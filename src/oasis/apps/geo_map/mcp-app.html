<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OASIS â€” Ghana Healthcare Map</title>
    <!-- All dependencies bundled by Vite - no CDN needed -->
    <style>
        :root {
            --accent: #FF6B35;
            --accent-glow: rgba(255,107,53,0.4);
            --accent-soft: rgba(255,107,53,0.15);
            --cyan: #00D4FF;
            --green: #00E676;
            --red: #FF5252;
            --yellow: #FFD740;
            --glass: rgba(10,12,20,0.82);
            --glass-border: rgba(255,255,255,0.08);
            --t1: #fff;
            --t2: rgba(255,255,255,0.6);
            --t3: rgba(255,255,255,0.35);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; overflow:hidden; background:#000; }
        #map { position:absolute; inset:0; }

        .glass {
            background: var(--glass);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.05);
        }
        .top-bar {
            position:absolute; top:20px; left:20px;
            z-index:1000; padding:10px 20px;
            display:flex; align-items:center; gap:10px;
        }
        .top-bar .logo {
            width:32px; height:32px;
            background:linear-gradient(135deg,var(--accent),#FF8F6B);
            border-radius:8px; display:flex; align-items:center; justify-content:center;
            font-size:18px; position:relative;
        }
        .top-bar .logo .status-dot {
            position:absolute; bottom:-3px; right:-3px;
            width:10px; height:10px;
            background:var(--green);
            border-radius:50%;
            border:2px solid rgba(10,12,20,0.9);
            box-shadow:0 0 6px rgba(0,230,118,0.6);
        }
        .top-bar h1 { font-size:18px; font-weight:700; color:var(--t1); letter-spacing:2px; }
        .nav-pills {
            position:absolute; bottom:20px; left:20px; z-index:1000;
            display:flex; flex-direction:column; gap:6px;
        }
        .nav-pill {
            padding:8px 14px;
            background:var(--glass); backdrop-filter:blur(24px);
            border:1px solid var(--glass-border); border-radius:10px;
            color:var(--t2); font-size:11px; font-weight:600;
            font-family:inherit; cursor:pointer; transition:all 0.3s;
            letter-spacing:0.5px;
        }
        .nav-pill:hover { background:rgba(255,255,255,0.1); color:var(--t1); transform:translateY(-2px); }
        .detail-card {
            position:absolute; top:80px; left:20px;
            width:320px; z-index:1000;
            display:none; overflow:hidden;
        }
        .detail-card.show { display:block; animation:slideDown 0.3s ease; }
        @keyframes slideDown { from{transform:translateY(-12px);opacity:0} to{transform:translateY(0);opacity:1} }
        .detail-header {
            padding:12px 16px; display:flex; justify-content:space-between; align-items:flex-start;
            border-bottom:1px solid var(--glass-border);
        }
        .detail-header h2 { font-size:14px; font-weight:700; color:var(--t1); }
        .type-badge {
            padding:3px 8px; background:var(--accent-soft);
            border:1px solid rgba(255,107,53,0.3); border-radius:12px;
            font-size:9px; font-weight:600; color:var(--accent);
            text-transform:uppercase; letter-spacing:0.5px;
        }
        .detail-actions { display:flex; gap:4px; }
        .close-btn, .recenter-btn {
            width:24px; height:24px; background:rgba(255,255,255,0.06);
            border:none; border-radius:6px; color:var(--t2); font-size:14px;
            cursor:pointer; display:flex; align-items:center; justify-content:center;
        }
        .close-btn:hover, .recenter-btn:hover { background:rgba(255,255,255,0.1); color:var(--t1); }
        .detail-stats {
            padding:10px 16px; display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px;
        }
        .stat-block { text-align:center; }
        .stat-val { font-size:18px; font-weight:800; color:var(--t1); }
        .stat-lbl { font-size:9px; color:var(--t3); text-transform:uppercase; letter-spacing:0.5px; margin-top:2px; }
        .detail-caps {
            padding:8px 16px 12px; border-top:1px solid var(--glass-border);
        }
        .detail-caps h4 { font-size:9px; color:var(--t3); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px; }
        .cap-chips { display:flex; flex-wrap:wrap; gap:4px; }
        .cap-chip {
            padding:2px 8px; background:rgba(0,212,255,0.08);
            border:1px solid rgba(0,212,255,0.15); border-radius:4px;
            font-size:10px; color:var(--cyan);
        }
        .layers {
            position:absolute; bottom:20px; right:20px; z-index:1000;
            display:flex; flex-direction:column; gap:8px;
        }
        .layer-btn {
            width:44px; height:44px; border-radius:12px;
            display:flex; align-items:center; justify-content:center;
            font-size:18px; cursor:pointer; border:none; position:relative;
            color:var(--t2); background:var(--glass);
            backdrop-filter:blur(24px); border:1px solid var(--glass-border);
            transition:all 0.3s;
        }
        .layer-btn:hover { background:rgba(255,255,255,0.1); color:var(--t1); transform:scale(1.1); }
        .layer-btn.on { background:var(--accent-soft); border-color:var(--accent); color:var(--accent); }
        .layer-btn .tip {
            position:absolute; right:56px; background:var(--glass); border:1px solid var(--glass-border);
            padding:6px 12px; border-radius:8px; font-size:11px; white-space:nowrap;
            opacity:0; pointer-events:none; transition:opacity 0.2s; color:var(--t2);
        }
        .layer-btn:hover .tip { opacity:1; }
        .legend {
            position:absolute; top:20px; right:20px; z-index:999;
            padding:12px 16px; display:none;
        }
        .legend.show { display:block; }
        .legend h4 { font-size:10px; color:var(--t3); text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; }
        .legend-bar {
            width:120px; height:8px; border-radius:4px;
            background:linear-gradient(90deg,rgba(0,0,0,0) 0%,#1a0530 15%,#6b0f6b 30%,#ff4444 50%,#ff9944 70%,#ffee44 85%,#fff 100%);
            margin-bottom:4px;
        }
        .legend-labels { display:flex; justify-content:space-between; font-size:9px; color:var(--t3); }
        .loader {
            position:fixed; inset:0; background:#000; z-index:9999;
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            transition:opacity 1s;
        }
        .loader.gone { opacity:0; pointer-events:none; }
        .loader-icon {
            width:64px; height:64px;
            background:linear-gradient(135deg,var(--accent),#FF8F6B);
            border-radius:16px; display:flex; align-items:center; justify-content:center;
            font-size:32px; margin-bottom:24px; animation:spin 2s ease infinite;
        }
        @keyframes spin { 0%,100%{transform:rotateY(0)} 50%{transform:rotateY(180deg)} }
        .loader-text { font-size:14px; color:var(--t2); letter-spacing:3px; text-transform:uppercase; }
        .loader-bar { width:200px; height:2px; background:rgba(255,255,255,0.1); border-radius:1px; margin-top:16px; overflow:hidden; }
        .loader-fill { height:100%; background:linear-gradient(90deg,var(--accent),#FF8F6B); border-radius:1px; animation:loadbar 2s ease forwards; }
        @keyframes loadbar { from{width:0} to{width:100%} }
        .mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-right{display:none}
        .mapboxgl-popup-content {
            background:var(--glass)!important; backdrop-filter:blur(24px);
            color:var(--t1)!important; border:1px solid var(--glass-border);
            border-radius:12px!important; padding:16px!important;
            box-shadow:0 8px 32px rgba(0,0,0,0.5)!important; min-width:200px;
        }
        .mapboxgl-popup-tip { border-top-color:var(--glass)!important; }
        .mapboxgl-popup-close-button { color:var(--t2)!important; font-size:18px!important; }
    </style>
  <script type="module" crossorigin>var B$=Object.defineProperty;var N$=(i,e,o)=>e in i?B$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[e]=o;var Ms=(i,e,o)=>N$(i,typeof e!="symbol"?e+"":e,o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))h(l);new MutationObserver(l=>{for(const f of l)if(f.type==="childList")for(const x of f.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&h(x)}).observe(document,{childList:!0,subtree:!0});function o(l){const f={};return l.integrity&&(f.integrity=l.integrity),l.referrerPolicy&&(f.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?f.credentials="include":l.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function h(l){if(l.ep)return;l.ep=!0;const f=o(l);fetch(l.href,f)}})();function Vt(i,e,o){function h(s,P){if(s._zod||Object.defineProperty(s,"_zod",{value:{def:P,constr:x,traits:new Set},enumerable:!1}),s._zod.traits.has(i))return;s._zod.traits.add(i),e(s,P);const C=x.prototype,O=Object.keys(C);for(let F=0;F<O.length;F++){const V=O[F];V in s||(s[V]=C[V].bind(s))}}const l=(o==null?void 0:o.Parent)??Object;class f extends l{}Object.defineProperty(f,"name",{value:i});function x(s){var P;const C=o!=null&&o.Parent?new f:this;h(C,s),(P=C._zod).deferred??(P.deferred=[]);for(const O of C._zod.deferred)O();return C}return Object.defineProperty(x,"init",{value:h}),Object.defineProperty(x,Symbol.hasInstance,{value:s=>{var P,C;return o!=null&&o.Parent&&s instanceof o.Parent?!0:(C=(P=s==null?void 0:s._zod)==null?void 0:P.traits)==null?void 0:C.has(i)}}),Object.defineProperty(x,"name",{value:i}),x}class dp extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class QL extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const eR={};function $u(i){return eR}function tR(i){const e=Object.values(i).filter(h=>typeof h=="number");return Object.entries(i).filter(([h,l])=>e.indexOf(+h)===-1).map(([h,l])=>l)}function KS(i,e){return typeof e=="bigint"?e.toString():e}function tb(i){return{get value(){{const e=i();return Object.defineProperty(this,"value",{value:e}),e}}}}function kT(i){return i==null}function OT(i){const e=i.startsWith("^")?1:0,o=i.endsWith("$")?i.length-1:i.length;return i.slice(e,o)}function U$(i,e){const o=(i.toString().split(".")[1]||"").length,h=e.toString();let l=(h.split(".")[1]||"").length;if(l===0&&/\d?e-\d?/.test(h)){const P=h.match(/\d?e-(\d?)/);P!=null&&P[1]&&(l=Number.parseInt(P[1]))}const f=o>l?o:l,x=Number.parseInt(i.toFixed(f).replace(".","")),s=Number.parseInt(e.toFixed(f).replace(".",""));return x%s/10**f}const Uz=Symbol("evaluating");function Mr(i,e,o){let h;Object.defineProperty(i,e,{get(){if(h!==Uz)return h===void 0&&(h=Uz,h=o()),h},set(l){Object.defineProperty(i,e,{value:l})},configurable:!0})}function dd(i,e,o){Object.defineProperty(i,e,{value:o,writable:!0,enumerable:!0,configurable:!0})}function qu(...i){const e={};for(const o of i){const h=Object.getOwnPropertyDescriptors(o);Object.assign(e,h)}return Object.defineProperties({},e)}function $z(i){return JSON.stringify(i)}function $$(i){return i.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const iR="captureStackTrace"in Error?Error.captureStackTrace:(...i)=>{};function b_(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}const V$=tb(()=>{var i;if(typeof navigator<"u"&&((i=navigator==null?void 0:navigator.userAgent)!=null&&i.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function pp(i){if(b_(i)===!1)return!1;const e=i.constructor;if(e===void 0||typeof e!="function")return!0;const o=e.prototype;return!(b_(o)===!1||Object.prototype.hasOwnProperty.call(o,"isPrototypeOf")===!1)}function nR(i){return pp(i)?{...i}:Array.isArray(i)?[...i]:i}const j$=new Set(["string","number","symbol"]);function mp(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Xu(i,e,o){const h=new i._zod.constr(e??i._zod.def);return(!e||o!=null&&o.parent)&&(h._zod.parent=i),h}function Qi(i){const e=i;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function G$(i){return Object.keys(i).filter(e=>i[e]._zod.optin==="optional"&&i[e]._zod.optout==="optional")}const H$={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Z$(i,e){const o=i._zod.def,h=o.checks;if(h&&h.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const f=qu(i._zod.def,{get shape(){const x={};for(const s in e){if(!(s in o.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&(x[s]=o.shape[s])}return dd(this,"shape",x),x},checks:[]});return Xu(i,f)}function W$(i,e){const o=i._zod.def,h=o.checks;if(h&&h.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const f=qu(i._zod.def,{get shape(){const x={...i._zod.def.shape};for(const s in e){if(!(s in o.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&delete x[s]}return dd(this,"shape",x),x},checks:[]});return Xu(i,f)}function q$(i,e){if(!pp(e))throw new Error("Invalid input to extend: expected a plain object");const o=i._zod.def.checks;if(o&&o.length>0){const f=i._zod.def.shape;for(const x in e)if(Object.getOwnPropertyDescriptor(f,x)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const l=qu(i._zod.def,{get shape(){const f={...i._zod.def.shape,...e};return dd(this,"shape",f),f}});return Xu(i,l)}function X$(i,e){if(!pp(e))throw new Error("Invalid input to safeExtend: expected a plain object");const o=qu(i._zod.def,{get shape(){const h={...i._zod.def.shape,...e};return dd(this,"shape",h),h}});return Xu(i,o)}function J$(i,e){const o=qu(i._zod.def,{get shape(){const h={...i._zod.def.shape,...e._zod.def.shape};return dd(this,"shape",h),h},get catchall(){return e._zod.def.catchall},checks:[]});return Xu(i,o)}function Y$(i,e,o){const l=e._zod.def.checks;if(l&&l.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const x=qu(e._zod.def,{get shape(){const s=e._zod.def.shape,P={...s};if(o)for(const C in o){if(!(C in s))throw new Error(`Unrecognized key: "${C}"`);o[C]&&(P[C]=i?new i({type:"optional",innerType:s[C]}):s[C])}else for(const C in s)P[C]=i?new i({type:"optional",innerType:s[C]}):s[C];return dd(this,"shape",P),P},checks:[]});return Xu(e,x)}function K$(i,e,o){const h=qu(e._zod.def,{get shape(){const l=e._zod.def.shape,f={...l};if(o)for(const x in o){if(!(x in f))throw new Error(`Unrecognized key: "${x}"`);o[x]&&(f[x]=new i({type:"nonoptional",innerType:l[x]}))}else for(const x in l)f[x]=new i({type:"nonoptional",innerType:l[x]});return dd(this,"shape",f),f}});return Xu(e,h)}function sp(i,e=0){var o;if(i.aborted===!0)return!0;for(let h=e;h<i.issues.length;h++)if(((o=i.issues[h])==null?void 0:o.continue)!==!0)return!0;return!1}function ap(i,e){return e.map(o=>{var h;return(h=o).path??(h.path=[]),o.path.unshift(i),o})}function $x(i){return typeof i=="string"?i:i==null?void 0:i.message}function Vu(i,e,o){var l,f,x,s,P,C;const h={...i,path:i.path??[]};if(!i.message){const O=$x((x=(f=(l=i.inst)==null?void 0:l._zod.def)==null?void 0:f.error)==null?void 0:x.call(f,i))??$x((s=e==null?void 0:e.error)==null?void 0:s.call(e,i))??$x((P=o.customError)==null?void 0:P.call(o,i))??$x((C=o.localeError)==null?void 0:C.call(o,i))??"Invalid input";h.message=O}return delete h.inst,delete h.continue,e!=null&&e.reportInput||delete h.input,h}function FT(i){return Array.isArray(i)?"array":typeof i=="string"?"string":"unknown"}function w_(...i){const[e,o,h]=i;return typeof e=="string"?{message:e,code:"custom",input:o,inst:h}:{...e}}const rR=(i,e)=>{i.name="$ZodError",Object.defineProperty(i,"_zod",{value:i._zod,enumerable:!1}),Object.defineProperty(i,"issues",{value:e,enumerable:!1}),i.message=JSON.stringify(e,KS,2),Object.defineProperty(i,"toString",{value:()=>i.message,enumerable:!1})},oR=Vt("$ZodError",rR),sR=Vt("$ZodError",rR,{Parent:Error});function Q$(i,e=o=>o.message){const o={},h=[];for(const l of i.issues)l.path.length>0?(o[l.path[0]]=o[l.path[0]]||[],o[l.path[0]].push(e(l))):h.push(e(l));return{formErrors:h,fieldErrors:o}}function e6(i,e=o=>o.message){const o={_errors:[]},h=l=>{for(const f of l.issues)if(f.code==="invalid_union"&&f.errors.length)f.errors.map(x=>h({issues:x}));else if(f.code==="invalid_key")h({issues:f.issues});else if(f.code==="invalid_element")h({issues:f.issues});else if(f.path.length===0)o._errors.push(e(f));else{let x=o,s=0;for(;s<f.path.length;){const P=f.path[s];s===f.path.length-1?(x[P]=x[P]||{_errors:[]},x[P]._errors.push(e(f))):x[P]=x[P]||{_errors:[]},x=x[P],s++}}};return h(i),o}const BT=i=>(e,o,h,l)=>{const f=h?Object.assign(h,{async:!1}):{async:!1},x=e._zod.run({value:o,issues:[]},f);if(x instanceof Promise)throw new dp;if(x.issues.length){const s=new((l==null?void 0:l.Err)??i)(x.issues.map(P=>Vu(P,f,$u())));throw iR(s,l==null?void 0:l.callee),s}return x.value},NT=i=>async(e,o,h,l)=>{const f=h?Object.assign(h,{async:!0}):{async:!0};let x=e._zod.run({value:o,issues:[]},f);if(x instanceof Promise&&(x=await x),x.issues.length){const s=new((l==null?void 0:l.Err)??i)(x.issues.map(P=>Vu(P,f,$u())));throw iR(s,l==null?void 0:l.callee),s}return x.value},ib=i=>(e,o,h)=>{const l=h?{...h,async:!1}:{async:!1},f=e._zod.run({value:o,issues:[]},l);if(f instanceof Promise)throw new dp;return f.issues.length?{success:!1,error:new(i??oR)(f.issues.map(x=>Vu(x,l,$u())))}:{success:!0,data:f.value}},aR=ib(sR),nb=i=>async(e,o,h)=>{const l=h?Object.assign(h,{async:!0}):{async:!0};let f=e._zod.run({value:o,issues:[]},l);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new i(f.issues.map(x=>Vu(x,l,$u())))}:{success:!0,data:f.value}},t6=nb(sR),i6=i=>(e,o,h)=>{const l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return BT(i)(e,o,l)},n6=i=>(e,o,h)=>BT(i)(e,o,h),r6=i=>async(e,o,h)=>{const l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return NT(i)(e,o,l)},o6=i=>async(e,o,h)=>NT(i)(e,o,h),s6=i=>(e,o,h)=>{const l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return ib(i)(e,o,l)},a6=i=>(e,o,h)=>ib(i)(e,o,h),l6=i=>async(e,o,h)=>{const l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return nb(i)(e,o,l)},c6=i=>async(e,o,h)=>nb(i)(e,o,h),u6=/^[cC][^\s-]{8,}$/,h6=/^[0-9a-z]+$/,d6=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,f6=/^[0-9a-vA-V]{20}$/,p6=/^[A-Za-z0-9]{27}$/,m6=/^[a-zA-Z0-9_-]{21}$/,g6=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,_6=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Vz=i=>i?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${i}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,y6=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,v6="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function x6(){return new RegExp(v6,"u")}const b6=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,w6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,S6=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,T6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,E6=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,lR=/^[A-Za-z0-9_-]*$/,I6=/^\+[1-9]\d{6,14}$/,cR="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",M6=new RegExp(`^${cR}$`);function uR(i){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof i.precision=="number"?i.precision===-1?`${e}`:i.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${i.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function A6(i){return new RegExp(`^${uR(i)}$`)}function P6(i){const e=uR({precision:i.precision}),o=["Z"];i.local&&o.push(""),i.offset&&o.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const h=`${e}(?:${o.join("|")})`;return new RegExp(`^${cR}T(?:${h})$`)}const z6=i=>{const e=i?`[\\s\\S]{${(i==null?void 0:i.minimum)??0},${(i==null?void 0:i.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},C6=/^-?\d+$/,hR=/^-?\d+(?:\.\d+)?$/,L6=/^(?:true|false)$/i,R6=/^null$/i,D6=/^[^A-Z]*$/,k6=/^[^a-z]*$/,ca=Vt("$ZodCheck",(i,e)=>{var o;i._zod??(i._zod={}),i._zod.def=e,(o=i._zod).onattach??(o.onattach=[])}),dR={number:"number",bigint:"bigint",object:"date"},fR=Vt("$ZodCheckLessThan",(i,e)=>{ca.init(i,e);const o=dR[typeof e.value];i._zod.onattach.push(h=>{const l=h._zod.bag,f=(e.inclusive?l.maximum:l.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<f&&(e.inclusive?l.maximum=e.value:l.exclusiveMaximum=e.value)}),i._zod.check=h=>{(e.inclusive?h.value<=e.value:h.value<e.value)||h.issues.push({origin:o,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:h.value,inclusive:e.inclusive,inst:i,continue:!e.abort})}}),pR=Vt("$ZodCheckGreaterThan",(i,e)=>{ca.init(i,e);const o=dR[typeof e.value];i._zod.onattach.push(h=>{const l=h._zod.bag,f=(e.inclusive?l.minimum:l.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>f&&(e.inclusive?l.minimum=e.value:l.exclusiveMinimum=e.value)}),i._zod.check=h=>{(e.inclusive?h.value>=e.value:h.value>e.value)||h.issues.push({origin:o,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:h.value,inclusive:e.inclusive,inst:i,continue:!e.abort})}}),O6=Vt("$ZodCheckMultipleOf",(i,e)=>{ca.init(i,e),i._zod.onattach.push(o=>{var h;(h=o._zod.bag).multipleOf??(h.multipleOf=e.value)}),i._zod.check=o=>{if(typeof o.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof o.value=="bigint"?o.value%e.value===BigInt(0):U$(o.value,e.value)===0)||o.issues.push({origin:typeof o.value,code:"not_multiple_of",divisor:e.value,input:o.value,inst:i,continue:!e.abort})}}),F6=Vt("$ZodCheckNumberFormat",(i,e)=>{var x;ca.init(i,e),e.format=e.format||"float64";const o=(x=e.format)==null?void 0:x.includes("int"),h=o?"int":"number",[l,f]=H$[e.format];i._zod.onattach.push(s=>{const P=s._zod.bag;P.format=e.format,P.minimum=l,P.maximum=f,o&&(P.pattern=C6)}),i._zod.check=s=>{const P=s.value;if(o){if(!Number.isInteger(P)){s.issues.push({expected:h,format:e.format,code:"invalid_type",continue:!1,input:P,inst:i});return}if(!Number.isSafeInteger(P)){P>0?s.issues.push({input:P,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:i,origin:h,inclusive:!0,continue:!e.abort}):s.issues.push({input:P,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:i,origin:h,inclusive:!0,continue:!e.abort});return}}P<l&&s.issues.push({origin:"number",input:P,code:"too_small",minimum:l,inclusive:!0,inst:i,continue:!e.abort}),P>f&&s.issues.push({origin:"number",input:P,code:"too_big",maximum:f,inclusive:!0,inst:i,continue:!e.abort})}}),B6=Vt("$ZodCheckMaxLength",(i,e)=>{var o;ca.init(i,e),(o=i._zod.def).when??(o.when=h=>{const l=h.value;return!kT(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{const l=h._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<l&&(h._zod.bag.maximum=e.maximum)}),i._zod.check=h=>{const l=h.value;if(l.length<=e.maximum)return;const x=FT(l);h.issues.push({origin:x,code:"too_big",maximum:e.maximum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),N6=Vt("$ZodCheckMinLength",(i,e)=>{var o;ca.init(i,e),(o=i._zod.def).when??(o.when=h=>{const l=h.value;return!kT(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{const l=h._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>l&&(h._zod.bag.minimum=e.minimum)}),i._zod.check=h=>{const l=h.value;if(l.length>=e.minimum)return;const x=FT(l);h.issues.push({origin:x,code:"too_small",minimum:e.minimum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),U6=Vt("$ZodCheckLengthEquals",(i,e)=>{var o;ca.init(i,e),(o=i._zod.def).when??(o.when=h=>{const l=h.value;return!kT(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{const l=h._zod.bag;l.minimum=e.length,l.maximum=e.length,l.length=e.length}),i._zod.check=h=>{const l=h.value,f=l.length;if(f===e.length)return;const x=FT(l),s=f>e.length;h.issues.push({origin:x,...s?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:h.value,inst:i,continue:!e.abort})}}),rb=Vt("$ZodCheckStringFormat",(i,e)=>{var o,h;ca.init(i,e),i._zod.onattach.push(l=>{const f=l._zod.bag;f.format=e.format,e.pattern&&(f.patterns??(f.patterns=new Set),f.patterns.add(e.pattern))}),e.pattern?(o=i._zod).check??(o.check=l=>{e.pattern.lastIndex=0,!e.pattern.test(l.value)&&l.issues.push({origin:"string",code:"invalid_format",format:e.format,input:l.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:i,continue:!e.abort})}):(h=i._zod).check??(h.check=()=>{})}),$6=Vt("$ZodCheckRegex",(i,e)=>{rb.init(i,e),i._zod.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:"regex",input:o.value,pattern:e.pattern.toString(),inst:i,continue:!e.abort})}}),V6=Vt("$ZodCheckLowerCase",(i,e)=>{e.pattern??(e.pattern=D6),rb.init(i,e)}),j6=Vt("$ZodCheckUpperCase",(i,e)=>{e.pattern??(e.pattern=k6),rb.init(i,e)}),G6=Vt("$ZodCheckIncludes",(i,e)=>{ca.init(i,e);const o=mp(e.includes),h=new RegExp(typeof e.position=="number"?`^.{${e.position}}${o}`:o);e.pattern=h,i._zod.onattach.push(l=>{const f=l._zod.bag;f.patterns??(f.patterns=new Set),f.patterns.add(h)}),i._zod.check=l=>{l.value.includes(e.includes,e.position)||l.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:l.value,inst:i,continue:!e.abort})}}),H6=Vt("$ZodCheckStartsWith",(i,e)=>{ca.init(i,e);const o=new RegExp(`^${mp(e.prefix)}.*`);e.pattern??(e.pattern=o),i._zod.onattach.push(h=>{const l=h._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(o)}),i._zod.check=h=>{h.value.startsWith(e.prefix)||h.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:h.value,inst:i,continue:!e.abort})}}),Z6=Vt("$ZodCheckEndsWith",(i,e)=>{ca.init(i,e);const o=new RegExp(`.*${mp(e.suffix)}$`);e.pattern??(e.pattern=o),i._zod.onattach.push(h=>{const l=h._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(o)}),i._zod.check=h=>{h.value.endsWith(e.suffix)||h.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:h.value,inst:i,continue:!e.abort})}}),W6=Vt("$ZodCheckOverwrite",(i,e)=>{ca.init(i,e),i._zod.check=o=>{o.value=e.tx(o.value)}});class q6{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const h=e.split(`
`).filter(x=>x),l=Math.min(...h.map(x=>x.length-x.trimStart().length)),f=h.map(x=>x.slice(l)).map(x=>" ".repeat(this.indent*2)+x);for(const x of f)this.content.push(x)}compile(){const e=Function,o=this==null?void 0:this.args,l=[...((this==null?void 0:this.content)??[""]).map(f=>`  ${f}`)];return new e(...o,l.join(`
`))}}const X6={major:4,minor:3,patch:6},eo=Vt("$ZodType",(i,e)=>{var l;var o;i??(i={}),i._zod.def=e,i._zod.bag=i._zod.bag||{},i._zod.version=X6;const h=[...i._zod.def.checks??[]];i._zod.traits.has("$ZodCheck")&&h.unshift(i);for(const f of h)for(const x of f._zod.onattach)x(i);if(h.length===0)(o=i._zod).deferred??(o.deferred=[]),(l=i._zod.deferred)==null||l.push(()=>{i._zod.run=i._zod.parse});else{const f=(s,P,C)=>{let O=sp(s),F;for(const V of P){if(V._zod.def.when){if(!V._zod.def.when(s))continue}else if(O)continue;const q=s.issues.length,ee=V._zod.check(s);if(ee instanceof Promise&&(C==null?void 0:C.async)===!1)throw new dp;if(F||ee instanceof Promise)F=(F??Promise.resolve()).then(async()=>{await ee,s.issues.length!==q&&(O||(O=sp(s,q)))});else{if(s.issues.length===q)continue;O||(O=sp(s,q))}}return F?F.then(()=>s):s},x=(s,P,C)=>{if(sp(s))return s.aborted=!0,s;const O=f(P,h,C);if(O instanceof Promise){if(C.async===!1)throw new dp;return O.then(F=>i._zod.parse(F,C))}return i._zod.parse(O,C)};i._zod.run=(s,P)=>{if(P.skipChecks)return i._zod.parse(s,P);if(P.direction==="backward"){const O=i._zod.parse({value:s.value,issues:[]},{...P,skipChecks:!0});return O instanceof Promise?O.then(F=>x(F,s,P)):x(O,s,P)}const C=i._zod.parse(s,P);if(C instanceof Promise){if(P.async===!1)throw new dp;return C.then(O=>f(O,h,P))}return f(C,h,P)}}Mr(i,"~standard",()=>({validate:f=>{var x;try{const s=aR(i,f);return s.success?{value:s.data}:{issues:(x=s.error)==null?void 0:x.issues}}catch{return t6(i,f).then(P=>{var C;return P.success?{value:P.data}:{issues:(C=P.error)==null?void 0:C.issues}})}},vendor:"zod",version:1}))}),UT=Vt("$ZodString",(i,e)=>{var o;eo.init(i,e),i._zod.pattern=[...((o=i==null?void 0:i._zod.bag)==null?void 0:o.patterns)??[]].pop()??z6(i._zod.bag),i._zod.parse=(h,l)=>{if(e.coerce)try{h.value=String(h.value)}catch{}return typeof h.value=="string"||h.issues.push({expected:"string",code:"invalid_type",input:h.value,inst:i}),h}}),to=Vt("$ZodStringFormat",(i,e)=>{rb.init(i,e),UT.init(i,e)}),J6=Vt("$ZodGUID",(i,e)=>{e.pattern??(e.pattern=_6),to.init(i,e)}),Y6=Vt("$ZodUUID",(i,e)=>{if(e.version){const h={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(h===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Vz(h))}else e.pattern??(e.pattern=Vz());to.init(i,e)}),K6=Vt("$ZodEmail",(i,e)=>{e.pattern??(e.pattern=y6),to.init(i,e)}),Q6=Vt("$ZodURL",(i,e)=>{to.init(i,e),i._zod.check=o=>{try{const h=o.value.trim(),l=new URL(h);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(l.hostname)||o.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:o.value,inst:i,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(l.protocol.endsWith(":")?l.protocol.slice(0,-1):l.protocol)||o.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:o.value,inst:i,continue:!e.abort})),e.normalize?o.value=l.href:o.value=h;return}catch{o.issues.push({code:"invalid_format",format:"url",input:o.value,inst:i,continue:!e.abort})}}}),eV=Vt("$ZodEmoji",(i,e)=>{e.pattern??(e.pattern=x6()),to.init(i,e)}),tV=Vt("$ZodNanoID",(i,e)=>{e.pattern??(e.pattern=m6),to.init(i,e)}),iV=Vt("$ZodCUID",(i,e)=>{e.pattern??(e.pattern=u6),to.init(i,e)}),nV=Vt("$ZodCUID2",(i,e)=>{e.pattern??(e.pattern=h6),to.init(i,e)}),rV=Vt("$ZodULID",(i,e)=>{e.pattern??(e.pattern=d6),to.init(i,e)}),oV=Vt("$ZodXID",(i,e)=>{e.pattern??(e.pattern=f6),to.init(i,e)}),sV=Vt("$ZodKSUID",(i,e)=>{e.pattern??(e.pattern=p6),to.init(i,e)}),aV=Vt("$ZodISODateTime",(i,e)=>{e.pattern??(e.pattern=P6(e)),to.init(i,e)}),lV=Vt("$ZodISODate",(i,e)=>{e.pattern??(e.pattern=M6),to.init(i,e)}),cV=Vt("$ZodISOTime",(i,e)=>{e.pattern??(e.pattern=A6(e)),to.init(i,e)}),uV=Vt("$ZodISODuration",(i,e)=>{e.pattern??(e.pattern=g6),to.init(i,e)}),hV=Vt("$ZodIPv4",(i,e)=>{e.pattern??(e.pattern=b6),to.init(i,e),i._zod.bag.format="ipv4"}),dV=Vt("$ZodIPv6",(i,e)=>{e.pattern??(e.pattern=w6),to.init(i,e),i._zod.bag.format="ipv6",i._zod.check=o=>{try{new URL(`http://[${o.value}]`)}catch{o.issues.push({code:"invalid_format",format:"ipv6",input:o.value,inst:i,continue:!e.abort})}}}),fV=Vt("$ZodCIDRv4",(i,e)=>{e.pattern??(e.pattern=S6),to.init(i,e)}),pV=Vt("$ZodCIDRv6",(i,e)=>{e.pattern??(e.pattern=T6),to.init(i,e),i._zod.check=o=>{const h=o.value.split("/");try{if(h.length!==2)throw new Error;const[l,f]=h;if(!f)throw new Error;const x=Number(f);if(`${x}`!==f)throw new Error;if(x<0||x>128)throw new Error;new URL(`http://[${l}]`)}catch{o.issues.push({code:"invalid_format",format:"cidrv6",input:o.value,inst:i,continue:!e.abort})}}});function mR(i){if(i==="")return!0;if(i.length%4!==0)return!1;try{return atob(i),!0}catch{return!1}}const mV=Vt("$ZodBase64",(i,e)=>{e.pattern??(e.pattern=E6),to.init(i,e),i._zod.bag.contentEncoding="base64",i._zod.check=o=>{mR(o.value)||o.issues.push({code:"invalid_format",format:"base64",input:o.value,inst:i,continue:!e.abort})}});function gV(i){if(!lR.test(i))return!1;const e=i.replace(/[-_]/g,h=>h==="-"?"+":"/"),o=e.padEnd(Math.ceil(e.length/4)*4,"=");return mR(o)}const _V=Vt("$ZodBase64URL",(i,e)=>{e.pattern??(e.pattern=lR),to.init(i,e),i._zod.bag.contentEncoding="base64url",i._zod.check=o=>{gV(o.value)||o.issues.push({code:"invalid_format",format:"base64url",input:o.value,inst:i,continue:!e.abort})}}),yV=Vt("$ZodE164",(i,e)=>{e.pattern??(e.pattern=I6),to.init(i,e)});function vV(i,e=null){try{const o=i.split(".");if(o.length!==3)return!1;const[h]=o;if(!h)return!1;const l=JSON.parse(atob(h));return!("typ"in l&&(l==null?void 0:l.typ)!=="JWT"||!l.alg||e&&(!("alg"in l)||l.alg!==e))}catch{return!1}}const xV=Vt("$ZodJWT",(i,e)=>{to.init(i,e),i._zod.check=o=>{vV(o.value,e.alg)||o.issues.push({code:"invalid_format",format:"jwt",input:o.value,inst:i,continue:!e.abort})}}),gR=Vt("$ZodNumber",(i,e)=>{eo.init(i,e),i._zod.pattern=i._zod.bag.pattern??hR,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=Number(o.value)}catch{}const l=o.value;if(typeof l=="number"&&!Number.isNaN(l)&&Number.isFinite(l))return o;const f=typeof l=="number"?Number.isNaN(l)?"NaN":Number.isFinite(l)?void 0:"Infinity":void 0;return o.issues.push({expected:"number",code:"invalid_type",input:l,inst:i,...f?{received:f}:{}}),o}}),bV=Vt("$ZodNumberFormat",(i,e)=>{F6.init(i,e),gR.init(i,e)}),wV=Vt("$ZodBoolean",(i,e)=>{eo.init(i,e),i._zod.pattern=L6,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=!!o.value}catch{}const l=o.value;return typeof l=="boolean"||o.issues.push({expected:"boolean",code:"invalid_type",input:l,inst:i}),o}}),SV=Vt("$ZodNull",(i,e)=>{eo.init(i,e),i._zod.pattern=R6,i._zod.values=new Set([null]),i._zod.parse=(o,h)=>{const l=o.value;return l===null||o.issues.push({expected:"null",code:"invalid_type",input:l,inst:i}),o}}),TV=Vt("$ZodUnknown",(i,e)=>{eo.init(i,e),i._zod.parse=o=>o}),EV=Vt("$ZodNever",(i,e)=>{eo.init(i,e),i._zod.parse=(o,h)=>(o.issues.push({expected:"never",code:"invalid_type",input:o.value,inst:i}),o)});function jz(i,e,o){i.issues.length&&e.issues.push(...ap(o,i.issues)),e.value[o]=i.value}const IV=Vt("$ZodArray",(i,e)=>{eo.init(i,e),i._zod.parse=(o,h)=>{const l=o.value;if(!Array.isArray(l))return o.issues.push({expected:"array",code:"invalid_type",input:l,inst:i}),o;o.value=Array(l.length);const f=[];for(let x=0;x<l.length;x++){const s=l[x],P=e.element._zod.run({value:s,issues:[]},h);P instanceof Promise?f.push(P.then(C=>jz(C,o,x))):jz(P,o,x)}return f.length?Promise.all(f).then(()=>o):o}});function M0(i,e,o,h,l){if(i.issues.length){if(l&&!(o in h))return;e.issues.push(...ap(o,i.issues))}i.value===void 0?o in h&&(e.value[o]=void 0):e.value[o]=i.value}function _R(i){var h,l,f,x;const e=Object.keys(i.shape);for(const s of e)if(!((x=(f=(l=(h=i.shape)==null?void 0:h[s])==null?void 0:l._zod)==null?void 0:f.traits)!=null&&x.has("$ZodType")))throw new Error(`Invalid element at key "${s}": expected a Zod schema`);const o=G$(i.shape);return{...i,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(o)}}function yR(i,e,o,h,l,f){const x=[],s=l.keySet,P=l.catchall._zod,C=P.def.type,O=P.optout==="optional";for(const F in e){if(s.has(F))continue;if(C==="never"){x.push(F);continue}const V=P.run({value:e[F],issues:[]},h);V instanceof Promise?i.push(V.then(q=>M0(q,o,F,e,O))):M0(V,o,F,e,O)}return x.length&&o.issues.push({code:"unrecognized_keys",keys:x,input:e,inst:f}),i.length?Promise.all(i).then(()=>o):o}const MV=Vt("$ZodObject",(i,e)=>{eo.init(i,e);const o=Object.getOwnPropertyDescriptor(e,"shape");if(!(o!=null&&o.get)){const s=e.shape;Object.defineProperty(e,"shape",{get:()=>{const P={...s};return Object.defineProperty(e,"shape",{value:P}),P}})}const h=tb(()=>_R(e));Mr(i._zod,"propValues",()=>{const s=e.shape,P={};for(const C in s){const O=s[C]._zod;if(O.values){P[C]??(P[C]=new Set);for(const F of O.values)P[C].add(F)}}return P});const l=b_,f=e.catchall;let x;i._zod.parse=(s,P)=>{x??(x=h.value);const C=s.value;if(!l(C))return s.issues.push({expected:"object",code:"invalid_type",input:C,inst:i}),s;s.value={};const O=[],F=x.shape;for(const V of x.keys){const q=F[V],ee=q._zod.optout==="optional",se=q._zod.run({value:C[V],issues:[]},P);se instanceof Promise?O.push(se.then(fe=>M0(fe,s,V,C,ee))):M0(se,s,V,C,ee)}return f?yR(O,C,s,P,h.value,i):O.length?Promise.all(O).then(()=>s):s}}),AV=Vt("$ZodObjectJIT",(i,e)=>{MV.init(i,e);const o=i._zod.parse,h=tb(()=>_R(e)),l=V=>{var tt;const q=new q6(["shape","payload","ctx"]),ee=h.value,se=Ue=>{const Ne=$z(Ue);return`shape[${Ne}]._zod.run({ value: input[${Ne}], issues: [] }, ctx)`};q.write("const input = payload.value;");const fe=Object.create(null);let ae=0;for(const Ue of ee.keys)fe[Ue]=`key_${ae++}`;q.write("const newResult = {};");for(const Ue of ee.keys){const Ne=fe[Ue],Ce=$z(Ue),Ye=V[Ue],At=((tt=Ye==null?void 0:Ye._zod)==null?void 0:tt.optout)==="optional";q.write(`const ${Ne} = ${se(Ue)};`),At?q.write(`
        if (${Ne}.issues.length) {
          if (${Ce} in input) {
            payload.issues = payload.issues.concat(${Ne}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${Ce}, ...iss.path] : [${Ce}]
            })));
          }
        }
        
        if (${Ne}.value === undefined) {
          if (${Ce} in input) {
            newResult[${Ce}] = undefined;
          }
        } else {
          newResult[${Ce}] = ${Ne}.value;
        }
        
      `):q.write(`
        if (${Ne}.issues.length) {
          payload.issues = payload.issues.concat(${Ne}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Ce}, ...iss.path] : [${Ce}]
          })));
        }
        
        if (${Ne}.value === undefined) {
          if (${Ce} in input) {
            newResult[${Ce}] = undefined;
          }
        } else {
          newResult[${Ce}] = ${Ne}.value;
        }
        
      `)}q.write("payload.value = newResult;"),q.write("return payload;");const ie=q.compile();return(Ue,Ne)=>ie(V,Ue,Ne)};let f;const x=b_,s=!eR.jitless,C=s&&V$.value,O=e.catchall;let F;i._zod.parse=(V,q)=>{F??(F=h.value);const ee=V.value;return x(ee)?s&&C&&(q==null?void 0:q.async)===!1&&q.jitless!==!0?(f||(f=l(e.shape)),V=f(V,q),O?yR([],ee,V,q,F,i):V):o(V,q):(V.issues.push({expected:"object",code:"invalid_type",input:ee,inst:i}),V)}});function Gz(i,e,o,h){for(const f of i)if(f.issues.length===0)return e.value=f.value,e;const l=i.filter(f=>!sp(f));return l.length===1?(e.value=l[0].value,l[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:o,errors:i.map(f=>f.issues.map(x=>Vu(x,h,$u())))}),e)}const vR=Vt("$ZodUnion",(i,e)=>{eo.init(i,e),Mr(i._zod,"optin",()=>e.options.some(l=>l._zod.optin==="optional")?"optional":void 0),Mr(i._zod,"optout",()=>e.options.some(l=>l._zod.optout==="optional")?"optional":void 0),Mr(i._zod,"values",()=>{if(e.options.every(l=>l._zod.values))return new Set(e.options.flatMap(l=>Array.from(l._zod.values)))}),Mr(i._zod,"pattern",()=>{if(e.options.every(l=>l._zod.pattern)){const l=e.options.map(f=>f._zod.pattern);return new RegExp(`^(${l.map(f=>OT(f.source)).join("|")})$`)}});const o=e.options.length===1,h=e.options[0]._zod.run;i._zod.parse=(l,f)=>{if(o)return h(l,f);let x=!1;const s=[];for(const P of e.options){const C=P._zod.run({value:l.value,issues:[]},f);if(C instanceof Promise)s.push(C),x=!0;else{if(C.issues.length===0)return C;s.push(C)}}return x?Promise.all(s).then(P=>Gz(P,l,i,f)):Gz(s,l,i,f)}}),PV=Vt("$ZodDiscriminatedUnion",(i,e)=>{e.inclusive=!1,vR.init(i,e);const o=i._zod.parse;Mr(i._zod,"propValues",()=>{const l={};for(const f of e.options){const x=f._zod.propValues;if(!x||Object.keys(x).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(f)}"`);for(const[s,P]of Object.entries(x)){l[s]||(l[s]=new Set);for(const C of P)l[s].add(C)}}return l});const h=tb(()=>{var x;const l=e.options,f=new Map;for(const s of l){const P=(x=s._zod.propValues)==null?void 0:x[e.discriminator];if(!P||P.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(const C of P){if(f.has(C))throw new Error(`Duplicate discriminator value "${String(C)}"`);f.set(C,s)}}return f});i._zod.parse=(l,f)=>{const x=l.value;if(!b_(x))return l.issues.push({code:"invalid_type",expected:"object",input:x,inst:i}),l;const s=h.value.get(x==null?void 0:x[e.discriminator]);return s?s._zod.run(l,f):e.unionFallback?o(l,f):(l.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:x,path:[e.discriminator],inst:i}),l)}}),zV=Vt("$ZodIntersection",(i,e)=>{eo.init(i,e),i._zod.parse=(o,h)=>{const l=o.value,f=e.left._zod.run({value:l,issues:[]},h),x=e.right._zod.run({value:l,issues:[]},h);return f instanceof Promise||x instanceof Promise?Promise.all([f,x]).then(([P,C])=>Hz(o,P,C)):Hz(o,f,x)}});function QS(i,e){if(i===e)return{valid:!0,data:i};if(i instanceof Date&&e instanceof Date&&+i==+e)return{valid:!0,data:i};if(pp(i)&&pp(e)){const o=Object.keys(e),h=Object.keys(i).filter(f=>o.indexOf(f)!==-1),l={...i,...e};for(const f of h){const x=QS(i[f],e[f]);if(!x.valid)return{valid:!1,mergeErrorPath:[f,...x.mergeErrorPath]};l[f]=x.data}return{valid:!0,data:l}}if(Array.isArray(i)&&Array.isArray(e)){if(i.length!==e.length)return{valid:!1,mergeErrorPath:[]};const o=[];for(let h=0;h<i.length;h++){const l=i[h],f=e[h],x=QS(l,f);if(!x.valid)return{valid:!1,mergeErrorPath:[h,...x.mergeErrorPath]};o.push(x.data)}return{valid:!0,data:o}}return{valid:!1,mergeErrorPath:[]}}function Hz(i,e,o){const h=new Map;let l;for(const s of e.issues)if(s.code==="unrecognized_keys"){l??(l=s);for(const P of s.keys)h.has(P)||h.set(P,{}),h.get(P).l=!0}else i.issues.push(s);for(const s of o.issues)if(s.code==="unrecognized_keys")for(const P of s.keys)h.has(P)||h.set(P,{}),h.get(P).r=!0;else i.issues.push(s);const f=[...h].filter(([,s])=>s.l&&s.r).map(([s])=>s);if(f.length&&l&&i.issues.push({...l,keys:f}),sp(i))return i;const x=QS(e.value,o.value);if(!x.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(x.mergeErrorPath)}`);return i.value=x.data,i}const CV=Vt("$ZodRecord",(i,e)=>{eo.init(i,e),i._zod.parse=(o,h)=>{const l=o.value;if(!pp(l))return o.issues.push({expected:"record",code:"invalid_type",input:l,inst:i}),o;const f=[],x=e.keyType._zod.values;if(x){o.value={};const s=new Set;for(const C of x)if(typeof C=="string"||typeof C=="number"||typeof C=="symbol"){s.add(typeof C=="number"?C.toString():C);const O=e.valueType._zod.run({value:l[C],issues:[]},h);O instanceof Promise?f.push(O.then(F=>{F.issues.length&&o.issues.push(...ap(C,F.issues)),o.value[C]=F.value})):(O.issues.length&&o.issues.push(...ap(C,O.issues)),o.value[C]=O.value)}let P;for(const C in l)s.has(C)||(P=P??[],P.push(C));P&&P.length>0&&o.issues.push({code:"unrecognized_keys",input:l,inst:i,keys:P})}else{o.value={};for(const s of Reflect.ownKeys(l)){if(s==="__proto__")continue;let P=e.keyType._zod.run({value:s,issues:[]},h);if(P instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof s=="string"&&hR.test(s)&&P.issues.length){const F=e.keyType._zod.run({value:Number(s),issues:[]},h);if(F instanceof Promise)throw new Error("Async schemas not supported in object keys currently");F.issues.length===0&&(P=F)}if(P.issues.length){e.mode==="loose"?o.value[s]=l[s]:o.issues.push({code:"invalid_key",origin:"record",issues:P.issues.map(F=>Vu(F,h,$u())),input:s,path:[s],inst:i});continue}const O=e.valueType._zod.run({value:l[s],issues:[]},h);O instanceof Promise?f.push(O.then(F=>{F.issues.length&&o.issues.push(...ap(s,F.issues)),o.value[P.value]=F.value})):(O.issues.length&&o.issues.push(...ap(s,O.issues)),o.value[P.value]=O.value)}}return f.length?Promise.all(f).then(()=>o):o}}),LV=Vt("$ZodEnum",(i,e)=>{eo.init(i,e);const o=tR(e.entries),h=new Set(o);i._zod.values=h,i._zod.pattern=new RegExp(`^(${o.filter(l=>j$.has(typeof l)).map(l=>typeof l=="string"?mp(l):l.toString()).join("|")})$`),i._zod.parse=(l,f)=>{const x=l.value;return h.has(x)||l.issues.push({code:"invalid_value",values:o,input:x,inst:i}),l}}),RV=Vt("$ZodLiteral",(i,e)=>{if(eo.init(i,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");const o=new Set(e.values);i._zod.values=o,i._zod.pattern=new RegExp(`^(${e.values.map(h=>typeof h=="string"?mp(h):h?mp(h.toString()):String(h)).join("|")})$`),i._zod.parse=(h,l)=>{const f=h.value;return o.has(f)||h.issues.push({code:"invalid_value",values:e.values,input:f,inst:i}),h}}),DV=Vt("$ZodTransform",(i,e)=>{eo.init(i,e),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new QL(i.constructor.name);const l=e.transform(o.value,o);if(h.async)return(l instanceof Promise?l:Promise.resolve(l)).then(x=>(o.value=x,o));if(l instanceof Promise)throw new dp;return o.value=l,o}});function Zz(i,e){return i.issues.length&&e===void 0?{issues:[],value:void 0}:i}const xR=Vt("$ZodOptional",(i,e)=>{eo.init(i,e),i._zod.optin="optional",i._zod.optout="optional",Mr(i._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Mr(i._zod,"pattern",()=>{const o=e.innerType._zod.pattern;return o?new RegExp(`^(${OT(o.source)})?$`):void 0}),i._zod.parse=(o,h)=>{if(e.innerType._zod.optin==="optional"){const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(f=>Zz(f,o.value)):Zz(l,o.value)}return o.value===void 0?o:e.innerType._zod.run(o,h)}}),kV=Vt("$ZodExactOptional",(i,e)=>{xR.init(i,e),Mr(i._zod,"values",()=>e.innerType._zod.values),Mr(i._zod,"pattern",()=>e.innerType._zod.pattern),i._zod.parse=(o,h)=>e.innerType._zod.run(o,h)}),OV=Vt("$ZodNullable",(i,e)=>{eo.init(i,e),Mr(i._zod,"optin",()=>e.innerType._zod.optin),Mr(i._zod,"optout",()=>e.innerType._zod.optout),Mr(i._zod,"pattern",()=>{const o=e.innerType._zod.pattern;return o?new RegExp(`^(${OT(o.source)}|null)$`):void 0}),Mr(i._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),i._zod.parse=(o,h)=>o.value===null?o:e.innerType._zod.run(o,h)}),FV=Vt("$ZodDefault",(i,e)=>{eo.init(i,e),i._zod.optin="optional",Mr(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);if(o.value===void 0)return o.value=e.defaultValue,o;const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(f=>Wz(f,e)):Wz(l,e)}});function Wz(i,e){return i.value===void 0&&(i.value=e.defaultValue),i}const BV=Vt("$ZodPrefault",(i,e)=>{eo.init(i,e),i._zod.optin="optional",Mr(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>(h.direction==="backward"||o.value===void 0&&(o.value=e.defaultValue),e.innerType._zod.run(o,h))}),NV=Vt("$ZodNonOptional",(i,e)=>{eo.init(i,e),Mr(i._zod,"values",()=>{const o=e.innerType._zod.values;return o?new Set([...o].filter(h=>h!==void 0)):void 0}),i._zod.parse=(o,h)=>{const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(f=>qz(f,i)):qz(l,i)}});function qz(i,e){return!i.issues.length&&i.value===void 0&&i.issues.push({code:"invalid_type",expected:"nonoptional",input:i.value,inst:e}),i}const UV=Vt("$ZodCatch",(i,e)=>{eo.init(i,e),Mr(i._zod,"optin",()=>e.innerType._zod.optin),Mr(i._zod,"optout",()=>e.innerType._zod.optout),Mr(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(f=>(o.value=f.value,f.issues.length&&(o.value=e.catchValue({...o,error:{issues:f.issues.map(x=>Vu(x,h,$u()))},input:o.value}),o.issues=[]),o)):(o.value=l.value,l.issues.length&&(o.value=e.catchValue({...o,error:{issues:l.issues.map(f=>Vu(f,h,$u()))},input:o.value}),o.issues=[]),o)}}),$V=Vt("$ZodPipe",(i,e)=>{eo.init(i,e),Mr(i._zod,"values",()=>e.in._zod.values),Mr(i._zod,"optin",()=>e.in._zod.optin),Mr(i._zod,"optout",()=>e.out._zod.optout),Mr(i._zod,"propValues",()=>e.in._zod.propValues),i._zod.parse=(o,h)=>{if(h.direction==="backward"){const f=e.out._zod.run(o,h);return f instanceof Promise?f.then(x=>Vx(x,e.in,h)):Vx(f,e.in,h)}const l=e.in._zod.run(o,h);return l instanceof Promise?l.then(f=>Vx(f,e.out,h)):Vx(l,e.out,h)}});function Vx(i,e,o){return i.issues.length?(i.aborted=!0,i):e._zod.run({value:i.value,issues:i.issues},o)}const VV=Vt("$ZodReadonly",(i,e)=>{eo.init(i,e),Mr(i._zod,"propValues",()=>e.innerType._zod.propValues),Mr(i._zod,"values",()=>e.innerType._zod.values),Mr(i._zod,"optin",()=>{var o,h;return(h=(o=e.innerType)==null?void 0:o._zod)==null?void 0:h.optin}),Mr(i._zod,"optout",()=>{var o,h;return(h=(o=e.innerType)==null?void 0:o._zod)==null?void 0:h.optout}),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(Xz):Xz(l)}});function Xz(i){return i.value=Object.freeze(i.value),i}const jV=Vt("$ZodCustom",(i,e)=>{ca.init(i,e),eo.init(i,e),i._zod.parse=(o,h)=>o,i._zod.check=o=>{const h=o.value,l=e.fn(h);if(l instanceof Promise)return l.then(f=>Jz(f,o,h,i));Jz(l,o,h,i)}});function Jz(i,e,o,h){if(!i){const l={code:"custom",input:o,inst:h,path:[...h._zod.def.path??[]],continue:!h._zod.def.abort};h._zod.def.params&&(l.params=h._zod.def.params),e.issues.push(w_(l))}}var Yz;class GV{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...o){const h=o[0];return this._map.set(e,h),h&&typeof h=="object"&&"id"in h&&this._idmap.set(h.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const o=this._map.get(e);return o&&typeof o=="object"&&"id"in o&&this._idmap.delete(o.id),this._map.delete(e),this}get(e){const o=e._zod.parent;if(o){const h={...this.get(o)??{}};delete h.id;const l={...h,...this._map.get(e)};return Object.keys(l).length?l:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function HV(){return new GV}(Yz=globalThis).__zod_globalRegistry??(Yz.__zod_globalRegistry=HV());const s_=globalThis.__zod_globalRegistry;function ZV(i,e){return new i({type:"string",...Qi(e)})}function WV(i,e){return new i({type:"string",format:"email",check:"string_format",abort:!1,...Qi(e)})}function Kz(i,e){return new i({type:"string",format:"guid",check:"string_format",abort:!1,...Qi(e)})}function qV(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,...Qi(e)})}function XV(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Qi(e)})}function JV(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Qi(e)})}function YV(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Qi(e)})}function KV(i,e){return new i({type:"string",format:"url",check:"string_format",abort:!1,...Qi(e)})}function QV(i,e){return new i({type:"string",format:"emoji",check:"string_format",abort:!1,...Qi(e)})}function ej(i,e){return new i({type:"string",format:"nanoid",check:"string_format",abort:!1,...Qi(e)})}function tj(i,e){return new i({type:"string",format:"cuid",check:"string_format",abort:!1,...Qi(e)})}function ij(i,e){return new i({type:"string",format:"cuid2",check:"string_format",abort:!1,...Qi(e)})}function nj(i,e){return new i({type:"string",format:"ulid",check:"string_format",abort:!1,...Qi(e)})}function rj(i,e){return new i({type:"string",format:"xid",check:"string_format",abort:!1,...Qi(e)})}function oj(i,e){return new i({type:"string",format:"ksuid",check:"string_format",abort:!1,...Qi(e)})}function sj(i,e){return new i({type:"string",format:"ipv4",check:"string_format",abort:!1,...Qi(e)})}function aj(i,e){return new i({type:"string",format:"ipv6",check:"string_format",abort:!1,...Qi(e)})}function lj(i,e){return new i({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Qi(e)})}function cj(i,e){return new i({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Qi(e)})}function uj(i,e){return new i({type:"string",format:"base64",check:"string_format",abort:!1,...Qi(e)})}function hj(i,e){return new i({type:"string",format:"base64url",check:"string_format",abort:!1,...Qi(e)})}function dj(i,e){return new i({type:"string",format:"e164",check:"string_format",abort:!1,...Qi(e)})}function fj(i,e){return new i({type:"string",format:"jwt",check:"string_format",abort:!1,...Qi(e)})}function pj(i,e){return new i({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Qi(e)})}function mj(i,e){return new i({type:"string",format:"date",check:"string_format",...Qi(e)})}function gj(i,e){return new i({type:"string",format:"time",check:"string_format",precision:null,...Qi(e)})}function _j(i,e){return new i({type:"string",format:"duration",check:"string_format",...Qi(e)})}function yj(i,e){return new i({type:"number",checks:[],...Qi(e)})}function vj(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"safeint",...Qi(e)})}function xj(i,e){return new i({type:"boolean",...Qi(e)})}function bj(i,e){return new i({type:"null",...Qi(e)})}function wj(i){return new i({type:"unknown"})}function Sj(i,e){return new i({type:"never",...Qi(e)})}function Qz(i,e){return new fR({check:"less_than",...Qi(e),value:i,inclusive:!1})}function vS(i,e){return new fR({check:"less_than",...Qi(e),value:i,inclusive:!0})}function eC(i,e){return new pR({check:"greater_than",...Qi(e),value:i,inclusive:!1})}function xS(i,e){return new pR({check:"greater_than",...Qi(e),value:i,inclusive:!0})}function tC(i,e){return new O6({check:"multiple_of",...Qi(e),value:i})}function bR(i,e){return new B6({check:"max_length",...Qi(e),maximum:i})}function A0(i,e){return new N6({check:"min_length",...Qi(e),minimum:i})}function wR(i,e){return new U6({check:"length_equals",...Qi(e),length:i})}function Tj(i,e){return new $6({check:"string_format",format:"regex",...Qi(e),pattern:i})}function Ej(i){return new V6({check:"string_format",format:"lowercase",...Qi(i)})}function Ij(i){return new j6({check:"string_format",format:"uppercase",...Qi(i)})}function Mj(i,e){return new G6({check:"string_format",format:"includes",...Qi(e),includes:i})}function Aj(i,e){return new H6({check:"string_format",format:"starts_with",...Qi(e),prefix:i})}function Pj(i,e){return new Z6({check:"string_format",format:"ends_with",...Qi(e),suffix:i})}function Mp(i){return new W6({check:"overwrite",tx:i})}function zj(i){return Mp(e=>e.normalize(i))}function Cj(){return Mp(i=>i.trim())}function Lj(){return Mp(i=>i.toLowerCase())}function Rj(){return Mp(i=>i.toUpperCase())}function Dj(){return Mp(i=>$$(i))}function kj(i,e,o){return new i({type:"array",element:e,...Qi(o)})}function Oj(i,e,o){const h=Qi(o);return h.abort??(h.abort=!0),new i({type:"custom",check:"custom",fn:e,...h})}function Fj(i,e,o){return new i({type:"custom",check:"custom",fn:e,...Qi(o)})}function Bj(i){const e=Nj(o=>(o.addIssue=h=>{if(typeof h=="string")o.issues.push(w_(h,o.value,e._zod.def));else{const l=h;l.fatal&&(l.continue=!1),l.code??(l.code="custom"),l.input??(l.input=o.value),l.inst??(l.inst=e),l.continue??(l.continue=!e._zod.def.abort),o.issues.push(w_(l))}},i(o.value,o)));return e}function Nj(i,e){const o=new ca({check:"custom",...Qi(e)});return o._zod.check=i,o}function SR(i){let e=(i==null?void 0:i.target)??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:i.processors??{},metadataRegistry:(i==null?void 0:i.metadata)??s_,target:e,unrepresentable:(i==null?void 0:i.unrepresentable)??"throw",override:(i==null?void 0:i.override)??(()=>{}),io:(i==null?void 0:i.io)??"output",counter:0,seen:new Map,cycles:(i==null?void 0:i.cycles)??"ref",reused:(i==null?void 0:i.reused)??"inline",external:(i==null?void 0:i.external)??void 0}}function Po(i,e,o={path:[],schemaPath:[]}){var O,F;var h;const l=i._zod.def,f=e.seen.get(i);if(f)return f.count++,o.schemaPath.includes(i)&&(f.cycle=o.path),f.schema;const x={schema:{},count:1,cycle:void 0,path:o.path};e.seen.set(i,x);const s=(F=(O=i._zod).toJSONSchema)==null?void 0:F.call(O);if(s)x.schema=s;else{const V={...o,schemaPath:[...o.schemaPath,i],path:o.path};if(i._zod.processJSONSchema)i._zod.processJSONSchema(e,x.schema,V);else{const ee=x.schema,se=e.processors[l.type];if(!se)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${l.type}`);se(i,e,ee,V)}const q=i._zod.parent;q&&(x.ref||(x.ref=q),Po(q,e,V),e.seen.get(q).isParent=!0)}const P=e.metadataRegistry.get(i);return P&&Object.assign(x.schema,P),e.io==="input"&&Hs(i)&&(delete x.schema.examples,delete x.schema.default),e.io==="input"&&x.schema._prefault&&((h=x.schema).default??(h.default=x.schema._prefault)),delete x.schema._prefault,e.seen.get(i).schema}function TR(i,e){var x,s,P,C;const o=i.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");const h=new Map;for(const O of i.seen.entries()){const F=(x=i.metadataRegistry.get(O[0]))==null?void 0:x.id;if(F){const V=h.get(F);if(V&&V!==O[0])throw new Error(`Duplicate schema id "${F}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);h.set(F,O[0])}}const l=O=>{var se;const F=i.target==="draft-2020-12"?"$defs":"definitions";if(i.external){const fe=(se=i.external.registry.get(O[0]))==null?void 0:se.id,ae=i.external.uri??(tt=>tt);if(fe)return{ref:ae(fe)};const ie=O[1].defId??O[1].schema.id??`schema${i.counter++}`;return O[1].defId=ie,{defId:ie,ref:`${ae("__shared")}#/${F}/${ie}`}}if(O[1]===o)return{ref:"#"};const q=`#/${F}/`,ee=O[1].schema.id??`__schema${i.counter++}`;return{defId:ee,ref:q+ee}},f=O=>{if(O[1].schema.$ref)return;const F=O[1],{ref:V,defId:q}=l(O);F.def={...F.schema},q&&(F.defId=q);const ee=F.schema;for(const se in ee)delete ee[se];ee.$ref=V};if(i.cycles==="throw")for(const O of i.seen.entries()){const F=O[1];if(F.cycle)throw new Error(`Cycle detected: #/${(s=F.cycle)==null?void 0:s.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const O of i.seen.entries()){const F=O[1];if(e===O[0]){f(O);continue}if(i.external){const q=(P=i.external.registry.get(O[0]))==null?void 0:P.id;if(e!==O[0]&&q){f(O);continue}}if((C=i.metadataRegistry.get(O[0]))==null?void 0:C.id){f(O);continue}if(F.cycle){f(O);continue}if(F.count>1&&i.reused==="ref"){f(O);continue}}}function ER(i,e){var x,s,P;const o=i.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");const h=C=>{const O=i.seen.get(C);if(O.ref===null)return;const F=O.def??O.schema,V={...F},q=O.ref;if(O.ref=null,q){h(q);const se=i.seen.get(q),fe=se.schema;if(fe.$ref&&(i.target==="draft-07"||i.target==="draft-04"||i.target==="openapi-3.0")?(F.allOf=F.allOf??[],F.allOf.push(fe)):Object.assign(F,fe),Object.assign(F,V),C._zod.parent===q)for(const ie in F)ie==="$ref"||ie==="allOf"||ie in V||delete F[ie];if(fe.$ref&&se.def)for(const ie in F)ie==="$ref"||ie==="allOf"||ie in se.def&&JSON.stringify(F[ie])===JSON.stringify(se.def[ie])&&delete F[ie]}const ee=C._zod.parent;if(ee&&ee!==q){h(ee);const se=i.seen.get(ee);if(se!=null&&se.schema.$ref&&(F.$ref=se.schema.$ref,se.def))for(const fe in F)fe==="$ref"||fe==="allOf"||fe in se.def&&JSON.stringify(F[fe])===JSON.stringify(se.def[fe])&&delete F[fe]}i.override({zodSchema:C,jsonSchema:F,path:O.path??[]})};for(const C of[...i.seen.entries()].reverse())h(C[0]);const l={};if(i.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":i.target==="draft-07"?l.$schema="http://json-schema.org/draft-07/schema#":i.target==="draft-04"?l.$schema="http://json-schema.org/draft-04/schema#":i.target,(x=i.external)!=null&&x.uri){const C=(s=i.external.registry.get(e))==null?void 0:s.id;if(!C)throw new Error("Schema is missing an `id` property");l.$id=i.external.uri(C)}Object.assign(l,o.def??o.schema);const f=((P=i.external)==null?void 0:P.defs)??{};for(const C of i.seen.entries()){const O=C[1];O.def&&O.defId&&(f[O.defId]=O.def)}i.external||Object.keys(f).length>0&&(i.target==="draft-2020-12"?l.$defs=f:l.definitions=f);try{const C=JSON.parse(JSON.stringify(l));return Object.defineProperty(C,"~standard",{value:{...e["~standard"],jsonSchema:{input:P0(e,"input",i.processors),output:P0(e,"output",i.processors)}},enumerable:!1,writable:!1}),C}catch{throw new Error("Error converting schema to JSON.")}}function Hs(i,e){const o=e??{seen:new Set};if(o.seen.has(i))return!1;o.seen.add(i);const h=i._zod.def;if(h.type==="transform")return!0;if(h.type==="array")return Hs(h.element,o);if(h.type==="set")return Hs(h.valueType,o);if(h.type==="lazy")return Hs(h.getter(),o);if(h.type==="promise"||h.type==="optional"||h.type==="nonoptional"||h.type==="nullable"||h.type==="readonly"||h.type==="default"||h.type==="prefault")return Hs(h.innerType,o);if(h.type==="intersection")return Hs(h.left,o)||Hs(h.right,o);if(h.type==="record"||h.type==="map")return Hs(h.keyType,o)||Hs(h.valueType,o);if(h.type==="pipe")return Hs(h.in,o)||Hs(h.out,o);if(h.type==="object"){for(const l in h.shape)if(Hs(h.shape[l],o))return!0;return!1}if(h.type==="union"){for(const l of h.options)if(Hs(l,o))return!0;return!1}if(h.type==="tuple"){for(const l of h.items)if(Hs(l,o))return!0;return!!(h.rest&&Hs(h.rest,o))}return!1}const Uj=(i,e={})=>o=>{const h=SR({...o,processors:e});return Po(i,h),TR(h,i),ER(h,i)},P0=(i,e,o={})=>h=>{const{libraryOptions:l,target:f}=h??{},x=SR({...l??{},target:f,io:e,processors:o});return Po(i,x),TR(x,i),ER(x,i)},$j={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},Vj=(i,e,o,h)=>{const l=o;l.type="string";const{minimum:f,maximum:x,format:s,patterns:P,contentEncoding:C}=i._zod.bag;if(typeof f=="number"&&(l.minLength=f),typeof x=="number"&&(l.maxLength=x),s&&(l.format=$j[s]??s,l.format===""&&delete l.format,s==="time"&&delete l.format),C&&(l.contentEncoding=C),P&&P.size>0){const O=[...P];O.length===1?l.pattern=O[0].source:O.length>1&&(l.allOf=[...O.map(F=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:F.source}))])}},jj=(i,e,o,h)=>{const l=o,{minimum:f,maximum:x,format:s,multipleOf:P,exclusiveMaximum:C,exclusiveMinimum:O}=i._zod.bag;typeof s=="string"&&s.includes("int")?l.type="integer":l.type="number",typeof O=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(l.minimum=O,l.exclusiveMinimum=!0):l.exclusiveMinimum=O),typeof f=="number"&&(l.minimum=f,typeof O=="number"&&e.target!=="draft-04"&&(O>=f?delete l.minimum:delete l.exclusiveMinimum)),typeof C=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(l.maximum=C,l.exclusiveMaximum=!0):l.exclusiveMaximum=C),typeof x=="number"&&(l.maximum=x,typeof C=="number"&&e.target!=="draft-04"&&(C<=x?delete l.maximum:delete l.exclusiveMaximum)),typeof P=="number"&&(l.multipleOf=P)},Gj=(i,e,o,h)=>{o.type="boolean"},Hj=(i,e,o,h)=>{e.target==="openapi-3.0"?(o.type="string",o.nullable=!0,o.enum=[null]):o.type="null"},Zj=(i,e,o,h)=>{o.not={}},Wj=(i,e,o,h)=>{},qj=(i,e,o,h)=>{const l=i._zod.def,f=tR(l.entries);f.every(x=>typeof x=="number")&&(o.type="number"),f.every(x=>typeof x=="string")&&(o.type="string"),o.enum=f},Xj=(i,e,o,h)=>{const l=i._zod.def,f=[];for(const x of l.values)if(x===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof x=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");f.push(Number(x))}else f.push(x);if(f.length!==0)if(f.length===1){const x=f[0];o.type=x===null?"null":typeof x,e.target==="draft-04"||e.target==="openapi-3.0"?o.enum=[x]:o.const=x}else f.every(x=>typeof x=="number")&&(o.type="number"),f.every(x=>typeof x=="string")&&(o.type="string"),f.every(x=>typeof x=="boolean")&&(o.type="boolean"),f.every(x=>x===null)&&(o.type="null"),o.enum=f},Jj=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},Yj=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},Kj=(i,e,o,h)=>{const l=o,f=i._zod.def,{minimum:x,maximum:s}=i._zod.bag;typeof x=="number"&&(l.minItems=x),typeof s=="number"&&(l.maxItems=s),l.type="array",l.items=Po(f.element,e,{...h,path:[...h.path,"items"]})},Qj=(i,e,o,h)=>{var C;const l=o,f=i._zod.def;l.type="object",l.properties={};const x=f.shape;for(const O in x)l.properties[O]=Po(x[O],e,{...h,path:[...h.path,"properties",O]});const s=new Set(Object.keys(x)),P=new Set([...s].filter(O=>{const F=f.shape[O]._zod;return e.io==="input"?F.optin===void 0:F.optout===void 0}));P.size>0&&(l.required=Array.from(P)),((C=f.catchall)==null?void 0:C._zod.def.type)==="never"?l.additionalProperties=!1:f.catchall?f.catchall&&(l.additionalProperties=Po(f.catchall,e,{...h,path:[...h.path,"additionalProperties"]})):e.io==="output"&&(l.additionalProperties=!1)},eG=(i,e,o,h)=>{const l=i._zod.def,f=l.inclusive===!1,x=l.options.map((s,P)=>Po(s,e,{...h,path:[...h.path,f?"oneOf":"anyOf",P]}));f?o.oneOf=x:o.anyOf=x},tG=(i,e,o,h)=>{const l=i._zod.def,f=Po(l.left,e,{...h,path:[...h.path,"allOf",0]}),x=Po(l.right,e,{...h,path:[...h.path,"allOf",1]}),s=C=>"allOf"in C&&Object.keys(C).length===1,P=[...s(f)?f.allOf:[f],...s(x)?x.allOf:[x]];o.allOf=P},iG=(i,e,o,h)=>{const l=o,f=i._zod.def;l.type="object";const x=f.keyType,s=x._zod.bag,P=s==null?void 0:s.patterns;if(f.mode==="loose"&&P&&P.size>0){const O=Po(f.valueType,e,{...h,path:[...h.path,"patternProperties","*"]});l.patternProperties={};for(const F of P)l.patternProperties[F.source]=O}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(l.propertyNames=Po(f.keyType,e,{...h,path:[...h.path,"propertyNames"]})),l.additionalProperties=Po(f.valueType,e,{...h,path:[...h.path,"additionalProperties"]});const C=x._zod.values;if(C){const O=[...C].filter(F=>typeof F=="string"||typeof F=="number");O.length>0&&(l.required=O)}},nG=(i,e,o,h)=>{const l=i._zod.def,f=Po(l.innerType,e,h),x=e.seen.get(i);e.target==="openapi-3.0"?(x.ref=l.innerType,o.nullable=!0):o.anyOf=[f,{type:"null"}]},rG=(i,e,o,h)=>{const l=i._zod.def;Po(l.innerType,e,h);const f=e.seen.get(i);f.ref=l.innerType},oG=(i,e,o,h)=>{const l=i._zod.def;Po(l.innerType,e,h);const f=e.seen.get(i);f.ref=l.innerType,o.default=JSON.parse(JSON.stringify(l.defaultValue))},sG=(i,e,o,h)=>{const l=i._zod.def;Po(l.innerType,e,h);const f=e.seen.get(i);f.ref=l.innerType,e.io==="input"&&(o._prefault=JSON.parse(JSON.stringify(l.defaultValue)))},aG=(i,e,o,h)=>{const l=i._zod.def;Po(l.innerType,e,h);const f=e.seen.get(i);f.ref=l.innerType;let x;try{x=l.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}o.default=x},lG=(i,e,o,h)=>{const l=i._zod.def,f=e.io==="input"?l.in._zod.def.type==="transform"?l.out:l.in:l.out;Po(f,e,h);const x=e.seen.get(i);x.ref=f},cG=(i,e,o,h)=>{const l=i._zod.def;Po(l.innerType,e,h);const f=e.seen.get(i);f.ref=l.innerType,o.readOnly=!0},IR=(i,e,o,h)=>{const l=i._zod.def;Po(l.innerType,e,h);const f=e.seen.get(i);f.ref=l.innerType};function $T(i){return!!i._zod}function MR(i,e){return $T(i)?aR(i,e):i.safeParse(e)}function uG(i){var o,h;if(!i)return;let e;if($T(i)?e=(h=(o=i._zod)==null?void 0:o.def)==null?void 0:h.shape:e=i.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function hG(i){var l;if($T(i)){const x=(l=i._zod)==null?void 0:l.def;if(x){if(x.value!==void 0)return x.value;if(Array.isArray(x.values)&&x.values.length>0)return x.values[0]}}const o=i._def;if(o){if(o.value!==void 0)return o.value;if(Array.isArray(o.values)&&o.values.length>0)return o.values[0]}const h=i.value;if(h!==void 0)return h}const dG=Vt("ZodISODateTime",(i,e)=>{aV.init(i,e),po.init(i,e)});function AR(i){return pj(dG,i)}const fG=Vt("ZodISODate",(i,e)=>{lV.init(i,e),po.init(i,e)});function pG(i){return mj(fG,i)}const mG=Vt("ZodISOTime",(i,e)=>{cV.init(i,e),po.init(i,e)});function gG(i){return gj(mG,i)}const _G=Vt("ZodISODuration",(i,e)=>{uV.init(i,e),po.init(i,e)});function yG(i){return _j(_G,i)}const vG=(i,e)=>{oR.init(i,e),i.name="ZodError",Object.defineProperties(i,{format:{value:o=>e6(i,o)},flatten:{value:o=>Q$(i,o)},addIssue:{value:o=>{i.issues.push(o),i.message=JSON.stringify(i.issues,KS,2)}},addIssues:{value:o=>{i.issues.push(...o),i.message=JSON.stringify(i.issues,KS,2)}},isEmpty:{get(){return i.issues.length===0}}})},Ya=Vt("ZodError",vG,{Parent:Error}),xG=BT(Ya),bG=NT(Ya),wG=ib(Ya),SG=nb(Ya),TG=i6(Ya),EG=n6(Ya),IG=r6(Ya),MG=o6(Ya),AG=s6(Ya),PG=a6(Ya),zG=l6(Ya),CG=c6(Ya),io=Vt("ZodType",(i,e)=>(eo.init(i,e),Object.assign(i["~standard"],{jsonSchema:{input:P0(i,"input"),output:P0(i,"output")}}),i.toJSONSchema=Uj(i,{}),i.def=e,i.type=e.type,Object.defineProperty(i,"_def",{value:e}),i.check=(...o)=>i.clone(qu(e,{checks:[...e.checks??[],...o.map(h=>typeof h=="function"?{_zod:{check:h,def:{check:"custom"},onattach:[]}}:h)]}),{parent:!0}),i.with=i.check,i.clone=(o,h)=>Xu(i,o,h),i.brand=()=>i,i.register=((o,h)=>(o.add(i,h),i)),i.parse=(o,h)=>xG(i,o,h,{callee:i.parse}),i.safeParse=(o,h)=>wG(i,o,h),i.parseAsync=async(o,h)=>bG(i,o,h,{callee:i.parseAsync}),i.safeParseAsync=async(o,h)=>SG(i,o,h),i.spa=i.safeParseAsync,i.encode=(o,h)=>TG(i,o,h),i.decode=(o,h)=>EG(i,o,h),i.encodeAsync=async(o,h)=>IG(i,o,h),i.decodeAsync=async(o,h)=>MG(i,o,h),i.safeEncode=(o,h)=>AG(i,o,h),i.safeDecode=(o,h)=>PG(i,o,h),i.safeEncodeAsync=async(o,h)=>zG(i,o,h),i.safeDecodeAsync=async(o,h)=>CG(i,o,h),i.refine=(o,h)=>i.check(wH(o,h)),i.superRefine=o=>i.check(SH(o)),i.overwrite=o=>i.check(Mp(o)),i.optional=()=>So(i),i.exactOptional=()=>cH(i),i.nullable=()=>rC(i),i.nullish=()=>So(rC(i)),i.nonoptional=o=>mH(i,o),i.array=()=>cr(i),i.or=o=>Jr([i,o]),i.and=o=>VT(i,o),i.transform=o=>tT(i,kR(o)),i.default=o=>dH(i,o),i.prefault=o=>pH(i,o),i.catch=o=>_H(i,o),i.pipe=o=>tT(i,o),i.readonly=()=>xH(i),i.describe=o=>{const h=i.clone();return s_.add(h,{description:o}),h},Object.defineProperty(i,"description",{get(){var o;return(o=s_.get(i))==null?void 0:o.description},configurable:!0}),i.meta=(...o)=>{if(o.length===0)return s_.get(i);const h=i.clone();return s_.add(h,o[0]),h},i.isOptional=()=>i.safeParse(void 0).success,i.isNullable=()=>i.safeParse(null).success,i.apply=o=>o(i),i)),PR=Vt("_ZodString",(i,e)=>{UT.init(i,e),io.init(i,e),i._zod.processJSONSchema=(h,l,f)=>Vj(i,h,l);const o=i._zod.bag;i.format=o.format??null,i.minLength=o.minimum??null,i.maxLength=o.maximum??null,i.regex=(...h)=>i.check(Tj(...h)),i.includes=(...h)=>i.check(Mj(...h)),i.startsWith=(...h)=>i.check(Aj(...h)),i.endsWith=(...h)=>i.check(Pj(...h)),i.min=(...h)=>i.check(A0(...h)),i.max=(...h)=>i.check(bR(...h)),i.length=(...h)=>i.check(wR(...h)),i.nonempty=(...h)=>i.check(A0(1,...h)),i.lowercase=h=>i.check(Ej(h)),i.uppercase=h=>i.check(Ij(h)),i.trim=()=>i.check(Cj()),i.normalize=(...h)=>i.check(zj(...h)),i.toLowerCase=()=>i.check(Lj()),i.toUpperCase=()=>i.check(Rj()),i.slugify=()=>i.check(Dj())}),LG=Vt("ZodString",(i,e)=>{UT.init(i,e),PR.init(i,e),i.email=o=>i.check(WV(RG,o)),i.url=o=>i.check(KV(DG,o)),i.jwt=o=>i.check(fj(XG,o)),i.emoji=o=>i.check(QV(kG,o)),i.guid=o=>i.check(Kz(iC,o)),i.uuid=o=>i.check(qV(jx,o)),i.uuidv4=o=>i.check(XV(jx,o)),i.uuidv6=o=>i.check(JV(jx,o)),i.uuidv7=o=>i.check(YV(jx,o)),i.nanoid=o=>i.check(ej(OG,o)),i.guid=o=>i.check(Kz(iC,o)),i.cuid=o=>i.check(tj(FG,o)),i.cuid2=o=>i.check(ij(BG,o)),i.ulid=o=>i.check(nj(NG,o)),i.base64=o=>i.check(uj(ZG,o)),i.base64url=o=>i.check(hj(WG,o)),i.xid=o=>i.check(rj(UG,o)),i.ksuid=o=>i.check(oj($G,o)),i.ipv4=o=>i.check(sj(VG,o)),i.ipv6=o=>i.check(aj(jG,o)),i.cidrv4=o=>i.check(lj(GG,o)),i.cidrv6=o=>i.check(cj(HG,o)),i.e164=o=>i.check(dj(qG,o)),i.datetime=o=>i.check(AR(o)),i.date=o=>i.check(pG(o)),i.time=o=>i.check(gG(o)),i.duration=o=>i.check(yG(o))});function kt(i){return ZV(LG,i)}const po=Vt("ZodStringFormat",(i,e)=>{to.init(i,e),PR.init(i,e)}),RG=Vt("ZodEmail",(i,e)=>{K6.init(i,e),po.init(i,e)}),iC=Vt("ZodGUID",(i,e)=>{J6.init(i,e),po.init(i,e)}),jx=Vt("ZodUUID",(i,e)=>{Y6.init(i,e),po.init(i,e)}),DG=Vt("ZodURL",(i,e)=>{Q6.init(i,e),po.init(i,e)}),kG=Vt("ZodEmoji",(i,e)=>{eV.init(i,e),po.init(i,e)}),OG=Vt("ZodNanoID",(i,e)=>{tV.init(i,e),po.init(i,e)}),FG=Vt("ZodCUID",(i,e)=>{iV.init(i,e),po.init(i,e)}),BG=Vt("ZodCUID2",(i,e)=>{nV.init(i,e),po.init(i,e)}),NG=Vt("ZodULID",(i,e)=>{rV.init(i,e),po.init(i,e)}),UG=Vt("ZodXID",(i,e)=>{oV.init(i,e),po.init(i,e)}),$G=Vt("ZodKSUID",(i,e)=>{sV.init(i,e),po.init(i,e)}),VG=Vt("ZodIPv4",(i,e)=>{hV.init(i,e),po.init(i,e)}),jG=Vt("ZodIPv6",(i,e)=>{dV.init(i,e),po.init(i,e)}),GG=Vt("ZodCIDRv4",(i,e)=>{fV.init(i,e),po.init(i,e)}),HG=Vt("ZodCIDRv6",(i,e)=>{pV.init(i,e),po.init(i,e)}),ZG=Vt("ZodBase64",(i,e)=>{mV.init(i,e),po.init(i,e)}),WG=Vt("ZodBase64URL",(i,e)=>{_V.init(i,e),po.init(i,e)}),qG=Vt("ZodE164",(i,e)=>{yV.init(i,e),po.init(i,e)}),XG=Vt("ZodJWT",(i,e)=>{xV.init(i,e),po.init(i,e)}),zR=Vt("ZodNumber",(i,e)=>{gR.init(i,e),io.init(i,e),i._zod.processJSONSchema=(h,l,f)=>jj(i,h,l),i.gt=(h,l)=>i.check(eC(h,l)),i.gte=(h,l)=>i.check(xS(h,l)),i.min=(h,l)=>i.check(xS(h,l)),i.lt=(h,l)=>i.check(Qz(h,l)),i.lte=(h,l)=>i.check(vS(h,l)),i.max=(h,l)=>i.check(vS(h,l)),i.int=h=>i.check(nC(h)),i.safe=h=>i.check(nC(h)),i.positive=h=>i.check(eC(0,h)),i.nonnegative=h=>i.check(xS(0,h)),i.negative=h=>i.check(Qz(0,h)),i.nonpositive=h=>i.check(vS(0,h)),i.multipleOf=(h,l)=>i.check(tC(h,l)),i.step=(h,l)=>i.check(tC(h,l)),i.finite=()=>i;const o=i._zod.bag;i.minValue=Math.max(o.minimum??Number.NEGATIVE_INFINITY,o.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,i.maxValue=Math.min(o.maximum??Number.POSITIVE_INFINITY,o.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,i.isInt=(o.format??"").includes("int")||Number.isSafeInteger(o.multipleOf??.5),i.isFinite=!0,i.format=o.format??null});function Rr(i){return yj(zR,i)}const JG=Vt("ZodNumberFormat",(i,e)=>{bV.init(i,e),zR.init(i,e)});function nC(i){return vj(JG,i)}const YG=Vt("ZodBoolean",(i,e)=>{wV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>Gj(i,o,h)});function us(i){return xj(YG,i)}const KG=Vt("ZodNull",(i,e)=>{SV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>Hj(i,o,h)});function CR(i){return bj(KG,i)}const QG=Vt("ZodUnknown",(i,e)=>{TV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>Wj()});function uo(){return wj(QG)}const eH=Vt("ZodNever",(i,e)=>{EV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>Zj(i,o,h)});function tH(i){return Sj(eH,i)}const iH=Vt("ZodArray",(i,e)=>{IV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>Kj(i,o,h,l),i.element=e.element,i.min=(o,h)=>i.check(A0(o,h)),i.nonempty=o=>i.check(A0(1,o)),i.max=(o,h)=>i.check(bR(o,h)),i.length=(o,h)=>i.check(wR(o,h)),i.unwrap=()=>i.element});function cr(i,e){return kj(iH,i,e)}const LR=Vt("ZodObject",(i,e)=>{AV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>Qj(i,o,h,l),Mr(i,"shape",()=>e.shape),i.keyof=()=>Ta(Object.keys(i._zod.def.shape)),i.catchall=o=>i.clone({...i._zod.def,catchall:o}),i.passthrough=()=>i.clone({...i._zod.def,catchall:uo()}),i.loose=()=>i.clone({...i._zod.def,catchall:uo()}),i.strict=()=>i.clone({...i._zod.def,catchall:tH()}),i.strip=()=>i.clone({...i._zod.def,catchall:void 0}),i.extend=o=>q$(i,o),i.safeExtend=o=>X$(i,o),i.merge=o=>J$(i,o),i.pick=o=>Z$(i,o),i.omit=o=>W$(i,o),i.partial=(...o)=>Y$(OR,i,o[0]),i.required=(...o)=>K$(FR,i,o[0])});function Ui(i,e){const o={type:"object",shape:i??{},...Qi(e)};return new LR(o)}function aa(i,e){return new LR({type:"object",shape:i,catchall:uo(),...Qi(e)})}const RR=Vt("ZodUnion",(i,e)=>{vR.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>eG(i,o,h,l),i.options=e.options});function Jr(i,e){return new RR({type:"union",options:i,...Qi(e)})}const nH=Vt("ZodDiscriminatedUnion",(i,e)=>{RR.init(i,e),PV.init(i,e)});function DR(i,e,o){return new nH({type:"union",options:e,discriminator:i,...Qi(o)})}const rH=Vt("ZodIntersection",(i,e)=>{zV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>tG(i,o,h,l)});function VT(i,e){return new rH({type:"intersection",left:i,right:e})}const oH=Vt("ZodRecord",(i,e)=>{CV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>iG(i,o,h,l),i.keyType=e.keyType,i.valueType=e.valueType});function ho(i,e,o){return new oH({type:"record",keyType:i,valueType:e,...Qi(o)})}const eT=Vt("ZodEnum",(i,e)=>{LV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(h,l,f)=>qj(i,h,l),i.enum=e.entries,i.options=Object.values(e.entries);const o=new Set(Object.keys(e.entries));i.extract=(h,l)=>{const f={};for(const x of h)if(o.has(x))f[x]=e.entries[x];else throw new Error(`Key ${x} not found in enum`);return new eT({...e,checks:[],...Qi(l),entries:f})},i.exclude=(h,l)=>{const f={...e.entries};for(const x of h)if(o.has(x))delete f[x];else throw new Error(`Key ${x} not found in enum`);return new eT({...e,checks:[],...Qi(l),entries:f})}});function Ta(i,e){const o=Array.isArray(i)?Object.fromEntries(i.map(h=>[h,h])):i;return new eT({type:"enum",entries:o,...Qi(e)})}const sH=Vt("ZodLiteral",(i,e)=>{RV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>Xj(i,o,h),i.values=new Set(e.values),Object.defineProperty(i,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function rn(i,e){return new sH({type:"literal",values:Array.isArray(i)?i:[i],...Qi(e)})}const aH=Vt("ZodTransform",(i,e)=>{DV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>Yj(i,o),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new QL(i.constructor.name);o.addIssue=f=>{if(typeof f=="string")o.issues.push(w_(f,o.value,e));else{const x=f;x.fatal&&(x.continue=!1),x.code??(x.code="custom"),x.input??(x.input=o.value),x.inst??(x.inst=i),o.issues.push(w_(x))}};const l=e.transform(o.value,o);return l instanceof Promise?l.then(f=>(o.value=f,o)):(o.value=l,o)}});function kR(i){return new aH({type:"transform",transform:i})}const OR=Vt("ZodOptional",(i,e)=>{xR.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>IR(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function So(i){return new OR({type:"optional",innerType:i})}const lH=Vt("ZodExactOptional",(i,e)=>{kV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>IR(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function cH(i){return new lH({type:"optional",innerType:i})}const uH=Vt("ZodNullable",(i,e)=>{OV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>nG(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function rC(i){return new uH({type:"nullable",innerType:i})}const hH=Vt("ZodDefault",(i,e)=>{FV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>oG(i,o,h,l),i.unwrap=()=>i._zod.def.innerType,i.removeDefault=i.unwrap});function dH(i,e){return new hH({type:"default",innerType:i,get defaultValue(){return typeof e=="function"?e():nR(e)}})}const fH=Vt("ZodPrefault",(i,e)=>{BV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>sG(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function pH(i,e){return new fH({type:"prefault",innerType:i,get defaultValue(){return typeof e=="function"?e():nR(e)}})}const FR=Vt("ZodNonOptional",(i,e)=>{NV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>rG(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function mH(i,e){return new FR({type:"nonoptional",innerType:i,...Qi(e)})}const gH=Vt("ZodCatch",(i,e)=>{UV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>aG(i,o,h,l),i.unwrap=()=>i._zod.def.innerType,i.removeCatch=i.unwrap});function _H(i,e){return new gH({type:"catch",innerType:i,catchValue:typeof e=="function"?e:()=>e})}const yH=Vt("ZodPipe",(i,e)=>{$V.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>lG(i,o,h,l),i.in=e.in,i.out=e.out});function tT(i,e){return new yH({type:"pipe",in:i,out:e})}const vH=Vt("ZodReadonly",(i,e)=>{VV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>cG(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function xH(i){return new vH({type:"readonly",innerType:i})}const BR=Vt("ZodCustom",(i,e)=>{jV.init(i,e),io.init(i,e),i._zod.processJSONSchema=(o,h,l)=>Jj(i,o)});function bH(i,e){return Oj(BR,i??(()=>!0),e)}function wH(i,e={}){return Fj(BR,i,e)}function SH(i){return Bj(i)}function NR(i,e){return tT(kR(i),e)}const td="io.modelcontextprotocol/related-task",ob="2.0",hs=bH(i=>i!==null&&(typeof i=="object"||typeof i=="function")),UR=Jr([kt(),Rr().int()]),$R=kt();aa({ttl:Jr([Rr(),CR()]).optional(),pollInterval:Rr().optional()});const TH=Ui({ttl:Rr().optional()}),EH=Ui({taskId:kt()}),jT=aa({progressToken:UR.optional(),[td]:EH.optional()}),Ea=Ui({_meta:jT.optional()}),B_=Ea.extend({task:TH.optional()}),IH=i=>B_.safeParse(i).success,ms=Ui({method:kt(),params:Ea.loose().optional()}),Ka=Ui({_meta:jT.optional()}),Qa=Ui({method:kt(),params:Ka.loose().optional()}),gs=aa({_meta:jT.optional()}),N_=Jr([kt(),Rr().int()]),VR=Ui({jsonrpc:rn(ob),id:N_,...ms.shape}).strict(),oC=i=>VR.safeParse(i).success,jR=Ui({jsonrpc:rn(ob),...Qa.shape}).strict(),MH=i=>jR.safeParse(i).success,GT=Ui({jsonrpc:rn(ob),id:N_,result:gs}).strict(),Gx=i=>GT.safeParse(i).success;var Pr;(function(i){i[i.ConnectionClosed=-32e3]="ConnectionClosed",i[i.RequestTimeout=-32001]="RequestTimeout",i[i.ParseError=-32700]="ParseError",i[i.InvalidRequest=-32600]="InvalidRequest",i[i.MethodNotFound=-32601]="MethodNotFound",i[i.InvalidParams=-32602]="InvalidParams",i[i.InternalError=-32603]="InternalError",i[i.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(Pr||(Pr={}));const HT=Ui({jsonrpc:rn(ob),id:N_.optional(),error:Ui({code:Rr().int(),message:kt(),data:uo().optional()})}).strict(),AH=i=>HT.safeParse(i).success,PH=Jr([VR,jR,GT,HT]);Jr([GT,HT]);const ZT=gs.strict(),zH=Ka.extend({requestId:N_.optional(),reason:kt().optional()}),WT=Qa.extend({method:rn("notifications/cancelled"),params:zH}),CH=Ui({src:kt(),mimeType:kt().optional(),sizes:cr(kt()).optional(),theme:Ta(["light","dark"]).optional()}),U_=Ui({icons:cr(CH).optional()}),gp=Ui({name:kt(),title:kt().optional()}),sb=gp.extend({...gp.shape,...U_.shape,version:kt(),websiteUrl:kt().optional(),description:kt().optional()}),LH=VT(Ui({applyDefaults:us().optional()}),ho(kt(),uo())),RH=NR(i=>i&&typeof i=="object"&&!Array.isArray(i)&&Object.keys(i).length===0?{form:{}}:i,VT(Ui({form:LH.optional(),url:hs.optional()}),ho(kt(),uo()).optional())),DH=aa({list:hs.optional(),cancel:hs.optional(),requests:aa({sampling:aa({createMessage:hs.optional()}).optional(),elicitation:aa({create:hs.optional()}).optional()}).optional()}),kH=aa({list:hs.optional(),cancel:hs.optional(),requests:aa({tools:aa({call:hs.optional()}).optional()}).optional()}),OH=Ui({experimental:ho(kt(),hs).optional(),sampling:Ui({context:hs.optional(),tools:hs.optional()}).optional(),elicitation:RH.optional(),roots:Ui({listChanged:us().optional()}).optional(),tasks:DH.optional()}),FH=Ea.extend({protocolVersion:kt(),capabilities:OH,clientInfo:sb}),BH=ms.extend({method:rn("initialize"),params:FH}),NH=Ui({experimental:ho(kt(),hs).optional(),logging:hs.optional(),completions:hs.optional(),prompts:Ui({listChanged:us().optional()}).optional(),resources:Ui({subscribe:us().optional(),listChanged:us().optional()}).optional(),tools:Ui({listChanged:us().optional()}).optional(),tasks:kH.optional()}),UH=gs.extend({protocolVersion:kt(),capabilities:NH,serverInfo:sb,instructions:kt().optional()}),$H=Qa.extend({method:rn("notifications/initialized"),params:Ka.optional()}),ab=ms.extend({method:rn("ping"),params:Ea.optional()}),VH=Ui({progress:Rr(),total:So(Rr()),message:So(kt())}),jH=Ui({...Ka.shape,...VH.shape,progressToken:UR}),qT=Qa.extend({method:rn("notifications/progress"),params:jH}),GH=Ea.extend({cursor:$R.optional()}),$_=ms.extend({params:GH.optional()}),V_=gs.extend({nextCursor:$R.optional()}),HH=Ta(["working","input_required","completed","failed","cancelled"]),j_=Ui({taskId:kt(),status:HH,ttl:Jr([Rr(),CR()]),createdAt:kt(),lastUpdatedAt:kt(),pollInterval:So(Rr()),statusMessage:So(kt())}),XT=gs.extend({task:j_}),ZH=Ka.merge(j_),z0=Qa.extend({method:rn("notifications/tasks/status"),params:ZH}),JT=ms.extend({method:rn("tasks/get"),params:Ea.extend({taskId:kt()})}),YT=gs.merge(j_),KT=ms.extend({method:rn("tasks/result"),params:Ea.extend({taskId:kt()})});gs.loose();const QT=$_.extend({method:rn("tasks/list")}),eE=V_.extend({tasks:cr(j_)}),tE=ms.extend({method:rn("tasks/cancel"),params:Ea.extend({taskId:kt()})}),WH=gs.merge(j_),GR=Ui({uri:kt(),mimeType:So(kt()),_meta:ho(kt(),uo()).optional()}),HR=GR.extend({text:kt()}),iE=kt().refine(i=>{try{return atob(i),!0}catch{return!1}},{message:"Invalid Base64 string"}),ZR=GR.extend({blob:iE}),G_=Ta(["user","assistant"]),Ap=Ui({audience:cr(G_).optional(),priority:Rr().min(0).max(1).optional(),lastModified:AR({offset:!0}).optional()}),WR=Ui({...gp.shape,...U_.shape,uri:kt(),description:So(kt()),mimeType:So(kt()),annotations:Ap.optional(),_meta:So(aa({}))}),qH=Ui({...gp.shape,...U_.shape,uriTemplate:kt(),description:So(kt()),mimeType:So(kt()),annotations:Ap.optional(),_meta:So(aa({}))}),XH=$_.extend({method:rn("resources/list")}),JH=V_.extend({resources:cr(WR)}),YH=$_.extend({method:rn("resources/templates/list")}),KH=V_.extend({resourceTemplates:cr(qH)}),nE=Ea.extend({uri:kt()}),QH=nE,e8=ms.extend({method:rn("resources/read"),params:QH}),t8=gs.extend({contents:cr(Jr([HR,ZR]))}),i8=Qa.extend({method:rn("notifications/resources/list_changed"),params:Ka.optional()}),n8=nE,r8=ms.extend({method:rn("resources/subscribe"),params:n8}),o8=nE,s8=ms.extend({method:rn("resources/unsubscribe"),params:o8}),a8=Ka.extend({uri:kt()}),l8=Qa.extend({method:rn("notifications/resources/updated"),params:a8}),c8=Ui({name:kt(),description:So(kt()),required:So(us())}),u8=Ui({...gp.shape,...U_.shape,description:So(kt()),arguments:So(cr(c8)),_meta:So(aa({}))}),h8=$_.extend({method:rn("prompts/list")}),d8=V_.extend({prompts:cr(u8)}),f8=Ea.extend({name:kt(),arguments:ho(kt(),kt()).optional()}),p8=ms.extend({method:rn("prompts/get"),params:f8}),rE=Ui({type:rn("text"),text:kt(),annotations:Ap.optional(),_meta:ho(kt(),uo()).optional()}),oE=Ui({type:rn("image"),data:iE,mimeType:kt(),annotations:Ap.optional(),_meta:ho(kt(),uo()).optional()}),sE=Ui({type:rn("audio"),data:iE,mimeType:kt(),annotations:Ap.optional(),_meta:ho(kt(),uo()).optional()}),m8=Ui({type:rn("tool_use"),name:kt(),id:kt(),input:ho(kt(),uo()),_meta:ho(kt(),uo()).optional()}),g8=Ui({type:rn("resource"),resource:Jr([HR,ZR]),annotations:Ap.optional(),_meta:ho(kt(),uo()).optional()}),_8=WR.extend({type:rn("resource_link")}),H_=Jr([rE,oE,sE,_8,g8]),y8=Ui({role:G_,content:H_}),v8=gs.extend({description:kt().optional(),messages:cr(y8)}),x8=Qa.extend({method:rn("notifications/prompts/list_changed"),params:Ka.optional()}),b8=Ui({title:kt().optional(),readOnlyHint:us().optional(),destructiveHint:us().optional(),idempotentHint:us().optional(),openWorldHint:us().optional()}),w8=Ui({taskSupport:Ta(["required","optional","forbidden"]).optional()}),aE=Ui({...gp.shape,...U_.shape,description:kt().optional(),inputSchema:Ui({type:rn("object"),properties:ho(kt(),hs).optional(),required:cr(kt()).optional()}).catchall(uo()),outputSchema:Ui({type:rn("object"),properties:ho(kt(),hs).optional(),required:cr(kt()).optional()}).catchall(uo()).optional(),annotations:b8.optional(),execution:w8.optional(),_meta:ho(kt(),uo()).optional()}),qR=$_.extend({method:rn("tools/list")}),S8=V_.extend({tools:cr(aE)}),lb=gs.extend({content:cr(H_).default([]),structuredContent:ho(kt(),uo()).optional(),isError:us().optional()});lb.or(gs.extend({toolResult:uo()}));const T8=B_.extend({name:kt(),arguments:ho(kt(),uo()).optional()}),XR=ms.extend({method:rn("tools/call"),params:T8}),E8=Qa.extend({method:rn("notifications/tools/list_changed"),params:Ka.optional()});Ui({autoRefresh:us().default(!0),debounceMs:Rr().int().nonnegative().default(300)});const JR=Ta(["debug","info","notice","warning","error","critical","alert","emergency"]),I8=Ea.extend({level:JR}),M8=ms.extend({method:rn("logging/setLevel"),params:I8}),A8=Ka.extend({level:JR,logger:kt().optional(),data:uo()}),P8=Qa.extend({method:rn("notifications/message"),params:A8}),z8=Ui({name:kt().optional()}),C8=Ui({hints:cr(z8).optional(),costPriority:Rr().min(0).max(1).optional(),speedPriority:Rr().min(0).max(1).optional(),intelligencePriority:Rr().min(0).max(1).optional()}),L8=Ui({mode:Ta(["auto","required","none"]).optional()}),R8=Ui({type:rn("tool_result"),toolUseId:kt().describe("The unique identifier for the corresponding tool call."),content:cr(H_).default([]),structuredContent:Ui({}).loose().optional(),isError:us().optional(),_meta:ho(kt(),uo()).optional()}),D8=DR("type",[rE,oE,sE]),C0=DR("type",[rE,oE,sE,m8,R8]),k8=Ui({role:G_,content:Jr([C0,cr(C0)]),_meta:ho(kt(),uo()).optional()}),O8=B_.extend({messages:cr(k8),modelPreferences:C8.optional(),systemPrompt:kt().optional(),includeContext:Ta(["none","thisServer","allServers"]).optional(),temperature:Rr().optional(),maxTokens:Rr().int(),stopSequences:cr(kt()).optional(),metadata:hs.optional(),tools:cr(aE).optional(),toolChoice:L8.optional()}),F8=ms.extend({method:rn("sampling/createMessage"),params:O8}),B8=gs.extend({model:kt(),stopReason:So(Ta(["endTurn","stopSequence","maxTokens"]).or(kt())),role:G_,content:D8}),N8=gs.extend({model:kt(),stopReason:So(Ta(["endTurn","stopSequence","maxTokens","toolUse"]).or(kt())),role:G_,content:Jr([C0,cr(C0)])}),U8=Ui({type:rn("boolean"),title:kt().optional(),description:kt().optional(),default:us().optional()}),$8=Ui({type:rn("string"),title:kt().optional(),description:kt().optional(),minLength:Rr().optional(),maxLength:Rr().optional(),format:Ta(["email","uri","date","date-time"]).optional(),default:kt().optional()}),V8=Ui({type:Ta(["number","integer"]),title:kt().optional(),description:kt().optional(),minimum:Rr().optional(),maximum:Rr().optional(),default:Rr().optional()}),j8=Ui({type:rn("string"),title:kt().optional(),description:kt().optional(),enum:cr(kt()),default:kt().optional()}),G8=Ui({type:rn("string"),title:kt().optional(),description:kt().optional(),oneOf:cr(Ui({const:kt(),title:kt()})),default:kt().optional()}),H8=Ui({type:rn("string"),title:kt().optional(),description:kt().optional(),enum:cr(kt()),enumNames:cr(kt()).optional(),default:kt().optional()}),Z8=Jr([j8,G8]),W8=Ui({type:rn("array"),title:kt().optional(),description:kt().optional(),minItems:Rr().optional(),maxItems:Rr().optional(),items:Ui({type:rn("string"),enum:cr(kt())}),default:cr(kt()).optional()}),q8=Ui({type:rn("array"),title:kt().optional(),description:kt().optional(),minItems:Rr().optional(),maxItems:Rr().optional(),items:Ui({anyOf:cr(Ui({const:kt(),title:kt()}))}),default:cr(kt()).optional()}),X8=Jr([W8,q8]),J8=Jr([H8,Z8,X8]),Y8=Jr([J8,U8,$8,V8]),K8=B_.extend({mode:rn("form").optional(),message:kt(),requestedSchema:Ui({type:rn("object"),properties:ho(kt(),Y8),required:cr(kt()).optional()})}),Q8=B_.extend({mode:rn("url"),message:kt(),elicitationId:kt(),url:kt().url()}),eZ=Jr([K8,Q8]),tZ=ms.extend({method:rn("elicitation/create"),params:eZ}),iZ=Ka.extend({elicitationId:kt()}),nZ=Qa.extend({method:rn("notifications/elicitation/complete"),params:iZ}),rZ=gs.extend({action:Ta(["accept","decline","cancel"]),content:NR(i=>i===null?void 0:i,ho(kt(),Jr([kt(),Rr(),us(),cr(kt())])).optional())}),oZ=Ui({type:rn("ref/resource"),uri:kt()}),sZ=Ui({type:rn("ref/prompt"),name:kt()}),aZ=Ea.extend({ref:Jr([sZ,oZ]),argument:Ui({name:kt(),value:kt()}),context:Ui({arguments:ho(kt(),kt()).optional()}).optional()}),lZ=ms.extend({method:rn("completion/complete"),params:aZ}),cZ=gs.extend({completion:aa({values:cr(kt()).max(100),total:So(Rr().int()),hasMore:So(us())})}),uZ=Ui({uri:kt().startsWith("file://"),name:kt().optional(),_meta:ho(kt(),uo()).optional()}),hZ=ms.extend({method:rn("roots/list"),params:Ea.optional()}),dZ=gs.extend({roots:cr(uZ)}),fZ=Qa.extend({method:rn("notifications/roots/list_changed"),params:Ka.optional()});Jr([ab,BH,lZ,M8,p8,h8,XH,YH,e8,r8,s8,XR,qR,JT,KT,QT,tE]);Jr([WT,qT,$H,fZ,z0]);Jr([ZT,B8,N8,rZ,dZ,YT,eE,XT]);Jr([ab,F8,tZ,hZ,JT,KT,QT,tE]);Jr([WT,qT,P8,l8,i8,E8,x8,z0,nZ]);Jr([ZT,UH,cZ,v8,d8,JH,KH,t8,lb,S8,YT,eE,XT]);class fr extends Error{constructor(e,o,h){super(`MCP error ${e}: ${o}`),this.code=e,this.data=h,this.name="McpError"}static fromError(e,o,h){if(e===Pr.UrlElicitationRequired&&h){const l=h;if(l.elicitations)return new pZ(l.elicitations,o)}return new fr(e,o,h)}}class pZ extends fr{constructor(e,o=`URL elicitation${e.length>1?"s":""} required`){super(Pr.UrlElicitationRequired,o,{elicitations:e})}get elicitations(){var e;return((e=this.data)==null?void 0:e.elicitations)??[]}}function Yh(i){return i==="completed"||i==="failed"||i==="cancelled"}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function sC(i){const e=uG(i),o=e==null?void 0:e.method;if(!o)throw new Error("Schema is missing a method literal");const h=hG(o);if(typeof h!="string")throw new Error("Schema method literal must be a string");return h}function aC(i,e){const o=MR(i,e);if(!o.success)throw o.error;return o.data}const mZ=6e4;class gZ{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(WT,o=>{this._oncancel(o)}),this.setNotificationHandler(qT,o=>{this._onprogress(o)}),this.setRequestHandler(ab,o=>({})),this._taskStore=e==null?void 0:e.taskStore,this._taskMessageQueue=e==null?void 0:e.taskMessageQueue,this._taskStore&&(this.setRequestHandler(JT,async(o,h)=>{const l=await this._taskStore.getTask(o.params.taskId,h.sessionId);if(!l)throw new fr(Pr.InvalidParams,"Failed to retrieve task: Task not found");return{...l}}),this.setRequestHandler(KT,async(o,h)=>{const l=async()=>{var s;const f=o.params.taskId;if(this._taskMessageQueue){let P;for(;P=await this._taskMessageQueue.dequeue(f,h.sessionId);){if(P.type==="response"||P.type==="error"){const C=P.message,O=C.id,F=this._requestResolvers.get(O);if(F)if(this._requestResolvers.delete(O),P.type==="response")F(C);else{const V=C,q=new fr(V.error.code,V.error.message,V.error.data);F(q)}else{const V=P.type==="response"?"Response":"Error";this._onerror(new Error(`${V} handler missing for request ${O}`))}continue}await((s=this._transport)==null?void 0:s.send(P.message,{relatedRequestId:h.requestId}))}}const x=await this._taskStore.getTask(f,h.sessionId);if(!x)throw new fr(Pr.InvalidParams,`Task not found: ${f}`);if(!Yh(x.status))return await this._waitForTaskUpdate(f,h.signal),await l();if(Yh(x.status)){const P=await this._taskStore.getTaskResult(f,h.sessionId);return this._clearTaskQueue(f),{...P,_meta:{...P._meta,[td]:{taskId:f}}}}return await l()};return await l()}),this.setRequestHandler(QT,async(o,h)=>{var l;try{const{tasks:f,nextCursor:x}=await this._taskStore.listTasks((l=o.params)==null?void 0:l.cursor,h.sessionId);return{tasks:f,nextCursor:x,_meta:{}}}catch(f){throw new fr(Pr.InvalidParams,`Failed to list tasks: ${f instanceof Error?f.message:String(f)}`)}}),this.setRequestHandler(tE,async(o,h)=>{try{const l=await this._taskStore.getTask(o.params.taskId,h.sessionId);if(!l)throw new fr(Pr.InvalidParams,`Task not found: ${o.params.taskId}`);if(Yh(l.status))throw new fr(Pr.InvalidParams,`Cannot cancel task in terminal status: ${l.status}`);await this._taskStore.updateTaskStatus(o.params.taskId,"cancelled","Client cancelled task execution.",h.sessionId),this._clearTaskQueue(o.params.taskId);const f=await this._taskStore.getTask(o.params.taskId,h.sessionId);if(!f)throw new fr(Pr.InvalidParams,`Task not found after cancellation: ${o.params.taskId}`);return{_meta:{},...f}}catch(l){throw l instanceof fr?l:new fr(Pr.InvalidRequest,`Failed to cancel task: ${l instanceof Error?l.message:String(l)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;const o=this._requestHandlerAbortControllers.get(e.params.requestId);o==null||o.abort(e.params.reason)}_setupTimeout(e,o,h,l,f=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(l,o),startTime:Date.now(),timeout:o,maxTotalTimeout:h,resetTimeoutOnProgress:f,onTimeout:l})}_resetTimeout(e){const o=this._timeoutInfo.get(e);if(!o)return!1;const h=Date.now()-o.startTime;if(o.maxTotalTimeout&&h>=o.maxTotalTimeout)throw this._timeoutInfo.delete(e),fr.fromError(Pr.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:o.maxTotalTimeout,totalElapsed:h});return clearTimeout(o.timeoutId),o.timeoutId=setTimeout(o.onTimeout,o.timeout),!0}_cleanupTimeout(e){const o=this._timeoutInfo.get(e);o&&(clearTimeout(o.timeoutId),this._timeoutInfo.delete(e))}async connect(e){var f,x,s;if(this._transport)throw new Error("Already connected to a transport. Call close() before connecting to a new transport, or use a separate Protocol instance per connection.");this._transport=e;const o=(f=this.transport)==null?void 0:f.onclose;this._transport.onclose=()=>{o==null||o(),this._onclose()};const h=(x=this.transport)==null?void 0:x.onerror;this._transport.onerror=P=>{h==null||h(P),this._onerror(P)};const l=(s=this._transport)==null?void 0:s.onmessage;this._transport.onmessage=(P,C)=>{l==null||l(P,C),Gx(P)||AH(P)?this._onresponse(P):oC(P)?this._onrequest(P,C):MH(P)?this._onnotification(P):this._onerror(new Error(`Unknown message type: ${JSON.stringify(P)}`))},await this._transport.start()}_onclose(){var h;const e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();for(const l of this._requestHandlerAbortControllers.values())l.abort();this._requestHandlerAbortControllers.clear();const o=fr.fromError(Pr.ConnectionClosed,"Connection closed");this._transport=void 0,(h=this.onclose)==null||h.call(this);for(const l of e.values())l(o)}_onerror(e){var o;(o=this.onerror)==null||o.call(this,e)}_onnotification(e){const o=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;o!==void 0&&Promise.resolve().then(()=>o(e)).catch(h=>this._onerror(new Error(`Uncaught error in notification handler: ${h}`)))}_onrequest(e,o){var O,F,V,q;const h=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,l=this._transport,f=(V=(F=(O=e.params)==null?void 0:O._meta)==null?void 0:F[td])==null?void 0:V.taskId;if(h===void 0){const ee={jsonrpc:"2.0",id:e.id,error:{code:Pr.MethodNotFound,message:"Method not found"}};f&&this._taskMessageQueue?this._enqueueTaskMessage(f,{type:"error",message:ee,timestamp:Date.now()},l==null?void 0:l.sessionId).catch(se=>this._onerror(new Error(`Failed to enqueue error response: ${se}`))):l==null||l.send(ee).catch(se=>this._onerror(new Error(`Failed to send an error response: ${se}`)));return}const x=new AbortController;this._requestHandlerAbortControllers.set(e.id,x);const s=IH(e.params)?e.params.task:void 0,P=this._taskStore?this.requestTaskStore(e,l==null?void 0:l.sessionId):void 0,C={signal:x.signal,sessionId:l==null?void 0:l.sessionId,_meta:(q=e.params)==null?void 0:q._meta,sendNotification:async ee=>{if(x.signal.aborted)return;const se={relatedRequestId:e.id};f&&(se.relatedTask={taskId:f}),await this.notification(ee,se)},sendRequest:async(ee,se,fe)=>{var tt;if(x.signal.aborted)throw new fr(Pr.ConnectionClosed,"Request was cancelled");const ae={...fe,relatedRequestId:e.id};f&&!ae.relatedTask&&(ae.relatedTask={taskId:f});const ie=((tt=ae.relatedTask)==null?void 0:tt.taskId)??f;return ie&&P&&await P.updateTaskStatus(ie,"input_required"),await this.request(ee,se,ae)},authInfo:o==null?void 0:o.authInfo,requestId:e.id,requestInfo:o==null?void 0:o.requestInfo,taskId:f,taskStore:P,taskRequestedTtl:s==null?void 0:s.ttl,closeSSEStream:o==null?void 0:o.closeSSEStream,closeStandaloneSSEStream:o==null?void 0:o.closeStandaloneSSEStream};Promise.resolve().then(()=>{s&&this.assertTaskHandlerCapability(e.method)}).then(()=>h(e,C)).then(async ee=>{if(x.signal.aborted)return;const se={result:ee,jsonrpc:"2.0",id:e.id};f&&this._taskMessageQueue?await this._enqueueTaskMessage(f,{type:"response",message:se,timestamp:Date.now()},l==null?void 0:l.sessionId):await(l==null?void 0:l.send(se))},async ee=>{if(x.signal.aborted)return;const se={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(ee.code)?ee.code:Pr.InternalError,message:ee.message??"Internal error",...ee.data!==void 0&&{data:ee.data}}};f&&this._taskMessageQueue?await this._enqueueTaskMessage(f,{type:"error",message:se,timestamp:Date.now()},l==null?void 0:l.sessionId):await(l==null?void 0:l.send(se))}).catch(ee=>this._onerror(new Error(`Failed to send response: ${ee}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){const{progressToken:o,...h}=e.params,l=Number(o),f=this._progressHandlers.get(l);if(!f){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}const x=this._responseHandlers.get(l),s=this._timeoutInfo.get(l);if(s&&x&&s.resetTimeoutOnProgress)try{this._resetTimeout(l)}catch(P){this._responseHandlers.delete(l),this._progressHandlers.delete(l),this._cleanupTimeout(l),x(P);return}f(h)}_onresponse(e){const o=Number(e.id),h=this._requestResolvers.get(o);if(h){if(this._requestResolvers.delete(o),Gx(e))h(e);else{const x=new fr(e.error.code,e.error.message,e.error.data);h(x)}return}const l=this._responseHandlers.get(o);if(l===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(o),this._cleanupTimeout(o);let f=!1;if(Gx(e)&&e.result&&typeof e.result=="object"){const x=e.result;if(x.task&&typeof x.task=="object"){const s=x.task;typeof s.taskId=="string"&&(f=!0,this._taskProgressTokens.set(s.taskId,o))}}if(f||this._progressHandlers.delete(o),Gx(e))l(e);else{const x=fr.fromError(e.error.code,e.error.message,e.error.data);l(x)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)==null?void 0:e.close())}async*requestStream(e,o,h){var x,s;const{task:l}=h??{};if(!l){try{yield{type:"result",result:await this.request(e,o,h)}}catch(P){yield{type:"error",error:P instanceof fr?P:new fr(Pr.InternalError,String(P))}}return}let f;try{const P=await this.request(e,XT,h);if(P.task)f=P.task.taskId,yield{type:"taskCreated",task:P.task};else throw new fr(Pr.InternalError,"Task creation did not return a task");for(;;){const C=await this.getTask({taskId:f},h);if(yield{type:"taskStatus",task:C},Yh(C.status)){C.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:f},o,h)}:C.status==="failed"?yield{type:"error",error:new fr(Pr.InternalError,`Task ${f} failed`)}:C.status==="cancelled"&&(yield{type:"error",error:new fr(Pr.InternalError,`Task ${f} was cancelled`)});return}if(C.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:f},o,h)};return}const O=C.pollInterval??((x=this._options)==null?void 0:x.defaultTaskPollInterval)??1e3;await new Promise(F=>setTimeout(F,O)),(s=h==null?void 0:h.signal)==null||s.throwIfAborted()}}catch(P){yield{type:"error",error:P instanceof fr?P:new fr(Pr.InternalError,String(P))}}}request(e,o,h){const{relatedRequestId:l,resumptionToken:f,onresumptiontoken:x,task:s,relatedTask:P}=h??{};return new Promise((C,O)=>{var ie,tt,Ue,Ne,Ce;const F=Ye=>{O(Ye)};if(!this._transport){F(new Error("Not connected"));return}if(((ie=this._options)==null?void 0:ie.enforceStrictCapabilities)===!0)try{this.assertCapabilityForMethod(e.method),s&&this.assertTaskCapability(e.method)}catch(Ye){F(Ye);return}(tt=h==null?void 0:h.signal)==null||tt.throwIfAborted();const V=this._requestMessageId++,q={...e,jsonrpc:"2.0",id:V};h!=null&&h.onprogress&&(this._progressHandlers.set(V,h.onprogress),q.params={...e.params,_meta:{...((Ue=e.params)==null?void 0:Ue._meta)||{},progressToken:V}}),s&&(q.params={...q.params,task:s}),P&&(q.params={...q.params,_meta:{...((Ne=q.params)==null?void 0:Ne._meta)||{},[td]:P}});const ee=Ye=>{var ft;this._responseHandlers.delete(V),this._progressHandlers.delete(V),this._cleanupTimeout(V),(ft=this._transport)==null||ft.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:V,reason:String(Ye)}},{relatedRequestId:l,resumptionToken:f,onresumptiontoken:x}).catch(wt=>this._onerror(new Error(`Failed to send cancellation: ${wt}`)));const At=Ye instanceof fr?Ye:new fr(Pr.RequestTimeout,String(Ye));O(At)};this._responseHandlers.set(V,Ye=>{var At;if(!((At=h==null?void 0:h.signal)!=null&&At.aborted)){if(Ye instanceof Error)return O(Ye);try{const ft=MR(o,Ye.result);ft.success?C(ft.data):O(ft.error)}catch(ft){O(ft)}}}),(Ce=h==null?void 0:h.signal)==null||Ce.addEventListener("abort",()=>{var Ye;ee((Ye=h==null?void 0:h.signal)==null?void 0:Ye.reason)});const se=(h==null?void 0:h.timeout)??mZ,fe=()=>ee(fr.fromError(Pr.RequestTimeout,"Request timed out",{timeout:se}));this._setupTimeout(V,se,h==null?void 0:h.maxTotalTimeout,fe,(h==null?void 0:h.resetTimeoutOnProgress)??!1);const ae=P==null?void 0:P.taskId;if(ae){const Ye=At=>{const ft=this._responseHandlers.get(V);ft?ft(At):this._onerror(new Error(`Response handler missing for side-channeled request ${V}`))};this._requestResolvers.set(V,Ye),this._enqueueTaskMessage(ae,{type:"request",message:q,timestamp:Date.now()}).catch(At=>{this._cleanupTimeout(V),O(At)})}else this._transport.send(q,{relatedRequestId:l,resumptionToken:f,onresumptiontoken:x}).catch(Ye=>{this._cleanupTimeout(V),O(Ye)})})}async getTask(e,o){return this.request({method:"tasks/get",params:e},YT,o)}async getTaskResult(e,o,h){return this.request({method:"tasks/result",params:e},o,h)}async listTasks(e,o){return this.request({method:"tasks/list",params:e},eE,o)}async cancelTask(e,o){return this.request({method:"tasks/cancel",params:e},WH,o)}async notification(e,o){var s,P,C,O;if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);const h=(s=o==null?void 0:o.relatedTask)==null?void 0:s.taskId;if(h){const F={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...((P=e.params)==null?void 0:P._meta)||{},[td]:o.relatedTask}}};await this._enqueueTaskMessage(h,{type:"notification",message:F,timestamp:Date.now()});return}if((((C=this._options)==null?void 0:C.debouncedNotificationMethods)??[]).includes(e.method)&&!e.params&&!(o!=null&&o.relatedRequestId)&&!(o!=null&&o.relatedTask)){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{var V,q;if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let F={...e,jsonrpc:"2.0"};o!=null&&o.relatedTask&&(F={...F,params:{...F.params,_meta:{...((V=F.params)==null?void 0:V._meta)||{},[td]:o.relatedTask}}}),(q=this._transport)==null||q.send(F,o).catch(ee=>this._onerror(ee))});return}let x={...e,jsonrpc:"2.0"};o!=null&&o.relatedTask&&(x={...x,params:{...x.params,_meta:{...((O=x.params)==null?void 0:O._meta)||{},[td]:o.relatedTask}}}),await this._transport.send(x,o)}setRequestHandler(e,o){const h=sC(e);this.assertRequestHandlerCapability(h),this._requestHandlers.set(h,(l,f)=>{const x=aC(e,l);return Promise.resolve(o(x,f))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,o){const h=sC(e);this._notificationHandlers.set(h,l=>{const f=aC(e,l);return Promise.resolve(o(f))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){const o=this._taskProgressTokens.get(e);o!==void 0&&(this._progressHandlers.delete(o),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,o,h){var f;if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");const l=(f=this._options)==null?void 0:f.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,o,h,l)}async _clearTaskQueue(e,o){if(this._taskMessageQueue){const h=await this._taskMessageQueue.dequeueAll(e,o);for(const l of h)if(l.type==="request"&&oC(l.message)){const f=l.message.id,x=this._requestResolvers.get(f);x?(x(new fr(Pr.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(f)):this._onerror(new Error(`Resolver missing for request ${f} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,o){var l,f;let h=((l=this._options)==null?void 0:l.defaultTaskPollInterval)??1e3;try{const x=await((f=this._taskStore)==null?void 0:f.getTask(e));x!=null&&x.pollInterval&&(h=x.pollInterval)}catch{}return new Promise((x,s)=>{if(o.aborted){s(new fr(Pr.InvalidRequest,"Request cancelled"));return}const P=setTimeout(x,h);o.addEventListener("abort",()=>{clearTimeout(P),s(new fr(Pr.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,o){const h=this._taskStore;if(!h)throw new Error("No task store configured");return{createTask:async l=>{if(!e)throw new Error("No request provided");return await h.createTask(l,e.id,{method:e.method,params:e.params},o)},getTask:async l=>{const f=await h.getTask(l,o);if(!f)throw new fr(Pr.InvalidParams,"Failed to retrieve task: Task not found");return f},storeTaskResult:async(l,f,x)=>{await h.storeTaskResult(l,f,x,o);const s=await h.getTask(l,o);if(s){const P=z0.parse({method:"notifications/tasks/status",params:s});await this.notification(P),Yh(s.status)&&this._cleanupTaskProgressHandler(l)}},getTaskResult:l=>h.getTaskResult(l,o),updateTaskStatus:async(l,f,x)=>{const s=await h.getTask(l,o);if(!s)throw new fr(Pr.InvalidParams,`Task "${l}" not found - it may have been cleaned up`);if(Yh(s.status))throw new fr(Pr.InvalidParams,`Cannot update task "${l}" from terminal status "${s.status}" to "${f}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await h.updateTaskStatus(l,f,x,o);const P=await h.getTask(l,o);if(P){const C=z0.parse({method:"notifications/tasks/status",params:P});await this.notification(C),Yh(P.status)&&this._cleanupTaskProgressHandler(l)}},listTasks:l=>h.listTasks(l,o)}}}var _Z=Object.defineProperty,Uc=(i,e)=>{for(var o in e)_Z(i,o,{get:e[o],enumerable:!0,configurable:!0,set:h=>e[o]=()=>h})};class yZ{constructor(e=window.parent,o){Ms(this,"eventTarget");Ms(this,"eventSource");Ms(this,"messageListener");Ms(this,"onclose");Ms(this,"onerror");Ms(this,"onmessage");Ms(this,"sessionId");Ms(this,"setProtocolVersion");this.eventTarget=e,this.eventSource=o,this.messageListener=h=>{var f,x;if(o&&h.source!==this.eventSource){console.debug("Ignoring message from unknown source",h);return}let l=PH.safeParse(h.data);l.success?(console.debug("Parsed message",l.data),(f=this.onmessage)==null||f.call(this,l.data)):(console.error("Failed to parse message",l.error.message,h),(x=this.onerror)==null||x.call(this,Error("Invalid JSON-RPC message received: "+l.error.message)))}}async start(){window.addEventListener("message",this.messageListener)}async send(e,o){console.debug("Sending message",e),this.eventTarget.postMessage(e,"*")}async close(){var e;window.removeEventListener("message",this.messageListener),(e=this.onclose)==null||e.call(this)}}var vZ="2026-01-26",$e={};Uc($e,{xor:()=>fB,xid:()=>OF,void:()=>aB,uuidv7:()=>AF,uuidv6:()=>MF,uuidv4:()=>IF,uuid:()=>EF,util:()=>Kn,url:()=>PF,uppercase:()=>_b,unknown:()=>ud,union:()=>Wb,undefined:()=>oB,ulid:()=>kF,uint64:()=>nB,uint32:()=>eB,tuple:()=>PI,trim:()=>Sb,treeifyError:()=>hD,transform:()=>Xb,toUpperCase:()=>Eb,toLowerCase:()=>Tb,toJSONSchema:()=>nF,templateLiteral:()=>IB,symbol:()=>rB,superRefine:()=>i2,success:()=>SB,stringbool:()=>RB,stringFormat:()=>WF,string:()=>B0,strictObject:()=>hB,startsWith:()=>vb,slugify:()=>Ib,size:()=>ty,setErrorMap:()=>U9,set:()=>yB,safeParseAsync:()=>pF,safeParse:()=>fF,safeEncodeAsync:()=>bF,safeEncode:()=>vF,safeDecodeAsync:()=>wF,safeDecode:()=>xF,registry:()=>RE,regexes:()=>pd,regex:()=>mb,refine:()=>t2,record:()=>zI,readonly:()=>XI,property:()=>rI,promise:()=>MB,prettifyError:()=>fD,preprocess:()=>kB,prefault:()=>VI,positive:()=>eI,pipe:()=>M_,partialRecord:()=>mB,parseAsync:()=>dF,parse:()=>hF,overwrite:()=>Vc,optional:()=>E_,object:()=>uB,number:()=>fI,nullish:()=>wB,nullable:()=>I_,null:()=>yI,normalize:()=>wb,nonpositive:()=>iI,nonoptional:()=>jI,nonnegative:()=>nI,never:()=>Hb,negative:()=>tI,nativeEnum:()=>vB,nanoid:()=>LF,nan:()=>TB,multipleOf:()=>vp,minSize:()=>Hu,minLength:()=>cd,mime:()=>bb,meta:()=>CB,maxSize:()=>Pp,maxLength:()=>iy,map:()=>_B,mac:()=>NF,lte:()=>Ha,lt:()=>ju,lowercase:()=>gb,looseRecord:()=>gB,looseObject:()=>dB,locales:()=>LE,literal:()=>xB,length:()=>ny,lazy:()=>KI,ksuid:()=>FF,keyof:()=>cB,jwt:()=>ZF,json:()=>DB,iso:()=>aI,ipv6:()=>UF,ipv4:()=>BF,intersection:()=>MI,int64:()=>iB,int32:()=>QF,int:()=>N0,instanceof:()=>LB,includes:()=>yb,httpUrl:()=>zF,hostname:()=>qF,hex:()=>XF,hash:()=>JF,guid:()=>TF,gte:()=>sa,gt:()=>Gu,globalRegistry:()=>ja,getErrorMap:()=>$9,function:()=>U0,fromJSONSchema:()=>H9,formatError:()=>dE,float64:()=>KF,float32:()=>YF,flattenError:()=>hE,file:()=>bB,exactOptional:()=>FI,enum:()=>qb,endsWith:()=>xb,encodeAsync:()=>_F,encode:()=>mF,emoji:()=>CF,email:()=>SF,e164:()=>HF,discriminatedUnion:()=>pB,describe:()=>zB,decodeAsync:()=>yF,decode:()=>gF,date:()=>lB,custom:()=>PB,cuid2:()=>DF,cuid:()=>RF,core:()=>YR,config:()=>zs,coerce:()=>FB,codec:()=>EB,clone:()=>el,cidrv6:()=>VF,cidrv4:()=>$F,check:()=>AB,catch:()=>ZI,boolean:()=>pI,bigint:()=>tB,base64url:()=>GF,base64:()=>jF,array:()=>uy,any:()=>sB,_function:()=>U0,_default:()=>UI,_ZodString:()=>Mb,ZodXor:()=>TI,ZodXID:()=>Db,ZodVoid:()=>wI,ZodUnknown:()=>xI,ZodUnion:()=>dy,ZodUndefined:()=>gI,ZodUUID:()=>oc,ZodURL:()=>sy,ZodULID:()=>Rb,ZodType:()=>Fn,ZodTuple:()=>AI,ZodTransform:()=>kI,ZodTemplateLiteral:()=>JI,ZodSymbol:()=>mI,ZodSuccess:()=>GI,ZodStringFormat:()=>Br,ZodString:()=>oy,ZodSet:()=>LI,ZodRecord:()=>fy,ZodRealError:()=>Ma,ZodReadonly:()=>qI,ZodPromise:()=>QI,ZodPrefault:()=>$I,ZodPipe:()=>Kb,ZodOptional:()=>Jb,ZodObject:()=>hy,ZodNumberFormat:()=>md,ZodNumber:()=>ay,ZodNullable:()=>BI,ZodNull:()=>_I,ZodNonOptional:()=>Yb,ZodNever:()=>bI,ZodNanoID:()=>zb,ZodNaN:()=>WI,ZodMap:()=>CI,ZodMAC:()=>dI,ZodLiteral:()=>RI,ZodLazy:()=>YI,ZodKSUID:()=>kb,ZodJWT:()=>jb,ZodIssueCode:()=>N9,ZodIntersection:()=>II,ZodISOTime:()=>uI,ZodISODuration:()=>hI,ZodISODateTime:()=>lI,ZodISODate:()=>cI,ZodIPv6:()=>Fb,ZodIPv4:()=>Ob,ZodGUID:()=>T_,ZodFunction:()=>e2,ZodFirstPartyTypeKind:()=>aT,ZodFile:()=>DI,ZodExactOptional:()=>OI,ZodError:()=>B9,ZodEnum:()=>Sp,ZodEmoji:()=>Pb,ZodEmail:()=>Ab,ZodE164:()=>Vb,ZodDiscriminatedUnion:()=>EI,ZodDefault:()=>NI,ZodDate:()=>Zb,ZodCustomStringFormat:()=>zp,ZodCustom:()=>py,ZodCodec:()=>Qb,ZodCatch:()=>HI,ZodCUID2:()=>Lb,ZodCUID:()=>Cb,ZodCIDRv6:()=>Nb,ZodCIDRv4:()=>Bb,ZodBoolean:()=>ly,ZodBigIntFormat:()=>Gb,ZodBigInt:()=>cy,ZodBase64URL:()=>$b,ZodBase64:()=>Ub,ZodArray:()=>SI,ZodAny:()=>vI,TimePrecision:()=>O3,NEVER:()=>KR,$output:()=>z3,$input:()=>C3,$brand:()=>QR});var YR={};Uc(YR,{version:()=>fk,util:()=>Kn,treeifyError:()=>hD,toJSONSchema:()=>nF,toDotPath:()=>dD,safeParseAsync:()=>mD,safeParse:()=>pD,safeEncodeAsync:()=>KZ,safeEncode:()=>JZ,safeDecodeAsync:()=>QZ,safeDecode:()=>YZ,registry:()=>RE,regexes:()=>pd,process:()=>Dr,prettifyError:()=>fD,parseAsync:()=>rT,parse:()=>nT,meta:()=>_O,locales:()=>LE,isValidJWT:()=>Bk,isValidBase64URL:()=>kk,isValidBase64:()=>EE,initializeContext:()=>xp,globalRegistry:()=>ja,globalConfig:()=>L0,formatError:()=>dE,flattenError:()=>hE,finalize:()=>wp,extractDefs:()=>bp,encodeAsync:()=>qZ,encode:()=>ZZ,describe:()=>gO,decodeAsync:()=>XZ,decode:()=>WZ,createToJSONSchemaMethod:()=>vO,createStandardJSONSchemaMethod:()=>S_,config:()=>zs,clone:()=>el,_xor:()=>f9,_xid:()=>GE,_void:()=>sO,_uuidv7:()=>BE,_uuidv6:()=>FE,_uuidv4:()=>OE,_uuid:()=>kE,_url:()=>pb,_uppercase:()=>_b,_unknown:()=>rO,_union:()=>d9,_undefined:()=>tO,_ulid:()=>jE,_uint64:()=>Q3,_uint32:()=>W3,_tuple:()=>g9,_trim:()=>Sb,_transform:()=>S9,_toUpperCase:()=>Eb,_toLowerCase:()=>Tb,_templateLiteral:()=>L9,_symbol:()=>eO,_superRefine:()=>pO,_success:()=>A9,_stringbool:()=>yO,_stringFormat:()=>ry,_string:()=>R3,_startsWith:()=>vb,_slugify:()=>Ib,_size:()=>ty,_set:()=>v9,_safeParseAsync:()=>J_,_safeParse:()=>X_,_safeEncodeAsync:()=>vE,_safeEncode:()=>_E,_safeDecodeAsync:()=>xE,_safeDecode:()=>yE,_regex:()=>mb,_refine:()=>fO,_record:()=>_9,_readonly:()=>C9,_property:()=>rI,_promise:()=>D9,_positive:()=>eI,_pipe:()=>z9,_parseAsync:()=>q_,_parse:()=>W_,_overwrite:()=>Vc,_optional:()=>T9,_number:()=>$3,_nullable:()=>E9,_null:()=>iO,_normalize:()=>wb,_nonpositive:()=>iI,_nonoptional:()=>M9,_nonnegative:()=>nI,_never:()=>oO,_negative:()=>tI,_nativeEnum:()=>b9,_nanoid:()=>UE,_nan:()=>cO,_multipleOf:()=>vp,_minSize:()=>Hu,_minLength:()=>cd,_min:()=>sa,_mime:()=>bb,_maxSize:()=>Pp,_maxLength:()=>iy,_max:()=>Ha,_map:()=>y9,_mac:()=>k3,_lte:()=>Ha,_lt:()=>ju,_lowercase:()=>gb,_literal:()=>w9,_length:()=>ny,_lazy:()=>R9,_ksuid:()=>HE,_jwt:()=>QE,_isoTime:()=>N3,_isoDuration:()=>U3,_isoDateTime:()=>F3,_isoDate:()=>B3,_ipv6:()=>WE,_ipv4:()=>ZE,_intersection:()=>m9,_int64:()=>K3,_int32:()=>Z3,_int:()=>j3,_includes:()=>yb,_guid:()=>F0,_gte:()=>sa,_gt:()=>Gu,_float64:()=>H3,_float32:()=>G3,_file:()=>hO,_enum:()=>x9,_endsWith:()=>xb,_encodeAsync:()=>mE,_encode:()=>fE,_emoji:()=>NE,_email:()=>DE,_e164:()=>KE,_discriminatedUnion:()=>p9,_default:()=>I9,_decodeAsync:()=>gE,_decode:()=>pE,_date:()=>aO,_custom:()=>dO,_cuid2:()=>VE,_cuid:()=>$E,_coercedString:()=>D3,_coercedNumber:()=>V3,_coercedDate:()=>lO,_coercedBoolean:()=>X3,_coercedBigint:()=>Y3,_cidrv6:()=>XE,_cidrv4:()=>qE,_check:()=>mO,_catch:()=>P9,_boolean:()=>q3,_bigint:()=>J3,_base64url:()=>YE,_base64:()=>JE,_array:()=>uO,_any:()=>nO,TimePrecision:()=>O3,NEVER:()=>KR,JSONSchemaGenerator:()=>O9,JSONSchema:()=>F9,Doc:()=>dk,$output:()=>z3,$input:()=>C3,$constructor:()=>mt,$brand:()=>QR,$ZodXor:()=>i3,$ZodXID:()=>Sk,$ZodVoid:()=>Xk,$ZodUnknown:()=>Wk,$ZodUnion:()=>fb,$ZodUndefined:()=>Gk,$ZodUUID:()=>mk,$ZodURL:()=>_k,$ZodULID:()=>wk,$ZodType:()=>Ln,$ZodTuple:()=>PE,$ZodTransform:()=>h3,$ZodTemplateLiteral:()=>w3,$ZodSymbol:()=>jk,$ZodSuccess:()=>_3,$ZodStringFormat:()=>Fr,$ZodString:()=>ey,$ZodSet:()=>a3,$ZodRegistry:()=>L3,$ZodRecord:()=>o3,$ZodRealError:()=>Ia,$ZodReadonly:()=>b3,$ZodPromise:()=>T3,$ZodPrefault:()=>m3,$ZodPipe:()=>x3,$ZodOptional:()=>zE,$ZodObjectJIT:()=>t3,$ZodObject:()=>e3,$ZodNumberFormat:()=>$k,$ZodNumber:()=>IE,$ZodNullable:()=>f3,$ZodNull:()=>Hk,$ZodNonOptional:()=>g3,$ZodNever:()=>qk,$ZodNanoID:()=>vk,$ZodNaN:()=>v3,$ZodMap:()=>s3,$ZodMAC:()=>Ck,$ZodLiteral:()=>c3,$ZodLazy:()=>E3,$ZodKSUID:()=>Tk,$ZodJWT:()=>Nk,$ZodIntersection:()=>r3,$ZodISOTime:()=>Mk,$ZodISODuration:()=>Ak,$ZodISODateTime:()=>Ek,$ZodISODate:()=>Ik,$ZodIPv6:()=>zk,$ZodIPv4:()=>Pk,$ZodGUID:()=>pk,$ZodFunction:()=>S3,$ZodFile:()=>u3,$ZodExactOptional:()=>d3,$ZodError:()=>uE,$ZodEnum:()=>l3,$ZodEncodeError:()=>cb,$ZodEmoji:()=>yk,$ZodEmail:()=>gk,$ZodE164:()=>Fk,$ZodDiscriminatedUnion:()=>n3,$ZodDefault:()=>p3,$ZodDate:()=>Jk,$ZodCustomStringFormat:()=>Uk,$ZodCustom:()=>I3,$ZodCodec:()=>CE,$ZodCheckUpperCase:()=>ok,$ZodCheckStringFormat:()=>Q_,$ZodCheckStartsWith:()=>ak,$ZodCheckSizeEquals:()=>QD,$ZodCheckRegex:()=>nk,$ZodCheckProperty:()=>ck,$ZodCheckOverwrite:()=>hk,$ZodCheckNumberFormat:()=>XD,$ZodCheckMultipleOf:()=>qD,$ZodCheckMinSize:()=>KD,$ZodCheckMinLength:()=>tk,$ZodCheckMimeType:()=>uk,$ZodCheckMaxSize:()=>YD,$ZodCheckMaxLength:()=>ek,$ZodCheckLowerCase:()=>rk,$ZodCheckLessThan:()=>SE,$ZodCheckLengthEquals:()=>ik,$ZodCheckIncludes:()=>sk,$ZodCheckGreaterThan:()=>TE,$ZodCheckEndsWith:()=>lk,$ZodCheckBigIntFormat:()=>JD,$ZodCheck:()=>no,$ZodCatch:()=>y3,$ZodCUID2:()=>bk,$ZodCUID:()=>xk,$ZodCIDRv6:()=>Rk,$ZodCIDRv4:()=>Lk,$ZodBoolean:()=>ME,$ZodBigIntFormat:()=>Vk,$ZodBigInt:()=>AE,$ZodBase64URL:()=>Ok,$ZodBase64:()=>Dk,$ZodAsyncError:()=>nd,$ZodArray:()=>Yk,$ZodAny:()=>Zk});var KR=Object.freeze({status:"aborted"});function mt(i,e,o){function h(s,P){if(s._zod||Object.defineProperty(s,"_zod",{value:{def:P,constr:x,traits:new Set},enumerable:!1}),s._zod.traits.has(i))return;s._zod.traits.add(i),e(s,P);let C=x.prototype,O=Object.keys(C);for(let F=0;F<O.length;F++){let V=O[F];V in s||(s[V]=C[V].bind(s))}}let l=(o==null?void 0:o.Parent)??Object;class f extends l{}Object.defineProperty(f,"name",{value:i});function x(s){var P;let C=o!=null&&o.Parent?new f:this;h(C,s),(P=C._zod).deferred??(P.deferred=[]);for(let O of C._zod.deferred)O();return C}return Object.defineProperty(x,"init",{value:h}),Object.defineProperty(x,Symbol.hasInstance,{value:s=>{var P,C;return o!=null&&o.Parent&&s instanceof o.Parent?!0:(C=(P=s==null?void 0:s._zod)==null?void 0:P.traits)==null?void 0:C.has(i)}}),Object.defineProperty(x,"name",{value:i}),x}var QR=Symbol("zod_brand");class nd extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class cb extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}var L0={};function zs(i){return i&&Object.assign(L0,i),L0}var Kn={};Uc(Kn,{unwrapMessage:()=>a_,uint8ArrayToHex:()=>GZ,uint8ArrayToBase64url:()=>VZ,uint8ArrayToBase64:()=>cD,stringifyPrimitive:()=>vn,slugify:()=>tD,shallowClone:()=>nD,safeExtend:()=>OZ,required:()=>NZ,randomString:()=>PZ,propertyKeyTypes:()=>D0,promiseAllObject:()=>AZ,primitiveTypes:()=>rD,prefixIssues:()=>Tl,pick:()=>RZ,partial:()=>BZ,parsedType:()=>Sn,optionalKeys:()=>oD,omit:()=>DZ,objectClone:()=>EZ,numKeys:()=>zZ,nullish:()=>fd,normalizeParams:()=>ui,mergeDefs:()=>$c,merge:()=>FZ,jsonStringifyReplacer:()=>R0,joinValues:()=>ai,issue:()=>k0,isPlainObject:()=>ld,isObject:()=>_p,hexToUint8Array:()=>jZ,getSizableOrigin:()=>hb,getParsedType:()=>CZ,getLengthableOrigin:()=>db,getEnumValues:()=>lE,getElementAtPath:()=>MZ,floatSafeRemainder:()=>eD,finalizeIssue:()=>qa,extend:()=>kZ,escapeRegex:()=>Nc,esc:()=>iT,defineLazy:()=>Hn,createTransparentProxy:()=>LZ,cloneDef:()=>IZ,clone:()=>el,cleanRegex:()=>ub,cleanEnum:()=>UZ,captureStackTrace:()=>cE,cached:()=>Z_,base64urlToUint8Array:()=>$Z,base64ToUint8Array:()=>lD,assignProp:()=>Ju,assertNotEqual:()=>bZ,assertNever:()=>SZ,assertIs:()=>wZ,assertEqual:()=>xZ,assert:()=>TZ,allowsEval:()=>iD,aborted:()=>id,NUMBER_FORMAT_RANGES:()=>sD,Class:()=>HZ,BIGINT_FORMAT_RANGES:()=>aD});function xZ(i){return i}function bZ(i){return i}function wZ(i){}function SZ(i){throw Error("Unexpected value in exhaustive check")}function TZ(i){}function lE(i){let e=Object.values(i).filter(o=>typeof o=="number");return Object.entries(i).filter(([o,h])=>e.indexOf(+o)===-1).map(([o,h])=>h)}function ai(i,e="|"){return i.map(o=>vn(o)).join(e)}function R0(i,e){return typeof e=="bigint"?e.toString():e}function Z_(i){return{get value(){{let e=i();return Object.defineProperty(this,"value",{value:e}),e}}}}function fd(i){return i==null}function ub(i){let e=i.startsWith("^")?1:0,o=i.endsWith("$")?i.length-1:i.length;return i.slice(e,o)}function eD(i,e){let o=(i.toString().split(".")[1]||"").length,h=e.toString(),l=(h.split(".")[1]||"").length;if(l===0&&/\d?e-\d?/.test(h)){let P=h.match(/\d?e-(\d?)/);P!=null&&P[1]&&(l=Number.parseInt(P[1]))}let f=o>l?o:l,x=Number.parseInt(i.toFixed(f).replace(".","")),s=Number.parseInt(e.toFixed(f).replace(".",""));return x%s/10**f}var lC=Symbol("evaluating");function Hn(i,e,o){let h;Object.defineProperty(i,e,{get(){if(h!==lC)return h===void 0&&(h=lC,h=o()),h},set(l){Object.defineProperty(i,e,{value:l})},configurable:!0})}function EZ(i){return Object.create(Object.getPrototypeOf(i),Object.getOwnPropertyDescriptors(i))}function Ju(i,e,o){Object.defineProperty(i,e,{value:o,writable:!0,enumerable:!0,configurable:!0})}function $c(...i){let e={};for(let o of i){let h=Object.getOwnPropertyDescriptors(o);Object.assign(e,h)}return Object.defineProperties({},e)}function IZ(i){return $c(i._zod.def)}function MZ(i,e){return e?e.reduce((o,h)=>o==null?void 0:o[h],i):i}function AZ(i){let e=Object.keys(i),o=e.map(h=>i[h]);return Promise.all(o).then(h=>{let l={};for(let f=0;f<e.length;f++)l[e[f]]=h[f];return l})}function PZ(i=10){let e="";for(let o=0;o<i;o++)e+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)];return e}function iT(i){return JSON.stringify(i)}function tD(i){return i.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}var cE="captureStackTrace"in Error?Error.captureStackTrace:(...i)=>{};function _p(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}var iD=Z_(()=>{var i;if(typeof navigator<"u"&&((i=navigator==null?void 0:navigator.userAgent)!=null&&i.includes("Cloudflare")))return!1;try{return new Function(""),!0}catch{return!1}});function ld(i){if(_p(i)===!1)return!1;let e=i.constructor;if(e===void 0||typeof e!="function")return!0;let o=e.prototype;return!(_p(o)===!1||Object.prototype.hasOwnProperty.call(o,"isPrototypeOf")===!1)}function nD(i){return ld(i)?{...i}:Array.isArray(i)?[...i]:i}function zZ(i){let e=0;for(let o in i)Object.prototype.hasOwnProperty.call(i,o)&&e++;return e}var CZ=i=>{let e=typeof i;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(i)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(i)?"array":i===null?"null":i.then&&typeof i.then=="function"&&i.catch&&typeof i.catch=="function"?"promise":typeof Map<"u"&&i instanceof Map?"map":typeof Set<"u"&&i instanceof Set?"set":typeof Date<"u"&&i instanceof Date?"date":typeof File<"u"&&i instanceof File?"file":"object";default:throw Error(`Unknown data type: ${e}`)}},D0=new Set(["string","number","symbol"]),rD=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Nc(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function el(i,e,o){let h=new i._zod.constr(e??i._zod.def);return(!e||o!=null&&o.parent)&&(h._zod.parent=i),h}function ui(i){let e=i;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function LZ(i){let e;return new Proxy({},{get(o,h,l){return e??(e=i()),Reflect.get(e,h,l)},set(o,h,l,f){return e??(e=i()),Reflect.set(e,h,l,f)},has(o,h){return e??(e=i()),Reflect.has(e,h)},deleteProperty(o,h){return e??(e=i()),Reflect.deleteProperty(e,h)},ownKeys(o){return e??(e=i()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(o,h){return e??(e=i()),Reflect.getOwnPropertyDescriptor(e,h)},defineProperty(o,h,l){return e??(e=i()),Reflect.defineProperty(e,h,l)}})}function vn(i){return typeof i=="bigint"?i.toString()+"n":typeof i=="string"?`"${i}"`:`${i}`}function oD(i){return Object.keys(i).filter(e=>i[e]._zod.optin==="optional"&&i[e]._zod.optout==="optional")}var sD={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},aD={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function RZ(i,e){let o=i._zod.def,h=o.checks;if(h&&h.length>0)throw Error(".pick() cannot be used on object schemas containing refinements");let l=$c(i._zod.def,{get shape(){let f={};for(let x in e){if(!(x in o.shape))throw Error(`Unrecognized key: "${x}"`);e[x]&&(f[x]=o.shape[x])}return Ju(this,"shape",f),f},checks:[]});return el(i,l)}function DZ(i,e){let o=i._zod.def,h=o.checks;if(h&&h.length>0)throw Error(".omit() cannot be used on object schemas containing refinements");let l=$c(i._zod.def,{get shape(){let f={...i._zod.def.shape};for(let x in e){if(!(x in o.shape))throw Error(`Unrecognized key: "${x}"`);e[x]&&delete f[x]}return Ju(this,"shape",f),f},checks:[]});return el(i,l)}function kZ(i,e){if(!ld(e))throw Error("Invalid input to extend: expected a plain object");let o=i._zod.def.checks;if(o&&o.length>0){let l=i._zod.def.shape;for(let f in e)if(Object.getOwnPropertyDescriptor(l,f)!==void 0)throw Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}let h=$c(i._zod.def,{get shape(){let l={...i._zod.def.shape,...e};return Ju(this,"shape",l),l}});return el(i,h)}function OZ(i,e){if(!ld(e))throw Error("Invalid input to safeExtend: expected a plain object");let o=$c(i._zod.def,{get shape(){let h={...i._zod.def.shape,...e};return Ju(this,"shape",h),h}});return el(i,o)}function FZ(i,e){let o=$c(i._zod.def,{get shape(){let h={...i._zod.def.shape,...e._zod.def.shape};return Ju(this,"shape",h),h},get catchall(){return e._zod.def.catchall},checks:[]});return el(i,o)}function BZ(i,e,o){let h=e._zod.def.checks;if(h&&h.length>0)throw Error(".partial() cannot be used on object schemas containing refinements");let l=$c(e._zod.def,{get shape(){let f=e._zod.def.shape,x={...f};if(o)for(let s in o){if(!(s in f))throw Error(`Unrecognized key: "${s}"`);o[s]&&(x[s]=i?new i({type:"optional",innerType:f[s]}):f[s])}else for(let s in f)x[s]=i?new i({type:"optional",innerType:f[s]}):f[s];return Ju(this,"shape",x),x},checks:[]});return el(e,l)}function NZ(i,e,o){let h=$c(e._zod.def,{get shape(){let l=e._zod.def.shape,f={...l};if(o)for(let x in o){if(!(x in f))throw Error(`Unrecognized key: "${x}"`);o[x]&&(f[x]=new i({type:"nonoptional",innerType:l[x]}))}else for(let x in l)f[x]=new i({type:"nonoptional",innerType:l[x]});return Ju(this,"shape",f),f}});return el(e,h)}function id(i,e=0){var o;if(i.aborted===!0)return!0;for(let h=e;h<i.issues.length;h++)if(((o=i.issues[h])==null?void 0:o.continue)!==!0)return!0;return!1}function Tl(i,e){return e.map(o=>{var h;return(h=o).path??(h.path=[]),o.path.unshift(i),o})}function a_(i){return typeof i=="string"?i:i==null?void 0:i.message}function qa(i,e,o){var l,f,x,s,P,C;let h={...i,path:i.path??[]};if(!i.message){let O=a_((x=(f=(l=i.inst)==null?void 0:l._zod.def)==null?void 0:f.error)==null?void 0:x.call(f,i))??a_((s=e==null?void 0:e.error)==null?void 0:s.call(e,i))??a_((P=o.customError)==null?void 0:P.call(o,i))??a_((C=o.localeError)==null?void 0:C.call(o,i))??"Invalid input";h.message=O}return delete h.inst,delete h.continue,!(e!=null&&e.reportInput)&&delete h.input,h}function hb(i){return i instanceof Set?"set":i instanceof Map?"map":i instanceof File?"file":"unknown"}function db(i){return Array.isArray(i)?"array":typeof i=="string"?"string":"unknown"}function Sn(i){let e=typeof i;switch(e){case"number":return Number.isNaN(i)?"nan":"number";case"object":{if(i===null)return"null";if(Array.isArray(i))return"array";let o=i;if(o&&Object.getPrototypeOf(o)!==Object.prototype&&"constructor"in o&&o.constructor)return o.constructor.name}}return e}function k0(...i){let[e,o,h]=i;return typeof e=="string"?{message:e,code:"custom",input:o,inst:h}:{...e}}function UZ(i){return Object.entries(i).filter(([e,o])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}function lD(i){let e=atob(i),o=new Uint8Array(e.length);for(let h=0;h<e.length;h++)o[h]=e.charCodeAt(h);return o}function cD(i){let e="";for(let o=0;o<i.length;o++)e+=String.fromCharCode(i[o]);return btoa(e)}function $Z(i){let e=i.replace(/-/g,"+").replace(/_/g,"/"),o="=".repeat((4-e.length%4)%4);return lD(e+o)}function VZ(i){return cD(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function jZ(i){let e=i.replace(/^0x/,"");if(e.length%2!==0)throw Error("Invalid hex string length");let o=new Uint8Array(e.length/2);for(let h=0;h<e.length;h+=2)o[h/2]=Number.parseInt(e.slice(h,h+2),16);return o}function GZ(i){return Array.from(i).map(e=>e.toString(16).padStart(2,"0")).join("")}class HZ{constructor(...e){}}var uD=(i,e)=>{i.name="$ZodError",Object.defineProperty(i,"_zod",{value:i._zod,enumerable:!1}),Object.defineProperty(i,"issues",{value:e,enumerable:!1}),i.message=JSON.stringify(e,R0,2),Object.defineProperty(i,"toString",{value:()=>i.message,enumerable:!1})},uE=mt("$ZodError",uD),Ia=mt("$ZodError",uD,{Parent:Error});function hE(i,e=o=>o.message){let o={},h=[];for(let l of i.issues)l.path.length>0?(o[l.path[0]]=o[l.path[0]]||[],o[l.path[0]].push(e(l))):h.push(e(l));return{formErrors:h,fieldErrors:o}}function dE(i,e=o=>o.message){let o={_errors:[]},h=l=>{for(let f of l.issues)if(f.code==="invalid_union"&&f.errors.length)f.errors.map(x=>h({issues:x}));else if(f.code==="invalid_key")h({issues:f.issues});else if(f.code==="invalid_element")h({issues:f.issues});else if(f.path.length===0)o._errors.push(e(f));else{let x=o,s=0;for(;s<f.path.length;){let P=f.path[s];s!==f.path.length-1?x[P]=x[P]||{_errors:[]}:(x[P]=x[P]||{_errors:[]},x[P]._errors.push(e(f))),x=x[P],s++}}};return h(i),o}function hD(i,e=o=>o.message){let o={errors:[]},h=(l,f=[])=>{var x,s;for(let P of l.issues)if(P.code==="invalid_union"&&P.errors.length)P.errors.map(C=>h({issues:C},P.path));else if(P.code==="invalid_key")h({issues:P.issues},P.path);else if(P.code==="invalid_element")h({issues:P.issues},P.path);else{let C=[...f,...P.path];if(C.length===0){o.errors.push(e(P));continue}let O=o,F=0;for(;F<C.length;){let V=C[F],q=F===C.length-1;typeof V=="string"?(O.properties??(O.properties={}),(x=O.properties)[V]??(x[V]={errors:[]}),O=O.properties[V]):(O.items??(O.items=[]),(s=O.items)[V]??(s[V]={errors:[]}),O=O.items[V]),q&&O.errors.push(e(P)),F++}}};return h(i),o}function dD(i){let e=[],o=i.map(h=>typeof h=="object"?h.key:h);for(let h of o)typeof h=="number"?e.push(`[${h}]`):typeof h=="symbol"?e.push(`[${JSON.stringify(String(h))}]`):/[^\w$]/.test(h)?e.push(`[${JSON.stringify(h)}]`):(e.length&&e.push("."),e.push(h));return e.join("")}function fD(i){var h;let e=[],o=[...i.issues].sort((l,f)=>(l.path??[]).length-(f.path??[]).length);for(let l of o)e.push(`âœ– ${l.message}`),(h=l.path)!=null&&h.length&&e.push(`  â†’ at ${dD(l.path)}`);return e.join(`
`)}var W_=i=>(e,o,h,l)=>{let f=h?Object.assign(h,{async:!1}):{async:!1},x=e._zod.run({value:o,issues:[]},f);if(x instanceof Promise)throw new nd;if(x.issues.length){let s=new((l==null?void 0:l.Err)??i)(x.issues.map(P=>qa(P,f,zs())));throw cE(s,l==null?void 0:l.callee),s}return x.value},nT=W_(Ia),q_=i=>async(e,o,h,l)=>{let f=h?Object.assign(h,{async:!0}):{async:!0},x=e._zod.run({value:o,issues:[]},f);if(x instanceof Promise&&(x=await x),x.issues.length){let s=new((l==null?void 0:l.Err)??i)(x.issues.map(P=>qa(P,f,zs())));throw cE(s,l==null?void 0:l.callee),s}return x.value},rT=q_(Ia),X_=i=>(e,o,h)=>{let l=h?{...h,async:!1}:{async:!1},f=e._zod.run({value:o,issues:[]},l);if(f instanceof Promise)throw new nd;return f.issues.length?{success:!1,error:new(i??uE)(f.issues.map(x=>qa(x,l,zs())))}:{success:!0,data:f.value}},pD=X_(Ia),J_=i=>async(e,o,h)=>{let l=h?Object.assign(h,{async:!0}):{async:!0},f=e._zod.run({value:o,issues:[]},l);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new i(f.issues.map(x=>qa(x,l,zs())))}:{success:!0,data:f.value}},mD=J_(Ia),fE=i=>(e,o,h)=>{let l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return W_(i)(e,o,l)},ZZ=fE(Ia),pE=i=>(e,o,h)=>W_(i)(e,o,h),WZ=pE(Ia),mE=i=>async(e,o,h)=>{let l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return q_(i)(e,o,l)},qZ=mE(Ia),gE=i=>async(e,o,h)=>q_(i)(e,o,h),XZ=gE(Ia),_E=i=>(e,o,h)=>{let l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return X_(i)(e,o,l)},JZ=_E(Ia),yE=i=>(e,o,h)=>X_(i)(e,o,h),YZ=yE(Ia),vE=i=>async(e,o,h)=>{let l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return J_(i)(e,o,l)},KZ=vE(Ia),xE=i=>async(e,o,h)=>J_(i)(e,o,h),QZ=xE(Ia),pd={};Uc(pd,{xid:()=>vD,uuid7:()=>nW,uuid6:()=>iW,uuid4:()=>tW,uuid:()=>yp,uppercase:()=>ZD,unicodeEmail:()=>ED,undefined:()=>GD,ulid:()=>yD,time:()=>FD,string:()=>ND,sha512_hex:()=>TW,sha512_base64url:()=>IW,sha512_base64:()=>EW,sha384_hex:()=>bW,sha384_base64url:()=>SW,sha384_base64:()=>wW,sha256_hex:()=>yW,sha256_base64url:()=>xW,sha256_base64:()=>vW,sha1_hex:()=>mW,sha1_base64url:()=>_W,sha1_base64:()=>gW,rfc5322Email:()=>oW,number:()=>wE,null:()=>jD,nanoid:()=>bD,md5_hex:()=>dW,md5_base64url:()=>pW,md5_base64:()=>fW,mac:()=>PD,lowercase:()=>HD,ksuid:()=>xD,ipv6:()=>AD,ipv4:()=>MD,integer:()=>$D,idnEmail:()=>sW,html5Email:()=>rW,hostname:()=>cW,hex:()=>hW,guid:()=>SD,extendedDuration:()=>eW,emoji:()=>ID,email:()=>TD,e164:()=>RD,duration:()=>wD,domain:()=>uW,datetime:()=>BD,date:()=>kD,cuid2:()=>_D,cuid:()=>gD,cidrv6:()=>CD,cidrv4:()=>zD,browserEmail:()=>aW,boolean:()=>VD,bigint:()=>UD,base64url:()=>bE,base64:()=>LD});var gD=/^[cC][^\s-]{8,}$/,_D=/^[0-9a-z]+$/,yD=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,vD=/^[0-9a-vA-V]{20}$/,xD=/^[A-Za-z0-9]{27}$/,bD=/^[a-zA-Z0-9_-]{21}$/,wD=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,eW=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,SD=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,yp=i=>i?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${i}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,tW=yp(4),iW=yp(6),nW=yp(7),TD=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,rW=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,oW=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,ED=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,sW=ED,aW=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,lW="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function ID(){return new RegExp(lW,"u")}var MD=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,AD=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,PD=i=>{let e=Nc(i??":");return new RegExp(`^(?:[0-9A-F]{2}${e}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${e}){5}[0-9a-f]{2}$`)},zD=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,CD=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,LD=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,bE=/^[A-Za-z0-9_-]*$/,cW=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,uW=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,RD=/^\+[1-9]\d{6,14}$/,DD="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",kD=new RegExp(`^${DD}$`);function OD(i){return typeof i.precision=="number"?i.precision===-1?"(?:[01]\\d|2[0-3]):[0-5]\\d":i.precision===0?"(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d":`(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d\\.\\d{${i.precision}}`:"(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?"}function FD(i){return new RegExp(`^${OD(i)}$`)}function BD(i){let e=OD({precision:i.precision}),o=["Z"];i.local&&o.push(""),i.offset&&o.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let h=`${e}(?:${o.join("|")})`;return new RegExp(`^${DD}T(?:${h})$`)}var ND=i=>{let e=i?`[\\s\\S]{${(i==null?void 0:i.minimum)??0},${(i==null?void 0:i.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},UD=/^-?\d+n?$/,$D=/^-?\d+$/,wE=/^-?\d+(?:\.\d+)?$/,VD=/^(?:true|false)$/i,jD=/^null$/i,GD=/^undefined$/i,HD=/^[^A-Z]*$/,ZD=/^[^a-z]*$/,hW=/^[0-9a-fA-F]*$/;function Y_(i,e){return new RegExp(`^[A-Za-z0-9+/]{${i}}${e}$`)}function K_(i){return new RegExp(`^[A-Za-z0-9_-]{${i}}$`)}var dW=/^[0-9a-fA-F]{32}$/,fW=Y_(22,"=="),pW=K_(22),mW=/^[0-9a-fA-F]{40}$/,gW=Y_(27,"="),_W=K_(27),yW=/^[0-9a-fA-F]{64}$/,vW=Y_(43,"="),xW=K_(43),bW=/^[0-9a-fA-F]{96}$/,wW=Y_(64,""),SW=K_(64),TW=/^[0-9a-fA-F]{128}$/,EW=Y_(86,"=="),IW=K_(86),no=mt("$ZodCheck",(i,e)=>{var o;i._zod??(i._zod={}),i._zod.def=e,(o=i._zod).onattach??(o.onattach=[])}),WD={number:"number",bigint:"bigint",object:"date"},SE=mt("$ZodCheckLessThan",(i,e)=>{no.init(i,e);let o=WD[typeof e.value];i._zod.onattach.push(h=>{let l=h._zod.bag,f=(e.inclusive?l.maximum:l.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<f&&(e.inclusive?l.maximum=e.value:l.exclusiveMaximum=e.value)}),i._zod.check=h=>{(e.inclusive?h.value<=e.value:h.value<e.value)||h.issues.push({origin:o,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:h.value,inclusive:e.inclusive,inst:i,continue:!e.abort})}}),TE=mt("$ZodCheckGreaterThan",(i,e)=>{no.init(i,e);let o=WD[typeof e.value];i._zod.onattach.push(h=>{let l=h._zod.bag,f=(e.inclusive?l.minimum:l.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>f&&(e.inclusive?l.minimum=e.value:l.exclusiveMinimum=e.value)}),i._zod.check=h=>{(e.inclusive?h.value>=e.value:h.value>e.value)||h.issues.push({origin:o,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:h.value,inclusive:e.inclusive,inst:i,continue:!e.abort})}}),qD=mt("$ZodCheckMultipleOf",(i,e)=>{no.init(i,e),i._zod.onattach.push(o=>{var h;(h=o._zod.bag).multipleOf??(h.multipleOf=e.value)}),i._zod.check=o=>{if(typeof o.value!=typeof e.value)throw Error("Cannot mix number and bigint in multiple_of check.");(typeof o.value=="bigint"?o.value%e.value===BigInt(0):eD(o.value,e.value)===0)||o.issues.push({origin:typeof o.value,code:"not_multiple_of",divisor:e.value,input:o.value,inst:i,continue:!e.abort})}}),XD=mt("$ZodCheckNumberFormat",(i,e)=>{var x;no.init(i,e),e.format=e.format||"float64";let o=(x=e.format)==null?void 0:x.includes("int"),h=o?"int":"number",[l,f]=sD[e.format];i._zod.onattach.push(s=>{let P=s._zod.bag;P.format=e.format,P.minimum=l,P.maximum=f,o&&(P.pattern=$D)}),i._zod.check=s=>{let P=s.value;if(o){if(!Number.isInteger(P)){s.issues.push({expected:h,format:e.format,code:"invalid_type",continue:!1,input:P,inst:i});return}if(!Number.isSafeInteger(P)){P>0?s.issues.push({input:P,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:i,origin:h,inclusive:!0,continue:!e.abort}):s.issues.push({input:P,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:i,origin:h,inclusive:!0,continue:!e.abort});return}}P<l&&s.issues.push({origin:"number",input:P,code:"too_small",minimum:l,inclusive:!0,inst:i,continue:!e.abort}),P>f&&s.issues.push({origin:"number",input:P,code:"too_big",maximum:f,inclusive:!0,inst:i,continue:!e.abort})}}),JD=mt("$ZodCheckBigIntFormat",(i,e)=>{no.init(i,e);let[o,h]=aD[e.format];i._zod.onattach.push(l=>{let f=l._zod.bag;f.format=e.format,f.minimum=o,f.maximum=h}),i._zod.check=l=>{let f=l.value;f<o&&l.issues.push({origin:"bigint",input:f,code:"too_small",minimum:o,inclusive:!0,inst:i,continue:!e.abort}),f>h&&l.issues.push({origin:"bigint",input:f,code:"too_big",maximum:h,inclusive:!0,inst:i,continue:!e.abort})}}),YD=mt("$ZodCheckMaxSize",(i,e)=>{var o;no.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!fd(l)&&l.size!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<l&&(h._zod.bag.maximum=e.maximum)}),i._zod.check=h=>{let l=h.value;l.size<=e.maximum||h.issues.push({origin:hb(l),code:"too_big",maximum:e.maximum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),KD=mt("$ZodCheckMinSize",(i,e)=>{var o;no.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!fd(l)&&l.size!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>l&&(h._zod.bag.minimum=e.minimum)}),i._zod.check=h=>{let l=h.value;l.size>=e.minimum||h.issues.push({origin:hb(l),code:"too_small",minimum:e.minimum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),QD=mt("$ZodCheckSizeEquals",(i,e)=>{var o;no.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!fd(l)&&l.size!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag;l.minimum=e.size,l.maximum=e.size,l.size=e.size}),i._zod.check=h=>{let l=h.value,f=l.size;if(f===e.size)return;let x=f>e.size;h.issues.push({origin:hb(l),...x?{code:"too_big",maximum:e.size}:{code:"too_small",minimum:e.size},inclusive:!0,exact:!0,input:h.value,inst:i,continue:!e.abort})}}),ek=mt("$ZodCheckMaxLength",(i,e)=>{var o;no.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!fd(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<l&&(h._zod.bag.maximum=e.maximum)}),i._zod.check=h=>{let l=h.value;if(l.length<=e.maximum)return;let f=db(l);h.issues.push({origin:f,code:"too_big",maximum:e.maximum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),tk=mt("$ZodCheckMinLength",(i,e)=>{var o;no.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!fd(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>l&&(h._zod.bag.minimum=e.minimum)}),i._zod.check=h=>{let l=h.value;if(l.length>=e.minimum)return;let f=db(l);h.issues.push({origin:f,code:"too_small",minimum:e.minimum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),ik=mt("$ZodCheckLengthEquals",(i,e)=>{var o;no.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!fd(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag;l.minimum=e.length,l.maximum=e.length,l.length=e.length}),i._zod.check=h=>{let l=h.value,f=l.length;if(f===e.length)return;let x=db(l),s=f>e.length;h.issues.push({origin:x,...s?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:h.value,inst:i,continue:!e.abort})}}),Q_=mt("$ZodCheckStringFormat",(i,e)=>{var o,h;no.init(i,e),i._zod.onattach.push(l=>{let f=l._zod.bag;f.format=e.format,e.pattern&&(f.patterns??(f.patterns=new Set),f.patterns.add(e.pattern))}),e.pattern?(o=i._zod).check??(o.check=l=>{e.pattern.lastIndex=0,!e.pattern.test(l.value)&&l.issues.push({origin:"string",code:"invalid_format",format:e.format,input:l.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:i,continue:!e.abort})}):(h=i._zod).check??(h.check=()=>{})}),nk=mt("$ZodCheckRegex",(i,e)=>{Q_.init(i,e),i._zod.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:"regex",input:o.value,pattern:e.pattern.toString(),inst:i,continue:!e.abort})}}),rk=mt("$ZodCheckLowerCase",(i,e)=>{e.pattern??(e.pattern=HD),Q_.init(i,e)}),ok=mt("$ZodCheckUpperCase",(i,e)=>{e.pattern??(e.pattern=ZD),Q_.init(i,e)}),sk=mt("$ZodCheckIncludes",(i,e)=>{no.init(i,e);let o=Nc(e.includes),h=new RegExp(typeof e.position=="number"?`^.{${e.position}}${o}`:o);e.pattern=h,i._zod.onattach.push(l=>{let f=l._zod.bag;f.patterns??(f.patterns=new Set),f.patterns.add(h)}),i._zod.check=l=>{l.value.includes(e.includes,e.position)||l.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:l.value,inst:i,continue:!e.abort})}}),ak=mt("$ZodCheckStartsWith",(i,e)=>{no.init(i,e);let o=new RegExp(`^${Nc(e.prefix)}.*`);e.pattern??(e.pattern=o),i._zod.onattach.push(h=>{let l=h._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(o)}),i._zod.check=h=>{h.value.startsWith(e.prefix)||h.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:h.value,inst:i,continue:!e.abort})}}),lk=mt("$ZodCheckEndsWith",(i,e)=>{no.init(i,e);let o=new RegExp(`.*${Nc(e.suffix)}$`);e.pattern??(e.pattern=o),i._zod.onattach.push(h=>{let l=h._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(o)}),i._zod.check=h=>{h.value.endsWith(e.suffix)||h.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:h.value,inst:i,continue:!e.abort})}});function cC(i,e,o){i.issues.length&&e.issues.push(...Tl(o,i.issues))}var ck=mt("$ZodCheckProperty",(i,e)=>{no.init(i,e),i._zod.check=o=>{let h=e.schema._zod.run({value:o.value[e.property],issues:[]},{});if(h instanceof Promise)return h.then(l=>cC(l,o,e.property));cC(h,o,e.property)}}),uk=mt("$ZodCheckMimeType",(i,e)=>{no.init(i,e);let o=new Set(e.mime);i._zod.onattach.push(h=>{h._zod.bag.mime=e.mime}),i._zod.check=h=>{o.has(h.value.type)||h.issues.push({code:"invalid_value",values:e.mime,input:h.value.type,inst:i,continue:!e.abort})}}),hk=mt("$ZodCheckOverwrite",(i,e)=>{no.init(i,e),i._zod.check=o=>{o.value=e.tx(o.value)}});class dk{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let o=e.split(`
`).filter(f=>f),h=Math.min(...o.map(f=>f.length-f.trimStart().length)),l=o.map(f=>f.slice(h)).map(f=>" ".repeat(this.indent*2)+f);for(let f of l)this.content.push(f)}compile(){let e=Function,o=this==null?void 0:this.args,h=[...((this==null?void 0:this.content)??[""]).map(l=>`  ${l}`)];return new e(...o,h.join(`
`))}}var fk={major:4,minor:3,patch:5},Ln=mt("$ZodType",(i,e)=>{var l;var o;i??(i={}),i._zod.def=e,i._zod.bag=i._zod.bag||{},i._zod.version=fk;let h=[...i._zod.def.checks??[]];i._zod.traits.has("$ZodCheck")&&h.unshift(i);for(let f of h)for(let x of f._zod.onattach)x(i);if(h.length===0)(o=i._zod).deferred??(o.deferred=[]),(l=i._zod.deferred)==null||l.push(()=>{i._zod.run=i._zod.parse});else{let f=(s,P,C)=>{let O=id(s),F;for(let V of P){if(V._zod.def.when){if(!V._zod.def.when(s))continue}else if(O)continue;let q=s.issues.length,ee=V._zod.check(s);if(ee instanceof Promise&&(C==null?void 0:C.async)===!1)throw new nd;if(F||ee instanceof Promise)F=(F??Promise.resolve()).then(async()=>{await ee,s.issues.length!==q&&(O||(O=id(s,q)))});else{if(s.issues.length===q)continue;O||(O=id(s,q))}}return F?F.then(()=>s):s},x=(s,P,C)=>{if(id(s))return s.aborted=!0,s;let O=f(P,h,C);if(O instanceof Promise){if(C.async===!1)throw new nd;return O.then(F=>i._zod.parse(F,C))}return i._zod.parse(O,C)};i._zod.run=(s,P)=>{if(P.skipChecks)return i._zod.parse(s,P);if(P.direction==="backward"){let O=i._zod.parse({value:s.value,issues:[]},{...P,skipChecks:!0});return O instanceof Promise?O.then(F=>x(F,s,P)):x(O,s,P)}let C=i._zod.parse(s,P);if(C instanceof Promise){if(P.async===!1)throw new nd;return C.then(O=>f(O,h,P))}return f(C,h,P)}}Hn(i,"~standard",()=>({validate:f=>{var x;try{let s=pD(i,f);return s.success?{value:s.data}:{issues:(x=s.error)==null?void 0:x.issues}}catch{return mD(i,f).then(P=>{var C;return P.success?{value:P.data}:{issues:(C=P.error)==null?void 0:C.issues}})}},vendor:"zod",version:1}))}),ey=mt("$ZodString",(i,e)=>{var o;Ln.init(i,e),i._zod.pattern=[...((o=i==null?void 0:i._zod.bag)==null?void 0:o.patterns)??[]].pop()??ND(i._zod.bag),i._zod.parse=(h,l)=>{if(e.coerce)try{h.value=String(h.value)}catch{}return typeof h.value=="string"||h.issues.push({expected:"string",code:"invalid_type",input:h.value,inst:i}),h}}),Fr=mt("$ZodStringFormat",(i,e)=>{Q_.init(i,e),ey.init(i,e)}),pk=mt("$ZodGUID",(i,e)=>{e.pattern??(e.pattern=SD),Fr.init(i,e)}),mk=mt("$ZodUUID",(i,e)=>{if(e.version){let o={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(o===void 0)throw Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=yp(o))}else e.pattern??(e.pattern=yp());Fr.init(i,e)}),gk=mt("$ZodEmail",(i,e)=>{e.pattern??(e.pattern=TD),Fr.init(i,e)}),_k=mt("$ZodURL",(i,e)=>{Fr.init(i,e),i._zod.check=o=>{try{let h=o.value.trim(),l=new URL(h);e.hostname&&(e.hostname.lastIndex=0,!e.hostname.test(l.hostname)&&o.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:o.value,inst:i,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,!e.protocol.test(l.protocol.endsWith(":")?l.protocol.slice(0,-1):l.protocol)&&o.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:o.value,inst:i,continue:!e.abort})),e.normalize?o.value=l.href:o.value=h;return}catch{o.issues.push({code:"invalid_format",format:"url",input:o.value,inst:i,continue:!e.abort})}}}),yk=mt("$ZodEmoji",(i,e)=>{e.pattern??(e.pattern=ID()),Fr.init(i,e)}),vk=mt("$ZodNanoID",(i,e)=>{e.pattern??(e.pattern=bD),Fr.init(i,e)}),xk=mt("$ZodCUID",(i,e)=>{e.pattern??(e.pattern=gD),Fr.init(i,e)}),bk=mt("$ZodCUID2",(i,e)=>{e.pattern??(e.pattern=_D),Fr.init(i,e)}),wk=mt("$ZodULID",(i,e)=>{e.pattern??(e.pattern=yD),Fr.init(i,e)}),Sk=mt("$ZodXID",(i,e)=>{e.pattern??(e.pattern=vD),Fr.init(i,e)}),Tk=mt("$ZodKSUID",(i,e)=>{e.pattern??(e.pattern=xD),Fr.init(i,e)}),Ek=mt("$ZodISODateTime",(i,e)=>{e.pattern??(e.pattern=BD(e)),Fr.init(i,e)}),Ik=mt("$ZodISODate",(i,e)=>{e.pattern??(e.pattern=kD),Fr.init(i,e)}),Mk=mt("$ZodISOTime",(i,e)=>{e.pattern??(e.pattern=FD(e)),Fr.init(i,e)}),Ak=mt("$ZodISODuration",(i,e)=>{e.pattern??(e.pattern=wD),Fr.init(i,e)}),Pk=mt("$ZodIPv4",(i,e)=>{e.pattern??(e.pattern=MD),Fr.init(i,e),i._zod.bag.format="ipv4"}),zk=mt("$ZodIPv6",(i,e)=>{e.pattern??(e.pattern=AD),Fr.init(i,e),i._zod.bag.format="ipv6",i._zod.check=o=>{try{new URL(`http://[${o.value}]`)}catch{o.issues.push({code:"invalid_format",format:"ipv6",input:o.value,inst:i,continue:!e.abort})}}}),Ck=mt("$ZodMAC",(i,e)=>{e.pattern??(e.pattern=PD(e.delimiter)),Fr.init(i,e),i._zod.bag.format="mac"}),Lk=mt("$ZodCIDRv4",(i,e)=>{e.pattern??(e.pattern=zD),Fr.init(i,e)}),Rk=mt("$ZodCIDRv6",(i,e)=>{e.pattern??(e.pattern=CD),Fr.init(i,e),i._zod.check=o=>{let h=o.value.split("/");try{if(h.length!==2)throw Error();let[l,f]=h;if(!f)throw Error();let x=Number(f);if(`${x}`!==f||x<0||x>128)throw Error();new URL(`http://[${l}]`)}catch{o.issues.push({code:"invalid_format",format:"cidrv6",input:o.value,inst:i,continue:!e.abort})}}});function EE(i){if(i==="")return!0;if(i.length%4!==0)return!1;try{return atob(i),!0}catch{return!1}}var Dk=mt("$ZodBase64",(i,e)=>{e.pattern??(e.pattern=LD),Fr.init(i,e),i._zod.bag.contentEncoding="base64",i._zod.check=o=>{EE(o.value)||o.issues.push({code:"invalid_format",format:"base64",input:o.value,inst:i,continue:!e.abort})}});function kk(i){if(!bE.test(i))return!1;let e=i.replace(/[-_]/g,h=>h==="-"?"+":"/"),o=e.padEnd(Math.ceil(e.length/4)*4,"=");return EE(o)}var Ok=mt("$ZodBase64URL",(i,e)=>{e.pattern??(e.pattern=bE),Fr.init(i,e),i._zod.bag.contentEncoding="base64url",i._zod.check=o=>{kk(o.value)||o.issues.push({code:"invalid_format",format:"base64url",input:o.value,inst:i,continue:!e.abort})}}),Fk=mt("$ZodE164",(i,e)=>{e.pattern??(e.pattern=RD),Fr.init(i,e)});function Bk(i,e=null){try{let o=i.split(".");if(o.length!==3)return!1;let[h]=o;if(!h)return!1;let l=JSON.parse(atob(h));return!("typ"in l&&(l==null?void 0:l.typ)!=="JWT"||!l.alg||e&&(!("alg"in l)||l.alg!==e))}catch{return!1}}var Nk=mt("$ZodJWT",(i,e)=>{Fr.init(i,e),i._zod.check=o=>{Bk(o.value,e.alg)||o.issues.push({code:"invalid_format",format:"jwt",input:o.value,inst:i,continue:!e.abort})}}),Uk=mt("$ZodCustomStringFormat",(i,e)=>{Fr.init(i,e),i._zod.check=o=>{e.fn(o.value)||o.issues.push({code:"invalid_format",format:e.format,input:o.value,inst:i,continue:!e.abort})}}),IE=mt("$ZodNumber",(i,e)=>{Ln.init(i,e),i._zod.pattern=i._zod.bag.pattern??wE,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=Number(o.value)}catch{}let l=o.value;if(typeof l=="number"&&!Number.isNaN(l)&&Number.isFinite(l))return o;let f=typeof l=="number"?Number.isNaN(l)?"NaN":Number.isFinite(l)?void 0:"Infinity":void 0;return o.issues.push({expected:"number",code:"invalid_type",input:l,inst:i,...f?{received:f}:{}}),o}}),$k=mt("$ZodNumberFormat",(i,e)=>{XD.init(i,e),IE.init(i,e)}),ME=mt("$ZodBoolean",(i,e)=>{Ln.init(i,e),i._zod.pattern=VD,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=!!o.value}catch{}let l=o.value;return typeof l=="boolean"||o.issues.push({expected:"boolean",code:"invalid_type",input:l,inst:i}),o}}),AE=mt("$ZodBigInt",(i,e)=>{Ln.init(i,e),i._zod.pattern=UD,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=BigInt(o.value)}catch{}return typeof o.value=="bigint"||o.issues.push({expected:"bigint",code:"invalid_type",input:o.value,inst:i}),o}}),Vk=mt("$ZodBigIntFormat",(i,e)=>{JD.init(i,e),AE.init(i,e)}),jk=mt("$ZodSymbol",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;return typeof l=="symbol"||o.issues.push({expected:"symbol",code:"invalid_type",input:l,inst:i}),o}}),Gk=mt("$ZodUndefined",(i,e)=>{Ln.init(i,e),i._zod.pattern=GD,i._zod.values=new Set([void 0]),i._zod.optin="optional",i._zod.optout="optional",i._zod.parse=(o,h)=>{let l=o.value;return typeof l>"u"||o.issues.push({expected:"undefined",code:"invalid_type",input:l,inst:i}),o}}),Hk=mt("$ZodNull",(i,e)=>{Ln.init(i,e),i._zod.pattern=jD,i._zod.values=new Set([null]),i._zod.parse=(o,h)=>{let l=o.value;return l===null||o.issues.push({expected:"null",code:"invalid_type",input:l,inst:i}),o}}),Zk=mt("$ZodAny",(i,e)=>{Ln.init(i,e),i._zod.parse=o=>o}),Wk=mt("$ZodUnknown",(i,e)=>{Ln.init(i,e),i._zod.parse=o=>o}),qk=mt("$ZodNever",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>(o.issues.push({expected:"never",code:"invalid_type",input:o.value,inst:i}),o)}),Xk=mt("$ZodVoid",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;return typeof l>"u"||o.issues.push({expected:"void",code:"invalid_type",input:l,inst:i}),o}}),Jk=mt("$ZodDate",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=new Date(o.value)}catch{}let l=o.value,f=l instanceof Date;return f&&!Number.isNaN(l.getTime())||o.issues.push({expected:"date",code:"invalid_type",input:l,...f?{received:"Invalid Date"}:{},inst:i}),o}});function uC(i,e,o){i.issues.length&&e.issues.push(...Tl(o,i.issues)),e.value[o]=i.value}var Yk=mt("$ZodArray",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;if(!Array.isArray(l))return o.issues.push({expected:"array",code:"invalid_type",input:l,inst:i}),o;o.value=Array(l.length);let f=[];for(let x=0;x<l.length;x++){let s=l[x],P=e.element._zod.run({value:s,issues:[]},h);P instanceof Promise?f.push(P.then(C=>uC(C,o,x))):uC(P,o,x)}return f.length?Promise.all(f).then(()=>o):o}});function O0(i,e,o,h,l){if(i.issues.length){if(l&&!(o in h))return;e.issues.push(...Tl(o,i.issues))}i.value===void 0?o in h&&(e.value[o]=void 0):e.value[o]=i.value}function Kk(i){var h,l,f,x;let e=Object.keys(i.shape);for(let s of e)if(!((x=(f=(l=(h=i.shape)==null?void 0:h[s])==null?void 0:l._zod)==null?void 0:f.traits)!=null&&x.has("$ZodType")))throw Error(`Invalid element at key "${s}": expected a Zod schema`);let o=oD(i.shape);return{...i,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(o)}}function Qk(i,e,o,h,l,f){let x=[],s=l.keySet,P=l.catchall._zod,C=P.def.type,O=P.optout==="optional";for(let F in e){if(s.has(F))continue;if(C==="never"){x.push(F);continue}let V=P.run({value:e[F],issues:[]},h);V instanceof Promise?i.push(V.then(q=>O0(q,o,F,e,O))):O0(V,o,F,e,O)}return x.length&&o.issues.push({code:"unrecognized_keys",keys:x,input:e,inst:f}),i.length?Promise.all(i).then(()=>o):o}var e3=mt("$ZodObject",(i,e)=>{var x;if(Ln.init(i,e),!((x=Object.getOwnPropertyDescriptor(e,"shape"))!=null&&x.get)){let s=e.shape;Object.defineProperty(e,"shape",{get:()=>{let P={...s};return Object.defineProperty(e,"shape",{value:P}),P}})}let o=Z_(()=>Kk(e));Hn(i._zod,"propValues",()=>{let s=e.shape,P={};for(let C in s){let O=s[C]._zod;if(O.values){P[C]??(P[C]=new Set);for(let F of O.values)P[C].add(F)}}return P});let h=_p,l=e.catchall,f;i._zod.parse=(s,P)=>{f??(f=o.value);let C=s.value;if(!h(C))return s.issues.push({expected:"object",code:"invalid_type",input:C,inst:i}),s;s.value={};let O=[],F=f.shape;for(let V of f.keys){let q=F[V],ee=q._zod.optout==="optional",se=q._zod.run({value:C[V],issues:[]},P);se instanceof Promise?O.push(se.then(fe=>O0(fe,s,V,C,ee))):O0(se,s,V,C,ee)}return l?Qk(O,C,s,P,o.value,i):O.length?Promise.all(O).then(()=>s):s}}),t3=mt("$ZodObjectJIT",(i,e)=>{e3.init(i,e);let o=i._zod.parse,h=Z_(()=>Kk(e)),l=F=>{var ie,tt;let V=new dk(["shape","payload","ctx"]),q=h.value,ee=Ue=>{let Ne=iT(Ue);return`shape[${Ne}]._zod.run({ value: input[${Ne}], issues: [] }, ctx)`};V.write("const input = payload.value;");let se=Object.create(null),fe=0;for(let Ue of q.keys)se[Ue]=`key_${fe++}`;V.write("const newResult = {};");for(let Ue of q.keys){let Ne=se[Ue],Ce=iT(Ue),Ye=((tt=(ie=F[Ue])==null?void 0:ie._zod)==null?void 0:tt.optout)==="optional";V.write(`const ${Ne} = ${ee(Ue)};`),Ye?V.write(`
        if (${Ne}.issues.length) {
          if (${Ce} in input) {
            payload.issues = payload.issues.concat(${Ne}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${Ce}, ...iss.path] : [${Ce}]
            })));
          }
        }
        
        if (${Ne}.value === undefined) {
          if (${Ce} in input) {
            newResult[${Ce}] = undefined;
          }
        } else {
          newResult[${Ce}] = ${Ne}.value;
        }
        
      `):V.write(`
        if (${Ne}.issues.length) {
          payload.issues = payload.issues.concat(${Ne}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Ce}, ...iss.path] : [${Ce}]
          })));
        }
        
        if (${Ne}.value === undefined) {
          if (${Ce} in input) {
            newResult[${Ce}] = undefined;
          }
        } else {
          newResult[${Ce}] = ${Ne}.value;
        }
        
      `)}V.write("payload.value = newResult;"),V.write("return payload;");let ae=V.compile();return(Ue,Ne)=>ae(F,Ue,Ne)},f,x=_p,s=!L0.jitless,P=s&&iD.value,C=e.catchall,O;i._zod.parse=(F,V)=>{O??(O=h.value);let q=F.value;return x(q)?s&&P&&(V==null?void 0:V.async)===!1&&V.jitless!==!0?(f||(f=l(e.shape)),F=f(F,V),C?Qk([],q,F,V,O,i):F):o(F,V):(F.issues.push({expected:"object",code:"invalid_type",input:q,inst:i}),F)}});function hC(i,e,o,h){for(let f of i)if(f.issues.length===0)return e.value=f.value,e;let l=i.filter(f=>!id(f));return l.length===1?(e.value=l[0].value,l[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:o,errors:i.map(f=>f.issues.map(x=>qa(x,h,zs())))}),e)}var fb=mt("$ZodUnion",(i,e)=>{Ln.init(i,e),Hn(i._zod,"optin",()=>e.options.some(l=>l._zod.optin==="optional")?"optional":void 0),Hn(i._zod,"optout",()=>e.options.some(l=>l._zod.optout==="optional")?"optional":void 0),Hn(i._zod,"values",()=>{if(e.options.every(l=>l._zod.values))return new Set(e.options.flatMap(l=>Array.from(l._zod.values)))}),Hn(i._zod,"pattern",()=>{if(e.options.every(l=>l._zod.pattern)){let l=e.options.map(f=>f._zod.pattern);return new RegExp(`^(${l.map(f=>ub(f.source)).join("|")})$`)}});let o=e.options.length===1,h=e.options[0]._zod.run;i._zod.parse=(l,f)=>{if(o)return h(l,f);let x=!1,s=[];for(let P of e.options){let C=P._zod.run({value:l.value,issues:[]},f);if(C instanceof Promise)s.push(C),x=!0;else{if(C.issues.length===0)return C;s.push(C)}}return x?Promise.all(s).then(P=>hC(P,l,i,f)):hC(s,l,i,f)}});function dC(i,e,o,h){let l=i.filter(f=>f.issues.length===0);return l.length===1?(e.value=l[0].value,e):(l.length===0?e.issues.push({code:"invalid_union",input:e.value,inst:o,errors:i.map(f=>f.issues.map(x=>qa(x,h,zs())))}):e.issues.push({code:"invalid_union",input:e.value,inst:o,errors:[],inclusive:!1}),e)}var i3=mt("$ZodXor",(i,e)=>{fb.init(i,e),e.inclusive=!1;let o=e.options.length===1,h=e.options[0]._zod.run;i._zod.parse=(l,f)=>{if(o)return h(l,f);let x=!1,s=[];for(let P of e.options){let C=P._zod.run({value:l.value,issues:[]},f);C instanceof Promise?(s.push(C),x=!0):s.push(C)}return x?Promise.all(s).then(P=>dC(P,l,i,f)):dC(s,l,i,f)}}),n3=mt("$ZodDiscriminatedUnion",(i,e)=>{e.inclusive=!1,fb.init(i,e);let o=i._zod.parse;Hn(i._zod,"propValues",()=>{let l={};for(let f of e.options){let x=f._zod.propValues;if(!x||Object.keys(x).length===0)throw Error(`Invalid discriminated union option at index "${e.options.indexOf(f)}"`);for(let[s,P]of Object.entries(x)){l[s]||(l[s]=new Set);for(let C of P)l[s].add(C)}}return l});let h=Z_(()=>{var x;let l=e.options,f=new Map;for(let s of l){let P=(x=s._zod.propValues)==null?void 0:x[e.discriminator];if(!P||P.size===0)throw Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let C of P){if(f.has(C))throw Error(`Duplicate discriminator value "${String(C)}"`);f.set(C,s)}}return f});i._zod.parse=(l,f)=>{let x=l.value;if(!_p(x))return l.issues.push({code:"invalid_type",expected:"object",input:x,inst:i}),l;let s=h.value.get(x==null?void 0:x[e.discriminator]);return s?s._zod.run(l,f):e.unionFallback?o(l,f):(l.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:x,path:[e.discriminator],inst:i}),l)}}),r3=mt("$ZodIntersection",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value,f=e.left._zod.run({value:l,issues:[]},h),x=e.right._zod.run({value:l,issues:[]},h);return f instanceof Promise||x instanceof Promise?Promise.all([f,x]).then(([s,P])=>fC(o,s,P)):fC(o,f,x)}});function oT(i,e){if(i===e)return{valid:!0,data:i};if(i instanceof Date&&e instanceof Date&&+i==+e)return{valid:!0,data:i};if(ld(i)&&ld(e)){let o=Object.keys(e),h=Object.keys(i).filter(f=>o.indexOf(f)!==-1),l={...i,...e};for(let f of h){let x=oT(i[f],e[f]);if(!x.valid)return{valid:!1,mergeErrorPath:[f,...x.mergeErrorPath]};l[f]=x.data}return{valid:!0,data:l}}if(Array.isArray(i)&&Array.isArray(e)){if(i.length!==e.length)return{valid:!1,mergeErrorPath:[]};let o=[];for(let h=0;h<i.length;h++){let l=i[h],f=e[h],x=oT(l,f);if(!x.valid)return{valid:!1,mergeErrorPath:[h,...x.mergeErrorPath]};o.push(x.data)}return{valid:!0,data:o}}return{valid:!1,mergeErrorPath:[]}}function fC(i,e,o){let h=new Map,l;for(let s of e.issues)if(s.code==="unrecognized_keys"){l??(l=s);for(let P of s.keys)h.has(P)||h.set(P,{}),h.get(P).l=!0}else i.issues.push(s);for(let s of o.issues)if(s.code==="unrecognized_keys")for(let P of s.keys)h.has(P)||h.set(P,{}),h.get(P).r=!0;else i.issues.push(s);let f=[...h].filter(([,s])=>s.l&&s.r).map(([s])=>s);if(f.length&&l&&i.issues.push({...l,keys:f}),id(i))return i;let x=oT(e.value,o.value);if(!x.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(x.mergeErrorPath)}`);return i.value=x.data,i}var PE=mt("$ZodTuple",(i,e)=>{Ln.init(i,e);let o=e.items;i._zod.parse=(h,l)=>{let f=h.value;if(!Array.isArray(f))return h.issues.push({input:f,inst:i,expected:"tuple",code:"invalid_type"}),h;h.value=[];let x=[],s=[...o].reverse().findIndex(O=>O._zod.optin!=="optional"),P=s===-1?0:o.length-s;if(!e.rest){let O=f.length>o.length,F=f.length<P-1;if(O||F)return h.issues.push({...O?{code:"too_big",maximum:o.length,inclusive:!0}:{code:"too_small",minimum:o.length},input:f,inst:i,origin:"array"}),h}let C=-1;for(let O of o){if(C++,C>=f.length&&C>=P)continue;let F=O._zod.run({value:f[C],issues:[]},l);F instanceof Promise?x.push(F.then(V=>Hx(V,h,C))):Hx(F,h,C)}if(e.rest){let O=f.slice(o.length);for(let F of O){C++;let V=e.rest._zod.run({value:F,issues:[]},l);V instanceof Promise?x.push(V.then(q=>Hx(q,h,C))):Hx(V,h,C)}}return x.length?Promise.all(x).then(()=>h):h}});function Hx(i,e,o){i.issues.length&&e.issues.push(...Tl(o,i.issues)),e.value[o]=i.value}var o3=mt("$ZodRecord",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;if(!ld(l))return o.issues.push({expected:"record",code:"invalid_type",input:l,inst:i}),o;let f=[],x=e.keyType._zod.values;if(x){o.value={};let s=new Set;for(let C of x)if(typeof C=="string"||typeof C=="number"||typeof C=="symbol"){s.add(typeof C=="number"?C.toString():C);let O=e.valueType._zod.run({value:l[C],issues:[]},h);O instanceof Promise?f.push(O.then(F=>{F.issues.length&&o.issues.push(...Tl(C,F.issues)),o.value[C]=F.value})):(O.issues.length&&o.issues.push(...Tl(C,O.issues)),o.value[C]=O.value)}let P;for(let C in l)s.has(C)||(P=P??[],P.push(C));P&&P.length>0&&o.issues.push({code:"unrecognized_keys",input:l,inst:i,keys:P})}else{o.value={};for(let s of Reflect.ownKeys(l)){if(s==="__proto__")continue;let P=e.keyType._zod.run({value:s,issues:[]},h);if(P instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(typeof s=="string"&&wE.test(s)&&P.issues.length&&P.issues.some(O=>O.code==="invalid_type"&&O.expected==="number")){let O=e.keyType._zod.run({value:Number(s),issues:[]},h);if(O instanceof Promise)throw Error("Async schemas not supported in object keys currently");O.issues.length===0&&(P=O)}if(P.issues.length){e.mode==="loose"?o.value[s]=l[s]:o.issues.push({code:"invalid_key",origin:"record",issues:P.issues.map(O=>qa(O,h,zs())),input:s,path:[s],inst:i});continue}let C=e.valueType._zod.run({value:l[s],issues:[]},h);C instanceof Promise?f.push(C.then(O=>{O.issues.length&&o.issues.push(...Tl(s,O.issues)),o.value[P.value]=O.value})):(C.issues.length&&o.issues.push(...Tl(s,C.issues)),o.value[P.value]=C.value)}}return f.length?Promise.all(f).then(()=>o):o}}),s3=mt("$ZodMap",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;if(!(l instanceof Map))return o.issues.push({expected:"map",code:"invalid_type",input:l,inst:i}),o;let f=[];o.value=new Map;for(let[x,s]of l){let P=e.keyType._zod.run({value:x,issues:[]},h),C=e.valueType._zod.run({value:s,issues:[]},h);P instanceof Promise||C instanceof Promise?f.push(Promise.all([P,C]).then(([O,F])=>{pC(O,F,o,x,l,i,h)})):pC(P,C,o,x,l,i,h)}return f.length?Promise.all(f).then(()=>o):o}});function pC(i,e,o,h,l,f,x){i.issues.length&&(D0.has(typeof h)?o.issues.push(...Tl(h,i.issues)):o.issues.push({code:"invalid_key",origin:"map",input:l,inst:f,issues:i.issues.map(s=>qa(s,x,zs()))})),e.issues.length&&(D0.has(typeof h)?o.issues.push(...Tl(h,e.issues)):o.issues.push({origin:"map",code:"invalid_element",input:l,inst:f,key:h,issues:e.issues.map(s=>qa(s,x,zs()))})),o.value.set(i.value,e.value)}var a3=mt("$ZodSet",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;if(!(l instanceof Set))return o.issues.push({input:l,inst:i,expected:"set",code:"invalid_type"}),o;let f=[];o.value=new Set;for(let x of l){let s=e.valueType._zod.run({value:x,issues:[]},h);s instanceof Promise?f.push(s.then(P=>mC(P,o))):mC(s,o)}return f.length?Promise.all(f).then(()=>o):o}});function mC(i,e){i.issues.length&&e.issues.push(...i.issues),e.value.add(i.value)}var l3=mt("$ZodEnum",(i,e)=>{Ln.init(i,e);let o=lE(e.entries),h=new Set(o);i._zod.values=h,i._zod.pattern=new RegExp(`^(${o.filter(l=>D0.has(typeof l)).map(l=>typeof l=="string"?Nc(l):l.toString()).join("|")})$`),i._zod.parse=(l,f)=>{let x=l.value;return h.has(x)||l.issues.push({code:"invalid_value",values:o,input:x,inst:i}),l}}),c3=mt("$ZodLiteral",(i,e)=>{if(Ln.init(i,e),e.values.length===0)throw Error("Cannot create literal schema with no valid values");let o=new Set(e.values);i._zod.values=o,i._zod.pattern=new RegExp(`^(${e.values.map(h=>typeof h=="string"?Nc(h):h?Nc(h.toString()):String(h)).join("|")})$`),i._zod.parse=(h,l)=>{let f=h.value;return o.has(f)||h.issues.push({code:"invalid_value",values:e.values,input:f,inst:i}),h}}),u3=mt("$ZodFile",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;return l instanceof File||o.issues.push({expected:"file",code:"invalid_type",input:l,inst:i}),o}}),h3=mt("$ZodTransform",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new cb(i.constructor.name);let l=e.transform(o.value,o);if(h.async)return(l instanceof Promise?l:Promise.resolve(l)).then(f=>(o.value=f,o));if(l instanceof Promise)throw new nd;return o.value=l,o}});function gC(i,e){return i.issues.length&&e===void 0?{issues:[],value:void 0}:i}var zE=mt("$ZodOptional",(i,e)=>{Ln.init(i,e),i._zod.optin="optional",i._zod.optout="optional",Hn(i._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Hn(i._zod,"pattern",()=>{let o=e.innerType._zod.pattern;return o?new RegExp(`^(${ub(o.source)})?$`):void 0}),i._zod.parse=(o,h)=>{if(e.innerType._zod.optin==="optional"){let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(f=>gC(f,o.value)):gC(l,o.value)}return o.value===void 0?o:e.innerType._zod.run(o,h)}}),d3=mt("$ZodExactOptional",(i,e)=>{zE.init(i,e),Hn(i._zod,"values",()=>e.innerType._zod.values),Hn(i._zod,"pattern",()=>e.innerType._zod.pattern),i._zod.parse=(o,h)=>e.innerType._zod.run(o,h)}),f3=mt("$ZodNullable",(i,e)=>{Ln.init(i,e),Hn(i._zod,"optin",()=>e.innerType._zod.optin),Hn(i._zod,"optout",()=>e.innerType._zod.optout),Hn(i._zod,"pattern",()=>{let o=e.innerType._zod.pattern;return o?new RegExp(`^(${ub(o.source)}|null)$`):void 0}),Hn(i._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),i._zod.parse=(o,h)=>o.value===null?o:e.innerType._zod.run(o,h)}),p3=mt("$ZodDefault",(i,e)=>{Ln.init(i,e),i._zod.optin="optional",Hn(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);if(o.value===void 0)return o.value=e.defaultValue,o;let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(f=>_C(f,e)):_C(l,e)}});function _C(i,e){return i.value===void 0&&(i.value=e.defaultValue),i}var m3=mt("$ZodPrefault",(i,e)=>{Ln.init(i,e),i._zod.optin="optional",Hn(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>(h.direction==="backward"||o.value===void 0&&(o.value=e.defaultValue),e.innerType._zod.run(o,h))}),g3=mt("$ZodNonOptional",(i,e)=>{Ln.init(i,e),Hn(i._zod,"values",()=>{let o=e.innerType._zod.values;return o?new Set([...o].filter(h=>h!==void 0)):void 0}),i._zod.parse=(o,h)=>{let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(f=>yC(f,i)):yC(l,i)}});function yC(i,e){return!i.issues.length&&i.value===void 0&&i.issues.push({code:"invalid_type",expected:"nonoptional",input:i.value,inst:e}),i}var _3=mt("$ZodSuccess",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new cb("ZodSuccess");let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(f=>(o.value=f.issues.length===0,o)):(o.value=l.issues.length===0,o)}}),y3=mt("$ZodCatch",(i,e)=>{Ln.init(i,e),Hn(i._zod,"optin",()=>e.innerType._zod.optin),Hn(i._zod,"optout",()=>e.innerType._zod.optout),Hn(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(f=>(o.value=f.value,f.issues.length&&(o.value=e.catchValue({...o,error:{issues:f.issues.map(x=>qa(x,h,zs()))},input:o.value}),o.issues=[]),o)):(o.value=l.value,l.issues.length&&(o.value=e.catchValue({...o,error:{issues:l.issues.map(f=>qa(f,h,zs()))},input:o.value}),o.issues=[]),o)}}),v3=mt("$ZodNaN",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>((typeof o.value!="number"||!Number.isNaN(o.value))&&o.issues.push({input:o.value,inst:i,expected:"nan",code:"invalid_type"}),o)}),x3=mt("$ZodPipe",(i,e)=>{Ln.init(i,e),Hn(i._zod,"values",()=>e.in._zod.values),Hn(i._zod,"optin",()=>e.in._zod.optin),Hn(i._zod,"optout",()=>e.out._zod.optout),Hn(i._zod,"propValues",()=>e.in._zod.propValues),i._zod.parse=(o,h)=>{if(h.direction==="backward"){let f=e.out._zod.run(o,h);return f instanceof Promise?f.then(x=>Zx(x,e.in,h)):Zx(f,e.in,h)}let l=e.in._zod.run(o,h);return l instanceof Promise?l.then(f=>Zx(f,e.out,h)):Zx(l,e.out,h)}});function Zx(i,e,o){return i.issues.length?(i.aborted=!0,i):e._zod.run({value:i.value,issues:i.issues},o)}var CE=mt("$ZodCodec",(i,e)=>{Ln.init(i,e),Hn(i._zod,"values",()=>e.in._zod.values),Hn(i._zod,"optin",()=>e.in._zod.optin),Hn(i._zod,"optout",()=>e.out._zod.optout),Hn(i._zod,"propValues",()=>e.in._zod.propValues),i._zod.parse=(o,h)=>{if((h.direction||"forward")==="forward"){let l=e.in._zod.run(o,h);return l instanceof Promise?l.then(f=>Wx(f,e,h)):Wx(l,e,h)}else{let l=e.out._zod.run(o,h);return l instanceof Promise?l.then(f=>Wx(f,e,h)):Wx(l,e,h)}}});function Wx(i,e,o){if(i.issues.length)return i.aborted=!0,i;if((o.direction||"forward")==="forward"){let h=e.transform(i.value,i);return h instanceof Promise?h.then(l=>qx(i,l,e.out,o)):qx(i,h,e.out,o)}else{let h=e.reverseTransform(i.value,i);return h instanceof Promise?h.then(l=>qx(i,l,e.in,o)):qx(i,h,e.in,o)}}function qx(i,e,o,h){return i.issues.length?(i.aborted=!0,i):o._zod.run({value:e,issues:i.issues},h)}var b3=mt("$ZodReadonly",(i,e)=>{Ln.init(i,e),Hn(i._zod,"propValues",()=>e.innerType._zod.propValues),Hn(i._zod,"values",()=>e.innerType._zod.values),Hn(i._zod,"optin",()=>{var o,h;return(h=(o=e.innerType)==null?void 0:o._zod)==null?void 0:h.optin}),Hn(i._zod,"optout",()=>{var o,h;return(h=(o=e.innerType)==null?void 0:o._zod)==null?void 0:h.optout}),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(vC):vC(l)}});function vC(i){return i.value=Object.freeze(i.value),i}var w3=mt("$ZodTemplateLiteral",(i,e)=>{Ln.init(i,e);let o=[];for(let h of e.parts)if(typeof h=="object"&&h!==null){if(!h._zod.pattern)throw Error(`Invalid template literal part, no pattern found: ${[...h._zod.traits].shift()}`);let l=h._zod.pattern instanceof RegExp?h._zod.pattern.source:h._zod.pattern;if(!l)throw Error(`Invalid template literal part: ${h._zod.traits}`);let f=l.startsWith("^")?1:0,x=l.endsWith("$")?l.length-1:l.length;o.push(l.slice(f,x))}else if(h===null||rD.has(typeof h))o.push(Nc(`${h}`));else throw Error(`Invalid template literal part: ${h}`);i._zod.pattern=new RegExp(`^${o.join("")}$`),i._zod.parse=(h,l)=>typeof h.value!="string"?(h.issues.push({input:h.value,inst:i,expected:"string",code:"invalid_type"}),h):(i._zod.pattern.lastIndex=0,i._zod.pattern.test(h.value)||h.issues.push({input:h.value,inst:i,code:"invalid_format",format:e.format??"template_literal",pattern:i._zod.pattern.source}),h)}),S3=mt("$ZodFunction",(i,e)=>(Ln.init(i,e),i._def=e,i._zod.def=e,i.implement=o=>{if(typeof o!="function")throw Error("implement() must be called with a function");return function(...h){let l=i._def.input?nT(i._def.input,h):h,f=Reflect.apply(o,this,l);return i._def.output?nT(i._def.output,f):f}},i.implementAsync=o=>{if(typeof o!="function")throw Error("implementAsync() must be called with a function");return async function(...h){let l=i._def.input?await rT(i._def.input,h):h,f=await Reflect.apply(o,this,l);return i._def.output?await rT(i._def.output,f):f}},i._zod.parse=(o,h)=>typeof o.value!="function"?(o.issues.push({code:"invalid_type",expected:"function",input:o.value,inst:i}),o):(i._def.output&&i._def.output._zod.def.type==="promise"?o.value=i.implementAsync(o.value):o.value=i.implement(o.value),o),i.input=(...o)=>{let h=i.constructor;return Array.isArray(o[0])?new h({type:"function",input:new PE({type:"tuple",items:o[0],rest:o[1]}),output:i._def.output}):new h({type:"function",input:o[0],output:i._def.output})},i.output=o=>new i.constructor({type:"function",input:i._def.input,output:o}),i)),T3=mt("$ZodPromise",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>Promise.resolve(o.value).then(l=>e.innerType._zod.run({value:l,issues:[]},h))}),E3=mt("$ZodLazy",(i,e)=>{Ln.init(i,e),Hn(i._zod,"innerType",()=>e.getter()),Hn(i._zod,"pattern",()=>{var o,h;return(h=(o=i._zod.innerType)==null?void 0:o._zod)==null?void 0:h.pattern}),Hn(i._zod,"propValues",()=>{var o,h;return(h=(o=i._zod.innerType)==null?void 0:o._zod)==null?void 0:h.propValues}),Hn(i._zod,"optin",()=>{var o,h;return((h=(o=i._zod.innerType)==null?void 0:o._zod)==null?void 0:h.optin)??void 0}),Hn(i._zod,"optout",()=>{var o,h;return((h=(o=i._zod.innerType)==null?void 0:o._zod)==null?void 0:h.optout)??void 0}),i._zod.parse=(o,h)=>i._zod.innerType._zod.run(o,h)}),I3=mt("$ZodCustom",(i,e)=>{no.init(i,e),Ln.init(i,e),i._zod.parse=(o,h)=>o,i._zod.check=o=>{let h=o.value,l=e.fn(h);if(l instanceof Promise)return l.then(f=>xC(f,o,h,i));xC(l,o,h,i)}});function xC(i,e,o,h){if(!i){let l={code:"custom",input:o,inst:h,path:[...h._zod.def.path??[]],continue:!h._zod.def.abort};h._zod.def.params&&(l.params=h._zod.def.params),e.issues.push(k0(l))}}var LE={};Uc(LE,{zhTW:()=>c9,zhCN:()=>a9,yo:()=>h9,vi:()=>o9,uz:()=>n9,ur:()=>t9,uk:()=>P3,ua:()=>Qq,tr:()=>Yq,th:()=>Xq,ta:()=>Wq,sv:()=>Hq,sl:()=>jq,ru:()=>$q,pt:()=>Nq,ps:()=>kq,pl:()=>Fq,ota:()=>Rq,no:()=>Cq,nl:()=>Pq,ms:()=>Mq,mk:()=>Eq,lt:()=>Sq,ko:()=>bq,km:()=>A3,kh:()=>vq,ka:()=>_q,ja:()=>mq,it:()=>fq,is:()=>hq,id:()=>cq,hy:()=>aq,hu:()=>oq,he:()=>nq,frCA:()=>tq,fr:()=>QW,fi:()=>YW,fa:()=>XW,es:()=>WW,eo:()=>HW,en:()=>M3,de:()=>VW,da:()=>UW,cs:()=>BW,ca:()=>OW,bg:()=>DW,be:()=>LW,az:()=>zW,ar:()=>AW});var MW=()=>{let i={string:{unit:"Ø­Ø±Ù",verb:"Ø£Ù† ÙŠØ­ÙˆÙŠ"},file:{unit:"Ø¨Ø§ÙŠØª",verb:"Ø£Ù† ÙŠØ­ÙˆÙŠ"},array:{unit:"Ø¹Ù†ØµØ±",verb:"Ø£Ù† ÙŠØ­ÙˆÙŠ"},set:{unit:"Ø¹Ù†ØµØ±",verb:"Ø£Ù† ÙŠØ­ÙˆÙŠ"}};function e(l){return i[l]??null}let o={regex:"Ù…Ø¯Ø®Ù„",email:"Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",url:"Ø±Ø§Ø¨Ø·",emoji:"Ø¥ÙŠÙ…ÙˆØ¬ÙŠ",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø¨Ù…Ø¹ÙŠØ§Ø± ISO",date:"ØªØ§Ø±ÙŠØ® Ø¨Ù…Ø¹ÙŠØ§Ø± ISO",time:"ÙˆÙ‚Øª Ø¨Ù…Ø¹ÙŠØ§Ø± ISO",duration:"Ù…Ø¯Ø© Ø¨Ù…Ø¹ÙŠØ§Ø± ISO",ipv4:"Ø¹Ù†ÙˆØ§Ù† IPv4",ipv6:"Ø¹Ù†ÙˆØ§Ù† IPv6",cidrv4:"Ù…Ø¯Ù‰ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¨ØµÙŠØºØ© IPv4",cidrv6:"Ù…Ø¯Ù‰ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¨ØµÙŠØºØ© IPv6",base64:"Ù†ÙŽØµ Ø¨ØªØ±Ù…ÙŠØ² base64-encoded",base64url:"Ù†ÙŽØµ Ø¨ØªØ±Ù…ÙŠØ² base64url-encoded",json_string:"Ù†ÙŽØµ Ø¹Ù„Ù‰ Ù‡ÙŠØ¦Ø© JSON",e164:"Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø¨Ù…Ø¹ÙŠØ§Ø± E.164",jwt:"JWT",template_literal:"Ù…Ø¯Ø®Ù„"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ù…Ø¯Ø®Ù„Ø§Øª ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„Ø©: ÙŠÙØªØ±Ø¶ Ø¥Ø¯Ø®Ø§Ù„ instanceof ${l.expected}ØŒ ÙˆÙ„ÙƒÙ† ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ${s}`:`Ù…Ø¯Ø®Ù„Ø§Øª ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„Ø©: ÙŠÙØªØ±Ø¶ Ø¥Ø¯Ø®Ø§Ù„ ${f}ØŒ ÙˆÙ„ÙƒÙ† ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ${s}`}case"invalid_value":return l.values.length===1?`Ù…Ø¯Ø®Ù„Ø§Øª ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„Ø©: ÙŠÙØªØ±Ø¶ Ø¥Ø¯Ø®Ø§Ù„ ${vn(l.values[0])}`:`Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØªÙˆÙ‚Ø¹ Ø§Ù†ØªÙ‚Ø§Ø¡ Ø£Ø­Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª: ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?` Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù…: ÙŠÙØªØ±Ø¶ Ø£Ù† ØªÙƒÙˆÙ† ${l.origin??"Ø§Ù„Ù‚ÙŠÙ…Ø©"} ${f} ${l.maximum.toString()} ${x.unit??"Ø¹Ù†ØµØ±"}`:`Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù…: ÙŠÙØªØ±Ø¶ Ø£Ù† ØªÙƒÙˆÙ† ${l.origin??"Ø§Ù„Ù‚ÙŠÙ…Ø©"} ${f} ${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù…: ÙŠÙØªØ±Ø¶ Ù„Ù€ ${l.origin} Ø£Ù† ÙŠÙƒÙˆÙ† ${f} ${l.minimum.toString()} ${x.unit}`:`Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù…: ÙŠÙØªØ±Ø¶ Ù„Ù€ ${l.origin} Ø£Ù† ÙŠÙƒÙˆÙ† ${f} ${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Ù†ÙŽØµ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ "${l.prefix}"`:f.format==="ends_with"?`Ù†ÙŽØµ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ù€ "${f.suffix}"`:f.format==="includes"?`Ù†ÙŽØµ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ¶Ù…Ù‘ÙŽÙ† "${f.includes}"`:f.format==="regex"?`Ù†ÙŽØµ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ù†Ù…Ø· ${f.pattern}`:`${o[f.format]??l.format} ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„`}case"not_multiple_of":return`Ø±Ù‚Ù… ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ù† Ù…Ø¶Ø§Ø¹ÙØ§Øª ${l.divisor}`;case"unrecognized_keys":return`Ù…Ø¹Ø±Ù${l.keys.length>1?"Ø§Øª":""} ØºØ±ÙŠØ¨${l.keys.length>1?"Ø©":""}: ${ai(l.keys,"ØŒ ")}`;case"invalid_key":return`Ù…Ø¹Ø±Ù ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„ ÙÙŠ ${l.origin}`;case"invalid_union":return"Ù…Ø¯Ø®Ù„ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„";case"invalid_element":return`Ù…Ø¯Ø®Ù„ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„ ÙÙŠ ${l.origin}`;default:return"Ù…Ø¯Ø®Ù„ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„"}}};function AW(){return{localeError:MW()}}var PW=()=>{let i={string:{unit:"simvol",verb:"olmalÄ±dÄ±r"},file:{unit:"bayt",verb:"olmalÄ±dÄ±r"},array:{unit:"element",verb:"olmalÄ±dÄ±r"},set:{unit:"element",verb:"olmalÄ±dÄ±r"}};function e(l){return i[l]??null}let o={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`YanlÄ±ÅŸ dÉ™yÉ™r: gÃ¶zlÉ™nilÉ™n instanceof ${l.expected}, daxil olan ${s}`:`YanlÄ±ÅŸ dÉ™yÉ™r: gÃ¶zlÉ™nilÉ™n ${f}, daxil olan ${s}`}case"invalid_value":return l.values.length===1?`YanlÄ±ÅŸ dÉ™yÉ™r: gÃ¶zlÉ™nilÉ™n ${vn(l.values[0])}`:`YanlÄ±ÅŸ seÃ§im: aÅŸaÄŸÄ±dakÄ±lardan biri olmalÄ±dÄ±r: ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ã‡ox bÃ¶yÃ¼k: gÃ¶zlÉ™nilÉ™n ${l.origin??"dÉ™yÉ™r"} ${f}${l.maximum.toString()} ${x.unit??"element"}`:`Ã‡ox bÃ¶yÃ¼k: gÃ¶zlÉ™nilÉ™n ${l.origin??"dÉ™yÉ™r"} ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Ã‡ox kiÃ§ik: gÃ¶zlÉ™nilÉ™n ${l.origin} ${f}${l.minimum.toString()} ${x.unit}`:`Ã‡ox kiÃ§ik: gÃ¶zlÉ™nilÉ™n ${l.origin} ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`YanlÄ±ÅŸ mÉ™tn: "${f.prefix}" ilÉ™ baÅŸlamalÄ±dÄ±r`:f.format==="ends_with"?`YanlÄ±ÅŸ mÉ™tn: "${f.suffix}" ilÉ™ bitmÉ™lidir`:f.format==="includes"?`YanlÄ±ÅŸ mÉ™tn: "${f.includes}" daxil olmalÄ±dÄ±r`:f.format==="regex"?`YanlÄ±ÅŸ mÉ™tn: ${f.pattern} ÅŸablonuna uyÄŸun olmalÄ±dÄ±r`:`YanlÄ±ÅŸ ${o[f.format]??l.format}`}case"not_multiple_of":return`YanlÄ±ÅŸ É™dÉ™d: ${l.divisor} ilÉ™ bÃ¶lÃ¼nÉ™ bilÉ™n olmalÄ±dÄ±r`;case"unrecognized_keys":return`TanÄ±nmayan aÃ§ar${l.keys.length>1?"lar":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`${l.origin} daxilindÉ™ yanlÄ±ÅŸ aÃ§ar`;case"invalid_union":return"YanlÄ±ÅŸ dÉ™yÉ™r";case"invalid_element":return`${l.origin} daxilindÉ™ yanlÄ±ÅŸ dÉ™yÉ™r`;default:return"YanlÄ±ÅŸ dÉ™yÉ™r"}}};function zW(){return{localeError:PW()}}function bC(i,e,o,h){let l=Math.abs(i),f=l%10,x=l%100;return x>=11&&x<=19?h:f===1?e:f>=2&&f<=4?o:h}var CW=()=>{let i={string:{unit:{one:"ÑÑ–Ð¼Ð²Ð°Ð»",few:"ÑÑ–Ð¼Ð²Ð°Ð»Ñ‹",many:"ÑÑ–Ð¼Ð²Ð°Ð»Ð°Ñž"},verb:"Ð¼ÐµÑ†ÑŒ"},array:{unit:{one:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚",few:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹",many:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°Ñž"},verb:"Ð¼ÐµÑ†ÑŒ"},set:{unit:{one:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚",few:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹",many:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°Ñž"},verb:"Ð¼ÐµÑ†ÑŒ"},file:{unit:{one:"Ð±Ð°Ð¹Ñ‚",few:"Ð±Ð°Ð¹Ñ‚Ñ‹",many:"Ð±Ð°Ð¹Ñ‚Ð°Ñž"},verb:"Ð¼ÐµÑ†ÑŒ"}};function e(l){return i[l]??null}let o={regex:"ÑƒÐ²Ð¾Ð´",email:"email Ð°Ð´Ñ€Ð°Ñ",url:"URL",emoji:"ÑÐ¼Ð¾Ð´Ð·Ñ–",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Ð´Ð°Ñ‚Ð° Ñ– Ñ‡Ð°Ñ",date:"ISO Ð´Ð°Ñ‚Ð°",time:"ISO Ñ‡Ð°Ñ",duration:"ISO Ð¿Ñ€Ð°Ñ†ÑÐ³Ð»Ð°ÑÑ†ÑŒ",ipv4:"IPv4 Ð°Ð´Ñ€Ð°Ñ",ipv6:"IPv6 Ð°Ð´Ñ€Ð°Ñ",cidrv4:"IPv4 Ð´Ñ‹ÑÐ¿Ð°Ð·Ð¾Ð½",cidrv6:"IPv6 Ð´Ñ‹ÑÐ¿Ð°Ð·Ð¾Ð½",base64:"Ñ€Ð°Ð´Ð¾Ðº Ñƒ Ñ„Ð°Ñ€Ð¼Ð°Ñ†Ðµ base64",base64url:"Ñ€Ð°Ð´Ð¾Ðº Ñƒ Ñ„Ð°Ñ€Ð¼Ð°Ñ†Ðµ base64url",json_string:"JSON Ñ€Ð°Ð´Ð¾Ðº",e164:"Ð½ÑƒÐ¼Ð°Ñ€ E.164",jwt:"JWT",template_literal:"ÑƒÐ²Ð¾Ð´"},h={nan:"NaN",number:"Ð»Ñ–Ðº",array:"Ð¼Ð°ÑÑ–Ñž"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´: Ñ‡Ð°ÐºÐ°ÑžÑÑ instanceof ${l.expected}, Ð°Ñ‚Ñ€Ñ‹Ð¼Ð°Ð½Ð° ${s}`:`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´: Ñ‡Ð°ÐºÐ°ÑžÑÑ ${f}, Ð°Ñ‚Ñ€Ñ‹Ð¼Ð°Ð½Ð° ${s}`}case"invalid_value":return l.values.length===1?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ ${vn(l.values[0])}`:`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ð²Ð°Ñ€Ñ‹ÑÐ½Ñ‚: Ñ‡Ð°ÐºÐ°ÑžÑÑ Ð°Ð´Ð·Ñ–Ð½ Ð· ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);if(x){let s=Number(l.maximum),P=bC(s,x.unit.one,x.unit.few,x.unit.many);return`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð° Ð²ÑÐ»Ñ–ÐºÑ–: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ, ÑˆÑ‚Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÑÐ½Ð½Ðµ"} Ð¿Ð°Ð²Ñ–Ð½Ð½Ð° ${x.verb} ${f}${l.maximum.toString()} ${P}`}return`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð° Ð²ÑÐ»Ñ–ÐºÑ–: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ, ÑˆÑ‚Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÑÐ½Ð½Ðµ"} Ð¿Ð°Ð²Ñ–Ð½Ð½Ð° Ð±Ñ‹Ñ†ÑŒ ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);if(x){let s=Number(l.minimum),P=bC(s,x.unit.one,x.unit.few,x.unit.many);return`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð° Ð¼Ð°Ð»Ñ‹: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ, ÑˆÑ‚Ð¾ ${l.origin} Ð¿Ð°Ð²Ñ–Ð½Ð½Ð° ${x.verb} ${f}${l.minimum.toString()} ${P}`}return`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð° Ð¼Ð°Ð»Ñ‹: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ, ÑˆÑ‚Ð¾ ${l.origin} Ð¿Ð°Ð²Ñ–Ð½Ð½Ð° Ð±Ñ‹Ñ†ÑŒ ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ñ€Ð°Ð´Ð¾Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð¿Ð°Ñ‡Ñ‹Ð½Ð°Ñ†Ñ†Ð° Ð· "${f.prefix}"`:f.format==="ends_with"?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ñ€Ð°Ð´Ð¾Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð·Ð°ÐºÐ°Ð½Ñ‡Ð²Ð°Ñ†Ñ†Ð° Ð½Ð° "${f.suffix}"`:f.format==="includes"?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ñ€Ð°Ð´Ð¾Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð·Ð¼ÑÑˆÑ‡Ð°Ñ†ÑŒ "${f.includes}"`:f.format==="regex"?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ñ€Ð°Ð´Ð¾Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð°Ð´Ð¿Ð°Ð²ÑÐ´Ð°Ñ†ÑŒ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ ${f.pattern}`:`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ${o[f.format]??l.format}`}case"not_multiple_of":return`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ð»Ñ–Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð±Ñ‹Ñ†ÑŒ ÐºÑ€Ð°Ñ‚Ð½Ñ‹Ð¼ ${l.divisor}`;case"unrecognized_keys":return`ÐÐµÑ€Ð°ÑÐ¿Ð°Ð·Ð½Ð°Ð½Ñ‹ ${l.keys.length>1?"ÐºÐ»ÑŽÑ‡Ñ‹":"ÐºÐ»ÑŽÑ‡"}: ${ai(l.keys,", ")}`;case"invalid_key":return`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÐºÐ»ÑŽÑ‡ Ñƒ ${l.origin}`;case"invalid_union":return"ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´";case"invalid_element":return`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ð°Ðµ Ð·Ð½Ð°Ñ‡ÑÐ½Ð½Ðµ Ñž ${l.origin}`;default:return"ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´"}}};function LW(){return{localeError:CW()}}var RW=()=>{let i={string:{unit:"ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°",verb:"Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð°"},file:{unit:"Ð±Ð°Ð¹Ñ‚Ð°",verb:"Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð°"},array:{unit:"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°",verb:"Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð°"},set:{unit:"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°",verb:"Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð°"}};function e(l){return i[l]??null}let o={regex:"Ð²Ñ…Ð¾Ð´",email:"Ð¸Ð¼ÐµÐ¹Ð» Ð°Ð´Ñ€ÐµÑ",url:"URL",emoji:"ÐµÐ¼Ð¾Ð´Ð¶Ð¸",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Ð²Ñ€ÐµÐ¼Ðµ",date:"ISO Ð´Ð°Ñ‚Ð°",time:"ISO Ð²Ñ€ÐµÐ¼Ðµ",duration:"ISO Ð¿Ñ€Ð¾Ð´ÑŠÐ»Ð¶Ð¸Ñ‚ÐµÐ»Ð½Ð¾ÑÑ‚",ipv4:"IPv4 Ð°Ð´Ñ€ÐµÑ",ipv6:"IPv6 Ð°Ð´Ñ€ÐµÑ",cidrv4:"IPv4 Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½",cidrv6:"IPv6 Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½",base64:"base64-ÐºÐ¾Ð´Ð¸Ñ€Ð°Ð½ Ð½Ð¸Ð·",base64url:"base64url-ÐºÐ¾Ð´Ð¸Ñ€Ð°Ð½ Ð½Ð¸Ð·",json_string:"JSON Ð½Ð¸Ð·",e164:"E.164 Ð½Ð¾Ð¼ÐµÑ€",jwt:"JWT",template_literal:"Ð²Ñ…Ð¾Ð´"},h={nan:"NaN",number:"Ñ‡Ð¸ÑÐ»Ð¾",array:"Ð¼Ð°ÑÐ¸Ð²"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´: Ð¾Ñ‡Ð°ÐºÐ²Ð°Ð½ instanceof ${l.expected}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½ ${s}`:`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´: Ð¾Ñ‡Ð°ÐºÐ²Ð°Ð½ ${f}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½ ${s}`}case"invalid_value":return l.values.length===1?`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´: Ð¾Ñ‡Ð°ÐºÐ²Ð°Ð½ ${vn(l.values[0])}`:`ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð° Ð¾Ð¿Ñ†Ð¸Ñ: Ð¾Ñ‡Ð°ÐºÐ²Ð°Ð½Ð¾ ÐµÐ´Ð½Ð¾ Ð¾Ñ‚ ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ð¢Ð²ÑŠÑ€Ð´Ðµ Ð³Ð¾Ð»ÑÐ¼Ð¾: Ð¾Ñ‡Ð°ÐºÐ²Ð° ÑÐµ ${l.origin??"ÑÑ‚Ð¾Ð¹Ð½Ð¾ÑÑ‚"} Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð° ${f}${l.maximum.toString()} ${x.unit??"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°"}`:`Ð¢Ð²ÑŠÑ€Ð´Ðµ Ð³Ð¾Ð»ÑÐ¼Ð¾: Ð¾Ñ‡Ð°ÐºÐ²Ð° ÑÐµ ${l.origin??"ÑÑ‚Ð¾Ð¹Ð½Ð¾ÑÑ‚"} Ð´Ð° Ð±ÑŠÐ´Ðµ ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Ð¢Ð²ÑŠÑ€Ð´Ðµ Ð¼Ð°Ð»ÐºÐ¾: Ð¾Ñ‡Ð°ÐºÐ²Ð° ÑÐµ ${l.origin} Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð° ${f}${l.minimum.toString()} ${x.unit}`:`Ð¢Ð²ÑŠÑ€Ð´Ðµ Ð¼Ð°Ð»ÐºÐ¾: Ð¾Ñ‡Ð°ÐºÐ²Ð° ÑÐµ ${l.origin} Ð´Ð° Ð±ÑŠÐ´Ðµ ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;if(f.format==="starts_with")return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð½Ð¸Ð·: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð·Ð°Ð¿Ð¾Ñ‡Ð²Ð° Ñ "${f.prefix}"`;if(f.format==="ends_with")return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð½Ð¸Ð·: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð·Ð°Ð²ÑŠÑ€ÑˆÐ²Ð° Ñ "${f.suffix}"`;if(f.format==="includes")return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð½Ð¸Ð·: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð²ÐºÐ»ÑŽÑ‡Ð²Ð° "${f.includes}"`;if(f.format==="regex")return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð½Ð¸Ð·: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° ÑÑŠÐ²Ð¿Ð°Ð´Ð° Ñ ${f.pattern}`;let x="ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½";return f.format==="emoji"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð¾"),f.format==="datetime"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð¾"),f.format==="date"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð°"),f.format==="time"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð¾"),f.format==="duration"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð°"),`${x} ${o[f.format]??l.format}`}case"not_multiple_of":return`ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð¾ Ñ‡Ð¸ÑÐ»Ð¾: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð±ÑŠÐ´Ðµ ÐºÑ€Ð°Ñ‚Ð½Ð¾ Ð½Ð° ${l.divisor}`;case"unrecognized_keys":return`ÐÐµÑ€Ð°Ð·Ð¿Ð¾Ð·Ð½Ð°Ñ‚${l.keys.length>1?"Ð¸":""} ÐºÐ»ÑŽÑ‡${l.keys.length>1?"Ð¾Ð²Ðµ":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ ÐºÐ»ÑŽÑ‡ Ð² ${l.origin}`;case"invalid_union":return"ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´";case"invalid_element":return`ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð° ÑÑ‚Ð¾Ð¹Ð½Ð¾ÑÑ‚ Ð² ${l.origin}`;default:return"ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´"}}};function DW(){return{localeError:RW()}}var kW=()=>{let i={string:{unit:"carÃ cters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}};function e(l){return i[l]??null}let o={regex:"entrada",email:"adreÃ§a electrÃ²nica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adreÃ§a IPv4",ipv6:"adreÃ§a IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"nÃºmero E.164",jwt:"JWT",template_literal:"entrada"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Tipus invÃ lid: s'esperava instanceof ${l.expected}, s'ha rebut ${s}`:`Tipus invÃ lid: s'esperava ${f}, s'ha rebut ${s}`}case"invalid_value":return l.values.length===1?`Valor invÃ lid: s'esperava ${vn(l.values[0])}`:`OpciÃ³ invÃ lida: s'esperava una de ${ai(l.values," o ")}`;case"too_big":{let f=l.inclusive?"com a mÃ xim":"menys de",x=e(l.origin);return x?`Massa gran: s'esperava que ${l.origin??"el valor"} continguÃ©s ${f} ${l.maximum.toString()} ${x.unit??"elements"}`:`Massa gran: s'esperava que ${l.origin??"el valor"} fos ${f} ${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?"com a mÃ­nim":"mÃ©s de",x=e(l.origin);return x?`Massa petit: s'esperava que ${l.origin} continguÃ©s ${f} ${l.minimum.toString()} ${x.unit}`:`Massa petit: s'esperava que ${l.origin} fos ${f} ${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Format invÃ lid: ha de comenÃ§ar amb "${f.prefix}"`:f.format==="ends_with"?`Format invÃ lid: ha d'acabar amb "${f.suffix}"`:f.format==="includes"?`Format invÃ lid: ha d'incloure "${f.includes}"`:f.format==="regex"?`Format invÃ lid: ha de coincidir amb el patrÃ³ ${f.pattern}`:`Format invÃ lid per a ${o[f.format]??l.format}`}case"not_multiple_of":return`NÃºmero invÃ lid: ha de ser mÃºltiple de ${l.divisor}`;case"unrecognized_keys":return`Clau${l.keys.length>1?"s":""} no reconeguda${l.keys.length>1?"s":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`Clau invÃ lida a ${l.origin}`;case"invalid_union":return"Entrada invÃ lida";case"invalid_element":return`Element invÃ lid a ${l.origin}`;default:return"Entrada invÃ lida"}}};function OW(){return{localeError:kW()}}var FW=()=>{let i={string:{unit:"znakÅ¯",verb:"mÃ­t"},file:{unit:"bajtÅ¯",verb:"mÃ­t"},array:{unit:"prvkÅ¯",verb:"mÃ­t"},set:{unit:"prvkÅ¯",verb:"mÃ­t"}};function e(l){return i[l]??null}let o={regex:"regulÃ¡rnÃ­ vÃ½raz",email:"e-mailovÃ¡ adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a Äas ve formÃ¡tu ISO",date:"datum ve formÃ¡tu ISO",time:"Äas ve formÃ¡tu ISO",duration:"doba trvÃ¡nÃ­ ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"Å™etÄ›zec zakÃ³dovanÃ½ ve formÃ¡tu base64",base64url:"Å™etÄ›zec zakÃ³dovanÃ½ ve formÃ¡tu base64url",json_string:"Å™etÄ›zec ve formÃ¡tu JSON",e164:"ÄÃ­slo E.164",jwt:"JWT",template_literal:"vstup"},h={nan:"NaN",number:"ÄÃ­slo",string:"Å™etÄ›zec",function:"funkce",array:"pole"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`NeplatnÃ½ vstup: oÄekÃ¡vÃ¡no instanceof ${l.expected}, obdrÅ¾eno ${s}`:`NeplatnÃ½ vstup: oÄekÃ¡vÃ¡no ${f}, obdrÅ¾eno ${s}`}case"invalid_value":return l.values.length===1?`NeplatnÃ½ vstup: oÄekÃ¡vÃ¡no ${vn(l.values[0])}`:`NeplatnÃ¡ moÅ¾nost: oÄekÃ¡vÃ¡na jedna z hodnot ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Hodnota je pÅ™Ã­liÅ¡ velkÃ¡: ${l.origin??"hodnota"} musÃ­ mÃ­t ${f}${l.maximum.toString()} ${x.unit??"prvkÅ¯"}`:`Hodnota je pÅ™Ã­liÅ¡ velkÃ¡: ${l.origin??"hodnota"} musÃ­ bÃ½t ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Hodnota je pÅ™Ã­liÅ¡ malÃ¡: ${l.origin??"hodnota"} musÃ­ mÃ­t ${f}${l.minimum.toString()} ${x.unit??"prvkÅ¯"}`:`Hodnota je pÅ™Ã­liÅ¡ malÃ¡: ${l.origin??"hodnota"} musÃ­ bÃ½t ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`NeplatnÃ½ Å™etÄ›zec: musÃ­ zaÄÃ­nat na "${f.prefix}"`:f.format==="ends_with"?`NeplatnÃ½ Å™etÄ›zec: musÃ­ konÄit na "${f.suffix}"`:f.format==="includes"?`NeplatnÃ½ Å™etÄ›zec: musÃ­ obsahovat "${f.includes}"`:f.format==="regex"?`NeplatnÃ½ Å™etÄ›zec: musÃ­ odpovÃ­dat vzoru ${f.pattern}`:`NeplatnÃ½ formÃ¡t ${o[f.format]??l.format}`}case"not_multiple_of":return`NeplatnÃ© ÄÃ­slo: musÃ­ bÃ½t nÃ¡sobkem ${l.divisor}`;case"unrecognized_keys":return`NeznÃ¡mÃ© klÃ­Äe: ${ai(l.keys,", ")}`;case"invalid_key":return`NeplatnÃ½ klÃ­Ä v ${l.origin}`;case"invalid_union":return"NeplatnÃ½ vstup";case"invalid_element":return`NeplatnÃ¡ hodnota v ${l.origin}`;default:return"NeplatnÃ½ vstup"}}};function BW(){return{localeError:FW()}}var NW=()=>{let i={string:{unit:"tegn",verb:"havde"},file:{unit:"bytes",verb:"havde"},array:{unit:"elementer",verb:"indeholdt"},set:{unit:"elementer",verb:"indeholdt"}};function e(l){return i[l]??null}let o={regex:"input",email:"e-mailadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslÃ¦t",date:"ISO-dato",time:"ISO-klokkeslÃ¦t",duration:"ISO-varighed",ipv4:"IPv4-omrÃ¥de",ipv6:"IPv6-omrÃ¥de",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodet streng",base64url:"base64url-kodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},h={nan:"NaN",string:"streng",number:"tal",boolean:"boolean",array:"liste",object:"objekt",set:"sÃ¦t",file:"fil"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ugyldigt input: forventede instanceof ${l.expected}, fik ${s}`:`Ugyldigt input: forventede ${f}, fik ${s}`}case"invalid_value":return l.values.length===1?`Ugyldig vÃ¦rdi: forventede ${vn(l.values[0])}`:`Ugyldigt valg: forventede en af fÃ¸lgende ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin),s=h[l.origin]??l.origin;return x?`For stor: forventede ${s??"value"} ${x.verb} ${f} ${l.maximum.toString()} ${x.unit??"elementer"}`:`For stor: forventede ${s??"value"} havde ${f} ${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin),s=h[l.origin]??l.origin;return x?`For lille: forventede ${s} ${x.verb} ${f} ${l.minimum.toString()} ${x.unit}`:`For lille: forventede ${s} havde ${f} ${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Ugyldig streng: skal starte med "${f.prefix}"`:f.format==="ends_with"?`Ugyldig streng: skal ende med "${f.suffix}"`:f.format==="includes"?`Ugyldig streng: skal indeholde "${f.includes}"`:f.format==="regex"?`Ugyldig streng: skal matche mÃ¸nsteret ${f.pattern}`:`Ugyldig ${o[f.format]??l.format}`}case"not_multiple_of":return`Ugyldigt tal: skal vÃ¦re deleligt med ${l.divisor}`;case"unrecognized_keys":return`${l.keys.length>1?"Ukendte nÃ¸gler":"Ukendt nÃ¸gle"}: ${ai(l.keys,", ")}`;case"invalid_key":return`Ugyldig nÃ¸gle i ${l.origin}`;case"invalid_union":return"Ugyldigt input: matcher ingen af de tilladte typer";case"invalid_element":return`Ugyldig vÃ¦rdi i ${l.origin}`;default:return"Ugyldigt input"}}};function UW(){return{localeError:NW()}}var $W=()=>{let i={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}};function e(l){return i[l]??null}let o={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"},h={nan:"NaN",number:"Zahl",array:"Array"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`UngÃ¼ltige Eingabe: erwartet instanceof ${l.expected}, erhalten ${s}`:`UngÃ¼ltige Eingabe: erwartet ${f}, erhalten ${s}`}case"invalid_value":return l.values.length===1?`UngÃ¼ltige Eingabe: erwartet ${vn(l.values[0])}`:`UngÃ¼ltige Option: erwartet eine von ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Zu groÃŸ: erwartet, dass ${l.origin??"Wert"} ${f}${l.maximum.toString()} ${x.unit??"Elemente"} hat`:`Zu groÃŸ: erwartet, dass ${l.origin??"Wert"} ${f}${l.maximum.toString()} ist`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Zu klein: erwartet, dass ${l.origin} ${f}${l.minimum.toString()} ${x.unit} hat`:`Zu klein: erwartet, dass ${l.origin} ${f}${l.minimum.toString()} ist`}case"invalid_format":{let f=l;return f.format==="starts_with"?`UngÃ¼ltiger String: muss mit "${f.prefix}" beginnen`:f.format==="ends_with"?`UngÃ¼ltiger String: muss mit "${f.suffix}" enden`:f.format==="includes"?`UngÃ¼ltiger String: muss "${f.includes}" enthalten`:f.format==="regex"?`UngÃ¼ltiger String: muss dem Muster ${f.pattern} entsprechen`:`UngÃ¼ltig: ${o[f.format]??l.format}`}case"not_multiple_of":return`UngÃ¼ltige Zahl: muss ein Vielfaches von ${l.divisor} sein`;case"unrecognized_keys":return`${l.keys.length>1?"Unbekannte SchlÃ¼ssel":"Unbekannter SchlÃ¼ssel"}: ${ai(l.keys,", ")}`;case"invalid_key":return`UngÃ¼ltiger SchlÃ¼ssel in ${l.origin}`;case"invalid_union":return"UngÃ¼ltige Eingabe";case"invalid_element":return`UngÃ¼ltiger Wert in ${l.origin}`;default:return"UngÃ¼ltige Eingabe"}}};function VW(){return{localeError:$W()}}var jW=()=>{let i={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"},map:{unit:"entries",verb:"to have"}};function e(l){return i[l]??null}let o={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return`Invalid input: expected ${f}, received ${s}`}case"invalid_value":return l.values.length===1?`Invalid input: expected ${vn(l.values[0])}`:`Invalid option: expected one of ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Too big: expected ${l.origin??"value"} to have ${f}${l.maximum.toString()} ${x.unit??"elements"}`:`Too big: expected ${l.origin??"value"} to be ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Too small: expected ${l.origin} to have ${f}${l.minimum.toString()} ${x.unit}`:`Too small: expected ${l.origin} to be ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Invalid string: must start with "${f.prefix}"`:f.format==="ends_with"?`Invalid string: must end with "${f.suffix}"`:f.format==="includes"?`Invalid string: must include "${f.includes}"`:f.format==="regex"?`Invalid string: must match pattern ${f.pattern}`:`Invalid ${o[f.format]??l.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${l.divisor}`;case"unrecognized_keys":return`Unrecognized key${l.keys.length>1?"s":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`Invalid key in ${l.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${l.origin}`;default:return"Invalid input"}}};function M3(){return{localeError:jW()}}var GW=()=>{let i={string:{unit:"karaktrojn",verb:"havi"},file:{unit:"bajtojn",verb:"havi"},array:{unit:"elementojn",verb:"havi"},set:{unit:"elementojn",verb:"havi"}};function e(l){return i[l]??null}let o={regex:"enigo",email:"retadreso",url:"URL",emoji:"emoÄio",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datotempo",date:"ISO-dato",time:"ISO-tempo",duration:"ISO-daÅ­ro",ipv4:"IPv4-adreso",ipv6:"IPv6-adreso",cidrv4:"IPv4-rango",cidrv6:"IPv6-rango",base64:"64-ume kodita karaktraro",base64url:"URL-64-ume kodita karaktraro",json_string:"JSON-karaktraro",e164:"E.164-nombro",jwt:"JWT",template_literal:"enigo"},h={nan:"NaN",number:"nombro",array:"tabelo",null:"senvalora"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Nevalida enigo: atendiÄis instanceof ${l.expected}, riceviÄis ${s}`:`Nevalida enigo: atendiÄis ${f}, riceviÄis ${s}`}case"invalid_value":return l.values.length===1?`Nevalida enigo: atendiÄis ${vn(l.values[0])}`:`Nevalida opcio: atendiÄis unu el ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Tro granda: atendiÄis ke ${l.origin??"valoro"} havu ${f}${l.maximum.toString()} ${x.unit??"elementojn"}`:`Tro granda: atendiÄis ke ${l.origin??"valoro"} havu ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Tro malgranda: atendiÄis ke ${l.origin} havu ${f}${l.minimum.toString()} ${x.unit}`:`Tro malgranda: atendiÄis ke ${l.origin} estu ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Nevalida karaktraro: devas komenciÄi per "${f.prefix}"`:f.format==="ends_with"?`Nevalida karaktraro: devas finiÄi per "${f.suffix}"`:f.format==="includes"?`Nevalida karaktraro: devas inkluzivi "${f.includes}"`:f.format==="regex"?`Nevalida karaktraro: devas kongrui kun la modelo ${f.pattern}`:`Nevalida ${o[f.format]??l.format}`}case"not_multiple_of":return`Nevalida nombro: devas esti oblo de ${l.divisor}`;case"unrecognized_keys":return`Nekonata${l.keys.length>1?"j":""} Ålosilo${l.keys.length>1?"j":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`Nevalida Ålosilo en ${l.origin}`;case"invalid_union":return"Nevalida enigo";case"invalid_element":return`Nevalida valoro en ${l.origin}`;default:return"Nevalida enigo"}}};function HW(){return{localeError:GW()}}var ZW=()=>{let i={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}};function e(l){return i[l]??null}let o={regex:"entrada",email:"direcciÃ³n de correo electrÃ³nico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duraciÃ³n ISO",ipv4:"direcciÃ³n IPv4",ipv6:"direcciÃ³n IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"nÃºmero E.164",jwt:"JWT",template_literal:"entrada"},h={nan:"NaN",string:"texto",number:"nÃºmero",boolean:"booleano",array:"arreglo",object:"objeto",set:"conjunto",file:"archivo",date:"fecha",bigint:"nÃºmero grande",symbol:"sÃ­mbolo",undefined:"indefinido",null:"nulo",function:"funciÃ³n",map:"mapa",record:"registro",tuple:"tupla",enum:"enumeraciÃ³n",union:"uniÃ³n",literal:"literal",promise:"promesa",void:"vacÃ­o",never:"nunca",unknown:"desconocido",any:"cualquiera"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Entrada invÃ¡lida: se esperaba instanceof ${l.expected}, recibido ${s}`:`Entrada invÃ¡lida: se esperaba ${f}, recibido ${s}`}case"invalid_value":return l.values.length===1?`Entrada invÃ¡lida: se esperaba ${vn(l.values[0])}`:`OpciÃ³n invÃ¡lida: se esperaba una de ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin),s=h[l.origin]??l.origin;return x?`Demasiado grande: se esperaba que ${s??"valor"} tuviera ${f}${l.maximum.toString()} ${x.unit??"elementos"}`:`Demasiado grande: se esperaba que ${s??"valor"} fuera ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin),s=h[l.origin]??l.origin;return x?`Demasiado pequeÃ±o: se esperaba que ${s} tuviera ${f}${l.minimum.toString()} ${x.unit}`:`Demasiado pequeÃ±o: se esperaba que ${s} fuera ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Cadena invÃ¡lida: debe comenzar con "${f.prefix}"`:f.format==="ends_with"?`Cadena invÃ¡lida: debe terminar en "${f.suffix}"`:f.format==="includes"?`Cadena invÃ¡lida: debe incluir "${f.includes}"`:f.format==="regex"?`Cadena invÃ¡lida: debe coincidir con el patrÃ³n ${f.pattern}`:`InvÃ¡lido ${o[f.format]??l.format}`}case"not_multiple_of":return`NÃºmero invÃ¡lido: debe ser mÃºltiplo de ${l.divisor}`;case"unrecognized_keys":return`Llave${l.keys.length>1?"s":""} desconocida${l.keys.length>1?"s":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`Llave invÃ¡lida en ${h[l.origin]??l.origin}`;case"invalid_union":return"Entrada invÃ¡lida";case"invalid_element":return`Valor invÃ¡lido en ${h[l.origin]??l.origin}`;default:return"Entrada invÃ¡lida"}}};function WW(){return{localeError:ZW()}}var qW=()=>{let i={string:{unit:"Ú©Ø§Ø±Ø§Ú©ØªØ±",verb:"Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯"},file:{unit:"Ø¨Ø§ÛŒØª",verb:"Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯"},array:{unit:"Ø¢ÛŒØªÙ…",verb:"Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯"},set:{unit:"Ø¢ÛŒØªÙ…",verb:"Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯"}};function e(l){return i[l]??null}let o={regex:"ÙˆØ±ÙˆØ¯ÛŒ",email:"Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„",url:"URL",emoji:"Ø§ÛŒÙ…ÙˆØ¬ÛŒ",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† Ø§ÛŒØ²Ùˆ",date:"ØªØ§Ø±ÛŒØ® Ø§ÛŒØ²Ùˆ",time:"Ø²Ù…Ø§Ù† Ø§ÛŒØ²Ùˆ",duration:"Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø§ÛŒØ²Ùˆ",ipv4:"IPv4 Ø¢Ø¯Ø±Ø³",ipv6:"IPv6 Ø¢Ø¯Ø±Ø³",cidrv4:"IPv4 Ø¯Ø§Ù…Ù†Ù‡",cidrv6:"IPv6 Ø¯Ø§Ù…Ù†Ù‡",base64:"base64-encoded Ø±Ø´ØªÙ‡",base64url:"base64url-encoded Ø±Ø´ØªÙ‡",json_string:"JSON Ø±Ø´ØªÙ‡",e164:"E.164 Ø¹Ø¯Ø¯",jwt:"JWT",template_literal:"ÙˆØ±ÙˆØ¯ÛŒ"},h={nan:"NaN",number:"Ø¹Ø¯Ø¯",array:"Ø¢Ø±Ø§ÛŒÙ‡"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ù…ÛŒâ€ŒØ¨Ø§ÛŒØ³Øª instanceof ${l.expected} Ù…ÛŒâ€ŒØ¨ÙˆØ¯ØŒ ${s} Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯`:`ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ù…ÛŒâ€ŒØ¨Ø§ÛŒØ³Øª ${f} Ù…ÛŒâ€ŒØ¨ÙˆØ¯ØŒ ${s} Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯`}case"invalid_value":return l.values.length===1?`ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ù…ÛŒâ€ŒØ¨Ø§ÛŒØ³Øª ${vn(l.values[0])} Ù…ÛŒâ€ŒØ¨ÙˆØ¯`:`Ú¯Ø²ÛŒÙ†Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ù…ÛŒâ€ŒØ¨Ø§ÛŒØ³Øª ÛŒÚ©ÛŒ Ø§Ø² ${ai(l.values,"|")} Ù…ÛŒâ€ŒØ¨ÙˆØ¯`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ø®ÛŒÙ„ÛŒ Ø¨Ø²Ø±Ú¯: ${l.origin??"Ù…Ù‚Ø¯Ø§Ø±"} Ø¨Ø§ÛŒØ¯ ${f}${l.maximum.toString()} ${x.unit??"Ø¹Ù†ØµØ±"} Ø¨Ø§Ø´Ø¯`:`Ø®ÛŒÙ„ÛŒ Ø¨Ø²Ø±Ú¯: ${l.origin??"Ù…Ù‚Ø¯Ø§Ø±"} Ø¨Ø§ÛŒØ¯ ${f}${l.maximum.toString()} Ø¨Ø§Ø´Ø¯`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú©: ${l.origin} Ø¨Ø§ÛŒØ¯ ${f}${l.minimum.toString()} ${x.unit} Ø¨Ø§Ø´Ø¯`:`Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú©: ${l.origin} Ø¨Ø§ÛŒØ¯ ${f}${l.minimum.toString()} Ø¨Ø§Ø´Ø¯`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Ø±Ø´ØªÙ‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ø¨Ø§ "${f.prefix}" Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯`:f.format==="ends_with"?`Ø±Ø´ØªÙ‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ø¨Ø§ "${f.suffix}" ØªÙ…Ø§Ù… Ø´ÙˆØ¯`:f.format==="includes"?`Ø±Ø´ØªÙ‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ "${f.includes}" Ø¨Ø§Ø´Ø¯`:f.format==="regex"?`Ø±Ø´ØªÙ‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø§Ù„Ú¯ÙˆÛŒ ${f.pattern} Ù…Ø·Ø§Ø¨Ù‚Øª Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯`:`${o[f.format]??l.format} Ù†Ø§Ù…Ø¹ØªØ¨Ø±`}case"not_multiple_of":return`Ø¹Ø¯Ø¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ù…Ø¶Ø±Ø¨ ${l.divisor} Ø¨Ø§Ø´Ø¯`;case"unrecognized_keys":return`Ú©Ù„ÛŒØ¯${l.keys.length>1?"Ù‡Ø§ÛŒ":""} Ù†Ø§Ø´Ù†Ø§Ø³: ${ai(l.keys,", ")}`;case"invalid_key":return`Ú©Ù„ÛŒØ¯ Ù†Ø§Ø´Ù†Ø§Ø³ Ø¯Ø± ${l.origin}`;case"invalid_union":return"ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±";case"invalid_element":return`Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¯Ø± ${l.origin}`;default:return"ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±"}}};function XW(){return{localeError:qW()}}var JW=()=>{let i={string:{unit:"merkkiÃ¤",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"pÃ¤ivÃ¤mÃ¤Ã¤rÃ¤n"}};function e(l){return i[l]??null}let o={regex:"sÃ¤Ã¤nnÃ¶llinen lauseke",email:"sÃ¤hkÃ¶postiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-pÃ¤ivÃ¤mÃ¤Ã¤rÃ¤",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Virheellinen tyyppi: odotettiin instanceof ${l.expected}, oli ${s}`:`Virheellinen tyyppi: odotettiin ${f}, oli ${s}`}case"invalid_value":return l.values.length===1?`Virheellinen syÃ¶te: tÃ¤ytyy olla ${vn(l.values[0])}`:`Virheellinen valinta: tÃ¤ytyy olla yksi seuraavista: ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Liian suuri: ${x.subject} tÃ¤ytyy olla ${f}${l.maximum.toString()} ${x.unit}`.trim():`Liian suuri: arvon tÃ¤ytyy olla ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Liian pieni: ${x.subject} tÃ¤ytyy olla ${f}${l.minimum.toString()} ${x.unit}`.trim():`Liian pieni: arvon tÃ¤ytyy olla ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Virheellinen syÃ¶te: tÃ¤ytyy alkaa "${f.prefix}"`:f.format==="ends_with"?`Virheellinen syÃ¶te: tÃ¤ytyy loppua "${f.suffix}"`:f.format==="includes"?`Virheellinen syÃ¶te: tÃ¤ytyy sisÃ¤ltÃ¤Ã¤ "${f.includes}"`:f.format==="regex"?`Virheellinen syÃ¶te: tÃ¤ytyy vastata sÃ¤Ã¤nnÃ¶llistÃ¤ lauseketta ${f.pattern}`:`Virheellinen ${o[f.format]??l.format}`}case"not_multiple_of":return`Virheellinen luku: tÃ¤ytyy olla luvun ${l.divisor} monikerta`;case"unrecognized_keys":return`${l.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${ai(l.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return"Virheellinen syÃ¶te"}}};function YW(){return{localeError:JW()}}var KW=()=>{let i={string:{unit:"caractÃ¨res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"Ã©lÃ©ments",verb:"avoir"},set:{unit:"Ã©lÃ©ments",verb:"avoir"}};function e(l){return i[l]??null}let o={regex:"entrÃ©e",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"durÃ©e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chaÃ®ne encodÃ©e en base64",base64url:"chaÃ®ne encodÃ©e en base64url",json_string:"chaÃ®ne JSON",e164:"numÃ©ro E.164",jwt:"JWT",template_literal:"entrÃ©e"},h={nan:"NaN",number:"nombre",array:"tableau"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`EntrÃ©e invalide : instanceof ${l.expected} attendu, ${s} reÃ§u`:`EntrÃ©e invalide : ${f} attendu, ${s} reÃ§u`}case"invalid_value":return l.values.length===1?`EntrÃ©e invalide : ${vn(l.values[0])} attendu`:`Option invalide : une valeur parmi ${ai(l.values,"|")} attendue`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Trop grand : ${l.origin??"valeur"} doit ${x.verb} ${f}${l.maximum.toString()} ${x.unit??"Ã©lÃ©ment(s)"}`:`Trop grand : ${l.origin??"valeur"} doit Ãªtre ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Trop petit : ${l.origin} doit ${x.verb} ${f}${l.minimum.toString()} ${x.unit}`:`Trop petit : ${l.origin} doit Ãªtre ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ChaÃ®ne invalide : doit commencer par "${f.prefix}"`:f.format==="ends_with"?`ChaÃ®ne invalide : doit se terminer par "${f.suffix}"`:f.format==="includes"?`ChaÃ®ne invalide : doit inclure "${f.includes}"`:f.format==="regex"?`ChaÃ®ne invalide : doit correspondre au modÃ¨le ${f.pattern}`:`${o[f.format]??l.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit Ãªtre un multiple de ${l.divisor}`;case"unrecognized_keys":return`ClÃ©${l.keys.length>1?"s":""} non reconnue${l.keys.length>1?"s":""} : ${ai(l.keys,", ")}`;case"invalid_key":return`ClÃ© invalide dans ${l.origin}`;case"invalid_union":return"EntrÃ©e invalide";case"invalid_element":return`Valeur invalide dans ${l.origin}`;default:return"EntrÃ©e invalide"}}};function QW(){return{localeError:KW()}}var eq=()=>{let i={string:{unit:"caractÃ¨res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"Ã©lÃ©ments",verb:"avoir"},set:{unit:"Ã©lÃ©ments",verb:"avoir"}};function e(l){return i[l]??null}let o={regex:"entrÃ©e",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"durÃ©e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chaÃ®ne encodÃ©e en base64",base64url:"chaÃ®ne encodÃ©e en base64url",json_string:"chaÃ®ne JSON",e164:"numÃ©ro E.164",jwt:"JWT",template_literal:"entrÃ©e"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`EntrÃ©e invalide : attendu instanceof ${l.expected}, reÃ§u ${s}`:`EntrÃ©e invalide : attendu ${f}, reÃ§u ${s}`}case"invalid_value":return l.values.length===1?`EntrÃ©e invalide : attendu ${vn(l.values[0])}`:`Option invalide : attendu l'une des valeurs suivantes ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"â‰¤":"<",x=e(l.origin);return x?`Trop grand : attendu que ${l.origin??"la valeur"} ait ${f}${l.maximum.toString()} ${x.unit}`:`Trop grand : attendu que ${l.origin??"la valeur"} soit ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?"â‰¥":">",x=e(l.origin);return x?`Trop petit : attendu que ${l.origin} ait ${f}${l.minimum.toString()} ${x.unit}`:`Trop petit : attendu que ${l.origin} soit ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ChaÃ®ne invalide : doit commencer par "${f.prefix}"`:f.format==="ends_with"?`ChaÃ®ne invalide : doit se terminer par "${f.suffix}"`:f.format==="includes"?`ChaÃ®ne invalide : doit inclure "${f.includes}"`:f.format==="regex"?`ChaÃ®ne invalide : doit correspondre au motif ${f.pattern}`:`${o[f.format]??l.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit Ãªtre un multiple de ${l.divisor}`;case"unrecognized_keys":return`ClÃ©${l.keys.length>1?"s":""} non reconnue${l.keys.length>1?"s":""} : ${ai(l.keys,", ")}`;case"invalid_key":return`ClÃ© invalide dans ${l.origin}`;case"invalid_union":return"EntrÃ©e invalide";case"invalid_element":return`Valeur invalide dans ${l.origin}`;default:return"EntrÃ©e invalide"}}};function tq(){return{localeError:eq()}}var iq=()=>{let i={string:{label:"×ž×—×¨×•×–×ª",gender:"f"},number:{label:"×ž×¡×¤×¨",gender:"m"},boolean:{label:"×¢×¨×š ×‘×•×œ×™×× ×™",gender:"m"},bigint:{label:"BigInt",gender:"m"},date:{label:"×ª××¨×™×š",gender:"m"},array:{label:"×ž×¢×¨×š",gender:"m"},object:{label:"××•×‘×™×™×§×˜",gender:"m"},null:{label:"×¢×¨×š ×¨×™×§ (null)",gender:"m"},undefined:{label:"×¢×¨×š ×œ× ×ž×•×’×“×¨ (undefined)",gender:"m"},symbol:{label:"×¡×™×ž×‘×•×œ (Symbol)",gender:"m"},function:{label:"×¤×•× ×§×¦×™×”",gender:"f"},map:{label:"×ž×¤×” (Map)",gender:"f"},set:{label:"×§×‘×•×¦×” (Set)",gender:"f"},file:{label:"×§×•×‘×¥",gender:"m"},promise:{label:"Promise",gender:"m"},NaN:{label:"NaN",gender:"m"},unknown:{label:"×¢×¨×š ×œ× ×™×“×•×¢",gender:"m"},value:{label:"×¢×¨×š",gender:"m"}},e={string:{unit:"×ª×•×•×™×",shortLabel:"×§×¦×¨",longLabel:"××¨×•×š"},file:{unit:"×‘×™×™×˜×™×",shortLabel:"×§×˜×Ÿ",longLabel:"×’×“×•×œ"},array:{unit:"×¤×¨×™×˜×™×",shortLabel:"×§×˜×Ÿ",longLabel:"×’×“×•×œ"},set:{unit:"×¤×¨×™×˜×™×",shortLabel:"×§×˜×Ÿ",longLabel:"×’×“×•×œ"},number:{unit:"",shortLabel:"×§×˜×Ÿ",longLabel:"×’×“×•×œ"}},o=C=>C?i[C]:void 0,h=C=>{let O=o(C);return O?O.label:C??i.unknown.label},l=C=>`×”${h(C)}`,f=C=>{var O;return(((O=o(C))==null?void 0:O.gender)??"m")==="f"?"×¦×¨×™×›×” ×œ×”×™×•×ª":"×¦×¨×™×š ×œ×”×™×•×ª"},x=C=>C?e[C]??null:null,s={regex:{label:"×§×œ×˜",gender:"m"},email:{label:"×›×ª×•×‘×ª ××™×ž×™×™×œ",gender:"f"},url:{label:"×›×ª×•×‘×ª ×¨×©×ª",gender:"f"},emoji:{label:"××™×ž×•×’'×™",gender:"m"},uuid:{label:"UUID",gender:"m"},nanoid:{label:"nanoid",gender:"m"},guid:{label:"GUID",gender:"m"},cuid:{label:"cuid",gender:"m"},cuid2:{label:"cuid2",gender:"m"},ulid:{label:"ULID",gender:"m"},xid:{label:"XID",gender:"m"},ksuid:{label:"KSUID",gender:"m"},datetime:{label:"×ª××¨×™×š ×•×–×ž×Ÿ ISO",gender:"m"},date:{label:"×ª××¨×™×š ISO",gender:"m"},time:{label:"×–×ž×Ÿ ISO",gender:"m"},duration:{label:"×ž×©×š ×–×ž×Ÿ ISO",gender:"m"},ipv4:{label:"×›×ª×•×‘×ª IPv4",gender:"f"},ipv6:{label:"×›×ª×•×‘×ª IPv6",gender:"f"},cidrv4:{label:"×˜×•×•×— IPv4",gender:"m"},cidrv6:{label:"×˜×•×•×— IPv6",gender:"m"},base64:{label:"×ž×—×¨×•×–×ª ×‘×‘×¡×™×¡ 64",gender:"f"},base64url:{label:"×ž×—×¨×•×–×ª ×‘×‘×¡×™×¡ 64 ×œ×›×ª×•×‘×•×ª ×¨×©×ª",gender:"f"},json_string:{label:"×ž×—×¨×•×–×ª JSON",gender:"f"},e164:{label:"×ž×¡×¤×¨ E.164",gender:"m"},jwt:{label:"JWT",gender:"m"},ends_with:{label:"×§×œ×˜",gender:"m"},includes:{label:"×§×œ×˜",gender:"m"},lowercase:{label:"×§×œ×˜",gender:"m"},starts_with:{label:"×§×œ×˜",gender:"m"},uppercase:{label:"×§×œ×˜",gender:"m"}},P={nan:"NaN"};return C=>{var O;switch(C.code){case"invalid_type":{let F=C.expected,V=P[F??""]??h(F),q=Sn(C.input),ee=P[q]??((O=i[q])==null?void 0:O.label)??q;return/^[A-Z]/.test(C.expected)?`×§×œ×˜ ×œ× ×ª×§×™×Ÿ: ×¦×¨×™×š ×œ×”×™×•×ª instanceof ${C.expected}, ×”×ª×§×‘×œ ${ee}`:`×§×œ×˜ ×œ× ×ª×§×™×Ÿ: ×¦×¨×™×š ×œ×”×™×•×ª ${V}, ×”×ª×§×‘×œ ${ee}`}case"invalid_value":{if(C.values.length===1)return`×¢×¨×š ×œ× ×ª×§×™×Ÿ: ×”×¢×¨×š ×—×™×™×‘ ×œ×”×™×•×ª ${vn(C.values[0])}`;let F=C.values.map(q=>vn(q));if(C.values.length===2)return`×¢×¨×š ×œ× ×ª×§×™×Ÿ: ×”××¤×©×¨×•×™×•×ª ×”×ž×ª××™×ž×•×ª ×”×Ÿ ${F[0]} ××• ${F[1]}`;let V=F[F.length-1];return`×¢×¨×š ×œ× ×ª×§×™×Ÿ: ×”××¤×©×¨×•×™×•×ª ×”×ž×ª××™×ž×•×ª ×”×Ÿ ${F.slice(0,-1).join(", ")} ××• ${V}`}case"too_big":{let F=x(C.origin),V=l(C.origin??"value");if(C.origin==="string")return`${(F==null?void 0:F.longLabel)??"××¨×•×š"} ×ž×“×™: ${V} ×¦×¨×™×›×” ×œ×”×›×™×œ ${C.maximum.toString()} ${(F==null?void 0:F.unit)??""} ${C.inclusive?"××• ×¤×—×•×ª":"×œ×›×œ ×”×™×•×ª×¨"}`.trim();if(C.origin==="number"){let se=C.inclusive?`×§×˜×Ÿ ××• ×©×•×•×” ×œ-${C.maximum}`:`×§×˜×Ÿ ×ž-${C.maximum}`;return`×’×“×•×œ ×ž×“×™: ${V} ×¦×¨×™×š ×œ×”×™×•×ª ${se}`}if(C.origin==="array"||C.origin==="set"){let se=C.origin==="set"?"×¦×¨×™×›×”":"×¦×¨×™×š",fe=C.inclusive?`${C.maximum} ${(F==null?void 0:F.unit)??""} ××• ×¤×—×•×ª`:`×¤×—×•×ª ×ž-${C.maximum} ${(F==null?void 0:F.unit)??""}`;return`×’×“×•×œ ×ž×“×™: ${V} ${se} ×œ×”×›×™×œ ${fe}`.trim()}let q=C.inclusive?"<=":"<",ee=f(C.origin??"value");return F!=null&&F.unit?`${F.longLabel} ×ž×“×™: ${V} ${ee} ${q}${C.maximum.toString()} ${F.unit}`:`${(F==null?void 0:F.longLabel)??"×’×“×•×œ"} ×ž×“×™: ${V} ${ee} ${q}${C.maximum.toString()}`}case"too_small":{let F=x(C.origin),V=l(C.origin??"value");if(C.origin==="string")return`${(F==null?void 0:F.shortLabel)??"×§×¦×¨"} ×ž×“×™: ${V} ×¦×¨×™×›×” ×œ×”×›×™×œ ${C.minimum.toString()} ${(F==null?void 0:F.unit)??""} ${C.inclusive?"××• ×™×•×ª×¨":"×œ×¤×—×•×ª"}`.trim();if(C.origin==="number"){let se=C.inclusive?`×’×“×•×œ ××• ×©×•×•×” ×œ-${C.minimum}`:`×’×“×•×œ ×ž-${C.minimum}`;return`×§×˜×Ÿ ×ž×“×™: ${V} ×¦×¨×™×š ×œ×”×™×•×ª ${se}`}if(C.origin==="array"||C.origin==="set"){let se=C.origin==="set"?"×¦×¨×™×›×”":"×¦×¨×™×š";if(C.minimum===1&&C.inclusive){let ae=(C.origin==="set","×œ×¤×—×•×ª ×¤×¨×™×˜ ××—×“");return`×§×˜×Ÿ ×ž×“×™: ${V} ${se} ×œ×”×›×™×œ ${ae}`}let fe=C.inclusive?`${C.minimum} ${(F==null?void 0:F.unit)??""} ××• ×™×•×ª×¨`:`×™×•×ª×¨ ×ž-${C.minimum} ${(F==null?void 0:F.unit)??""}`;return`×§×˜×Ÿ ×ž×“×™: ${V} ${se} ×œ×”×›×™×œ ${fe}`.trim()}let q=C.inclusive?">=":">",ee=f(C.origin??"value");return F!=null&&F.unit?`${F.shortLabel} ×ž×“×™: ${V} ${ee} ${q}${C.minimum.toString()} ${F.unit}`:`${(F==null?void 0:F.shortLabel)??"×§×˜×Ÿ"} ×ž×“×™: ${V} ${ee} ${q}${C.minimum.toString()}`}case"invalid_format":{let F=C;if(F.format==="starts_with")return`×”×ž×—×¨×•×–×ª ×—×™×™×‘×ª ×œ×”×ª×—×™×œ ×‘ "${F.prefix}"`;if(F.format==="ends_with")return`×”×ž×—×¨×•×–×ª ×—×™×™×‘×ª ×œ×”×¡×ª×™×™× ×‘ "${F.suffix}"`;if(F.format==="includes")return`×”×ž×—×¨×•×–×ª ×—×™×™×‘×ª ×œ×›×œ×•×œ "${F.includes}"`;if(F.format==="regex")return`×”×ž×—×¨×•×–×ª ×—×™×™×‘×ª ×œ×”×ª××™× ×œ×ª×‘× ×™×ª ${F.pattern}`;let V=s[F.format],q=(V==null?void 0:V.label)??F.format,ee=((V==null?void 0:V.gender)??"m")==="f"?"×ª×§×™× ×”":"×ª×§×™×Ÿ";return`${q} ×œ× ${ee}`}case"not_multiple_of":return`×ž×¡×¤×¨ ×œ× ×ª×§×™×Ÿ: ×—×™×™×‘ ×œ×”×™×•×ª ×ž×›×¤×œ×” ×©×œ ${C.divisor}`;case"unrecognized_keys":return`×ž×¤×ª×—${C.keys.length>1?"×•×ª":""} ×œ× ×ž×–×•×”${C.keys.length>1?"×™×":"×”"}: ${ai(C.keys,", ")}`;case"invalid_key":return"×©×“×” ×œ× ×ª×§×™×Ÿ ×‘××•×‘×™×™×§×˜";case"invalid_union":return"×§×œ×˜ ×œ× ×ª×§×™×Ÿ";case"invalid_element":return`×¢×¨×š ×œ× ×ª×§×™×Ÿ ×‘${l(C.origin??"array")}`;default:return"×§×œ×˜ ×œ× ×ª×§×™×Ÿ"}}};function nq(){return{localeError:iq()}}var rq=()=>{let i={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}};function e(l){return i[l]??null}let o={regex:"bemenet",email:"email cÃ­m",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO idÅ‘bÃ©lyeg",date:"ISO dÃ¡tum",time:"ISO idÅ‘",duration:"ISO idÅ‘intervallum",ipv4:"IPv4 cÃ­m",ipv6:"IPv6 cÃ­m",cidrv4:"IPv4 tartomÃ¡ny",cidrv6:"IPv6 tartomÃ¡ny",base64:"base64-kÃ³dolt string",base64url:"base64url-kÃ³dolt string",json_string:"JSON string",e164:"E.164 szÃ¡m",jwt:"JWT",template_literal:"bemenet"},h={nan:"NaN",number:"szÃ¡m",array:"tÃ¶mb"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ã‰rvÃ©nytelen bemenet: a vÃ¡rt Ã©rtÃ©k instanceof ${l.expected}, a kapott Ã©rtÃ©k ${s}`:`Ã‰rvÃ©nytelen bemenet: a vÃ¡rt Ã©rtÃ©k ${f}, a kapott Ã©rtÃ©k ${s}`}case"invalid_value":return l.values.length===1?`Ã‰rvÃ©nytelen bemenet: a vÃ¡rt Ã©rtÃ©k ${vn(l.values[0])}`:`Ã‰rvÃ©nytelen opciÃ³: valamelyik Ã©rtÃ©k vÃ¡rt ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`TÃºl nagy: ${l.origin??"Ã©rtÃ©k"} mÃ©rete tÃºl nagy ${f}${l.maximum.toString()} ${x.unit??"elem"}`:`TÃºl nagy: a bemeneti Ã©rtÃ©k ${l.origin??"Ã©rtÃ©k"} tÃºl nagy: ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`TÃºl kicsi: a bemeneti Ã©rtÃ©k ${l.origin} mÃ©rete tÃºl kicsi ${f}${l.minimum.toString()} ${x.unit}`:`TÃºl kicsi: a bemeneti Ã©rtÃ©k ${l.origin} tÃºl kicsi ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Ã‰rvÃ©nytelen string: "${f.prefix}" Ã©rtÃ©kkel kell kezdÅ‘dnie`:f.format==="ends_with"?`Ã‰rvÃ©nytelen string: "${f.suffix}" Ã©rtÃ©kkel kell vÃ©gzÅ‘dnie`:f.format==="includes"?`Ã‰rvÃ©nytelen string: "${f.includes}" Ã©rtÃ©ket kell tartalmaznia`:f.format==="regex"?`Ã‰rvÃ©nytelen string: ${f.pattern} mintÃ¡nak kell megfelelnie`:`Ã‰rvÃ©nytelen ${o[f.format]??l.format}`}case"not_multiple_of":return`Ã‰rvÃ©nytelen szÃ¡m: ${l.divisor} tÃ¶bbszÃ¶rÃ¶sÃ©nek kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${l.keys.length>1?"s":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`Ã‰rvÃ©nytelen kulcs ${l.origin}`;case"invalid_union":return"Ã‰rvÃ©nytelen bemenet";case"invalid_element":return`Ã‰rvÃ©nytelen Ã©rtÃ©k: ${l.origin}`;default:return"Ã‰rvÃ©nytelen bemenet"}}};function oq(){return{localeError:rq()}}function wC(i,e,o){return Math.abs(i)===1?e:o}function Nf(i){if(!i)return"";let e=["Õ¡","Õ¥","Õ¨","Õ«","Õ¸","Õ¸Ö‚","Ö…"],o=i[i.length-1];return i+(e.includes(o)?"Õ¶":"Õ¨")}var sq=()=>{let i={string:{unit:{one:"Õ¶Õ·Õ¡Õ¶",many:"Õ¶Õ·Õ¡Õ¶Õ¶Õ¥Ö€"},verb:"Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡Õ¬"},file:{unit:{one:"Õ¢Õ¡ÕµÕ©",many:"Õ¢Õ¡ÕµÕ©Õ¥Ö€"},verb:"Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡Õ¬"},array:{unit:{one:"Õ¿Õ¡Ö€Ö€",many:"Õ¿Õ¡Ö€Ö€Õ¥Ö€"},verb:"Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡Õ¬"},set:{unit:{one:"Õ¿Õ¡Ö€Ö€",many:"Õ¿Õ¡Ö€Ö€Õ¥Ö€"},verb:"Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡Õ¬"}};function e(l){return i[l]??null}let o={regex:"Õ´Õ¸Ö‚Õ¿Ö„",email:"Õ§Õ¬. Õ°Õ¡Õ½ÖÕ¥",url:"URL",emoji:"Õ§Õ´Õ¸Õ»Õ«",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Õ¡Õ´Õ½Õ¡Õ©Õ«Õ¾ Ö‡ ÕªÕ¡Õ´",date:"ISO Õ¡Õ´Õ½Õ¡Õ©Õ«Õ¾",time:"ISO ÕªÕ¡Õ´",duration:"ISO Õ¿Ö‡Õ¸Õ²Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶",ipv4:"IPv4 Õ°Õ¡Õ½ÖÕ¥",ipv6:"IPv6 Õ°Õ¡Õ½ÖÕ¥",cidrv4:"IPv4 Õ´Õ«Õ»Õ¡Õ¯Õ¡ÕµÖ„",cidrv6:"IPv6 Õ´Õ«Õ»Õ¡Õ¯Õ¡ÕµÖ„",base64:"base64 Õ±Ö‡Õ¡Õ¹Õ¡ÖƒÕ¸Õ¾ Õ¿Õ¸Õ²",base64url:"base64url Õ±Ö‡Õ¡Õ¹Õ¡ÖƒÕ¸Õ¾ Õ¿Õ¸Õ²",json_string:"JSON Õ¿Õ¸Õ²",e164:"E.164 Õ°Õ¡Õ´Õ¡Ö€",jwt:"JWT",template_literal:"Õ´Õ¸Ö‚Õ¿Ö„"},h={nan:"NaN",number:"Õ©Õ«Õ¾",array:"Õ¦Õ¡Õ¶Õ£Õ¾Õ¡Õ®"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§Ö€ instanceof ${l.expected}, Õ½Õ¿Õ¡ÖÕ¾Õ¥Õ¬ Õ§ ${s}`:`ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§Ö€ ${f}, Õ½Õ¿Õ¡ÖÕ¾Õ¥Õ¬ Õ§ ${s}`}case"invalid_value":return l.values.length===1?`ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§Ö€ ${vn(l.values[1])}`:`ÕÕ­Õ¡Õ¬ Õ¿Õ¡Ö€Õ¢Õ¥Ö€Õ¡Õ¯â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§Ö€ Õ°Õ¥Õ¿Ö‡ÕµÕ¡Õ¬Õ¶Õ¥Ö€Õ«Ö Õ´Õ¥Õ¯Õ¨Õ ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);if(x){let s=Number(l.maximum),P=wC(s,x.unit.one,x.unit.many);return`Õ‰Õ¡ÖƒÕ¡Õ¦Õ¡Õ¶Ö Õ´Õ¥Õ® Õ¡Ö€ÕªÕ¥Ö„â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§, Õ¸Ö€ ${Nf(l.origin??"Õ¡Ö€ÕªÕ¥Ö„")} Õ¯Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡ ${f}${l.maximum.toString()} ${P}`}return`Õ‰Õ¡ÖƒÕ¡Õ¦Õ¡Õ¶Ö Õ´Õ¥Õ® Õ¡Ö€ÕªÕ¥Ö„â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§, Õ¸Ö€ ${Nf(l.origin??"Õ¡Ö€ÕªÕ¥Ö„")} Õ¬Õ«Õ¶Õ« ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);if(x){let s=Number(l.minimum),P=wC(s,x.unit.one,x.unit.many);return`Õ‰Õ¡ÖƒÕ¡Õ¦Õ¡Õ¶Ö ÖƒÕ¸Ö„Ö€ Õ¡Ö€ÕªÕ¥Ö„â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§, Õ¸Ö€ ${Nf(l.origin)} Õ¯Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡ ${f}${l.minimum.toString()} ${P}`}return`Õ‰Õ¡ÖƒÕ¡Õ¦Õ¡Õ¶Ö ÖƒÕ¸Ö„Ö€ Õ¡Ö€ÕªÕ¥Ö„â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§, Õ¸Ö€ ${Nf(l.origin)} Õ¬Õ«Õ¶Õ« ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ÕÕ­Õ¡Õ¬ Õ¿Õ¸Õ²â€¤ ÕºÕ¥Õ¿Ö„ Õ§ Õ½Õ¯Õ½Õ¾Õ« "${f.prefix}"-Õ¸Õ¾`:f.format==="ends_with"?`ÕÕ­Õ¡Õ¬ Õ¿Õ¸Õ²â€¤ ÕºÕ¥Õ¿Ö„ Õ§ Õ¡Õ¾Õ¡Ö€Õ¿Õ¾Õ« "${f.suffix}"-Õ¸Õ¾`:f.format==="includes"?`ÕÕ­Õ¡Õ¬ Õ¿Õ¸Õ²â€¤ ÕºÕ¥Õ¿Ö„ Õ§ ÕºÕ¡Ö€Õ¸Ö‚Õ¶Õ¡Õ¯Õ« "${f.includes}"`:f.format==="regex"?`ÕÕ­Õ¡Õ¬ Õ¿Õ¸Õ²â€¤ ÕºÕ¥Õ¿Ö„ Õ§ Õ°Õ¡Õ´Õ¡ÕºÕ¡Õ¿Õ¡Õ½Õ­Õ¡Õ¶Õ« ${f.pattern} Õ±Ö‡Õ¡Õ¹Õ¡ÖƒÕ«Õ¶`:`ÕÕ­Õ¡Õ¬ ${o[f.format]??l.format}`}case"not_multiple_of":return`ÕÕ­Õ¡Õ¬ Õ©Õ«Õ¾â€¤ ÕºÕ¥Õ¿Ö„ Õ§ Õ¢Õ¡Õ¦Õ´Õ¡ÕºÕ¡Õ¿Õ«Õ¯ Õ¬Õ«Õ¶Õ« ${l.divisor}-Õ«`;case"unrecognized_keys":return`Õ‰Õ³Õ¡Õ¶Õ¡Õ¹Õ¾Õ¡Õ® Õ¢Õ¡Õ¶Õ¡Õ¬Õ«${l.keys.length>1?"Õ¶Õ¥Ö€":""}. ${ai(l.keys,", ")}`;case"invalid_key":return`ÕÕ­Õ¡Õ¬ Õ¢Õ¡Õ¶Õ¡Õ¬Õ« ${Nf(l.origin)}-Õ¸Ö‚Õ´`;case"invalid_union":return"ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´";case"invalid_element":return`ÕÕ­Õ¡Õ¬ Õ¡Ö€ÕªÕ¥Ö„ ${Nf(l.origin)}-Õ¸Ö‚Õ´`;default:return"ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´"}}};function aq(){return{localeError:sq()}}var lq=()=>{let i={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}};function e(l){return i[l]??null}let o={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Input tidak valid: diharapkan instanceof ${l.expected}, diterima ${s}`:`Input tidak valid: diharapkan ${f}, diterima ${s}`}case"invalid_value":return l.values.length===1?`Input tidak valid: diharapkan ${vn(l.values[0])}`:`Pilihan tidak valid: diharapkan salah satu dari ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Terlalu besar: diharapkan ${l.origin??"value"} memiliki ${f}${l.maximum.toString()} ${x.unit??"elemen"}`:`Terlalu besar: diharapkan ${l.origin??"value"} menjadi ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Terlalu kecil: diharapkan ${l.origin} memiliki ${f}${l.minimum.toString()} ${x.unit}`:`Terlalu kecil: diharapkan ${l.origin} menjadi ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`String tidak valid: harus dimulai dengan "${f.prefix}"`:f.format==="ends_with"?`String tidak valid: harus berakhir dengan "${f.suffix}"`:f.format==="includes"?`String tidak valid: harus menyertakan "${f.includes}"`:f.format==="regex"?`String tidak valid: harus sesuai pola ${f.pattern}`:`${o[f.format]??l.format} tidak valid`}case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${l.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${l.keys.length>1?"s":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${l.origin}`;case"invalid_union":return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${l.origin}`;default:return"Input tidak valid"}}};function cq(){return{localeError:lq()}}var uq=()=>{let i={string:{unit:"stafi",verb:"aÃ° hafa"},file:{unit:"bÃ¦ti",verb:"aÃ° hafa"},array:{unit:"hluti",verb:"aÃ° hafa"},set:{unit:"hluti",verb:"aÃ° hafa"}};function e(l){return i[l]??null}let o={regex:"gildi",email:"netfang",url:"vefslÃ³Ã°",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dagsetning og tÃ­mi",date:"ISO dagsetning",time:"ISO tÃ­mi",duration:"ISO tÃ­malengd",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded strengur",base64url:"base64url-encoded strengur",json_string:"JSON strengur",e164:"E.164 tÃ¶lugildi",jwt:"JWT",template_literal:"gildi"},h={nan:"NaN",number:"nÃºmer",array:"fylki"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Rangt gildi: ÃžÃº slÃ³st inn ${s} Ã¾ar sem Ã¡ aÃ° vera instanceof ${l.expected}`:`Rangt gildi: ÃžÃº slÃ³st inn ${s} Ã¾ar sem Ã¡ aÃ° vera ${f}`}case"invalid_value":return l.values.length===1?`Rangt gildi: gert rÃ¡Ã° fyrir ${vn(l.values[0])}`:`Ã“gilt val: mÃ¡ vera eitt af eftirfarandi ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Of stÃ³rt: gert er rÃ¡Ã° fyrir aÃ° ${l.origin??"gildi"} hafi ${f}${l.maximum.toString()} ${x.unit??"hluti"}`:`Of stÃ³rt: gert er rÃ¡Ã° fyrir aÃ° ${l.origin??"gildi"} sÃ© ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Of lÃ­tiÃ°: gert er rÃ¡Ã° fyrir aÃ° ${l.origin} hafi ${f}${l.minimum.toString()} ${x.unit}`:`Of lÃ­tiÃ°: gert er rÃ¡Ã° fyrir aÃ° ${l.origin} sÃ© ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Ã“gildur strengur: verÃ°ur aÃ° byrja Ã¡ "${f.prefix}"`:f.format==="ends_with"?`Ã“gildur strengur: verÃ°ur aÃ° enda Ã¡ "${f.suffix}"`:f.format==="includes"?`Ã“gildur strengur: verÃ°ur aÃ° innihalda "${f.includes}"`:f.format==="regex"?`Ã“gildur strengur: verÃ°ur aÃ° fylgja mynstri ${f.pattern}`:`Rangt ${o[f.format]??l.format}`}case"not_multiple_of":return`RÃ¶ng tala: verÃ°ur aÃ° vera margfeldi af ${l.divisor}`;case"unrecognized_keys":return`Ã“Ã¾ekkt ${l.keys.length>1?"ir lyklar":"ur lykill"}: ${ai(l.keys,", ")}`;case"invalid_key":return`Rangur lykill Ã­ ${l.origin}`;case"invalid_union":return"Rangt gildi";case"invalid_element":return`Rangt gildi Ã­ ${l.origin}`;default:return"Rangt gildi"}}};function hq(){return{localeError:uq()}}var dq=()=>{let i={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}};function e(l){return i[l]??null}let o={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"},h={nan:"NaN",number:"numero",array:"vettore"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Input non valido: atteso instanceof ${l.expected}, ricevuto ${s}`:`Input non valido: atteso ${f}, ricevuto ${s}`}case"invalid_value":return l.values.length===1?`Input non valido: atteso ${vn(l.values[0])}`:`Opzione non valida: atteso uno tra ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Troppo grande: ${l.origin??"valore"} deve avere ${f}${l.maximum.toString()} ${x.unit??"elementi"}`:`Troppo grande: ${l.origin??"valore"} deve essere ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Troppo piccolo: ${l.origin} deve avere ${f}${l.minimum.toString()} ${x.unit}`:`Troppo piccolo: ${l.origin} deve essere ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Stringa non valida: deve iniziare con "${f.prefix}"`:f.format==="ends_with"?`Stringa non valida: deve terminare con "${f.suffix}"`:f.format==="includes"?`Stringa non valida: deve includere "${f.includes}"`:f.format==="regex"?`Stringa non valida: deve corrispondere al pattern ${f.pattern}`:`Invalid ${o[f.format]??l.format}`}case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${l.divisor}`;case"unrecognized_keys":return`Chiav${l.keys.length>1?"i":"e"} non riconosciut${l.keys.length>1?"e":"a"}: ${ai(l.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${l.origin}`;case"invalid_union":return"Input non valido";case"invalid_element":return`Valore non valido in ${l.origin}`;default:return"Input non valido"}}};function fq(){return{localeError:dq()}}var pq=()=>{let i={string:{unit:"æ–‡å­—",verb:"ã§ã‚ã‚‹"},file:{unit:"ãƒã‚¤ãƒˆ",verb:"ã§ã‚ã‚‹"},array:{unit:"è¦ç´ ",verb:"ã§ã‚ã‚‹"},set:{unit:"è¦ç´ ",verb:"ã§ã‚ã‚‹"}};function e(l){return i[l]??null}let o={regex:"å…¥åŠ›å€¤",email:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",url:"URL",emoji:"çµµæ–‡å­—",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISOæ—¥æ™‚",date:"ISOæ—¥ä»˜",time:"ISOæ™‚åˆ»",duration:"ISOæœŸé–“",ipv4:"IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹",ipv6:"IPv6ã‚¢ãƒ‰ãƒ¬ã‚¹",cidrv4:"IPv4ç¯„å›²",cidrv6:"IPv6ç¯„å›²",base64:"base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ–‡å­—åˆ—",base64url:"base64urlã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ–‡å­—åˆ—",json_string:"JSONæ–‡å­—åˆ—",e164:"E.164ç•ªå·",jwt:"JWT",template_literal:"å…¥åŠ›å€¤"},h={nan:"NaN",number:"æ•°å€¤",array:"é…åˆ—"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ç„¡åŠ¹ãªå…¥åŠ›: instanceof ${l.expected}ãŒæœŸå¾…ã•ã‚Œã¾ã—ãŸãŒã€${s}ãŒå…¥åŠ›ã•ã‚Œã¾ã—ãŸ`:`ç„¡åŠ¹ãªå…¥åŠ›: ${f}ãŒæœŸå¾…ã•ã‚Œã¾ã—ãŸãŒã€${s}ãŒå…¥åŠ›ã•ã‚Œã¾ã—ãŸ`}case"invalid_value":return l.values.length===1?`ç„¡åŠ¹ãªå…¥åŠ›: ${vn(l.values[0])}ãŒæœŸå¾…ã•ã‚Œã¾ã—ãŸ`:`ç„¡åŠ¹ãªé¸æŠž: ${ai(l.values,"ã€")}ã®ã„ãšã‚Œã‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`;case"too_big":{let f=l.inclusive?"ä»¥ä¸‹ã§ã‚ã‚‹":"ã‚ˆã‚Šå°ã•ã„",x=e(l.origin);return x?`å¤§ãã™ãŽã‚‹å€¤: ${l.origin??"å€¤"}ã¯${l.maximum.toString()}${x.unit??"è¦ç´ "}${f}å¿…è¦ãŒã‚ã‚Šã¾ã™`:`å¤§ãã™ãŽã‚‹å€¤: ${l.origin??"å€¤"}ã¯${l.maximum.toString()}${f}å¿…è¦ãŒã‚ã‚Šã¾ã™`}case"too_small":{let f=l.inclusive?"ä»¥ä¸Šã§ã‚ã‚‹":"ã‚ˆã‚Šå¤§ãã„",x=e(l.origin);return x?`å°ã•ã™ãŽã‚‹å€¤: ${l.origin}ã¯${l.minimum.toString()}${x.unit}${f}å¿…è¦ãŒã‚ã‚Šã¾ã™`:`å°ã•ã™ãŽã‚‹å€¤: ${l.origin}ã¯${l.minimum.toString()}${f}å¿…è¦ãŒã‚ã‚Šã¾ã™`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ç„¡åŠ¹ãªæ–‡å­—åˆ—: "${f.prefix}"ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`:f.format==="ends_with"?`ç„¡åŠ¹ãªæ–‡å­—åˆ—: "${f.suffix}"ã§çµ‚ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`:f.format==="includes"?`ç„¡åŠ¹ãªæ–‡å­—åˆ—: "${f.includes}"ã‚’å«ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™`:f.format==="regex"?`ç„¡åŠ¹ãªæ–‡å­—åˆ—: ãƒ‘ã‚¿ãƒ¼ãƒ³${f.pattern}ã«ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`:`ç„¡åŠ¹ãª${o[f.format]??l.format}`}case"not_multiple_of":return`ç„¡åŠ¹ãªæ•°å€¤: ${l.divisor}ã®å€æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`;case"unrecognized_keys":return`èªè­˜ã•ã‚Œã¦ã„ãªã„ã‚­ãƒ¼${l.keys.length>1?"ç¾¤":""}: ${ai(l.keys,"ã€")}`;case"invalid_key":return`${l.origin}å†…ã®ç„¡åŠ¹ãªã‚­ãƒ¼`;case"invalid_union":return"ç„¡åŠ¹ãªå…¥åŠ›";case"invalid_element":return`${l.origin}å†…ã®ç„¡åŠ¹ãªå€¤`;default:return"ç„¡åŠ¹ãªå…¥åŠ›"}}};function mq(){return{localeError:pq()}}var gq=()=>{let i={string:{unit:"áƒ¡áƒ˜áƒ›áƒ‘áƒáƒšáƒ",verb:"áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡"},file:{unit:"áƒ‘áƒáƒ˜áƒ¢áƒ˜",verb:"áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡"},array:{unit:"áƒ”áƒšáƒ”áƒ›áƒ”áƒœáƒ¢áƒ˜",verb:"áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡"},set:{unit:"áƒ”áƒšáƒ”áƒ›áƒ”áƒœáƒ¢áƒ˜",verb:"áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡"}};function e(l){return i[l]??null}let o={regex:"áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ",email:"áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜",url:"URL",emoji:"áƒ”áƒ›áƒáƒ¯áƒ˜",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜-áƒ“áƒ áƒ",date:"áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜",time:"áƒ“áƒ áƒ",duration:"áƒ®áƒáƒœáƒ’áƒ áƒ«áƒšáƒ˜áƒ•áƒáƒ‘áƒ",ipv4:"IPv4 áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜",ipv6:"IPv6 áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜",cidrv4:"IPv4 áƒ“áƒ˜áƒáƒžáƒáƒ–áƒáƒœáƒ˜",cidrv6:"IPv6 áƒ“áƒ˜áƒáƒžáƒáƒ–áƒáƒœáƒ˜",base64:"base64-áƒ™áƒáƒ“áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜",base64url:"base64url-áƒ™áƒáƒ“áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜",json_string:"JSON áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜",e164:"E.164 áƒœáƒáƒ›áƒ”áƒ áƒ˜",jwt:"JWT",template_literal:"áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ"},h={nan:"NaN",number:"áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜",string:"áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜",boolean:"áƒ‘áƒ£áƒšáƒ”áƒáƒœáƒ˜",function:"áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ",array:"áƒ›áƒáƒ¡áƒ˜áƒ•áƒ˜"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ instanceof ${l.expected}, áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ£áƒšáƒ˜ ${s}`:`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${f}, áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ£áƒšáƒ˜ ${s}`}case"invalid_value":return l.values.length===1?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${vn(l.values[0])}`:`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ•áƒáƒ áƒ˜áƒáƒœáƒ¢áƒ˜: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜áƒ áƒ”áƒ áƒ—-áƒ”áƒ áƒ—áƒ˜ ${ai(l.values,"|")}-áƒ“áƒáƒœ`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`áƒ–áƒ”áƒ“áƒ›áƒ”áƒ¢áƒáƒ“ áƒ“áƒ˜áƒ“áƒ˜: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${l.origin??"áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ"} ${x.verb} ${f}${l.maximum.toString()} ${x.unit}`:`áƒ–áƒ”áƒ“áƒ›áƒ”áƒ¢áƒáƒ“ áƒ“áƒ˜áƒ“áƒ˜: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${l.origin??"áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ"} áƒ˜áƒ§áƒáƒ¡ ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`áƒ–áƒ”áƒ“áƒ›áƒ”áƒ¢áƒáƒ“ áƒžáƒáƒ¢áƒáƒ áƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${l.origin} ${x.verb} ${f}${l.minimum.toString()} ${x.unit}`:`áƒ–áƒ”áƒ“áƒ›áƒ”áƒ¢áƒáƒ“ áƒžáƒáƒ¢áƒáƒ áƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${l.origin} áƒ˜áƒ§áƒáƒ¡ ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜: áƒ£áƒœáƒ“áƒ áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒáƒ“áƒ”áƒ¡ "${f.prefix}"-áƒ˜áƒ—`:f.format==="ends_with"?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜: áƒ£áƒœáƒ“áƒ áƒ›áƒ—áƒáƒ•áƒ áƒ“áƒ”áƒ‘áƒáƒ“áƒ”áƒ¡ "${f.suffix}"-áƒ˜áƒ—`:f.format==="includes"?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜: áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡ "${f.includes}"-áƒ¡`:f.format==="regex"?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜: áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ”áƒ¡áƒáƒ‘áƒáƒ›áƒ”áƒ‘áƒáƒ“áƒ”áƒ¡ áƒ¨áƒáƒ‘áƒšáƒáƒœáƒ¡ ${f.pattern}`:`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ ${o[f.format]??l.format}`}case"not_multiple_of":return`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜: áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ ${l.divisor}-áƒ˜áƒ¡ áƒ¯áƒ”áƒ áƒáƒ“áƒ˜`;case"unrecognized_keys":return`áƒ£áƒªáƒœáƒáƒ‘áƒ˜ áƒ’áƒáƒ¡áƒáƒ¦áƒ”áƒ‘${l.keys.length>1?"áƒ”áƒ‘áƒ˜":"áƒ˜"}: ${ai(l.keys,", ")}`;case"invalid_key":return`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ’áƒáƒ¡áƒáƒ¦áƒ”áƒ‘áƒ˜ ${l.origin}-áƒ¨áƒ˜`;case"invalid_union":return"áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ";case"invalid_element":return`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ ${l.origin}-áƒ¨áƒ˜`;default:return"áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ"}}};function _q(){return{localeError:gq()}}var yq=()=>{let i={string:{unit:"ážáž½áž¢áž€áŸ’ážŸážš",verb:"áž‚áž½ážšáž˜áž¶áž“"},file:{unit:"áž”áŸƒ",verb:"áž‚áž½ážšáž˜áž¶áž“"},array:{unit:"áž’áž¶ážáž»",verb:"áž‚áž½ážšáž˜áž¶áž“"},set:{unit:"áž’áž¶ážáž»",verb:"áž‚áž½ážšáž˜áž¶áž“"}};function e(l){return i[l]??null}let o={regex:"áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›",email:"áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“áž¢áŸŠáž¸áž˜áŸ‚áž›",url:"URL",emoji:"ážŸáž‰áŸ’áž‰áž¶áž¢áž¶ážšáž˜áŸ’áž˜ážŽáŸ",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"áž€áž¶áž›áž”ážšáž·áž…áŸ’áž†áŸáž‘ áž“áž·áž„áž˜áŸ‰áŸ„áž„ ISO",date:"áž€áž¶áž›áž”ážšáž·áž…áŸ’áž†áŸáž‘ ISO",time:"áž˜áŸ‰áŸ„áž„ ISO",duration:"ážšáž™áŸˆáž–áŸáž› ISO",ipv4:"áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“ IPv4",ipv6:"áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“ IPv6",cidrv4:"ážŠáŸ‚áž“áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“ IPv4",cidrv6:"ážŠáŸ‚áž“áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“ IPv6",base64:"ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž¢áŸŠáž·áž€áž¼ážŠ base64",base64url:"ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž¢áŸŠáž·áž€áž¼ážŠ base64url",json_string:"ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážš JSON",e164:"áž›áŸáž E.164",jwt:"JWT",template_literal:"áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›"},h={nan:"NaN",number:"áž›áŸáž",array:"áž¢áž¶ážšáŸ (Array)",null:"áž‚áŸ’áž˜áž¶áž“ážáž˜áŸ’áž›áŸƒ (null)"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš instanceof ${l.expected} áž”áŸ‰áž»áž“áŸ’ážáŸ‚áž‘áž‘áž½áž›áž”áž¶áž“ ${s}`:`áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${f} áž”áŸ‰áž»áž“áŸ’ážáŸ‚áž‘áž‘áž½áž›áž”áž¶áž“ ${s}`}case"invalid_value":return l.values.length===1?`áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${vn(l.values[0])}`:`áž‡áž˜áŸ’ážšáž¾ážŸáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž‡áž¶áž˜áž½áž™áž€áŸ’áž“áž»áž„áž…áŸ†ážŽáŸ„áž˜ ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`áž’áŸ†áž–áŸáž€áŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${l.origin??"ážáž˜áŸ’áž›áŸƒ"} ${f} ${l.maximum.toString()} ${x.unit??"áž’áž¶ážáž»"}`:`áž’áŸ†áž–áŸáž€áŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${l.origin??"ážáž˜áŸ’áž›áŸƒ"} ${f} ${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`ážáž¼áž…áž–áŸáž€áŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${l.origin} ${f} ${l.minimum.toString()} ${x.unit}`:`ážáž¼áž…áž–áŸáž€áŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${l.origin} ${f} ${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž…áž¶áž”áŸ‹áž•áŸ’ážáž¾áž˜ážŠáŸ„áž™ "${f.prefix}"`:f.format==="ends_with"?`ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž”áž‰áŸ’áž…áž”áŸ‹ážŠáŸ„áž™ "${f.suffix}"`:f.format==="includes"?`ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž˜áž¶áž“ "${f.includes}"`:f.format==="regex"?`ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœážáŸ‚áž•áŸ’áž‚áž¼áž•áŸ’áž‚áž„áž“áž¹áž„áž‘áž˜áŸ’ážšáž„áŸ‹ážŠáŸ‚áž›áž”áž¶áž“áž€áŸ†ážŽážáŸ‹ ${f.pattern}`:`áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ${o[f.format]??l.format}`}case"not_multiple_of":return`áž›áŸážáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœážáŸ‚áž‡áž¶áž–áž áž»áž‚áž»ážŽáž“áŸƒ ${l.divisor}`;case"unrecognized_keys":return`ážšáž€ážƒáž¾áž‰ážŸáŸ„áž˜áž·áž“ážŸáŸ’áž‚áž¶áž›áŸ‹áŸ– ${ai(l.keys,", ")}`;case"invalid_key":return`ážŸáŸ„áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáž“áŸ…áž€áŸ’áž“áž»áž„ ${l.origin}`;case"invalid_union":return"áž‘áž·áž“áŸ’áž“áž“áŸáž™áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœ";case"invalid_element":return`áž‘áž·áž“áŸ’áž“áž“áŸáž™áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáž“áŸ…áž€áŸ’áž“áž»áž„ ${l.origin}`;default:return"áž‘áž·áž“áŸ’áž“áž“áŸáž™áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœ"}}};function A3(){return{localeError:yq()}}function vq(){return A3()}var xq=()=>{let i={string:{unit:"ë¬¸ìž",verb:"to have"},file:{unit:"ë°”ì´íŠ¸",verb:"to have"},array:{unit:"ê°œ",verb:"to have"},set:{unit:"ê°œ",verb:"to have"}};function e(l){return i[l]??null}let o={regex:"ìž…ë ¥",email:"ì´ë©”ì¼ ì£¼ì†Œ",url:"URL",emoji:"ì´ëª¨ì§€",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ë‚ ì§œì‹œê°„",date:"ISO ë‚ ì§œ",time:"ISO ì‹œê°„",duration:"ISO ê¸°ê°„",ipv4:"IPv4 ì£¼ì†Œ",ipv6:"IPv6 ì£¼ì†Œ",cidrv4:"IPv4 ë²”ìœ„",cidrv6:"IPv6 ë²”ìœ„",base64:"base64 ì¸ì½”ë”© ë¬¸ìžì—´",base64url:"base64url ì¸ì½”ë”© ë¬¸ìžì—´",json_string:"JSON ë¬¸ìžì—´",e164:"E.164 ë²ˆí˜¸",jwt:"JWT",template_literal:"ìž…ë ¥"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ìž˜ëª»ëœ ìž…ë ¥: ì˜ˆìƒ íƒ€ìž…ì€ instanceof ${l.expected}, ë°›ì€ íƒ€ìž…ì€ ${s}ìž…ë‹ˆë‹¤`:`ìž˜ëª»ëœ ìž…ë ¥: ì˜ˆìƒ íƒ€ìž…ì€ ${f}, ë°›ì€ íƒ€ìž…ì€ ${s}ìž…ë‹ˆë‹¤`}case"invalid_value":return l.values.length===1?`ìž˜ëª»ëœ ìž…ë ¥: ê°’ì€ ${vn(l.values[0])} ì´ì–´ì•¼ í•©ë‹ˆë‹¤`:`ìž˜ëª»ëœ ì˜µì…˜: ${ai(l.values,"ë˜ëŠ” ")} ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤`;case"too_big":{let f=l.inclusive?"ì´í•˜":"ë¯¸ë§Œ",x=f==="ë¯¸ë§Œ"?"ì´ì–´ì•¼ í•©ë‹ˆë‹¤":"ì—¬ì•¼ í•©ë‹ˆë‹¤",s=e(l.origin),P=(s==null?void 0:s.unit)??"ìš”ì†Œ";return s?`${l.origin??"ê°’"}ì´ ë„ˆë¬´ í½ë‹ˆë‹¤: ${l.maximum.toString()}${P} ${f}${x}`:`${l.origin??"ê°’"}ì´ ë„ˆë¬´ í½ë‹ˆë‹¤: ${l.maximum.toString()} ${f}${x}`}case"too_small":{let f=l.inclusive?"ì´ìƒ":"ì´ˆê³¼",x=f==="ì´ìƒ"?"ì´ì–´ì•¼ í•©ë‹ˆë‹¤":"ì—¬ì•¼ í•©ë‹ˆë‹¤",s=e(l.origin),P=(s==null?void 0:s.unit)??"ìš”ì†Œ";return s?`${l.origin??"ê°’"}ì´ ë„ˆë¬´ ìž‘ìŠµë‹ˆë‹¤: ${l.minimum.toString()}${P} ${f}${x}`:`${l.origin??"ê°’"}ì´ ë„ˆë¬´ ìž‘ìŠµë‹ˆë‹¤: ${l.minimum.toString()} ${f}${x}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ìž˜ëª»ëœ ë¬¸ìžì—´: "${f.prefix}"(ìœ¼)ë¡œ ì‹œìž‘í•´ì•¼ í•©ë‹ˆë‹¤`:f.format==="ends_with"?`ìž˜ëª»ëœ ë¬¸ìžì—´: "${f.suffix}"(ìœ¼)ë¡œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤`:f.format==="includes"?`ìž˜ëª»ëœ ë¬¸ìžì—´: "${f.includes}"ì„(ë¥¼) í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤`:f.format==="regex"?`ìž˜ëª»ëœ ë¬¸ìžì—´: ì •ê·œì‹ ${f.pattern} íŒ¨í„´ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤`:`ìž˜ëª»ëœ ${o[f.format]??l.format}`}case"not_multiple_of":return`ìž˜ëª»ëœ ìˆ«ìž: ${l.divisor}ì˜ ë°°ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤`;case"unrecognized_keys":return`ì¸ì‹í•  ìˆ˜ ì—†ëŠ” í‚¤: ${ai(l.keys,", ")}`;case"invalid_key":return`ìž˜ëª»ëœ í‚¤: ${l.origin}`;case"invalid_union":return"ìž˜ëª»ëœ ìž…ë ¥";case"invalid_element":return`ìž˜ëª»ëœ ê°’: ${l.origin}`;default:return"ìž˜ëª»ëœ ìž…ë ¥"}}};function bq(){return{localeError:xq()}}var Xg=i=>i.charAt(0).toUpperCase()+i.slice(1);function SC(i){let e=Math.abs(i),o=e%10,h=e%100;return h>=11&&h<=19||o===0?"many":o===1?"one":"few"}var wq=()=>{let i={string:{unit:{one:"simbolis",few:"simboliai",many:"simboliÅ³"},verb:{smaller:{inclusive:"turi bÅ«ti ne ilgesnÄ— kaip",notInclusive:"turi bÅ«ti trumpesnÄ— kaip"},bigger:{inclusive:"turi bÅ«ti ne trumpesnÄ— kaip",notInclusive:"turi bÅ«ti ilgesnÄ— kaip"}}},file:{unit:{one:"baitas",few:"baitai",many:"baitÅ³"},verb:{smaller:{inclusive:"turi bÅ«ti ne didesnis kaip",notInclusive:"turi bÅ«ti maÅ¾esnis kaip"},bigger:{inclusive:"turi bÅ«ti ne maÅ¾esnis kaip",notInclusive:"turi bÅ«ti didesnis kaip"}}},array:{unit:{one:"elementÄ…",few:"elementus",many:"elementÅ³"},verb:{smaller:{inclusive:"turi turÄ—ti ne daugiau kaip",notInclusive:"turi turÄ—ti maÅ¾iau kaip"},bigger:{inclusive:"turi turÄ—ti ne maÅ¾iau kaip",notInclusive:"turi turÄ—ti daugiau kaip"}}},set:{unit:{one:"elementÄ…",few:"elementus",many:"elementÅ³"},verb:{smaller:{inclusive:"turi turÄ—ti ne daugiau kaip",notInclusive:"turi turÄ—ti maÅ¾iau kaip"},bigger:{inclusive:"turi turÄ—ti ne maÅ¾iau kaip",notInclusive:"turi turÄ—ti daugiau kaip"}}}};function e(l,f,x,s){let P=i[l]??null;return P===null?P:{unit:P.unit[f],verb:P.verb[s][x?"inclusive":"notInclusive"]}}let o={regex:"Ä¯vestis",email:"el. paÅ¡to adresas",url:"URL",emoji:"jaustukas",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO data ir laikas",date:"ISO data",time:"ISO laikas",duration:"ISO trukmÄ—",ipv4:"IPv4 adresas",ipv6:"IPv6 adresas",cidrv4:"IPv4 tinklo prefiksas (CIDR)",cidrv6:"IPv6 tinklo prefiksas (CIDR)",base64:"base64 uÅ¾koduota eilutÄ—",base64url:"base64url uÅ¾koduota eilutÄ—",json_string:"JSON eilutÄ—",e164:"E.164 numeris",jwt:"JWT",template_literal:"Ä¯vestis"},h={nan:"NaN",number:"skaiÄius",bigint:"sveikasis skaiÄius",string:"eilutÄ—",boolean:"loginÄ— reikÅ¡mÄ—",undefined:"neapibrÄ—Å¾ta reikÅ¡mÄ—",function:"funkcija",symbol:"simbolis",array:"masyvas",object:"objektas",null:"nulinÄ— reikÅ¡mÄ—"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Gautas tipas ${s}, o tikÄ—tasi - instanceof ${l.expected}`:`Gautas tipas ${s}, o tikÄ—tasi - ${f}`}case"invalid_value":return l.values.length===1?`Privalo bÅ«ti ${vn(l.values[0])}`:`Privalo bÅ«ti vienas iÅ¡ ${ai(l.values,"|")} pasirinkimÅ³`;case"too_big":{let f=h[l.origin]??l.origin,x=e(l.origin,SC(Number(l.maximum)),l.inclusive??!1,"smaller");if(x!=null&&x.verb)return`${Xg(f??l.origin??"reikÅ¡mÄ—")} ${x.verb} ${l.maximum.toString()} ${x.unit??"elementÅ³"}`;let s=l.inclusive?"ne didesnis kaip":"maÅ¾esnis kaip";return`${Xg(f??l.origin??"reikÅ¡mÄ—")} turi bÅ«ti ${s} ${l.maximum.toString()} ${x==null?void 0:x.unit}`}case"too_small":{let f=h[l.origin]??l.origin,x=e(l.origin,SC(Number(l.minimum)),l.inclusive??!1,"bigger");if(x!=null&&x.verb)return`${Xg(f??l.origin??"reikÅ¡mÄ—")} ${x.verb} ${l.minimum.toString()} ${x.unit??"elementÅ³"}`;let s=l.inclusive?"ne maÅ¾esnis kaip":"didesnis kaip";return`${Xg(f??l.origin??"reikÅ¡mÄ—")} turi bÅ«ti ${s} ${l.minimum.toString()} ${x==null?void 0:x.unit}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`EilutÄ— privalo prasidÄ—ti "${f.prefix}"`:f.format==="ends_with"?`EilutÄ— privalo pasibaigti "${f.suffix}"`:f.format==="includes"?`EilutÄ— privalo Ä¯traukti "${f.includes}"`:f.format==="regex"?`EilutÄ— privalo atitikti ${f.pattern}`:`Neteisingas ${o[f.format]??l.format}`}case"not_multiple_of":return`SkaiÄius privalo bÅ«ti ${l.divisor} kartotinis.`;case"unrecognized_keys":return`NeatpaÅ¾int${l.keys.length>1?"i":"as"} rakt${l.keys.length>1?"ai":"as"}: ${ai(l.keys,", ")}`;case"invalid_key":return"Rastas klaidingas raktas";case"invalid_union":return"Klaidinga Ä¯vestis";case"invalid_element":{let f=h[l.origin]??l.origin;return`${Xg(f??l.origin??"reikÅ¡mÄ—")} turi klaidingÄ… Ä¯vestÄ¯`}default:return"Klaidinga Ä¯vestis"}}};function Sq(){return{localeError:wq()}}var Tq=()=>{let i={string:{unit:"Ð·Ð½Ð°Ñ†Ð¸",verb:"Ð´Ð° Ð¸Ð¼Ð°Ð°Ñ‚"},file:{unit:"Ð±Ð°Ñ˜Ñ‚Ð¸",verb:"Ð´Ð° Ð¸Ð¼Ð°Ð°Ñ‚"},array:{unit:"ÑÑ‚Ð°Ð²ÐºÐ¸",verb:"Ð´Ð° Ð¸Ð¼Ð°Ð°Ñ‚"},set:{unit:"ÑÑ‚Ð°Ð²ÐºÐ¸",verb:"Ð´Ð° Ð¸Ð¼Ð°Ð°Ñ‚"}};function e(l){return i[l]??null}let o={regex:"Ð²Ð½ÐµÑ",email:"Ð°Ð´Ñ€ÐµÑÐ° Ð½Ð° Ðµ-Ð¿Ð¾ÑˆÑ‚Ð°",url:"URL",emoji:"ÐµÐ¼Ð¾ÑŸÐ¸",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Ð´Ð°Ñ‚ÑƒÐ¼ Ð¸ Ð²Ñ€ÐµÐ¼Ðµ",date:"ISO Ð´Ð°Ñ‚ÑƒÐ¼",time:"ISO Ð²Ñ€ÐµÐ¼Ðµ",duration:"ISO Ð²Ñ€ÐµÐ¼ÐµÑ‚Ñ€Ð°ÐµÑšÐµ",ipv4:"IPv4 Ð°Ð´Ñ€ÐµÑÐ°",ipv6:"IPv6 Ð°Ð´Ñ€ÐµÑÐ°",cidrv4:"IPv4 Ð¾Ð¿ÑÐµÐ³",cidrv6:"IPv6 Ð¾Ð¿ÑÐµÐ³",base64:"base64-ÐµÐ½ÐºÐ¾Ð´Ð¸Ñ€Ð°Ð½Ð° Ð½Ð¸Ð·Ð°",base64url:"base64url-ÐµÐ½ÐºÐ¾Ð´Ð¸Ñ€Ð°Ð½Ð° Ð½Ð¸Ð·Ð°",json_string:"JSON Ð½Ð¸Ð·Ð°",e164:"E.164 Ð±Ñ€Ð¾Ñ˜",jwt:"JWT",template_literal:"Ð²Ð½ÐµÑ"},h={nan:"NaN",number:"Ð±Ñ€Ð¾Ñ˜",array:"Ð½Ð¸Ð·Ð°"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ð“Ñ€ÐµÑˆÐµÐ½ Ð²Ð½ÐµÑ: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° instanceof ${l.expected}, Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¾ ${s}`:`Ð“Ñ€ÐµÑˆÐµÐ½ Ð²Ð½ÐµÑ: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${f}, Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¾ ${s}`}case"invalid_value":return l.values.length===1?`Invalid input: expected ${vn(l.values[0])}`:`Ð“Ñ€ÐµÑˆÐ°Ð½Ð° Ð¾Ð¿Ñ†Ð¸Ñ˜Ð°: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ÐµÐ´Ð½Ð° ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`ÐŸÑ€ÐµÐ¼Ð½Ð¾Ð³Ñƒ Ð³Ð¾Ð»ÐµÐ¼: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${l.origin??"Ð²Ñ€ÐµÐ´Ð½Ð¾ÑÑ‚Ð°"} Ð´Ð° Ð¸Ð¼Ð° ${f}${l.maximum.toString()} ${x.unit??"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¸"}`:`ÐŸÑ€ÐµÐ¼Ð½Ð¾Ð³Ñƒ Ð³Ð¾Ð»ÐµÐ¼: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${l.origin??"Ð²Ñ€ÐµÐ´Ð½Ð¾ÑÑ‚Ð°"} Ð´Ð° Ð±Ð¸Ð´Ðµ ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`ÐŸÑ€ÐµÐ¼Ð½Ð¾Ð³Ñƒ Ð¼Ð°Ð»: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${l.origin} Ð´Ð° Ð¸Ð¼Ð° ${f}${l.minimum.toString()} ${x.unit}`:`ÐŸÑ€ÐµÐ¼Ð½Ð¾Ð³Ñƒ Ð¼Ð°Ð»: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${l.origin} Ð´Ð° Ð±Ð¸Ð´Ðµ ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ÐÐµÐ²Ð°Ð¶ÐµÑ‡ÐºÐ° Ð½Ð¸Ð·Ð°: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð·Ð°Ð¿Ð¾Ñ‡Ð½ÑƒÐ²Ð° ÑÐ¾ "${f.prefix}"`:f.format==="ends_with"?`ÐÐµÐ²Ð°Ð¶ÐµÑ‡ÐºÐ° Ð½Ð¸Ð·Ð°: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð·Ð°Ð²Ñ€ÑˆÑƒÐ²Ð° ÑÐ¾ "${f.suffix}"`:f.format==="includes"?`ÐÐµÐ²Ð°Ð¶ÐµÑ‡ÐºÐ° Ð½Ð¸Ð·Ð°: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð²ÐºÐ»ÑƒÑ‡ÑƒÐ²Ð° "${f.includes}"`:f.format==="regex"?`ÐÐµÐ²Ð°Ð¶ÐµÑ‡ÐºÐ° Ð½Ð¸Ð·Ð°: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð¾Ð´Ð³Ð¾Ð°Ñ€Ð° Ð½Ð° Ð¿Ð°Ñ‚ÐµÑ€Ð½Ð¾Ñ‚ ${f.pattern}`:`Invalid ${o[f.format]??l.format}`}case"not_multiple_of":return`Ð“Ñ€ÐµÑˆÐµÐ½ Ð±Ñ€Ð¾Ñ˜: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð±Ð¸Ð´Ðµ Ð´ÐµÐ»Ð¸Ð² ÑÐ¾ ${l.divisor}`;case"unrecognized_keys":return`${l.keys.length>1?"ÐÐµÐ¿Ñ€ÐµÐ¿Ð¾Ð·Ð½Ð°ÐµÐ½Ð¸ ÐºÐ»ÑƒÑ‡ÐµÐ²Ð¸":"ÐÐµÐ¿Ñ€ÐµÐ¿Ð¾Ð·Ð½Ð°ÐµÐ½ ÐºÐ»ÑƒÑ‡"}: ${ai(l.keys,", ")}`;case"invalid_key":return`Ð“Ñ€ÐµÑˆÐµÐ½ ÐºÐ»ÑƒÑ‡ Ð²Ð¾ ${l.origin}`;case"invalid_union":return"Ð“Ñ€ÐµÑˆÐµÐ½ Ð²Ð½ÐµÑ";case"invalid_element":return`Ð“Ñ€ÐµÑˆÐ½Ð° Ð²Ñ€ÐµÐ´Ð½Ð¾ÑÑ‚ Ð²Ð¾ ${l.origin}`;default:return"Ð“Ñ€ÐµÑˆÐµÐ½ Ð²Ð½ÐµÑ"}}};function Eq(){return{localeError:Tq()}}var Iq=()=>{let i={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}};function e(l){return i[l]??null}let o={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"},h={nan:"NaN",number:"nombor"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Input tidak sah: dijangka instanceof ${l.expected}, diterima ${s}`:`Input tidak sah: dijangka ${f}, diterima ${s}`}case"invalid_value":return l.values.length===1?`Input tidak sah: dijangka ${vn(l.values[0])}`:`Pilihan tidak sah: dijangka salah satu daripada ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Terlalu besar: dijangka ${l.origin??"nilai"} ${x.verb} ${f}${l.maximum.toString()} ${x.unit??"elemen"}`:`Terlalu besar: dijangka ${l.origin??"nilai"} adalah ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Terlalu kecil: dijangka ${l.origin} ${x.verb} ${f}${l.minimum.toString()} ${x.unit}`:`Terlalu kecil: dijangka ${l.origin} adalah ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`String tidak sah: mesti bermula dengan "${f.prefix}"`:f.format==="ends_with"?`String tidak sah: mesti berakhir dengan "${f.suffix}"`:f.format==="includes"?`String tidak sah: mesti mengandungi "${f.includes}"`:f.format==="regex"?`String tidak sah: mesti sepadan dengan corak ${f.pattern}`:`${o[f.format]??l.format} tidak sah`}case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${l.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${ai(l.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${l.origin}`;case"invalid_union":return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${l.origin}`;default:return"Input tidak sah"}}};function Mq(){return{localeError:Iq()}}var Aq=()=>{let i={string:{unit:"tekens",verb:"heeft"},file:{unit:"bytes",verb:"heeft"},array:{unit:"elementen",verb:"heeft"},set:{unit:"elementen",verb:"heeft"}};function e(l){return i[l]??null}let o={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"},h={nan:"NaN",number:"getal"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ongeldige invoer: verwacht instanceof ${l.expected}, ontving ${s}`:`Ongeldige invoer: verwacht ${f}, ontving ${s}`}case"invalid_value":return l.values.length===1?`Ongeldige invoer: verwacht ${vn(l.values[0])}`:`Ongeldige optie: verwacht Ã©Ã©n van ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin),s=l.origin==="date"?"laat":l.origin==="string"?"lang":"groot";return x?`Te ${s}: verwacht dat ${l.origin??"waarde"} ${f}${l.maximum.toString()} ${x.unit??"elementen"} ${x.verb}`:`Te ${s}: verwacht dat ${l.origin??"waarde"} ${f}${l.maximum.toString()} is`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin),s=l.origin==="date"?"vroeg":l.origin==="string"?"kort":"klein";return x?`Te ${s}: verwacht dat ${l.origin} ${f}${l.minimum.toString()} ${x.unit} ${x.verb}`:`Te ${s}: verwacht dat ${l.origin} ${f}${l.minimum.toString()} is`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Ongeldige tekst: moet met "${f.prefix}" beginnen`:f.format==="ends_with"?`Ongeldige tekst: moet op "${f.suffix}" eindigen`:f.format==="includes"?`Ongeldige tekst: moet "${f.includes}" bevatten`:f.format==="regex"?`Ongeldige tekst: moet overeenkomen met patroon ${f.pattern}`:`Ongeldig: ${o[f.format]??l.format}`}case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${l.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${l.keys.length>1?"s":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${l.origin}`;case"invalid_union":return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${l.origin}`;default:return"Ongeldige invoer"}}};function Pq(){return{localeError:Aq()}}var zq=()=>{let i={string:{unit:"tegn",verb:"Ã¥ ha"},file:{unit:"bytes",verb:"Ã¥ ha"},array:{unit:"elementer",verb:"Ã¥ inneholde"},set:{unit:"elementer",verb:"Ã¥ inneholde"}};function e(l){return i[l]??null}let o={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omrÃ¥de",ipv6:"IPv6-omrÃ¥de",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},h={nan:"NaN",number:"tall",array:"liste"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ugyldig input: forventet instanceof ${l.expected}, fikk ${s}`:`Ugyldig input: forventet ${f}, fikk ${s}`}case"invalid_value":return l.values.length===1?`Ugyldig verdi: forventet ${vn(l.values[0])}`:`Ugyldig valg: forventet en av ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`For stor(t): forventet ${l.origin??"value"} til Ã¥ ha ${f}${l.maximum.toString()} ${x.unit??"elementer"}`:`For stor(t): forventet ${l.origin??"value"} til Ã¥ ha ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`For lite(n): forventet ${l.origin} til Ã¥ ha ${f}${l.minimum.toString()} ${x.unit}`:`For lite(n): forventet ${l.origin} til Ã¥ ha ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Ugyldig streng: mÃ¥ starte med "${f.prefix}"`:f.format==="ends_with"?`Ugyldig streng: mÃ¥ ende med "${f.suffix}"`:f.format==="includes"?`Ugyldig streng: mÃ¥ inneholde "${f.includes}"`:f.format==="regex"?`Ugyldig streng: mÃ¥ matche mÃ¸nsteret ${f.pattern}`:`Ugyldig ${o[f.format]??l.format}`}case"not_multiple_of":return`Ugyldig tall: mÃ¥ vÃ¦re et multiplum av ${l.divisor}`;case"unrecognized_keys":return`${l.keys.length>1?"Ukjente nÃ¸kler":"Ukjent nÃ¸kkel"}: ${ai(l.keys,", ")}`;case"invalid_key":return`Ugyldig nÃ¸kkel i ${l.origin}`;case"invalid_union":return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${l.origin}`;default:return"Ugyldig input"}}};function Cq(){return{localeError:zq()}}var Lq=()=>{let i={string:{unit:"harf",verb:"olmalÄ±dÄ±r"},file:{unit:"bayt",verb:"olmalÄ±dÄ±r"},array:{unit:"unsur",verb:"olmalÄ±dÄ±r"},set:{unit:"unsur",verb:"olmalÄ±dÄ±r"}};function e(l){return i[l]??null}let o={regex:"giren",email:"epostagÃ¢h",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO hengÃ¢mÄ±",date:"ISO tarihi",time:"ISO zamanÄ±",duration:"ISO mÃ¼ddeti",ipv4:"IPv4 niÅŸÃ¢nÄ±",ipv6:"IPv6 niÅŸÃ¢nÄ±",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-ÅŸifreli metin",base64url:"base64url-ÅŸifreli metin",json_string:"JSON metin",e164:"E.164 sayÄ±sÄ±",jwt:"JWT",template_literal:"giren"},h={nan:"NaN",number:"numara",array:"saf",null:"gayb"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`FÃ¢sit giren: umulan instanceof ${l.expected}, alÄ±nan ${s}`:`FÃ¢sit giren: umulan ${f}, alÄ±nan ${s}`}case"invalid_value":return l.values.length===1?`FÃ¢sit giren: umulan ${vn(l.values[0])}`:`FÃ¢sit tercih: mÃ»teberler ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Fazla bÃ¼yÃ¼k: ${l.origin??"value"}, ${f}${l.maximum.toString()} ${x.unit??"elements"} sahip olmalÄ±ydÄ±.`:`Fazla bÃ¼yÃ¼k: ${l.origin??"value"}, ${f}${l.maximum.toString()} olmalÄ±ydÄ±.`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Fazla kÃ¼Ã§Ã¼k: ${l.origin}, ${f}${l.minimum.toString()} ${x.unit} sahip olmalÄ±ydÄ±.`:`Fazla kÃ¼Ã§Ã¼k: ${l.origin}, ${f}${l.minimum.toString()} olmalÄ±ydÄ±.`}case"invalid_format":{let f=l;return f.format==="starts_with"?`FÃ¢sit metin: "${f.prefix}" ile baÅŸlamalÄ±.`:f.format==="ends_with"?`FÃ¢sit metin: "${f.suffix}" ile bitmeli.`:f.format==="includes"?`FÃ¢sit metin: "${f.includes}" ihtivÃ¢ etmeli.`:f.format==="regex"?`FÃ¢sit metin: ${f.pattern} nakÅŸÄ±na uymalÄ±.`:`FÃ¢sit ${o[f.format]??l.format}`}case"not_multiple_of":return`FÃ¢sit sayÄ±: ${l.divisor} katÄ± olmalÄ±ydÄ±.`;case"unrecognized_keys":return`TanÄ±nmayan anahtar ${l.keys.length>1?"s":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`${l.origin} iÃ§in tanÄ±nmayan anahtar var.`;case"invalid_union":return"Giren tanÄ±namadÄ±.";case"invalid_element":return`${l.origin} iÃ§in tanÄ±nmayan kÄ±ymet var.`;default:return"KÄ±ymet tanÄ±namadÄ±."}}};function Rq(){return{localeError:Lq()}}var Dq=()=>{let i={string:{unit:"ØªÙˆÚ©ÙŠ",verb:"ÙˆÙ„Ø±ÙŠ"},file:{unit:"Ø¨Ø§ÛŒÙ¼Ø³",verb:"ÙˆÙ„Ø±ÙŠ"},array:{unit:"ØªÙˆÚ©ÙŠ",verb:"ÙˆÙ„Ø±ÙŠ"},set:{unit:"ØªÙˆÚ©ÙŠ",verb:"ÙˆÙ„Ø±ÙŠ"}};function e(l){return i[l]??null}let o={regex:"ÙˆØ±ÙˆØ¯ÙŠ",email:"Ø¨Ø±ÛŒÚšÙ†Ø§Ù„ÛŒÚ©",url:"ÛŒÙˆ Ø¢Ø± Ø§Ù„",emoji:"Ø§ÛŒÙ…ÙˆØ¬ÙŠ",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"Ù†ÛŒÙ¼Ù‡ Ø§Ùˆ ÙˆØ®Øª",date:"Ù†ÛÙ¼Ù‡",time:"ÙˆØ®Øª",duration:"Ù…ÙˆØ¯Ù‡",ipv4:"Ø¯ IPv4 Ù¾ØªÙ‡",ipv6:"Ø¯ IPv6 Ù¾ØªÙ‡",cidrv4:"Ø¯ IPv4 Ø³Ø§Ø­Ù‡",cidrv6:"Ø¯ IPv6 Ø³Ø§Ø­Ù‡",base64:"base64-encoded Ù…ØªÙ†",base64url:"base64url-encoded Ù…ØªÙ†",json_string:"JSON Ù…ØªÙ†",e164:"Ø¯ E.164 Ø´Ù…ÛØ±Ù‡",jwt:"JWT",template_literal:"ÙˆØ±ÙˆØ¯ÙŠ"},h={nan:"NaN",number:"Ø¹Ø¯Ø¯",array:"Ø§Ø±Û"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ù†Ø§Ø³Ù… ÙˆØ±ÙˆØ¯ÙŠ: Ø¨Ø§ÛŒØ¯ instanceof ${l.expected} ÙˆØ§ÛŒ, Ù…Ú«Ø± ${s} ØªØ±Ù„Ø§Ø³Ù‡ Ø´Ùˆ`:`Ù†Ø§Ø³Ù… ÙˆØ±ÙˆØ¯ÙŠ: Ø¨Ø§ÛŒØ¯ ${f} ÙˆØ§ÛŒ, Ù…Ú«Ø± ${s} ØªØ±Ù„Ø§Ø³Ù‡ Ø´Ùˆ`}case"invalid_value":return l.values.length===1?`Ù†Ø§Ø³Ù… ÙˆØ±ÙˆØ¯ÙŠ: Ø¨Ø§ÛŒØ¯ ${vn(l.values[0])} ÙˆØ§ÛŒ`:`Ù†Ø§Ø³Ù… Ø§Ù†ØªØ®Ø§Ø¨: Ø¨Ø§ÛŒØ¯ ÛŒÙˆ Ù„Ù‡ ${ai(l.values,"|")} Ú…Ø®Ù‡ ÙˆØ§ÛŒ`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ú‰ÛŒØ± Ù„ÙˆÛŒ: ${l.origin??"Ø§Ø±Ø²ÚšØª"} Ø¨Ø§ÛŒØ¯ ${f}${l.maximum.toString()} ${x.unit??"Ø¹Ù†ØµØ±ÙˆÙ†Ù‡"} ÙˆÙ„Ø±ÙŠ`:`Ú‰ÛŒØ± Ù„ÙˆÛŒ: ${l.origin??"Ø§Ø±Ø²ÚšØª"} Ø¨Ø§ÛŒØ¯ ${f}${l.maximum.toString()} ÙˆÙŠ`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Ú‰ÛŒØ± Ú©ÙˆÚ†Ù†ÛŒ: ${l.origin} Ø¨Ø§ÛŒØ¯ ${f}${l.minimum.toString()} ${x.unit} ÙˆÙ„Ø±ÙŠ`:`Ú‰ÛŒØ± Ú©ÙˆÚ†Ù†ÛŒ: ${l.origin} Ø¨Ø§ÛŒØ¯ ${f}${l.minimum.toString()} ÙˆÙŠ`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Ù†Ø§Ø³Ù… Ù…ØªÙ†: Ø¨Ø§ÛŒØ¯ Ø¯ "${f.prefix}" Ø³Ø±Ù‡ Ù¾ÛŒÙ„ Ø´ÙŠ`:f.format==="ends_with"?`Ù†Ø§Ø³Ù… Ù…ØªÙ†: Ø¨Ø§ÛŒØ¯ Ø¯ "${f.suffix}" Ø³Ø±Ù‡ Ù¾Ø§ÛŒ ØªÙ‡ ÙˆØ±Ø³ÙŠÚ–ÙŠ`:f.format==="includes"?`Ù†Ø§Ø³Ù… Ù…ØªÙ†: Ø¨Ø§ÛŒØ¯ "${f.includes}" ÙˆÙ„Ø±ÙŠ`:f.format==="regex"?`Ù†Ø§Ø³Ù… Ù…ØªÙ†: Ø¨Ø§ÛŒØ¯ Ø¯ ${f.pattern} Ø³Ø±Ù‡ Ù…Ø·Ø§Ø¨Ù‚Øª ÙˆÙ„Ø±ÙŠ`:`${o[f.format]??l.format} Ù†Ø§Ø³Ù… Ø¯ÛŒ`}case"not_multiple_of":return`Ù†Ø§Ø³Ù… Ø¹Ø¯Ø¯: Ø¨Ø§ÛŒØ¯ Ø¯ ${l.divisor} Ù…Ø¶Ø±Ø¨ ÙˆÙŠ`;case"unrecognized_keys":return`Ù†Ø§Ø³Ù… ${l.keys.length>1?"Ú©Ù„ÛŒÚ‰ÙˆÙ†Ù‡":"Ú©Ù„ÛŒÚ‰"}: ${ai(l.keys,", ")}`;case"invalid_key":return`Ù†Ø§Ø³Ù… Ú©Ù„ÛŒÚ‰ Ù¾Ù‡ ${l.origin} Ú©Û`;case"invalid_union":return"Ù†Ø§Ø³Ù…Ù‡ ÙˆØ±ÙˆØ¯ÙŠ";case"invalid_element":return`Ù†Ø§Ø³Ù… Ø¹Ù†ØµØ± Ù¾Ù‡ ${l.origin} Ú©Û`;default:return"Ù†Ø§Ø³Ù…Ù‡ ÙˆØ±ÙˆØ¯ÙŠ"}}};function kq(){return{localeError:Dq()}}var Oq=()=>{let i={string:{unit:"znakÃ³w",verb:"mieÄ‡"},file:{unit:"bajtÃ³w",verb:"mieÄ‡"},array:{unit:"elementÃ³w",verb:"mieÄ‡"},set:{unit:"elementÃ³w",verb:"mieÄ‡"}};function e(l){return i[l]??null}let o={regex:"wyraÅ¼enie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"ciÄ…g znakÃ³w zakodowany w formacie base64",base64url:"ciÄ…g znakÃ³w zakodowany w formacie base64url",json_string:"ciÄ…g znakÃ³w w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wejÅ›cie"},h={nan:"NaN",number:"liczba",array:"tablica"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`NieprawidÅ‚owe dane wejÅ›ciowe: oczekiwano instanceof ${l.expected}, otrzymano ${s}`:`NieprawidÅ‚owe dane wejÅ›ciowe: oczekiwano ${f}, otrzymano ${s}`}case"invalid_value":return l.values.length===1?`NieprawidÅ‚owe dane wejÅ›ciowe: oczekiwano ${vn(l.values[0])}`:`NieprawidÅ‚owa opcja: oczekiwano jednej z wartoÅ›ci ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Za duÅ¼a wartoÅ›Ä‡: oczekiwano, Å¼e ${l.origin??"wartoÅ›Ä‡"} bÄ™dzie mieÄ‡ ${f}${l.maximum.toString()} ${x.unit??"elementÃ³w"}`:`Zbyt duÅ¼(y/a/e): oczekiwano, Å¼e ${l.origin??"wartoÅ›Ä‡"} bÄ™dzie wynosiÄ‡ ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Za maÅ‚a wartoÅ›Ä‡: oczekiwano, Å¼e ${l.origin??"wartoÅ›Ä‡"} bÄ™dzie mieÄ‡ ${f}${l.minimum.toString()} ${x.unit??"elementÃ³w"}`:`Zbyt maÅ‚(y/a/e): oczekiwano, Å¼e ${l.origin??"wartoÅ›Ä‡"} bÄ™dzie wynosiÄ‡ ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`NieprawidÅ‚owy ciÄ…g znakÃ³w: musi zaczynaÄ‡ siÄ™ od "${f.prefix}"`:f.format==="ends_with"?`NieprawidÅ‚owy ciÄ…g znakÃ³w: musi koÅ„czyÄ‡ siÄ™ na "${f.suffix}"`:f.format==="includes"?`NieprawidÅ‚owy ciÄ…g znakÃ³w: musi zawieraÄ‡ "${f.includes}"`:f.format==="regex"?`NieprawidÅ‚owy ciÄ…g znakÃ³w: musi odpowiadaÄ‡ wzorcowi ${f.pattern}`:`NieprawidÅ‚ow(y/a/e) ${o[f.format]??l.format}`}case"not_multiple_of":return`NieprawidÅ‚owa liczba: musi byÄ‡ wielokrotnoÅ›ciÄ… ${l.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${l.keys.length>1?"s":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`NieprawidÅ‚owy klucz w ${l.origin}`;case"invalid_union":return"NieprawidÅ‚owe dane wejÅ›ciowe";case"invalid_element":return`NieprawidÅ‚owa wartoÅ›Ä‡ w ${l.origin}`;default:return"NieprawidÅ‚owe dane wejÅ›ciowe"}}};function Fq(){return{localeError:Oq()}}var Bq=()=>{let i={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}};function e(l){return i[l]??null}let o={regex:"padrÃ£o",email:"endereÃ§o de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"duraÃ§Ã£o ISO",ipv4:"endereÃ§o IPv4",ipv6:"endereÃ§o IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"nÃºmero E.164",jwt:"JWT",template_literal:"entrada"},h={nan:"NaN",number:"nÃºmero",null:"nulo"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Tipo invÃ¡lido: esperado instanceof ${l.expected}, recebido ${s}`:`Tipo invÃ¡lido: esperado ${f}, recebido ${s}`}case"invalid_value":return l.values.length===1?`Entrada invÃ¡lida: esperado ${vn(l.values[0])}`:`OpÃ§Ã£o invÃ¡lida: esperada uma das ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Muito grande: esperado que ${l.origin??"valor"} tivesse ${f}${l.maximum.toString()} ${x.unit??"elementos"}`:`Muito grande: esperado que ${l.origin??"valor"} fosse ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Muito pequeno: esperado que ${l.origin} tivesse ${f}${l.minimum.toString()} ${x.unit}`:`Muito pequeno: esperado que ${l.origin} fosse ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Texto invÃ¡lido: deve comeÃ§ar com "${f.prefix}"`:f.format==="ends_with"?`Texto invÃ¡lido: deve terminar com "${f.suffix}"`:f.format==="includes"?`Texto invÃ¡lido: deve incluir "${f.includes}"`:f.format==="regex"?`Texto invÃ¡lido: deve corresponder ao padrÃ£o ${f.pattern}`:`${o[f.format]??l.format} invÃ¡lido`}case"not_multiple_of":return`NÃºmero invÃ¡lido: deve ser mÃºltiplo de ${l.divisor}`;case"unrecognized_keys":return`Chave${l.keys.length>1?"s":""} desconhecida${l.keys.length>1?"s":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`Chave invÃ¡lida em ${l.origin}`;case"invalid_union":return"Entrada invÃ¡lida";case"invalid_element":return`Valor invÃ¡lido em ${l.origin}`;default:return"Campo invÃ¡lido"}}};function Nq(){return{localeError:Bq()}}function TC(i,e,o,h){let l=Math.abs(i),f=l%10,x=l%100;return x>=11&&x<=19?h:f===1?e:f>=2&&f<=4?o:h}var Uq=()=>{let i={string:{unit:{one:"ÑÐ¸Ð¼Ð²Ð¾Ð»",few:"ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°",many:"ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"},verb:"Ð¸Ð¼ÐµÑ‚ÑŒ"},file:{unit:{one:"Ð±Ð°Ð¹Ñ‚",few:"Ð±Ð°Ð¹Ñ‚Ð°",many:"Ð±Ð°Ð¹Ñ‚"},verb:"Ð¸Ð¼ÐµÑ‚ÑŒ"},array:{unit:{one:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚",few:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°",many:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²"},verb:"Ð¸Ð¼ÐµÑ‚ÑŒ"},set:{unit:{one:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚",few:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°",many:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²"},verb:"Ð¸Ð¼ÐµÑ‚ÑŒ"}};function e(l){return i[l]??null}let o={regex:"Ð²Ð²Ð¾Ð´",email:"email Ð°Ð´Ñ€ÐµÑ",url:"URL",emoji:"ÑÐ¼Ð¾Ð´Ð·Ð¸",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Ð´Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ",date:"ISO Ð´Ð°Ñ‚Ð°",time:"ISO Ð²Ñ€ÐµÐ¼Ñ",duration:"ISO Ð´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ",ipv4:"IPv4 Ð°Ð´Ñ€ÐµÑ",ipv6:"IPv6 Ð°Ð´Ñ€ÐµÑ",cidrv4:"IPv4 Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½",cidrv6:"IPv6 Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½",base64:"ÑÑ‚Ñ€Ð¾ÐºÐ° Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ base64",base64url:"ÑÑ‚Ñ€Ð¾ÐºÐ° Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ base64url",json_string:"JSON ÑÑ‚Ñ€Ð¾ÐºÐ°",e164:"Ð½Ð¾Ð¼ÐµÑ€ E.164",jwt:"JWT",template_literal:"Ð²Ð²Ð¾Ð´"},h={nan:"NaN",number:"Ñ‡Ð¸ÑÐ»Ð¾",array:"Ð¼Ð°ÑÑÐ¸Ð²"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ð²Ð¾Ð´: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ instanceof ${l.expected}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ ${s}`:`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ð²Ð¾Ð´: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ ${f}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ ${s}`}case"invalid_value":return l.values.length===1?`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ð²Ð¾Ð´: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ ${vn(l.values[0])}`:`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð´Ð½Ð¾ Ð¸Ð· ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);if(x){let s=Number(l.maximum),P=TC(s,x.unit.one,x.unit.few,x.unit.many);return`Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ, Ñ‡Ñ‚Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ"} Ð±ÑƒÐ´ÐµÑ‚ Ð¸Ð¼ÐµÑ‚ÑŒ ${f}${l.maximum.toString()} ${P}`}return`Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ, Ñ‡Ñ‚Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ"} Ð±ÑƒÐ´ÐµÑ‚ ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);if(x){let s=Number(l.minimum),P=TC(s,x.unit.one,x.unit.few,x.unit.many);return`Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ, Ñ‡Ñ‚Ð¾ ${l.origin} Ð±ÑƒÐ´ÐµÑ‚ Ð¸Ð¼ÐµÑ‚ÑŒ ${f}${l.minimum.toString()} ${P}`}return`Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ, Ñ‡Ñ‚Ð¾ ${l.origin} Ð±ÑƒÐ´ÐµÑ‚ ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°: Ð´Ð¾Ð»Ð¶Ð½Ð° Ð½Ð°Ñ‡Ð¸Ð½Ð°Ñ‚ÑŒÑÑ Ñ "${f.prefix}"`:f.format==="ends_with"?`ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°: Ð´Ð¾Ð»Ð¶Ð½Ð° Ð·Ð°ÐºÐ°Ð½Ñ‡Ð¸Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð° "${f.suffix}"`:f.format==="includes"?`ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°: Ð´Ð¾Ð»Ð¶Ð½Ð° ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ "${f.includes}"`:f.format==="regex"?`ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°: Ð´Ð¾Ð»Ð¶Ð½Ð° ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ ${f.pattern}`:`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ${o[f.format]??l.format}`}case"not_multiple_of":return`ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾: Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ ÐºÑ€Ð°Ñ‚Ð½Ñ‹Ð¼ ${l.divisor}`;case"unrecognized_keys":return`ÐÐµÑ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð½Ð½${l.keys.length>1?"Ñ‹Ðµ":"Ñ‹Ð¹"} ÐºÐ»ÑŽÑ‡${l.keys.length>1?"Ð¸":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ Ð² ${l.origin}`;case"invalid_union":return"ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ðµ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ";case"invalid_element":return`ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð² ${l.origin}`;default:return"ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ðµ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ"}}};function $q(){return{localeError:Uq()}}var Vq=()=>{let i={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}};function e(l){return i[l]??null}let o={regex:"vnos",email:"e-poÅ¡tni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in Äas",date:"ISO datum",time:"ISO Äas",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 Å¡tevilka",jwt:"JWT",template_literal:"vnos"},h={nan:"NaN",number:"Å¡tevilo",array:"tabela"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Neveljaven vnos: priÄakovano instanceof ${l.expected}, prejeto ${s}`:`Neveljaven vnos: priÄakovano ${f}, prejeto ${s}`}case"invalid_value":return l.values.length===1?`Neveljaven vnos: priÄakovano ${vn(l.values[0])}`:`Neveljavna moÅ¾nost: priÄakovano eno izmed ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Preveliko: priÄakovano, da bo ${l.origin??"vrednost"} imelo ${f}${l.maximum.toString()} ${x.unit??"elementov"}`:`Preveliko: priÄakovano, da bo ${l.origin??"vrednost"} ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Premajhno: priÄakovano, da bo ${l.origin} imelo ${f}${l.minimum.toString()} ${x.unit}`:`Premajhno: priÄakovano, da bo ${l.origin} ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Neveljaven niz: mora se zaÄeti z "${f.prefix}"`:f.format==="ends_with"?`Neveljaven niz: mora se konÄati z "${f.suffix}"`:f.format==="includes"?`Neveljaven niz: mora vsebovati "${f.includes}"`:f.format==="regex"?`Neveljaven niz: mora ustrezati vzorcu ${f.pattern}`:`Neveljaven ${o[f.format]??l.format}`}case"not_multiple_of":return`Neveljavno Å¡tevilo: mora biti veÄkratnik ${l.divisor}`;case"unrecognized_keys":return`Neprepoznan${l.keys.length>1?"i kljuÄi":" kljuÄ"}: ${ai(l.keys,", ")}`;case"invalid_key":return`Neveljaven kljuÄ v ${l.origin}`;case"invalid_union":return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${l.origin}`;default:return"Neveljaven vnos"}}};function jq(){return{localeError:Vq()}}var Gq=()=>{let i={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att innehÃ¥lla"},set:{unit:"objekt",verb:"att innehÃ¥lla"}};function e(l){return i[l]??null}let o={regex:"reguljÃ¤rt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad strÃ¤ng",base64url:"base64url-kodad strÃ¤ng",json_string:"JSON-strÃ¤ng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"},h={nan:"NaN",number:"antal",array:"lista"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ogiltig inmatning: fÃ¶rvÃ¤ntat instanceof ${l.expected}, fick ${s}`:`Ogiltig inmatning: fÃ¶rvÃ¤ntat ${f}, fick ${s}`}case"invalid_value":return l.values.length===1?`Ogiltig inmatning: fÃ¶rvÃ¤ntat ${vn(l.values[0])}`:`Ogiltigt val: fÃ¶rvÃ¤ntade en av ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`FÃ¶r stor(t): fÃ¶rvÃ¤ntade ${l.origin??"vÃ¤rdet"} att ha ${f}${l.maximum.toString()} ${x.unit??"element"}`:`FÃ¶r stor(t): fÃ¶rvÃ¤ntat ${l.origin??"vÃ¤rdet"} att ha ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`FÃ¶r lite(t): fÃ¶rvÃ¤ntade ${l.origin??"vÃ¤rdet"} att ha ${f}${l.minimum.toString()} ${x.unit}`:`FÃ¶r lite(t): fÃ¶rvÃ¤ntade ${l.origin??"vÃ¤rdet"} att ha ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Ogiltig strÃ¤ng: mÃ¥ste bÃ¶rja med "${f.prefix}"`:f.format==="ends_with"?`Ogiltig strÃ¤ng: mÃ¥ste sluta med "${f.suffix}"`:f.format==="includes"?`Ogiltig strÃ¤ng: mÃ¥ste innehÃ¥lla "${f.includes}"`:f.format==="regex"?`Ogiltig strÃ¤ng: mÃ¥ste matcha mÃ¶nstret "${f.pattern}"`:`Ogiltig(t) ${o[f.format]??l.format}`}case"not_multiple_of":return`Ogiltigt tal: mÃ¥ste vara en multipel av ${l.divisor}`;case"unrecognized_keys":return`${l.keys.length>1?"OkÃ¤nda nycklar":"OkÃ¤nd nyckel"}: ${ai(l.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${l.origin??"vÃ¤rdet"}`;case"invalid_union":return"Ogiltig input";case"invalid_element":return`Ogiltigt vÃ¤rde i ${l.origin??"vÃ¤rdet"}`;default:return"Ogiltig input"}}};function Hq(){return{localeError:Gq()}}var Zq=()=>{let i={string:{unit:"à®Žà®´à¯à®¤à¯à®¤à¯à®•à¯à®•à®³à¯",verb:"à®•à¯Šà®£à¯à®Ÿà®¿à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯"},file:{unit:"à®ªà¯ˆà®Ÿà¯à®Ÿà¯à®•à®³à¯",verb:"à®•à¯Šà®£à¯à®Ÿà®¿à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯"},array:{unit:"à®‰à®±à¯à®ªà¯à®ªà¯à®•à®³à¯",verb:"à®•à¯Šà®£à¯à®Ÿà®¿à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯"},set:{unit:"à®‰à®±à¯à®ªà¯à®ªà¯à®•à®³à¯",verb:"à®•à¯Šà®£à¯à®Ÿà®¿à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯"}};function e(l){return i[l]??null}let o={regex:"à®‰à®³à¯à®³à¯€à®Ÿà¯",email:"à®®à®¿à®©à¯à®©à®žà¯à®šà®²à¯ à®®à¯à®•à®µà®°à®¿",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO à®¤à¯‡à®¤à®¿ à®¨à¯‡à®°à®®à¯",date:"ISO à®¤à¯‡à®¤à®¿",time:"ISO à®¨à¯‡à®°à®®à¯",duration:"ISO à®•à®¾à®² à®…à®³à®µà¯",ipv4:"IPv4 à®®à¯à®•à®µà®°à®¿",ipv6:"IPv6 à®®à¯à®•à®µà®°à®¿",cidrv4:"IPv4 à®µà®°à®®à¯à®ªà¯",cidrv6:"IPv6 à®µà®°à®®à¯à®ªà¯",base64:"base64-encoded à®šà®°à®®à¯",base64url:"base64url-encoded à®šà®°à®®à¯",json_string:"JSON à®šà®°à®®à¯",e164:"E.164 à®Žà®£à¯",jwt:"JWT",template_literal:"input"},h={nan:"NaN",number:"à®Žà®£à¯",array:"à®…à®£à®¿",null:"à®µà¯†à®±à¯à®®à¯ˆ"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ instanceof ${l.expected}, à®ªà¯†à®±à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${s}`:`à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${f}, à®ªà¯†à®±à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${s}`}case"invalid_value":return l.values.length===1?`à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${vn(l.values[0])}`:`à®¤à®µà®±à®¾à®© à®µà®¿à®°à¯à®ªà¯à®ªà®®à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${ai(l.values,"|")} à®‡à®²à¯ à®’à®©à¯à®±à¯`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`à®®à®¿à®• à®ªà¯†à®°à®¿à®¯à®¤à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${l.origin??"à®®à®¤à®¿à®ªà¯à®ªà¯"} ${f}${l.maximum.toString()} ${x.unit??"à®‰à®±à¯à®ªà¯à®ªà¯à®•à®³à¯"} à®†à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:`à®®à®¿à®• à®ªà¯†à®°à®¿à®¯à®¤à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${l.origin??"à®®à®¤à®¿à®ªà¯à®ªà¯"} ${f}${l.maximum.toString()} à®†à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`à®®à®¿à®•à®šà¯ à®šà®¿à®±à®¿à®¯à®¤à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${l.origin} ${f}${l.minimum.toString()} ${x.unit} à®†à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:`à®®à®¿à®•à®šà¯ à®šà®¿à®±à®¿à®¯à®¤à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${l.origin} ${f}${l.minimum.toString()} à®†à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`}case"invalid_format":{let f=l;return f.format==="starts_with"?`à®¤à®µà®±à®¾à®© à®šà®°à®®à¯: "${f.prefix}" à®‡à®²à¯ à®¤à¯Šà®Ÿà®™à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:f.format==="ends_with"?`à®¤à®µà®±à®¾à®© à®šà®°à®®à¯: "${f.suffix}" à®‡à®²à¯ à®®à¯à®Ÿà®¿à®µà®Ÿà¯ˆà®¯ à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:f.format==="includes"?`à®¤à®µà®±à®¾à®© à®šà®°à®®à¯: "${f.includes}" à® à®‰à®³à¯à®³à®Ÿà®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:f.format==="regex"?`à®¤à®µà®±à®¾à®© à®šà®°à®®à¯: ${f.pattern} à®®à¯à®±à¯ˆà®ªà®¾à®Ÿà¯à®Ÿà¯à®Ÿà®©à¯ à®ªà¯Šà®°à¯à®¨à¯à®¤ à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:`à®¤à®µà®±à®¾à®© ${o[f.format]??l.format}`}case"not_multiple_of":return`à®¤à®µà®±à®¾à®© à®Žà®£à¯: ${l.divisor} à®‡à®©à¯ à®ªà®²à®®à®¾à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`;case"unrecognized_keys":return`à®…à®Ÿà¯ˆà®¯à®¾à®³à®®à¯ à®¤à¯†à®°à®¿à®¯à®¾à®¤ à®µà®¿à®šà¯ˆ${l.keys.length>1?"à®•à®³à¯":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`${l.origin} à®‡à®²à¯ à®¤à®µà®±à®¾à®© à®µà®¿à®šà¯ˆ`;case"invalid_union":return"à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯";case"invalid_element":return`${l.origin} à®‡à®²à¯ à®¤à®µà®±à®¾à®© à®®à®¤à®¿à®ªà¯à®ªà¯`;default:return"à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯"}}};function Wq(){return{localeError:Zq()}}var qq=()=>{let i={string:{unit:"à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£",verb:"à¸„à¸§à¸£à¸¡à¸µ"},file:{unit:"à¹„à¸šà¸•à¹Œ",verb:"à¸„à¸§à¸£à¸¡à¸µ"},array:{unit:"à¸£à¸²à¸¢à¸à¸²à¸£",verb:"à¸„à¸§à¸£à¸¡à¸µ"},set:{unit:"à¸£à¸²à¸¢à¸à¸²à¸£",verb:"à¸„à¸§à¸£à¸¡à¸µ"}};function e(l){return i[l]??null}let o={regex:"à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸›à¹‰à¸­à¸™",email:"à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸­à¸µà¹€à¸¡à¸¥",url:"URL",emoji:"à¸­à¸´à¹‚à¸¡à¸ˆà¸´",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸§à¸¥à¸²à¹à¸šà¸š ISO",date:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸šà¸š ISO",time:"à¹€à¸§à¸¥à¸²à¹à¸šà¸š ISO",duration:"à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¹à¸šà¸š ISO",ipv4:"à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ IPv4",ipv6:"à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ IPv6",cidrv4:"à¸Šà¹ˆà¸§à¸‡ IP à¹à¸šà¸š IPv4",cidrv6:"à¸Šà¹ˆà¸§à¸‡ IP à¹à¸šà¸š IPv6",base64:"à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸šà¸š Base64",base64url:"à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸šà¸š Base64 à¸ªà¸³à¸«à¸£à¸±à¸š URL",json_string:"à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸šà¸š JSON",e164:"à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸žà¸—à¹Œà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸›à¸£à¸°à¹€à¸—à¸¨ (E.164)",jwt:"à¹‚à¸—à¹€à¸„à¸™ JWT",template_literal:"à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸›à¹‰à¸­à¸™"},h={nan:"NaN",number:"à¸•à¸±à¸§à¹€à¸¥à¸‚",array:"à¸­à¸²à¸£à¹Œà¹€à¸£à¸¢à¹Œ (Array)",null:"à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸² (null)"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸„à¸§à¸£à¹€à¸›à¹‡à¸™ instanceof ${l.expected} à¹à¸•à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š ${s}`:`à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸„à¸§à¸£à¹€à¸›à¹‡à¸™ ${f} à¹à¸•à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š ${s}`}case"invalid_value":return l.values.length===1?`à¸„à¹ˆà¸²à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸„à¸§à¸£à¹€à¸›à¹‡à¸™ ${vn(l.values[0])}`:`à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸„à¸§à¸£à¹€à¸›à¹‡à¸™à¸«à¸™à¸¶à¹ˆà¸‡à¹ƒà¸™ ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™":"à¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²",x=e(l.origin);return x?`à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”: ${l.origin??"à¸„à¹ˆà¸²"} à¸„à¸§à¸£à¸¡à¸µ${f} ${l.maximum.toString()} ${x.unit??"à¸£à¸²à¸¢à¸à¸²à¸£"}`:`à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”: ${l.origin??"à¸„à¹ˆà¸²"} à¸„à¸§à¸£à¸¡à¸µ${f} ${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?"à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢":"à¸¡à¸²à¸à¸à¸§à¹ˆà¸²",x=e(l.origin);return x?`à¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸à¸³à¸«à¸™à¸”: ${l.origin} à¸„à¸§à¸£à¸¡à¸µ${f} ${l.minimum.toString()} ${x.unit}`:`à¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸à¸³à¸«à¸™à¸”: ${l.origin} à¸„à¸§à¸£à¸¡à¸µ${f} ${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸‚à¸¶à¹‰à¸™à¸•à¹‰à¸™à¸”à¹‰à¸§à¸¢ "${f.prefix}"`:f.format==="ends_with"?`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸¥à¸‡à¸—à¹‰à¸²à¸¢à¸”à¹‰à¸§à¸¢ "${f.suffix}"`:f.format==="includes"?`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸¡à¸µ "${f.includes}" à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡`:f.format==="regex"?`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸•à¹‰à¸­à¸‡à¸•à¸£à¸‡à¸à¸±à¸šà¸£à¸¹à¸›à¹à¸šà¸šà¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸” ${f.pattern}`:`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: ${o[f.format]??l.format}`}case"not_multiple_of":return`à¸•à¸±à¸§à¹€à¸¥à¸‚à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¸ˆà¸³à¸™à¸§à¸™à¸—à¸µà¹ˆà¸«à¸²à¸£à¸”à¹‰à¸§à¸¢ ${l.divisor} à¹„à¸”à¹‰à¸¥à¸‡à¸•à¸±à¸§`;case"unrecognized_keys":return`à¸žà¸šà¸„à¸µà¸¢à¹Œà¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸£à¸¹à¹‰à¸ˆà¸±à¸: ${ai(l.keys,", ")}`;case"invalid_key":return`à¸„à¸µà¸¢à¹Œà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¹ƒà¸™ ${l.origin}`;case"invalid_union":return"à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¹„à¸¡à¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸£à¸¹à¸›à¹à¸šà¸šà¸¢à¸¹à¹€à¸™à¸µà¸¢à¸™à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”à¹„à¸§à¹‰";case"invalid_element":return`à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¹ƒà¸™ ${l.origin}`;default:return"à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡"}}};function Xq(){return{localeError:qq()}}var Jq=()=>{let i={string:{unit:"karakter",verb:"olmalÄ±"},file:{unit:"bayt",verb:"olmalÄ±"},array:{unit:"Ã¶ÄŸe",verb:"olmalÄ±"},set:{unit:"Ã¶ÄŸe",verb:"olmalÄ±"}};function e(l){return i[l]??null}let o={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO sÃ¼re",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aralÄ±ÄŸÄ±",cidrv6:"IPv6 aralÄ±ÄŸÄ±",base64:"base64 ile ÅŸifrelenmiÅŸ metin",base64url:"base64url ile ÅŸifrelenmiÅŸ metin",json_string:"JSON dizesi",e164:"E.164 sayÄ±sÄ±",jwt:"JWT",template_literal:"Åžablon dizesi"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`GeÃ§ersiz deÄŸer: beklenen instanceof ${l.expected}, alÄ±nan ${s}`:`GeÃ§ersiz deÄŸer: beklenen ${f}, alÄ±nan ${s}`}case"invalid_value":return l.values.length===1?`GeÃ§ersiz deÄŸer: beklenen ${vn(l.values[0])}`:`GeÃ§ersiz seÃ§enek: aÅŸaÄŸÄ±dakilerden biri olmalÄ±: ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ã‡ok bÃ¼yÃ¼k: beklenen ${l.origin??"deÄŸer"} ${f}${l.maximum.toString()} ${x.unit??"Ã¶ÄŸe"}`:`Ã‡ok bÃ¼yÃ¼k: beklenen ${l.origin??"deÄŸer"} ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Ã‡ok kÃ¼Ã§Ã¼k: beklenen ${l.origin} ${f}${l.minimum.toString()} ${x.unit}`:`Ã‡ok kÃ¼Ã§Ã¼k: beklenen ${l.origin} ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`GeÃ§ersiz metin: "${f.prefix}" ile baÅŸlamalÄ±`:f.format==="ends_with"?`GeÃ§ersiz metin: "${f.suffix}" ile bitmeli`:f.format==="includes"?`GeÃ§ersiz metin: "${f.includes}" iÃ§ermeli`:f.format==="regex"?`GeÃ§ersiz metin: ${f.pattern} desenine uymalÄ±`:`GeÃ§ersiz ${o[f.format]??l.format}`}case"not_multiple_of":return`GeÃ§ersiz sayÄ±: ${l.divisor} ile tam bÃ¶lÃ¼nebilmeli`;case"unrecognized_keys":return`TanÄ±nmayan anahtar${l.keys.length>1?"lar":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`${l.origin} iÃ§inde geÃ§ersiz anahtar`;case"invalid_union":return"GeÃ§ersiz deÄŸer";case"invalid_element":return`${l.origin} iÃ§inde geÃ§ersiz deÄŸer`;default:return"GeÃ§ersiz deÄŸer"}}};function Yq(){return{localeError:Jq()}}var Kq=()=>{let i={string:{unit:"ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ–Ð²",verb:"Ð¼Ð°Ñ‚Ð¸Ð¼Ðµ"},file:{unit:"Ð±Ð°Ð¹Ñ‚Ñ–Ð²",verb:"Ð¼Ð°Ñ‚Ð¸Ð¼Ðµ"},array:{unit:"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ–Ð²",verb:"Ð¼Ð°Ñ‚Ð¸Ð¼Ðµ"},set:{unit:"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ–Ð²",verb:"Ð¼Ð°Ñ‚Ð¸Ð¼Ðµ"}};function e(l){return i[l]??null}let o={regex:"Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–",email:"Ð°Ð´Ñ€ÐµÑÐ° ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸",url:"URL",emoji:"ÐµÐ¼Ð¾Ð´Ð·Ñ–",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"Ð´Ð°Ñ‚Ð° Ñ‚Ð° Ñ‡Ð°Ñ ISO",date:"Ð´Ð°Ñ‚Ð° ISO",time:"Ñ‡Ð°Ñ ISO",duration:"Ñ‚Ñ€Ð¸Ð²Ð°Ð»Ñ–ÑÑ‚ÑŒ ISO",ipv4:"Ð°Ð´Ñ€ÐµÑÐ° IPv4",ipv6:"Ð°Ð´Ñ€ÐµÑÐ° IPv6",cidrv4:"Ð´Ñ–Ð°Ð¿Ð°Ð·Ð¾Ð½ IPv4",cidrv6:"Ð´Ñ–Ð°Ð¿Ð°Ð·Ð¾Ð½ IPv6",base64:"Ñ€ÑÐ´Ð¾Ðº Ñƒ ÐºÐ¾Ð´ÑƒÐ²Ð°Ð½Ð½Ñ– base64",base64url:"Ñ€ÑÐ´Ð¾Ðº Ñƒ ÐºÐ¾Ð´ÑƒÐ²Ð°Ð½Ð½Ñ– base64url",json_string:"Ñ€ÑÐ´Ð¾Ðº JSON",e164:"Ð½Ð¾Ð¼ÐµÑ€ E.164",jwt:"JWT",template_literal:"Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–"},h={nan:"NaN",number:"Ñ‡Ð¸ÑÐ»Ð¾",array:"Ð¼Ð°ÑÐ¸Ð²"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ instanceof ${l.expected}, Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð¾ ${s}`:`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ ${f}, Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð¾ ${s}`}case"invalid_value":return l.values.length===1?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ ${vn(l.values[0])}`:`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð° Ð¾Ð¿Ñ†Ñ–Ñ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ Ð¾Ð´Ð½Ðµ Ð· ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð¾ Ð²ÐµÐ»Ð¸ÐºÐµ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ, Ñ‰Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ"} ${x.verb} ${f}${l.maximum.toString()} ${x.unit??"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ–Ð²"}`:`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð¾ Ð²ÐµÐ»Ð¸ÐºÐµ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ, Ñ‰Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ"} Ð±ÑƒÐ´Ðµ ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð¾ Ð¼Ð°Ð»Ðµ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ, Ñ‰Ð¾ ${l.origin} ${x.verb} ${f}${l.minimum.toString()} ${x.unit}`:`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð¾ Ð¼Ð°Ð»Ðµ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ, Ñ‰Ð¾ ${l.origin} Ð±ÑƒÐ´Ðµ ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº: Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð¿Ð¾Ñ‡Ð¸Ð½Ð°Ñ‚Ð¸ÑÑ Ð· "${f.prefix}"`:f.format==="ends_with"?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº: Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð·Ð°ÐºÑ–Ð½Ñ‡ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð½Ð° "${f.suffix}"`:f.format==="includes"?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº: Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð¼Ñ–ÑÑ‚Ð¸Ñ‚Ð¸ "${f.includes}"`:f.format==="regex"?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº: Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ñ‚Ð¸ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ ${f.pattern}`:`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ ${o[f.format]??l.format}`}case"not_multiple_of":return`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ðµ Ñ‡Ð¸ÑÐ»Ð¾: Ð¿Ð¾Ð²Ð¸Ð½Ð½Ð¾ Ð±ÑƒÑ‚Ð¸ ÐºÑ€Ð°Ñ‚Ð½Ð¸Ð¼ ${l.divisor}`;case"unrecognized_keys":return`ÐÐµÑ€Ð¾Ð·Ð¿Ñ–Ð·Ð½Ð°Ð½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡${l.keys.length>1?"Ñ–":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ Ñƒ ${l.origin}`;case"invalid_union":return"ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–";case"invalid_element":return`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ Ñƒ ${l.origin}`;default:return"ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–"}}};function P3(){return{localeError:Kq()}}function Qq(){return P3()}var e9=()=>{let i={string:{unit:"Ø­Ø±ÙˆÙ",verb:"ÛÙˆÙ†Ø§"},file:{unit:"Ø¨Ø§Ø¦Ù¹Ø³",verb:"ÛÙˆÙ†Ø§"},array:{unit:"Ø¢Ø¦Ù¹Ù…Ø²",verb:"ÛÙˆÙ†Ø§"},set:{unit:"Ø¢Ø¦Ù¹Ù…Ø²",verb:"ÛÙˆÙ†Ø§"}};function e(l){return i[l]??null}let o={regex:"Ø§Ù† Ù¾Ù¹",email:"Ø§ÛŒ Ù…ÛŒÙ„ Ø§ÛŒÚˆØ±ÛŒØ³",url:"ÛŒÙˆ Ø¢Ø± Ø§ÛŒÙ„",emoji:"Ø§ÛŒÙ…ÙˆØ¬ÛŒ",uuid:"ÛŒÙˆ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",uuidv4:"ÛŒÙˆ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ ÙˆÛŒ 4",uuidv6:"ÛŒÙˆ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ ÙˆÛŒ 6",nanoid:"Ù†ÛŒÙ†Ùˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",guid:"Ø¬ÛŒ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",cuid:"Ø³ÛŒ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",cuid2:"Ø³ÛŒ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ 2",ulid:"ÛŒÙˆ Ø§ÛŒÙ„ Ø¢Ø¦ÛŒ ÚˆÛŒ",xid:"Ø§ÛŒÚ©Ø³ Ø¢Ø¦ÛŒ ÚˆÛŒ",ksuid:"Ú©Û’ Ø§ÛŒØ³ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",datetime:"Ø¢Ø¦ÛŒ Ø§ÛŒØ³ Ø§Ùˆ ÚˆÛŒÙ¹ Ù¹Ø§Ø¦Ù…",date:"Ø¢Ø¦ÛŒ Ø§ÛŒØ³ Ø§Ùˆ ØªØ§Ø±ÛŒØ®",time:"Ø¢Ø¦ÛŒ Ø§ÛŒØ³ Ø§Ùˆ ÙˆÙ‚Øª",duration:"Ø¢Ø¦ÛŒ Ø§ÛŒØ³ Ø§Ùˆ Ù…Ø¯Øª",ipv4:"Ø¢Ø¦ÛŒ Ù¾ÛŒ ÙˆÛŒ 4 Ø§ÛŒÚˆØ±ÛŒØ³",ipv6:"Ø¢Ø¦ÛŒ Ù¾ÛŒ ÙˆÛŒ 6 Ø§ÛŒÚˆØ±ÛŒØ³",cidrv4:"Ø¢Ø¦ÛŒ Ù¾ÛŒ ÙˆÛŒ 4 Ø±ÛŒÙ†Ø¬",cidrv6:"Ø¢Ø¦ÛŒ Ù¾ÛŒ ÙˆÛŒ 6 Ø±ÛŒÙ†Ø¬",base64:"Ø¨ÛŒØ³ 64 Ø§Ù† Ú©ÙˆÚˆÚˆ Ø³Ù¹Ø±Ù†Ú¯",base64url:"Ø¨ÛŒØ³ 64 ÛŒÙˆ Ø¢Ø± Ø§ÛŒÙ„ Ø§Ù† Ú©ÙˆÚˆÚˆ Ø³Ù¹Ø±Ù†Ú¯",json_string:"Ø¬Û’ Ø§ÛŒØ³ Ø§Ùˆ Ø§ÛŒÙ† Ø³Ù¹Ø±Ù†Ú¯",e164:"Ø§ÛŒ 164 Ù†Ù…Ø¨Ø±",jwt:"Ø¬Û’ ÚˆØ¨Ù„ÛŒÙˆ Ù¹ÛŒ",template_literal:"Ø§Ù† Ù¾Ù¹"},h={nan:"NaN",number:"Ù†Ù…Ø¨Ø±",array:"Ø¢Ø±Û’",null:"Ù†Ù„"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ØºÙ„Ø· Ø§Ù† Ù¾Ù¹: instanceof ${l.expected} Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§ØŒ ${s} Ù…ÙˆØµÙˆÙ„ ÛÙˆØ§`:`ØºÙ„Ø· Ø§Ù† Ù¾Ù¹: ${f} Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§ØŒ ${s} Ù…ÙˆØµÙˆÙ„ ÛÙˆØ§`}case"invalid_value":return l.values.length===1?`ØºÙ„Ø· Ø§Ù† Ù¾Ù¹: ${vn(l.values[0])} Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§`:`ØºÙ„Ø· Ø¢Ù¾Ø´Ù†: ${ai(l.values,"|")} Ù…ÛŒÚº Ø³Û’ Ø§ÛŒÚ© Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ø¨ÛØª Ø¨Ú‘Ø§: ${l.origin??"ÙˆÛŒÙ„ÛŒÙˆ"} Ú©Û’ ${f}${l.maximum.toString()} ${x.unit??"Ø¹Ù†Ø§ØµØ±"} ÛÙˆÙ†Û’ Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Û’`:`Ø¨ÛØª Ø¨Ú‘Ø§: ${l.origin??"ÙˆÛŒÙ„ÛŒÙˆ"} Ú©Ø§ ${f}${l.maximum.toString()} ÛÙˆÙ†Ø§ Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Ø¨ÛØª Ú†Ú¾ÙˆÙ¹Ø§: ${l.origin} Ú©Û’ ${f}${l.minimum.toString()} ${x.unit} ÛÙˆÙ†Û’ Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Û’`:`Ø¨ÛØª Ú†Ú¾ÙˆÙ¹Ø§: ${l.origin} Ú©Ø§ ${f}${l.minimum.toString()} ÛÙˆÙ†Ø§ Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ØºÙ„Ø· Ø³Ù¹Ø±Ù†Ú¯: "${f.prefix}" Ø³Û’ Ø´Ø±ÙˆØ¹ ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`:f.format==="ends_with"?`ØºÙ„Ø· Ø³Ù¹Ø±Ù†Ú¯: "${f.suffix}" Ù¾Ø± Ø®ØªÙ… ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`:f.format==="includes"?`ØºÙ„Ø· Ø³Ù¹Ø±Ù†Ú¯: "${f.includes}" Ø´Ø§Ù…Ù„ ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`:f.format==="regex"?`ØºÙ„Ø· Ø³Ù¹Ø±Ù†Ú¯: Ù¾ÛŒÙ¹Ø±Ù† ${f.pattern} Ø³Û’ Ù…ÛŒÚ† ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`:`ØºÙ„Ø· ${o[f.format]??l.format}`}case"not_multiple_of":return`ØºÙ„Ø· Ù†Ù…Ø¨Ø±: ${l.divisor} Ú©Ø§ Ù…Ø¶Ø§Ø¹Ù ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`;case"unrecognized_keys":return`ØºÛŒØ± ØªØ³Ù„ÛŒÙ… Ø´Ø¯Û Ú©ÛŒ${l.keys.length>1?"Ø²":""}: ${ai(l.keys,"ØŒ ")}`;case"invalid_key":return`${l.origin} Ù…ÛŒÚº ØºÙ„Ø· Ú©ÛŒ`;case"invalid_union":return"ØºÙ„Ø· Ø§Ù† Ù¾Ù¹";case"invalid_element":return`${l.origin} Ù…ÛŒÚº ØºÙ„Ø· ÙˆÛŒÙ„ÛŒÙˆ`;default:return"ØºÙ„Ø· Ø§Ù† Ù¾Ù¹"}}};function t9(){return{localeError:e9()}}var i9=()=>{let i={string:{unit:"belgi",verb:"boâ€˜lishi kerak"},file:{unit:"bayt",verb:"boâ€˜lishi kerak"},array:{unit:"element",verb:"boâ€˜lishi kerak"},set:{unit:"element",verb:"boâ€˜lishi kerak"}};function e(l){return i[l]??null}let o={regex:"kirish",email:"elektron pochta manzili",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO sana va vaqti",date:"ISO sana",time:"ISO vaqt",duration:"ISO davomiylik",ipv4:"IPv4 manzil",ipv6:"IPv6 manzil",mac:"MAC manzil",cidrv4:"IPv4 diapazon",cidrv6:"IPv6 diapazon",base64:"base64 kodlangan satr",base64url:"base64url kodlangan satr",json_string:"JSON satr",e164:"E.164 raqam",jwt:"JWT",template_literal:"kirish"},h={nan:"NaN",number:"raqam",array:"massiv"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Notoâ€˜gâ€˜ri kirish: kutilgan instanceof ${l.expected}, qabul qilingan ${s}`:`Notoâ€˜gâ€˜ri kirish: kutilgan ${f}, qabul qilingan ${s}`}case"invalid_value":return l.values.length===1?`Notoâ€˜gâ€˜ri kirish: kutilgan ${vn(l.values[0])}`:`Notoâ€˜gâ€˜ri variant: quyidagilardan biri kutilgan ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`Juda katta: kutilgan ${l.origin??"qiymat"} ${f}${l.maximum.toString()} ${x.unit} ${x.verb}`:`Juda katta: kutilgan ${l.origin??"qiymat"} ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`Juda kichik: kutilgan ${l.origin} ${f}${l.minimum.toString()} ${x.unit} ${x.verb}`:`Juda kichik: kutilgan ${l.origin} ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Notoâ€˜gâ€˜ri satr: "${f.prefix}" bilan boshlanishi kerak`:f.format==="ends_with"?`Notoâ€˜gâ€˜ri satr: "${f.suffix}" bilan tugashi kerak`:f.format==="includes"?`Notoâ€˜gâ€˜ri satr: "${f.includes}" ni oâ€˜z ichiga olishi kerak`:f.format==="regex"?`Notoâ€˜gâ€˜ri satr: ${f.pattern} shabloniga mos kelishi kerak`:`Notoâ€˜gâ€˜ri ${o[f.format]??l.format}`}case"not_multiple_of":return`Notoâ€˜gâ€˜ri raqam: ${l.divisor} ning karralisi boâ€˜lishi kerak`;case"unrecognized_keys":return`Nomaâ€™lum kalit${l.keys.length>1?"lar":""}: ${ai(l.keys,", ")}`;case"invalid_key":return`${l.origin} dagi kalit notoâ€˜gâ€˜ri`;case"invalid_union":return"Notoâ€˜gâ€˜ri kirish";case"invalid_element":return`${l.origin} da notoâ€˜gâ€˜ri qiymat`;default:return"Notoâ€˜gâ€˜ri kirish"}}};function n9(){return{localeError:i9()}}var r9=()=>{let i={string:{unit:"kÃ½ tá»±",verb:"cÃ³"},file:{unit:"byte",verb:"cÃ³"},array:{unit:"pháº§n tá»­",verb:"cÃ³"},set:{unit:"pháº§n tá»­",verb:"cÃ³"}};function e(l){return i[l]??null}let o={regex:"Ä‘áº§u vÃ o",email:"Ä‘á»‹a chá»‰ email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ngÃ y giá» ISO",date:"ngÃ y ISO",time:"giá» ISO",duration:"khoáº£ng thá»i gian ISO",ipv4:"Ä‘á»‹a chá»‰ IPv4",ipv6:"Ä‘á»‹a chá»‰ IPv6",cidrv4:"dáº£i IPv4",cidrv6:"dáº£i IPv6",base64:"chuá»—i mÃ£ hÃ³a base64",base64url:"chuá»—i mÃ£ hÃ³a base64url",json_string:"chuá»—i JSON",e164:"sá»‘ E.164",jwt:"JWT",template_literal:"Ä‘áº§u vÃ o"},h={nan:"NaN",number:"sá»‘",array:"máº£ng"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Äáº§u vÃ o khÃ´ng há»£p lá»‡: mong Ä‘á»£i instanceof ${l.expected}, nháº­n Ä‘Æ°á»£c ${s}`:`Äáº§u vÃ o khÃ´ng há»£p lá»‡: mong Ä‘á»£i ${f}, nháº­n Ä‘Æ°á»£c ${s}`}case"invalid_value":return l.values.length===1?`Äáº§u vÃ o khÃ´ng há»£p lá»‡: mong Ä‘á»£i ${vn(l.values[0])}`:`TÃ¹y chá»n khÃ´ng há»£p lá»‡: mong Ä‘á»£i má»™t trong cÃ¡c giÃ¡ trá»‹ ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`QuÃ¡ lá»›n: mong Ä‘á»£i ${l.origin??"giÃ¡ trá»‹"} ${x.verb} ${f}${l.maximum.toString()} ${x.unit??"pháº§n tá»­"}`:`QuÃ¡ lá»›n: mong Ä‘á»£i ${l.origin??"giÃ¡ trá»‹"} ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`QuÃ¡ nhá»: mong Ä‘á»£i ${l.origin} ${x.verb} ${f}${l.minimum.toString()} ${x.unit}`:`QuÃ¡ nhá»: mong Ä‘á»£i ${l.origin} ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`Chuá»—i khÃ´ng há»£p lá»‡: pháº£i báº¯t Ä‘áº§u báº±ng "${f.prefix}"`:f.format==="ends_with"?`Chuá»—i khÃ´ng há»£p lá»‡: pháº£i káº¿t thÃºc báº±ng "${f.suffix}"`:f.format==="includes"?`Chuá»—i khÃ´ng há»£p lá»‡: pháº£i bao gá»“m "${f.includes}"`:f.format==="regex"?`Chuá»—i khÃ´ng há»£p lá»‡: pháº£i khá»›p vá»›i máº«u ${f.pattern}`:`${o[f.format]??l.format} khÃ´ng há»£p lá»‡`}case"not_multiple_of":return`Sá»‘ khÃ´ng há»£p lá»‡: pháº£i lÃ  bá»™i sá»‘ cá»§a ${l.divisor}`;case"unrecognized_keys":return`KhÃ³a khÃ´ng Ä‘Æ°á»£c nháº­n dáº¡ng: ${ai(l.keys,", ")}`;case"invalid_key":return`KhÃ³a khÃ´ng há»£p lá»‡ trong ${l.origin}`;case"invalid_union":return"Äáº§u vÃ o khÃ´ng há»£p lá»‡";case"invalid_element":return`GiÃ¡ trá»‹ khÃ´ng há»£p lá»‡ trong ${l.origin}`;default:return"Äáº§u vÃ o khÃ´ng há»£p lá»‡"}}};function o9(){return{localeError:r9()}}var s9=()=>{let i={string:{unit:"å­—ç¬¦",verb:"åŒ…å«"},file:{unit:"å­—èŠ‚",verb:"åŒ…å«"},array:{unit:"é¡¹",verb:"åŒ…å«"},set:{unit:"é¡¹",verb:"åŒ…å«"}};function e(l){return i[l]??null}let o={regex:"è¾“å…¥",email:"ç”µå­é‚®ä»¶",url:"URL",emoji:"è¡¨æƒ…ç¬¦å·",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISOæ—¥æœŸæ—¶é—´",date:"ISOæ—¥æœŸ",time:"ISOæ—¶é—´",duration:"ISOæ—¶é•¿",ipv4:"IPv4åœ°å€",ipv6:"IPv6åœ°å€",cidrv4:"IPv4ç½‘æ®µ",cidrv6:"IPv6ç½‘æ®µ",base64:"base64ç¼–ç å­—ç¬¦ä¸²",base64url:"base64urlç¼–ç å­—ç¬¦ä¸²",json_string:"JSONå­—ç¬¦ä¸²",e164:"E.164å·ç ",jwt:"JWT",template_literal:"è¾“å…¥"},h={nan:"NaN",number:"æ•°å­—",array:"æ•°ç»„",null:"ç©ºå€¼(null)"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`æ— æ•ˆè¾“å…¥ï¼šæœŸæœ› instanceof ${l.expected}ï¼Œå®žé™…æŽ¥æ”¶ ${s}`:`æ— æ•ˆè¾“å…¥ï¼šæœŸæœ› ${f}ï¼Œå®žé™…æŽ¥æ”¶ ${s}`}case"invalid_value":return l.values.length===1?`æ— æ•ˆè¾“å…¥ï¼šæœŸæœ› ${vn(l.values[0])}`:`æ— æ•ˆé€‰é¡¹ï¼šæœŸæœ›ä»¥ä¸‹ä¹‹ä¸€ ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`æ•°å€¼è¿‡å¤§ï¼šæœŸæœ› ${l.origin??"å€¼"} ${f}${l.maximum.toString()} ${x.unit??"ä¸ªå…ƒç´ "}`:`æ•°å€¼è¿‡å¤§ï¼šæœŸæœ› ${l.origin??"å€¼"} ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`æ•°å€¼è¿‡å°ï¼šæœŸæœ› ${l.origin} ${f}${l.minimum.toString()} ${x.unit}`:`æ•°å€¼è¿‡å°ï¼šæœŸæœ› ${l.origin} ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`æ— æ•ˆå­—ç¬¦ä¸²ï¼šå¿…é¡»ä»¥ "${f.prefix}" å¼€å¤´`:f.format==="ends_with"?`æ— æ•ˆå­—ç¬¦ä¸²ï¼šå¿…é¡»ä»¥ "${f.suffix}" ç»“å°¾`:f.format==="includes"?`æ— æ•ˆå­—ç¬¦ä¸²ï¼šå¿…é¡»åŒ…å« "${f.includes}"`:f.format==="regex"?`æ— æ•ˆå­—ç¬¦ä¸²ï¼šå¿…é¡»æ»¡è¶³æ­£åˆ™è¡¨è¾¾å¼ ${f.pattern}`:`æ— æ•ˆ${o[f.format]??l.format}`}case"not_multiple_of":return`æ— æ•ˆæ•°å­—ï¼šå¿…é¡»æ˜¯ ${l.divisor} çš„å€æ•°`;case"unrecognized_keys":return`å‡ºçŽ°æœªçŸ¥çš„é”®(key): ${ai(l.keys,", ")}`;case"invalid_key":return`${l.origin} ä¸­çš„é”®(key)æ— æ•ˆ`;case"invalid_union":return"æ— æ•ˆè¾“å…¥";case"invalid_element":return`${l.origin} ä¸­åŒ…å«æ— æ•ˆå€¼(value)`;default:return"æ— æ•ˆè¾“å…¥"}}};function a9(){return{localeError:s9()}}var l9=()=>{let i={string:{unit:"å­—å…ƒ",verb:"æ“æœ‰"},file:{unit:"ä½å…ƒçµ„",verb:"æ“æœ‰"},array:{unit:"é …ç›®",verb:"æ“æœ‰"},set:{unit:"é …ç›®",verb:"æ“æœ‰"}};function e(l){return i[l]??null}let o={regex:"è¼¸å…¥",email:"éƒµä»¶åœ°å€",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO æ—¥æœŸæ™‚é–“",date:"ISO æ—¥æœŸ",time:"ISO æ™‚é–“",duration:"ISO æœŸé–“",ipv4:"IPv4 ä½å€",ipv6:"IPv6 ä½å€",cidrv4:"IPv4 ç¯„åœ",cidrv6:"IPv6 ç¯„åœ",base64:"base64 ç·¨ç¢¼å­—ä¸²",base64url:"base64url ç·¨ç¢¼å­—ä¸²",json_string:"JSON å­—ä¸²",e164:"E.164 æ•¸å€¼",jwt:"JWT",template_literal:"è¼¸å…¥"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ç„¡æ•ˆçš„è¼¸å…¥å€¼ï¼šé æœŸç‚º instanceof ${l.expected}ï¼Œä½†æ”¶åˆ° ${s}`:`ç„¡æ•ˆçš„è¼¸å…¥å€¼ï¼šé æœŸç‚º ${f}ï¼Œä½†æ”¶åˆ° ${s}`}case"invalid_value":return l.values.length===1?`ç„¡æ•ˆçš„è¼¸å…¥å€¼ï¼šé æœŸç‚º ${vn(l.values[0])}`:`ç„¡æ•ˆçš„é¸é …ï¼šé æœŸç‚ºä»¥ä¸‹å…¶ä¸­ä¹‹ä¸€ ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`æ•¸å€¼éŽå¤§ï¼šé æœŸ ${l.origin??"å€¼"} æ‡‰ç‚º ${f}${l.maximum.toString()} ${x.unit??"å€‹å…ƒç´ "}`:`æ•¸å€¼éŽå¤§ï¼šé æœŸ ${l.origin??"å€¼"} æ‡‰ç‚º ${f}${l.maximum.toString()}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`æ•¸å€¼éŽå°ï¼šé æœŸ ${l.origin} æ‡‰ç‚º ${f}${l.minimum.toString()} ${x.unit}`:`æ•¸å€¼éŽå°ï¼šé æœŸ ${l.origin} æ‡‰ç‚º ${f}${l.minimum.toString()}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`ç„¡æ•ˆçš„å­—ä¸²ï¼šå¿…é ˆä»¥ "${f.prefix}" é–‹é ­`:f.format==="ends_with"?`ç„¡æ•ˆçš„å­—ä¸²ï¼šå¿…é ˆä»¥ "${f.suffix}" çµå°¾`:f.format==="includes"?`ç„¡æ•ˆçš„å­—ä¸²ï¼šå¿…é ˆåŒ…å« "${f.includes}"`:f.format==="regex"?`ç„¡æ•ˆçš„å­—ä¸²ï¼šå¿…é ˆç¬¦åˆæ ¼å¼ ${f.pattern}`:`ç„¡æ•ˆçš„ ${o[f.format]??l.format}`}case"not_multiple_of":return`ç„¡æ•ˆçš„æ•¸å­—ï¼šå¿…é ˆç‚º ${l.divisor} çš„å€æ•¸`;case"unrecognized_keys":return`ç„¡æ³•è­˜åˆ¥çš„éµå€¼${l.keys.length>1?"å€‘":""}ï¼š${ai(l.keys,"ã€")}`;case"invalid_key":return`${l.origin} ä¸­æœ‰ç„¡æ•ˆçš„éµå€¼`;case"invalid_union":return"ç„¡æ•ˆçš„è¼¸å…¥å€¼";case"invalid_element":return`${l.origin} ä¸­æœ‰ç„¡æ•ˆçš„å€¼`;default:return"ç„¡æ•ˆçš„è¼¸å…¥å€¼"}}};function c9(){return{localeError:l9()}}var u9=()=>{let i={string:{unit:"Ã mi",verb:"nÃ­"},file:{unit:"bytes",verb:"nÃ­"},array:{unit:"nkan",verb:"nÃ­"},set:{unit:"nkan",verb:"nÃ­"}};function e(l){return i[l]??null}let o={regex:"áº¹Ì€rá» Ã¬bÃ¡wá»lÃ©",email:"Ã dÃ­ráº¹ÌsÃ¬ Ã¬máº¹ÌlÃ¬",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"Ã kÃ³kÃ² ISO",date:"á»já»Ì ISO",time:"Ã kÃ³kÃ² ISO",duration:"Ã kÃ³kÃ² tÃ³ pÃ© ISO",ipv4:"Ã dÃ­ráº¹ÌsÃ¬ IPv4",ipv6:"Ã dÃ­ráº¹ÌsÃ¬ IPv6",cidrv4:"Ã gbÃ¨gbÃ¨ IPv4",cidrv6:"Ã gbÃ¨gbÃ¨ IPv6",base64:"á»Ì€rá»Ì€ tÃ­ a ká»Ì nÃ­ base64",base64url:"á»Ì€rá»Ì€ base64url",json_string:"á»Ì€rá»Ì€ JSON",e164:"ná»ÌmbÃ  E.164",jwt:"JWT",template_literal:"áº¹Ì€rá» Ã¬bÃ¡wá»lÃ©"},h={nan:"NaN",number:"ná»ÌmbÃ ",array:"akopá»"};return l=>{switch(l.code){case"invalid_type":{let f=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e: a nÃ­ lÃ¡ti fi instanceof ${l.expected}, Ã má»Ì€ a rÃ­ ${s}`:`ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e: a nÃ­ lÃ¡ti fi ${f}, Ã má»Ì€ a rÃ­ ${s}`}case"invalid_value":return l.values.length===1?`ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e: a nÃ­ lÃ¡ti fi ${vn(l.values[0])}`:`Ã€á¹£Ã yÃ n aá¹£Ã¬á¹£e: yan á»Ì€kan lÃ¡ra ${ai(l.values,"|")}`;case"too_big":{let f=l.inclusive?"<=":"<",x=e(l.origin);return x?`TÃ³ pá»Ì€ jÃ¹: a nÃ­ lÃ¡ti jáº¹Ì pÃ© ${l.origin??"iye"} ${x.verb} ${f}${l.maximum} ${x.unit}`:`TÃ³ pá»Ì€ jÃ¹: a nÃ­ lÃ¡ti jáº¹Ì ${f}${l.maximum}`}case"too_small":{let f=l.inclusive?">=":">",x=e(l.origin);return x?`KÃ©rÃ© ju: a nÃ­ lÃ¡ti jáº¹Ì pÃ© ${l.origin} ${x.verb} ${f}${l.minimum} ${x.unit}`:`KÃ©rÃ© ju: a nÃ­ lÃ¡ti jáº¹Ì ${f}${l.minimum}`}case"invalid_format":{let f=l;return f.format==="starts_with"?`á»ŒÌ€rá»Ì€ aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ báº¹Ì€ráº¹Ì€ páº¹Ì€lÃº "${f.prefix}"`:f.format==="ends_with"?`á»ŒÌ€rá»Ì€ aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ parÃ­ páº¹Ì€lÃº "${f.suffix}"`:f.format==="includes"?`á»ŒÌ€rá»Ì€ aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ nÃ­ "${f.includes}"`:f.format==="regex"?`á»ŒÌ€rá»Ì€ aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ bÃ¡ Ã páº¹áº¹ráº¹ mu ${f.pattern}`:`Aá¹£Ã¬á¹£e: ${o[f.format]??l.format}`}case"not_multiple_of":return`Ná»ÌmbÃ  aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ jáº¹Ì Ã¨yÃ  pÃ­pÃ­n ti ${l.divisor}`;case"unrecognized_keys":return`Bá»tÃ¬nÃ¬ Ã Ã¬má»Ì€: ${ai(l.keys,", ")}`;case"invalid_key":return`Bá»tÃ¬nÃ¬ aá¹£Ã¬á¹£e nÃ­nÃº ${l.origin}`;case"invalid_union":return"ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e";case"invalid_element":return`Iye aá¹£Ã¬á¹£e nÃ­nÃº ${l.origin}`;default:return"ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e"}}};function h9(){return{localeError:u9()}}var EC,z3=Symbol("ZodOutput"),C3=Symbol("ZodInput");class L3{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...o){let h=o[0];return this._map.set(e,h),h&&typeof h=="object"&&"id"in h&&this._idmap.set(h.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let o=this._map.get(e);return o&&typeof o=="object"&&"id"in o&&this._idmap.delete(o.id),this._map.delete(e),this}get(e){let o=e._zod.parent;if(o){let h={...this.get(o)??{}};delete h.id;let l={...h,...this._map.get(e)};return Object.keys(l).length?l:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function RE(){return new L3}(EC=globalThis).__zod_globalRegistry??(EC.__zod_globalRegistry=RE());var ja=globalThis.__zod_globalRegistry;function R3(i,e){return new i({type:"string",...ui(e)})}function D3(i,e){return new i({type:"string",coerce:!0,...ui(e)})}function DE(i,e){return new i({type:"string",format:"email",check:"string_format",abort:!1,...ui(e)})}function F0(i,e){return new i({type:"string",format:"guid",check:"string_format",abort:!1,...ui(e)})}function kE(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,...ui(e)})}function OE(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...ui(e)})}function FE(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...ui(e)})}function BE(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...ui(e)})}function pb(i,e){return new i({type:"string",format:"url",check:"string_format",abort:!1,...ui(e)})}function NE(i,e){return new i({type:"string",format:"emoji",check:"string_format",abort:!1,...ui(e)})}function UE(i,e){return new i({type:"string",format:"nanoid",check:"string_format",abort:!1,...ui(e)})}function $E(i,e){return new i({type:"string",format:"cuid",check:"string_format",abort:!1,...ui(e)})}function VE(i,e){return new i({type:"string",format:"cuid2",check:"string_format",abort:!1,...ui(e)})}function jE(i,e){return new i({type:"string",format:"ulid",check:"string_format",abort:!1,...ui(e)})}function GE(i,e){return new i({type:"string",format:"xid",check:"string_format",abort:!1,...ui(e)})}function HE(i,e){return new i({type:"string",format:"ksuid",check:"string_format",abort:!1,...ui(e)})}function ZE(i,e){return new i({type:"string",format:"ipv4",check:"string_format",abort:!1,...ui(e)})}function WE(i,e){return new i({type:"string",format:"ipv6",check:"string_format",abort:!1,...ui(e)})}function k3(i,e){return new i({type:"string",format:"mac",check:"string_format",abort:!1,...ui(e)})}function qE(i,e){return new i({type:"string",format:"cidrv4",check:"string_format",abort:!1,...ui(e)})}function XE(i,e){return new i({type:"string",format:"cidrv6",check:"string_format",abort:!1,...ui(e)})}function JE(i,e){return new i({type:"string",format:"base64",check:"string_format",abort:!1,...ui(e)})}function YE(i,e){return new i({type:"string",format:"base64url",check:"string_format",abort:!1,...ui(e)})}function KE(i,e){return new i({type:"string",format:"e164",check:"string_format",abort:!1,...ui(e)})}function QE(i,e){return new i({type:"string",format:"jwt",check:"string_format",abort:!1,...ui(e)})}var O3={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function F3(i,e){return new i({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...ui(e)})}function B3(i,e){return new i({type:"string",format:"date",check:"string_format",...ui(e)})}function N3(i,e){return new i({type:"string",format:"time",check:"string_format",precision:null,...ui(e)})}function U3(i,e){return new i({type:"string",format:"duration",check:"string_format",...ui(e)})}function $3(i,e){return new i({type:"number",checks:[],...ui(e)})}function V3(i,e){return new i({type:"number",coerce:!0,checks:[],...ui(e)})}function j3(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"safeint",...ui(e)})}function G3(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"float32",...ui(e)})}function H3(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"float64",...ui(e)})}function Z3(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"int32",...ui(e)})}function W3(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"uint32",...ui(e)})}function q3(i,e){return new i({type:"boolean",...ui(e)})}function X3(i,e){return new i({type:"boolean",coerce:!0,...ui(e)})}function J3(i,e){return new i({type:"bigint",...ui(e)})}function Y3(i,e){return new i({type:"bigint",coerce:!0,...ui(e)})}function K3(i,e){return new i({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...ui(e)})}function Q3(i,e){return new i({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...ui(e)})}function eO(i,e){return new i({type:"symbol",...ui(e)})}function tO(i,e){return new i({type:"undefined",...ui(e)})}function iO(i,e){return new i({type:"null",...ui(e)})}function nO(i){return new i({type:"any"})}function rO(i){return new i({type:"unknown"})}function oO(i,e){return new i({type:"never",...ui(e)})}function sO(i,e){return new i({type:"void",...ui(e)})}function aO(i,e){return new i({type:"date",...ui(e)})}function lO(i,e){return new i({type:"date",coerce:!0,...ui(e)})}function cO(i,e){return new i({type:"nan",...ui(e)})}function ju(i,e){return new SE({check:"less_than",...ui(e),value:i,inclusive:!1})}function Ha(i,e){return new SE({check:"less_than",...ui(e),value:i,inclusive:!0})}function Gu(i,e){return new TE({check:"greater_than",...ui(e),value:i,inclusive:!1})}function sa(i,e){return new TE({check:"greater_than",...ui(e),value:i,inclusive:!0})}function eI(i){return Gu(0,i)}function tI(i){return ju(0,i)}function iI(i){return Ha(0,i)}function nI(i){return sa(0,i)}function vp(i,e){return new qD({check:"multiple_of",...ui(e),value:i})}function Pp(i,e){return new YD({check:"max_size",...ui(e),maximum:i})}function Hu(i,e){return new KD({check:"min_size",...ui(e),minimum:i})}function ty(i,e){return new QD({check:"size_equals",...ui(e),size:i})}function iy(i,e){return new ek({check:"max_length",...ui(e),maximum:i})}function cd(i,e){return new tk({check:"min_length",...ui(e),minimum:i})}function ny(i,e){return new ik({check:"length_equals",...ui(e),length:i})}function mb(i,e){return new nk({check:"string_format",format:"regex",...ui(e),pattern:i})}function gb(i){return new rk({check:"string_format",format:"lowercase",...ui(i)})}function _b(i){return new ok({check:"string_format",format:"uppercase",...ui(i)})}function yb(i,e){return new sk({check:"string_format",format:"includes",...ui(e),includes:i})}function vb(i,e){return new ak({check:"string_format",format:"starts_with",...ui(e),prefix:i})}function xb(i,e){return new lk({check:"string_format",format:"ends_with",...ui(e),suffix:i})}function rI(i,e,o){return new ck({check:"property",property:i,schema:e,...ui(o)})}function bb(i,e){return new uk({check:"mime_type",mime:i,...ui(e)})}function Vc(i){return new hk({check:"overwrite",tx:i})}function wb(i){return Vc(e=>e.normalize(i))}function Sb(){return Vc(i=>i.trim())}function Tb(){return Vc(i=>i.toLowerCase())}function Eb(){return Vc(i=>i.toUpperCase())}function Ib(){return Vc(i=>tD(i))}function uO(i,e,o){return new i({type:"array",element:e,...ui(o)})}function d9(i,e,o){return new i({type:"union",options:e,...ui(o)})}function f9(i,e,o){return new i({type:"union",options:e,inclusive:!1,...ui(o)})}function p9(i,e,o,h){return new i({type:"union",options:o,discriminator:e,...ui(h)})}function m9(i,e,o){return new i({type:"intersection",left:e,right:o})}function g9(i,e,o,h){let l=o instanceof Ln;return new i({type:"tuple",items:e,rest:l?o:null,...ui(l?h:o)})}function _9(i,e,o,h){return new i({type:"record",keyType:e,valueType:o,...ui(h)})}function y9(i,e,o,h){return new i({type:"map",keyType:e,valueType:o,...ui(h)})}function v9(i,e,o){return new i({type:"set",valueType:e,...ui(o)})}function x9(i,e,o){let h=Array.isArray(e)?Object.fromEntries(e.map(l=>[l,l])):e;return new i({type:"enum",entries:h,...ui(o)})}function b9(i,e,o){return new i({type:"enum",entries:e,...ui(o)})}function w9(i,e,o){return new i({type:"literal",values:Array.isArray(e)?e:[e],...ui(o)})}function hO(i,e){return new i({type:"file",...ui(e)})}function S9(i,e){return new i({type:"transform",transform:e})}function T9(i,e){return new i({type:"optional",innerType:e})}function E9(i,e){return new i({type:"nullable",innerType:e})}function I9(i,e,o){return new i({type:"default",innerType:e,get defaultValue(){return typeof o=="function"?o():nD(o)}})}function M9(i,e,o){return new i({type:"nonoptional",innerType:e,...ui(o)})}function A9(i,e){return new i({type:"success",innerType:e})}function P9(i,e,o){return new i({type:"catch",innerType:e,catchValue:typeof o=="function"?o:()=>o})}function z9(i,e,o){return new i({type:"pipe",in:e,out:o})}function C9(i,e){return new i({type:"readonly",innerType:e})}function L9(i,e,o){return new i({type:"template_literal",parts:e,...ui(o)})}function R9(i,e){return new i({type:"lazy",getter:e})}function D9(i,e){return new i({type:"promise",innerType:e})}function dO(i,e,o){let h=ui(o);return h.abort??(h.abort=!0),new i({type:"custom",check:"custom",fn:e,...h})}function fO(i,e,o){return new i({type:"custom",check:"custom",fn:e,...ui(o)})}function pO(i){let e=mO(o=>(o.addIssue=h=>{if(typeof h=="string")o.issues.push(k0(h,o.value,e._zod.def));else{let l=h;l.fatal&&(l.continue=!1),l.code??(l.code="custom"),l.input??(l.input=o.value),l.inst??(l.inst=e),l.continue??(l.continue=!e._zod.def.abort),o.issues.push(k0(l))}},i(o.value,o)));return e}function mO(i,e){let o=new no({check:"custom",...ui(e)});return o._zod.check=i,o}function gO(i){let e=new no({check:"describe"});return e._zod.onattach=[o=>{let h=ja.get(o)??{};ja.add(o,{...h,description:i})}],e._zod.check=()=>{},e}function _O(i){let e=new no({check:"meta"});return e._zod.onattach=[o=>{let h=ja.get(o)??{};ja.add(o,{...h,...i})}],e._zod.check=()=>{},e}function yO(i,e){let o=ui(e),h=o.truthy??["true","1","yes","on","y","enabled"],l=o.falsy??["false","0","no","off","n","disabled"];o.case!=="sensitive"&&(h=h.map(V=>typeof V=="string"?V.toLowerCase():V),l=l.map(V=>typeof V=="string"?V.toLowerCase():V));let f=new Set(h),x=new Set(l),s=i.Codec??CE,P=i.Boolean??ME,C=new(i.String??ey)({type:"string",error:o.error}),O=new P({type:"boolean",error:o.error}),F=new s({type:"pipe",in:C,out:O,transform:(V,q)=>{let ee=V;return o.case!=="sensitive"&&(ee=ee.toLowerCase()),f.has(ee)?!0:x.has(ee)?!1:(q.issues.push({code:"invalid_value",expected:"stringbool",values:[...f,...x],input:q.value,inst:F,continue:!1}),{})},reverseTransform:(V,q)=>V===!0?h[0]||"true":l[0]||"false",error:o.error});return F}function ry(i,e,o,h={}){let l=ui(h),f={...ui(h),check:"string_format",type:"string",format:e,fn:typeof o=="function"?o:x=>o.test(x),...l};return o instanceof RegExp&&(f.pattern=o),new i(f)}function xp(i){let e=(i==null?void 0:i.target)??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:i.processors??{},metadataRegistry:(i==null?void 0:i.metadata)??ja,target:e,unrepresentable:(i==null?void 0:i.unrepresentable)??"throw",override:(i==null?void 0:i.override)??(()=>{}),io:(i==null?void 0:i.io)??"output",counter:0,seen:new Map,cycles:(i==null?void 0:i.cycles)??"ref",reused:(i==null?void 0:i.reused)??"inline",external:(i==null?void 0:i.external)??void 0}}function Dr(i,e,o={path:[],schemaPath:[]}){var C,O;var h;let l=i._zod.def,f=e.seen.get(i);if(f)return f.count++,o.schemaPath.includes(i)&&(f.cycle=o.path),f.schema;let x={schema:{},count:1,cycle:void 0,path:o.path};e.seen.set(i,x);let s=(O=(C=i._zod).toJSONSchema)==null?void 0:O.call(C);if(s)x.schema=s;else{let F={...o,schemaPath:[...o.schemaPath,i],path:o.path};if(i._zod.processJSONSchema)i._zod.processJSONSchema(e,x.schema,F);else{let q=x.schema,ee=e.processors[l.type];if(!ee)throw Error(`[toJSONSchema]: Non-representable type encountered: ${l.type}`);ee(i,e,q,F)}let V=i._zod.parent;V&&(x.ref||(x.ref=V),Dr(V,e,F),e.seen.get(V).isParent=!0)}let P=e.metadataRegistry.get(i);return P&&Object.assign(x.schema,P),e.io==="input"&&Zs(i)&&(delete x.schema.examples,delete x.schema.default),e.io==="input"&&x.schema._prefault&&((h=x.schema).default??(h.default=x.schema._prefault)),delete x.schema._prefault,e.seen.get(i).schema}function bp(i,e){var x,s,P,C;let o=i.seen.get(e);if(!o)throw Error("Unprocessed schema. This is a bug in Zod.");let h=new Map;for(let O of i.seen.entries()){let F=(x=i.metadataRegistry.get(O[0]))==null?void 0:x.id;if(F){let V=h.get(F);if(V&&V!==O[0])throw Error(`Duplicate schema id "${F}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);h.set(F,O[0])}}let l=O=>{var ee;let F=i.target==="draft-2020-12"?"$defs":"definitions";if(i.external){let se=(ee=i.external.registry.get(O[0]))==null?void 0:ee.id,fe=i.external.uri??(ie=>ie);if(se)return{ref:fe(se)};let ae=O[1].defId??O[1].schema.id??`schema${i.counter++}`;return O[1].defId=ae,{defId:ae,ref:`${fe("__shared")}#/${F}/${ae}`}}if(O[1]===o)return{ref:"#"};let V=`#/${F}/`,q=O[1].schema.id??`__schema${i.counter++}`;return{defId:q,ref:V+q}},f=O=>{if(O[1].schema.$ref)return;let F=O[1],{ref:V,defId:q}=l(O);F.def={...F.schema},q&&(F.defId=q);let ee=F.schema;for(let se in ee)delete ee[se];ee.$ref=V};if(i.cycles==="throw")for(let O of i.seen.entries()){let F=O[1];if(F.cycle)throw Error(`Cycle detected: #/${(s=F.cycle)==null?void 0:s.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let O of i.seen.entries()){let F=O[1];if(e===O[0]){f(O);continue}if(i.external){let V=(P=i.external.registry.get(O[0]))==null?void 0:P.id;if(e!==O[0]&&V){f(O);continue}}if((C=i.metadataRegistry.get(O[0]))!=null&&C.id){f(O);continue}if(F.cycle){f(O);continue}if(F.count>1&&i.reused==="ref"){f(O);continue}}}function wp(i,e){var x,s,P;let o=i.seen.get(e);if(!o)throw Error("Unprocessed schema. This is a bug in Zod.");let h=C=>{let O=i.seen.get(C);if(O.ref===null)return;let F=O.def??O.schema,V={...F},q=O.ref;if(O.ref=null,q){h(q);let se=i.seen.get(q),fe=se.schema;if(fe.$ref&&(i.target==="draft-07"||i.target==="draft-04"||i.target==="openapi-3.0")?(F.allOf=F.allOf??[],F.allOf.push(fe)):Object.assign(F,fe),Object.assign(F,V),C._zod.parent===q)for(let ae in F)ae==="$ref"||ae==="allOf"||ae in V||delete F[ae];if(fe.$ref)for(let ae in F)ae==="$ref"||ae==="allOf"||ae in se.def&&JSON.stringify(F[ae])===JSON.stringify(se.def[ae])&&delete F[ae]}let ee=C._zod.parent;if(ee&&ee!==q){h(ee);let se=i.seen.get(ee);if(se!=null&&se.schema.$ref&&(F.$ref=se.schema.$ref,se.def))for(let fe in F)fe==="$ref"||fe==="allOf"||fe in se.def&&JSON.stringify(F[fe])===JSON.stringify(se.def[fe])&&delete F[fe]}i.override({zodSchema:C,jsonSchema:F,path:O.path??[]})};for(let C of[...i.seen.entries()].reverse())h(C[0]);let l={};if(i.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":i.target==="draft-07"?l.$schema="http://json-schema.org/draft-07/schema#":i.target==="draft-04"?l.$schema="http://json-schema.org/draft-04/schema#":i.target,(x=i.external)!=null&&x.uri){let C=(s=i.external.registry.get(e))==null?void 0:s.id;if(!C)throw Error("Schema is missing an `id` property");l.$id=i.external.uri(C)}Object.assign(l,o.def??o.schema);let f=((P=i.external)==null?void 0:P.defs)??{};for(let C of i.seen.entries()){let O=C[1];O.def&&O.defId&&(f[O.defId]=O.def)}i.external||Object.keys(f).length>0&&(i.target==="draft-2020-12"?l.$defs=f:l.definitions=f);try{let C=JSON.parse(JSON.stringify(l));return Object.defineProperty(C,"~standard",{value:{...e["~standard"],jsonSchema:{input:S_(e,"input",i.processors),output:S_(e,"output",i.processors)}},enumerable:!1,writable:!1}),C}catch{throw Error("Error converting schema to JSON.")}}function Zs(i,e){let o=e??{seen:new Set};if(o.seen.has(i))return!1;o.seen.add(i);let h=i._zod.def;if(h.type==="transform")return!0;if(h.type==="array")return Zs(h.element,o);if(h.type==="set")return Zs(h.valueType,o);if(h.type==="lazy")return Zs(h.getter(),o);if(h.type==="promise"||h.type==="optional"||h.type==="nonoptional"||h.type==="nullable"||h.type==="readonly"||h.type==="default"||h.type==="prefault")return Zs(h.innerType,o);if(h.type==="intersection")return Zs(h.left,o)||Zs(h.right,o);if(h.type==="record"||h.type==="map")return Zs(h.keyType,o)||Zs(h.valueType,o);if(h.type==="pipe")return Zs(h.in,o)||Zs(h.out,o);if(h.type==="object"){for(let l in h.shape)if(Zs(h.shape[l],o))return!0;return!1}if(h.type==="union"){for(let l of h.options)if(Zs(l,o))return!0;return!1}if(h.type==="tuple"){for(let l of h.items)if(Zs(l,o))return!0;return!!(h.rest&&Zs(h.rest,o))}return!1}var vO=(i,e={})=>o=>{let h=xp({...o,processors:e});return Dr(i,h),bp(h,i),wp(h,i)},S_=(i,e,o={})=>h=>{let{libraryOptions:l,target:f}=h??{},x=xp({...l??{},target:f,io:e,processors:o});return Dr(i,x),bp(x,i),wp(x,i)},k9={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},xO=(i,e,o,h)=>{let l=o;l.type="string";let{minimum:f,maximum:x,format:s,patterns:P,contentEncoding:C}=i._zod.bag;if(typeof f=="number"&&(l.minLength=f),typeof x=="number"&&(l.maxLength=x),s&&(l.format=k9[s]??s,l.format===""&&delete l.format,s==="time"&&delete l.format),C&&(l.contentEncoding=C),P&&P.size>0){let O=[...P];O.length===1?l.pattern=O[0].source:O.length>1&&(l.allOf=[...O.map(F=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:F.source}))])}},bO=(i,e,o,h)=>{let l=o,{minimum:f,maximum:x,format:s,multipleOf:P,exclusiveMaximum:C,exclusiveMinimum:O}=i._zod.bag;typeof s=="string"&&s.includes("int")?l.type="integer":l.type="number",typeof O=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(l.minimum=O,l.exclusiveMinimum=!0):l.exclusiveMinimum=O),typeof f=="number"&&(l.minimum=f,typeof O=="number"&&e.target!=="draft-04"&&(O>=f?delete l.minimum:delete l.exclusiveMinimum)),typeof C=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(l.maximum=C,l.exclusiveMaximum=!0):l.exclusiveMaximum=C),typeof x=="number"&&(l.maximum=x,typeof C=="number"&&e.target!=="draft-04"&&(C<=x?delete l.maximum:delete l.exclusiveMaximum)),typeof P=="number"&&(l.multipleOf=P)},wO=(i,e,o,h)=>{o.type="boolean"},SO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("BigInt cannot be represented in JSON Schema")},TO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Symbols cannot be represented in JSON Schema")},EO=(i,e,o,h)=>{e.target==="openapi-3.0"?(o.type="string",o.nullable=!0,o.enum=[null]):o.type="null"},IO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Undefined cannot be represented in JSON Schema")},MO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Void cannot be represented in JSON Schema")},AO=(i,e,o,h)=>{o.not={}},PO=(i,e,o,h)=>{},zO=(i,e,o,h)=>{},CO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Date cannot be represented in JSON Schema")},LO=(i,e,o,h)=>{let l=i._zod.def,f=lE(l.entries);f.every(x=>typeof x=="number")&&(o.type="number"),f.every(x=>typeof x=="string")&&(o.type="string"),o.enum=f},RO=(i,e,o,h)=>{let l=i._zod.def,f=[];for(let x of l.values)if(x===void 0){if(e.unrepresentable==="throw")throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof x=="bigint"){if(e.unrepresentable==="throw")throw Error("BigInt literals cannot be represented in JSON Schema");f.push(Number(x))}else f.push(x);if(f.length!==0)if(f.length===1){let x=f[0];o.type=x===null?"null":typeof x,e.target==="draft-04"||e.target==="openapi-3.0"?o.enum=[x]:o.const=x}else f.every(x=>typeof x=="number")&&(o.type="number"),f.every(x=>typeof x=="string")&&(o.type="string"),f.every(x=>typeof x=="boolean")&&(o.type="boolean"),f.every(x=>x===null)&&(o.type="null"),o.enum=f},DO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("NaN cannot be represented in JSON Schema")},kO=(i,e,o,h)=>{let l=o,f=i._zod.pattern;if(!f)throw Error("Pattern not found in template literal");l.type="string",l.pattern=f.source},OO=(i,e,o,h)=>{let l=o,f={type:"string",format:"binary",contentEncoding:"binary"},{minimum:x,maximum:s,mime:P}=i._zod.bag;x!==void 0&&(f.minLength=x),s!==void 0&&(f.maxLength=s),P?P.length===1?(f.contentMediaType=P[0],Object.assign(l,f)):(Object.assign(l,f),l.anyOf=P.map(C=>({contentMediaType:C}))):Object.assign(l,f)},FO=(i,e,o,h)=>{o.type="boolean"},BO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Custom types cannot be represented in JSON Schema")},NO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Function types cannot be represented in JSON Schema")},UO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Transforms cannot be represented in JSON Schema")},$O=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Map cannot be represented in JSON Schema")},VO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Set cannot be represented in JSON Schema")},jO=(i,e,o,h)=>{let l=o,f=i._zod.def,{minimum:x,maximum:s}=i._zod.bag;typeof x=="number"&&(l.minItems=x),typeof s=="number"&&(l.maxItems=s),l.type="array",l.items=Dr(f.element,e,{...h,path:[...h.path,"items"]})},GO=(i,e,o,h)=>{var C;let l=o,f=i._zod.def;l.type="object",l.properties={};let x=f.shape;for(let O in x)l.properties[O]=Dr(x[O],e,{...h,path:[...h.path,"properties",O]});let s=new Set(Object.keys(x)),P=new Set([...s].filter(O=>{let F=f.shape[O]._zod;return e.io==="input"?F.optin===void 0:F.optout===void 0}));P.size>0&&(l.required=Array.from(P)),((C=f.catchall)==null?void 0:C._zod.def.type)==="never"?l.additionalProperties=!1:f.catchall?f.catchall&&(l.additionalProperties=Dr(f.catchall,e,{...h,path:[...h.path,"additionalProperties"]})):e.io==="output"&&(l.additionalProperties=!1)},oI=(i,e,o,h)=>{let l=i._zod.def,f=l.inclusive===!1,x=l.options.map((s,P)=>Dr(s,e,{...h,path:[...h.path,f?"oneOf":"anyOf",P]}));f?o.oneOf=x:o.anyOf=x},HO=(i,e,o,h)=>{let l=i._zod.def,f=Dr(l.left,e,{...h,path:[...h.path,"allOf",0]}),x=Dr(l.right,e,{...h,path:[...h.path,"allOf",1]}),s=C=>"allOf"in C&&Object.keys(C).length===1,P=[...s(f)?f.allOf:[f],...s(x)?x.allOf:[x]];o.allOf=P},ZO=(i,e,o,h)=>{let l=o,f=i._zod.def;l.type="array";let x=e.target==="draft-2020-12"?"prefixItems":"items",s=e.target==="draft-2020-12"||e.target==="openapi-3.0"?"items":"additionalItems",P=f.items.map((V,q)=>Dr(V,e,{...h,path:[...h.path,x,q]})),C=f.rest?Dr(f.rest,e,{...h,path:[...h.path,s,...e.target==="openapi-3.0"?[f.items.length]:[]]}):null;e.target==="draft-2020-12"?(l.prefixItems=P,C&&(l.items=C)):e.target==="openapi-3.0"?(l.items={anyOf:P},C&&l.items.anyOf.push(C),l.minItems=P.length,!C&&(l.maxItems=P.length)):(l.items=P,C&&(l.additionalItems=C));let{minimum:O,maximum:F}=i._zod.bag;typeof O=="number"&&(l.minItems=O),typeof F=="number"&&(l.maxItems=F)},WO=(i,e,o,h)=>{var C;let l=o,f=i._zod.def;l.type="object";let x=f.keyType,s=(C=x._zod.bag)==null?void 0:C.patterns;if(f.mode==="loose"&&s&&s.size>0){let O=Dr(f.valueType,e,{...h,path:[...h.path,"patternProperties","*"]});l.patternProperties={};for(let F of s)l.patternProperties[F.source]=O}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(l.propertyNames=Dr(f.keyType,e,{...h,path:[...h.path,"propertyNames"]})),l.additionalProperties=Dr(f.valueType,e,{...h,path:[...h.path,"additionalProperties"]});let P=x._zod.values;if(P){let O=[...P].filter(F=>typeof F=="string"||typeof F=="number");O.length>0&&(l.required=O)}},qO=(i,e,o,h)=>{let l=i._zod.def,f=Dr(l.innerType,e,h),x=e.seen.get(i);e.target==="openapi-3.0"?(x.ref=l.innerType,o.nullable=!0):o.anyOf=[f,{type:"null"}]},XO=(i,e,o,h)=>{let l=i._zod.def;Dr(l.innerType,e,h);let f=e.seen.get(i);f.ref=l.innerType},JO=(i,e,o,h)=>{let l=i._zod.def;Dr(l.innerType,e,h);let f=e.seen.get(i);f.ref=l.innerType,o.default=JSON.parse(JSON.stringify(l.defaultValue))},YO=(i,e,o,h)=>{let l=i._zod.def;Dr(l.innerType,e,h);let f=e.seen.get(i);f.ref=l.innerType,e.io==="input"&&(o._prefault=JSON.parse(JSON.stringify(l.defaultValue)))},KO=(i,e,o,h)=>{let l=i._zod.def;Dr(l.innerType,e,h);let f=e.seen.get(i);f.ref=l.innerType;let x;try{x=l.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}o.default=x},QO=(i,e,o,h)=>{let l=i._zod.def,f=e.io==="input"?l.in._zod.def.type==="transform"?l.out:l.in:l.out;Dr(f,e,h);let x=e.seen.get(i);x.ref=f},eF=(i,e,o,h)=>{let l=i._zod.def;Dr(l.innerType,e,h);let f=e.seen.get(i);f.ref=l.innerType,o.readOnly=!0},tF=(i,e,o,h)=>{let l=i._zod.def;Dr(l.innerType,e,h);let f=e.seen.get(i);f.ref=l.innerType},sI=(i,e,o,h)=>{let l=i._zod.def;Dr(l.innerType,e,h);let f=e.seen.get(i);f.ref=l.innerType},iF=(i,e,o,h)=>{let l=i._zod.innerType;Dr(l,e,h);let f=e.seen.get(i);f.ref=l},sT={string:xO,number:bO,boolean:wO,bigint:SO,symbol:TO,null:EO,undefined:IO,void:MO,never:AO,any:PO,unknown:zO,date:CO,enum:LO,literal:RO,nan:DO,template_literal:kO,file:OO,success:FO,custom:BO,function:NO,transform:UO,map:$O,set:VO,array:jO,object:GO,union:oI,intersection:HO,tuple:ZO,record:WO,nullable:qO,nonoptional:XO,default:JO,prefault:YO,catch:KO,pipe:QO,readonly:eF,promise:tF,optional:sI,lazy:iF};function nF(i,e){if("_idmap"in i){let h=i,l=xp({...e,processors:sT}),f={};for(let P of h._idmap.entries()){let[C,O]=P;Dr(O,l)}let x={},s={registry:h,uri:e==null?void 0:e.uri,defs:f};l.external=s;for(let P of h._idmap.entries()){let[C,O]=P;bp(l,O),x[C]=wp(l,O)}if(Object.keys(f).length>0){let P=l.target==="draft-2020-12"?"$defs":"definitions";x.__shared={[P]:f}}return{schemas:x}}let o=xp({...e,processors:sT});return Dr(i,o),bp(o,i),wp(o,i)}class O9{get metadataRegistry(){return this.ctx.metadataRegistry}get target(){return this.ctx.target}get unrepresentable(){return this.ctx.unrepresentable}get override(){return this.ctx.override}get io(){return this.ctx.io}get counter(){return this.ctx.counter}set counter(e){this.ctx.counter=e}get seen(){return this.ctx.seen}constructor(e){let o=(e==null?void 0:e.target)??"draft-2020-12";o==="draft-4"&&(o="draft-04"),o==="draft-7"&&(o="draft-07"),this.ctx=xp({processors:sT,target:o,...(e==null?void 0:e.metadata)&&{metadata:e.metadata},...(e==null?void 0:e.unrepresentable)&&{unrepresentable:e.unrepresentable},...(e==null?void 0:e.override)&&{override:e.override},...(e==null?void 0:e.io)&&{io:e.io}})}process(e,o={path:[],schemaPath:[]}){return Dr(e,this.ctx,o)}emit(e,o){o&&(o.cycles&&(this.ctx.cycles=o.cycles),o.reused&&(this.ctx.reused=o.reused),o.external&&(this.ctx.external=o.external)),bp(this.ctx,e);let h=wp(this.ctx,e),{"~standard":l,...f}=h;return f}}var F9={},rF={};Uc(rF,{xor:()=>fB,xid:()=>OF,void:()=>aB,uuidv7:()=>AF,uuidv6:()=>MF,uuidv4:()=>IF,uuid:()=>EF,url:()=>PF,unknown:()=>ud,union:()=>Wb,undefined:()=>oB,ulid:()=>kF,uint64:()=>nB,uint32:()=>eB,tuple:()=>PI,transform:()=>Xb,templateLiteral:()=>IB,symbol:()=>rB,superRefine:()=>i2,success:()=>SB,stringbool:()=>RB,stringFormat:()=>WF,string:()=>B0,strictObject:()=>hB,set:()=>yB,refine:()=>t2,record:()=>zI,readonly:()=>XI,promise:()=>MB,preprocess:()=>kB,prefault:()=>VI,pipe:()=>M_,partialRecord:()=>mB,optional:()=>E_,object:()=>uB,number:()=>fI,nullish:()=>wB,nullable:()=>I_,null:()=>yI,nonoptional:()=>jI,never:()=>Hb,nativeEnum:()=>vB,nanoid:()=>LF,nan:()=>TB,meta:()=>CB,map:()=>_B,mac:()=>NF,looseRecord:()=>gB,looseObject:()=>dB,literal:()=>xB,lazy:()=>KI,ksuid:()=>FF,keyof:()=>cB,jwt:()=>ZF,json:()=>DB,ipv6:()=>UF,ipv4:()=>BF,intersection:()=>MI,int64:()=>iB,int32:()=>QF,int:()=>N0,instanceof:()=>LB,httpUrl:()=>zF,hostname:()=>qF,hex:()=>XF,hash:()=>JF,guid:()=>TF,function:()=>U0,float64:()=>KF,float32:()=>YF,file:()=>bB,exactOptional:()=>FI,enum:()=>qb,emoji:()=>CF,email:()=>SF,e164:()=>HF,discriminatedUnion:()=>pB,describe:()=>zB,date:()=>lB,custom:()=>PB,cuid2:()=>DF,cuid:()=>RF,codec:()=>EB,cidrv6:()=>VF,cidrv4:()=>$F,check:()=>AB,catch:()=>ZI,boolean:()=>pI,bigint:()=>tB,base64url:()=>GF,base64:()=>jF,array:()=>uy,any:()=>sB,_function:()=>U0,_default:()=>UI,_ZodString:()=>Mb,ZodXor:()=>TI,ZodXID:()=>Db,ZodVoid:()=>wI,ZodUnknown:()=>xI,ZodUnion:()=>dy,ZodUndefined:()=>gI,ZodUUID:()=>oc,ZodURL:()=>sy,ZodULID:()=>Rb,ZodType:()=>Fn,ZodTuple:()=>AI,ZodTransform:()=>kI,ZodTemplateLiteral:()=>JI,ZodSymbol:()=>mI,ZodSuccess:()=>GI,ZodStringFormat:()=>Br,ZodString:()=>oy,ZodSet:()=>LI,ZodRecord:()=>fy,ZodReadonly:()=>qI,ZodPromise:()=>QI,ZodPrefault:()=>$I,ZodPipe:()=>Kb,ZodOptional:()=>Jb,ZodObject:()=>hy,ZodNumberFormat:()=>md,ZodNumber:()=>ay,ZodNullable:()=>BI,ZodNull:()=>_I,ZodNonOptional:()=>Yb,ZodNever:()=>bI,ZodNanoID:()=>zb,ZodNaN:()=>WI,ZodMap:()=>CI,ZodMAC:()=>dI,ZodLiteral:()=>RI,ZodLazy:()=>YI,ZodKSUID:()=>kb,ZodJWT:()=>jb,ZodIntersection:()=>II,ZodIPv6:()=>Fb,ZodIPv4:()=>Ob,ZodGUID:()=>T_,ZodFunction:()=>e2,ZodFile:()=>DI,ZodExactOptional:()=>OI,ZodEnum:()=>Sp,ZodEmoji:()=>Pb,ZodEmail:()=>Ab,ZodE164:()=>Vb,ZodDiscriminatedUnion:()=>EI,ZodDefault:()=>NI,ZodDate:()=>Zb,ZodCustomStringFormat:()=>zp,ZodCustom:()=>py,ZodCodec:()=>Qb,ZodCatch:()=>HI,ZodCUID2:()=>Lb,ZodCUID:()=>Cb,ZodCIDRv6:()=>Nb,ZodCIDRv4:()=>Bb,ZodBoolean:()=>ly,ZodBigIntFormat:()=>Gb,ZodBigInt:()=>cy,ZodBase64URL:()=>$b,ZodBase64:()=>Ub,ZodArray:()=>SI,ZodAny:()=>vI});var oF={};Uc(oF,{uppercase:()=>_b,trim:()=>Sb,toUpperCase:()=>Eb,toLowerCase:()=>Tb,startsWith:()=>vb,slugify:()=>Ib,size:()=>ty,regex:()=>mb,property:()=>rI,positive:()=>eI,overwrite:()=>Vc,normalize:()=>wb,nonpositive:()=>iI,nonnegative:()=>nI,negative:()=>tI,multipleOf:()=>vp,minSize:()=>Hu,minLength:()=>cd,mime:()=>bb,maxSize:()=>Pp,maxLength:()=>iy,lte:()=>Ha,lt:()=>ju,lowercase:()=>gb,length:()=>ny,includes:()=>yb,gte:()=>sa,gt:()=>Gu,endsWith:()=>xb});var aI={};Uc(aI,{time:()=>lF,duration:()=>cF,datetime:()=>sF,date:()=>aF,ZodISOTime:()=>uI,ZodISODuration:()=>hI,ZodISODateTime:()=>lI,ZodISODate:()=>cI});var lI=mt("ZodISODateTime",(i,e)=>{Ek.init(i,e),Br.init(i,e)});function sF(i){return F3(lI,i)}var cI=mt("ZodISODate",(i,e)=>{Ik.init(i,e),Br.init(i,e)});function aF(i){return B3(cI,i)}var uI=mt("ZodISOTime",(i,e)=>{Mk.init(i,e),Br.init(i,e)});function lF(i){return N3(uI,i)}var hI=mt("ZodISODuration",(i,e)=>{Ak.init(i,e),Br.init(i,e)});function cF(i){return U3(hI,i)}var uF=(i,e)=>{uE.init(i,e),i.name="ZodError",Object.defineProperties(i,{format:{value:o=>dE(i,o)},flatten:{value:o=>hE(i,o)},addIssue:{value:o=>{i.issues.push(o),i.message=JSON.stringify(i.issues,R0,2)}},addIssues:{value:o=>{i.issues.push(...o),i.message=JSON.stringify(i.issues,R0,2)}},isEmpty:{get(){return i.issues.length===0}}})},B9=mt("ZodError",uF),Ma=mt("ZodError",uF,{Parent:Error}),hF=W_(Ma),dF=q_(Ma),fF=X_(Ma),pF=J_(Ma),mF=fE(Ma),gF=pE(Ma),_F=mE(Ma),yF=gE(Ma),vF=_E(Ma),xF=yE(Ma),bF=vE(Ma),wF=xE(Ma),Fn=mt("ZodType",(i,e)=>(Ln.init(i,e),Object.assign(i["~standard"],{jsonSchema:{input:S_(i,"input"),output:S_(i,"output")}}),i.toJSONSchema=vO(i,{}),i.def=e,i.type=e.type,Object.defineProperty(i,"_def",{value:e}),i.check=(...o)=>i.clone(Kn.mergeDefs(e,{checks:[...e.checks??[],...o.map(h=>typeof h=="function"?{_zod:{check:h,def:{check:"custom"},onattach:[]}}:h)]}),{parent:!0}),i.with=i.check,i.clone=(o,h)=>el(i,o,h),i.brand=()=>i,i.register=(o,h)=>(o.add(i,h),i),i.parse=(o,h)=>hF(i,o,h,{callee:i.parse}),i.safeParse=(o,h)=>fF(i,o,h),i.parseAsync=async(o,h)=>dF(i,o,h,{callee:i.parseAsync}),i.safeParseAsync=async(o,h)=>pF(i,o,h),i.spa=i.safeParseAsync,i.encode=(o,h)=>mF(i,o,h),i.decode=(o,h)=>gF(i,o,h),i.encodeAsync=async(o,h)=>_F(i,o,h),i.decodeAsync=async(o,h)=>yF(i,o,h),i.safeEncode=(o,h)=>vF(i,o,h),i.safeDecode=(o,h)=>xF(i,o,h),i.safeEncodeAsync=async(o,h)=>bF(i,o,h),i.safeDecodeAsync=async(o,h)=>wF(i,o,h),i.refine=(o,h)=>i.check(t2(o,h)),i.superRefine=o=>i.check(i2(o)),i.overwrite=o=>i.check(Vc(o)),i.optional=()=>E_(i),i.exactOptional=()=>FI(i),i.nullable=()=>I_(i),i.nullish=()=>E_(I_(i)),i.nonoptional=o=>jI(i,o),i.array=()=>uy(i),i.or=o=>Wb([i,o]),i.and=o=>MI(i,o),i.transform=o=>M_(i,Xb(o)),i.default=o=>UI(i,o),i.prefault=o=>VI(i,o),i.catch=o=>ZI(i,o),i.pipe=o=>M_(i,o),i.readonly=()=>XI(i),i.describe=o=>{let h=i.clone();return ja.add(h,{description:o}),h},Object.defineProperty(i,"description",{get(){var o;return(o=ja.get(i))==null?void 0:o.description},configurable:!0}),i.meta=(...o)=>{if(o.length===0)return ja.get(i);let h=i.clone();return ja.add(h,o[0]),h},i.isOptional=()=>i.safeParse(void 0).success,i.isNullable=()=>i.safeParse(null).success,i.apply=o=>o(i),i)),Mb=mt("_ZodString",(i,e)=>{ey.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(h,l,f)=>xO(i,h,l);let o=i._zod.bag;i.format=o.format??null,i.minLength=o.minimum??null,i.maxLength=o.maximum??null,i.regex=(...h)=>i.check(mb(...h)),i.includes=(...h)=>i.check(yb(...h)),i.startsWith=(...h)=>i.check(vb(...h)),i.endsWith=(...h)=>i.check(xb(...h)),i.min=(...h)=>i.check(cd(...h)),i.max=(...h)=>i.check(iy(...h)),i.length=(...h)=>i.check(ny(...h)),i.nonempty=(...h)=>i.check(cd(1,...h)),i.lowercase=h=>i.check(gb(h)),i.uppercase=h=>i.check(_b(h)),i.trim=()=>i.check(Sb()),i.normalize=(...h)=>i.check(wb(...h)),i.toLowerCase=()=>i.check(Tb()),i.toUpperCase=()=>i.check(Eb()),i.slugify=()=>i.check(Ib())}),oy=mt("ZodString",(i,e)=>{ey.init(i,e),Mb.init(i,e),i.email=o=>i.check(DE(Ab,o)),i.url=o=>i.check(pb(sy,o)),i.jwt=o=>i.check(QE(jb,o)),i.emoji=o=>i.check(NE(Pb,o)),i.guid=o=>i.check(F0(T_,o)),i.uuid=o=>i.check(kE(oc,o)),i.uuidv4=o=>i.check(OE(oc,o)),i.uuidv6=o=>i.check(FE(oc,o)),i.uuidv7=o=>i.check(BE(oc,o)),i.nanoid=o=>i.check(UE(zb,o)),i.guid=o=>i.check(F0(T_,o)),i.cuid=o=>i.check($E(Cb,o)),i.cuid2=o=>i.check(VE(Lb,o)),i.ulid=o=>i.check(jE(Rb,o)),i.base64=o=>i.check(JE(Ub,o)),i.base64url=o=>i.check(YE($b,o)),i.xid=o=>i.check(GE(Db,o)),i.ksuid=o=>i.check(HE(kb,o)),i.ipv4=o=>i.check(ZE(Ob,o)),i.ipv6=o=>i.check(WE(Fb,o)),i.cidrv4=o=>i.check(qE(Bb,o)),i.cidrv6=o=>i.check(XE(Nb,o)),i.e164=o=>i.check(KE(Vb,o)),i.datetime=o=>i.check(sF(o)),i.date=o=>i.check(aF(o)),i.time=o=>i.check(lF(o)),i.duration=o=>i.check(cF(o))});function B0(i){return R3(oy,i)}var Br=mt("ZodStringFormat",(i,e)=>{Fr.init(i,e),Mb.init(i,e)}),Ab=mt("ZodEmail",(i,e)=>{gk.init(i,e),Br.init(i,e)});function SF(i){return DE(Ab,i)}var T_=mt("ZodGUID",(i,e)=>{pk.init(i,e),Br.init(i,e)});function TF(i){return F0(T_,i)}var oc=mt("ZodUUID",(i,e)=>{mk.init(i,e),Br.init(i,e)});function EF(i){return kE(oc,i)}function IF(i){return OE(oc,i)}function MF(i){return FE(oc,i)}function AF(i){return BE(oc,i)}var sy=mt("ZodURL",(i,e)=>{_k.init(i,e),Br.init(i,e)});function PF(i){return pb(sy,i)}function zF(i){return pb(sy,{protocol:/^https?$/,hostname:pd.domain,...Kn.normalizeParams(i)})}var Pb=mt("ZodEmoji",(i,e)=>{yk.init(i,e),Br.init(i,e)});function CF(i){return NE(Pb,i)}var zb=mt("ZodNanoID",(i,e)=>{vk.init(i,e),Br.init(i,e)});function LF(i){return UE(zb,i)}var Cb=mt("ZodCUID",(i,e)=>{xk.init(i,e),Br.init(i,e)});function RF(i){return $E(Cb,i)}var Lb=mt("ZodCUID2",(i,e)=>{bk.init(i,e),Br.init(i,e)});function DF(i){return VE(Lb,i)}var Rb=mt("ZodULID",(i,e)=>{wk.init(i,e),Br.init(i,e)});function kF(i){return jE(Rb,i)}var Db=mt("ZodXID",(i,e)=>{Sk.init(i,e),Br.init(i,e)});function OF(i){return GE(Db,i)}var kb=mt("ZodKSUID",(i,e)=>{Tk.init(i,e),Br.init(i,e)});function FF(i){return HE(kb,i)}var Ob=mt("ZodIPv4",(i,e)=>{Pk.init(i,e),Br.init(i,e)});function BF(i){return ZE(Ob,i)}var dI=mt("ZodMAC",(i,e)=>{Ck.init(i,e),Br.init(i,e)});function NF(i){return k3(dI,i)}var Fb=mt("ZodIPv6",(i,e)=>{zk.init(i,e),Br.init(i,e)});function UF(i){return WE(Fb,i)}var Bb=mt("ZodCIDRv4",(i,e)=>{Lk.init(i,e),Br.init(i,e)});function $F(i){return qE(Bb,i)}var Nb=mt("ZodCIDRv6",(i,e)=>{Rk.init(i,e),Br.init(i,e)});function VF(i){return XE(Nb,i)}var Ub=mt("ZodBase64",(i,e)=>{Dk.init(i,e),Br.init(i,e)});function jF(i){return JE(Ub,i)}var $b=mt("ZodBase64URL",(i,e)=>{Ok.init(i,e),Br.init(i,e)});function GF(i){return YE($b,i)}var Vb=mt("ZodE164",(i,e)=>{Fk.init(i,e),Br.init(i,e)});function HF(i){return KE(Vb,i)}var jb=mt("ZodJWT",(i,e)=>{Nk.init(i,e),Br.init(i,e)});function ZF(i){return QE(jb,i)}var zp=mt("ZodCustomStringFormat",(i,e)=>{Uk.init(i,e),Br.init(i,e)});function WF(i,e,o={}){return ry(zp,i,e,o)}function qF(i){return ry(zp,"hostname",pd.hostname,i)}function XF(i){return ry(zp,"hex",pd.hex,i)}function JF(i,e){let o=(e==null?void 0:e.enc)??"hex",h=`${i}_${o}`,l=pd[h];if(!l)throw Error(`Unrecognized hash format: ${h}`);return ry(zp,h,l,e)}var ay=mt("ZodNumber",(i,e)=>{IE.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(h,l,f)=>bO(i,h,l),i.gt=(h,l)=>i.check(Gu(h,l)),i.gte=(h,l)=>i.check(sa(h,l)),i.min=(h,l)=>i.check(sa(h,l)),i.lt=(h,l)=>i.check(ju(h,l)),i.lte=(h,l)=>i.check(Ha(h,l)),i.max=(h,l)=>i.check(Ha(h,l)),i.int=h=>i.check(N0(h)),i.safe=h=>i.check(N0(h)),i.positive=h=>i.check(Gu(0,h)),i.nonnegative=h=>i.check(sa(0,h)),i.negative=h=>i.check(ju(0,h)),i.nonpositive=h=>i.check(Ha(0,h)),i.multipleOf=(h,l)=>i.check(vp(h,l)),i.step=(h,l)=>i.check(vp(h,l)),i.finite=()=>i;let o=i._zod.bag;i.minValue=Math.max(o.minimum??Number.NEGATIVE_INFINITY,o.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,i.maxValue=Math.min(o.maximum??Number.POSITIVE_INFINITY,o.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,i.isInt=(o.format??"").includes("int")||Number.isSafeInteger(o.multipleOf??.5),i.isFinite=!0,i.format=o.format??null});function fI(i){return $3(ay,i)}var md=mt("ZodNumberFormat",(i,e)=>{$k.init(i,e),ay.init(i,e)});function N0(i){return j3(md,i)}function YF(i){return G3(md,i)}function KF(i){return H3(md,i)}function QF(i){return Z3(md,i)}function eB(i){return W3(md,i)}var ly=mt("ZodBoolean",(i,e)=>{ME.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>wO(i,o,h)});function pI(i){return q3(ly,i)}var cy=mt("ZodBigInt",(i,e)=>{AE.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(h,l,f)=>SO(i,h),i.gte=(h,l)=>i.check(sa(h,l)),i.min=(h,l)=>i.check(sa(h,l)),i.gt=(h,l)=>i.check(Gu(h,l)),i.gte=(h,l)=>i.check(sa(h,l)),i.min=(h,l)=>i.check(sa(h,l)),i.lt=(h,l)=>i.check(ju(h,l)),i.lte=(h,l)=>i.check(Ha(h,l)),i.max=(h,l)=>i.check(Ha(h,l)),i.positive=h=>i.check(Gu(BigInt(0),h)),i.negative=h=>i.check(ju(BigInt(0),h)),i.nonpositive=h=>i.check(Ha(BigInt(0),h)),i.nonnegative=h=>i.check(sa(BigInt(0),h)),i.multipleOf=(h,l)=>i.check(vp(h,l));let o=i._zod.bag;i.minValue=o.minimum??null,i.maxValue=o.maximum??null,i.format=o.format??null});function tB(i){return J3(cy,i)}var Gb=mt("ZodBigIntFormat",(i,e)=>{Vk.init(i,e),cy.init(i,e)});function iB(i){return K3(Gb,i)}function nB(i){return Q3(Gb,i)}var mI=mt("ZodSymbol",(i,e)=>{jk.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>TO(i,o)});function rB(i){return eO(mI,i)}var gI=mt("ZodUndefined",(i,e)=>{Gk.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>IO(i,o)});function oB(i){return tO(gI,i)}var _I=mt("ZodNull",(i,e)=>{Hk.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>EO(i,o,h)});function yI(i){return iO(_I,i)}var vI=mt("ZodAny",(i,e)=>{Zk.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>PO()});function sB(){return nO(vI)}var xI=mt("ZodUnknown",(i,e)=>{Wk.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>zO()});function ud(){return rO(xI)}var bI=mt("ZodNever",(i,e)=>{qk.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>AO(i,o,h)});function Hb(i){return oO(bI,i)}var wI=mt("ZodVoid",(i,e)=>{Xk.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>MO(i,o)});function aB(i){return sO(wI,i)}var Zb=mt("ZodDate",(i,e)=>{Jk.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(h,l,f)=>CO(i,h),i.min=(h,l)=>i.check(sa(h,l)),i.max=(h,l)=>i.check(Ha(h,l));let o=i._zod.bag;i.minDate=o.minimum?new Date(o.minimum):null,i.maxDate=o.maximum?new Date(o.maximum):null});function lB(i){return aO(Zb,i)}var SI=mt("ZodArray",(i,e)=>{Yk.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>jO(i,o,h,l),i.element=e.element,i.min=(o,h)=>i.check(cd(o,h)),i.nonempty=o=>i.check(cd(1,o)),i.max=(o,h)=>i.check(iy(o,h)),i.length=(o,h)=>i.check(ny(o,h)),i.unwrap=()=>i.element});function uy(i,e){return uO(SI,i,e)}function cB(i){let e=i._zod.def.shape;return qb(Object.keys(e))}var hy=mt("ZodObject",(i,e)=>{t3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>GO(i,o,h,l),Kn.defineLazy(i,"shape",()=>e.shape),i.keyof=()=>qb(Object.keys(i._zod.def.shape)),i.catchall=o=>i.clone({...i._zod.def,catchall:o}),i.passthrough=()=>i.clone({...i._zod.def,catchall:ud()}),i.loose=()=>i.clone({...i._zod.def,catchall:ud()}),i.strict=()=>i.clone({...i._zod.def,catchall:Hb()}),i.strip=()=>i.clone({...i._zod.def,catchall:void 0}),i.extend=o=>Kn.extend(i,o),i.safeExtend=o=>Kn.safeExtend(i,o),i.merge=o=>Kn.merge(i,o),i.pick=o=>Kn.pick(i,o),i.omit=o=>Kn.omit(i,o),i.partial=(...o)=>Kn.partial(Jb,i,o[0]),i.required=(...o)=>Kn.required(Yb,i,o[0])});function uB(i,e){let o={type:"object",shape:i??{},...Kn.normalizeParams(e)};return new hy(o)}function hB(i,e){return new hy({type:"object",shape:i,catchall:Hb(),...Kn.normalizeParams(e)})}function dB(i,e){return new hy({type:"object",shape:i,catchall:ud(),...Kn.normalizeParams(e)})}var dy=mt("ZodUnion",(i,e)=>{fb.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>oI(i,o,h,l),i.options=e.options});function Wb(i,e){return new dy({type:"union",options:i,...Kn.normalizeParams(e)})}var TI=mt("ZodXor",(i,e)=>{dy.init(i,e),i3.init(i,e),i._zod.processJSONSchema=(o,h,l)=>oI(i,o,h,l),i.options=e.options});function fB(i,e){return new TI({type:"union",options:i,inclusive:!1,...Kn.normalizeParams(e)})}var EI=mt("ZodDiscriminatedUnion",(i,e)=>{dy.init(i,e),n3.init(i,e)});function pB(i,e,o){return new EI({type:"union",options:e,discriminator:i,...Kn.normalizeParams(o)})}var II=mt("ZodIntersection",(i,e)=>{r3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>HO(i,o,h,l)});function MI(i,e){return new II({type:"intersection",left:i,right:e})}var AI=mt("ZodTuple",(i,e)=>{PE.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>ZO(i,o,h,l),i.rest=o=>i.clone({...i._zod.def,rest:o})});function PI(i,e,o){let h=e instanceof Ln,l=h?o:e;return new AI({type:"tuple",items:i,rest:h?e:null,...Kn.normalizeParams(l)})}var fy=mt("ZodRecord",(i,e)=>{o3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>WO(i,o,h,l),i.keyType=e.keyType,i.valueType=e.valueType});function zI(i,e,o){return new fy({type:"record",keyType:i,valueType:e,...Kn.normalizeParams(o)})}function mB(i,e,o){let h=el(i);return h._zod.values=void 0,new fy({type:"record",keyType:h,valueType:e,...Kn.normalizeParams(o)})}function gB(i,e,o){return new fy({type:"record",keyType:i,valueType:e,mode:"loose",...Kn.normalizeParams(o)})}var CI=mt("ZodMap",(i,e)=>{s3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>$O(i,o),i.keyType=e.keyType,i.valueType=e.valueType,i.min=(...o)=>i.check(Hu(...o)),i.nonempty=o=>i.check(Hu(1,o)),i.max=(...o)=>i.check(Pp(...o)),i.size=(...o)=>i.check(ty(...o))});function _B(i,e,o){return new CI({type:"map",keyType:i,valueType:e,...Kn.normalizeParams(o)})}var LI=mt("ZodSet",(i,e)=>{a3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>VO(i,o),i.min=(...o)=>i.check(Hu(...o)),i.nonempty=o=>i.check(Hu(1,o)),i.max=(...o)=>i.check(Pp(...o)),i.size=(...o)=>i.check(ty(...o))});function yB(i,e){return new LI({type:"set",valueType:i,...Kn.normalizeParams(e)})}var Sp=mt("ZodEnum",(i,e)=>{l3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(h,l,f)=>LO(i,h,l),i.enum=e.entries,i.options=Object.values(e.entries);let o=new Set(Object.keys(e.entries));i.extract=(h,l)=>{let f={};for(let x of h)if(o.has(x))f[x]=e.entries[x];else throw Error(`Key ${x} not found in enum`);return new Sp({...e,checks:[],...Kn.normalizeParams(l),entries:f})},i.exclude=(h,l)=>{let f={...e.entries};for(let x of h)if(o.has(x))delete f[x];else throw Error(`Key ${x} not found in enum`);return new Sp({...e,checks:[],...Kn.normalizeParams(l),entries:f})}});function qb(i,e){let o=Array.isArray(i)?Object.fromEntries(i.map(h=>[h,h])):i;return new Sp({type:"enum",entries:o,...Kn.normalizeParams(e)})}function vB(i,e){return new Sp({type:"enum",entries:i,...Kn.normalizeParams(e)})}var RI=mt("ZodLiteral",(i,e)=>{c3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>RO(i,o,h),i.values=new Set(e.values),Object.defineProperty(i,"value",{get(){if(e.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function xB(i,e){return new RI({type:"literal",values:Array.isArray(i)?i:[i],...Kn.normalizeParams(e)})}var DI=mt("ZodFile",(i,e)=>{u3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>OO(i,o,h),i.min=(o,h)=>i.check(Hu(o,h)),i.max=(o,h)=>i.check(Pp(o,h)),i.mime=(o,h)=>i.check(bb(Array.isArray(o)?o:[o],h))});function bB(i){return hO(DI,i)}var kI=mt("ZodTransform",(i,e)=>{h3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>UO(i,o),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new cb(i.constructor.name);o.addIssue=f=>{if(typeof f=="string")o.issues.push(Kn.issue(f,o.value,e));else{let x=f;x.fatal&&(x.continue=!1),x.code??(x.code="custom"),x.input??(x.input=o.value),x.inst??(x.inst=i),o.issues.push(Kn.issue(x))}};let l=e.transform(o.value,o);return l instanceof Promise?l.then(f=>(o.value=f,o)):(o.value=l,o)}});function Xb(i){return new kI({type:"transform",transform:i})}var Jb=mt("ZodOptional",(i,e)=>{zE.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>sI(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function E_(i){return new Jb({type:"optional",innerType:i})}var OI=mt("ZodExactOptional",(i,e)=>{d3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>sI(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function FI(i){return new OI({type:"optional",innerType:i})}var BI=mt("ZodNullable",(i,e)=>{f3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>qO(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function I_(i){return new BI({type:"nullable",innerType:i})}function wB(i){return E_(I_(i))}var NI=mt("ZodDefault",(i,e)=>{p3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>JO(i,o,h,l),i.unwrap=()=>i._zod.def.innerType,i.removeDefault=i.unwrap});function UI(i,e){return new NI({type:"default",innerType:i,get defaultValue(){return typeof e=="function"?e():Kn.shallowClone(e)}})}var $I=mt("ZodPrefault",(i,e)=>{m3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>YO(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function VI(i,e){return new $I({type:"prefault",innerType:i,get defaultValue(){return typeof e=="function"?e():Kn.shallowClone(e)}})}var Yb=mt("ZodNonOptional",(i,e)=>{g3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>XO(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function jI(i,e){return new Yb({type:"nonoptional",innerType:i,...Kn.normalizeParams(e)})}var GI=mt("ZodSuccess",(i,e)=>{_3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>FO(i,o,h),i.unwrap=()=>i._zod.def.innerType});function SB(i){return new GI({type:"success",innerType:i})}var HI=mt("ZodCatch",(i,e)=>{y3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>KO(i,o,h,l),i.unwrap=()=>i._zod.def.innerType,i.removeCatch=i.unwrap});function ZI(i,e){return new HI({type:"catch",innerType:i,catchValue:typeof e=="function"?e:()=>e})}var WI=mt("ZodNaN",(i,e)=>{v3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>DO(i,o)});function TB(i){return cO(WI,i)}var Kb=mt("ZodPipe",(i,e)=>{x3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>QO(i,o,h,l),i.in=e.in,i.out=e.out});function M_(i,e){return new Kb({type:"pipe",in:i,out:e})}var Qb=mt("ZodCodec",(i,e)=>{Kb.init(i,e),CE.init(i,e)});function EB(i,e,o){return new Qb({type:"pipe",in:i,out:e,transform:o.decode,reverseTransform:o.encode})}var qI=mt("ZodReadonly",(i,e)=>{b3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>eF(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function XI(i){return new qI({type:"readonly",innerType:i})}var JI=mt("ZodTemplateLiteral",(i,e)=>{w3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>kO(i,o,h)});function IB(i,e){return new JI({type:"template_literal",parts:i,...Kn.normalizeParams(e)})}var YI=mt("ZodLazy",(i,e)=>{E3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>iF(i,o,h,l),i.unwrap=()=>i._zod.def.getter()});function KI(i){return new YI({type:"lazy",getter:i})}var QI=mt("ZodPromise",(i,e)=>{T3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>tF(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function MB(i){return new QI({type:"promise",innerType:i})}var e2=mt("ZodFunction",(i,e)=>{S3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>NO(i,o)});function U0(i){return new e2({type:"function",input:Array.isArray(i==null?void 0:i.input)?PI(i==null?void 0:i.input):(i==null?void 0:i.input)??uy(ud()),output:(i==null?void 0:i.output)??ud()})}var py=mt("ZodCustom",(i,e)=>{I3.init(i,e),Fn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>BO(i,o)});function AB(i){let e=new no({check:"custom"});return e._zod.check=i,e}function PB(i,e){return dO(py,i??(()=>!0),e)}function t2(i,e={}){return fO(py,i,e)}function i2(i){return pO(i)}var zB=gO,CB=_O;function LB(i,e={}){let o=new py({type:"custom",check:"custom",fn:h=>h instanceof i,abort:!0,...Kn.normalizeParams(e)});return o._zod.bag.Class=i,o._zod.check=h=>{h.value instanceof i||h.issues.push({code:"invalid_type",expected:i.name,input:h.value,inst:o,path:[...o._zod.def.path??[]]})},o}var RB=(...i)=>yO({Codec:Qb,Boolean:ly,String:oy},...i);function DB(i){let e=KI(()=>Wb([B0(i),fI(),pI(),yI(),uy(e),zI(B0(),e)]));return e}function kB(i,e){return M_(Xb(i),e)}var N9={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};function U9(i){zs({customError:i})}function $9(){return zs().customError}var aT;aT||(aT={});var Li={...rF,...oF,iso:aI},V9=new Set(["$schema","$ref","$defs","definitions","$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor","type","enum","const","anyOf","oneOf","allOf","not","properties","required","additionalProperties","patternProperties","propertyNames","minProperties","maxProperties","items","prefixItems","additionalItems","minItems","maxItems","uniqueItems","contains","minContains","maxContains","minLength","maxLength","pattern","format","minimum","maximum","exclusiveMinimum","exclusiveMaximum","multipleOf","description","default","contentEncoding","contentMediaType","contentSchema","unevaluatedItems","unevaluatedProperties","if","then","else","dependentSchemas","dependentRequired","nullable","readOnly"]);function j9(i,e){let o=i.$schema;return o==="https://json-schema.org/draft/2020-12/schema"?"draft-2020-12":o==="http://json-schema.org/draft-07/schema#"?"draft-7":o==="http://json-schema.org/draft-04/schema#"?"draft-4":e??"draft-2020-12"}function G9(i,e){if(!i.startsWith("#"))throw Error("External $ref is not supported, only local refs (#/...) are allowed");let o=i.slice(1).split("/").filter(Boolean);if(o.length===0)return e.rootSchema;let h=e.version==="draft-2020-12"?"$defs":"definitions";if(o[0]===h){let l=o[1];if(!l||!e.defs[l])throw Error(`Reference not found: ${i}`);return e.defs[l]}throw Error(`Reference not found: ${i}`)}function OB(i,e){if(i.not!==void 0){if(typeof i.not=="object"&&Object.keys(i.not).length===0)return Li.never();throw Error("not is not supported in Zod (except { not: {} } for never)")}if(i.unevaluatedItems!==void 0)throw Error("unevaluatedItems is not supported");if(i.unevaluatedProperties!==void 0)throw Error("unevaluatedProperties is not supported");if(i.if!==void 0||i.then!==void 0||i.else!==void 0)throw Error("Conditional schemas (if/then/else) are not supported");if(i.dependentSchemas!==void 0||i.dependentRequired!==void 0)throw Error("dependentSchemas and dependentRequired are not supported");if(i.$ref){let l=i.$ref;if(e.refs.has(l))return e.refs.get(l);if(e.processing.has(l))return Li.lazy(()=>{if(!e.refs.has(l))throw Error(`Circular reference not resolved: ${l}`);return e.refs.get(l)});e.processing.add(l);let f=G9(l,e),x=Ps(f,e);return e.refs.set(l,x),e.processing.delete(l),x}if(i.enum!==void 0){let l=i.enum;if(e.version==="openapi-3.0"&&i.nullable===!0&&l.length===1&&l[0]===null)return Li.null();if(l.length===0)return Li.never();if(l.length===1)return Li.literal(l[0]);if(l.every(x=>typeof x=="string"))return Li.enum(l);let f=l.map(x=>Li.literal(x));return f.length<2?f[0]:Li.union([f[0],f[1],...f.slice(2)])}if(i.const!==void 0)return Li.literal(i.const);let o=i.type;if(Array.isArray(o)){let l=o.map(f=>{let x={...i,type:f};return OB(x,e)});return l.length===0?Li.never():l.length===1?l[0]:Li.union(l)}if(!o)return Li.any();let h;switch(o){case"string":{let l=Li.string();if(i.format){let f=i.format;f==="email"?l=l.check(Li.email()):f==="uri"||f==="uri-reference"?l=l.check(Li.url()):f==="uuid"||f==="guid"?l=l.check(Li.uuid()):f==="date-time"?l=l.check(Li.iso.datetime()):f==="date"?l=l.check(Li.iso.date()):f==="time"?l=l.check(Li.iso.time()):f==="duration"?l=l.check(Li.iso.duration()):f==="ipv4"?l=l.check(Li.ipv4()):f==="ipv6"?l=l.check(Li.ipv6()):f==="mac"?l=l.check(Li.mac()):f==="cidr"?l=l.check(Li.cidrv4()):f==="cidr-v6"?l=l.check(Li.cidrv6()):f==="base64"?l=l.check(Li.base64()):f==="base64url"?l=l.check(Li.base64url()):f==="e164"?l=l.check(Li.e164()):f==="jwt"?l=l.check(Li.jwt()):f==="emoji"?l=l.check(Li.emoji()):f==="nanoid"?l=l.check(Li.nanoid()):f==="cuid"?l=l.check(Li.cuid()):f==="cuid2"?l=l.check(Li.cuid2()):f==="ulid"?l=l.check(Li.ulid()):f==="xid"?l=l.check(Li.xid()):f==="ksuid"&&(l=l.check(Li.ksuid()))}typeof i.minLength=="number"&&(l=l.min(i.minLength)),typeof i.maxLength=="number"&&(l=l.max(i.maxLength)),i.pattern&&(l=l.regex(new RegExp(i.pattern))),h=l;break}case"number":case"integer":{let l=o==="integer"?Li.number().int():Li.number();typeof i.minimum=="number"&&(l=l.min(i.minimum)),typeof i.maximum=="number"&&(l=l.max(i.maximum)),typeof i.exclusiveMinimum=="number"?l=l.gt(i.exclusiveMinimum):i.exclusiveMinimum===!0&&typeof i.minimum=="number"&&(l=l.gt(i.minimum)),typeof i.exclusiveMaximum=="number"?l=l.lt(i.exclusiveMaximum):i.exclusiveMaximum===!0&&typeof i.maximum=="number"&&(l=l.lt(i.maximum)),typeof i.multipleOf=="number"&&(l=l.multipleOf(i.multipleOf)),h=l;break}case"boolean":{h=Li.boolean();break}case"null":{h=Li.null();break}case"object":{let l={},f=i.properties||{},x=new Set(i.required||[]);for(let[P,C]of Object.entries(f)){let O=Ps(C,e);l[P]=x.has(P)?O:O.optional()}if(i.propertyNames){let P=Ps(i.propertyNames,e),C=i.additionalProperties&&typeof i.additionalProperties=="object"?Ps(i.additionalProperties,e):Li.any();if(Object.keys(l).length===0){h=Li.record(P,C);break}let O=Li.object(l).passthrough(),F=Li.looseRecord(P,C);h=Li.intersection(O,F);break}if(i.patternProperties){let P=i.patternProperties,C=Object.keys(P),O=[];for(let V of C){let q=Ps(P[V],e),ee=Li.string().regex(new RegExp(V));O.push(Li.looseRecord(ee,q))}let F=[];if(Object.keys(l).length>0&&F.push(Li.object(l).passthrough()),F.push(...O),F.length===0)h=Li.object({}).passthrough();else if(F.length===1)h=F[0];else{let V=Li.intersection(F[0],F[1]);for(let q=2;q<F.length;q++)V=Li.intersection(V,F[q]);h=V}break}let s=Li.object(l);i.additionalProperties===!1?h=s.strict():typeof i.additionalProperties=="object"?h=s.catchall(Ps(i.additionalProperties,e)):h=s.passthrough();break}case"array":{let{prefixItems:l,items:f}=i;if(l&&Array.isArray(l)){let x=l.map(P=>Ps(P,e)),s=f&&typeof f=="object"&&!Array.isArray(f)?Ps(f,e):void 0;s?h=Li.tuple(x).rest(s):h=Li.tuple(x),typeof i.minItems=="number"&&(h=h.check(Li.minLength(i.minItems))),typeof i.maxItems=="number"&&(h=h.check(Li.maxLength(i.maxItems)))}else if(Array.isArray(f)){let x=f.map(P=>Ps(P,e)),s=i.additionalItems&&typeof i.additionalItems=="object"?Ps(i.additionalItems,e):void 0;s?h=Li.tuple(x).rest(s):h=Li.tuple(x),typeof i.minItems=="number"&&(h=h.check(Li.minLength(i.minItems))),typeof i.maxItems=="number"&&(h=h.check(Li.maxLength(i.maxItems)))}else if(f!==void 0){let x=Ps(f,e),s=Li.array(x);typeof i.minItems=="number"&&(s=s.min(i.minItems)),typeof i.maxItems=="number"&&(s=s.max(i.maxItems)),h=s}else h=Li.array(Li.any());break}default:throw Error(`Unsupported type: ${o}`)}return i.description&&(h=h.describe(i.description)),i.default!==void 0&&(h=h.default(i.default)),h}function Ps(i,e){if(typeof i=="boolean")return i?Li.any():Li.never();let o=OB(i,e),h=i.type||i.enum!==void 0||i.const!==void 0;if(i.anyOf&&Array.isArray(i.anyOf)){let s=i.anyOf.map(C=>Ps(C,e)),P=Li.union(s);o=h?Li.intersection(o,P):P}if(i.oneOf&&Array.isArray(i.oneOf)){let s=i.oneOf.map(C=>Ps(C,e)),P=Li.xor(s);o=h?Li.intersection(o,P):P}if(i.allOf&&Array.isArray(i.allOf))if(i.allOf.length===0)o=h?o:Li.any();else{let s=h?o:Ps(i.allOf[0],e),P=h?0:1;for(let C=P;C<i.allOf.length;C++)s=Li.intersection(s,Ps(i.allOf[C],e));o=s}i.nullable===!0&&e.version==="openapi-3.0"&&(o=Li.nullable(o)),i.readOnly===!0&&(o=Li.readonly(o));let l={},f=["$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor"];for(let s of f)s in i&&(l[s]=i[s]);let x=["contentEncoding","contentMediaType","contentSchema"];for(let s of x)s in i&&(l[s]=i[s]);for(let s of Object.keys(i))V9.has(s)||(l[s]=i[s]);return Object.keys(l).length>0&&e.registry.add(o,l),o}function H9(i,e){if(typeof i=="boolean")return i?Li.any():Li.never();let o=j9(i,e==null?void 0:e.defaultTarget),h=i.$defs||i.definitions||{},l={version:o,defs:h,refs:new Map,processing:new Set,rootSchema:i,registry:(e==null?void 0:e.registry)??ja};return Ps(i,l)}var FB={};Uc(FB,{string:()=>Z9,number:()=>W9,date:()=>J9,boolean:()=>q9,bigint:()=>X9});function Z9(i){return D3(oy,i)}function W9(i){return V3(ay,i)}function q9(i){return X3(ly,i)}function X9(i){return Y3(cy,i)}function J9(i){return lO(Zb,i)}zs(M3());var Y9=$e.union([$e.literal("light"),$e.literal("dark")]).describe("Color theme preference for the host environment."),A_=$e.union([$e.literal("inline"),$e.literal("fullscreen"),$e.literal("pip")]).describe("Display mode for UI presentation."),K9=$e.union([$e.literal("--color-background-primary"),$e.literal("--color-background-secondary"),$e.literal("--color-background-tertiary"),$e.literal("--color-background-inverse"),$e.literal("--color-background-ghost"),$e.literal("--color-background-info"),$e.literal("--color-background-danger"),$e.literal("--color-background-success"),$e.literal("--color-background-warning"),$e.literal("--color-background-disabled"),$e.literal("--color-text-primary"),$e.literal("--color-text-secondary"),$e.literal("--color-text-tertiary"),$e.literal("--color-text-inverse"),$e.literal("--color-text-ghost"),$e.literal("--color-text-info"),$e.literal("--color-text-danger"),$e.literal("--color-text-success"),$e.literal("--color-text-warning"),$e.literal("--color-text-disabled"),$e.literal("--color-text-ghost"),$e.literal("--color-border-primary"),$e.literal("--color-border-secondary"),$e.literal("--color-border-tertiary"),$e.literal("--color-border-inverse"),$e.literal("--color-border-ghost"),$e.literal("--color-border-info"),$e.literal("--color-border-danger"),$e.literal("--color-border-success"),$e.literal("--color-border-warning"),$e.literal("--color-border-disabled"),$e.literal("--color-ring-primary"),$e.literal("--color-ring-secondary"),$e.literal("--color-ring-inverse"),$e.literal("--color-ring-info"),$e.literal("--color-ring-danger"),$e.literal("--color-ring-success"),$e.literal("--color-ring-warning"),$e.literal("--font-sans"),$e.literal("--font-mono"),$e.literal("--font-weight-normal"),$e.literal("--font-weight-medium"),$e.literal("--font-weight-semibold"),$e.literal("--font-weight-bold"),$e.literal("--font-text-xs-size"),$e.literal("--font-text-sm-size"),$e.literal("--font-text-md-size"),$e.literal("--font-text-lg-size"),$e.literal("--font-heading-xs-size"),$e.literal("--font-heading-sm-size"),$e.literal("--font-heading-md-size"),$e.literal("--font-heading-lg-size"),$e.literal("--font-heading-xl-size"),$e.literal("--font-heading-2xl-size"),$e.literal("--font-heading-3xl-size"),$e.literal("--font-text-xs-line-height"),$e.literal("--font-text-sm-line-height"),$e.literal("--font-text-md-line-height"),$e.literal("--font-text-lg-line-height"),$e.literal("--font-heading-xs-line-height"),$e.literal("--font-heading-sm-line-height"),$e.literal("--font-heading-md-line-height"),$e.literal("--font-heading-lg-line-height"),$e.literal("--font-heading-xl-line-height"),$e.literal("--font-heading-2xl-line-height"),$e.literal("--font-heading-3xl-line-height"),$e.literal("--border-radius-xs"),$e.literal("--border-radius-sm"),$e.literal("--border-radius-md"),$e.literal("--border-radius-lg"),$e.literal("--border-radius-xl"),$e.literal("--border-radius-full"),$e.literal("--border-width-regular"),$e.literal("--shadow-hairline"),$e.literal("--shadow-sm"),$e.literal("--shadow-md"),$e.literal("--shadow-lg")]).describe("CSS variable keys available to MCP apps for theming."),Q9=$e.record(K9.describe(`Style variables for theming MCP apps.

Individual style keys are optional - hosts may provide any subset of these values.
Values are strings containing CSS values (colors, sizes, font stacks, etc.).

Note: This type uses \`Record<K, string | undefined>\` rather than \`Partial<Record<K, string>>\`
for compatibility with Zod schema generation. Both are functionally equivalent for validation.`),$e.union([$e.string(),$e.undefined()]).describe(`Style variables for theming MCP apps.

Individual style keys are optional - hosts may provide any subset of these values.
Values are strings containing CSS values (colors, sizes, font stacks, etc.).

Note: This type uses \`Record<K, string | undefined>\` rather than \`Partial<Record<K, string>>\`
for compatibility with Zod schema generation. Both are functionally equivalent for validation.`)).describe(`Style variables for theming MCP apps.

Individual style keys are optional - hosts may provide any subset of these values.
Values are strings containing CSS values (colors, sizes, font stacks, etc.).

Note: This type uses \`Record<K, string | undefined>\` rather than \`Partial<Record<K, string>>\`
for compatibility with Zod schema generation. Both are functionally equivalent for validation.`);$e.object({method:$e.literal("ui/open-link"),params:$e.object({url:$e.string().describe("URL to open in the host's browser")})});var e7=$e.object({isError:$e.boolean().optional().describe("True if the host failed to open the URL (e.g., due to security policy).")}).passthrough(),t7=$e.object({isError:$e.boolean().optional().describe("True if the host rejected or failed to deliver the message.")}).passthrough();$e.object({method:$e.literal("ui/notifications/sandbox-proxy-ready"),params:$e.object({})});var n2=$e.object({connectDomains:$e.array($e.string()).optional().describe("Origins for network requests (fetch/XHR/WebSocket)."),resourceDomains:$e.array($e.string()).optional().describe("Origins for static resources (scripts, images, styles, fonts)."),frameDomains:$e.array($e.string()).optional().describe("Origins for nested iframes (frame-src directive)."),baseUriDomains:$e.array($e.string()).optional().describe("Allowed base URIs for the document (base-uri directive).")}),r2=$e.object({camera:$e.object({}).optional().describe("Request camera access (Permission Policy `camera` feature)."),microphone:$e.object({}).optional().describe("Request microphone access (Permission Policy `microphone` feature)."),geolocation:$e.object({}).optional().describe("Request geolocation access (Permission Policy `geolocation` feature)."),clipboardWrite:$e.object({}).optional().describe("Request clipboard write access (Permission Policy `clipboard-write` feature).")});$e.object({method:$e.literal("ui/notifications/size-changed"),params:$e.object({width:$e.number().optional().describe("New width in pixels."),height:$e.number().optional().describe("New height in pixels.")})});var i7=$e.object({method:$e.literal("ui/notifications/tool-input"),params:$e.object({arguments:$e.record($e.string(),$e.unknown().describe("Complete tool call arguments as key-value pairs.")).optional().describe("Complete tool call arguments as key-value pairs.")})}),n7=$e.object({method:$e.literal("ui/notifications/tool-input-partial"),params:$e.object({arguments:$e.record($e.string(),$e.unknown().describe("Partial tool call arguments (incomplete, may change).")).optional().describe("Partial tool call arguments (incomplete, may change).")})}),r7=$e.object({method:$e.literal("ui/notifications/tool-cancelled"),params:$e.object({reason:$e.string().optional().describe('Optional reason for the cancellation (e.g., "user action", "timeout").')})}),o7=$e.object({fonts:$e.string().optional()}),s7=$e.object({variables:Q9.optional().describe("CSS variables for theming the app."),css:o7.optional().describe("CSS blocks that apps can inject.")}),a7=$e.object({method:$e.literal("ui/resource-teardown"),params:$e.object({})});$e.record($e.string(),$e.unknown());var IC=$e.object({text:$e.object({}).optional().describe("Host supports text content blocks."),image:$e.object({}).optional().describe("Host supports image content blocks."),audio:$e.object({}).optional().describe("Host supports audio content blocks."),resource:$e.object({}).optional().describe("Host supports resource content blocks."),resourceLink:$e.object({}).optional().describe("Host supports resource link content blocks."),structuredContent:$e.object({}).optional().describe("Host supports structured content.")}),l7=$e.object({experimental:$e.object({}).optional().describe("Experimental features (structure TBD)."),openLinks:$e.object({}).optional().describe("Host supports opening external URLs."),serverTools:$e.object({listChanged:$e.boolean().optional().describe("Host supports tools/list_changed notifications.")}).optional().describe("Host can proxy tool calls to the MCP server."),serverResources:$e.object({listChanged:$e.boolean().optional().describe("Host supports resources/list_changed notifications.")}).optional().describe("Host can proxy resource reads to the MCP server."),logging:$e.object({}).optional().describe("Host accepts log messages."),sandbox:$e.object({permissions:r2.optional().describe("Permissions granted by the host (camera, microphone, geolocation)."),csp:n2.optional().describe("CSP domains approved by the host.")}).optional().describe("Sandbox configuration applied by the host."),updateModelContext:IC.optional().describe("Host accepts context updates (ui/update-model-context) to be included in the model's context for future turns."),message:IC.optional().describe("Host supports receiving content messages (ui/message) from the view.")}),c7=$e.object({experimental:$e.object({}).optional().describe("Experimental features (structure TBD)."),tools:$e.object({listChanged:$e.boolean().optional().describe("App supports tools/list_changed notifications.")}).optional().describe("App exposes MCP-style tools that the host can call."),availableDisplayModes:$e.array(A_).optional().describe("Display modes the app supports.")});$e.object({method:$e.literal("ui/notifications/initialized"),params:$e.object({}).optional()});$e.object({csp:n2.optional().describe("Content Security Policy configuration."),permissions:r2.optional().describe("Sandbox permissions requested by the UI."),domain:$e.string().optional().describe("Dedicated origin for view sandbox."),prefersBorder:$e.boolean().optional().describe("Visual boundary preference - true if UI prefers a visible border.")});$e.object({method:$e.literal("ui/request-display-mode"),params:$e.object({mode:A_.describe("The display mode being requested.")})});var u7=$e.object({mode:A_.describe("The display mode that was actually set. May differ from requested if not supported.")}).passthrough(),h7=$e.union([$e.literal("model"),$e.literal("app")]).describe("Tool visibility scope - who can access the tool.");$e.object({resourceUri:$e.string().optional(),visibility:$e.array(h7).optional().describe(`Who can access this tool. Default: ["model", "app"]
- "model": Tool visible to and callable by the agent
- "app": Tool callable by the app from this server only`)});$e.object({mimeTypes:$e.array($e.string()).optional().describe('Array of supported MIME types for UI resources.\nMust include `"text/html;profile=mcp-app"` for MCP Apps support.')});$e.object({method:$e.literal("ui/message"),params:$e.object({role:$e.literal("user").describe('Message role, currently only "user" is supported.'),content:$e.array(H_).describe("Message content blocks (text, image, etc.).")})});$e.object({method:$e.literal("ui/notifications/sandbox-resource-ready"),params:$e.object({html:$e.string().describe("HTML content to load into the inner iframe."),sandbox:$e.string().optional().describe("Optional override for the inner iframe's sandbox attribute."),csp:n2.optional().describe("CSP configuration from resource metadata."),permissions:r2.optional().describe("Sandbox permissions from resource metadata.")})});var d7=$e.object({method:$e.literal("ui/notifications/tool-result"),params:lb.describe("Standard MCP tool execution result.")}),BB=$e.object({toolInfo:$e.object({id:N_.optional().describe("JSON-RPC id of the tools/call request."),tool:aE.describe("Tool definition including name, inputSchema, etc.")}).optional().describe("Metadata of the tool call that instantiated this App."),theme:Y9.optional().describe("Current color theme preference."),styles:s7.optional().describe("Style configuration for theming the app."),displayMode:A_.optional().describe("How the UI is currently displayed."),availableDisplayModes:$e.array(A_).optional().describe("Display modes the host supports."),containerDimensions:$e.union([$e.object({height:$e.number().describe("Fixed container height in pixels.")}),$e.object({maxHeight:$e.union([$e.number(),$e.undefined()]).optional().describe("Maximum container height in pixels.")})]).and($e.union([$e.object({width:$e.number().describe("Fixed container width in pixels.")}),$e.object({maxWidth:$e.union([$e.number(),$e.undefined()]).optional().describe("Maximum container width in pixels.")})])).optional().describe(`Container dimensions. Represents the dimensions of the iframe or other
container holding the app. Specify either width or maxWidth, and either height or maxHeight.`),locale:$e.string().optional().describe("User's language and region preference in BCP 47 format."),timeZone:$e.string().optional().describe("User's timezone in IANA format."),userAgent:$e.string().optional().describe("Host application identifier."),platform:$e.union([$e.literal("web"),$e.literal("desktop"),$e.literal("mobile")]).optional().describe("Platform type for responsive design decisions."),deviceCapabilities:$e.object({touch:$e.boolean().optional().describe("Whether the device supports touch input."),hover:$e.boolean().optional().describe("Whether the device supports hover interactions.")}).optional().describe("Device input capabilities."),safeAreaInsets:$e.object({top:$e.number().describe("Top safe area inset in pixels."),right:$e.number().describe("Right safe area inset in pixels."),bottom:$e.number().describe("Bottom safe area inset in pixels."),left:$e.number().describe("Left safe area inset in pixels.")}).optional().describe("Mobile safe area boundaries in pixels.")}).passthrough(),f7=$e.object({method:$e.literal("ui/notifications/host-context-changed"),params:BB.describe("Partial context update containing only changed fields.")});$e.object({method:$e.literal("ui/update-model-context"),params:$e.object({content:$e.array(H_).optional().describe("Context content blocks (text, image, etc.)."),structuredContent:$e.record($e.string(),$e.unknown().describe("Structured content for machine-readable context data.")).optional().describe("Structured content for machine-readable context data.")})});$e.object({method:$e.literal("ui/initialize"),params:$e.object({appInfo:sb.describe("App identification (name and version)."),appCapabilities:c7.describe("Features and capabilities this app provides."),protocolVersion:$e.string().describe("Protocol version this app supports.")})});var p7=$e.object({protocolVersion:$e.string().describe('Negotiated protocol version string (e.g., "2025-11-21").'),hostInfo:sb.describe("Host application identification and version."),hostCapabilities:l7.describe("Features and capabilities provided by the host."),hostContext:BB.describe("Rich context about the host environment.")}).passthrough();function m7(i){let e=document.documentElement;e.setAttribute("data-theme",i),e.style.colorScheme=i}function g7(i,e=document.documentElement){for(let[o,h]of Object.entries(i))h!==void 0&&e.style.setProperty(o,h)}function _7(i){if(document.getElementById("__mcp-host-fonts"))return;let e=document.createElement("style");e.id="__mcp-host-fonts",e.textContent=i,document.head.appendChild(e)}class y7 extends gZ{constructor(o,h={},l={autoResize:!0}){super(l);Ms(this,"_appInfo");Ms(this,"_capabilities");Ms(this,"options");Ms(this,"_hostCapabilities");Ms(this,"_hostInfo");Ms(this,"_hostContext");Ms(this,"sendOpenLink",this.openLink);this._appInfo=o,this._capabilities=h,this.options=l,this.setRequestHandler(ab,f=>(console.log("Received ping:",f.params),{})),this.onhostcontextchanged=()=>{}}getHostCapabilities(){return this._hostCapabilities}getHostVersion(){return this._hostInfo}getHostContext(){return this._hostContext}set ontoolinput(o){this.setNotificationHandler(i7,h=>o(h.params))}set ontoolinputpartial(o){this.setNotificationHandler(n7,h=>o(h.params))}set ontoolresult(o){this.setNotificationHandler(d7,h=>o(h.params))}set ontoolcancelled(o){this.setNotificationHandler(r7,h=>o(h.params))}set onhostcontextchanged(o){this.setNotificationHandler(f7,h=>{this._hostContext={...this._hostContext,...h.params},o(h.params)})}set onteardown(o){this.setRequestHandler(a7,(h,l)=>o(h.params,l))}set oncalltool(o){this.setRequestHandler(XR,(h,l)=>o(h.params,l))}set onlisttools(o){this.setRequestHandler(qR,(h,l)=>o(h.params,l))}assertCapabilityForMethod(o){}assertRequestHandlerCapability(o){switch(o){case"tools/call":case"tools/list":if(!this._capabilities.tools)throw Error(`Client does not support tool capability (required for ${o})`);return;case"ping":case"ui/resource-teardown":return;default:throw Error(`No handler for method ${o} registered`)}}assertNotificationCapability(o){}assertTaskCapability(o){throw Error("Tasks are not supported in MCP Apps")}assertTaskHandlerCapability(o){throw Error("Task handlers are not supported in MCP Apps")}async callServerTool(o,h){return await this.request({method:"tools/call",params:o},lb,h)}sendMessage(o,h){return this.request({method:"ui/message",params:o},t7,h)}sendLog(o){return this.notification({method:"notifications/message",params:o})}updateModelContext(o,h){return this.request({method:"ui/update-model-context",params:o},ZT,h)}openLink(o,h){return this.request({method:"ui/open-link",params:o},e7,h)}requestDisplayMode(o,h){return this.request({method:"ui/request-display-mode",params:o},u7,h)}sendSizeChanged(o){return this.notification({method:"ui/notifications/size-changed",params:o})}setupSizeChangedNotifications(){let o=!1,h=0,l=0,f=()=>{o||(o=!0,requestAnimationFrame(()=>{o=!1;let s=document.documentElement,P=s.style.width,C=s.style.height;s.style.width="fit-content",s.style.height="fit-content";let O=s.getBoundingClientRect();s.style.width=P,s.style.height=C;let F=window.innerWidth-s.clientWidth,V=Math.ceil(O.width+F),q=Math.ceil(O.height);(V!==h||q!==l)&&(h=V,l=q,this.sendSizeChanged({width:V,height:q}))}))};f();let x=new ResizeObserver(f);return x.observe(document.documentElement),x.observe(document.body),()=>x.disconnect()}async connect(o=new yZ(window.parent,window.parent),h){var l;await super.connect(o);try{let f=await this.request({method:"ui/initialize",params:{appCapabilities:this._capabilities,appInfo:this._appInfo,protocolVersion:vZ}},p7,h);if(f===void 0)throw Error(`Server sent invalid initialize result: ${f}`);this._hostCapabilities=f.hostCapabilities,this._hostInfo=f.hostInfo,this._hostContext=f.hostContext,await this.notification({method:"ui/notifications/initialized"}),(l=this.options)!=null&&l.autoResize&&this.setupSizeChangedNotifications()}catch(f){throw this.close(),f}}}function v7(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var T0={exports:{}},x7=T0.exports,MC;function b7(){return MC||(MC=1,(function(i,e){(function(o,h){i.exports=h()})(x7,(function(){var o,h,l;function f(s,P){if(!o)o=P;else if(!h)h=P;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",O={};o(O),l=P(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}f(["exports"],function(s){var P=1e-6,C=typeof Float32Array<"u"?Float32Array:Array;function O(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=r*g-d*c;return _?(a[0]=g*(_=1/_),a[1]=-c*_,a[2]=-d*_,a[3]=r*_,a):null}function F(){var a=new C(9);return C!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function V(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=t[4],v=t[5],S=t[6],T=t[7],M=t[8];return a[0]=_*M-v*T,a[1]=d*T-c*M,a[2]=c*v-d*_,a[3]=v*S-g*M,a[4]=r*M-d*S,a[5]=d*g-r*v,a[6]=g*T-_*S,a[7]=c*S-r*T,a[8]=r*_-c*g,a}function q(a,t,r){var c=t[0],d=t[1],g=t[2],_=t[3],v=t[4],S=t[5],T=t[6],M=t[7],A=t[8],z=r[0],D=r[1],k=r[2],$=r[3],H=r[4],j=r[5],X=r[6],Y=r[7],te=r[8];return a[0]=z*c+D*_+k*T,a[1]=z*d+D*v+k*M,a[2]=z*g+D*S+k*A,a[3]=$*c+H*_+j*T,a[4]=$*d+H*v+j*M,a[5]=$*g+H*S+j*A,a[6]=X*c+Y*_+te*T,a[7]=X*d+Y*v+te*M,a[8]=X*g+Y*S+te*A,a}function ee(){var a=new C(16);return C!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function se(a){var t=new C(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}function fe(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ae(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=t[4],v=t[5],S=t[6],T=t[7],M=t[8],A=t[9],z=t[10],D=t[11],k=t[12],$=t[13],H=t[14],j=t[15],X=r*v-c*_,Y=r*S-d*_,te=r*T-g*_,ue=c*S-d*v,le=c*T-g*v,ge=d*T-g*S,ye=M*$-A*k,me=M*H-z*k,we=M*j-D*k,Ie=A*H-z*$,Je=A*j-D*$,qe=z*j-D*H,Xe=X*qe-Y*Je+te*Ie+ue*we-le*me+ge*ye;return Xe?(a[0]=(v*qe-S*Je+T*Ie)*(Xe=1/Xe),a[1]=(d*Je-c*qe-g*Ie)*Xe,a[2]=($*ge-H*le+j*ue)*Xe,a[3]=(z*le-A*ge-D*ue)*Xe,a[4]=(S*we-_*qe-T*me)*Xe,a[5]=(r*qe-d*we+g*me)*Xe,a[6]=(H*te-k*ge-j*Y)*Xe,a[7]=(M*ge-z*te+D*Y)*Xe,a[8]=(_*Je-v*we+T*ye)*Xe,a[9]=(c*we-r*Je-g*ye)*Xe,a[10]=(k*le-$*te+j*X)*Xe,a[11]=(A*te-M*le-D*X)*Xe,a[12]=(v*me-_*Ie-S*ye)*Xe,a[13]=(r*Ie-c*me+d*ye)*Xe,a[14]=($*Y-k*ue-H*X)*Xe,a[15]=(M*ue-A*Y+z*X)*Xe,a):null}function ie(a,t,r){var c=t[0],d=t[1],g=t[2],_=t[3],v=t[4],S=t[5],T=t[6],M=t[7],A=t[8],z=t[9],D=t[10],k=t[11],$=t[12],H=t[13],j=t[14],X=t[15],Y=r[0],te=r[1],ue=r[2],le=r[3];return a[0]=Y*c+te*v+ue*A+le*$,a[1]=Y*d+te*S+ue*z+le*H,a[2]=Y*g+te*T+ue*D+le*j,a[3]=Y*_+te*M+ue*k+le*X,a[4]=(Y=r[4])*c+(te=r[5])*v+(ue=r[6])*A+(le=r[7])*$,a[5]=Y*d+te*S+ue*z+le*H,a[6]=Y*g+te*T+ue*D+le*j,a[7]=Y*_+te*M+ue*k+le*X,a[8]=(Y=r[8])*c+(te=r[9])*v+(ue=r[10])*A+(le=r[11])*$,a[9]=Y*d+te*S+ue*z+le*H,a[10]=Y*g+te*T+ue*D+le*j,a[11]=Y*_+te*M+ue*k+le*X,a[12]=(Y=r[12])*c+(te=r[13])*v+(ue=r[14])*A+(le=r[15])*$,a[13]=Y*d+te*S+ue*z+le*H,a[14]=Y*g+te*T+ue*D+le*j,a[15]=Y*_+te*M+ue*k+le*X,a}function tt(a,t,r){var c,d,g,_,v,S,T,M,A,z,D,k,$=r[0],H=r[1],j=r[2];return t===a?(a[12]=t[0]*$+t[4]*H+t[8]*j+t[12],a[13]=t[1]*$+t[5]*H+t[9]*j+t[13],a[14]=t[2]*$+t[6]*H+t[10]*j+t[14],a[15]=t[3]*$+t[7]*H+t[11]*j+t[15]):(d=t[1],g=t[2],_=t[3],v=t[4],S=t[5],T=t[6],M=t[7],A=t[8],z=t[9],D=t[10],k=t[11],a[0]=c=t[0],a[1]=d,a[2]=g,a[3]=_,a[4]=v,a[5]=S,a[6]=T,a[7]=M,a[8]=A,a[9]=z,a[10]=D,a[11]=k,a[12]=c*$+v*H+A*j+t[12],a[13]=d*$+S*H+z*j+t[13],a[14]=g*$+T*H+D*j+t[14],a[15]=_*$+M*H+k*j+t[15]),a}function Ue(a,t,r){var c=r[0],d=r[1],g=r[2];return a[0]=t[0]*c,a[1]=t[1]*c,a[2]=t[2]*c,a[3]=t[3]*c,a[4]=t[4]*d,a[5]=t[5]*d,a[6]=t[6]*d,a[7]=t[7]*d,a[8]=t[8]*g,a[9]=t[9]*g,a[10]=t[10]*g,a[11]=t[11]*g,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a}function Ne(a,t,r){var c=Math.sin(r),d=Math.cos(r),g=t[4],_=t[5],v=t[6],S=t[7],T=t[8],M=t[9],A=t[10],z=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=g*d+T*c,a[5]=_*d+M*c,a[6]=v*d+A*c,a[7]=S*d+z*c,a[8]=T*d-g*c,a[9]=M*d-_*c,a[10]=A*d-v*c,a[11]=z*d-S*c,a}function Ce(a,t,r){var c=Math.sin(r),d=Math.cos(r),g=t[0],_=t[1],v=t[2],S=t[3],T=t[8],M=t[9],A=t[10],z=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*d-T*c,a[1]=_*d-M*c,a[2]=v*d-A*c,a[3]=S*d-z*c,a[8]=g*c+T*d,a[9]=_*c+M*d,a[10]=v*c+A*d,a[11]=S*c+z*d,a}function Ye(a,t,r){var c=Math.sin(r),d=Math.cos(r),g=t[0],_=t[1],v=t[2],S=t[3],T=t[4],M=t[5],A=t[6],z=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*d+T*c,a[1]=_*d+M*c,a[2]=v*d+A*c,a[3]=S*d+z*c,a[4]=T*d-g*c,a[5]=M*d-_*c,a[6]=A*d-v*c,a[7]=z*d-S*c,a}function At(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ft(a,t,r){var c,d,g,_=r[0],v=r[1],S=r[2],T=Math.sqrt(_*_+v*v+S*S);return T<P?null:(_*=T=1/T,v*=T,S*=T,c=Math.sin(t),d=Math.cos(t),a[0]=_*_*(g=1-d)+d,a[1]=v*_*g+S*c,a[2]=S*_*g-v*c,a[3]=0,a[4]=_*v*g-S*c,a[5]=v*v*g+d,a[6]=S*v*g+_*c,a[7]=0,a[8]=_*S*g+v*c,a[9]=v*S*g-_*c,a[10]=S*S*g+d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function wt(a,t){var r=t[0],c=t[1],d=t[2],g=t[4],_=t[5],v=t[6],S=t[8],T=t[9],M=t[10];return a[0]=Math.sqrt(r*r+c*c+d*d),a[1]=Math.sqrt(g*g+_*_+v*v),a[2]=Math.sqrt(S*S+T*T+M*M),a}function Et(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=r+r,v=c+c,S=d+d,T=r*_,M=c*_,A=c*v,z=d*_,D=d*v,k=d*S,$=g*_,H=g*v,j=g*S;return a[0]=1-A-k,a[1]=M+j,a[2]=z-H,a[3]=0,a[4]=M-j,a[5]=1-T-k,a[6]=D+$,a[7]=0,a[8]=z+H,a[9]=D-$,a[10]=1-T-A,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}var Dt=ie;function Qe(){var a=new C(3);return C!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function ht(a){var t=new C(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t}function _t(a){var t=a[0],r=a[1],c=a[2];return Math.sqrt(t*t+r*r+c*c)}function yt(a,t,r){var c=new C(3);return c[0]=a,c[1]=t,c[2]=r,c}function Nt(a,t,r,c){return a[0]=t,a[1]=r,a[2]=c,a}function ei(a,t,r){return a[0]=t[0]+r[0],a[1]=t[1]+r[1],a[2]=t[2]+r[2],a}function mi(a,t,r){return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],a}function Pi(a,t,r){return a[0]=t[0]*r[0],a[1]=t[1]*r[1],a[2]=t[2]*r[2],a}function Ai(a,t,r){return a[0]=Math.min(t[0],r[0]),a[1]=Math.min(t[1],r[1]),a[2]=Math.min(t[2],r[2]),a}function dn(a,t,r){return a[0]=Math.max(t[0],r[0]),a[1]=Math.max(t[1],r[1]),a[2]=Math.max(t[2],r[2]),a}function wi(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r,a}function Rn(a,t,r,c){return a[0]=t[0]+r[0]*c,a[1]=t[1]+r[1]*c,a[2]=t[2]+r[2]*c,a}function Un(a,t){var r=t[0]-a[0],c=t[1]-a[1],d=t[2]-a[2];return Math.sqrt(r*r+c*c+d*d)}function Zt(a,t){var r=t[0]-a[0],c=t[1]-a[1],d=t[2]-a[2];return r*r+c*c+d*d}function pr(a){var t=a[0],r=a[1],c=a[2];return t*t+r*r+c*c}function zn(a,t){return a[0]=-t[0],a[1]=-t[1],a[2]=-t[2],a}function Di(a,t){var r=t[0],c=t[1],d=t[2],g=r*r+c*c+d*d;return g>0&&(g=1/Math.sqrt(g)),a[0]=t[0]*g,a[1]=t[1]*g,a[2]=t[2]*g,a}function Ii(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]}function hn(a,t,r){var c=t[0],d=t[1],g=t[2],_=r[0],v=r[1],S=r[2];return a[0]=d*S-g*v,a[1]=g*_-c*S,a[2]=c*v-d*_,a}function ti(a,t,r,c){var d=t[0],g=t[1],_=t[2];return a[0]=d+c*(r[0]-d),a[1]=g+c*(r[1]-g),a[2]=_+c*(r[2]-_),a}function qt(a,t,r){var c=t[0],d=t[1],g=t[2],_=r[3]*c+r[7]*d+r[11]*g+r[15];return a[0]=(r[0]*c+r[4]*d+r[8]*g+r[12])/(_=_||1),a[1]=(r[1]*c+r[5]*d+r[9]*g+r[13])/_,a[2]=(r[2]*c+r[6]*d+r[10]*g+r[14])/_,a}function hi(a,t,r){var c=t[0],d=t[1],g=t[2];return a[0]=c*r[0]+d*r[3]+g*r[6],a[1]=c*r[1]+d*r[4]+g*r[7],a[2]=c*r[2]+d*r[5]+g*r[8],a}function ji(a,t,r){var c=r[0],d=r[1],g=r[2],_=r[3],v=t[0],S=t[1],T=t[2],M=d*T-g*S,A=g*v-c*T,z=c*S-d*v;return a[0]=v+_*(M+=M)+d*(z+=z)-g*(A+=A),a[1]=S+_*A+g*M-c*z,a[2]=T+_*z+c*A-d*M,a}function zi(a){return a[0]=0,a[1]=0,a[2]=0,a}function Ve(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]}var Le=mi,Wt=Pi,Jt=_t;function rt(){var a=new C(4);return C!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function oi(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r,a[3]=t[3]*r,a}function Si(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=r*r+c*c+d*d+g*g;return _>0&&(_=1/Math.sqrt(_)),a[0]=r*_,a[1]=c*_,a[2]=d*_,a[3]=g*_,a}function _i(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]*t[3]}function Kt(a,t,r){var c=t[0],d=t[1],g=t[2],_=t[3];return a[0]=r[0]*c+r[4]*d+r[8]*g+r[12]*_,a[1]=r[1]*c+r[5]*d+r[9]*g+r[13]*_,a[2]=r[2]*c+r[6]*d+r[10]*g+r[14]*_,a[3]=r[3]*c+r[7]*d+r[11]*g+r[15]*_,a}function Wi(){var a=new C(4);return C!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Xi(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Vi(a,t,r){r*=.5;var c=t[0],d=t[1],g=t[2],_=t[3],v=Math.sin(r),S=Math.cos(r);return a[0]=c*S+_*v,a[1]=d*S+g*v,a[2]=g*S-d*v,a[3]=_*S-c*v,a}function Ji(a,t,r){r*=.5;var c=t[0],d=t[1],g=t[2],_=t[3],v=Math.sin(r),S=Math.cos(r);return a[0]=c*S-g*v,a[1]=d*S+_*v,a[2]=g*S+c*v,a[3]=_*S-d*v,a}Qe(),rt();var ki,mr,Er,Il=Si,Ys=(ki=Qe(),mr=yt(1,0,0),Er=yt(0,1,0),function(a,t,r){var c=Ii(t,r);return c<-.999999?(hn(ki,mr,t),Jt(ki)<1e-6&&hn(ki,Er,t),Di(ki,ki),(function(d,g,_){_*=.5;var v=Math.sin(_);d[0]=v*g[0],d[1]=v*g[1],d[2]=v*g[2],d[3]=Math.cos(_)})(a,ki,Math.PI),a):c>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(hn(ki,t,r),a[0]=ki[0],a[1]=ki[1],a[2]=ki[2],a[3]=1+c,Il(a,a))});function mo(){var a=new C(2);return C!=Float32Array&&(a[0]=0,a[1]=0),a}function Ks(a,t){var r=new C(2);return r[0]=a,r[1]=t,r}function ua(a,t,r){return a[0]=t,a[1]=r,a}function Qs(a,t,r){return a[0]=t[0]+r[0],a[1]=t[1]+r[1],a}function ha(a,t,r){return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a}function _s(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a}function da(a){var t=a[0],r=a[1];return Math.sqrt(t*t+r*r)}function il(a,t){var r=t[0],c=t[1],d=r*r+c*c;return d>0&&(d=1/Math.sqrt(d)),a[0]=t[0]*d,a[1]=t[1]*d,a}function $n(a,t){return a[0]*t[0]+a[1]*t[1]}Wi(),Wi(),F();var yr,lc,Ml=ha;function Qo(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}mo();var De=(function(){if(lc)return yr;function a(t,r,c,d){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=c,this.p2y=d}return lc=1,yr=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,d=0;d<8;d++){var g=this.sampleCurveX(c)-t;if(Math.abs(g)<r)return c;var _=this.sampleCurveDerivativeX(c);if(Math.abs(_)<1e-6)break;c-=g/_}var v=0,S=1;for(c=t,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-t)<r));d++)t>g?v=c:S=c,c=.5*(S-v)+v;return c},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},yr})(),Lt=Qo(De);function Ae(a,t){this.x=a,this.y=t}function Ot(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(!Ot(a[r],t[r]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const r in a)if(!Ot(a[r],t[r]))return!1;return!0}return a===t}Ae.prototype={clone(){return new Ae(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,t){return this.clone()._rotateAround(a,t)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const t=a.x-this.x,r=a.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult(a){const t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const t=Math.cos(a),r=Math.sin(a),c=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=c,this},_rotateAround(a,t){const r=Math.cos(a),c=Math.sin(a),d=t.y+c*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-c*(this.y-t.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ae},Ae.convert=function(a){if(a instanceof Ae)return a;if(Array.isArray(a))return new Ae(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new Ae(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const yi=Math.PI/180,Cn=180/Math.PI;function ii(a){return a*yi}function Ee(a){return a*Cn}const Z=[[0,0],[1,0],[1,1],[0,1]];function Q(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,r=t*a;return 4*(a<.5?r:3*(a-t)+r-.75)}function ce(a,t,r,c){const d=new Lt(a,t,r,c);return function(g){return d.solve(g)}}const xe=ce(.25,.1,.25,1);function de(a,t,r){return Math.min(r,Math.max(t,a))}function Me(a,t,r){return(r=de((r-a)/(t-a),0,1))*r*(3-2*r)}function Oe(a,t,r){const c=r-t,d=((a-t)%c+c)%c+t;return d===t?r:d}function Pe(a,t,r){if(!a.length)return r(null,[]);let c=a.length;const d=new Array(a.length);let g=null;a.forEach((_,v)=>{t(_,(S,T)=>{S&&(g=S),d[v]=T,--c===0&&r(g,d)})})}let Be=1;function gt(){return Be++}function st(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log2(a)))}function Ft(a,t){a.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function ri(a,t,r){const c={};for(const d in a)c[d]=t.call(this,a[d],d,a);return c}function ci(a,t,r){const c={};for(const d in a)t.call(this,a[d],d,a)&&(c[d]=a[d]);return c}function Oi(a){return Array.isArray(a)?a.map(Oi):typeof a=="object"&&a?ri(a,Oi):a}function Gi(a,t){for(let r=0;r<a.length;r++)if(t.indexOf(a[r])>=0)return!0;return!1}const Ti={};function vi(a){Ti[a]||(typeof console<"u"&&console.warn(a),Ti[a]=!0)}function Vn(a,t,r){return(r.y-a.y)*(t.x-a.x)>(t.y-a.y)*(r.x-a.x)}function Nr(a){let t=0;for(let r,c,d=0,g=a.length,_=g-1;d<g;_=d++)r=a[d],c=a[_],t+=(c.x-r.x)*(r.y+c.y);return t}function vr([a,t,r]){const c=ii(t+90),d=ii(r);return{x:a*Math.cos(c)*Math.sin(d),y:a*Math.sin(c)*Math.sin(d),z:a*Math.cos(d),azimuthal:t,polar:r}}function xr(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function Qn(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,c,d,g)=>{const _=d||g;return t[c]=!_||_.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let sn=null;function nr(a,t){return[a[4*t],a[4*t+1],a[4*t+2],a[4*t+3]]}function kn(a,t,r,c){for(;t<r;){const d=t+r>>1;a[d]<c?t=d+1:r=d}return t}function On(a,t,r,c){for(;t<r;){const d=t+r>>1;a[d]<=c?t=d+1:r=d}return t}function gr(a){return a>0?1/(1.001-a):1+a}function To(a){return a>0?1-1/(1.001-a):-a}function go(a,t,r){return(a-t.min)*(r.max-r.min)/(t.max-t.min)+r.min}const jr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!jr.API_URL)return null;try{const a=new URL(jr.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Al(a){return jr.API_URL_REGEX.test(a)}function zo(a){return jr.API_SPRITE_REGEX.test(a)}let ys,ea,fa,vs,Fo,nl;function cc(){return ys==null&&(ys=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ys}const Cs={now:()=>vs!==void 0?vs:performance.now(),setNow(a){vs=a},restoreNow(){vs=void 0},frame(a){const t=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(a,t=0){const{width:r,height:c}=a;Fo||(Fo=document.createElement("canvas"));const d=Fo.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(r>Fo.width||c>Fo.height)&&(Fo.width=r,Fo.height=c),d.clearRect(-t,-t,r+2*t,c+2*t),d.drawImage(a,0,0,r,c),d.getImageData(-t,-t,r+2*t,c+2*t)},resolveURL:a=>(ea||(ea=document.createElement("a")),ea.href=a,ea.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(fa==null&&(fa=window.matchMedia("(prefers-reduced-motion: reduce)")),fa.matches)},hasCanvasFingerprintNoise(){if(nl!==void 0)return nl;if(!cc())return nl=!1,!1;const a=new OffscreenCanvas(85,1),t=a.getContext("2d",{willReadFrequently:!0});let r=0;for(let d=0;d<a.width;++d)t.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,t.fillRect(d,0,1,1);const c=t.getImageData(0,0,a.width,a.height);r=0;for(let d=0;d<c.data.length;++d)if(d%4!=3&&r++!==c.data[d])return nl=!0,!0;return nl=!1,!1}};function Ku(a,t){const r=a.indexOf("?");if(r<0)return`${a}?${new URLSearchParams(t).toString()}`;const c=new URLSearchParams(a.slice(r));for(const d in t)c.set(d,t[d]);return`${a.slice(0,r)}?${c.toString()}`}function Qu(a,t={persistentParams:[]}){const r=a.indexOf("?");if(r<0)return a;const c=new URLSearchParams,d=new URLSearchParams(a.slice(r));for(const _ of t.persistentParams){const v=d.get(_);v&&c.set(_,v)}const g=c.toString();return`${a.slice(0,r)}${g.length>0?`?${g}`:""}`}const yy="mapbox-tiles";let vy=500,Bp=50;const Np=["language","worldview","jobid"];let _o,Ls;function rl(){try{return caches}catch{}}function Rs(){const a=rl();a&&_o==null&&(_o=a.open(yy))}let Aa=1/0;const jc={supported:!1,testSupport:function(a){!Pl&&uc&&(_d?by(a):Gc=a)}};let Gc,uc,Pl=!1,_d=!1;const xy=typeof self<"u"?self:{};function by(a){const t=a.createTexture();a.bindTexture(a.TEXTURE_2D,t);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,uc),a.isContextLost())return;jc.supported=!0}catch{}a.deleteTexture(t),Pl=!0}xy.document&&(uc=xy.document.createElement("img"),uc.onload=function(){Gc&&by(Gc),Gc=null,_d=!0},uc.onerror=function(){Pl=!0,Gc=null},uc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const es={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(es);class eh extends Error{constructor(t,r,c){r===401&&Al(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const th=xr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ol=function(a,t){if(!(/^file:/.test(r=a.url)||/^file:/.test(th())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(c,d){const g=new AbortController,_=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:th(),referrerPolicy:c.referrerPolicy,signal:g.signal});let v=!1,S=!1;const T=(M=_.url).indexOf("sku=")>0&&Al(M);var M;c.type==="json"&&_.headers.set("Accept","application/json");const A=(D,k,$)=>{if(S)return;if(D&&D.message!=="SecurityError"&&vi(D.toString()),k&&$)return z(k);const H=Date.now();fetch(_).then(j=>{if(j.ok){const X=T?j.clone():null;return z(j,X,H)}return d(new eh(j.statusText,j.status,c.url))}).catch(j=>{j.name!=="AbortError"&&d(new Error(`${j.message} ${c.url}`))})},z=(D,k,$)=>{(c.type==="arrayBuffer"?D.arrayBuffer():c.type==="json"?D.json():D.text()).then(H=>{S||(k&&$&&(function(j,X,Y){if(Rs(),_o==null)return;const te=Qn(X.headers.get("Cache-Control")||"");if(te["no-store"])return;const ue={status:X.status,statusText:X.statusText,headers:new Headers};X.headers.forEach((ye,me)=>ue.headers.set(me,ye)),te["max-age"]&&ue.headers.set("Expires",new Date(Y+1e3*te["max-age"]).toUTCString());const le=ue.headers.get("Expires");if(!le||new Date(le).getTime()-Y<42e4)return;let ge=Qu(j.url,{persistentParams:Np});if(X.status===206){const ye=j.headers.get("Range");if(!ye)return;ue.status=200,ge=Ku(ge,{range:ye})}(function(ye,me){if(Ls===void 0)try{new Response(new ReadableStream),Ls=!0}catch{Ls=!1}Ls?me(ye.body):ye.blob().then(me).catch(we=>vi(we.message))})(X,ye=>{const me=new Response((we=X.status)!==200&&we!==404&&[101,103,204,205,304].includes(we)?null:ye,ue);var we;Rs(),_o!=null&&_o.then(Ie=>Ie.put(ge,me)).catch(Ie=>vi(Ie.message))})})(_,k,$),v=!0,d(null,H,D.headers))}).catch(H=>{S||d(new Error(H.message))})};return T?(function(D,k){if(Rs(),_o==null)return k(null);_o.then($=>{let H=Qu(D.url,{persistentParams:Np});const j=D.headers.get("Range");j&&(H=Ku(H,{range:j})),$.match(H).then(X=>{const Y=(function(te){if(!te)return!1;const ue=new Date(te.headers.get("Expires")||0),le=Qn(te.headers.get("Cache-Control")||"");return Number(ue)>Date.now()&&!le["no-cache"]})(X);$.delete(H).catch(k),Y&&$.put(H,X.clone()).catch(k),k(null,X,Y)}).catch(k)}).catch(k)})(_,A):A(null,null),{cancel:()=>{S=!0,v||g.abort()}}})(a,t);if(xr(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,t,void 0,!0)}var r;return(function(c,d){const g=new XMLHttpRequest;g.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const _ in c.headers)g.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=c.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let _=g.response;if(c.type==="json")try{_=JSON.parse(g.response)}catch(S){return d(S)}const v=new Headers;g.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(S=>{const T=S.split(": "),M=T.shift(),A=T.join(": ");v.append(M,A)}),d(null,_,v)}else d(new eh(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}})(a,t)},ih=function(a,t){return ol(Object.assign(a,{type:"arrayBuffer"}),t)};function hw(a){const t=document.createElement("a");return t.href=a,t.protocol===location.protocol&&t.host===location.host}const Up="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let un,Hc;un=[],Hc=0;const yd=function(a,t){if(jc.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Hc>=jr.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return un.push(g),g}Hc++;let r=!1;const c=()=>{if(!r)for(r=!0,Hc--;un.length&&Hc<jr.MAX_PARALLEL_IMAGE_REQUESTS;){const g=un.shift(),{requestParameters:_,callback:v,cancelled:S}=g;S||(g.cancel=yd(_,v).cancel)}},d=ih(a,(g,_,v)=>{c(),g?t(g):_&&(self.createImageBitmap?(function(S,T){const M=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(M).then(A=>{T(null,A)}).catch(A=>{T(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(_,(S,T)=>t(S,T,v)):(function(S,T){const M=new Image;M.onload=()=>{T(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=Up})},M.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(S)],{type:"image/png"});M.src=S.byteLength?URL.createObjectURL(A):Up})(_,(S,T)=>t(S,T,v)))});return{cancel:()=>{d.cancel(),c()}}};var wy,Sy,nh,zl={exports:{}},rh={exports:{}},vd={exports:{}},dw=(function(){if(nh)return zl.exports;nh=1;var a=(wy||(wy=1,rh.exports=function(r,c){var d,g,_,v,S,T,M,A;for(g=r.length-(d=3&r.length),_=c,S=3432918353,T=461845907,A=0;A<g;)M=255&r.charCodeAt(A)|(255&r.charCodeAt(++A))<<8|(255&r.charCodeAt(++A))<<16|(255&r.charCodeAt(++A))<<24,++A,_=27492+(65535&(v=5*(65535&(_=(_^=M=(65535&(M=(M=(65535&M)*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+(((v>>>16)+58964&65535)<<16);switch(M=0,d){case 3:M^=(255&r.charCodeAt(A+2))<<16;case 2:M^=(255&r.charCodeAt(A+1))<<8;case 1:_^=M=(65535&(M=(M=(65535&(M^=255&r.charCodeAt(A)))*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),rh.exports),t=(Sy||(Sy=1,vd.exports=function(r,c){for(var d,g=r.length,_=c^g,v=0;g>=4;)d=1540483477*(65535&(d=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++v;switch(g){case 3:_^=(255&r.charCodeAt(v+2))<<16;case 2:_^=(255&r.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),vd.exports);return zl.exports=a,zl.exports.murmur3=a,zl.exports.murmur2=t,zl.exports})(),Zc=Qo(dw);class sl{constructor(t,...r){Object.assign(this,r[0]||{}),this.type=t}}class oh extends sl{constructor(t,r={}){super("error",Object.assign({error:t},r))}}function Ty(a,t,r){r[a]&&r[a].indexOf(t)!==-1||(r[a]=r[a]||[],r[a].push(t))}function hc(a,t,r){if(r&&r[a]){const c=r[a].indexOf(t);c!==-1&&r[a].splice(c,1)}}class al{on(t,r){return this._listeners=this._listeners||{},Ty(t,r,this._listeners),this}off(t,r){return hc(t,r,this._listeners),hc(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ty(t,r,this._oneTimeListeners),this):new Promise(c=>{this.once(t,c)})}fire(t,r){const c=typeof t=="string"?new sl(t,r):t,d=c.type;if(this.listens(d)){c.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const S of g)S.call(this,c);const _=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const S of _)hc(d,S,this._oneTimeListeners),S.call(this,c);const v=this._eventedParent;if(v){const S=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(c,S),v.fire(c)}}else c instanceof oh&&console.error(c.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}class ts{constructor(t){typeof t=="string"?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId)}static from(t){return new ts(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){const[r,c]=t.split("");return new ts({name:r,iconsetId:c})}static isEqual(t,r){return t.name===r.name&&t.iconsetId===r.iconsetId}toString(){return ts.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ta,xd={},Ey=(function(){if(ta)return xd;ta=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(g){return(g=Math.round(g))<0?0:g>255?255:g}function r(g){return t(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function c(g){return(_=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:_>1?1:_;var _}function d(g,_,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?g+(_-g)*v*6:2*v<1?_:3*v<2?g+(_-g)*(2/3-v)*6:g}try{xd.parseCSSColor=function(g){var _,v=g.replace(/ /g,"").toLowerCase();if(v in a)return a[v].slice();if(v[0]==="#")return v.length===4?(_=parseInt(v.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:v.length===7&&(_=parseInt(v.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var S=v.indexOf("("),T=v.indexOf(")");if(S!==-1&&T+1===v.length){var M=v.substr(0,S),A=v.substr(S+1,T-(S+1)).split(","),z=1;switch(M){case"rgba":if(A.length!==4)return null;z=c(A.pop());case"rgb":return A.length!==3?null:[r(A[0]),r(A[1]),r(A[2]),z];case"hsla":if(A.length!==4)return null;z=c(A.pop());case"hsl":if(A.length!==3)return null;var D=(parseFloat(A[0])%360+360)%360/360,k=c(A[1]),$=c(A[2]),H=$<=.5?$*(k+1):$+k-$*k,j=2*$-H;return[t(255*d(j,H,D+1/3)),t(255*d(j,H,D)),t(255*d(j,H,D-1/3)),z];default:return null}}return null}}catch{}return xd})();class bn{constructor(t,r,c,d=1){this.r=t,this.g=r,this.b=c,this.a=d}static parse(t){if(!t)return;if(t instanceof bn)return t;if(typeof t!="string")return;const r=Ey.parseCSSColor(t);return r?new bn(r[0]/255,r[1]/255,r[2]/255,r[3]):void 0}toString(){const[t,r,c,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*c)},${d})`}toNonPremultipliedRenderColor(t){const{r,g:c,b:d,a:g}=this;return new Iy(t,r,c,d,g)}toPremultipliedRenderColor(t){const{r,g:c,b:d,a:g}=this;return new My(t,r*g,c*g,d*g,g)}clone(){return new bn(this.r,this.g,this.b,this.a)}}class $p{constructor(t,r,c,d,g,_=!1){if(this.premultiplied=!1,this.premultiplied=_,t){const v=t.image.height,S=v*v;this.premultiplied?(r=g===0?0:r/g*(v-1),c=g===0?0:c/g*(v-1),d=g===0?0:d/g*(v-1)):(r*=v-1,c*=v-1,d*=v-1),r=Math.max(0,Math.min(v-1,r)),c=Math.max(0,Math.min(v-1,c)),d=Math.max(0,Math.min(v-1,d));const T=Math.floor(r),M=Math.floor(c),A=Math.floor(d),z=Math.ceil(r),D=Math.ceil(c),k=Math.ceil(d),$=r-T,H=c-M,j=d-A,X=t.image.data,Y=4*(T+M*S+A*v),te=4*(T+M*S+k*v),ue=4*(T+D*S+A*v),le=4*(T+D*S+k*v),ge=4*(z+M*S+A*v),ye=4*(z+M*S+k*v),me=4*(z+D*S+A*v),we=4*(z+D*S+k*v);this.r=di(di(di(X[Y],X[te],j),di(X[ue],X[le],j),H),di(di(X[ge],X[ye],j),di(X[me],X[we],j),H),$)/255*(this.premultiplied?g:1),this.g=di(di(di(X[Y+1],X[te+1],j),di(X[ue+1],X[le+1],j),H),di(di(X[ge+1],X[ye+1],j),di(X[me+1],X[we+1],j),H),$)/255*(this.premultiplied?g:1),this.b=di(di(di(X[Y+2],X[te+2],j),di(X[ue+2],X[le+2],j),H),di(di(X[ge+2],X[ye+2],j),di(X[me+2],X[we+2],j),H),$)/255*(this.premultiplied?g:1),this.a=g}else this.r=r,this.g=c,this.b=d,this.a=g}toArray(){const{r:t,g:r,b:c,a:d}=this;return[255*t,255*r,255*c,d]}toHslaArray(){let{r:t,g:r,b:c,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const k=1/d;t*=k,r*=k,c*=k}const g=Math.min(Math.max(t,0),1),_=Math.min(Math.max(r,0),1),v=Math.min(Math.max(c,0),1),S=Math.min(g,_,v),T=Math.max(g,_,v),M=T-S,A=.5*(S+T);if(M===0)return[0,0,100*A,d];const z=A>.5?M/(2-T-S):M/(T+S);let D;switch(T){case g:D=60*((_-v)/M+(_<v?6:0));break;case _:D=60*((v-g)/M+2);break;default:D=60*((g-_)/M+4)}return[D,100*z,100*A,d]}toArray01(){const{r:t,g:r,b:c,a:d}=this;return[t,r,c,d]}toArray01Scaled(t){const{r,g:c,b:d}=this;return[r*t,c*t,d*t]}toArray01Linear(){const{r:t,g:r,b:c,a:d}=this;return[Math.pow(t,2.2),Math.pow(r,2.2),Math.pow(c,2.2),d]}}class Iy extends $p{constructor(t,r,c,d,g){super(t,r,c,d,g,!1)}}class My extends $p{constructor(t,r,c,d,g){super(t,r,c,d,g,!0)}}function di(a,t,r){return a*(1-r)+t*r}function Vp(a,t,r){return a.map((c,d)=>di(c,t[d],r))}bn.black=new bn(0,0,0,1),bn.white=new bn(1,1,1,1),bn.transparent=new bn(0,0,0,0),bn.red=new bn(1,0,0,1),bn.blue=new bn(0,0,1,1);var dc=Object.freeze({__proto__:null,array:Vp,color:function(a,t,r){return new bn(di(a.r,t.r,r),di(a.g,t.g,r),di(a.b,t.b,r),di(a.a,t.a,r))},number:di});class Bo extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class bd{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[c,d]of r)this.bindings[c]=d}concat(t){return new bd(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const is={kind:"null"},ni={kind:"number"},xn={kind:"string"},fn={kind:"boolean"},No={kind:"color"},Wc={kind:"object"},Tn={kind:"value"},wd={kind:"collator"},qc={kind:"formatted"},fc={kind:"resolvedImage"};function Co(a,t){return{kind:"array",itemType:a,N:t}}function Ar(a){if(a.kind==="array"){const t=Ar(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const fw=[is,ni,xn,fn,No,qc,Wc,Co(Tn),fc];function sh(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!sh(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const r of fw)if(!sh(r,t))return null}}return`Expected ${Ar(a)} but found ${Ar(t)} instead.`}function jp(a,t){return t.some(r=>r.kind===a.kind)}function ah(a,t){return t.some(r=>r==="null"?a===null:r==="array"?Array.isArray(a):r==="object"?a&&!Array.isArray(a)&&typeof a=="object":r===typeof a)}function Sd(a,t){return a.kind==="array"&&t.kind==="array"?a.N===t.N&&Sd(a.itemType,t.itemType):a.kind===t.kind}class Gp{constructor(t,r,c){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Td{constructor(t,r,c,d,g){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=c,this.fontStack=d,this.textColor=g}}class Lo{constructor(t){this.sections=t}static fromString(t){return new Lo([new Td(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||!!t.image&&t.image.hasPrimary())}static factory(t){return t instanceof Lo?t:Lo.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const r of this.sections){if(r.image){const d=r.image.getPrimary().id.toString();t.push(["image",d]);continue}t.push(r.text);const c={};r.fontStack&&(c["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(c["font-scale"]=r.scale),r.textColor&&(c["text-color"]=["rgba"].concat(r.textColor.toNonPremultipliedRenderColor(null).toArray())),t.push(c)}return t}}class ns{constructor(t,r={}){this.id=ts.from(t),this.params=r.params,this.sx=r.sx||1,this.sy=r.sy||1}toString(){return JSON.stringify(this)}static parse(t){let r,c,d,g;try{({id:r,params:c,sx:d,sy:g}=JSON.parse(t)||{})}catch{return null}return r?new ns(r,{params:c,sx:d,sy:g}):null}scaleSelf(t,r=t){return this.sx*=t,this.sy*=r,this}}class rs{constructor(t,r,c,d,g=!1){this.primaryId=ts.from(t),this.primaryOptions=r,c&&(this.secondaryId=ts.from(c)),this.secondaryOptions=d,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ns(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ns(this.secondaryId,this.secondaryOptions):null}static from(t){return typeof t=="string"?rs.build({name:t}):t}static build(t,r,c,d){return!t||typeof t=="object"&&!("name"in t)?null:new rs(t,c,r,d)}}function Hp(a,t,r,c){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[a,t,r,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[a,t,r,c]:[a,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Cl(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof bn||a instanceof Gp||a instanceof Lo||a instanceof rs)return!0;if(Array.isArray(a)){for(const t of a)if(!Cl(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!Cl(a[t]))return!1;return!0}return!1}function Yr(a){if(a===null)return is;if(typeof a=="string")return xn;if(typeof a=="boolean")return fn;if(typeof a=="number")return ni;if(a instanceof bn)return No;if(a instanceof Gp)return wd;if(a instanceof Lo)return qc;if(a instanceof rs)return fc;if(Array.isArray(a)){const t=a.length;let r;for(const c of a){const d=Yr(c);if(r){if(r===d)continue;r=Tn;break}r=d}return Co(r||Tn,t)}return Wc}function Pa(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Lo||a instanceof rs||a instanceof bn?a.toString():JSON.stringify(a)}class ll{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Cl(t[1]))return r.error("invalid value");const c=t[1];let d=Yr(c);const g=r.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new ll(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof bn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Lo?this.value.serialize():this.value}}class Gr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ll={string:xn,number:ni,boolean:fn,object:Wc};class Mi{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c,d=1;const g=t[0];if(g==="array"){let v,S;if(t.length>2){const T=t[1];if(typeof T!="string"||!(T in Ll)||T==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=Ll[T],d++}else v=Tn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=t[2],d++}c=Co(v,S)}else c=Ll[g];const _=[];for(;d<t.length;d++){const v=r.parse(t[d],d,Tn);if(!v)return null;_.push(v)}return new Mi(c,_)}evaluate(t){for(let r=0;r<this.args.length;r++){const c=this.args[r].evaluate(t);if(!sh(this.type,Yr(c)))return c;if(r===this.args.length-1)throw new Gr(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${Ar(Yr(c))} but was expected to be of type ${Ar(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,r=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){r.push(c.kind);const d=t.N;(typeof d=="number"||this.args.length>1)&&r.push(d)}}return r.concat(this.args.map(c=>c.serialize()))}}class Qt{constructor(t){this.type=qc,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return r.error("First argument must be an image or text section.");const d=[];let g=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let S=null;if(v["font-scale"]&&(S=r.parseObjectValue(v["font-scale"],_,"font-scale",ni),!S))return null;let T=null;if(v["text-font"]&&(T=r.parseObjectValue(v["text-font"],_,"text-font",Co(xn)),!T))return null;let M=null;if(v["text-color"]&&(M=r.parseObjectValue(v["text-color"],_,"text-color",No),!M))return null;const A=d[d.length-1];A.scale=S,A.font=T,A.textColor=M}else{const S=r.parse(t[_],_,Tn);if(!S)return null;const T=S.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:S,scale:null,font:null,textColor:null})}}return new Qt(d)}evaluate(t){return new Lo(this.sections.map(r=>{const c=r.content.evaluate(t);return Sd(Yr(c),fc)?new Td("",c,null,null,null):new Td(Pa(c),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const r of this.sections){t.push(r.content.serialize());const c={};r.scale&&(c["font-scale"]=r.scale.serialize()),r.font&&(c["text-font"]=r.font.serialize()),r.textColor&&(c["text-color"]=r.textColor.serialize()),t.push(c)}return t}}class Xc{constructor(t,r,c,d){this._imageWarnHistory={},this.type=fc,this.namePrimary=t,this.nameSecondary=r,c&&(this.paramsPrimary=c.params,this.iconsetIdPrimary=c.iconset?c.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(t,r){if(t.length<2)return r.error("Expected two or more arguments.");let c=1;const d=[];function g(){if(c<t.length){const v=r.parse(t[c],c++,xn);return v?(d.push({image:v,options:{}}),!0):(r.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(c<t.length){const S=t[c];if((v=S)===null||typeof v!="object"||Array.isArray(v))return!0;const T=S.params,M=S.iconset,A=r.concat(c);if(!T&&!M)return c++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return A.error('Image options "params" should be an object'),!1;const z={},D=A.concat(void 0,"params");for(const k in T){if(!k)return D.error("Image parameter name should be non-empty"),!1;const $=D.concat(void 0,k).parse(T[k],void 0,No,void 0,{typeAnnotation:"coerce"});if(!$)return!1;z[k]=$}d[d.length-1].options.params=z}if(M){if(typeof M!="object"||M.constructor!==Object)return A.error('Image options "iconset" should be an object'),!1;if(!M.id)return A.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=M}return c++,!0}var v;return!0}for(let v=0;v<2;v++)if(!g()||!_())return;return new Xc(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(t,r){const c={};if(r){for(const d in r)if(r[d])try{c[d]=r[d].evaluate(t)}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(t){const r={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},c=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,d=rs.build(r,c,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(d&&t.availableImages){const g=d.getPrimary().id;if(d.available=t.availableImages.some(_=>ts.isEqual(_,g)),d.available){const _=d.getSecondary()?d.getSecondary().id:null;_&&(d.available=t.availableImages.some(v=>ts.isEqual(v,_)))}}return d}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&t(this.paramsPrimary[r]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&t(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(t,r){const c={};if(r&&(c.iconset={id:r}),t){c.params={};for(const d in t)t[d]&&(c.params[d]=t[d].serialize())}return Object.keys(c).length>0?c:void 0}serialize(){const t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&t.push(r)}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&t.push(r)}return t}}function xi(a){return lh(a)?"string":fi(a)?"number":Zp(a)?"boolean":Array.isArray(a)?"array":a===null?"null":Ed(a)?"object":typeof a}function Ed(a){return a!=null&&!Array.isArray(a)&&typeof a!="function"&&!(a instanceof String||a instanceof Number||a instanceof Boolean)&&typeof a=="object"}function lh(a){return typeof a=="string"||a instanceof String}function fi(a){return typeof a=="number"||a instanceof Number}function Zp(a){return typeof a=="boolean"||a instanceof Boolean}const Wp={"to-boolean":fn,"to-color":No,"to-number":ni,"to-string":xn};class za{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[0],d=[];let g=is;if(c==="to-array"){if(!Array.isArray(t[1]))return null;const _=t[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);g=Co(r.expectedType.itemType,_)}else{if(!(_>0&&Cl(t[1][0])))return null;g=Co(Yr(t[1][0]),_)}for(let v=0;v<_;v++){const S=t[1][v];let T;if(Array.isArray(S))T=r.parse(S,void 0,g.itemType);else{const M=xi(S);if(M!==g.itemType.kind)return r.error(`Expected ${g.itemType.kind} but found ${M}.`);T=r.registry.literal.parse(["literal",S===void 0?null:S],r)}if(!T)return null;d.push(T)}}else{if((c==="to-boolean"||c==="to-string")&&t.length!==2)return r.error("Expected one argument.");g=Wp[c];for(let _=1;_<t.length;_++){const v=r.parse(t[_],_,Tn);if(!v)return null;d.push(v)}}return new za(g,d)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let r,c;for(const d of this.args){if(r=d.evaluate(t),c=null,r instanceof bn)return r;if(typeof r=="string"){const g=t.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(c=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Hp(r[0],r[1],r[2],r[3]),!c))return new bn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Gr(c||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const c of this.args){if(r=c.evaluate(t),r===null)return 0;const d=Number(r);if(!isNaN(d))return d}throw new Gr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Lo.fromString(Pa(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?rs.build(Pa(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(r=>r.evaluate(t)):Pa(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Qt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xc(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}const Ay=["Unknown","Point","LineString","Polygon"];class Jc{constructor(t,r,c){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=r,this.iconImageUseTheme=c}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ay[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:c,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*r-t[0])+this.featureDistanceData.bearing[1]*(d*r-t[1])}return 0}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=bn.parse(t)),r}getConfig(t){return this.options?this.options.get(t):null}}class os{constructor(t,r,c,d,g){this.name=t,this.type=r,this._evaluate=c,this.args=d,this._overloadIndex=g}evaluate(t){if(!this._evaluate){const r=os.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){const c=t[0],d=os.definitions[c];if(!d)return r.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,v=[];let S=null,T=-1;for(const[M,A]of _){if(Array.isArray(M)&&M.length!==t.length-1)continue;v.push(M),T++,S=new kd(r.registry,r.path,null,r.scope,void 0,r._scope,r.options,r.iconImageUseTheme);const z=[];let D=!1;for(let k=1;k<t.length;k++){const $=t[k],H=Array.isArray(M)?M[k-1]:M.type,j=S.parse($,1+z.length,H);if(!j){D=!0;break}z.push(j)}if(!D)if(Array.isArray(M)&&M.length!==z.length)S.error(`Expected ${M.length} arguments, but found ${z.length} instead.`);else{for(let k=0;k<z.length;k++){const $=Array.isArray(M)?M[k]:M.type,H=z[k];S.concat(k+1).checkSubtype($,H.type)}if(S.errors.length===0)return new os(c,g,A,z,T)}}if(v.length===1)r.errors.push(...S.errors);else{const M=(v.length?v:_.map(([z])=>z)).map(qp).join(" | "),A=[];for(let z=1;z<t.length;z++){const D=r.parse(t[z],1+A.length);if(!D)return null;A.push(Ar(D.type))}r.error(`Expected arguments of type ${M}, but found (${A.join(", ")}) instead.`)}return null}static register(t,r){os.definitions=r;for(const c in r)t[c]=os}}function qp(a){return Array.isArray(a)?`(${a.map(Ar).join(", ")})`:`(${Ar(a.type)}...)`}class Ca{constructor(t,r,c){this.type=wd,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return r.error("Collator options argument must be an object.");const d=c["case-sensitive"]===void 0?r.parse(!1,1,fn):r.parseObjectValue(c["case-sensitive"],1,"case-sensitive",fn);if(!d)return null;const g=c["diacritic-sensitive"]===void 0?r.parse(!1,1,fn):r.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",fn);if(!g)return null;let _=null;return c.locale&&(_=r.parseObjectValue(c.locale,1,"locale",xn),!_)?null:new Ca(d,g,_)}evaluate(t){return new Gp(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Id(a,t,r=0,c=a.length-1,d=Rl){for(;c>r;){if(c-r>600){const S=c-r+1,T=t-r+1,M=Math.log(S),A=.5*Math.exp(2*M/3),z=.5*Math.sqrt(M*A*(S-A)/S)*(T-S/2<0?-1:1);Id(a,t,Math.max(r,Math.floor(t-T*A/S+z)),Math.min(c,Math.floor(t+(S-T)*A/S+z)),d)}const g=a[t];let _=r,v=c;for(ia(a,r,t),d(a[c],g)>0&&ia(a,r,c);_<v;){for(ia(a,_,v),_++,v--;d(a[_],g)<0;)_++;for(;d(a[v],g)>0;)v--}d(a[r],g)===0?ia(a,r,v):(v++,ia(a,v,c)),v<=t&&(r=v+1),t<=v&&(c=v-1)}}function ia(a,t,r){const c=a[t];a[t]=a[r],a[r]=c}function Rl(a,t){return a<t?-1:a>t?1:0}function pw(a){let t=0;for(let r,c,d=0,g=a.length,_=g-1;d<g;_=d++)r=a[d],c=a[_],t+=(c.x-r.x)*(r.y+c.y);return t}function ch(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function uh(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Md(a,t,r){const c=a[0]-t[0],d=a[1]-t[1],g=a[0]-r[0],_=a[1]-r[1];return c*_-g*d===0&&c*g<=0&&d*_<=0}function Py(a,t,r){return t[1]>a[1]!=r[1]>a[1]&&a[0]<(r[0]-t[0])*(a[1]-t[1])/(r[1]-t[1])+t[0]}function na(a,t,r=!1){let c=!1;for(let d=0,g=t.length;d<g;d++){const _=t[d];for(let v=0,S=_.length,T=S-1;v<S;T=v++){const M=_[T],A=_[v];if(Md(a,M,A))return r;Py(a,M,A)&&(c=!c)}}return c}function zy(a,t,r,c){const d=c[0]-r[0],g=c[1]-r[1],_=(a[0]-r[0])*g-d*(a[1]-r[1]),v=(t[0]-r[0])*g-d*(t[1]-r[1]);return _>0&&v<0||_<0&&v>0}function Ad(a,t,r,c){return(d=[c[0]-r[0],c[1]-r[1]])[0]*(g=[t[0]-a[0],t[1]-a[1]])[1]-d[1]*g[0]!==0&&!(!zy(a,t,r,c)||!zy(r,c,a,t));var d,g}function hh(a){const t=new Ae(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new Ae(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of a[0])t.x>c.x&&(t.x=c.x),t.y>c.y&&(t.y=c.y),r.x<c.x&&(r.x=c.x),r.y<c.y&&(r.y=c.y);return{min:t,max:r}}const Dl=8192;function mw(a,t){const r=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(r*d*Dl),Math.round(c*d*Dl)]}function Cy(a,t){for(let r=0;r<t.length;r++)if(na(a,t[r]))return!0;return!1}function gw(a,t,r){for(const c of r)for(let d=0,g=c.length,_=g-1;d<g;_=d++)if(Ad(a,t,c[_],c[d]))return!0;return!1}function Xp(a,t){for(let r=0;r<a.length;++r)if(!na(a[r],t))return!1;for(let r=0;r<a.length-1;++r)if(gw(a[r],a[r+1],t))return!1;return!0}function _w(a,t){for(let r=0;r<t.length;r++)if(Xp(a,t[r]))return!0;return!1}function cl(a,t,r){const c=[];for(let d=0;d<a.length;d++){const g=[];for(let _=0;_<a[d].length;_++){const v=mw(a[d][_],r);ch(t,v),g.push(v)}c.push(g)}return c}function Ly(a,t,r){const c=[];for(let d=0;d<a.length;d++){const g=cl(a[d],t,r);c.push(g)}return c}function Ry(a,t,r,c){if(a[0]<r[0]||a[0]>r[2]){const d=.5*c;let g=a[0]-r[0]>d?-c:r[0]-a[0]>d?c:0;g===0&&(g=a[0]-r[2]>d?-c:r[2]-a[0]>d?c:0),a[0]+=g}ch(t,a)}function Pd(a,t,r,c){const d=Math.pow(2,c.z)*Dl,g=[c.x*Dl,c.y*Dl],_=[];if(!a)return _;for(const v of a)for(const S of v){const T=[S.x+g[0],S.y+g[1]];Ry(T,t,r,d),_.push(T)}return _}function Jp(a,t,r,c){const d=Math.pow(2,c.z)*Dl,g=[c.x*Dl,c.y*Dl],_=[];if(!a)return _;for(const S of a){const T=[];for(const M of S){const A=[M.x+g[0],M.y+g[1]];ch(t,A),T.push(A)}_.push(T)}if(t[2]-t[0]<=d/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of _)for(const T of S)Ry(T,t,r,d)}var v;return _}class kl{constructor(t,r){this.type=fn,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Cl(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let d=0;d<c.features.length;++d){const g=c.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new kl(c,c.features[d].geometry)}else if(c.type==="Feature"){const d=c.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new kl(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new kl(c,c)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,c){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const v=cl(c.coordinates,g,_),S=Pd(r.geometry(),d,g,_);if(!uh(d,g))return!1;for(const T of S)if(!na(T,v))return!1}if(c.type==="MultiPolygon"){const v=Ly(c.coordinates,g,_),S=Pd(r.geometry(),d,g,_);if(!uh(d,g))return!1;for(const T of S)if(!Cy(T,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,c){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const v=cl(c.coordinates,g,_),S=Jp(r.geometry(),d,g,_);if(!uh(d,g))return!1;for(const T of S)if(!Xp(T,v))return!1}if(c.type==="MultiPolygon"){const v=Ly(c.coordinates,g,_),S=Jp(r.geometry(),d,g,_);if(!uh(d,g))return!1;for(const T of S)if(!_w(T,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const xs={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Yp=1/298.257223563,Kp=Yp*(2-Yp),Yc=Math.PI/180;class Kc{static fromTile(t,r,c){const d=Math.PI*(1-2*(t+.5)/Math.pow(2,r)),g=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Yc;return new Kc(g,c)}static get units(){return xs}constructor(t,r){if(t===void 0)throw new Error("No latitude given.");if(r&&!xs[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(xs).join(", ")}`);const c=6378.137*Yc*(r?xs[r]:1),d=Math.cos(t*Yc),g=1/(1-Kp*(1-d*d)),_=Math.sqrt(g);this.kx=c*_*d,this.ky=c*_*g*(1-Kp)}distance(t,r){const c=Ds(t[0]-r[0])*this.kx,d=(t[1]-r[1])*this.ky;return Math.sqrt(c*c+d*d)}bearing(t,r){const c=Ds(r[0]-t[0])*this.kx;return Math.atan2(c,(r[1]-t[1])*this.ky)/Yc}destination(t,r,c){const d=c*Yc;return this.offset(t,Math.sin(d)*r,Math.cos(d)*r)}offset(t,r,c){return[t[0]+r/this.kx,t[1]+c/this.ky]}lineDistance(t){let r=0;for(let c=0;c<t.length-1;c++)r+=this.distance(t[c],t[c+1]);return r}area(t){let r=0;for(let c=0;c<t.length;c++){const d=t[c];for(let g=0,_=d.length,v=_-1;g<_;v=g++)r+=Ds(d[g][0]-d[v][0])*(d[g][1]+d[v][1])*(c?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(t,r){let c=0;if(r<=0)return t[0];for(let d=0;d<t.length-1;d++){const g=t[d],_=t[d+1],v=this.distance(g,_);if(c+=v,c>r)return zd(g,_,(r-(c-v))/v)}return t[t.length-1]}pointToSegmentDistance(t,r,c){let[d,g]=r,_=Ds(c[0]-d)*this.kx,v=(c[1]-g)*this.ky;if(_!==0||v!==0){const S=(Ds(t[0]-d)*this.kx*_+(t[1]-g)*this.ky*v)/(_*_+v*v);S>1?(d=c[0],g=c[1]):S>0&&(d+=_/this.kx*S,g+=v/this.ky*S)}return _=Ds(t[0]-d)*this.kx,v=(t[1]-g)*this.ky,Math.sqrt(_*_+v*v)}pointOnLine(t,r){let c=1/0,d=t[0][0],g=t[0][1],_=0,v=0;for(let S=0;S<t.length-1;S++){let T=t[S][0],M=t[S][1],A=Ds(t[S+1][0]-T)*this.kx,z=(t[S+1][1]-M)*this.ky,D=0;A===0&&z===0||(D=(Ds(r[0]-T)*this.kx*A+(r[1]-M)*this.ky*z)/(A*A+z*z),D>1?(T=t[S+1][0],M=t[S+1][1]):D>0&&(T+=A/this.kx*D,M+=z/this.ky*D)),A=Ds(r[0]-T)*this.kx,z=(r[1]-M)*this.ky;const k=A*A+z*z;k<c&&(c=k,d=T,g=M,_=S,v=D)}return{point:[d,g],index:_,t:Math.max(0,Math.min(1,v))}}lineSlice(t,r,c){let d=this.pointOnLine(c,t),g=this.pointOnLine(c,r);if(d.index>g.index||d.index===g.index&&d.t>g.t){const T=d;d=g,g=T}const _=[d.point],v=d.index+1,S=g.index;!Qp(c[v],_[0])&&v<=S&&_.push(c[v]);for(let T=v+1;T<=S;T++)_.push(c[T]);return Qp(c[S],g.point)||_.push(g.point),_}lineSliceAlong(t,r,c){let d=0;const g=[];for(let _=0;_<c.length-1;_++){const v=c[_],S=c[_+1],T=this.distance(v,S);if(d+=T,d>t&&g.length===0&&g.push(zd(v,S,(t-(d-T))/T)),d>=r)return g.push(zd(v,S,(r-(d-T))/T)),g;d>t&&g.push(S)}return g}bufferPoint(t,r){const c=r/this.ky,d=r/this.kx;return[t[0]-d,t[1]-c,t[0]+d,t[1]+c]}bufferBBox(t,r){const c=r/this.ky,d=r/this.kx;return[t[0]-d,t[1]-c,t[2]+d,t[3]+c]}insideBBox(t,r){return Ds(t[0]-r[0])>=0&&Ds(t[0]-r[2])<=0&&t[1]>=r[1]&&t[1]<=r[3]}}function Qp(a,t){return a[0]===t[0]&&a[1]===t[1]}function zd(a,t,r){const c=Ds(t[0]-a[0]);return[a[0]+c*r,a[1]+(t[1]-a[1])*r]}function Ds(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class dh{constructor(t=[],r=(c,d)=>c<d?-1:c>d?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:c}=this,d=r[t];for(;t>0;){const g=t-1>>1,_=r[g];if(c(d,_)>=0)break;r[t]=_,t=g}r[t]=d}_down(t){const{data:r,compare:c}=this,d=this.length>>1,g=r[t];for(;t<d;){let _=1+(t<<1);const v=_+1;if(v<this.length&&c(r[v],r[_])<0&&(_=v),c(r[_],g)>=0)break;r[t]=r[_],t=_}r[t]=g}}var It=8192;function em(a,t){return t.dist-a.dist}function tm(a){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==a.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==a[r])return!1;return!0}function fh(a){return a[1]-a[0]+1}function La(a,t){const r=a[1]>=a[0]&&a[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function im(a,t){if(a[0]>a[1])return[null,null];const r=fh(a);if(t){if(r===2)return[a,null];const c=Math.floor(r/2);return[[a[0],a[0]+c],[a[0]+c,a[1]]]}{if(r===1)return[a,null];const c=Math.floor(r/2)-1;return[[a[0],a[0]+c],[a[0]+c+1,a[1]]]}}function pc(a,t){const r=[1/0,1/0,-1/0,-1/0];if(!La(t,a.length))return r;for(let c=t[0];c<=t[1];++c)ch(r,a[c]);return r}function mc(a){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<a.length;++r)for(let c=0;c<a[r].length;++c)ch(t,a[r][c]);return t}function Ol(a,t,r){if(tm(a)||tm(t))return NaN;let c=0,d=0;return a[2]<t[0]&&(c=t[0]-a[2]),a[0]>t[2]&&(c=a[0]-t[2]),a[1]>t[3]&&(d=a[1]-t[3]),a[3]<t[1]&&(d=t[1]-a[3]),r.distance([0,0],[c,d])}function Cd(a){return 360*a-180}function Dy(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ld(a,t){const r=Math.pow(2,t.z),c=(a.y/It+t.y)/r;return[Cd((a.x/It+t.x)/r),Dy(c)]}function yw(a,t){const r=[];for(let c=0;c<a.length;++c)r.push(Ld(a[c],t));return r}function ky(a,t,r){const c=r.pointOnLine(t,a).point;return r.distance(a,c)}function nm(a,t,r,c,d){const g=r.slice(c[0],c[1]+1);let _=1/0;for(let v=t[0];v<=t[1];++v)if((_=Math.min(_,ky(a[v],g,d)))===0)return 0;return _}function Fl(a,t,r,c,d){const g=Math.min(d.pointToSegmentDistance(a,r,c),d.pointToSegmentDistance(t,r,c)),_=Math.min(d.pointToSegmentDistance(r,a,t),d.pointToSegmentDistance(c,a,t));return Math.min(g,_)}function on(a,t,r,c,d){if(!La(t,a.length)||!La(c,r.length))return NaN;let g=1/0;for(let _=t[0];_<t[1];++_)for(let v=c[0];v<c[1];++v){if(Ad(a[_],a[_+1],r[v],r[v+1]))return 0;g=Math.min(g,Fl(a[_],a[_+1],r[v],r[v+1],d))}return g}function vw(a,t,r,c,d){if(!La(t,a.length)||!La(c,r.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let v=c[0];v<=c[1];++v)if((g=Math.min(g,d.distance(a[_],r[v])))===0)return g;return g}function xw(a,t,r){if(na(a,t,!0))return 0;let c=1/0;for(const d of t){const g=d.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[g-1]&&(c=Math.min(c,r.pointToSegmentDistance(a,d[g-1],d[0])))===0||(c=Math.min(c,ky(a,d,r)))===0)return c}return c}function bw(a,t,r,c){if(!La(t,a.length))return NaN;for(let g=t[0];g<=t[1];++g)if(na(a[g],r,!0))return 0;let d=1/0;for(let g=t[0];g<t[1];++g)for(const _ of r)for(let v=0,S=_.length,T=S-1;v<S;T=v++){if(Ad(a[g],a[g+1],_[T],_[v]))return 0;d=Math.min(d,Fl(a[g],a[g+1],_[T],_[v],c))}return d}function rm(a,t){for(const r of a)for(let c=0;c<=r.length-1;++c)if(na(r[c],t,!0))return!0;return!1}function ww(a,t,r,c=1/0){const d=mc(a),g=mc(t);if(c!==1/0&&Ol(d,g,r)>=c)return c;if(uh(d,g)){if(rm(a,t))return 0}else if(rm(t,a))return 0;let _=c;for(const v of a)for(let S=0,T=v.length,M=T-1;S<T;M=S++)for(const A of t)for(let z=0,D=A.length,k=D-1;z<D;k=z++){if(Ad(v[M],v[S],A[k],A[z]))return 0;_=Math.min(_,Fl(v[M],v[S],A[k],A[z],r))}return _}function Xn(a,t,r,c,d,g,_){if(g===null||_===null)return;const v=Ol(pc(c,g),pc(d,_),r);v<t&&a.push({dist:v,range1:g,range2:_})}function Sw(a,t,r,c,d=1/0){let g=Math.min(c.distance(a[0],r[0][0]),d);if(g===0)return g;const _=new dh([{dist:0,range1:[0,a.length-1],range2:[0,0]}],em),v=t?50:100,S=mc(r);for(;_.length;){const T=_.pop();if(T.dist>=g)continue;const M=T.range1;if(fh(M)<=v){if(!La(M,a.length))return NaN;if(t){const A=bw(a,M,r,c);if((g=Math.min(g,A))===0)return g}else for(let A=M[0];A<=M[1];++A){const z=xw(a[A],r,c);if((g=Math.min(g,z))===0)return g}}else{const A=im(M,t);if(A[0]!==null){const z=Ol(pc(a,A[0]),S,c);z<g&&_.push({dist:z,range1:A[0],range2:[0,0]})}if(A[1]!==null){const z=Ol(pc(a,A[1]),S,c);z<g&&_.push({dist:z,range1:A[1],range2:[0,0]})}}}return g}function Oy(a,t,r,c,d,g=1/0){let _=Math.min(g,d.distance(a[0],r[0]));if(_===0)return _;const v=new dh([{dist:0,range1:[0,a.length-1],range2:[0,r.length-1]}],em),S=t?50:100,T=c?50:100;for(;v.length;){const M=v.pop();if(M.dist>=_)continue;const A=M.range1,z=M.range2;if(fh(A)<=S&&fh(z)<=T){if(!La(A,a.length)||!La(z,r.length))return NaN;if(t&&c?_=Math.min(_,on(a,A,r,z,d)):t||c?t&&!c?_=Math.min(_,nm(r,z,a,A,d)):!t&&c&&(_=Math.min(_,nm(a,A,r,z,d))):_=Math.min(_,vw(a,A,r,z,d)),_===0)return _}else{const D=im(A,t),k=im(z,c);Xn(v,_,d,a,r,D[0],k[0]),Xn(v,_,d,a,r,D[0],k[1]),Xn(v,_,d,a,r,D[1],k[0]),Xn(v,_,d,a,r,D[1],k[1])}}return _}function om(a,t,r,c,d=1/0){let g=d;const _=pc(a,[0,a.length-1]);for(const v of r)if(!(g!==1/0&&Ol(_,pc(v,[0,v.length-1]),c)>=g)&&(g=Math.min(g,Oy(a,t,v,!0,c,g)),g===0))return g;return g}function Rd(a,t,r,c,d=1/0){let g=d;const _=pc(a,[0,a.length-1]);for(const v of r){if(g!==1/0&&Ol(_,mc(v),c)>=g)continue;const S=Sw(a,t,v,c,g);if(isNaN(S))return S;if((g=Math.min(g,S))===0)return g}return g}function sm(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class gc{constructor(t,r){this.type=ni,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Cl(t[1])){const c=t[1];if(c.type==="FeatureCollection"){for(let d=0;d<c.features.length;++d)if(sm(c.features[d].geometry.type))return new gc(c,c.features[d].geometry)}else if(c.type==="Feature"){if(sm(c.geometry.type))return new gc(c,c.geometry)}else if(sm(c.type))return new gc(c,c)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const r=t.geometry(),c=t.canonicalID();if(r!=null&&c!=null){if(t.geometryType()==="Point")return(function(d,g,_){const v=[];for(const T of d)for(const M of T)v.push(Ld(M,g));const S=new Kc(v[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?Oy(v,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S):_.type==="MultiLineString"?om(v,!1,_.coordinates,S):_.type==="Polygon"||_.type==="MultiPolygon"?Rd(v,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,S):null})(r,c,this.geometries);if(t.geometryType()==="LineString")return(function(d,g,_){const v=[];for(const T of d){const M=[];for(const A of T)M.push(Ld(A,g));v.push(M)}const S=new Kc(v[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return om(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,S);if(_.type==="MultiLineString"){let T=1/0;for(let M=0;M<_.coordinates.length;M++){const A=om(_.coordinates[M],!0,v,S,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}if(_.type==="Polygon"||_.type==="MultiPolygon"){let T=1/0;for(let M=0;M<v.length;M++){const A=Rd(v[M],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,S,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}return null})(r,c,this.geometries);if(t.geometryType()==="Polygon")return(function(d,g,_){const v=[];for(const T of(function(M){const A=M.length;if(A<=1)return[M];const z=[];let D,k;for(let $=0;$<A;$++){const H=pw(M[$]);H!==0&&(M[$].area=Math.abs(H),k===void 0&&(k=H<0),k===H<0?(D&&z.push(D),D=[M[$]]):D.push(M[$]))}return D&&z.push(D),z})(d)){const M=[];for(let A=0;A<T.length;++A)M.push(yw(T[A],g));v.push(M)}const S=new Kc(v[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Rd(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,S);if(_.type==="MultiLineString"){let T=1/0;for(let M=0;M<_.coordinates.length;M++){const A=Rd(_.coordinates[M],!0,v,S,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(T,M,A){let z=1/0;for(const D of T)for(const k of M){const $=ww(D,k,A,z);if(isNaN($))return $;if((z=Math.min(z,$))===0)return z}return z})(_.type==="Polygon"?[_.coordinates]:_.coordinates,v,S):null})(r,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Qc(a){if(a instanceof os&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof kl||a instanceof gc)return!1;if(a instanceof tu)return a.featureConstant;let t=!0;return a.eachChild(r=>{t&&!Qc(r)&&(t=!1)}),t}function ph(a){if(a instanceof os&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(r=>{t&&!ph(r)&&(t=!1)}),t}function eu(a,t){if(a instanceof os&&t.indexOf(a.name)>=0)return!1;let r=!0;return a.eachChild(c=>{r&&!eu(c,t)&&(r=!1)}),r}function Fy(a,t,r){return[a,t,r].filter(Boolean).join("")}function am(a,t){switch(a){case"string":return Pa(t);case"number":return+t;case"boolean":return!!t;case"color":return bn.parse(t);case"formatted":return Lo.fromString(Pa(t));case"resolvedImage":return rs.build(Pa(t))}return t}function By(a,t,r,c){return c!==void 0&&(a=c*Math.round(a/c)),t!==void 0&&a<t&&(a=t),r!==void 0&&a>r&&(a=r),a}class tu{constructor(t,r,c,d=!1){this.type=t,this.key=r,this.scope=c,this.featureConstant=d}static parse(t,r){let c=r.expectedType;if(c==null&&(c=Tn),t.length<2||t.length>3)return r.error("Invalid number of arguments for 'config' expression.");const d=r.parse(t[1],1);if(!(d instanceof ll))return r.error("Key name of 'config' expression must be a string literal.");let g,_=!0;const v=Pa(d.value);if(t.length>=3){const S=r.parse(t[2],2);if(!(S instanceof ll))return r.error("Scope of 'config' expression must be a string literal.");g=Pa(S.value)}if(r.options){const S=Fy(v,g,r._scope),T=r.options.get(S);T&&(_=Qc(T.value||T.default))}return new tu(c,v,g,_)}evaluate(t){const r=Fy(this.key,this.scope,t.scope),c=t.getConfig(r);if(!c)return null;const{type:d,value:g,values:_,minValue:v,maxValue:S,stepValue:T}=c,M=c.default.evaluate(t);let A=M;if(g){const z=t.scope;t.scope=(z||"").split("").slice(1).join(""),A=g.evaluate(t),t.scope=z}return d&&(A=am(d,A)),A===void 0||v===void 0&&S===void 0&&T===void 0||(typeof A=="number"?A=By(A,v,S,T):Array.isArray(A)&&(A=A.map(z=>typeof z=="number"?By(z,v,S,T):z))),g!==void 0&&A!==void 0&&_&&!_.includes(A)&&(A=M,d&&(A=am(d,A))),(d&&d!==this.type||A!==void 0&&!Sd(Yr(A),this.type))&&(A=am(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.scope),t}}class Dd{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const c=t[1];return r.scope.has(c)?new Dd(c,r.scope.get(c)):r.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class kd{constructor(t,r=[],c,d=new bd,g=[],_,v,S){this.registry=t,this.path=r,this.key=r.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=d,this.errors=g,this.expectedType=c,this._scope=_,this.options=v,this.iconImageUseTheme=S}parse(t,r,c,d,g={}){return r||c?this.concat(r,null,c,d)._parse(t,g):this._parse(t,g)}parseObjectValue(t,r,c,d,g,_={}){return this.concat(r,c,d,g)._parse(t,_)}_parse(t,r){function c(d,g,_){return _==="assert"?new Mi(g,[d]):_==="coerce"?new za(g,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(d){let g=d.parse(t,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,v=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(_,v))return null}else g=c(g,_,r.typeAnnotation||"coerce");else g=c(g,_,r.typeAnnotation||"assert")}if(!(g instanceof ll)&&g.type.kind!=="resolvedImage"&&lm(g)){const _=new Jc(this._scope,this.options,this.iconImageUseTheme);try{g=new ll(g.type,g.evaluate(_))}catch(v){return this.error(v.message),null}}return g}return za.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,c,d){let g=typeof t=="number"?this.path.concat(t):this.path;g=typeof r=="string"?g.concat(r):g;const _=d?this.scope.concat(d):this.scope;return new kd(this.registry,g,c||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(t,...r){const c=`${this.key}${r.map(d=>`[${d}]`).join("")}`;this.errors.push(new Bo(c,t))}checkSubtype(t,r){const c=sh(t,r);return c&&this.error(c),c}}function lm(a){if(a instanceof Dd)return lm(a.boundExpression);if(a instanceof os&&a.name==="error"||a instanceof Ca||a instanceof kl||a instanceof gc||a instanceof tu)return!1;const t=a instanceof za||a instanceof Mi;let r=!0;return a.eachChild(c=>{r=t?r&&lm(c):r&&c instanceof ll}),!!r&&Qc(a)&&eu(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Od(a,t){const r=a.length-1;let c,d,g=0,_=r,v=0;for(;g<=_;)if(v=Math.floor((g+_)/2),c=a[v],d=a[v+1],c<=t){if(v===r||t<d)return v;g=v+1}else{if(!(c>t))throw new Gr("Input is not a number.");_=v-1}return 0}class mh{constructor(t,r,c){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[d,g]of c)this.labels.push(d),this.outputs.push(g)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const c=r.parse(t[1],1,ni);if(!c)return null;const d=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],S=t[_+1],T=_,M=_+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(d.length&&d[d.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const A=r.parse(S,M,g);if(!A)return null;g=g||A.type,d.push([v,A])}return new mh(g,c,d)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const d=this.input.evaluate(t);if(d<=r[0])return c[0].evaluate(t);const g=r.length;return d>=r[g-1]?c[g-1].evaluate(t):c[Od(r,d)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}const Ny=.95047,Uy=1.08883,$y=4/29,iu=6/29,Vy=3*iu*iu,Tw=iu*iu*iu,Ew=Math.PI/180,Iw=180/Math.PI;function cm(a){return a>Tw?Math.pow(a,1/3):a/Vy+$y}function um(a){return a>iu?a*a*a:Vy*(a-$y)}function hm(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function dm(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function jy(a){const t=dm(a.r),r=dm(a.g),c=dm(a.b),d=cm((.4124564*t+.3575761*r+.1804375*c)/Ny),g=cm((.2126729*t+.7151522*r+.072175*c)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-cm((.0193339*t+.119192*r+.9503041*c)/Uy)),alpha:a.a}}function Fd(a){let t=(a.l+16)/116,r=isNaN(a.a)?t:t+a.a/500,c=isNaN(a.b)?t:t-a.b/200;return t=1*um(t),r=Ny*um(r),c=Uy*um(c),new bn(hm(3.2404542*r-1.5371385*t-.4985314*c),hm(-.969266*r+1.8760108*t+.041556*c),hm(.0556434*r-.2040259*t+1.0572252*c),a.alpha)}function Bd(a,t,r){const c=t-a;return a+r*(c>180||c<-180?c-360*Math.round(c/360):c)}const nu={forward:jy,reverse:Fd,interpolate:function(a,t,r){return{l:di(a.l,t.l,r),a:di(a.a,t.a,r),b:di(a.b,t.b,r),alpha:di(a.alpha,t.alpha,r)}}},gh={forward:function(a){const{l:t,a:r,b:c}=jy(a),d=Math.atan2(c,r)*Iw;return{h:d<0?d+360:d,c:Math.sqrt(r*r+c*c),l:t,alpha:a.a}},reverse:function(a){const t=a.h*Ew,r=a.c;return Fd({l:a.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:a.alpha})},interpolate:function(a,t,r){return{h:Bd(a.h,t.h,r),c:di(a.c,t.c,r),l:di(a.l,t.l,r),alpha:di(a.alpha,t.alpha,r)}}};var Gy=Object.freeze({__proto__:null,hcl:gh,lab:nu});class ks{constructor(t,r,c,d,g){this.type=t,this.operator=r,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[_,v]of g)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,r,c,d){let g=0;if(t.name==="exponential")g=Nd(r,t.base,c,d);else if(t.name==="linear")g=Nd(r,1,c,d);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new Lt(_[0],_[1],_[2],_[3]).solve(Nd(r,1,c,d))}return g}static parse(t,r){let[c,d,g,..._]=t;if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const T=d[1];if(typeof T!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:T}}else{if(d[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const T=d.slice(1);if(T.length!==4||T.some(M=>typeof M!="number"||M<0||M>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,ni),!g)return null;const v=[];let S=null;c==="interpolate-hcl"||c==="interpolate-lab"?S=No:r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType);for(let T=0;T<_.length;T+=2){const M=_[T],A=_[T+1],z=T+3,D=T+4;if(typeof M!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(v.length&&v[v.length-1][0]>=M)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const k=r.parse(A,D,S);if(!k)return null;S=S||k.type,v.push([M,k])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new ks(S,c,d,g,v):r.error(`Type ${Ar(S)} is not interpolatable.`)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const d=this.input.evaluate(t);if(d<=r[0])return c[0].evaluate(t);const g=r.length;if(d>=r[g-1])return c[g-1].evaluate(t);const _=Od(r,d),v=ks.interpolationFactor(this.interpolation,d,r[_],r[_+1]),S=c[_].evaluate(t),T=c[_+1].evaluate(t);return this.operator==="interpolate"?dc[this.type.kind.toLowerCase()](S,T,v):this.operator==="interpolate-hcl"?gh.reverse(gh.interpolate(gh.forward(S),gh.forward(T),v)):nu.reverse(nu.interpolate(nu.forward(S),nu.forward(T),v))}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)r.push(this.labels[c],this.outputs[c].serialize());return r}}function Nd(a,t,r,c){const d=c-r,g=a-r;return d===0?0:t===1?g/d:(Math.pow(t,g)-1)/(Math.pow(t,d)-1)}class _h{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let c=null;const d=r.expectedType;d&&d.kind!=="value"&&(c=d);const g=[];for(const v of t.slice(1)){const S=r.parse(v,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!S)return null;c=c||S.type,g.push(S)}const _=d&&g.some(v=>sh(d,v.type));return new _h(_?Tn:c,g)}evaluate(t){let r,c=null,d=0;for(const g of this.args){if(d++,c=g.evaluate(t),c&&c instanceof rs&&!c.available&&(r||(r=c),c=null,d===this.args.length))return r;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class ul{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=r.parse(t[g+1],g+1);if(!v)return null;c.push([_,v])}const d=r.parse(t[t.length-1],t.length-1,r.expectedType,c);return d?new ul(c,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[r,c]of this.bindings)t.push(r,c.serialize());return t.push(this.result.serialize()),t}}class Ud{constructor(t,r,c){this.type=t,this.index=r,this.input=c}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,ni),d=r.parse(t[2],2,Co(r.expectedType||Tn));return c&&d?new Ud(d.type.itemType,c,d):null}evaluate(t){const r=this.index.evaluate(t),c=this.input.evaluate(t);if(r<0)throw new Gr("Array index out of bounds: negative index");if(r>=c.length)throw new Gr("Array index out of bounds: index exceeds array size");if(r!==Math.floor(r))throw new Gr("Array index must be an integer. Use at-interpolated for fractional indices");return c[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class $d{constructor(t,r,c){this.type=t,this.index=r,this.input=c}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,ni),d=r.parse(t[2],2,Co(r.expectedType||Tn));return c&&d?new $d(d.type.itemType,c,d):null}evaluate(t){const r=this.index.evaluate(t),c=this.input.evaluate(t);if(r<0)throw new Gr(`Array index out of bounds: ${r} < 0.`);if(r>c.length-1)throw new Gr(`Array index out of bounds: ${r} > ${c.length-1}.`);if(r===Math.floor(r))return c[r];const d=Math.floor(r),g=Math.ceil(r),_=c[d],v=c[g];if(typeof _!="number"||typeof v!="number")throw new Gr(`Cannot interpolate between non-number values at index ${r}.`);const S=r-d;return _*(1-S)+v*S}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class fm{constructor(t,r){this.type=fn,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Tn),d=r.parse(t[2],2,Tn);return c&&d?jp(c.type,[fn,xn,ni,is,Tn])?new fm(c,d):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(c.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!ah(r,["boolean","string","number","null"]))throw new Gr(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(Yr(r))} instead.`);if(!ah(c,["string","array"]))throw new Gr(`Expected second argument to be of type array or string, but found ${Ar(Yr(c))} instead.`);return c.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ru{constructor(t,r,c){this.type=ni,this.needle=t,this.haystack=r,this.fromIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Tn),d=r.parse(t[2],2,Tn);if(!c||!d)return null;if(!jp(c.type,[fn,xn,ni,is,Tn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(c.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,ni);return g?new ru(c,d,g):null}return new ru(c,d)}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!ah(r,["boolean","string","number","null"]))throw new Gr(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(Yr(r))} instead.`);if(!ah(c,["string","array"]))throw new Gr(`Expected second argument to be of type array or string, but found ${Ar(Yr(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return c.indexOf(r,d)}return c.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class yh{constructor(t,r,c,d,g,_){this.inputType=t,this.type=r,this.input=c,this.cases=d,this.outputs=g,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let c,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);const g={},_=[];for(let T=2;T<t.length-1;T+=2){let M=t[T];const A=t[T+1];Array.isArray(M)||(M=[M]);const z=r.concat(T);if(M.length===0)return z.error("Expected at least one branch label.");for(const k of M){if(typeof k!="number"&&typeof k!="string")return z.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return z.error("Numeric branch labels must be integer values.");if(c){if(z.checkSubtype(c,Yr(k)))return null}else c=Yr(k);if(g[String(k)]!==void 0)return z.error("Branch labels must be unique.");g[String(k)]=_.length}const D=r.parse(A,T,d);if(!D)return null;d=d||D.type,_.push(D)}const v=r.parse(t[1],1,Tn);if(!v)return null;const S=r.parse(t[t.length-1],t.length-1,d);return S?v.type.kind!=="value"&&r.concat(1).checkSubtype(c,v.type)?null:new yh(c,d,v,g,_,S):null}evaluate(t){const r=this.input.evaluate(t);return(Sd(Yr(r),this.inputType)&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),c=[],d={};for(const _ of r){const v=d[this.cases[_]];v===void 0?(d[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[v][1].push(_)}const g=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of c)t.push(v.length===1?g(v[0]):v.map(g)),t.push(this.outputs[_].serialize());return t.push(this.otherwise.serialize()),t}}class vh{constructor(t,r,c){this.type=t,this.branches=r,this.otherwise=c}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const d=[];for(let _=1;_<t.length-1;_+=2){const v=r.parse(t[_],_,fn);if(!v)return null;const S=r.parse(t[_+1],_+1,c);if(!S)return null;d.push([v,S]),c=c||S.type}const g=r.parse(t[t.length-1],t.length-1,c);return g?new vh(c,d,g):null}evaluate(t){for(const[r,c]of this.branches)if(r.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,c]of this.branches)t(r),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class Vd{constructor(t,r,c,d){this.type=t,this.input=r,this.beginIndex=c,this.endIndex=d}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Tn),d=r.parse(t[2],2,ni);if(!c||!d)return null;if(!jp(c.type,[Co(Tn),xn,Tn]))return r.error(`Expected first argument to be of type array or string, but found ${Ar(c.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,ni);return g?new Vd(c.type,c,d,g):null}return new Vd(c.type,c,d)}evaluate(t){const r=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!ah(r,["string","array"]))throw new Gr(`Expected first argument to be of type array or string, but found ${Ar(Yr(r))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return r.slice(c,d)}return r.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class pm{constructor(t,r){this.type=Co(xn),this.str=t,this.delimiter=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,xn),d=r.parse(t[2],2,xn);return c&&d?new pm(c,d):void 0}evaluate(t){const r=this.str.evaluate(t),c=this.delimiter.evaluate(t);return r.split(c)}eachChild(t){t(this.str),t(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function mm(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function gm(a,t,r,c){return c.compare(t,r)===0}function ou(a,t,r){const c=a!=="=="&&a!=="!=";return class NB{constructor(g,_,v){this.type=fn,this.lhs=g,this.rhs=_,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const v=g[0];let S=_.parse(g[1],1,Tn);if(!S)return null;if(!mm(v,S.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Ar(S.type)}'.`);let T=_.parse(g[2],2,Tn);if(!T)return null;if(!mm(v,T.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Ar(T.type)}'.`);if(S.type.kind!==T.type.kind&&S.type.kind!=="value"&&T.type.kind!=="value")return _.error(`Cannot compare types '${Ar(S.type)}' and '${Ar(T.type)}'.`);c&&(S.type.kind==="value"&&T.type.kind!=="value"?S=new Mi(T.type,[S]):S.type.kind!=="value"&&T.type.kind==="value"&&(T=new Mi(S.type,[T])));let M=null;if(g.length===4){if(S.type.kind!=="string"&&T.type.kind!=="string"&&S.type.kind!=="value"&&T.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(g[3],3,wd),!M)return null}return new NB(S,T,M)}evaluate(g){const _=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const S=Yr(_),T=Yr(v);if(S.kind!==T.kind||S.kind!=="string"&&S.kind!=="number")throw new Gr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${S.kind}, ${T.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const S=Yr(_),T=Yr(v);if(S.kind!=="string"||T.kind!=="string")return t(g,_,v)}return this.collator?r(g,_,v,this.collator.evaluate(g)):t(g,_,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(_=>{g.push(_.serialize())}),g}}}const Mw=ou("==",function(a,t,r){return t===r},gm),Aw=ou("!=",function(a,t,r){return t!==r},function(a,t,r,c){return!gm(0,t,r,c)}),Hy=ou("<",function(a,t,r){return t<r},function(a,t,r,c){return c.compare(t,r)<0}),Zy=ou(">",function(a,t,r){return t>r},function(a,t,r,c){return c.compare(t,r)>0}),jd=ou("<=",function(a,t,r){return t<=r},function(a,t,r,c){return c.compare(t,r)<=0}),Pw=ou(">=",function(a,t,r){return t>=r},function(a,t,r,c){return c.compare(t,r)>=0});class Gd{constructor(t,r,c,d,g,_){this.type=xn,this.number=t,this.locale=r,this.currency=c,this.unit=d,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const c=r.parse(t[1],1,ni);if(!c)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=r.parseObjectValue(d.locale,2,"locale",xn),!g))return null;let _=null;if(d.currency&&(_=r.parseObjectValue(d.currency,2,"currency",xn),!_))return null;let v=null;if(d.unit&&(v=r.parseObjectValue(d.unit,2,"unit",xn),!v))return null;let S=null;if(d["min-fraction-digits"]&&(S=r.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",ni),!S))return null;let T=null;return d["max-fraction-digits"]&&(T=r.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",ni),!T)?null:new Gd(c,g,_,v,S,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class _m{constructor(t){this.type=ni,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=r.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ar(c.type)} instead.`):new _m(c):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Gr(`Expected value to be of type string or array, but found ${Ar(Yr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}function Wy(a){return function(){a=1831565813+(a|=0)|0;let t=Math.imul(a^a>>>15,1|a);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const _c={"==":Mw,"!=":Aw,">":Zy,"<":Hy,">=":Pw,"<=":jd,array:Mi,at:Ud,"at-interpolated":$d,boolean:Mi,case:vh,coalesce:_h,collator:Ca,format:Qt,image:Xc,in:fm,"index-of":ru,interpolate:ks,"interpolate-hcl":ks,"interpolate-lab":ks,length:_m,let:ul,literal:ll,match:yh,number:Mi,"number-format":Gd,object:Mi,slice:Vd,step:mh,string:Mi,"to-boolean":za,"to-color":za,"to-number":za,"to-string":za,var:Dd,within:kl,distance:gc,config:tu,split:pm};function ym(a,[t,r,c,d]){t=t.evaluate(a),r=r.evaluate(a),c=c.evaluate(a);const g=d?d.evaluate(a):1,_=Hp(t,r,c,g);if(_)throw new Gr(_);return new bn(t/255,r/255,c/255,g)}function qy(a,[t,r,c,d]){t=t.evaluate(a),r=r.evaluate(a),c=c.evaluate(a);const g=d?d.evaluate(a):1,_=(function(T,M,A,z){return typeof T=="number"&&T>=0&&T<=360?typeof M=="number"&&M>=0&&M<=100&&typeof A=="number"&&A>=0&&A<=100?z===void 0||typeof z=="number"&&z>=0&&z<=1?null:`Invalid hsla value [${[T,M,A,z].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof z=="number"?[T,M,A,z]:[T,M,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof z=="number"?[T,M,A,z]:[T,M,A]).join(", ")}]: 'h' must be between 0 and 360.`})(t,r,c,g);if(_)throw new Gr(_);const v=`hsla(${t}, ${r}%, ${c}%, ${g})`,S=bn.parse(v);if(!S)throw new Gr(`Failed to parse HSLA color: ${v}`);return S}function Xy(a,t){return a in t}function vm(a,t){const r=t[a];return r===void 0?null:r}function Bl(a){return{type:a}}function yc(a){if(a instanceof tu)return new Set([a.key]);let t=new Set;return a.eachChild(r=>{t=new Set([...t,...yc(r)])}),t}function Hd(a){if(a instanceof os&&a.name==="is-active-floor")return!0;let t=!1;return a.eachChild(r=>{!t&&Hd(r)&&(t=!0)}),t}function Jy(a){return{result:"success",value:a}}function Nl(a){return{result:"error",value:a}}function xm(a,t){return!!a&&!!a.parameters&&a.parameters.indexOf(t)>-1}function Zd(a){return a["property-type"]==="data-driven"}function bm(a){return xm(a.expression,"measure-light")}function Yy(a){return xm(a.expression,"zoom")}function wm(a){return!!a.expression&&a.expression.interpolated}function Wd(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Ky(a){return a}function Sm(a,t){const r=t.type==="color",c=a.stops&&typeof a.stops[0][0]=="object",d=c||!(c||a.property!==void 0),g=a.type||(wm(t)?"exponential":"interval");if(r&&((a=Object.assign({},a)).stops&&(a.stops=a.stops.map(T=>[T[0],bn.parse(T[1])])),a.default=bn.parse(a.default?a.default:t.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Gy[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let _,v,S;if(g==="exponential")_=Qy;else if(g==="interval")_=zw;else if(g==="categorical"){_=su,v=Object.create(null);for(const T of a.stops)v[T[0]]=T[1];S=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=Cw}if(c){const T={},M=[];for(let D=0;D<a.stops.length;D++){const k=a.stops[D],$=k[0].zoom;T[$]===void 0&&(T[$]={zoom:$,type:a.type,property:a.property,default:a.default,stops:[]},M.push($)),T[$].stops.push([k[0].value,k[1]])}const A=[];for(const D of M)A.push([T[D].zoom,Sm(T[D],t)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:ks.interpolationFactor.bind(void 0,z),zoomStops:A.map(D=>D[0]),evaluate:({zoom:D},k)=>Qy({stops:A,base:a.base},t,D).evaluate(D,k)}}if(d){const T=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:ks.interpolationFactor.bind(void 0,T),zoomStops:a.stops.map(M=>M[0]),evaluate:({zoom:M})=>_(a,t,M,v,S)}}return{kind:"source",evaluate(T,M){const A=M&&M.properties?M.properties[a.property]:void 0;return A===void 0?xh(a.default,t.default):_(a,t,A,v,S)}}}function xh(a,t,r){return a!==void 0?a:t!==void 0?t:r!==void 0?r:void 0}function su(a,t,r,c,d){return xh(typeof r===d?c[r]:void 0,a.default,t.default)}function zw(a,t,r){if(!fi(r))return xh(a.default,t.default);const c=a.stops.length;if(c===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[c-1][0])return a.stops[c-1][1];const d=Od(a.stops.map(g=>g[0]),r);return a.stops[d][1]}function Qy(a,t,r){const c=a.base!==void 0?a.base:1;if(!fi(r))return xh(a.default,t.default);const d=a.stops.length;if(d===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[d-1][0])return a.stops[d-1][1];const g=Od(a.stops.map(M=>M[0]),r),_=(function(M,A,z,D){const k=D-z,$=M-z;return k===0?0:A===1?$/k:(Math.pow(A,$)-1)/(Math.pow(A,k)-1)})(r,c,a.stops[g][0],a.stops[g+1][0]),v=a.stops[g][1],S=a.stops[g+1][1];let T=dc[t.type]||Ky;if(a.colorSpace&&a.colorSpace!=="rgb"){const M=Gy[a.colorSpace];T=(A,z)=>M.reverse(M.interpolate(M.forward(A),M.forward(z),_))}return typeof v.evaluate=="function"?{evaluate(...M){const A=v.evaluate.apply(void 0,M),z=S.evaluate.apply(void 0,M);if(A!==void 0&&z!==void 0)return T(A,z,_)}}:T(v,S,_)}function Cw(a,t,r){return t.type==="color"?r=bn.parse(r):t.type==="formatted"?r=Lo.fromString(r.toString()):t.type==="resolvedImage"?r=rs.build(r.toString()):xi(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),xh(r,a.default,t.default)}os.register(_c,{error:[{kind:"error"},[xn],(a,[t])=>{throw new Gr(t.evaluate(a))}],typeof:[xn,[Tn],(a,[t])=>Ar(Yr(t.evaluate(a)))],"to-rgba":[Co(ni,4),[No],(a,[t])=>t.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Co(ni,4),[No],(a,[t])=>t.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[No,[ni,ni,ni],ym],rgba:[No,[ni,ni,ni,ni],ym],hsl:[No,[ni,ni,ni],qy],hsla:[No,[ni,ni,ni,ni],qy],has:{type:fn,overloads:[[[xn],(a,[t])=>Xy(t.evaluate(a),a.properties())],[[xn,Wc],(a,[t,r])=>Xy(t.evaluate(a),r.evaluate(a))]]},get:{type:Tn,overloads:[[[xn],(a,[t])=>vm(t.evaluate(a),a.properties())],[[xn,Wc],(a,[t,r])=>vm(t.evaluate(a),r.evaluate(a))]]},"feature-state":[Tn,[xn],(a,[t])=>vm(t.evaluate(a),a.featureState||{})],properties:[Wc,[],a=>a.properties()],"geometry-type":[xn,[],a=>a.geometryType()],worldview:[xn,[],a=>a.globals.worldview||""],"is-active-floor":[fn,Bl(xn),(a,t)=>{if(!(a.globals.activeFloors&&a.globals.activeFloors.size>0))return!1;const r=a.globals.activeFloors;return t.some(c=>{const d=c.evaluate(a);return r.has(d)})}],id:[Tn,[],a=>a.id()],zoom:[ni,[],a=>a.globals.zoom],pitch:[ni,[],a=>a.globals.pitch||0],"distance-from-center":[ni,[],a=>a.distanceFromCenter()],"measure-light":[ni,[xn],(a,[t])=>a.measureLight(t.evaluate(a))],"heatmap-density":[ni,[],a=>a.globals.heatmapDensity||0],"line-progress":[ni,[],a=>a.globals.lineProgress||0],"raster-value":[ni,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[ni,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[ni,[],a=>a.globals.skyRadialProgress||0],accumulated:[Tn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[ni,Bl(ni),(a,t)=>{let r=0;for(const c of t)r+=c.evaluate(a);return r}],"*":[ni,Bl(ni),(a,t)=>{let r=1;for(const c of t)r*=c.evaluate(a);return r}],"-":{type:ni,overloads:[[[ni,ni],(a,[t,r])=>t.evaluate(a)-r.evaluate(a)],[[ni],(a,[t])=>-t.evaluate(a)]]},"/":[ni,[ni,ni],(a,[t,r])=>t.evaluate(a)/r.evaluate(a)],"%":[ni,[ni,ni],(a,[t,r])=>t.evaluate(a)%r.evaluate(a)],ln2:[ni,[],()=>Math.LN2],pi:[ni,[],()=>Math.PI],e:[ni,[],()=>Math.E],"^":[ni,[ni,ni],(a,[t,r])=>Math.pow(t.evaluate(a),r.evaluate(a))],sqrt:[ni,[ni],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[ni,[ni],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[ni,[ni],(a,[t])=>Math.log(t.evaluate(a))],log2:[ni,[ni],(a,[t])=>Math.log2(t.evaluate(a))],sin:[ni,[ni],(a,[t])=>Math.sin(t.evaluate(a))],cos:[ni,[ni],(a,[t])=>Math.cos(t.evaluate(a))],tan:[ni,[ni],(a,[t])=>Math.tan(t.evaluate(a))],asin:[ni,[ni],(a,[t])=>Math.asin(t.evaluate(a))],acos:[ni,[ni],(a,[t])=>Math.acos(t.evaluate(a))],atan:[ni,[ni],(a,[t])=>Math.atan(t.evaluate(a))],min:[ni,Bl(ni),(a,t)=>Math.min(...t.map(r=>r.evaluate(a)))],max:[ni,Bl(ni),(a,t)=>Math.max(...t.map(r=>r.evaluate(a)))],abs:[ni,[ni],(a,[t])=>Math.abs(t.evaluate(a))],round:[ni,[ni],(a,[t])=>{const r=t.evaluate(a);return r<0?-Math.round(-r):Math.round(r)}],floor:[ni,[ni],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[ni,[ni],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[fn,[xn,Tn],(a,[t,r])=>a.properties()[t.value]===r.value],"filter-id-==":[fn,[Tn],(a,[t])=>a.id()===t.value],"filter-type-==":[fn,[xn],(a,[t])=>a.geometryType()===t.value],"filter-<":[fn,[xn,Tn],(a,[t,r])=>{const c=a.properties()[t.value],d=r.value;return typeof c==typeof d&&c<d}],"filter-id-<":[fn,[Tn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r<c}],"filter->":[fn,[xn,Tn],(a,[t,r])=>{const c=a.properties()[t.value],d=r.value;return typeof c==typeof d&&c>d}],"filter-id->":[fn,[Tn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r>c}],"filter-<=":[fn,[xn,Tn],(a,[t,r])=>{const c=a.properties()[t.value],d=r.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[fn,[Tn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r<=c}],"filter->=":[fn,[xn,Tn],(a,[t,r])=>{const c=a.properties()[t.value],d=r.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[fn,[Tn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r>=c}],"filter-has":[fn,[Tn],(a,[t])=>t.value in a.properties()],"filter-has-id":[fn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[fn,[Co(xn)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[fn,[Co(Tn)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[fn,[xn,Co(Tn)],(a,[t,r])=>r.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[fn,[xn,Co(Tn)],(a,[t,r])=>(function(c,d,g,_){for(;g<=_;){const v=g+_>>1;if(d[v]===c)return!0;d[v]>c?_=v-1:g=v+1}return!1})(a.properties()[t.value],r.value,0,r.value.length-1)],all:{type:fn,overloads:[[[fn,fn],(a,[t,r])=>t.evaluate(a)&&r.evaluate(a)],[Bl(fn),(a,t)=>{for(const r of t)if(!r.evaluate(a))return!1;return!0}]]},any:{type:fn,overloads:[[[fn,fn],(a,[t,r])=>t.evaluate(a)||r.evaluate(a)],[Bl(fn),(a,t)=>{for(const r of t)if(r.evaluate(a))return!0;return!1}]]},"!":[fn,[fn],(a,[t])=>!t.evaluate(a)],"is-supported-script":[fn,[xn],(a,[t])=>{const r=a.globals&&a.globals.isSupportedScript;return!r||r(t.evaluate(a))}],upcase:[xn,[xn],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[xn,[xn],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[xn,Bl(Tn),(a,t)=>t.map(r=>Pa(r.evaluate(a))).join("")],"resolved-locale":[xn,[wd],(a,[t])=>t.evaluate(a).resolvedLocale()],random:[ni,[ni,ni,Tn],(a,t)=>{const[r,c,d]=t.map(_=>_.evaluate(a));if(r>c||r===c)return r;let g;if(typeof d=="string")g=(function(_){let v=0;if(_.length===0)return v;for(let S=0;S<_.length;S++)v=(v<<5)-v+_.charCodeAt(S),v&=v;return v})(d);else{if(typeof d!="number")throw new Gr(`Invalid seed input: ${d}`);g=d}return r+Wy(g)()*(c-r)}]});class qd{constructor(t,r,c,d,g){this.expression=t,this._warningHistory={},this._scope=c,this._options=d,this._iconImageUseTheme=g,this._evaluator=new Jc(c,d,g),this._defaultValue=r?(function(_){return _.type==="color"&&(Wd(_.default)||Array.isArray(_.default))?new bn(0,0,0,0):_.type==="color"?bn.parse(_.default)||null:_.default===void 0?null:_.default})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=yc(t),this.isIndoorDependent=Hd(t)}evaluateWithoutErrorHandling(t,r,c,d,g,_,v,S){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=c,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,c,d,g,_,v,S,T){this._evaluator||(this._evaluator=new Jc(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this._evaluator.iconImageUseTheme=T||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Gr(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){const A=M;return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function bh(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in _c}function Ul(a,t,r,c,d){const g=new kd(_c,[],t?(function(v){const S={color:No,string:xn,number:ni,enum:xn,boolean:fn,formatted:qc,resolvedImage:fc};return v.type==="array"?Co(S[v.value]||Tn,v.length):S[v.type]})(t):void 0,void 0,void 0,r,c,d),_=g.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Jy(new qd(_,t,r,c,d)):Nl(g.errors)}class wh{constructor(t,r,c,d){this.kind=t,this._styleExpression=r,this.isLightConstant=c,this.isLineProgressConstant=d,this.isStateDependent=t!=="constant"&&!ph(r.expression),this.configDependencies=yc(r.expression),this.isIndoorDependent=Hd(r.expression)}evaluateWithoutErrorHandling(t,r,c,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,d,g,_)}evaluate(t,r,c,d,g,_,v){return this._styleExpression.evaluate(t,r,c,d,g,_,void 0,void 0,v)}}class vc{constructor(t,r,c,d,g,_){this.kind=t,this.zoomStops=c,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!ph(r.expression),this.isIndoorDependent=Hd(r.expression),this.isLightConstant=g,this.isLineProgressConstant=_,this.configDependencies=yc(r.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,r,c,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,d,g,_)}evaluate(t,r,c,d,g,_){return this._styleExpression.evaluate(t,r,c,d,g,_)}interpolationFactor(t,r,c){return this.interpolationType?ks.interpolationFactor(this.interpolationType,t,r,c):0}}function Xd(a,t,r,c,d){if((a=Ul(a,t,r,c,d)).result==="error")return a;const g=a.value.expression,_=Qc(g);if(!_&&!Zd(t))return Nl([new Bo("","data expressions not supported")]);const v=eu(g,["zoom","pitch","distance-from-center"]);if(!v&&!Yy(t))return Nl([new Bo("","zoom expressions not supported")]);const S=eu(g,["measure-light"]);if(!S&&!bm(t))return Nl([new Bo("","measure-light expression not supported")]);const T=eu(g,["line-progress"]);if(!T&&!(function(z){return xm(z.expression,"line-progress")})(t))return Nl([new Bo("","line-progress expression not supported")]);const M=t.expression&&t.expression.relaxZoomRestriction,A=Jd(g);return A||v||M?A instanceof Bo?Nl([A]):A instanceof ks&&!wm(t)?Nl([new Bo("",'"interpolate" expressions cannot be used with this property')]):Jy(A?new vc(_&&T?"camera":"composite",a.value,A.labels,A instanceof ks?A.interpolation:void 0,S,T):new wh(_&&T?"constant":"source",a.value,S,T)):Nl([new Bo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Sh{constructor(t,r){this._parameters=t,this._specification=r,Object.assign(this,Sm(this._parameters,this._specification))}static deserialize(t){return new Sh(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Jd(a){let t=null;if(a instanceof ul)t=Jd(a.result);else if(a instanceof _h){for(const r of a.args)if(t=Jd(r),t)break}else(a instanceof mh||a instanceof ks)&&a.input instanceof os&&a.input.name==="zoom"&&(t=a);return t instanceof Bo||a.eachChild(r=>{const c=Jd(r);c instanceof Bo?t=c:t&&c&&t!==c&&(t=new Bo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Ra,ev,Lw=(function(){if(ev)return Ra;ev=1,Ra=t;var a=3;function t(r,c,d){var g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var _=new Int32Array(this.arrayBuffer);r=_[0],this.d=(c=_[1])+2*(d=_[2]);for(var v=0;v<this.d*this.d;v++){var S=_[a+v],T=_[a+v+1];g.push(S===T?null:_.subarray(S,T))}var M=_[a+g.length+1];this.keys=_.subarray(_[a+g.length],M),this.bboxes=_.subarray(M),this.insert=this._insertReadonly}else{this.d=c+2*d;for(var A=0;A<this.d*this.d;A++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=r,this.padding=d,this.scale=c/r,this.uid=0;var z=d/c*r;this.min=-z,this.max=r+z}return t.prototype.insert=function(r,c,d,g,_){this._forEachCell(c,d,g,_,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(_)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(r,c,d,g,_,v){this.cells[_].push(v)},t.prototype.query=function(r,c,d,g,_){var v=this.min,S=this.max;if(r<=v&&c<=v&&S<=d&&S<=g&&!_)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(r,c,d,g,this._queryCell,T,{},_),T},t.prototype._queryCell=function(r,c,d,g,_,v,S,T){var M=this.cells[_];if(M!==null)for(var A=this.keys,z=this.bboxes,D=0;D<M.length;D++){var k=M[D];if(S[k]===void 0){var $=4*k;(T?T(z[$+0],z[$+1],z[$+2],z[$+3]):r<=z[$+2]&&c<=z[$+3]&&d>=z[$+0]&&g>=z[$+1])?(S[k]=!0,v.push(A[k])):S[k]=!1}}},t.prototype._forEachCell=function(r,c,d,g,_,v,S,T){for(var M=this._convertToCellCoord(r),A=this._convertToCellCoord(c),z=this._convertToCellCoord(d),D=this._convertToCellCoord(g),k=M;k<=z;k++)for(var $=A;$<=D;$++){var H=this.d*$+k;if((!T||T(this._convertFromCellCoord(k),this._convertFromCellCoord($),this._convertFromCellCoord(k+1),this._convertFromCellCoord($+1)))&&_.call(this,r,c,d,g,H,v,S,T))return}},t.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},t.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,c=a+this.cells.length+1+1,d=0,g=0;g<this.cells.length;g++)d+=this.cells[g].length;var _=new Int32Array(c+d+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var v=c,S=0;S<r.length;S++){var T=r[S];_[a+S]=v,_.set(T,v),v+=T.length}return _[a+r.length]=v,_.set(this.keys,v),_[a+r.length+1]=v+=this.keys.length,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer},Ra})(),xc=Qo(Lw);const Yd={};function jt(a,t,r={}){Object.defineProperty(a,"_classRegistryKey",{value:t,writable:!1}),Yd[t]={klass:a,omit:r.omit||[]}}jt(Object,"Object"),xc.serialize=function(a,t){const r=a.toArrayBuffer();return t&&t.add(r),{buffer:r}},xc.deserialize=function(a){return new xc(a.buffer)},Object.defineProperty(xc,"name",{value:"Grid"}),jt(xc,"Grid"),delete Ae.prototype.constructor,jt(bn,"Color"),jt(Error,"Error"),jt(Lo,"Formatted"),jt(Td,"FormattedSection"),jt(eh,"AJAXError"),jt(rs,"ResolvedImage"),jt(Sh,"StylePropertyFunction"),jt(qd,"StyleExpression",{omit:["_evaluator"]}),jt(ts,"ImageId"),jt(ns,"ImageVariant"),jt(vc,"ZoomDependentExpression"),jt(wh,"ZoomConstantExpression"),jt(os,"CompoundExpression",{omit:["_evaluate"]});for(const a in _c)Yd[_c[a]._classRegistryKey]||jt(_c[a],`Expression${a}`);function Tm(a){return a&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function pa(a,t){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Tm(a)||a instanceof ImageBitmap)return t&&t.add(a),a;if(ArrayBuffer.isView(a))return t&&t.add(a.buffer),a;if(a instanceof ImageData)return t&&t.add(a.data.buffer),a;if(Array.isArray(a)){const r=[];for(const c of a)r.push(pa(c,t));return r}if(a instanceof Map){const r={$name:"Map",entries:[]};for(const[c,d]of a.entries())r.entries.push(pa(c),pa(d,t));return r}if(a instanceof Set){const r={$name:"Set"};let c=0;for(const d of a.values())r[++c]=pa(d);return r}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const r=a.constructor,c=r._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const d=r.serialize?r.serialize(a,t):{};if(!r.serialize){for(const g in a)a.hasOwnProperty(g)&&(Yd[c].omit.indexOf(g)>=0||(d[g]=pa(a[g],t)));a instanceof Error&&(d.message=a.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof a)}function hl(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Tm(a)||a instanceof ImageBitmap||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(hl);if(typeof a=="object"){const t=a.$name||"Object";if(t==="Map"){const d=a.entries||[],g=new Map;for(let _=0;_<d.length;_+=2)g.set(hl(d[_]),hl(d[_+1]));return g}if(t==="Set"){const d=new Set;for(const g of Object.keys(a))g!=="$name"&&d.add(hl(a[g]));return d}if(t==="BigInt")return BigInt(a.value);const{klass:r}=Yd[t];if(!r)throw new Error(`Can't deserialize unregistered class "${t}".`);if(r.deserialize)return r.deserialize(a);const c=Object.create(r.prototype);for(const d of Object.keys(a))d!=="$name"&&(c[d]=hl(a[d]));return c}throw new Error("can't deserialize object of type "+typeof a)}const tv=a=>a>=1536&&a<=1791,iv=a=>a>=1872&&a<=1919,Kd=a=>a>=2208&&a<=2303,Qd=a=>a>=11904&&a<=12031,Em=a=>a>=12032&&a<=12255,Im=a=>a>=12272&&a<=12287,au=a=>a>=12288&&a<=12351,lu=a=>a>=12352&&a<=12447,Th=a=>a>=12448&&a<=12543,Da=a=>a>=12544&&a<=12591,nv=a=>a>=12704&&a<=12735,rv=a=>a>=12736&&a<=12783,ov=a=>a>=12784&&a<=12799,sv=a=>a>=12800&&a<=13055,Mm=a=>a>=13056&&a<=13311,cu=a=>a>=13312&&a<=19903,ef=a=>a>=19968&&a<=40959,Am=a=>a>=40960&&a<=42127,tf=a=>a>=42128&&a<=42191,av=a=>a>=44032&&a<=55215,lv=a=>a>=63744&&a<=64255,Pm=a=>a>=64336&&a<=65023,cv=a=>a>=65040&&a<=65055,zm=a=>a>=65072&&a<=65103,uv=a=>a>=65104&&a<=65135,Cm=a=>a>=65136&&a<=65279,Lm=a=>a>=65280&&a<=65519;function Rm(a){for(const t of a)if($l(t.charCodeAt(0)))return!0;return!1}function Rw(a){for(const t of a)if(!Dw(t.charCodeAt(0)))return!1;return!0}function Dw(a){return!(tv(a)||iv(a)||Kd(a)||Pm(a)||Cm(a))}function hv(a){return!(a<11904||!(nv(a)||Da(a)||zm(a)||lv(a)||Mm(a)||Qd(a)||rv(a)||au(a)||cu(a)||ef(a)||sv(a)||Lm(a)||lu(a)||Im(a)||Em(a)||ov(a)||Th(a)||cv(a)||tf(a)||Am(a)))}function $l(a){return!(a!==746&&a!==747&&(a<4352||!(nv(a)||Da(a)||zm(a)&&!(a>=65097&&a<=65103)||lv(a)||Mm(a)||Qd(a)||rv(a)||!(!au(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||cu(a)||ef(a)||sv(a)||(t=>t>=12592&&t<=12687)(a)||(t=>t>=43360&&t<=43391)(a)||(t=>t>=55216&&t<=55295)(a)||(t=>t>=4352&&t<=4607)(a)||av(a)||lu(a)||Im(a)||(t=>t>=12688&&t<=12703)(a)||Em(a)||ov(a)||Th(a)&&a!==12540||!(!Lm(a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!uv(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(t=>t>=5120&&t<=5759)(a)||(t=>t>=6320&&t<=6399)(a)||cv(a)||(t=>t>=19904&&t<=19967)(a)||Am(a)||tf(a))))}function dv(a){return a===12312||a===12313||a===12316||a===12540||a===12448}function Dm(a){return!($l(a)||(function(t){return!!((r=>r>=128&&r<=255)(t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||(r=>r>=8192&&r<=8303)(t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||(r=>r>=8448&&r<=8527)(t)||(r=>r>=8528&&r<=8591)(t)||(r=>r>=8960&&r<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||(r=>r>=9216&&r<=9279)(t)&&t!==9251||(r=>r>=9280&&r<=9311)(t)||(r=>r>=9312&&r<=9471)(t)||(r=>r>=9632&&r<=9727)(t)||(r=>r>=9728&&r<=9983)(t)&&!(t>=9754&&t<=9759)||(r=>r>=11008&&r<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||au(t)||Th(t)||(r=>r>=57344&&r<=63743)(t)||zm(t)||uv(t)||Lm(t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(a))}function nf(a){return tv(a)||iv(a)||Kd(a)||Pm(a)||Cm(a)}function fv(a){return a>=1424&&a<=2303||Pm(a)||Cm(a)}function kw(a,t){return!(!t&&fv(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(r=>r>=6016&&r<=6143)(a))}function Vl(a){for(const t of a)if(fv(t.charCodeAt(0)))return!0;return!1}const ss={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let jl=null,Uo=ss.unavailable,Gl=null;const pv=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Uo=ss.error),jl&&jl(a)};function km(){Om.fire(new sl("pluginStateChange",{pluginStatus:Uo,pluginURL:Gl}))}const Om=new al,Fm=function(){return Uo},Bm=function(){if(Uo!==ss.deferred||!Gl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Uo=ss.loading,km(),Gl&&ih({url:Gl},a=>{a?pv(a):(Uo=ss.loaded,km())})},ma={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Uo===ss.loaded||ma.applyArabicShaping!=null,isLoading:()=>Uo===ss.loading,setState(a){Uo=a.pluginStatus,Gl=a.pluginURL},isParsing:()=>Uo===ss.parsing,isParsed:()=>Uo===ss.parsed,getPluginURL:()=>Gl};class An{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness,this.worldview=r.worldview,this.activeFloors=r.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return(function(r,c){for(const d of r)if(!kw(d.charCodeAt(0),c))return!1;return!0})(t,ma.isLoaded())}}class Eh{constructor(t,r,c,d,g){this.property=t,this.value=r,this.expression=(function(_,v,S,T,M){if(Wd(_))return new Sh(_,v);if(bh(_)||Array.isArray(_)&&_.length>0){const A=Xd(_,v,S,T,M);if(A.result==="error")throw new Error(A.value.map(z=>`${z.key}: ${z.message}`).join(", "));return A.value}{let A=_;return typeof _=="string"&&v.type==="color"&&(A=bn.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>A}}})(r===void 0?t.specification.default:r,t.specification,c,d,g)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,c,d){return this.property.possiblyEvaluate(this,t,r,c,d)}}class Ih{constructor(t,r,c,d){this.property=t,this.value=new Eh(t,void 0,r,c,d)}transitioned(t,r){return new mv(this.property,this.value,r,Object.assign({},t.transition,this.transition),t.now)}untransitioned(){return new mv(this.property,this.value,null,{},0)}}class uu{constructor(t,r,c,d){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=r,this._options=c,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return Oi(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Ih(this._values[t].property,this._scope,this._options,this._iconImageUseTheme)),this._values[t].value=new Eh(this._values[t].property,r===null?void 0:Oi(r),this._scope,this._options,this._iconImageUseTheme),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].value.isIndoorDependent())}setTransitionOrValue(t,r){r&&(this._options=r);const c=this._properties.properties;if(t)for(const d in t){const g=t[d];if(d.endsWith("-transition")){const _=d.slice(0,-11);c[_]&&this.setTransition(_,g)}else c.hasOwnProperty(d)&&this.setValue(d,g)}}getTransition(t){return Oi(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Ih(this._values[t].property)),this._values[t].transition=Oi(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c);const d=this.getTransition(r);d!==void 0&&(t[`${r}-transition`]=d)}return t}transitioned(t,r){const c=new gv(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(t,r._values[d]);return c}untransitioned(){const t=new gv(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}isIndoorDependent(){return this._isIndoorDependent}}class mv{constructor(t,r,c,d,g){const _=d.delay||0,v=d.duration||0;g=g||0,this.property=t,this.value=r,this.begin=g+_,this.end=this.begin+v,t.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(t,r,c){const d=t.now||0,g=this.value.possiblyEvaluate(t,r,c),_=this.prior;if(_){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return _.possiblyEvaluate(t,r,c);{const v=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,c),g,Q(v))}}return g}}class gv{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,c){const d=new $o(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(t,r,c);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Nm{constructor(t,r,c,d){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=r,this._options=c,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return Oi(this._values[t].value)}setValue(t,r){this._values[t]=new Eh(this._values[t].property,r===null?void 0:Oi(r),this._scope,this._options,this._iconImageUseTheme),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].isIndoorDependent())}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c)}return t}possiblyEvaluate(t,r,c,d){const g=new $o(this._properties);for(const _ of Object.keys(this._values))g._values[_]=this._values[_].possiblyEvaluate(t,r,c,d);return g}isIndoorDependent(){return this._isIndoorDependent}}class bc{constructor(t,r,c,d){this.property=t,this.value=r,this.parameters=c,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,c,d){return this.property.evaluate(this.value,this.parameters,t,r,c,d,this.iconImageUseTheme)}}class $o{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class bt{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,c){const d=dc[this.specification.type];return d?d(t,r,c):t}}class zt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,c,d,g){return t.expression.kind==="constant"||t.expression.kind==="camera"?new bc(this,{kind:"constant",value:t.expression.evaluate(r,null,{},c,d,void 0,g)},r):new bc(this,t.expression,r,g)}interpolate(t,r,c){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new bc(this,{kind:"constant",value:void 0},t.parameters);const d=dc[this.specification.type];return d?new bc(this,{kind:"constant",value:d(t.value.value,r.value.value,c)},t.parameters):t}evaluate(t,r,c,d,g,_,v){return t.kind==="constant"?t.value:t.evaluate(r,c,d,g,_,void 0,v)}}class hu{constructor(t){this.specification=t}possiblyEvaluate(t,r,c,d){return!!t.expression.evaluate(r,null,{},c,d)}interpolate(){return!1}}class ur{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new An(0,{});for(const c in t){const d=t[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new Eh(d,void 0),_=this.defaultTransitionablePropertyValues[c]=new Ih(d);this.defaultTransitioningPropertyValues[c]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(r)}}}jt(zt,"DataDrivenProperty"),jt(bt,"DataConstantProperty"),jt(hu,"ColorRampProperty");var ke=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function _v(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function rf(a){if(Array.isArray(a))return a.map(rf);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const r in a)t[r]=rf(a[r]);return t}return _v(a)}function Um(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!Um(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function $m(a,t="",r=null,c="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Um(a)||(a=Mh(a));const d=a;let g=!0;try{g=(function(M){if(!du(M))return M;let A=rf(M);return Vm(A),A=yv(A),A})(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let _=null,v=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){v=ke[`filter_${c}`];const M=Ul(g,v,t,r);if(M.result==="error")throw new Error(M.value.map(A=>`${A.key}: ${A.message}`).join(", "));_=(A,z,D)=>M.value.evaluate(A,z,{},D)}let S=null,T=null;if(g!==d){const M=Ul(d,v,t,r);if(M.result==="error")throw new Error(M.value.map(A=>`${A.key}: ${A.message}`).join(", "));S=(A,z,D,k,$)=>M.value.evaluate(A,z,{},D,void 0,void 0,k,$),T=!Qc(M.value.expression)}return{filter:_,dynamicFilter:S||void 0,needGeometry:jm(g),needFeature:!!T}}function yv(a){if(!Array.isArray(a))return a;const t=(function(r){if(Ow.has(r[0])){for(let c=1;c<r.length;c++)if(du(r[c]))return!0}return r})(a);return t===!0?t:t.map(r=>yv(r))}function Vm(a){let t=!1;const r=[];if(a[0]==="case"){for(let c=1;c<a.length-1;c+=2)t=t||du(a[c]),r.push(a[c+1]);r.push(a[a.length-1])}else if(a[0]==="match"){t=t||du(a[1]);for(let c=2;c<a.length-1;c+=2)r.push(a[c+1]);r.push(a[a.length-1])}else if(a[0]==="step"){t=t||du(a[1]);for(let c=1;c<a.length-1;c+=2)r.push(a[c+1])}t&&(a.length=0,a.push("any",...r));for(let c=1;c<a.length;c++)Vm(a[c])}function du(a){if(!Array.isArray(a))return!1;if((t=a[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let r=1;r<a.length;r++)if(du(a[r]))return!0;return!1}const Ow=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Fw(a,t){return a<t?-1:a>t?1:0}function jm(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(jm(a[t]))return!0;return!1}function Mh(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?ka(a[1],a[2],"=="):t==="!="?of(ka(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ka(a[1],a[2],t):t==="any"?(r=a.slice(1),["any"].concat(r.map(Mh))):t==="all"?["all"].concat(a.slice(1).map(Mh)):t==="none"?["all"].concat(a.slice(1).map(Mh).map(of)):t==="in"?Gm(a[1],a.slice(2)):t==="!in"?of(Gm(a[1],a.slice(2))):t==="has"?vv(a[1]):t!=="!has"||of(vv(a[1]));var r}function ka(a,t,r){switch(a){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,a,t]}}function Gm(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",a,["literal",t.sort(Fw)]]:["filter-in-small",a,["literal",t]]}}function vv(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function of(a){return["!",a]}const Ah="";function wc(a,t){return t?`${a}${Ah}${t}`:a}let Hm;const Zm=()=>Hm||(Hm=new ur({"icon-size":new zt(ke.layout_symbol["icon-size"]),"icon-image":new zt(ke.layout_symbol["icon-image"]),"icon-rotate":new zt(ke.layout_symbol["icon-rotate"]),"icon-offset":new zt(ke.layout_symbol["icon-offset"]),"text-size":new zt(ke.layout_symbol["text-size"]),"text-rotate":new zt(ke.layout_symbol["text-rotate"]),"text-offset":new zt(ke.layout_symbol["text-offset"])}));class xv{constructor(t,r,c,d,g,_){const v=Ul(t,ke.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=r,c){this.properties=new $o(Zm()),this.unevaluatedLayout=new Nm(Zm(),d,g,_);for(const S in c)this.unevaluatedLayout.setValue(S,c[S])}}isActive(t){return!(this.condition||!t.isHidden||this.name!=="hidden")||this.condition.evaluate(t.globals,t.feature,t.featureState,t.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(t){return this.properties.get(t)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(t){return this.unevaluatedLayout._values[t]}recalculate(t,r,c){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(t,void 0,r,c))}serialize(){const t={};return t.condition=this.condition.expression.serialize(),this.name&&(t.name=this.name),this.unevaluatedLayout&&(t.properties=this.unevaluatedLayout.serialize()),t}hasIconProperties(){const t=this.hasProperty("icon-image"),r=this.hasProperty("icon-size"),c=this.hasProperty("icon-offset"),d=this.hasProperty("icon-rotate");return t||r||c||d}hasTextProperties(){const t=this.hasProperty("text-size"),r=this.hasProperty("text-offset"),c=this.hasProperty("text-rotate");return t||r||c}hasProperty(t){return this.getUnevaluatedProperty(t).value!==void 0}}const bv="-transition",wv=new Set(["fill","line","background","hillshade","raster"]);class Vo extends al{constructor(t,r,c,d,g,_){if(super(),this.id=t.id,this.fqid=wc(this.id,c),this.type=t.type,this.scope=c,this.lut=d,this.options=g,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const v=Ul(this.filter,ke[`filter_${t.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(t.slot&&(this.slot=t.slot),t.appearances&&this.setAppearances(t.appearances),r.layout&&(this._unevaluatedLayout=new Nm(r.layout,this.scope,g,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),r.paint){this._transitionablePaint=new uu(r.paint,this.scope,g);for(const v in t.paint)this.setPaintProperty(v,t.paint[v]);for(const v in t.layout)this.setLayoutProperty(v,t.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $o(r.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D(!0)&&wv.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r){if(this.type==="custom"&&t==="visibility")return void(this.visibility=r);const c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,r),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...c.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||c.isIndoorDependent(),t==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(t){this.appearances=[],t.forEach(r=>{this.appearances.push(new xv(r.condition,r.name,r.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return t.endsWith(bv)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}isPaintProperty(t){return!!this._transitionablePaint._properties.properties[t]}setPaintProperty(t,r){const c=this._transitionablePaint,d=c._properties.properties;if(t.endsWith(bv)){const A=t.slice(0,-11);return d[A]&&c.setTransition(A,r||void 0),!1}if(!d[t])return!1;const g=c._values[t],_=g.value.isDataDriven(),v=g.value;c.setValue(t,r),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...c.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||c.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(t);const S=c._values[t].value,T=S.isDataDriven(),M=t.endsWith("pattern")||t==="line-dasharray";return T||_||M||this._handleOverridablePaintPropertyUpdate(t,v,S)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,r,c){return null}_handleOverridablePaintPropertyUpdate(t,r,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(t.appearances=this.appearances.map(r=>r.serialize())),ci(t,(r,c)=>!(r===void 0||c==="layout"&&!Object.keys(r).length||c==="paint"&&!Object.keys(r).length))}is3D(t){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof bc&&Zd(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}for(const t of this.appearances)if(!ph(t.condition.expression))return!0;return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=$m(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(t,r,c){return{}}queryRadius(t){}queryIntersectsFeature(t,r,c,d,g,_,v,S,T,M){}}const Sv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Hl{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const Bw=new ArrayBuffer(0);class Zn{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(t,r){return t._trim(),r&&t.arrayBuffer&&r.add(t.arrayBuffer),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,t.arrayBuffer?r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement:(r.capacity=0,r.arrayBuffer=Bw),r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this._reallocCount++,this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}reserveForAdditional(t){this.reserve(this.length+t)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ki(a,t=1){let r=0,c=0;return{members:a.map(d=>{const g=Sv[d.type].BYTES_PER_ELEMENT,_=r=Tv(r,Math.max(t,g)),v=d.components||1;return c=Math.max(c,g),r+=g*v,{name:d.name,type:d.type,components:v,offset:_}}),size:Tv(r,Math.max(c,t)),alignment:t}}function Tv(a,t){return Math.ceil(a/t)*t}class Zl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const d=2*t;return this.int16[d+0]=r,this.int16[d+1]=c,t}}Zl.prototype.bytesPerElement=4,jt(Zl,"StructArrayLayout2i4");class dl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=3*t;return this.int16[g+0]=r,this.int16[g+1]=c,this.int16[g+2]=d,t}}dl.prototype.bytesPerElement=6,jt(dl,"StructArrayLayout3i6");class fl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,c,d)}emplace(t,r,c,d,g){const _=4*t;return this.int16[_+0]=r,this.int16[_+1]=c,this.int16[_+2]=d,this.int16[_+3]=g,t}}fl.prototype.bytesPerElement=8,jt(fl,"StructArrayLayout4i8");class yo extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}yo.prototype.bytesPerElement=4,jt(yo,"StructArrayLayout1f4");class fu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=4*t,_=2*t;return this.int16[g+0]=r,this.int16[g+1]=c,this.float32[_+1]=d,t}}fu.prototype.bytesPerElement=8,jt(fu,"StructArrayLayout2i1f8");class Wm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=4*t;return this.int16[g+0]=r,this.int16[g+1]=c,this.int16[g+2]=d,t}}Wm.prototype.bytesPerElement=8,jt(Wm,"StructArrayLayout3i8");class qm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,d,g)}emplace(t,r,c,d,g,_){const v=5*t;return this.int16[v+0]=r,this.int16[v+1]=c,this.int16[v+2]=d,this.int16[v+3]=g,this.int16[v+4]=_,t}}qm.prototype.bytesPerElement=10,jt(qm,"StructArrayLayout5i10");class Xm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,c,d,g,_,v)}emplace(t,r,c,d,g,_,v,S){const T=6*t,M=12*t,A=3*t;return this.int16[T+0]=r,this.int16[T+1]=c,this.uint8[M+4]=d,this.uint8[M+5]=g,this.uint8[M+6]=_,this.uint8[M+7]=v,this.float32[A+2]=S,t}}Xm.prototype.bytesPerElement=12,jt(Xm,"StructArrayLayout2i4ub1f12");class ra extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=3*t;return this.float32[g+0]=r,this.float32[g+1]=c,this.float32[g+2]=d,t}}ra.prototype.bytesPerElement=12,jt(ra,"StructArrayLayout3f12");class Oa extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,d,g)}emplace(t,r,c,d,g,_){const v=6*t,S=3*t;return this.uint16[v+0]=r,this.uint16[v+1]=c,this.uint16[v+2]=d,this.uint16[v+3]=g,this.float32[S+2]=_,t}}Oa.prototype.bytesPerElement=12,jt(Oa,"StructArrayLayout4ui1f12");class pu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,c,d)}emplace(t,r,c,d,g){const _=4*t;return this.uint16[_+0]=r,this.uint16[_+1]=c,this.uint16[_+2]=d,this.uint16[_+3]=g,t}}pu.prototype.bytesPerElement=8,jt(pu,"StructArrayLayout4ui8");class mu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,d,g,_)}emplace(t,r,c,d,g,_,v){const S=6*t;return this.int16[S+0]=r,this.int16[S+1]=c,this.int16[S+2]=d,this.int16[S+3]=g,this.int16[S+4]=_,this.int16[S+5]=v,t}}mu.prototype.bytesPerElement=12,jt(mu,"StructArrayLayout6i12");class Jm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z){const D=this.length;return this.resize(D+1),this.emplace(D,t,r,c,d,g,_,v,S,T,M,A,z)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D){const k=12*t;return this.int16[k+0]=r,this.int16[k+1]=c,this.int16[k+2]=d,this.int16[k+3]=g,this.uint16[k+4]=_,this.uint16[k+5]=v,this.uint16[k+6]=S,this.uint16[k+7]=T,this.int16[k+8]=M,this.int16[k+9]=A,this.int16[k+10]=z,this.int16[k+11]=D,t}}Jm.prototype.bytesPerElement=24,jt(Jm,"StructArrayLayout4i4ui4i24");class Ym extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,d,g,_)}emplace(t,r,c,d,g,_,v){const S=10*t,T=5*t;return this.int16[S+0]=r,this.int16[S+1]=c,this.int16[S+2]=d,this.float32[T+2]=g,this.float32[T+3]=_,this.float32[T+4]=v,t}}Ym.prototype.bytesPerElement=20,jt(Ym,"StructArrayLayout3i3f20");class Wl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,c,d)}emplace(t,r,c,d,g){const _=4*t;return this.float32[_+0]=r,this.float32[_+1]=c,this.float32[_+2]=d,this.float32[_+3]=g,t}}Wl.prototype.bytesPerElement=16,jt(Wl,"StructArrayLayout4f16");class Km extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Km.prototype.bytesPerElement=4,jt(Km,"StructArrayLayout1ul4");class Os extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const d=2*t;return this.uint16[d+0]=r,this.uint16[d+1]=c,t}}Os.prototype.bytesPerElement=4,jt(Os,"StructArrayLayout2ui4");class Ph extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z,D){const k=this.length;return this.resize(k+1),this.emplace(k,t,r,c,d,g,_,v,S,T,M,A,z,D)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D,k){const $=20*t,H=10*t;return this.int16[$+0]=r,this.int16[$+1]=c,this.int16[$+2]=d,this.int16[$+3]=g,this.int16[$+4]=_,this.float32[H+3]=v,this.float32[H+4]=S,this.float32[H+5]=T,this.float32[H+6]=M,this.int16[$+14]=A,this.uint32[H+8]=z,this.uint16[$+18]=D,this.uint16[$+19]=k,t}}Ph.prototype.bytesPerElement=40,jt(Ph,"StructArrayLayout5i4f1i1ul2ui40");class sf extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,c,d,g,_,v)}emplace(t,r,c,d,g,_,v,S){const T=8*t;return this.int16[T+0]=r,this.int16[T+1]=c,this.int16[T+2]=d,this.int16[T+4]=g,this.int16[T+5]=_,this.int16[T+6]=v,this.int16[T+7]=S,t}}sf.prototype.bytesPerElement=16,jt(sf,"StructArrayLayout3i2i2i16");class af extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,d,g)}emplace(t,r,c,d,g,_){const v=4*t,S=8*t;return this.float32[v+0]=r,this.float32[v+1]=c,this.float32[v+2]=d,this.int16[S+6]=g,this.int16[S+7]=_,t}}af.prototype.bytesPerElement=16,jt(af,"StructArrayLayout2f1f2i16");class lf extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,d,g,_)}emplace(t,r,c,d,g,_,v){const S=20*t,T=5*t;return this.uint8[S+0]=r,this.uint8[S+1]=c,this.float32[T+1]=d,this.float32[T+2]=g,this.float32[T+3]=_,this.float32[T+4]=v,t}}lf.prototype.bytesPerElement=20,jt(lf,"StructArrayLayout2ub4f20");class Hr extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=3*t;return this.uint16[g+0]=r,this.uint16[g+1]=c,this.uint16[g+2]=d,t}}Hr.prototype.bytesPerElement=6,jt(Hr,"StructArrayLayout3ui6");class zh extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X,Y,te,ue){const le=this.length;return this.resize(le+1),this.emplace(le,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X,Y,te,ue)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X,Y,te,ue,le){const ge=30*t,ye=15*t,me=60*t;return this.int16[ge+0]=r,this.int16[ge+1]=c,this.int16[ge+2]=d,this.float32[ye+2]=g,this.float32[ye+3]=_,this.uint16[ge+8]=v,this.uint16[ge+9]=S,this.uint32[ye+5]=T,this.uint32[ye+6]=M,this.uint32[ye+7]=A,this.uint16[ge+16]=z,this.uint16[ge+17]=D,this.uint16[ge+18]=k,this.float32[ye+10]=$,this.float32[ye+11]=H,this.uint8[me+48]=j,this.uint8[me+49]=X,this.uint8[me+50]=Y,this.uint32[ye+13]=te,this.int16[ge+28]=ue,this.uint8[me+58]=le,t}}zh.prototype.bytesPerElement=60,jt(zh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class gu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X,Y,te,ue,le,ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X,Y,te,ue,le,ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X,Y,te,ue,le,ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot,Ge){const ct=20*t,et=40*t,ut=80*t;return this.float32[ct+0]=r,this.float32[ct+1]=c,this.int16[et+4]=d,this.int16[et+5]=g,this.int16[et+6]=_,this.int16[et+7]=v,this.int16[et+8]=S,this.int16[et+9]=T,this.int16[et+10]=M,this.int16[et+11]=A,this.int16[et+12]=z,this.uint16[et+13]=D,this.uint16[et+14]=k,this.uint16[et+15]=$,this.uint16[et+16]=H,this.uint16[et+17]=j,this.uint16[et+18]=X,this.uint16[et+19]=Y,this.uint16[et+20]=te,this.uint16[et+21]=ue,this.uint16[et+22]=le,this.uint16[et+23]=ge,this.uint16[et+24]=ye,this.uint16[et+25]=me,this.uint16[et+26]=we,this.uint16[et+27]=Ie,this.uint32[ct+14]=Je,this.float32[ct+15]=qe,this.float32[ct+16]=Xe,this.float32[ct+17]=at,this.float32[ct+18]=nt,this.uint8[ut+76]=ot,this.uint16[et+39]=Ge,t}}gu.prototype.bytesPerElement=80,jt(gu,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class cf extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,d,g,_)}emplace(t,r,c,d,g,_,v){const S=6*t;return this.float32[S+0]=r,this.float32[S+1]=c,this.float32[S+2]=d,this.float32[S+3]=g,this.float32[S+4]=_,this.float32[S+5]=v,t}}cf.prototype.bytesPerElement=24,jt(cf,"StructArrayLayout6f24");class Sc extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,d,g)}emplace(t,r,c,d,g,_){const v=5*t;return this.float32[v+0]=r,this.float32[v+1]=c,this.float32[v+2]=d,this.float32[v+3]=g,this.float32[v+4]=_,t}}Sc.prototype.bytesPerElement=20,jt(Sc,"StructArrayLayout5f20");class uf extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,c,d,g,_,v)}emplace(t,r,c,d,g,_,v,S){const T=7*t;return this.float32[T+0]=r,this.float32[T+1]=c,this.float32[T+2]=d,this.float32[T+3]=g,this.float32[T+4]=_,this.float32[T+5]=v,this.float32[T+6]=S,t}}uf.prototype.bytesPerElement=28,jt(uf,"StructArrayLayout7f28");class Qm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A){const z=this.length;return this.resize(z+1),this.emplace(z,t,r,c,d,g,_,v,S,T,M,A)}emplace(t,r,c,d,g,_,v,S,T,M,A,z){const D=11*t;return this.float32[D+0]=r,this.float32[D+1]=c,this.float32[D+2]=d,this.float32[D+3]=g,this.float32[D+4]=_,this.float32[D+5]=v,this.float32[D+6]=S,this.float32[D+7]=T,this.float32[D+8]=M,this.float32[D+9]=A,this.float32[D+10]=z,t}}Qm.prototype.bytesPerElement=44,jt(Qm,"StructArrayLayout11f44");class Ch extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,c,d,g,_,v,S,T)}emplace(t,r,c,d,g,_,v,S,T,M){const A=9*t;return this.float32[A+0]=r,this.float32[A+1]=c,this.float32[A+2]=d,this.float32[A+3]=g,this.float32[A+4]=_,this.float32[A+5]=v,this.float32[A+6]=S,this.float32[A+7]=T,this.float32[A+8]=M,t}}Ch.prototype.bytesPerElement=36,jt(Ch,"StructArrayLayout9f36");class Tc extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const d=2*t;return this.float32[d+0]=r,this.float32[d+1]=c,t}}Tc.prototype.bytesPerElement=8,jt(Tc,"StructArrayLayout2f8");class eg extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,c,d)}emplace(t,r,c,d,g){const _=6*t;return this.uint32[3*t+0]=r,this.uint16[_+2]=c,this.uint16[_+3]=d,this.uint16[_+4]=g,t}}eg.prototype.bytesPerElement=12,jt(eg,"StructArrayLayout1ul3ui12");class Lh extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Lh.prototype.bytesPerElement=2,jt(Lh,"StructArrayLayout1ui2");class tg extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H){const j=this.length;return this.resize(j+1),this.emplace(j,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j){const X=16*t;return this.float32[X+0]=r,this.float32[X+1]=c,this.float32[X+2]=d,this.float32[X+3]=g,this.float32[X+4]=_,this.float32[X+5]=v,this.float32[X+6]=S,this.float32[X+7]=T,this.float32[X+8]=M,this.float32[X+9]=A,this.float32[X+10]=z,this.float32[X+11]=D,this.float32[X+12]=k,this.float32[X+13]=$,this.float32[X+14]=H,this.float32[X+15]=j,t}}tg.prototype.bytesPerElement=64,jt(tg,"StructArrayLayout16f64");class Rh extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,c,d,g,_,v)}emplace(t,r,c,d,g,_,v,S){const T=10*t,M=5*t;return this.uint16[T+0]=r,this.uint16[T+1]=c,this.uint16[T+2]=d,this.uint16[T+3]=g,this.float32[M+2]=_,this.float32[M+3]=v,this.float32[M+4]=S,t}}Rh.prototype.bytesPerElement=20,jt(Rh,"StructArrayLayout4ui3f20");class ig extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.int16[1*t+0]=r,t}}ig.prototype.bytesPerElement=2,jt(ig,"StructArrayLayout1i2");class hf extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint8[1*t+0]=r,t}}hf.prototype.bytesPerElement=1,jt(hf,"StructArrayLayout1ub1");class Ev extends Hl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ev.prototype.size=40;class Iv extends Ph{get(t){return new Ev(this,t)}}jt(Iv,"CollisionBoxArray");class Mv extends Hl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Mv.prototype.size=60;class Av extends zh{get(t){return new Mv(this,t)}}jt(Av,"PlacedSymbolArray");class Pv extends Hl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Pv.prototype.size=80;class zv extends gu{get(t){return new Pv(this,t)}}jt(zv,"SymbolInstanceArray");class Dh extends yo{getoffsetX(t){return this.float32[1*t+0]}}jt(Dh,"GlyphOffsetArray");class Cv extends Zl{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}jt(Cv,"SymbolLineVertexArray");class Lv extends Hl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Lv.prototype.size=12;class kh extends eg{get(t){return new Lv(this,t)}}jt(kh,"FeatureIndexArray");class Rv extends Os{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}jt(Rv,"FillExtrusionCentroidArray");class ng extends Hl{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}ng.prototype.size=6;class Dv extends dl{get(t){return new ng(this,t)}}jt(Dv,"FillExtrusionWallArray");const kv=Ki([{name:"a_pos",components:2,type:"Int16"}],4),Ov=Ki([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Fv=Ki([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class er{constructor(t=[]){this.segments=t}_prepareSegment(t,r,c,d){let g=this.segments[this.segments.length-1];return t>er.MAX_VERTEX_ARRAY_LENGTH&&vi(`Max vertices per segment is ${er.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>er.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:r,primitiveOffset:c,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}prepareSegment(t,r,c,d){return this._prepareSegment(t,r.length,c.length,d)}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,c,d){return new er([{vertexOffset:t,primitiveOffset:r,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}function Bv(a,t){return 256*(a=de(Math.floor(a),0,255))+de(Math.floor(t),0,255)}er.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt(er,"SegmentVector");const Nv=Ki([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Nw=Ki([{name:"a_pattern_b",components:4,type:"Uint16"}]),Uw=Ki([{name:"a_dash",components:4,type:"Uint16"}]);class Oh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,r,c,d){this.ids.push(Uv(t)),this.positions.push(r,c,d)}eachPosition(t,r){const c=Uv(t);let d=0,g=this.ids.length-1;for(;d<g;){const _=d+g>>1;this.ids[_]>=c?g=_:d=_+1}for(;this.ids[d]===c;)r(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(t,r){const c=new Float64Array(t.ids),d=new Uint32Array(t.positions);return rg(c,d,0,c.length-1),r&&(r.add(c.buffer),r.add(d.buffer)),{ids:c,positions:d}}static deserialize(t){const r=new Oh;let c;r.ids=t.ids,r.positions=t.positions;for(const d of r.ids)d!==c&&r.uniqueIds.push(d),c=d;return r.indexed=!0,r}}function Uv(a){const t=+a;return Number.isSafeInteger(t)?t:Zc(String(a))}function rg(a,t,r,c){for(;r<c;){const d=a[r+c>>1];let g=r-1,_=c+1;for(;;){do g++;while(a[g]<d);do _--;while(a[_]>d);if(g>=_)break;Fh(a,g,_),Fh(t,3*g,3*_),Fh(t,3*g+1,3*_+1),Fh(t,3*g+2,3*_+2)}_-r<c-_?(rg(a,t,r,_),r=_+1):(rg(a,t,_+1,c),c=_)}}function Fh(a,t,r){const c=a[t];a[t]=a[r],a[r]=c}jt(Oh,"FeaturePositionMap");class ga{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,r),this.initialized=!0),!!this.location}set(t,r,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Fs extends ga{constructor(t){super(t),this.current=0}set(t,r,c){this.fetchUniformLocation(t,r)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class zr extends ga{constructor(t){super(t),this.current=0}set(t,r,c){this.fetchUniformLocation(t,r)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Bs extends ga{constructor(t){super(t),this.current=[0,0]}set(t,r,c){this.fetchUniformLocation(t,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class Bh extends ga{constructor(t){super(t),this.current=[0,0,0]}set(t,r,c){this.fetchUniformLocation(t,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class df extends ga{constructor(t){super(t),this.current=[0,0,0,0]}set(t,r,c){this.fetchUniformLocation(t,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class $v extends ga{constructor(t){super(t),this.current=bn.transparent.toPremultipliedRenderColor(null)}set(t,r,c){this.fetchUniformLocation(t,r)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const $w=new Float32Array(16);class _u extends ga{constructor(t){super(t),this.current=$w}set(t,r,c){if(this.fetchUniformLocation(t,r)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let d=1;d<16;d++)if(c[d]!==this.current[d]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const E2=new Float32Array(9),p=new Float32Array(4);class n extends ga{constructor(t){super(t),this.current=p}set(t,r,c){if(this.fetchUniformLocation(t,r)){for(let d=0;d<4;d++)if(c[d]!==this.current[d]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function u(a){return[Bv(255*a.r,255*a.g),Bv(255*a.b,255*a.a)]}function m(a,t,r,c,d,g,_,v){return!!a&&(a.kind==="composite"||a.kind==="source"?a.evaluate(new An(0,{brightness:g,worldview:v}),t,r,d,c,_)==="none":a.value==="none")}class y{constructor(t,r,c,d){this.value=t,this.uniformNames=r.map(g=>`u_${g}`),this.type=c,this.context=d}setUniform(t,r,c,d,g){const _=d.constantOr(this.value);r.set(t,g,_ instanceof bn?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(t,r){return this.type==="color"?new $v(t):new zr(t)}}class b{constructor(t,r){this.uniformNames=r.map(c=>`u_${c}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(t,r){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br),this.patternTransition=r?r.tl.concat(r.br):this.pattern}setUniform(t,r,c,d,g){let _=null;g!=="u_pattern"&&g!=="u_dash"||(_=this.pattern),g==="u_pattern_b"&&(_=this.patternTransition),g==="u_pixel_ratio"&&(_=this.pixelRatio),_&&r.set(t,g,_)}getBinding(t,r){return r==="u_pattern"||r==="u_pattern_b"||r==="u_dash"?new df(t):new zr(t)}}class w{constructor(t,r,c,d){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,r,c,d,g,_,v,S){const T=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new An(0,{brightness:_,worldview:S}),r,{},g,d,v):this.expression.kind==="constant"&&this.expression.value,A=m(this.lutExpression,r,{},d,g,_,v,S);this.paintVertexArray.resize(t),this._setPaintValue(T,t,M,A?null:this.context.lut)}updatePaintArray(t,r,c,d,g,_,v,S){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:S},c,d,void 0,g):this.expression.kind==="constant"&&this.expression.value,M=m(this.lutExpression,c,d,g,void 0,v,void 0,S);this._setPaintValue(t,r,T,M?null:this.context.lut)}_setPaintValue(t,r,c,d){if(this.type==="color"){const g=u(c.toPremultipliedRenderColor(d));for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,g[0],g[1])}else{for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class E{constructor(t,r,c,d,g,_){this.expression=t,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=d,this.context=g,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,r,c,d,g,_,v,S){const T=this.expression.evaluate(new An(this.context.zoom,{brightness:_,worldview:S}),r,{},g,d,v),M=this.expression.evaluate(new An(this.context.zoom+1,{brightness:_,worldview:S}),r,{},g,d,v),A=m(this.lutExpression,r,{},d,g,_,v,S),z=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(z,t,T,M,A?null:this.context.lut)}updatePaintArray(t,r,c,d,g,_,v,S){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:S},c,d,void 0,g),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:S},c,d,void 0,g),A=m(this.lutExpression,c,d,g,void 0,v,void 0,S);this._setPaintValue(t,r,T,M,A?null:this.context.lut)}_setPaintValue(t,r,c,d,g){if(this.type==="color"){const _=u(c.toPremultipliedRenderColor(g)),v=u(d.toPremultipliedRenderColor(g));for(let S=t;S<r;S++)this.paintVertexArray.emplace(S,_[0],_[1],v[0],v[1])}else{for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r,c,d,g){const _=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=de(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);r.set(t,g,v)}getBinding(t,r){return new zr(t)}}class I{constructor(t,r,c,d,g){this.expression=t,this.layerId=g,this.paintVertexAttributes=(c==="array"?Uw:Nv).members;for(let _=0;_<r.length;++_);this.paintVertexArray=new d,this.paintTransitionVertexArray=new pu}populatePaintArray(t,r,c,d){const g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(g,t,r.patterns&&r.patterns[this.layerId],c)}updatePaintArray(t,r,c,d,g,_,v){this._setPaintValues(t,r,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(t,r,c,d){if(!d||!c)return;const g=d[c[0]],_=d[c[1]];if(g){if(g){const{tl:v,br:S,pixelRatio:T}=g;for(let M=t;M<r;M++)this.paintVertexArray.emplace(M,v[0],v[1],S[0],S[1],T)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:S}=_;for(let T=t;T<r;T++)this.paintTransitionVertexArray.emplace(T,v[0],v[1],S[0],S[1])}}}upload(t){const r=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,r)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=t.createVertexBuffer(this.paintTransitionVertexArray,Nw.members,r))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class L{constructor(t,r,c=()=>!0){this.binders={},this._buffers=[],this.context=r;const d=[];for(const g in t.paint._values){const _=t.paint.get(g);if(g.endsWith("-use-theme")||!c(g)||!(_ instanceof bc&&Zd(_.property.specification)))continue;const v=B(g,t.type),S=_.value,T=_.property.specification.type,M=!!_.property.useIntegerZoom,A=g==="line-dasharray"||g.endsWith("pattern"),z=t.paint.get(`${g}-use-theme`),D=g==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||z&&z.value.kind!=="constant";if(S.kind!=="constant"||D)if(S.kind==="source"||D||A){const k=G(g,T,"source");this.binders[g]=A?new I(S,v,T,k,t.id):new w(S,v,T,k),d.push(`/a_${g}`)}else{const k=G(g,T,"composite");this.binders[g]=new E(S,v,T,M,r,k),d.push(`/z_${g}`)}else this.binders[g]=A?new b(S.value,v):new y(S.value,v,T,r),d.push(`/u_${g}`);z&&(this.binders[g].lutExpression=z.value)}this.cacheKey=d.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof w||r instanceof E?r.maxValue:0}populatePaintArrays(t,r,c,d,g,_,v,S){for(const T in this.binders){const M=this.binders[T];M.context=this.context,(M instanceof w||M instanceof E||M instanceof I)&&M.populatePaintArray(t,r,c,d,g,_,v,S)}}setConstantPatternPositions(t,r){for(const c in this.binders){const d=this.binders[c];d instanceof b&&d.setConstantPatternPositions(t,r)}}getPatternTransitionVertexBuffer(t){const r=this.binders[t];return r instanceof I?r.paintTransitionVertexBuffer:null}updatePaintArrays(t,r,c,d,g,_,v,S,T,M){let A=!1;const z=Object.keys(t),D=z.length!==0&&!S,k=D?z:r.uniqueIds;this.context.lut=g.lut;for(const $ in this.binders){const H=this.binders[$];if(H.context=this.context,(H instanceof w||H instanceof E||H instanceof I)&&H.expression&&H.expression.kind&&H.expression.kind!=="constant"&&(H.expression.isStateDependent===!0||H.expression.isLightConstant===!1)){const j=g.paint.get($);H.expression=j.value;for(const X of k){const Y=t[X.toString()];r.eachPosition(X,(te,ue,le)=>{const ge=d.feature(te);H.updatePaintArray(ue,le,ge,Y,_,v,T,M)})}if(!D)for(const X of c.uniqueIds){const Y=t[X.toString()];c.eachPosition(X,(te,ue,le)=>{const ge=d.feature(te);H.updatePaintArray(ue,le,ge,Y,_,v,T,M)})}A=!0}}return A}defines(){const t=[];for(const r in this.binders){const c=this.binders[r];(c instanceof y||c instanceof b)&&t.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const r=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof y||d instanceof b||d instanceof E)for(const g of d.uniformNames)r.push({name:g,property:c,binding:d.getBinding(t,g)})}return r}setUniforms(t,r,c,d,g){for(const{name:_,property:v,binding:S}of c)this.binders[v].setUniform(t,S,g,d.get(v),_)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const r=this.binders[t];(r instanceof w||r instanceof E||r instanceof I)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer),r instanceof I&&r.paintTransitionVertexBuffer&&this._buffers.push(r.paintTransitionVertexBuffer)}}upload(t){for(const r in this.binders){const c=this.binders[r];(c instanceof w||c instanceof E||c instanceof I)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof w||r instanceof E||r instanceof I)&&r.destroy()}}}class R{constructor(t,r,c=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new L(d,r,c);this.needsUpload=!1,this._featureMap=new Oh,this._featureMapWithoutIds=new Oh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,r,c,d,g,_,v,S,T){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(t,r,d,g,_,v,S,T);r.id!==void 0?this._featureMap.add(r.id,c,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,c,d,g,_,v,S){for(const T of c)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,r,T,d,g,_,v||0,S)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const N={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function B(a,t){return N[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}const U={"line-pattern":{source:Oa,composite:Oa},"fill-pattern":{source:Oa,composite:Oa},"fill-extrusion-pattern":{source:Oa,composite:Oa},"line-dasharray":{source:pu,composite:pu}},W={color:{source:Tc,composite:Wl},number:{source:yo,composite:Tc}};function G(a,t,r){const c=U[a];return c&&c[r]||W[t][r]}jt(y,"ConstantBinder"),jt(b,"PatternConstantBinder"),jt(w,"SourceExpressionBinder"),jt(I,"PatternCompositeBinder"),jt(E,"CompositeExpressionBinder"),jt(L,"ProgramConfiguration",{omit:["_buffers"]}),jt(R,"ProgramConfigurationSet");const J=It/Math.PI/2,K=64,oe=[K,32,16],re=-J,ne=J;function be(a,t,r,c=J){return r=ii(r),[a*Math.sin(r)*c,-t*c,a*Math.cos(r)*c]}function _e(a,t,r){return be(Math.cos(ii(a)),Math.sin(ii(a)),t,r)}const ve=63710088e-1,pe=2*Math.PI*ve;class he{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new he(Oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,c=this.lat*r,d=t.lat*r,g=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((t.lng-this.lng)*r);return ve*Math.acos(Math.min(g,1))}toBounds(t=0){const r=360*t/40075017,c=r/Math.cos(Math.PI/180*this.lat);return new Se({lng:this.lng-c,lat:this.lat-r},{lng:this.lng+c,lat:this.lat+r})}toEcef(t){return _e(this.lat,this.lng,J+t*J/ve)}static convert(t){if(t instanceof he)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new he(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new he(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Se{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof he?new he(t.lng,t.lat):he.convert(t),this}setSouthWest(t){return this._sw=t instanceof he?new he(t.lng,t.lat):he.convert(t),this}extend(t){const r=this._sw,c=this._ne;let d,g;if(t instanceof he)d=t,g=t;else{if(!(t instanceof Se))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Se.convert(t)):this.extend(he.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(he.convert(t)):this;if(d=t._sw,g=t._ne,!d||!g)return this}return r||c?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new he(d.lng,d.lat),this._ne=new he(g.lng,g.lat)),this}getCenter(){return new he((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new he(this.getWest(),this.getNorth())}getSouthEast(){return new he(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:c}=he.convert(t);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(t){if(t)return t instanceof Se?t:new Se(t)}}function ze(a){return pe*Math.cos(a*Math.PI/180)}function Re(a){return(180+a)/360}function Ze(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function je(a,t){return a/ze(t)}function it(a){return 360*a-180}function dt(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Fe(a,t){return a*ze(dt(t))}const Te=85.051129;function Ke(a){return Math.cos(ii(de(a,-85.051129,Te)))}function We(a,t){const r=de(t,0,25.5),c=Math.pow(2,r);return Ke(a)*pe/(512*c)}function pt(a){return 1/Math.cos(a*Math.PI/180)}function vt(a,t=0){const r=Math.exp(Math.PI*(1-(a.y+t/It)/(1<<a.z)*2));return 80150034*r/(r*r+1)/It/(1<<a.z)}class Pt{constructor(t,r,c=0){this.x=+t,this.y=+r,this.z=+c}static fromLngLat(t,r=0){const c=he.convert(t);return new Pt(Re(c.lng),Ze(c.lat),je(r,c.lat))}toLngLat(){return new he(it(this.x),dt(this.y))}toAltitude(){return Fe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/pe*pt(dt(this.y))}}function xt(a,t,r,c,d,g,_,v,S){const T=(t+c)/2,M=(r+d)/2,A=new Ae(T,M);v(A),(function(z,D,k,$,H,j){const X=k-H,Y=$-j;return Math.abs(($-D)*X-(k-z)*Y)/Math.hypot(X,Y)})(A.x,A.y,g.x,g.y,_.x,_.y)>=S?(xt(a,t,r,T,M,g,A,v,S),xt(a,T,M,c,d,A,_,v,S)):a.push(_)}function St(a,t,r){let c=a[0],d=c.x,g=c.y;t(c);const _=[c];for(let v=1;v<a.length;v++){const S=a[v],{x:T,y:M}=S;t(S),xt(_,d,g,T,M,c,S,t,r),d=T,g=M,c=S}return _}function Xt(a,t,r,c){if(c(t,r)){const d=t.add(r)._mult(.5);Xt(a,t,d,c),Xt(a,d,r,c)}else a.push(r)}function Ht(a,t){let r=a[0];const c=[r];for(let d=1;d<a.length;d++){const g=a[d];Xt(c,r,g,t),r=g}return c}const Rt=Math.pow(2,14)-1,Gt=-Rt-1;function si(a,t){const r=Math.round(a.x*t),c=Math.round(a.y*t);return a.x=de(r,Gt,Rt),a.y=de(c,Gt,Rt),(r<a.x||r>a.x+1||c<a.y||c>a.y+1)&&vi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function pi(a,t,r){const c=a.loadGeometry(),d=a.extent,g=It/d;if(t&&r&&r.projection.isReprojectedInTileSpace){const _=1<<t.z,{scale:v,x:S,y:T,projection:M}=r,A=z=>{const D=it((t.x+z.x/d)/_),k=dt((t.y+z.y/d)/_),$=M.project(D,k);z.x=($.x*v-S)*d,z.y=($.y*v-T)*d};for(let z=0;z<c.length;z++)if(a.type!==1)c[z]=St(c[z],A,1);else{const D=[];for(const k of c[z])k.x<0||k.x>=d||k.y<0||k.y>=d||(A(k),D.push(k));c[z]=D}}for(const _ of c)for(const v of _)si(v,g);return c}function Ni(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?pi(a):[]}}class en{constructor(t,r,c,d,g){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=g,t.readFields(Ei,this,r)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos,c=[];let d,g=1,_=0,v=0,S=0;for(;t.pos<r;){if(_<=0){const T=t.readVarint();g=7&T,_=T>>3}if(_--,g===1||g===2)v+=t.readSVarint(),S+=t.readSVarint(),g===1&&(d&&c.push(d),d=[]),d&&d.push(new Ae(v,S));else{if(g!==7)throw new Error(`unknown command ${g}`);d&&d.push(d[0].clone())}}return d&&c.push(d),c}bbox(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos;let c=1,d=0,g=0,_=0,v=1/0,S=-1/0,T=1/0,M=-1/0;for(;t.pos<r;){if(d<=0){const A=t.readVarint();c=7&A,d=A>>3}if(d--,c===1||c===2)g+=t.readSVarint(),_+=t.readSVarint(),g<v&&(v=g),g>S&&(S=g),_<T&&(T=_),_>M&&(M=_);else if(c!==7)throw new Error(`unknown command ${c}`)}return[v,T,S,M]}toGeoJSON(t,r,c){const d=this.extent*Math.pow(2,c),g=this.extent*t,_=this.extent*r,v=this.loadGeometry();function S(z){return[360*(z.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(z.y+_)/d)*Math.PI))-90]}function T(z){return z.map(S)}let M;if(this.type===1){const z=[];for(const k of v)z.push(k[0]);const D=T(z);M=z.length===1?{type:"Point",coordinates:D[0]}:{type:"MultiPoint",coordinates:D}}else if(this.type===2){const z=v.map(T);M=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z}}else{if(this.type!==3)throw new Error("unknown feature type");{const z=(function(k){const $=k.length;if($<=1)return[k];const H=[];let j,X;for(let Y=0;Y<$;Y++){const te=ln(k[Y]);te!==0&&(X===void 0&&(X=te<0),X===te<0?(j&&H.push(j),j=[k[Y]]):j&&j.push(k[Y]))}return j&&H.push(j),H})(v),D=[];for(const k of z)D.push(k.map(T));M=D.length===1?{type:"Polygon",coordinates:D[0]}:{type:"MultiPolygon",coordinates:D}}}const A={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(A.id=this.id),A}}function Ei(a,t,r){a===1?t.id=r.readVarint():a===2?(function(c,d){const g=c.readVarint()+c.pos;for(;c.pos<g;){const _=d._keys[c.readVarint()],v=d._values[c.readVarint()];d.properties[_]=v}})(r,t):a===3?t.type=r.readVarint():a===4&&(t._geometry=r.pos)}function ln(a){let t=0;for(let r,c,d=0,g=a.length,_=g-1;d<g;_=d++)r=a[d],c=a[_],t+=(c.x-r.x)*(r.y+c.y);return t}en.types=["Unknown","Point","LineString","Polygon"];class Ri{constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(En,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const r=this._pbf.readVarint()+this._pbf.pos;return new en(this._pbf,r,this.extent,this._keys,this._values)}}function En(a,t,r){a===15?t.version=r.readVarint():a===1?t.name=r.readString():a===5?t.extent=r.readVarint():a===2?t._features.push(r.pos):a===3?t._keys.push(r.readString()):a===4&&t._values.push((function(c){let d=null;const g=c.readVarint()+c.pos;for(;c.pos<g;){const _=c.readVarint()>>3;d=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(r))}class wn{constructor(t,r){this.layers=t.readFields(Mn,{},r)}}function Mn(a,t,r){if(a===3){const c=new Ri(r,r.readVarint()+r.pos);c.length&&(t[c.name]=c)}}const tn="3d_elevation_id",Fi="level";class gn{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(t,r){return this._valid&&t(r(this._geometry)),this}require(t,r,c){return this.get(t,!0,r,c)}optional(t,r,c){return this.get(t,!1,r,c)}success(){return this._valid}get(t,r,c,d){const g=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?c(d?d(g):g):r&&(this._valid=!1),this}}class tr{constructor(t,r){this.featureFunc=t,this.vertexFunc=r}parseFeature(t,r,c){return this.featureFunc(t,r,c)}parseVertex(t,r,c){return this.vertexFunc(t,r,c)}}const ir=new tr((a,t,r)=>a.reset(t).require(tn,c=>{r.id=c}).optional("fixed_height_relative",c=>{r.constantHeight=c},Yi.decodeRelativeHeight).geometry(c=>{r.bounds=c},hh).success(),(a,t,r)=>a.reset(t).require(tn,c=>{r.id=c}).require("elevation_idx",c=>{r.idx=c}).require("extent",c=>{r.extent=c}).require("height_relative",c=>{r.height=c},Yi.decodeRelativeHeight).geometry(c=>{r.position=c},Yi.getPoint).success()),_n=new tr((a,t,r)=>a.reset(t).require(tn,c=>{r.id=c}).optional("fixed_height",c=>{r.constantHeight=c},Yi.decodeMetricHeight).geometry(c=>{r.bounds=c},hh).success(),(a,t,r)=>a.reset(t).require(tn,c=>{r.id=c}).require("elevation_idx",c=>{r.idx=c}).require("extent",c=>{r.extent=c}).require("height",c=>{r.height=c},Yi.decodeMetricHeight).geometry(c=>{r.position=c},Yi.getPoint).success());class Yi{static getPoint(t){return Ks(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static getVersionSchema(t){return t?t==="1.0.1"?_n:void 0:ir}static parse(t){const r=[],c=[],d=t.length,g=new gn;for(let _=0;_<d;_++){const v=t.feature(_),S=v.properties.version,T=Yi.getVersionSchema(S);if(T===void 0){vi(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const M=v.properties.type;if(!M)continue;const A=en.types[v.type];if(A==="Point"&&M==="curve_point"){const z={};T.parseVertex(g,v,z)&&r.push(z)}else if(A==="Polygon"&&M==="curve_meta"){const z={};T.parseFeature(g,v,z)&&c.push(z)}}return{vertices:r,features:c}}}class Bi{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,c){const d=$n(r,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1])/d;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,!0}}class Nn{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,c){const d=Ii(r,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/d;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(t,r,c){if((function(D,k){var $=D[0],H=D[1],j=D[2],X=k[0],Y=k[1],te=k[2];return Math.abs($-X)<=P*Math.max(1,Math.abs($),Math.abs(X))&&Math.abs(H-Y)<=P*Math.max(1,Math.abs(H),Math.abs(Y))&&Math.abs(j-te)<=P*Math.max(1,Math.abs(j),Math.abs(te))})(this.pos,t)||r===0)return c[0]=c[1]=c[2]=0,!1;const[d,g,_]=this.dir,v=this.pos[0]-t[0],S=this.pos[1]-t[1],T=this.pos[2]-t[2],M=d*d+g*g+_*_,A=2*(v*d+S*g+T*_),z=A*A-4*M*(v*v+S*S+T*T-r*r);if(z<0){const D=Math.max(-A/2,0),k=v+d*D,$=S+g*D,H=T+_*D,j=Math.hypot(k,$,H);return c[0]=k*r/j,c[1]=$*r/j,c[2]=H*r/j,!1}{const D=(-A-Math.sqrt(z))/(2*M);if(D<0){const k=Math.hypot(v,S,T);return c[0]=v*r/k,c[1]=S*r/k,c[2]=T*r/k,!1}return c[0]=v+d*D,c[1]=S+g*D,c[2]=T+_*D,!0}}}class hr{constructor(t,r,c,d,g){this.TL=t,this.TR=r,this.BR=c,this.BL=d,this.horizon=g}static fromInvProjectionMatrix(t,r,c){const d=[-1,1,1],g=[1,1,1],_=[1,-1,1],v=[-1,-1,1],S=qt(d,d,t),T=qt(g,g,t),M=qt(_,_,t),A=qt(v,v,t);return new hr(S,T,M,A,r/c)}}function jn(a,t,r){let c=1/0,d=-1/0;const g=[];for(const _ of a){Le(g,_,t);const v=Ii(g,r);c=Math.min(c,v),d=Math.max(d,v)}return[c,d]}function Wn(a,t){let r=!0;for(let c=0;c<a.planes.length;c++){const d=a.planes[c];let g=0;for(let _=0;_<t.length;_++)g+=+(Ii(d,t[_])+d[3]>=0);if(g===0)return 0;g!==t.length&&(r=!1)}return r?2:1}function jo(a,t){for(const r of a.projections){const c=jn(t,a.points[0],r.axis);if(r.projection[1]<c[0]||r.projection[0]>c[1])return 0}return 1}function as(a,t){let r=0;const c=[0,0,0,0];for(let d=0;d<a.length;d++)c[0]=a[d][0],c[1]=a[d][1],c[2]=a[d][2],c[3]=1,_i(c,t)>=0&&r++;return r}class ro{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=yn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Le([],this.points[2],this.points[3]),Le([],this.points[0],this.points[3]),Le([],this.points[4],this.points[0]),Le([],this.points[5],this.points[1]),Le([],this.points[6],this.points[2]),Le([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const d=[0,-c[2],c[1]],g=[c[2],0,-c[0]];this.projections.push({axis:d,projection:jn(this.points,this.points[0],d)}),this.projections.push({axis:g,projection:jn(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(t,r,c,d){const g=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const M=Kt([],T,t),A=1/M[3]/r*g;return(z=M)[0]=(D=M)[0]*(k=[A,A,d?1/M[3]:A,A])[0],z[1]=D[1]*k[1],z[2]=D[2]*k[2],z[3]=D[3]*k[3],z;var z,D,k}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const M=Di([],hn([],Le([],_[T[0]],_[T[1]]),Le([],_[T[2]],_[T[1]]))),A=-Ii(M,_[T[1]]);return M.concat(A)}),S=[];for(let T=0;T<_.length;T++)S.push([_[T][0],_[T][1],_[T][2]]);return new ro(S,v)}intersectsPrecise(t,r,c){for(let d=0;d<r.length;d++)if(!as(t,r[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!as(t,this.planes[d]))return 0;for(const d of c)for(const g of this.frustumEdges){const _=hn([],d,g),v=_t(_);if(v===0)continue;wi(_,_,1/v);const S=jn(this.points,this.points[0],_),T=jn(t,this.points[0],_);if(S[0]>T[1]||T[0]>S[1])return 0}return 1}containsPoint(t){for(const r of this.planes){const c=r[3];if(Ii([r[0],r[1],r[2]],t)+c<0)return!1}return!0}}class yn{static fromPoints(t){const r=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const d of t)Ai(r,r,d),dn(c,c,d);return new yn(r,c)}static fromTileIdAndHeight(t,r,c){const d=1<<t.canonical.z,g=t.canonical.x,_=t.canonical.y;return new yn([g/d,_/d,r],[(g+1)/d,(_+1)/d,c])}static applyTransform(t,r){const c=t.getCorners();for(let d=0;d<c.length;++d)qt(c[d],c[d],r);return yn.fromPoints(c)}static applyTransformFast(t,r){const c=[r[12],r[13],r[14]],d=[...c];for(let g=0;g<3;g++)for(let _=0;_<3;_++){const v=r[4*_+g],S=v*t.min[_],T=v*t.max[_];c[g]+=Math.min(S,T),d[g]+=Math.max(S,T)}return new yn(c,d)}static projectAabbCorners(t,r){const c=t.getCorners();for(let d=0;d<c.length;++d)qt(c[d],c[d],r);return c}constructor(t,r){this.min=t,this.max=r,this.center=wi([],ei([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],c=ht(this.min),d=ht(this.max);for(let g=0;g<r.length;g++)c[g]=r[g]?this.min[g]:this.center[g],d[g]=r[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new yn(c,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Wn(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Wn(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,r){return r||this.intersects(t)?jo(t,this.getCorners()):0}intersectsPreciseFlat(t,r){return r||this.intersectsFlat(t)?jo(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let r=0;r<3;++r)if(this.min[r]>t.max[r]||t.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t.min[r]),this.max[r]=Math.max(this.max[r],t.max[r])}encapsulatePoint(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t[r]),this.max[r]=Math.max(this.max[r],t[r])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}jt(yn,"Aabb");class bs{constructor(t,r){this.feature=t,this.metersToTile=r,this.index=0}get(){const t=this.feature.vertices[this.index],r=this.feature.vertexProps[this.index].dir,c=r[1],d=-r[0],g=(t.extent+1)*this.metersToTile;return[new Ae(Math.trunc(t.position[0]+c*g),Math.trunc(t.position[1]+d*g)),new Ae(Math.trunc(t.position[0]-c*g),Math.trunc(t.position[1]-d*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Eo{constructor(t,r,c,d,g,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[mo(),mo(),mo(),mo(),mo(),mo(),mo()],this.id=t,this.heightRange={min:c,max:c},this.safeArea=r,this.constantHeight=c,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=g,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((S=this.vertices[v.a].position)[0]===(T=this.vertices[v.b].position)[0]&&S[1]===T[1]);var S,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:Ks(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const S=this.vertices[v.a].position,T=this.vertices[v.b].position,M=ha(mo(),T,S),A=da(M),z=_s(mo(),M,1/A);this.edgeProps.push({vec:M,dir:z,len:A});const D=this.vertexProps[v.a].dir,k=this.vertexProps[v.b].dir;Qs(D,D,z),Qs(k,k,z)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||il(v.dir,v.dir);this.tessellate(_)}}pointElevation(t){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(t);if(r==null)return 0;const[c,d]=r;return di(this.vertices[this.edges[c].a].height,this.vertices[this.edges[c].b].height,d)}computeSlopeNormal(t,r){const c=this.getClosestEdge(t);if(!c)return yt(0,0,1);const d=c[0],g=this.edges[d],_=this.edgeProps[d].vec,v=yt(_[0],_[1],(this.vertices[g.b].height-this.vertices[g.a].height)*r),S=yt(v[1],-v[0],0);hn(S,S,v);const T=_t(S);return T>0?wi(S,S,1/T):Nt(S,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(this.edges.length===0)return;let r=0,c=Number.POSITIVE_INFINITY,d=0;const[g,_,v,S,T,M,A]=this._tmpVec2;ua(A,t.x,t.y);const z=new Bi(A,null);for(let D=0;D<this.edges.length;D++){const k=this.edges[D],$=this.edgeProps[D].dir;z.dir=$;const H=this.vertices[k.a].position,j=this.vertices[k.b].position,X=z.intersectsPlane(H,this.vertexProps[k.a].dir,g),Y=z.intersectsPlane(j,this.vertexProps[k.b].dir,_);if(!X||!Y)continue;ha(v,_,g),ha(S,A,g);const te=$n(v,v),ue=te>0?$n(S,v)/te:0,le=de(ue,0,1),ge=Math.abs((ue-le)*this.edgeProps[D].len);ha(T,A,H),ua(M,$[1],-$[0]);const ye=ge+Math.abs($n(T,M));ye<c&&(r=D,c=ye,d=le)}return[r,d]}tessellate(t){const r=Qe(),c=Qe(),d=Qe(),g=Qe();for(let _=this.edges.length-1;_>=0;--_){const v=this.edges[_].a,S=this.edges[_].b,{position:T,height:M,extent:A}=this.vertices[v],{position:z,height:D,extent:k}=this.vertices[S],$=this.vertexProps[v].dir,H=this.vertexProps[S].dir;if(Nt(r,T[0]/t,T[1]/t,M),Nt(c,z[0]/t,z[1]/t,D),Nt(d,$[1],-$[0],0),wi(d,d,A),Nt(g,H[1],-H[0],0),wi(g,g,k),this.distSqLines(yt(r[0]+.5*d[0],r[1]+.5*d[1],r[2]+.5*d[2]),yt(c[0]-.5*g[0],c[1]-.5*g[1],c[2]-.5*g[2]),yt(r[0]-.5*d[0],r[1]-.5*d[1],r[2]-.5*d[2]),yt(c[0]+.5*g[0],c[1]+.5*g[1],c[2]+.5*g[2]))<=.0025000000000000005)continue;const j=this.vertices.length,X=Qs(mo(),T,z);this.vertices.push({position:_s(X,X,.5),height:.5*(M+D),extent:.5*(A+k)});const Y=Qs(mo(),$,H);this.vertexProps.push({dir:il(Y,Y)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:v,b:j}),this.edges.push({a:j,b:S});const te=ha(mo(),this.vertices[j].position,T),ue=da(te),le={vec:te,dir:_s(mo(),te,1/ue),len:ue};this.edgeProps.push(le),this.edgeProps.push(le)}}distSqLines(t,r,c,d){const g=mi(Qe(),r,t),_=mi(Qe(),d,c),v=mi(Qe(),t,c),S=Ii(g,g),T=Ii(g,_),M=Ii(g,v),A=Ii(_,_),z=Ii(_,v),D=S*A-T*T;if(D===0)return Zt(ti(g,c,d,Ii(v,_)/Ii(_,_)),t);const k=(S*z-T*M)/D;return Zt(ti(g,t,r,(T*z-M*A)/D),ti(_,c,d,k))}}class Go{static parseFrom(t,r){const c=Yi.parse(t);if(!c)return[];let{vertices:d,features:g}=c;const _=1/vt(r);g.sort((M,A)=>M.id-A.id),d.sort((M,A)=>M.id-A.id||M.idx-A.idx),d=d.filter((M,A,z)=>A===z.findIndex(D=>D.id===M.id&&D.idx===M.idx));const v=new Array;let S=0;const T=d.length;for(const M of g){if(M.constantHeight){v.push(new Eo(M.id,M.bounds,M.constantHeight));continue}for(;S!==T&&d[S].id<M.id;)S++;if(S===T||d[S].id!==M.id)continue;const A=new Array,z=new Array,D=S;for(;S!==T&&d[S].id===M.id;){const k=d[S];if(A.push({position:k.position,height:k.height,extent:k.extent}),S!==D&&d[S-1].idx===k.idx-1){const $=S-D;z.push({a:$-1,b:$})}S++}v.push(new Eo(M.id,M.bounds,void 0,A,z,_))}return v}static getElevationFeature(t,r){if(!r)return;const c=+t.properties[tn];return Number.isNaN(c)?void 0:r.find(d=>d.id===c)}}class oa{constructor(t,r){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(r)||(this.zScale=Math.pow(2,r.z-t.z),this.xOffset=(t.x*this.zScale-r.x)*It,this.yOffset=(t.y*this.zScale-r.y)*It)}constantElevation(t,r){if(t.constantHeight!=null)return this.computeBiasedHeight(t.constantHeight,r)}pointElevation(t,r,c){const d=this.constantElevation(r,c);return d??(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(t),c))}computeBiasedHeight(t,r){return r<=0?t:t+r*Me(0,r,t>=0?t:Math.abs(.5*t))}}jt(Eo,"ElevationFeature");class Ho{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Zl,this.indexArray=new Hr,this.segments=new er,this.programConfigurations=new R(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new yo),this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){const g=this.layers[0],_=[];let v=null;g.type==="circle"&&(v=g.layout.get("circle-sort-key"));for(const{feature:T,id:M,index:A,sourceLayerIndex:z}of t){const D=this.layers[0]._featureFilter.needGeometry,k=Ni(T,D);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),k,c))continue;const $=v?v.evaluate(k,{},c):void 0,H={id:M,properties:T.properties,type:T.type,sourceLayerIndex:z,index:A,geometry:D?k.geometry:pi(T,c,d),patterns:{},sortKey:$};_.push(H)}v&&_.sort((T,M)=>T.sortKey-M.sortKey);let S=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new mu,S=d.projection);for(const T of _){const{geometry:M,index:A,sourceLayerIndex:z}=T,D=t[A].feature;this.addFeature(T,M,A,r.availableImages,c,S,r.brightness,r.elevationFeatures),r.featureIndex.insert(D,M,A,z,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(t,r,c,d,g,_,v){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kv.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Fv.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,Ov.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(t,r,c,d,g,_,v,S){let T;this.elevationMode!=="none"&&(T=Go.getElevationFeature(t,S));for(const M of r)for(const A of M){const z=A.x,D=A.y;if(z<0||z>=It||D<0||D>=It)continue;if(_){const H=_.projectTilePoint(z,D,g),j=_.upVector(g,z,D);this.addGlobeExtVertex(H,j),this.addGlobeExtVertex(H,j),this.addGlobeExtVertex(H,j),this.addGlobeExtVertex(H,j)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),$=k.vertexLength;if(this.addCircleVertex(z,D,-1,-1),this.addCircleVertex(z,D,1,-1),this.addCircleVertex(z,D,1,1),this.addCircleVertex(z,D,-1,1),this.elevationMode!=="none"){const H=T?T.pointElevation(new Ae(z,D)):0;this.hasElevation=this.hasElevation||H!==0;for(let j=0;j<4;j++)this.elevatedLayoutVertexArray.emplaceBack(H)}this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+2,$+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},d,g,v,void 0,this.worldview)}addCircleVertex(t,r,c,d){this.layoutVertexArray.emplaceBack(2*t+(c+1)/2,2*r+(d+1)/2)}addGlobeExtVertex(t,r){this.globeExtVertexArray.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}}function rr(a,t){for(let r=0;r<a.length;r++)if(Ss(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(Ss(a,t[r]))return!0;return!!Io(a,t)}function Ir(a,t,r){return!!Ss(a,t)||!!Fa(t,a,r)}function Gn(a,t){if(a.length===1)return vu(t,a[0]);for(let r=0;r<t.length;r++){const c=t[r];for(let d=0;d<c.length;d++)if(Ss(a,c[d]))return!0}for(let r=0;r<a.length;r++)if(vu(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(Io(a,t[r]))return!0;return!1}function Cr(a,t,r){if(a.length>1){if(Io(a,t))return!0;for(let c=0;c<t.length;c++)if(Fa(t[c],a,r))return!0}for(let c=0;c<a.length;c++)if(Fa(a[c],t,r))return!0;return!1}function Io(a,t){if(a.length===0||t.length===0)return!1;for(let r=0;r<a.length-1;r++){const c=a[r],d=a[r+1];for(let g=0;g<t.length-1;g++)if(br(c,d,t[g],t[g+1]))return!0}return!1}function br(a,t,r,c){return Vn(a,r,c)!==Vn(t,r,c)&&Vn(a,t,r)!==Vn(a,t,c)}function ws(a,t,r){return(a.x-r.x)*(t.y-r.y)-(a.y-r.y)*(t.x-r.x)}function Nh(a,t,r,c){const d=ws(a,t,c),g=ws(a,t,r);if(Math.sign(d)===Math.sign(g))return;const _=ws(r,c,a),v=_+g-d;return Math.sign(_)!==Math.sign(v)?[_/(_-v),g/(g-d)]:void 0}function Fa(a,t,r){const c=r*r;if(t.length===1)return a.distSqr(t[0])<c;for(let d=1;d<t.length;d++)if(yu(a,t[d-1],t[d])<c)return!0;return!1}function yu(a,t,r){const c=t.distSqr(r);if(c===0)return a.distSqr(t);const d=((a.x-t.x)*(r.x-t.x)+(a.y-t.y)*(r.y-t.y))/c;return a.distSqr(d<0?t:d>1?r:r.sub(t)._mult(d)._add(t))}function vu(a,t){let r,c,d,g=!1;for(let _=0;_<a.length;_++){r=a[_];for(let v=0,S=r.length-1;v<r.length;S=v++)c=r[v],d=r[S],c.y>t.y!=d.y>t.y&&t.x<(d.x-c.x)*(t.y-c.y)/(d.y-c.y)+c.x&&(g=!g)}return g}function Ss(a,t){let r=!1;for(let c=0,d=a.length-1;c<a.length;d=c++){const g=a[c],_=a[d];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(r=!r)}return r}function Ba(a,t,r,c,d){for(const _ of a)if(t<=_.x&&r<=_.y&&c>=_.x&&d>=_.y)return!0;const g=[new Ae(t,r),new Ae(t,d),new Ae(c,d),new Ae(c,r)];if(a.length>2){for(const _ of g)if(Ss(a,_))return!0}for(let _=0;_<a.length-1;_++)if(Na(a[_],a[_+1],g))return!0;return!1}function Na(a,t,r){const c=r[0],d=r[2];if(a.x<c.x&&t.x<c.x||a.x>d.x&&t.x>d.x||a.y<c.y&&t.y<c.y||a.y>d.y&&t.y>d.y)return!1;const g=Vn(a,t,r[0]);return g!==Vn(a,t,r[1])||g!==Vn(a,t,r[2])||g!==Vn(a,t,r[3])}function Ns(a,t,r,c,d,g){let _=t.y-a.y,v=a.x-t.x;if(g=g||0){const S=_*_+v*v;if(S===0)return!0;const T=Math.sqrt(S);_/=T,v/=T}return!((r.x-a.x)*_+(r.y-a.y)*v-g<0||(c.x-a.x)*_+(c.y-a.y)*v-g<0||(d.x-a.x)*_+(d.y-a.y)*v-g<0)}function pl(a,t,r,c,d,g,_){return!(Ns(a,t,c,d,g,_)||Ns(t,r,c,d,g,_)||Ns(r,a,c,d,g,_)||Ns(c,d,a,t,r,_)||Ns(d,g,a,t,r,_)||Ns(g,c,a,t,r,_))}function Ec(a,t,r){const c=t.paint.get(a).value;return c.kind==="constant"?c.value:r.programConfigurations.get(t.id).getMaxValue(a)}function ff(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function I2(a,t,r,c,d){if(!t[0]&&!t[1])return a;const g=Ae.convert(t)._mult(d);r==="viewport"&&g._rotate(-c);const _=[];for(let v=0;v<a.length;v++)_.push(a[v].sub(g));return _}function M2(a,t,r,c){const d=Ae.convert(a)._mult(c);return t==="viewport"&&d._rotate(-r),d}let A2,P2;function z2(a,t,r){var c=2*Math.PI*6378137/256/Math.pow(2,r);return[a*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}jt(Ho,"CircleBucket",{omit:["layers"]});class Uh{constructor(t,r,c){this.z=t,this.x=r,this.y=c,this.key=pf(0,t,t,r,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}isChildOf(t){const r=this.z-t.z;return t.z===0||t.z<this.z&&t.x===this.x>>r&&t.y===this.y>>r}url(t,r){const c=(function(g,_,v){var S=z2(256*g,256*(_=Math.pow(2,v)-_-1),v),T=z2(256*(g+1),256*(_+1),v);return S[0]+","+S[1]+","+T[0]+","+T[1]})(this.x,this.y,this.z),d=(function(g,_,v){let S,T="";for(let M=g;M>0;M--)S=1<<M-1,T+=(_&S?1:0)+(v&S?2:0);return T})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class C2{constructor(t,r){this.wrap=t,this.canonical=r,this.key=pf(t,r.z,r.z,r.x,r.y)}}class Zo{constructor(t,r,c,d,g){this.overscaledZ=t,this.wrap=r,this.canonical=new Uh(c,+d,+g),this.key=r===0&&t===c?this.canonical.key:pf(r,t,c,d,g)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const r=this.canonical.z-t;return t>this.canonical.z?new Zo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zo(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return pf(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return pf(this.wrap*+r,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Zo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new Zo(r,this.wrap,r,c,d),new Zo(r,this.wrap,r,c+1,d),new Zo(r,this.wrap,r,c,d+1),new Zo(r,this.wrap,r,c+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Zo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Zo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new C2(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function pf(a,t,r,c,d){const g=1<<Math.min(r,22);let _=g*(d%g)+c%g;return a&&r<22&&(_+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-r)))),16*(32*_+r)+(t-r)}const N4=[a=>{let t=a.canonical.x-1,r=a.wrap;return t<0&&(t=(1<<a.canonical.z)-1,r--),new Zo(a.overscaledZ,r,a.canonical.z,t,a.canonical.y)},a=>{let t=a.canonical.x+1,r=a.wrap;return t===1<<a.canonical.z&&(t=0,r++),new Zo(a.overscaledZ,r,a.canonical.z,t,a.canonical.y)},a=>new Zo(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Zo(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];jt(Uh,"CanonicalTileID"),jt(Zo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const U4=Ki([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vv}=U4,$4=Ki([{name:"a_pos_3",components:3,type:"Int16"}]);var L2=Ki([{name:"a_pos",type:"Int16",components:2}]);function jv(a){return a*J/ve}const V4=[new yn([re,re,re],[ne,ne,ne]),new yn([re,re,re],[0,0,ne]),new yn([0,re,re],[ne,0,ne]),new yn([re,0,re],[0,ne,ne]),new yn([0,0,re],[ne,ne,ne])];function R2(a,t,r,c=!0){const d=wi([],a._camera.position,a.worldSize),g=[t,r,1,1];Kt(g,g,a.pixelMatrixInverse),oi(g,g,1/g[3]);const _=Di([],Le([],g,d)),v=a.globeMatrix,S=[v[12],v[13],v[14]],T=Le([],S,d),M=_t(T),A=Di([],T),z=a.worldSize/(2*Math.PI),D=Ii(A,_),k=Math.asin(z/M);if(k<Math.acos(D)){if(!c)return null;const we=[],Ie=[];wi(we,_,M/D),Di(Ie,Le(Ie,we,T)),Di(_,ei(_,T,wi(_,Ie,Math.tan(k)*M)))}const $=[];new Nn(d,_).closestPointOnSphere(S,z,$);const H=Di([],nr(v,0)),j=Di([],nr(v,1)),X=Di([],nr(v,2)),Y=Ii(H,$),te=Ii(j,$),ue=Ii(X,$),le=Ee(Math.asin(-te/z));let ge=Ee(Math.atan2(Y,ue));ge=a.center.lng+(function(we,Ie){const Je=(Ie-we+180)%360-180;return Je<-180?Je+360:Je})(a.center.lng,ge);const ye=Re(ge),me=de(Ze(le),0,1);return new Pt(ye,me)}class j4{constructor(t,r,c){this.a=Le([],t,c),this.b=Le([],r,c),this.center=c;const d=Di([],this.a),g=Di([],this.b);this.angle=Math.acos(Ii(d,g))}}function Vw(a,t){if(a.angle===0)return null;let r;return r=a.a[t]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[t]/a.a[t]/Math.sin(a.angle)-1/Math.tan(a.angle)),r<0||r>1?null:(function(c,d,g,_){const v=Math.sin(g);return c*(Math.sin((1-_)*g)/v)+d*(Math.sin(_*g)/v)})(a.a[t],a.b[t],a.angle,de(r,0,1))+a.center[t]}function ql(a){if(a.z<=1)return V4[a.z+2*a.y+a.x];const t=jw(Gv(a));return yn.fromPoints(t)}function Ic(a,t,r){return wi(a,a,1-r),Rn(a,a,t,r)}function D2(a,t,r){for(const c of a)qt(c,c,t),wi(c,c,r)}function k2(a,t,r,c){const d=t/a.worldSize,g=a.globeMatrix;if(r.z<=1){const me=ql(r).getCorners();return D2(me,g,d),yn.fromPoints(me)}const _=Gv(r,c),v=jw(_,J+jv(a._tileCoverLift));D2(v,g,d);const S=Number.MAX_VALUE,T=[-S,-S,-S],M=[S,S,S];if(_.contains(a.center)){for(const Ie of v)Ai(M,M,Ie),dn(T,T,Ie);T[2]=0;const me=a.point,we=[me.x*d,me.y*d,0];return Ai(M,M,we),dn(T,T,we),new yn(M,T)}if(a._tileCoverLift>0){for(const me of v)Ai(M,M,me),dn(T,T,me);return new yn(M,T)}const A=[g[12]*d,g[13]*d,g[14]*d],z=_.getCenter(),D=de(a.center.lat,-85.051129,Te),k=de(z.lat,-85.051129,Te),$=Re(a.center.lng),H=Ze(D);let j=$-Re(z.lng);const X=H-Ze(k);j>.5?j-=1:j<-.5&&(j+=1);let Y=0;Math.abs(j)>Math.abs(X)?Y=j>=0?1:3:(Y=X>=0?0:2,Rn(A,A,[g[4]*d,g[5]*d,g[6]*d],-Math.sin(ii(X>=0?_.getSouth():_.getNorth()))*J));const te=v[Y],ue=v[(Y+1)%4],le=new j4(te,ue,A),ge=[Vw(le,0)||te[0],Vw(le,1)||te[1],Vw(le,2)||te[2]],ye=xu(a.zoom);if(ye>0){const me=(function({x:Ie,y:Je,z:qe},Xe,at,nt,ot){const Ge=1/(1<<qe);let ct=Ie*Ge,et=ct+Ge,ut=Je*Ge,lt=ut+Ge,Bt=0;const Ut=(ct+et)/2-nt;return Ut>.5?Bt=-1:Ut<-.5&&(Bt=1),ct=((ct+Bt)*Xe-(nt*=Xe))*at+nt,et=((et+Bt)*Xe-nt)*at+nt,ut=(ut*Xe-(ot*=Xe))*at+ot,lt=(lt*Xe-ot)*at+ot,[[ct,lt,0],[et,lt,0],[et,ut,0],[ct,ut,0]]})(r,t,a._pixelsPerMercatorPixel,$,H);for(let Ie=0;Ie<v.length;Ie++)Ic(v[Ie],me[Ie],ye);const we=ei([],me[Y],me[(Y+1)%4]);wi(we,we,.5),Ic(ge,we,ye)}for(const me of v)Ai(M,M,me),dn(T,T,me);return M[2]=Math.min(te[2],ue[2]),Ai(M,M,ge),dn(T,T,ge),new yn(M,T)}function Gv({x:a,y:t,z:r},c=!1){const d=1/(1<<r),g=new he(it(a*d),t===(1<<r)-1&&c?-90:dt((t+1)*d)),_=new he(it((a+1)*d),t===0&&c?90:dt(t*d));return new Se(g,_)}function jw(a,t=J){const r=ii(a.getNorth()),c=ii(a.getSouth()),d=Math.cos(r),g=Math.cos(c),_=Math.sin(r),v=Math.sin(c),S=a.getWest(),T=a.getEast();return[be(g,v,S,t),be(g,v,T,t),be(d,_,T,t),be(d,_,S,t)]}function og(a,t,r,c){const d=1<<r.z,g=(a/It+r.x)/d;return _e(dt((t/It+r.y)/d),it(g),c)}function Hv({min:a,max:t}){return 16383/Math.max(t[0]-a[0],t[1]-a[1],t[2]-a[2])}const O2=new Float64Array(16);function Zv(a){const t=Hv(a),r=At(O2,[t,t,t]);return tt(r,r,zn([],a.min))}function Gw(a){const t=(function(c,d){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=d[0],c[13]=d[1],c[14]=d[2],c[15]=1,c})(O2,a.min),r=1/Hv(a);return Ue(t,t,[r,r,r])}function Hw(a){const t=It/(2*Math.PI);return a/(2*Math.PI)/t}function F2(a,t){return It/(512*Math.pow(2,a))*Hv(ql(t))}function B2(a,t,r,c,d){const g=Hw(r),_=[a,t,-r/(2*Math.PI)],v=fe(new Float64Array(16));return tt(v,v,_),Ue(v,v,[g,g,g]),Ne(v,v,ii(-d)),Ce(v,v,ii(-c)),v}function xu(a){return Me(5,6,a)}function N2(a,t){const r=_e(t.lat,t.lng),c=(function(k){const $=_e(k._center.lat,k._center.lng);let H=hn([],yt(0,1,0),$);const j=ft([],-k.angle,$);H=qt(H,H,j),ft(j,-k._pitch,H);const X=Di([],$);return wi(X,X,jv(k.cameraToCenterDistance/k.pixelsPerMeter)),qt(X,X,j),ei([],$,X)})(a);return _=(d=mi([],c,r))[0],v=d[1],S=d[2],T=(g=r)[0],M=g[1],A=g[2],D=(z=Math.sqrt((_*_+v*v+S*S)*(T*T+M*M+A*A)))&&Ii(d,g)/z,Math.acos(Math.min(Math.max(D,-1),1));var d,g,_,v,S,T,M,A,z,D}function Zw(a,t){return N2(a,t)>Math.PI/2*1.01}const U2=ii(85),G4=Math.cos(U2),H4=Math.sin(U2),Z4=ee(),$2=a=>{const t=[];return a.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function V2(a,t,r,c,d,g,_,v,S){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(S*=a.pixelToTileUnitsFactor);const T=a.tileID.canonical,M=r.projection.upVectorScale(T,r.center.lat,r.worldSize).metersToTile;for(const A of t)for(const z of A){const D=z.add(v),k=d&&r.elevation?r.elevation.exaggeration()*d.getElevationAt(D.x,D.y,!0):0,$=r.projection.projectTilePoint(D.x,D.y,T);if(k>0){const Y=r.projection.upVector(T,D.x,D.y);$.x+=Y[0]*M*k,$.y+=Y[1]*M*k,$.z+=Y[2]*M*k}const H=g?D:W4($.x,$.y,$.z,c),j=g?a.tilespaceRays.map(Y=>X4(Y,k)):a.queryGeometry.screenGeometry,X=Kt([],[$.x,$.y,$.z,1],c);if(!_&&g?S*=X[3]/r.cameraToCenterDistance:_&&!g&&(S*=r.cameraToCenterDistance/X[3]),g){const Y=dt((z.y/It+T.y)/(1<<T.z));S/=r.projection.pixelsPerMeter(Y,1)/je(1,Y)}if(Ir(j,H,S))return!0}return!1}function W4(a,t,r,c){const d=Kt([],[a,t,r,1],c);return new Ae(d[0]/d[3],d[1]/d[3])}const j2=yt(0,0,0),q4=yt(0,0,1);function X4(a,t){const r=Qe();return j2[2]=t,a.intersectsPlane(j2,q4,r),new Ae(r[0],r[1])}class G2 extends Ho{}let H2,Z2,W2,q2;function X2(a,{width:t,height:r},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*r*c)throw new RangeError("mismatched image size")}else d=new Uint8Array(t*r*c);return a.width=t,a.height=r,a.data=d,a}function J2(a,t,r){const{width:c,height:d}=t;c===a.width&&d===a.height||(Ww(a,t,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,c),height:Math.min(a.height,d)},r,null),a.width=c,a.height=d,a.data=t.data)}function Ww(a,t,r,c,d,g,_,v){if(d.width===0||d.height===0)return t;if(d.width>a.width||d.height>a.height||r.x>a.width-d.width||r.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||c.x>t.width-d.width||c.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const S=a.data,T=t.data,M=g===4&&v;for(let A=0;A<d.height;A++){const z=((r.y+A)*a.width+r.x)*g,D=((c.y+A)*t.width+c.x)*g;if(M)for(let k=0;k<d.width;k++){const $=z+k*g+3,H=D+k*g;T[H+0]=255,T[H+1]=255,T[H+2]=255,T[H+3]=S[$]}else if(_)for(let k=0;k<d.width;k++){const $=z+k*g,H=D+k*g,j=new bn(S[$+0]/255,S[$+1]/255,S[$+2]/255,S[$+3]).toNonPremultipliedRenderColor(_).toArray();T[H+0]=j[0],T[H+1]=j[1],T[H+2]=j[2],T[H+3]=j[3]}else for(let k=0;k<d.width*g;k++)T[D+k]=S[z+k]}return t}jt(G2,"HeatmapBucket",{omit:["layers"]});class bu{constructor(t,r){X2(this,t,1,r)}resize(t){J2(this,new bu(t),1)}clone(){return new bu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,d,g){Ww(t,r,c,d,g,1,null)}}class Mo{constructor(t,r){X2(this,t,4,r)}resize(t){J2(this,new Mo(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,d,g,_,v){Ww(t,r,c,d,g,4,_,v)}}class Y2{constructor(t,r){this.width=t.width,this.height=t.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function sg(a){const t={},r=a.resolution||256,c=a.clips?a.clips.length:1,d=a.image||new Mo({width:r,height:c}),g=(_,v,S)=>{t[a.evaluationKey]=S;const T=a.expression.evaluate(t),M=T?T.toNonPremultipliedRenderColor(null):null;M&&(d.data[_+v+0]=Math.floor(255*M.r),d.data[_+v+1]=Math.floor(255*M.g),d.data[_+v+2]=Math.floor(255*M.b),d.data[_+v+3]=Math.floor(255*M.a))};if(a.clips)for(let _=0,v=0;_<c;++_,v+=4*r)for(let S=0,T=0;S<r;S++,T+=4){const M=S/(r-1),{start:A,end:z}=a.clips[_];g(v,T,A*(1-M)+z*M)}else for(let _=0,v=0;_<r;_++,v+=4)g(0,v,_/(r-1));return d}jt(bu,"AlphaImage"),jt(Mo,"RGBAImage");const J4=Ki([{name:"a_pos",components:2,type:"Int16"}],4),Y4=Ki([{name:"a_road_z_offset",components:1,type:"Float32"}],4),K4=Ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Q4=Ki([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function mf(a,t,r=2){const c=t&&t.length,d=c?t[0]*r:a.length;let g=K2(a,0,d,r,!0);const _=[];if(!g||g.next===g.prev)return _;let v,S,T;if(c&&(g=(function(M,A,z,D){const k=[];for(let $=0,H=A.length;$<H;$++){const j=K2(M,A[$]*D,$<H-1?A[$+1]*D:M.length,D,!1);j===j.next&&(j.steiner=!0),k.push(aN(j))}k.sort(rN);for(let $=0;$<k.length;$++)z=oN(k[$],z);return z})(a,t,g,r)),a.length>80*r){v=a[0],S=a[1];let M=v,A=S;for(let z=r;z<d;z+=r){const D=a[z],k=a[z+1];D<v&&(v=D),k<S&&(S=k),D>M&&(M=D),k>A&&(A=k)}T=Math.max(M-v,A-S),T=T!==0?32767/T:0}return ag(g,_,r,v,S,T,0),_}function K2(a,t,r,c,d){let g;if(d===(function(_,v,S,T){let M=0;for(let A=v,z=S-T;A<S;A+=T)M+=(_[z]-_[A])*(_[A+1]+_[z+1]),z=A;return M})(a,t,r,c)>0)for(let _=t;_<r;_+=c)g=iM(_/c|0,a[_],a[_+1],g);else for(let _=r-c;_>=t;_-=c)g=iM(_/c|0,a[_],a[_+1],g);return g&&gf(g,g.next)&&(ug(g),g=g.next),g}function $h(a,t){if(!a)return a;t||(t=a);let r,c=a;do if(r=!1,c.steiner||!gf(c,c.next)&&oo(c.prev,c,c.next)!==0)c=c.next;else{if(ug(c),c=t=c.prev,c===c.next)break;r=!0}while(r||c!==t);return t}function ag(a,t,r,c,d,g,_){if(!a)return;!_&&g&&(function(S,T,M,A){let z=S;do z.z===0&&(z.z=qw(z.x,z.y,T,M,A)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==S);z.prevZ.nextZ=null,z.prevZ=null,(function(D){let k,$=1;do{let H,j=D;D=null;let X=null;for(k=0;j;){k++;let Y=j,te=0;for(let le=0;le<$&&(te++,Y=Y.nextZ,Y);le++);let ue=$;for(;te>0||ue>0&&Y;)te!==0&&(ue===0||!Y||j.z<=Y.z)?(H=j,j=j.nextZ,te--):(H=Y,Y=Y.nextZ,ue--),X?X.nextZ=H:D=H,H.prevZ=X,X=H;j=Y}X.nextZ=null,$*=2}while(k>1)})(z)})(a,c,d,g);let v=a;for(;a.prev!==a.next;){const S=a.prev,T=a.next;if(g?tN(a,c,d,g):eN(a))t.push(S.i,a.i,T.i),ug(a),a=T.next,v=T.next;else if((a=T)===v){_?_===1?ag(a=iN($h(a),t),t,r,c,d,g,2):_===2&&nN(a,t,r,c,d,g):ag($h(a),t,r,c,d,g,1);break}}}function eN(a){const t=a.prev,r=a,c=a.next;if(oo(t,r,c)>=0)return!1;const d=t.x,g=r.x,_=c.x,v=t.y,S=r.y,T=c.y,M=Math.min(d,g,_),A=Math.min(v,S,T),z=Math.max(d,g,_),D=Math.max(v,S,T);let k=c.next;for(;k!==t;){if(k.x>=M&&k.x<=z&&k.y>=A&&k.y<=D&&lg(d,v,g,S,_,T,k.x,k.y)&&oo(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function tN(a,t,r,c){const d=a.prev,g=a,_=a.next;if(oo(d,g,_)>=0)return!1;const v=d.x,S=g.x,T=_.x,M=d.y,A=g.y,z=_.y,D=Math.min(v,S,T),k=Math.min(M,A,z),$=Math.max(v,S,T),H=Math.max(M,A,z),j=qw(D,k,t,r,c),X=qw($,H,t,r,c);let Y=a.prevZ,te=a.nextZ;for(;Y&&Y.z>=j&&te&&te.z<=X;){if(Y.x>=D&&Y.x<=$&&Y.y>=k&&Y.y<=H&&Y!==d&&Y!==_&&lg(v,M,S,A,T,z,Y.x,Y.y)&&oo(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,te.x>=D&&te.x<=$&&te.y>=k&&te.y<=H&&te!==d&&te!==_&&lg(v,M,S,A,T,z,te.x,te.y)&&oo(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;Y&&Y.z>=j;){if(Y.x>=D&&Y.x<=$&&Y.y>=k&&Y.y<=H&&Y!==d&&Y!==_&&lg(v,M,S,A,T,z,Y.x,Y.y)&&oo(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;te&&te.z<=X;){if(te.x>=D&&te.x<=$&&te.y>=k&&te.y<=H&&te!==d&&te!==_&&lg(v,M,S,A,T,z,te.x,te.y)&&oo(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function iN(a,t){let r=a;do{const c=r.prev,d=r.next.next;!gf(c,d)&&eM(c,r,r.next,d)&&cg(c,d)&&cg(d,c)&&(t.push(c.i,r.i,d.i),ug(r),ug(r.next),r=a=d),r=r.next}while(r!==a);return $h(r)}function nN(a,t,r,c,d,g){let _=a;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&lN(_,v)){let S=tM(_,v);return _=$h(_,_.next),S=$h(S,S.next),ag(_,t,r,c,d,g,0),void ag(S,t,r,c,d,g,0)}v=v.next}_=_.next}while(_!==a)}function rN(a,t){let r=a.x-t.x;return r===0&&(r=a.y-t.y,r===0)&&(r=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function oN(a,t){const r=(function(d,g){let _=g;const v=d.x,S=d.y;let T,M=-1/0;if(gf(d,_))return _;do{if(gf(d,_.next))return _.next;if(S<=_.y&&S>=_.next.y&&_.next.y!==_.y){const $=_.x+(S-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if($<=v&&$>M&&(M=$,T=_.x<_.next.x?_:_.next,$===v))return T}_=_.next}while(_!==g);if(!T)return null;const A=T,z=T.x,D=T.y;let k=1/0;_=T;do{if(v>=_.x&&_.x>=z&&v!==_.x&&Q2(S<D?v:M,S,z,D,S<D?M:v,S,_.x,_.y)){const $=Math.abs(S-_.y)/(v-_.x);cg(_,d)&&($<k||$===k&&(_.x>T.x||_.x===T.x&&sN(T,_)))&&(T=_,k=$)}_=_.next}while(_!==A);return T})(a,t);if(!r)return t;const c=tM(r,a);return $h(c,c.next),$h(r,r.next)}function sN(a,t){return oo(a.prev,a,t.prev)<0&&oo(t.next,a,a.next)<0}function qw(a,t,r,c,d){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-r)*d|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function aN(a){let t=a,r=a;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==a);return r}function Q2(a,t,r,c,d,g,_,v){return(d-_)*(t-v)>=(a-_)*(g-v)&&(a-_)*(c-v)>=(r-_)*(t-v)&&(r-_)*(g-v)>=(d-_)*(c-v)}function lg(a,t,r,c,d,g,_,v){return!(a===_&&t===v)&&Q2(a,t,r,c,d,g,_,v)}function lN(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!(function(r,c){let d=r;do{if(d.i!==r.i&&d.next.i!==r.i&&d.i!==c.i&&d.next.i!==c.i&&eM(d,d.next,r,c))return!0;d=d.next}while(d!==r);return!1})(a,t)&&(cg(a,t)&&cg(t,a)&&(function(r,c){let d=r,g=!1;const _=(r.x+c.x)/2,v=(r.y+c.y)/2;do d.y>v!=d.next.y>v&&d.next.y!==d.y&&_<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==r);return g})(a,t)&&(oo(a.prev,a,t.prev)||oo(a,t.prev,t))||gf(a,t)&&oo(a.prev,a,a.next)>0&&oo(t.prev,t,t.next)>0)}function oo(a,t,r){return(t.y-a.y)*(r.x-t.x)-(t.x-a.x)*(r.y-t.y)}function gf(a,t){return a.x===t.x&&a.y===t.y}function eM(a,t,r,c){const d=qv(oo(a,t,r)),g=qv(oo(a,t,c)),_=qv(oo(r,c,a)),v=qv(oo(r,c,t));return d!==g&&_!==v||!(d!==0||!Wv(a,r,t))||!(g!==0||!Wv(a,c,t))||!(_!==0||!Wv(r,a,c))||!(v!==0||!Wv(r,t,c))}function Wv(a,t,r){return t.x<=Math.max(a.x,r.x)&&t.x>=Math.min(a.x,r.x)&&t.y<=Math.max(a.y,r.y)&&t.y>=Math.min(a.y,r.y)}function qv(a){return a>0?1:a<0?-1:0}function cg(a,t){return oo(a.prev,a,a.next)<0?oo(a,t,a.next)>=0&&oo(a,a.prev,t)>=0:oo(a,t,a.prev)<0||oo(a,a.next,t)<0}function tM(a,t){const r=Xw(a.i,a.x,a.y),c=Xw(t.i,t.x,t.y),d=a.next,g=t.prev;return a.next=t,t.prev=a,r.next=d,d.prev=r,c.next=r,r.prev=c,g.next=c,c.prev=g,c}function iM(a,t,r,c){const d=Xw(a,t,r);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function ug(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Xw(a,t,r){return{i:a,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function hg(a,t){const r=a.length;if(r<=1)return[a];const c=[];let d,g;for(let _=0;_<r;_++){const v=Nr(a[_]);v!==0&&(a[_].area=Math.abs(v),g===void 0&&(g=v<0),g===v<0?(d&&c.push(d),d=[a[_]]):d.push(a[_]))}if(d&&c.push(d),t>1)for(let _=0;_<c.length;_++)c[_].length<=t||(Id(c[_],t,1,c[_].length-1,cN),c[_]=c[_].slice(0,t));return c}function cN(a,t){return t.area-a.area}function nM(a,t,r=1){if(!a)return null;const c=typeof a=="string"?rs.from(a).getPrimary():a.getPrimary(),d=typeof a=="string"?null:a.getSecondary();for(const g of[c,d]){if(!g)continue;const _=g.id.toString();t.has(_)||t.set(_,[]),g.scaleSelf(r),t.get(_).push(g)}return{primary:c.toString(),secondary:d?d.toString():null}}function Jw(a,t,r,c){const d=c.patternDependencies;let g=!1;for(const _ of t){const v=_.paint.get(`${a}-pattern`);v.isConstant()||(g=!0),nM(v.constantOr(null),d,r)&&(g=!0)}return g}function Yw(a,t,r,c,d,g){const _=g.patternDependencies;for(const v of t){const S=v.paint.get(`${a}-pattern`).value;if(S.kind!=="constant"){let T=S.evaluate({zoom:c},r,{},g.availableImages);T=T&&T.name?T.name:T;const M=nM(T,_,d);if(!M)continue;const{primary:A,secondary:z}=M;A&&(r.patterns[v.id]=[A,z].filter(Boolean))}}return r}class Mc{constructor(){this.portals=[]}static isOnBorder(t,r){return t<=0&&r<=0||t>=It&&r>=It}static evaluate(t){if(t.length===0)return new Mc;let r=[];for(const S of t)r.push(...S.portals);if(r.length===0)return new Mc;for(const S of r){const T=S.va,M=S.vb;(Mc.isOnBorder(T.x,M.x)||Mc.isOnBorder(T.y,M.y))&&(S.type="border")}const c=r.filter(S=>S.type!=="unevaluated"),d=r.filter(S=>S.type==="unevaluated");if(d.length===0)return new Mc;d.sort((S,T)=>S.hash===T.hash?S.isTunnel===T.isTunnel?0:S.isTunnel?-1:1:S.hash<T.hash?1:-1),r=c.concat(d);let g=c.length,_=g,v=g;do if(_++,_===r.length||r[g].hash!==r[_].hash){if(_-g===2){v<g&&(r[v]=r[g],r[g]=null);const S=r[v],T=r[_-1];S.type=S.isTunnel!==T.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:T.connection.a},v++}g=_}while(g!==r.length);return r.splice(v),r.sort((S,T)=>S.hash<T.hash?1:-1),{portals:r}}}jt(Mc,"ElevationPortalGraph");class uN{constructor(t,r,c){this.outPositions=t,this.outNormals=r,this.outIndices=c,this.vertexLookup=new Map}addVertex(t,r,c){let d=t[2];c!=null&&(d*=c);const g=`${t[0]},${t[1]},${t[2]},${r[0]},${r[1]},${r[2]}`,_=this.vertexLookup.get(g);if(_!=null)return _;const v=this.outPositions.length;this.vertexLookup.set(g,v);const S=Math.trunc(16384*r[0]),T=Math.trunc(16384*r[1]),M=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(t[0],t[1],d),this.outNormals.emplaceBack(S,T,M),v}addTriangle(t,r,c){this.outIndices.emplaceBack(t,r,c)}addTriangles(t,r,c){if(t.length===0)return;const d=c.length===1,g=Qe(),_=Qe();for(let v=0;v<t.length;v+=3){const S=r[t[v+0]],T=r[t[v+1]],M=r[t[v+2]],A=d?c[0]:c[t[v+1]],z=d?c[0]:c[t[v+2]];Nt(g,S.x,S.y,d?c[0]:c[t[v+0]]);const D=this.addVertex(g,_);Nt(g,T.x,T.y,A);const k=this.addVertex(g,_);Nt(g,M.x,M.y,z);const $=this.addVertex(g,_);this.outIndices.emplaceBack(D,k,$)}}addQuad(t,r,c,d,g,_){const v=this.addVertex(t,g,_),S=this.addVertex(r,g,_),T=this.addVertex(c,g,_),M=this.addVertex(d,g,_);this.addTriangle(v,S,T),this.addTriangle(T,M,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Us{constructor(t,r,c,d){this.unevaluatedPortals=new Mc,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new fu,this.vertexNormals=new Wm,this.indexArray=new Hr,this.tileToMeters=vt(t),this.bridgeProgramConfigurations=new R(r,{zoom:c,lut:d},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new R(r,{zoom:c,lut:d},g=>g!=="fill-bridge-guard-rail-color")}addVertices(t,r){const c=this.unevalVertices.length;for(let d=0;d<t.length;d++)this.unevalVertices.push(t[d]),this.unevalHeights.push(r[d]);return c}addTriangles(t,r,c){const d=c?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of t)d.push(g+r)}addRenderableRing(t,r,c,d,g,_){const v=[new Ae(g.min.x,g.min.y),new Ae(g.max.x,g.min.y),new Ae(g.max.x,g.max.y),new Ae(g.min.x,g.max.y)];for(let S=0;S<c-1;S++){const T=r+S,M=T+1,A=this.unevalVertices[T],z=this.unevalVertices[M];if(!(A.x>=g.min.x&&A.x<=g.max.x&&A.y>=g.min.y&&A.y<=g.max.y||z.x>=g.min.x&&z.x<=g.max.x&&z.y>=g.min.y&&z.y<=g.max.y||Na(A,z,v))||this.isOnBorder(A.x,z.x)||this.isOnBorder(A.y,z.y))continue;const D=Us.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[M]);let k,$=this.vertexHashLookup.get(Us.computePosHash(A));$!=null?k=$.next:($=this.vertexHashLookup.get(Us.computePosHash(z)),k=$!=null?$.prev:D),this.unevalEdges.push({polygonIdx:t,a:T,b:M,hash:D,portalHash:k,isTunnel:d,type:"unevaluated",featureInfo:_})}}addPortalCandidates(t,r,c,d,g){if(r.length!==0){this.vertexHashLookup.clear();for(const _ of r){if(_.length===0)continue;const v=_[0];let S=Us.computeEdgeHash(v[v.length-2],v[v.length-1]);for(let T=0;T<v.length-1;T++){const M=v[T+0],A=v[T+1],z=Ks(A.x-M.x,A.y-M.y),D=da(z);if(D===0)continue;let k="unevaluated";const $=d.pointElevation(M),H=d.pointElevation(A);Math.abs($)<.01&&Math.abs(H)<.01?k="entrance":(this.isOnBorder(M.x,A.x)||this.isOnBorder(M.y,A.y))&&(k="border");const j=Us.computeEdgeHash(M,A);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:M,vb:A,vab:z,length:D,hash:j,isTunnel:c,type:k});const X=Us.computePosHash(M);this.vertexHashLookup.set(X,{prev:S,next:j}),S=j}}}}construct(t){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),c=z=>{z.primitiveLength=this.indexArray.length-z.primitiveOffset},d=new uN(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);const g=r(),_=r(),v=r(),S=(z,D)=>{z.sort(($,H)=>$.type===D&&H.type!==D?-1:$.type!==D&&H.type===D?1:0);const k=z.findIndex($=>$.type!==D);return k>=0?k:z.length};let T=0;this.unevalEdges.length>0&&(T=S(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),c(v);const M=r(),A=r();if(this.unevalEdges.length>0){const z=this.unevalEdges.splice(T),D=S(z,"tunnel")+T;this.unevalEdges.push(...z),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:D})}c(M),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),c(A),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),c(_),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),c(g),this.maskSegments=er.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.depthSegments=er.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=er.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=er.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=er.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(t,r,c,d,g,_,v,S){this.bridgeProgramConfigurations.updatePaintArrays(t,r,g,c,d,_,v,S),this.tunnelProgramConfigurations.updatePaintArrays(t,r,g,c,d,_,v,S)}upload(t){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,K4.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,Q4.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(t),this.tunnelProgramConfigurations.upload(t))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(t,r,c,d,g){const _=(v,S)=>{for(let T=0;T<S.length-1;T++){const M=S[T].featureIndex,A=S[T+1].vertexStart,z=t.feature(M);v.populatePaintArrays(A,z,M,{},c,r,d,void 0,g)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(t,r,c,d,g){const _=new Map;for(let v=d;v<g;v++){const S=c[v],T=S.a,M=S.b,A=Us.computePosHash(t[T]),z=Us.computePosHash(t[M]);let D=_.get(A);D||(D={},_.set(A,D));let k=_.get(z);k||(k={},_.set(z,k)),r[T]<=0&&r[M]<=0||(D.to=M,k.from=T)}return _}isTerminalVertex(t,r){const c=Us.computePosHash(this.unevalVertices[t]),d=r.get(c);return!d||!d.from||!d.to}constructBridgeStructures(t,r,c,d,g,_){t.clearVertexLookup();const v=this.computeVertexConnections(r,c,d,g.min,g.max),S=1/_,T=.5*S,M=(at,nt)=>Nt(at,r[nt].x,r[nt].y,c[nt]*S),A=Qe(),z=Qe(),D=Qe(),k=Qe(),$=Qe(),H=(at,nt)=>{const ot=v.get(Us.computePosHash(r[nt])),Ge=ot.from,ct=ot.to;if(!Ge||!ct)return;M(A,Ge),M(z,nt),M(D,ct),zi(k),Ve(A,z)||(Le($,z,A),Di(k,$)),Ve(D,z)||(Le($,D,z),ei(k,k,Di($,$)));const et=Jt(k);return et>0?wi(at,k,1/et):void 0};let j=Number.POSITIVE_INFINITY;this.sortSubarray(d,g.min,g.max,(at,nt)=>at.featureInfo.featureIndex-nt.featureInfo.featureIndex);const X=Qe(),Y=Qe(),te=Qe(),ue=Qe(),le=Qe(),ge=Qe(),ye=Qe(),me=Qe(),we=Qe(),Ie=[Qe(),Qe(),Qe(),Qe()],Je=[Qe(),Qe(),Qe(),Qe()],qe=[{coord:new Ae(0,0),height:0},{coord:new Ae(0,0),height:0}],Xe=(at,nt)=>at>nt;for(let at=g.min;at<g.max;at++){const nt=d[at];if(!nt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(qe,r,c,nt,Xe))continue;const[ot,Ge]=qe;if(Nt(X,ot.coord.x,ot.coord.y,S*ot.height),Nt(Y,Ge.coord.x,Ge.coord.y,S*Ge.height),Ve(X,Y))continue;Le(te,Y,X),Di(te,te);const ct=H(me,nt.a)||te,et=H(we,nt.b)||te;Nt(ue,ct[1],-ct[0],0),Di(ue,ue),Nt(le,et[1],-et[0],0),Di(le,le),hn(me,ue,ct),Di(ge,me),hn(me,le,et),Di(ye,me),ei(Ie[0],X,wi(me,Le(me,ue,ge),T)),ei(Ie[1],X,wi(me,ei(me,ue,ge),T)),ei(Ie[2],X,wi(me,ge,T)),Ie[3]=X,ei(Je[0],Y,wi(me,Le(me,le,ye),T)),ei(Je[1],Y,wi(me,ei(me,le,ye),T)),ei(Je[2],Y,wi(me,ye,T)),Je[3]=Y,j=this.addFeatureSection(nt.featureInfo.featureIndex,j,this.bridgeFeatureSections,t);const ut=t.addVertex(Ie[0],ue,_),lt=t.addVertex(Ie[1],ue,_),Bt=t.addVertex(Je[0],le,_),Ut=t.addVertex(Je[1],le,_);t.addTriangle(ut,lt,Bt),t.addTriangle(lt,Ut,Bt);const Tt=t.addVertex(Ie[1],ge,_),Mt=t.addVertex(Ie[2],ge,_),li=t.addVertex(Je[1],ye,_),Yt=t.addVertex(Je[2],ye,_);t.addTriangle(Tt,Mt,li),t.addTriangle(Mt,Yt,li),zn(ue,ue),zn(le,le);const Ct=t.addVertex(Ie[2],ue,_),bi=t.addVertex(Ie[3],ue,_),qi=t.addVertex(Je[2],le,_),pn=t.addVertex(Je[3],le,_);t.addTriangle(Ct,bi,qi),t.addTriangle(bi,pn,qi);const Hi=this.isTerminalVertex(nt.a,v),Pn=this.isTerminalVertex(nt.b,v);ot.height<.01&&Hi&&t.addQuad(Ie[3],Ie[2],Ie[1],Ie[0],zn(ct,ct),_),Ge.height<.01&&Pn&&t.addQuad(Je[0],Je[1],Je[2],Je[3],et,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}constructTunnelStructures(t,r,c,d,g,_){t.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const S=(j,X)=>j.featureInfo.featureIndex-X.featureInfo.featureIndex;this.sortSubarray(d,g.min,g.max,S),this.sortSubarray(d,_.min,_.max,S);const T=j=>Di(j,j),M=[{coord:new Ae(0,0),height:0},{coord:new Ae(0,0),height:0}],A=(j,X)=>j<X,z=Qe(),D=Qe(),k=Qe(),$=Qe(),H=Qe();for(let j=g.min;j<g.max;j++){if(!this.prepareEdgePoints(M,r,c,d[j],A))continue;const[X,Y]=M,te=T(Nt(H,-(Y.coord.y-X.coord.y),Y.coord.x-X.coord.x,0));v=this.addFeatureSection(d[j].featureInfo.featureIndex,v,this.tunnelFeatureSections,t),t.addQuad(Nt(z,X.coord.x,X.coord.y,X.height),Nt(D,Y.coord.x,Y.coord.y,Y.height),Nt(k,Y.coord.x,Y.coord.y,d[j].isTunnel?-.1:0),Nt($,X.coord.x,X.coord.y,d[j].isTunnel?-.1:0),te)}for(let j=_.min;j<_.max;j++){const X=d[j];X.isTunnel&&([X.a,X.b]=[X.b,X.a]);const Y=r[X.a],te=r[X.b],ue=T(Nt(H,-(te.y-Y.y),te.x-Y.x,0));v=this.addFeatureSection(X.featureInfo.featureIndex,v,this.tunnelFeatureSections,t),t.addQuad(Nt(z,te.x,te.y,0),Nt(D,Y.x,Y.y,0),Nt(k,Y.x,Y.y,c[X.a]+4),Nt($,te.x,te.y,c[X.b]+4),ue),t.addQuad(Nt(z,Y.x,Y.y,0),Nt(D,te.x,te.y,0),Nt(k,te.x,te.y,c[X.b]+4),Nt($,Y.x,Y.y,c[X.a]+4),ue)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}setElevatedPoint(t,r,c,d){t.coord.x=r,t.coord.y=c,t.height=d}prepareEdgePoints(t,r,c,d,g){let _=r[d.a].x,v=r[d.a].y,S=r[d.b].x,T=r[d.b].y,M=c[d.a],A=c[d.b];const z=g(M,0),D=g(A,0);if(z&&D)return this.setElevatedPoint(t[0],_,v,M),this.setElevatedPoint(t[1],S,T,A),!0;if(!z&&!D)return!1;if(z){if(!D){const k=A/(A-M);S=di(S,_,k),T=di(T,v,k),A=di(A,M,k)}}else{const k=M/(M-A);_=di(_,S,k),v=di(v,T,k),M=di(M,A,k)}return this.setElevatedPoint(t[0],_,v,M),this.setElevatedPoint(t[1],S,T,A),!0}prepareEdges(t,r){if(r.length===0)return;r.sort((v,S)=>v.hash===S.hash?S.polygonIdx-v.polygonIdx:S.hash>v.hash?1:-1);let c=0,d=0,g=0,_=r[c].polygonIdx;do d++,(d===r.length||r[c].hash!==r[d].hash)&&((d-c===1||r[d-1].polygonIdx!==_)&&(g<c&&(r[g]=r[c],r[c]=null),r[g].type="none",g++),c=d,c!==r.length&&(_=r[c].polygonIdx));while(c!==r.length);if(r.splice(g),r.length!==0&&t.length!==0){r.sort((T,M)=>T.portalHash<M.portalHash?1:-1);let v=0,S=0;for(;v!==r.length&&S!==t.length;){const T=r[v],M=t[S];T.portalHash>M.hash?v++:M.hash>T.portalHash?S++:(T.type=M.type,v++)}}}isOnBorder(t,r){return t<=0&&r<=0||t>=It&&r>=It}addFeatureSection(t,r,c,d){return t!==r&&(r=t,c.push({featureIndex:t,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),r}sortSubarray(t,r,c,d){const g=t.slice(r,c);g.sort(d),t.splice(r,g.length,...g)}static computeEdgeHash(t,r){return(t.y===r.y&&t.x>r.x||t.y>r.y)&&([t,r]=[r,t]),BigInt(Us.computePosHash(t))<<32n|BigInt(Us.computePosHash(r))}static computePosHash(t){return((65535&t.x)<<16|65535&t.y)>>>0}}function hN(a,t){return a>t?1:a<t?-1:0}class Kw{constructor(t=hN,r=!1){this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!r}rotateLeft(t){var r=t.right;r&&(t.right=r.left,r.left&&(r.left.parent=t),r.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=r:t.parent.right=r:this._root=r,r&&(r.left=t),t.parent=r}rotateRight(t){var r=t.left;r&&(t.left=r.right,r.right&&(r.right.parent=t),r.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=r:t.parent.right=r:this._root=r,r&&(r.right=t),t.parent=r}_splay(t){for(;t.parent;){var r=t.parent;r.parent?r.left===t&&r.parent.left===r?(this.rotateRight(r.parent),this.rotateRight(r)):r.right===t&&r.parent.right===r?(this.rotateLeft(r.parent),this.rotateLeft(r)):r.left===t&&r.parent.right===r?(this.rotateRight(r),this.rotateLeft(r)):(this.rotateLeft(r),this.rotateRight(r)):r.left===t?this.rotateRight(r):this.rotateLeft(r)}}splay(t){for(var r,c,d,g,_;t.parent;)(c=(r=t.parent).parent)&&c.parent?((d=c.parent).left===c?d.left=t:d.right=t,t.parent=d):(t.parent=null,this._root=t),g=t.left,_=t.right,t===r.left?(c&&(c.left===r?(r.right?(c.left=r.right,c.left.parent=c):c.left=null,r.right=c,c.parent=r):(g?(c.right=g,g.parent=c):c.right=null,t.left=c,c.parent=t)),_?(r.left=_,_.parent=r):r.left=null,t.right=r,r.parent=t):(c&&(c.right===r?(r.left?(c.right=r.left,c.right.parent=c):c.right=null,r.left=c,c.parent=r):(_?(c.left=_,_.parent=c):c.left=null,t.right=c,c.parent=t)),g?(r.right=g,g.parent=r):r.right=null,t.left=r,r.parent=t)}replace(t,r){t.parent?t===t.parent.left?t.parent.left=r:t.parent.right=r:this._root=r,r&&(r.parent=t.parent)}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}insert(t,r){var c=this._root,d=null,g=this._compare;if(this._noDuplicates)for(;c;){if(d=c,g(c.key,t)===0)return;c=g(c.key,t)<0?c.right:c.left}else for(;c;)d=c,c=g(c.key,t)<0?c.right:c.left;return c={key:t,data:r,left:null,right:null,parent:d},d?g(d.key,c.key)<0?d.right=c:d.left=c:this._root=c,this.splay(c),this._size++,c}find(t){for(var r=this._root,c=this._compare;r;){var d=c(r.key,t);if(d<0)r=r.right;else{if(!(d>0))return r;r=r.left}}return null}contains(t){for(var r=this._root,c=this._compare;r;){var d=c(t,r.key);if(d===0)return!0;r=d<0?r.left:r.right}return!1}remove(t){var r=this.find(t);if(!r)return!1;if(this.splay(r),r.left)if(r.right){var c=this.minNode(r.right);c.parent!==r&&(this.replace(c,c.right),c.right=r.right,c.right.parent=c),this.replace(r,c),c.left=r.left,c.left.parent=c}else this.replace(r,r.left);else this.replace(r,r.right);return this._size--,!0}removeNode(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var r=this.minNode(t.right);r.parent!==t&&(this.replace(r,r.right),r.right=t.right,r.right.parent=r),this.replace(t,r),r.left=t.left,r.left.parent=r}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}erase(t){var r=this.find(t);if(r){this.splay(r);var c=r.left,d=r.right,g=null;c&&(c.parent=null,g=this.maxNode(c),this.splay(g),this._root=g),d&&(c?g.right=d:this._root=d,d.parent=g),this._size--}}pop(){var t=this._root,r=null;if(t){for(;t.left;)t=t.left;r={key:t.key,data:t.data},this.remove(t.key)}return r}next(t){var r=t;if(r)if(r.right)for(r=r.right;r&&r.left;)r=r.left;else for(r=t.parent;r&&r.right===t;)t=r,r=r.parent;return r}prev(t){var r=t;if(r)if(r.left)for(r=r.left;r&&r.right;)r=r.right;else for(r=t.parent;r&&r.left===t;)t=r,r=r.parent;return r}forEach(t){for(var r=this._root,c=[],d=!1,g=0;!d;)r?(c.push(r),r=r.left):c.length>0?(t(r=c.pop(),g++),r=r.right):d=!0;return this}range(t,r,c,d){const g=[],_=this._compare;let v,S=this._root;for(;g.length!==0||S;)if(S)g.push(S),S=S.left;else{if(S=g.pop(),v=_(S.key,r),v>0)break;if(_(S.key,t)>=0&&c.call(d,S))return this;S=S.right}return this}keys(){for(var t=this._root,r=[],c=[],d=!1;!d;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),c.push(t.key),t=t.right):d=!0;return c}values(){for(var t=this._root,r=[],c=[],d=!1;!d;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),c.push(t.data),t=t.right):d=!0;return c}at(t){for(var r=this._root,c=[],d=!1,g=0;!d;)if(r)c.push(r),r=r.left;else if(c.length>0){if(r=c.pop(),g===t)return r;g++,r=r.right}else d=!0;return null}load(t=[],r=[],c=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const d=t.length;return c&&e1(t,r,0,d-1,this._compare),this._root=Qw(null,t,r,0,d),this._size=d,this}min(){var t=this.minNode(this._root);return t?t.key:null}max(){var t=this.maxNode(this._root);return t?t.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(t,r,c,d,g){return new Kw(c,g).load(t,r,d)}}function Qw(a,t,r,c,d){const g=d-c;if(g>0){const _=c+Math.floor(g/2),v={key:t[_],data:r[_],parent:a};return v.left=Qw(v,t,r,c,_),v.right=Qw(v,t,r,_+1,d),v}return null}function e1(a,t,r,c,d){if(r>=c)return;const g=a[r+c>>1];let _=r-1,v=c+1;for(;;){do _++;while(d(a[_],g)<0);do v--;while(d(a[v],g)>0);if(_>=v)break;let S=a[_];a[_]=a[v],a[v]=S,S=t[_],t[_]=t[v],t[v]=S}e1(a,t,r,v,d),e1(a,t,v+1,c,d)}const rM=11102230246251565e-32,Ts=134217729,dN=(3+8*rM)*rM;function t1(a,t,r,c,d){let g,_,v,S,T=t[0],M=c[0],A=0,z=0;M>T==M>-T?(g=T,T=t[++A]):(g=M,M=c[++z]);let D=0;if(A<a&&z<r)for(M>T==M>-T?(_=T+g,v=g-(_-T),T=t[++A]):(_=M+g,v=g-(_-M),M=c[++z]),g=_,v!==0&&(d[D++]=v);A<a&&z<r;)M>T==M>-T?(_=g+T,S=_-g,v=g-(_-S)+(T-S),T=t[++A]):(_=g+M,S=_-g,v=g-(_-S)+(M-S),M=c[++z]),g=_,v!==0&&(d[D++]=v);for(;A<a;)_=g+T,S=_-g,v=g-(_-S)+(T-S),T=t[++A],g=_,v!==0&&(d[D++]=v);for(;z<r;)_=g+M,S=_-g,v=g-(_-S)+(M-S),M=c[++z],g=_,v!==0&&(d[D++]=v);return g===0&&D!==0||(d[D++]=g),D}function dg(a){return new Float64Array(a)}const _f=dg(4),oM=dg(8),sM=dg(12),aM=dg(16),$s=dg(4);function fg(a,t,r){t===null?(a.inOut=!1,a.otherInOut=!0):(a.isSubject===t.isSubject?(a.inOut=!t.inOut,a.otherInOut=t.otherInOut):(a.inOut=!t.otherInOut,a.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(a.prevInResult=!lM(t,r)||t.isVertical()?t.prevInResult:t)),a.resultTransition=lM(a,r)?(function(c,d){let g,_=!c.inOut,v=!c.otherInOut;switch(d){case 0:g=_&&v;break;case 1:g=_||v;break;case 3:g=_!==v;break;case 2:g=c.isSubject?_&&!v:v&&!_}return g?1:-1})(a,r):0}function lM(a,t){switch(a.type){case 0:switch(t){case 0:return!a.otherInOut;case 1:return a.otherInOut;case 2:return a.isSubject&&a.otherInOut||!a.isSubject&&!a.otherInOut;case 3:return!0}break;case 2:return t===0||t===1;case 3:return t===2;case 1:return!1}return!1}class yf{constructor(t,r,c,d,g){this.left=r,this.point=t,this.otherEvent=c,this.isSubject=d??!1,this.type=g||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(t){const r=this.point,c=this.otherEvent.point;return this.left?(r[0]-t[0])*(c[1]-t[1])-(c[0]-t[0])*(r[1]-t[1])>0:(c[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(c[1]-t[1])>0}isAbove(t){return!this.isBelow(t)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const t=new yf(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.contourId=this.contourId,t.resultTransition=this.resultTransition,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}}function Xl(a,t){return a[0]===t[0]&&a[1]===t[1]}function i1(a,t,r){const c=(function(d,g,_,v,S,T){const M=(g-T)*(_-S),A=(d-S)*(v-T),z=M-A;if(M===0||A===0||M>0!=A>0)return z;const D=Math.abs(M+A);return Math.abs(z)>=33306690738754716e-32*D?z:-(function(k,$,H,j,X,Y,te){let ue,le,ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot,Ge,ct,et,ut,lt;const Bt=k-X,Ut=H-X,Tt=$-Y,Mt=j-Y;Ge=Bt*Mt,we=Ts*Bt,Ie=we-(we-Bt),Je=Bt-Ie,we=Ts*Mt,qe=we-(we-Mt),Xe=Mt-qe,ct=Je*Xe-(Ge-Ie*qe-Je*qe-Ie*Xe),et=Tt*Ut,we=Ts*Tt,Ie=we-(we-Tt),Je=Tt-Ie,we=Ts*Ut,qe=we-(we-Ut),Xe=Ut-qe,ut=Je*Xe-(et-Ie*qe-Je*qe-Ie*Xe),at=ct-ut,me=ct-at,_f[0]=ct-(at+me)+(me-ut),nt=Ge+at,me=nt-Ge,ot=Ge-(nt-me)+(at-me),at=ot-et,me=ot-at,_f[1]=ot-(at+me)+(me-et),lt=nt+at,me=lt-nt,_f[2]=nt-(lt-me)+(at-me),_f[3]=lt;let li=(function(pn,Hi){let Pn=Hi[0];for(let an=1;an<4;an++)Pn+=Hi[an];return Pn})(0,_f),Yt=22204460492503146e-32*te;if(li>=Yt||-li>=Yt||(me=k-Bt,ue=k-(Bt+me)+(me-X),me=H-Ut,ge=H-(Ut+me)+(me-X),me=$-Tt,le=$-(Tt+me)+(me-Y),me=j-Mt,ye=j-(Mt+me)+(me-Y),ue===0&&le===0&&ge===0&&ye===0)||(Yt=11093356479670487e-47*te+dN*Math.abs(li),li+=Bt*ye+Mt*ue-(Tt*ge+Ut*le),li>=Yt||-li>=Yt))return li;Ge=ue*Mt,we=Ts*ue,Ie=we-(we-ue),Je=ue-Ie,we=Ts*Mt,qe=we-(we-Mt),Xe=Mt-qe,ct=Je*Xe-(Ge-Ie*qe-Je*qe-Ie*Xe),et=le*Ut,we=Ts*le,Ie=we-(we-le),Je=le-Ie,we=Ts*Ut,qe=we-(we-Ut),Xe=Ut-qe,ut=Je*Xe-(et-Ie*qe-Je*qe-Ie*Xe),at=ct-ut,me=ct-at,$s[0]=ct-(at+me)+(me-ut),nt=Ge+at,me=nt-Ge,ot=Ge-(nt-me)+(at-me),at=ot-et,me=ot-at,$s[1]=ot-(at+me)+(me-et),lt=nt+at,me=lt-nt,$s[2]=nt-(lt-me)+(at-me),$s[3]=lt;const Ct=t1(4,_f,4,$s,oM);Ge=Bt*ye,we=Ts*Bt,Ie=we-(we-Bt),Je=Bt-Ie,we=Ts*ye,qe=we-(we-ye),Xe=ye-qe,ct=Je*Xe-(Ge-Ie*qe-Je*qe-Ie*Xe),et=Tt*ge,we=Ts*Tt,Ie=we-(we-Tt),Je=Tt-Ie,we=Ts*ge,qe=we-(we-ge),Xe=ge-qe,ut=Je*Xe-(et-Ie*qe-Je*qe-Ie*Xe),at=ct-ut,me=ct-at,$s[0]=ct-(at+me)+(me-ut),nt=Ge+at,me=nt-Ge,ot=Ge-(nt-me)+(at-me),at=ot-et,me=ot-at,$s[1]=ot-(at+me)+(me-et),lt=nt+at,me=lt-nt,$s[2]=nt-(lt-me)+(at-me),$s[3]=lt;const bi=t1(Ct,oM,4,$s,sM);Ge=ue*ye,we=Ts*ue,Ie=we-(we-ue),Je=ue-Ie,we=Ts*ye,qe=we-(we-ye),Xe=ye-qe,ct=Je*Xe-(Ge-Ie*qe-Je*qe-Ie*Xe),et=le*ge,we=Ts*le,Ie=we-(we-le),Je=le-Ie,we=Ts*ge,qe=we-(we-ge),Xe=ge-qe,ut=Je*Xe-(et-Ie*qe-Je*qe-Ie*Xe),at=ct-ut,me=ct-at,$s[0]=ct-(at+me)+(me-ut),nt=Ge+at,me=nt-Ge,ot=Ge-(nt-me)+(at-me),at=ot-et,me=ot-at,$s[1]=ot-(at+me)+(me-et),lt=nt+at,me=lt-nt,$s[2]=nt-(lt-me)+(at-me),$s[3]=lt;const qi=t1(bi,sM,4,$s,aM);return aM[qi-1]})(d,g,_,v,S,T,D)})(a[0],a[1],t[0],t[1],r[0],r[1]);return c>0?-1:c<0?1:0}function wu(a,t){const r=a.point,c=t.point;return r[0]>c[0]?1:r[0]<c[0]?-1:r[1]!==c[1]?r[1]>c[1]?1:-1:(function(d,g,_){return d.left!==g.left?d.left?1:-1:i1(_,d.otherEvent.point,g.otherEvent.point)!==0?d.isBelow(g.otherEvent.point)?-1:1:!d.isSubject&&g.isSubject?1:-1})(a,t,r)}function Su(a,t,r){const c=new yf(t,!1,a,a.isSubject),d=new yf(t,!0,a.otherEvent,a.isSubject);return Xl(a.point,a.otherEvent.point)&&console.warn("what is that, a collapsed segment?",a),c.contourId=d.contourId=a.contourId,wu(d,a.otherEvent)>0&&(a.otherEvent.left=!0,d.left=!1),a.otherEvent.otherEvent=d,a.otherEvent=c,r.push(d),r.push(c),r}function Xv(a,t){return a[0]*t[1]-a[1]*t[0]}function n1(a,t){return a[0]*t[0]+a[1]*t[1]}function r1(a,t,r){const c=(function(S,T,M,A){const z=[T[0]-S[0],T[1]-S[1]],D=[A[0]-M[0],A[1]-M[1]];function k(ge,ye,me){return[ge[0]+ye*me[0],ge[1]+ye*me[1]]}const $=[M[0]-S[0],M[1]-S[1]];let H=Xv(z,D),j=H*H;const X=n1(z,z);if(j>0){const ge=Xv($,D)/H;if(ge<0||ge>1)return null;const ye=Xv($,z)/H;return ye<0||ye>1?null:ge===0||ge===1?[k(S,ge,z)]:ye===0||ye===1?[k(M,ye,D)]:[k(S,ge,z)]}if(H=Xv($,z),j=H*H,j>0)return null;const Y=n1(z,$)/X,te=Y+n1(z,D)/X,ue=Math.min(Y,te),le=Math.max(Y,te);return ue<=1&&le>=0?ue===1?[k(S,ue>0?ue:0,z)]:le===0?[k(S,le<1?le:1,z)]:[k(S,ue>0?ue:0,z),k(S,le<1?le:1,z)]:null})(a.point,a.otherEvent.point,t.point,t.otherEvent.point),d=c?c.length:0;if(d===0||d===1&&(Xl(a.point,t.point)||Xl(a.otherEvent.point,t.otherEvent.point))||d===2&&a.isSubject===t.isSubject)return 0;if(d===1)return!Xl(a.point,c[0])&&!Xl(a.otherEvent.point,c[0])&&Su(a,c[0],r),!Xl(t.point,c[0])&&!Xl(t.otherEvent.point,c[0])&&Su(t,c[0],r),1;const g=[];let _=!1,v=!1;return Xl(a.point,t.point)?_=!0:wu(a,t)===1?g.push(t,a):g.push(a,t),Xl(a.otherEvent.point,t.otherEvent.point)?v=!0:wu(a.otherEvent,t.otherEvent)===1?g.push(t.otherEvent,a.otherEvent):g.push(a.otherEvent,t.otherEvent),_&&v||_?(t.type=1,a.type=t.inOut===a.inOut?2:3,_&&!v&&Su(g[1].otherEvent,g[0].point,r),2):v?(Su(g[0],g[1].point,r),3):g[0]!==g[3].otherEvent?(Su(g[0],g[1].point,r),Su(g[1],g[2].point,r),3):(Su(g[0],g[1].point,r),Su(g[3].otherEvent,g[2].point,r),3)}function fN(a,t){if(a===t)return 0;if(i1(a.point,a.otherEvent.point,t.point)!==0||i1(a.point,a.otherEvent.point,t.otherEvent.point)!==0)return Xl(a.point,t.point)?a.isBelow(t.otherEvent.point)?-1:1:a.point[0]===t.point[0]?a.point[1]<t.point[1]?-1:1:wu(a,t)===1?t.isAbove(a.point)?-1:1:a.isBelow(t.point)?-1:1;if(a.isSubject!==t.isSubject)return a.isSubject?-1:1;{let r=a.point,c=t.point;if(r[0]===c[0]&&r[1]===c[1])return r=a.otherEvent.point,c=t.otherEvent.point,r[0]===c[0]&&r[1]===c[1]?0:(a.contourId??0)>(t.contourId??0)?1:-1}return wu(a,t)===1?1:-1}class pN{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function mN(a,t,r,c){let d,g=a+1,_=t[a].point;const v=t.length;for(g<v&&(d=t[g].point);g<v&&d[0]===_[0]&&d[1]===_[1];){if(!r[g])return g;g++,g<v&&(d=t[g].point)}for(g=a-1;r[g]&&g>c;)g--;return g}function gN(a,t,r){const c=new pN;if(a.prevInResult!=null){const d=a.prevInResult,g=d.outputContourId;if(d.resultTransition>0){const _=t[g];if(_.holeOf!=null){const v=_.holeOf;t[v].holeIds.push(r),c.holeOf=v,c.depth=t[g].depth}else t[g].holeIds.push(r),c.holeOf=g,c.depth=t[g].depth+1}else c.holeOf=null,c.depth=t[g].depth}else c.holeOf=null,c.depth=0;return c}const cM=Math.max,uM=Math.min;let Jv=0;function hM(a,t,r,c,d,g){let _,v,S,T,M,A;for(_=0,v=a.length-1;_<v;_++){if(S=a[_],T=a[_+1],M=new yf(S,!1,void 0,t),A=new yf(T,!1,M,t),M.otherEvent=A,S[0]===T[0]&&S[1]===T[1])continue;M.contourId=A.contourId=r,g||(M.isExteriorRing=!1,A.isExteriorRing=!1),wu(M,A)>0?A.left=!0:M.left=!0;const z=S[0],D=S[1];d[0]=uM(d[0],z),d[1]=uM(d[1],D),d[2]=cM(d[2],z),d[3]=cM(d[3],D),c.push(M),c.push(A)}}const Yv=[];function dM(a,t,r){let c=a,d=t;typeof a[0][0][0]=="number"&&(c=[a]),typeof t[0][0][0]=="number"&&(d=[t]);let g=(function(z,D,k){let $=null;return z.length*D.length===0&&(k===0?$=Yv:k===2?$=z:(k===1||k===3)&&($=z.length===0?D:z)),$})(c,d,r);if(g)return g===Yv?null:g;const _=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],S=(function(z,D,k,$,H){const j=new dh(void 0,wu);let X,Y,te,ue,le,ge;for(te=0,ue=z.length;te<ue;te++)for(X=z[te],le=0,ge=X.length;le<ge;le++)Y=le===0,Y&&Jv++,hM(X[le],!0,Jv,j,k,Y);for(te=0,ue=D.length;te<ue;te++)for(X=D[te],le=0,ge=X.length;le<ge;le++)Y=le===0,H===2&&(Y=!1),Y&&Jv++,hM(X[le],!1,Jv,j,$,Y);return j})(c,d,_,v,r);if(g=(function(z,D,k,$,H){let j=null;return(k[0]>$[2]||$[0]>k[2]||k[1]>$[3]||$[1]>k[3])&&(H===0?j=Yv:H===2?j=z:(H===1||H===3)&&(j=z.concat(D))),j})(c,d,_,v,r),g)return g===Yv?null:g;const T=(function(z,D,k,$,H,j){const X=new Kw(fN),Y=[],te=Math.min($[2],H[2]);let ue,le,ge;for(;z.length!==0;){let ye=z.pop();if(Y.push(ye),j===0&&ye.point[0]>te||j===2&&ye.point[0]>$[2])break;if(ye.left){le=ue=X.insert(ye),ge=X.minNode(),ue=ue!==ge?X.prev(ue):null,le=X.next(le);const me=ue?ue.key:null;let we;if(fg(ye,me,j),le&&r1(ye,le.key,z)===2&&(fg(ye,me,j),fg(le.key,ye,j)),ue&&r1(ue.key,ye,z)===2){let Ie=ue;Ie=Ie!==ge?X.prev(Ie):null,we=Ie?Ie.key:null,fg(me,we,j),fg(ye,me,j)}}else ye=ye.otherEvent,le=ue=X.find(ye),ue&&le&&(ue=ue!==ge?X.prev(ue):null,le=X.next(le),X.remove(ye),le&&ue&&r1(ue.key,le.key,z))}return Y})(S,0,0,_,v,r),M=(function(z){let D,k;const $=(function(X){let Y,te,ue,le,ge;const ye=[];for(te=0,ue=X.length;te<ue;te++)Y=X[te],(Y.left&&Y.inResult||!Y.left&&Y.otherEvent.inResult)&&ye.push(Y);let me=!1;for(;!me;)for(me=!0,te=0,ue=ye.length;te<ue;te++)te+1<ue&&wu(ye[te],ye[te+1])===1&&(le=ye[te],ye[te]=ye[te+1],ye[te+1]=le,me=!1);for(te=0,ue=ye.length;te<ue;te++)Y=ye[te],Y.otherPos=te;for(te=0,ue=ye.length;te<ue;te++)Y=ye[te],Y.left||(ge=Y.otherPos,Y.otherPos=Y.otherEvent.otherPos,Y.otherEvent.otherPos=ge);return ye})(z),H={},j=[];for(D=0,k=$.length;D<k;D++){if(H[D])continue;const X=j.length,Y=gN($[D],j,X),te=ge=>{H[ge]=!0,ge<$.length&&$[ge]&&($[ge].outputContourId=X)};let ue=D,le=D;for(Y.points.push($[D].point);te(ue),ue=$[ue].otherPos,te(ue),Y.points.push($[ue].point),ue=mN(ue,$,H,le),!(ue==le||ue>=$.length)&&$[ue];);j.push(Y)}return j})(T),A=[];for(let z=0;z<M.length;z++){let D=M[z];if(D.isExterior()){let k=[D.points];for(let $=0;$<D.holeIds.length;$++)k.push(M[D.holeIds[$]].points);A.push(k)}}return A}function Kv(a,t,r,c){const d=[],g=c===0?(_,v,S,T,M,A)=>{_.push(new Ae(A,S+(A-v)/(T-v)*(M-S)))}:(_,v,S,T,M,A)=>{_.push(new Ae(v+(A-S)/(M-S)*(T-v),A))};for(const _ of a){const v=[];for(const S of _){if(S.length<=2)continue;const T=[];for(let z=0;z<S.length-1;z++){const D=S[z].x,k=S[z].y,$=S[z+1].x,H=S[z+1].y,j=c===0?D:k,X=c===0?$:H;j<t?X>t&&g(T,D,k,$,H,t):j>r?X<r&&g(T,D,k,$,H,r):T.push(S[z]),X<t&&j>=t&&g(T,D,k,$,H,t),X>r&&j<=r&&g(T,D,k,$,H,r)}let M=S[S.length-1];const A=c===0?M.x:M.y;A>=t&&A<=r&&T.push(M),T.length&&(M=T[T.length-1],T[0].x===M.x&&T[0].y===M.y||T.push(T[0]),v.push(T))}v.length&&d.push(v)}return d}function _N(a,t){const r=dM(o1(a),o1([t]),0);return r==null?[]:fM(r)}function yN(a,t){let c=o1(a,65536);const d=[];for(;t.valid();t.next()){const[g,_]=t.get(),v=g.x*65536,S=g.y*65536,T=_.x*65536,M=_.y*65536,A=T-v,z=M-S,D=Math.hypot(A,z);if(D===0)continue;const k=Math.trunc(z/D*3),$=-Math.trunc(A/D*3);d.push([[[v,S],[T,M],[T+k,M+$],[v+k,S+$],[v,S]]])}return d.length>0&&(c=dM(c,d,2)),fM(c,1/65536,128)}function o1(a,t=1){return[a.map(r=>r.map(c=>[c.x*t,c.y*t]))]}function fM(a,t=1,r){return a.map(c=>c.map((d,g)=>{const _=d.map(v=>{let S=v[0],T=v[1];return r&&(S=Math.round(S/r)*r,T=Math.round(T/r)*r),new Ae(S*t,T*t)._round()});return g>0&&_.reverse(),_}))}class s1{constructor(t,r){this.layoutVertexArray=new Zl,this.indexArray=new Hr,this.lineIndexArray=new Os,this.triangleSegments=new er,this.lineSegments=new er,this.programConfigurations=new R(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new yo)}update(t,r,c,d,g,_,v,S){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,S)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,J4.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,Y4.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(t,r,c,d,g,_,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,c,d,g,_,void 0,v)}}class a1{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=t.lut,this.bufferData=new s1(t,!1),this.elevationBufferData=new s1(t,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=t.sourceLayerIndex,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){this.hasPattern=Jw("fill",this.layers,this.pixelRatio,r);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:S,index:T,sourceLayerIndex:M}of t){const A=this.layers[0]._featureFilter.needGeometry,z=Ni(v,A);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),z,c))continue;const D=g?g.evaluate(z,{},c,r.availableImages):void 0,k={id:S,properties:v.properties,type:v.type,sourceLayerIndex:M,index:T,geometry:A?z.geometry:pi(v,c,d),patterns:{},sortKey:D};_.push(k)}g&&_.sort((v,S)=>v.sortKey-S.sortKey);for(const v of _){const{geometry:S,index:T,sourceLayerIndex:M}=v;if(this.hasPattern){const A=Yw("fill",this.layers,v,this.zoom,this.pixelRatio,r);this.patternFeatures.push(A)}else this.addFeature(v,S,T,c,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(t[T].feature,S,T,M,this.index)}}update(t,r,c,d,g,_,v){this.bufferData.update(t,r,c,d,g,_,v,this.worldview),this.elevationBufferData.update(t,r,c,d,g,_,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(t,r,c,d,g,_,v,this.worldview)}addFeatures(t,r,c,d,g,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,c,d,_,t.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(t,r,c,d,g,_=[],v,S){const T=hg(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(t,T,d,c,S):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(t,c,g,_,d,v,this.worldview),this.elevationBufferData.populatePaintArrays(t,c,g,_,d,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(t,r,c,d,g){this.elevatedStructures&&(this.elevatedStructures.construct(t),this.elevatedStructures.populatePaintArrays(r,c,d,g,this.worldview))}addElevatedRoadFeature(t,r,c,d,g){const _=new Array,v=Go.getElevationFeature(t,g);if(!v)return void this.addGeometry(r,this.bufferData);{const T=this.clipPolygonsToTile(r,1);T.length>0&&_.push({polygons:T,elevationFeature:v,elevationTileID:c})}const S={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(t,{},c),featureIndex:d};for(const T of _)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Us(T.elevationTileID,this.layers,this.zoom,this.lut));const A=T.elevationFeature.isTunnel();let z=0;t.properties.hasOwnProperty(Fi)&&(z=+t.properties[Fi]),this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,T.polygons,A,T.elevationFeature,z)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const M=new oa(c,T.elevationTileID);this.addElevatedGeometry(T.polygons,M,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,S)}}addElevatedGeometry(t,r,c,d,g,_){const v={elevation:c,elevationSampler:r,bias:d,index:g,featureInfo:_},[S,T]=this.addGeometry(t,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:S,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,S),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(t,r,c){let d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,_=null;c&&(_=c.elevationSampler.constantElevation(c.elevation,c.bias),_!=null&&(d=_,g=_));const v=(S,T,M)=>{if(c!=null)if(T.push(S),_!=null)r.elevatedLayoutVertexArray.emplaceBack(_),M.push(_);else{const A=c.elevationSampler.pointElevation(S,c.elevation,c.bias);r.elevatedLayoutVertexArray.emplaceBack(A),M.push(A),d=Math.min(d,A),g=Math.max(g,A)}};for(const S of t){let T=0;for(const Y of S)T+=Y.length;const M=r.triangleSegments.prepareSegment(T,r.layoutVertexArray,r.indexArray),A=M.vertexLength,z=[],D=[],k=[],$=[],H=[],j=r.layoutVertexArray.length;for(const Y of S){if(Y.length===0)continue;Y!==S[0]&&D.push(z.length/2);const te=r.lineSegments.prepareSegment(Y.length,r.layoutVertexArray,r.lineIndexArray),ue=te.vertexLength;c&&H.push(r.layoutVertexArray.length-j),v(Y[0],k,$),r.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),r.lineIndexArray.emplaceBack(ue+Y.length-1,ue),z.push(Y[0].x),z.push(Y[0].y);for(let le=1;le<Y.length;le++)v(Y[le],k,$),r.layoutVertexArray.emplaceBack(Y[le].x,Y[le].y),r.lineIndexArray.emplaceBack(ue+le-1,ue+le),z.push(Y[le].x),z.push(Y[le].y);te.vertexLength+=Y.length,te.primitiveLength+=Y.length}const X=mf(z,D);for(let Y=0;Y<X.length;Y+=3)r.indexArray.emplaceBack(A+X[Y],A+X[Y+1],A+X[Y+2]);if(X.length>0&&c&&this.elevationMode==="hd-road-base"){const Y=c.elevation.isTunnel(),te=c.elevation.safeArea,ue=this.elevatedStructures.addVertices(k,$);this.elevatedStructures.addTriangles(X,ue,Y);const le=H.length;if(le>0){for(let ge=0;ge<le-1;ge++)this.elevatedStructures.addRenderableRing(c.index,H[ge]+ue,H[ge+1]-H[ge],Y,te,c.featureInfo);this.elevatedStructures.addRenderableRing(c.index,H[le-1]+ue,k.length-H[le-1],Y,te,c.featureInfo)}}M.vertexLength+=T,M.primitiveLength+=X.length/3}return[d,g]}prepareElevatedPolygons(t,r,c){const d=1/vt(c),g=[];for(const _ of t){const v=yN(_,new bs(r,d));g.push(...v)}return g}clipPolygonsToTile(t,r){const c=-r,d=-r,g=It+r,_=It+r;let v=0;const S=[],T=[];for(;v<t.length;v++){const z=t[v],D=hh(z);(D.min.x>=c&&D.max.x<=g&&D.min.y>=d&&D.max.y<=_?S:T).push(z)}if(S.length===t.length)return t;const M=[new Ae(c,d),new Ae(g,d),new Ae(g,_),new Ae(c,_),new Ae(c,d)],A=S;for(const z of T)A.push(..._N(z,M));return A}}let pM,mM,gM,_M;jt(a1,"FillBucket",{omit:["layers","patternFeatures"]}),jt(s1,"FillBufferData"),jt(Us,"ElevatedStructures");class Qv{constructor(t,r,c,d){if(this.triangleCount=r.length/3,this.min=new Ae(0,0),this.max=new Ae(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[g,_]=[t[0].clone(),t[0].clone()];for(let A=1;A<t.length;++A){const z=t[A];g.x=Math.min(g.x,z.x),g.y=Math.min(g.y,z.y),_.x=Math.max(_.x,z.x),_.y=Math.max(_.y,z.y)}if(d){const A=Math.ceil(Math.max(_.x-g.x,_.y-g.y)/d);c=Math.max(c,A)}if(c===0)return;this.min=g,this.max=_;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const S=Math.max(v.x,v.y)/c;this.cellsX=Math.max(1,Math.ceil(v.x/S)),this.cellsY=Math.max(1,Math.ceil(v.y/S)),this.xScale=1/S,this.yScale=1/S;const T=[];for(let A=0;A<this.triangleCount;A++){const z=t[r[3*A+0]].sub(this.min),D=t[r[3*A+1]].sub(this.min),k=t[r[3*A+2]].sub(this.min),$=Jl(Math.floor(Math.min(z.x,D.x,k.x)),this.xScale,this.cellsX),H=Jl(Math.floor(Math.max(z.x,D.x,k.x)),this.xScale,this.cellsX),j=Jl(Math.floor(Math.min(z.y,D.y,k.y)),this.yScale,this.cellsY),X=Jl(Math.floor(Math.max(z.y,D.y,k.y)),this.yScale,this.cellsY),Y=new Ae(0,0),te=new Ae(0,0),ue=new Ae(0,0),le=new Ae(0,0);for(let ge=j;ge<=X;++ge){Y.y=te.y=ge*S,ue.y=le.y=(ge+1)*S;for(let ye=$;ye<=H;++ye)Y.x=ue.x=ye*S,te.x=le.x=(ye+1)*S,(pl(z,D,k,Y,te,le)||pl(z,D,k,Y,le,ue))&&T.push({cellIdx:ge*this.cellsX+ye,triIdx:A})}}if(T.length===0)return;T.sort((A,z)=>A.cellIdx-z.cellIdx||A.triIdx-z.triIdx);let M=0;for(;M<T.length;){const A=T[M].cellIdx,z={start:this.payload.length,len:0};for(;M<T.length&&T[M].cellIdx===A;)++z.len,this.payload.push(T[M++].triIdx);this.cells[A]=z}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,r){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const c=Jl(t.x-this.min.x,this.xScale,this.cellsX),d=Jl(t.y-this.min.y,this.yScale,this.cellsY),g=this.cells[d*this.cellsX+c];if(g){this._lazyInitLookup();for(let _=0;_<g.len;_++){const v=this.payload[g.start+_],S=Math.floor(v/8),T=1<<v%8;if(!(this.lookup[S]&T)&&(this.lookup[S]|=T,r.push(v),r.length===this.triangleCount))return}}}query(t,r,c){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>r.x||t.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const d=Jl(t.x-this.min.x,this.xScale,this.cellsX),g=Jl(r.x-this.min.x,this.xScale,this.cellsX),_=Jl(t.y-this.min.y,this.yScale,this.cellsY),v=Jl(r.y-this.min.y,this.yScale,this.cellsY);for(let S=_;S<=v;S++)for(let T=d;T<=g;T++){const M=this.cells[S*this.cellsX+T];if(M)for(let A=0;A<M.len;A++){const z=this.payload[M.start+A],D=Math.floor(z/8),k=1<<z%8;if(!(this.lookup[D]&k)&&(this.lookup[D]|=k,c.push(z),c.length===this.triangleCount))return}}}}function Jl(a,t,r){return Math.max(0,Math.min(r-1,Math.floor(a*t)))}jt(Qv,"TriangleGridIndex");class yM{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){for(const c of this.footprints)r.push({footprint:c,id:t})}updateAppearances(t,r,c,d){}populate(t,r,c,d){const g=[];for(const{feature:_,id:v,index:S,sourceLayerIndex:T}of t){const M=this.layers[0]._featureFilter.needGeometry,A=Ni(_,M);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),A,c))continue;const z={id:v,properties:_.properties,type:_.type,sourceLayerIndex:T,index:S,geometry:M?A.geometry:pi(_,c,d),patterns:{}};g.push(z)}for(const _ of g){const{geometry:v,index:S,sourceLayerIndex:T}=_;this.addFeature(_,v,S,c,{},r.availableImages,r.brightness),r.featureIndex.insert(t[S].feature,v,S,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,r,c,d,g,_,v){}destroy(){}addFeature(t,r,c,d,g,_=[],v){for(const S of hg(r,2)){const T=[],M=[],A=[],z=new Ae(1/0,1/0),D=new Ae(-1/0,-1/0);for(const H of S)if(H.length!==0){H!==S[0]&&A.push(M.length/2);for(let j=0;j<H.length;j++)M.push(H[j].x),M.push(H[j].y),T.push(H[j]),z.x=Math.min(z.x,H[j].x),z.y=Math.min(z.y,H[j].y),D.x=Math.max(D.x,H[j].x),D.y=Math.max(D.y,H[j].y)}const k=mf(M,A),$=new Qv(T,k,8,256);this.footprints.push({vertices:T,indices:k,grid:$,min:z,max:D})}}}jt(yM,"ClipBucket",{omit:["layers"]});const vN=Ki([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),xN=Ki([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),bN=Ki([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),wN=Ki([{name:"a_centroid_pos",components:2,type:"Uint16"}]),SN=Ki([{name:"a_join_normal_inside",components:3,type:"Int16"}]),TN=Ki([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),EN=Ki([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:IN}=vN,pg=Number.MAX_SAFE_INTEGER,MN=pg-1;function vM(a,t,r,c){return a.order<t||a.order===pg||!(a.clipMask&r)||(function(d,g){return g.length!==0&&g.find(_=>_===d)===void 0})(c,a.clipScope)}function ex(a,t){return a.x-t.x||a.y-t.y}function xM(a,t){return ex(a.min,t.min)===0&&ex(a.max,t.max)===0}function l1(a,t){return!(a.min.x>t.max.x||a.max.x<t.min.x||a.min.y>t.max.y||a.max.y<t.min.y)}function tx(a,t){if(a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(a[r].sourceId!==t[r].sourceId||!xM(a[r],t[r])||a[r].order!==t[r].order||a[r].clipMask!==t[r].clipMask||!Ot(a[r].clipScope,t[r].clipScope))return!1;return!0}function bM(a,t,r){const c=1/It,d=1/(1<<r.canonical.z),g=(t.x*c+r.canonical.x)*d+r.wrap,_=(t.y*c+r.canonical.y)*d;return{min:new Ae((a.x*c+r.canonical.x)*d+r.wrap,(a.y*c+r.canonical.y)*d),max:new Ae(g,_)}}function AN(a,t,r){const c=1<<r.canonical.z,d=((t.x-r.wrap)*c-r.canonical.x)*It,g=(t.y*c-r.canonical.y)*It;return{min:new Ae(((a.x-r.wrap)*c-r.canonical.x)*It,(a.y*c-r.canonical.y)*It),max:new Ae(d,g)}}function c1(a,t,r,c,d,g,_){const v=a.indices,S=a.vertices,T=[];for(let M=c;M<c+d;M+=3){const A=t[r[M+0]+g],z=t[r[M+1]+g],D=t[r[M+2]+g],k=Math.min(A.x,z.x,D.x),$=Math.max(A.x,z.x,D.x),H=Math.min(A.y,z.y,D.y),j=Math.max(A.y,z.y,D.y);T.length=0,a.grid.query(new Ae(k,H),new Ae($,j),T);for(let X=0;X<T.length;X++){const Y=T[X];if(pl(S[v[3*Y+0]],S[v[3*Y+1]],S[v[3*Y+2]],A,z,D,_))return!0}}return!1}function wM(a,t,r,c){if(!a||!r)return!1;let d=a.vertices;if(!t.canonical.equals(c.canonical)||t.wrap!==c.wrap){if(r.vertices.length<a.vertices.length)return wM(r,c,a,t);const g=t.canonical,_=c.canonical,v=Math.pow(2,_.z-g.z);d=a.vertices.map(S=>new Ae((S.x+g.x*It)*v-_.x*It,(S.y+g.y*It)*v-_.y*It))}return c1(r,d,a.indices,0,a.indices.length,0,0)}function SM(a,t,r,c){const d=Math.pow(2,c.z-r.z);return new Ae((a+r.x*It)*d-c.x*It,(t+r.y*It)*d-c.y*It)}function TM(a,t){const r=[];t.grid.queryPoint(a,r);const c=t.indices,d=t.vertices;for(let g=0;g<r.length;g++){const _=r[g];if(Ss([d[c[3*_+0]],d[c[3*_+1]],d[c[3*_+2]]],a))return!0}return!1}const u1=[new Ae(0,0),new Ae(It,0),new Ae(It,It),new Ae(0,It)];function EM(a,t){const r=[];let c=[];if(!t||a.length<2)return[a];if(a.length===2)return Na(a[0],a[1],u1)?[a]:[];for(let d=0;d<a.length+2;d++){const g=a[d%a.length],_=a[(d+1)%a.length],v=Na(d===0?a[a.length-1]:a[(d-1)%a.length],g,u1),S=Na(g,_,u1),T=v||S;T&&c.push(g),T&&S||c.length>0&&(c.length>1&&r.push(c),c=[])}return c.length>1&&r.push(c),r}const h1=en.types,PN=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],zN=["fill-extrusion-flood-light-ground-radius"],CN=Math.pow(2,13),LN=Math.pow(2,15)-1,IM=new Ae(0,1),Ac=2147483648;function mg(a,t,r,c,d,g,_,v){a.emplaceBack((t<<1)+_,(r<<1)+g,(Math.floor(c*CN)<<1)+d,Math.round(v))}function gg(a,t,r){a.emplaceBack(t.x*It,t.y*It,r?1:0)}function ix(a,t,r,c,d,g){a.emplaceBack(t.x,t.y,(r.x<<1)+c,(r.y<<1)+d,g)}function _g(a,t,r){a.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class MM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class AM{constructor(){this.centroidXY=new Ae(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ae(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ae(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}}class PM{constructor(){this.acc=new Ae(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,r){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=r.x,t.min.y=t.max.y=r.y)}appendEdge(t,r,c){this.accCount++,this.acc._add(r);let d=!!this.borders;r.x<t.min.x?(t.min.x=r.x,d=!0):r.x>t.max.x&&(t.max.x=r.x,d=!0),r.y<t.min.y?(t.min.y=r.y,d=!0):r.y>t.max.y&&(t.max.y=r.y,d=!0),((r.x===0||r.x===It)&&r.x===c.x)!=((r.y===0||r.y===It)&&r.y===c.y)&&this.processBorderOverlap(r,c),d&&this.checkBorderIntersection(r,c)}checkBorderIntersection(t,r){r.x<0!=t.x<0&&this.addBorderIntersection(0,di(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>It!=t.x>It&&this.addBorderIntersection(1,di(r.y,t.y,(It-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,di(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>It!=t.y>It&&this.addBorderIntersection(3,di(r.x,t.x,(It-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];r<c[0]&&(c[0]=r),r>c[1]&&(c[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,r.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,r.x),this.addBorderIntersection(c,t.x)}}centroid(){return this.accCount===0?new Ae(0,0):new Ae(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0):0}}function zM(a,t){const r=a.add(t)._unit(),c=de(a.x*r.x+a.y*r.y,-1,1);var d,g,_;return _=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(_)))/4*LN*((d=a).x*(g=t).y-d.y*g.x<0?-1:1)}const RN=[a=>a.x<0,a=>a.x>It,a=>a.y<0,a=>a.y>It];function DN(a,t,r,c){const d=[4];if(c===0)return d;r._mult(c);const g=a.sub(r),_=t.sub(r),v=[a,t,g,_];for(let S=0;S<4;S++)for(const T of v)if(RN[S](T)){d.push(S);break}return d}class d1{constructor(t){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new qm,this.indexArray=new Hr,this.programConfigurations=new R(t.layers,{zoom:t.zoom,lut:t.lut},r=>zN.includes(r)),this._segments=new er,this.hiddenByLandmarkVertexArray=new hf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new er}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,r,c,d=!1){const g=t.length;if(g>2){let _=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let S;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const T=t[0],M=t[1];S=zM(T.sub(t[g-1])._perp()._unit(),M.sub(T)._perp()._unit())}for(let T=0;T<g;T++){const M=T===g-1?0:T+1,A=t[T],z=t[M],D=t[M===g-1?0:M+1],k=z.sub(A)._perp()._unit(),$=zM(k,D.sub(z)._perp()._unit()),H=S,j=$;if(f1(A,z,r)||d&&RM(A,r)&&RM(z,r)){S=$;continue}const X=v.vertexLength;ix(this.vertexArray,A,z,1,1,H),ix(this.vertexArray,A,z,1,0,H),ix(this.vertexArray,A,z,0,1,j),ix(this.vertexArray,A,z,0,0,j),v.vertexLength+=4;const Y=DN(A,z,k,c);for(const te of Y)this._segmentToGroundQuads[_].push({id:X,region:te}),this._segmentToRegionTriCounts[_][te]+=2,v.primitiveLength+=2;S=$}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),r=t.length;for(let c=0;c<r;c++)this._segmentToGroundQuads[c].sort((d,g)=>d.region-g.region);for(let c=0;c<r;c++){const d=this._segmentToGroundQuads[c],g=t[c],_=this._segmentToRegionTriCounts[c];_.reduce((S,T)=>S+T,0);let v=0;for(let S=0;S<=4;S++){const T=_[S];if(T!==0){let M=this.regionSegments[S];M||(M=this.regionSegments[S]=new er);const A={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+v,vertexLength:g.vertexLength,primitiveLength:T};M.get().push(A)}v+=T}for(let S=0;S<d.length;S++){const T=d[S].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,r,c,d,g,_,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,r,c,d,g,_,void 0,v)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,xN.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=t.createVertexBuffer(this.groundRadiusArray,bN.members)))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,r,c,d,g,_,v,S){this.hasData()&&this.programConfigurations.updatePaintArrays(t,r,c,d,g,_,v,S)}updateHiddenByLandmark(t){this.updateHiddenByLandmarkRange(t.groundVertexArrayOffset,t.groundVertexCount,!!(t.flags&Ac))}updateHiddenByLandmarkRange(t,r,c){if(!this.hasData())return;const d=r+t;if(r!==0){for(let g=t;g<d;++g)this.hiddenByLandmarkVertexArray.emplace(g,c?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,TN.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const r=this.regionSegments[t];r&&r.destroy()}}}}class nx{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Hr,this.footprintVertices=new Zl,this.footprintSegments=[],this.layoutVertexArray=new fl,this.centroidVertexArray=new Rv,this.wallVertexArray=new Dv,this.indexArray=new Hr,this.programConfigurations=new R(t.layers,{zoom:t.zoom,lut:t.lut},r=>PN.includes(r)),this.segments=new er,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new d1(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){this.features=[],this.hasPattern=Jw("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=vt(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:_,index:v,sourceLayerIndex:S}of t){const T=this.layers[0]._featureFilter.needGeometry,M=Ni(g,T);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),M,c))continue;const A={id:_,sourceLayerIndex:S,index:v,geometry:T?M.geometry:pi(g,c,d),properties:g.properties,type:g.type,patterns:{}},z=this.layoutVertexArray.length,D=h1[A.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:Yw("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,r)});else if(this.wallMode)for(const k of A.geometry)for(const $ of EM(k,D))this.addFeature(g.id,A,[$],v,c,{},r.availableImages,d,r.brightness);else this.addFeature(g.id,A,A.geometry,v,c,{},r.availableImages,d,r.brightness);r.featureIndex.insert(g,A.geometry,v,S,this.index,z)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,r,c,d,g,_){for(const{featureId:v,feature:S}of this.features){const T=h1[S.type]==="Polygon",{geometry:M}=S;if(this.wallMode)for(const A of M)for(const z of EM(A,T))this.addFeature(v,S,[z],S.index,r,c,d,g,_);else this.addFeature(v,S,M,S.index,r,c,d,g,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,r,c,d,g,_,v){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,this.worldview),this.groundEffect.update(t,r,g,c,d,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,IN),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,SN.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,EN.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,wN.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,c,d,g,_,v,S,T){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,A=[new Ae(0,0),new Ae(It,It)],z=S.projection,D=z.name==="globe",k=this.wallMode||h1[r.type]==="Polygon",$=new PM;$.centroidDataIndex=this.centroidData.length;const H=new AM;H.buildingId=t,r.properties&&r.properties.hasOwnProperty("building_id")&&(H.buildingId=Number(r.properties.building_id));const j=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},g)<=0,X=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},g);let Y;if(H.height=X,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new mu),this.wallMode){if(D)return void vi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(c.length!==1)return;Y=(function(we){const Ie=we[0].x===we[we.length-1].x&&we[0].y===we[we.length-1].y;(function(Tt){let Mt=0;const li=Tt.length;for(let Yt=0;Yt<li;Yt++)Mt+=(Tt[(Yt+1)%li].x-Tt[Yt].x)*(Tt[(Yt+1)%li].y+Tt[Yt].y);return Mt>=0})(we)||(we=we.reverse());const qe={geometry:[],joinNormals:[],indices:[]},Xe=[],at=[],nt=[];let ot=we.length;for(;ot>=2&&we[ot-1].equals(we[ot-2]);)ot--;if(ot<(Ie?3:2))return qe;let Ge,ct,et,ut,lt,Bt=0;for(;Bt<ot-1&&we[Bt].equals(we[Bt+1]);)Bt++;Ie&&(Ge=we[ot-2],lt=we[Bt].sub(Ge)._unit()._perp());for(let Tt=Bt;Tt<ot;Tt++){if(et=Tt===ot-1?Ie?we[Bt+1]:void 0:we[Tt+1],et&&we[Tt].equals(et))continue;lt&&(ut=lt),Ge&&(ct=Ge),Ge=we[Tt],lt=et?et.sub(Ge)._unit()._perp():ut,ut=ut||lt;let Mt=ut.add(lt);Mt.x===0&&Mt.y===0||Mt._unit();const li=Mt.x*lt.x+Mt.y*lt.y,Yt=li!==0?1/li:1/0,Ct=ut.x*lt.y-ut.y*lt.x>0;let bi="miter";const qi=2;bi==="miter"&&Yt>qi&&(bi="bevel"),bi==="bevel"&&(Yt>100&&(bi="flipbevel"),Yt<qi&&(bi="miter"));const pn=(Hi,Pn,an,wr)=>{const cn=new Ae(Hi.x,Hi.y),In=new Ae(Hi.x,Hi.y);cn.x+=Pn.x*wr,cn.y+=Pn.y*wr,In.x-=Pn.x*Math.max(an,1),In.y-=Pn.y*Math.max(an,1),nt.push(Pn),Xe.push(cn),at.push(In)};if(bi==="miter")Mt._mult(Yt),pn(Ge,Mt,0,0);else if(bi==="flipbevel")Mt=lt.mult(-1),pn(Ge,Mt,0,0),pn(Ge,Mt.mult(-1),0,0);else{const Hi=-Math.sqrt(Yt*Yt-1),Pn=Ct?Hi:0,an=Ct?0:Hi;ct&&pn(Ge,ut,Pn,an),et&&pn(Ge,lt,Pn,an)}}qe.geometry=[...Xe,...at.reverse(),Xe[0]],qe.joinNormals=[...nt,...nt.reverse(),nt[nt.length-1]];const Ut=qe.geometry.length-1;for(let Tt=0;Tt<Ut/2;Tt++)if(Tt+1<Ut/2){let Mt=Tt,li=Tt+1,Yt=Ut-1-Tt,Ct=Ut-2-Tt;Mt=Mt===0?Ut-1:Mt-1,li=li===0?Ut-1:li-1,Yt=Yt===0?Ut-1:Yt-1,Ct=Ct===0?Ut-1:Ct-1,qe.indices.push(Yt),qe.indices.push(li),qe.indices.push(Mt),qe.indices.push(Yt),qe.indices.push(Ct),qe.indices.push(li)}return qe})(c[0]),c=[Y.geometry]}const te=(we,Ie)=>we<(Ie.length-1)/2||we===Ie.length-1,ue=this.wallMode?[c]:hg(c,500);for(let we=ue.length-1;we>=0;we--){const Ie=ue[we];(Ie.length===0||ON(Ie[0]))&&ue.splice(we,1)}let le;if(D)le=FM(ue,A,g);else{le=[];for(const we of ue)le.push({polygon:we,bounds:A})}const ge=k?this.edgeRadius:0,ye=ge>0&&this.zoom<17,me=(we,Ie)=>{if(we.length===0)return!1;const Je=we[we.length-1];return Ie.x===Je.x&&Ie.y===Je.y};for(const{polygon:we,bounds:Ie}of le){let Je=0,qe=0;for(const ot of we)k&&!ot[0].equals(ot[ot.length-1])&&ot.push(ot[0]),qe+=k?ot.length-1:ot.length;const Xe=this.segments.prepareSegment((k?5:4)*qe,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);const at={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},nt=new MM;if(nt.vertexOffset=this.footprintVertices.length,nt.indexOffset=3*this.footprintIndices.length,nt.ringIndices=[],k){const ot=[],Ge=[];Je=Xe.vertexLength;for(let et=0;et<we.length;et++){const ut=we[et];ut.length&&et!==0&&Ge.push(ot.length/2);const lt=[];let Bt,Ut;Bt=ut[1].sub(ut[0])._perp()._unit(),nt.ringIndices.push(ut.length-1);for(let Tt=1;Tt<ut.length;Tt++){const Mt=ut[Tt],li=ut[Tt===ut.length-1?1:Tt+1],Yt=Mt.clone();if(ge){Ut=li.sub(Mt)._perp()._unit();const Ct=Bt.add(Ut)._unit(),bi=ge*Math.min(4,1/(Bt.x*Ct.x+Bt.y*Ct.y));Yt.x+=bi*Ct.x,Yt.y+=bi*Ct.y,Yt.x=Math.round(Yt.x),Yt.y=Math.round(Yt.y),Bt=Ut}if(!j||ge!==0&&!ye||me(lt,Yt)||lt.push(Yt),mg(this.layoutVertexArray,Yt.x,Yt.y,0,0,1,1,0),this.wallMode){const Ct=te(Tt,ut);gg(this.wallVertexArray,Y.joinNormals[Tt],!Ct)}Xe.vertexLength++,this.footprintVertices.emplaceBack(Mt.x,Mt.y),ot.push(Mt.x,Mt.y),D&&_g(this.layoutVertexExtArray,z.projectTilePoint(Yt.x,Yt.y,g),z.upVector(g,Yt.x,Yt.y))}j&&(ge===0||ye)&&(lt.length!==0&&me(lt,lt[0])&&lt.pop(),this.groundEffect.addData(lt,Ie,M))}const ct=this.wallMode?Y.indices:mf(ot,Ge);for(let et=0;et<ct.length;et+=3)this.footprintIndices.emplaceBack(nt.vertexOffset+ct[et+0],nt.vertexOffset+ct[et+1],nt.vertexOffset+ct[et+2]),this.indexArray.emplaceBack(Je+ct[et],Je+ct[et+2],Je+ct[et+1]),Xe.primitiveLength++;nt.indexCount+=ct.length,nt.vertexCount+=this.footprintVertices.length-nt.vertexOffset}for(let ot=0;ot<we.length;ot++){const Ge=we[ot];$.startRing(H,Ge[0]);let ct=Ge.length>4&&DM(Ge[Ge.length-2],Ge[0],Ge[1]),et=ge?kN(Ge[Ge.length-2],Ge[0],Ge[1],ge):0;const ut=[];let lt,Bt,Ut;Bt=Ge[1].sub(Ge[0])._perp()._unit();let Tt=!0;for(let Mt=1,li=0;Mt<Ge.length;Mt++){let Yt=Ge[Mt-1],Ct=Ge[Mt];const bi=Ge[Mt===Ge.length-1?1:Mt+1];if($.appendEdge(H,Ct,Yt),f1(Ct,Yt,Ie)){ge&&(Bt=bi.sub(Ct)._perp()._unit(),Tt=!Tt);continue}const qi=Ct.sub(Yt)._perp(),pn=qi.x/(Math.abs(qi.x)+Math.abs(qi.y)),Hi=qi.y>0?1:0,Pn=Yt.dist(Ct);if(li+Pn>32768&&(li=0),ge){Ut=bi.sub(Ct)._perp()._unit();let In=LM(Yt,Ct,bi,CM(Bt,Ut),ge);isNaN(In)&&(In=0);const Jn=Ct.sub(Yt)._unit();Yt=Yt.add(Jn.mult(et))._round(),Ct=Ct.add(Jn.mult(-In))._round(),et=In,Bt=Ut,j&&this.zoom>=17&&(me(ut,Yt)||ut.push(Yt),me(ut,Ct)||ut.push(Ct))}const an=Xe.vertexLength,wr=Ge.length>4&&DM(Yt,Ct,bi);let cn=kM(li,ct,Tt);if(mg(this.layoutVertexArray,Yt.x,Yt.y,pn,Hi,0,0,cn),mg(this.layoutVertexArray,Yt.x,Yt.y,pn,Hi,0,1,cn),this.wallMode){const In=te(Mt-1,Ge),Jn=Y.joinNormals[Mt-1];gg(this.wallVertexArray,Jn,In),gg(this.wallVertexArray,Jn,In)}if(li+=Pn,cn=kM(li,wr,!Tt),ct=wr,mg(this.layoutVertexArray,Ct.x,Ct.y,pn,Hi,0,0,cn),mg(this.layoutVertexArray,Ct.x,Ct.y,pn,Hi,0,1,cn),this.wallMode){const In=te(Mt,Ge),Jn=Y.joinNormals[Mt];gg(this.wallVertexArray,Jn,In),gg(this.wallVertexArray,Jn,In)}if(Xe.vertexLength+=4,this.indexArray.emplaceBack(an+0,an+1,an+2),this.indexArray.emplaceBack(an+1,an+3,an+2),Xe.primitiveLength+=2,ge){const In=Je+(Mt===1?Ge.length-2:Mt-2),Jn=Mt===1?Je:In+1;if(this.indexArray.emplaceBack(an+1,In,an+3),this.indexArray.emplaceBack(In,Jn,an+3),Xe.primitiveLength+=2,lt===void 0&&(lt=an),!f1(bi,Ge[Mt],Ie)){const or=Mt===Ge.length-1?lt:Xe.vertexLength;this.indexArray.emplaceBack(an+2,an+3,or),this.indexArray.emplaceBack(an+3,or+1,or),this.indexArray.emplaceBack(an+3,Jn,or+1),Xe.primitiveLength+=3}Tt=!Tt}if(D){const In=this.layoutVertexExtArray,Jn=z.projectTilePoint(Yt.x,Yt.y,g),or=z.projectTilePoint(Ct.x,Ct.y,g),sr=z.upVector(g,Yt.x,Yt.y),Sr=z.upVector(g,Ct.x,Ct.y);_g(In,Jn,sr),_g(In,Jn,sr),_g(In,or,Sr),_g(In,or,Sr)}}k&&(Je+=Ge.length-1),j&&ge&&this.zoom>=17&&(ut.length!==0&&me(ut,ut[0])&&ut.pop(),this.groundEffect.addData(ut,Ie,M,ge>0))}this.footprintSegments.push(nt),at.triangleCount=this.indexArray.length-at.triangleArrayOffset,this.polygonSegments.push(at),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=$.borders?IM:this.encodeCentroid($,H),this.centroidData.push(H),$.borders){this.featuresOnBorder.push($);const we=this.featuresOnBorder.length-1;for(let Ie=0;Ie<$.borders.length;Ie++)$.borders[Ie][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ie].push(we)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,_,v,g,T,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(r,d,_,v,g,T,this.worldview),this.maxHeight=Math.max(this.maxHeight,X)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((r,c)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}splitToSubtiles(){const t=[];for(let v=0;v<this.centroidData.length;v++){const S=this.centroidData[v],T=+(S.min.y+S.max.y>It),M=2*T+(+(S.min.x+S.max.x>It)^T);for(let A=0;A<S.polygonSegLen;A++){const z=S.polygonSegIdx+A;t.push({centroidIdx:v,subtile:M,polygonSegmentIdx:z,triangleSegmentIdx:this.polygonSegments[z].triangleSegIdx})}}const r=new Hr;t.sort((v,S)=>v.triangleSegmentIdx===S.triangleSegmentIdx?v.subtile-S.subtile:v.triangleSegmentIdx-S.triangleSegmentIdx);let c=0,d=0,g=0;for(const v of t){if(v.triangleSegmentIdx!==c)break;g++}const _=t.length;for(;d!==t.length;){c=t[d].triangleSegmentIdx;let v=0,S=d,T=d;for(let M=S;M<g&&t[M].subtile===v;M++)T++;for(;S!==g;){const M=t[S];v=M.subtile;const A=this.centroidData[M.centroidIdx].min.clone(),z=this.centroidData[M.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=S;k<T;k++){const $=t[k],H=this.polygonSegments[$.polygonSegmentIdx],j=this.centroidData[$.centroidIdx].min,X=this.centroidData[$.centroidIdx].max,Y=this.indexArray.uint16;for(let te=H.triangleArrayOffset;te<H.triangleArrayOffset+H.triangleCount;te++)r.emplaceBack(Y[3*te],Y[3*te+1],Y[3*te+2]);D.primitiveLength+=H.triangleCount,A.x=Math.min(A.x,j.x),A.y=Math.min(A.y,j.y),z.x=Math.max(z.x,X.x),z.y=Math.max(z.y,X.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:A,max:z}),S=T;for(let k=S;k<g&&t[k].subtile===t[S].subtile;k++)T++}d=g;for(let M=d;M<_&&t[M].triangleSegmentIdx===t[d].triangleSegmentIdx;M++)g++}r._trim(),this.indexArray=r}getVisibleSegments(t,r,c){const d=new er;if(this.wallMode){for(const $ of this.triangleSubSegments)d.segments.push($.segment);return d}let g=0,_=0;const v=1<<t.canonical.z;if(r){const $=r.getMinMaxForTile(t);$&&(g=$.min,_=$.max)}_+=this.maxHeight;const S=t.toUnwrapped();let T;const M=[S.canonical.x/v+S.wrap,S.canonical.y/v],A=[(S.canonical.x+1)/v+S.wrap,(S.canonical.y+1)/v],z=($,H,j)=>[$[0]*(1-j[0])+H[0]*j[0],$[1]*(1-j[1])+H[1]*j[1]],D=[],k=[];for(const $ of this.triangleSubSegments){D[0]=$.min.x/It,D[1]=$.min.y/It,k[0]=$.max.x/It,k[1]=$.max.y/It;const H=z(M,A,D),j=z(M,A,k);if(new yn([H[0],H[1],g],[j[0],j[1],_]).intersectsPrecise(c)===0){T&&(d.segments.push(T),T=void 0);continue}const X=$.segment;T&&T.vertexOffset!==X.vertexOffset&&(d.segments.push(T),T=void 0),T?(T.vertexLength+=X.vertexLength,T.primitiveLength+=X.primitiveLength):T={vertexOffset:X.vertexOffset,primitiveLength:X.primitiveLength,vertexLength:X.vertexLength,primitiveOffset:X.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&d.segments.push(T),d}encodeCentroid(t,r){const c=t.centroid(),d=r.span(),g=Math.min(7,Math.round(d.x*this.tileToMeter/10)),_=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Ae(de(c.x,1,8191)<<3|g,de(c.y,1,8191)<<3|_)}encodeBorderCentroid(t){if(!t.borders)return new Ae(0,0);const r=t.borders,c=Number.MAX_VALUE;if(r[0][0]!==c||r[1][0]!==c){const d=r[0][0]!==c?0:1;return new Ae(6|(r[0][0]!==c?0:65528),(r[d][0]+r[d][1])/2<<3|6)}{const d=r[2][0]!==c?2:3;return new Ae((r[d][0]+r[d][1])/2<<3|6,6|(r[2][0]!==c?0:65528))}}showCentroid(t){const r=this.centroidData[t.centroidDataIndex];r.flags&=2147483647,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const r=t.vertexArrayOffset,c=t.vertexCount+t.vertexArrayOffset,d=t.flags&Ac?IM:t.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==d.y||g!==d.x){for(let _=r;_<c;++_)this.centroidVertexArray.emplace(_,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,r,c){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const d=r.getReplacementRegionsForTile(t.toUnwrapped());if(tx(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const g=[];for(const _ of this.activeReplacements){if(_.order<c)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-t.canonical.z));if(_.footprint.buildingIds)for(const S of this.centroidData)S.flags&Ac||_.min.x>S.max.x||S.min.x>_.max.x||_.min.y>S.max.y||S.min.y>_.max.y||_.footprint.buildingIds.has(S.buildingId)&&(S.flags|=Ac);else for(const S of this.centroidData)if(!(S.flags&Ac||_.min.x>S.max.x||S.min.x>_.max.x||_.min.y>S.max.y||S.min.y>_.max.y))for(let T=0;T<S.footprintSegLen;T++){const M=this.footprintSegments[S.footprintSegIdx+T];if(g.length=0,FN(this.footprintVertices,M.vertexOffset,M.vertexCount,_.footprintTileId.canonical,t.canonical,g),c1(_.footprint,g,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-v)){S.flags|=Ac;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,r,c){let d=!1;for(let g=0;g<c.footprintSegLen;g++){const _=this.footprintSegments[c.footprintSegIdx+g];let v=0;for(const S of _.ringIndices){for(let T=v,M=S+v-1;T<S+v;M=T++){const A=this.footprintVertices.int16[2*(T+_.vertexOffset)+0],z=this.footprintVertices.int16[2*(T+_.vertexOffset)+1],D=this.footprintVertices.int16[2*(M+_.vertexOffset)+1];z>r!=D>r&&t<(this.footprintVertices.int16[2*(M+_.vertexOffset)+0]-A)*(r-z)/(D-z)+A&&(d=!d)}v=S}}return d}getHeightAtTileCoord(t,r){let c=Number.NEGATIVE_INFINITY,d=!0;const g=4*(t+It)*It+(r+It);if(this.partLookup.hasOwnProperty(g)){const _=this.partLookup[g];return _?{height:_.height,hidden:!!(_.flags&Ac)}:void 0}for(const _ of this.centroidData)t>_.max.x||_.min.x>t||r>_.max.y||_.min.y>r||_.height<=c||this.footprintContainsPoint(t,r,_)&&(c=_.height,this.partLookup[g]=_,d=!!(_.flags&Ac));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:d};this.partLookup[g]=void 0}}function CM(a,t){const r=a.add(t)._unit();return a.x*r.x+a.y*r.y}function kN(a,t,r,c){const d=t.sub(a)._perp()._unit(),g=r.sub(t)._perp()._unit();return LM(a,t,r,CM(d,g),c)}function LM(a,t,r,c,d){const g=Math.sqrt(1-c*c);return Math.min(a.dist(t)/3,t.dist(r)/3,d*g/c)}function f1(a,t,r){return a.x<r[0].x&&t.x<r[0].x||a.x>r[1].x&&t.x>r[1].x||a.y<r[0].y&&t.y<r[0].y||a.y>r[1].y&&t.y>r[1].y}function RM(a,t){return a.x<t[0].x||a.x>t[1].x||a.y<t[0].y||a.y>t[1].y}function ON(a){return a.every(t=>t.x<=0)||a.every(t=>t.x>=It)||a.every(t=>t.y<=0)||a.every(t=>t.y>=It)}function DM(a,t,r){if(a.x<0||a.x>=It||t.x<0||t.x>=It||r.x<0||r.x>=It)return!1;const c=r.sub(t),d=c.perp(),g=a.sub(t);return(c.x*g.x+c.y*g.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(g.x*g.x+g.y*g.y))>-.866&&d.x*g.x+d.y*g.y<0}function kM(a,t,r){const c=t?2|a:-3&a;return r?1|c:-2&c}function OM(){const a=Math.PI/32,t=Math.tan(a),r=ve;return r*Math.sqrt(1+2*t*t)-r}function FM(a,t,r){const c=1<<r.z,d=it(r.x/c),g=it((r.x+1)/c),_=dt(r.y/c),v=dt((r.y+1)/c);return(function(S,T,M,A,z=0,D){const k=[];if(!S.length||!M||!A)return k;const $=(le,ge)=>{for(const ye of le)k.push({polygon:ye,bounds:ge})},H=Math.ceil(Math.log2(M)),j=Math.ceil(Math.log2(A)),X=H-j,Y=[];for(let le=0;le<Math.abs(X);le++)Y.push(X>0?0:1);for(let le=0;le<Math.min(H,j);le++)Y.push(0),Y.push(1);let te=S;if(te=Kv(te,T[0].y-z,T[1].y+z,1),te=Kv(te,T[0].x-z,T[1].x+z,0),!te.length)return k;const ue=[];for(Y.length?ue.push({polygons:te,bounds:T,depth:0}):$(te,T);ue.length;){const le=ue.pop(),ge=le.depth,ye=Y[ge],me=le.bounds[0],we=le.bounds[1],Ie=ye===0?me.x:me.y,Je=ye===0?we.x:we.y,qe=D?D(ye,Ie,Je):.5*(Ie+Je),Xe=Kv(le.polygons,Ie-z,qe+z,ye),at=Kv(le.polygons,qe-z,Je+z,ye);if(Xe.length){const nt=[me,new Ae(ye===0?qe:we.x,ye===1?qe:we.y)];Y.length>ge+1?ue.push({polygons:Xe,bounds:nt,depth:ge+1}):$(Xe,nt)}if(at.length){const nt=[new Ae(ye===0?qe:me.x,ye===1?qe:me.y),we];Y.length>ge+1?ue.push({polygons:at,bounds:nt,depth:ge+1}):$(at,nt)}}return k})(a,t,Math.ceil((g-d)/11.25),Math.ceil((_-v)/11.25),1,(S,T,M)=>{if(S===0)return .5*(T+M);{const A=dt((r.y+T/It)/c);return(Ze(.5*(dt((r.y+M/It)/c)+A))*c-r.y)*It}})}function FN(a,t,r,c,d,g){const _=Math.pow(2,c.z-d.z);for(let v=0;v<r;v++){let S=a.int16[2*(v+t)+0],T=a.int16[2*(v+t)+1];S=(S+d.x*It)*_-c.x*It,T=(T+d.y*It)*_-c.y*It,g.push(new Ae(S,T))}}let BM,NM;jt(nx,"FillExtrusionBucket",{omit:["layers","features"]}),jt(AM,"PartData"),jt(MM,"FootprintSegment"),jt(PM,"BorderCentroidData"),jt(d1,"GroundEffect");class Vh extends Ae{constructor(t,r,c){super(t,r),this.z=c}}class UM extends Vh{constructor(t,r,c,d){super(t,r,c),this.w=d}}function $M(a,t,r,c){const d=r==="x"?"y":"x",g=(c-a[r])/(t[r]-a[r]);a[d]=Math.round(a[d]+(t[d]-a[d])*g),a[r]=c,a.hasOwnProperty("z")&&(a.z=di(a.z,t.z,g)),a.hasOwnProperty("w")&&(a.w=di(a.w,t.w,g))}function VM(a,t,r,c){const d=r,g=c;for(const _ of["x","y"]){let v=a,S=t;v[_]>=S[_]&&(v=t,S=a),v[_]<d&&S[_]>d&&$M(v,S,_,d),v[_]<g&&S[_]>g&&$M(S,v,_,g)}}function rx(a,t,r,c,d,g){const _=[];for(let v=0;v<a.length;v++){const S=a[v];let T;const M=_.length;let A=0;for(let z=0;z<S.length-1;z++){let D=S[z],k=S[z+1],$=0;const H=A;let j,X;g&&($=Math.hypot(k.x-D.x,k.y-D.y),A+=$,j=D,X=k),D.x<t&&k.x<t||(D.x<t?D=new Ae(t,D.y+(t-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x<t&&(k=new Ae(t,D.y+(t-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y<r&&k.y<r||(D.y<r?D=new Ae(D.x+(r-D.y)/(k.y-D.y)*(k.x-D.x),r)._round():k.y<r&&(k=new Ae(D.x+(r-D.y)/(k.y-D.y)*(k.x-D.x),r)._round()),D.x>=c&&k.x>=c||(D.x>=c?D=new Ae(c,D.y+(c-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x>=c&&(k=new Ae(c,D.y+(c-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y>=d&&k.y>=d||(D.y>=d?D=new Ae(D.x+(d-D.y)/(k.y-D.y)*(k.x-D.x),d)._round():k.y>=d&&(k=new Ae(D.x+(d-D.y)/(k.y-D.y)*(k.x-D.x),d)._round()),T&&D.equals(T[T.length-1])||(T=[D],_.push(T),g&&g.push({progress:{min:H+jM(j,X,D)*$,max:1},parentIndex:v,prevPoint:j,nextPoint:X})),T.push(k),g&&(g[g.length-1].progress.max=H+jM(j,X,k)*$,g[g.length-1].nextPoint=X)))))}if(g&&A>0)for(let z=M;z<_.length;z++)g[z].progress.min/=A,g[z].progress.max/=A}return _}function BN(a,t,r,c,d){if(a.length<2)return void c.push(a);const g=[];for(;t.valid();){const[T,M]=t.get();for(let A=0;A<a.length-1;A++){const z=a[A],D=a[A+1],k=Nh(z,D,T,M);if(k){const[$]=k,H=new Ae(di(z.x,D.x,$),di(z.y,D.y,$));g.push({t:A+$,distance:0,point:H})}}t.next()}if(g.length===0)return void c.push(a);g.sort((T,M)=>T.t-M.t);let _=0,v=0,S=[];for(c.push(S);_!==a.length;){if(v===g.length){for(;_!==a.length;)S.length!==0&&S[S.length-1].equals(a[_])||S.push(a[_]),_++;break}g[v].t<=_?(S.length!==0&&S[S.length-1].equals(g[v].point)||S.push(g[v].point),Math.trunc(g[v].t),v++):(S.length!==0&&S[S.length-1].equals(a[_])||S.push(a[_]),_++)}}function jM(a,t,r){return a.x!==t.x?(r.x-a.x)/(t.x-a.x):a.y!==t.y?(r.y-a.y)/(t.y-a.y):0}function yg(a,t){return a.x*t.x+a.y*t.y}function GM(a,t){if(a.length===1){let r=0;const c=t[r++];let d;for(;!d||c.equals(d);)if(d=t[r++],!d)return 1/0;for(;r<t.length;r++){const g=t[r],_=a[0],v=d.sub(c),S=g.sub(c),T=_.sub(c),M=yg(v,v),A=yg(v,S),z=yg(S,S),D=yg(T,v),k=yg(T,S),$=M*z-A*A,H=(z*D-A*k)/$,j=(M*k-A*D)/$,X=c.z*(1-H-j)+d.z*H+g.z*j;if(isFinite(X))return X}return 1/0}{let r=1/0;for(const c of t)r=Math.min(r,c.z);return r}}function HM(a,t,r){let c=1/0;Gn(r,t)&&(c=GM(r,t[0]));for(let d=0;d<t.length;d++){const g=t[d],_=a[d];for(let v=0;v<g.length-1;v++){const S=g[v],T=[S,g[v+1],_[v+1],_[v],S];rr(r,T)&&(c=Math.min(c,GM(r,T)))}}return c!==1/0&&c}function ZM(a,t,r,c,d,g,_,v,S,T,M){return a.projection.name==="globe"?(function(A,z,D,k,$,H,j,X,Y,te,ue){const le=[],ge=[],ye=A.projection.upVectorScale(ue,A.center.lat,A.worldSize).metersToTile,me=[0,0,0,1],we=[0,0,0,1],Ie=(qe,Xe,at,nt)=>{qe[0]=Xe,qe[1]=at,qe[2]=nt,qe[3]=1},Je=OM();D>0&&(D+=Je),k+=Je;for(const qe of z){const Xe=[],at=[];for(const nt of qe){const ot=nt.x+$.x,Ge=nt.y+$.y,ct=A.projection.projectTilePoint(ot,Ge,ue),et=A.projection.upVector(ue,nt.x,nt.y);let ut=D,lt=k;if(j){const Bt=WM(ot,Ge,D,k,j,X,Y,te);ut+=Bt.base,lt+=Bt.top}D!==0?Ie(me,ct.x+et[0]*ye*ut,ct.y+et[1]*ye*ut,ct.z+et[2]*ye*ut):Ie(me,ct.x,ct.y,ct.z),Ie(we,ct.x+et[0]*ye*lt,ct.y+et[1]*ye*lt,ct.z+et[2]*ye*lt),qt(me,me,H),qt(we,we,H),Xe.push(new Vh(me[0],me[1],me[2])),at.push(new Vh(we[0],we[1],we[2]))}le.push(Xe),ge.push(at)}return[le,ge]})(a,t,r,c,d,g,_,v,S,T,M):_?(function(A,z,D,k,$,H,j,X,Y){const te=[],ue=[],le=[0,0,0,1];for(const ge of A){const ye=[],me=[];for(const we of ge){const Ie=we.x+k.x,Je=we.y+k.y,qe=WM(Ie,Je,z,D,H,j,X,Y);le[0]=Ie,le[1]=Je,le[2]=qe.base,le[3]=1,Kt(le,le,$),le[3]=Math.max(le[3],1e-5);const Xe=new Vh(le[0]/le[3],le[1]/le[3],le[2]/le[3]);le[0]=Ie,le[1]=Je,le[2]=qe.top,le[3]=1,Kt(le,le,$),le[3]=Math.max(le[3],1e-5);const at=new Vh(le[0]/le[3],le[1]/le[3],le[2]/le[3]);ye.push(Xe),me.push(at)}te.push(ye),ue.push(me)}return[te,ue]})(t,r,c,d,g,_,v,S,T):(function(A,z,D,k,$){const H=[],j=[],X=$[8]*z,Y=$[9]*z,te=$[10]*z,ue=$[11]*z,le=$[8]*D,ge=$[9]*D,ye=$[10]*D,me=$[11]*D;for(const we of A){const Ie=[],Je=[];for(const qe of we){const Xe=qe.x+k.x,at=qe.y+k.y,nt=$[0]*Xe+$[4]*at+$[12],ot=$[1]*Xe+$[5]*at+$[13],Ge=$[2]*Xe+$[6]*at+$[14],ct=$[3]*Xe+$[7]*at+$[15],et=nt+X,ut=ot+Y,lt=Ge+te,Bt=Math.max(ct+ue,1e-5),Ut=nt+le,Tt=ot+ge,Mt=Ge+ye,li=Math.max(ct+me,1e-5);Ie.push(new Vh(et/Bt,ut/Bt,lt/Bt)),Je.push(new Vh(Ut/li,Tt/li,Mt/li))}H.push(Ie),j.push(Je)}return[H,j]})(t,r,c,d,g)}function WM(a,t,r,c,d,g,_,v){const S=_*d.getElevationAt(a,t,!0,!0),T=g[0]!==0,M=T?g[1]===0?_*(g[0]/7-450):_*(function(A,z,D){const k=Math.floor(z[0]/8),$=Math.floor(z[1]/8),H=10*(z[0]-8*k),j=10*(z[1]-8*$),X=A.getElevationAt(k,$,!0,!0),Y=A.getMeterToDEM(D),te=Math.floor(.5*(H*Y-1)),ue=Math.floor(.5*(j*Y-1)),le=A.tileCoordToPixel(k,$),ge=2*te+1,ye=2*ue+1,me=(function(at,nt,ot,Ge,ct){return[at.getElevationAtPixel(nt,ot,!0),at.getElevationAtPixel(nt+ct,ot,!0),at.getElevationAtPixel(nt,ot+ct,!0),at.getElevationAtPixel(nt+Ge,ot+ct,!0)]})(A,le.x-te,le.y-ue,ge,ye),we=Math.abs(me[0]-me[1]),Ie=Math.abs(me[2]-me[3]),Je=Math.abs(me[0]-me[2])+Math.abs(me[1]-me[3]),qe=Math.min(.25,.5*Y*(we+Ie)/ge),Xe=Math.min(.25,.5*Y*Je/ye);return X+Math.max(qe*H,Xe*j)})(d,g,v):S;return{base:S+(r===0?-1:r),top:T?Math.max(M+c,S+r+2):S+c}}class NN{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class UN{constructor(){this.tasks={},this.taskQueue=[],Ft(["process"],this),this.invoker=new NN(this.process),this.nextId=0}add(t,r){const c=this.nextId++,d=(function({type:g,isSymbolTile:_,zoom:v}){return v=v||0,g==="message"?0:g!=="maybePrepare"||_?g!=="parseTile"||_?g==="parseTile"&&_?300-v:g==="maybePrepare"&&_?400-v:500:200-v:100-v})(r);if(d===0){try{t()}finally{}return null}return this.tasks[c]={fn:t,metadata:r,priority:d,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<r&&(r=g.priority,t=d)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class qM{constructor(t,r,c){this.target=t,this.parent=r,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Ft(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new UN}send(t,r,c,d,g=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=_,this.callbacks[v]=c);const S=new Set;return this.target.postMessage({id:v,type:t,hasCallback:!!c,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:pa(r,S)},S),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(t){const r=t.data;if(!r)return;const c=r.id;if(c&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const d=this.cancelCallbacks[c];delete this.cancelCallbacks[c],d&&d.cancel()}else if(r.mustQueue||xr(self)){const d=this.callbacks[c],g=this.scheduler.add(()=>this.processTask(c,r),d&&d.metadata||{type:"message"});g&&(this.cancelCallbacks[c]=g)}else this.processTask(c,r)}processTask(t,r){if(delete this.cancelCallbacks[t],r.type==="<response>"){const c=this.callbacks[t];delete this.callbacks[t],c&&(r.error?c(hl(r.error)):c(null,hl(r.data)))}else{const c=new Set,d=r.hasCallback?(_,v)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:_?pa(_):null,data:pa(v,c)},c)}:()=>{},g=hl(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,g,d);else if(this.parent.getWorkerSource){const _=r.type.split("."),{source:v,scope:S}=g;this.parent.getWorkerSource(r.sourceMapId,_[0],v,S)[_[1]](g,d)}else d(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var vg={workerUrl:"",workerClass:null,workerParams:void 0};function $N(a){return vg.workerClass!=null?new vg.workerClass:new self.Worker(vg.workerUrl,Object.assign({name:a},vg.workerParams))}const p1="mapboxgl_preloaded_worker_pool";class jh{constructor(t){this.active={},this.name=t}acquire(t,r=jh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;){const c=$N(`${this.name||""}WorkerPool: ${t}-${this.workers.length}`);this.workers.push(c)}return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[p1]}numActive(){return Object.keys(this.active).length}}jh.workerCount=2;class vf{constructor(t,r,c="Worker",d=jh.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=gt();const g=this.workerPool.acquire(this.id,d);for(let _=0;_<g.length;_++){const v=new vf.Actor(g[_],r,this.id);v.name=`${c} ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,r,c){Pe(this.actors,(d,g)=>{d.send(t,r,g)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}let xg,m1;function ox(){return xg||(xg=new jh),xg}vf.Actor=qM;const g1=4096;class VN{constructor(t){this.module=t,this.memoryStack=this.module.malloc(g1),this.memoryStackNextFree=this.memoryStack}createIntArray(t){const r=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>g1?-1:(new Int32Array(this.module.heap32.buffer,r,t.length).set(t),r)}createFloatArray(t){const r=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>g1?-1:(new Float32Array(this.module.heapF32.buffer,r,t.length).set(t),r)}readStringBuffer(t){let r="";for(;this.module.heapU8[t]!==0;)r+=String.fromCharCode(this.module.heapU8[t]),++t;return r}setStyle(t){const r=t.normalScale;this.module.setStyle(r[0],r[1],r[2],t.tileToMeters)}setAOOptions(t,r){this.module.setAOOptions(t?1:0,r)}setMetricOptions(t,r){this.module.setMetricOptions(t?1:0,r)}setStructuralOptions(t){this.module.setStructuralOptions(t?1:0)}setFacadeOptions(t,r){this.module.setFacadeOptions(t,r?1:0)}setFauxFacadeOptions(t,r,c){this.module.setFauxFacadeOptions(t?1:0,r?1:0,c)}setFacadeClassifierOptions(t){this.module.setFacadeClassifierOptions(t)}generateMesh(t,r){this.memoryStackNextFree=this.memoryStack;for(const v of t){const S=this.createIntArray(v.ringIndices),T=this.createFloatArray(v.coordinates);if(S===-1||T===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,v.roofType,T,S,v.ringIndices.length-1)}for(const v of r){let S;S=v.entrances?JSON.parse(v.entrances):[];const T=this.createFloatArray(S),M=this.createFloatArray(v.coordinates);if(T===-1||M===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,T,S.length,M,v.coordinates.length)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const c=this.module.getMeshCount(),d=new Array(c);for(let v=0;v<c;v++){const S=this.module.getPositionsPtr(v),T=this.module.getPositionsLength(v),M=new Float32Array(this.module.heapF32.buffer,S,T),A=this.module.getNormalsPtr(v),z=this.module.getNormalsLength(v),D=new Float32Array(this.module.heapF32.buffer,A,z),k=this.module.getAOPtr(v),$=this.module.getAOLength(v),H=new Float32Array(this.module.heapF32.buffer,k,$),j=this.module.getUVPtr(v),X=this.module.getUVLength(v),Y=new Float32Array(this.module.heapF32.buffer,j,X),te=this.module.getFauxFacadePtr(v),ue=this.module.getFauxFacadeLength(v),le=new Uint8Array(this.module.heapU8.buffer,te,ue),ge=this.module.getIndicesPtr(v),ye=this.module.getIndicesLength(v),me=new Int16Array(this.module.heap16.buffer,ge,ye),we=this.module.getBuildingPart(v);d[v]={positions:M,normals:D,ao:H,uv:Y,isFauxFacade:le,indices:me,buildingPart:we}}const g=this.module.getRingCount(),_=[];for(let v=0;v<g;v++){const S=this.module.getRingPtr(v),T=this.module.getRingLength(v),M=new Float32Array(this.module.heapF32.buffer,S,T);_.push(M)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let bg,_1,ml,xf,y1,bf=null,wf=null,XM=null,sx=null;function JM(){return xr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:_1||jr.DRACO_URL}function YM(){if(xr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(xf)return xf;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return xf=WebAssembly.validate(a)?jr.MESHOPT_SIMD_URL:jr.MESHOPT_URL,xf}function jN(){return sx}const KM=5120,QM=5121,eA=5122,tA=5123,iA=5125,nA=5126,ax={[KM]:Int8Array,[QM]:Uint8Array,[eA]:Int16Array,[tA]:Uint16Array,[iA]:Uint32Array,[nA]:Float32Array},GN={[KM]:"DT_INT8",[QM]:"DT_UINT8",[eA]:"DT_INT16",[tA]:"DT_UINT16",[iA]:"DT_UINT32",[nA]:"DT_FLOAT32"},wg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function rA(a,t,r){const c=r.json.bufferViews.length,d=r.buffers.length;t.bufferView=c,r.json.bufferViews[c]={buffer:d,byteLength:a.byteLength},r.buffers[d]=a}const v1="KHR_draco_mesh_compression";function HN(a,t){const r=a.extensions&&a.extensions[v1];if(!r)return;const c=new ml.Decoder,d=lA(t,r.bufferView),g=new ml.Mesh;if(!c.DecodeArrayToMesh(d,d.byteLength,g))throw new Error("Failed to decode Draco mesh");const _=t.json.accessors[a.indices],v=ax[_.componentType],S=_.count*v.BYTES_PER_ELEMENT,T=ml._malloc(S);v===Uint16Array?c.GetTrianglesUInt16Array(g,S,T):c.GetTrianglesUInt32Array(g,S,T),rA(ml.memory.buffer.slice(T,T+S),_,t),ml._free(T);for(const M of Object.keys(r.attributes)){const A=c.GetAttributeByUniqueId(g,r.attributes[M]),z=t.json.accessors[a.attributes[M]],D=GN[z.componentType],k=z.count*wg[z.type]*ax[z.componentType].BYTES_PER_ELEMENT,$=ml._malloc(k);c.GetAttributeDataArrayForAllPoints(g,A,ml[D],k,$),rA(ml.memory.buffer.slice($,$+k),z,t),ml._free($)}c.destroy(),g.destroy(),delete a.extensions[v1]}const lx="EXT_meshopt_compression";function ZN(a,t){if(!a.extensions||!a.extensions[lx])return;const r=a.extensions[lx],c=new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),d=new Uint8Array(r.count*r.byteStride);y1.decodeGltfBuffer(d,r.count,r.byteStride,c,r.mode,r.filter),a.buffer=t.buffers.length,a.byteOffset=0,t.buffers[a.buffer]=d.buffer,delete a.extensions[lx]}const oA=1179937895,sA=new TextDecoder("utf8");function aA(a,t){return new URL(a,t).href}function WN(a,t,r,c){return fetch(aA(a.uri,c)).then(d=>d.arrayBuffer()).then(d=>{t.buffers[r]=d})}function lA(a,t){const r=a.json.bufferViews[t];return new Uint8Array(a.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function qN(a,t,r,c){if(a.uri){const d=aA(a.uri,c);return fetch(d).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{t.images[r]=g})}if(a.bufferView!==void 0){const d=lA(t,a.bufferView),g=new Blob([d],{type:a.mimeType});return createImageBitmap(g).then(_=>{t.images[r]=_})}}function cA(a,t=0,r){const c={json:null,images:[],buffers:[]};if(new Uint32Array(a,t,1)[0]===oA){const M=new Uint32Array(a,t);let A=2;const z=(M[A++]>>2)-3,D=M[A++]>>2;if(A++,c.json=JSON.parse(sA.decode(M.subarray(A,A+D))),A+=D,A<z){const k=M[A++];A++;const $=t+(A<<2);c.buffers[0]=a.slice($,$+k)}}else c.json=JSON.parse(sA.decode(new Uint8Array(a,t)));const{buffers:d,images:g,meshes:_,extensionsUsed:v,bufferViews:S}=c.json;let T=Promise.resolve();if(d){const M=[];for(let A=0;A<d.length;A++){const z=d[A];z.uri?M.push(WN(z,c,A,r)):c.buffers[A]||(c.buffers[A]=null)}T=Promise.all(M)}return T.then(()=>{const M=[],A=v&&v.includes(v1),z=v&&v.includes(lx);if(A&&M.push((function(){if(!ml)return bg??(bg=(function(D){let k,$=null;function H(){k=new Uint8Array($.buffer)}function j(){throw new Error("Unexpected Draco error.")}const X={a:{a:j,d:function(Y,te,ue){return k.copyWithin(Y,te,te+ue)},c:function(Y){const te=k.length,ue=Math.max(Y>>>0,Math.ceil(1.2*te)),le=Math.ceil((ue-te)/65536);try{return $.grow(le),H(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,X):D.then(Y=>Y.arrayBuffer()).then(Y=>WebAssembly.instantiate(Y,X))).then(Y=>{const{Rb:te,Qb:ue,P:le,T:ge,X:ye,Ja:me,La:we,Qa:Ie,Va:Je,Wa:qe,eb:Xe,jb:at,f:nt,e:ot,yb:Ge,zb:ct,Ab:et,Bb:ut,Db:lt,Gb:Bt}=Y.instance.exports;$=ot;const Ut=(()=>{let Tt=0,Mt=0,li=0,Yt=0;return Ct=>{li&&(te(Yt),te(Tt),Mt+=li,li=Tt=0),Tt||(Mt+=128,Tt=ue(Mt));const bi=Ct.length+7&-8;let qi=Tt;bi>=Mt&&(li=bi,qi=Yt=ue(bi));for(let pn=0;pn<Ct.length;pn++)k[qi+pn]=Ct[pn];return qi}})();return H(),nt(),{memory:ot,_free:te,_malloc:ue,Mesh:class{constructor(){this.ptr=le()}destroy(){ge(this.ptr)}},Decoder:class{constructor(){this.ptr=me()}destroy(){at(this.ptr)}DecodeArrayToMesh(Tt,Mt,li){const Yt=Ut(Tt),Ct=we(this.ptr,Yt,Mt,li.ptr);return!!ye(Ct)}GetAttributeByUniqueId(Tt,Mt){return{ptr:Ie(this.ptr,Tt.ptr,Mt)}}GetTrianglesUInt16Array(Tt,Mt,li){Je(this.ptr,Tt.ptr,Mt,li)}GetTrianglesUInt32Array(Tt,Mt,li){qe(this.ptr,Tt.ptr,Mt,li)}GetAttributeDataArrayForAllPoints(Tt,Mt,li,Yt,Ct){Xe(this.ptr,Tt.ptr,Mt.ptr,li,Yt,Ct)}},DT_INT8:Ge(),DT_UINT8:ct(),DT_INT16:et(),DT_UINT16:ut(),DT_UINT32:lt(),DT_FLOAT32:Bt()}})})(fetch(JM())),bg.then(D=>{ml=D,bg=void 0}))})()),z&&M.push((function(){if(y1)return;const D=(function(k){let $;const H=WebAssembly.instantiateStreaming(k,{}).then(Y=>{$=Y.instance,$.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},X={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(Y,te,ue,le,ge,ye){(function(me,we,Ie,Je,qe,Xe,at){const nt=me.exports.sbrk,ot=Je+3&-4,Ge=nt(ot*qe),ct=nt(Xe.length),et=new Uint8Array(me.exports.memory.buffer);et.set(Xe,ct);const ut=we(Ge,Je,qe,ct,Xe.length);if(ut===0&&at&&at(Ge,ot,qe),Ie.set(et.subarray(Ge,Ge+Je*qe)),nt(Ge-nt(0)),ut!==0)throw new Error(`Malformed buffer data: ${ut}`)})($,$.exports[X[ge]],Y,te,ue,le,$.exports[j[ye]])}}})(fetch(YM()));return D.ready.then(()=>{y1=D})})()),g)for(let D=0;D<g.length;D++)M.push(qN(g[D],c,D,r));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(A&&_)for(const{primitives:D}of _)for(const k of D)HN(k,c);if(z&&_&&S)for(const D of S)ZN(D,c);return c})})}function uA(a){return fetch(a).then(t=>t.arrayBuffer()).then(t=>cA(t,0,a))}function x1(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function b1(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class w1{constructor(t,r,c,d){this.context=t,this.format=c,this.useMipmap=d&&d.useMipmap,this.texture=t.gl.createTexture(),this.update(r,{premultiply:d&&d.premultiply})}update(t,r){const c=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,d=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:g}=this,{gl:_}=g,{x:v,y:S}=r&&r.position?r.position:{x:0,y:0},T=v+c,M=S+d;!this.size||this.size[0]===T&&this.size[1]===M||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!r||r.premultiply!==!1));const A=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&T>0&&M>0){const z=this.useMipmap?Math.floor(Math.log2(Math.max(T,M)))+1:1;_.texStorage2D(_.TEXTURE_2D,z,this.format,T,M),this.size=[T,M]}this.size&&(A?_.texSubImage2D(_.TEXTURE_2D,0,v,S,x1(this.format),b1(this.format),t):"data"in t&&t.data&&_.texSubImage2D(_.TEXTURE_2D,0,v,S,c,d,x1(this.format),b1(this.format),t.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(t,r,c=!1){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),t!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!c?t===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),r!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(t,r,c,d,g){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),r!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,r),this.magFilter=r),t!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?t===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),c!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,c),this.wrapS=c),d!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,d),this.wrapT=d),g!==this.compareMode&&(g?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,g)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=g)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Sg{constructor(t,r){this.context=t,this.texture=r}bind(t,r){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),t!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,t),this.minFilter=t),r!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrapS=r)}}const XN=Ki([{name:"a_pos_3f",components:3,type:"Float32"}]),JN=Ki([{name:"a_color_3f",components:3,type:"Float32"}]),YN=Ki([{name:"a_color_4f",components:4,type:"Float32"}]),KN=Ki([{name:"a_uv_2f",components:2,type:"Float32"}]),QN=Ki([{name:"a_normal_3f",components:3,type:"Float32"}]),eU=Ki([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),tU=Ki([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function hA(a,t){const r=cx(a.projection,a.zoom,a.width,a.height),c=(function(g,_,v,S,T){const M=new he(v.lng-180*Tu,v.lat),A=new he(v.lng+180*Tu,v.lat),z=g.project(M.lng,M.lat),D=g.project(A.lng,A.lat),k=-Math.atan2(D.y-z.y,D.x-z.x),$=Pt.fromLngLat(v);$.y=de($.y,-1+Tu,1-Tu);const H=$.toLngLat(),j=g.project(H.lng,H.lat),X=Pt.fromLngLat(H);X.x+=Tu;const Y=X.toLngLat(),te=g.project(Y.lng,Y.lat),ue=fA(te.x-j.x,te.y-j.y,k),le=Pt.fromLngLat(H);le.y+=Tu;const ge=le.toLngLat(),ye=g.project(ge.lng,ge.lat),me=fA(ye.x-j.x,ye.y-j.y,k),we=Math.abs(ue.x)/Math.abs(me.y),Ie=fe([]);Ye(Ie,Ie,-k*(1-(T?0:S)));const Je=fe([]);return Ue(Je,Je,[1,1-(1-we)*S,1]),Je[4]=-me.x/me.y*S,Ye(Je,Je,k),ie(Je,Ie,Je),Je})(a.projection,0,a.center,r,t),d=dA(a);return Ue(c,c,[d,d,1]),c}function dA(a){const t=a.projection,r=cx(a.projection,a.zoom,a.width,a.height),c=S1(t,a.center),d=S1(t,he.convert(t.center));return Math.pow(2,c*r+(1-r)*d)}function cx(a,t,r,c,d=1/0){const g=a.range;if(!g)return 0;const _=Math.min(d,Math.max(r,c)),v=Math.log2(_/1024);return Me(g[0]+v,g[1]+v,t)}const Tu=1/4e4;function S1(a,t){const r=de(t.lat,-85.051129,Te),c=new he(t.lng-180*Tu,r),d=new he(t.lng+180*Tu,r),g=a.project(c.lng,r),_=a.project(d.lng,r),v=Pt.fromLngLat(c),S=Pt.fromLngLat(d),T=_.x-g.x,M=_.y-g.y,A=S.x-v.x,z=S.y-v.y,D=Math.sqrt((A*A+z*z)/(T*T+M*M));return Math.log2(D)}function fA(a,t,r){const c=Math.cos(r),d=Math.sin(r);return{x:a*c-t*d,y:a*d+t*c}}function pA(a,t,r){fe(a),Ye(a,a,ii(t[2])),Ne(a,a,ii(t[0])),Ce(a,a,ii(t[1])),Ue(a,a,r),ie(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ux(a,t,r,c,d,g,_,v){const S=[r[0]-t[0],r[1]-t[1],0],T=[c[0]-t[0],c[1]-t[1],0];if(_t(S)<1e-12||_t(T)<1e-12)return Xi(a);const M=hn([],S,T);Di(M,M),mi(T,c,t),S[2]=(g-d)*v,T[2]=(_-d)*v;const A=S;return hn(A,S,T),Di(A,A),Ys(a,M,A)}function hx(a,t,r=!1){const c=xu(t.zoom),d=(function(g,_,v){const S=_.worldSize,T=[g[12],g[13],g[14]],M=dt(T[1]/S),A=it(T[0]/S),z=fe([]),D=je(1,M)*S,k=je(1,0)*S*We(M,_.zoom),$=1/Hw(S);let H=k*$;if(v){const te=cx(_.projection,_.zoom,_.width,_.height,1024);H=$*_.projection.pixelSpaceConversion(_.center.lat,S,te)}const j=_e(M,A);ei(j,j,wi([],Di([],j),D*H*T[2]));const X=(function(te){const ue=[te[0],te[1],te[2]];let le=[0,1,0];const ge=hn([],le,ue);return hn(le,ue,ge),pr(le)===0&&(le=[0,1,0],hn(ge,ue,le)),Di(ge,ge),Di(le,le),Di(ue,ue),[ge[0],ge[1],ge[2],0,le[0],le[1],le[2],0,ue[0],ue[1],ue[2],0,te[0],te[1],te[2],1]})(j);Ue(z,z,[H,H,H*D]),tt(z,z,[-T[0],-T[1],-T[2]]);const Y=ie([],_.globeMatrix,X);return ie(Y,Y,z),ie(Y,Y,g),Y})(a,t,r);if(c>0){const g=(function(_,v){const S=v.worldSize,T=je(1,0)*S*We(v.center.lat,v.zoom)/Hw(S),M=je(1,v.center.lat)*S,A=fe([]);Ce(A,A,ii(v.center.lng)),Ne(A,A,ii(v.center.lat)),tt(A,A,[0,0,J]),Ue(A,A,[T,T,T*M]);const z=v.point;return tt(A,A,[-z.x,-z.y,0]),ie(A,A,_),ie(A,v.globeMatrix,A)})(a,t);return(function(_,v,S){const T=(k,$,H)=>{const j=_t(k),X=_t($),Y=Ic(k,$,H);return wi(Y,Y,1/_t(Y)*di(j,X,H))},M=T([_[0],_[1],_[2]],[v[0],v[1],v[2]],S),A=T([_[4],_[5],_[6]],[v[4],v[5],v[6]],S),z=T([_[8],_[9],_[10]],[v[8],v[9],v[10]],S),D=Ic([_[12],_[13],_[14]],[v[12],v[13],v[14]],S);return[M[0],M[1],M[2],0,A[0],A[1],A[2],0,z[0],z[1],z[2],0,D[0],D[1],D[2],1]})(d,g,c)}return d}function T1(a,t,r,c){const d=yn.projectAabbCorners(c,r);let g=Number.MAX_VALUE;for(let v=0;v<d.length;++v){const S=d[v];S[0]=(.5*S[0]+.5)*t.width,S[1]=(.5-.5*S[1])*t.height,S[2]<g&&(g=S[2])}const _=(function(v){const S=[];let T=0;for(let D=1;D<v.length;D++)(v[D][0]<v[T][0]||v[D][0]===v[T][0]&&v[D][1]<v[T][1])&&(T=D);let M,A=T;const z=new Uint8Array(v.length);do{if(z[A])break;S.push(new Ae(v[A][0],v[A][1])),z[A]=1,M=(A+1)%v.length;for(let D=0;D<v.length;D++){if(v[D][0]===v[M][0]&&v[D][1]===v[M][1]||v[D][0]===v[A][0]&&v[D][1]===v[A][1])continue;const k=[v[D][0]-v[A][0],v[D][1]-v[A][1]],$=[v[M][0]-v[A][0],v[M][1]-v[A][1]],H=k[0]*$[1]-k[1]*$[0];(H>0||H===0&&k[0]*$[0]+k[1]*$[1]>=0&&k[0]*k[0]+k[1]*k[1]>$[0]*$[0]+$[1]*$[1])&&(M=D)}A=M}while(A!==T);return S.length>0&&S.push(S[0]),S})(d);if(rr(a,_))return g}const Gh=64,Sf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function dx(a,t,r,c,d,g,_,v,S,T=!1){const M=r.zoom,A=r.project(c),z=We(c.lat,M),D=1/z;fe(a),tt(a,a,[A.x+_[0]*D,A.y+_[1]*D,_[2]]);let k=1,$=1;const H=r.worldSize;if(T){if(r.projection.name==="mercator"){let te=0;r.elevation&&(te=r.elevation.getAtPointOrZero(new Pt(A.x/H,A.y/H),0));const ue=Kt([],[A.x,A.y,te,1],r.projMatrix)[3]/r.cameraToCenterDistance;k=ue,$=ue*We(r.center.lat,M)}else if(r.projection.name==="globe"){const te=hx(a,r),ue=[0,0,0,1];Kt(ue,ue,ie([],r.projMatrix,te));const le=ue[3]/r.cameraToCenterDistance,ge=xu(M),ye=r.projection.pixelsPerMeter(c.lat,H)*We(c.lat,M),me=r.projection.pixelsPerMeter(r.center.lat,H)*We(r.center.lat,M);k=le/di(ye,Ke(r.center.lat),ge),$=le*z/ye,k*=me,$*=me}}else k=D;Ue(a,a,[k,k,$]);const j=[...a],X=t.orientation,Y=[];if(pA(Y,[X[0]+(d?d[0]:0),X[1]+(d?d[1]:0),X[2]+(d?d[2]:0)],g),ie(a,j,Y),v&&r.elevation){let te=0;const ue=[];if(S&&r.elevation){te=(function(ge,ye,me,we,Ie){const Je=ye.elevation;if(!Je)return 0;const qe=yn.projectAabbCorners(me,we),Xe=je(1,Ie.lat)*ye.worldSize,at=(function(Mt,li){const Yt=[0,0,1],Ct=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const bi of Ct){const qi=Mt[bi.corners[0]],pn=Mt[bi.corners[1]],Hi=Mt[bi.corners[2]],Pn=[pn[0]-qi[0],pn[1]-qi[1],li*(pn[2]-qi[2])],an=hn(Pn,Pn,[Hi[0]-qi[0],Hi[1]-qi[1],li*(Hi[2]-qi[2])]);Di(an,an),bi.dotProductWithUp=Ii(an,Yt)}return Ct.sort((bi,qi)=>bi.dotProductWithUp-qi.dotProductWithUp),Ct[0].corners})(qe,Xe),nt=qe[at[0]],ot=qe[at[1]],Ge=qe[at[2]],ct=qe[at[3]],et=Je.getAtPointOrZero(new Pt(nt[0]/ye.worldSize,nt[1]/ye.worldSize),0),ut=Je.getAtPointOrZero(new Pt(ot[0]/ye.worldSize,ot[1]/ye.worldSize),0),lt=Je.getAtPointOrZero(new Pt(Ge[0]/ye.worldSize,Ge[1]/ye.worldSize),0),Bt=Je.getAtPointOrZero(new Pt(ct[0]/ye.worldSize,ct[1]/ye.worldSize),0),Ut=(et+Bt)/2,Tt=(ut+lt)/2;return Ut>Tt?ut<lt?ux(ge,ot,ct,nt,ut,Bt,et,Xe):ux(ge,Ge,nt,ct,lt,et,Bt,Xe):et<Bt?ux(ge,nt,ot,Ge,et,ut,lt,Xe):ux(ge,ct,Ge,ot,Bt,lt,ut,Xe),Math.max(Ut,Tt)})(ue,r,t.aabb,a,c);const le=ie([],Et([],ue),Y);ie(a,j,le)}else te=r.elevation.getAtPointOrZero(new Pt(A.x/H,A.y/H),0);te!==0&&(a[14]+=te)}}class mA{constructor(t,r,c,d,g){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=t,this.uri=r,this.position=c!=null?new he(c[0],c[1]):new he(0,0),this.orientation=d??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,r){ie(t.globalMatrix,r,t.localMatrix);const c=this.nodeOverrides.get(t.name);if(c!==void 0){const _=[];g=c.orientation,fe(d=_),Ce(d,d,ii(g[1])),Ye(d,d,ii(g[2])),Ne(d,d,ii(g[0])),ie(t.globalMatrix,t.globalMatrix,_)}var d,g;if(t.meshes)for(const _ of t.meshes){const v=yn.applyTransformFast(_.aabb,t.globalMatrix);this.aabb.encapsulate(v)}if(t.children)for(const _ of t.children)this._applyTransformations(_,t.globalMatrix)}computeBoundsAndApplyParent(){const t=fe([]);this.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.nodes)this._applyTransformations(r,t)}computeModelMatrix(t,r,c,d,g,_,v=!1){dx(this.matrix,this,t.transform,this.position,r,c,d,g,_,v)}upload(t){if(!this.uploaded){for(const r of this.nodes)E1(r,t);for(const r of this.nodes)fx(r);this.uploaded=!0}}destroy(){for(const t of this.nodes)I1(t)}}function Tg(a,t,r=!1){a.uploaded||(a.gfxTexture=new w1(t,a.image,r?t.gl.R8:t.gl.RGBA8,{useMipmap:a.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function iU(a,t,r){a.indexBuffer=t.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=t.createVertexBuffer(a.vertexArray,XN.members,!1,!0),a.normalArray&&(a.normalBuffer=t.createVertexBuffer(a.normalArray,QN.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=t.createVertexBuffer(a.texcoordArray,KN.members,!1,!0)),a.colorArray&&(a.colorBuffer=t.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?JN:YN).members,!1,!0)),a.featureArray&&(a.pbrBuffer=t.createVertexBuffer(a.featureArray,tU.members,!0)),a.segments=er.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const c=a.material;c.pbrMetallicRoughness.baseColorTexture&&Tg(c.pbrMetallicRoughness.baseColorTexture,t),c.pbrMetallicRoughness.metallicRoughnessTexture&&Tg(c.pbrMetallicRoughness.metallicRoughnessTexture,t),c.normalTexture&&Tg(c.normalTexture,t),c.occlusionTexture&&Tg(c.occlusionTexture,t,r),c.emissionTexture&&Tg(c.emissionTexture,t)}function E1(a,t,r){if(a.meshes)for(const c of a.meshes)iU(c,t,r);if(a.children)for(const c of a.children)E1(c,t,r)}function fx(a){if(a.meshes)for(const t of a.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(a.children)for(const t of a.children)fx(t)}function nU(a){a.pbrMetallicRoughness.baseColorTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),a.pbrMetallicRoughness.metallicRoughnessTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),a.normalTexture&&a.normalTexture.gfxTexture&&a.normalTexture.gfxTexture.destroy(),a.emissionTexture&&a.emissionTexture.gfxTexture&&a.emissionTexture.gfxTexture.destroy(),a.occlusionTexture&&a.occlusionTexture.gfxTexture&&a.occlusionTexture.gfxTexture.destroy()}function I1(a){if(a.meshes)for(const t of a.meshes)t.vertexBuffer&&(t.vertexBuffer.destroy(),t.indexBuffer.destroy(),t.normalBuffer&&t.normalBuffer.destroy(),t.texcoordBuffer&&t.texcoordBuffer.destroy(),t.colorBuffer&&t.colorBuffer.destroy(),t.pbrBuffer&&t.pbrBuffer.destroy(),t.segments.destroy(),t.material&&nU(t.material));if(a.children)for(const t of a.children)I1(t)}function Hh(a,t){const r=a.json.bufferViews[t.bufferView],c=ax[t.componentType];return new c(a.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*(r.byteStride&&r.byteStride!==wg[t.type]*c.BYTES_PER_ELEMENT?r.byteStride/c.BYTES_PER_ELEMENT:wg[t.type]))}function M1(a,t,r,c){const d=ax[t.componentType],g=(function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(d),_=a.json.bufferViews[t.bufferView],v=_.byteStride?_.byteStride/d.BYTES_PER_ELEMENT:wg[t.type],S=r.float32,T=S.length/r.capacity;for(let M=0,A=0;M<t.count*v;M+=v,A+=T)for(let z=0;z<T;z++)S[A+z]=c[M+z]*g;r._trim()}function rU(a,t,r){const c=a.indices,d=a.attributes,g={};g.indexArray=new Hr;const _=t.json.accessors[c],v=_.count/3;g.indexArray.reserve(v);const S=Hh(t,_);for(let z=0;z<v;z++)g.indexArray.emplaceBack(S[3*z],S[3*z+1],S[3*z+2]);g.indexArray._trim(),g.vertexArray=new ra;const T=t.json.accessors[d.POSITION];g.vertexArray.reserve(T.count);const M=Hh(t,T);for(let z=0;z<T.count;z++)g.vertexArray.emplaceBack(M[3*z],M[3*z+1],M[3*z+2]);if(g.vertexArray._trim(),g.aabb=new yn(T.min,T.max),g.centroid=(function(z,D){const k=[0,0,0],$=z.length;if($>0){for(let H=0;H<$;H++){const j=3*z[H];k[0]+=D[j],k[1]+=D[j+1],k[2]+=D[j+2]}k[0]/=$,k[1]/=$,k[2]/=$}return k})(S,M),d.COLOR_0!==void 0){const z=t.json.accessors[d.COLOR_0],D=wg[z.type],k=Hh(t,z);g.colorArray=D===3?new ra:new Wl,g.colorArray.resize(z.count),M1(t,z,g.colorArray,k)}if(d.NORMAL!==void 0){g.normalArray=new ra;const z=t.json.accessors[d.NORMAL];g.normalArray.resize(z.count);const D=Hh(t,z);M1(t,z,g.normalArray,D)}if(d.TEXCOORD_0!==void 0&&r.length>0){g.texcoordArray=new Tc;const z=t.json.accessors[d.TEXCOORD_0];g.texcoordArray.resize(z.count);const D=Hh(t,z);M1(t,z,g.texcoordArray,D)}if(d._FEATURE_ID_RGBA4444!==void 0){const z=t.json.accessors[d._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Hh(t,z))}d._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Hh(t,t.json.accessors[d._FEATURE_RGBA4444]).buffer));const A=a.material;return g.material=(function(z,D){const{emissiveFactor:k=[0,0,0],alphaMode:$="OPAQUE",alphaCutoff:H=.5,normalTexture:j,occlusionTexture:X,emissiveTexture:Y,doubleSided:te,name:ue}=z,{baseColorFactor:le=[1,1,1,1],metallicFactor:ge=1,roughnessFactor:ye=1,baseColorTexture:me,metallicRoughnessTexture:we}=z.pbrMetallicRoughness||{},Ie=X?D[X.index]:void 0;if(X&&X.extensions&&X.extensions.KHR_texture_transform&&Ie){const Je=X.extensions.KHR_texture_transform;Ie.offsetScale=[Je.offset[0],Je.offset[1],Je.scale[0],Je.scale[1]]}return{name:ue,pbrMetallicRoughness:{baseColorFactor:new bn(...le),metallicFactor:ge,roughnessFactor:ye,baseColorTexture:me?D[me.index]:void 0,metallicRoughnessTexture:we?D[we.index]:void 0},doubleSided:te,emissiveFactor:new bn(...k),alphaMode:$,alphaCutoff:H,normalTexture:j?D[j.index]:void 0,occlusionTexture:Ie,emissionTexture:Y?D[Y.index]:void 0,defined:z.defined===void 0}})(A!==void 0?t.json.materials[A]:{defined:!1},r),g}function gA(a,t,r){const{matrix:c,rotation:d,translation:g,scale:_,mesh:v,extras:S,children:T,name:M}=a,A={};if(A.name=M,A.localMatrix=c||(function(z,D,k,$){var H=D[0],j=D[1],X=D[2],Y=D[3],te=H+H,ue=j+j,le=X+X,ge=H*te,ye=H*ue,me=H*le,we=j*ue,Ie=j*le,Je=X*le,qe=Y*te,Xe=Y*ue,at=Y*le,nt=$[0],ot=$[1],Ge=$[2];return z[0]=(1-(we+Je))*nt,z[1]=(ye+at)*nt,z[2]=(me-Xe)*nt,z[3]=0,z[4]=(ye-at)*ot,z[5]=(1-(ge+Je))*ot,z[6]=(Ie+qe)*ot,z[7]=0,z[8]=(me+Xe)*Ge,z[9]=(Ie-qe)*Ge,z[10]=(1-(ge+we))*Ge,z[11]=0,z[12]=k[0],z[13]=k[1],z[14]=k[2],z[15]=1,z})([],d||[0,0,0,1],g||[0,0,0],_||[1,1,1]),A.globalMatrix=se(A.localMatrix),v!==void 0){A.meshes=r[v];const z=A.anchor=[0,0];for(const D of A.meshes){const{min:k,max:$}=D.aabb;z[0]+=k[0]+$[0],z[1]+=k[1]+$[1]}z[0]=Math.floor(z[0]/A.meshes.length/2),z[1]=Math.floor(z[1]/A.meshes.length/2)}if(S&&(S.id&&(A.id=S.id),S.lights&&(A.lights=(function(z){if(!z.length)return[];const D=(function(X){const Y=atob(X),te=new Uint8Array(Y.length);for(let ue=0;ue<Y.length;ue++)te[ue]=Y.codePointAt(ue);return te})(z),k=[],$=D.length/24,H=new Uint16Array(D.buffer),j=new Float32Array(D.buffer);for(let X=0;X<$;X++){const Y=H[2*X*6]/30,te=H[2*X*6+1]/30,ue=H[2*X*6+10]/100,le=j[6*X+1],ge=j[6*X+2],ye=j[6*X+3],me=j[6*X+4],we=ye-le,Ie=me-ge,Je=Math.hypot(we,Ie);k.push({pos:[le+.5*we,ge+.5*Ie,te],normal:[Ie/Je,-we/Je,0],width:Je,height:Y,depth:ue,points:[le,ge,ye,me]})}return k})(S.lights)),S.MAPBOX_geometry_bloom&&(A.isGeometryBloom=S.MAPBOX_geometry_bloom)),T){const z=[];for(const D of T)z.push(gA(t.json.nodes[D],t,r));A.children=z}return A}function oU(a){if(a.vertices.length===0||a.indices.length===0)return null;const t=new Qv(a.vertices,a.indices,8,256),[r,c]=[t.min.clone(),t.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:t,min:r,max:c}}function sU(a){if(!a.extras||!a.extras.ground)return null;const t=a.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const r=t[0];if(!r||!Array.isArray(r)||r.length===0)return null;const c=[];for(const _ of r){if(!Array.isArray(_)||_.length!==2)continue;const v=_[0],S=_[1];typeof v=="number"&&typeof S=="number"&&c.push(new Ae(v,S))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let d=0;for(let _=0;_<c.length;_++){const v=c[_],S=c[(_+1)%c.length],T=c[(_+2)%c.length];d+=(v.x-S.x)*(T.y-S.y)-(T.x-S.x)*(v.y-S.y)}d>0&&c.reverse();const g=mf(c.flatMap(_=>[_.x,_.y]),[]);return g.length===0?null:{vertices:c,indices:g}}function aU(a,t){const r=[],c=[];let d=0;const g=[];for(const _ of a){d=r.length;const v=_.vertexArray.float32,S=_.indexArray.uint16;for(let T=0;T<_.vertexArray.length;T++)g[0]=v[3*T+0],g[1]=v[3*T+1],g[2]=v[3*T+2],qt(g,g,t),r.push(new Ae(g[0],g[1]));for(let T=0;T<3*_.indexArray.length;T++)c.push(S[T]+d)}if(c.length%3!=0)return null;for(let _=0;_<c.length;_+=3){const v=r[c[_+0]],S=r[c[_+1]],T=r[c[_+2]];(v.x-S.x)*(T.y-S.y)-(T.x-S.x)*(v.y-S.y)>0&&([c[_+1],c[_+2]]=[c[_+2],c[_+1]])}return{vertices:r,indices:c}}function A1(a){const t=(function(S,T){const M=[],A=WebGL2RenderingContext;if(S.json.textures)for(const z of S.json.textures){const D={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};z.sampler!==void 0&&Object.assign(D,S.json.samplers[z.sampler]),M.push({image:T[z.source],sampler:D,uploaded:!1})}return M})(a,a.images),r=(function(S,T){const M=[];for(const A of S.json.meshes){const z=[];for(const D of A.primitives)z.push(rU(D,S,T));M.push(z)}return M})(a,t),{scenes:c,scene:d,nodes:g}=a.json,_=c?c[d||0].nodes:[...g.keys()],v=[];for(const S of _)v.push(gA(g[S],a,r));return(function(S,T,M){const A={},z=new Set;for(let D=0;D<S.length;D++){const k=M[T[D]];if(!k.extras)continue;const $=k.extras["mapbox:footprint:version"],H=k.extras["mapbox:footprint:id"];($||H)&&z.add(D),$==="1.0.0"&&H&&(A[H]=D)}for(let D=0;D<S.length;D++){if(z.has(D))continue;const k=S[D],$=M[T[D]];if(!$.extras)continue;let H=null;k.id in A&&(H=aU(S[A[k.id]].meshes,k.localMatrix)),H||(H=sU($)),H&&(k.footprint=oU(H))}if(z.size>0){const D=Array.from(z.values()).sort((k,$)=>k-$);for(let k=D.length-1;k>=0;k--)S.splice(D[k],1)}})(v,_,a.json.nodes),v}function lU(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const t=a.vertexArray.float32,r=a.aabb.min[0]-1,c=a.aabb.min[1]-1,d=Gh/(a.aabb.max[0]-r+2),g=Gh/(a.aabb.max[1]-c+2);for(let _=0;_<t.length;_+=3){const v=t[_+2],S=(t[_+0]-r)*d|0,T=(t[_+1]-c)*g|0;v>a.heightmap[T*Gh+S]&&(a.heightmap[T*Gh+S]=v)}}function _A(a,t,r,c,d){r.reserve(r.length+4*a.length),c.reserve(c.length+10*a.length),d.reserve(d.length+10*a.length);let g=c.length;for(const _ of a){const v=Math.min(10,Math.max(4,1.3*_.height))*t,S=[-_.normal[1],_.normal[0],0],T=Math.min(.29,.1*_.width/_.depth),M=_.width-2*_.depth*t*(T+.01),A=Rn([],_.pos,S,M/2),z=Rn([],_.pos,S,-M/2),D=[A[0],A[1],A[2]+_.height],k=[z[0],z[1],z[2]+_.height],$=Rn([],_.normal,S,T);wi($,$,v);const H=Rn([],_.normal,S,-T);wi(H,H,v),ei($,A,$),ei(H,z,H),A[2]+=.1,z[2]+=.1,c.emplaceBack($[0],$[1],$[2]),c.emplaceBack(H[0],H[1],H[2]),c.emplaceBack(A[0],A[1],A[2]),c.emplaceBack(z[0],z[1],z[2]),c.emplaceBack(D[0],D[1],D[2]),c.emplaceBack(k[0],k[1],k[2]),c.emplaceBack(A[0],A[1],A[2]),c.emplaceBack(z[0],z[1],z[2]),c.emplaceBack($[0],$[1],$[2]),c.emplaceBack(H[0],H[1],H[2]);const j=M/v/2;d.emplaceBack(-j-T,-1,j,.8),d.emplaceBack(j+T,-1,j,.8),d.emplaceBack(-j,0,j,1.3),d.emplaceBack(j,0,j,1.3),d.emplaceBack(j+T,-.8,j,.7),d.emplaceBack(j+T,-.8,j,.7),d.emplaceBack(0,0,j,1.3),d.emplaceBack(0,0,j,1.3),d.emplaceBack(j+T,-1.2,j,.8),d.emplaceBack(j+T,-1.2,j,.8),r.emplaceBack(6+g,4+g,8+g),r.emplaceBack(7+g,9+g,5+g),r.emplaceBack(0+g,1+g,2+g),r.emplaceBack(1+g,3+g,2+g),g+=10}}function cU(a,t){const r={};r.indexArray=new Hr,r.vertexArray=new ra,r.colorArray=new Wl,_A(a,t,r.indexArray,r.vertexArray,r.colorArray);const c={defined:!0};c.emissiveFactor=bn.black;const d={};return d.baseColorFactor=bn.white,c.pbrMetallicRoughness=d,r.material=c,r.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const yA=Ki([{name:"a_pos_3f",components:3,type:"Float32"}]),uU=Ki([{name:"a_normal_3",components:3,type:"Int16"}]),hU=Ki([{name:"a_centroid_3",components:3,type:"Int16"}]),vA=Ki([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),dU=Ki([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),fU=Ki([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),pU=Ki([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),mU=Ki([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),gU=Ki([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),xA=en.types,px=32767;function _U(a,t){const r=It+t;for(const c of a)for(const d of c)if(d.x<-t||d.x>r||d.y<-t||d.y>r)return!1;return!0}function yU(a){switch(a){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${a}`)}}class P1{constructor(){this.layoutVertexArray=new ra,this.layoutAttenuationArray=new Wl,this.layoutColorArray=new Os,this.indexArray=new Hr,this.indexArrayForConflation=new Hr,this.segmentsBucket=new er}}class z1{constructor(t){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new er,this.entranceBloom=new P1;const r=66560;this.layoutVertexArray=new ra,this.layoutVertexArray.reserve(r),this.layoutNormalArray=new dl,this.layoutNormalArray.reserve(r),this.layoutCentroidArray=new dl,this.layoutCentroidArray.reserve(r),this.layoutColorArray=new Os,this.layoutColorArray.reserve(r),this.layoutFloodLightDataArray=new Lh,this.layoutFloodLightDataArray.reserve(r),this.layoutAOArray=new hf,this.layoutAOArray.reserve(r),this.indexArray=new Hr,this.indexArray.reserve(66560),this.indexArrayForConflation=new Hr,this.segmentsBucket=new er,this.entranceBloom=new P1,t&&(this.layoutFacadePaintArray=new Os,this.layoutFacadeDataArray=new pu,this.layoutFacadeVerticalRangeArray=new Os)}reserve(t,r,c){this.layoutVertexArray.reserveForAdditional(t),this.layoutCentroidArray.reserveForAdditional(t),this.layoutFloodLightDataArray.reserveForAdditional(t),this.layoutNormalArray.reserveForAdditional(t),this.layoutAOArray.reserveForAdditional(t),this.layoutColorArray.reserveForAdditional(t),this.indexArray.reserveForAdditional(r),c&&(this.layoutFacadePaintArray.reserveForAdditional(t),this.layoutFacadeDataArray.reserveForAdditional(t),this.layoutFacadeVerticalRangeArray.reserveForAdditional(t))}}class bA{constructor(t){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Tc,this.footprintsIndices=new Lh,this.footprintsMin=new Ae(1/0,1/0),this.footprintsMax=new Ae(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new z1(!1),this.buildingWithFacade=new z1(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.worldview=t.worldview,this.lut=t.lut,this.programConfigurations=new R(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection,this.groundEffect=new d1(t),this.groundEffect.groundRadiusArray=new yo,this.hasAppearances=null}updateFootprints(t,r){const c=new Qv([],[],1),d={vertices:[],indices:new Uint32Array(0),grid:c,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};r.push({footprint:d,id:t})}updateAppearances(t,r,c,d){}prepare(){return(function(){if(sx!=null||XM!=null)return null;if(wf!=null)return wf;const t=fetch(jr.BUILDING_GEN_URL);return wf=(function(r){let c,d,g,_,v;function S(){c=new Uint8Array(v.buffer),d=new Int16Array(v.buffer),g=new Int32Array(v.buffer),_=new Float32Array(v.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const M=()=>{},A={a:{a:T,f:function(z){const D=c.length,k=Math.max(z>>>0,Math.ceil(1.2*D)),$=Math.ceil((k-D)/65536);try{return v.grow($),S(),!0}catch{return!1}},g:T,b:M,c:M,d:M,e:M}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,A):r.then(z=>z.arrayBuffer()).then(z=>WebAssembly.instantiate(z,A))).then(z=>{const D=z.instance.exports;return(0,D.g)(),v=D.f,S(),new VN({setStyle:D.h,setAOOptions:D.i,setMetricOptions:D.j,setStructuralOptions:D.k,setFacadeOptions:D.l,setFauxFacadeOptions:D.m,setFacadeClassifierOptions:D.n,addFeature:D.o,addFacade:D.p,generateMesh:D.q,getLastError:D.r,getOuterRingLength:D.s,getMeshCount:D.t,getPositionsPtr:D.u,getPositionsLength:D.v,getNormalsPtr:D.w,getNormalsLength:D.x,getAOPtr:D.y,getAOLength:D.z,getUVPtr:D.A,getUVLength:D.B,getFauxFacadePtr:D.C,getFauxFacadeLength:D.D,getIndicesPtr:D.E,getIndicesLength:D.F,getBuildingPart:D.G,getRingCount:D.H,getRingPtr:D.I,getRingLength:D.J,malloc:D.K,free:D.L,heapU8:c,heap16:d,heap32:g,heapF32:_})})})(t).then(r=>(wf=null,sx=r,sx)).catch(r=>{vi("Could not load building-gen"),wf=null,XM=r}),wf})()}populate(t,r,c,d){const g=jN();if(!g)return;const _=vt(c);this.tileToMeter=_,this.brightness=r.brightness,g.setStyle({normalScale:[1,-1,_],tileToMeters:_}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const v=new Map,S=new Map;let T=0;for(const{feature:j}of t){if(xA[j.type]!=="LineString"){v.set(j.id,j.properties.source_id);continue}const X=this.layers[0]._featureFilter.needGeometry;if(X&&!this.layers[0]._featureFilter.filter(new An(this.zoom),j,c))continue;const Y=Ni(j,X);if(!X&&!this.layers[0]._featureFilter.filter(new An(this.zoom),Y,c))continue;const te=X?Y.geometry:pi(j,c,d),ue=[];for(const me of te)for(const we of me)ue.push(we.x),ue.push(we.y);const le={coordinates:ue,crossPerc:j.properties.cross_perc,distanceToRoad:j.properties.distance_to_road,entrances:j.properties.entrances,sourceId:0},ge=j.properties.source_id;let ye=S.get(ge);ye||(ye=[],S.set(ge,ye)),ye.push(le),++T}this.maxHeight=0;const M=new Array,A=new Set,z=j=>{j!=null&&A.add(j)},D=(j,X)=>{j!=null&&M.push({buildingId:j,footprintIndex:X})},k=64*(t.length-T),$=k/2;this.buildingWithFacade.reserve(k,$,!0),this.buildingWithoutFacade.reserve(2*k,2*$,!1),this.footprintsIndices.reserve(16*(t.length-T)),this.footprintsVertices.reserve(8*(t.length-T));for(const{feature:j,id:X,index:Y,sourceLayerIndex:te}of t){if(xA[j.type]==="LineString")continue;const ue=this.layers[0]._featureFilter.needGeometry;if(ue&&!this.layers[0]._featureFilter.filter(new An(this.zoom),j,c))continue;let le=null;if(j.properties&&j.properties.hasOwnProperty("building_id")&&(le=Number(j.properties.building_id),A.has(le)))continue;const ge=Ni(j,ue);if(!ue&&!this.layers[0]._featureFilter.filter(new An(this.zoom),ge,c))continue;const ye=ue?ge.geometry:pi(j,c,d),me=hg(ye,500);let we=!1;for(const Zi of me)if(Zi.length!==1){we=!0;break}if(we){z(le);continue}if(!_U(ye,163)){z(le);continue}const Ie=this.layers[0],Je=yU(Ie.layout.get("building-roof-shape").evaluate(j,{},c)),qe=Ie.layout.get("building-base").evaluate(j,{},c),Xe=Ie.layout.get("building-height").evaluate(j,{},c),at=Ie.layout.get("building-flood-light-ground-radius").evaluate(j,{},c),nt=Ie.paint.get("building-ambient-occlusion-intensity"),ot=at/this.tileToMeter;j.properties["building-part"]="roof";const Ge=Ie.paint.get("building-color").evaluate(j,{},this.canonical).toPremultipliedRenderColor(this.lut),ct=Ie.paint.get("building-emissive-strength").evaluate(j,{},this.canonical);j.properties["building-part"]="wall";const et=Ie.paint.get("building-color").evaluate(j,{},this.canonical).toPremultipliedRenderColor(this.lut),ut=Ie.paint.get("building-emissive-strength").evaluate(j,{},this.canonical);j.properties["building-part"]="window";const lt=Ie.paint.get("building-color").evaluate(j,{},this.canonical).toPremultipliedRenderColor(this.lut),Bt=Ie.paint.get("building-emissive-strength").evaluate(j,{},this.canonical);j.properties["building-part"]="door";const Ut=Ie.paint.get("building-color").evaluate(j,{},this.canonical).toPremultipliedRenderColor(this.lut),Tt=Ie.paint.get("building-emissive-strength").evaluate(j,{},this.canonical);let Mt=Ie.layout.get("building-flood-light-wall-radius").evaluate(j,{},c);Mt=de(Mt,0,2048);const li=Mt/2048*px,Yt=v.get(X),Ct=S.get(Yt)||[],bi=Ct.length!==0&&Ie.layout.get("building-facade").evaluate(j,{},c);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(bi,!1,1);let qi=0,pn=0,Hi=0,Pn=0,an=0,wr=0,cn=0,In=0,Jn=0,or=0,sr=0;if(bi){let Zi=Math.round(Ie.layout.get("building-facade-floors").evaluate(j,{},c));if(qe===0){Zi=Math.max(1,Zi-(Ct.length>0?1:0));let Tr=4;if(Xe>100){const qr=[10,13,15];Tr=qr[j.id?j.id%qr.length:0]}else Xe<=10&&(Tr=3);g.setFacadeOptions(Tr,!0),an=(Xe<15?1.3:1.61803)*Tr/_}else an=qe/_;wr=Xe/_,an=Math.min(an,wr),Hi=Ie.layout.get("building-facade-unit-width").evaluate(j,{},c)/_,Pn=(wr-an)/Zi,g.setFauxFacadeOptions(!0,!0,Hi);const ao=Ie.layout.get("building-facade-window").evaluate(j,{},c);qi=ao[0],pn=ao[1],cn=Math.floor(65535*Math.min(1,an/It)),In=Math.floor(65535*Math.min(1,wr/It)),Jn=Math.floor(255*qi)<<8|Math.floor(255*pn),or=Math.floor(65535*Math.min(1,Hi/It)),sr=Math.floor(65535*Math.min(1,Pn/It))}const Sr=Array(me.length),vo={x:1/0,y:1/0},Ao={x:-1/0,y:-1/0},Ur={x:0,y:0};let Wr=0;for(let Zi=0;Zi<me.length;Zi++){const ao=me[Zi];if(ao.length>0){const Tr=[],qr=Array(ao.length+1);qr[0]=0;for(let va=0;va<ao.length;va++){const Es=ao[va];for(let Gs=0;Gs<Es.length;Gs++){const lo=Es[Es.length-Gs-1];vo.x=Math.min(vo.x,lo.x),vo.y=Math.min(vo.y,lo.y),Ao.x=Math.max(Ao.x,lo.x),Ao.y=Math.max(Ao.y,lo.y),Ur.x+=lo.x,Ur.y+=lo.y,Wr++,Tr.push(lo.x),Tr.push(lo.y)}qr[va+1]=Tr.length}Sr[Zi]={id:j.id?j.id:0,height:Xe,minHeight:qe,sourceId:0,roofType:Je,coordinates:Tr,ringIndices:qr}}}Ur.x/=Wr||1,Ur.y/=Wr||1;const Kr=g.generateMesh(Sr,Ct);if(typeof Kr=="string"){vi(`Unable to generate building ${j.id}: ${Kr}`),z(le);continue}if(Kr.meshes.length===0||Kr.modifiedPolygonRings.length===0){z(le);continue}const $i=bi?this.buildingWithFacade:this.buildingWithoutFacade;let ar=0;for(const Zi of Kr.meshes)ar+=Zi.positions.length/3;const dr=$i.segmentsBucket.prepareSegment(ar,$i.layoutVertexArray,$i.indexArray),js=[];let Wo=null,xo=0,qo=-1;const Yl=$i.layoutVertexArray.length,Ro=Yl+ar;$i.layoutVertexArray.resize(Ro),$i.layoutCentroidArray.resize(Ro),$i.layoutNormalArray.resize(Ro),$i.layoutAOArray.resize(Ro),$i.layoutColorArray.resize(Ro),$i.layoutFloodLightDataArray.resize(Ro),bi&&($i.layoutFacadePaintArray.resize(Ro),$i.layoutFacadeDataArray.resize(Ro),$i.layoutFacadeVerticalRangeArray.resize(Ro));const Nx=$i.indexArray.length;let kf=0,ls=Yl;for(const Zi of Kr.meshes){let ao,Tr;if(Zi.buildingPart===1)ao=Ge,Tr=ct;else if(Zi.buildingPart===0)ao=et,Tr=ut;else if(Zi.buildingPart===2)ao=lt,Tr=Bt;else{if(Zi.buildingPart!==3)continue;ao=Ut,Tr=Tt}if(Tr=de(Tr,0,1),Zi.buildingPart===3){const $r=new Array;for(let ko=0;ko<Zi.positions.length;ko+=12){const Pu=Zi.positions[ko+0],wo=Zi.positions[ko+1],Is=Zi.positions[ko+3],Va=Zi.positions[ko+4],ec=Zi.positions[ko+2],mS=Zi.positions[ko+8]-ec,gS=1,qg=Is-Pu,Ff=Va-wo,yl=Math.hypot(qg,Ff);$r.push({pos:[Pu+.5*qg,wo+.5*Ff,ec],normal:[Ff/yl,-qg/yl,0],width:yl,height:mS,depth:gS,points:[Pu,wo,Is,Va]})}const bo=$i.entranceBloom.segmentsBucket.prepareSegment(10*$r.length,$i.entranceBloom.layoutVertexArray,$i.entranceBloom.indexArray),Xr=$i.entranceBloom.layoutVertexArray.length;xo=$i.entranceBloom.indexArray.length,_A($r,.5/this.tileToMeter,$i.entranceBloom.indexArray,$i.entranceBloom.layoutVertexArray,$i.entranceBloom.layoutAttenuationArray);const Do=$i.entranceBloom.layoutVertexArray.length-Xr;qo=$i.entranceBloom.indexArray.length-xo;for(let ko=0;ko<Do;ko++)$i.entranceBloom.layoutColorArray.emplaceBack(255*Ut.r<<8|255*Ut.g,255*Ut.b<<8|51*Tt);bo.vertexLength+=Do,bo.primitiveLength+=qo,Wo={part:Zi.buildingPart,vertexOffset:Xr,vertexLength:Do}}$i.layoutVertexArray.float32.set(Zi.positions,3*ls);const qr=Zi.positions.length/3;for(let $r=0;$r<qr;++$r){const bo=3*$r;kf=Math.max(kf,Zi.positions[bo+2]);const Xr=Zi.normals[bo+1]*px,Do=Zi.normals[bo+2]*px,ko=3*(ls+$r);$i.layoutNormalArray.int16[ko]=Zi.normals[bo]*px,$i.layoutNormalArray.int16[ko+1]=Xr,$i.layoutNormalArray.int16[ko+2]=Do;const Pu=Zi.ao[$r];$i.layoutAOArray.uint8[ls+$r]=255*Pu;const wo=1+(Pu-1)*nt,Is=255*ao.b*wo<<8|255*Tr;$i.layoutColorArray.uint16[2*(ls+$r)]=255*ao.r*wo<<8|255*ao.g*wo,$i.layoutColorArray.uint16[2*(ls+$r)+1]=Is}const va=Math.floor(Ur.x),Es=Math.floor(Ur.y),Gs=Math.floor(Xe);for(let $r=0;$r<qr;++$r){const bo=3*(ls+$r);$i.layoutCentroidArray.int16[bo]=va,$i.layoutCentroidArray.int16[bo+1]=Es,$i.layoutCentroidArray.int16[bo+2]=Gs}if($i.layoutFloodLightDataArray.uint16.fill(Zi.buildingPart===0?li:0,ls,ls+qr),bi){const $r=255*lt.r<<8|255*lt.g,bo=255*lt.b<<8|255*Bt;for(let Xr=0;Xr<qr;++Xr){const Do=2*(ls+Xr);$i.layoutFacadePaintArray.uint16[Do]=$r,$i.layoutFacadePaintArray.uint16[Do+1]=bo}for(let Xr=0;Xr<qr;++Xr)if(Zi.isFauxFacade[Xr]){const Do=Math.min(65535,Math.floor(Zi.uv[2*Xr]*Kr.outerRingLength));$i.layoutFacadeDataArray.emplace(ls+Xr,1|Do,Jn,or,sr),$i.layoutFacadeVerticalRangeArray.emplace(ls+Xr,cn,In)}else $i.layoutFacadeDataArray.emplace(ls+Xr,0,0,0,0),$i.layoutFacadeVerticalRangeArray.emplace(ls+Xr,0,0)}const lo=dr.vertexLength,Wg=Zi.indices.length/3,Ql=$i.indexArray.length;$i.indexArray.resize(Ql+Wg);for(let $r=0;$r<Wg;++$r){const bo=3*$r,Xr=3*Ql+bo;$i.indexArray.uint16[Xr]=lo+Zi.indices[bo],$i.indexArray.uint16[Xr+1]=lo+Zi.indices[bo+1],$i.indexArray.uint16[Xr+2]=lo+Zi.indices[bo+2]}Zi.buildingPart!==1&&Zi.buildingPart!==0&&Zi.buildingPart!==2&&Zi.buildingPart!==3||js.push({part:Zi.buildingPart,vertexOffset:ls,vertexLength:Zi.positions.length/3}),ls+=qr,dr.vertexLength+=qr,dr.primitiveLength+=Zi.indices.length/3}this.maxHeight=Math.max(this.maxHeight,kf);const Ux=$i.indexArray.length-Nx,Kl=this.footprintsIndices.length,Cc=this.footprintsVertices.length,Au=[],ya=new Ae(1/0,1/0),$a=new Ae(-1/0,-1/0),Zg=this.groundEffect.vertexArray.length;for(const Zi of Kr.modifiedPolygonRings){const ao=[],Tr=new Ae(1/0,1/0),qr=new Ae(-1/0,-1/0);for(let va=0;va<Zi.length;va+=2){const Es=Zi.length-va-2;Tr.x=Math.min(Tr.x,Zi[Es]),Tr.y=Math.min(Tr.y,Zi[Es+1]),qr.x=Math.max(qr.x,Zi[Es]),qr.y=Math.max(qr.y,Zi[Es+1]);const Gs=new Ae(Zi[Es],Zi[Es+1]);ao.push(Gs),Au.push(Gs.x,Gs.y),this.footprintsVertices.emplaceBack(Gs.x,Gs.y)}ya.x=Math.min(ya.x,Tr.x),ya.y=Math.min(ya.y,Tr.y),$a.x=Math.max($a.x,qr.x),$a.y=Math.max($a.y,qr.y),this.groundEffect.addData(ao,[Tr,qr],ot)}const Of=this.groundEffect.vertexArray.length-Zg;this.groundEffect.groundRadiusArray.reserveForAdditional(Of);for(let Zi=0;Zi<Of;Zi++)this.groundEffect.groundRadiusArray.emplaceBack(at);(vo.x<0||Ao.x>It||vo.y<0||Ao.y>It)&&this.featuresOnBorder.push({featureId:j.id,footprintIndex:this.footprints.length});{const Zi=mf(Au,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Zi.length),this.footprintsIndices.uint16.set(Zi,Kl),this.buildingIds.add(le??j.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,ya.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,ya.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,$a.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,$a.y);const ao={footprintVertexOffset:Cc,footprintVertexLength:this.footprintsVertices.length-Cc,footprintIndexOffset:Kl,footprintIndexLength:this.footprintsIndices.length-Kl,min:ya,max:$a,hiddenFlags:0,indicesOffset:Nx,indicesLength:Ux,bloomIndicesOffset:xo,bloomIndicesLength:qo,groundEffectVertexOffset:Zg,groundEffectVertexLength:Of,hasFauxFacade:bi,height:kf,promoteId:X,feature:ge,parts:js,buildingBloom:Wo},Tr=this.footprints.length;j.id!==void 0&&this.featureFootprintLookup.set(j.id,Tr),D(le,Tr),this.footprints.push(ao)}this.programConfigurations.populatePaintArrays($i.layoutVertexArray.length,j,Y,{},r.availableImages,c,r.brightness),this.groundEffect.addPaintPropertiesData(j,Y,{},r.availableImages,c,r.brightness),r.featureIndex.insert(j,ye,Y,te,this.index,Yl)}M.forEach(({buildingId:j,footprintIndex:X})=>{A.has(j)&&(this.footprints[X].hiddenFlags|=4)});const H=new Set;this.buildingIds.forEach((j,X,Y)=>{A.has(j)||H.add(j)}),this.buildingIds=H,this.groundEffect.prepareBorderSegments()}update(t,r,c,d,g,_,v){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v),this.groundEffect.update(t,r,g,c,d,_,v),this.evaluate(this.layers[0],t),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){const r=c=>{c.layoutVertexBuffer=t.createVertexBuffer(c.layoutVertexArray,yA.members),c.layoutNormalBuffer=t.createVertexBuffer(c.layoutNormalArray,uU.members),c.layoutCentroidBuffer=t.createVertexBuffer(c.layoutCentroidArray,hU.members),c.layoutFloodLightDataBuffer=t.createVertexBuffer(c.layoutFloodLightDataArray,gU.members),c.layoutFacadeDataArray&&c.layoutFacadeDataArray.length&&(c.layoutFacadeDataBuffer=t.createVertexBuffer(c.layoutFacadeDataArray,fU.members)),c.layoutFacadeVerticalRangeArray&&c.layoutFacadeVerticalRangeArray.length&&(c.layoutFacadeVerticalRangeBuffer=t.createVertexBuffer(c.layoutFacadeVerticalRangeArray,pU.members)),c.entranceBloom.layoutVertexArray.length&&(c.entranceBloom.layoutVertexBuffer=t.createVertexBuffer(c.entranceBloom.layoutVertexArray,yA.members),c.entranceBloom.layoutAttenuationBuffer=t.createVertexBuffer(c.entranceBloom.layoutAttenuationArray,mU.members)),this.uploadUpdatedColorBuffer(t),this.uploadUpdatedIndexBuffer(t)};this.uploaded||(r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){const t=r=>{r.layoutVertexBuffer&&(r.layoutVertexBuffer.destroy(),r.layoutNormalBuffer.destroy(),r.layoutColorBuffer.destroy(),r.segmentsBucket.destroy(),r.indexBuffer&&r.indexBuffer.destroy(),r.entranceBloom.layoutVertexBuffer&&(r.entranceBloom.layoutVertexBuffer.destroy(),r.entranceBloom.layoutColorBuffer.destroy(),r.entranceBloom.layoutAttenuationBuffer.destroy(),r.entranceBloom.indexBuffer.destroy(),r.entranceBloom.segmentsBucket.destroy()))};t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(t,r,c=!0){let d=!1;const g=c?r:0,_=0|(c?-1:~r);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of t){const S=this.footprints[v],T=S.hiddenFlags&_|g;S.hiddenFlags!==T&&(S.hiddenFlags=T,d=!0,this.groundEffect.updateHiddenByLandmarkRange(S.groundEffectVertexOffset,S.groundEffectVertexLength,S.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(t){if(this.groundEffect.uploadHiddenByLandmark(t),this.indexArrayForConflationUploaded)return;const r=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};r(this.buildingWithoutFacade),r(this.buildingWithFacade);for(const d of this.footprints){const g=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let S=d.indicesOffset;S<_;S++)g.indexArrayForConflation.uint16[3*S+0]=0,g.indexArrayForConflation.uint16[3*S+1]=0,g.indexArrayForConflation.uint16[3*S+2]=0;const v=d.bloomIndicesOffset+d.bloomIndicesLength;for(let S=d.bloomIndicesOffset;S<v;S++)g.entranceBloom.indexArrayForConflation.uint16[3*S+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*S+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*S+2]=0}}const c=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=t.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=t.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(t){const r=c=>{c.layoutColorBuffer?c.layoutColorBuffer.updateData(c.layoutColorArray):c.layoutColorBuffer=t.createVertexBuffer(c.layoutColorArray,vA.members,!0),c.layoutFacadePaintArray&&(c.layoutFacadePaintBuffer?c.layoutFacadePaintBuffer.updateData(c.layoutFacadePaintArray):c.layoutFacadePaintBuffer=t.createVertexBuffer(c.layoutFacadePaintArray,dU.members,!0)),c.entranceBloom.layoutColorBuffer?c.entranceBloom.layoutColorBuffer.updateData(c.entranceBloom.layoutColorArray):c.entranceBloom.layoutColorBuffer=t.createVertexBuffer(c.entranceBloom.layoutColorArray,vA.members,!0)};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(t,r){const c=t.paint.get("building-ambient-occlusion-intensity");for(const d of this.footprints){if(4&d.hiddenFlags)continue;const g=r[d.promoteId],_=d.feature;_.properties["building-part"]="roof";const v=t.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),S=t.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="wall";const T=t.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),M=t.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="window";const A=t.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),z=t.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="door";const D=t.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),k=t.paint.get("building-emissive-strength").evaluate(_,g,this.canonical),$=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const j of d.parts){let X,Y=v;j.part===1?(Y=v,X=S):j.part===0?(Y=T,X=M):j.part===2?(Y=A,X=z):j.part===3&&(Y=D,X=k),X=de(X,0,1);for(let te=0;te<j.vertexLength;te++){const ue=j.vertexOffset+te,le=1+($.layoutAOArray.uint8[ue]/255-1)*c;$.layoutColorArray.emplace(ue,Y.r*le*255<<8|Y.g*le*255,Y.b*le*255<<8|255*X),d.hasFauxFacade&&$.layoutFacadePaintArray.emplace(ue,255*A.r<<8|255*A.g,255*A.b<<8|255*z)}}const H=d.buildingBloom;if(H)for(let j=0;j<H.vertexLength;j++)$.entranceBloom.layoutColorArray.emplace(H.vertexOffset+j,255*D.r<<8|255*D.g,255*D.b<<8|51*k)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(t,r,c){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const d=r.getReplacementRegionsForTile(t.toUnwrapped());if(tx(this.activeReplacements,d))return;this.activeReplacements=d;for(const _ of this.footprints)_.hiddenFlags&=-2;const g=[];for(const _ of this.activeReplacements){if(_.order<c)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-t.canonical.z));for(const S of this.footprints)S.min.x>_.max.x||S.max.x<_.min.x||S.min.y>_.max.y||S.max.y<_.min.y||(g.length=0,xU(this.footprintsVertices,S.footprintVertexOffset,S.footprintVertexLength,_.footprintTileId.canonical,t.canonical,g),c1(_.footprint,g,this.footprintsIndices.uint16,S.footprintIndexOffset,S.footprintIndexLength,0,-v)&&(S.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(t){if(t.id!==void 0){const r=this.featureFootprintLookup.get(t.id);return this.footprints[r]}return null}getHeightAtTileCoord(t,r){let c=Number.NEGATIVE_INFINITY,d=!0;const g=4*(t+It)*It+(r+It);if(this.footprintLookup.hasOwnProperty(g)){const v=this.footprintLookup[g];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const _=new Ae(t,r);for(const v of this.footprints)t>v.max.x||v.min.x>t||r>v.max.y||v.min.y>r||v.height<=c||vU(_,this.footprintsVertices.float32.subarray(2*v.footprintVertexOffset,2*(v.footprintVertexOffset+v.footprintVertexLength)),this.footprintsIndices.uint16.subarray(v.footprintIndexOffset,v.footprintIndexOffset+v.footprintIndexLength))&&(c=v.height,this.footprintLookup[g]=v,d=v.hiddenFlags!==0);if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:d};this.footprintLookup[g]=void 0}}function vU(a,t,r){for(let c=0;c<r.length;c+=3){const d=r[c],g=r[c+1],_=r[c+2],v=t[2*d+0],S=t[2*d+1],T=t[2*g+0],M=t[2*g+1],A=t[2*_+0],z=t[2*_+1],D=(v-A)*(a.y-z)-(S-z)*(a.x-A),k=(T-v)*(a.y-S)-(M-S)*(a.x-v);if(D<0!=k<0&&D!==0&&k!==0)continue;const $=(A-T)*(a.y-M)-(z-M)*(a.x-T);if($===0||$<0==D+k<=0)return!0}return!1}function xU(a,t,r,c,d,g){const _=Math.pow(2,c.z-d.z);for(let v=0;v<r;v++){let S=a.float32[2*(v+t)+0],T=a.float32[2*(v+t)+1];S=(S+d.x*It)*_-c.x*It,T=(T+d.y*It)*_-c.y*It,g.push(new Ae(S,T))}}let wA,SA;jt(bA,"BuildingBucket",{omit:["layers"]}),jt(z1,"BuildingGeometry"),jt(P1,"BuildingBloomGeometry");const bU=Ki([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),wU=Ki([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:SU}=bU,TU=Ki([{name:"a_packed",components:3,type:"Float32"}]),{members:EU}=TU,IU=Ki([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:MU}=IU;class TA{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new bu({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){const c=this.getKey(t,r);return this.positions[c]}trim(){const t=this.width,r=this.height=st(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,c){const d=[];let g=t.length%2==1?-t[t.length-1]*c:0,_=t[0]*c,v=!0;d.push({left:g,right:_,isDash:v,zeroLength:t[0]===0});let S=t[0];for(let T=1;T<t.length;T++){v=!v;const M=t[T];g=S*c,S+=M,_=S*c,d.push({left:g,right:_,isDash:v,zeroLength:M===0})}return d}addRoundDash(t,r,c){const d=r/2;for(let g=-c;g<=c;g++){const _=this.width*(this.nextRow+c+g);let v=0,S=t[v];for(let T=0;T<this.width;T++){T/S.right>1&&(S=t[++v]);const M=Math.abs(T-S.left),A=Math.abs(T-S.right),z=Math.min(M,A);let D;const k=g/c*(d+1);if(S.isDash){const $=d-Math.abs(k);D=Math.sqrt(z*z+$*$)}else D=d-Math.sqrt(z*z+k*k);this.image.data[_+T]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(t,r){for(let S=t.length-1;S>=0;--S){const T=t[S],M=t[S+1];T.zeroLength?t.splice(S,1):M&&M.isDash===T.isDash&&(M.left=T.left,t.splice(S,1))}const c=t[0],d=t[t.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const g=this.width*this.nextRow;let _=0,v=t[_];for(let S=0;S<this.width;S++){S/v.right>1&&(v=t[++_]);const T=Math.abs(S-v.left),M=Math.abs(S-v.right),A=Math.min(T,M);this.image.data[g+S]=Math.max(0,Math.min(255,(v.isDash?A:-A)+r+128))}}addDash(t,r){const c=this.getKey(t,r);if(this.positions[c])return this.positions[c];const d=r==="round",g=d?7:0,_=2*g+1;if(this.nextRow+_>this.height)return vi("LineAtlas out of space"),null;t.length===0&&t.push(1);let v=0;for(let M=0;M<t.length;M++)t[M]<0&&(vi("Negative value is found in line dasharray, replacing values with 0"),t[M]=0),v+=t[M];if(v!==0){const M=this.width/v,A=this.getDashRanges(t,this.width,M);d?this.addRoundDash(A,M,g):this.addRegularDash(A,r==="square"?.5*M:0)}const S=this.nextRow+g;this.nextRow+=_;const T={tl:[S,g],br:[v,0]};return this.positions[c]=T,T}}jt(TA,"LineAtlas");const AU=en.types,PU=Math.cos(Math.PI/180*37.5),zU=Math.cos(Math.PI/180*5);class C1{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Xm,this.layoutVertexArray2=new ra,this.patternVertexArray=new ra,this.indexArray=new Hr,this.programConfigurations=new R(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new er,this.maxLineLength=0,this.zOffsetVertexArray=new ra,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:128,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){this.hasPattern=Jw("line",this.layers,this.pixelRatio,r);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=vt(c);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const z=this.layers[0].layout.get("line-z-offset"),D=z.isConstant()&&!z.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&D?"none":"offset",this.elevationType==="offset"&&_==="none"&&vi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const S=[];for(const{feature:z,id:D,index:k,sourceLayerIndex:$}of t){const H=this.layers[0]._featureFilter.needGeometry,j=Ni(z,H);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),j,c))continue;const X=g?g.evaluate(j,{},c):void 0,Y={id:D,properties:z.properties,type:z.type,sourceLayerIndex:$,index:k,geometry:H?j.geometry:pi(z,c,d),patterns:{},sortKey:X};S.push(Y)}g&&S.sort((z,D)=>z.sortKey-D.sortKey);const{lineAtlas:T,featureIndex:M}=r,A=this.addConstantDashes(T);for(const z of S){const{geometry:D,index:k,sourceLayerIndex:$}=z;if(A&&this.addFeatureDashes(z,T),this.hasPattern){const H=Yw("line",this.layers,z,this.zoom,this.pixelRatio,r);this.patternFeatures.push(H)}else this.addFeature(z,D,k,c,T.positions,r.availableImages,r.brightness,r.elevationFeatures);M.insert(t[k].feature,D,k,$,this.index)}}addConstantDashes(t){let r=!1;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(d.kind!=="constant"||g.kind!=="constant")r=!0;else{const _=g.value,v=d.value;if(!v)continue;t.addDash(v,_)}}return r}addFeatureDashes(t,r){const c=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if(g.kind==="constant"&&_.kind==="constant")continue;let v,S;if(g.kind==="constant"){if(v=g.value,!v)continue}else v=g.evaluate({zoom:c},t);S=_.kind==="constant"?_.value:_.evaluate({zoom:c},t),r.addDash(v,S),t.patterns[d.id]=[r.getKey(v,S)]}}update(t,r,c,d,g,_,v,S){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,S)}addFeatures(t,r,c,d,g,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,c,d,_,t.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,EU)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,MU)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,wU.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,SU),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t,r){let c,d;if(r&&r>0?(c=`mapbox_clip_start_${r}`,d=`mapbox_clip_end_${r}`):(c="mapbox_clip_start",d="mapbox_clip_end"),t.properties&&t.properties.hasOwnProperty(c)&&t.properties.hasOwnProperty(d))return{start:+t.properties[c],end:+t.properties[d]}}addFeature(t,r,c,d,g,_,v,S){const T=this.layers[0].layout,M=T.get("line-join").evaluate(t,{}),A=T.get("line-cap").evaluate(t,{}),z=T.get("line-miter-limit"),D=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t;const k=!(!t.properties||!t.properties.hasOwnProperty("mapbox_line_metrics"))&&t.properties.mapbox_line_metrics;this.zOffsetValue=T.get("line-z-offset").value;const $=this.layers[0].paint.get("line-width").value;if($.kind!=="constant"&&$.isLineProgressConstant===!1&&(this.variableWidthValue=$),this.elevationType==="road"){const H=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(t,r,d,S,M,A,z,D)){const[j,X]=this.clipRuntimeLinesToTile(r,1);for(let Y=0;Y<j.length;Y++){const te=j[Y],ue=X[Y],le={progress:{min:ue.progress.min,max:ue.progress.max},nextDir:this.computeSegNextDir(ue,te),prevDir:this.computeSegPrevDir(ue,te)};this.addLine(te,t,d,M,A,z,D,le,k&&ue.parentIndex>0?ue.parentIndex:null)}this.fillNonElevatedRoadSegment(H)}}else for(let H=0;H<r.length;H++)this.addLine(r[H],t,d,M,A,z,D,void 0,k&&H>0?H:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,g,_,d,v,void 0,this.worldview)}computeSegNextDir(t,r){return t.nextPoint.sub(r.at(-2)).unit()}computeSegPrevDir(t,r){return r[1].sub(t.prevPoint).unit()}clipLinesToTile(t,r){return rx(t,-r,-r,It+r,It+r)}clipRuntimeLinesToTile(t,r){const c=[];return[rx(t,-r,-r,It+r,It+r,c),c]}addElevatedRoadFeature(t,r,c,d,g,_,v,S){const T=[],M=Go.getElevationFeature(t,d);if(M){const A=this.clipLinesToTile(r,1),z=this.prepareElevatedLines(A,M,c);for(const D of z)T.push({geometry:D,elevation:M,elevationTileID:c,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const A of T){const z=this.layoutVertexArray.length;this.addLine(A.geometry,t,c,g,_,v,S);const D=new oa(c,A.elevationTileID);if(A.elevation)for(let k=z;k<this.layoutVertexArray.length;k++){const $=new Ae(this.layoutVertexArray.int16[6*k]>>1,this.layoutVertexArray.int16[6*k+1]>>1),H=D.pointElevation($,A.elevation,.05);this.updateHeightRange(H),this.zOffsetVertexArray.emplaceBack(H,0,0)}else this.fillNonElevatedRoadSegment(z)}return!0}prepareElevatedLines(t,r,c){if(r.constantHeight!=null)return t;const d=[],g=1/vt(c);for(const _ of t)BN(_,new bs(r,g),0,d);return d}fillNonElevatedRoadSegment(t){for(let r=t;r<this.layoutVertexArray.length;r++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(t){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,t),this.heightRange.max=Math.max(this.heightRange.max,t)):this.heightRange={min:t,max:t}}addLine(t,r,c,d,g,_,v,S,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=T?this.lineFeatureClips(r,T):this.lineClips;const M=d==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const A=S&&S.progress.min>0,z=S&&S.progress.max<1;if(this.lineClips){let me={min:this.lineClips.start,max:this.lineClips.end},we=1;if(S){const qe=this.lineClips.end-this.lineClips.start;me=(function(Xe,at,nt){return{min:go(Xe.min,at,nt),max:go(Xe.max,at,nt)}})(S.progress,{min:0,max:1},me),qe>0&&(we=(me.max-me.min)/qe)}const Ie=+r.properties.mapbox_clip_feature_len,Je=+r.properties.mapbox_clip_seg_len;if(Number.isNaN(Ie)||Number.isNaN(Je)){for(let Xe=0;Xe<t.length-1;Xe++)this.totalDistance+=t[Xe].dist(t[Xe+1]);const qe=this.totalDistance/(me.max-me.min);this.totalFeatureLength=Number.isFinite(qe)?qe:0,this.lineClips.start=me.min,this.lineClips.end=me.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ie,this.distance=Je*we,this.lineClips.start=me.min,this.lineClips.end=me.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const D=AU[r.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let $=0;for(;$<k-1&&t[$].equals(t[$+1]);)$++;if(k<(D?3:2))return;d==="bevel"&&(_=1.05);const H=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let j,X,Y,te,ue,le,ge,ye;S&&S.prevDir&&(le=S.prevDir.perp()),S&&S.nextDir&&(ge=S.nextDir.perp()),this.e1=this.e2=-1,D&&(j=t[k-2],ue=t[$].sub(j)._unit()._perp());for(let me=$;me<k;me++){if(Y=me===k-1?D?t[$+1]:void 0:t[me+1],Y&&t[me].equals(Y))continue;ue&&(te=ue),j&&(X=j),j=t[me],ye=this.evaluateLineProgressFeatures(X?X.dist(j):0),ue=Y?Y.sub(j)._unit()._perp():te,te=te||ue;const we=X&&Y;let Ie=we?d:D||M?"butt":g;const Je=te.x*ue.x+te.y*ue.y;if(M){const et=function(ut){if(ut.patternJoinNone){const lt=ut.segmentPoints.length/2,Bt=ut.lineSoFar-ut.segmentStart;for(let Ut=0;Ut<lt;++Ut){const Tt=ut.segmentPoints[2*Ut+1],Mt=Math.round(ut.segmentPoints[2*Ut])+.5+.25*Tt;ut.patternVertexArray.emplaceBack(Mt,Bt,ut.segmentStart),ut.patternVertexArray.emplaceBack(Mt,Bt,ut.segmentStart)}ut.segmentPoints.length=0}ut.e1=ut.e2=-1};if(we&&Je<zU){this.updateDistance(X,j),this.addCurrentVertex(j,te,1,1,H,ye),et(this),this.addCurrentVertex(j,ue,-1,-1,H,ye);continue}if(X){if(!Y){this.updateDistance(X,j),this.addCurrentVertex(j,te,1,1,H,ye),et(this);continue}Ie="miter"}}let qe=te.add(ue);qe.x===0&&qe.y===0||qe._unit();const Xe=qe.x*ue.x+qe.y*ue.y,at=Xe!==0?1/Xe:1/0,nt=2*Math.sqrt(2-2*Xe),ot=Xe<PU&&X&&Y,Ge=te.x*ue.y-te.y*ue.x>0,ct=this.overscaling<=16?122880/(512*this.overscaling):0;if(we&&Ie==="round"){if(at<v)Ie="miter";else if(at<=2){const et=L1(j,-10,8202);Ie=this.elevationType==="offset"&&(et||this.hasCrossSlope)?"miter":"fakeround"}}if(Ie==="miter"&&at>_&&(Ie="bevel"),Ie==="bevel"&&(at>2&&(Ie="flipbevel"),at<_&&(Ie="miter")),X&&!(Ie==="miter"&&ot)&&this.updateDistance(X,j),Ie==="miter")if(ot){const et=j.dist(X);if(et>2*ct){const lt=j.sub(j.sub(X)._mult(ct/et)._round());this.updateDistance(X,lt),this.addCurrentVertex(lt,te,0,0,H,ye),X=lt}this.updateDistance(X,j),qe._mult(at),this.addCurrentVertex(j,qe,0,0,H,ye);const ut=j.dist(Y);if(ut>2*ct){const lt=j.add(Y.sub(j)._mult(ct/ut)._round());this.updateDistance(j,lt),this.addCurrentVertex(lt,ue,0,0,H,ye),j=lt}}else qe._mult(at),this.addCurrentVertex(j,qe,0,0,H,ye);else if(Ie==="flipbevel"){if(at>100)qe=ue.mult(-1);else{const et=at*te.add(ue).mag()/te.sub(ue).mag();qe._perp()._mult(et*(Ge?-1:1))}this.addCurrentVertex(j,qe,0,0,H,ye),this.addCurrentVertex(j,qe.mult(-1),0,0,H,ye)}else if(Ie==="bevel"||Ie==="fakeround"){ye!=null&&X&&this.addCurrentVertex(j,ge||te,-1,-1,H,ye);const et=j.dist(X)<=2*ct&&Ie!=="bevel",ut=qe.mult(Ge?1:-1);ut._mult(at);const lt=ue.mult(Ge?-1:1),Bt=te.mult(Ge?-1:1),Ut=this.evaluateLineProgressFeatures(this.distance);if(ye==null&&(this.addHalfVertex(j,ut.x,ut.y,!1,!Ge,0,H,Ut),et||this.addHalfVertex(j,ut.x+2*Bt.x,ut.y+2*Bt.y,!1,Ge,0,H,Ut)),Ie==="fakeround"){const Tt=Math.round(180*nt/Math.PI/20);this.addHalfVertex(j,Bt.x,Bt.y,!1,Ge,0,H,Ut);for(let Mt=0;Mt<Tt;Mt++){let li=Mt/Tt;if(li!==.5){const Ct=li-.5;li+=li*Ct*(li-1)*((1.0904+Je*(Je*(3.55645-1.43519*Je)-3.2452))*Ct*Ct+(.848013+Je*(.215638*Je-1.06021)))}const Yt=lt.sub(Bt)._mult(li)._add(Bt)._unit();this.addHalfVertex(j,Yt.x,Yt.y,!1,Ge,0,H,Ut)}this.addHalfVertex(j,lt.x,lt.y,!1,Ge,0,H,Ut)}et||ye!=null||this.addHalfVertex(j,ut.x+2*lt.x,ut.y+2*lt.y,!1,Ge,0,H,Ut),ye!=null&&Y&&this.addCurrentVertex(j,le||ue,1,1,H,ye)}else if(Ie==="butt")this.addCurrentVertex(j,qe,0,0,H,ye);else if(Ie==="square"){if(!X){const et=A?0:-1;this.addCurrentVertex(j,qe,et,et,H,ye)}if(this.addCurrentVertex(j,qe,0,0,H,ye),X){const et=z?0:1;this.addCurrentVertex(j,qe,et,et,H,ye)}}else if(Ie==="round"){if(X){const et=!we&&ge?ge:te;this.addCurrentVertex(j,et,0,0,H,ye),!we&&z||this.addCurrentVertex(j,et,1,1,H,ye,!0)}if(Y){const et=!we&&le?le:ue;!we&&A||this.addCurrentVertex(j,et,-1,-1,H,ye,!0),this.addCurrentVertex(j,et,0,0,H,ye)}}}}addVerticesTo(t,r,c,d,g,_,v,S,T,M){const A=(r.w-t.w)/this.tessellationStep|0;let z=0;const D=this.scaledDistance;if(A>1){this.lineSoFar=t.w;const $=(r.x-t.x)/A,H=(r.y-t.y)/A,j=(r.z-t.z)/A,X=(r.w-t.w)/A;for(let Y=1;Y<A;++Y){t.x+=$,t.y+=H,t.z+=j,this.lineSoFar+=X,z+=X;const te=this.evaluateLineProgressFeatures(this.prevDistance+z);this.scaledDistance=(this.prevDistance+z)/this.totalDistance,this.addHalfVertex(t,c,d,M,!1,v,T,te),this.addHalfVertex(t,g,_,M,!0,-S,T,te)}}this.lineSoFar=r.w,this.scaledDistance=D;const k=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,c,d,M,!1,v,T,k),this.addHalfVertex(r,g,_,M,!0,-S,T,k)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):vi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:r}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}}addCurrentVertex(t,r,c,d,g,_,v=!1){const S=r.x+r.y*c,T=r.y-r.x*c,M=r.y*d-r.x,A=-r.y-r.x*d;if(_!=null){const z=this.elevationType==="offset",D=-10,k=8202,$=_.zOffset,H=new UM(t.x,t.y,$,this.lineSoFar),j=!!z&&L1(t,D,k),X=this.lineSoFar,Y=this.distance;if(this.currentVertex)if(j){const te=this.currentVertexIsOutside,ue=this.currentVertex,le=new UM(t.x,t.y,$,this.lineSoFar);if(VM(ue,le,D,k),!L1(le,D,k)){if(te){this.e1=this.e2=-1,this.distance-=ue.dist(H),this.lineSoFar=ue.w;const ge=this.evaluateLineProgressFeatures(ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ue,S,T,v,!1,c,g,ge),this.addHalfVertex(ue,M,A,v,!0,-d,g,ge),this.prevDistance=this.distance}this.distance=this.prevDistance+ue.dist(le),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ue,le,S,T,M,A,c,d,g,v),this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}}else{const te=this.currentVertex;if(this.currentVertexIsOutside){VM(te,H,D,k),this.e1=this.e2=-1,this.distance-=te.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=te.w;const ue=this.evaluateLineProgressFeatures(te.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(te,S,T,v,!1,c,g,ue),this.addHalfVertex(te,M,A,v,!0,-d,g,ue),this.prevDistance=this.distance,this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(te,H,S,T,M,A,c,d,g,v)}else j||(this.addHalfVertex(t,S,T,v,!1,c,g,_),this.addHalfVertex(t,M,A,v,!0,-d,g,_));this.currentVertex=H,this.currentVertexIsOutside=j,this.lineSoFar=X}else this.addHalfVertex(t,S,T,v,!1,c,g,_),this.addHalfVertex(t,M,A,v,!0,-d,g,_)}addHalfVertex({x:t,y:r},c,d,g,_,v,S,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(r<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=di(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const M=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),S.primitiveLength++),_?this.e2=M:this.e1=M,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,r){this.prevDistance=this.distance,this.distance+=t.dist(r),this.updateScaledDistance()}}function L1(a,t,r){return a.x<t||a.x>r||a.y<t||a.y>r}let EA,IA;function MA(a,t,r){return t*(It/(a.tileSize*Math.pow(2,r-a.tileID.overscaledZ)))}jt(C1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const AA=(a,t,r)=>(1-r)*a+r*t;function PA(a,t){return 1/MA(a,1,t.tileZoom)}function zA(a,t,r,c){return a.translatePosMatrix(c||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const CA=a=>{const t=[];LA(a)&&t.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=a.paint.get("line-trim-offset");r[0]===0&&r[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const c=a.layout.get("line-join").constantOr("miter")==="none",d=!!a.paint.get("line-pattern").constantOr(1);return c&&d&&t.push("LINE_JOIN_NONE"),t};function LA(a){const t=a.paint.get("line-dasharray").value;return t.kind!=="constant"||t.value}let R1;const RA=()=>R1||(R1={layout:EA||(EA=new ur({"line-cap":new zt(ke.layout_line["line-cap"]),"line-join":new zt(ke.layout_line["line-join"]),"line-miter-limit":new bt(ke.layout_line["line-miter-limit"]),"line-round-limit":new bt(ke.layout_line["line-round-limit"]),"line-sort-key":new zt(ke.layout_line["line-sort-key"]),"line-z-offset":new zt(ke.layout_line["line-z-offset"]),"line-elevation-reference":new bt(ke.layout_line["line-elevation-reference"]),"line-cross-slope":new bt(ke.layout_line["line-cross-slope"]),visibility:new bt(ke.layout_line.visibility),"line-width-unit":new bt(ke.layout_line["line-width-unit"])})),paint:IA||(IA=new ur({"line-opacity":new zt(ke.paint_line["line-opacity"]),"line-color":new zt(ke.paint_line["line-color"]),"line-translate":new bt(ke.paint_line["line-translate"]),"line-translate-anchor":new bt(ke.paint_line["line-translate-anchor"]),"line-width":new zt(ke.paint_line["line-width"]),"line-gap-width":new zt(ke.paint_line["line-gap-width"]),"line-offset":new zt(ke.paint_line["line-offset"]),"line-blur":new zt(ke.paint_line["line-blur"]),"line-dasharray":new zt(ke.paint_line["line-dasharray"]),"line-pattern":new zt(ke.paint_line["line-pattern"]),"line-pattern-cross-fade":new bt(ke.paint_line["line-pattern-cross-fade"]),"line-gradient":new hu(ke.paint_line["line-gradient"]),"line-trim-offset":new bt(ke.paint_line["line-trim-offset"]),"line-trim-fade-range":new bt(ke.paint_line["line-trim-fade-range"]),"line-trim-color":new bt(ke.paint_line["line-trim-color"]),"line-emissive-strength":new zt(ke.paint_line["line-emissive-strength"]),"line-border-width":new zt(ke.paint_line["line-border-width"]),"line-border-color":new zt(ke.paint_line["line-border-color"]),"line-occlusion-opacity":new bt(ke.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},R1);class CU extends zt{possiblyEvaluate(t,r){return r=new An(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition,worldview:r.worldview}),super.possiblyEvaluate(t,r)}evaluate(t,r,c,d){return r=Object.assign({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,c,d)}}let Eg;function DA(a,t){return t>0?t+2*a:a}const LU=Ki([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),RU=Ki([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),DU=Ki([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ki([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kU=Ki([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),OU=Ki([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),FU=Ki([{name:"a_texb",components:2,type:"Uint16"}]),BU=Ki([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),NU=Ki([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ki([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const kA=Ki([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),UU=Ki([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ki([{name:"triangle",components:3,type:"Uint16"}]),Ki([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ki([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Ki([{type:"Float32",name:"offsetX"}]),Ki([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var so=24;function $U(a,t,r){return a.sections.forEach(c=>{c.text=(function(d,g,_){const v=g.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?d=d.toLocaleUpperCase():v==="lowercase"&&(d=d.toLocaleLowerCase()),ma.applyArabicShaping&&(d=ma.applyArabicShaping(d)),d})(c.text,t,r)}),a}const Ig={"!":"ï¸•","#":"ï¼ƒ",$:"ï¼„","%":"ï¼…","&":"ï¼†","(":"ï¸µ",")":"ï¸¶","*":"ï¼Š","+":"ï¼‹",",":"ï¸","-":"ï¸²",".":"ãƒ»","/":"ï¼",":":"ï¸“",";":"ï¸”","<":"ï¸¿","=":"ï¼",">":"ï¹€","?":"ï¸–","@":"ï¼ ","[":"ï¹‡","\\":"ï¼¼","]":"ï¹ˆ","^":"ï¼¾",_:"ï¸³","`":"ï½€","{":"ï¸·","|":"â€•","}":"ï¸¸","~":"ï½ž","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â€“":"ï¸²","â€”":"ï¸±","â€˜":"ï¹ƒ","â€™":"ï¹„","â€œ":"ï¹","â€":"ï¹‚","â€¦":"ï¸™","â€§":"ãƒ»","â‚©":"ï¿¦","ã€":"ï¸‘","ã€‚":"ï¸’","ã€ˆ":"ï¸¿","ã€‰":"ï¹€","ã€Š":"ï¸½","ã€‹":"ï¸¾","ã€Œ":"ï¹","ã€":"ï¹‚","ã€Ž":"ï¹ƒ","ã€":"ï¹„","ã€":"ï¸»","ã€‘":"ï¸¼","ã€”":"ï¸¹","ã€•":"ï¸º","ã€–":"ï¸—","ã€—":"ï¸˜","ï¼":"ï¸•","ï¼ˆ":"ï¸µ","ï¼‰":"ï¸¶","ï¼Œ":"ï¸","ï¼":"ï¸²","ï¼Ž":"ãƒ»","ï¼š":"ï¸“","ï¼›":"ï¸”","ï¼œ":"ï¸¿","ï¼ž":"ï¹€","ï¼Ÿ":"ï¸–","ï¼»":"ï¹‡","ï¼½":"ï¹ˆ","ï¼¿":"ï¸³","ï½›":"ï¸·","ï½œ":"â€•","ï½":"ï¸¸","ï½Ÿ":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸’","ï½¢":"ï¹","ï½£":"ï¹‚","â†":"â†‘","â†’":"â†“"};function VU(a){return a==="ï¸¶"||a==="ï¹ˆ"||a==="ï¸¸"||a==="ï¹„"||a==="ï¹‚"||a==="ï¸¾"||a==="ï¸¼"||a==="ï¸º"||a==="ï¸˜"||a==="ï¹€"||a==="ï¸"||a==="ï¸“"||a==="ï¸”"||a==="ï½€"||a==="ï¿£"||a==="ï¸‘"||a==="ï¸’"}function jU(a){return a==="ï¸µ"||a==="ï¹‡"||a==="ï¸·"||a==="ï¹ƒ"||a==="ï¹"||a==="ï¸½"||a==="ï¸»"||a==="ï¸¹"||a==="ï¸—"||a==="ï¸¿"}const D1=4294967296,OA=1/D1,FA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let mx=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,t,r=this.length){for(;this.pos<r;){const c=this.readVarint(),d=c>>3,g=this.pos;this.type=7&c,a(d,t,this),this.pos===g&&this.skip(c)}return t}readMessage(a,t){return this.readFields(a,t,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*D1;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*D1;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const t=this.buf;let r,c;return c=t[this.pos++],r=127&c,c<128?r:(c=t[this.pos++],r|=(127&c)<<7,c<128?r:(c=t[this.pos++],r|=(127&c)<<14,c<128?r:(c=t[this.pos++],r|=(127&c)<<21,c<128?r:(c=t[this.pos],r|=(15&c)<<28,(function(d,g,_){const v=_.buf;let S,T;if(T=v[_.pos++],S=(112&T)>>4,T<128||(T=v[_.pos++],S|=(127&T)<<3,T<128)||(T=v[_.pos++],S|=(127&T)<<10,T<128)||(T=v[_.pos++],S|=(127&T)<<17,T<128)||(T=v[_.pos++],S|=(127&T)<<24,T<128)||(T=v[_.pos++],S|=(1&T)<<31,T<128))return Tf(d,S,g);throw new Error("Expected varint not more than 10 bytes")})(r,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,t=this.pos;return this.pos=a,a-t>=12&&FA?FA.decode(this.buf.subarray(t,a)):(function(r,c,d){let g="",_=c;for(;_<d;){const v=r[_];let S,T,M,A=null,z=v>239?4:v>223?3:v>191?2:1;if(_+z>d)break;z===1?v<128&&(A=v):z===2?(S=r[_+1],(192&S)==128&&(A=(31&v)<<6|63&S,A<=127&&(A=null))):z===3?(S=r[_+1],T=r[_+2],(192&S)==128&&(192&T)==128&&(A=(15&v)<<12|(63&S)<<6|63&T,(A<=2047||A>=55296&&A<=57343)&&(A=null))):z===4&&(S=r[_+1],T=r[_+2],M=r[_+3],(192&S)==128&&(192&T)==128&&(192&M)==128&&(A=(15&v)<<18|(63&S)<<12|(63&T)<<6|63&M,(A<=65535||A>=1114112)&&(A=null))),A===null?(A=65533,z=1):A>65535&&(A-=65536,g+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),g+=String.fromCharCode(A),_+=z}return g})(this.buf,t,a)}readBytes(){const a=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,a);return this.pos=a,t}readPackedVarint(a=[],t){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readVarint(t));return a}readPackedSVarint(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const t=7&a;if(t===0)for(;this.buf[this.pos++]>127;);else if(t===2)this.pos=this.readVarint()+this.pos;else if(t===5)this.pos+=4;else{if(t!==1)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(a,t){this.writeVarint(a<<3|t)}realloc(a){let t=this.length||16;for(;t<this.pos+a;)t*=2;if(t!==this.length){const r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*OA),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*OA),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(t,r){let c,d;if(t>=0?(c=t%4294967296|0,d=t/4294967296|0):(c=~(-t%4294967296),d=~(-t/4294967296),4294967295^c?c=c+1|0:(c=0,d=d+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),(function(g,_,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)})(c,0,r),(function(g,_){const v=(7&g)<<4;_.buf[_.pos++]|=v|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))})(d,r)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const t=this.pos;this.pos=(function(c,d,g){for(let _,v,S=0;S<d.length;S++){if(_=d.charCodeAt(S),_>55295&&_<57344){if(!v){_>56319||S+1===d.length?(c[g++]=239,c[g++]=191,c[g++]=189):v=_;continue}if(_<56320){c[g++]=239,c[g++]=191,c[g++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(c[g++]=239,c[g++]=191,c[g++]=189,v=null);_<128?c[g++]=_:(_<2048?c[g++]=_>>6|192:(_<65536?c[g++]=_>>12|224:(c[g++]=_>>18|240,c[g++]=_>>12&63|128),c[g++]=_>>6&63|128),c[g++]=63&_|128)}return g})(this.buf,a,this.pos);const r=this.pos-t;r>=128&&BA(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const t=a.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=a[r]}writeRawMessage(a,t){this.pos++;const r=this.pos;a(t,this);const c=this.pos-r;c>=128&&BA(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c}writeMessage(a,t,r){this.writeTag(a,2),this.writeRawMessage(t,r)}writePackedVarint(a,t){t.length&&this.writeMessage(a,GU,t)}writePackedSVarint(a,t){t.length&&this.writeMessage(a,HU,t)}writePackedBoolean(a,t){t.length&&this.writeMessage(a,qU,t)}writePackedFloat(a,t){t.length&&this.writeMessage(a,ZU,t)}writePackedDouble(a,t){t.length&&this.writeMessage(a,WU,t)}writePackedFixed32(a,t){t.length&&this.writeMessage(a,XU,t)}writePackedSFixed32(a,t){t.length&&this.writeMessage(a,JU,t)}writePackedFixed64(a,t){t.length&&this.writeMessage(a,YU,t)}writePackedSFixed64(a,t){t.length&&this.writeMessage(a,KU,t)}writeBytesField(a,t){this.writeTag(a,2),this.writeBytes(t)}writeFixed32Field(a,t){this.writeTag(a,5),this.writeFixed32(t)}writeSFixed32Field(a,t){this.writeTag(a,5),this.writeSFixed32(t)}writeFixed64Field(a,t){this.writeTag(a,1),this.writeFixed64(t)}writeSFixed64Field(a,t){this.writeTag(a,1),this.writeSFixed64(t)}writeVarintField(a,t){this.writeTag(a,0),this.writeVarint(t)}writeSVarintField(a,t){this.writeTag(a,0),this.writeSVarint(t)}writeStringField(a,t){this.writeTag(a,2),this.writeString(t)}writeFloatField(a,t){this.writeTag(a,5),this.writeFloat(t)}writeDoubleField(a,t){this.writeTag(a,1),this.writeDouble(t)}writeBooleanField(a,t){this.writeVarintField(a,+t)}};function Tf(a,t,r){return r?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function BA(a,t,r){const c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(c);for(let d=r.pos-1;d>=a;d--)r.buf[d+c]=r.buf[d]}function GU(a,t){for(let r=0;r<a.length;r++)t.writeVarint(a[r])}function HU(a,t){for(let r=0;r<a.length;r++)t.writeSVarint(a[r])}function ZU(a,t){for(let r=0;r<a.length;r++)t.writeFloat(a[r])}function WU(a,t){for(let r=0;r<a.length;r++)t.writeDouble(a[r])}function qU(a,t){for(let r=0;r<a.length;r++)t.writeBoolean(a[r])}function XU(a,t){for(let r=0;r<a.length;r++)t.writeFixed32(a[r])}function JU(a,t){for(let r=0;r<a.length;r++)t.writeSFixed32(a[r])}function YU(a,t){for(let r=0;r<a.length;r++)t.writeFixed64(a[r])}function KU(a,t){for(let r=0;r<a.length;r++)t.writeSFixed64(a[r])}function QU(a,t,r){t.glyphs=[],a===1&&r.readMessage(e5,t)}function e5(a,t,r){if(a===3){const{id:c,bitmap:d,width:g,height:_,left:v,top:S,advance:T}=r.readMessage(t5,{});t.glyphs.push({id:c,bitmap:new bu({width:g+6,height:_+6},d),metrics:{width:g,height:_,left:v,top:S,advance:T}})}else a===4?t.ascender=r.readSVarint():a===5&&(t.descender=r.readSVarint())}function t5(a,t,r){a===1?t.id=r.readVarint():a===2?t.bitmap=r.readBytes():a===3?t.width=r.readVarint():a===4?t.height=r.readVarint():a===5?t.left=r.readSVarint():a===6?t.top=r.readSVarint():a===7&&(t.advance=r.readVarint())}const Vs={horizontal:1,vertical:2,horizontalOnly:3};class Mg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,r){const c=new Mg;return c.scale=t||1,c.fontStack=r,c}static forImage(t){const r=new Mg;return r.image=t,r}}class Ef{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r,c){const d=new Ef;for(let g=0;g<t.sections.length;g++){const _=t.sections[g];_.image?d.addImageSection(_,c):d.addTextSection(_,r)}return d}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=(function(r,c){let d="";for(let g=0;g<r.length;g++){const _=r.charCodeAt(g+1)||null,v=r.charCodeAt(g-1)||null;d+=!c&&(_&&Dm(_)&&!Ig[r[g+1]]||v&&Dm(v)&&!Ig[r[g-1]])||!Ig[r[g]]?r[g]:Ig[r[g]]}return d})(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&gx[this.text.charCodeAt(c)];c++)t++;let r=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&gx[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const c=new Ef;return c.text=this.text.substring(t,r),c.sectionIndex=this.sectionIndex.slice(t,r),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Mg.forText(t.scale,t.fontStack||r));const c=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(c)}addImageSection(t,r){const c=t.image?t.image.getPrimary():null;if(!c)return void vi("Can't add FormattedSection with an empty image.");c.scaleSelf(r);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(Mg.forImage(c)),this.sectionIndex.push(this.sections.length-1)):vi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function k1(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$=1){const H=Ef.fromFeature(a,d,$);A===Vs.vertical&&H.verticalizePunctuation(z);let j=[];const X=(function(ge,ye,me,we,Ie,Je){if(!ge)return[];const qe=[],Xe=(function(ot,Ge,ct,et,ut,lt){let Bt=0;for(let Ut=0;Ut<ot.length();Ut++){const Tt=ot.getSection(Ut);Bt+=NA(ot.getCodePoint(Ut),Tt,et,ut,Ge,lt)}return Bt/Math.max(1,Math.ceil(Bt/ct))})(ge,ye,me,we,Ie,Je),at=ge.text.indexOf("â€‹")>=0;let nt=0;for(let ot=0;ot<ge.length();ot++){const Ge=ge.getSection(ot),ct=ge.getCodePoint(ot);if(gx[ct]||(nt+=NA(ct,Ge,we,Ie,ye,Je)),ot<ge.length()-1){const et=hv(ct);(i5[ct]||et||Ge.image)&&qe.push($A(ot+1,nt,Xe,qe,n5(ct,ge.getCodePoint(ot+1),et&&at),!1))}}return VA($A(ge.length(),nt,Xe,qe,0,!0))})(H,T,g,t,c,D),{processBidirectionalText:Y,processStyledBidirectionalText:te}=ma;if(Y&&H.sections.length===1){const ge=Y(H.toString(),X);for(const ye of ge){const me=new Ef;me.text=ye,me.sections=H.sections;for(let we=0;we<ye.length;we++)me.sectionIndex.push(0);j.push(me)}}else if(te){const ge=te(H.text,H.sectionIndex,X);for(const ye of ge){const me=new Ef;me.text=ye[0],me.sectionIndex=ye[1],me.sections=H.sections,j.push(me)}}else j=(function(ge,ye){const me=[],we=ge.text;let Ie=0;for(const Je of ye)me.push(ge.substring(Ie,Je)),Ie=Je;return Ie<we.length&&me.push(ge.substring(Ie,we.length)),me})(H,X);const ue=[],le={positionedLines:ue,text:H.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot,Ge){let ct=0,et=0,ut=0;const lt=Xe==="right"?1:Xe==="left"?0:.5;let Bt=!1;for(const Yt of Ie){const Ct=Yt.getSections();for(const bi of Ct){if(bi.image)continue;const qi=ye[bi.fontStack];if(qi&&(Bt=qi.ascender!==void 0&&qi.descender!==void 0,!Bt))break}if(!Bt)break}let Ut=0;for(const Yt of Ie){Yt.trim();const Ct=Yt.getMaxScale(),bi=(Ct-1)*so,qi={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Ut]=qi;const pn=qi.positionedGlyphs;let Hi=0;if(!Yt.length()){et+=Je,++Ut;continue}let Pn=0,an=0;for(let cn=0;cn<Yt.length();cn++){const In=Yt.getSection(cn),Jn=Yt.getSectionIndex(cn),or=Yt.getCodePoint(cn);let sr=In.scale,Sr=null,vo=null,Ao=null,Ur=so,Wr=0,Kr=at;Kr===Vs.vertical&&dv(or)&&(Kr=Vs.horizontal);const $i=!(Kr===Vs.horizontal||!ot&&!$l(or)||ot&&(gx[or]||nf(or)));if(In.image){const ar=we.get(In.image.toString());if(!ar)continue;Ao=In.image,ge.iconsInText=ge.iconsInText||!0,vo=ar.paddedRect;const dr=ar.displaySize;sr=sr*so/Ge,Sr={width:dr[0],height:dr[1],left:0,top:-3,advance:$i?dr[1]:dr[0],localGlyph:!1},Wr=Bt?-Sr.height*sr:Ct*so-17-dr[1]*sr,Ur=Sr.advance;const js=($i?dr[0]:dr[1])*sr-so*Ct;js>0&&js>Hi&&(Hi=js)}else{const ar=me[In.fontStack];if(!ar)continue;ar[or]&&(vo=ar[or]);const dr=ye[In.fontStack];if(!dr)continue;const js=dr.glyphs[or];if(!js)continue;if(Sr=js.metrics,Ur=or!==8203?so:0,Bt){const Wo=dr.ascender!==void 0?Math.abs(dr.ascender):0,xo=dr.descender!==void 0?Math.abs(dr.descender):0,qo=(Wo+xo)*sr;Pn<qo&&(Pn=qo,an=(Wo-xo)/2*sr),Wr=-Wo*sr}else Wr=(Ct-sr)*so-17}$i?(ge.verticalizable=!0,pn.push({glyph:or,image:Ao,x:ct,y:et+Wr,vertical:$i,scale:sr,localGlyph:Sr.localGlyph,fontStack:In.fontStack,sectionIndex:Jn,metrics:Sr,rect:vo}),ct+=Ur*sr+nt):(pn.push({glyph:or,image:Ao,x:ct,y:et+Wr,vertical:$i,scale:sr,localGlyph:Sr.localGlyph,fontStack:In.fontStack,sectionIndex:Jn,metrics:Sr,rect:vo}),ct+=Sr.advance*sr+nt)}pn.length!==0&&(ut=Math.max(ct-nt,ut),Bt?jA(pn,lt,Hi,an,Je*Ct/2):jA(pn,lt,Hi,0,Je/2)),ct=0;const wr=Je*Ct+Hi;qi.lineOffset=Math.max(Hi,bi),et+=wr,++Ut}const Tt=et,{horizontalAlign:Mt,verticalAlign:li}=O1(qe);(function(Yt,Ct,bi,qi,pn,Hi){const Pn=(Ct-bi)*pn,an=-Hi*qi;for(const wr of Yt)for(const cn of wr.positionedGlyphs)cn.x+=Pn,cn.y+=an})(ge.positionedLines,lt,Mt,li,ut,Tt),ge.top+=-li*Tt,ge.bottom=ge.top+Tt,ge.left+=-Mt*ut,ge.right=ge.left+ut,ge.hasBaseline=Bt})(le,t,r,c,j,_,v,S,A,T,z,k),!(function(ge){for(const ye of ge)if(ye.positionedGlyphs.length!==0)return!1;return!0})(ue))return le}const gx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},i5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function NA(a,t,r,c,d,g){if(t.image){const _=c.get(t.image.toString());return _?_.displaySize[0]*t.scale*so/g+d:0}{const _=r[t.fontStack],v=_&&_.glyphs[a];return v?v.metrics.advance*t.scale+d:0}}function UA(a,t,r,c){const d=Math.pow(a-t,2);return c?a<t?d/2:2*d:d+Math.abs(r)*r}function n5(a,t,r){let c=0;return a===10&&(c-=1e4),r&&(c+=150),a!==40&&a!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function $A(a,t,r,c,d,g){let _=null,v=UA(t,r,d,g);for(const S of c){const T=UA(t-S.x,r,d,g)+S.badness;T<=v&&(_=S,v=T)}return{index:a,x:t,priorBreak:_,badness:v}}function VA(a){return a?VA(a.priorBreak).concat(a.index):[]}function O1(a){let t=.5,r=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function jA(a,t,r,c,d){if(!(t||r||c||d))return;const g=a.length-1,_=a[g],v=(_.x+_.metrics.advance*_.scale)*t;for(let S=0;S<=g;S++)a[S].x-=v,a[S].y+=r+c+d}function F1(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function _x(a,t,r,c){const{horizontalAlign:d,verticalAlign:g}=O1(c),_=r[0]-a.displaySize[0]*d,v=r[1]-a.displaySize[1]*g;return{imagePrimary:a,imageSecondary:t,top:v,bottom:v+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function B1(a,t,r,c,d,g){const _=a.imagePrimary;let v;if(_.content){const H=_.content,j=_.pixelRatio||1;v=[H[0]/j,H[1]/j,_.displaySize[0]-H[2]/j,_.displaySize[1]-H[3]/j]}const S=t.left*g,T=t.right*g;let M,A,z,D;r==="width"||r==="both"?(D=d[0]+S-c[3],A=d[0]+T+c[1]):(D=d[0]+(S+T-_.displaySize[0])/2,A=D+_.displaySize[0]);const k=t.top*g,$=t.bottom*g;return r==="height"||r==="both"?(M=d[1]+k-c[0],z=d[1]+$+c[2]):(M=d[1]+(k+$-_.displaySize[1])/2,z=M+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:M,right:A,bottom:z,left:D,collisionPadding:v}}function GA(a){return!a.imagePrimary.stretchX}function HA(a){return!a.imagePrimary.stretchY}function ZA(a){return{width:a.right-a.left,height:a.bottom-a.top}}const Pc=128;function Zh(a,t,r,c){const{expression:d}=t;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new An(a+1,{worldview:r}),void 0,void 0,void 0,c)};if(d.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:_}=d;let v=0;for(;v<g.length&&g[v]<=a;)v++;v=Math.max(0,v-1);let S=v;for(;S<g.length&&g[S]<a+1;)S++;S=Math.min(g.length-1,S);const T=g[v],M=g[S];return d.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:M,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:M,minSize:d.evaluate(new An(T,{worldview:r}),void 0,void 0,void 0,c),maxSize:d.evaluate(new An(M,{worldview:r}),void 0,void 0,void 0,c),interpolationType:_}}}function N1(a,{uSize:t,uSizeT:r},{lowerSize:c,upperSize:d}){return a.kind==="source"?c/Pc:a.kind==="composite"?di(c/Pc,d/Pc,r):t}function If(a,t,r=1){let c=0,d=0;if(a.kind==="constant")d=a.layoutSize*r;else if(a.kind!=="source"){const{interpolationType:g,minZoom:_,maxZoom:v}=a,S=g?de(ks.interpolationFactor(g,t,_,v),0,1):0;a.kind==="camera"?d=di(a.minSize,a.maxSize,S)*r:c=S*r}return{uSizeT:c,uSize:d}}class zc extends Ae{constructor(t,r,c,d,g){super(t,r),this.angle=d,this.z=c,g!==void 0&&(this.segment=g)}clone(){return new zc(this.x,this.y,this.z,this.angle,this.segment)}}function WA(a,t,r,c,d){if(t.segment===void 0)return!0;let g=t,_=t.segment+1,v=0;for(;v>-r/2;){if(_--,_<0)return!1;v-=a[_].dist(g),g=a[_]}v+=a[_].dist(a[_+1]),_++;const S=[];let T=0;for(;v<r/2;){const M=a[_],A=a[_+1];if(!A)return!1;let z=a[_-1].angleTo(M)-M.angleTo(A);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:z}),T+=z;v-S[0].distance>c;)T-=S.shift().angleDelta;if(T>d)return!1;_++,v+=M.dist(A)}return!0}function qA(a){let t=0;for(let r=0;r<a.length-1;r++)t+=a[r].dist(a[r+1]);return t}function XA(a,t,r){return a?.6*t*r:0}function JA(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function r5(a,t,r,c,d,g){const _=XA(r,d,g),v=JA(r,c)*g;let S=0;const T=qA(a)/2;for(let M=0;M<a.length-1;M++){const A=a[M],z=a[M+1],D=A.dist(z);if(S+D>T){const k=(T-S)/D,$=di(A.x,z.x,k),H=di(A.y,z.y,k),j=new zc($,H,0,z.angleTo(A),M);return!_||WA(a,j,v,_,t)?j:void 0}S+=D}}function o5(a,t,r,c,d,g,_,v,S){const T=XA(c,g,_),M=JA(c,d),A=M*_,z=a[0].x===0||a[0].x===S||a[0].y===0||a[0].y===S;return t-A<t/4&&(t=A+t/4),YA(a,z?t/2*v%t:(M/2+2*g)*_*v%t,t,T,r,A,z,!1,S)}function YA(a,t,r,c,d,g,_,v,S){const T=g/2,M=qA(a);let A=0,z=t-r,D=[];for(let k=0;k<a.length-1;k++){const $=a[k],H=a[k+1],j=$.dist(H),X=H.angleTo($);for(;z+r<A+j;){z+=r;const Y=(z-A)/j,te=di($.x,H.x,Y),ue=di($.y,H.y,Y);if(te>=0&&te<S&&ue>=0&&ue<S&&z-T>=0&&z+T<=M){const le=new zc(te,ue,0,X,k);c&&!WA(a,le,g,c,d)||D.push(le)}}A+=j}return v||D.length||_||(D=YA(a,A/2,r,c,d,g,_,!0,S)),D}function KA(a){let t=0,r=0;for(const _ of a)t+=_.w*_.h,r=Math.max(r,_.w);a.sort((_,v)=>v.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let d=0,g=0;for(const _ of a)for(let v=c.length-1;v>=0;v--){const S=c[v];if(!(_.w>S.w||_.h>S.h)){if(_.x=S.x,_.y=S.y,g=Math.max(g,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===S.w&&_.h===S.h){const T=c.pop();T&&v<c.length&&(c[v]=T)}else _.h===S.h?(S.x+=_.w,S.w-=_.w):_.w===S.w?(S.y+=_.h,S.h-=_.h):(c.push({x:S.x+_.w,y:S.y,w:S.w-_.w,h:_.h}),S.y+=_.h,S.h-=_.h);break}}return{w:d,h:g,fill:t/(d*g)||0}}jt(zc,"Anchor");class Ag{static getImagePositionScale(t,r,c){if(r&&t){const{sx:d,sy:g}=t;return{x:d,y:g}}return{x:c,y:c}}constructor(t,r,c,d){this.paddedRect=t;const{pixelRatio:g,version:_,stretchX:v,stretchY:S,content:T,sdf:M,usvg:A}=r;this.pixelRatio=g,this.stretchX=v,this.stretchY=S,this.content=T,this.version=_,this.padding=c,this.sdf=M,this.usvg=A,this.scale=Ag.getImagePositionScale(d,A,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function U1(a,t,r){const c=ns.parse(a),d=(function(g,_,v=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*v[0])+2*_,h:(g.data?g.data.height:g.height*v[1])+2*_}})(t,r,[c.sx,c.sy]);return{bin:d,imagePosition:new Ag(d,t,r,c),imageVariant:c}}class QA{constructor(t,r,c){const d=new Map,g=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(t,d,1,_),this.addImages(r,g,2,_);const{w:v,h:S}=KA(_),T=new Mo({width:v||1,height:S||1});for(const[M,A]of t.entries()){const z=d.get(M).paddedRect;Mo.copy(A.data,T,{x:0,y:0},{x:z.x+1,y:z.y+1},A.data,null,A.sdf)}for(const[M,A]of r.entries()){const z=g.get(M),D=z.paddedRect;let k=z.padding;const $=D.x+k,H=D.y+k,j=A.data.width,X=A.data.height;k=k>1?k-1:k,Mo.copy(A.data,T,{x:0,y:0},{x:$,y:H},A.data,c),Mo.copy(A.data,T,{x:0,y:X-k},{x:$,y:H-k},{width:j,height:k},c),Mo.copy(A.data,T,{x:0,y:0},{x:$,y:H+X},{width:j,height:k},c),Mo.copy(A.data,T,{x:j-k,y:0},{x:$-k,y:H},{width:k,height:X},c),Mo.copy(A.data,T,{x:0,y:0},{x:$+j,y:H},{width:k,height:X},c),Mo.copy(A.data,T,{x:j-k,y:X-k},{x:$-k,y:H-k},{width:k,height:k},c),Mo.copy(A.data,T,{x:0,y:X-k},{x:$+j,y:H-k},{width:k,height:k},c),Mo.copy(A.data,T,{x:0,y:0},{x:$+j,y:H+X},{width:k,height:k},c),Mo.copy(A.data,T,{x:j-k,y:0},{x:$-k,y:H+X},{width:k,height:k},c)}this.lut=c,this.image=T,this.iconPositions=d,this.patternPositions=g}addImages(t,r,c,d){for(const[g,_]of t.entries()){const{bin:v,imagePosition:S,imageVariant:T}=U1(g,_,c);r.set(g,S),d.push(v),_.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(t,r,c,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>t.hasImage(g,c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const g of t.getUpdatedImages(c)){for(const _ of this.iconPositions.keys()){const v=ns.parse(_);if(ts.isEqual(v.id,g)){const S=t.getImage(g,c);this.patchUpdatedImage(this.iconPositions.get(_),S,r,null)}}for(const _ of this.patternPositions.keys()){const v=ns.parse(_);if(ts.isEqual(v.id,g)){const S=t.getImage(g,c);this.patchUpdatedImage(this.patternPositions.get(_),S,r,d||this.lut)}}}}patchUpdatedImage(t,r,c,d=null){if(!t||!r||t.version===r.version)return;t.version=r.version;const[g,_]=t.tl,v=t.sdf;if(this.lut||v){const S={width:r.data.width,height:r.data.height},T=new Mo(S);Mo.copy(r.data,T,{x:0,y:0},{x:0,y:0},S,d,v),c.update(T,{position:{x:g,y:_}})}else c.update(r.data,{position:{x:g,y:_}})}}jt(Ag,"ImagePosition"),jt(QA,"ImageAtlas",{omit:["lut"]});const Pg=1e20;function eP(a,t,r,c,d,g,_,v,S){for(let T=t;T<t+c;T++)tP(a,r*g+T,g,d,_,v,S);for(let T=r;T<r+d;T++)tP(a,T*g+t,1,c,_,v,S)}function tP(a,t,r,c,d,g,_){g[0]=0,_[0]=-Pg,_[1]=Pg,d[0]=a[t];for(let v=1,S=0,T=0;v<c;v++){d[v]=a[t+v*r];const M=v*v;do{const A=g[S];T=(d[v]-d[A]+M-A*A)/(v-A)/2}while(T<=_[S]&&--S>-1);S++,g[S]=v,_[S]=T,_[S+1]=Pg}for(let v=0,S=0;v<c;v++){for(;_[S+1]<v;)S++;const T=g[S],M=v-T;a[t+v*r]=d[T]+M*M}}const $1={none:0,ideographs:1,all:2};class Mf{constructor(t,r,c){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=c,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,r){const c=[],d=this.url||jr.GLYPHS_URL;for(const g in t)for(const _ of t[g])c.push({stack:g,id:_});Pe(c,({stack:g,id:_},v)=>{let S=this.entries[g];S||(S=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=S.glyphs[_];if(T!==void 0)return void v(null,{stack:g,id:_,glyph:T});if(T=this._tinySDF(S,g,_),T)return S.glyphs[_]=T,void v(null,{stack:g,id:_,glyph:T});const M=Math.floor(_/256);if(256*M>65535)return vi("glyphs > 65535 not supported"),void v(null,{stack:g,id:_,glyph:T});if(S.ranges[M])return void v(null,{stack:g,id:_,glyph:T});let A=S.requests[M];A||(A=S.requests[M]=[],Mf.loadGlyphRange(g,M,d,this.requestManager,(z,D)=>{if(D){S.ascender=D.ascender,S.descender=D.descender;for(const k in D.glyphs)this._doesCharSupportLocalGlyph(+k)||(S.glyphs[+k]=D.glyphs[+k]);S.ranges[M]=!0}for(const k of A)k(z,D);delete S.requests[M]})),A.push((z,D)=>{z?v(z):D&&v(null,{stack:g,id:_,glyph:D.glyphs[_]||null})})},(g,_)=>{if(g)r(g);else if(_){const v={};for(const{stack:S,id:T,glyph:M}of _)v[S]===void 0&&(v[S]={}),v[S].glyphs===void 0&&(v[S].glyphs={}),v[S].glyphs[T]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},v[S].ascender=this.entries[S].ascender,v[S].descender=this.entries[S].descender;r(null,v)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==$1.none&&(this.localGlyphMode===$1.all?!!this.localFontFamily:!!this.localFontFamily&&(ef(t)||av(t)||lu(t)||Th(t)||au(t)||cu(t)||(r=t)>=131072&&r<=173791||(c=>c>=66736&&c<=66815)(t)));var r}_tinySDF(t,r,c){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let g=t.tinySDF;if(!g){let $="400";/bold/i.test(r)?$="900":/medium/i.test(r)?$="500":/light/i.test(r)&&($="200"),g=t.tinySDF=new Mf.TinySDF({fontFamily:d,fontWeight:$,fontSize:48,buffer:6,radius:16}),g.fontWeight=$}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const _=String.fromCodePoint(c),{data:v,width:S,height:T,glyphWidth:M,glyphHeight:A,glyphLeft:z,glyphTop:D,glyphAdvance:k}=g.draw(_);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new bu({width:S,height:T},v),metrics:{width:M/2,height:A/2,left:z/2,top:D/2-27,advance:k/2,localGlyph:!0}}}}function iP(a,t){return a+t[1]-t[0]}function V1(a,t,r,c,d=1){const g=[],_=a.imagePrimary,v=_.pixelRatio,S=_.paddedRect.w-2,T=_.paddedRect.h-2,M=(a.right-a.left)*d,A=(a.bottom-a.top)*d,z=_.stretchX||[[0,S]],D=_.stretchY||[[0,T]],k=z.reduce(iP,0),$=D.reduce(iP,0),H=S-k,j=T-$;let X=0,Y=k,te=0,ue=$,le=0,ge=H,ye=0,me=j;if(_.content&&c){const Ie=_.content;X=yx(z,0,Ie[0]),te=yx(D,0,Ie[1]),Y=yx(z,Ie[0],Ie[2]),ue=yx(D,Ie[1],Ie[3]),le=Ie[0]-X,ye=Ie[1]-te,ge=Ie[2]-Ie[0]-Y,me=Ie[3]-Ie[1]-ue}const we=(Ie,Je,qe,Xe)=>{const at=vx(Ie.stretch-X,Y,M,a.left*d),nt=xx(Ie.fixed-le,ge,Ie.stretch,k),ot=vx(Je.stretch-te,ue,A,a.top*d),Ge=xx(Je.fixed-ye,me,Je.stretch,$),ct=vx(qe.stretch-X,Y,M,a.left*d),et=xx(qe.fixed-le,ge,qe.stretch,k),ut=vx(Xe.stretch-te,ue,A,a.top*d),lt=xx(Xe.fixed-ye,me,Xe.stretch,$),Bt=new Ae(at,ot),Ut=new Ae(ct,ot),Tt=new Ae(ct,ut),Mt=new Ae(at,ut),li=new Ae(nt/v,Ge/v),Yt=new Ae(et/v,lt/v),Ct=t*Math.PI/180;if(Ct){const an=Math.sin(Ct),wr=Math.cos(Ct),cn=[wr,-an,an,wr];Bt._matMult(cn),Ut._matMult(cn),Mt._matMult(cn),Tt._matMult(cn)}const bi=Ie.stretch+Ie.fixed,qi=qe.stretch+qe.fixed,pn=Je.stretch+Je.fixed,Hi=Xe.stretch+Xe.fixed,Pn=a.imageSecondary;return{tl:Bt,tr:Ut,bl:Mt,br:Tt,texPrimary:{x:_.paddedRect.x+1+bi,y:_.paddedRect.y+1+pn,w:qi-bi,h:Hi-pn},texSecondary:Pn?{x:Pn.paddedRect.x+1+bi,y:Pn.paddedRect.y+1+pn,w:qi-bi,h:Hi-pn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:li,pixelOffsetBR:Yt,minFontScaleX:ge/v/M,minFontScaleY:me/v/A,isSDF:r}};if(_.stretchX||_.stretchY){const Ie=nP(z,H,k),Je=nP(D,j,$);for(let qe=0;qe<Ie.length-1;qe++){const Xe=Ie[qe],at=Ie[qe+1];for(let nt=0;nt<Je.length-1;nt++)g.push(we(Xe,Je[nt],at,Je[nt+1]))}}else g.push(we({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:T+1}));return g}function s5(a,t){const r=a.stretchY||[[0,a.paddedRect.h-2]];return a.stretchX||a.stretchY?rP(a.stretchX||[[0,a.paddedRect.w-2]])*rP(r):1}function yx(a,t,r){let c=0;for(const d of a)c+=Math.max(t,Math.min(r,d[1]))-Math.max(t,Math.min(r,d[0]));return c}function nP(a,t,r){const c=[{fixed:-1,stretch:0}];for(const[d,g]of a){const _=c[c.length-1];c.push({fixed:d-_.stretch,stretch:_.stretch}),c.push({fixed:d-_.stretch,stretch:_.stretch+(g-d)})}return c.push({fixed:t+1,stretch:r}),c}function rP(a){return 2*a.length+1}function vx(a,t,r,c){return a/t*r+c}function xx(a,t,r,c){return a-t*r/c}function a5(a,t,r,c){const d=t+a.positionedLines[c].lineOffset;return c===0?r+d/2:r+(d+(t+a.positionedLines[c-1].lineOffset))/2}function oP(a,t,r,c,d,g,_,v,S){const T=[];if(t.positionedLines.length===0)return T;const M=(S!==void 0?S:c.layout.get("text-rotate").evaluate(g,{}))*Math.PI/180,A=(function(H){const j=H[0],X=H[1],Y=j*X;return Y>0?[j,-X]:Y<0?[-j,X]:j===0?[X,j]:[X,-j]})(r);let z=Math.abs(t.top-t.bottom);for(const H of t.positionedLines)z-=H.lineOffset;const D=t.positionedLines.length,k=z/D;let $=t.top-r[1];for(let H=0;H<D;++H){const j=t.positionedLines[H];$=a5(t,k,$,H);for(const X of j.positionedGlyphs){if(!X.rect)continue;const Y=X.rect||{};let te=4,ue=!0,le=1,ge=0;if(X.image){const Ut=_.get(X.image.toString());if(!Ut)continue;if(Ut.sdf){vi("SDF images are not supported in formatted text and will be ignored.");continue}ue=!1,le=Ut.pixelRatio,te=1/le}const ye=(d||v)&&X.vertical,me=X.metrics.advance*X.scale/2,we=X.metrics,Ie=X.rect;if(Ie===null)continue;v&&t.verticalizable&&(ge=X.image?me-X.metrics.width*X.scale/2:0);const Je=d?[X.x+me,X.y]:[0,0];let qe=[0,0],Xe=[0,0],at=!1;d||(ye?(Xe=[X.x+me+A[0],X.y+A[1]-ge],at=!0):qe=[X.x+me+r[0],X.y+r[1]-ge]);const nt=Ie.w*X.scale/(le*(X.localGlyph?2:1)),ot=Ie.h*X.scale/(le*(X.localGlyph?2:1));let Ge,ct,et,ut;if(ye){const Ut=X.y-$,Tt=new Ae(-me,me-Ut),Mt=-Math.PI/2,li=new Ae(...Xe);Ge=new Ae(-me+qe[0],qe[1]),Ge._rotateAround(Mt,Tt)._add(li),Ge.x+=-Ut+me,Ge.y-=(we.left-te)*X.scale;const Yt=X.image?we.advance*X.scale:so*X.scale,Ct=String.fromCodePoint(X.glyph);VU(Ct)?Ge.x+=(1-te)*X.scale:jU(Ct)?Ge.x+=Yt-we.height*X.scale+(-te-1)*X.scale:Ge.x+=X.image||we.width+2*te===Ie.w&&we.height+2*te===Ie.h?(Yt-ot)/2:(Yt-(we.height+2*te)*X.scale)/2,ct=new Ae(Ge.x,Ge.y-nt),et=new Ae(Ge.x+ot,Ge.y),ut=new Ae(Ge.x+ot,Ge.y-nt)}else{const Ut=(we.left-te)*X.scale-me+qe[0],Tt=(-we.top-te)*X.scale+qe[1],Mt=Ut+nt,li=Tt+ot;Ge=new Ae(Ut,Tt),ct=new Ae(Mt,Tt),et=new Ae(Ut,li),ut=new Ae(Mt,li)}if(M){let Ut;Ut=d?new Ae(0,0):at?new Ae(A[0],A[1]):new Ae(r[0],r[1]),Ge._rotateAround(M,Ut),ct._rotateAround(M,Ut),et._rotateAround(M,Ut),ut._rotateAround(M,Ut)}const lt=new Ae(0,0),Bt=new Ae(0,0);T.push({tl:Ge,tr:ct,bl:et,br:ut,texPrimary:Y,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:Je,sectionIndex:X.sectionIndex,isSDF:ue,pixelOffsetTL:lt,pixelOffsetBR:Bt,minFontScaleX:0,minFontScaleY:0})}}return T}function l5(a,t=1,r=!1){let c=1/0,d=1/0,g=-1/0,_=-1/0;const v=a[0];for(let D=0;D<v.length;D++){const k=v[D];(!D||k.x<c)&&(c=k.x),(!D||k.y<d)&&(d=k.y),(!D||k.x>g)&&(g=k.x),(!D||k.y>_)&&(_=k.y)}const S=Math.min(g-c,_-d);let T=S/2;const M=new dh([],c5);if(S===0)return new Ae(c,d);for(let D=c;D<g;D+=S)for(let k=d;k<_;k+=S)M.push(new Af(D+T,k+T,T,a));let A=(function(D){let k=0,$=0,H=0;const j=D[0];for(let X=0,Y=j.length,te=Y-1;X<Y;te=X++){const ue=j[X],le=j[te],ge=ue.x*le.y-le.x*ue.y;$+=(ue.x+le.x)*ge,H+=(ue.y+le.y)*ge,k+=3*ge}return new Af($/k,H/k,0,D)})(a),z=M.length;for(;M.length;){const D=M.pop();(D.d>A.d||!A.d)&&(A=D,r&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,z)),D.max-A.d<=t||(T=D.h/2,M.push(new Af(D.p.x-T,D.p.y-T,T,a)),M.push(new Af(D.p.x+T,D.p.y-T,T,a)),M.push(new Af(D.p.x-T,D.p.y+T,T,a)),M.push(new Af(D.p.x+T,D.p.y+T,T,a)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${A.d}`)),A.p}function c5(a,t){return t.max-a.max}Mf.loadGlyphRange=function(a,t,r,c,d){const g=256*t,_=g+255,v=c.transformRequest(c.normalizeGlyphsURL(r).replace("{fontstack}",a).replace("{range}",`${g}-${_}`),es.Glyphs);ih(v,(S,T)=>{if(S)d(S);else if(T){const M={},A=(function(z){return new mx(z).readFields(QU,{})})(T);for(const z of A.glyphs)M[z.id]=z;d(null,{glyphs:M,ascender:A.ascender,descender:A.descender})}})},Mf.TinySDF=class{constructor({fontSize:a=24,buffer:t=3,radius:r=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:_="normal",lang:v=null}={}){this.buffer=t,this.cutoff=c,this.radius=r,this.lang=v;const S=this.size=a+4*t,T=this._createCanvas(S),M=this.ctx=T.getContext("2d",{willReadFrequently:!0});M.font=`${_} ${g} ${a}px ${d}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(a){const t=document.createElement("canvas");return t.width=t.height=a,t}draw(a){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(a),_=Math.ceil(r),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),S=Math.min(this.size-this.buffer,_+Math.ceil(c)),T=v+2*this.buffer,M=S+2*this.buffer,A=Math.max(T*M,0),z=new Uint8ClampedArray(A),D={data:z,width:T,height:M,glyphWidth:v,glyphHeight:S,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(v===0||S===0)return D;const{ctx:k,buffer:$,gridInner:H,gridOuter:j}=this;this.lang&&(k.lang=this.lang),k.clearRect($,$,v,S),k.fillText(a,$,$+_);const X=k.getImageData($,$,v,S);j.fill(Pg,0,A),H.fill(0,0,A);for(let Y=0;Y<S;Y++)for(let te=0;te<v;te++){const ue=X.data[4*(Y*v+te)+3]/255;if(ue===0)continue;const le=(Y+$)*T+te+$;if(ue===1)j[le]=0,H[le]=Pg;else{const ge=.5-ue;j[le]=ge>0?ge*ge:0,H[le]=ge<0?ge*ge:0}}eP(j,0,0,T,M,T,this.f,this.v,this.z),eP(H,$,$,v,S,T,this.f,this.v,this.z);for(let Y=0;Y<A;Y++){const te=Math.sqrt(j[Y])-Math.sqrt(H[Y]);z[Y]=Math.round(255-255*(te/this.radius+this.cutoff))}return D}};class Af{constructor(t,r,c,d){this.p=new Ae(t,r),this.h=c,this.d=(function(g,_){let v=!1,S=1/0;for(let T=0;T<_.length;T++){const M=_[T];for(let A=0,z=M.length,D=z-1;A<z;D=A++){const k=M[A],$=M[D];k.y>g.y!=$.y>g.y&&g.x<($.x-k.x)*(g.y-k.y)/($.y-k.y)+k.x&&(v=!v),S=Math.min(S,yu(g,k,$))}}return(v?1:-1)*Math.sqrt(S)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const u5=Object.keys,j1=Number.POSITIVE_INFINITY,h5=Math.sqrt(2);function Eu(a,t,r,c,d){const g=F1(a)&&a.collisionPadding?a.collisionPadding:[0,0,0,0],_={top:a.top-g[1],bottom:a.bottom+g[3],left:a.left-g[0],right:a.right+g[2],scaled:!1};return c!==void 0&&(function(v,S){v.top*=S,v.bottom*=S,v.left*=S,v.right*=S,v.scaled=!0})(_,c),r&&(function(v,S){if(!S)return;const T=ii(S),M=new Ae(v.left,v.top),A=new Ae(v.right,v.top),z=new Ae(v.left,v.bottom),D=new Ae(v.right,v.bottom),k=new Ae(0,0);M._rotateAround(T,k),A._rotateAround(T,k),z._rotateAround(T,k),D._rotateAround(T,k),v.left=Math.min(M.x,A.x,z.x,D.x),v.right=Math.max(M.x,A.x,z.x,D.x),v.top=Math.min(M.y,A.y,z.y,D.y),v.bottom=Math.max(M.y,A.y,z.y,D.y)})(_,r),d&&(_.left+=d[0],_.right+=d[0],_.top+=d[1],_.bottom+=d[1]),t?{top:Math.min(t.top,_.top),bottom:Math.max(t.bottom,_.bottom),left:Math.min(t.left,_.left),right:Math.max(t.right,_.right),scaled:t.scaled||_.scaled}:_}function sP(a,[t,r]){let c=0,d=0;if(r===j1){t<0&&(t=0);const g=t/h5;switch(a){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-t;break;case"top":d=t-7}switch(a){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),a){case"top-right":case"top-left":case"top":d=r-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-r}switch(a){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,d]}function d5(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k){const $=a.layers[0],H=$.appearances;if(H.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const j={iconBBox:null,iconVerticalBBox:null},X={textBBox:null,textVerticalBBox:null},{baseIconRotate:Y,baseTextRotate:te,iconScaleFactor:ue}=(function(ge,ye,me){const we=ge.get("icon-rotate").evaluate(ye,{},me),Ie=ge.get("text-rotate").evaluate(ye,{},me),[Je,qe]=ge.get("icon-size-scale-range");return{baseIconRotate:we,baseTextRotate:Ie,iconScaleFactor:de(1,Je,qe)}})(c,d,g);t&&(j.iconBBox=Eu(t,j.iconBBox,Y,_),r)&&(j.iconVerticalBBox=Eu(r,j.iconVerticalBBox,Y+90,_));const le=wx(A.horizontal);le&&(X.textBBox=Eu(le,X.textBBox,te,1,D)),A.vertical&&(X.textVerticalBBox=Eu(A.vertical,X.textVerticalBBox,te+90,1,D));for(const ge of H)ge.hasIconProperties()&&f5(j,a,$,ge,d,g,v,Y,_,S,t,T,ue,M,k),ge.hasTextProperties()&&p5(X,$,ge,d,g,D,te,z,le,A.vertical);return{iconBBox:j.iconBBox,iconVerticalBBox:j.iconVerticalBBox,textBBox:X.textBBox,textVerticalBBox:X.textVerticalBBox}}function f5(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k){const{appearanceIconOffset:$,appearanceIconRotate:H,appearanceIconSize:j}=aP(c,r,d,g,_,v,S,T.iconScaleFactor);let X=null,Y=null,te=null;c.hasProperty("icon-image")?te=(function(ue,le,ge,ye,me,we,Ie,Je){let qe=null;const Xe=le.getAppearanceValueAndResolveTokens(ge,"icon-image",ye,me,Je);if(Xe){const at=ue.getResolvedImageFromTokens(Xe),nt=ge.getUnevaluatedProperty("icon-size"),ot=zg(at,Zh(ue.zoom,nt,ue.worldview,Je),nt,me,ue.zoom,ye,ue.pixelRatio,Ie,ue.worldview,Je);qe=we.get(ot.iconPrimary.toString())}return qe})(t,r,c,d,g,A,z,k):M&&(te=M.imagePrimary),te&&(X=_x(te,null,$,D),t.allowVerticalPlacement&&(Y=_x(te,null,$,D))),X&&(a.iconBBox=Eu(X,a.iconBBox,H,j)),Y&&(a.iconVerticalBBox=Eu(Y,a.iconVerticalBBox,H+90,j))}function aP(a,t,r,c,d,g,_,v){const S=a.hasProperty("icon-offset")?t.getAppearanceValueAndResolveTokens(a,"icon-offset",r,c,[]):null,T=S&&Array.isArray(S)?S:d,M=a.hasProperty("icon-rotate")?t.getAppearanceValueAndResolveTokens(a,"icon-rotate",r,c,[]):null,A=typeof M=="number"?M:g,z=a.hasProperty("icon-size")?t.getAppearanceValueAndResolveTokens(a,"icon-size",r,c,[]):null;return{appearanceIconOffset:T,appearanceIconRotate:A,appearanceIconSize:typeof z=="number"?z*v:_}}function p5(a,t,r,c,d,g,_,v,S,T){const{appearanceTextOffset:M,appearanceTextRotate:A,appearanceTextSize:z}=lP(r,t,c,d,g,_,v),D=z/v;S&&(a.textBBox=Eu(S,a.textBBox,A,D,M)),T&&(a.textVerticalBBox=Eu(T,a.textVerticalBBox,A+90,D,M))}function lP(a,t,r,c,d,g,_){const v=a.hasProperty("text-offset")?t.getAppearanceValueAndResolveTokens(a,"text-offset",r,c,[]):null,S=v&&Array.isArray(v)?[v[0]*so,v[1]*so]:d,T=a.hasProperty("text-rotate")?t.getAppearanceValueAndResolveTokens(a,"text-rotate",r,c,[]):null,M=typeof T=="number"?T:g,A=a.hasProperty("text-size")?t.getAppearanceValueAndResolveTokens(a,"text-size",r,c,[]):null;return{appearanceTextOffset:S,appearanceTextRotate:M,appearanceTextSize:typeof A=="number"?A:_}}function bx(a,t,r,c,d,g,_,v,S){if(!t||!t.usvg)return;const T=ZA(c),M=ZA(d),A=g!=="both"&&g!=="width"||!GA(c)?1:M.width/T.width,z=g!=="both"&&g!=="height"||!HA(c)?1:M.height/T.height;r.scaleSelf(A,z);const D=r.toString();_.set(D,r),v.set(D,t);const{imagePosition:k}=U1(D,t,1);S.set(D,k)}function cP(a,t,r,c,d,g,_,v,S,T){if(!a)return;const M=(function(A,z,D,k,$,H,j){if(A.kind==="camera")return A.maxSize;if(A.kind==="composite"){const X=z.possiblyEvaluate(new An(A.maxZoom,{worldview:H}),D,j).evaluate($,{},D,j),Y=z.possiblyEvaluate(new An(A.minZoom,{worldview:H}),D,j).evaluate($,{},D,j);return Math.max(X,Y)}return z.possiblyEvaluate(new An(k,{worldview:H}),D,j).evaluate($,{},D,j)})(t,r,c,d,g,S,T);return a.scaleSelf(M*v*_)}function zg(a,t,r,c,d,g,_,v,S,T){return{iconPrimary:cP(a.getPrimary(),t,r,c,d,g,_,v,S,T),iconSecondary:cP(a.getSecondary(),t,r,c,d,g,_,v,S,T)}}function m5(a,t,r){if(!t)return;const c=r.get(a.toString()),d=r.get(t.toString());c&&d&&(c.paddedRect.w===d.paddedRect.w&&c.paddedRect.h===d.paddedRect.h||vi(`Mismatch in icon variant sizes: ${a.toString()} and ${t.toString()}`),c.usvg!==d.usvg&&vi(`Mismatch in icon variant image types: ${a.id} and ${t.id}`))}function uP(a,t,r,c){if(!a)return;const d=t.get(r.toString());if(a.imagePrimary=d,c){const g=t.get(c.toString());a.imageSecondary=g}}function g5(a,t){for(const r in a.horizontal)hP(a.horizontal[r],t);hP(a.vertical,t)}function hP(a,t){if(a){for(const r of a.positionedLines)for(const c of r.positionedGlyphs)if(c.image!==null){const d=c.image.toString();c.rect=t.get(d).paddedRect}}}function G1(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _5(a,t,r,c,d,g,_,v,S){const T=wx(g.horizontal)||g.vertical,M=r.get("icon-text-fit-padding").evaluate(c,{},d);let A,z=t;return t&&S!=="none"&&(a.allowVerticalPlacement&&g.vertical&&(A=B1(t,g.vertical,S,M,v,_)),T&&(z=B1(t,T,S,M,v,_))),{defaultShapedIcon:z,verticallyShapedIcon:A}}function dP(a,t){return a*t/24}function y5(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X,Y,te,ue,le,ge){let ye=_.textMaxSize.evaluate(t,{},z);ye===void 0?ye=v*_.textScaleFactor:ye*=_.textScaleFactor;const me=a.layers[0].layout,we=dP(v,_.textScaleFactor),Ie=wx(r.horizontal)||r.vertical,Je=a.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((H!=="none"||Je)&&a.appearanceFeatureData&&a.featureToAppearanceIndex[t.index]<a.appearanceFeatureData.length){const Tt=a.appearanceFeatureData[a.featureToAppearanceIndex[t.index]];Tt&&(Tt.textShaping=Ie,Tt.iconTextFitPadding=me.get("icon-text-fit-padding").evaluate(t,{},z),Tt.fontScale=we,Tt.textScaleFactor=_.textScaleFactor)}const qe=D.name==="globe",Xe=a.tilePixelRatio*ye/24,at=(ut=a.overscaling,a.zoom>18&&ut>2&&(ut>>=1),Math.max(It/(512*ut),1)*me.get("symbol-spacing")),nt=me.get("text-padding")*a.tilePixelRatio,ot=me.get("icon-padding")*a.tilePixelRatio,Ge=ii(me.get("text-max-angle")),ct=me.get("icon-rotation-alignment")==="map"&&Y!=="point",et=at/2;var ut;a.hasAnyIconTextFit===!1&&H!=="none"&&(a.hasAnyIconTextFit=!0);const lt=t.properties?+t.properties[tn]:null,Bt=lt&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(lt):65535,Ut=(Tt,Mt,li)=>{if(Mt.x<0||Mt.x>=It||Mt.y<0||Mt.y>=It)return;let Yt=null;if(qe){const{x:Ct,y:bi,z:qi}=D.projectTilePoint(Mt.x,Mt.y,li);Yt={anchor:new zc(Ct,bi,qi,0,void 0),up:D.upVector(li,Mt.x,Mt.y)}}(function(Ct,bi,qi,pn,Hi,Pn,an,wr,cn,In,Jn,or,sr,Sr,vo,Ao,Ur,Wr,Kr,$i,ar,dr,js,Wo,xo,qo,Yl,Ro,Nx,kf,ls,Ux){const Kl=Ct.addToLineVertexArray(bi,pn);let Cc,Au,ya,$a,Zg,Of,Zi,ao=0,Tr=0,qr=0,va=0,Es=-1,Gs=-1;const lo={};let Wg=Zc("");const Ql=qi?qi.anchor:bi,$r=Ro!=="none";let bo=0,Xr=0;if(cn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const wo=cn.layout.get("text-offset").evaluate(ar,{},xo);bo=wo[0]*so,Xr=wo[1]*so}else bo=cn.layout.get("text-radial-offset").evaluate(ar,{},xo)*so,Xr=j1;if(Ct.allowVerticalPlacement&&Hi.vertical){const wo=Hi.vertical;if(vo)Of=W1(wo),wr&&(Zi=W1(wr));else{const Is=cn.layout.get("text-rotate").evaluate(ar,{},xo)+90;ya=Sx(In,Ql,bi,Jn,or,sr,wo,Sr,Is,Ao,Ux),wr&&($a=Sx(In,Ql,bi,Jn,or,sr,wr,Wr,Is,null,ls))}}if(Pn){const wo=cn.layout.get("icon-rotate").evaluate(ar,{},xo),Is=V1(Pn,wo,js,$r,dr.iconScaleFactor),Va=wr?V1(wr,wo,js,$r,dr.iconScaleFactor):void 0;Au=Sx(In,Ql,bi,Jn,or,sr,Pn,Wr,wo,null,kf);const ec=(function(yl,z$,zz,C$,L$,Cz,Lz,R$,die,_S){const Rz=yl.layers[0],Dz=Rz.appearances;let Bf=z$.length;if(zz&&(Bf=Math.max(Bf,zz.length)),Dz.length===0)return Bf;const[D$,k$]=C$.get("icon-size-scale-range"),O$=de(1,D$,k$);for(const yS of Dz){const kz=yS.getUnevaluatedProperties();if(kz._values["icon-image"].value!==void 0){const Oz=Rz.getAppearanceValueAndResolveTokens(yS,"icon-image",Cz,Lz,_S);if(Oz){const Fz=yl.getResolvedImageFromTokens(Oz);if(Fz){const Bz=yS.hasProperty("icon-size")?kz._values["icon-size"]:L$._values["icon-size"],F$=zg(Fz,Zh(yl.zoom,Bz,yl.worldview,_S),Bz,Lz,yl.zoom,Cz,yl.pixelRatio,O$,yl.worldview,_S),Nz=R$.get(F$.iconPrimary.toString());Nz&&(Bf=Math.max(Bf,s5(Nz)))}}}}return Bf})(Ct,Is,Va,cn.layout,cn._unevaluatedLayout,ar,xo,Ct.iconAtlasPositions,0,Wo);ao=4*ec;const mS=cn.layout.get("icon-size").evaluate(ar,{},xo,Wo),gS=dr.compositeIconSizes?dr.compositeIconSizes[0].evaluate(ar,{},xo,Wo):0,qg=dr.compositeIconSizes?dr.compositeIconSizes[1].evaluate(ar,{},xo,Wo):0,Ff=Z1(Ct.layerIds[0],Ct.iconSizeData,mS,dr.iconScaleFactor,gS,qg);Ct.addSymbols(Ct.icon,Is,Ff,$i,Kr,ar,void 0,qi,bi,Kl.lineStartIndex,Kl.lineLength,-1,Wo,xo,qo,Yl,Ct.symbolInstances.length,ec),Es=Ct.icon.placedSymbolArray.length-1,Va&&(Tr=4*ec,Ct.addSymbols(Ct.icon,Va,Ff,$i,Kr,ar,Vs.vertical,qi,bi,Kl.lineStartIndex,Kl.lineLength,-1,Wo,xo,qo,Yl,Ct.symbolInstances.length,ec),Gs=Ct.icon.placedSymbolArray.length-1)}for(const wo in Hi.horizontal){const Is=wo,Va=Hi.horizontal[Is];Cc||(Wg=Zc(Va.text),vo?Zg=W1(Va):Cc=Sx(In,Ql,bi,Jn,or,sr,Va,Sr,cn.layout.get("text-rotate").evaluate(ar,{},xo),Ao,Ux));const ec=Va.positionedLines.length===1;if(qr+=fP(Ct,qi,bi,Va,an,cn,vo,ar,Ao,Kl,Hi.vertical?Vs.horizontal:Vs.horizontalOnly,ec?u5(Hi.horizontal):[Is],lo,Es,dr,Wo,xo,Ct.symbolInstances.length,qo),ec)break}Hi.vertical&&(va+=fP(Ct,qi,bi,Hi.vertical,an,cn,vo,ar,Ao,Kl,Vs.vertical,["vertical"],lo,Gs,dr,Wo,xo,Ct.symbolInstances.length,qo));let Do=-1;const ko=(wo,Is)=>wo?Math.max(wo,Is):Is;Do=ko(Zg,Do),Do=ko(Of,Do),Do=ko(Zi,Do);const Pu=Do>-1?1:0;Ct.glyphOffsetArray.length>=65535&&vi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ar.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,ar.sortKey),Ct.symbolInstances.emplaceBack(bi.x,bi.y,Ql.x,Ql.y,Ql.z,lo.right>=0?lo.right:-1,lo.center>=0?lo.center:-1,lo.left>=0?lo.left:-1,lo.vertical>=0?lo.vertical:-1,Es,Gs,Wg,Cc!==void 0?Cc:Ct.collisionBoxArray.length,Cc!==void 0?Cc+1:Ct.collisionBoxArray.length,ya!==void 0?ya:Ct.collisionBoxArray.length,ya!==void 0?ya+1:Ct.collisionBoxArray.length,Au!==void 0?Au:Ct.collisionBoxArray.length,Au!==void 0?Au+1:Ct.collisionBoxArray.length,$a||Ct.collisionBoxArray.length,$a?$a+1:Ct.collisionBoxArray.length,Jn,qr,va,ao,Tr,Pu,0,bo,Xr,Do,0,$r?1:0,Nx)})(a,Mt,Yt,Tt,r,c,g,d,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,nt,X,T,0,ot,ct,j,t,_,M,A,z,k,$,H,Bt,te,ue,le)};if(Y==="line")for(const Tt of rx(t.geometry,0,0,It,It)){const Mt=o5(Tt,at,Ge,r.vertical||Ie,c,24,Xe,a.overscaling,It);for(const li of Mt)Ie&&v5(a,Ie.text,et,li)||Ut(Tt,li,z)}else if(Y==="line-center"){for(const Tt of t.geometry)if(Tt.length>1){const Mt=r5(Tt,Ge,r.vertical||Ie,c,24,Xe);Mt&&Ut(Tt,Mt,z)}}else if(t.type==="Polygon")for(const Tt of hg(t.geometry,0)){const Mt=l5(Tt,16);Ut(Tt[0],new zc(Mt.x,Mt.y,0,0,void 0),z)}else if(t.type==="LineString")for(const Tt of t.geometry)Ut(Tt,new zc(Tt[0].x,Tt[0].y,0,0,void 0),z);else if(t.type==="Point")for(const Tt of t.geometry)for(const Mt of Tt)Ut([Mt],new zc(Mt.x,Mt.y,0,0,void 0),z)}const H1=255,Wh=H1*Pc;function fP(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X){const Y=oP(0,c,S,g,_,v,d,a.allowVerticalPlacement,void 0),te=g.layout.get("text-size").evaluate(v,{},H),ue=k.compositeTextSizes?k.compositeTextSizes[0].evaluate(v,{},H):0,le=k.compositeTextSizes?k.compositeTextSizes[1].evaluate(v,{},H):0,ge=Z1(a.layerIds[0],a.textSizeData,te,k.textScaleFactor,ue,le);a.addSymbols(a.text,Y,ge,S,_,v,M,t,r,T.lineStartIndex,T.lineLength,D,$,H,X,!1,j,Y.length);for(const ye of A)z[ye]=a.text.placedSymbolArray.length-1;return 4*Y.length}function Z1(a,t,r,c,d,g){const _=t;let v=null;return _.kind==="source"?(v=[Pc*r*c],v[0]>Wh&&vi(`${a}: Value for "text-size" is >= ${H1}. Reduce your "text-size".`)):_.kind==="composite"&&(v=[Pc*d*c,Pc*g*c],(v[0]>Wh||v[1]>Wh)&&vi(`${a}: Value for "text-size" is >= ${H1}. Reduce your "text-size".`)),v}function wx(a){for(const t in a)return a[t];return null}function Sx(a,t,r,c,d,g,_,v,S,T,M){let A,z,D,k;if(A=M?M.top:_.top,z=M?M.bottom:_.bottom,D=M?M.left:_.left,k=M?M.right:_.right,F1(_)&&_.collisionPadding){const $=_.collisionPadding;D-=$[0],A-=$[1],k+=$[2],z+=$[3]}if(S){const $=new Ae(D,A),H=new Ae(k,A),j=new Ae(D,z),X=new Ae(k,z),Y=ii(S);let te=new Ae(0,0);T&&(te=new Ae(T[0],T[1])),$._rotateAround(Y,te),H._rotateAround(Y,te),j._rotateAround(Y,te),X._rotateAround(Y,te),D=Math.min($.x,H.x,j.x,X.x),k=Math.max($.x,H.x,j.x,X.x),A=Math.min($.y,H.y,j.y,X.y),z=Math.max($.y,H.y,j.y,X.y)}return a.emplaceBack(t.x,t.y,t.z,r.x,r.y,D,A,k,z,v,c,d,g),a.length-1}function W1(a){F1(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const t=a.bottom-a.top;return t>0?Math.max(10,t):null}function v5(a,t,r,c){const d=a.compareText;if(t in d){const g=d[t];for(let _=g.length-1;_>=0;_--)if(c.dist(g[_])<r)return!0}else d[t]=[];return d[t].push(c),!1}function pP(a,t){const r=a.fovAboveCenter,c=a.elevation?a.elevation.getMinElevationBelowMSL()*t:0,d=(a._camera.position[2]*a.worldSize-c)/Math.cos(a._pitch),g=Math.sin(r)*d/Math.sin(Math.max(Math.PI/2-a._pitch-r,.01));let _=Math.sin(a._pitch)*g+d;const v=d*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let S=Math.max(a.zoom-17,0);a.isOrthographic&&(S/=10),_*=1+S}return Math.min(1.01*_,v)}function Cg(a,t){if(!t.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:t};const r=Math.pow(2,-a.z),c=a.x*r,d=(a.x+1)*r,g=a.y*r,_=(a.y+1)*r,v=it(c),S=it(d),T=dt(g),M=dt(_),A=t.project(v,T),z=t.project(S,T),D=t.project(S,M),k=t.project(v,M);let $=Math.min(A.x,z.x,D.x,k.x),H=Math.min(A.y,z.y,D.y,k.y),j=Math.max(A.x,z.x,D.x,k.x),X=Math.max(A.y,z.y,D.y,k.y);const Y=r/16;function te(le,ge,ye,me,we,Ie){const Je=(ye+we)/2,qe=(me+Ie)/2,Xe=t.project(it(Je),dt(qe)),at=Math.max(0,$-Xe.x,H-Xe.y,Xe.x-j,Xe.y-X);$=Math.min($,Xe.x),j=Math.max(j,Xe.x),H=Math.min(H,Xe.y),X=Math.max(X,Xe.y),at>Y&&(te(le,Xe,ye,me,Je,qe),te(Xe,ge,Je,qe,we,Ie))}te(A,z,c,g,d,g),te(z,D,d,g,d,_),te(D,k,d,_,c,_),te(k,A,c,_,c,g),$-=Y,H-=Y,j+=Y,X+=Y;const ue=1/Math.max(j-$,X-H);return{scale:ue,x:$*ue,y:H*ue,x2:j*ue,y2:X*ue,projection:t}}function mP(a,{x:t,y:r},c=0){return new Ae(((t-c)*a.scale-a.x)*It,(r*a.scale-a.y)*It)}const x5=fe(new Float32Array(16));class Iu{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new he(0,0)}projectTilePoint(t,r,c){return{x:t,y:r,z:0}}locationPoint(t,r,c,d=!0){return t._coordinatePoint(t.locationCoordinate(r,c),d)}pixelsPerMeter(t,r){return je(1,t)*r}pixelSpaceConversion(t,r,c){return 1}farthestPixelDistance(t){return pP(t,t.pixelsPerMeter)}pointCoordinate(t,r,c,d){const g=t.horizonLineFromTop(!1),_=new Ae(r,Math.max(g,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(_,d))}pointCoordinate3D(t,r,c){const d=new Ae(r,c);if(t.elevation)return t.elevation.pointCoordinate(d);{const g=this.pointCoordinate(t,d.x,d.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(t,r){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,r.x,r.y);const c=t.horizonLineFromTop();return r.y<c}createInversionMatrix(t,r){return x5}createTileMatrix(t,r,c){let d,g,_;const v=c.canonical,S=fe(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Cg(v,this);d=1,g=T.x+c.wrap*T.scale,_=T.y,Ue(S,S,[d/T.scale,d/T.scale,t.pixelsPerMeter/r])}else d=r/t.zoomScale(v.z),g=(v.x+Math.pow(2,v.z)*c.wrap)*d,_=v.y*d;return tt(S,S,[g,_,0]),Ue(S,S,[d/It,d/It,1]),S}upVector(t,r,c){return[0,0,1]}upVectorScale(t,r,c){return{metersToTile:1}}}class b5 extends Iu{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[r,c]=this.parallels=t.parallels||[29.5,45.5],d=Math.sin(ii(r));this.n=(d+Math.sin(ii(c)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(t,r){const{n:c,c:d,r0:g}=this,_=ii(t-this.center[0]),v=ii(r),S=Math.sqrt(d-2*c*Math.sin(v))/c;return{x:S*Math.sin(_*c),y:S*Math.cos(_*c)-g,z:0}}unproject(t,r){const{n:c,c:d,r0:g}=this,_=g+r;let v=Math.atan2(t,Math.abs(_))*Math.sign(_);_*c<0&&(v-=Math.PI*Math.sign(t)*Math.sign(_));const S=ii(this.center[0])*c;v=Oe(v,-Math.PI-S,Math.PI-S);const T=de(Ee(v/c)+this.center[0],-180,180),M=Math.asin(de((d-(t*t+_*_)*c*c)/(2*c),-1,1)),A=de(Ee(M),-85.051129,Te);return new he(T,A)}}const Lg=1.340264,Rg=-.081106,Dg=893e-6,kg=.003796,Tx=Math.sqrt(3)/2;class w5 extends Iu{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(Tx*Math.sin(r)),d=c*c,g=d*d*d;return{x:.5*(t*Math.cos(c)/(Tx*(Lg+3*Rg*d+g*(7*Dg+9*kg*d)))/Math.PI+.5),y:1-.5*(c*(Lg+Rg*d+g*(Dg+kg*d))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,d=c*c,g=d*d*d;for(let M,A,z,D=0;D<12&&(A=c*(Lg+Rg*d+g*(Dg+kg*d))-r,z=Lg+3*Rg*d+g*(7*Dg+9*kg*d),M=A/z,c=de(c-M,-Math.PI/3,Math.PI/3),d=c*c,g=d*d*d,!(Math.abs(M)<1e-12));++D);const _=Tx*t*(Lg+3*Rg*d+g*(7*Dg+9*kg*d))/Math.cos(c),v=Math.asin(Math.sin(c)/Tx),S=de(180*_/Math.PI,-180,180),T=de(180*v/Math.PI,-85.051129,Te);return new he(S,T)}}class S5 extends Iu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){const c=360*(t-.5),d=de(360*(.5-r),-85.051129,Te);return new he(c,d)}}const Pf=Math.PI/2;function Ex(a){return Math.tan((Pf+a)/2)}class T5 extends Iu{constructor(t){super(t),this.center=t.center||[0,30];const[r,c]=this.parallels=t.parallels||[30,30];let d=ii(r),g=ii(c);this.southernCenter=d+g<0,this.southernCenter&&(d=-d,g=-g);const _=Math.cos(d),v=Ex(d);this.n=d===g?Math.sin(d):Math.log(_/Math.cos(g))/Math.log(Ex(g)/v),this.f=_*Math.pow(Ex(d),this.n)/this.n}project(t,r){r=ii(r),this.southernCenter&&(r=-r),t=ii(t-this.center[0]);const c=1e-6,{n:d,f:g}=this;g>0?r<-Pf+c&&(r=-Pf+c):r>Pf-c&&(r=Pf-c);const _=g/Math.pow(Ex(r),d);let v=_*Math.sin(d*t),S=g-_*Math.cos(d*t);return v=.5*(v/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:v,y:this.southernCenter?S:1-S,z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:c,f:d}=this,g=d-r,_=Math.sign(g),v=Math.sign(c)*Math.sqrt(t*t+g*g);let S=Math.atan2(t,Math.abs(g))*_;g*c<0&&(S-=Math.PI*Math.sign(t)*_);const T=de(Ee(S/c)+this.center[0],-180,180),M=de(Ee(2*Math.atan(Math.pow(d/v,1/c))-Pf),-85.051129,Te);return new he(T,this.southernCenter?-M:M)}}class gP extends Iu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:Re(t),y:Ze(r),z:0}}unproject(t,r){const c=it(t),d=dt(r);return new he(c,d)}}const _P=ii(Te);class E5 extends Iu{project(t,r){const c=(r=ii(r))*r,d=c*c;return{x:.5*((t=ii(t))*(.8707-.131979*c+d*(d*(.003971*c-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+c*(.015085+d*(.028874*c-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,d=25,g=0,_=c*c;do{_=c*c;const T=_*_;g=(c*(1.007226+_*(.015085+T*(.028874*_-.044475-.005916*T)))-r)/(1.007226+_*(.045255+T*(.259866*_-.311325-.005916*11*T))),c=de(c-g,-_P,_P)}while(Math.abs(g)>1e-6&&--d>0);_=c*c;const v=de(Ee(t/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),S=Ee(c);return new he(v,S)}}const yP=ii(Te);class I5 extends Iu{project(t,r){r=ii(r),t=ii(t);const c=Math.cos(r),d=2/Math.PI,g=Math.acos(c*Math.cos(t/2)),_=Math.sin(g)/g,v=.5*(t*d+2*c*Math.sin(t/2)/_)||0,S=.5*(r+Math.sin(r)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(t,r){let c=t=(2*t-.5)*Math.PI,d=r=(2*(1-r)-1)*Math.PI,g=25;const _=1e-6;let v=0,S=0;do{const T=Math.cos(d),M=Math.sin(d),A=2*M*T,z=M*M,D=T*T,k=Math.cos(c/2),$=Math.sin(c/2),H=2*k*$,j=$*$,X=1-D*k*k,Y=X?1/X:0,te=X?Math.acos(T*k)*Math.sqrt(1/X):0,ue=.5*(2*te*T*$+2*c/Math.PI)-t,le=.5*(te*M+d)-r,ge=.5*Y*(D*j+te*T*k*z)+1/Math.PI,ye=Y*(H*A/4-te*M*$),me=.125*Y*(A*$-te*M*D*H),we=.5*Y*(z*k+te*j*T)+.5,Ie=ye*me-we*ge;v=(le*ye-ue*we)/Ie,S=(ue*me-le*ge)/Ie,c=de(c-v,-Math.PI,Math.PI),d=de(d-S,-yP,yP)}while((Math.abs(v)>_||Math.abs(S)>_)&&--g>0);return new he(Ee(c),Ee(d))}}class vP extends Iu{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ii(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){const{scale:c,cosPhi:d}=this;return{x:ii(t)*d*c+.5,y:-Math.sin(ii(r))/d*c+.5,z:0}}unproject(t,r){const{scale:c,cosPhi:d}=this,g=-(r-.5)/c,_=de(Ee((t-.5)/c)/d,-180,180),v=Math.asin(de(g*d,-1,1)),S=de(Ee(v),-85.051129,Te);return new he(_,S)}}class M5 extends gP{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,c){const d=og(t,r,c);return qt(d,d,Zv(ql(c))),{x:d[0],y:d[1],z:d[2]}}locationPoint(t,r,c){const d=_e(r.lat,r.lng),g=Di([],d),_=c?t._centerAltitude+c:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude;Rn(d,d,g,je(1,0)*It*_);const v=fe(new Float64Array(16));return ie(v,t.pixelMatrix,t.globeMatrix),qt(d,d,v),new Ae(d[0],d[1])}pixelsPerMeter(t,r){return je(1,0)*r}pixelSpaceConversion(t,r,c){const d=je(1,t)*r,g=di(je(1,45)*r,d,c);return this.pixelsPerMeter(t,r)/g}createTileMatrix(t,r,c){const d=Gw(ql(c.canonical));return ie(new Float64Array(16),t.globeMatrix,d)}createInversionMatrix(t,r){const{center:c}=t,d=Zv(ql(r));return Ce(d,d,ii(c.lng)),Ne(d,d,ii(c.lat)),Ue(d,d,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(t,r,c,d){return R2(t,r,c,!0)||new Pt(0,0)}pointCoordinate3D(t,r,c){const d=this.pointCoordinate(t,r,c,0);return[d.x,d.y,d.z]}isPointAboveHorizon(t,r){return!R2(t,r.x,r.y,!1)}farthestPixelDistance(t){const r=(function(d,g){const _=d.cameraToCenterDistance,v=d._centerAltitude*g,S=d._camera,T=d._camera.forward(),M=ei([],wi([],T,-_),[0,0,v]),A=d.worldSize/(2*Math.PI),z=[0,0,-A],D=d.width/d.height,k=Math.tan(d.fovAboveCenter),$=wi([],S.up(),k),H=wi([],S.right(),k*D),j=Di([],ei([],ei([],T,$),H)),X=[];let Y;if(new Nn(M,j).closestPointOnSphere(z,A,X)){const te=ei([],X,z),ue=Le([],te,M);Y=Math.cos(d.fovAboveCenter)*_t(ue)}else{const te=Le([],M,z),ue=Le([],z,M);Di(ue,ue);const le=_t(te)-A;Y=Math.sqrt(le*(le+2*A));const ge=Math.acos(Y/(A+le))-Math.acos(Ii(T,ue));Y*=Math.cos(ge)}return 1.01*Y})(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=xu(t.zoom);if(c>0){const d=pP(t,je(1,t.center.lat)*t.worldSize),g=t.worldSize/(2*Math.PI),_=Math.max(t.width,t.height)/t.worldSize*Math.PI;return di(r,d+g*(1-Math.cos(_)),Math.pow(c,10))}return r}upVector(t,r,c){return og(r,c,t,1)}upVectorScale(t){return{metersToTile:jv(Hv(ql(t)))}}}function xP(a){const t=a.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(a.name){case"mercator":return new gP(a);case"equirectangular":return new S5(a);case"naturalEarth":return new E5(a);case"equalEarth":return new w5(a);case"winkelTripel":return new I5(a);case"albers":return r?new vP(a):new b5(a);case"lambertConformalConic":return r?new vP(a):new T5(a);case"globe":return new M5(a)}throw new Error(`Invalid projection name: ${a.name}`)}const A5=en.types,P5=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Og(a,t,r,c,d,g,_,v,S,T,M,A,z){const D=v?Math.min(Wh,Math.round(v[0])):0,k=v?Math.min(Wh,Math.round(v[1])):0;a.emplaceBack(t,r,Math.round(32*c),Math.round(32*d),g,_,(D<<1)+(S?1:0),0+(k<<1),16*T,16*M,256*A,256*z)}function Fg(a,t,r){a.emplaceBack(t,r)}function Bg(a,t,r,c,d,g,_){a.emplaceBack(t,r,c,d,g,_)}const Ix=(a,t,r,c)=>{for(let d=0;d<t;d++)a.emplaceBack(r[0],r[1],r[2],c[0],c[1],c[2])};function zf(a,t,r,c,d){a.emplaceBack(t,r,c,d),a.emplaceBack(t,r,c,d),a.emplaceBack(t,r,c,d),a.emplaceBack(t,r,c,d)}function z5(a){for(const t of a.sections)if(Vl(t.text))return!0;return!1}class q1{constructor(t){this.layoutVertexArray=new Jm,this.indexArray=new Hr,this.programConfigurations=t,this.segments=new er,this.dynamicLayoutVertexArray=new Wl,this.opacityVertexArray=new Km,this.placedSymbolArray=new Av,this.iconTransitioningVertexArray=new Os,this.globeExtVertexArray=new Ym,this.zOffsetVertexArray=new yo,this.orientationVertexArray=new cf,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(t,r){const c=[],d=this.layoutVertexArray.uint16;for(let g=0;g<r;++g){const _=12*(t+g);c.push(...d.slice(_,_+12))}return c}updateSymbolVertexData(t,r,c,d,g,_,v,S,T,M,A,z,D){const k=this.layoutVertexArray.uint16,$=12*t;k[$]=r,k[$+1]=c,k[$+2]=d,k[$+3]=g,k[$+4]=_,k[$+5]=v,k[$+6]=S,k[$+7]=T,k[$+8]=M,k[$+9]=A,k[$+10]=z,k[$+11]=D}upload(t,r,c,d,g,_){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,LU.members,!!_),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,DU.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,P5,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,FU.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,RU.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,kU.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=t.createVertexBuffer(this.orientationVertexArray,OU.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}jt(q1,"SymbolBuffers");class X1{constructor(t,r,c){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new c,this.segments=new er,this.collisionVertexArray=new lf,this.collisionVertexArrayExt=new Wl}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,BU.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,NU.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}jt(X1,"CollisionBuffers");class Mx{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fe([]),this.placementViewportMatrix=fe([]);const r=this.layers[0]._unevaluatedLayout._values;this.worldview=t.worldview,this.localizable=t.localizable,this.textSizeData=Zh(this.zoom,r["text-size"],this.worldview,t.availableImages),this.iconSizeData=Zh(this.zoom,r["icon-size"],this.worldview,t.availableImages);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.lut=t.lut,this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>Vs[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(t){const r=this.layers[0].getAppearances();if(!r||r.length===0)return!1;const c=Array.isArray(t)?t:[t];return r.some(d=>c.some(g=>d.getProperty(g)!=null))}createArrays(){this.text=new q1(new R(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new q1(new R(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new Dh,this.lineVertexArray=new Cv,this.symbolInstances=new zv}calculateGlyphDependencies(t,r,c,d,g){for(const _ of t){const v=_.codePointAt(0);if(v===void 0)break;if(r[v]=!0,d&&g&&v<=65535){const S=Ig[_];S&&(r[S.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(t,r,c,d,g,_,v){if(!t.hasProperty("icon-size"))return v*_;let S=1;const T=t.getUnevaluatedProperties()._values["icon-size"],M=Zh(this.zoom,T,this.worldview,g),A=If(M,r);if(M.kind!=="constant"&&M.kind!=="camera"||(S=A.uSize),M.kind==="composite"){const{minZoom:z,maxZoom:D}=M,k=T.possiblyEvaluate(new An(z,{worldview:this.worldview}),d),$=T.possiblyEvaluate(new An(D,{worldview:this.worldview}),d),H=k.evaluate(c,{},d,g);S=H+($.evaluate(c,{},d,g)-H)*A.uSizeT}return M.kind==="source"&&(S=T.possiblyEvaluate(new An(this.zoom,{worldview:this.worldview}),d).evaluate(c,{},d,g)),S*_}updateFootprints(t,r){}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!tx(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}getResolvedImageFromTokens(t){return typeof t=="string"?rs.build(t):t}populate(t,r,c,d){const g=this.layers[0],_=g.layout,v=this.projection.name==="globe",S=_.get("text-font"),T=_.get("text-field"),M=_.get("icon-image"),[A,z]=_.get("icon-size-scale-range"),D=de(r.scaleFactor||1,A,z),k=(T.value.kind!=="constant"||T.value.value instanceof Lo&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),$=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,H=this.hasAnyAppearanceProperty("icon-image"),j=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!k&&!$&&!H)return;const X=r.iconDependencies,Y=r.glyphDependencies,te=r.availableImages,ue=new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),le=ge=>{const ye=ge.id.toString();X.has(ye)?X.get(ye).push(ge):X.set(ye,[ge])};for(const ge of t){const{feature:ye,id:me,index:we,sourceLayerIndex:Ie}=ge,Je=g._featureFilter.needGeometry,qe=Ni(ye,Je);if(!g._featureFilter.filter(ue,qe,c))continue;if(Je||(qe.geometry=pi(ye,c,d)),v&&ye.type!==1&&c.z<=5){const ut=qe.geometry,lt=.98078528056,Bt=(Ut,Tt)=>Ii(og(Ut.x,Ut.y,c,1),og(Tt.x,Tt.y,c,1))<lt;for(let Ut=0;Ut<ut.length;Ut++)ut[Ut]=Ht(ut[Ut],Bt)}let Xe,at;if(k){const ut=g.getValueAndResolveTokens("text-field",qe,c,te),lt=Lo.factory(ut);z5(lt)&&(this.hasRTLText=!0),(!this.hasRTLText||Fm()==="unavailable"||this.hasRTLText&&ma.isParsed())&&(Xe=$U(lt,g,qe))}if($){const ut=g.getValueAndResolveTokens("icon-image",qe,c,te);at=this.getResolvedImageFromTokens(ut)}const nt=this.layers[0];let ot=!1;if(!at&&H){const ut=nt.getAppearances();for(const lt of ut)if(lt.getProperty("icon-image")){const Bt=nt.getAppearanceValueAndResolveTokens(lt,"icon-image",qe,c,te);if(Bt){at=this.getResolvedImageFromTokens(Bt),ot=!0;break}}}if(!Xe&&!at)continue;const Ge=this.sortFeaturesByKey?j.evaluate(qe,{},c):void 0,ct={id:me,text:Xe,icon:at,index:we,sourceLayerIndex:Ie,geometry:qe.geometry,properties:ye.properties,type:A5[ye.type],sortKey:Ge};if(this.features.push(ct),this.featureToAppearanceIndex[we]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:me,properties:ye.properties,usesAppearanceIconAsPlaceholder:ot,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),at){const ut=nt._unevaluatedLayout._values,{iconPrimary:lt,iconSecondary:Bt}=zg(at,this.iconSizeData,ut["icon-size"],c,this.zoom,ct,this.pixelRatio,D,this.worldview,te);le(lt),Bt&&(this.hasAnySecondaryIcon=!0,le(Bt))}const et=nt.getAppearances();if(et.length!==0&&et.forEach(ut=>{if(!ut.getProperty("icon-image"))return;const lt=this.getCombinedIconPrimary(ut,nt,qe,c,te,ct,D);lt&&le(lt)}),Xe){const ut=S.evaluate(qe,{},c).join(","),lt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Vs.vertical)>=0;for(const Bt of Xe.sections)if(Bt.image){const Ut=Bt.image.getPrimary().scaleSelf(this.pixelRatio),Tt=Ut.id.toString(),Mt=X.get(Tt)||[];Mt.push(Ut),X.set(Tt,Mt)}else{const Ut=Rm(Xe.toString()),Tt=Bt.fontStack||ut,Mt=Y[Tt]=Y[Tt]||{};this.calculateGlyphDependencies(Bt.text,Mt,lt,this.allowVerticalPlacement,Ut)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(ge){const ye={},me={},we=[];let Ie=0;function Je(nt){we.push(ge[nt]),Ie++}function qe(nt,ot,Ge){const ct=me[nt];return delete me[nt],me[ot]=ct,we[ct].geometry[0].pop(),we[ct].geometry[0]=we[ct].geometry[0].concat(Ge[0]),ct}function Xe(nt,ot,Ge){const ct=ye[ot];return delete ye[ot],ye[nt]=ct,we[ct].geometry[0].shift(),we[ct].geometry[0]=Ge[0].concat(we[ct].geometry[0]),ct}function at(nt,ot,Ge){const ct=Ge?ot[0][ot[0].length-1]:ot[0][0];return`${nt}:${ct.x}:${ct.y}`}for(let nt=0;nt<ge.length;nt++){const ot=ge[nt],Ge=ot.geometry,ct=ot.text?ot.text.toString():null;if(!ct){Je(nt);continue}const et=at(ct,Ge),ut=at(ct,Ge,!0);if(et in me&&ut in ye&&me[et]!==ye[ut]){const lt=Xe(et,ut,Ge),Bt=qe(et,ut,we[lt].geometry);delete ye[et],delete me[ut],me[at(ct,we[Bt].geometry,!0)]=Bt,we[lt].geometry=null}else et in me?qe(et,ut,Ge):ut in ye?Xe(et,ut,Ge):(Je(nt),ye[et]=Ie-1,me[ut]=Ie-1)}return we.filter(nt=>nt.geometry)})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ge of r.elevationFeatures)this.elevationFeatureIdToIndex.set(ge.id,this.elevationFeatures.length),this.elevationFeatures.push(ge)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ge,ye)=>ge.sortKey-ye.sortKey)}getCombinedIconPrimary(t,r,c,d,g,_,v){let S,T;const M=t.getUnevaluatedProperties();if(M._values["icon-image"].value!==void 0){const A=r.getAppearanceValueAndResolveTokens(t,"icon-image",c,d,g);S=this.getResolvedImageFromTokens(A)}else{const A=r.getValueAndResolveTokens("icon-image",c,d,g);S=this.getResolvedImageFromTokens(A)}if(S){const A=t.hasProperty("icon-size")?M._values["icon-size"]:r._unevaluatedLayout._values["icon-size"];T=zg(S,Zh(this.zoom,A,this.worldview,g),A,d,this.zoom,_,this.pixelRatio,v,this.worldview,g).iconPrimary}return T}updateSymbolInstanceIconVertices(t,r,c,d,g,_,v,S,T,M,A,z,D,k){if(t.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(r.activeAppearance===c)return{vertexOffsetDelta:t.numIconVertices,hasChanges:!1};if(c){const $=this.getCombinedIconPrimary(c,T,d,_,v,{sortKey:void 0,text:void 0,icon:null,index:t.featureIndex,sourceLayerIndex:t.featureIndex,geometry:[],properties:r.properties,type:"Point",id:r.id},M);if(!$)return{vertexOffsetDelta:0,hasChanges:!1};const H=$.toString(),j=this.iconAtlasPositions&&this.iconAtlasPositions.get(H);if(j){const{appearanceIconOffset:X,appearanceIconRotate:Y}=aP(c,T,d,_,z,k,D,M);let te=_x(j,void 0,X,T.layout.get("icon-anchor").evaluate(d,A,_));const ue=j.sdf,le=T.layout.get("icon-text-fit").constantOr("none");le!=="none"&&r.textShaping&&r.iconTextFitPadding&&r.fontScale&&(te=B1(te,r.textShaping,le,r.iconTextFitPadding,X,r.fontScale));const ge=this.calculateEffectiveAppearanceIconSize(c,S.zoom,d,_,v,M,D),ye=0,me=1+(Math.min(Wh,Math.round(ge*Pc))<<1),we=V1(te,Y,ue,le!=="none",M);r.isUsingAppearanceIconVertexData||(r.isUsingAppearanceIconVertexData=!0,r.layoutBasedIconVertexData=this.icon.getSymbolVertexData(g,t.numIconVertices));let Ie=g;for(let qe=0;qe<we.length;++qe){const Xe=we[qe],at=r.layoutBasedIconVertexData[0]||t.tileAnchorX,nt=r.layoutBasedIconVertexData[1]||t.tileAnchorY,ot=16*Xe.pixelOffsetTL.x,Ge=16*Xe.pixelOffsetTL.y,ct=16*Xe.pixelOffsetBR.x,et=16*Xe.pixelOffsetBR.y,ut=16*Xe.minFontScaleX,lt=16*Xe.minFontScaleY;this.icon.updateSymbolVertexData(Ie,at,nt,Math.round(32*Xe.tl.x),Math.round(32*Xe.tl.y),Xe.texPrimary.x,Xe.texPrimary.y,ye,me,ot,Ge,ut,lt),this.icon.updateSymbolVertexData(Ie+1,at,nt,Math.round(32*Xe.tr.x),Math.round(32*Xe.tr.y),Xe.texPrimary.x+Xe.texPrimary.w,Xe.texPrimary.y,ye,me,ct,Ge,ut,lt),this.icon.updateSymbolVertexData(Ie+2,at,nt,Math.round(32*Xe.bl.x),Math.round(32*Xe.bl.y),Xe.texPrimary.x,Xe.texPrimary.y+Xe.texPrimary.h,ye,me,ot,et,ut,lt),this.icon.updateSymbolVertexData(Ie+3,at,nt,Math.round(32*Xe.br.x),Math.round(32*Xe.br.y),Xe.texPrimary.x+Xe.texPrimary.w,Xe.texPrimary.y+Xe.texPrimary.h,ye,me,ct,et,ut,lt),Ie+=4}const Je=t.numIconVertices-4*we.length;for(let qe=0;qe<Je;++qe)this.icon.updateSymbolVertexData(Ie+qe,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:t.numIconVertices,hasChanges:!0}}}else if(r.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(g,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(g+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(g+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(g+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:t.numIconVertices,hasChanges:!0}}else if(r.isUsingAppearanceIconVertexData){const H=r.layoutBasedIconVertexData.length/12;for(let j=0;j<H;++j){const X=j*12;this.icon.updateSymbolVertexData(g+j,r.layoutBasedIconVertexData[X+0],r.layoutBasedIconVertexData[X+1],r.layoutBasedIconVertexData[X+2],r.layoutBasedIconVertexData[X+3],r.layoutBasedIconVertexData[X+4],r.layoutBasedIconVertexData[X+5],r.layoutBasedIconVertexData[X+6],r.layoutBasedIconVertexData[X+7],r.layoutBasedIconVertexData[X+8],r.layoutBasedIconVertexData[X+9],r.layoutBasedIconVertexData[X+10],r.layoutBasedIconVertexData[X+11])}return r.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:H,hasChanges:!0}}return{vertexOffsetDelta:t.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X){const Y=t.numHorizontalGlyphVertices>0||t.numVerticalGlyphVertices>0;if(!Y)return{vertexOffsetDelta:Y?t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices:0,hasChanges:!1};if(r.activeAppearance===c)return{vertexOffsetDelta:t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices,hasChanges:!1};if(c&&r.textShaping){const{appearanceTextOffset:te,appearanceTextRotate:ue,appearanceTextSize:le}=lP(c,v,d,_,A,D,z);r.fontScale=dP(le,r.textScaleFactor);const ge=c.getUnevaluatedProperty("text-size");let ye=this.textSizeData,me=H,we=j;c.hasProperty("text-size")&&(ye=Zh(this.zoom,ge,this.worldview,X),me=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,we=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const Ie=r.textShaping.bottom-A[1],Je=r.textShaping.left-A[0],qe=r.textShaping.right-A[0];r.textShaping.top=te[1]+(r.textShaping.top-A[1]),r.textShaping.bottom=te[1]+Ie,r.textShaping.left=te[0]+Je,r.textShaping.right=te[0]+qe;const Xe=oP(0,r.textShaping,te,v,!1,d,T,this.allowVerticalPlacement,ue),at=le&&ye.kind==="composite"?ge.possiblyEvaluate(new An(me,{}),_).evaluate(d,M,_):k,nt=le&&ye.kind==="composite"?ge.possiblyEvaluate(new An(we,{}),_).evaluate(d,M,_):$,ot=Z1(c.name,ye,le,S,at,nt),Ge=Array.isArray(ot)?ot[1]:le,ct=0,et=1+(Math.min(Wh,Math.round(Ge*Pc))<<1);r.isUsingAppearanceTextVertexData||(r.isUsingAppearanceTextVertexData=!0,r.layoutBasedTextVertexData=this.text.getSymbolVertexData(g,t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices));for(let ut=0;ut<Xe.length&&ut<(t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices)/4;++ut){const lt=Xe[ut],Bt=lt.glyphOffset[1],Ut=t.tileAnchorX,Tt=t.tileAnchorY,Mt=g+4*ut;this.text.updateSymbolVertexData(Mt,Ut,Tt,Math.round(32*lt.tl.x),Math.round(32*(Bt+lt.tl.y)),lt.texPrimary.x,lt.texPrimary.y,ct,et,lt.pixelOffsetTL.x,lt.pixelOffsetTL.y,lt.minFontScaleX,lt.minFontScaleY),this.text.updateSymbolVertexData(Mt+1,Ut,Tt,Math.round(32*lt.tr.x),Math.round(32*(Bt+lt.tr.y)),lt.texPrimary.x+lt.texPrimary.w,lt.texPrimary.y,ct,et,lt.pixelOffsetBR.x,lt.pixelOffsetTL.y,lt.minFontScaleX,lt.minFontScaleY),this.text.updateSymbolVertexData(Mt+2,Ut,Tt,Math.round(32*lt.bl.x),Math.round(32*(Bt+lt.bl.y)),lt.texPrimary.x,lt.texPrimary.y+lt.texPrimary.h,ct,et,lt.pixelOffsetTL.x,lt.pixelOffsetBR.y,lt.minFontScaleX,lt.minFontScaleY),this.text.updateSymbolVertexData(Mt+3,Ut,Tt,Math.round(32*lt.br.x),Math.round(32*(Bt+lt.br.y)),lt.texPrimary.x+lt.texPrimary.w,lt.texPrimary.y+lt.texPrimary.h,ct,et,lt.pixelOffsetBR.x,lt.pixelOffsetBR.y,lt.minFontScaleX,lt.minFontScaleY)}return{vertexOffsetDelta:t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices,hasChanges:!0}}if(r.isUsingAppearanceTextVertexData){const ue=r.layoutBasedTextVertexData.length/12;for(let le=0;le<ue;++le){const ge=le*12;this.text.updateSymbolVertexData(g+le,r.layoutBasedTextVertexData[ge+0],r.layoutBasedTextVertexData[ge+1],r.layoutBasedTextVertexData[ge+2],r.layoutBasedTextVertexData[ge+3],r.layoutBasedTextVertexData[ge+4],r.layoutBasedTextVertexData[ge+5],r.layoutBasedTextVertexData[ge+6],r.layoutBasedTextVertexData[ge+7],r.layoutBasedTextVertexData[ge+8],r.layoutBasedTextVertexData[ge+9],r.layoutBasedTextVertexData[ge+10],r.layoutBasedTextVertexData[ge+11])}return r.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:ue,hasChanges:!0}}return{vertexOffsetDelta:t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices,hasChanges:!1}}update(t,r,c,d,g,_,v){this.text.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,this.worldview)}updateRoadElevation(t){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let r=!1;const c=vt(t),d=1/c;let g=!1,_=!1;for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v),T=yt(1,0,0),M=yt(0,1,0),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:z,numIconVertices:D,numVerticalIconVertices:k}=S,$=A>0||z>0,H=D>0,j=this.elevationFeatures[S.elevationFeatureIndex];if(j){const X=new Ae(S.tileAnchorX,S.tileAnchorY),Y=.075+j.pointElevation(X);S.zOffset!==Y&&(r=!0,S.zOffset=Y),Y!==0&&(this.hasAnyZOffset=!0);const te=j.computeSlopeNormal(X,d),ue=Ys(Wi(),yt(0,0,1),te);ji(T,T,ue),ji(M,M,ue),T[2]*=c,M[2]*=c,T[0]===1&&T[1]===0&&T[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(g=g||$,_=_||H)}if($&&(Ix(this.text.orientationVertexArray,A,T,M),Ix(this.text.orientationVertexArray,z,T,M)),H){const{placedIconSymbolIndex:X,verticalPlacedIconSymbolIndex:Y}=S;X>=0&&Ix(this.icon.orientationVertexArray,D,T,M),Y>=0&&Ix(this.icon.orientationVertexArray,k,T,M)}}g||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),r&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const t=(g,_,v)=>{c+=_,c>g.length&&g.resize(c);for(let S=-_;S<0;S++)g.emplace(S+c,v)},r=(g,_,v)=>{d+=_,d>g.length&&g.resize(d);for(let S=-_;S<0;S++)g.emplace(S+d,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,d=0;for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:S,numIconVertices:T}=_,M=_.zOffset,A=T>0;if((v>0||S>0)&&(t(this.text.zOffsetVertexArray,v,M),t(this.text.zOffsetVertexArray,S,M)),A){const{placedIconSymbolIndex:z,verticalPlacedIconSymbolIndex:D}=_;z>=0&&r(this.icon.zOffsetVertexArray,T,M),D>=0&&r(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t,r,c,d,g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(_=>_.appearances&&_.appearances.length>0)),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(t,r,c,d,g){if(!(t&&r&&c&&this.appearanceFeatureData))return!1;const _=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,v=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!_&&!v)return!1;const S=this.layers[0],T=S.layout;let M=1,A=0,z=!1;if(_){const[j,X]=T.get("icon-size-scale-range");M=de(1,j,X)}let D=1,k=0,$=!1;if(v){const[j,X]=T.get("text-size-scale-range");D=de(1,j,X)}const H=new Map;if(g&&c)for(const j of c){const X=g.getImage(j,S.scope);if(X){const Y=new ns(j.toString());H.set(Y.toString(),X)}}for(let j=0;j<this.symbolInstances.length;j++){const X=this.symbolInstances.get(j),Y=this.featureToAppearanceIndex[X.featureIndex],te=Y!==void 0?this.appearanceFeatureData[Y]:void 0;if(!te)continue;const ue=te.id,le=r&&ue!==void 0?r[String(ue)]:void 0,ge={type:"Point",id:te.id,properties:te.properties,geometry:[]},ye=S.appearances&&S.appearances.find(me=>me.isActive({globals:d,feature:ge,canonical:t,featureState:le}));if(v){const me=T.get("text-size"),we=T.get("text-offset").evaluate(ge,le,t),Ie=me.evaluate(ge,le,t),Je=T.get("text-rotate").evaluate(ge,le,t),qe=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,Xe=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,at=me.evaluate(ge,{zoom:qe},t),nt=me.evaluate(ge,{zoom:Xe},t),ot=this.updateSymbolInstanceTextVertices(X,te,ye,ge,k,t,S,D,H,le,we,Ie,Je,at,nt,qe,Xe,c);k+=ot.vertexOffsetDelta,$=$||ot.hasChanges}if(_){const me=T.get("icon-offset").evaluate(ge,le,t),we=T.get("icon-size").evaluate(ge,le,t,c),Ie=T.get("icon-rotate").evaluate(ge,le,t),Je=this.updateSymbolInstanceIconVertices(X,te,ye,ge,A,t,c,d,S,M,le,me,we,Ie);A+=Je.vertexOffsetDelta,z=z||Je.hasChanges}te.activeAppearance=ye}return z&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),$&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),z||$}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=xP(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:d,y:g}of r)this.lineVertexArray.emplaceBack(d,g);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,X){const Y=t.indexArray,te=t.layoutVertexArray,ue=t.globeExtVertexArray,le=t.segments.prepareSegment(4*X,te,Y,this.canOverlap?_.sortKey:void 0),ge=this.glyphOffsetArray.length,ye=le.vertexLength,me=this.allowVerticalPlacement&&v===Vs.vertical?Math.PI/2:0,we=_.text&&_.text.sections;for(let qe=0;qe<r.length;qe++){const{tl:Xe,tr:at,bl:nt,br:ot,texPrimary:Ge,texSecondary:ct,pixelOffsetTL:et,pixelOffsetBR:ut,minFontScaleX:lt,minFontScaleY:Bt,glyphOffset:Ut,isSDF:Tt,sectionIndex:Mt}=r[qe],li=le.vertexLength,Yt=Ut[1];if(Og(te,T.x,T.y,Xe.x,Yt+Xe.y,Ge.x,Ge.y,c,Tt,et.x,et.y,lt,Bt),Og(te,T.x,T.y,at.x,Yt+at.y,Ge.x+Ge.w,Ge.y,c,Tt,ut.x,et.y,lt,Bt),Og(te,T.x,T.y,nt.x,Yt+nt.y,Ge.x,Ge.y+Ge.h,c,Tt,et.x,ut.y,lt,Bt),Og(te,T.x,T.y,ot.x,Yt+ot.y,Ge.x+Ge.w,Ge.y+Ge.h,c,Tt,ut.x,ut.y,lt,Bt),S){const{x:Ct,y:bi,z:qi}=S.anchor,[pn,Hi,Pn]=S.up;Bg(ue,Ct,bi,qi,pn,Hi,Pn),Bg(ue,Ct,bi,qi,pn,Hi,Pn),Bg(ue,Ct,bi,qi,pn,Hi,Pn),Bg(ue,Ct,bi,qi,pn,Hi,Pn),zf(t.dynamicLayoutVertexArray,Ct,bi,qi,me)}else zf(t.dynamicLayoutVertexArray,T.x,T.y,T.z,me);if(H){const Ct=ct||Ge;Fg(t.iconTransitioningVertexArray,Ct.x,Ct.y),Fg(t.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y),Fg(t.iconTransitioningVertexArray,Ct.x,Ct.y+Ct.h),Fg(t.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y+Ct.h)}Y.emplaceBack(li,li+1,li+2),Y.emplaceBack(li+1,li+2,li+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),qe!==r.length-1&&Mt===r[qe+1].sectionIndex||t.programConfigurations.populatePaintArrays(te.length,_,_.index,{},D,k,$,we&&we[Mt],this.worldview)}const Ie=X-r.length;Ie!==0&&this._addNullVertices(Ie,te,c,S,ue,t,H,le,Y);const Je=S?S.anchor:T;t.placedSymbolArray.emplaceBack(Je.x,Je.y,Je.z,T.x,T.y,ge,this.glyphOffsetArray.length-ge,ye,M,A,T.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],v,0,0,0,z,0),t.symbolInstanceIndices.push(j)}_addNullVertices(t,r,c,d,g,_,v,S,T){for(let M=0;M<t;M++){for(let z=0;z<4;z++)Og(r,0,0,0,0,0,0,c,!1,0,0,0,0),d&&Bg(g,0,0,0,0,0,0),zf(_.dynamicLayoutVertexArray,0,0,0,0),v&&Fg(_.iconTransitioningVertexArray,0,0);const A=S.vertexLength;T.emplaceBack(A,A+1,A+2),T.emplaceBack(A+1,A+2,A+3),S.vertexLength+=4,S.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(t,r,c,d,g,_,v){t.emplaceBack(r,c,d,g,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(t,r,c,d,g,_,v){const S=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),T=S.vertexLength,M=v.tileAnchorX,A=v.tileAnchorY;for(let D=0;D<4;D++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,r,t.padding,v.zOffset),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,M,A,new Ae(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,M,A,new Ae(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,M,A,new Ae(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,M,A,new Ae(t.x1,t.y2)),S.vertexLength+=4;const z=c.indexArray;z.emplaceBack(T,T+1),z.emplaceBack(T+1,T+2),z.emplaceBack(T+2,T+3),z.emplaceBack(T+3,T),S.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,c,d,g,_){for(let v=d;v<g;v++){const S=c.get(v),T=this.getSymbolInstanceTextSize(t,_,r,v);this._addCollisionDebugVertices(S,T,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(t,r,c,d,g,_){for(let v=d;v<g;v++){const S=c.get(v),T=this.getSymbolInstanceIconSize(t,r,_.placedIconSymbolIndex);this._addCollisionDebugVertices(S,T,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}generateCollisionDebugBuffers(t,r,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new X1(sf,kA.members,Os),this.iconCollisionBox=new X1(sf,kA.members,Os);const d=If(this.iconSizeData,t),g=If(this.textSizeData,t,c);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(g,t,r,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(g,t,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,t,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,t,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(t,r,c,d){const g=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:d),_=N1(this.textSizeData,t,g)/so;return this.tilePixelRatio*_}getSymbolInstanceIconSize(t,r,c){const d=this.icon.placedSymbolArray.get(c),g=N1(this.iconSizeData,t,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(t,r,c,d){t.emplaceBack(r,-c,-c,d),t.emplaceBack(r,c,-c,d),t.emplaceBack(r,c,c,d),t.emplaceBack(r,-c,c,d)}_updateTextDebugCollisionBoxes(t,r,c,d,g,_,v){for(let S=d;S<g;S++){const T=c.get(S),M=this.getSymbolInstanceTextSize(t,_,r,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,T.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(t,r,c,d,g,_,v){for(let S=d;S<g;S++){const T=c.get(S),M=this.getSymbolInstanceIconSize(t,r,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,T.padding,_.zOffset)}}updateCollisionDebugBuffers(t,r,c,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=If(this.iconSizeData,t,d),_=If(this.textSizeData,t,c);for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(_,t,r,S.textBoxStartIndex,S.textBoxEndIndex,S,c),this._updateTextDebugCollisionBoxes(_,t,r,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,c),this._updateIconDebugCollisionBoxes(g,t,r,S.iconBoxStartIndex,S.iconBoxEndIndex,S,d),this._updateIconDebugCollisionBoxes(g,t,r,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,c,d,g,_,v,S,T){const M={};if(r<c){const{x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:te,featureIndex:ue}=t.get(r);M.textBox={x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:te},M.textFeatureIndex=ue}if(d<g){const{x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:te,featureIndex:ue}=t.get(d);M.verticalTextBox={x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:te},M.verticalTextFeatureIndex=ue}if(_<v){const{x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:te,featureIndex:ue}=t.get(_);M.iconBox={x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:te},M.iconFeatureIndex=ue}if(S<T){const{x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:te,featureIndex:ue}=t.get(S);M.verticalIconBox={x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:te},M.verticalIconFeatureIndex=ue}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const c=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,r){const c=t.placedSymbolArray.get(r),d=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<d;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),c=Math.cos(t),d=[],g=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const S=this.symbolInstances.get(v);d.push(0|Math.round(r*S.tileAnchorX+c*S.tileAnchorY)),g.push(S.featureIndex)}return _.sort((v,S)=>d[v]-d[S]||g[S]-g[v]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,r){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===r?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const c=this.symbolInstances.get(r);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:T}=c;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),_>=0&&_!==g&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(t){const r=this.symbolInstances.get(this.text.symbolInstanceIndices[t]).elevationFeatureIndex;let c;return this.elevationFeatures&&r<this.elevationFeatures.length&&(c=this.elevationFeatures[r]),c}}function bP(a,t){return t.replace(/{([^{}]+)}/g,(r,c)=>c in a?String(a[c]):"")}let wP,SP,J1;jt(Mx,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Mx.addDynamicAttributes=zf;class TP{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:is,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jt(TP,"FormatSectionOverride",{omit:["defaultValue"]});const Y1=()=>J1||(J1={layout:wP||(wP=new ur({"symbol-placement":new bt(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(ke.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new bt(ke.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new bt(ke.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new bt(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bt(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(ke.layout_symbol["icon-size"]),"icon-size-scale-range":new bt(ke.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new zt(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(ke.layout_symbol["icon-image"]),"icon-image-use-theme":new bt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new zt(ke.layout_symbol["icon-rotate"]),"icon-padding":new bt(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(ke.layout_symbol["icon-offset"]),"icon-anchor":new zt(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(ke.layout_symbol["text-rotation-alignment"]),"text-field":new zt(ke.layout_symbol["text-field"]),"text-font":new zt(ke.layout_symbol["text-font"]),"text-size":new zt(ke.layout_symbol["text-size"]),"text-size-scale-range":new bt(ke.layout_symbol["text-size-scale-range"]),"text-max-width":new zt(ke.layout_symbol["text-max-width"]),"text-line-height":new zt(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(ke.layout_symbol["text-letter-spacing"]),"text-justify":new zt(ke.layout_symbol["text-justify"]),"text-radial-offset":new zt(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new zt(ke.layout_symbol["text-anchor"]),"text-max-angle":new bt(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(ke.layout_symbol["text-writing-mode"]),"text-rotate":new zt(ke.layout_symbol["text-rotate"]),"text-padding":new bt(ke.layout_symbol["text-padding"]),"text-keep-upright":new bt(ke.layout_symbol["text-keep-upright"]),"text-transform":new zt(ke.layout_symbol["text-transform"]),"text-offset":new zt(ke.layout_symbol["text-offset"]),"text-allow-overlap":new bt(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bt(ke.layout_symbol["text-ignore-placement"]),"text-optional":new bt(ke.layout_symbol["text-optional"]),visibility:new bt(ke.layout_symbol.visibility)})),paint:SP||(SP=new ur({"icon-opacity":new zt(ke.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new zt(ke.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new zt(ke.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new zt(ke.paint_symbol["text-emissive-strength"]),"icon-color":new zt(ke.paint_symbol["icon-color"]),"icon-halo-color":new zt(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(ke.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new bt(ke.paint_symbol["icon-image-cross-fade"]),"text-opacity":new zt(ke.paint_symbol["text-opacity"]),"text-occlusion-opacity":new zt(ke.paint_symbol["text-occlusion-opacity"]),"text-color":new zt(ke.paint_symbol["text-color"],{runtimeType:No,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new zt(ke.paint_symbol["text-halo-color"]),"text-halo-width":new zt(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(ke.paint_symbol["text-halo-blur"]),"text-translate":new bt(ke.paint_symbol["text-translate"]),"text-translate-anchor":new bt(ke.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new bt(ke.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new bt(ke.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new bt(ke.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new bt(ke.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new zt(ke.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},J1);class Ax extends Vo{constructor(t,r,c,d){super(t,Y1(),r,c,d,t.layout?t.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=fe([]),this.hasOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}_handleSpecialPaintPropertyUpdate(t){t!=="icon-occlusion-opacity"&&t!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(t,r){super.recalculate(t,r),this.appearances&&this.appearances.forEach(d=>{d.recalculate(t,r,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const g of c)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,r,c,d){return this._saturation===t&&this._contrast===r&&this._brightnessMin===c&&this._brightnessMax===d||(this._colorAdjustmentMatrix=(function(g,_,v,S){g=To(g),_=gr(_);const T=ee(),M=g/3,A=1-2*M,z=[A,M,M,0,M,A,M,0,M,M,A,0,0,0,0,1],D=.5-.5*_,k=S-v;return ie(T,[k,0,0,0,0,k,0,0,0,0,k,0,v,v,v,1],[_,0,0,0,0,_,0,0,0,0,_,0,D,D,D,1]),ie(T,T,z),T})(t,r,c,d),this._saturation=t,this._contrast=r,this._brightnessMin=c,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,r,c,d){const g=this.layout.get(t).evaluate(r,{},c,d),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||bh(_.value)||!g?g:bP(r.properties,g)}getAppearanceValueAndResolveTokens(t,r,c,d,g){const _=t.getProperty(r);if(!_)return;const v=_.evaluate(c,{},d,g),S=t.getUnevaluatedProperties()._values[r];return S.isDataDriven()||bh(S.value)||!v||typeof v!="string"?v:bP(c.properties,v)}createBucket(t){return new Mx(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Y1().paint.overridableProperties){if(!Ax.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),c=new TP(r),d=new qd(c,r.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new wh("source",d):new vc("composite",d,r.value.zoomStops,r.value.interpolationType),this.paint._values[t]=new bc(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,c){return!(!this.layout||r.isDataDriven()||c.isDataDriven())&&Ax.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const c=t.get("text-field"),d=Y1().paint.properties[r];let g=!1;const _=v=>{for(const S of v)if(d.overrides&&d.overrides.hasOverride(S))return void(g=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Lo)_(c.value.value.sections);else if(c.value.kind==="source"){const v=T=>{g||(T instanceof ll&&Yr(T.value)===qc?_(T.value.sections):T instanceof Qt?_(T.sections):T.eachChild(v))},S=c.value;S._styleExpression&&v(S._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,r,c){return{config:new L(this,{zoom:r,lut:c}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let EP,IP,MP,AP;var K1=Ki([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Px(a,t,r,c,d,g,_,v){const S=[a,t,1,r,c,1,d,g,1],T=[_,v,1],M=V([],S),[A,z,D]=hi(T,T,M);return q(S,S,[A,0,0,0,z,0,0,0,D])}function PP(a,t,r,c,d,g,_,v){const S=(function(T,M,A,z,D,k,$,H){const j=Px(0,0,1,0,1,1,0,1),X=Px(T,M,A,z,D,k,$,H);return q(X,X,V([],j))})(a,t,r,c,d,g,_,v);return[S[2]/S[8]/It,S[5]/S[8]/It]}function zx(a){return[a[0],Math.min(Math.max(a[1],-85.051129),Te)]}class zP extends al{constructor(t,r,c,d){super(),this.id=t,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=r,this._dirty=!1}load(t,r){if(this._loaded=r||!1,this.fire(new sl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=yd(this.map._requestManager.transformRequest(this.url,es.Image),(c,d)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new oh(c)):d&&(this.image=d instanceof HTMLImageElement?Cs.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Sg(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new sl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Sg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=t[0][1],c=t[0][1];for(const g of t)g[1]>c&&(c=g[1]),g[1]<r&&(r=g[1]);const d=(c+r)/2;if(d>Te?this.onNorthPole=!0:d<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=t.map(Pt.fromLngLat);this.tileID=(function(_){let v=1/0,S=1/0,T=-1/0,M=-1/0;for(const $ of _)v=Math.min(v,$.x),S=Math.min(S,$.y),T=Math.max(T,$.x),M=Math.max(M,$.y);const A=Math.max(T-v,M-S),z=Math.max(0,Math.floor(-Math.log2(A))),D=Math.pow(2,z);let k=Math.floor((v+T)/2*D);return k>1&&(k-=1),new Uh(z,k,Math.floor((S+M)/2*D))})(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new sl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Sg||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const j in this.tiles){const X=this.tiles[j];X.state!=="loaded"&&(X.state="loaded",X.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Cg(new Uh(0,0,0),this.map.transform.projection),c=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(j){const X=j[1].x-j[0].x,Y=j[1].y-j[0].y,te=j[2].x-j[1].x,ue=j[2].y-j[1].y,le=j[3].x-j[2].x,ge=j[3].y-j[2].y,ye=j[0].x-j[3].x,me=j[0].y-j[3].y,we=X*ue-te*Y,Ie=te*ge-le*ue,Je=le*me-ye*ge,qe=ye*Y-X*me;return we>0&&Ie>0&&Je>0&&qe>0||we<0&&Ie<0&&Je<0&&qe<0})(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=Cg(this.tileID,this.map.transform.projection),[g,_,v,S]=this.coordinates.map(j=>{const X=d.projection.project(j[0],j[1]);return mP(d,X)._round()});this.perspectiveTransform=PP(g.x,g.y,_.x,_.y,v.x,v.y,S.x,S.y);const T=this._boundsArray=new fl;T.emplaceBack(g.x,g.y,0,0),T.emplaceBack(_.x,_.y,It,0),T.emplaceBack(S.x,S.y,0,It),T.emplaceBack(v.x,v.y,It,It),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(T,K1.members),this.boundsSegments=er.simpleSegment(0,0,4,2);const M=[],A=[zx((z=this.coordinates)[0]),zx(z[1]),zx(z[2]),zx(z[3])];var z;const[D,k,$,H]=(function(j){let X=j[0][0],Y=X,te=j[0][1],ue=te;for(let le=1;le<j.length;le++)j[le][0]<X?X=j[le][0]:j[le][0]>Y&&(Y=j[le][0]),j[le][1]<te?te=j[le][1]:j[le][1]>ue&&(ue=j[le][1]);return[X,te,Y-X,ue-te]})(A);{const j=new fl,[X,Y,te,ue]=(function(ot){let Ge=ot[0].x,ct=Ge,et=ot[0].y,ut=et;for(let lt=1;lt<ot.length;lt++)ot[lt].x<Ge?Ge=ot[lt].x:ot[lt].x>ct&&(ct=ot[lt].x),ot[lt].y<et?et=ot[lt].y:ot[lt].y>ut&&(ut=ot[lt].y);return[Ge,et,ct-Ge,ut-et]})(c),le=ot=>[(ot.x-X)/te,(ot.y-Y)/ue],[ge,ye,me,we]=c.map(le),Ie=(function(ot,Ge,ct,et,ut,lt,Bt,Ut){const Tt=Px(0,0,1,0,1,1,0,1);return q(Tt,Tt,V([],Px(ot,Ge,ct,et,ut,lt,Bt,Ut)))})(ge[0],ge[1],ye[0],ye[1],me[0],me[1],we[0],we[1]);this.elevatedGlobePerspectiveTransform=PP(ge[0],ge[1],ye[0],ye[1],me[0],me[1],we[0],we[1]);const Je=(ot,Ge)=>{M.push(ot.lng);const ct=Math.round((ot.lng-D)/$*It),et=Math.round((ot.lat-k)/H*It),ut=le(Ge),lt=hi([],[ut[0],ut[1],1],Ie),Bt=Math.round(lt[0]/lt[2]*It),Ut=Math.round(lt[1]/lt[2]*It);j.emplaceBack(ct,et,Bt,Ut)},qe=c[3].x-c[0].x,Xe=c[3].y-c[0].y,at=c[2].x-c[1].x,nt=c[2].y-c[1].y;for(let ot=0;ot<65;ot++){const Ge=ot/64,ct=[c[0].x+Ge*qe,c[0].y+Ge*Xe],et=[c[1].x+Ge*at,c[1].y+Ge*nt],ut=et[0]-ct[0],lt=et[1]-ct[1];for(let Bt=0;Bt<65;Bt++){const Ut=Bt/64,Tt={x:ct[0]+ut*Ut,y:ct[1]+lt*Ut};Je(r.projection.unproject(Tt.x,Tt.y),Tt)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(j,K1.members)}{this.maxLongitudeTriangleSize=0;let j=[],X=new Hr;const Y=(te,ue,le)=>{X.emplaceBack(te,ue,le);const ge=M[te],ye=M[ue],me=M[le],we=Math.min(Math.min(ge,ye),me),Ie=Math.max(Math.max(ge,ye),me)-we;Ie>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ie),j.push(we+Ie/2)};for(let te=0;te<64;te++)for(let ue=0;ue<64;ue++){const le=65*te+ue,ge=le+1,ye=le+65,me=ye+1;Y(le,ye,ge),Y(ge,ye,me)}[j,X]=(function(te,ue){const le=Array.from({length:te.length},(me,we)=>we);le.sort((me,we)=>te[me]-te[we]);const ge=[],ye=new Hr;for(let me=0;me<le.length;me++){const we=le[me];ge.push(te[we]);const Ie=3*we,Je=Ie+1;ye.emplaceBack(ue.uint16[Ie],ue.uint16[Je],ue.uint16[Je+1])}return[ge,ye]})(j,X),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(X)}this.elevatedGlobeSegments=er.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,$/It,0,H/It,0,0,k,D,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const r=this.map.painter.context,c=r.gl;!this._dirty||this.texture instanceof Sg||(this.texture?this.texture.update(this.image):(this.texture=new w1(r,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(r)}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let d=(g=t+180)+360*Math.round((c[0]-g)/360);var g;const _=new er,v=(A,z)=>{_.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:r.segments[0].vertexLength,primitiveLength:z,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-d)<=S){const A=On(c,0,c.length,d+S);return A===c.length||v(A,kn(c,A+1,c.length,d+360-S)-A),_}d<c[0]&&(d+=360);const T=kn(c,0,c.length,d-S);if(T===c.length)return v(0,c.length),_;v(0,T-0);const M=On(c,T+1,c.length,d+S);return M!==c.length&&v(M,c.length-M),_}}const Q1=1024,C5=(Math.pow(Q1,2)-1)/268170240;class CP extends Vo{constructor(t,r,c,d){super(t,{layout:MP||(MP=new ur({visibility:new bt(ke.layout_raster.visibility)})),paint:AP||(AP=new ur({"raster-opacity":new bt(ke.paint_raster["raster-opacity"]),"raster-color":new hu(ke.paint_raster["raster-color"]),"raster-color-mix":new bt(ke.paint_raster["raster-color-mix"]),"raster-color-range":new bt(ke.paint_raster["raster-color-range"]),"raster-hue-rotate":new bt(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(ke.paint_raster["raster-saturation"]),"raster-contrast":new bt(ke.paint_raster["raster-contrast"]),"raster-resampling":new bt(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(ke.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new bt(ke.paint_raster["raster-emissive-strength"]),"raster-array-band":new bt(ke.paint_raster["raster-array-band"]),"raster-elevation":new bt(ke.paint_raster["raster-elevation"]),"raster-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof zP&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[c,d]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(d)||c===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=sg({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:d}],resolution:Q1}),this.colorRampTexture=null,this._curRampRange=[c,d])}is3D(t){return this.paint.get("raster-elevation")>0}}let LP,RP,DP,kP,OP;class FP extends Vo{constructor(t,r,c,d){super(t,{layout:LP||(LP=new ur({visibility:new bt(ke["layout_raster-particle"].visibility)})),paint:RP||(RP=new ur({"raster-particle-array-band":new bt(ke["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new bt(ke["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new hu(ke["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new bt(ke["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new bt(ke["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new bt(ke["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new bt(ke["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new bt(ke["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d),this._updateColorRamp(),this.lastInvalidatedAt=Cs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=sg({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Cs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class L5 extends Vo{constructor(t,r){super(t,{},r,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(t){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function eS(a,t,r){const c=[0,0,1],d=Xi([]);return Ji(d,d,r?-ii(a)+Math.PI:ii(a)),Vi(d,d,-ii(t)),ji(c,c,d),Di(c,c)}const BP={None:0,Model:1,Symbol:2,FillExtrusion:4};class Cx{constructor(t,r,c,d){this.message=(t?`${t}: `:"")+c,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)}}function tS(a,t){const r=a.indexOf("://")===-1;try{return new URL(a,r&&t?"http://example.com":void 0),!0}catch{return!1}}class NP{constructor(t,r){this.feature=t,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class UP{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new tg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(t){const r=16*t,c=this.instancedDataArray.float32;let d=Math.floor(c[r+2]);const g=1.05*(c[r+2]-d);return d/=100,[c[r]%1*1.05,c[r+1]%1*1.05,g,d]}tileCoordinatesForInstance(t){const r=16*t,c=this.instancedDataArray.float32;let d=c[r+0];return d=d>It?d-It:d,new Ae(Math.trunc(d),Math.trunc(c[r+1]))}translationForInstance(t){const r=16*t,c=this.instancedDataArray.float32;return[c[r+4],c[r+5],c[r+6]]}rotationScaleForInstance(t){const r=16*t,c=this.instancedDataArray.float32;return[c[r+7],c[r+8],c[r+9],c[r+10],c[r+11],c[r+12],c[r+13],c[r+14],c[r+15]]}transformForInstance(t){const r=16*t,c=this.instancedDataArray.float32;return[c[r+7],c[r+8],c[r+9],c[r+4],c[r+10],c[r+11],c[r+12],c[r+5],c[r+13],c[r+14],c[r+15],c[r+6],0,0,0,1]}}class iS{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaledZ=this.canonical.z+Math.log2(t.overscaling),this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=t.projection,this.index=t.index,this.worldview=t.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=t.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){this.tileToMeter=vt(c);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);const _=this.layers[0].paint.get("model-elevation-reference")==="hd-road-markup"?r.elevationFeatures:void 0;for(const{feature:v,id:S,index:T,sourceLayerIndex:M}of t){const A=S??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),z=Ni(v,g);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),z,c))continue;const D={id:A,sourceLayerIndex:M,index:T,geometry:g?z.geometry:pi(v,c,d),properties:v.properties,type:v.type,patterns:{}},k=this.addFeature(D,D.geometry,z,_,c);k&&r.featureIndex.insert(v,D.geometry,T,M,this.index,this.instancesPerModel[k].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const t=this.layers[0].modelManager,r=this.layers[0].scope;let c=0;for(const d of this.modelUris){const g=t.getModel(d,r);if(!g)continue;const _=this.instancesPerModel[d];if(_){const v=.5*Un(g.aabb.max,g.aabb.min)*_.maxScale+_.maxXYTranslationDistance,S=Math.min(It,Math.max(v/this.tileToMeter,256));c=Math.max(S,c)}}return c}update(t,r,c,d){for(const g in this.instancesPerModel){const _=this.instancesPerModel[g];for(const v in t)_.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(_.features[_.idToFeaturesIndex[v]],t[v],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const c=this.instancesPerModel[r];for(const d of c.features){const g=this.layers[0],_=d.feature,v=this.canonical,S=g.paint.get("model-rotation").evaluate(_,{},v),T=g.paint.get("model-scale").evaluate(_,{},v),M=g.paint.get("model-translation").evaluate(_,{},v);Ve(d.rotation,S)&&Ve(d.scale,T)&&Ve(d.translation,M)||(this.evaluate(d,d.featureStates,c,!0),t=!0)}}return t}updateReplacement(t,r,c,d){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const g=r.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(tx(this.activeReplacements,g))return!1;this.activeReplacements=g;let _=!1;for(const v in this.instancesPerModel){const S=this.instancesPerModel[v],T=S.instancedDataArray;for(const M of S.features){const A=M.instancedDataOffset,z=M.instancedDataCount;for(let D=0;D<z;D++){const k=16*(D+A);let $=T.float32[k+0];const H=$>It;$=H?$-It:$;const j=Math.floor($),X=Math.floor(T.float32[k+1]);let Y=!1;for(const te of this.activeReplacements)if(!vM(te,c,BP.Model,d)&&!(te.min.x>j||j>te.max.x||te.min.y>X||X>te.max.y)&&(Y=TM(SM(j,X,t.canonical,te.footprintTileId.canonical),te.footprint),Y))break;T.float32[k]=Y?$+It:$,_=_||Y!==H}}}return _}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const r in this.instancesPerModel){const c=this.instancesPerModel[r];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=t.createVertexBuffer(c.instancedDataArray,eU.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(t){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(t&&r&&this.modelUris&&this.modelsRequested)for(const c of this.modelUris)r.removeModel(c,"",!0)}addFeature(t,r,c,d,g){const _=this.layers[0],v=_.layout.get("model-id"),S=_.layout.get("model-allow-density-reduction"),T=v.evaluate(c,{},this.canonical);if(!T)return vi(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),T;(tS(T,!1)||this.styleDefinedModelURLs[T]!==void 0)&&(this.modelUris.includes(T)||this.modelUris.push(T)),this.instancesPerModel[T]||(this.instancesPerModel[T]=new UP);const M=this.instancesPerModel[T],A=M.instancedDataArray,z=new NP(c,A.length);let D;d&&(D=Go.getElevationFeature(t,d));for(const k of r)for(const $ of k){if($.x<0||$.x>=It||$.y<0||$.y>=It)continue;if(this.lookupDim!==0&&S){const j=(this.lookupDim-1)/It,X=this.lookupDim*($.y*j|0)+$.x*j|0;if(this.lookup){if(this.lookup[X]!==0)continue;this.lookup[X]=1}}this.instanceCount++;const H=A.length;if(A.resize(H+1),d){M.instancesRoadElevation||(M.instancesRoadElevation=[]);const j=D?D.pointElevation(new Ae($.x,$.y)):0;M.instancesRoadElevation.push(j)}M.instancesEvaluatedElevation.push(0),A.float32[16*H]=$.x,A.float32[16*H+1]=$.y}return z.instancedDataCount=M.instancedDataArray.length-z.instancedDataOffset,z.instancedDataCount>0&&(t.id&&(M.idToFeaturesIndex[t.id]=M.features.length),M.features.push(z),this.evaluate(z,{},M,!1)),T}getModelUris(){return this.modelUris}evaluate(t,r,c,d){const g=this.layers[0],_=t.feature,v=this.canonical,S=t.rotation=g.paint.get("model-rotation").evaluate(_,r,v),T=t.scale=g.paint.get("model-scale").evaluate(_,r,v),M=t.translation=g.paint.get("model-translation").evaluate(_,r,v),A=Object.assign({},g.paint.get("model-color").evaluate(_,r,v));A.a=g.paint.get("model-color-mix-intensity").evaluate(_,r,v);const z=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]);const D=M[0]*M[0]+M[1]*M[1],k=D>0?Math.sqrt(D):0;c.maxScale=Math.max(Math.max(c.maxScale,T[0]),Math.max(T[1],T[2])),c.maxXYTranslationDistance=Math.max(c.maxXYTranslationDistance,k),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),pA(z,S,T);const $=Math.round(100*A.a)+A.b/1.05;for(let H=0;H<t.instancedDataCount;++H){const j=t.instancedDataOffset+H,X=16*j,Y=c.instancedDataArray.float32;let te=0;d&&(te=Y[X+6]-c.instancesEvaluatedElevation[j]);const ue=0|Y[X+1];Y[X]=(0|Y[X])+A.r/1.05,Y[X+1]=ue+A.g/1.05,Y[X+2]=$,Y[X+3]=1/(v.z>10?this.tileToMeter:vt(v,ue)),Y[X+4]=M[0],Y[X+5]=M[1],Y[X+6]=M[2]+(c.instancesRoadElevation?c.instancesRoadElevation[j]:0)+te,Y[X+7]=z[0],Y[X+8]=z[1],Y[X+9]=z[2],Y[X+10]=z[4],Y[X+11]=z[5],Y[X+12]=z[6],Y[X+13]=z[8],Y[X+14]=z[9],Y[X+15]=z[10],c.instancesEvaluatedElevation[j]=M[2]}}}let $P,VP;jt(iS,"ModelBucket",{omit:["layers"]}),jt(UP,"PerModelAttributes"),jt(NP,"ModelFeature");class Cf{constructor(t,r,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=c}static create(t,r,c){const d=c||t.findDEMTileFor(r);if(!d||!d.dem)return;const g=d.dem,_=d.tileID,v=1<<r.canonical.z-_.canonical.z;return new Cf(d,g.dim/It/v,[(r.canonical.x/v-_.canonical.x)*g.dim,(r.canonical.y/v-_.canonical.y)*g.dim])}tileCoordToPixel(t,r){const c=r*this._scale+this._offset[1];return new Ae(Math.floor(t*this._scale+this._offset[0]),Math.floor(c))}getElevationAt(t,r,c,d){const g=t*this._scale+this._offset[0],_=r*this._scale+this._offset[1],v=Math.floor(g),S=Math.floor(_),T=this._dem;return d=!!d,c?di(di(T.get(v,S,d),T.get(v,S+1,d),_-S),di(T.get(v+1,S,d),T.get(v+1,S+1,d),_-S),g-v):T.get(v,S,d)}getElevationAtPixel(t,r,c){return this._dem.get(t,r,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*je(1,t)*this._dem.stride}}const nS=new Float32Array(262144),qh=new Uint8Array(262144);function jP(a){let t=0;if(a.meshes)for(const r of a.meshes)t=Math.max(t,r.aabb.max[2]);if(a.children)for(const r of a.children)t=Math.max(t,jP(r));return t}function GP(a,t,r){if(a.meshes)for(const c of a.meshes){if(c.aabb.min[0]===1/0)continue;const d=yn.applyTransform(c.aabb,a.globalMatrix);r.insert(t,d.min[0],d.min[1],d.max[0],d.max[1])}if(a.children)for(const c of a.children)GP(c,t,r)}const HP=["","wall","door","roof","window","lamp","logo"];class ZP{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:jP(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const r=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==t&&(c.transformedAabb=yn.applyTransformFast(c.aabb,this.node.globalMatrix),r.encapsulate(c.transformedAabb)),t++;this.aabb=r}return this.aabb}}class Lx{constructor(t,r,c,d,g,_,v,S){this.id=c,this.layers=t,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Sf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=Sf.HasMapboxMeshFeatures),g&&(this.modelTraits|=Sf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=S,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of r)this.nodesInfo.push(new ZP(T)),GP(T,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(t,r){for(const c of this.getNodesInfo()){const d=c.node;d.footprint&&r.push({footprint:d.footprint,id:t})}}updateAppearances(t,r,c,d){}update(t){const r=Object.keys(t).length!==0;if(r&&!this.stateDependentLayers.length)return;const c=r?this.stateDependentLayers:this.layers;if(!Ot(t,this.states))for(const d of c)this.evaluate(d,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const c of r){const d=c.node;this.uploaded?this.updatePbrBuffer(d):E1(d,t,!0)}for(const c of r)fx(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let r=!1;if(!t.meshes)return r;for(const c of t.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),r=!0);return r}needsReEvaluation(t,r,c){const d=t.transform.projectionOptions,g=t.style.getBrightness(),_=this.brightness!==g;if(!this.uploaded||this.dirty||d.name!==this.projection.name||Ng(c.paint.get("model-color").value,_)||Ng(c.paint.get("model-color-mix-intensity").value,_)||Ng(c.paint.get("model-roughness").value,_)||Ng(c.paint.get("model-emissive-strength").value,_)||Ng(c.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=d,this.brightness=g;const v=this.getNodesInfo();for(const S of v)S.state=null;return!0}return!1}evaluateTransform(t,r){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const c=this.getNodesInfo(),d=this.id.canonical;for(const g of c){const _=g.feature;g.evaluatedTranslation=r.paint.get("model-translation").evaluate(_,{},d),g.evaluatedScale=r.paint.get("model-scale").evaluate(_,{},d)}}evaluate(t,r){const c=this.getNodesInfo();for(const d of c){if(!d.node.meshes)continue;const g=d.feature,_=r&&r[g.id];if(Ot(_,d.state))continue;d.state=structuredClone(_);const v=d.node.meshes&&d.node.meshes[0].featureData,S=d.evaluatedColor[2],T=d.evaluatedRMEA[2],M=this.id.canonical;if(d.hasTranslucentParts=!1,v){for(let A=0;A<HP.length;A++){const z=HP[A];z.length&&(g.properties.part=z);const D=t.paint.get("model-color").evaluate(g,_,M).toPremultipliedRenderColor(null),k=t.paint.get("model-color-mix-intensity").evaluate(g,_,M);d.evaluatedColor[A]=[D.r,D.g,D.b,k],d.evaluatedRMEA[A][0]=t.paint.get("model-roughness").evaluate(g,_,M),d.evaluatedRMEA[A][2]=t.paint.get("model-emissive-strength").evaluate(g,_,M),d.evaluatedRMEA[A][3]=D.a,d.emissionHeightBasedParams[A]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,_,M),!d.hasTranslucentParts&&D.a<1&&(d.hasTranslucentParts=!0)}delete g.properties.part,D5(d,S!==d.evaluatedColor[2]||T!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(g,_,M);d.evaluatedTranslation=t.paint.get("model-translation").evaluate(g,_,M),d.evaluatedScale=t.paint.get("model-scale").evaluate(g,_,M),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,r,c,d){const g=t.findDEMTileFor(c);if(g&&(g.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const _=Cf.create(t,c,g);if(!_)return;this.modelTraits&Sf.HasMapboxMeshFeatures&&this.updateDEM(t,_,c,d);for(const v of this.getNodesInfo()){const S=v.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const T=S.footprint.vertices;let M=_.getElevationAt(T[0].x,T[0].y,!0,!0);for(let A=1;A<T.length;A++)M=Math.min(M,_.getElevationAt(T[A].x,T[A].y,!0,!0));S.elevation=M}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=r}}updateDEM(t,r,c,d){let g=r._dem._modifiedForSources[d];if(g===void 0&&(r._dem._modifiedForSources[d]=[],g=r._dem._modifiedForSources[d]),g.includes(c.canonical))return;const _=r._dem.dim;g.push(c.canonical);let v=!1;for(const S of this.getNodesInfo()){const T=S.node;if(!T.footprint||!T.footprint.grid)continue;const M=T.footprint.grid,A=r.tileCoordToPixel(M.min.x,M.min.y),z=r.tileCoordToPixel(M.max.x,M.max.y),D=Math.min(Math.min(_-z.y,A.x),Math.min(A.y,_-z.x));if(D<0)continue;const k=de(D,2,5);let $=Math.max(0,A.x-k),H=Math.max(0,A.y-k),j=Math.min(z.x+k,_-1),X=Math.min(z.y+k,_-1);for(let le=H;le<=X;++le)for(let ge=$;ge<=j;++ge)qh[le*_+ge]=255;let Y=0,te=0;for(let le=0;le<M.cellsY;++le)for(let ge=0;ge<M.cellsX;++ge){if(!M.cells[le*M.cellsX+ge])continue;const ye=r.tileCoordToPixel(M.min.x+ge/M.xScale,M.min.y+le/M.yScale),me=r.tileCoordToPixel(M.min.x+(ge+1)/M.xScale,M.min.y+(le+1)/M.yScale);for(let we=ye.y;we<=Math.min(me.y+1,_-1);++we)for(let Ie=ye.x;Ie<=Math.min(me.x+1,_-1);++Ie)qh[we*_+Ie]===255&&(qh[we*_+Ie]=0,Y+=r.getElevationAtPixel(Ie,we),te++)}const ue=Y/te;$=Math.max(1,A.x-k),H=Math.max(1,A.y-k),j=Math.min(z.x+k,_-2),X=Math.min(z.y+k,_-2),v=!0;for(let le=H;le<=X;++le)for(let ge=$;ge<=j;++ge)qh[le*_+ge]===0&&(nS[le*_+ge]=r._dem.set(ge,le,ue));for(let le=1;le<k;++le){$=Math.max(1,A.x-le),H=Math.max(1,A.y-le),j=Math.min(z.x+le,_-2),X=Math.min(z.y+le,_-2);for(let ge=H;ge<=X;++ge)for(let ye=$;ye<=j;++ye){const me=ge*_+ye;if(qh[me]===255){let we=0,Ie=0,Je=-1,qe=-1;for(let Xe=-1;Xe<=1;++Xe)for(let at=-1;at<=1;++at){const nt=(ge+Xe)*_+ye+at;if(qh[nt]>=le)continue;const ot=nS[nt],Ge=Math.abs(ot);Ge>Ie&&(we=ot,Ie=Ge,Je=at,qe=Xe)}if(Ie>.1){const Xe=1-(le+.5*Math.abs(Je*qe))/k;let at=r._dem.get(ye,ge)+we*Xe;const nt=r._dem.get(ye+Je,ge+qe),ot=r._dem.get(ye-Je,ge-qe,!0);(at-nt)*(at-ot)>0&&(at=(nt+ot)/2),nS[me]=r._dem.set(ye,ge,at),qh[me]=le}}}}}v&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=Cs.now())}setFilter(t){this.filter=t?$m(t):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(t=>this.filter.filter(new An(this.id.overscaledZ,{worldview:this.worldview}),t.feature,this.id.canonical)):this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const r of t)fx(r.node),I1(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(t.toUnwrapped());for(const d of this.getNodesInfo()){const g=d.node.footprint;d.hiddenByReplacement=!!g&&!c.find(_=>_.footprint===g)}}getHeightAtTileCoord(t,r){const c=[],d=[0,0,0],g=fe([]);for(const _ of this.getNodesInfo()){const v=_.node.meshes[0],S=v.transformedAabb;if(t<S.min[0]||r<S.min[1]||t>S.max[0]||r>S.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};ae(g,_.node.globalMatrix),d[0]=t,d[1]=r,qt(d,d,g);const T=(d[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Gh|0,M=Math.min(63,(d[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Gh|0)*Gh+Math.min(63,T),A=v.heightmap[M];if(!(A<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:A,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Ae(t,r),new Ae(t,r),c),c.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Ng(a,t){return a instanceof wh&&!a.isLightConstant&&t}function R5(a,t,r,c,d,g,_,v){let S=(61440&t|(61440&t)>>4)>>8,T=(3840&t|(3840&t)>>4)>>4,M=240&t|(240&t)>>4;r[3]>0&&(S=di(S,255*r[0],r[3]),T=di(T,255*r[1],r[3]),M=di(M,255*r[2],r[3]));const A=S<<8|T,z=M<<8|Math.floor(255*c[3]),D=(function(le){const ge=de(le,0,2);return Math.min(Math.round(.5*ge*255),255)})(c[2])<<8|15*c[0]<<4|15*c[1],k=de(d[0],0,1),$=de(d[1],0,1),H=de(d[2],0,1),j=de(d[3],0,1);let X,Y,te,ue;if(k!==$&&_!==g&&$!==k){const le=_-g;Y=1/(le*($-k)),te=-(g+le*k)/(le*($-k));const ge=de(d[4],-1,1);ue=Math.pow(10,ge),X=255*H<<8|255*j}else X=65535,Y=0,te=1,ue=1;if(a.emplaceBack(A,z,D,X,Y,te,ue),v){const le=v.length;v.clear();for(let ge=0;ge<le;ge++)v.emplaceBack(A,z,D,X,Y,te,ue)}}function D5(a,t,r){const c=a.node;let d=0;const g=r&Sf.HasMeshoptCompression;for(const _ of c.meshes){if(c.lights&&c.lightMeshIndex===d||!_.featureData)continue;_.featureArray=new Rh,_.featureArray.reserve(_.featureData.length);let v=t;for(const S of _.featureData){const T=g?65535&S:S>>16&65535,M=g?S>>16&65535:65535&S,A=(15&M)<8?15&M:0,z=a.evaluatedRMEA[A],D=a.evaluatedColor[A],k=a.emissionHeightBasedParams[A];let $;if(v&&A===2&&c.lights&&($=new Rh,$.resize(10*c.lights.length)),R5(_.featureArray,T,D,z,k,_.aabb.min[2],_.aabb.max[2],$),$&&v){v=!1;const H=c.meshes[c.lightMeshIndex];H.featureArray=$,H.featureArray._trim()}}_.featureArray._trim(),d++}}jt(Lx,"Tiled3dModelBucket",{omit:["layers"]}),jt(ZP,"Tiled3dModelFeature");const k5=["id","tile","layer","source","sourceLayer","state"];class Xh{constructor(t,r,c,d,g){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=c,this._y=d,this.properties=t?t.properties:{},this.id=g}clone(){const t=new Xh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of k5)this[r]!==void 0&&(t[r]=this[r]);return t}}class Jh extends al{constructor(t,r,c,d){super(),this.id=t,this.type="model",this.models=[],this._options=r,this._modelsInfo=new Map}loadGLTFFromURI(t){return uA(this.map._requestManager.transformRequest(t,es.Model).url)}load(){for(const t in this._options.models){const r=this._options.models[t],c=this._modelsInfo.get(t);if(c){c.modelSpec=r;const d=c.model;d&&(d.position=r.position!=null?new he(r.position[0],r.position[1]):new he(0,0),d.orientation=r.orientation!=null?r.orientation:[0,0,0],Jh.applyModelSpecification(d,r),d.computeBoundsAndApplyParent(),this.models.push(d))}else this._modelsInfo.set(t,{modelSpec:r,model:null}),this.loadGLTFFromURI(r.uri).then(d=>{if(!d)return;const g=this._modelsInfo.get(t);if(!g)return;const _=A1(d),v=g.modelSpec,S=new mA(t,v.uri,v.position,v.orientation,_);Jh.applyModelSpecification(S,v),S.computeBoundsAndApplyParent(),this.models.push(S),g.model=S,this.loaded()&&this.fire(new sl("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(d=>{this.fire(new oh(new Error(`Could not load model ${t} from ${r.uri}: ${d.message}`)))})}this.loaded()&&this.fire(new sl("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(t,r){r.nodeOverrides&&Jh.convertNodeOverrides(t,r.nodeOverrides),r.materialOverrides&&Jh.convertMaterialOverrides(t,r.materialOverrides),r.nodeOverrideNames&&(t.nodeOverrideNames=[...r.nodeOverrideNames]),r.materialOverrideNames&&(t.materialOverrideNames=[...r.materialOverrideNames]),r.featureProperties&&(t.featureProperties=r.featureProperties)}static convertNodeOverrides(t,r){if(Array.isArray(r)&&r.every(c=>typeof c=="string")){t.nodeOverrideNames=[];for(const c of r)t.nodeOverrideNames.push(c)}else Object.entries(r).forEach(([c,d])=>{const g={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){const _=d.orientation;_&&(g.orientation=_)}t.nodeOverrides.set(c,g)})}static convertMaterialOverrides(t,r){if(Array.isArray(r)&&r.every(c=>typeof c=="string")){t.materialOverrideNames=[];for(const c of r)t.materialOverrideNames.push(c)}else Object.entries(r).forEach(([c,d])=>{const g={color:new bn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=d["model-color"];_!==void 0&&(g.color.r=_[0],g.color.g=_[1],g.color.b=_[2]);const v=d["model-color-mix-intensity"];v!==void 0&&(g.colorMix=v);const S=d["model-emissive-strength"];S!==void 0&&(g.emissionStrength=S);const T=d["model-opacity"];T!==void 0&&(g.opacity=T),t.materialOverrides.set(c,g)})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const t of this._modelsInfo.values())if(t.model==null)return!1;return!0}getModels(){return this.models}loadTile(t,r){}serialize(){return this._options}setProperty(t,r){return!1}reload(){const t=wc(this.id,this.scope);this.map.style.clearSource(t),this.models=[],this._modelsInfo.clear(),this.load()}setModels(t){this.models=[];const r=new Map;for(const c in t){const d=t[c];if(this._modelsInfo.has(c)){const g=this._modelsInfo.get(c);g&&g.modelSpec.uri===d.uri&&r.set(c,g)}}this._modelsInfo=r,this._options.models=t,this.load()}}function rS(a,t,r,c){const d=1<<a.z;t.lat=dt((c/It+a.y)/d),t.lng=it((r/It+a.x)/d)}function O5(a,t,r,c){const d=a.getNodesInfo()[t];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let g=Number.MAX_VALUE;const _=d.node,v=r.tile,S=c.calculatePosMatrix(v.tileID.toUnwrapped(),c.worldSize),T=d.evaluatedScale;let M=0;c.elevation&&_.elevation&&(M=_.elevation*c.elevation.exaggeration()),tt(S,S,[(_.anchor?_.anchor[0]:0)*(T[0]-1),(_.anchor?_.anchor[1]:0)*(T[1]-1),M]),Ue(S,S,T);const A=r.queryGeometry,z=A.isPointQuery()?A.screenBounds:A.screenGeometry,D=function($){const H=ie([],S,$.globalMatrix);ie(H,c.expandedFarZProjMatrix,H);for(let j=0;j<$.meshes.length;++j){const X=$.meshes[j];if(j===$.lightMeshIndex)continue;const Y=T1(z,c,H,X.aabb);Y!=null&&(g=Math.min(Y,g))}if($.children)for(const j of $.children)D(j)};if(D(_),g===Number.MAX_VALUE)return;const k=new he(0,0);return rS(v.tileID.canonical,k,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:g,position:k,feature:d.feature}}const F5={circle:class extends Vo{constructor(a,t,r,c){super(a,{layout:A2||(A2=new ur({"circle-sort-key":new zt(ke.layout_circle["circle-sort-key"]),"circle-elevation-reference":new bt(ke.layout_circle["circle-elevation-reference"]),visibility:new bt(ke.layout_circle.visibility)})),paint:P2||(P2=new ur({"circle-radius":new zt(ke.paint_circle["circle-radius"]),"circle-color":new zt(ke.paint_circle["circle-color"]),"circle-blur":new zt(ke.paint_circle["circle-blur"]),"circle-opacity":new zt(ke.paint_circle["circle-opacity"]),"circle-translate":new bt(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(ke.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new bt(ke.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c)}createBucket(a){return new Ho(a)}queryRadius(a){const t=a;return Ec("circle-radius",this,t)+Ec("circle-stroke-width",this,t)+ff(this.paint.get("circle-translate"))}queryIntersectsFeature(a,t,r,c,d,g,_,v){const S=M2(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return V2(a,c,g,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,t,r){const c=$2(this);return{config:new L(this,{zoom:t,lut:r}),defines:c,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Vo{createBucket(a){return new G2(a)}constructor(a,t,r,c){super(a,{layout:H2||(H2=new ur({visibility:new bt(ke.layout_heatmap.visibility)})),paint:Z2||(Z2=new ur({"heatmap-radius":new zt(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new hu(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(ke.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return Ec("heatmap-radius",this,a)}queryIntersectsFeature(a,t,r,c,d,g,_,v){const S=this.paint.get("heatmap-radius").evaluate(t,r);return V2(a,c,g,_,v,!0,!0,new Ae(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,t,r){return a==="heatmap"?{config:new L(this,{zoom:t,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Vo{constructor(a,t,r,c){super(a,{layout:W2||(W2=new ur({visibility:new bt(ke.layout_hillshade.visibility)})),paint:q2||(q2=new ur({"hillshade-illumination-direction":new bt(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(ke.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new bt(ke.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,t,r){return{overrideFog:!1}}},fill:class extends Vo{constructor(a,t,r,c){super(a,{layout:pM||(pM=new ur({"fill-sort-key":new zt(ke.layout_fill["fill-sort-key"]),visibility:new bt(ke.layout_fill.visibility),"fill-elevation-reference":new bt(ke.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new zt(ke.layout_fill["fill-construct-bridge-guard-rail"])})),paint:mM||(mM=new ur({"fill-antialias":new bt(ke.paint_fill["fill-antialias"]),"fill-opacity":new zt(ke.paint_fill["fill-opacity"]),"fill-color":new zt(ke.paint_fill["fill-color"]),"fill-outline-color":new zt(ke.paint_fill["fill-outline-color"]),"fill-translate":new bt(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new zt(ke.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new bt(ke.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new bt(ke.paint_fill["fill-emissive-strength"]),"fill-z-offset":new zt(ke.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new zt(ke.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new zt(ke.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c)}getProgramIds(){const a=this.paint.get("fill-pattern"),t=a&&a.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(a,t,r){return{config:new L(this,{zoom:t,lut:r}),overrideFog:!1}}recalculate(a,t){super.recalculate(a,t);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new a1(a)}queryRadius(){return ff(this.paint.get("fill-translate"))}queryIntersectsFeature(a,t,r,c,d,g){return!a.queryGeometry.isAboveHorizon&&Gn(I2(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),c)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const t=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?t&&!a:t}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Vo{constructor(a,t,r,c){super(a,{layout:BM||(BM=new ur({visibility:new bt(ke["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new bt(ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:NM||(NM=new ur({"fill-extrusion-opacity":new bt(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zt(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new bt(ke["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new zt(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new bt(ke["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new bt(ke["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new bt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new bt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new bt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new zt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new zt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new bt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new bt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new bt(ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new bt(ke["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new zt(ke["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new zt(ke["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new bt(ke["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new nx(a)}queryRadius(){return ff(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,t,r,c,d,g,_,v,S){const T=M2(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(t,r),A=this.paint.get("fill-extrusion-base").evaluate(t,r),z=[0,0],D=v&&g.elevation,k=g.elevation?g.elevation.exaggeration():1,$=a.tile.getBucket(this);if(D&&$ instanceof nx){const te=$.centroidVertexArray,ue=S+1;ue<te.length&&(z[0]=te.geta_centroid_pos0(ue),z[1]=te.geta_centroid_pos1(ue))}if(z[0]===0&&z[1]===1)return!1;g.projection.name==="globe"&&(c=FM([c],[new Ae(0,0),new Ae(It,It)],a.tileID.canonical).map(te=>te.polygon).flat());const H=D?v:null,[j,X]=ZM(g,c,A,M,T,_,H,z,k,g.center.lat,a.tileID.canonical),Y=a.queryGeometry;return HM(j,X,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},building:class extends Vo{constructor(a,t,r,c){super(a,{layout:wA||(wA=new ur({visibility:new bt(ke.layout_building.visibility),"building-facade":new zt(ke.layout_building["building-facade"]),"building-facade-floors":new zt(ke.layout_building["building-facade-floors"]),"building-facade-unit-width":new zt(ke.layout_building["building-facade-unit-width"]),"building-facade-window":new zt(ke.layout_building["building-facade-window"]),"building-roof-shape":new zt(ke.layout_building["building-roof-shape"]),"building-height":new zt(ke.layout_building["building-height"]),"building-base":new zt(ke.layout_building["building-base"]),"building-flood-light-wall-radius":new zt(ke.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new zt(ke.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new zt(ke.layout_building["building-flip-roof-orientation"])})),paint:SA||(SA=new ur({"building-opacity":new bt(ke.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new bt(ke.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new bt(ke.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new bt(ke.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new bt(ke.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new bt(ke.paint_building["building-vertical-scale"]),"building-cast-shadows":new bt(ke.paint_building["building-cast-shadows"]),"building-color":new zt(ke.paint_building["building-color"]),"building-emissive-strength":new zt(ke.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new bt(ke.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new bt(ke.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new bt(ke.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new bt(ke.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new bt(ke.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new bA(a)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}queryRadius(a){return 0}queryIntersectsFeature(a,t,r,c,d,g,_,v,S,T){let M=this.layout.get("building-height").evaluate(t,r);const A=this.layout.get("building-base").evaluate(t,r),z=a.tile.getBucket(this).getFootprint(t);if(z){if(z.hiddenFlags!==0)return!1;M=z.height}const[D,k]=ZM(g,c,A,M,new Ae(0,0),_,null,[0,0],1,g.center.lat,a.tileID.canonical),$=a.queryGeometry;return HM(D,k,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},line:class extends Vo{constructor(a,t,r,c){const d=RA();super(a,d,t,r,c),d.layout&&(this.layout=new $o(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof mh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(a,t){super.recalculate(a,t),this.paint._values["line-floorwidth"]=(()=>{if(Eg)return Eg;const r=RA();return Eg=new CU(r.paint.properties["line-width"].specification),Eg.useIntegerZoom=!0,Eg})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new C1(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,t,r){const c=CA(this);return{config:new L(this,{zoom:t,lut:r}),defines:c,overrideFog:!1}}queryRadius(a){const t=a,r=DA(Ec("line-width",this,t),Ec("line-gap-width",this,t)),c=Ec("line-offset",this,t);return r/2+Math.abs(c)+ff(this.paint.get("line-translate"))}queryIntersectsFeature(a,t,r,c,d,g){if(a.queryGeometry.isAboveHorizon)return!1;const _=I2(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),v=a.pixelToTileUnitsFactor/2*DA(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),S=this.paint.get("line-offset").evaluate(t,r);return S&&(c=(function(T,M){const A=[],z=new Ae(0,0);for(let D=0;D<T.length;D++){const k=T[D],$=[];for(let H=0;H<k.length;H++){const j=k[H],X=k[H+1],Y=H===0?z:j.sub(k[H-1])._unit()._perp(),te=H===k.length-1?z:X.sub(j)._unit()._perp(),ue=Y._add(te)._unit();ue._mult(1/(ue.x*te.x+ue.y*te.y)),$.push(ue._mult(M)._add(j))}A.push($)}return A})(c,S*a.pixelToTileUnitsFactor)),(function(T,M,A){for(let z=0;z<M.length;z++){const D=M[z];if(T.length>=3){for(let k=0;k<D.length;k++)if(Ss(T,D[k]))return!0}if(Cr(T,D,A))return!0}return!1})(_,c,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Ax,background:class extends Vo{constructor(a,t,r,c){super(a,{layout:EP||(EP=new ur({visibility:new bt(ke.layout_background.visibility)})),paint:IP||(IP=new ur({"background-pitch-alignment":new bt(ke.paint_background["background-pitch-alignment"]),"background-color":new bt(ke.paint_background["background-color"]),"background-pattern":new bt(ke.paint_background["background-pattern"]),"background-opacity":new bt(ke.paint_background["background-opacity"]),"background-emissive-strength":new bt(ke.paint_background["background-emissive-strength"]),"background-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,t,r){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:CP,"raster-particle":FP,sky:class extends Vo{constructor(a,t,r,c){super(a,{layout:DP||(DP=new ur({visibility:new bt(ke.layout_sky.visibility)})),paint:kP||(kP=new ur({"sky-type":new bt(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new bt(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new bt(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new bt(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new bt(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new hu(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new bt(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new bt(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new bt(ke.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=sg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(a,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),d=!c,g=a.style.light,_=g.properties.get("position");return d&&g.properties.get("anchor")==="viewport"&&vi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?eS(_.azimuthal,90-_.polar,t):eS(c[0],90-c[1],t)}const r=this.paint.get("sky-gradient-center");return eS(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends Vo{constructor(a,t,r,c){super(a,{paint:OP||(OP=new ur({}))},t,null)}},model:class extends Vo{constructor(a,t,r,c){super(a,{layout:$P||($P=new ur({visibility:new bt(ke.layout_model.visibility),"model-id":new zt(ke.layout_model["model-id"]),"model-allow-density-reduction":new bt(ke.layout_model["model-allow-density-reduction"])})),paint:VP||(VP=new ur({"model-opacity":new zt(ke.paint_model["model-opacity"]),"model-rotation":new zt(ke.paint_model["model-rotation"]),"model-scale":new zt(ke.paint_model["model-scale"]),"model-translation":new zt(ke.paint_model["model-translation"]),"model-color":new zt(ke.paint_model["model-color"]),"model-color-mix-intensity":new zt(ke.paint_model["model-color-mix-intensity"]),"model-type":new bt(ke.paint_model["model-type"]),"model-cast-shadows":new bt(ke.paint_model["model-cast-shadows"]),"model-receive-shadows":new bt(ke.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new bt(ke.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new zt(ke.paint_model["model-emissive-strength"]),"model-roughness":new zt(ke.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new zt(ke.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new bt(ke.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new bt(ke.paint_model["model-front-cutoff"]),"model-elevation-reference":new bt(ke.paint_model["model-elevation-reference"]),"model-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this.layer=a,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new iS(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof Lx?8191:0}queryRenderedFeatures(a,t,r){const c=t.getSource();if(!(c&&c instanceof Jh))return{};const d=c,g={};g[this.id]=[];const _=g[this.id];let v=0;for(const S of d.models){const T=t.getFeatureState(this.sourceLayer,S.id),M={type:"Unknown",id:S.id,properties:S.featureProperties},A=this.paint.get("model-rotation").evaluate(M,T),z=this.paint.get("model-scale").evaluate(M,T),D=this.paint.get("model-translation").evaluate(M,T),k=this.paint.get("model-elevation-reference");let $=[];dx($,S,r,S.position,A,z,D,k==="ground",k==="ground",!1),r.projection.name==="globe"&&($=hx($,r));const H=ie([],r.projMatrix,$),j=T1(a.isPointQuery()?a.screenBounds:a.screenGeometry,r,H,S.aabb);if(j!=null){const X=new Xh(void 0,0,0,0,S.id);X.layer=this.layer,X.properties=structuredClone(S.featureProperties),X.properties.layer=this.id,X.properties.uri=S.uri,X.properties.orientation=S.orientation,X.sourceLayer=this.sourceLayer,X.geometry={type:"Point",coordinates:[S.position.lng,S.position.lat]},X.state=T,X.source=this.source,_.push({featureIndex:v,feature:X,intersectionZ:j})}++v}return g}queryIntersectsFeature(a,t,r,c,d,g,_,v,S,T){if(!this.modelManager)return!1;const M=this.modelManager,A=a.tile.getBucket(this);if(!(A&&A instanceof iS))return!1;for(const z in A.instancesPerModel){const D=A.instancesPerModel[z],k=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(D.idToFeaturesIndex.hasOwnProperty(k)){const $=D.features[D.idToFeaturesIndex[k]],H=M.getModel(z,T||this.scope);if(!H)return!1;let j=[];const X=new he(0,0),Y=A.canonical;let te=Number.MAX_VALUE;for(let ue=0;ue<$.instancedDataCount;++ue){const le=16*($.instancedDataOffset+ue),ge=D.instancedDataArray.float32,ye=[ge[le+4],ge[le+5],ge[le+6]];rS(Y,X,Math.floor(ge[le]),Math.floor(ge[le+1])),dx(j,H,g,X,$.rotation,$.scale,ye,!1,!1,!1),g.projection.name==="globe"&&(j=hx(j,g));const me=ie([],g.projMatrix,j),we=a.queryGeometry,Ie=T1(we.isPointQuery()?we.screenBounds:we.screenGeometry,g,me,H.aabb);Ie!=null&&(te=Math.min(Ie,te))}return te!==Number.MAX_VALUE&&te}}return!1}_handleOverridablePaintPropertyUpdate(a,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const t=this._transitionablePaint._values[a];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof vc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Vo{constructor(a,t,r,c){super(a,{layout:gM||(gM=new ur({"clip-layer-types":new bt(ke.layout_clip["clip-layer-types"]),"clip-layer-scope":new bt(ke.layout_clip["clip-layer-scope"]),visibility:new bt(ke.layout_clip.visibility)})),paint:_M||(_M=new ur({}))},t,r,c)}recalculate(a,t){super.recalculate(a,t)}createBucket(a){return new yM(a)}is3D(a){return!0}}},oS=new bn(0,0,0);function B5(a,t,r){a===1&&t.icons.push((function(c,d){return(function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:_}=g;if(_.content_area){const{content_area:v}=_;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=g.usvg_tree.width),v.height==null&&(v.height=v.width)}if(_.text_placeholder){const{text_placeholder:v}=_;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return _.stretch_x&&_.stretch_x.length&&WP(_,"x"),_.stretch_y&&_.stretch_y.length&&WP(_,"y"),g})(c.readFields(N5,{name:void 0},d))})(r,r.readVarint()+r.pos))}function WP(a,t){const r=[],c=a[`stretch_${t}`];let d=null;for(let g=0;g<c.length;g++)d===null?d=r.length===0?c[0]:r[r.length-1][1]+c[g]:(r.push([d,d+c[g]]),d=null);a[`stretch_${t}_areas`]=r}function N5(a,t,r){a===1?t.name=r.readString():a===2?t.metadata=(function(c,d){return c.readFields(U5,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)})(r,r.readVarint()+r.pos):a===3&&(t.usvg_tree=(function(c,d){return c.readFields(j5,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)})(r,r.readVarint()+r.pos),t.data="usvg_tree")}function U5(a,t,r){a===1?t.stretch_x=r.readPackedVarint():a===2?t.stretch_y=r.readPackedVarint():a===3?t.content_area=qP(r,r.readVarint()+r.pos):a===4?t.variables.push((function(c,d){return c.readFields(V5,{name:void 0},d)})(r,r.readVarint()+r.pos)):a===5&&(t.text_placeholder=qP(r,r.readVarint()+r.pos))}function qP(a,t){return a.readFields($5,{},t)}function $5(a,t,r){a===1?t.left=r.readVarint():a===2?t.width=r.readVarint():a===3?t.top=r.readVarint():a===4&&(t.height=r.readVarint())}function V5(a,t,r){a===1?t.name=r.readString():a===2&&(t.rgb_color=kx(r.readVarint()),t.value="rgb_color")}function j5(a,t,r){a===1?t.width=t.height=r.readVarint():a===2?t.height=r.readVarint():a===3?t.children.push(Rx(r,r.readVarint()+r.pos)):a===4?t.linear_gradients.push((function(c,d){return c.readFields(J5,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)})(r,r.readVarint()+r.pos)):a===5?t.radial_gradients.push((function(c,d){return c.readFields(K5,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)})(r,r.readVarint()+r.pos)):a===7?t.clip_paths.push((function(c,d){return c.readFields(Q5,{children:[]},d)})(r,r.readVarint()+r.pos)):a===8&&t.masks.push((function(c,d){const g=c.readFields(e$,{left:0,width:20,mask_type:1,children:[]},d);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g})(r,r.readVarint()+r.pos))}function Rx(a,t){return a.readFields(G5,{},t)}function G5(a,t,r){a===1?(t.group=(function(c,d){return c.readFields(H5,{opacity:255,children:[]},d)})(r,r.readVarint()+r.pos),t.node="group"):a===2&&(t.path=(function(c,d){return c.readFields(W5,{paint_order:1,commands:[],step:1,diffs:[],rule:1},d)})(r,r.readVarint()+r.pos),t.node="path")}function H5(a,t,r){a===1?t.transform=Dx(r,r.readVarint()+r.pos):a===2?t.opacity=r.readVarint():a===5?t.clip_path_idx=r.readVarint():a===6?t.mask_idx=r.readVarint():a===7&&t.children.push(Rx(r,r.readVarint()+r.pos))}function Dx(a,t){return a.readFields(Z5,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function Z5(a,t,r){a===1?t.sx=r.readFloat():a===2?t.ky=r.readFloat():a===3?t.kx=r.readFloat():a===4?t.sy=r.readFloat():a===5?t.tx=r.readFloat():a===6&&(t.ty=r.readFloat())}function W5(a,t,r){a===1?t.fill=(function(c,d){return c.readFields(q5,{rgb_color:oS,paint:"rgb_color",opacity:255},d)})(r,r.readVarint()+r.pos):a===2?t.stroke=(function(c,d){return c.readFields(X5,{rgb_color:oS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)})(r,r.readVarint()+r.pos):a===3?t.paint_order=r.readVarint():a===5?r.readPackedVarint(t.commands):a===6?t.step=r.readFloat():a===7?r.readPackedSVarint(t.diffs):a===8&&(t.rule=r.readVarint())}function q5(a,t,r){a===1?(t.rgb_color=kx(r.readVarint()),t.paint="rgb_color"):a===2?(t.linear_gradient_idx=r.readVarint(),t.paint="linear_gradient_idx"):a===3?(t.radial_gradient_idx=r.readVarint(),t.paint="radial_gradient_idx"):a===5&&(t.opacity=r.readVarint())}function kx(a){return new bn((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function X5(a,t,r){a===1?(t.rgb_color=kx(r.readVarint()),t.paint="rgb_color"):a===2?(t.linear_gradient_idx=r.readVarint(),t.paint="linear_gradient_idx"):a===3?(t.radial_gradient_idx=r.readVarint(),t.paint="radial_gradient_idx"):a===5?r.readPackedFloat(t.dasharray):a===6?t.dashoffset=r.readFloat():a===7?t.miterlimit=r.readFloat():a===8?t.opacity=r.readVarint():a===9?t.width=r.readFloat():a===10?t.linecap=r.readVarint():a===11&&(t.linejoin=r.readVarint())}function J5(a,t,r){a===1?t.transform=Dx(r,r.readVarint()+r.pos):a===2?t.spread_method=r.readVarint():a===3?t.stops.push(XP(r,r.readVarint()+r.pos)):a===4?t.x1=r.readFloat():a===5?t.y1=r.readFloat():a===6?t.x2=r.readFloat():a===7&&(t.y2=r.readFloat())}function XP(a,t){return a.readFields(Y5,{offset:0,opacity:255,rgb_color:oS},t)}function Y5(a,t,r){a===1?t.offset=r.readFloat():a===2?t.opacity=r.readVarint():a===3&&(t.rgb_color=kx(r.readVarint()))}function K5(a,t,r){a===1?t.transform=Dx(r,r.readVarint()+r.pos):a===2?t.spread_method=r.readVarint():a===3?t.stops.push(XP(r,r.readVarint()+r.pos)):a===4?t.cx=r.readFloat():a===5?t.cy=r.readFloat():a===6?t.r=r.readFloat():a===7?t.fx=r.readFloat():a===8?t.fy=r.readFloat():a===9&&(t.fr=r.readFloat())}function Q5(a,t,r){a===1?t.transform=Dx(r,r.readVarint()+r.pos):a===2?t.clip_path_idx=r.readVarint():a===3&&t.children.push(Rx(r,r.readVarint()+r.pos))}function e$(a,t,r){a===1?t.left=t.top=r.readFloat():a===2?t.width=t.height=r.readFloat():a===3?t.top=r.readFloat():a===4?t.height=r.readFloat():a===5?t.mask_type=r.readVarint():a===6?t.mask_idx=r.readVarint():a===7&&t.children.push(Rx(r,r.readVarint()+r.pos))}class t${static calculate(t={},r=[]){const c=new Map,d=new Map;if(Object.keys(t).length===0)return c;r.forEach(g=>{d.set(g.name,g.rgb_color||new bn(0,0,0))});for(const[g,_]of Object.entries(t))d.has(g)?c.set(d.get(g).toString(),_):console.warn(`Ignoring unknown image variable "${g}"`);return c}}function Lf(a,t=255,r){const c=t/255,d=a.toString(),g=r.has(d)?r.get(d).clone():a.clone();return g.a*=c,g.toString()}function Ug(a,t){if(!cc()){const r=document.createElement("canvas");return r.width=a,r.height=t,r}return new OffscreenCanvas(a,t)}let sS,$g=null;function aS(a,t,r,c,d){for(const g of c.children)JP(a,t,r,g,d)}function JP(a,t,r,c,d){c.group?(a.save(),(function(g,_,v,S,T){const M=S.mask_idx!=null?v.masks[S.mask_idx]:null,A=S.clip_path_idx!=null?v.clip_paths[S.clip_path_idx]:null;if(S.transform&&(_=Rf(S.transform).preMultiplySelf(_)),!(function(k,$,H){return k.opacity!==255||$||H})(S,A!=null,M!=null))return void aS(g,_,v,S,T);const z=Ug(g.canvas.width,g.canvas.height),D=z.getContext("2d");aS(D,_,v,S,T),A&&nz(D,_,v,A),M&&rz(D,_,v,M,T),g.globalAlpha=S.opacity/255,g.drawImage(z,0,0)})(a,t,r,c.group,d),a.restore()):c.path&&(a.save(),(function(g,_,v,S,T){g.setTransform(_),S.paint_order===1?(YP(g,v,S,T),QP(g,v,S,T)):(QP(g,v,S,T),YP(g,v,S,T))})(a,t,r,c.path,d),a.restore())}function YP(a,t,r,c){const d=r.fill;if(!d)return;const g=d.opacity/255;switch(a.save(),a.beginPath(),oz(r,a),d.paint){case"rgb_color":a.fillStyle=Lf(d.rgb_color,d.opacity,c);break;case"linear_gradient_idx":{const _=t.linear_gradients[d.linear_gradient_idx];_.transform&&a.setTransform(Rf(_.transform).preMultiplySelf(a.getTransform())),a.fillStyle=ez(a,_,g,c);break}case"radial_gradient_idx":{const _=t.radial_gradients[d.radial_gradient_idx];_.transform&&a.setTransform(Rf(_.transform).preMultiplySelf(a.getTransform())),a.fillStyle=tz(a,_,g,c)}}a.fill(KP(r)),a.restore()}function KP(a){return a.rule===1?"nonzero":a.rule===2?"evenodd":void 0}function QP(a,t,r,c){const d=r.stroke;if(!d)return;const g=sz(r);a.lineWidth=d.width,a.miterLimit=d.miterlimit,a.setLineDash(d.dasharray),a.lineDashOffset=d.dashoffset;const _=d.opacity/255;switch(d.paint){case"rgb_color":a.strokeStyle=Lf(d.rgb_color,d.opacity,c);break;case"linear_gradient_idx":a.strokeStyle=ez(a,t.linear_gradients[d.linear_gradient_idx],_,c,!0);break;case"radial_gradient_idx":a.strokeStyle=tz(a,t.radial_gradients[d.radial_gradient_idx],_,c,!0)}switch(d.linejoin){case 2:case 1:a.lineJoin="miter";break;case 3:a.lineJoin="round";break;case 4:a.lineJoin="bevel"}switch(d.linecap){case 1:a.lineCap="butt";break;case 2:a.lineCap="round";break;case 3:a.lineCap="square"}a.stroke(g)}function ez(a,t,r,c,d=!1){if(t.stops.length===1){const z=t.stops[0];return Lf(z.rgb_color,z.opacity*r,c)}const{x1:g,y1:_,x2:v,y2:S}=t;let T=new DOMPoint(g,_),M=new DOMPoint(v,S);if(d){const z=Rf(t.transform);T=z.transformPoint(T),M=z.transformPoint(M)}const A=a.createLinearGradient(T.x,T.y,M.x,M.y);for(const z of t.stops)A.addColorStop(z.offset,Lf(z.rgb_color,z.opacity*r,c));return A}function tz(a,t,r,c,d=!1){if(t.stops.length===1){const j=t.stops[0];return Lf(j.rgb_color,j.opacity*r,c)}const g=Rf(t.transform),{fx:_,fy:v,fr:S,cx:T,cy:M,r:A}=t;let z=new DOMPoint(_,v),D=new DOMPoint(T,M),k=S,$=A;if(d){z=g.transformPoint(z),D=g.transformPoint(D);const j=(g.a+g.d)/2;k=S*j,$=t.r*j}const H=a.createRadialGradient(z.x,z.y,k,D.x,D.y,$);for(const j of t.stops)H.addColorStop(j.offset,Lf(j.rgb_color,j.opacity*r,c));return H}function iz(a,t,r,c){const d=c.transform?Rf(c.transform).preMultiplySelf(t):t,g=Ug(a.canvas.width,a.canvas.height),_=g.getContext("2d");for(const S of c.children)if(S.group)iz(_,d,r,S.group);else if(S.path){const T=S.path,M=new Path2D;M.addPath(sz(T),d),_.fill(M,KP(T))}const v=c.clip_path_idx!=null?r.clip_paths[c.clip_path_idx]:null;v&&nz(_,d,r,v),a.globalCompositeOperation="source-over",a.drawImage(g,0,0)}function nz(a,t,r,c){const d=Ug(a.canvas.width,a.canvas.height);iz(d.getContext("2d"),t,r,c),a.globalCompositeOperation="destination-in",a.drawImage(d,0,0)}function rz(a,t,r,c,d){if(c.children.length===0)return;const g=c.mask_idx!=null?r.masks[c.mask_idx]:null;g&&rz(a,t,r,g,d);const _=a.canvas.width,v=a.canvas.height,S=Ug(_,v),T=S.getContext("2d"),M=c.width,A=c.height,z=c.left,D=c.top,k=new Path2D,$=new Path2D;$.rect(z,D,M,A),k.addPath($,t),T.clip(k);for(const X of c.children)JP(T,t,r,X,d);const H=T.getImageData(0,0,_,v),j=H.data;if(c.mask_type===1)for(let X=0;X<j.length;X+=4)j[X+3]=j[X+3]/255*(.2126*j[X]+.7152*j[X+1]+.0722*j[X+2]);T.putImageData(H,0,0),a.globalCompositeOperation="destination-in",a.drawImage(S,0,0)}function Rf(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function oz(a,t){const r=a.step;let c=a.diffs[0]*r,d=a.diffs[1]*r;t.moveTo(c,d);for(let g=0,_=2;g<a.commands.length;g++)switch(a.commands[g]){case 1:c+=a.diffs[_++]*r,d+=a.diffs[_++]*r,t.moveTo(c,d);break;case 2:c+=a.diffs[_++]*r,d+=a.diffs[_++]*r,t.lineTo(c,d);break;case 3:{const v=c+a.diffs[_++]*r,S=d+a.diffs[_++]*r;c=v+a.diffs[_++]*r,d=S+a.diffs[_++]*r,t.quadraticCurveTo(v,S,c,d);break}case 4:{const v=c+a.diffs[_++]*r,S=d+a.diffs[_++]*r,T=v+a.diffs[_++]*r,M=S+a.diffs[_++]*r;c=T+a.diffs[_++]*r,d=M+a.diffs[_++]*r,t.bezierCurveTo(v,S,T,M,c,d);break}case 5:t.closePath();break}return t}function sz(a){return oz(a,new Path2D)}class Ox{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const r=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,r),r}put(t,r){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,r)}delete(t){this.cache.delete(t)}}jt(Ox,"LRUCache");class lS{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new Mo(t,t.data)}getFromCache(t,r,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new Ox(150)),this.cacheMap.get(c).get(wc(t.toString(),r))}setInCache(t,r,c,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new Ox(150));const g=this.cacheDependenciesMap.get(d),_=wc(t.id.toString(),c);g.get(_)||g.set(_,new Set);const v=this.cacheMap.get(d),S=t.toString();g.get(_).add(S),v.put(wc(t.toString(),c),r)}removeImagesFromCacheByIds(t,r,c=0){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const d=this.cacheMap.get(c),g=this.cacheDependenciesMap.get(c);for(const _ of t){const v=wc(_.toString(),r);if(g.has(v)){for(const S of g.get(v))d.delete(S);g.delete(v)}}}rasterize(t,r,c,d){const g=this.getFromCache(t,c,d);if(g)return g.clone();const _=(function(S,T){const M=t$.calculate(T.params,S.metadata?S.metadata.variables:[]),A=S.usvg_tree,z=A.width,D=A.height,k=Math.max(1,Math.round(z*T.sx)),$=Math.max(1,Math.round(D*T.sy)),H=new DOMMatrix([k/z,0,0,$/D,0,0]);return $g===null&&($g=Ug(10,10),sS=$g.getContext("2d",{willReadFrequently:!0})),$g.width=k,$g.height=$,aS(sS,H,A,A,M),sS.getImageData(0,0,k,$)})(r.icon,t),v=lS._getImage(_);return this.setInCache(t,v,c,d),v.clone()}}class az{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){const c=this.toIdx(t,r);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function lz(a,t,r,c){let d=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(r[_]<a[_]||r[_]>t[_])return null}else{const v=1/c[_];let S=(a[_]-r[_])*v,T=(t[_]-r[_])*v;if(S>T){const M=S;S=T,T=M}if(S>d&&(d=S),T<g&&(g=T),d>g)return null}return d}function cz(a,t,r,c,d,g,_,v,S,T,M){const A=c-a,z=d-t,D=g-r,k=_-a,$=v-t,H=S-r,j=M[1]*H-M[2]*$,X=M[2]*k-M[0]*H,Y=M[0]*$-M[1]*k,te=A*j+z*X+D*Y;if(Math.abs(te)<1e-15)return null;const ue=1/te,le=T[0]-a,ge=T[1]-t,ye=T[2]-r,me=(le*j+ge*X+ye*Y)*ue;if(me<0||me>1)return null;const we=ge*D-ye*z,Ie=ye*A-le*D,Je=le*z-ge*A,qe=(M[0]*we+M[1]*Ie+M[2]*Je)*ue;return qe<0||me+qe>1?null:(k*we+$*Ie+H*Je)*ue}function uz(a,t,r){return(a-t)/(r-t)}function hz(a,t,r,c,d,g,_,v,S){const T=1<<r,M=g-c,A=_-d,z=(a+1)/T*M+c,D=(t+0)/T*A+d,k=(t+1)/T*A+d;v[0]=(a+0)/T*M+c,v[1]=D,S[0]=z,S[1]=k}class dz{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=(function(g){const _=Math.ceil(Math.log2(g.dim/8)),v=[];let S=Math.ceil(Math.pow(2,_));const T=1/S,M=(D,k,$,H,j)=>{const X=H?1:0,Y=(D+1)*$-X,te=k*$,ue=(k+1)*$-X;j[0]=D*$,j[1]=te,j[2]=Y,j[3]=ue};let A=new az(S);const z=[];for(let D=0;D<S*S;D++){M(D%S,Math.floor(D/S),T,!1,z);const k=Mu(z[0],z[1],g),$=Mu(z[2],z[1],g),H=Mu(z[2],z[3],g),j=Mu(z[0],z[3],g);A.minimums.push(Math.min(k,$,H,j)),A.maximums.push(Math.max(k,$,H,j)),A.leaves.push(1)}for(v.push(A),S/=2;S>=1;S/=2){const D=v[v.length-1];A=new az(S);for(let k=0;k<S*S;k++){M(k%S,Math.floor(k/S),2,!0,z);const $=D.getElevation(z[0],z[1]),H=D.getElevation(z[2],z[1]),j=D.getElevation(z[2],z[3]),X=D.getElevation(z[0],z[3]),Y=D.isLeaf(z[0],z[1]),te=D.isLeaf(z[2],z[1]),ue=D.isLeaf(z[2],z[3]),le=D.isLeaf(z[0],z[3]),ge=Math.min($.min,H.min,j.min,X.min),ye=Math.max($.max,H.max,j.max,X.max),me=Y&&te&&ue&&le;A.maximums.push(ye),A.minimums.push(ge),A.leaves.push(ye-ge<=5&&me?1:0)}v.push(A)}return v})(this.dem),c=r.length-1,d=r[c];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(r,0,0,c,0)}raycastRoot(t,r,c,d,g,_,v=1){return lz([t,r,-100],[c,d,this.maximums[0]*v],g,_)}raycast(t,r,c,d,g,_,v=1){if(!this.nodeCount)return null;const S=this.raycastRoot(t,r,c,d,g,_,v);if(S==null)return null;const T=[],M=[],A=[],z=[],D=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:k,t:$,nodex:H,nodey:j,depth:X}=D.pop();if(this.leaves[k]){hz(H,j,X,t,r,c,d,A,z);const te=1<<X,ue=(H+0)/te,le=(H+1)/te,ge=(j+0)/te,ye=(j+1)/te,me=Mu(ue,ge,this.dem)*v,we=Mu(le,ge,this.dem)*v,Ie=Mu(le,ye,this.dem)*v,Je=Mu(ue,ye,this.dem)*v,qe=cz(A[0],A[1],me,z[0],A[1],we,z[0],z[1],Ie,g,_),Xe=cz(z[0],z[1],Ie,A[0],z[1],Je,A[0],A[1],me,g,_),at=Math.min(qe!==null?qe:Number.MAX_VALUE,Xe!==null?Xe:Number.MAX_VALUE);if(at!==Number.MAX_VALUE)return at;{const nt=Rn([],g,_,$);if(fz(me,we,Je,Ie,uz(nt[0],A[0],z[0]),uz(nt[1],A[1],z[1]))>=nt[2])return $}continue}let Y=0;for(let te=0;te<this._siblingOffset.length;te++){hz((H<<1)+this._siblingOffset[te][0],(j<<1)+this._siblingOffset[te][1],X+1,t,r,c,d,A,z),A[2]=-100,z[2]=this.maximums[this.childOffsets[k]+te]*v;const ue=lz(A,z,g,_);if(ue!=null){const le=ue;T[te]=le;let ge=!1;for(let ye=0;ye<Y&&!ge;ye++)le>=T[M[ye]]&&(M.splice(ye,0,te),ge=!0);ge||(M[Y]=te),Y++}}for(let te=0;te<Y;te++){const ue=M[te];D.push({idx:this.childOffsets[k]+ue,t:T[ue],nodex:(H<<1)+this._siblingOffset[ue][0],nodey:(j<<1)+this._siblingOffset[ue][1],depth:X+1})}}return null}_addNode(t,r,c){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,c,d,g){if(t[d].isLeaf(r,c)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=d-1,v=t[_];let S=0,T=0;for(let M=0;M<this._siblingOffset.length;M++){const A=2*r+this._siblingOffset[M][0],z=2*c+this._siblingOffset[M][1],D=v.getElevation(A,z),k=v.isLeaf(A,z),$=this._addNode(D.min,D.max,k);k&&(S|=1<<M),T||(T=$)}for(let M=0;M<this._siblingOffset.length;M++)S&1<<M||this._construct(t,2*r+this._siblingOffset[M][0],2*c+this._siblingOffset[M][1],_,T+M)}}function fz(a,t,r,c,d,g){return di(di(a,r,g),di(t,c,g),d)}function Mu(a,t,r){const c=r.dim,d=de(a*c-.5,0,c-1),g=de(t*c-.5,0,c-1),_=Math.floor(d),v=Math.floor(g),S=Math.min(_+1,c-1),T=Math.min(v+1,c-1);return fz(r.get(_,v),r.get(S,v),r.get(_,T),r.get(S,T),d-_,g-v)}const i$={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function n$(a,t,r){return(256*a*256+256*t+r)/10-1e4}function r$(a,t,r){return 256*a+t+r/256-32768}class Fx{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,c,d=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void vi(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const g=this.dim=r.height-2,_=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let S=0;S<g;S++)_[this._idx(-1,S)]=_[this._idx(0,S)],_[this._idx(g,S)]=_[this._idx(g-1,S)],_[this._idx(S,-1)]=_[this._idx(S,0)],_[this._idx(S,g)]=_[this._idx(S,g-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(g,-1)]=_[this._idx(g-1,0)],_[this._idx(-1,g)]=_[this._idx(0,g-1)],_[this._idx(g,g)]=_[this._idx(g-1,g-1)]}const v=c==="terrarium"?r$:n$;for(let S=0;S<_.length;++S){const T=4*S;this.floatView[S]=v(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=Cs.now()}_buildQuadTree(){this._tree=new dz(this)}get(t,r,c=!1){c&&(t=de(t,-1,this.dim),r=de(r,-1,this.dim));const d=this._idx(t,r);return this.floatView[d]}set(t,r,c){const d=this._idx(t,r),g=this.floatView[d];return this.floatView[d]=c,c-g}static getUnpackVector(t){return i$[t]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}static pack(t,r){const c=[0,0,0,0],d=Fx.getUnpackVector(r);let g=Math.floor((t+d[3])/d[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Y2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=r*this.dim,g=r*this.dim+this.dim,_=c*this.dim,v=c*this.dim+this.dim;switch(r){case-1:d=g-1;break;case 1:g=d+1}switch(c){case-1:_=v-1;break;case 1:v=_+1}const S=-r*this.dim,T=-c*this.dim;for(let M=_;M<v;M++)for(let A=d;A<g;A++){const z=4*this._idx(A,M),D=4*this._idx(A+S,M+T);this.pixels[z+0]=t.pixels[D+0],this.pixels[z+1]=t.pixels[D+1],this.pixels[z+2]=t.pixels[D+2],this.pixels[z+3]=t.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function o$(a,t,r){a===1?t.headerLength=r.readFixed32():a===2?t.x=r.readVarint():a===3?t.y=r.readVarint():a===4?t.z=r.readVarint():a===5&&t.layers.push((function(c,d){return c.readFields(u$,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)})(r,r.readVarint()+r.pos))}function s$(a,t,r){a===1?(t.delta_filter=(function(c,d){return c.readFields(a$,{blockSize:0},d)})(r,r.readVarint()+r.pos),t.filter="delta_filter"):a===2?(r.readVarint(),t.filter="zigzag_filter"):a===3?(r.readVarint(),t.filter="bitshuffle_filter"):a===4&&(r.readVarint(),t.filter="byteshuffle_filter")}function a$(a,t,r){a===1&&(t.blockSize=r.readVarint())}function l$(a,t,r){a===1?(r.readVarint(),t.codec="gzip_data"):a===2?(r.readVarint(),t.codec="jpeg_image"):a===3?(r.readVarint(),t.codec="webp_image"):a===4&&(r.readVarint(),t.codec="png_image")}function c$(a,t,r){let c=0,d=0;a===1?t.firstByte=r.readFixed64():a===2?t.lastByte=r.readFixed64():a===3?t.filters.push((function(g,_){return g.readFields(s$,{},_)})(r,r.readVarint()+r.pos)):a===4?t.codec=(function(g,_){return g.readFields(l$,{},_)})(r,r.readVarint()+r.pos):a===5?d=r.readFloat():a===6?c=r.readFloat():a===7?t.bands.push(r.readString()):a===8?t.offset=r.readDouble():a===9&&(t.scale=r.readDouble()),t.offset===0&&(t.offset=d),t.scale===0&&(t.scale=c)}function u$(a,t,r){a===1?t.version=r.readVarint():a===2?t.name=r.readString():a===3?t.units=r.readString():a===4?t.tileSize=r.readVarint():a===5?t.buffer=r.readVarint():a===6?t.pixelFormat=r.readVarint():a===7&&t.dataIndex.push((function(c,d){return c.readFields(c$,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)})(r,r.readVarint()+r.pos))}function h$(a,t,r){if(a===2)(function(c,d,g){c.readFields(d$,g,d)})(r,r.readVarint()+r.pos,t);else if(a===3)throw new Error("Not implemented")}function d$(a,t,r){if(a===1){let c=0;const d=r.readVarint()+r.pos;for(;r.pos<d;)t[c++]=r.readVarint()}}function f$(a,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let r=t[3];for(let c=2;c>=1;c--){const d=c===1?1:0,g=c===2?1:0;for(let _=0;_<t[0];_++){const v=t[1]*_;for(let S=d;S<t[1];S++){const T=t[2]*(S+v);for(let M=g;M<t[2];M++){const A=t[3]*(M+T);for(let z=0;z<t[3];z++){const D=A+z;a[D]+=a[D-r]}}}}r*=t[c]}return a}function p$(a){for(let t=0,r=a.length;t<r;t++)a[t]=a[t]>>>1^-(1&a[t]);return a}function m$(a,t){switch(t){case"uint32":return a;case"uint16":for(let r=0;r<a.length;r+=2){const c=a[r],d=a[r+1];a[r]=(240&c)>>4|(61440&c)>>8|(240&d)<<4|61440&d,a[r+1]=15&c|(3840&c)>>4|(15&d)<<8|(3840&d)<<4}return a;case"uint8":for(let r=0;r<a.length;r+=4){const c=a[r],d=a[r+1],g=a[r+2],_=a[r+3];a[r+0]=(192&c)>>6|(192&d)>>4|(192&g)>>2|192&_,a[r+1]=(48&c)>>4|(48&d)>>2|48&g|(48&_)<<2,a[r+2]=(12&c)>>2|12&d|(12&g)<<2|(12&_)<<4,a[r+3]=3&c|(3&d)<<2|(3&g)<<4|(3&_)<<6}return a;default:throw new Error(`Invalid pixel format, "${t}"`)}}jt(Fx,"DEMData"),jt(dz,"DemMinMaxQuadTree",{omit:["dem"]});var _a=Uint8Array,Vg=Uint16Array,g$=Int32Array,pz=new _a([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mz=new _a([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_$=new _a([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gz=function(a,t){for(var r=new Vg(31),c=0;c<31;++c)r[c]=t+=1<<a[c-1];var d=new g$(r[30]);for(c=1;c<30;++c)for(var g=r[c];g<r[c+1];++g)d[g]=g-r[c]<<5|c;return{b:r,r:d}},_z=gz(pz,2),yz=_z.b,y$=_z.r;yz[28]=258,y$[258]=28;for(var v$=gz(mz,0).b,vz=new Vg(32768),Zr=0;Zr<32768;++Zr){var Df=(43690&Zr)>>1|(21845&Zr)<<1;vz[Zr]=((65280&(Df=(61680&(Df=(52428&Df)>>2|(13107&Df)<<2))>>4|(3855&Df)<<4))>>8|(255&Df)<<8)>>1}var jg=function(a,t,r){for(var c=a.length,d=0,g=new Vg(t);d<c;++d)a[d]&&++g[a[d]-1];var _,v=new Vg(t);for(d=1;d<t;++d)v[d]=v[d-1]+g[d-1]<<1;_=new Vg(1<<t);var S=15-t;for(d=0;d<c;++d)if(a[d])for(var T=d<<4|a[d],M=t-a[d],A=v[a[d]-1]++<<M,z=A|(1<<M)-1;A<=z;++A)_[vz[A]>>S]=T;return _},Gg=new _a(288);for(Zr=0;Zr<144;++Zr)Gg[Zr]=8;for(Zr=144;Zr<256;++Zr)Gg[Zr]=9;for(Zr=256;Zr<280;++Zr)Gg[Zr]=7;for(Zr=280;Zr<288;++Zr)Gg[Zr]=8;var xz=new _a(32);for(Zr=0;Zr<32;++Zr)xz[Zr]=5;var x$=jg(Gg,9),b$=jg(xz,5),cS=function(a){for(var t=a[0],r=1;r<a.length;++r)a[r]>t&&(t=a[r]);return t},gl=function(a,t,r){var c=t/8|0;return(a[c]|a[c+1]<<8)>>(7&t)&r},uS=function(a,t){var r=t/8|0;return(a[r]|a[r+1]<<8|a[r+2]<<16)>>(7&t)},w$=function(a){return(a+7)/8|0},S$=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_l=function(a,t,r){var c=new Error(t||S$[a]);if(c.code=a,Error.captureStackTrace&&Error.captureStackTrace(c,_l),!r)throw c;return c},T$=new _a(0),E$=typeof TextDecoder<"u"&&new TextDecoder;try{E$.decode(T$,{stream:!0})}catch{}const I$={gzip_data:"gzip"};class Ua extends Error{constructor(t){super(t),this.name="MRTError"}}const M$={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},bz={uint32:1,uint16:2,uint8:4},A$={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let hS;class Bx{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const r=this.layers[t];if(!r)throw new Ua(`Layer '${t}' not found`);return r}getHeaderLength(t){const r=new Uint8Array(t),c=new DataView(t);if(r[0]!==13)throw new Ua("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(t){const r=new Uint8Array(t),c=this.getHeaderLength(t);if(r.length<c)throw new Ua(`Expected header with length >= ${c} but got buffer of length ${r.length}`);const d=new hS(r.subarray(0,c)).readFields(o$,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Ua(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const g of d.layers)this.layers[g.name]=new wz(g,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const r=[],c=this.getLayer(t.layerName);for(let d of t.blockIndices){const g=c.dataIndex[d],_=g.firstByte-t.firstByte,v=g.lastByte-t.firstByte;if(c._blocksInProgress.has(d))continue;const S={layerName:c.name,firstByte:_,lastByte:v,pixelFormat:c.pixelFormat,blockIndex:d,blockShape:[g.bands.length].concat(c.bandShape),buffer:c.buffer,codec:g.codec.codec,filters:g.filters.map(T=>T.filter)};c._blocksInProgress.add(d),r.push(S)}return new Sz(r,()=>{r.forEach(d=>c._blocksInProgress.delete(d.blockIndex))},(d,g)=>{if(r.forEach(_=>c._blocksInProgress.delete(_.blockIndex)),d)throw d;g.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class wz{constructor({version:t,name:r,units:c,tileSize:d,pixelFormat:g,buffer:_,dataIndex:v},S){if(this.version=t,this.version!==1)throw new Ua(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=r,this.units=c,this.tileSize=d,this.buffer=_,this.pixelFormat=M$[g],this.dataIndex=v,this.bandShape=[d+2*_,d+2*_,bz[this.pixelFormat]],this._decodedBlocks=new Ox(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return bz[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const r=t.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,t.data)}getBlockForBand(t){let r=0;switch(typeof t){case"string":for(const[c,d]of this.dataIndex.entries()){for(const[g,_]of d.bands.entries())if(_===t)return{bandIndex:r+g,blockIndex:c,blockBandIndex:g};r+=d.bands.length}break;case"number":for(const[c,d]of this.dataIndex.entries()){if(t>=r&&t<r+d.bands.length)return{bandIndex:t,blockIndex:c,blockBandIndex:t-r};r+=d.bands.length}break;default:throw new Ua(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(t){let r=1/0,c=-1/0;const d=[],g=new Set;for(const _ of t){const{blockIndex:v}=this.getBlockForBand(_);if(v<0)throw new Ua(`Invalid band: ${JSON.stringify(_)}`);const S=this.dataIndex[v];d.includes(v)||d.push(v),g.add(v),r=Math.min(r,S.firstByte),c=Math.max(c,S.lastByte)}if(g.size>this.cacheSize)throw new Ua(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:c,blockIndices:d}}hasBand(t){const{blockIndex:r}=this.getBlockForBand(t);return r>=0}hasDataForBand(t){const{blockIndex:r}=this.getBlockForBand(t);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(t){const{blockIndex:r,blockBandIndex:c}=this.getBlockForBand(t);if(r<0)throw new Ua(`Band not found: ${JSON.stringify(t)}`);const d=this._decodedBlocks.get(r.toString());if(!d)throw new Ua(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[r],_=this.bandShape.reduce((T,M)=>T*M,1),v=c*_,S=d.subarray(v,v+_);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}Bx.setPbf=function(a){hS=a};class Sz{constructor(t,r,c){this.tasks=t,this._onCancel=r,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,r){this._finalized||(this._onComplete(t,r),this._finalized=!0)}}Bx.performDecoding=function(a,t){const r=new Uint8Array(a);return Promise.all(t.tasks.map(c=>{const{layerName:d,firstByte:g,lastByte:_,pixelFormat:v,blockShape:S,blockIndex:T,filters:M,codec:A}=c,z=r.subarray(g,_+1),D=new Uint32Array(S[0]*S[1]*S[2]);let k;if(A!=="gzip_data")throw new Ua(`Unhandled codec: ${A}`);return k=(function($,H){if(!globalThis.DecompressionStream&&H==="gzip_data")return Promise.resolve((ue=(function(ye){ye[0]==31&&ye[1]==139&&ye[2]==8||_l(6,"invalid gzip data");var me=ye[3],we=10;4&me&&(we+=2+(ye[10]|ye[11]<<8));for(var Ie=(me>>3&1)+(me>>4&1);Ie>0;Ie-=!ye[we++]);return we+(2&me)})(j=$),ue+8>j.length&&_l(6,"invalid gzip data"),(function(ye,me,we,Ie){var Je=ye.length;if(!Je||me.f&&!me.l)return we||new _a(0);var qe=!we,Xe=qe||me.i!=2,at=me.i;qe&&(we=new _a(3*Je));var nt=function(qo){var Yl=we.length;if(qo>Yl){var Ro=new _a(Math.max(2*Yl,qo));Ro.set(we),we=Ro}},ot=me.f||0,Ge=me.p||0,ct=me.b||0,et=me.l,ut=me.d,lt=me.m,Bt=me.n,Ut=8*Je;do{if(!et){ot=gl(ye,Ge,1);var Tt=gl(ye,Ge+1,3);if(Ge+=3,!Tt){var Mt=ye[(cn=w$(Ge)+4)-4]|ye[cn-3]<<8,li=cn+Mt;if(li>Je){at&&_l(0);break}Xe&&nt(ct+Mt),we.set(ye.subarray(cn,li),ct),me.b=ct+=Mt,me.p=Ge=8*li,me.f=ot;continue}if(Tt==1)et=x$,ut=b$,lt=9,Bt=5;else if(Tt==2){var Yt=gl(ye,Ge,31)+257,Ct=gl(ye,Ge+10,15)+4,bi=Yt+gl(ye,Ge+5,31)+1;Ge+=14;for(var qi=new _a(bi),pn=new _a(19),Hi=0;Hi<Ct;++Hi)pn[_$[Hi]]=gl(ye,Ge+3*Hi,7);Ge+=3*Ct;var Pn=cS(pn),an=(1<<Pn)-1,wr=jg(pn,Pn);for(Hi=0;Hi<bi;){var cn,In=wr[gl(ye,Ge,an)];if(Ge+=15&In,(cn=In>>4)<16)qi[Hi++]=cn;else{var Jn=0,or=0;for(cn==16?(or=3+gl(ye,Ge,3),Ge+=2,Jn=qi[Hi-1]):cn==17?(or=3+gl(ye,Ge,7),Ge+=3):cn==18&&(or=11+gl(ye,Ge,127),Ge+=7);or--;)qi[Hi++]=Jn}}var sr=qi.subarray(0,Yt),Sr=qi.subarray(Yt);lt=cS(sr),Bt=cS(Sr),et=jg(sr,lt),ut=jg(Sr,Bt)}else _l(1);if(Ge>Ut){at&&_l(0);break}}Xe&&nt(ct+131072);for(var vo=(1<<lt)-1,Ao=(1<<Bt)-1,Ur=Ge;;Ur=Ge){var Wr=(Jn=et[uS(ye,Ge)&vo])>>4;if((Ge+=15&Jn)>Ut){at&&_l(0);break}if(Jn||_l(2),Wr<256)we[ct++]=Wr;else{if(Wr==256){Ur=Ge,et=null;break}var Kr=Wr-254;Wr>264&&(Kr=gl(ye,Ge,(1<<(dr=pz[Hi=Wr-257]))-1)+yz[Hi],Ge+=dr);var $i=ut[uS(ye,Ge)&Ao],ar=$i>>4;if($i||_l(3),Ge+=15&$i,Sr=v$[ar],ar>3){var dr=mz[ar];Sr+=uS(ye,Ge)&(1<<dr)-1,Ge+=dr}if(Ge>Ut){at&&_l(0);break}Xe&&nt(ct+131072);var js=ct+Kr;if(ct<Sr){var Wo=0-Sr,xo=Math.min(Sr,js);for(Wo+ct<0&&_l(3);ct<xo;++ct)we[ct]=Ie[Wo+ct]}for(;ct<js;++ct)we[ct]=we[ct-Sr]}}me.l=et,me.p=Ur,me.b=ct,me.f=ot,et&&(ot=1,me.m=lt,me.d=ut,me.n=Bt)}while(!ot);return ct!=we.length&&qe?(function(qo,Yl,Ro){return(Ro==null||Ro>qo.length)&&(Ro=qo.length),new _a(qo.subarray(0,Ro))})(we,0,ct):we.subarray(0,ct)})(j.subarray(ue,-8),{i:2},new _a(((Y=j)[(te=Y.length)-4]|Y[te-3]<<8|Y[te-2]<<16|Y[te-1]<<24)>>>0),X)));var j,X,Y,te,ue;const le=I$[H];if(!le)throw new Error(`Unhandled codec: ${H}`);const ge=new globalThis.DecompressionStream(le);return new Response(new Blob([$]).stream().pipeThrough(ge)).arrayBuffer().then(ye=>new Uint8Array(ye))})(z,A).then($=>((function(H,j){H.readFields(h$,j)})(new hS($),D),new A$[v](D.buffer))),k.then($=>{for(let H=M.length-1;H>=0;H--)switch(M[H]){case"delta_filter":f$($,S);break;case"zigzag_filter":p$($);break;case"bitshuffle_filter":m$($,v);break;default:throw new Ua(`Unhandled filter "${M[H]}"`)}return{layerName:d,blockIndex:T,data:$}}).catch($=>{throw $})}))},jt(Sz,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),jt(Bx,"MapboxRasterTile"),jt(wz,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Tz{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const c=t[r];this._stringToNumber[c]=r,this._numberToString[r]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class Ez{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xc(It,16,0),this.featureIndexArray=new kh,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,r,c,d,g,_=0,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,g,_);const T=this.grid;for(let M=0;M<r.length;M++){const A=r[M],z=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const k=A[D];z[0]=Math.min(z[0],k.x),z[1]=Math.min(z[1],k.y),z[2]=Math.max(z[2],k.x),z[3]=Math.max(z[3],k.y)}v!==0&&(z[0]-=v,z[1]-=v,z[2]+=v,z[3]+=v),z[0]<It&&z[1]<It&&z[2]>=0&&z[3]>=0&&T.insert(S,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wn(new mx(this.rawTileData)).layers,this.sourceLayerCoder=new Tz(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r){const{tilespaceGeometry:c,transform:d,tileTransform:g,pixelPosMatrix:_,availableImages:v,worldview:S}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const T=r.queryRadius?r.queryRadius:0,M=c.bufferedTilespaceBounds,A=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,($,H,j,X)=>Ba(c.bufferedTilespaceGeometry,$-T,H-T,j+T,X+T));A.sort(P$);let z=null;d.elevation&&A.length>0&&(z=Cf.create(d.elevation,this.tileID));const D={};let k;for(let $=0;$<A.length;$++){const H=A[$];if(H===k)continue;k=H;const j=this.featureIndexArray.get(H);let X=null;this.is3DTile?this.loadMatchingModelFeature(D,j,t,c,d,S):this.loadMatchingFeature(D,j,t,v,S,(Y,te,ue,le=0)=>(X||(X=pi(Y,this.tileID.canonical,g)),te.queryIntersectsFeature(c,Y,ue,X,this.z,d,_,z,le,r.scope)))}return D}loadMatchingFeature(t,r,c,d,g,_){const{featureIndex:v,bucketIndex:S,sourceLayerIndex:T,layoutVertexArrayOffset:M}=r,A=this.bucketLayerIDs[S],z=c.layers,D=Object.keys(z);if(D.length&&!Gi(D,A))return;const k=c.sourceCache,$=this.sourceLayerCoder.decode(T),H=this.vtLayers[$].feature(v),j=this.getId(H,$);for(let X=0;X<A.length;X++){const Y=A[X];if(!z[Y])continue;const{styleLayer:te,targets:ue}=z[Y];let le={};j!==void 0&&(le=k.getFeatureState(te.sourceLayer,j));const ge=!_||_(H,te,le,M);if(!ge)continue;const ye=new Xh(H,this.z,this.x,this.y,j);ye.tile=this.tileID.canonical,ye.state=le;let me=this.serializedLayersCache.get(Y);me||(me=te.serialize(),me.id=Y,this.serializedLayersCache.set(Y,me)),ye.source=me.source,ye.sourceLayer=me["source-layer"],ye.layer=Object.assign({},me),ye.layer.paint=Iz(me.paint,te.paint,H,le,d),ye.layer.layout=Iz(me.layout,te.layout,H,le,d);let we=!1;for(const Ie of ue){this.updateFeatureProperties(ye,Ie);const{filter:Je}=Ie;if(Je){if(H.properties=ye.properties,Je.needGeometry){const qe=Ni(H,!0);if(!Je.filter(new An(this.tileID.overscaledZ,{worldview:g}),qe,this.tileID.canonical))continue}else if(!Je.filter(new An(this.tileID.overscaledZ,{worldview:g}),H))continue}we=!0,Ie.targetId&&this.addFeatureVariant(ye,Ie)}we&&this.appendToResult(t,Y,v,ye,ge)}}loadMatchingModelFeature(t,r,c,d,g,_){const{featureIndex:v,bucketIndex:S}=r,T=this.bucketLayerIDs[S],M=c.layers,A=Object.keys(M);if(!A.length||Gi(A,T))for(let z=0;z<T.length;z++){const D=T[z],{styleLayer:k,targets:$}=M[D];if(k.type!=="model")continue;const H=d.tile,j=H.getBucket(k);if(!(j&&j instanceof Lx))continue;const X=O5(j,v,d,g);if(!X)continue;const{z:Y,x:te,y:ue}=H.tileID.canonical,{feature:le,intersectionZ:ge,position:ye}=X;let me={};le.id!==void 0&&(me=c.sourceCache.getFeatureState(k.sourceLayer,le.id));const we=new Xh({},Y,te,ue,le.id);we.tile=this.tileID.canonical,we.state=me,we.properties=le.properties,we.geometry={type:"Point",coordinates:[ye.lng,ye.lat]};let Ie=this.serializedLayersCache.get(D);Ie||(Ie=k.serialize(),Ie.id=D,this.serializedLayersCache.set(D,Ie)),we.source=Ie.source,we.sourceLayer=Ie["source-layer"],we.layer=Object.assign({},Ie);let Je=!1;for(const qe of $){this.updateFeatureProperties(we,qe);const{filter:Xe}=qe;if(Xe){if(le.properties=we.properties,Xe.needGeometry){if(!Xe.filter(new An(this.tileID.overscaledZ,{worldview:_}),le,this.tileID.canonical))continue}else if(!Xe.filter(new An(this.tileID.overscaledZ,{worldview:_}),le))continue}Je=!0,qe.targetId&&this.addFeatureVariant(we,qe)}Je&&this.appendToResult(t,D,v,we,ge)}}updateFeatureProperties(t,r,c){if(r.properties){const d={};for(const g in r.properties){const _=r.properties[g].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,c);_!=null&&(d[g]=_)}t.properties=d}}addFeatureVariant(t,r,c){const d={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(d.properties=t.properties),t.variants=t.variants||{},t.variants[r.targetId]=t.variants[r.targetId]||[],t.variants[r.targetId].push(d)}appendToResult(t,r,c,d,g){let _=t[r];_===void 0&&(_=t[r]=[]),_.push({featureIndex:c,feature:d,intersectionZ:g})}lookupSymbolFeatures(t,r,c,d,g,_){const v={};this.loadVTLayers();for(const S of t)this.loadMatchingFeature(v,{bucketIndex:r,sourceLayerIndex:c,featureIndex:S,layoutVertexArrayOffset:0},d,g,_);return v}loadFeature(t){const{featureIndex:r,sourceLayerIndex:c}=t;this.loadVTLayers();const d=this.sourceLayerCoder.decode(c),g=this.vtFeatures[d];if(g[r])return g[r];const _=this.vtLayers[d].feature(r);return g[r]=_,_}hasLayer(t){for(const r of this.bucketLayerIDs)for(const c of r)if(t===c)return!0;return!1}getId(t,r){let c=t.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const g=Ul(d);if(g.result!=="success"){const _=g.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void vi(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=g.value}c=this.promoteIdExpression.evaluate({zoom:0},t)}else c=t.properties[d];typeof c=="boolean"&&(c=Number(c))}return c}}function Iz(a,t,r,c,d){return ri(a,(g,_)=>{const v=t instanceof $o?t.get(_):null;return v&&v.evaluate?v.evaluate(r,c,void 0,d):v})}function P$(a,t){return t-a}jt(Ez,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Mz=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dS{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,c]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=c>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=Mz[15&c];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new dS(v,_,g,t)}constructor(t,r=64,c=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=Mz.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${c}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+S,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+S),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+S,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=r,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return fS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:v}=this,S=[0,g.length-1,0],T=[];for(;S.length;){const M=S.pop()||0,A=S.pop()||0,z=S.pop()||0;if(A-z<=v){for(let H=z;H<=A;H++){const j=_[2*H],X=_[2*H+1];j>=t&&j<=c&&X>=r&&X<=d&&T.push(g[H])}continue}const D=z+A>>1,k=_[2*D],$=_[2*D+1];k>=t&&k<=c&&$>=r&&$<=d&&T.push(g[D]),(M===0?t<=k:r<=$)&&(S.push(z),S.push(D-1),S.push(1-M)),(M===0?c>=k:d>=$)&&(S.push(D+1),S.push(A),S.push(1-M))}return T}within(t,r,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:_}=this,v=[0,d.length-1,0],S=[],T=c*c;for(;v.length;){const M=v.pop()||0,A=v.pop()||0,z=v.pop()||0;if(A-z<=_){for(let H=z;H<=A;H++)Pz(g[2*H],g[2*H+1],t,r)<=T&&S.push(d[H]);continue}const D=z+A>>1,k=g[2*D],$=g[2*D+1];Pz(k,$,t,r)<=T&&S.push(d[D]),(M===0?t-c<=k:r-c<=$)&&(v.push(z),v.push(D-1),v.push(1-M)),(M===0?t+c>=k:r+c>=$)&&(v.push(D+1),v.push(A),v.push(1-M))}return S}}function fS(a,t,r,c,d,g){if(d-c<=r)return;const _=c+d>>1;Az(a,t,_,c,d,g),fS(a,t,r,c,_-1,1-g),fS(a,t,r,_+1,d,1-g)}function Az(a,t,r,c,d,g){for(;d>c;){if(d-c>600){const T=d-c+1,M=r-c+1,A=Math.log(T),z=.5*Math.exp(2*A/3),D=.5*Math.sqrt(A*z*(T-z)/T)*(M-T/2<0?-1:1);Az(a,t,r,Math.max(c,Math.floor(r-M*z/T+D)),Math.min(d,Math.floor(r+(T-M)*z/T+D)),g)}const _=t[2*r+g];let v=c,S=d;for(Hg(a,t,c,r),t[2*d+g]>_&&Hg(a,t,c,d);v<S;){for(Hg(a,t,v,S),v++,S--;t[2*v+g]<_;)v++;for(;t[2*S+g]>_;)S--}t[2*c+g]===_?Hg(a,t,c,S):(S++,Hg(a,t,S,d)),S<=r&&(c=S+1),r<=S&&(d=S-1)}}function Hg(a,t,r,c){pS(a,r,c),pS(t,2*r,2*c),pS(t,2*r+1,2*c+1)}function pS(a,t,r){const c=a[t];a[t]=a[r],a[r]=c}function Pz(a,t,r,c){const d=a-r,g=t-c;return d*d+g*g}s.$=Zp,s.A=ns,s.B=wc,s.C=2,s.D=vf,s.E=al,s.F=Ag,s.G=KA,s.H=Ed,s.I=ts,s.J=_v,s.K=xi,s.L=fi,s.M=wm,s.N=Zd,s.O=Yy,s.P=Ae,s.Q=bh,s.R=es,s.S=rf,s.T=w1,s.U=Ul,s.V=Cx,s.W=Xd,s.X=eu,s.Y=Qc,s.Z=ph,s._=os,s.a=function(a){return jr.API_CDN_URL_REGEX.test(a)},s.a$=dt,s.a0=lh,s.a1=Ey,s.a2=Um,s.a3=class extends Cx{},s.a4=Wd,s.a5=bm,s.a6=ke,s.a7=function(a){const t=a.value;return t?lh(t)?tS(t,!0)?[]:[new Cx(a.key,t,`invalid url "${t}"`)]:[new Cx(a.key,t,`string expected, "${xi(t)}" found`)]:[]},s.a8=uu,s.a9=ur,s.aA=de,s.aB=ie,s.aC=Kt,s.aD=J,s.aE=Ss,s.aF=Re,s.aG=St,s.aH=function(a,t){const r={};for(let c=0;c<t.length;c++){const d=t[c];d in a&&(r[d]=a[d])}return r},s.aI=Se,s.aJ=Ze,s.aK=class{constructor(a){this.entries={},this.scheduler=a}request(a,t,r,c){const d=this.entries[a]=this.entries[a]||{callbacks:[]};if(d.result){const[g,_]=d.result;return this.scheduler?this.scheduler.add(()=>{c(g,_)},t):c(g,_),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=r((g,_)=>{d.result=[g,_];for(const v of d.callbacks)this.scheduler?this.scheduler.add(()=>{v(g,_)},t):v(g,_);setTimeout(()=>delete this.entries[a],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==c),d.callbacks.length||(d.cancel(),delete this.entries[a]))}}},s.aL=function(a,t,r){const c=JSON.stringify(a.request);return a.data&&(this.deduped.entries[c]={result:[null,a.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},d=>{const g=ih(a.request,(_,v,S)=>{_?d(_):v&&d(null,{rawData:v,vectorTile:r?void 0:new wn(new mx(v)),responseHeaders:new Map(S.entries())})});return()=>{g.cancel(),d()}},t)},s.aM=function(a){return a?{cacheControl:a.get("Cache-Control"),expires:a.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=eh,s.aO=function(a){Aa++,Aa>Bp&&(a.getActor().send("enforceCacheSizeLimit",vy),Aa=0)},s.aP=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log2(a)))},s.aQ=Zo,s.aR=CP,s.aS=FP,s.aT=he,s.aU=zP,s.aV=function(a,t){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let c=0;c<a.length;c++){const d=document.createElement("source");hw(a[c])||(r.crossOrigin="Anonymous"),d.src=a[c],r.appendChild(d)}return{cancel:()=>{}}},s.aW=Sg,s.aX=Jh,s.aY=Ft,s.aZ=Cg,s.a_=it,s.aa=bt,s.ab=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return vr(a.expression.evaluate(t))}interpolate(a,t,r){return{x:di(a.x,t.x,r),y:di(a.y,t.y,r),z:di(a.z,t.z,r),azimuthal:di(a.azimuthal,t.azimuthal,r),polar:di(a.polar,t.polar,r)}}},s.ac=An,s.ad=vc,s.ae=Pt,s.af=qt,s.ag=_t,s.ah=Me,s.ai=$o,s.aj=xu,s.ak=di,s.al=It,s.am=Vp,s.an=ii,s.ao=bn,s.ap=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return(function([r,c]){const d=vr([1,r,c]);return{x:d.x,y:d.y,z:d.z}})(a.expression.evaluate(t))}interpolate(a,t,r){return{x:di(a.x,t.x,r),y:di(a.y,t.y,r),z:di(a.z,t.z,r)}}},s.aq=function(a,t,r=0,c=!0){const d=new Ae(r,r),g=a.sub(d),_=t.add(d),v=[g,new Ae(_.x,g.y),_,new Ae(g.x,_.y)];return c&&v.push(g.clone()),v},s.ar=function(a,t){const r=[];for(let c=0;c<a.length;c++){const d=Oe(c-1,-1,a.length-1),g=Oe(c+1,-1,a.length-1),_=a[c],v=a[g],S=a[d].sub(_).unit(),T=v.sub(_).unit(),M=T.angleWithSep(S.x,S.y),A=S.add(T).unit().mult(-1*t/Math.sin(M/2));r.push(_.add(A))}return r},s.as=mP,s.at=Ba,s.au=function(a,t,r=0){return yt(((t.x-r)*a.scale-a.x)*It,(t.y*a.scale-a.y)*It,Fe(t.z,t.y))},s.av=Le,s.aw=Di,s.ax=Nn,s.ay=MA,s.az=function(a){let t=1/0,r=1/0,c=-1/0,d=-1/0;for(const g of a)t=Math.min(t,g.x),r=Math.min(r,g.y),c=Math.max(c,g.x),d=Math.max(d,g.y);return{min:new Ae(t,r),max:new Ae(c,d)}},s.b=function(a){return jr.API_FONTS_REGEX.test(a)},s.b$=SM,s.b0=Hr,s.b1=fl,s.b2=gt,s.b3=Iv,s.b4=Mx,s.b5=function(){ma.isLoading()||ma.isLoaded()||Fm()!=="deferred"||Bm()},s.b6=$m,s.b7=Ni,s.b8=Xh,s.b9=Qn,s.bA=fe,s.bB=Ye,s.bC=ee,s.bD=function(a,t){const{x:r,y:c}=a.point,d=B2(r,c,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ie(d,d,Gw(ql(t)))},s.bE=O,s.bF=zi,s.bG=Un,s.bH=Rn,s.bI=hn,s.bJ=Ii,s.bK=If,s.bL=Vs,s.bM=N1,s.bN=function(a,t,r,c,d){const g=5*t+2;a.float32[g+0]=r,a.float32[g+1]=c,a.float32[g+2]=d},s.bO=zf,s.bP=Ks,s.bQ=_s,s.bR=Qs,s.bS=Ml,s.bT=Oe,s.bU=function(a,t,r,c){var d=new C(4);return d[0]=a,d[1]=t,d[2]=r,d[3]=c,d},s.bV=class{isDataAvailableAtPoint(a){const t=this._source();if(this.isUsingMockSource()||!t||a.y<0||a.y>1)return!1;const r=t.getSource().maxzoom,c=1<<r,d=Math.floor(a.x),g=Math.floor((a.x-d)*c),_=Math.floor(a.y*c),v=this.findDEMTileFor(new Zo(r,d,r,g,_));return!(!v||!v.dem)}getAtPointOrZero(a,t=0){return this.getAtPoint(a,t)||0}getAtPoint(a,t,r=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||a.y<0||a.y>1)return t;const d=c.getSource().maxzoom,g=1<<d,_=Math.floor(a.x),v=a.x-_,S=new Zo(d,_,d,Math.floor(v*g),Math.floor(a.y*g)),T=this.findDEMTileFor(S);if(!T||!T.dem)return t;const M=T.dem,A=1<<T.tileID.canonical.z,z=(v*A-T.tileID.canonical.x)*M.dim,D=(a.y*A-T.tileID.canonical.y)*M.dim,k=Math.floor(z),$=Math.floor(D);return(r?this.exaggeration():1)*di(di(M.get(k,$),M.get(k,$+1),D-$),di(M.get(k+1,$),M.get(k+1,$+1),D-$),z-k)}static getAtTileOffset(a,t,r,c){const d=1<<a.canonical.z;return c?c.pointElevation(t):r?r.getAtPointOrZero(new Pt(a.wrap+(a.canonical.x+t.x/It)/d,(a.canonical.y+t.y/It)/d)):0}static getAtTileOffsetFunc(a,t,r,c){return(d,g,_)=>{const v=this.getAtTileOffset(a,d,g,_),S=c.upVector(a.canonical,d.x,d.y);return wi(S,S,v*c.upVectorScale(a.canonical,t,r).metersToTile),S}}getForTilePoints(a,t,r,c){if(this.isUsingMockSource())return!1;const d=Cf.create(this,a,c);return!!d&&(t.forEach(g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],r)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(a);if(!t||!t.dem)return null;const r=t.dem.tree,c=t.tileID,d=1<<a.canonical.z-c.canonical.z;let g=a.canonical.x/d-c.canonical.x,_=a.canonical.y/d-c.canonical.y,v=0;for(let S=0;S<a.canonical.z-c.canonical.z&&!r.leaves[v];S++){g*=2,_*=2;const T=2*Math.floor(_)+Math.floor(g);v=r.childOffsets[v]+T,g%=1,_%=1}return{min:this.exaggeration()*r.minimums[v],max:this.exaggeration()*r.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let t=!1,r=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const d of a){const g=this.getMinMaxForTile(d.tileID);g&&(r=Math.min(r,g.min),c=Math.max(c,g.max),t=!0)}return t?{min:r,max:c}:null}},s.bW=rx,s.bX=rr,s.bY=so,s.bZ=vM,s.b_=BP,s.ba=C1,s.bb=a1,s.bc=pi,s.bd=Zl,s.be=Lh,s.bf=L2,s.bg=er,s.bh=mf,s.bi=K1,s.bj=function(a,t){const r=xu(t.zoom);if(r===0)return ql(a);const c=Gv(a),d=jw(c),g=Re(c.getWest())*t.worldSize,_=Re(c.getEast())*t.worldSize,v=Ze(c.getNorth())*t.worldSize,S=Ze(c.getSouth())*t.worldSize,T=[g,v,0],M=[_,v,0],A=[g,S,0],z=[_,S,0],D=ae([],t.globeMatrix);return qt(T,T,D),qt(M,M,D),qt(A,A,D),qt(z,z,D),d[0]=Ic(d[0],A,r),d[1]=Ic(d[1],z,r),d[2]=Ic(d[2],M,r),d[3]=Ic(d[3],T,r),yn.fromPoints(d)},s.bk=Zv,s.bl=ae,s.bm=og,s.bn=Ic,s.bo=dl,s.bp=$4,s.bq=At,s.br=tt,s.bs=Bx,s.bt=mx,s.bu=ih,s.bv=function(a,t){const r=[];for(const c in a)c in t||r.push(c);return r},s.bw=Pe,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=Ot,s.bz=se,s.c=zo,s.c$=function(a,t,r){let c=0;for(let d=0;d<2;++d)a[d]>0&&(c+=(a[d]-0)*(a[d]-0)),t[d]<0&&(c+=(0-t[d])*(0-t[d]));return c},s.c0=TM,s.c1=O1,s.c2=sP,s.c3=G1,s.c4=dS,s.c5=wi,s.c6=Jt,s.c7=Xi,s.c8=function(a,t,r){r*=.5;var c=t[0],d=t[1],g=t[2],_=t[3],v=Math.sin(r),S=Math.cos(r);return a[0]=c*S+d*v,a[1]=d*S-c*v,a[2]=g*S+_*v,a[3]=_*S-g*v,a},s.c9=Vi,s.cA=Qe,s.cB=ro,s.cC=dA,s.cD=Uh,s.cE=k2,s.cF=function(a,t,r,c,d,g,_,v,S){if(S.name==="globe")return k2(a,t,new Uh(r,c,d),!1);const T=Cg({z:r,x:c,y:d},S);return new yn([(g+T.x/T.scale)*t,t*(T.y/T.scale),_],[(g+T.x2/T.scale)*t,t*(T.y2/T.scale),v])},s.cG=function(a,t,r){return a[0]=Math.min(t[0],r[0]),a[1]=Math.min(t[1],r[1]),a[2]=Math.min(t[2],r[2]),a[3]=Math.min(t[3],r[3]),a},s.cH=function(a,t,r){return a[0]=Math.max(t[0],r[0]),a[1]=Math.max(t[1],r[1]),a[2]=Math.max(t[2],r[2]),a[3]=Math.max(t[3],r[3]),a},s.cI=function(a){const t=Math.round((a+45+360)%360/90)%4;return Z[t]},s.cJ=Te,s.cK=oi,s.cL=6,s.cM=function(a){const t=fe(new Float64Array(16));ie(t,a.pixelMatrix,a.globeMatrix);const r=[0,re,0],c=[0,ne,0];return qt(r,r,t),qt(c,c,t),[r[0]>0&&r[0]<=a.width&&r[1]>0&&r[1]<=a.height&&!Zw(a,new he(a.center.lat,90)),c[0]>0&&c[0]<=a.width&&c[1]>0&&c[1]<=a.height&&!Zw(a,new he(a.center.lat,-90))]},s.cN=function(a,t){const{scale:r}=a.tileTransform,c=r*It/(a.tileSize*Math.pow(2,t.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return(function(d,g,_){var v=g[1],S=g[2],T=g[3],M=_[0],A=_[1];return d[0]=g[0]*M,d[1]=v*M,d[2]=S*A,d[3]=T*A,d})(new Float32Array(4),t.inverseAdjustmentMatrix,[c,c])},s.cO=cx,s.cP=Dt,s.cQ=hA,s.cR=function(a){const t=hA(a,!0);return O([],[t[0],t[1],t[4],t[5]])},s.cS=Ue,s.cT=hr,s.cU=Ne,s.cV=function(a){const{x:t,y:r}=a.point,{lng:c,lat:d}=a._center;return B2(t,r,a.worldSize,c,d)},s.cW=Pi,s.cX=Ee,s.cY=pf,s.cZ=Na,s.c_=5,s.ca=nr,s.cb=function(a,t){return a[0]=-t[0],a[1]=-t[1],a[2]=-t[2],a[3]=t[3],a},s.cc=Et,s.cd=function(a,t,r,c,d){var g=1/Math.tan(t/2);if(a[0]=g/r,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,d!=null&&d!==1/0){var _=1/(c-d);a[10]=(d+c)*_,a[14]=2*d*c*_}else a[10]=-1,a[14]=-2*c;return a},s.ce=function(a,t,r,c,d,g,_){var v=1/(t-r),S=1/(c-d),T=1/(g-_);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*S,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*T,a[11]=0,a[12]=(t+r)*v,a[13]=(d+c)*S,a[14]=(_+g)*T,a[15]=1,a},s.cf=je,s.cg=function(a,t,r){a[4*t+0]=r[0],a[4*t+1]=r[1],a[4*t+2]=r[2],a[4*t+3]=r[3]},s.ch=Fs,s.ci=Bh,s.cj=zr,s.ck=Bs,s.cl=_u,s.cm=xP,s.cn=function(){var a=new C(4);return C!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.co=function(a,t,r){var c=t[0],d=t[1],g=t[2],_=t[3],v=Math.sin(r),S=Math.cos(r);return a[0]=c*S+g*v,a[1]=d*S+_*v,a[2]=c*-v+g*S,a[3]=d*-v+_*S,a},s.cp=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]},s.cq=Ve,s.cr=function(a){var t=a[0],r=a[1],c=a[2],d=a[3];return Math.sqrt(t*t+r*r+c*c+d*d)},s.cs=Il,s.ct=ji,s.cu=C2,s.cv=3,s.cw=2,s.cx=7,s.cy=6,s.cz=ti,s.d=function(a){return jr.API_TILEJSON_REGEX.test(a)},s.d$=class{constructor(a,t,r,c){this.context=a,this.format=c,this.size=r,this.texture=a.gl.createTexture();const[d,g,_]=this.size,{gl:v}=a;v.bindTexture(v.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in t&&t.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,d,g,_,0,x1(this.format),b1(this.format),t.data)}bind(a,t){const{context:r}=this,{gl:c}=r;c.bindTexture(c.TEXTURE_3D,this.texture),a!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,a),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,a),this.minFilter=a),t!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},s.d0=function(a){return a*a*a*a*a},s.d1=ze,s.d2=45,s.d3=df,s.d4=function(a,t,r){const c=Math.sqrt(a*a+t*t+r*r),d=c>0?Math.acos(r/c)*Cn:0;let g=a!==0||t!==0?Math.atan2(-t,-a)*Cn+90:0;return g<0&&(g+=360),[c,g,d]},s.d5=yt,s.d6=vr,s.d7=vt,s.d8=ei,s.d9=yn,s.dA=function(a){return a({pluginStatus:Uo,pluginURL:Gl}),Om.on("pluginStateChange",a),a},s.dB=$v,s.dC=class extends ga{constructor(a){super(a),this.current=E2}set(a,t,r){if(this.fetchUniformLocation(a,t)){for(let c=0;c<9;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.dD=Q,s.dE=function(a,t,r){const c=xu(r.zoom),d=a.style.map._antialias,g=a.terrain&&a.terrain.exaggeration()>0;return c===0&&!d&&!g},s.dF=function(a){const t=a.pixelsPerMeter,r=t/je(1,a.center.lat),c=fe(new Float64Array(16));return tt(c,c,[a.point.x,a.point.y,0]),Ue(c,c,[r,r,t]),Float32Array.from(c)},s.dG=Gv,s.dH=function(a){const t=80.051129;a=de(a,-80.051129,t)/t*90;const r=Math.pow(Math.abs(Math.sin(ii(a))),3);return Math.round(r*(oe.length-1))},s.dI=function(a,t,r,c){const d=t.getNorth(),g=t.getSouth(),_=t.getWest(),v=t.getEast(),S=1<<a.z,T=v-_,M=d-g,A=T/K,z=-M/oe[r],D=[0,A,0,z,0,0,d,_,0];if(a.z>0){const k=180/c;q(D,D,[k/T+1,0,0,0,k/M+1,0,-.5*k/A,.5*k/z,1])}return D[2]=S,D[5]=a.x,D[8]=a.y,D},s.dJ=ql,s.dK=function(a,t,r){const c=fe(new Float64Array(16)),d=(t/(1<<a)-.5)*Math.PI*2;return Ce(c,r.globeMatrix,d),Float32Array.from(c)},s.dL=Y2,s.dM=jv,s.dN=function(a,t){return[Math.pow(a[0],2.2)*t,Math.pow(a[1],2.2)*t,Math.pow(a[2],2.2)*t]},s.dO=F,s.dP=function(a,t){var r=Math.sin(t),c=Math.cos(t);return a[0]=c,a[1]=r,a[2]=0,a[3]=-r,a[4]=c,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.dQ=hi,s.dR=F2,s.dS=gr,s.dT=To,s.dU=Q1,s.dV=function(a,t){const r=[0,0,0];return qt(r,r,Zv(ql(t.canonical))),qt(r,r,a),r},s.dW=a=>({u_matrix:new _u(a),u_texsize:new Bs(a),u_pixels_to_tile_units:new n(a),u_device_pixel_ratio:new zr(a),u_width_scale:new zr(a),u_floor_width_scale:new zr(a),u_image:new Fs(a),u_units_to_pixels:new Bs(a),u_tile_units_to_pixels:new zr(a),u_alpha_discard_threshold:new zr(a),u_trim_offset:new Bs(a),u_trim_fade_range:new Bs(a),u_trim_gradient_mix_range:new Bs(a),u_trim_color:new df(a),u_zbias_factor:new zr(a),u_tile_to_meter:new zr(a),u_ground_shadow_factor:new Bh(a),u_pattern_transition:new zr(a)}),s.dX=a=>({u_matrix:new _u(a),u_pixels_to_tile_units:new n(a),u_device_pixel_ratio:new zr(a),u_width_scale:new zr(a),u_floor_width_scale:new zr(a),u_units_to_pixels:new Bs(a),u_dash_image:new Fs(a),u_gradient_image:new Fs(a),u_image_height:new zr(a),u_texsize:new Bs(a),u_tile_units_to_pixels:new zr(a),u_alpha_discard_threshold:new zr(a),u_trim_offset:new Bs(a),u_trim_fade_range:new Bs(a),u_trim_gradient_mix_range:new Bs(a),u_trim_color:new df(a),u_zbias_factor:new zr(a),u_tile_to_meter:new zr(a),u_ground_shadow_factor:new Bh(a)}),s.dY=a=>({u_camera_to_center_distance:new zr(a),u_extrude_scale:new n(a),u_device_pixel_ratio:new zr(a),u_matrix:new _u(a),u_inv_rot_matrix:new _u(a),u_merc_center:new Bs(a),u_tile_id:new Bh(a),u_zoom_transition:new zr(a),u_up_dir:new Bh(a),u_emissive_strength:new zr(a)}),s.dZ=af,s.d_=UU,s.da=mi,s.db=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},s.dc=uA,s.dd=A1,s.de=mA,s.df=tS,s.dg=function(a,t){return a.readFields(B5,{icons:[]},t)},s.dh=ox,s.di=Mf,s.dj=$1,s.dk=th,s.dl=pv,s.dm=Qu,s.dn=Zc,s.dp=Oi,s.dq=function(a){const t=a.indexOf(Ah);return t>=0?a.slice(0,t):a},s.dr=function(a){return a.indexOf(Ah)>=0},s.ds=function(a){const t=a.lastIndexOf(Ah);return t>=0?a.slice(t+1):""},s.dt=function(a){const t=[],r=a.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},s.du=function(a,t,r,c){return a.type==="custom"?new L5(a,t):new F5[a.type](a,t,r,c)},s.dv=ci,s.dw=function(a){const t=a.indexOf(Ah);return t>=0?a.slice(t+1):""},s.dx=class extends Xh{constructor(a,t){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},s.dy=Om,s.dz=ol,s.e=jr,s.e$=Nt,s.e0=$2,s.e1=(a,t,r,c,d,g)=>{const _=a.transform,v=_.projection.name==="globe";let S;if(g.paint.get("circle-pitch-alignment")==="map")if(v){const M=F2(_.zoom,t.canonical)*_._pixelsPerMercatorPixel;S=Float32Array.from([M,0,0,M])}else S=_.calculatePixelsToTileUnitsMatrix(r);else S=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(_.projection),u_matrix:a.translatePosMatrix(t.projMatrix,r,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Cs.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Z4,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(v){T.u_inv_rot_matrix=c,T.u_merc_center=d,T.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],T.u_zoom_transition=xu(_.zoom);const M=d[0]*It,A=d[1]*It;T.u_up_dir=_.projection.upVector(new Uh(0,0,0),M,A)}return T},s.e2=CA,s.e3=rs,s.e4=(a,t,r,c,d,g,_,v,S,T)=>{const M=a.transform,A=M.pitch<15?AA(.07,.7,de((14-M.zoom)/5,0,1)):.07,z=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:zA(a,t,r,c),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:PA(t,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:r.lut).toArray01(),u_zbias_factor:A,u_tile_to_meter:vt(t.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:T}},s.e5=(a,t,r,c,d,g,_,v,S,T)=>{const M=a.transform,A=M.calculatePixelsToTileUnitsMatrix(t),z=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",D=M.pitch<15?AA(.07,.7,de((14-M.zoom)/5,0,1)):.07;return{u_matrix:zA(a,t,r,c),u_pixels_to_tile_units:A,u_device_pixel_ratio:g,u_width_scale:_,u_floor_width_scale:v,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:LA(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:PA(t,a.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:r.lut).toArray01(),u_zbias_factor:D,u_tile_to_meter:vt(t.tileID.canonical,0),u_ground_shadow_factor:T}},s.e6=st,s.e7=sg,s.e8=Fe,s.e9=N4,s.eA=function(a,t){var r=2*Math.acos(t[3]),c=Math.sin(r/2);return c>P?(a[0]=t[0]/c,a[1]=t[1]/c,a[2]=t[2]/c):(a[0]=1,a[1]=0,a[2]=0),r},s.eB=rS,s.eC=dx,s.eD=hx,s.eE=[1,1,1],s.eF=Cf,s.eG=rt,s.eH=function(a,t,r,c){var d=t[0],g=t[1],_=t[2],v=t[3];return a[0]=d+c*(r[0]-d),a[1]=g+c*(r[1]-g),a[2]=_+c*(r[2]-_),a[3]=v+c*(r[3]-v),a},s.eI=Sf,s.eJ=Os,s.eK=Tc,s.eL=function(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$){var H=new C(16);return H[0]=a,H[1]=t,H[2]=r,H[3]=c,H[4]=d,H[5]=g,H[6]=_,H[7]=v,H[8]=S,H[9]=T,H[10]=M,H[11]=A,H[12]=z,H[13]=D,H[14]=k,H[15]=$,H},s.eM=ve,s.eN=Ch,s.eO=Qm,s.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ae(1/0,1/0),max:new Ae(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,t=!1){const r=bM(new Ae(0,0),new Ae(It,It),a),c=[];if(t&&!l1(r,this._globalClipBounds))return c;for(const d of this._activeRegions){if(d.hiddenByOverlap||!l1(r,d))continue;const g=AN(d.min,d.max,a);c.push({min:g.min,max:g.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return c}setSources(a){this._setSources(a.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const r=[];for(const c of t.cache.getVisibleCoordinates()){const d=t.cache.getTile(c).buckets[t.layer];d&&d.updateFootprints(c.toUnwrapped(),r)}return r},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(a){const t=a.getFootprints();if(t.length===0)return;const r=a.getOrder(),c=a.getClipMask(),d=a.getClipScope();for(const g of t){if(!g.footprint)continue;const _=bM(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:r,clipMask:c,clipScope:d})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,r)=>t.priority-r.priority||ex(t.min,r.min)||ex(t.max,r.max)||t.order-r.order||t.clipMask-r.clipMask||(function(c,d){const g=(_,v)=>_+v;return c.length-d.length||c.reduce(g,"").localeCompare(d.reduce(g,""))})(t.clipScope,r.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let t=0;for(;!a&&t!==this._activeRegions.length;){const r=this._activeRegions[t],c=this._prevRegions[t];a=r.priority!==c.priority||!xM(r,c)||r.order!==c.order||r.clipMask!==c.clipMask||!Ot(r.clipScope,c.clipScope),this._activeRegions[t].hiddenByOverlap=c.hiddenByOverlap,++t}}if(a){++this._updateTime;for(const r of this._activeRegions)r.order!==pg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const t=r=>{const c=this._activeRegions;if(r>=c.length)return r;const d=c[r].priority;for(;r<c.length&&c[r].priority===d;)++r;return r};if(this._sourceIds.length>1){let r=0,c=t(r);for(;r!==c;){let d=r;const g=r;for(;d!==c;){const _=this._activeRegions[d];_.hiddenByOverlap=!1;for(let v=0;v<g;v++){const S=this._activeRegions[v];if(!S.hiddenByOverlap&&_.order===pg&&l1(_,S)&&(_.hiddenByOverlap=wM(_.footprint,_.tileId,S.footprint,S.tileId),_.hiddenByOverlap))break}++d}r=c,c=t(r)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=a.length-1;t>=0;t--)this._addSource(a[t]);this._computeReplacement()}},s.eQ=pg,s.eR=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,t){const r=new Zl,c=new Hr,d=[],g=a+1+2,_=t[0]+1,v=t[0]+1+(1+t.length),S=(T,M,A)=>{let z=T===g-1?T-2:T===0?T:T-1;return z+=A?24575:0,[z,M]};for(let T=0;T<g;++T)r.emplaceBack(...S(T,0,!0));for(let T=0;T<_;++T)for(let M=0;M<g;++M)r.emplaceBack(...S(M,T,(M===0||M===g-1)&&!0));for(let T=0;T<t.length;++T){const M=t[T];for(let A=0;A<g;++A)r.emplaceBack(...S(A,M,!0))}for(let T=0;T<t.length;++T){const M=c.length,A=t[T]+1+2,z=new Hr;for(let $=0;$<A-1;$++){const H=$===A-2,j=H?g*(v-t.length+T-$):g;for(let X=0;X<g-1;X++){const Y=$*g+X;$===0||H||X===0||X===g-2?(z.emplaceBack(Y+1,Y,Y+j),z.emplaceBack(Y+j,Y+j+1,Y+1)):(c.emplaceBack(Y+1,Y,Y+j),c.emplaceBack(Y+j,Y+j+1,Y+1))}}const D=er.simpleSegment(0,M,r.length,c.length-M);for(let $=0;$<z.uint16.length;$+=3)c.emplaceBack(z.uint16[$],z.uint16[$+1],z.uint16[$+2]);const k=er.simpleSegment(0,M,r.length,c.length-M);d.push({withoutSkirts:D,withSkirts:k})}return{vertices:r,indices:c,segments:d}}_createGrid(a){const t=this._fillGridMeshWithLods(K,oe);this._gridSegments=t.segments,this._gridBuffer=a.createVertexBuffer(t.vertices,L2.members),this._gridIndexBuffer=a.createIndexBuffer(t.indices,!0)}_createPoles(a){const t=new Hr;for(let _=0;_<=K;_++)t.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=a.createIndexBuffer(t,!0);const r=new Sc,c=new Sc,d=new Sc,g=new Sc;this._poleSegments=[];for(let _=0,v=0;_<5;_++){const S=360/(1<<_);r.emplaceBack(0,-J,0,.5,0),c.emplaceBack(0,-J,0,.5,1),d.emplaceBack(0,-J,0,.5,.5),g.emplaceBack(0,-J,0,.5,.5);for(let T=0;T<=K;T++){let M=T/K,A=0;const z=di(0,S,M),[D,k,$]=be(G4,H4,z,J);r.emplaceBack(D,k,$,M,A),c.emplaceBack(D,k,$,M,1-A);const H=ii(z);M=.5+.5*Math.sin(H),A=.5+.5*Math.cos(H),d.emplaceBack(D,k,$,M,A),g.emplaceBack(D,k,$,M,1-A)}this._poleSegments.push(er.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(r,Vv,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(c,Vv,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(d,Vv,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(g,Vv,!1)}getGridBuffers(a,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},s.eS=MN,s.eT=ce,s.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eV=xe,s.eW=pt,s.eX=function(a,t,r){return a[0]=t[0]/r[0],a[1]=t[1]/r[1],a[2]=t[2]/r[2],a},s.eY=Wt,s.eZ=_e,s.e_=pr,s.ea=nx,s.eb=OM,s.ec=Ac,s.ed=450,s.ee=7,s.ef=We,s.eg=function(a,t){if(a===t){var r=t[1],c=t[2],d=t[3],g=t[6],_=t[7],v=t[11];a[1]=t[4],a[2]=t[8],a[3]=t[12],a[4]=r,a[6]=t[9],a[7]=t[13],a[8]=c,a[9]=g,a[11]=t[14],a[12]=d,a[13]=_,a[14]=v}else a[0]=t[0],a[1]=t[4],a[2]=t[8],a[3]=t[12],a[4]=t[1],a[5]=t[5],a[6]=t[9],a[7]=t[13],a[8]=t[2],a[9]=t[6],a[10]=t[10],a[11]=t[14],a[12]=t[3],a[13]=t[7],a[14]=t[11],a[15]=t[15];return a},s.eh=C5,s.ei=Ki,s.ej=ig,s.ek=256,s.el=Gw,s.em=ra,s.en=Ce,s.eo=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[4],a[4]=t[5],a[5]=t[6],a[6]=t[8],a[7]=t[9],a[8]=t[10],a},s.ep=Sc,s.eq=Wy,s.er=uf,s.es=function(a,t,r,c,d){return de((a-t)/(r-t)*(d-c)+c,c,d)},s.et=Ji,s.eu=function(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=t[4],v=t[5],S=t[6],T=t[7],M=t[8],A=M*_-v*T,z=-M*g+v*S,D=T*g-_*S,k=r*A+c*z+d*D;return k?(a[0]=A*(k=1/k),a[1]=(-M*c+d*T)*k,a[2]=(v*c-d*_)*k,a[3]=z*k,a[4]=(M*r-d*S)*k,a[5]=(-v*r+d*g)*k,a[6]=D*k,a[7]=(-T*r+c*S)*k,a[8]=(_*r-c*g)*k,a):null},s.ev=2,s.ew=zn,s.ex=Wi,s.ey=wt,s.ez=function(a,t){var r=new C(3);wt(r,t);var c=1/r[0],d=1/r[1],g=1/r[2],_=t[0]*c,v=t[1]*d,S=t[2]*g,T=t[4]*c,M=t[5]*d,A=t[6]*g,z=t[8]*c,D=t[9]*d,k=t[10]*g,$=_+M+k,H=0;return $>0?(H=2*Math.sqrt($+1),a[3]=.25*H,a[0]=(A-D)/H,a[1]=(z-S)/H,a[2]=(v-T)/H):_>M&&_>k?(H=2*Math.sqrt(1+_-M-k),a[3]=(A-D)/H,a[0]=.25*H,a[1]=(v+T)/H,a[2]=(z+S)/H):M>k?(H=2*Math.sqrt(1+M-_-k),a[3]=(z-S)/H,a[0]=(v+T)/H,a[1]=.25*H,a[2]=(A+D)/H):(H=2*Math.sqrt(1+k-_-M),a[3]=(v-T)/H,a[0]=(z+S)/H,a[1]=(A+D)/H,a[2]=.25*H),a},s.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(t,r)=>String.fromCharCode(+("0x"+r))))},s.f0=function([a,t,r]){const c=Math.hypot(a,t,r),d=Math.atan2(a,r),g=.5*Math.PI-Math.acos(-t/c);return new he(Ee(d),Ee(g))},s.f1=Si,s.f2=S1,s.f3=function(a){const t=a.navigator?a.navigator.userAgent:null;return!!(function(r){if(sn==null){const c=r.navigator?r.navigator.userAgent:null;sn=!!r.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return sn})(a)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f4=function(a,t){vy=a,Bp=t},s.f5=Zw,s.f6=N2,s.f7=function(a){const t=[0,0,0],r=fe(new Float64Array(16));return ie(r,a.pixelMatrix,a.globeMatrix),qt(t,t,r),new Ae(t[0],t[1])},s.f8=function(){const a=xg;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(p1),xg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f9=function(){ox().acquire(p1)},s.fA=Fx,s.fB=en,s.fC=function(a){let t=0;if(new Uint32Array(a,0,1)[0]!==oA){const r=new Uint32Array(a,0,7),[,,c,d,g,_]=r;t=r.byteLength+d+g+_+g,(c!==a.byteLength||t>=a.byteLength)&&vi("Invalid b3dm header information.")}return cA(a,t)},s.fD=function(a,t){const r=A1(a);for(const c of r){for(const d of c.meshes)lU(d);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(cU(c.lights,t)))}return r},s.fE=Lx,s.fF=xr,s.fG=qM,s.fH=ma,s.fI=ss,s.fJ=function(a){Rs(),_o!=null&&_o.then(t=>{t.keys().then(r=>{for(let c=0;c<r.length-a;c++)t.delete(r[c]).catch(d=>vi(d.message))}).catch(r=>vi(r.message))}).catch(t=>vi(t.message))},s.fa=Fm,s.fb=function(a,t,r=!1){if(Uo===ss.deferred||Uo===ss.loading||Uo===ss.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Gl=Cs.resolveURL(a),Uo=ss.deferred,jl=t,km(),r||Bm()},s.fc=function(a){xf=Cs.resolveURL(a),bf||(bf=new vf(ox(),new al)),bf.broadcast("setMeshoptUrl",xf)},s.fd=YM,s.fe=function(a){_1=Cs.resolveURL(a),bf||(bf=new vf(ox(),new al)),bf.broadcast("setDracoUrl",_1)},s.ff=JM,s.fg=vg,s.fh=function(a){const t=rl();if(!t)return;const r=t.delete(yy);a&&r.then(()=>a()).catch(a)},s.fi=jh,s.fj=jt,s.fk=bu,s.fl=2,s.fm=Tz,s.fn=Ez,s.fo=TA,s.fp=tn,s.fq="hd_road_elevation",s.fr=Go,s.fs=ri,s.ft=Mc,s.fu=U1,s.fv=1,s.fw=function(a,t,r,c,d,g,_,v=1,S,T,M,A){a.createArrays(),a.tilePixelRatio=It/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const z=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,k={};k.scaleFactor=v,k.textSizeScaleRange=z.get("text-size-scale-range"),k.iconSizeScaleRange=z.get("icon-size-scale-range");const[$,H]=k.textSizeScaleRange,[j,X]=k.iconSizeScaleRange;k.textScaleFactor=de(k.scaleFactor,$,H),k.iconScaleFactor=de(k.scaleFactor,j,X);const Y=D["text-size"],te=D["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:we,maxZoom:Ie}=a.textSizeData;k.compositeTextSizes=[Y.possiblyEvaluate(new An(we,{worldview:M}),g),Y.possiblyEvaluate(new An(Ie,{worldview:M}),g)]}if(a.iconSizeData.kind==="composite"){const{minZoom:we,maxZoom:Ie}=a.iconSizeData;k.compositeIconSizes=[te.possiblyEvaluate(new An(we,{worldview:M}),g,A),te.possiblyEvaluate(new An(Ie,{worldview:M}),g,A)]}k.layoutTextSize=Y.possiblyEvaluate(new An(_+1,{worldview:M}),g),k.layoutIconSize=te.possiblyEvaluate(new An(_+1,{worldview:M}),g,A),k.textMaxSize=Y.possiblyEvaluate(new An(18,{worldview:M}),g);const ue=z.get("symbol-placement"),le=z.get("text-rotation-alignment")==="map"&&ue!=="point",ge=z.get("text-size");let ye=!1;const me=[];for(const we of a.features){const Ie=z.get("text-font").evaluate(we,{},g).join(","),Je=ge.evaluate(we,{},g)*k.textScaleFactor,qe=k.layoutTextSize.evaluate(we,{},g)*k.textScaleFactor,Xe=k.layoutIconSize.evaluate(we,{},g,A)*k.iconScaleFactor,at={horizontal:{},vertical:void 0},nt=we.text;let ot,Ge=[0,0];if(nt){const an=nt.toString(),wr=z.get("text-letter-spacing").evaluate(we,{},g)*so,cn=z.get("text-line-height").evaluate(we,{},g)*so,In=Rw(an)?wr:0,Jn=z.get("text-anchor").evaluate(we,{},g),or=z.get("text-variable-anchor");if(!or){const Ur=z.get("text-radial-offset").evaluate(we,{},g);if(Ur)Ge=sP(Jn,[Ur*so,j1]);else{const Wr=z.get("text-offset").evaluate(we,{},g);Ge=[Wr[0]*so,Wr[1]*so]}}let sr=le?"center":z.get("text-justify").evaluate(we,{},g);const Sr=ue==="point",vo=Sr?z.get("text-max-width").evaluate(we,{},g)*so:1/0,Ao=Ur=>{a.allowVerticalPlacement&&Rm(an)&&(at.vertical=k1(nt,t,r,d,Ie,vo,cn,Jn,Ur,In,Ge,Vs.vertical,!0,qe,Je,S))};if(!le&&or){const Ur=sr==="auto"?or.map(Kr=>G1(Kr)):[sr];let Wr=!1;for(let Kr=0;Kr<Ur.length;Kr++){const $i=Ur[Kr];if(!at.horizontal[$i])if(Wr)at.horizontal[$i]=at.horizontal[0];else{const ar=k1(nt,t,r,d,Ie,vo,cn,"center",$i,In,Ge,Vs.horizontal,!1,qe,Je,S);ar&&(at.horizontal[$i]=ar,Wr=ar.positionedLines.length===1)}}Ao("left")}else{if(sr==="auto"&&(sr=G1(Jn)),Sr||z.get("text-writing-mode").indexOf("horizontal")>=0||!Rm(an)){const Ur=k1(nt,t,r,d,Ie,vo,cn,Jn,sr,In,Ge,Vs.horizontal,!1,qe,Je,S);Ur&&(at.horizontal[sr]=Ur)}Ao(Sr?"left":sr)}}let ct,et,ut,lt,Bt,Ut,Tt=!1;const Mt=z.get("icon-text-fit").evaluate(we,{},g);if(we.icon&&we.icon.hasPrimary()){const an=zg(we.icon,a.iconSizeData,D["icon-size"],g,a.zoom,we,S,k.iconScaleFactor,M,A);ct=an.iconPrimary,ut=an.iconSecondary;const wr=ct.toString();if(et=c.get(wr),et&&(Bt=z.get("icon-offset").evaluate(we,{},g),Ut=z.get("icon-anchor").evaluate(we,{},g),ot=_x(d.get(wr),ut?d.get(ut.toString()):void 0,Bt,Ut),Tt=et.sdf,a.sdfIcons===void 0?a.sdfIcons=et.sdf:a.sdfIcons!==et.sdf&&vi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==a.pixelRatio||z.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),ut){const cn=ut.toString();lt=c.get(cn)}}ye=ye||!(!we.icon||!we.icon.hasSecondary());const li=wx(at.horizontal)||at.vertical;a.iconsInText||(a.iconsInText=!!li&&li.iconsInText);const Yt=qe*k.textScaleFactor/so,{defaultShapedIcon:Ct,verticallyShapedIcon:bi}=_5(a,ot,z,we,g,at,Yt,Bt,Mt);Mt!=="none"&&ot&&(GA(ot)||HA(ot))&&(bx(0,et,ct,ot,Ct,Mt,T,c,d),bx(0,lt,ut,ot,Ct,Mt,T,c,d),bi&&(bx(0,et,ct,ot,bi,Mt,T,c,d),bx(0,lt,ut,ot,bi,Mt,T,c,d))),ot=Ct;const{iconBBox:qi,iconVerticalBBox:pn,textBBox:Hi,textVerticalBBox:Pn}=d5(a,ot,bi,z,we,g,Xe,Bt,k,d,Ut,at,qe,Ge,A);me.push({feature:we,shapedTextOrientations:at,shapedText:li,shapedIcon:ot,iconPrimary:ct,iconSecondary:ut,iconOffset:Bt,iconAnchor:Ut,verticallyShapedIcon:bi,layoutTextSize:qe,layoutIconSize:Xe,textOffset:Ge,isSDFIcon:Tt,iconTextFit:Mt,iconCollisionBounds:qi,iconVerticalCollisionBounds:pn,textCollisionBounds:Hi,textVerticalCollisionBounds:Pn})}return{featureData:me,sizes:k,hasAnySecondaryIcon:ye,textAlongLine:le,symbolPlacement:ue}},s.fx=QA,s.fy=function(a,t,r,c,d,g,_,v,S,T){a.iconAtlasPositions=T.iconPositions;const{featureData:M,hasAnySecondaryIcon:A,sizes:z,textAlongLine:D,symbolPlacement:k}=t;for(const $ of M){const{shapedIcon:H,verticallyShapedIcon:j,feature:X,shapedTextOrientations:Y,shapedText:te,layoutTextSize:ue,textOffset:le,isSDFIcon:ge,iconPrimary:ye,iconSecondary:me,iconTextFit:we,iconOffset:Ie,iconCollisionBounds:Je,iconVerticalCollisionBounds:qe,textCollisionBounds:Xe}=$;uP(H,T.iconPositions,ye,me),uP(j,T.iconPositions,ye,me),g5(Y,T.iconPositions),m5(ye,me,T.iconPositions),(te||H)&&y5(a,X,Y,H,j,S,z,ue,0,le,ge,c,d,_,v,A,we,Ie,D,k,Je,qe,Xe)}r&&a.generateCollisionDebugBuffers(g,a.collisionBoxArray,z.textScaleFactor)},s.fz=wn,s.g=function(a,t){return ol(Object.assign(a,{method:"GET"}),t)},s.h=function(a){return a.indexOf("mapbox:")===0},s.i=function(a){return jr.API_STYLE_REGEX.test(a)&&!zo(a)},s.j=Al,s.k=jc,s.l=function(a){return decodeURIComponent(atob(a).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(a,t){return ol(Object.assign(a,{type:"json"}),t)},s.n=yd,s.o=Cs,s.p=function(a,t){return ol(Object.assign(a,{method:"POST"}),t)},s.q=Mo,s.r=cc,s.s=function(a){try{const t=self[a];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return m1||(m1=new jh("ImageRasterizer")),m1},s.u=function(){return(function a(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()},s.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},s.w=vi,s.x=lS,s.y=oh,s.z=sl}),f(["./shared"],function(s){function P(Ee){const Z=Ee?Ee.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function C(Ee){if(typeof Ee=="number"||typeof Ee=="boolean"||typeof Ee=="string"||Ee==null)return JSON.stringify(Ee);if(Array.isArray(Ee)){let Q="[";for(const ce of Ee)Q+=`${C(ce)},`;return`${Q}]`}let Z="{";for(const Q of Object.keys(Ee).sort())Z+=`${Q}:${C(Ee[Q])},`;return`${Z}}`}function O(Ee){let Z="";for(const Q of s.bx)Z+=`/${C(Ee[Q])}`;return Z}function F(Ee,Z){return(function Q(ce){return typeof ce=="string"&&ce===Z||(Array.isArray(ce)?ce.some(Q):!(!ce||typeof ce!="object")&&Object.values(ce).some(Q))})(Ee)}class V{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,Q){this._layerConfigs={},this._layers={},this.update(Z,[],Q)}update(Z,Q,ce){this._options=ce;for(const de of Z)this._layerConfigs[de.id]=de,(this._layers[de.id]=s.du(de,this.scope,null,this._options)).compileFilter(ce),this.keyCache[de.id]&&delete this.keyCache[de.id];for(const de of Q)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const xe=(function(de,Me){const Oe={};for(let Be=0;Be<de.length;Be++){const gt=de[Be];let st=Me&&Me[gt.id];st||(gt.type==="symbol"?st=gt.id:(st=O(gt),gt.type==="line"&&gt.paint&&F(gt.paint["line-width"],"line-progress")&&(st+=`/${C(gt.paint["line-width"])}`))),Me&&(Me[gt.id]=st);let Ft=Oe[st];Ft||(Ft=Oe[st]=[]),Ft.push(gt)}const Pe=[];for(const Be in Oe)Pe.push(Oe[Be]);return Pe})(Object.values(this._layerConfigs),this.keyCache);for(const de of xe){const Me=de.map(Ft=>this._layers[Ft.id]),Oe=Me[0];if(Oe.visibility==="none")continue;const Pe=Oe.source||"";let Be=this.familiesBySource[Pe];Be||(Be=this.familiesBySource[Pe]={});const gt=Oe.sourceLayer||"_geojsonTileLayer";let st=Be[gt];st||(st=Be[gt]=[]),st.push(Me)}}}const q=1*s.fl;class ee{constructor(Z){const Q={},ce=[];for(const Oe in Z){const Pe=Z[Oe],Be=Q[Oe]={};for(const gt in Pe.glyphs){const st=Pe.glyphs[+gt];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const Ft=st.metrics.localGlyph?q:1,ri={x:0,y:0,w:st.bitmap.width+2*Ft,h:st.bitmap.height+2*Ft};ce.push(ri),Be[gt]=ri}}const{w:xe,h:de}=s.G(ce),Me=new s.fk({width:xe||1,height:de||1});for(const Oe in Z){const Pe=Z[Oe];for(const Be in Pe.glyphs){const gt=Pe.glyphs[+Be];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const st=Q[Oe][Be],Ft=gt.metrics.localGlyph?q:1;s.fk.copy(gt.bitmap,Me,{x:0,y:0},{x:st.x+Ft,y:st.y+Ft},gt.bitmap)}}this.image=Me,this.positions=Q}}function se(Ee,Z,Q){Ee[Z]?Q&&(Ee[Z].center=Q):Ee[Z]={floorIds:new Set,center:Q||[0,0],floors:{}}}function fe(Ee,Z,Q,ce){for(const xe of Z)se(Ee,xe),Ee[xe].floors[Q]=ce,Ee[xe].floorIds.add(Q)}function ae(Ee){return{id:Ee.properties.id.toString(),center:Ee.properties.center.toString().split(";").map(Number)}}function ie(Ee){return{id:Ee.properties.id.toString(),isDefault:!!Ee.properties.is_default&&Ee.properties.is_default,connections:Ee.properties.connected_floor_ids?new Set(Ee.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ee.properties.conflicted_floor_ids?new Set(Ee.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ee.properties.building_ids?new Set(Ee.properties.building_ids.toString().split(";")):new Set,name:Ee.properties.name.toString(),zIndex:Ee.properties.z_index}}function tt(Ee,Z){return Z.every(Q=>Ee.properties&&Ee.properties[Q]!=null)}function Ue(Ee){return tt(Ee,["type","id","name"])&&Ee.properties.type==="building"}function Ne(Ee){return tt(Ee,["type","id","name","z_index"])&&Ee.properties.type==="floor"}s.fj(ee,"GlyphAtlas");class Ce{constructor(Z){this.tileID=new s.aQ(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.lut=Z.lut,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.request&&Z.request.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=s.aZ(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.worldview=Z.worldview,this.localizableLayerIds=Z.localizableLayerIds,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster,this.tessellationStep=Z.tessellationStep,this.scaleFactor=Z.scaleFactor,this.worldview=Z.worldview,this.indoor=Z.indoor}parse(Z,Q,ce,xe,de,Me){this.status="parsing",this.data=Z,this.collisionBoxArray=new s.b3;const Oe=new s.fm(Object.keys(Z.layers).sort()),Pe=new s.fn(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];const Be={},gt=new s.fo(256,256),st={featureIndex:Pe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:gt,availableImages:ce,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Oi=this.indoor.indoorState.activeFloorsVisible,Gi=(function(Ti,vi,Vn){const Nr=(function(Qn,sn){if(!Qn)return s.w("No source layers defined in indoor specification"),sn;if(Qn.size===0)return sn;const nr=Qn.difference(sn);for(const kn of nr)s.w(`Missing source layer required in indoor specification: ${kn}`);return sn.intersection(sn)})(vi.sourceLayers,new Set(Object.keys(Ti.layers))),vr=vi.indoorState,xr=(function(Qn,sn,nr,kn){const On=new Set,gr=new Set,To=new Set,go=new Map,jr={},Al=zo=>{const ys=go.get(zo)||new Set;for(const ea of On)if((go.get(ea)||new Set).has(zo)||ys.has(ea))return!0;return!1};for(const zo of sn){const ys=Qn.layers[zo];if(ys)for(let ea=0;ea<ys.length;ea++){const fa=ys.feature(ea);if(Ue(fa)){const{id:vs,center:Fo}=ae(fa);se(jr,vs,Fo),On.add(vs);continue}if(Ne(fa)){const{id:vs,isDefault:Fo,connections:nl,conflicts:cc,buildings:Cs,name:Ku,zIndex:Qu}=ie(fa);fe(jr,Cs,vs,{name:Ku,zIndex:Qu}),go.set(vs,cc),(vs===kn||nl.has(kn))&&On.add(vs),gr.add(vs),Fo&&To.add(vs)}}else s.w(`indoor source layer not found: ${zo}`)}if(nr)for(const zo of nr)gr.has(zo)&&(Al(zo)||On.add(zo));for(const zo of To)On.has(zo)||Al(zo)||On.add(zo);return{buildings:jr,activeFloors:On}})(Ti,Nr,vr.lastActiveFloors,vr.selectedFloorId);return Vn.send("setIndoorData",xr),xr})(Z,this.indoor,de);st.activeFloors=Oi?Gi.activeFloors:void 0}const Ft=[],ri=Q.familiesBySource[this.source];for(const Oi in ri){const Gi=Z.layers[Oi];if(!Gi)continue;let Ti=!1,vi=!1,Vn=!1;for(const sn of ri[Oi])sn[0].type==="symbol"?Ti=!0:vi=!0,sn[0].is3D()&&sn[0].type!=="model"&&(Vn=!0);if(this.extraShadowCaster&&!Vn||this.isSymbolTile===!0&&!Ti||this.isSymbolTile===!1&&!vi)continue;Gi.version===1&&s.w(`Vector tile source "${this.source}" layer "${Oi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Nr=Oe.encode(Oi),vr=[],xr=this.localizableLayerIds&&this.localizableLayerIds.has(Oi);let Qn=!1;for(let sn=0,nr=0;sn<Gi.length;sn++){const kn=Gi.feature(sn),On=Pe.getId(kn,Oi),gr=kn.properties?kn.properties.worldview:null;if(xr&&this.worldview&&typeof gr=="string")if(gr==="all")kn.properties.$localized=!0;else{if(!gr.split(",").includes(this.worldview))continue;kn.properties.$localized=!0,kn.properties.worldview=this.worldview}!Qn&&kn.properties&&kn.properties.hasOwnProperty(s.fp)&&(Qn=!0),vr.push({feature:kn,id:On,index:nr,sourceLayerIndex:Nr}),nr++}Qn&&!st.elevationFeatures&&Z.layers.hasOwnProperty(s.fq)&&(st.elevationFeatures=s.fr.parseFrom(Z.layers[s.fq],this.canonical));for(const sn of ri[Oi]){const nr=sn[0];if(this.extraShadowCaster&&(!nr.is3D()||nr.type==="model")||this.isSymbolTile!==void 0&&nr.type==="symbol"!==this.isSymbolTile||nr.minzoom&&this.zoom<Math.floor(nr.minzoom)||nr.maxzoom&&this.zoom>=nr.maxzoom||nr.visibility==="none")continue;Ye(sn,this.zoom,st.brightness,ce,this.worldview);const kn=Be[nr.id]=nr.createBucket({index:Pe.bucketLayerIDs.length,layers:sn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Nr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:xe,worldview:this.worldview,localizable:xr,availableImages:ce});Pe.bucketLayerIDs.push(sn.map(gr=>s.B(gr.id,gr.scope)));let On=kn.prepare?kn.prepare():null;On!=null?(On=On.then(()=>kn.populate(vr,st,this.tileID.canonical,this.tileTransform)),Ft.push(On)):kn.populate(vr,st,this.tileID.canonical,this.tileTransform)}}const ci=()=>{let Oi,Gi,Ti,vi,Vn,Nr;gt.trim();const vr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xr=()=>{if(Oi)return this.status="done",Me(Oi);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:Object.values(Be).filter(sn=>!sn.isEmpty()),featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:st.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Gi&&Ti&&vi){const sn=new ee(Gi),nr=new Map;for(const[gr,To]of Ti.entries()){const{imagePosition:go}=s.fu(gr,To,s.fv);nr.set(gr,go)}const kn={};for(const gr in Be){const To=Be[gr];To instanceof s.b4&&(Ye(To.layers,this.zoom,st.brightness,ce,this.worldview),kn[gr]=s.fw(To,Gi,sn.positions,Ti,nr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Vn,this.worldview,ce))}const On={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(de,Ti,Vn,()=>{On.iconsPending=!1,Qn(kn,sn,On)}),this.rasterizeIfNeeded(de,vi,Nr,()=>{On.patternsPending=!1,Qn(kn,sn,On)})}},Qn=(sn,nr,kn,On)=>{if(kn.iconsPending||kn.patternsPending)return;const gr=new s.fx(Ti,vi,this.lut);for(const To in Be){const go=Be[To];if(To in sn)s.fy(go,sn[To],this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Ti,gr);else if(go.hasPattern&&(go instanceof s.ba||go instanceof s.bb||go instanceof s.ea)){Ye(go.layers,this.zoom,st.brightness,ce,this.worldview);const jr=Object.fromEntries(gr.patternPositions);go.addFeatures(st,this.tileID.canonical,jr,ce,this.tileTransform,this.brightness)}}this.status="done",Me(null,{buckets:Object.values(Be).filter(To=>!To.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nr.image,lineAtlas:gt,imageAtlas:gr,brightness:st.brightness})};if(!this.extraShadowCaster){const sn=s.fs(st.glyphDependencies,On=>Object.keys(On).map(Number));Object.keys(sn).length?de.send("getGlyphs",{uid:this.uid,stacks:sn},(On,gr)=>{Oi||(Oi=On,Gi=gr,xr())},void 0,!1,vr):Gi={};const nr=Array.from(st.iconDependencies.keys()).map(On=>s.I.parse(On));nr.length?de.send("getImages",{images:nr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(On,gr)=>{Oi||(Oi=On,Ti=new Map,Vn=this.updateImageMapAndGetImageTaskQueue(Ti,gr,st.iconDependencies),xr())},void 0,!1,vr):(Ti=new Map,Vn=new Map);const kn=Array.from(st.patternDependencies.keys()).map(On=>s.I.parse(On));kn.length?de.send("getImages",{images:kn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(On,gr)=>{Oi||(Oi=On,vi=new Map,Nr=this.updateImageMapAndGetImageTaskQueue(vi,gr,st.patternDependencies),xr())},void 0,!1,vr):(vi=new Map,Nr=new Map)}if(st.elevationFeatures&&st.elevationFeatures.length>0){const sn=[];for(const kn of Object.values(Be))if(kn instanceof s.bb){const On=kn.getUnevaluatedPortalGraph();On&&sn.push(On)}const nr=s.ft.evaluate(sn);for(const kn of Object.values(Be))if(kn instanceof s.bb){const On=Z.layers[Oe.decode(kn.sourceLayerIndex)];kn.setEvaluatedPortalGraph(nr,On,this.tileID.canonical,st.availableImages,st.brightness)}}xr()};Ft.length>0?Promise.allSettled(Ft).then(ci).catch(Me):ci()}updateParameters(Z){this.scaleFactor=Z.scaleFactor,this.showCollisionBoxes=Z.showCollisionBoxes,this.projection=Z.projection,this.brightness=Z.brightness,this.tileTransform=s.aZ(Z.tileID.canonical,Z.projection),this.extraShadowCaster=Z.extraShadowCaster,this.lut=Z.lut,this.worldview=Z.worldview,this.indoor=Z.indoor}rasterizeIfNeeded(Z,Q,ce,xe){Array.from(Q.values()).some(de=>de.usvg)?this.rasterize(Z,Q,ce,xe):xe()}updateImageMapAndGetImageTaskQueue(Z,Q,ce){const xe=new Map;for(const de of Q.keys()){const Me=ce.get(de)||[];for(const Oe of Me){const Pe=Oe.toString(),Be=Q.get(Oe.id.toString());Be.usvg?xe.has(Pe)||(xe.set(Pe,Oe),Z.set(Pe,Object.assign({},Be))):Z.set(Pe,Be)}}return xe}rasterize(Z,Q,ce,xe){this.rasterizeTask=Z.send("rasterizeImages",{scope:this.scope,tasks:ce},(de,Me)=>{if(!de)for(const[Oe,Pe]of Me.entries()){const Be=Object.assign(Q.get(Oe),{data:Pe});Q.set(Oe,Be)}xe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ye(Ee,Z,Q,ce,xe){const de=new s.ac(Z,{brightness:Q,worldview:xe});for(const Me of Ee)Me.recalculate(de,ce)}class At extends s.E{constructor(Z,Q,ce,xe,de,Me,Oe){super(),this.actor=Z,this.layerIndex=Q,this.availableImages=ce,this.availableModels=xe,this.loadVectorData=Me||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(Z.scheduler),this.isSpriteLoaded=de,this.scheduler=Z.scheduler,this.brightness=Oe}loadTile(Z,Q){const ce=Z.uid,xe=Z&&Z.request,de=xe&&xe.collectResourceTiming,Me=this.loading[ce]=new Ce(Z);Me.abort=this.loadVectorData(Z,(Oe,Pe)=>{const Be=!this.loading[ce];if(delete this.loading[ce],Me.cancelRasterize(),Be||Oe||!Pe)return Me.status="done",Be||(this.loaded[ce]=Me),Q(Oe);const gt=Pe.rawData,st={},Ft=s.aM(Pe.responseHeaders);Ft&&Ft.expires&&(st.expires=Ft.expires),Ft&&Ft.cacheControl&&(st.cacheControl=Ft.cacheControl),Me.vectorTile=Pe.vectorTile||new s.fz(new s.bt(gt));const ri=()=>{Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(ci,Oi)=>{if(ci||!Oi)return Q(ci);const Gi={};if(de){const Ti=P(xe);Ti.length>0&&(Gi.resourceTiming=JSON.parse(JSON.stringify(Ti)))}Q(null,Object.assign({rawTileData:gt.slice(0),responseHeaders:Pe.responseHeaders},Oi,st,Gi))})};this.isSpriteLoaded?ri():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ri,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):ri()}),this.loaded=this.loaded||{},this.loaded[ce]=Me})}reloadTile(Z,Q){const ce=this.loaded,xe=Z.uid;if(ce&&ce[xe]){const de=ce[xe];de.updateParameters(Z);const Me=(Oe,Pe)=>{const Be=de.reloadCallback;Be&&(delete de.reloadCallback,de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Be)),Q(Oe,Pe)};de.status==="parsing"?de.reloadCallback=Me:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Me):Me())}else Q(null,void 0)}abortTile(Z,Q){const ce=Z.uid,xe=this.loading[ce];xe&&(xe.abort&&xe.abort(),delete this.loading[ce]),Q()}removeTile(Z,Q){const ce=this.loaded,xe=Z.uid;ce&&ce[xe]&&delete ce[xe],Q()}}class ft{loadTile(Z,Q){const{uid:ce,encoding:xe,rawImageData:de,padding:Me}=Z,Oe=ImageBitmap&&de instanceof ImageBitmap?this.getImageData(de,Me):de;Q(null,new s.fA(ce,Oe,xe,Me<1))}reloadTile(Z,Q){Q(null,null)}abortTile(Z,Q){Q()}removeTile(Z,Q){Q()}getImageData(Z,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ce=this.offscreenCanvasContext.getImageData(-Q,-Q,Z.width+2*Q,Z.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}s.bs.setPbf(s.bt);class wt{constructor(Z){this._mrt=new s.bs(Z.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Z.uid,this.tileID=Z.tileID,this.source=Z.source}parse(Z,Q){const ce=this._mrt;this.status="parsing",this._entireBuffer=Z;try{ce.parseHeader(Z),this._isHeaderLoaded=!0;const xe=[];for(const de in ce.layers){const Me=ce.getLayer(de),Oe=Me.getDataRange(Me.getBandList()),Pe=ce.createDecodingTask(Oe),Be=Z.slice(Oe.firstByte,Oe.lastByte+1),gt=s.bs.performDecoding(Be,Pe).then(st=>Pe.complete(null,st)).catch(st=>Pe.complete(st,null));xe.push(gt)}Promise.allSettled(xe).then(()=>Q(null,ce)).catch(de=>Q(de))}catch(xe){Q(xe)}}}class Et{constructor(Z){this.actor=Z,this.loading={},this.loaded={}}loadTile(Z,Q){const ce=Z.uid,xe=Z.request,de=this.loading[ce]=new wt(Z),{cancel:Me}=s.bu(xe,(Oe,Pe,Be)=>{const gt=!this.loading[ce];if(delete this.loading[ce],gt||Oe||!Pe)return de.status="done",gt||(this.loaded[ce]=de),Q(Oe);de.parse(Pe,(st,Ft)=>{if(st||!Ft)return Q(st);Q(null,Ft,Be)}),this.loaded[ce]=de});de.abort=Me}reloadTile(Z,Q){Q(null,void 0)}abortTile(Z,Q){const ce=Z.uid,xe=this.loading[ce];xe&&(xe.abort&&xe.abort(),delete this.loading[ce]),Q()}removeTile(Z,Q){const ce=Z.uid;this.loaded[ce]&&delete this.loaded[ce],Q()}decodeRasterArray(Z,Q){s.bs.performDecoding(Z.buffer,Z.task).then(ce=>Q(null,ce)).catch(ce=>Q(ce))}}const Dt=s.fB.prototype.toGeoJSON;class Qe{constructor(Z){this._feature=Z,this.extent=s.al,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(this._feature.type===1){const Z=[];for(const Q of this._feature.geometry)Z.push([new s.P(Q[0],Q[1])]);return Z}{const Z=[];for(const Q of this._feature.geometry){const ce=[];for(const xe of Q)ce.push(new s.P(xe[0],xe[1]));Z.push(ce)}return Z}}toGeoJSON(Z,Q,ce){return Dt.call(this,Z,Q,ce)}}class ht{constructor(Z,Q){this.name=Z,this.extent=s.al,this.length=Q.length,this._jsonFeatures=Q}feature(Z){return new Qe(this._jsonFeatures[Z])}}class _t{constructor(Z){this.layers={},this.extent=s.al;for(const Q of Object.keys(Z))this.layers[Q]=new ht(Q,Z[Q])}}const yt=64/4096;class Nt{constructor(){this.features=new Map}clear(){this.features.clear()}load(Z=[],Q){for(const ce of Z){const xe=ce.id;if(xe==null)continue;let de=this.features.get(xe);de&&this.updateCache(de,Q),ce.geometry?(de=mi(ce),this.updateCache(de,Q),this.features.set(xe,de)):this.features.delete(xe),this.updateCache(de,Q)}}updateCache(Z,Q){for(const{canonical:ce,uid:xe}of Object.values(Q)){const{z:de,x:Me,y:Oe}=ce;ei(Z,Math.pow(2,de),Me,Oe)&&delete Q[xe]}}getTile(Z,Q,ce){const xe=Math.pow(2,Z),de=[];for(const Me of this.features.values())ei(Me,xe,Q,ce)&&de.push(wi(Me,xe,Q,ce));return{features:de}}getFeatures(){return[...this.features.values()]}}function ei({minX:Ee,minY:Z,maxX:Q,maxY:ce},xe,de,Me){return Ee<(de+1+yt)/xe&&Z<(Me+1+yt)/xe&&Q>(de-yt)/xe&&ce>(Me-yt)/xe}function mi(Ee){const{id:Z,geometry:Q,properties:ce}=Ee;if(!Q)return;if(Q.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:xe,coordinates:de}=Q,Me={id:Z,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Oe=Me.geometry;if(xe==="Point")Pi(de,Oe,Me);else if(xe==="MultiPoint")for(const Pe of de)Pi(Pe,Oe,Me);else if(xe==="LineString")Me.type=2,Ai(de,Oe,Me);else if(xe==="MultiLineString")Me.type=2,dn(de,Oe,Me);else if(xe==="Polygon")Me.type=3,dn(de,Oe,Me,!0);else{if(xe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Me.type=3;for(const Pe of de)dn(Pe,Oe,Me,!0)}return Me}function Pi([Ee,Z],Q,ce){const xe=s.aF(Ee);let de=s.aJ(Z);de=de<0?0:de>1?1:de,Q.push(xe,de),ce.minX=Math.min(ce.minX,xe),ce.minY=Math.min(ce.minY,de),ce.maxX=Math.max(ce.maxX,xe),ce.maxY=Math.max(ce.maxY,de)}function Ai(Ee,Z,Q,ce=!1,xe=!1){const de=[];for(const Me of Ee)Pi(Me,de,Q);Z.push(de),ce&&(function(Me,Oe){let Pe=0;for(let Be=0,gt=Me.length,st=gt-2;Be<gt;st=Be,Be+=2)Pe+=(Me[Be]-Me[st])*(Me[Be+1]+Me[st+1]);if(Pe>0===Oe)for(let Be=0,gt=Me.length;Be<gt/2;Be+=2){const st=Me[Be],Ft=Me[Be+1];Me[Be]=Me[gt-2-Be],Me[Be+1]=Me[gt-1-Be],Me[gt-2-Be]=st,Me[gt-1-Be]=Ft}})(de,xe)}function dn(Ee,Z,Q,ce=!1){for(let xe=0;xe<Ee.length;xe++)Ai(Ee[xe],Z,Q,ce,xe===0)}function wi(Ee,Z,Q,ce){const{id:xe,type:de,geometry:Me,tags:Oe}=Ee,Pe=[];if(de===1)(function(Be,gt,st,Ft,ri){for(let ci=0;ci<Be.length;ci+=2){const Oi=Math.round(s.al*(Be[ci+0]*gt-st)),Gi=Math.round(s.al*(Be[ci+1]*gt-Ft));ri.push([Oi,Gi])}})(Me,Z,Q,ce,Pe);else if(de===2)for(const Be of Me)Rn(Be,Z,Q,ce,Pe);else if(de===3)for(const Be of Me)Un(Be,Z,Q,ce,Pe);return{id:xe,type:de,geometry:Pe,tags:Oe}}function Rn(Ee,Z,Q,ce,xe){const Me=s.al+128;let Oe;for(let Pe=0;Pe<Ee.length-2;Pe+=2){let Be=Math.round(s.al*(Ee[Pe+0]*Z-Q)),gt=Math.round(s.al*(Ee[Pe+1]*Z-ce)),st=Math.round(s.al*(Ee[Pe+2]*Z-Q)),Ft=Math.round(s.al*(Ee[Pe+3]*Z-ce));const ri=st-Be,ci=Ft-gt;Be<-128&&st<-128||(Be<-128?(gt+=Math.round(ci*((-128-Be)/ri)),Be=-128):st<-128&&(Ft=gt+Math.round(ci*((-128-Be)/ri)),st=-128),gt<-128&&Ft<-128||(gt<-128?(Be+=Math.round(ri*((-128-gt)/ci)),gt=-128):Ft<-128&&(st=Be+Math.round(ri*((-128-gt)/ci)),Ft=-128),Be>=Me&&st>=Me||(Be>=Me?(gt+=Math.round(ci*((Me-Be)/ri)),Be=Me):st>=Me&&(Ft=gt+Math.round(ci*((Me-Be)/ri)),st=Me),gt>=Me&&Ft>=Me||(gt>=Me?(Be+=Math.round(ri*((Me-gt)/ci)),gt=Me):Ft>=Me&&(st=Be+Math.round(ri*((Me-gt)/ci)),Ft=Me),Oe&&Be===Oe[Oe.length-1][0]&&gt===Oe[Oe.length-1][1]||(Oe=[[Be,gt]],xe.push(Oe)),Oe.push([st,Ft])))))}}function Un(Ee,Z,Q,ce,xe){const de=(Q-yt)/Z,Me=(ce-yt)/Z,Oe=(Q+1+yt)/Z,Pe=(ce+1+yt)/Z;function Be(Ft,ri){let ci=0;return Ft<de?ci|=1:Ft>Oe&&(ci|=2),ri<Me?ci|=4:ri>Pe&&(ci|=8),ci}let gt=[];for(let Ft=1;Ft<=8;Ft*=2){let ri=Ee[Ee.length-2],ci=Ee[Ee.length-1],Oi=!(Be(ri,ci)&Ft);for(let Gi=0;Gi<Ee.length;Gi+=2){const Ti=Ee[Gi],vi=Ee[Gi+1],Vn=!(Be(Ti,vi)&Ft);Vn!==Oi&&(8&Ft?gt.push(ri+(Ti-ri)*(Pe-ci)/(vi-ci),Pe):4&Ft?gt.push(ri+(Ti-ri)*(Me-ci)/(vi-ci),Me):2&Ft?gt.push(Oe,ci+(vi-ci)*(Oe-ri)/(Ti-ri)):1&Ft&&gt.push(de,ci+(vi-ci)*(de-ri)/(Ti-ri))),Vn&&gt.push(Ti,vi),ri=Ti,ci=vi,Oi=Vn}if(!(Ee=gt).length||Ft===8)break;gt=[]}const st=[];for(let Ft=0;Ft<gt.length;Ft+=2)st.push([Math.round(s.al*(gt[Ft]*Z-Q)),Math.round(s.al*(gt[Ft+1]*Z-ce))]);st.length&&xe.push(st)}function Zt({name:Ee,features:Z},Q){Q.writeStringField(1,Ee),Q.writeVarintField(5,s.al);const ce=new Map,xe=new Map,de={keys:ce,values:xe,feature:null};for(const Me of Z)de.feature=Me,Q.writeMessage(2,pr,de);for(const Me of ce.keys())Q.writeStringField(3,Me);for(const Me of xe.keys())Q.writeMessage(4,ti,Me)}function pr(Ee,Z){const Q=Ee.feature;Q.id!==void 0&&Number.isSafeInteger(+Q.id)&&Z.writeVarintField(1,+Q.id),Q.tags&&Z.writeMessage(2,zn,Ee),Z.writeVarintField(3,Q.type),Z.writeMessage(4,hn,Q)}function zn({keys:Ee,values:Z,feature:Q},ce){for(const xe of Object.keys(Q.tags)){let de=Q.tags[xe];if(de===null)continue;let Me=Ee.get(xe);Me===void 0&&(Me=Ee.size,Ee.set(xe,Me)),ce.writeVarint(Me);const Oe=typeof de;Oe!=="string"&&Oe!=="boolean"&&Oe!=="number"&&(de=JSON.stringify(de));let Pe=Z.get(de);Pe===void 0&&(Pe=Z.size,Z.set(de,Pe)),ce.writeVarint(Pe)}}function Di(Ee,Z){return(Z<<3)+(7&Ee)}function Ii(Ee){return Ee<<1^Ee>>31}function hn(Ee,Z){const{geometry:Q,type:ce}=Ee;let xe=0,de=0;if(ce===1){Z.writeVarint(Di(1,Q.length));for(const Me of Q){const Oe=Me[0]-xe,Pe=Me[1]-de;Z.writeVarint(Ii(Oe)),Z.writeVarint(Ii(Pe)),xe+=Oe,de+=Pe}}else for(const Me of Q){if(Me.length===0)continue;Z.writeVarint(Di(1,1));const Oe=Me.length-(ce===3?1:0);for(let Pe=0;Pe<Oe;Pe++){Pe===1&&Z.writeVarint(Di(2,Oe-1));const Be=Me[Pe][0]-xe,gt=Me[Pe][1]-de;Z.writeVarint(Ii(Be)),Z.writeVarint(Ii(gt)),xe+=Be,de+=gt}ce===3&&Z.writeVarint(Di(7,1))}}function ti(Ee,Z){const Q=typeof Ee;Q==="string"?Z.writeStringField(1,Ee):Q==="boolean"?Z.writeBooleanField(7,Ee):Q==="number"&&(Ee%1!=0?Z.writeDoubleField(3,Ee):Ee<0?Z.writeSVarintField(6,Ee):Z.writeVarintField(5,Ee))}const qt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},hi=Math.fround||(ji=new Float32Array(1),Ee=>(ji[0]=+Ee,ji[0]));var ji;class zi{constructor(Z){this.options=Object.assign(Object.create(qt),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:Q,minZoom:ce,maxZoom:xe}=this.options;Q&&console.time("total time");const de=`prepare ${Z.length} points`;Q&&console.time(de),this.points=Z;const Me=[];for(let Pe=0;Pe<Z.length;Pe++){const Be=Z[Pe];if(!Be.geometry)continue;const[gt,st]=Be.geometry.coordinates,Ft=hi(Wt(gt)),ri=hi(Jt(st));Me.push(Ft,ri,1/0,Pe,-1,1),this.options.reduce&&Me.push(0)}let Oe=this.trees[xe+1]=this._createTree(Me);Q&&console.timeEnd(de);for(let Pe=xe;Pe>=ce;Pe--){const Be=+Date.now();Oe=this.trees[Pe]=this._createTree(this._cluster(Oe,Pe)),Q&&console.log("z%d: %d clusters in %dms",Pe,Oe.numItems,+Date.now()-Be)}return Q&&console.timeEnd("total time"),this}getClusters(Z,Q){let ce=((Z[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,Z[1]));let de=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ce=-180,de=180;else if(ce>de){const st=this.getClusters([ce,xe,180,Me],Q),Ft=this.getClusters([-180,xe,de,Me],Q);return st.concat(Ft)}const Oe=this.trees[this._limitZoom(Q)],Pe=Oe.range(Wt(ce),Jt(Me),Wt(de),Jt(xe)),Be=Oe.data,gt=[];for(const st of Pe){const Ft=this.stride*st;gt.push(Be[Ft+5]>1?Ve(Be,Ft,this.clusterProps):this.points[Be[Ft+3]])}return gt}getChildren(Z){const Q=this._getOriginId(Z),ce=this._getOriginZoom(Z),xe="No cluster with the specified id.",de=this.trees[ce];if(!de)throw new Error(xe);const Me=de.data;if(Q*this.stride>=Me.length)throw new Error(xe);const Oe=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Pe=de.within(Me[Q*this.stride],Me[Q*this.stride+1],Oe),Be=[];for(const gt of Pe){const st=gt*this.stride;Me[st+4]===Z&&Be.push(Me[st+5]>1?Ve(Me,st,this.clusterProps):this.points[Me[st+3]])}if(Be.length===0)throw new Error(xe);return Be}getLeaves(Z,Q,ce){const xe=[];return this._appendLeaves(xe,Z,Q=Q||10,ce=ce||0,0),xe}getTile(Z,Q,ce){const xe=this.trees[this._limitZoom(Z)],de=Math.pow(2,Z),{extent:Me,radius:Oe}=this.options,Pe=Oe/Me,Be=(ce-Pe)/de,gt=(ce+1+Pe)/de,st={features:[]};return this._addTileFeatures(xe.range((Q-Pe)/de,Be,(Q+1+Pe)/de,gt),xe.data,Q,ce,de,st),Q===0&&this._addTileFeatures(xe.range(1-Pe/de,Be,1,gt),xe.data,de,ce,de,st),Q===de-1&&this._addTileFeatures(xe.range(0,Be,Pe/de,gt),xe.data,-1,ce,de,st),st.features.length?st:null}getClusterExpansionZoom(Z){let Q=this._getOriginZoom(Z)-1;for(;Q<=this.options.maxZoom;){const ce=this.getChildren(Z);if(Q++,ce.length!==1)break;Z=ce[0].properties.cluster_id}return Q}_appendLeaves(Z,Q,ce,xe,de){const Me=this.getChildren(Q);for(const Oe of Me){const Pe=Oe.properties;if(Pe&&Pe.cluster?de+Pe.point_count<=xe?de+=Pe.point_count:de=this._appendLeaves(Z,Pe.cluster_id,ce,xe,de):de<xe?de++:Z.push(Oe),Z.length===ce)break}return de}_createTree(Z){const Q=new s.c4(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<Z.length;ce+=this.stride)Q.add(Z[ce],Z[ce+1]);return Q.finish(),Q.data=Z,Q}_addTileFeatures(Z,Q,ce,xe,de,Me){for(const Oe of Z){const Pe=Oe*this.stride,Be=Q[Pe+5]>1;let gt,st,Ft;if(Be)gt=Le(Q,Pe,this.clusterProps),st=Q[Pe],Ft=Q[Pe+1];else{const Oi=this.points[Q[Pe+3]];gt=Oi.properties;const[Gi,Ti]=Oi.geometry.coordinates;st=Wt(Gi),Ft=Jt(Ti)}const ri={type:1,geometry:[[Math.round(this.options.extent*(st*de-ce)),Math.round(this.options.extent*(Ft*de-xe))]],tags:gt};let ci;ci=Be||this.options.generateId?Q[Pe+3]:this.points[Q[Pe+3]].id,ci!==void 0&&(ri.id=ci),Me.features.push(ri)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,Q){const{radius:ce,extent:xe,reduce:de,minPoints:Me}=this.options,Oe=ce/(xe*Math.pow(2,Q)),Pe=Z.data,Be=[],gt=this.stride;for(let st=0;st<Pe.length;st+=gt){if(Pe[st+2]<=Q)continue;Pe[st+2]=Q;const Ft=Pe[st],ri=Pe[st+1],ci=Z.within(Pe[st],Pe[st+1],Oe),Oi=Pe[st+5];let Gi=Oi;for(const Ti of ci){const vi=Ti*gt;Pe[vi+2]>Q&&(Gi+=Pe[vi+5])}if(Gi>Oi&&Gi>=Me){let Ti,vi=Ft*Oi,Vn=ri*Oi,Nr=-1;const vr=(st/gt<<5)+(Q+1)+this.points.length;for(const xr of ci){const Qn=xr*gt;if(Pe[Qn+2]<=Q)continue;Pe[Qn+2]=Q;const sn=Pe[Qn+5];vi+=Pe[Qn]*sn,Vn+=Pe[Qn+1]*sn,Pe[Qn+4]=vr,de&&(Ti||(Ti=this._map(Pe,st,!0),Nr=this.clusterProps.length,this.clusterProps.push(Ti)),de(Ti,this._map(Pe,Qn)))}Pe[st+4]=vr,Be.push(vi/Gi,Vn/Gi,1/0,vr,-1,Gi),de&&Be.push(Nr)}else{for(let Ti=0;Ti<gt;Ti++)Be.push(Pe[st+Ti]);if(Gi>1)for(const Ti of ci){const vi=Ti*gt;if(!(Pe[vi+2]<=Q)){Pe[vi+2]=Q;for(let Vn=0;Vn<gt;Vn++)Be.push(Pe[vi+Vn])}}}}return Be}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,Q,ce){if(Z[Q+5]>1){const Me=this.clusterProps[Z[Q+6]];return ce?Object.assign({},Me):Me}const xe=this.points[Z[Q+3]].properties,de=this.options.map(xe);return ce&&de===xe?Object.assign({},de):de}}function Ve(Ee,Z,Q){return{type:"Feature",id:Ee[Z+3],properties:Le(Ee,Z,Q),geometry:{type:"Point",coordinates:[(ce=Ee[Z],360*(ce-.5)),rt(Ee[Z+1])]}};var ce}function Le(Ee,Z,Q){const ce=Ee[Z+5],xe=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,de=Ee[Z+6],Me=de===-1?{}:Object.assign({},Q[de]);return Object.assign(Me,{cluster:!0,cluster_id:Ee[Z+3],point_count:ce,point_count_abbreviated:xe})}function Wt(Ee){return Ee/360+.5}function Jt(Ee){const Z=Math.sin(Ee*Math.PI/180),Q=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Q<0?0:Q>1?1:Q}function rt(Ee){const Z=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function oi(Ee,Z,Q,ce){let xe=ce;const de=Z+(Q-Z>>1);let Me,Oe=Q-Z;const Pe=Ee[Z],Be=Ee[Z+1],gt=Ee[Q],st=Ee[Q+1];for(let Ft=Z+3;Ft<Q;Ft+=3){const ri=Si(Ee[Ft],Ee[Ft+1],Pe,Be,gt,st);if(ri>xe)Me=Ft,xe=ri;else if(ri===xe){const ci=Math.abs(Ft-de);ci<Oe&&(Me=Ft,Oe=ci)}}xe>ce&&(Me-Z>3&&oi(Ee,Z,Me,ce),Ee[Me+2]=xe,Q-Me>3&&oi(Ee,Me,Q,ce))}function Si(Ee,Z,Q,ce,xe,de){let Me=xe-Q,Oe=de-ce;if(Me!==0||Oe!==0){const Pe=((Ee-Q)*Me+(Z-ce)*Oe)/(Me*Me+Oe*Oe);Pe>1?(Q=xe,ce=de):Pe>0&&(Q+=Me*Pe,ce+=Oe*Pe)}return Me=Ee-Q,Oe=Z-ce,Me*Me+Oe*Oe}function _i(Ee,Z,Q,ce){const xe={id:Ee??null,type:Z,geometry:Q,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")Kt(xe,Q);else if(Z==="Polygon")Kt(xe,Q[0]);else if(Z==="MultiLineString")for(const de of Q)Kt(xe,de);else if(Z==="MultiPolygon")for(const de of Q)Kt(xe,de[0]);return xe}function Kt(Ee,Z){for(let Q=0;Q<Z.length;Q+=3)Ee.minX=Math.min(Ee.minX,Z[Q]),Ee.minY=Math.min(Ee.minY,Z[Q+1]),Ee.maxX=Math.max(Ee.maxX,Z[Q]),Ee.maxY=Math.max(Ee.maxY,Z[Q+1])}function Wi(Ee,Z,Q,ce){if(!Z.geometry)return;const xe=Z.geometry.coordinates;if(xe&&xe.length===0)return;const de=Z.geometry.type,Me=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let Oe=[],Pe=Z.id;if(Q.promoteId?Pe=Z.properties[Q.promoteId]:Q.generateId&&(Pe=ce||0),de==="Point")Xi(xe,Oe);else if(de==="MultiPoint")for(const Be of xe)Xi(Be,Oe);else if(de==="LineString")Vi(xe,Oe,Me,!1);else if(de==="MultiLineString"){if(Q.lineMetrics){for(const Be of xe)Oe=[],Vi(Be,Oe,Me,!1),Ee.push(_i(Pe,"LineString",Oe,Z.properties));return}Ji(xe,Oe,Me,!1)}else if(de==="Polygon")Ji(xe,Oe,Me,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const Be of Z.geometry.geometries)Wi(Ee,{id:Pe,geometry:Be,properties:Z.properties},Q,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Be of xe){const gt=[];Ji(Be,gt,Me,!0),Oe.push(gt)}}Ee.push(_i(Pe,de,Oe,Z.properties))}function Xi(Ee,Z){Z.push(ki(Ee[0]),mr(Ee[1]),0)}function Vi(Ee,Z,Q,ce){let xe,de,Me=0;for(let Pe=0;Pe<Ee.length;Pe++){const Be=ki(Ee[Pe][0]),gt=mr(Ee[Pe][1]);Z.push(Be,gt,0),Pe>0&&(Me+=ce?(xe*gt-Be*de)/2:Math.sqrt(Math.pow(Be-xe,2)+Math.pow(gt-de,2))),xe=Be,de=gt}const Oe=Z.length-3;Z[2]=1,oi(Z,0,Oe,Q),Z[Oe+2]=1,Z.size=Math.abs(Me),Z.start=0,Z.end=Z.size}function Ji(Ee,Z,Q,ce){for(let xe=0;xe<Ee.length;xe++){const de=[];Vi(Ee[xe],de,Q,ce),Z.push(de)}}function ki(Ee){return Ee/360+.5}function mr(Ee){const Z=Math.sin(Ee*Math.PI/180),Q=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Q<0?0:Q>1?1:Q}function Er(Ee,Z,Q,ce,xe,de,Me,Oe){if(ce/=Z,de>=(Q/=Z)&&Me<ce)return Ee;if(Me<Q||de>=ce)return null;const Pe=[];for(const Be of Ee){const gt=Be.geometry;let st=Be.type;const Ft=xe===0?Be.minX:Be.minY,ri=xe===0?Be.maxX:Be.maxY;if(Ft>=Q&&ri<ce){Pe.push(Be);continue}if(ri<Q||Ft>=ce)continue;let ci=[];if(st==="Point"||st==="MultiPoint")Il(gt,ci,Q,ce,xe);else if(st==="LineString")Ys(gt,ci,Q,ce,xe,!1,Oe.lineMetrics);else if(st==="MultiLineString")Ks(gt,ci,Q,ce,xe,!1);else if(st==="Polygon")Ks(gt,ci,Q,ce,xe,!0);else if(st==="MultiPolygon")for(const Oi of gt){const Gi=[];Ks(Oi,Gi,Q,ce,xe,!0),Gi.length&&ci.push(Gi)}if(ci.length){if(Oe.lineMetrics&&st==="LineString"){for(const Oi of ci)Pe.push(_i(Be.id,st,Oi,Be.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(ci.length===1?(st="LineString",ci=ci[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=ci.length===3?"Point":"MultiPoint"),Pe.push(_i(Be.id,st,ci,Be.tags))}}return Pe.length?Pe:null}function Il(Ee,Z,Q,ce,xe){for(let de=0;de<Ee.length;de+=3){const Me=Ee[de+xe];Me>=Q&&Me<=ce&&ua(Z,Ee[de],Ee[de+1],Ee[de+2])}}function Ys(Ee,Z,Q,ce,xe,de,Me){let Oe=mo(Ee);const Pe=xe===0?Qs:ha;let Be,gt,st=Ee.start;for(let Gi=0;Gi<Ee.length-3;Gi+=3){const Ti=Ee[Gi],vi=Ee[Gi+1],Vn=Ee[Gi+2],Nr=Ee[Gi+3],vr=Ee[Gi+4],xr=xe===0?Ti:vi,Qn=xe===0?Nr:vr;let sn=!1;Me&&(Be=Math.sqrt(Math.pow(Ti-Nr,2)+Math.pow(vi-vr,2))),xr<Q?Qn>Q&&(gt=Pe(Oe,Ti,vi,Nr,vr,Q),Me&&(Oe.start=st+Be*gt)):xr>ce?Qn<ce&&(gt=Pe(Oe,Ti,vi,Nr,vr,ce),Me&&(Oe.start=st+Be*gt)):ua(Oe,Ti,vi,Vn),Qn<Q&&xr>=Q&&(gt=Pe(Oe,Ti,vi,Nr,vr,Q),sn=!0),Qn>ce&&xr<=ce&&(gt=Pe(Oe,Ti,vi,Nr,vr,ce),sn=!0),!de&&sn&&(Me&&(Oe.end=st+Be*gt),Z.push(Oe),Oe=mo(Ee)),Me&&(st+=Be)}let Ft=Ee.length-3;const ri=Ee[Ft],ci=Ee[Ft+1],Oi=xe===0?ri:ci;Oi>=Q&&Oi<=ce&&ua(Oe,ri,ci,Ee[Ft+2]),Ft=Oe.length-3,de&&Ft>=3&&(Oe[Ft]!==Oe[0]||Oe[Ft+1]!==Oe[1])&&ua(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&Z.push(Oe)}function mo(Ee){const Z=[];return Z.size=Ee.size,Z.start=Ee.start,Z.end=Ee.end,Z}function Ks(Ee,Z,Q,ce,xe,de){for(const Me of Ee)Ys(Me,Z,Q,ce,xe,de,!1)}function ua(Ee,Z,Q,ce){Ee.push(Z,Q,ce)}function Qs(Ee,Z,Q,ce,xe,de){const Me=(de-Z)/(ce-Z);return ua(Ee,de,Q+(xe-Q)*Me,1),Me}function ha(Ee,Z,Q,ce,xe,de){const Me=(de-Q)/(xe-Q);return ua(Ee,Z+(ce-Z)*Me,de,1),Me}function _s(Ee,Z){const Q=[];for(let ce=0;ce<Ee.length;ce++){const xe=Ee[ce],de=xe.type;let Me;if(de==="Point"||de==="MultiPoint"||de==="LineString")Me=da(xe.geometry,Z);else if(de==="MultiLineString"||de==="Polygon"){Me=[];for(const Oe of xe.geometry)Me.push(da(Oe,Z))}else if(de==="MultiPolygon"){Me=[];for(const Oe of xe.geometry){const Pe=[];for(const Be of Oe)Pe.push(da(Be,Z));Me.push(Pe)}}Q.push(_i(xe.id,de,Me,xe.tags))}return Q}function da(Ee,Z){const Q=[];Q.size=Ee.size,Ee.start!==void 0&&(Q.start=Ee.start,Q.end=Ee.end);for(let ce=0;ce<Ee.length;ce+=3)Q.push(Ee[ce]+Z,Ee[ce+1],Ee[ce+2]);return Q}function il(Ee,Z){if(Ee.transformed)return Ee;const Q=1<<Ee.z,ce=Ee.x,xe=Ee.y;for(const de of Ee.features){const Me=de.geometry,Oe=de.type;if(de.geometry=[],Oe===1)for(let Pe=0;Pe<Me.length;Pe+=2)de.geometry.push($n(Me[Pe],Me[Pe+1],Z,Q,ce,xe));else for(let Pe=0;Pe<Me.length;Pe++){const Be=[];for(let gt=0;gt<Me[Pe].length;gt+=2)Be.push($n(Me[Pe][gt],Me[Pe][gt+1],Z,Q,ce,xe));de.geometry.push(Be)}}return Ee.transformed=!0,Ee}function $n(Ee,Z,Q,ce,xe,de){return[Math.round(Q*(Ee*ce-xe)),Math.round(Q*(Z*ce-de))]}function yr(Ee,Z,Q,ce,xe){const de=Z===xe.maxZoom?0:xe.tolerance/((1<<Z)*xe.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:Ee.length,source:null,x:Q,y:ce,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Oe of Ee)lc(Me,Oe,de,xe);return Me}function lc(Ee,Z,Q,ce){const xe=Z.geometry,de=Z.type,Me=[];if(Ee.minX=Math.min(Ee.minX,Z.minX),Ee.minY=Math.min(Ee.minY,Z.minY),Ee.maxX=Math.max(Ee.maxX,Z.maxX),Ee.maxY=Math.max(Ee.maxY,Z.maxY),de==="Point"||de==="MultiPoint")for(let Oe=0;Oe<xe.length;Oe+=3)Me.push(xe[Oe],xe[Oe+1]),Ee.numPoints++,Ee.numSimplified++;else if(de==="LineString")Ml(Me,xe,Ee,Q,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let Oe=0;Oe<xe.length;Oe++)Ml(Me,xe[Oe],Ee,Q,de==="Polygon",Oe===0);else if(de==="MultiPolygon")for(let Oe=0;Oe<xe.length;Oe++){const Pe=xe[Oe];for(let Be=0;Be<Pe.length;Be++)Ml(Me,Pe[Be],Ee,Q,!0,Be===0)}if(Me.length){let Oe=Z.tags||null;if(de==="LineString"&&ce.lineMetrics){Oe={};for(const Be in Z.tags)Oe[Be]=Z.tags[Be];Oe.mapbox_clip_start=xe.start/xe.size,Oe.mapbox_clip_end=xe.end/xe.size}const Pe={geometry:Me,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Oe};Z.id!==null&&(Pe.id=Z.id),Ee.features.push(Pe)}}function Ml(Ee,Z,Q,ce,xe,de){const Me=ce*ce;if(ce>0&&Z.size<(xe?Me:ce))return void(Q.numPoints+=Z.length/3);const Oe=[];for(let Pe=0;Pe<Z.length;Pe+=3)(ce===0||Z[Pe+2]>Me)&&(Q.numSimplified++,Oe.push(Z[Pe],Z[Pe+1])),Q.numPoints++;xe&&(function(Pe,Be){let gt=0;for(let st=0,Ft=Pe.length,ri=Ft-2;st<Ft;ri=st,st+=2)gt+=(Pe[st]-Pe[ri])*(Pe[st+1]+Pe[ri+1]);if(gt>0===Be)for(let st=0,Ft=Pe.length;st<Ft/2;st+=2){const ri=Pe[st],ci=Pe[st+1];Pe[st]=Pe[Ft-2-st],Pe[st+1]=Pe[Ft-1-st],Pe[Ft-2-st]=ri,Pe[Ft-1-st]=ci}})(Oe,de),Ee.push(Oe)}const Qo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class De{constructor(Z,Q){const ce=(Q=this.options=(function(de,Me){for(const Oe in Me)de[Oe]=Me[Oe];return de})(Object.create(Qo),Q)).debug;if(ce&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=(function(de,Me){const Oe=[];if(de.type==="FeatureCollection")for(let Pe=0;Pe<de.features.length;Pe++)Wi(Oe,de.features[Pe],Me,Pe);else Wi(Oe,de.type==="Feature"?de:{geometry:de},Me);return Oe})(Z,Q);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=(function(de,Me){const Oe=Me.buffer/Me.extent;let Pe=de;const Be=Er(de,1,-1-Oe,Oe,0,-1,2,Me),gt=Er(de,1,1-Oe,2+Oe,0,-1,2,Me);return(Be||gt)&&(Pe=Er(de,1,-Oe,1+Oe,0,-1,2,Me)||[],Be&&(Pe=_s(Be,1).concat(Pe)),gt&&(Pe=Pe.concat(_s(gt,-1)))),Pe})(xe,Q),xe.length&&this.splitTile(xe,0,0,0),ce&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,Q,ce,xe,de,Me,Oe){const Pe=[Z,Q,ce,xe],Be=this.options,gt=Be.debug;for(;Pe.length;){xe=Pe.pop(),ce=Pe.pop(),Q=Pe.pop(),Z=Pe.pop();const st=1<<Q,Ft=Lt(Q,ce,xe);let ri=this.tiles[Ft];if(!ri&&(gt>1&&console.time("creation"),ri=this.tiles[Ft]=yr(Z,Q,ce,xe,Be),this.tileCoords.push({z:Q,x:ce,y:xe}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ce,xe,ri.numFeatures,ri.numPoints,ri.numSimplified),console.timeEnd("creation"));const sn=`z${Q}`;this.stats[sn]=(this.stats[sn]||0)+1,this.total++}if(ri.source=Z,de==null){if(Q===Be.indexMaxZoom||ri.numPoints<=Be.indexMaxPoints)continue}else{if(Q===Be.maxZoom||Q===de)continue;if(de!=null){const sn=de-Q;if(ce!==Me>>sn||xe!==Oe>>sn)continue}}if(ri.source=null,Z.length===0)continue;gt>1&&console.time("clipping");const ci=.5*Be.buffer/Be.extent,Oi=.5-ci,Gi=.5+ci,Ti=1+ci;let vi=null,Vn=null,Nr=null,vr=null,xr=Er(Z,st,ce-ci,ce+Gi,0,ri.minX,ri.maxX,Be),Qn=Er(Z,st,ce+Oi,ce+Ti,0,ri.minX,ri.maxX,Be);Z=null,xr&&(vi=Er(xr,st,xe-ci,xe+Gi,1,ri.minY,ri.maxY,Be),Vn=Er(xr,st,xe+Oi,xe+Ti,1,ri.minY,ri.maxY,Be),xr=null),Qn&&(Nr=Er(Qn,st,xe-ci,xe+Gi,1,ri.minY,ri.maxY,Be),vr=Er(Qn,st,xe+Oi,xe+Ti,1,ri.minY,ri.maxY,Be),Qn=null),gt>1&&console.timeEnd("clipping"),Pe.push(vi||[],Q+1,2*ce,2*xe),Pe.push(Vn||[],Q+1,2*ce,2*xe+1),Pe.push(Nr||[],Q+1,2*ce+1,2*xe),Pe.push(vr||[],Q+1,2*ce+1,2*xe+1)}}getTile(Z,Q,ce){Z=+Z,Q=+Q,ce=+ce;const xe=this.options,{extent:de,debug:Me}=xe;if(Z<0||Z>24)return null;const Oe=1<<Z,Pe=Lt(Z,Q=Q+Oe&Oe-1,ce);if(this.tiles[Pe])return il(this.tiles[Pe],de);Me>1&&console.log("drilling down to z%d-%d-%d",Z,Q,ce);let Be,gt=Z,st=Q,Ft=ce;for(;!Be&&gt>0;)gt--,st>>=1,Ft>>=1,Be=this.tiles[Lt(gt,st,Ft)];return Be&&Be.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",gt,st,Ft),console.time("drilling down")),this.splitTile(Be.source,gt,st,Ft,Z,Q,ce),Me>1&&console.timeEnd("drilling down"),this.tiles[Pe]?il(this.tiles[Pe],de):null):null}}function Lt(Ee,Z,Q){return 32*((1<<Ee)*Q+Z)+Ee}function Ae(Ee,Z){const Q=Ee.tileID.canonical;if(!this._geoJSONIndex)return void Z(null,null);const ce=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!ce)return void Z(null,null);const xe=Be=>Be.tags&&"3d_elevation_id"in Be.tags&&"source"in Be.tags&&Be.tags.source==="elevation",de=ce.features.filter(Be=>xe(Be));let Me={_geojsonTileLayer:ce.features};de.length>0&&(Me={_geojsonTileLayer:ce.features.filter(Be=>!xe(Be)),hd_road_elevation:de});const Oe=new _t(Me),Pe=(function(Be){const gt=new s.bt;for(const st of Object.keys(Be))gt.writeMessage(3,Zt,{name:st,features:Be[st]});return gt.finish()})(Me).buffer;Z(null,{vectorTile:Oe,rawData:Pe})}class Ot extends At{constructor(Z,Q,ce,xe,de,Me,Oe){super(Z,Q,ce,xe,de,Ae,Oe),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new Nt}loadData(Z,Q){const ce=Z&&Z.request,xe=ce&&ce.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Z,(de,Me)=>{if(de||!Me)return Q(de);if(typeof Me!="object")return Q(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{try{if(Z.filter){const Pe=s.U(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(Be=>`${Be.key}: ${Be.message}`).join(", "));Me.features=Me.features.filter(Be=>Pe.value.evaluate({zoom:0},Be))}Z.dynamic?(Me.type==="Feature"&&(Me={type:"FeatureCollection",features:[Me]}),Z.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Me.features,this.loaded),Z.cluster&&(Me.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Z.cluster?new zi((function({superclusterOptions:Pe,clusterProperties:Be}){if(!Be||!Pe)return Pe;const gt={},st={},Ft={accumulated:null,zoom:0},ri={properties:null},ci=Object.keys(Be);for(const Oi of ci){const[Gi,Ti]=Be[Oi],vi=s.U(Ti),Vn=s.U(typeof Gi=="string"?[Gi,["accumulated"],["get",Oi]]:Gi);gt[Oi]=vi.value,st[Oi]=Vn.value}return Pe.map=Oi=>{ri.properties=Oi;const Gi={};for(const Ti of ci)Gi[Ti]=gt[Ti].evaluate(Ft,ri);return Gi},Pe.reduce=(Oi,Gi)=>{ri.properties=Gi;for(const Ti of ci)Ft.accumulated=Oi[Ti],Oi[Ti]=st[Ti].evaluate(Ft,ri)},Pe})(Z)).load(Me.features):Z.dynamic?this._dynamicIndex:(function(Pe,Be){return new De(Pe,Be)})(Me,Z.geojsonVtOptions)}catch(Pe){return Q(Pe)}const Oe={};if(xe){const Pe=P(ce);Pe&&(Oe.resourceTiming={},Oe.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Pe)))}Q(null,Oe)}})}reloadTile(Z,Q){const ce=this.loaded;return ce&&ce[Z.uid]?Z.partial?Q(null,void 0):super.reloadTile(Z,Q):this.loadTile(Z,Q)}loadGeoJSON(Z,Q){if(Z.request)s.m(Z.request,Q);else{if(typeof Z.data!="string")return Q(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return Q(null,JSON.parse(Z.data))}catch{return Q(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Z,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ce){Q(ce)}}getClusterChildren(Z,Q){try{Q(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ce){Q(ce)}}getClusterLeaves(Z,Q){try{Q(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ce){Q(ce)}}}class yi{constructor(Z,Q,ce){this.tileID=new s.aQ(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=Q,this.worldview=ce}parse(Z,Q,ce,xe){this.status="parsing";const de=new s.aQ(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Me=[],Oe=Q.familiesBySource[ce.source],Pe=new s.fn(de,ce.promoteId);Pe.bucketLayerIDs=[],Pe.is3DTile=!0,s.fC(Z).then(Be=>{if(!Be)return xe(new Error("Could not parse tile"));const gt=Be.json.extensionsUsed&&Be.json.extensionsUsed.includes("MAPBOX_mesh_features")||Be.json.asset.extras&&Be.json.asset.extras.MAPBOX_mesh_features,st=Be.json.extensionsUsed&&Be.json.extensionsUsed.includes("EXT_meshopt_compression"),Ft=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const ri in Oe)for(const ci of Oe[ri]){const Oi=ci[0];Pe.bucketLayerIDs.push(ci.map(vi=>s.B(vi.id,vi.scope))),Oi.recalculate(Ft,[]);const Gi=s.fD(Be,1/s.d7(ce.tileID.canonical)),Ti=new s.fE(ci,Gi,de,gt,st,this.brightness,Pe,this.worldview);gt||(Ti.needsUpload=!0),Me.push(Ti),Ti.evaluate(Oi)}this.status="done",xe(null,{buckets:Me,featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Be=>xe(new Error(Be.message)))}}class Cn{constructor(Z,Q,ce,xe,de,Me,Oe,Pe){this.actor=Z,this.layerIndex=Q,this.availableImages=ce,this.availableModels=xe,this.brightness=Oe,this.loading={},this.loaded={},this.worldview=Pe}loadTile(Z,Q){const ce=Z.uid,xe=this.loading[ce]=new yi(Z,this.brightness,this.worldview);s.bu(Z.request,(de,Me)=>{const Oe=!this.loading[ce];return delete this.loading[ce],Oe||de?(xe.status="done",Oe||(this.loaded[ce]=xe),Q(de)):Me&&Me.byteLength!==0?void xe.parse(Me,this.layerIndex,Z,(Pe,Be)=>{xe.status="done",this.loaded=this.loaded||{},this.loaded[ce]=xe,Pe||!Be?Q(Pe):Q(null,Be)}):(xe.status="done",this.loaded[ce]=xe,Q())})}reloadTile(Z,Q){const ce=this.loaded,xe=Z.uid;if(ce&&ce[xe]){const de=ce[xe];de.projection=Z.projection,de.brightness=Z.brightness;const Me=(Oe,Pe)=>{de.reloadCallback&&(delete de.reloadCallback,this.loadTile(Z,Q)),Q(Oe,Pe)};de.status==="parsing"?de.reloadCallback=Me:de.status==="done"&&this.loadTile(Z,Q)}}abortTile(Z,Q){const ce=Z.uid;this.loading[ce]&&delete this.loading[ce],Q()}removeTile(Z,Q){const ce=this.loaded,xe=Z.uid;ce&&ce[xe]&&delete ce[xe],Q()}}class ii{constructor(Z){this.self=Z,this.actor=new s.fG(Z,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cm({name:"mercator"}),this.workerSourceTypes={vector:At,geojson:Ot,"raster-dem":ft,"raster-array":Et,"batched-model":Cn},this.workerSources={},this.self.registerWorkerSource=(Q,ce)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=ce},this.self.registerRTLTextPlugin=Q=>{if(s.fH.isParsed())throw new Error("RTL text plugin already registered.");s.fH.setState({pluginStatus:s.fI.parsed,pluginURL:s.fH.getPluginURL()}),s.fH.applyArabicShaping=Q.applyArabicShaping,s.fH.processBidirectionalText=Q.processBidirectionalText,s.fH.processStyledBidirectionalText=Q.processStyledBidirectionalText;for(const ce of this.rtlPluginParsingListeners)ce(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Z,Q,ce){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.availableModels[Z],delete this.workerSources[Z],ce()}checkIfReady(Z,Q,ce){ce()}setReferrer(Z,Q){this.referrer=Q}spriteLoaded(Z,Q){this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={});const{scope:ce,isLoaded:xe}=Q;if(this.isSpriteLoaded[Z][ce]=xe,this.workerSources[Z]&&this.workerSources[Z][ce])for(const de in this.workerSources[Z][ce]){const Me=this.workerSources[Z][ce][de];for(const Oe in Me){const Pe=Me[Oe];Pe instanceof At&&(Pe.isSpriteLoaded=xe,Pe.fire(new s.z("isSpriteLoaded")))}}}setImages(Z,Q,ce){this.availableImages[Z]||(this.availableImages[Z]={});const{scope:xe,images:de}=Q;if(this.availableImages[Z][xe]=de,this.workerSources[Z]&&this.workerSources[Z][xe]){for(const Me in this.workerSources[Z][xe]){const Oe=this.workerSources[Z][xe][Me];for(const Pe in Oe)Oe[Pe].availableImages=de}ce()}else ce()}setModels(Z,{scope:Q,models:ce},xe){if(this.availableModels[Z]||(this.availableModels[Z]={}),this.availableModels[Z][Q]=ce,this.workerSources[Z]&&this.workerSources[Z][Q]){for(const de in this.workerSources[Z][Q]){const Me=this.workerSources[Z][Q][de];for(const Oe in Me)Me[Oe].availableModels=ce}xe()}else xe()}setProjection(Z,Q){this.projections[Z]=s.cm(Q)}setBrightness(Z,Q,ce){this.brightness=Q,ce()}setWorldview(Z,Q,ce){this.worldview=Q,ce()}setLayers(Z,Q,ce){this.getLayerIndex(Z,Q.scope).replace(Q.layers,Q.options),ce()}updateLayers(Z,Q,ce){this.getLayerIndex(Z,Q.scope).update(Q.layers,Q.removedIds,Q.options),ce()}loadTile(Z,Q,ce){Q.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Q.type,Q.source,Q.scope).loadTile(Q,ce)}decodeRasterArray(Z,Q,ce){this.getWorkerSource(Z,Q.type,Q.source,Q.scope).decodeRasterArray(Q,ce)}reloadTile(Z,Q,ce){Q.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Q.type,Q.source,Q.scope).reloadTile(Q,ce)}abortTile(Z,Q,ce){this.getWorkerSource(Z,Q.type,Q.source,Q.scope).abortTile(Q,ce)}removeTile(Z,Q,ce){this.getWorkerSource(Z,Q.type,Q.source,Q.scope).removeTile(Q,ce)}removeSource(Z,Q,ce){if(!(this.workerSources[Z]&&this.workerSources[Z][Q.scope]&&this.workerSources[Z][Q.scope][Q.type]&&this.workerSources[Z][Q.scope][Q.type][Q.source]))return;const xe=this.workerSources[Z][Q.scope][Q.type][Q.source];delete this.workerSources[Z][Q.scope][Q.type][Q.source],xe.removeSource!==void 0?xe.removeSource(Q,ce):ce()}loadWorkerSource(Z,Q,ce){try{this.self.importScripts(Q.url),ce()}catch(xe){ce(xe)}}syncRTLPluginState(Z,Q,ce){if(s.fH.isParsed())ce(null,!0);else if(s.fH.isParsing())this.rtlPluginParsingListeners.push(ce);else try{s.fH.setState(Q);const xe=s.fH.getPluginURL();!s.fH.isLoaded()||s.fH.isParsed()||s.fH.isParsing()||xe==null||(s.fH.setState({pluginStatus:s.fI.parsing,pluginURL:s.fH.getPluginURL()}),this.self.importScripts(xe),s.fH.isParsed()?ce(null,!0):this.rtlPluginParsingListeners.push(ce))}catch(xe){ce(xe)}}setDracoUrl(Z,Q){this.dracoUrl=Q}getAvailableImages(Z,Q){this.availableImages[Z]||(this.availableImages[Z]={});let ce=this.availableImages[Z][Q];return ce||(ce=[]),ce}getAvailableModels(Z,Q){this.availableModels[Z]||(this.availableModels[Z]={});let ce=this.availableModels[Z][Q];return ce||(ce={}),ce}getLayerIndex(Z,Q){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let ce=this.layerIndexes[Z][Q];return ce||(ce=this.layerIndexes[Z][Q]=new V,ce.scope=Q),ce}getWorkerSource(Z,Q,ce,xe){const de=this.workerSources;return de[Z]||(de[Z]={}),de[Z][xe]||(de[Z][xe]={}),de[Z][xe][Q]||(de[Z][xe][Q]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),de[Z][xe][Q][ce]||(de[Z][xe][Q][ce]=new this.workerSourceTypes[Q]({send:(Me,Oe,Pe,Be,gt,st)=>this.actor.send(Me,Oe,Pe,Z,gt,st),scheduler:this.actor.scheduler},this.getLayerIndex(Z,xe),this.getAvailableImages(Z,xe),this.getAvailableModels(Z,xe),this.isSpriteLoaded[Z][xe],void 0,this.brightness,this.worldview)),de[Z][xe][Q][ce]}rasterizeImagesWorker(Z,Q,ce){const xe=new Map;for(const[de,{image:Me,imageVariant:Oe}]of Q.tasks.entries()){const Pe=this.imageRasterizer.rasterize(Oe,Me,Q.scope,Z);xe.set(de,Pe)}ce(void 0,xe)}removeRasterizedImages(Z,Q,ce){this.imageRasterizer.removeImagesFromCacheByIds(Q.imageIds,Q.scope,Z),ce()}enforceCacheSizeLimit(Z,Q){s.fJ(Q)}getWorkerPerformanceMetrics(Z,Q,ce){ce(void 0,void 0)}}return s.fF(self)&&(self.worker=new ii(self)),ii}),f(["./shared"],function(s){var P="3.18.1";const C={create:"create",load:"load",fullLoad:"fullLoad"},O={mark(p){performance.mark(p)},measure(p,n,u){performance.measure(p,n,u)}};function F(p){const n=p.name.split("?")[0];return s.a(n)&&n.includes("mapbox-gl.js")?"javascript":s.a(n)&&n.includes("mapbox-gl.css")?"css":s.b(n)?"fontRange":s.c(n)?"sprite":s.i(n)?"style":s.d(n)?"tilejson":"other"}var V,q={},ee=(function(){if(V)return q;function p(m){return!n(m)}function n(m){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,w,E=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(E);try{w=new Worker(I),b=!0}catch{b=!1}return w&&w.terminate(),URL.revokeObjectURL(I),b})()?(function(){var b=document.createElement("canvas");b.width=b.height=1;var w=b.getContext("2d");if(!w)return!1;var E=w.getImageData(0,0,1,1);return E&&E.width===b.width})()?(u[y=m&&m.failIfMajorPerformanceCaveat]===void 0&&(u[y]=(function(b){var w,E=(function(I){var L=document.createElement("canvas"),R=Object.create(p.webGLContextAttributes);return R.failIfMajorPerformanceCaveat=I,L.getContext("webgl2",R)})(b);if(!E)return!1;try{w=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!w||E.isContextLost())&&(E.shaderSource(w,"void main() {}"),E.compileShader(w),E.getShaderParameter(w,E.COMPILE_STATUS)===!0)})(y)),u[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}V=1,q.supported=p,q.notSupportedReason=n;var u={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},q})();function se(p,n,u){const m=document.createElement(p);return n!=null&&(m.className=n),u&&u.appendChild(m),m}function fe(p,n,u){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const y of Object.keys(n))m.setAttributeNS(null,y,String(n[y]));return u&&u.appendChild(m),m}const ae=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ie=ae&&ae.userSelect!==void 0?"userSelect":"WebkitUserSelect";let tt;function Ue(){ae&&ie&&(tt=ae[ie],ae[ie]="none")}function Ne(){ae&&ie&&(ae[ie]=tt)}function Ce(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",Ce,!0)}function Ye(){window.addEventListener("click",Ce,!0),window.setTimeout(()=>{window.removeEventListener("click",Ce,!0)},0)}function At(p,n){const u=p.getBoundingClientRect();return Et(p,u,n)}function ft(p,n){const u=p.getBoundingClientRect(),m=[];for(let y=0;y<n.length;y++)m.push(Et(p,u,n[y]));return m}function wt(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function Et(p,n,u){const m=p.offsetWidth===n.width?1:p.offsetWidth/n.width;return new s.P((u.clientX-n.left)*m,(u.clientY-n.top)*m)}const Dt="01",Qe="NO_ACCESS_TOKEN";class ht{constructor(n,u,m){this._transformRequestFn=n,this._customAccessToken=u,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const n=(function(){let u="";for(let m=0;m<10;m++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Dt,u].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,u){return this._transformRequestFn&&this._transformRequestFn(n,u)||{url:n}}normalizeStyleURL(n,u){if(!s.h(n))return n;const m=yt(n);return m.params.push(`sdk=js-${P}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||u)}normalizeGlyphsURL(n,u){if(!s.h(n))return n;const m=yt(n);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||u)}normalizeModelURL(n,u){if(!s.h(n))return n;const m=yt(n);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||u)}normalizeSourceURL(n,u,m,y){if(!s.h(n))return n;const b=yt(n);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),m&&b.params.push(`language=${m}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||u)}normalizeIconsetURL(n,u){const m=yt(n);return s.h(n)?(m.path=`/styles/v1${m.path}/iconset.pbf`,this._makeAPIURL(m,this._customAccessToken||u)):Nt(m)}normalizeSpriteURL(n,u,m,y){const b=yt(n);return s.h(n)?(b.path=`/styles/v1${b.path}/sprite${u}${m}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${u}${m}`,Nt(b))}normalizeTileURL(n,u,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!s.h(n))return n;const y=yt(n);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||m&&y.authority!=="raster"&&m===512?"@2x":""}${s.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${s.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${s.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${s.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||(function(w){for(const E of w){const I=E.match(/^access_token=(.*)$/);if(I)return I[1]}return null})(y.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(n,u){const m=yt(n);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return n;let y="mapbox://";m.path.match(/^\/raster\/v1\//)?y+=`raster/${m.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${m.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${m.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let b=m.params;return u&&(b=b.filter(w=>!w.match(/^access_token=/))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(n,u){const m=!!u&&s.h(u),y=[];for(const b of n.tiles||[])s.j(b)?y.push(this.canonicalizeTileURL(b,m)):y.push(b);return y}_makeAPIURL(n,u){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=yt(s.e.API_URL);if(n.protocol=y.protocol,n.authority=y.authority,n.protocol==="http"){const b=n.params.indexOf("secure");b>=0&&n.params.splice(b,1)}if(y.path!=="/"&&(n.path=`${y.path}${n.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Nt(n);if(u=u||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return n.params=n.params.filter(b=>b.indexOf("access_token")===-1),n.params.push(`access_token=${u||""}`),Nt(n)}}const _t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yt(p){const n=p.match(_t);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Nt(p){const n=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${n}`}const ei="mapbox.eventData";function mi(p){if(!p)return null;const n=p.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(s.l(n[1]))}catch{return null}}class Pi{constructor(n){this.type=n,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const u=mi(s.e.ACCESS_TOKEN);let m="";return m=u&&u.u?s.f(u.u):s.e.ACCESS_TOKEN||"",n?`${ei}.${n}:${m}`:`${ei}:${m}`}fetchEventData(){const n=s.s("localStorage"),u=this.getStorageKey(),m=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp");if(n)try{const b=localStorage.getItem(u);b&&(this.eventData=JSON.parse(b));const w=localStorage.getItem(m);w&&(this.anonId=w);const E=localStorage.getItem(y);E&&(this.anonIdTimestamp=Number(E));const I=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<I)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const n=s.s("localStorage"),u=this.getStorageKey(),m=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp"),b=this.anonId,w=this.anonIdTimestamp;if(n&&b)try{localStorage.setItem(m,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(u,JSON.stringify(this.eventData)),w&&localStorage.setItem(y,w.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,u,m,y){if(!s.e.EVENTS_URL)return;const b=yt(s.e.EVENTS_URL);b.params.push(`access_token=${y||s.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(n).toISOString()},E=u?Object.assign(w,u):w,I={url:Nt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=s.p(I,L=>{this.pendingRequest=null,m(L),this.saveEventData(),this.processRequests(y)})}queueRequest(n,u){this.queue.push(n),this.processRequests(u)}}class Ai extends Pi{constructor(n){super("metrics"),n&&(this.data=n)}postMetricsEvent(n){if(!s.e.EVENTS_URL||!n&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const u=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:u},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:u,payload:m}=this.queue.shift();this.postEvent(u,m,()=>{},n)}}const dn=new class extends Pi{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,n){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(u=>s.h(u)||s.j(u))&&this.queueRequest(Date.now(),n)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=mi(s.e.ACCESS_TOKEN),u=n?n.u:s.e.ACCESS_TOKEN;let m=u!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),m=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),w=new Date(y),E=(y-this.eventData.lastSuccess)/864e5;m=m||E>=1||E<-1||b.getDate()!==w.getDate()}else m=!0;m?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:Dt,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=u)},p):this.processRequests()}},wi=dn.postTurnstileEvent.bind(dn),Rn=new class extends Pi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,n,u,m){this.skuToken=n,this.errorCb=m,s.e.EVENTS_URL&&(u||s.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},u):this.errorCb(new Error(Qe)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:u}=this.queue.shift();n&&this.success[n]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:Dt,skuToken:this.skuToken,userId:this.anonId},m=>{m?this.errorCb(m):n&&(this.success[n]=!0)},p))}remove(){this.errorCb=null}},Un=Rn.postMapLoadEvent.bind(Rn),Zt=new class extends Pi{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let n=this.mapInstanceIdMap.get(p);return n||(n=s.u(),this.mapInstanceIdMap.set(p,n)),n}getEventId(p){const n=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,n+1),n}postStyleLoadEvent(p,n){const{map:u,style:m,importedStyles:y}=n;if(!s.e.EVENTS_URL||!p&&!s.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(u),w={mapInstanceId:b,eventId:this.getEventId(b),style:m};y.length&&(w.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:w},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:u}=this.queue.shift();this.postEvent(n,u,()=>{},p)}},pr=Zt.postStyleLoadEvent.bind(Zt),zn=new Ai({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Di=zn.postMetricsEvent.bind(zn),Ii=new Ai({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),hn=Ii.postMetricsEvent.bind(Ii),ti=new class extends Pi{constructor(){super("gljs.performance")}postPerformanceEvent(p,n){s.e.EVENTS_URL&&(p||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:u}=this.queue.shift(),m=(function(y){const b=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),E=(function(U){const W={};if(U){for(const G in U)if(G!=="other")for(const J of U[G]){const K=`${G}ResolveRangeMin`,oe=`${G}ResolveRangeMax`,re=`${G}RequestCount`,ne=`${G}RequestCachedCount`;W[K]=Math.min(W[K]||1/0,J.startTime),W[oe]=Math.max(W[oe]||-1/0,J.responseEnd);const be=_e=>{W[_e]===void 0&&(W[_e]=0),++W[_e]};J.transferSize!==void 0&&J.transferSize===0&&be(ne),be(re)}}return W})((function(U,W){const G={};if(U)for(const J of U){const K=W(J);G[K]===void 0&&(G[K]=[]),G[K].push(J)}return G})(b,F)),I=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,R=L?L.effectiveType:void 0,N={counters:[],metadata:[],attributes:[]},B=(U,W,G)=>{G!=null&&U.push({name:W,value:G.toString()})};for(const U in E)B(N.counters,U,E[U]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(B(N.counters,"interactionRangeMin",y.interactionRange[0]),B(N.counters,"interactionRangeMax",y.interactionRange[1])),w)for(const U of Object.values(C)){const W=w.find(G=>G.name===U);W&&B(N.counters,U,W.startTime)}return B(N.counters,"visibilityHidden",y.visibilityHidden),B(N.attributes,"style",(function(U){if(U)for(const W of U){const G=W.name.split("?")[0];if(s.i(G)){const J=G.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}})(b)),B(N.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),B(N.attributes,"fogEnabled",y.fogEnabled?"true":"false"),B(N.attributes,"projection",y.projection),B(N.attributes,"zoom",y.zoom),B(N.metadata,"devicePixelRatio",I),B(N.metadata,"connectionEffectiveType",R),B(N.metadata,"navigatorUserAgent",navigator.userAgent),B(N.metadata,"screenWidth",window.screen.width),B(N.metadata,"screenHeight",window.screen.height),B(N.metadata,"windowWidth",window.innerWidth),B(N.metadata,"windowHeight",window.innerHeight),B(N.metadata,"mapWidth",y.width/I),B(N.metadata,"mapHeight",y.height/I),B(N.metadata,"webglRenderer",y.renderer),B(N.metadata,"webglVendor",y.vendor),B(N.metadata,"sdkVersion",P),B(N.metadata,"sdkIdentifier","mapbox-gl-js"),N})(u);for(const y of m.metadata);for(const y of m.counters);for(const y of m.attributes);this.postEvent(n,m,()=>{},p)}},qt=ti.postPerformanceEvent.bind(ti),hi=new class extends Pi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,n,u,m){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const y=yt(s.e.API_URL+s.e.SESSION_PATH);y.params.push(`sku=${n||""}`),y.params.push(`access_token=${m||s.e.ACCESS_TOKEN||""}`);const b={url:Nt(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(b,w=>{this.pendingRequest=null,u(w),this.saveEventData(),this.processRequests(m)})}getSessionAPI(p,n,u,m){this.skuToken=n,this.errorCb=m,s.e.SESSION_PATH&&s.e.API_URL&&(u||s.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},u):this.errorCb(new Error(Qe)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:u}=this.queue.shift();n&&this.success[n]||this.getSession(u,this.skuToken,m=>{m?this.errorCb(m):n&&(this.success[n]=!0)},p)}remove(){this.errorCb=null}},ji=hi.getSessionAPI.bind(hi),zi=new Set;function Ve(p,n){n?zi.add(p):zi.delete(p)}class Le{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,u){this._updatedSourceCaches[n]=u,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const u=n.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(n.id),this.setDirty()}removeLayer(n){const u=n.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][n.id]=n,this._updatedLayers[u].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const u in this._updatedLayers)n[u]=n[u]||{},n[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)n[u]=n[u]||{},n[u].removedIds=Object.keys(this._removedLayers[u]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,u){this._updatedImages[u]=this._updatedImages[u]||new Set,this._updatedImages[u].add(s.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Wt(p){const{userImage:n}=p;return!!(n&&n.render&&n.render())&&(p.data.replace(new Uint8Array(n.data.buffer)),!0)}class Jt extends s.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new s.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const u=this.atlasTexture.get(n);u&&(u.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,u){this.imageProviders.has(u)||this.imageProviders.set(u,new Map),this.imageProviders.get(u).set(n.id,n)}removeImageProvider(n,u){this.imageProviders.has(u)&&this.imageProviders.get(u).delete(n)}getPendingImageProviders(){const n=[];for(const u of this.imageProviders.values())for(const m of u.values())m.hasPendingRequests()&&n.push(m);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,u){if(this.loaded.get(u)!==n&&(this.loaded.set(u,n),n)){for(const{ids:m,callback:y}of this.requestors)this._notify(m,u,y);this.requestors=[]}}hasImage(n,u){return!!this.getImage(n,u)}getImage(n,u){return this.images.get(u).get(n.toString())}addImage(n,u,m){this._validate(n,m)&&this.images.get(u).set(n.toString(),m)}_validate(n,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "content" value`))),m=!1),m}_validateStretch(n,u){if(!n)return!0;let m=0;for(const y of n){if(y[0]<m||y[1]<y[0]||u<y[1])return!1;m=y[1]}return!0}_validateContent(n,u){return n?n.length!==4||!u.usvg&&(n[0]<0||u.data.width<n[0]||n[1]<0||u.data.height<n[1]||n[2]<0||u.data.width<n[2]||n[3]<0||u.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,u,m){const y=this.images.get(u).get(n.toString());m.version=y.version+1,this.images.get(u).set(n.toString(),m),this.updatedImages.get(u).add(n),this.removeFromImageRasterizerCache(n,u)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,u){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:u}):this.imageRasterizer.removeImagesFromCacheByIds([n],u))}removeImage(n,u){const m=this.images.get(u),y=m.get(n.toString());m.delete(n.toString()),this.patterns.get(u).delete(n.toString()),this.removeFromImageRasterizerCache(n,u),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(u=>s.I.from(u))}getImages(n,u,m){const y=[],b=[],w=this.imageProviders.get(u);for(const R of n){if(!R.iconsetId){y.push(R);continue}const N=w.get(R.iconsetId);N&&(this.getImage(R,u)?b.push(R):N.addPendingRequest(R))}if(y.length===0)return void this._notify(b,u,m);let E=!0;const I=!!this.loaded.get(u),L=this.images.get(u);if(!I)for(const R of y)L.has(R.toString())||(E=!1);I||E?this._notify(y,u,m):this.requestors.push({ids:y,scope:u,callback:m})}rasterizeImages(n,u){const m=new Map,{tasks:y,scope:b}=n;for(const[w,E]of y.entries()){const I=this.getImage(E.id,b);I&&m.set(w,{image:I,imageVariant:E})}this._rasterizeImages(b,m,u)}_rasterizeImages(n,u,m){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:u,scope:n},m);else{const y=new Map;for(const[b,{image:w,imageVariant:E}]of u.entries())y.set(b,this.imageRasterizer.rasterize(E,w,n,0));m(void 0,y)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,u,m){const y=this.images.get(u),b=new Map;for(const w of n){if(!y.get(w.toString())){if(w.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:w.name}))}const E=y.get(w.toString());if(!E){s.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const I={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)};E.usvg&&Object.assign(I,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),b.set(s.I.toString(w),I)}m(null,b)}getPixelSize(n){const{width:u,height:m}=this.atlasImage.get(n);return{width:u,height:m}}getPattern(n,u,m){const y=n.toString(),b=this.patterns.get(u),w=b.get(y),E=this.getImage(n,u);if(!E)return null;if(w){if(w.position.version===E.version)return w.position;w.position.version=E.version}else{if(E.usvg&&!E.data){const I=this.getPatternInFlightId(y,u);if(this.patternsInFlight.has(I))return null;this.patternsInFlight.add(I);const L=new s.A(n).scaleSelf(s.o.devicePixelRatio),R=new Map([[L.toString(),{image:E,imageVariant:L}]]);return this._rasterizeImages(u,R,(N,B)=>this.storePatternImage(L,u,E,m,B)),null}this.storePattern(n,u,E)}return this._updatePatternAtlas(u,m),b.get(y).position}getPatternInFlightId(n,u){return s.B(n,u)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,u,m,y,b){const w=n.toString(),E=b?b.get(w):void 0;E&&(m.data=E,this.storePattern(n.id,u,m),this._updatePatternAtlas(u,y),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),u)))}storePattern(n,u,m){const y={w:m.data.width+2*s.C,h:m.data.height+2*s.C,x:0,y:0},b=new s.F(y,m,s.C);this.patterns.get(u).set(n.toString(),{bin:y,position:b})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,u){const m=n.gl;let y=this.atlasTexture.get(u);y?this.dirty&&(y.update(this.atlasImage.get(u)),this.dirty=!1):(y=new s.T(n,this.atlasImage.get(u),m.RGBA8),this.atlasTexture.set(u,y)),y.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(n,u){const m=this.patterns.get(n),y=Array.from(m.values()).map(({bin:L})=>L),{w:b,h:w}=s.G(y),E=this.atlasImage.get(n);E.resize({width:b||1,height:w||1});const I=this.images.get(n);for(const[L,{bin:R,position:N}]of m.entries()){let B=N.padding;const U=R.x+B,W=R.y+B,G=I.get(L).data,J=G.width,K=G.height;B=B>1?B-1:B,s.q.copy(G,E,{x:0,y:0},{x:U,y:W},{width:J,height:K},u),s.q.copy(G,E,{x:0,y:K-B},{x:U,y:W-B},{width:J,height:B},u),s.q.copy(G,E,{x:0,y:0},{x:U,y:W+K},{width:J,height:B},u),s.q.copy(G,E,{x:J-B,y:0},{x:U-B,y:W},{width:B,height:K},u),s.q.copy(G,E,{x:0,y:0},{x:U+J,y:W},{width:B,height:K},u),s.q.copy(G,E,{x:J-B,y:K-B},{x:U-B,y:W-B},{width:B,height:B},u),s.q.copy(G,E,{x:0,y:K-B},{x:U+J,y:W-B},{width:B,height:B},u),s.q.copy(G,E,{x:0,y:0},{x:U+J,y:W+K},{width:B,height:B},u),s.q.copy(G,E,{x:J-B,y:0},{x:U-B,y:W+K},{width:B,height:B},u)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,u){const m=this.images.get(u);for(const y of n){if(this.callbackDispatchedThisFrame.get(u).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(u).add(y.toString());const b=m.get(y.toString());Wt(b)&&this.updateImage(y,u,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function rt(p){const n=p.value,u=p.valueSpec,m=p.style,y=p.styleSpec,b=p.key,w=p.arrayElementValidator||$n;if(!Array.isArray(n))return[new s.V(b,n,`array expected, ${s.K(n)} found`)];if(u.length&&n.length!==u.length)return[new s.V(b,n,`array length ${u.length} expected, length ${n.length} found`)];if(u["min-length"]&&n.length<u["min-length"])return[new s.V(b,n,`array length at least ${u["min-length"]} expected, length ${n.length} found`)];let E={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};y.$version<7&&(E.function=u.function),s.H(u.value)&&(E=u.value);let I=[];for(let L=0;L<n.length;L++)I=I.concat(w({array:n,arrayIndex:L,value:n[L],valueSpec:E,style:m,styleSpec:y,key:`${b}[${L}]`},!0));return I}function oi(p){const n=p.key,u=p.value,m=p.valueSpec;if(!s.L(u))return[new s.V(n,u,`number expected, ${s.K(u)} found`)];if(u!=u)return[new s.V(n,u,"number expected, NaN found")];if("minimum"in m){let y=m.minimum;if(Array.isArray(m.minimum)&&(y=m.minimum[p.arrayIndex]),u<y)return[new s.V(n,u,`${u} is less than the minimum value ${y}`)]}if("maximum"in m){let y=m.maximum;if(Array.isArray(m.maximum)&&(y=m.maximum[p.arrayIndex]),u>y)return[new s.V(n,u,`${u} is greater than the maximum value ${y}`)]}return[]}function Si(p){const n=p.key,u=p.value;if(!s.H(u))return[new s.V(n,u,`object expected, ${s.K(u)} found`)];const m=p.valueSpec,y=s.J(u.type);let b,w,E,I={};const L=y!=="categorical"&&u.property===void 0,R=!L,N=(function(G){const J=G.stops;return Array.isArray(J)&&Array.isArray(J[0])&&s.H(J[0][0])})(u),B=yr({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(G){if(y==="identity")return[new s.V(G.key,G.value,'identity function may not have a "stops" property')];let J=[];const K=G.value;return J=J.concat(rt({key:G.key,value:K,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:U})),Array.isArray(K)&&K.length===0&&J.push(new s.V(G.key,K,"array must have at least one stop")),J},default:function(G){return $n({key:G.key,value:G.value,valueSpec:m,style:G.style,styleSpec:G.styleSpec})}}});return y==="identity"&&L&&B.push(new s.V(p.key,p.value,'missing required property "property"')),y==="identity"||u.stops||B.push(new s.V(p.key,p.value,'missing required property "stops"')),y==="exponential"&&m.expression&&!s.M(m)&&B.push(new s.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(R&&!s.N(m)?B.push(new s.V(p.key,p.value,"property functions not supported")):L&&!s.O(m)&&B.push(new s.V(p.key,p.value,"zoom functions not supported"))),y!=="categorical"&&!N||u.property!==void 0||B.push(new s.V(p.key,p.value,'"property" property is required')),B;function U(G){let J=[];const K=G.value,oe=G.key;if(!Array.isArray(K))return[new s.V(oe,K,`array expected, ${s.K(K)} found`)];if(K.length!==2)return[new s.V(oe,K,`array length 2 expected, length ${K.length} found`)];if(N){if(!s.H(K[0]))return[new s.V(oe,K,`object expected, ${s.K(K[0])} found`)];const re=K[0];if(re.zoom===void 0)return[new s.V(oe,K,"object stop key must have zoom")];if(re.value===void 0)return[new s.V(oe,K,"object stop key must have value")];const ne=s.J(re.zoom);if(typeof ne!="number")return[new s.V(oe,re.zoom,"stop zoom values must be numbers")];if(E&&E>ne)return[new s.V(oe,re.zoom,"stop zoom values must appear in ascending order")];ne!==E&&(E=ne,w=void 0,I={}),J=J.concat(yr({key:`${oe}[0]`,value:K[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:oi,value:W}}))}else J=J.concat(W({key:`${oe}[0]`,value:K[0],style:G.style,styleSpec:G.styleSpec},K));return s.Q(s.S(K[1]))?J.concat([new s.V(`${oe}[1]`,K[1],"expressions are not allowed in function stops.")]):J.concat($n({key:`${oe}[1]`,value:K[1],valueSpec:m,style:G.style,styleSpec:G.styleSpec}))}function W(G,J){const K=s.K(G.value),oe=s.J(G.value),re=G.value!==null?G.value:J;if(b){if(K!==b)return[new s.V(G.key,re,`${K} stop domain type must match previous stop domain type ${b}`)]}else b=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof oe!="number"&&typeof oe!="string"&&typeof oe!="boolean")return[new s.V(G.key,re,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&y!=="categorical"){let ne=`number expected, ${K} found`;return s.N(m)&&y===void 0&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(G.key,re,ne)]}return y!=="categorical"||K!=="number"||typeof oe=="number"&&isFinite(oe)&&Math.floor(oe)===oe?y!=="categorical"&&K==="number"&&typeof oe=="number"&&typeof w=="number"&&w!==void 0&&oe<w?[new s.V(G.key,re,"stop domain values must appear in ascending order")]:(w=oe,y==="categorical"&&oe in I?[new s.V(G.key,re,"stop domain values must be unique")]:(I[oe]=!0,[])):[new s.V(G.key,re,`integer expected, found ${String(oe)}`)]}}function _i(p){const n=(p.expressionContext==="property"?s.W:s.U)(s.S(p.value),p.valueSpec);if(n.result==="error")return n.value.map(m=>new s.V(`${p.key}${m.key}`,p.value,m.message));const u=n.value.expression||n.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!u.outputDefined())return[new s.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!s.Z(u))return[new s.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Kt(u,p);if(p.expressionContext==="appearance")return Wi(u,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!s.X(u,["zoom","feature-state"]))return[new s.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!s.Y(u))return[new s.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kt(p,n){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const y of n.valueSpec.expression.parameters)u.delete(y);if(u.size===0)return[];const m=[];return p instanceof s._&&u.has(p.name)?[new s.V(n.key,n.value,`["${p.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(p.eachChild(y=>{m.push(...Kt(y,n))}),m)}function Wi(p,n){const u=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const y of n.valueSpec.expression.parameters)u.add(y);if(u.size===0)return[];const m=[];return p instanceof s._&&!u.has(p.name)?[new s.V(n.key,n.value,`["${p.name}"] is not an allowed parameter`)]:(p.eachChild(y=>{m.push(...Wi(y,n))}),m)}function Xi(p){const n=p.key,u=p.value,m=p.valueSpec,y=[];return Array.isArray(m.values)?m.values.indexOf(s.J(u))===-1&&y.push(new s.V(n,u,`expected one of [${m.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(m.values).indexOf(s.J(u))===-1&&y.push(new s.V(n,u,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function Vi(p){return s.a2(s.S(p.value))?_i(Object.assign({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):Ji(p)}function Ji(p){const n=p.value,u=p.key;if(!Array.isArray(n))return[new s.V(u,n,`array expected, ${s.K(n)} found`)];if(n.length<1)return[new s.V(u,n,"filter array must have at least 1 element")];const m=p.styleSpec;let y=Xi({key:`${u}[0]`,value:n[0],valueSpec:m.filter_operator});const b=()=>{n.length>=2&&(s.a0(n[1])||y.push(new s.V(`${u}[1]`,n[1],`string expected, ${s.K(n[1])} found`)));for(let w=2;w<n.length;w++)s.J(n[1])==="$type"?y=y.concat(Xi({key:`${u}[${w}]`,value:n[w],valueSpec:m.geometry_type})):s.a0(n[w])||s.L(n[w])||s.$(n[w])||y.push(new s.V(`${u}[${w}]`,n[w],`string, number, or boolean expected, ${s.K(n[w])} found.`))};switch(s.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.J(n[1])==="$type"&&y.push(new s.V(u,n,`"$type" cannot be use with operator "${n[0]}"`)),n.length!==3&&y.push(new s.V(u,n,`filter array for operator "${n[0]}" must have 3 elements`)),b();break;case"==":case"!=":n.length!==3&&y.push(new s.V(u,n,`filter array for operator "${n[0]}" must have 3 elements`)),b();break;case"in":case"!in":b();break;case"any":case"all":case"none":for(let w=1;w<n.length;w++)y=y.concat(Ji({key:`${u}[${w}]`,value:n[w],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":n.length!==2?y.push(new s.V(u,n,`filter array for "${n[0]}" operator must have 2 elements`)):s.a0(n[1])||y.push(new s.V(`${u}[1]`,n[1],`string expected, ${s.K(n[1])} found`))}return y}function ki(p,n){const u=p.key,m=p.style,y=p.layer,b=p.styleSpec,w=p.value,E=p.objectKey,I=b[`${n}_${p.layerType}`];if(!I)return[];const L=E.match(/^(.*)-use-theme$/);if(L&&I[L[1]])return s.Q(s.S(w))?[].concat($n({key:u,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:m,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:E})):$n({key:u,value:w,valueSpec:{type:"string"},style:m,styleSpec:b});const R=E.match(/^(.*)-transition$/);if(n==="paint"&&R&&I[R[1]]&&I[R[1]].transition)return $n({key:u,value:w,valueSpec:b.transition,style:m,styleSpec:b});const N=p.valueSpec||I[E];if(!N)return[new s.a3(u,w,`unknown property "${E}"`)];let B;if(s.a0(w)&&s.N(N)&&!N.tokens&&(B=/^{([^}]+)}$/.exec(w))){const W=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new s.V(u,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${W}.`)]}const U=[];if(p.layerType==="symbol")E!=="text-field"||!m||m.glyphs||m.imports||U.push(new s.V(u,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&s.a4(s.S(w))&&s.J(w.type)==="identity"&&U.push(new s.V(u,w,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&n==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&s.N(N)&&(s.a5(N)||s.O(N))){const W=s.W(s.S(w),N).value,G="expression"in W&&W.expression||"_styleExpression"in W&&W._styleExpression&&W._styleExpression.expression;G&&!s.X(G,["measure-light"])&&(E==="model-emissive-strength"&&s.Y(G)&&s.Z(G)||U.push(new s.V(u,w,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat($n({key:p.key,value:w,valueSpec:N,style:m,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:E}))}function mr(p){return ki(p,"paint")}function Er(p){return ki(p,"layout")}function Il(p){let n=[];const u=p.value,m=p.key,y=p.style,b=p.styleSpec;if(!s.H(u))return[new s.V(m,u,"object expected")];u.type||u.ref||n.push(new s.V(m,u,'either "type" or "ref" is required'));let w=s.J(u.type);const E=s.J(u.ref);if(u.id){const I=s.J(u.id);for(let L=0;L<p.arrayIndex;L++){const R=y.layers[L];s.J(R.id)===I&&n.push(new s.V(m,u.id,`duplicate layer id "${I}", previously used at line ${R.id.__line__}`))}}if("ref"in u){let I;["type","source","source-layer","filter","layout"].forEach(L=>{L in u&&n.push(new s.V(m,u[L],`"${L}" is prohibited for ref layers`))}),y.layers.forEach(L=>{s.J(L.id)===E&&(I=L)}),I?I.ref?n.push(new s.V(m,u.ref,"ref cannot reference another ref layer")):w=s.J(I.type):typeof E=="string"&&n.push(new s.V(m,u.ref,`ref layer "${E}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(u.source)if(s.a0(u.source)){const I=y.sources&&y.sources[u.source],L=I&&s.J(I.type);I?L==="vector"&&w==="raster"?n.push(new s.V(m,u.source,`layer "${u.id}" requires a raster source`)):L==="raster"&&w!=="raster"?n.push(new s.V(m,u.source,`layer "${u.id}" requires a vector source`)):L!=="vector"||u["source-layer"]?L==="raster-dem"&&w!=="hillshade"?n.push(new s.V(m,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&u.paint&&(u.paint["line-gradient"]||u.paint["line-trim-offset"])&&L==="geojson"&&!I.lineMetrics?n.push(new s.V(m,u,`layer "${u.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&L!=="raster-array"&&n.push(new s.V(m,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):n.push(new s.V(m,u.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new s.V(m,u,`layer "${u.id}" must specify a "source-layer"`)):n.push(new s.V(m,u.source,`source "${u.source}" not found`))}else n.push(new s.V(`${m}.source`,u.source,'"source" must be a string'));else n.push(new s.V(m,u,'missing required property "source"'));return n=n.concat(yr({key:m,value:u,valueSpec:b.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$n({key:`${m}.type`,value:u.type,valueSpec:b.layer.type,style:p.style,styleSpec:p.styleSpec,object:u,objectKey:"type"}),filter:I=>Vi(Object.assign({layerType:w},I)),layout:I=>yr({layer:u,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":L=>Er(Object.assign({layerType:w},L))}}),paint:I=>yr({layer:u,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":L=>mr(Object.assign({layerType:w,layer:u},L))}}),appearances(I){const L=rt({key:I.key,value:I.value,valueSpec:I.valueSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:B=>(function(U){const{key:W,layer:G,layerType:J}=U,K=s.J(U.value),oe=s.J(K.name),re=s.J(K.condition),ne=yr({key:W,value:K,valueSpec:U.styleSpec.appearance,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{condition:be=>(function(_e){const ve=[];return ve.push(..._i({key:_e.key,value:_e.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),ve})(Object.assign({layer:G,layerType:J},be)),properties:be=>(function(_e){const ve=[],{styleSpec:pe,layer:he,layerType:Se}=_e,ze=pe[`paint_${Se}`],Re=pe[`layout_${Se}`],Ze=_e.object[_e.objectKey];for(const je in Ze){const it=je in ze?"paint":je in Re?"layout":void 0;if(!it){ve.push(new s.V(_e.key,je,`unknown property "${je}" for layer type "${Se}"`));continue}const dt=Object.assign({},_e,{key:`${_e.key}.${je}`,object:Ze,objectKey:je,layer:he,layerType:Se,value:Ze[je],valueSpec:it==="paint"?ze[je]:Re[je]});ve.push(...ki(dt,it))}return ve})(Object.assign({layer:G,layerType:J},be))}});return oe!=="hidden"&&re===void 0&&ne.push(new s.V(U.key,"name",'Appearance with name different than "hidden" must have a condition')),ne})(Object.assign({layerType:w,layer:u},B))}),R=Array.isArray(I.value)?I.value:[],N=new Set;return R.forEach((B,U)=>{const W=s.J(B.name);if(W)if(N.has(W)){const G=s.J(u.id);L.push(new s.V(I.key,W,`Duplicated appearance name "${W}" for layer "${G}"`))}else N.add(W)}),L}}})),n}function Ys({key:p,value:n}){return s.a0(n)?[]:[new s.V(p,n,`string expected, ${s.K(n)} found`)]}const mo={promoteId:function p({key:n,value:u}){if(s.a0(u))return Ys({key:n,value:u});if(Array.isArray(u)){const y=[],b=s.S(u),w=s.U(b);return w.result==="error"&&w.value.forEach(E=>{y.push(new s.V(`${n}${E.key}`,null,`${E.message}`))}),s.X(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new s.V(`${n}`,null,"promoteId expression should be only feature dependent")),y}if(!s.H(u))return[new s.V(n,u,`string, expression or object expected, "${s.K(u)}" found`)];const m=[];for(const y in u)m.push(...p({key:`${n}.${y}`,value:u[y]}));return m}};function Ks(p){const n=p.value,u=p.key,m=p.styleSpec,y=p.style;if(!s.H(n))return[new s.V(u,n,`object expected, ${s.K(n)} found`)];if(!("type"in n))return[new s.V(u,n,'"type" is required')];const b=s.J(n.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in n||"tiles"in n||w.push(new s.a3(u,n,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(yr({key:u,value:n,valueSpec:m[`source_${b.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:mo})),w;case"geojson":if(w=yr({key:u,value:n,valueSpec:m.source_geojson,style:y,styleSpec:m,objectElementValidators:mo}),"cluster"in n&&"clusterProperties"in n){if(!s.H(n.clusterProperties))return[new s.V(`${u}.clusterProperties`,n,`object expected, ${s.K(n)} found`)];for(const E in n.clusterProperties){const I=n.clusterProperties[E];if(!Array.isArray(I))return[new s.V(`${u}.clusterProperties.${E}`,I,"array expected")];const[L,R]=I,N=typeof L=="string"?[L,["accumulated"],["get",E]]:L;w.push(..._i({key:`${u}.${E}.map`,value:R,expressionContext:"cluster-map"})),w.push(..._i({key:`${u}.${E}.reduce`,value:N,expressionContext:"cluster-reduce"}))}}return w;case"video":return yr({key:u,value:n,valueSpec:m.source_video,style:y,styleSpec:m});case"image":return yr({key:u,value:n,valueSpec:m.source_image,style:y,styleSpec:m});case"canvas":return[new s.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xi({key:`${u}.type`,value:n.type,valueSpec:{values:ua(m)}})}}function ua(p){return p.source.reduce((n,u)=>{const m=p[u];return m.type.type==="enum"&&(n=n.concat(Object.keys(m.type.values||{}))),n},[])}function Qs(p){const n=p.value,u=p.styleSpec,m=u.light,y=p.style;if(n===void 0)return[];if(!s.H(n))return[new s.V("light",n,`object expected, ${s.K(n)} found`)];let b=[];for(const w in n){const E=w.match(/^(.*)-transition$/),I=w.match(/^(.*)-use-theme$/);b=b.concat(I&&m[I[1]]?$n({key:w,value:n[w],valueSpec:{type:"string"},style:y,styleSpec:u}):E&&m[E[1]]&&m[E[1]].transition?$n({key:w,value:n[w],valueSpec:u.transition,style:y,styleSpec:u}):m[w]?$n({key:w,value:n[w],valueSpec:m[w],style:y,styleSpec:u}):[new s.V(w,n[w],`unknown property "${w}"`)])}return b}function ha(p){const n=p.value;if(!n)return[];const u=p.key;if(!s.H(n))return[new s.V(u,n,`object expected, ${s.K(n)} found`)];let m=[];const y=p.styleSpec,b=y["light-3d"],w=p.style,E=p.style.lights;for(const R of["type","id"])if(!(R in n))return m=m.concat([new s.V(u,n,`missing property "${R}"`)]),m;if(!s.a0(n.type))return m=m.concat([new s.V(`${u}.type`,n.type,"string expected")]),m;if(E)for(let R=0;R<p.arrayIndex;R++){const N=s.J(n.type),B=E[R];s.J(B.type)===N&&m.push(new s.V(u,n.id,`duplicate light type "${n.type}", previously defined at line ${B.id.__line__}`))}const I=`properties_light_${n.type}`;if(!(I in y))return m=m.concat([new s.V(`${u}.type`,n,`Invalid light type ${n.type}`)]),m;const L=y[I];for(const R in n)if(R==="properties"){const N=n[R];if(!s.H(N))return m=m.concat([new s.V("properties",N,`object expected, ${s.K(N)} found`)]),m;for(const B in N){const U=B.match(/^(.*)-transition$/),W=B.match(/^(.*)-use-theme$/);m=m.concat(W&&L[W[1]]?$n({key:R,value:N[B],valueSpec:{type:"string"},style:w,styleSpec:y}):U&&L[U[1]]&&L[U[1]].transition?$n({key:R,value:n[R],valueSpec:y.transition,style:w,styleSpec:y}):L[B]?$n({key:B,value:N[B],valueSpec:L[B],style:w,styleSpec:y}):[new s.a3(p.key,N[B],`unknown property "${B}"`)])}}else m=m.concat(b[R]?$n({key:R,value:n[R],valueSpec:b[R],style:w,styleSpec:y}):[new s.a3(R,n[R],`unknown property "${R}"`)]);return m}function _s(p){const n=p.value,u=p.key,m=p.style,y=p.styleSpec,b=y.terrain;if(n==null)return[];if(!s.H(n))return[new s.V("terrain",n,`object expected, ${s.K(n)} found`)];let w=[];for(const E in n){const I=E.match(/^(.*)-transition$/),L=E.match(/^(.*)-use-theme$/);w=w.concat(L&&b[L[1]]?$n({key:E,value:n[E],valueSpec:{type:"string"},style:m,styleSpec:y}):I&&b[I[1]]&&b[I[1]].transition?$n({key:E,value:n[E],valueSpec:y.transition,style:m,styleSpec:y}):b[E]?$n({key:E,value:n[E],valueSpec:b[E],style:m,styleSpec:y}):[new s.a3(E,n[E],`unknown property "${E}"`)])}if(n.source)if(s.a0(n.source)){const E=m.sources&&m.sources[n.source],I=E&&s.J(E.type);E?I!=="raster-dem"&&w.push(new s.V(`${u}.source`,n.source,`terrain cannot be used with a source of type ${I}, it only be used with a "raster-dem" source type`)):w.push(new s.V(`${u}.source`,n.source,`source "${n.source}" not found`))}else w.push(new s.V(`${u}.source`,n.source,"source must be a string"));else w.push(new s.V(u,n,'terrain is missing required property "source"'));return w}function da(p){const n=p.value,u=p.style,m=p.styleSpec,y=m.fog;if(n===void 0)return[];if(!s.H(n))return[new s.V("fog",n,`object expected, ${s.K(n)} found`)];let b=[];for(const w in n){const E=w.match(/^(.*)-transition$/),I=w.match(/^(.*)-use-theme$/);b=b.concat(I&&y[I[1]]?$n({key:w,value:n[w],valueSpec:{type:"string"},style:u,styleSpec:m}):E&&y[E[1]]&&y[E[1]].transition?$n({key:w,value:n[w],valueSpec:m.transition,style:u,styleSpec:m}):y[w]?$n({key:w,value:n[w],valueSpec:y[w],style:u,styleSpec:m}):[new s.a3(w,n[w],`unknown property "${w}"`)])}return b}const il={"*":()=>[],array:rt,boolean:function(p){const n=p.value,u=p.key;return s.$(n)?[]:[new s.V(u,n,`boolean expected, ${s.K(n)} found`)]},number:oi,color:function({key:p,value:n}){return s.a0(n)?s.a1.parseCSSColor(n)===null?[new s.V(p,n,`color expected, "${n}" found`)]:[]:[new s.V(p,n,`color expected, ${s.K(n)} found`)]},enum:Xi,filter:Vi,function:Si,layer:Il,object:yr,source:Ks,model:s.a7,light:Qs,"light-3d":ha,terrain:_s,fog:da,string:Ys,formatted:function(p){return Ys(p).length===0?[]:_i(p)},resolvedImage:function(p){return Ys(p).length===0?[]:_i(p)},projection:function(p){const n=p.value,u=p.styleSpec,m=u.projection,y=p.style;if(s.H(n)){let b=[];for(const w in n)b=b.concat($n({key:w,value:n[w],valueSpec:m[w],style:y,styleSpec:u}));return b}return s.a0(n)?[]:[new s.V("projection",n,`object or string expected, ${s.K(n)} found`)]},import:function(p){const n=p.key,{value:u,styleSpec:m}=p;if(!s.H(u))return[new s.V(n,u,"import must be an object")];const{data:y,...b}=u;Object.defineProperty(b,"__line__",{value:u.__line__,enumerable:!1});let w=yr(Object.assign({},p,{value:b,valueSpec:m.import}));return s.J(b.id)===""&&w.push(new s.V(`${p.key}.id`,b,"import id can't be an empty string")),y&&(w=w.concat(Ml(y,m,{key:`${p.key}.data`}))),w},iconset:function(p){const n=p.value,u=p.key,m=p.styleSpec,y=p.style;if(!s.H(n))return[new s.V(u,n,"object expected")];if(!n.type)return[new s.V(u,n,'"type" is required')];const b=s.J(n.type);let w=[];if(w=w.concat(yr({key:u,value:n,valueSpec:m[`iconset_${b}`],style:y,styleSpec:m})),(function(E,I){return!(E!=="source"||!I.source)})(b,n)){const E=y.sources&&y.sources[n.source],I=E&&s.J(E.type);E?I!=="raster-array"&&w.push(new s.V(u,n.source,`iconset cannot be used with a source of type ${String(I)}, it only be used with a "raster-array" source type`)):w.push(new s.V(u,n.source,`source "${n.source}" not found`))}return w}};function $n(p,n=!1){const u=p.value,m=p.valueSpec,y=p.styleSpec;if(m.expression){if(s.a4(s.J(u)))return Si(p);if(s.Q(s.S(u)))return _i(p)}if(m.type&&il[m.type]){const b=il[m.type](p);return n===!0&&b.length>0&&Array.isArray(p.value)?_i(p):b}return yr(Object.assign({},p,{valueSpec:m.type?y[m.type]:m}))}function yr(p){const n=p.key,u=p.value,m=p.valueSpec||{},y=p.objectElementValidators||{},b=p.style,w=p.styleSpec;if(!s.H(u))return[new s.V(n,u,`object expected, ${s.K(u)} found`)];let E=[];for(const I in u){const L=I.split(".")[0];let R;y[L]?R=y[L]:m[L]?R=$n:y["*"]?R=y["*"]:m["*"]&&(R=$n),R?E=E.concat(R({key:(n&&`${n}.`)+I,value:u[I],valueSpec:m[L]||m["*"],style:b,styleSpec:w,object:u,objectKey:I},u)):E.push(new s.a3(n,u[I],`unknown property "${I}"`))}for(const I in m){if(y[I])continue;const L=m[I];L.required&&L.default===void 0&&u[I]===void 0&&E.push(new s.V(n,u,`missing required property "${I}"`))}return E}function lc({key:p,value:n}){const u=Ys({key:p,value:n});if(u.length)return u;const m=n;return m.indexOf("{fontstack}")===-1&&u.push(new s.V(p,n,'"glyphs" url must include a "{fontstack}" token')),m.indexOf("{range}")===-1&&u.push(new s.V(p,n,'"glyphs" url must include a "{range}" token')),u}function Ml(p,n=s.a6,u={}){return yr({key:u.key||"",value:p,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:p,objectElementValidators:{glyphs:lc}})}function Qo(p,n=s.a6){return de(Ml(p,n))}const De=p=>de(Ks(p)),Lt=p=>de(Qs(p)),Ae=p=>de(ha(p)),Ot=p=>de(_s(p)),yi=p=>de(da(p)),Cn=p=>de((function(n){const u=n.value,m=n.style,y=n.styleSpec,b=y.snow;if(u===void 0)return[];if(!s.H(u))return[new s.V("snow",u,`object expected, ${s.K(u)} found`)];let w=[];for(const E in u){const I=E.match(/^(.*)-transition$/);w=w.concat(I&&b[I[1]]&&b[I[1]].transition?$n({key:E,value:u[E],valueSpec:y.transition,style:m,styleSpec:y}):b[E]?$n({key:E,value:u[E],valueSpec:b[E],style:m,styleSpec:y}):[new s.a3(E,u[E],`unknown property "${E}"`)])}return w})(p)),ii=p=>de((function(n){const u=n.value,m=n.style,y=n.styleSpec,b=y.rain;if(u===void 0)return[];if(!s.H(u))return[new s.V("rain",u,`object expected, ${s.K(u)} found`)];let w=[];for(const E in u){const I=E.match(/^(.*)-transition$/);w=w.concat(I&&b[I[1]]&&b[I[1]].transition?$n({key:E,value:u[E],valueSpec:y.transition,style:m,styleSpec:y}):b[E]?$n({key:E,value:u[E],valueSpec:b[E],style:m,styleSpec:y}):[new s.a3(E,u[E],`unknown property "${E}"`)])}return w})(p)),Ee=p=>de(Il(p)),Z=p=>de(Vi(p)),Q=p=>de(mr(p)),ce=p=>de(Er(p)),xe=p=>de(s.a7(p));function de(p){return p.slice().sort((n,u)=>n.line&&u.line?n.line-u.line:0)}function Me(p,n){let u=!1;if(n&&n.length)for(const m of n)m instanceof s.a3?s.w(m.message):(p.fire(new s.y(new Error(m.message))),u=!0);return u}const Oe=s.a6.light;let Pe;class Be extends s.E{constructor(n,u="flat"){super(),this._transitionable=new s.a8(Pe||(Pe=new s.a9({anchor:new s.aa(Oe.anchor),position:new s.ab(Oe.position),color:new s.aa(Oe.color),intensity:new s.aa(Oe.intensity)}))),this.setLight(n,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,u,m={}){this._validate(Lt,n,m)||(this._transitionable.setTransitionOrValue(n),this.id=u)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,m){return(!m||m.validate!==!1)&&Me(this,n.call(Qo,Object.assign({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const gt=s.a6.terrain;let st=class extends s.E{constructor(p,n,u,m,y){super(),this.scope=u,this._transitionable=new s.a8(new s.a9({source:new s.aa(gt.source),exaggeration:new s.aa(gt.exaggeration)}),u,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=y}get(){return this._transitionable.serialize()}set(p,n){this._transitionable.setTransitionOrValue(p,n)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new s.ac(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const p=this._transitionable._values.exaggeration;if(!p)return null;const n=p.value.expression;if(!n)return null;let u=-1,m=-1,y=1;for(const b of n.zoomStops)y=n.evaluate(new s.ac(b,{worldview:this.worldview})),y>.01?(u=b,m=-1):m=b;return y<.01&&u>0&&m>u?[u,m]:null}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof s.ad}};const Ft=.05;function ri(p,n,u,m){const y=s.ah(45,65,u),[b,w]=ci(p,m);let E=1-Math.min(1,Math.exp((n-b)/(w-b)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*y*p.alpha}function ci(p,n){const u=.5/Math.tan(.5*n);return[p.range[0]+u,p.range[1]+u]}function Oi(p,n,u,m,y){const b=s.af([],[n,u,m],y.mercatorFogMatrix);return ri(p,s.ag(b),y.pitch,y._fov)}function Gi(p,n,u,m,y,b,w){const E=[[u,m,0],[y,m,0],[y,b,0],[u,b,0]];let I=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const R of E){const N=s.af([],R,n),B=s.ag(N);I=Math.min(I,B),L=Math.max(L,B)}return[ri(p,I,w.pitch,w._fov),ri(p,L,w.pitch,w._fov)]}const Ti=s.a6.fog;class vi extends s.E{constructor(n,u,m,y){super();const b=new s.a9({range:new s.aa(Ti.range),color:new s.aa(Ti.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(Ti["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(Ti["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(Ti["horizon-blend"]),"star-intensity":new s.aa(Ti["star-intensity"]),"vertical-range":new s.aa(Ti["vertical-range"])});this._transitionable=new s.a8(b,m,new Map(y)),this.set(n,y),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new s.ai(b),this.scope=m}get state(){const n=this._transform,u=n.projection.name==="globe",m=s.aj(n.zoom),y=this.properties.get("range"),b=[.5,3];return{range:u?[s.ak(b[0],y[0],m),s.ak(b[1],y[1],m)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,u,m={}){if(this._validate(yi,n,m))return;const y=Object.assign({},n);for(const b of Object.keys(Ti))y[b]===void 0&&(y[b]=Ti[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(45,65,n))*u.a}getOpacityAtLatLng(n,u){return this._transform.projection.supportsFog?(function(m,y,b){const w=s.ae.fromLngLat(y),E=b.elevation?b.elevation.getAtPointOrZero(w):0;return Oi(m,w.x,w.y,E,b)})(this.state,n,u):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Gi(this.state,u,0,0,s.al,s.al,this._transform)}getOpacityForBounds(n,u,m,y,b){return this._transform.projection.supportsFog?Gi(this.state,n,u,m,y,b,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?ci(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const m of u){const y=n.points[m];let b;if(y[2]>=0)b=y;else{const w=n.points[m-4];b=s.am(w,y,w[2]/(w[2]-y[2]))}if(Oi(this.state,b[0],b[1],0,this._transform)>=Ft)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,m){return(!m||m.validate!==!1)&&Me(this,n.call(Qo,Object.assign({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let Vn,Nr,vr,xr=class extends s.E{constructor(p,n,u,m){super();const y=Vn||(Vn=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(y,u,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(y),this.scope=u}get state(){const p=this.properties.get("opacity"),n=this.properties.get("color"),u=this.properties.get("direction"),m=s.an(u[0]),y=-Math.max(s.an(u[1]),.01),b=[Math.cos(m)*Math.cos(y),Math.sin(m)*Math.cos(y),Math.sin(y)],w=this.properties.get("vignette"),E=this.properties.get("vignette-color");return E.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*p),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(p,n,u={}){if(this._validate(Cn,p,u))return;const m=Object.assign({},p),y=s.a6.snow;for(const b of Object.keys(y))m[b]===void 0&&(m[b]=y[b].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,n,u){return(!u||u.validate!==!1)&&Me(this,p.call(Qo,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},Qn=class extends s.E{constructor(p,n,u,m){super();const y=Nr||(Nr=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(y,u,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(y),this.scope=u}get state(){const p=this.properties.get("opacity"),n=this.properties.get("color"),u=this.properties.get("direction"),m=s.an(u[0]),y=-Math.max(s.an(u[1]),.01),b=[Math.cos(m)*Math.cos(y),Math.sin(m)*Math.cos(y),Math.sin(y)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*p),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(p,n,u={}){if(this._validate(ii,p,u))return;const m=Object.assign({},p),y=s.a6.rain;for(const b of Object.keys(y))m[b]===void 0&&(m[b]=y[b].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,n,u){return(!u||u.validate!==!1)&&Me(this,p.call(Qo,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class sn extends s.E{constructor(n,u,m,y){super(),this.scope=m,this._options=n,this.properties=new s.ai(u),this._transitionable=new s.a8(u,m,new Map(y)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,u){this._options=n,this._transitionable.setTransitionOrValue(n.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const nr=()=>vr||(vr=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)}));let kn;const On=()=>kn||(kn=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new s.aa(s.a6.properties_light_directional["shadow-draw-before-layer"])}));class gr{constructor(n,u,m){this.screenBounds=n,this.cameraPoint=m.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(n,u){let m,y;if(n instanceof s.P||typeof n[0]=="number"){const b=s.P.convert(n);m=[b],y=u.isPointAboveHorizon(b)}else{const b=s.P.convert(n[0]),w=s.P.convert(n[1]),E=b.add(w)._div(2);m=[b,w],y=s.aq(b,w).every(I=>u.isPointAboveHorizon(I))&&u.isPointAboveHorizon(E)}return new gr(m,y,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],y=s.aq(u,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(y[3]=this.cameraPoint)),s.ar(y,n)}bufferedCameraGeometryGlobe(n){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],y=s.aq(u,m,n),b=this.cameraPoint.clone();switch(3*((b.y>u.y)+(b.y>m.y))+((b.x>u.x)+(b.x>m.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(n,u,m,y=0){const b=Math.max(n.queryPadding,n.evaluateQueryRenderedFeaturePadding())/u._pixelsPerMercatorPixel+1,w=m?this._bufferedCameraMercator(b,u):this._bufferedScreenMercator(b,u);let E=n.tileID.wrap+(w.unwrapped?y:0);const I=w.polygon.map(J=>s.as(n.tileTransform,J,E));if(!s.at(I,0,0,s.al,s.al))return;E=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const L=this.screenGeometryMercator.polygon.map(J=>s.au(n.tileTransform,J,E)),R=L.map(J=>new s.P(J[0],J[1])),N=u.getFreeCameraOptions().position||new s.ae(0,0,0),B=s.au(n.tileTransform,N,E),U=L.map(J=>{const K=s.av(J,J,B);return s.aw(K,K),new s.ax(B,K)}),W=s.ay(n,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:U,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(G=s.az(I),G.min.x=s.aA(G.min.x,0,s.al),G.min.y=s.aA(G.min.y,0,s.al),G.max.x=s.aA(G.max.x,0,s.al),G.max.y=s.aA(G.max.y,0,s.al),G),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:W};var G}_bufferedScreenMercator(n,u){const m=jr(n);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),u):{polygon:this.bufferedScreenGeometry(n).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(n,u){const m=jr(n);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),u):{polygon:this.bufferedCameraGeometry(n).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[m]=y,y}}_projectAndResample(n,u){const m=(function(b,w){const E=s.aB([],w.pixelMatrix,w.globeMatrix),I=[0,-s.aD,0,1],L=[0,s.aD,0,1],R=[0,0,0,1];s.aC(I,I,E),s.aC(L,L,E),s.aC(R,R,E);const N=new s.P(I[0]/I[3],I[1]/I[3]),B=new s.P(L[0]/L[3],L[1]/L[3]),U=s.aE(b,N)&&I[3]<R[3],W=s.aE(b,B)&&L[3]<R[3];if(!U&&!W)return null;const G=(function(ve,pe,he){for(let Se=1;Se<ve.length;Se++){const ze=go(pe.pointCoordinate3D(ve[Se-1]).x),Re=go(pe.pointCoordinate3D(ve[Se]).x);if(he<0){if(ze<Re)return{idx:Se,t:-ze/(Re-1-ze)}}else if(Re<ze)return{idx:Se,t:(1-ze)/(Re+1-ze)}}return null})(b,w,U?-1:1);if(!G)return null;const{idx:J,t:K}=G;let oe=J>1?To(b.slice(0,J),w):[],re=J<b.length?To(b.slice(J),w):[];oe=oe.map(ve=>new s.P(go(ve.x),ve.y)),re=re.map(ve=>new s.P(go(ve.x),ve.y));const ne=[...oe];ne.length===0&&ne.push(re[re.length-1]);const be=s.ak(ne[ne.length-1].y,(re.length===0?oe[0]:re[0]).y,K);let _e;return _e=U?[new s.P(0,be),new s.P(0,0),new s.P(1,0),new s.P(1,be)]:[new s.P(1,be),new s.P(1,1),new s.P(0,1),new s.P(0,be)],ne.push(..._e),re.length===0?ne.push(oe[0]):ne.push(...re),{polygon:ne.map(ve=>new s.ae(ve.x,ve.y)),unwrapped:!1}})(n,u);if(m)return m;const y=(function(b,w){let E=!1,I=-1/0,L=0;for(let N=0;N<b.length-1;N++)b[N].x>I&&(I=b[N].x,L=N);for(let N=0;N<b.length-1;N++){const B=(L+N)%(b.length-1),U=b[B],W=b[B+1];Math.abs(U.x-W.x)>.5&&(U.x<W.x?(U.x+=1,B===0&&(b[b.length-1].x+=1)):(W.x+=1,B+1===b.length-1&&(b[0].x+=1)),E=!0)}const R=s.aF(w.center.lng);return E&&R<Math.abs(R-1)&&b.forEach(N=>{N.x-=1}),{polygon:b,unwrapped:E}})(To(n,u).map(b=>new s.P(go(b.x),b.y)),u);return{polygon:y.polygon.map(b=>new s.ae(b.x,b.y)),unwrapped:y.unwrapped}}}function To(p,n){return s.aG(p,u=>{const m=n.pointCoordinate3D(u);u.x=m.x,u.y=m.y},1/256)}function go(p){return p<0?1+p%1:p%1}function jr(p){return 100*p|0}function Al(p,n,u,m,y){const b=function(E,I){if(E)return y(E);if(I){if(p.url&&I.tiles&&p.tiles&&delete p.tiles,I.variants){if(!Array.isArray(I.variants))return y(new Error("variants must be an array"));for(const R of I.variants){if(R==null||typeof R!="object"||R.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(R.capabilities))return y(new Error("capabilities must be an array"));if(R.capabilities.length===1&&R.capabilities[0]==="meshopt"){I=Object.assign(I,R);break}}}const L=s.aH(Object.assign({},I,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=n.canonicalizeTileset(L,p.url),y(null,L)}},w=(function(E,I,L){if(!E)return null;if(!I&&!L)return E;L=L||E.worldview_default;const R=Object.values(E.language||{});if(R.length===0)return null;const N=Object.values(E.worldview||{});if(N.length===0)return null;const B=R.every(W=>W===I),U=N.every(W=>W===L);return B&&U?E:I in(E.language_options||{})||L in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null})(p.data,u,m);return w?s.o.frame(()=>b(null,w)):p.url?s.m(n.transformRequest(n.normalizeSourceURL(p.url,null,u,m),s.R.Source),b):s.o.frame(()=>{const{data:E,...I}=p;b(null,I)})}function zo(p,n){const u=Math.pow(2,n.z),m=Math.floor(s.aF(p.getWest())*u),y=Math.floor(s.aJ(p.getNorth())*u),b=Math.ceil(s.aF(p.getEast())*u),w=Math.ceil(s.aJ(p.getSouth())*u);return n.x>=m&&n.x<b&&n.y>=y&&n.y<w}class ys{constructor(n,u,m){this.bounds=n?s.aI.convert(this.validateBounds(n)):null,this.minzoom=u||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const u of n)this.extraBounds.push(s.aI.convert(this.validateBounds(u)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!zo(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const u of this.extraBounds)if(zo(u,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const u=new ys(n.bounds,n.minzoom,n.maxzoom);return u.addExtraBounds(n.extra_bounds),u}}class ea extends s.E{constructor(n,u,m,y){if(super(),this.id=n,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(u,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new s.aK}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=Al(this._options,this.map._requestManager,u,m,(y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new s.y(y));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of b.vector_layers)this.vectorLayerIds.push(w.id),b.worldview&&b.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=ys.fromTileJSON(b),wi(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(y)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,u){const m=n.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(m),b=this.map._requestManager.transformRequest(y,s.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,E=w?{image:w.image.clone()}:null,I={request:b,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:E,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&s.h(m)&&(I.localizableLayerIds=this.localizableLayerIds),I.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=u:n.request=n.actor.send("reloadTile",I,L.bind(this));else if(n.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",I,L.bind(this),void 0,!0);else{const R=s.aL.call({deduped:this._deduped},I,(N,B)=>{if(N||!B)L.call(this,N);else{const U=s.aM(B.responseHeaders);I.data={rawData:B.rawData.slice(0),expires:U.expires,cacheControl:U.cacheControl},n.actor&&n.actor.send("loadTile",I,L.bind(this),void 0,!0)}},!0);n.request={cancel:R}}function L(R,N){return delete n.request,n.aborted?u(null):R&&R instanceof s.aN&&R.status!==404?u(R):(N&&N.resourceTiming&&(n.resourceTiming=N.resourceTiming),this.map._refreshExpiredTiles&&N&&n.setExpiryData(N),n.loadVectorData(N,this.map.painter),s.aO(this.dispatcher),u(null,N),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,u){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class fa extends s.E{constructor(n,u,m,y){super(),this.id=n,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},u),Object.assign(this,s.aH(u,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const u=this.map.getWorldview();this._tileJSONRequest=Al(this._options,this.map._requestManager,null,u,(m,y)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new s.y(m)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=ys.fromTileJSON(y),wi(y.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(m)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,u){const m=s.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);n.request=s.n(this.map._requestManager.transformRequest(y,s.R.Tile),(b,w,E)=>{if(delete n.request,n.aborted)return n.state="unloaded",u(null);if(b)return n.state="errored",u(b);if(!w)return u(null);const I=s.aM(E);this.map._refreshExpiredTiles&&n.setExpiryData(I),n.setTexture(w,this.map.painter),n.state="loaded",s.aO(this.dispatcher),u(null)})}abortTile(n,u){n.request&&(n.request.cancel(),delete n.request),u&&u()}unloadTile(n,u){n.texture&&n.texture instanceof s.T?(n.destroy(!1),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function vs([p,n],u,m,{scaled:y=!0}={}){const{tileSize:b,buffer:w}=m,{x:E,y:I,z:L}=u;if(!isFinite(E)||!isFinite(I)||!isFinite(L))throw new Error("Invalid MRT header");const R=2**L,N=R*s.aF(p),B=R*s.aJ(n);return(function([U,W],G,{scaled:J=!0}={}){if(!G)throw new Error("bandView is undefined");const{data:K,tileSize:oe,buffer:re,offset:ne,scale:be,dimension:_e}=G;if(U<-re||U>oe+re||W<-re||W>oe+re)throw new Error(`Point (${U}, ${W}) out of bounds for tileSize=${oe}, buffer=${re}`);const ve=(W+re)*(oe+2*re)+(U+re);if(new Uint32Array(K.buffer)[ve]===4294967295)return null;let pe=[];pe=J?[]:new G.data.constructor(_e);for(let he=0;he<_e;he++)pe[he]=Math.round(1e12*(K[_e*ve+he]*be+ne))/1e12;return pe})([Math.min(Math.max(-w,Math.floor((N-E)*b)),b-1+w),Math.min(Math.max(-w,Math.floor((B-I)*b)),b-1+w)],m,{scaled:y})}class Fo extends fa{constructor(n,u,m,y){super(n,u,m,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},u)}triggerRepaint(n){const u=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);u&&u.enabled&&m&&u._clearRenderCacheForTile(m.id,n.tileID),this.map.triggerRepaint()}loadTile(n,u){const m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(m,s.R.Tile),b={request:y,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=y,n.actor||(n.actor=this.dispatcher.getActor());const w=(E,I,L)=>{if(delete n.request,n.aborted)return n.state="unloaded",u(null);if(E)return E.name==="AbortError"?void 0:(n.state="errored",u(E));if(this.map._refreshExpiredTiles&&I){const R=s.aM(L);n.setExpiryData(R)}if(this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!I)return u(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=I}u(null)};n.request=this.partial?n.fetchHeader(void 0,w.bind(this)):n.actor.send("loadTile",b,w.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,u){const m=n.texturePerLayer;if(n.flushAllQueues(),m.size){n.destroy(!1);for(const y of m.values())this.map.painter.saveTileTexture(y)}else n.destroy()}prepareTile(n,u,m,y){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(u,m,y,(b,w)=>{if(b)return n.state="errored",this.fire(new s.y(b)),void this.triggerRepaint(n);w&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(m,w,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:b})=>b===n),m=u&&u.fields,y=m&&m.bands&&m.bands;return y?y[0]:0}getTextureDescriptor(n,u,m){if(!n)return;const y=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;u instanceof s.aR?b=u.paint.get("raster-array-band"):u instanceof s.aS&&(b=u.paint.get("raster-particle-array-band"));const w=b||this.getInitialBand(y);if(w==null)return;if(!n.textureDescriptorPerLayer.get(u.id))return void this.prepareTile(n,y,u.id,w);if(n.updateNeeded(u.id,w)&&!m)return;const E=n.textureDescriptorPerLayer.get(u.id);return Object.assign({},E,{texture:n.texturePerLayer.get(u.id)})}getImages(n,u){const m=new Map;for(const y of n)for(const b of u){const[w,E]=b.split("/"),I=y.getLayer(w);if(!I||!I.hasBand(E)||!I.hasDataForBand(E))continue;const{bytes:L,tileSize:R,buffer:N}=I.getBandView(E),B=R+2*N,U={data:new s.q({width:B,height:B},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};m.set(b,U)}return m}queryRasterArrayValueByBandId(n,u,m){const y=u._mrt;return new Promise(b=>{const w={},E=new Set;for(const[I,L]of Object.entries(y.layers)){if(m.layerName&&I!==m.layerName)continue;const R={};w[I]=R;for(const{bands:N}of L.dataIndex)for(const B of N)m.bands&&!m.bands.includes(B)||(E.add(s.B(I,B)),u.fetchBand(I,null,B,U=>{s.o.frame(()=>{R[B]=U?null:vs([n.lng,n.lat],y,L.getBandView(B)),E.delete(s.B(I,B)),E.size===0&&b(w)})},!1))}E.size===0&&b(w)})}_loadTileForQuery(n,u){if(this._loadTileLoaded[n.uid])return void u(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(u);this._loadTilePending[n.uid]=[u];const m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(m,s.R.Tile);n.actor.send("loadTile",{request:y,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(b,w,E)=>{if(b)return this._loadTilePending[n.uid].forEach(I=>I(b,null)),void delete this._loadTilePending[n.uid];if(!w)return this._loadTilePending[n.uid].forEach(I=>I(null,null)),void delete this._loadTilePending[n.uid];if(this.map._refreshExpiredTiles&&w){const I=s.aM(E);n.setExpiryData(I)}n._mrt=w,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach(I=>I(null,w)),this._loadTileLoaded[n.uid]=!0,delete this._loadTilePending[n.uid]},void 0,!0)}queryRasterArrayValueByAllBands(n,u,m){return new Promise((y,b)=>{this._loadTileForQuery(u,(w,E)=>{w?b(w):y(E?this.queryRasterArrayValueByBandId(n,u,m):null)})})}queryRasterArrayValue(n,u){const m=s.aT.convert(n),y=this.findLoadedParent(m);return y&&y._mrt?u.bands||!this.partial?this.queryRasterArrayValueByBandId(m,y,u):this.queryRasterArrayValueByAllBands(m,y,u):Promise.resolve(null)}findLoadedParent(n){const u=s.ae.fromLngLat(n,this.map.transform.tileSize),m=this.maxzoom+1,y=1<<m,b=Math.floor(u.x),w=Math.floor((u.x-b)*y),E=Math.floor(u.y*y),I=this.map.style.getSourceCache(this.id),L=new s.aQ(m,b,m,w,E);return I.findLoadedParent(L,this.minzoom)}}const nl={vector:ea,raster:fa,"raster-dem":class extends fa{constructor(p,n,u,m){super(p,n,u,m),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(p,n){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,b){y&&(p.state="errored",n(y)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",n(null))}p.request=s.n(this.map._requestManager.transformRequest(u,s.R.Tile),(function(y,b,w){if(delete p.request,p.aborted)p.state="unloaded",n(null);else if(y)p.state="errored",n(y);else if(b){const E=s.aM(w);this.map._refreshExpiredTiles&&p.setExpiryData(E);const I=ImageBitmap&&b instanceof ImageBitmap&&s.r(),L=1-(b.width-s.aP(b.width))/2;L<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const R=I?b:s.o.getImageData(b,L),N={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:R,encoding:this.encoding,padding:L};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",N,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const n=p.canonical,u=Math.pow(2,n.z),m=(n.x-1+u)%u,y=n.x===0?p.wrap-1:p.wrap,b=(n.x+1+u)%u,w=n.x+1===u?p.wrap+1:p.wrap,E={};return E[new s.aQ(p.overscaledZ,y,n.z,m,n.y).key]={backfilled:!1},E[new s.aQ(p.overscaledZ,w,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(E[new s.aQ(p.overscaledZ,y,n.z,m,n.y-1).key]={backfilled:!1},E[new s.aQ(p.overscaledZ,p.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},E[new s.aQ(p.overscaledZ,w,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<u&&(E[new s.aQ(p.overscaledZ,y,n.z,m,n.y+1).key]={backfilled:!1},E[new s.aQ(p.overscaledZ,p.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},E[new s.aQ(p.overscaledZ,w,n.z,b,n.y+1).key]={backfilled:!1}),E}},"raster-array":Fo,geojson:class extends s.E{constructor(p,n,u,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(m),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:s.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const u of this._data.features)n.set(u.id,u);for(const u of p.features)n.set(u.id,u);this._data.features=[...n.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterChildren(p,n){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterLeaves(p,n,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:n,offset:u},m),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:p},this.workerOptions);n.scope=this.scope;const u=this._data;typeof u=="string"?(n.request=this.map._requestManager.transformRequest(s.o.resolveURL(u),s.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(m,y)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new s.y(m));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new s.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const p=s.B(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,n){const u=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,y=m?{image:m.image.clone()}:null,b=this._partialReload,w={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};p.request=this.actor.send(u,w,(E,I)=>b&&!I?(p.state="loaded",n(null)):(delete p.request,p.destroy(!1),p.aborted?n(null):E?n(E):(p.loadVectorData(I,this.map.painter,u==="reloadTile"),n(null))),void 0,u==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,n){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aU{constructor(p,n,u,m){super(p,n,u,m),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const n of p.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aV(this.urls,(n,u)=>{this._loaded=!0,n?this.fire(new s.y(n)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const n=this.video.seekable;p<n.start(0)||p>n.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,n=p.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(p,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aU,model:s.aX,"batched-model":class extends s.E{constructor(p,n,u,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();const p=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Al(this._options,this.map._requestManager,n,u,(m,y)=>{this._tileJSONRequest=null,this._loaded=!0,m?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new s.y(m))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new ys(y.bounds,this.minzoom,this.maxzoom)),wi(y.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,n){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(u,s.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=n;else{if(p.buckets){const b=Object.values(p.buckets);for(const w of b)w.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,y.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,y.bind(this),void 0,!0);function y(b,w){return p.aborted?n(null):b&&b.status!==404?n(b):(this.map._refreshExpiredTiles&&w&&p.setExpiryData(w),p.loadModelData(w,this.map.painter),p.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aU{constructor(p,n,u,m){super(p,n,u,m),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new s.y(new s.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${p}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof s.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends s.E{constructor(p,n,u,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=n,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ys(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:n,y:u,z:m}=p.canonical;return this._implementation.hasTile({x:n,y:u,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,n){const{x:u,y:m,z:y}=p.tileID.canonical,b=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:u,y:m,z:y},{signal:b.signal})).then((function(w){return delete p.request,p.aborted?(p.state="unloaded",n(null)):w===void 0?(p.state="errored",n(null)):w===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",n(null)):(function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement})(w)?(this.loadTileData(p,w),p.state="loaded",void n(null)):(p.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(p.state="errored",n(w))}),p.request.cancel=()=>b.abort()}loadTileData(p,n){p.setTexture(n,this.map.painter)}unloadTile(p,n){if(p.texture&&p.texture instanceof s.T?(p.destroy(!1),p.texture&&p.texture instanceof s.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:u,y:m,z:y}=p.tileID.canonical;this._implementation.unloadTile({x:u,y:m,z:y})}n&&n()}abortTile(p,n){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=s.B(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},cc=function(p,n,u,m){const y=new nl[n.type](p,n,u,m);if(y.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${y.id}`);return s.aY(["load","abort","unload","serialize","prepare"],y),y};function Cs(p,n,u=""){return`${u}:${n.id||""}:${n.layer.id}:${(function(m){if("layerId"in m)return`layer:${m.layerId}`;{const{featuresetId:y,importId:b}=m;return`featureset:${y}${b?`:import:${b}`:""}`}})(p.target)}`}function Ku(p,n,u,m=""){if(p.uniqueFeatureID){const y=Cs(p,n,m);if(u.has(y))return!0;u.add(y)}return!1}function Qu(p,n,u,m,y=!1,b=void 0){const w=n.sourceCache.transform,E=n.sourceCache.tilesIn(p,n.has3DLayers,y);E.sort(Bp);const I=[];for(const L of E){const R=L.tile.queryRenderedFeatures(n,L,u,m,w,y,b);Object.keys(R).length&&I.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:R})}for(const L in n.layers){const R=n.layers[L];if(R.styleLayer){const N=R.styleLayer.queryRenderedFeatures(p,n.sourceCache,m);Object.keys(N).length&&I.push({wrappedTileID:0,queryResults:N})}}return I.length===0?{}:(function(L){const R={},N={};for(const B of L){const U=B.queryResults,W=B.wrappedTileID,G=N[W]=N[W]||{};for(const J in U){const K=U[J],oe=G[J]=G[J]||{},re=R[J]=R[J]||[];for(const ne of K)oe[ne.featureIndex]||(oe[ne.featureIndex]=!0,re.push(ne))}}return R})(I)}function yy(p,n,u,m,y,b){const w={},E=m.queryRenderedSymbols(p),I=[];for(const L of Object.keys(E).map(Number))I.push(y[L]);I.sort(Bp);for(const L of I){const R=L.featureIndex.lookupSymbolFeatures(E[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,n,u,b);for(const N in R){const B=w[N]=w[N]||[],U=R[N];U.sort((W,G)=>{const J=L.featureSortOrder;if(J){const K=J.indexOf(W.featureIndex);return J.indexOf(G.featureIndex)-K}return G.featureIndex-W.featureIndex});for(const W of U)B.push(W)}}return w}function vy(p,n){const u=p.getRenderableIds().map(b=>p.getTileByID(b)),m=[],y={};for(let b=0;b<u.length;b++){const w=u[b],E=w.tileID.canonical.key;y[E]||(y[E]=!0,w.querySourceFeatures(m,n))}return m}function Bp(p,n){const u=p.tileID,m=n.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}function Np(p,n){const u={};if(!n)return u;for(const m of p){const y=m.layerIds.map(b=>n.getLayer(b)).filter(Boolean);if(y.length!==0){m.layers=y,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(b=>y.filter(w=>w.id===b)[0]));for(const b of y)u[b.fqid]=m}}return u}const _o=32,Ls=33,rl=new Uint16Array(8184);for(let p=0;p<2046;p++){let n=p+2,u=0,m=0,y=0,b=0,w=0,E=0;for(1&n?y=b=w=_o:u=m=E=_o;(n>>=1)>1;){const L=u+y>>1,R=m+b>>1;1&n?(y=u,b=m,u=w,m=E):(u=y,m=b,y=w,b=E),w=L,E=R}const I=4*p;rl[I+0]=u,rl[I+1]=m,rl[I+2]=y,rl[I+3]=b}const Rs=new Uint16Array(2178),Aa=new Uint8Array(1089),jc=new Uint16Array(1089);function Gc(p){return p===0?-.03125:p===32?.03125:0}const uc={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Pl{constructor(n,u,m,y,b,w){this.tileID=n,this.uid=s.b2(),this.uses=0,this.tileSize=u,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=w,this._hasAppearances=null}registerFadeDuration(n){const u=n+this.timeAdded;u<s.o.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,u,m){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Np(n.buckets,u.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof s.b4){if(this.hasSymbolBuckets=!0,!m)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof s.b4&&b.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],w=u.style.getOwnLayer(y);if(!w)continue;const E=w.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,E)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,u,m){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,Np(n.buckets,u.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n,u){for(const b in this.buckets){const w=this.buckets[b];if(w.uploadPending()){let E={},I=[],L={zoom:0,pitch:0,brightness:0,worldview:""};if(u){if(u.style){I=u.style.listImages();const R=w.layers[0],N=R.sourceLayer||"_geojsonTileLayer",B=u.style.getLayerSourceCache(R);B&&(E=B._state.getState(N,void 0))}L={zoom:u.transform.zoom||0,pitch:u.transform.pitch||0,brightness:u.style.getBrightness()||0,worldview:u.worldview||""}}w.upload(n,this.tileID.canonical,E,I,L)}}const m=n.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new s.T(n,y.image,m.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,m.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,m.R8),this.lineAtlas.uploaded=!0)}prepare(n,u,m){if(this.imageAtlas&&this.imageAtlasTexture&&u){const b=u.style.getLut(m);this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,m,b)}if(!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=u.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(u)),(this._lastUpdatedBrightness||y||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(u,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}evaluateQueryRenderedFeaturePadding(){let n=0;for(const u in this.buckets){const m=this.buckets[u];m.evaluateQueryRenderedFeaturePadding&&(n=Math.max(n,m.evaluateQueryRenderedFeaturePadding()))}return n}queryRenderedFeatures(n,u,m,y,b,w,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=this.evaluateQueryRenderedFeaturePadding(),L=(function(R,N){const B=s.bq([],[.5*R.width,.5*-R.height,1]);return s.br(B,B,[1,-1,0]),s.aB(B,B,R.calculateProjMatrix(N.toUnwrapped())),Float32Array.from(B)})(b,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:u,pixelPosMatrix:L,transform:y,availableImages:m,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:I,scope:E})}querySourceFeatures(n,u){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),b=u?u.sourceLayer:"",w=y._geojsonTileLayer||y[b];if(!w)return;const E=s.b6(u&&u.filter),{z:I,x:L,y:R}=this.tileID.canonical,N={z:I,x:L,y:R};for(let B=0;B<w.length;B++){const U=w.feature(B);if(E.needGeometry){const J=s.b7(U,!0);if(!E.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),J,this.tileID.canonical))continue}else if(!E.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),U))continue;const W=m.getId(U,b),G=new s.b8(U,I,L,R,W);G.tile=N,n.push(G)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const u=this.expirationTime;if(n.cacheControl){const m=s.b9(n.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(u)if(this.expirationTime<u)y=!0;else{const b=this.expirationTime-u;b?this.expirationTime=m+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}hasAppearances(n){for(const u in this.buckets)if(n.style.hasLayer(u)&&this.buckets[u].layers.some(m=>m.appearances&&m.appearances.length>0))return!0;return!1}updateBuckets(n,u){if(!this.latestFeatureIndex||!n.style)return;const m=n.style.listImages(),y=n.style.getBrightness();for(const b in this.buckets){if(!n.style.hasLayer(b))continue;const w=this.buckets[b],E=w.layers[0],I=E.sourceLayer||"_geojsonTileLayer",L=n.style.getLayerSourceCache(E);let R={};L&&(R=L._state.getState(I,void 0));const N=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},B=Object.keys(R).length>0&&!u;w.hasAppearances=w.layers.some(G=>G.appearances&&G.appearances.length>0);const U=B?w.stateDependentLayers:w.layers;if(B&&w.stateDependentLayers.length!==0||u){const G=this.latestFeatureIndex.loadVTLayers();w.update(R,G[I],m,N,U,u,y)}if(B&&w.stateDependentLayers.length!==0||u||w.hasAppearances){const G={zoom:n.transform.zoom,pitch:n.transform.pitch,brightness:n.style.getBrightness()||0,worldview:n.worldview};w.updateAppearances(this.tileID.canonical,R,m,G,n.imageManager)}(w instanceof s.ba||w instanceof s.bb)&&n._terrain&&n._terrain.enabled&&L&&w.uploadPending()&&n._terrain._clearRenderCacheForTile(L.id,this.tileID);const W=n&&n.style&&n.style.getOwnLayer(b);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.o.now()+n}setTexture(n,u){const m=u.context,y=m.gl;this.texture=this.texture||u.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n):(this.texture=new s.T(m,n,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(n,u){const m={};for(const y of u)m[y]=!0;this.dependencies[n]=m}hasDependency(n,u){for(const m of n){const y=this.dependencies[m];if(y){for(const b of u)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const m=s.bc(uc,this.tileID.canonical,this.tileTransform)[0],y=new s.bd,b=new s.be;for(let w=0;w<m.length;w++){const{x:E,y:I}=m[w];y.emplaceBack(E,I),b.emplaceBack(w)}b.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(y,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(n,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const m=s.bc(uc,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const w=(function(E,I){const L=s.aZ(E,I),R=Math.pow(2,E.z);for(let J=0;J<Ls;J++)for(let K=0;K<Ls;K++){const oe=s.a_((E.x+(K+Gc(K))/_o)/R),re=s.a$((E.y+(J+Gc(J))/_o)/R),ne=I.project(oe,re),be=J*Ls+K;Rs[2*be+0]=Math.round((ne.x*L.scale-L.x)*s.al),Rs[2*be+1]=Math.round((ne.y*L.scale-L.y)*s.al)}Aa.fill(0),jc.fill(0);for(let J=2045;J>=0;J--){const K=4*J,oe=rl[K+0],re=rl[K+1],ne=rl[K+2],be=rl[K+3],_e=oe+ne>>1,ve=re+be>>1,pe=_e+ve-re,he=ve+oe-_e,Se=re*Ls+oe,ze=be*Ls+ne,Re=ve*Ls+_e,Ze=Math.hypot((Rs[2*Se+0]+Rs[2*ze+0])/2-Rs[2*Re+0],(Rs[2*Se+1]+Rs[2*ze+1])/2-Rs[2*Re+1])>=16;Aa[Re]=Aa[Re]||(Ze?1:0),J<1022&&(Aa[Re]=Aa[Re]||Aa[(re+he>>1)*Ls+(oe+pe>>1)]||Aa[(be+he>>1)*Ls+(ne+pe>>1)])}const N=new s.b1,B=new s.b0;let U=0;function W(J,K){const oe=K*Ls+J;return jc[oe]===0&&(N.emplaceBack(Rs[2*oe+0],Rs[2*oe+1],J*s.al/_o,K*s.al/_o),jc[oe]=++U),jc[oe]-1}function G(J,K,oe,re,ne,be){const _e=J+oe>>1,ve=K+re>>1;if(Math.abs(J-ne)+Math.abs(K-be)>1&&Aa[ve*Ls+_e])G(ne,be,J,K,_e,ve),G(oe,re,ne,be,_e,ve);else{const pe=W(J,K),he=W(oe,re),Se=W(ne,be);B.emplaceBack(pe,he,Se)}}return G(0,0,_o,_o,_o,0),G(_o,_o,0,0,0,_o),{vertices:N,indices:B}})(this.tileID.canonical,u);y=w.vertices,b=w.indices}else{y=new s.b1,b=new s.b0;for(const{x:E,y:I}of m)y.emplaceBack(E,I,0,0);const w=s.bh(y.int16.subarray(0,4*y.length),void 0,4);for(let E=0;E<w.length;E+=3)b.emplaceBack(w[E],w[E+1],w[E+2])}this._tileBoundsBuffer=n.createVertexBuffer(y,s.bi.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(b),this._tileBoundsSegments=s.bg.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(n,u){const m=u.projection;if(!m||m.name!=="globe"||u.freezeTileCoverage)return;const y=this.tileID.canonical,b=s.bj(y,u),w=s.bk(b),E=s.aj(u.zoom);let I;E>0&&(I=s.bl(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,y,u,w,I,E),this._makeGlobeTileDebugTextBuffer(n,y,u,w,I,E)}_globePoint(n,u,m,y,b,w,E){let I=s.bm(n,u,m);if(w){const L=1<<m.z,R=s.aF(y.center.lng),N=s.aJ(y.center.lat),B=(m.x+.5)/L-R;let U=0;B>.5?U=-1:B<-.5&&(U=1);let W=(n/s.al+m.x)/L+U,G=(u/s.al+m.y)/L;W=(W-R)*y._pixelsPerMercatorPixel+R,G=(G-N)*y._pixelsPerMercatorPixel+N;const J=[W*y.worldSize,G*y.worldSize,0];s.af(J,J,w),I=s.bn(I,J,E)}return s.af(I,I,b)}_makeGlobeTileDebugBorderBuffer(n,u,m,y,b,w){const E=new s.bd,I=new s.be,L=new s.bo,R=(B,U,W,G,J)=>{const K=(W-B)/(J-1),oe=(G-U)/(J-1),re=E.length;for(let ne=0;ne<J;ne++){const be=B+ne*K,_e=U+ne*oe;E.emplaceBack(be,_e);const ve=this._globePoint(be,_e,u,m,y,b,w);L.emplaceBack(ve[0],ve[1],ve[2]),I.emplaceBack(re+ne)}},N=s.al;R(0,0,N,0,16),R(N,0,N,N,16),R(N,N,0,N,16),R(0,N,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(I),this._tileDebugBuffer=n.createVertexBuffer(E,s.bf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(L,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,E.length,I.length)}_makeGlobeTileDebugTextBuffer(n,u,m,y,b,w){const E=s.al/4,I=new s.bd,L=new s.b0,R=new s.bo,N=25;L.reserve(32),I.reserve(N),R.reserve(N);const B=(U,W)=>N*U+W;for(let U=0;U<N;U++){const W=U*E;for(let G=0;G<N;G++){const J=G*E;I.emplaceBack(J,W);const K=this._globePoint(J,W,u,m,y,b,w);R.emplaceBack(K[0],K[1],K[2])}}for(let U=0;U<4;U++)for(let W=0;W<4;W++){const G=B(U,W),J=B(U,W+1),K=B(U+1,W),oe=B(U+1,W+1);L.emplaceBack(G,J,K),L.emplaceBack(K,J,oe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(L),this._tileDebugTextBuffer=n.createVertexBuffer(I,s.bf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(R,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,N,32)}destroy(n=!0){for(const u in this.buckets)this.buckets[u].destroy(n);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof s.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class _d extends Pl{constructor(n,u,m,y,b){super(n,u,m,y,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,u,m){const y=m.context,b=y.gl;let w=this.texturePerLayer.get(n)||m.getTileTexture(u.width);w&&w instanceof s.T?w.update(u,{premultiply:!1}):w=new s.T(y,u,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,w)}flushQueues(n){const u=this._workQueuePerLayer.get(n)||[],m=this._fetchQueuePerLayer.get(n)||[];for(;u.length;)u.pop()();for(;m.length;)m.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const u=this._workQueuePerLayer.get(n)||[];for(;u.length;)u.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const u=this._fetchQueuePerLayer.get(n)||[];for(;u.length;)u.pop()()}}fetchHeader(n=16384,u){const m=this._mrt=new s.bs(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.bu(y,(b,w,E)=>{if(b)u(b);else try{const I=m.getHeaderLength(w);if(I>n)return void(this.request=this.fetchHeader(I,u));m.parseHeader(w),this._isHeaderLoaded=!0;let L=0;for(const R of Object.values(m.layers))L=Math.max(L,R.dataIndex[R.dataIndex.length-1].lastByte);w.byteLength>=L&&(this.entireBuffer=w),u(null,this.entireBuffer||w,E)}catch(I){u(I)}}),this.request}fetchBandForRender(n,u,m,y){this.fetchBand(n,u,m,b=>{if(b)return void y(b);this.updateTextureDescriptor(n,u,m);const w=this.textureDescriptorPerLayer.get(u);y(null,w?w.img:null)})}fetchBand(n,u,m,y,b=!0){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void y(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void y(new Error("Can't fetch tile band without an actor"));let I;const L=s.B(String(m),s.B(this.tileID.key,n));let R=this._taskQueue.get(L);R?R.add(y):(R=new Set,R.add(y),this._taskQueue.set(L,R));const N=(G,J)=>{I.complete(G,J),G?y(G):(R.forEach(K=>K(null,J)),this._taskQueue.delete(L))},B=(G,J)=>{if(G)return y(G);const K=E.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:J,task:I},N,void 0,!0);if(u!==null){const oe=this._workQueuePerLayer.get(u)||[];oe.push(()=>{K&&K.cancel(),I.cancel()}),this._workQueuePerLayer.has(u)||this._workQueuePerLayer.set(u,oe)}};let U;try{U=w.getLayer(n)}catch(G){if(this.state==="reloading")return;throw G}if(!U)return void y(new Error(`Unknown sourceLayer "${n}"`));if(U.hasDataForBand(m))return R.forEach(G=>G(null,null)),void this._taskQueue.delete(L);const W=U.getDataRange([m]);if(I=w.createDecodingTask(W),!I||I.tasks.length)if(u!==null&&this.flushQueues(u),this.entireBuffer)B(null,this.entireBuffer.slice(W.firstByte,W.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${W.firstByte}-${W.lastByte}`}}),J=s.bu(G,B);if(u!==null){const K=this._fetchQueuePerLayer.get(u)||[];K.push(()=>{J.cancel(),I.cancel()}),this._fetchQueuePerLayer.has(u)||this._fetchQueuePerLayer.set(u,K)}}}updateNeeded(n,u){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==u||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,u,m){if(!this._mrt)return;const y=this._mrt.getLayer(n);if(!y||!y.hasBand(m)||!y.hasDataForBand(m))return;const{bytes:b,tileSize:w,buffer:E,offset:I,scale:L}=y.getBandView(m),R=w+2*E,N=new s.q({width:R,height:R},b),B=this.texturePerLayer.get(u);B&&B instanceof s.T&&B.update(N,{premultiply:!1}),this.textureDescriptorPerLayer.set(u,{layer:n,band:m,img:N,buffer:E,offset:I,tileSize:w,format:y.pixelFormat,mix:[L,256*L,65536*L,16777216*L]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const u of this.texturePerLayer.values())u&&u instanceof s.T&&u.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class xy{constructor(n,u){this.max=n,this.onRemove=u,this.reset()}reset(){for(const n in this.data)for(const u of this.data[n])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(n,u,m){const y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:u,timeout:void 0};if(m!==void 0&&(b.timeout=setTimeout(()=>{this.remove(n,b)},m)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value}getByKey(n){const u=this.data[n];return u?u[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,u){if(!this.has(n))return this;const m=n.wrapped().key,y=u===void 0?0:this.data[m].indexOf(u),b=this.data[m][y];return this.data[m].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(b.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(n){const u=[];for(const m in this.data)for(const y of this.data[m])n(y.value)||u.push(y);for(const m of u)this.remove(m.value.tileID,m)}}class by{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,u,m){const y=String(u);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][y]=this.stateChanges[n][y]||{},Object.assign(this.stateChanges[n][y],m),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==y&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][y]===null){this.deletedStates[n][y]={};for(const b in this.state[n][y])m[b]||(this.deletedStates[n][y][b]=null)}else for(const b in m)this.deletedStates[n]&&this.deletedStates[n][y]&&this.deletedStates[n][y][b]===null&&delete this.deletedStates[n][y][b]}removeFeatureState(n,u,m){if(this.deletedStates[n]===null)return;const y=String(u);if(this.deletedStates[n]=this.deletedStates[n]||{},m&&u!==void 0)this.deletedStates[n][y]!==null&&(this.deletedStates[n][y]=this.deletedStates[n][y]||{},this.deletedStates[n][y][m]=null);else if(u!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][y])for(m in this.deletedStates[n][y]={},this.stateChanges[n][y])this.deletedStates[n][y][m]=null;else this.deletedStates[n][y]=null;else this.deletedStates[n]=null}getState(n,u){const m=this.state[n]||{},y=this.stateChanges[n]||{},b=this.deletedStates[n];if(b===null)return{};if(u!==void 0){const E=String(u),I=Object.assign({},m[E],y[E]);if(b){const L=b[u];if(L===null)return{};for(const R in L)delete I[R]}return I}const w=Object.assign({},m,y);if(b)for(const E in b)delete w[E];return w}initializeTileState(n,u){n.refreshFeatureState(u)}coalesceChanges(n,u){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const w in this.stateChanges[y])this.state[y][w]||(this.state[y][w]={}),Object.assign(this.state[y][w],this.stateChanges[y][w]),b[w]=this.state[y][w];m[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const w in this.state[y])b[w]={},this.state[y][w]={};else for(const w in this.deletedStates[y]){if(this.deletedStates[y][w]===null)this.state[y][w]={};else if(this.state[y][w])for(const E of Object.keys(this.deletedStates[y][w]))delete this.state[y][w][E];b[w]=this.state[y][w]}m[y]=m[y]||{},Object.assign(m[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const y in n)n[y].refreshFeatureState(u)}}class es extends s.E{constructor(n,u,m){super(),this.id=n,this._onlySymbols=m,u.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new xy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new by,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,u){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,u)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const m=this._tiles[u];m.upload(n,this.map?this.map.painter:void 0),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(eh).map(n=>n.key)}getRenderableIds(n,u){const m=[];for(const y in this._tiles)this._isIdRenderable(+y,n,u)&&m.push(this._tiles[y]);return n?m.sort((y,b)=>{const w=y.tileID,E=b.tileID,I=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),L=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-E.overscaledZ||L.y-I.y||L.x-I.x}).map(y=>y.tileID.key):m.map(y=>y.tileID).sort(eh).map(y=>y.key)}hasRenderableParent(n){const u=this.findLoadedParent(n,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(n,u,m){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(u||!this._tiles[n].holdingForFade())&&(m||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,u){const m=this._tiles[n];m&&(m.state!=="loading"&&(m.state=u),this._loadTile(m,this._tileLoaded.bind(this,m,n,u)))}_tileLoaded(n,u,m,y,b){if(y){if(n.state="errored",y.status!==404)this._source.fire(new s.y(y,{tile:n}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const E=this.map.painter.terrain;this.update(this.transform,E.getScaledDemTileSize(),!0),E.resetTileLookupCache(this.id)}else this.update(this.transform)}return}n.timeAdded=s.o.now(),m==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(u,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null);let w=new Map;b&&b.responseHeaders&&(w=b.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id,responseHeaders:w}))}_backfillDEM(n){const u=this.getRenderableIds();for(let y=0;y<u.length;y++){const b=u[y];if(n.neighboringTiles&&n.neighboringTiles[b]){const w=this.getTileByID(b);m(n,w),m(w,n)}}function m(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let w=b.tileID.canonical.x-y.tileID.canonical.x;const E=b.tileID.canonical.y-y.tileID.canonical.y,I=Math.pow(2,y.tileID.canonical.z),L=b.tileID.key;w===0&&E===0||Math.abs(E)>1||(Math.abs(w)>1&&(Math.abs(w+I)===1?w+=I:Math.abs(w-I)===1&&(w-=I)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,w,E),y.neighboringTiles&&y.neighboringTiles[L]&&(y.neighboringTiles[L].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,u,m,y){for(const b in this._tiles){let w=this._tiles[b];if(y[b]||!w.hasData()||w.tileID.overscaledZ<=u||w.tileID.overscaledZ>m)continue;let E=w.tileID;for(;w&&w.tileID.overscaledZ>u+1;){const L=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[L.key],w&&w.hasData()&&(E=L)}let I=E;for(;I.overscaledZ>u;)if(I=I.scaledTo(I.overscaledZ-1),n[I.key]){y[E.key]=E;break}}}findLoadedParent(n,u){if(n.key in this._loadedParentTiles){const m=this._loadedParentTiles[n.key];return m&&m.tileID.overscaledZ>=u?m:null}for(let m=n.overscaledZ-1;m>=u;m--){const y=n.scaledTo(m),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(n){const u=this._tiles[n.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,u){u=u||this._source.tileSize;const m=Math.ceil(n.width/u)+1,y=Math.ceil(n.height/u)+1,b=Math.floor(m*y*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(E)}handleWrapJump(n){const u=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,u){const m={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),m[b.tileID.key]=b}this._tiles=m;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(n,u,m,y,b){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(n,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let E,I=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const B=L.attenuationRange()[0],U=Math.floor(B)-Math.log2(L.getDemUpscale());I>U&&(I=U)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new s.aQ(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y));else if(this.tileCoverLift!==0){const B=n.clone();B.tileCoverLift=this.tileCoverLift,E=B.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&n.projection.name==="globe"&&(E.push(new s.aQ(1,0,1,0,0)),E.push(new s.aQ(1,0,1,1,0)),E.push(new s.aQ(1,0,1,0,1)),E.push(new s.aQ(1,0,1,1,1)))}else if(E=n.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);E=E.filter(U=>B(U))}}else E=[];if(E.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!th(this._source.type)){const B=n.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),U=Math.min(B,this._source.maxzoom);if(w){const W=n.extendTileCover(E,U);for(const G of W)E.push(G)}else if(b){const W=n.extendTileCoverToNearPlane(E,this.transform.getFrustum(U),U);for(const G of W)E.push(G)}else if(this.castsShadows&&y){const W=n.extendTileCover(E,U,y,16);for(const G of W)this._shadowCasterTiles[G.key]=!0,E.push(G)}}const R=this._updateRetainedTiles(E);if(th(this._source.type)&&E.length!==0){const B={},U={},W=Object.keys(R);for(const J of W){const K=R[J],oe=this._tiles[J];if(!oe||oe.fadeEndTime&&oe.fadeEndTime<=s.o.now())continue;const re=this.findLoadedParent(K,Math.max(K.overscaledZ-es.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),B[re.tileID.key]=re.tileID),U[J]=K}const G=E[E.length-1].overscaledZ;for(const J in this._tiles){const K=this._tiles[J];if(R[J]||!K.hasData())continue;let oe=K.tileID;for(;oe.overscaledZ>G;){oe=oe.scaledTo(oe.overscaledZ-1);const re=this._tiles[oe.key];if(re&&re.hasData()&&U[oe.key]){R[J]=K.tileID;break}}}for(const J in B)R[J]||(this._coveredTiles[J]=!0,R[J]=B[J])}for(const B in R)this._tiles[B].clearFadeHold();const N=s.bv(this._tiles,R);for(const B of N){const U=this._tiles[B];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const u={};if(n.length===0)return u;const m={},y=n.reduce((L,R)=>Math.min(L,R.overscaledZ),1/0),b=n[0].overscaledZ,w=Math.max(b-es.maxOverzooming,this._source.minzoom),E=Math.max(b+es.maxUnderzooming,this._source.minzoom),I={};for(const L of n){const R=this._addTile(L);u[L.key]=L,R.hasData()||y<this._source.maxzoom&&(I[L.key]=L)}this._retainLoadedChildren(I,y,E,u);for(const L of n){let R=this._tiles[L.key];if(R.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const B=L.children(this._source.maxzoom)[0],U=this.getTile(B);if(U&&U.hasData()){u[B.key]=B;continue}}else{const B=L.children(this._source.maxzoom);if(u[B[0].key]&&u[B[1].key]&&u[B[2].key]&&u[B[3].key])continue}let N=R.wasRequested();for(let B=L.overscaledZ-1;B>=w;--B){const U=L.scaledTo(B);if(m[U.key]||(m[U.key]=!0,R=this.getTile(U),!R&&N&&(R=this._addTile(U)),R&&(u[U.key]=U,N=R.wasRequested(),R.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const u=[];let m,y=this._tiles[n].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){m=this._loadedParentTiles[y.key];break}u.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(m=this._getLoadedTile(b),m)break;y=b}for(const b of u)this._loadedParentTiles[b]=m}}_addTile(n){let u=this._tiles[n.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),u;u=this._cache.getAndRemove(n),u&&(this._setTileReloadTimer(n.key,u),u.tileID=n,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,u)));const m=!!u;if(!m){const y=this.map?this.map.painter:null,b=this._source.tileSize*n.overscaleFactor();u=this._source.type==="raster-array"?new _d(n,b,this.transform.tileZoom,y,this._isRaster):new Pl(n,b,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(u,this._tileLoaded.bind(this,u,n.key,u.state))}return u.uses++,this._tiles[n.key]=u,m||this._source.fire(new s.z("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(n,u){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const m=u.getExpiryTimeout();m&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},m))}_removeTile(n){const u=this._tiles[n];u&&(u.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,u,m){const y=[],b=this.transform;if(!b)return y;const w=b.projection.name==="globe",E=s.aF(b.center.lng);for(const I in this._tiles){const L=this._tiles[I];if(m&&L.clearQueryDebugViz(),L.holdingForFade())continue;let R;if(w){const N=L.tileID.canonical;if(N.z===0){const B=[Math.abs(s.aA(E,...ol(N,-1))-E),Math.abs(s.aA(E,...ol(N,1))-E)];R=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(s.aA(E,...ol(N,-1))-E),Math.abs(s.aA(E,...ol(N,0))-E),Math.abs(s.aA(E,...ol(N,1))-E)];R=[B.indexOf(Math.min(...B))-1]}}else R=[0];for(const N of R){const B=n.containsTile(L,b,u,N);B&&y.push(B)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,u){const m=this.getRenderableIds(n,u).map(b=>this._tiles[b].tileID),y=this.transform.projection.name==="globe";for(const b of m)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return m}sortCoordinatesByDistance(n){const u=n.slice(),m=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const w of u){const E=1/(1<<w.canonical.z);b[w.key]=((w.canonical.x+.5)*E+w.wrap-m[0])*y[0]+((w.canonical.y+.5)*E-m[1])*y[1]-m[2]*y[2]}return u.sort((w,E)=>b[w.key]-b[E.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(th(this._source.type))for(const n in this._tiles){const u=this._tiles[n];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(n,u,m){this._state.updateState(n=n||"_geojsonTileLayer",u,m)}removeFeatureState(n,u,m){this._state.removeFeatureState(n=n||"_geojsonTileLayer",u,m)}getFeatureState(n,u){return this._state.getState(n=n||"_geojsonTileLayer",u)}setDependencies(n,u,m){const y=this._tiles[n];y&&y.setDependencies(u,m)}reloadTilesForDependencies(n,u){for(const m in this._tiles)this._tiles[m].hasDependency(n,u)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(n,u))}_preloadTiles(n,u){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(n,u))};return void this._source.on("data",I)}const m=new Map,y=Array.isArray(n)?n:[n],b=this.map.painter.terrain,w=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const I of y){const L=I.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of L)m.set(R.key,R);this.usedForTerrain&&I.updateElevation(!1)}const E=Array.from(m.values());s.bw(E,(I,L)=>{const R=new Pl(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(R,N=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),L(N,R)})},u)}}function eh(p,n){const u=Math.abs(2*p.wrap)-+(p.wrap<0),m=Math.abs(2*n.wrap)-+(n.wrap<0);return p.overscaledZ-n.overscaledZ||m-u||n.canonical.y-p.canonical.y||n.canonical.x-p.canonical.x}function th(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function ol(p,n){const u=1<<p.z;return[p.x/u+n,(p.x+1)/u+n]}es.maxOverzooming=10,es.maxUnderzooming=3;class ih{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,u=!1;for(const m in this.style._mergedLayers){const y=this.style._mergedLayers[m];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:n,visibilityChanged:u});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:n,visibilityChanged:u})}}}onNewFrame(n){this.layersGotHidden=!1;for(const u of this.layers){const m=u.layer;let y=!1;m.type==="fill-extrusion"?y=!m.isHidden(n)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="building"?y=!m.isHidden(n)&&m.paint.get("building-opacity")>0:m.type==="model"&&(y=!m.isHidden(n)&&m.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&u.visible,u.visible=y}}updateZOffset(n,u){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,w=this.style.getLayerSourceCache(b);let E=1;b.type==="fill-extrusion"?E=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(E=y.visible?b.paint.get("building-vertical-scale"):0);let I=w?w.getTile(u):null;if(!I&&w)for(const L in w._tiles){const R=w._tiles[L];if(u.canonical.isChildOf(R.tileID.canonical)){I=R;break}}this.currentBuildingBuckets.push({bucket:I?I.getBucket(b):null,tileID:I?I.tileID:u,verticalScale:E})}n.hasAnyZOffset=!1;let m=!1;for(let y=0;y<n.symbolInstances.length;y++){const b=n.symbolInstances.get(y),w=b.zOffset,E=this._getHeightAtTileOffset(u,b.tileAnchorX,b.tileAnchorY);b.zOffset=E!==Number.NEGATIVE_INFINITY?E:w,m||w===b.zOffset||(m=!0),n.hasAnyZOffset||b.zOffset===0||(n.hasAnyZOffset=!0)}m&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,u,m,y){let b=u,w=m;if(n.canonical.z!==y.canonical.z){const E=y.canonical,I=1/(1<<n.canonical.z-E.z);b=(u+n.canonical.x*s.al)*I-E.x*s.al|0,w=(m+n.canonical.y*s.al)*I-E.y*s.al|0}return{tileX:b,tileY:w}}_getHeightAtTileOffset(n,u,m){let y,b;for(let w=0;w<this.layers.length;++w){const E=this.layers[w].layer;if(E.type!=="fill-extrusion"&&E.type!=="building")continue;const{bucket:I,tileID:L,verticalScale:R}=this.currentBuildingBuckets[w];if(!I)continue;const{tileX:N,tileY:B}=this._mapCoordToOverlappingTile(n,u,m,L),U=I.getHeightAtTileCoord(N,B);U&&U.height!==void 0&&(U.hidden?y=U.height:b=Math.max(U.height*R,b||0))}if(b!==void 0)return b;for(let w=0;w<this.layers.length;++w){const E=this.layers[w];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:I,tileID:L}=this.currentBuildingBuckets[w];if(!I)continue;const{tileX:R,tileY:N}=this._mapCoordToOverlappingTile(n,u,m,L),B=I.getHeightAtTileCoord(R,N);if(B&&!B.hidden)return B.height===void 0&&y!==void 0?Math.min(B.maxHeight,y)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function hw(p,n){const u={};for(const m in p)m!=="ref"&&(u[m]=p[m]);return s.bx.forEach(m=>{m in n&&(u[m]=n[m])}),u}function Up(p){p=p.slice();const n=Object.create(null);for(let u=0;u<p.length;u++)n[p[u].id]=p[u];for(let u=0;u<p.length;u++)"ref"in p[u]&&(p[u]=hw(p[u],n[p[u].ref]));return p}const un={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Hc(p,n,u){u.push({command:un.addSource,args:[p,n[p]]})}function yd(p,n,u){n.push({command:un.removeSource,args:[p]}),u[p]=!0}function wy(p,n,u,m){yd(p,u,m),Hc(p,n,u)}function Sy(p,n,u){let m;for(m in p[u])if(p[u].hasOwnProperty(m)&&m!=="data"&&!s.by(p[u][m],n[u][m]))return!1;for(m in n[u])if(n[u].hasOwnProperty(m)&&m!=="data"&&!s.by(p[u][m],n[u][m]))return!1;return!0}function nh(p,n,u,m,y,b){let w;for(w in n=n||{},p=p||{})p.hasOwnProperty(w)&&(s.by(p[w],n[w])||u.push({command:b,args:[m,w,n[w],y]}));for(w in n)n.hasOwnProperty(w)&&!p.hasOwnProperty(w)&&(s.by(p[w],n[w])||u.push({command:b,args:[m,w,n[w],y]}))}function zl(p){return p.id}function rh(p,n){return p[n.id]=n,p}function vd(p,n,u){const m=n.createTileMatrix(p,p.worldSize,u.toUnwrapped());return s.aB(new Float32Array(16),p.projMatrix,m)}function dw(p,n,u){if(n.projection.name===u.projection.name)return p.projMatrix;const m=u.clone();return m.setProjection(n.projection),vd(m,n.getProjection(),p)}function Zc(p,n,u){return n.name===u.projection.name?p.projMatrix:vd(u,n,p)}class sl{constructor(n,u){this.reset(n,u)}reset(n,u){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.aA(n,0,1);let u=1,m=this._distances[u];const y=n*this.paddedLength+this.padding;for(;m<y&&u<this._distances.length;)m=this._distances[++u];const b=u-1,w=this._distances[b],E=m-w,I=E>0?(y-w)/E:0;return this.points[b].mult(1-I).add(this.points[u].mult(I))}}class oh{constructor(n,u,m){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(u/m);for(let w=0;w<this.xCellCount*this.yCellCount;w++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,u,m,y,b){this._forEachCell(u,m,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(n,u,m,y){this._forEachCell(u-y,m-y,u+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(m),this.circles.push(y)}_insertBoxCell(n,u,m,y,b,w){this.boxCells[b].push(w)}_insertCircleCell(n,u,m,y,b,w){this.circleCells[b].push(w)}_query(n,u,m,y,b,w){if(m<0||n>this.width||y<0||u>this.height)return!b&&[];const E=[];if(n<=0&&u<=0&&this.width<=m&&this.height<=y){if(b)return!0;for(let I=0;I<this.boxKeys.length;I++)E.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const L=this.circles[3*I],R=this.circles[3*I+1],N=this.circles[3*I+2];E.push({key:this.circleKeys[I],x1:L-N,y1:R-N,x2:L+N,y2:R+N})}return w?E.filter(w):E}return this._forEachCell(n,u,m,y,this._queryCell,E,{hitTest:b,seenUids:{box:{},circle:{}}},w),b?E.length>0:E}_queryCircle(n,u,m,y,b){const w=n-m,E=n+m,I=u-m,L=u+m;if(E<0||w>this.width||L<0||I>this.height)return!y&&[];const R=[];return this._forEachCell(w,I,E,L,this._queryCellCircle,R,{hitTest:y,circle:{x:n,y:u,radius:m},seenUids:{box:{},circle:{}}},b),y?R.length>0:R}query(n,u,m,y,b){return this._query(n,u,m,y,!1,b)}hitTest(n,u,m,y,b){return this._query(n,u,m,y,!0,b)}hitTestCircle(n,u,m,y){return this._queryCircle(n,u,m,!0,y)}_queryCell(n,u,m,y,b,w,E,I){const L=E.seenUids,R=this.boxCells[b];if(R!==null){const B=this.bboxes;for(const U of R)if(!L.box[U]){L.box[U]=!0;const W=4*U;if(n<=B[W+2]&&u<=B[W+3]&&m>=B[W+0]&&y>=B[W+1]&&(!I||I(this.boxKeys[U]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[U],x1:B[W],y1:B[W+1],x2:B[W+2],y2:B[W+3]})}}}const N=this.circleCells[b];if(N!==null){const B=this.circles;for(const U of N)if(!L.circle[U]){L.circle[U]=!0;const W=3*U;if(this._circleAndRectCollide(B[W],B[W+1],B[W+2],n,u,m,y)&&(!I||I(this.circleKeys[U]))){if(E.hitTest)return w.push(!0),!0;{const G=B[W],J=B[W+1],K=B[W+2];w.push({key:this.circleKeys[U],x1:G-K,y1:J-K,x2:G+K,y2:J+K})}}}}}_queryCellCircle(n,u,m,y,b,w,E,I){const L=E.circle,R=E.seenUids,N=this.boxCells[b];if(N!==null){const U=this.bboxes;for(const W of N)if(!R.box[W]){R.box[W]=!0;const G=4*W;if(this._circleAndRectCollide(L.x,L.y,L.radius,U[G+0],U[G+1],U[G+2],U[G+3])&&(!I||I(this.boxKeys[W])))return w.push(!0),!0}}const B=this.circleCells[b];if(B!==null){const U=this.circles;for(const W of B)if(!R.circle[W]){R.circle[W]=!0;const G=3*W;if(this._circlesCollide(U[G],U[G+1],U[G+2],L.x,L.y,L.radius)&&(!I||I(this.circleKeys[W])))return w.push(!0),!0}}}_forEachCell(n,u,m,y,b,w,E,I){const L=this._convertToXCellCoord(n),R=this._convertToYCellCoord(u),N=this._convertToXCellCoord(m),B=this._convertToYCellCoord(y);for(let U=L;U<=N;U++)for(let W=R;W<=B;W++)if(b.call(this,n,u,m,y,this.xCellCount*W+U,w,E,I))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,u,m,y,b,w){const E=y-n,I=b-u,L=m+w;return L*L>E*E+I*I}_circleAndRectCollide(n,u,m,y,b,w,E){const I=(w-y)/2,L=Math.abs(n-(y+I));if(L>I+m)return!1;const R=(E-b)/2,N=Math.abs(u-(b+R));if(N>R+m)return!1;if(L<=I||N<=R)return!0;const B=L-I,U=N-R;return B*B+U*U<=m*m}}const Ty=Math.tan(85*Math.PI/180);function hc(p,n,u,m,y,b,w){const E=s.bC();if(u)if(b.name==="globe"){const I=s.bD(y,n);s.aB(E,E,I)}else{const I=s.bE([],w);E[0]=I[0],E[1]=I[1],E[4]=I[2],E[5]=I[3],m||s.bB(E,E,y.angle)}else s.aB(E,y.labelPlaneMatrix,p);return E}function al(p,n,u,m,y,b,w){const E=hc(p,n,u,m,y,b,w);return b.name==="globe"&&u||(E[2]=E[6]=E[10]=E[14]=0),E}function ts(p,n,u,m,y,b,w){if(u){if(b.name==="globe"){const E=hc(p,n,u,m,y,b,w);return s.bl(E,E),s.aB(E,p,E),E}{const E=s.bz(p),I=s.bA([]);return I[0]=w[0],I[1]=w[1],I[4]=w[2],I[5]=w[3],s.aB(E,E,I),m||s.bB(E,E,-y.angle),E}}return y.glCoordMatrix}function ta(p,n,u,m){const y=[p,n,u,1];u?s.aC(y,y,m):bd(y,y,m);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function xd(p,n){return Math.min(.5+p/n*.5,1.5)}function Ey(p,n){const u=p[0]/p[3],m=p[1]/p[3];return u>=-n[0]&&u<=n[0]&&m>=-n[1]&&m<=n[1]}function bn(p,n,u,m,y,b,w,E,I,L,R=1){const N=u.transform,B=m?p.textSizeData:p.iconSizeData,U=s.bK(B,u.transform.zoom,R),W=N.projection.name==="globe",G=[256/u.width*2+1,256/u.height*2+1],J=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;J.clear();let K=null;W&&(K=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const oe=p.lineVertexArray,re=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,ne=u.transform.width/u.transform.height;let be,_e=!1;for(let ve=0;ve<re.length;ve++){const pe=re.get(ve),{numGlyphs:he,writingMode:Se}=pe;if(Se!==s.bL.vertical||_e||be===s.bL.horizontal||(_e=!0),be=Se,(pe.hidden||Se===s.bL.vertical)&&!_e){Bo(he,J);continue}_e=!1;const ze=new s.P(pe.tileAnchorX,pe.tileAnchorY),Re=p.elevationType==="road",Ze=!!N.elevation||Re;let{x:je,y:it,z:dt}=N.projection.projectTilePoint(ze.x,ze.y,L.canonical),Fe=null;if(Ze){const Gt=Re?p.getElevationFeatureForText(ve):null;Fe={getElevation:I,elevation:N.elevation,elevationFeature:Gt};const[si,pi,Ni]=I(ze,N.elevation,Gt);je+=si,it+=pi,dt+=Ni}const Te=[je,it,dt,1];if(s.aC(Te,Te,n),!Ey(Te,G)){Bo(he,J);continue}const Ke=Te[3],We=xd(u.transform.getCameraToCenterDistance(N.projection),Ke),pt=s.bM(B,U,pe),vt=w?pt/We:pt*We,Pt=ta(je,it,dt,y);if(Pt[3]<=0){Bo(he,J);continue}let xt={};const St=s.an(p.layers[0].layout.get("text-max-angle")),Xt=Math.cos(St),Ht=w?null:Fe,Rt=My(pe,vt,!1,E,n,y,b,p.glyphOffsetArray,oe,J,K,Pt,ze,xt,ne,Ht,N.projection,L,w,Xt);_e=Rt.useVertical,Ht&&Rt.needsFlipping&&(xt={}),(Rt.notEnoughRoom||_e||Rt.needsFlipping&&My(pe,vt,!0,E,n,y,b,p.glyphOffsetArray,oe,J,K,Pt,ze,xt,ne,Ht,N.projection,L,w,Xt).notEnoughRoom)&&Bo(he,J)}m?(p.text.dynamicLayoutVertexBuffer.updateData(J),K&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(K)):(p.icon.dynamicLayoutVertexBuffer.updateData(J),K&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(K))}function $p(p,n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J){const{lineStartIndex:K,glyphStartIndex:oe,segment:re}=E,ne=oe+E.numGlyphs,be=K+E.lineLength,_e=n.getoffsetX(oe),ve=n.getoffsetX(ne-1),pe=dc(p*_e,u,m,y,b,w,re,K,be,I,L,R,N,B,!0,U,W,G,J);if(!pe)return null;const he=dc(p*ve,u,m,y,b,w,re,K,be,I,L,R,N,B,!0,U,W,G,J);return he?{first:pe,last:he}:null}function Iy(p,n,u,m){return p===s.bL.horizontal&&Math.abs(m)>Math.abs(u)?{useVertical:!0}:p===s.bL.vertical?m>0?{needsFlipping:!0}:null:n!==0&&(function(y,b){return y===0||Math.abs(b/y)>Ty})(u,m)?n===1?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function My(p,n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J,K,oe,re){const ne=n/24,be=p.lineOffsetX*ne,_e=p.lineOffsetY*ne,{lineStartIndex:ve,glyphStartIndex:pe,numGlyphs:he,segment:Se,writingMode:ze,flipState:Re}=p,Ze=ve+p.lineLength,je=it=>{if(R){const[Ke,We,pt]=it.up,vt=L.length;s.bN(R,vt+0,Ke,We,pt),s.bN(R,vt+1,Ke,We,pt),s.bN(R,vt+2,Ke,We,pt),s.bN(R,vt+3,Ke,We,pt)}const[dt,Fe,Te]=it.point;s.bO(L,dt,Fe,Te,it.angle)};if(he>1){const it=$p(ne,E,be,_e,u,N,B,p,I,b,U,G,!1,J,K,oe,re);if(!it)return{notEnoughRoom:!0};if(m&&!u){let[dt,Fe,Te]=it.first.point,[Ke,We,pt]=it.last.point;[dt,Fe]=ta(dt,Fe,Te,w),[Ke,We]=ta(Ke,We,pt,w);const vt=Iy(ze,Re,(Ke-dt)*W,We-Fe);if(p.flipState=vt&&vt.needsFlipping?1:2,vt)return vt}je(it.first);for(let dt=pe+1;dt<pe+he-1;dt++){const Fe=dc(ne*E.getoffsetX(dt),be,_e,u,N,B,Se,ve,Ze,I,b,U,G,!1,!1,J,K,oe,re);if(!Fe)return L.length-=4*(dt-pe),{notEnoughRoom:!0};je(Fe)}je(it.last)}else{if(m&&!u){const dt=ta(B.x,B.y,0,y),Fe=ve+Se+1,Te=new s.P(I.getx(Fe),I.gety(Fe)),Ke=ta(Te.x,Te.y,0,y),We=Ke[3]>0?Ke:Vp(B,Te,dt,1,y,void 0,J,K.canonical),pt=Iy(ze,Re,(We[0]-dt[0])*W,We[1]-dt[1]);if(p.flipState=pt&&pt.needsFlipping?1:2,pt)return pt}const it=dc(ne*E.getoffsetX(pe),be,_e,u,N,B,Se,ve,Ze,I,b,U,G,!1,!1,J,K,oe,re);if(!it)return{notEnoughRoom:!0};je(it)}return{}}function di(p,n,u,m,y){const{x:b,y:w,z:E}=m.projectTilePoint(p.x,p.y,n);if(!y)return ta(b,w,E,u);const[I,L,R]=y.getElevation(p,y.elevation,y.elevationFeature);return ta(b+I,w+L,E+R,u)}function Vp(p,n,u,m,y,b,w,E){const I=di(p.sub(n)._unit()._add(p),E,y,w,b);return s.av(I,u,I),s.aw(I,I),s.bH(I,u,I,m)}function dc(p,n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J,K,oe){const re=m?p-n:p+n;let ne=re>0?1:-1,be=0;m&&(ne*=-1,be=Math.PI),ne<0&&(be+=Math.PI);let _e=E+w+(ne>0?0:1)|0,ve=y,pe=y,he=0,Se=0;const ze=Math.abs(re),Re=[],Ze=[];let je=b,it=je,dt=s.bF([]);const Fe=()=>Vp(it,je,pe,ze-he+1,R,B,G,J.canonical);for(;he+Se<=ze;){if(_e+=ne,_e<E||_e>=I)return null;if(pe=ve,it=je,Re.push(pe),U&&Ze.push(it),je=new s.P(L.getx(_e),L.gety(_e)),ve=N[_e],!ve){const Ht=di(je,J.canonical,R,G,B);ve=Ht[3]>0?N[_e]=Ht:Fe()}he+=Se;const St=s.av([],ve,pe),Xt=s.bG(pe,ve);if(u&&Xt>0&&Se>0&&s.bJ(dt,St)/(Se*Xt)<oe)return null;Se=Xt,dt=St}W&&B&&(N[_e]&&(ve=Fe(),Se=s.bG(pe,ve),dt=s.av([],ve,pe)),N[_e]=ve);const Te=(ze-he)/Se,Ke=je.sub(it)._mult(Te)._add(it),We=s.bH([],pe,dt,Te);let pt=[0,0,1],vt=dt[0],Pt=dt[1];if(K&&(pt=G.upVector(J.canonical,Ke.x,Ke.y),pt[0]!==0||pt[1]!==0||pt[2]!==1)){const St=[pt[2],0,-pt[0]],Xt=s.bI([],pt,St);s.aw(St,St),s.aw(Xt,Xt),vt=s.bJ(dt,St),Pt=s.bJ(dt,Xt)}if(u){const St=s.bI([],pt,dt);s.aw(St,St),s.bH(We,We,St,u*ne)}const xt=be+Math.atan2(Pt,vt);return Re.push(We),U&&Ze.push(Ke),{point:We,angle:xt,path:Re,tilePath:Ze,up:pt}}function Bo(p,n){const u=n.length,m=u+4*p;n.resize(m),n.float32.fill(-1/0,4*u,4*m)}function bd(p,n,u){const m=n[0],y=n[1];return p[0]=u[0]*m+u[4]*y+u[12],p[1]=u[1]*m+u[5]*y+u[13],p[3]=u[3]*m+u[7]*y+u[15],p}const is=100;class ni{constructor(n,u,m=new oh(n.width+200,n.height+200,25),y=new oh(n.width+200,n.height+200,25)){this.transform=n,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+is,this.screenBottomBoundary=n.height+is,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=u}placeCollisionBox(n,u,m,y,b,w,E,I,L,R,N){let B=m.projectedAnchorX,U=m.projectedAnchorY,W=m.projectedAnchorZ;const G=m.tileAnchorX,J=m.tileAnchorY,K=m.elevation,oe=m.tileID,re=n.getProjection();if(K&&oe){const[Ze,je,it]=re.upVector(oe.canonical,m.tileAnchorX,m.tileAnchorY),dt=re.upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=Ze*K*dt,U+=je*K*dt,W+=it*K*dt}const ne=n.projection.name==="globe",be=n.projection.name==="globe"?s.aj(this.transform.zoom):0;if(oe&&ne&&be<1&&!w){const Ze=1<<oe.canonical.z,je=s.bP(G,J);s.bQ(je,je,1/s.al),s.bR(je,je,s.bP(oe.canonical.x,oe.canonical.y)),s.bQ(je,je,1/Ze),s.bS(je,je,s.bP(y[0],y[1])),je[0]=s.bT(je[0],-.5,.5),s.bQ(je,je,s.al);const it=s.bU(je[0],je[1],s.al/(2*Math.PI),1);s.aC(it,it,b),B=s.ak(B,it[0],be),U=s.ak(U,it[1],be),W=s.ak(W,it[2],be)}const _e=this.projectAndGetPerspectiveRatio(R,B,U,W,m.tileID,re.name==="globe"||!!K||this.transform.pitch>0,re),ve=L*_e.perspectiveRatio,pe=(m.x1*u+E.x-m.padding)*ve+_e.point.x,he=(m.y1*u+E.y-m.padding)*ve+_e.point.y,Se=(m.x2*u+E.x+m.padding)*ve+_e.point.x,ze=(m.y2*u+E.y+m.padding)*ve+_e.point.y,Re=_e.perspectiveRatio<=.55||_e.occluded;return!this.isInsideGrid(pe,he,Se,ze)||!I&&this.grid.hitTest(pe,he,Se,ze,N)||Re?{box:[],offscreen:!1,occluded:_e.occluded}:{box:[pe,he,Se,ze],offscreen:this.isOffscreen(pe,he,Se,ze),occluded:!1}}placeCollisionCircles(n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J){const K=[],oe=this.transform.elevation,re=n.getProjection(),ne=n.elevationType==="road",be=!!oe||ne,_e=s.bV.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,re),ve=new s.P(m.tileAnchorX,m.tileAnchorY),pe=new s.P(m.tileAnchorX,m.tileAnchorY);let{x:he,y:Se,z:ze}=re.projectTilePoint(pe.x,pe.y,J.canonical),Re=null;if(be){const Xt=ne?n.getElevationFeatureForText(y):null;Re={getElevation:_e,elevation:oe,elevationFeature:Xt};const[Ht,Rt,Gt]=_e(ve,oe,Xt);he+=Ht,Se+=Rt,ze+=Gt}const Ze=re.name==="globe",je=this.projectAndGetPerspectiveRatio(I,he,Se,ze,J,Ze||!!oe||this.transform.pitch>0,re),{perspectiveRatio:it}=je,dt=(B?E/it:E*it)/s.bY,Fe=ta(he,Se,ze,L),Te=m.lineOffsetX*dt,Ke=m.lineOffsetY*dt,We=s.an(n.layers[0].layout.get("text-max-angle")),pt=Math.cos(We),vt=je.signedDistanceFromCamera>0?$p(dt,w,Te,Ke,ne&&m.flipState===1,Fe,pe,m,b,L,{},be&&!B?Re:null,B&&be,re,J,B,pt):null;let Pt=!1,xt=!1,St=!0;if(vt&&!je.occluded){const Xt=.5*W*it+G,Ht=new s.P(-100,-100),Rt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Gt=new sl,{first:si,last:pi}=vt,Ni=si.path.length;let en=[];for(let Ri=Ni-1;Ri>=1;Ri--)en.push(si.path[Ri]);for(let Ri=1;Ri<pi.path.length;Ri++)en.push(pi.path[Ri]);const Ei=2.5*Xt;R&&(en=en.map(([Ri,En,wn],Mn)=>(be&&!Ze&&(wn=_e(Mn<Ni-1?si.tilePath[Ni-1-Mn]:pi.tilePath[Mn-Ni+2],oe,Re.elevationFeature)[2]),ta(Ri,En,wn,R))),en.some(Ri=>Ri[3]<=0)&&(en=[]));let ln=[];if(en.length>0){let Ri=1/0,En=-1/0,wn=1/0,Mn=-1/0;for(const tn of en)Ri=Math.min(Ri,tn[0]),wn=Math.min(wn,tn[1]),En=Math.max(En,tn[0]),Mn=Math.max(Mn,tn[1]);En>=Ht.x&&Ri<=Rt.x&&Mn>=Ht.y&&wn<=Rt.y&&(ln=[en.map(tn=>new s.P(tn[0],tn[1]))],(Ri<Ht.x||En>Rt.x||wn<Ht.y||Mn>Rt.y)&&(ln=s.bW(ln,Ht.x,Ht.y,Rt.x,Rt.y)))}for(const Ri of ln){Gt.reset(Ri,.25*Xt);let En=0;En=Gt.length<=.5*Xt?1:Math.ceil(Gt.paddedLength/Ei)+1;for(let wn=0;wn<En;wn++){const Mn=wn/Math.max(En-1,1),tn=Gt.lerp(Mn),Fi=tn.x+is,gn=tn.y+is;K.push(Fi,gn,Xt,0);const tr=Fi-Xt,ir=gn-Xt,_n=Fi+Xt,Yi=gn+Xt;if(St=St&&this.isOffscreen(tr,ir,_n,Yi),xt=xt||this.isInsideGrid(tr,ir,_n,Yi),!u&&this.grid.hitTestCircle(Fi,gn,Xt,U)&&(Pt=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Pt,occluded:!1}}}}return{circles:!N&&Pt||!xt?[]:K,offscreen:St,collisionDetected:Pt,occluded:je.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let m=1/0,y=1/0,b=-1/0,w=-1/0;for(const R of n){const N=new s.P(R.x+is,R.y+is);m=Math.min(m,N.x),y=Math.min(y,N.y),b=Math.max(b,N.x),w=Math.max(w,N.y),u.push(N)}const E=this.grid.query(m,y,b,w).concat(this.ignoredGrid.query(m,y,b,w)),I={},L={};for(const R of E){const N=R.key;if(I[N.bucketInstanceId]===void 0&&(I[N.bucketInstanceId]={}),I[N.bucketInstanceId][N.featureIndex])continue;const B=[new s.P(R.x1,R.y1),new s.P(R.x2,R.y1),new s.P(R.x2,R.y2),new s.P(R.x1,R.y2)];s.bX(u,B)&&(I[N.bucketInstanceId][N.featureIndex]=!0,L[N.bucketInstanceId]===void 0&&(L[N.bucketInstanceId]=[]),L[N.bucketInstanceId].push(N.featureIndex))}return L}insertCollisionBox(n,u,m,y,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,u,m,y,b){const w=u?this.ignoredGrid:this.grid,E={bucketInstanceId:m,featureIndex:y,collisionGroupID:b};for(let I=0;I<n.length;I+=4)w.insertCircle(E,n[I],n[I+1],n[I+2])}projectAndGetPerspectiveRatio(n,u,m,y,b,w,E){const I=[u,m,y,1];let L=!1;y||this.transform.pitch>0?(s.aC(I,I,n),this.fogState&&b&&E.name!=="globe"&&(L=(function(B,U,W,G,J,K){const oe=K.calculateFogTileMatrix(J),re=[U,W,G];return s.af(re,re,oe),ri(B,s.ag(re),K.pitch,K._fov)})(this.fogState,u,m,y,b.toUnwrapped(),this.transform)>.9)):bd(I,I,n);const R=I[3];return{point:new s.P((I[0]/R+1)/2*this.transform.width+is,(-I[1]/R+1)/2*this.transform.height+is),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/R*.5,1.5),signedDistanceFromCamera:R,occluded:w&&I[2]>R||L}}isOffscreen(n,u,m,y){return m<is||n>=this.screenRightBoundary||y<is||u>this.screenBottomBoundary}isInsideGrid(n,u,m,y){return m>=0&&n<this.gridRightBoundary&&y>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const n=s.bA([]);return s.br(n,n,[-100,-100,0]),n}}class xn{constructor(n,u,m,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class fn{constructor(n,u,m,y,b,w=!1){this.text=new xn(n?n.text:null,u,m,b),this.icon=new xn(n?n.icon:null,u,y,b),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class No{constructor(n,u,m,y=!1){this.text=n,this.icon=u,this.skipFade=m,this.clipped=y}}class Wc{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Tn{constructor(n,u,m,y,b){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=b}}class wd{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[n]}}function qc(p,n,u,m,y){const{horizontalAlign:b,verticalAlign:w}=s.c1(p),E=-(b-.5)*n,I=-(w-.5)*u,L=s.c2(p,m);return new s.P(E+L[0]*y,I+L[1]*y)}function fc(p,n,u,m,y){const b=new s.P(p,n);return u&&b._rotate(m?y:-y),b}class Co{constructor(n,u,m,y,b,w){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new ni(this.transform,b),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new wd(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(n,u,m,y,b=1){const w=m.getBucket(u),E=m.latestFeatureIndex;if(!w||!E||u.fqid!==w.layerIds[0])return;const I=w.layers[0].layout,L=w.layers[0].paint,R=m.collisionBoxArray,N=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),B=m.tileSize/s.al,U=m.tileID.toUnwrapped();this.transform.setProjection(w.projection);const W=(G=m.tileID,J=w.getProjection(),K=this.transform,J.name===this.projection?K.calculateProjMatrix(G.toUnwrapped()):vd(K,J,G));var G,J,K;const oe=I.get("text-pitch-alignment")==="map",re=I.get("text-rotation-alignment")==="map";u.compileFilter(u.options);const ne=u.dynamicFilter(),be=u.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(m),ve=al(W,m.tileID.canonical,oe,re,this.transform,w.getProjection(),_e);let pe=null;const he=w.getProjection().createInversionMatrix(this.transform,m.tileID.canonical);if(oe){const Te=ts(W,m.tileID.canonical,oe,re,this.transform,w.getProjection(),_e);pe=s.aB([],this.transform.labelPlaneMatrix,Te)}let Se=null;ne&&m.latestFeatureIndex&&(Se={unwrappedTileID:U,dynamicFilter:ne,dynamicFilterNeedsFeature:be}),this.retainedQueryData[w.bucketInstanceId]=new Tn(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,m.tileID);const[ze,Re]=w.layers[0].layout.get("text-size-scale-range"),Ze=s.aA(b,ze,Re),[je,it]=I.get("icon-size-scale-range"),dt=s.aA(b,je,it),Fe={bucket:w,layout:I,paint:L,posMatrix:W,invMatrix:he,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ve,labelToScreenMatrix:pe,clippingData:Se,scale:N,textPixelRatio:B,holdingForFade:m.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:s.bK(w.textSizeData,this.transform.zoom,Ze),partiallyEvaluatedIconSize:s.bK(w.iconSizeData,this.transform.zoom,dt),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(y)for(const Te of w.sortKeyRanges){const{sortKey:Ke,symbolInstanceStart:We,symbolInstanceEnd:pt}=Te;n.push({sortKey:Ke,symbolInstanceStart:We,symbolInstanceEnd:pt,parameters:Fe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J,K,oe,re,ne,be){const{textOffset0:_e,textOffset1:ve,crossTileID:pe}=G,he=[_e,ve],Se=qc(n,w,E,he,I),ze=this.collisionIndex.placeCollisionBox(K,I,u,m,y,b,fc(Se.x,Se.y,L,R,this.transform.angle),W,N,B,U.predicate);if(re){const Re=K.getSymbolInstanceIconSize(be,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,Re,re,m,y,b,fc(Se.x,Se.y,L,R,this.transform.angle),W,N,B,U.predicate).box.length===0)return}if(ze.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[pe]&&this.prevPlacement.placements[pe]&&this.prevPlacement.placements[pe].text&&(Re=this.prevPlacement.variableOffsets[pe].anchor),this.variableOffsets[pe]={textOffset:he,width:w,height:E,anchor:n,textScale:I,prevAnchor:Re},this.markUsedJustification(K,n,G,oe),K.allowVerticalPlacement&&(this.markUsedOrientation(K,oe,G),this.placedOrientations[pe]=oe),{shift:Se,placedGlyphBoxes:ze}}}placeLayerBucketPart(n,u,m,y,b=1){const{bucket:w,layout:E,paint:I,posMatrix:L,textLabelPlaneMatrix:R,labelToScreenMatrix:N,clippingData:B,textPixelRatio:U,mercatorCenter:W,invMatrix:G,holdingForFade:J,collisionBoxArray:K,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:re,collisionGroup:ne,latestFeatureIndex:be}=n.parameters,_e=E.get("text-optional"),ve=E.get("icon-optional"),pe=E.get("text-allow-overlap"),he=E.get("icon-allow-overlap"),Se=E.get("text-rotation-alignment")==="map",ze=E.get("icon-rotation-alignment")==="map",Re=E.get("text-pitch-alignment")==="map",Ze=I.get("symbol-z-offset"),je=E.get("symbol-elevation-reference")==="sea",it=E.get("symbol-placement"),[dt,Fe]=E.get("text-size-scale-range"),[Te,Ke]=E.get("icon-size-scale-range"),We=s.aA(b,dt,Fe),pt=s.aA(b,Te,Ke),vt=E.get("text-variable-anchor"),Pt=Se&&it!=="point",xt=ze&&it!=="point",St=vt&&w.hasTextData(),Xt=w.hasIconTextFit()&&St&&w.hasIconData();this.transform.setProjection(w.projection);const Ht=St||Pt,Rt=xt||Xt;let Gt=pe&&(he||!w.hasIconData()||ve),si=he&&(pe||!w.hasTextData()||_e);const pi=!Ze.isConstant();!w.collisionArrays&&K&&w.deserializeCollisionBoxes(K),m&&y&&w.updateCollisionDebugBuffers(this.transform.zoom,K,We,pt);const Ni=(Ei,ln,Ri)=>{const{crossTileID:En,numVerticalGlyphVertices:wn}=Ei;let Mn=null;if(B&&B.dynamicFilterNeedsFeature||pi){const rr=this.retainedQueryData[w.bucketInstanceId];Mn=be.loadFeature({featureIndex:Ei.featureIndex,bucketIndex:rr.bucketIndex,sourceLayerIndex:rr.sourceLayerIndex,layoutVertexArrayOffset:0});const Ir=Mn.properties?Mn.properties.worldview:null;if(w.localizable&&w.worldview&&typeof Ir=="string")if(Ir==="all")Mn.properties.$localized=!0;else{if(!Ir.split(",").includes(w.worldview))return;Mn.properties.$localized=!0,Mn.properties.worldview=w.worldview}}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:w.worldview},Mn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.P(Ei.tileAnchorX,Ei.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[En]=new No(!1,!1,!1,!0),void u.add(En);const tn=Ze.evaluate(Mn,{});if(u.has(En))return;if(J)return void(this.placements[En]=new No(!1,!1,!1));let Fi=!1,gn=!1,tr=!0,ir=!1,_n=!1,Yi=null,Bi={box:null,offscreen:null,occluded:null},Nn={box:null},hr=null,jn=null,Wn=null,jo=0,as=0,ro=0;Ri.textFeatureIndex?jo=Ri.textFeatureIndex:Ei.useRuntimeCollisionCircles&&(jo=Ei.featureIndex),Ri.verticalTextFeatureIndex&&(as=Ri.verticalTextFeatureIndex);const yn=w.elevationFeatures?w.elevationFeatures[Ei.elevationFeatureIndex]:void 0,bs=rr=>{rr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Ir=this.transform.elevation;rr.elevation=je?tn:tn+s.bV.getAtTileOffset(rr.tileID,new s.P(rr.tileAnchorX,rr.tileAnchorY),Ir,yn),rr.elevation+=Ei.zOffset},Eo=Ri.textBox;if(Eo){bs(Eo);const rr=Gn=>{let Cr=s.bL.horizontal;if(w.allowVerticalPlacement&&!Gn&&this.prevPlacement){const Io=this.prevPlacement.placedOrientations[En];Io&&(this.placedOrientations[En]=Io,Cr=Io,this.markUsedOrientation(w,Cr,Ei))}return Cr},Ir=(Gn,Cr)=>{if(w.allowVerticalPlacement&&wn>0&&Ri.verticalTextBox){for(const Io of w.writingModes)if(Io===s.bL.vertical?(Bi=Cr(),Nn=Bi):Bi=Gn(),Bi&&Bi.box&&Bi.box.length)break}else Bi=Gn()};if(vt){let Gn=vt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[En]){const br=this.prevPlacement.variableOffsets[En];Gn.indexOf(br.anchor)>0&&(Gn=Gn.filter(ws=>ws!==br.anchor),Gn.unshift(br.anchor))}const Cr=(br,ws,Nh)=>{const Fa=w.getSymbolInstanceTextSize(oe,Ei,this.transform.zoom,ln),yu=(br.x2-br.x1)*Fa+2*br.padding,vu=(br.y2-br.y1)*Fa+2*br.padding,Ss=Ei.hasIconTextFit&&!he?ws:null;Ss&&bs(Ss);let Ba={box:[],offscreen:!1,occluded:!1};const Na=pe?2*Gn.length:Gn.length;for(let Ns=0;Ns<Na;++Ns){const pl=this.attemptAnchorPlacement(Gn[Ns%Gn.length],br,W,G,Ht,yu,vu,Fa,Se,Re,U,L,ne,Ns>=Gn.length,Ei,ln,w,Nh,Ss,oe,re);if(pl&&(Ba=pl.placedGlyphBoxes,Ba&&Ba.box&&Ba.box.length)){Fi=!0,Yi=pl.shift;break}}return Ba};Ir(()=>Cr(Eo,Ri.iconBox,s.bL.horizontal),()=>{const br=Ri.verticalTextBox;return br&&bs(br),w.allowVerticalPlacement&&!(Bi&&Bi.box&&Bi.box.length)&&wn>0&&br?Cr(br,Ri.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),Bi&&(Fi=Bi.box,tr=Bi.offscreen,ir=Bi.occluded);const Io=rr(!(!Bi||!Bi.box));if(!Fi&&this.prevPlacement){const br=this.prevPlacement.variableOffsets[En];br&&(this.variableOffsets[En]=br,this.markUsedJustification(w,br.anchor,Ei,Io))}}else{const Gn=(Cr,Io)=>{const br=w.getSymbolInstanceTextSize(oe,Ei,this.transform.zoom,ln),ws=this.collisionIndex.placeCollisionBox(w,br,Cr,W,G,Ht,new s.P(0,0),pe,U,L,ne.predicate);return ws&&ws.box&&ws.box.length&&(this.markUsedOrientation(w,Io,Ei),this.placedOrientations[En]=Io),ws};Ir(()=>Gn(Eo,s.bL.horizontal),()=>{const Cr=Ri.verticalTextBox;return w.allowVerticalPlacement&&wn>0&&Cr?(bs(Cr),Gn(Cr,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),rr(!!(Bi&&Bi.box&&Bi.box.length))}}if(hr=Bi,Fi=hr&&hr.box&&hr.box.length>0,tr=hr&&hr.offscreen,ir=hr&&hr.occluded,Ei.useRuntimeCollisionCircles){const rr=Ei.centerJustifiedTextSymbolIndex>=0?Ei.centerJustifiedTextSymbolIndex:Ei.verticalPlacedTextSymbolIndex,Ir=w.text.placedSymbolArray.get(rr),Gn=s.bM(w.textSizeData,oe,Ir),Cr=E.get("text-padding");jn=this.collisionIndex.placeCollisionCircles(w,pe,Ir,rr,w.lineVertexArray,w.glyphOffsetArray,Gn,L,R,N,m,Re,ne.predicate,Ei.collisionCircleDiameter*Gn/s.bY,Cr,this.retainedQueryData[w.bucketInstanceId].tileID),Fi=pe||jn.circles.length>0&&!jn.collisionDetected,tr=tr&&jn.offscreen,ir=jn.occluded}if(Ri.iconFeatureIndex&&(ro=Ri.iconFeatureIndex),Ri.iconBox){const rr=Ir=>{bs(Ir);const Gn=Ei.hasIconTextFit&&Yi?fc(Yi.x,Yi.y,Se,Re,this.transform.angle):new s.P(0,0),Cr=w.getSymbolInstanceIconSize(re,this.transform.zoom,Ei.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Cr,Ir,W,G,Rt,Gn,he,U,L,ne.predicate)};Nn&&Nn.box&&Nn.box.length&&Ri.verticalIconBox?(Wn=rr(Ri.verticalIconBox),gn=Wn.box.length>0):(Wn=rr(Ri.iconBox),gn=Wn.box.length>0),tr=tr&&Wn.offscreen,_n=Wn.occluded}const Go=_e||Ei.numHorizontalGlyphVertices===0&&wn===0,oa=ve||Ei.numIconVertices===0;if(Go||oa?oa?Go||(gn=gn&&Fi):Fi=gn&&Fi:gn=Fi=gn&&Fi,Fi&&hr&&hr.box&&this.collisionIndex.insertCollisionBox(hr.box,E.get("text-ignore-placement"),w.bucketInstanceId,Nn&&Nn.box&&as?as:jo,ne.ID),gn&&Wn&&this.collisionIndex.insertCollisionBox(Wn.box,E.get("icon-ignore-placement"),w.bucketInstanceId,ro,ne.ID),jn&&(Fi&&this.collisionIndex.insertCollisionCircles(jn.circles,E.get("text-ignore-placement"),w.bucketInstanceId,jo,ne.ID),m)){const rr=w.bucketInstanceId;let Ir=this.collisionCircleArrays[rr];Ir===void 0&&(Ir=this.collisionCircleArrays[rr]=new Wc);for(let Gn=0;Gn<jn.circles.length;Gn+=4)Ir.circles.push(jn.circles[Gn+0]),Ir.circles.push(jn.circles[Gn+1]),Ir.circles.push(jn.circles[Gn+2]),Ir.circles.push(jn.collisionDetected?1:0)}const Ho=w.projection.name!=="globe";Gt=Gt&&(Ho||!ir),si=si&&(Ho||!_n),this.placements[En]=new No(Fi||Gt,gn||si,tr||w.justReloaded),u.add(En)},en=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,en),w.elevationType==="road"&&w.updateRoadElevation(en.canonical),w.updateZOffset(),w.sortFeaturesByY){const Ei=w.getSortedSymbolIndexes(this.transform.angle);for(let ln=Ei.length-1;ln>=0;--ln){const Ri=Ei[ln];Ni(w.symbolInstances.get(Ri),Ri,w.collisionArrays[Ri])}w.hasAnyZOffset&&s.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Ei=w.getSortedIndexesByZOffset();for(let ln=0;ln<Ei.length;++ln){const Ri=Ei[ln];Ni(w.symbolInstances.get(Ri),Ri,w.collisionArrays[Ri])}}else for(let Ei=n.symbolInstanceStart;Ei<n.symbolInstanceEnd;Ei++)Ni(w.symbolInstances.get(Ei),Ei,w.collisionArrays[Ei]);if(m&&w.bucketInstanceId in this.collisionCircleArrays){const Ei=this.collisionCircleArrays[w.bucketInstanceId];s.bl(Ei.invProjMatrix,L),Ei.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(n,u,m,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:I,crossTileID:L}=m,R=s.c3(u),N=y===s.bL.vertical?I:R==="left"?b:R==="center"?w:R==="right"?E:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=N>=0&&b!==N?0:L),w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=N>=0&&w!==N?0:L),E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=N>=0&&E!==N?0:L),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=N>=0&&I!==N?0:L)}markUsedOrientation(n,u,m){const y=u===s.bL.horizontal||u===s.bL.horizontalOnly?u:0,b=u===s.bL.vertical?u:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:L}=m,R=n.text.placedSymbolArray;w>=0&&(R.get(w).placedOrientation=y),E>=0&&(R.get(E).placedOrientation=y),I>=0&&(R.get(I).placedOrientation=y),L>=0&&(R.get(L).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const y=u?u.symbolFadeChange(n):1,b=u?u.opacities:{},w=u?u.variableOffsets:{},E=u?u.placedOrientations:{};for(const I in this.placements){const L=this.placements[I],R=b[I];R?(this.opacities[I]=new fn(R,y,L.text,L.icon,null,L.clipped),m=m||L.text!==R.text.placed||L.icon!==R.icon.placed):(this.opacities[I]=new fn(null,y,L.text,L.icon,L.skipFade,L.clipped),m=m||L.text||L.icon)}for(const I in b){const L=b[I];if(!this.opacities[I]){const R=new fn(L,y,!1,!1);R.isHidden()||(this.opacities[I]=R,m=m||L.text.placed||L.icon.placed)}}for(const I in w)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=w[I]);for(const I in E)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=E[I]);m?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)}updateLayerOpacities(n,u,m,y){y&&(this.lastReplacementSourceUpdateTime=y.updateTime);const b=new Set;for(const w of u){const E=w.getBucket(n);E&&w.latestFeatureIndex&&n.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,b,w,w.collisionBoxArray,m,y,w.tileID,n.scope),E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,w.tileID),E.elevationType==="road"&&E.updateRoadElevation(w.tileID.canonical),E.updateZOffset())}}updateBucketOpacities(n,u,m,y,b,w,E,I){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const L=n.layers[0].layout,R=n.layers[0].paint,N=!!n.layers[0].dynamicFilter(),B=new fn(null,0,!1,!1,!0),U=L.get("text-allow-overlap"),W=L.get("icon-allow-overlap"),G=L.get("text-variable-anchor"),J=L.get("text-rotation-alignment")==="map",K=L.get("text-pitch-alignment")==="map",oe=R.get("symbol-z-offset"),re=L.get("symbol-elevation-reference")==="sea",ne=!oe.isConstant(),be=new fn(null,0,U&&(W||!n.hasIconData()||L.get("icon-optional")),W&&(U||!n.hasTextData()||L.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const _e=(pe,he,Se)=>{for(let ze=0;ze<he/4;ze++)pe.opacityVertexArray.emplaceBack(Se)};let ve=0;w&&n.updateReplacement(E,w);for(let pe=0;pe<n.symbolInstances.length;pe++){const he=n.symbolInstances.get(pe),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:ze,crossTileID:Re,numIconVertices:Ze,tileAnchorX:je,tileAnchorY:it}=he;let dt=null;const Fe=this.retainedQueryData[n.bucketInstanceId];ne&&he&&Fe&&(dt=m.latestFeatureIndex.loadFeature({featureIndex:he.featureIndex,bucketIndex:Fe.bucketIndex,sourceLayerIndex:Fe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Te=oe.evaluate(dt,{}),Ke=u.has(Re);let We=this.opacities[Re];Ke?We=B:We||(We=be,this.opacities[Re]=We),u.add(Re);const pt=Se>0||ze>0,vt=Ze>0,Pt=this.placedOrientations[Re],xt=Pt===s.bL.vertical,St=Pt===s.bL.horizontal||Pt===s.bL.horizontalOnly;!pt&&!vt||We.isHidden()||ve++;let Xt=!1;if((pt||vt)&&w)for(const Ht of n.activeReplacements){if(s.bZ(Ht,b,s.b_.Symbol,I)||Ht.min.x>je||je>Ht.max.x||Ht.min.y>it||it>Ht.max.y)continue;const Rt=s.b$(je,it,E.canonical,Ht.footprintTileId.canonical);if(Xt=s.c0(Rt,Ht.footprint),Xt)break}if(pt){const Ht=Xt?ns:Lo(We.text);_e(n.text,Se,xt?ns:Ht),_e(n.text,ze,St?ns:Ht);const Rt=We.text.isHidden(),{leftJustifiedTextSymbolIndex:Gt,centerJustifiedTextSymbolIndex:si,rightJustifiedTextSymbolIndex:pi,verticalPlacedTextSymbolIndex:Ni}=he,en=n.text.placedSymbolArray,Ei=Rt||xt?1:0;Gt>=0&&(en.get(Gt).hidden=Ei),si>=0&&(en.get(si).hidden=Ei),pi>=0&&(en.get(pi).hidden=Ei),Ni>=0&&(en.get(Ni).hidden=Rt||St?1:0);const ln=this.variableOffsets[Re];ln&&this.markUsedJustification(n,ln.anchor,he,Pt);const Ri=this.placedOrientations[Re];Ri&&(this.markUsedJustification(n,"left",he,Ri),this.markUsedOrientation(n,Ri,he))}if(vt){const Ht=Xt?ns:Lo(We.icon),{placedIconSymbolIndex:Rt,verticalPlacedIconSymbolIndex:Gt}=he,si=n.icon.placedSymbolArray,pi=We.icon.isHidden()?1:0;Rt>=0&&(_e(n.icon,Ze,xt?ns:Ht),si.get(Rt).hidden=pi),Gt>=0&&(_e(n.icon,he.numVerticalIconVertices,St?ns:Ht),si.get(Gt).hidden=pi)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Ht=n.collisionArrays[pe];if(Ht){let Rt=new s.P(0,0),Gt=!0;if(Ht.textBox||Ht.verticalTextBox){if(G){const pi=this.variableOffsets[Re];pi?(Rt=qc(pi.anchor,pi.width,pi.height,pi.textOffset,pi.textScale),J&&Rt._rotate(K?this.transform.angle:-this.transform.angle)):Gt=!1}N&&(Gt=!We.clipped),Ht.textBox&&Ar(n.textCollisionBox.collisionVertexArray,We.text.placed,!Gt||xt,Te,re,Rt.x,Rt.y),Ht.verticalTextBox&&Ar(n.textCollisionBox.collisionVertexArray,We.text.placed,!Gt||St,Te,re,Rt.x,Rt.y)}const si=Gt&&!!(!St&&Ht.verticalIconBox);Ht.iconBox&&Ar(n.iconCollisionBox.collisionVertexArray,We.icon.placed,si,Te,re,he.hasIconTextFit?Rt.x:0,he.hasIconTextFit?Rt.y:0),Ht.verticalIconBox&&Ar(n.iconCollisionBox.collisionVertexArray,We.icon.placed,!si,Te,re,he.hasIconTextFit?Rt.x:0,he.hasIconTextFit?Rt.y:0)}}}if(n.fullyClipped=ve===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=pe.invProjMatrix,n.placementViewportMatrix=pe.viewportMatrix,n.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>n}isStale(){return this.stale}setStale(){this.stale=!0}}function Ar(p,n,u,m,y,b,w){p.emplaceBack(n?1:0,u?1:0,b||0,w||0,m,y?1:0),p.emplaceBack(n?1:0,u?1:0,b||0,w||0,m,y?1:0),p.emplaceBack(n?1:0,u?1:0,b||0,w||0,m,y?1:0),p.emplaceBack(n?1:0,u?1:0,b||0,w||0,m,y?1:0)}const fw=Math.pow(2,25),sh=Math.pow(2,24),jp=Math.pow(2,17),ah=Math.pow(2,16),Sd=Math.pow(2,9),Gp=Math.pow(2,8),Td=Math.pow(2,1);function Lo(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const n=p.placed?1:0,u=Math.floor(127*p.opacity);return u*fw+n*sh+u*jp+n*ah+u*Sd+n*Gp+u*Td+n}const ns=0;class rs{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,u,m,y,b,w){const E=this._bucketParts;for(;this._currentTileIndex<n.length;)if(u.getBucketParts(E,y,n[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,L)=>I.sortKey-L.sortKey));this._currentPartIndex<E.length;){const I=E[this._currentPartIndex];if(u.placeLayerBucketPart(I,this._seenCrossTileIDs,m,I.symbolInstanceStart===0,w),this._currentPartIndex++,b())return!0}return!1}}class Hp{startNewPlacement(n,u,m,y,b,w,E,I){return this.placement=new Co(n,y,b,w,E,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=m,this._fadeDuration=y,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(n,u,m,y,b){const w=s.o.now(),E=()=>{const I=s.o.now()-w;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&I>2};for(;this._currentPlacementIndex>=0;){const I=u[n[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&I.visibility!=="none"&&(!I.minzoom||I.minzoom<=L)&&(!I.maxzoom||I.maxzoom>L)){const R=I,N=R.layout.get("symbol-z-elevate"),B=R.layout.get("symbol-sort-key").constantOr(1)!==void 0,U=R.layout.get("symbol-z-order"),W=U==="viewport-y"||U==="auto"&&!(U!=="viewport-y"&&B),G=R.layout.get("text-allow-overlap")||R.layout.get("icon-allow-overlap")||R.layout.get("text-ignore-placement")||R.layout.get("icon-ignore-placement"),J=W&&G,K=this._inProgressLayer=this._inProgressLayer||new rs(R),oe=s.B(I.source,I.scope);if(K.continuePlacement(N||J?y[oe]:m[oe],this.placement,this._showCollisionBoxes,I,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Cl=512/s.al/2;class Yr{constructor(n,u,m){this.tileID=n,this.bucketInstanceId=m,this.index=new s.c4(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=n.canonical.x*s.al,b=n.canonical.y*s.al;for(let w=0;w<u.length;w++){const{key:E,crossTileID:I,tileAnchorX:L,tileAnchorY:R}=u.get(w),N=Math.floor((y+L)*Cl),B=Math.floor((b+R)*Cl);this.index.add(N,B),this.keys.push(E),this.crossTileIDs.push(I)}this.index.finish()}findMatches(n,u,m){const y=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),b=Cl/Math.pow(2,u.canonical.z-this.tileID.canonical.z),w=u.canonical.x*s.al,E=u.canonical.y*s.al;for(let I=0;I<n.length;I++){const L=n.get(I);if(L.crossTileID)continue;const{key:R,tileAnchorX:N,tileAnchorY:B}=L,U=Math.floor((w+N)*b),W=Math.floor((E+B)*b),G=this.index.range(U-y,W-y,U+y,W+y).sort((J,K)=>J-K);for(const J of G){const K=this.crossTileIDs[J];if(this.keys[J]===R&&!m.has(K)){m.add(K),L.crossTileID=K;break}}}}}class Pa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ll{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const u=Math.round((n-this.lng)/360);if(u!==0)for(const m in this.indexes){const y=this.indexes[m],b={};for(const w in y){const E=y[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+u),b[E.tileID.key]=E}this.indexes[m]=b}this.lng=n}addBucket(n,u,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const y=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const w=this.indexes[b];if(Number(b)>n.overscaledZ)for(const E in w){const I=w[E];I.tileID.isChildOf(n)&&I.findMatches(u.symbolInstances,n,y)}else{const E=w[n.scaledTo(Number(b)).key];E&&E.findMatches(u.symbolInstances,n,y)}}for(let b=0;b<u.symbolInstances.length;b++){const w=u.symbolInstances.get(b);w.crossTileID||(w.crossTileID=m.generate(),y.add(w.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Yr(n,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(n,u){for(const m of u.crossTileIDs)this.usedCrossTileIDs[n].delete(m)}removeStaleBuckets(n){let u=!1;for(const m in this.indexes){const y=this.indexes[m];for(const b in y)n[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[b]),delete y[b],u=!0)}return u}}class Gr{constructor(){this.layerIndexes={},this.crossTileIDs=new Pa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,u,m,y){let b=this.layerIndexes[n.fqid];b===void 0&&(b=this.layerIndexes[n.fqid]=new ll);let w=!1;const E={};y.name!=="globe"&&b.handleWrapJump(m);for(const I of u){const L=I.getBucket(n);L&&n.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(I.tileID,L,this.crossTileIDs)&&(w=!0),E[L.bucketInstanceId]=!0)}return b.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(n){const u={};n.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}const Ll=771;class Mi{constructor(n,u,m,y){this.blendFunction=n,this.blendColor=u.toNonPremultipliedRenderColor(null),this.mask=m,this.blendEquation=y}}Mi.Replace=[1,0,1,0],Mi.disabled=new Mi(Mi.Replace,s.ao.transparent,[!1,!1,!1,!1]),Mi.unblended=new Mi(Mi.Replace,s.ao.transparent,[!0,!0,!0,!0]),Mi.alphaBlended=new Mi([1,Ll,1,Ll],s.ao.transparent,[!0,!0,!0,!0]),Mi.alphaBlendedNonPremultiplied=new Mi([770,Ll,770,Ll],s.ao.transparent,[!0,!0,!0,!0]),Mi.multiply=new Mi([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),Mi.additive=new Mi([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class Qt{constructor(n,u,m){this.func=n,this.mask=u,this.range=m}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const Xc=7680;class xi{constructor(n,u,m,y,b,w){this.test=n,this.ref=u,this.mask=m,this.fail=y,this.depthFail=b,this.pass=w}}xi.disabled=new xi({func:519,mask:0},0,0,Xc,Xc,Xc);const Ed=1029,lh=2305;class fi{constructor(n,u,m){this.enable=n,this.mode=u,this.frontFace=m}}function Zp(p,n){const u=s.ca(p,3);s.cc(p,n),s.cg(p,3,u)}function Wp(p,n){const u=s.c7([]);return s.c8(u,u,-n),s.c9(u,u,-p),u}function za(p,n){const u=[p[0],p[1],0],m=[n[0],n[1],0];if(s.ag(u)>=1e-15){const w=s.aw([],u);s.c5(m,w,s.bJ(m,w)),n[0]=m[0],n[1]=m[1]}const y=s.bI([],n,p);if(s.c6(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return Wp(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}fi.disabled=new fi(!1,Ed,lh),fi.backCCW=new fi(!0,Ed,lh),fi.backCW=new fi(!0,Ed,2304),fi.frontCW=new fi(!0,1028,2304),fi.frontCCW=new fi(!0,1028,lh);class Ay{constructor(n,u){this.position=n,this.orientation=u}get position(){return this._position}set position(n){if(n){const u=n instanceof s.ae?n:new s.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(u.x=s.bT(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(n,u,m){if(this.orientation=null,!this.position)return;const y=this.position,b=m||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(n)):0),w=s.ae.fromLngLat(n,b),E=[w.x-y.x,w.y-y.y,w.z-y.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=za(E,u)}setPitchBearing(n,u){this.orientation=Wp(s.an(n),s.an(-u))}}class Jc{constructor(n,u){this._transform=s.bA([]),this.orientation=u,this.position=n}get mercatorPosition(){const n=this.position;return new s.ae(n[0],n[1],n[2])}get position(){const n=s.ca(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var u;n&&s.cg(this._transform,3,[(u=n)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.c7([]),n&&Zp(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,u){this._orientation=Wp(n,u),Zp(this._transform,this._orientation)}forward(){const n=s.ca(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.ca(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.ca(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,u){const m=new Float64Array(16);return s.bl(m,this.getWorldToCamera(n,u)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,u,m){const y=this.position;s.c5(y,y,-n);const b=new Float64Array(16);return s.bq(b,[m,m,m]),s.br(b,b,y),b[10]*=u,b}getWorldToCamera(n,u){const m=new Float64Array(16),y=new Float64Array(4),b=this.position;return s.cb(y,this._orientation),s.c5(b,b,-n),s.cc(m,y),s.br(m,m,b),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=u,m[9]*=u,m[10]*=u,m[11]*=u,m}getCameraToClipPerspective(n,u,m,y){const b=new Float64Array(16);return s.cd(b,n,u,m,y),b}getCameraToClipOrthographic(n,u,m,y,b,w){const E=new Float64Array(16);return s.ce(E,n,u,m,y,b,w),E}getDistanceToElevation(n,u=!1){const m=n===0?0:s.cf(n,u?s.a$(this.position[1]):this.position[1]),y=this.forward();return(m-this.position[2])/y[2]}clone(){return new Jc([...this.position],[...this.orientation])}}const os=(p,n)=>({u_matrix:p,u_ground_shadow_factor:n});class qp{constructor(n=0,u=0,m=0,y=0){if(isNaN(n)||n<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=m,this.right=y}interpolate(n,u,m){return u.top!=null&&n.top!=null&&(this.top=s.ak(n.top,u.top,m)),u.bottom!=null&&n.bottom!=null&&(this.bottom=s.ak(n.bottom,u.bottom,m)),u.left!=null&&n.left!=null&&(this.left=s.ak(n.left,u.left,m)),u.right!=null&&n.right!=null&&(this.right=s.ak(n.right,u.right,m)),this}getCenter(n,u){const m=s.aA((this.left+n-this.right)/2,0,n),y=s.aA((this.top+u-this.bottom)/2,0,u);return new s.P(m,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new qp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ca=15;class Id{constructor(n,u,m,y,b,w,E){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=m??0,this._maxPitch=y??60,this.setProjection(w),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new s.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Jc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new Id(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ca}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,u=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(n||m)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=s.cm(this.projectionOptions);const m=this.getProjection(),y=!s.by(u,m);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cm({name:"mercator"});const u=n!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const u=-n*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=s.cn(),s.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const u=s.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,b=0;for(let w=0;w<u.length;w++){const E=new s.P(u[w][0]*this.width,m+u[w][1]*(this.height-m)),I=n.pointCoordinate(E);if(!I)continue;const L=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);y+=I[3]*L,b+=L}return b===0?NaN:y/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*u,y=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),w=Math.max(y-m,b);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}equals(n){const u=this.elevation,m=n.elevation,y=u!=null!=(m!=null)||u&&m&&u.exaggeration()!==m.exaggeration();return this.width===n.width&&this.height===n.height&&this.center.lng===n.center.lng&&this.center.lat===n.center.lat&&this.zoom===n.zoom&&this.bearing===n.bearing&&this.pitch===n.pitch&&this.fov===n.fov&&this.projection.name===n.projection.name&&this._edgeInsets.equals(n.padding)&&!y}computeZoomRelativeTo(n){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let m;m=n.z<this._camera.position[2]?[u.x,u.y,u.z]:[n.x,n.y,n.z];const y=s.ag(s.av([],this._camera.position,m));return s.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let u=!1;if(n.orientation&&!s.cp(n.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(n.orientation)),n.position){const m=[n.position.x,n.position.y,n.position.z];s.cq(m,this._camera.position)||(this._setCameraPosition(m),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,u=new Ay;return u.position=new s.ae(n[0],n[1],n[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(n){if(!s.cr(n))return!1;s.cs(n,n);const u=s.ct([],[0,0,-1],n),m=s.ct([],[0,-1,0],n);if(m[2]<0)return!1;const y=za(u,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const u=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=s.aA(n[2],y/m,y/u),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,u,m){this._unmodified=!1,this._edgeInsets.interpolate(n,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(n){const u=[new s.cu(0,n)];if(this.renderWorldCopies){const m=this.pointCoordinate(new s.P(0,0)),y=this.pointCoordinate(new s.P(this.width,0)),b=this.pointCoordinate(new s.P(this.width,this.height)),w=this.pointCoordinate(new s.P(0,this.height)),E=Math.floor(Math.min(m.x,y.x,b.x,w.x)),I=Math.floor(Math.max(m.x,y.x,b.x,w.x)),L=1;for(let R=E-L;R<=I+L;R++)R!==0&&u.push(new s.cu(R,n))}return u}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,u,m,y){let b=[];const w=m!=null,E=!w;if(E&&this.zoom<u||w&&m[0]===0&&m[1]===0)return b;const I=new Set,L=(N,B,U,W,G)=>{const J=s.cY(B,N,U,W,G);I.has(J)||(b.push(new s.aQ(N,B,U,W,G)),I.add(J))};for(let N=0;N<n.length;N++){const B=n[N];if(E&&B.canonical.z!==u||w&&y!==void 0&&y>B.canonical.z)continue;const U=B.canonical,W=B.overscaledZ,G=B.wrap,J=1<<U.z,K=U.x+1<J,oe=U.x>0,re=U.y+1<J,ne=U.y>0,be=B.wrap-(oe?0:1),_e=B.wrap+(K?0:1),ve=oe?U.x-1:J-1,pe=K?U.x+1:0;if(w)m[0]<0?(L(W,_e,U.z,pe,U.y),m[1]<0&&re&&(L(W,G,U.z,U.x,U.y+1),L(W,_e,U.z,pe,U.y+1)),m[1]>0&&ne&&(L(W,G,U.z,U.x,U.y-1),L(W,_e,U.z,pe,U.y-1))):m[0]>0?(L(W,be,U.z,ve,U.y),m[1]<0&&re&&(L(W,G,U.z,U.x,U.y+1),L(W,be,U.z,ve,U.y+1)),m[1]>0&&ne&&(L(W,G,U.z,U.x,U.y-1),L(W,be,U.z,ve,U.y-1))):m[1]<0&&re?L(W,G,U.z,U.x,U.y+1):ne&&L(W,G,U.z,U.x,U.y-1);else{const he=B.visibleQuadrants;1&he&&(L(W,be,U.z,ve,U.y),ne&&(L(W,G,U.z,U.x,U.y-1),L(W,be,U.z,ve,U.y-1))),2&he&&(L(W,_e,U.z,pe,U.y),ne&&(L(W,G,U.z,U.x,U.y-1),L(W,_e,U.z,pe,U.y-1))),4&he&&(L(W,be,U.z,ve,U.y),re&&(L(W,G,U.z,U.x,U.y+1),L(W,be,U.z,ve,U.y+1))),8&he&&(L(W,_e,U.z,pe,U.y),re&&(L(W,G,U.z,U.x,U.y+1),L(W,_e,U.z,pe,U.y+1)))}}const R=[];for(const N of b)b.some(B=>N.isChildOf(B))||R.push(N);if(b=R.filter(N=>!n.some(B=>!!(N.overscaledZ<u&&B.isChildOf(N))||N.equals(B)||N.isChildOf(B))),E){const N=1<<u,B=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[N*B.x,N*B.y],W=4,G=W*W;b=b.filter(J=>{const K=J.canonical.x+.5-U[0],oe=J.canonical.y+.5-U[1];return K*K+oe*oe<G})}return b}extendTileCoverToNearPlane(n,u,m){const y=[],b=new Set;for(const oe of n)b.add(oe.key);const w=(oe,re,ne,be,_e)=>{const ve=s.cY(re,oe,ne,be,_e);b.has(ve)||(y.push(new s.aQ(oe,re,ne,be,_e)),b.add(ve))},E=n.reduce((oe,re)=>Math.max(oe,re.overscaledZ),m),I=1<<m,L=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],R=new s.P(0,0),N=new s.P(0,0),B=(oe,re)=>{const ne=Math.floor(oe[0]),be=Math.floor(oe[1]),_e=(oe[0]-ne)*s.al,ve=(oe[1]-be)*s.al,pe=Math.floor(re[0]),he=Math.floor(re[1]),Se=(re[0]-pe)*s.al,ze=(re[1]-he)*s.al;for(let Re=-1;Re<=1;Re++){const Ze=ne+Re;if(!(Ze<0||Ze>=I)){R.x=_e-Re*s.al,N.x=Se-(Ze-pe)*s.al;for(let je=-1;je<=1;je++){const it=be+je;R.y=ve-je*s.al,N.y=ze-(it-he)*s.al,s.cZ(R,N,L)&&w(E,0,m,Ze,it)}}}},U=u.points,W=U[s.cv],G=U[s.cw],J=this._projectToGround(W,U[s.cx]),K=this._projectToGround(G,U[s.cy]);return B(W,J),B(G,K),y}_projectToGround(n,u){return s.cz(s.cA(),n,u,n[2]/(n[2]-u[2]))}coveringTiles(n){let u=this.coveringZoomLevel(n);const m=u,y=this.elevation&&this.elevation.exaggeration(),b=y&&!n.isTerrainDEM,w=this.projection.name==="mercator";if(n.minzoom!==void 0&&u<n.minzoom)return[];n.maxzoom!==void 0&&u>n.maxzoom&&(u=n.maxzoom);const E=this.locationCoordinate(this.center),I=this.center.lat,L=1<<u,R=[L*E.x,L*E.y,0],N=this.projection.name==="globe",B=!N,U=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,B),W=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=L*s.cf(1,this.center.lat),J=this._camera.position[2]/s.cf(1,this.center.lat),K=[L*W.x,L*W.y,J*(B?1:G)],oe=N||y,re=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ne=this.isLODDisabled(!0)?u:0;let be;if(this._elevation&&n.isTerrainDEM)be=1e4*this._elevation.exaggeration();else if(this._elevation){const Te=this._elevation.getMinMaxForVisibleTiles();be=Te?Te.max:this._centerAltitude}else be=this._centerAltitude;const _e=n.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?s.cC(this):1,pe=Te=>{const We=new s.ae(Te.x+25e-6,Te.y,Te.z),pt=new s.ae(Te.x,Te.y+25e-6,Te.z),vt=Te.toLngLat(),Pt=We.toLngLat(),xt=pt.toLngLat(),St=this.locationCoordinate(vt),Xt=this.locationCoordinate(Pt),Ht=this.locationCoordinate(xt),Rt=Math.hypot(Xt.x-St.x,Xt.y-St.y),Gt=Math.hypot(Ht.x-St.x,Ht.y-St.y);return Math.sqrt(Rt*Gt)*ve/25e-6},he=Te=>{const Ke=be,We=_e;return{aabb:s.cF(this,L,0,0,0,Te,We,Ke,this.projection),zoom:0,x:0,y:0,minZ:We,maxZ:Ke,wrap:Te,fullyVisible:!1}},Se=[];let ze=[];const Re=u,Ze=n.reparseOverscaled?m:u,je=(J-this._centerAltitude)*G,it=Te=>{if(!this._elevation||!Te.tileID||!w)return;const Ke=this._elevation.getMinMaxForTile(Te.tileID),We=Te.aabb;Ke?(We.min[2]=Ke.min,We.max[2]=Ke.max,We.center[2]=(We.min[2]+We.max[2])/2):(Te.shouldSplit=Fe(Te),Te.shouldSplit||(We.min[2]=We.max[2]=We.center[2]=this._centerAltitude))},dt=(Te,Ke)=>{if(.707*Ke<Te)return 1;const We=Ke/Te;return We/(1.4144271570014144+(Math.pow(1.1,We-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=Te=>{if(Te.zoom<ne)return!0;if(Te.zoom===Re)return!1;if(Te.shouldSplit!=null)return Te.shouldSplit;const Ke=Te.aabb.distanceX(K),We=Te.aabb.distanceY(K);let pt=je,vt=1;if(N){pt=Te.aabb.distanceZ(K);const Gt=Math.pow(2,Te.zoom),si=s.a$((Te.y+1)/Gt),pi=s.a$(Te.y/Gt),Ni=Math.min(Math.max(I,si),pi),en=s.d1(Ni)/s.d1(I);if(vt=Ni===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,en/this._mercatorScaleRatio),this.zoom<=s.c_&&Te.zoom===Re-1&&en>=.9)return!0}else if(b&&(pt=Te.aabb.distanceZ(K)*G),this.projection.isReprojectedInTileSpace&&m<=5){const Gt=Math.pow(2,Te.zoom),si=pe(new s.ae((Te.x+.5)/Gt,(Te.y+.5)/Gt));vt=si>.85?1:si}if(!w&&!N){const Gt=Math.sqrt(Ke*Ke+We*We+pt*pt);let si=(1<<Re-Te.zoom)*re*vt;return si*=dt(Math.max(pt,je),Gt),Gt<si}let Pt=Number.MAX_VALUE,xt=0;const St=Te.aabb.getCorners(),Xt=[];for(const Gt of St){s.av(Xt,Gt,K),N||(b?Xt[2]*=G:Xt[2]=je);const si=s.bJ(Xt,this._camera.forward());si<Pt&&(Pt=si,xt=Math.abs(Xt[2]))}let Ht=(1<<Re-Te.zoom)*re*vt;if(Ht*=dt(Math.max(xt,je),Pt),Pt<Ht)return!0;const Rt=Te.aabb.closestPoint(R);return Rt[0]===R[0]&&Rt[1]===R[1]};if(this.renderWorldCopies)for(let Te=1;Te<=3;Te++)Se.push(he(-Te)),Se.push(he(Te));for(Se.push(he(0));Se.length>0;){const Te=Se.pop(),Ke=Te.x,We=Te.y;let pt=Te.fullyVisible;const vt=()=>this.projection.name==="globe"&&(Te.y===0||Te.y===(1<<Te.zoom)-1);if(!pt){let Pt=oe?Te.aabb.intersects(U):Te.aabb.intersectsFlat(U);if(Pt===0&&vt()){const xt=new s.cD(Te.zoom,Ke,We);Pt=s.cE(this,L,xt,!0).intersects(U)}if(Pt===0)continue;pt=Pt===2}if(Te.zoom===Re||!Fe(Te)){const Pt=Te.zoom===Re?Ze:Te.zoom;if(n.minzoom&&n.minzoom>Pt)continue;let xt=0;if(!pt){let Rt=oe?Te.aabb.intersectsPrecise(U):Te.aabb.intersectsPreciseFlat(U);if(Rt===0&&vt()){const Gt=new s.cD(Te.zoom,Ke,We);Rt=s.cE(this,L,Gt,!0).intersectsPrecise(U)}if(Rt===0)continue;if(n.calculateQuadrantVisibility)if(U.containsPoint(Te.aabb.center))xt=15;else for(let Gt=0;Gt<4;Gt++)Te.aabb.quadrant(Gt).intersects(U)!==0&&(xt|=1<<Gt)}const St=R[0]-(.5+Ke+(Te.wrap<<Te.zoom))*(1<<u-Te.zoom),Xt=R[1]-.5-We,Ht=Te.tileID?Te.tileID:new s.aQ(Pt,Te.wrap,Te.zoom,Ke,We);n.calculateQuadrantVisibility&&(Ht.visibleQuadrants=xt),ze.push({tileID:Ht,distanceSq:St*St+Xt*Xt});continue}for(let Pt=0;Pt<4;Pt++){const xt=(Ke<<1)+Pt%2,St=(We<<1)+(Pt>>1),Xt={aabb:w?Te.aabb.quadrant(Pt):s.cF(this,L,Te.zoom+1,xt,St,Te.wrap,Te.minZ,Te.maxZ,this.projection),zoom:Te.zoom+1,x:xt,y:St,wrap:Te.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:Te.minZ,maxZ:Te.maxZ};b&&!N&&(Xt.tileID=new s.aQ(Te.zoom+1===Re?Ze:Te.zoom+1,Te.wrap,Te.zoom+1,xt,St),it(Xt)),Se.push(Xt)}}if(this.fogCullDistSq){const Te=this.fogCullDistSq,Ke=this.horizonLineFromTop();ze=ze.filter(We=>{const pt=[0,0,0,1],vt=[s.al,s.al,0,1],Pt=this.calculateFogTileMatrix(We.tileID.toUnwrapped());s.aC(pt,pt,Pt),s.aC(vt,vt,Pt);const xt=s.cG([],pt,vt),St=s.cH([],pt,vt),Xt=s.c$(xt,St);if(Xt===0)return!0;let Ht=!1;const Rt=this._elevation;if(Rt&&Xt>Te&&Ke!==0){const Gt=this.calculateProjMatrix(We.tileID.toUnwrapped());let si;n.isTerrainDEM||(si=Rt.getMinMaxForTile(We.tileID)),si||(si={min:_e,max:be});const pi=s.cI(this.rotation),Ni=[pi[0]*s.al,pi[1]*s.al,si.max];s.af(Ni,Ni,Gt),Ht=(1-Ni[1])*this.height*.5<Ke}return Xt<Te||Ht})}return ze.sort((Te,Ke)=>Te.distanceSq-Ke.distanceSq).map(Te=>Te.tileID)}resize(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const u=s.aA(n.lat,-s.cJ,s.cJ),m=this.projection.project(n.lng,u);return new s.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,u){let m,y;const b=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;m=(u.x-b.x)/E,y=(u.y-b.y)/E}else{const E=this.pointCoordinate(u),I=this.pointCoordinate(b);m=E.x-I.x,y=E.y-I.y}const w=this.locationCoordinate(n);this.setLocation(new s.ae(w.x-m,w.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,u){return this.projection.locationPoint(this,n,u)}locationPoint3D(n,u){return this.projection.locationPoint(this,n,u,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,u){return this.coordinateLocation(this.pointCoordinate3D(n,u))}locationCoordinate(n,u){const m=u?s.cf(u,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new s.ae(y.x,y.y,m)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,u){const m=u??this._centerAltitude,y=[n.x,n.y,0,1],b=[n.x,n.y,1,1];s.aC(y,y,this.pixelMatrixInverse),s.aC(b,b,this.pixelMatrixInverse);const w=b[3];s.cK(y,y,1/y[3]),s.cK(b,b,1/w);const E=y[2],I=b[2];return{p0:y,p1:b,t:E===I?0:(m-E)/(I-E)}}screenPointToMercatorRay(n){const u=[n.x,n.y,0,1],m=[n.x,n.y,1,1];return s.aC(u,u,this.pixelMatrixInverse),s.aC(m,m,this.pixelMatrixInverse),s.cK(u,u,1/u[3]),s.cK(m,m,1/m[3]),u[2]=s.cf(u[2],this._center.lat)*this.worldSize,m[2]=s.cf(m[2],this._center.lat)*this.worldSize,s.cK(u,u,1/this.worldSize),s.cK(m,m,1/this.worldSize),new s.ax([u[0],u[1],u[2]],s.aw([],s.av([],m,u)))}rayIntersectionCoordinate(n){const{p0:u,p1:m,t:y}=n,b=s.cf(u[2],this._center.lat),w=s.cf(m[2],this._center.lat);return new s.ae(s.ak(u[0],m[0],y)/this.worldSize,s.ak(u[1],m[1],y)/this.worldSize,s.ak(b,w,y))}pointCoordinate(n,u=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,u)}pointCoordinate3D(n,u){if(!this.elevation)return this.pointCoordinate(n,u);let m=this.projection.pointCoordinate3D(this,n.x,n.y);if(m)return new s.ae(m[0],m[1],m[2]);let y=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n,u);const w=.02*b,E=n.clone();for(let I=0;I<10&&b-y>w;I++){E.y=s.ak(y,b,.66);const L=this.projection.pointCoordinate3D(this,E.x,E.y);L?(b=E.y,m=L):y=E.y}return m?new s.ae(m[0],m[1],m[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.cL)return!this.isPointAboveHorizon(n);const u=this.pointCoordinate(n);return u.y>=0&&u.y<=1}_coordinatePoint(n,u){const m=u&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,m+n.toAltitude(),1];return s.aC(y,y,this.pixelMatrix),y[3]>0?new s.P(y[0]/y[3],y[1]/y[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:u}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.P(u,n)),w=this.pointLocation3D(new s.P(y,n)),E=this.pointLocation3D(new s.P(y,m)),I=this.pointLocation3D(new s.P(u,m));let L=Math.min(b.lng,w.lng,E.lng,I.lng),R=Math.max(b.lng,w.lng,E.lng,I.lng),N=Math.min(b.lat,w.lat,E.lat,I.lat),B=Math.max(b.lat,w.lat,E.lat,I.lat);const U=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,G=(J,K,oe,re,ne)=>{const be=(J+oe)/2,_e=(K+re)/2,ve=new s.P(be,_e),{lng:pe,lat:he}=this.pointLocation3D(ve),Se=Math.max(0,L-pe,N-he,pe-R,he-B);L=Math.min(L,pe),R=Math.max(R,pe),N=Math.min(N,he),B=Math.max(B,he),(ne<W||Se>U)&&(G(J,K,be,_e,ne+1),G(be,_e,oe,re,ne+1))};if(G(u,n,y,n,1),G(y,n,y,m,1),G(y,m,u,m,1),G(u,m,u,n,1),this.projection.name==="globe"){const[J,K]=s.cM(this);J?(B=90,R=180,L=-180):K&&(N=-90,R=180,L=-180)}return new s.aI(new s.aT(L,N),new s.aT(R,B))}_getBoundsRectangular(n,u){const{top:m,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,E=new s.P(y,m),I=new s.P(w,m),L=new s.P(w,b),R=new s.P(y,b);let N=this.pointCoordinate(E,n),B=this.pointCoordinate(I,n);const U=this.pointCoordinate(L,u),W=this.pointCoordinate(R,u),G=(J,K)=>(K.y-J.y)/(K.x-J.x);return N.y>1&&B.y>=0?N=new s.ae((1-W.y)/G(W,N)+W.x,1):N.y<0&&B.y<=1&&(N=new s.ae(-W.y/G(W,N)+W.x,0)),B.y>1&&N.y>=0?B=new s.ae((1-U.y)/G(U,B)+U.x,1):B.y<0&&N.y<=1&&(B=new s.ae(-U.y/G(U,B)+U.x,0)),new s.aI().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=n.visibleDemTiles.reduce((m,y)=>{if(y.dem){const b=y.dem.tree;m.min=Math.min(m.min,b.minimums[0]),m.max=Math.max(m.max,b.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*n.exaggeration(),u.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-u*(1-this._horizonShift);return n?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.cJ,this.maxLat=s.cJ,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,u){return this.projection.createTileMatrix(this,u,n)}calculateDistanceTileData(n){const u=n.key,m=this._distanceTileDataCache;if(m[u])return m[u];const y=n.canonical,b=1/this.height,w=this.cameraWorldSize,E=w/this.zoomScale(y.z),I=(y.x+Math.pow(2,y.z)*n.wrap)*E,L=y.y*E,R=this.point;R.x*=w/this.worldSize,R.y*=w/this.worldSize;const N=this.angle,B=Math.sin(-N),U=-Math.cos(-N);return m[u]={bearing:[B,U],center:[(R.x-I)*b,(R.y-L)*b],scale:E/s.al*b},m[u]}calculateFogTileMatrix(n){const u=n.key,m=this._fogTileMatrixCache;if(m[u])return m[u];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.aB(y,this.worldToFogMatrix,y),m[u]=new Float32Array(y),m[u]}calculateProjMatrix(n,u=!1,m=!1){const y=n.key;let b;if(b=m?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const w=this.calculatePosMatrix(n,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,s.aB(w,E,w),b[y]=new Float32Array(w),b[y]}calculatePixelsToTileUnitsMatrix(n){const u=n.tileID.key,m=this._pixelsToTileUnitsCache;if(m[u])return m[u];const y=s.cN(n,this);return m[u]=y,m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,u=s.bq([],[n,n,n]);return s.aB(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const u=s.cf(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),y=this._camera.forward(),b=s.cf(1,this._center.lat);m[2]/=b,y[2]/=b,s.aw(y,y);const w=n.raycast(m,y,n.exaggeration());if(w){const E=s.bH([],m,y,w),I=new s.ae(E[0],E[1],s.cf(E[2],s.a$(E[1]))),L=(I.z+s.ag([I.x-m[0],I.y-m[1],I.z-m[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const u=this._elevation,m=s.cf(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(m),b=u.getAtPointOrZero(new s.ae(...y)),w=this.pixelsPerMeter/this.worldSize*b,E=this._minimumHeightOverTerrain(),I=y[2]-w;if(I<=E)if(I<0||n){const L=this.locationCoordinate(this._center,this._centerAltitude),R=[y[0],y[1],L.z-y[2]],N=s.ag(R);R[2]-=(E-I)/this._pixelsPerMercatorPixel;const B=s.ag(R);if(B===0)return;s.c5(R,R,N/B*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],L.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const B=this.center;return B.lat=s.aA(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(B.lng=s.aA(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const u=this._unmodified,{x:m,y}=this.point;let b=0,w=m,E=y;const I=this.width/2,L=this.height/2,R=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(y-L<R&&(E=R+L),y+L>N&&(E=N-L),N-R<this.height&&(b=Math.max(b,this.height/(N-R)),E=(N+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,W=this.worldSize/2-(B+U)/2;w=(m+W+this.worldSize)%this.worldSize-W,w-I<B&&(w=B+I),w+I>U&&(w=U-I),U-B<this.width&&(b=Math.max(b,this.width/(U-B)),w=(U+B)/2)}w===m&&E===y||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(w,E))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,u=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cf(1,this.center.lat)/s.cf(1,s.d2));const y=s.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?m:1,w=this._camera.getWorldToCamera(this.worldSize,b);let E;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-n.x/this.width,I[9]=2*n.y/this.height,this.isOrthographic){let he=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Se=he*this.aspect,ze=-Se,Re=-he;Se-=n.x,ze-=n.x,he+=n.y,Re+=n.y,E=this._camera.getCameraToClipOrthographic(ze,Se,Re,he,this._nearZ,this._farZ),((Ze,je,it,dt)=>{for(let Fe=0;Fe<16;Fe++)Ze[Fe]=s.ak(je[Fe],it[Fe],dt)})(E,E,I,s.d0(this.pitch>=Ca?1:this.pitch/Ca))}else E=I;const L=s.cP([],I,w);let R=s.cP([],E,w);if(this.projection.isReprojectedInTileSpace){const he=this.locationCoordinate(this.center),Se=s.bA([]);s.br(Se,Se,[he.x*this.worldSize,he.y*this.worldSize,0]),s.aB(Se,Se,s.cQ(this)),s.br(Se,Se,[-he.x*this.worldSize,-he.y*this.worldSize,0]),s.aB(R,R,Se),s.aB(L,L,Se),this.inverseAdjustmentMatrix=s.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cS([],R,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=R,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),u){const he=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);he[8]=2*-n.x/this.width,he[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.cP([],he,w)}else this.expandedFarZProjMatrix=this.projMatrix;const N=s.bl([],E);this.frustumCorners=s.cT.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const B=new Float32Array(16);s.bA(B),s.cS(B,B,[1,-1,1]),s.cU(B,B,this._pitch),s.bB(B,B,this.angle);const U=s.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(U);const W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-n.x/this.width,U[9]=2*(n.y+W)/this.height,this.skyboxMatrix=s.aB(B,U,B);const G=this.point,J=G.x,K=G.y,oe=this.width%2/2,re=this.height%2/2,ne=Math.cos(this.angle),be=Math.sin(this.angle),_e=J-Math.round(J)+ne*oe+be*re,ve=K-Math.round(K)+ne*re+be*oe,pe=new Float64Array(R);if(s.br(pe,pe,[_e>.5?_e-1:_e,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=pe,R=s.bC(),s.cS(R,R,[this.width/2,-this.height/2,1]),s.br(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=s.bC(),s.cS(R,R,[1,-1,1]),s.br(R,R,[-1,-1,0]),s.cS(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},R=s.bl(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cV(this);const he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(he,he,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,u];s.c5(b,b,y),s.c5(m,m,-1),s.cW(m,m,b);const w=s.bC();s.br(w,w,m),s.cS(w,w,b),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,u,y)}_computeCameraPosition(n){const u=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*b,y.y/this.worldSize-m[1]*b,n/this.worldSize*this._centerAltitude-m[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],y=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((u-m)/y,1)),this._camera.position=s.bH([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,u=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),b=s.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),E=Math.max((n[2]-b)/Math.cos(m),w),I=this._zoomFromMercatorZ(E);s.bH(n,n,u,E),this._pitch=s.aA(m,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(y,-Math.PI,Math.PI),this._setZoom(s.aA(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let u=0,m=s.cL,y=0,b=1/0;for(;m-u>1e-6&&m>u;){const w=u+.5*(m-u),E=this.tileSize*Math.pow(2,w),I=this.getCameraToCenterDistance(this.projection,w,E),L=this.scaleZoom(I/(Math.max(0,n)*this.tileSize)),R=Math.abs(w-L);R<b&&(b=R,y=w),w<L?u=w:m=w}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,u){const m=Math.min(n.x,u.x),y=Math.max(n.x,u.x),b=Math.min(n.y,u.y),w=Math.max(n.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new s.P(m,b),new s.P(y,w),new s.P(m,w),new s.P(y,b)],I=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const R of E){const N=this.pointRayIntersection(R);if(N.t<0)return!0;const B=this.rayIntersectionCoordinate(N);if(B.x<I||B.y<0||B.x>L||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,u){const m=s.ag(s.av([],this._camera.position,n)),y=this._zoomFromMercatorZ(m)+u;return m-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([u,m,y],b){const w=[u,m,y,1];s.aC(w,w,b);const E=w[3]=Math.max(w[3],1e-6);return w[0]/=E,w[1]/=E,w[2]/=E,w})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,u=this.zoom,m=this.worldSize){const y=s.cO(n,u,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,m,y);let w=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(w=s.ak(1,w,s.d0(this.pitch>=Ca?1:this.pitch/Ca))),w}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(n,n,this.globeMatrix),n}getFrustum(n){return s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const ia=(p,n)=>{if(n>0&&p.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=p.transform,m=Math.max(Math.abs(u._zoom-(p.minCutoffZoom-1)),1),y=u.isLODDisabled(!1)?s.ah(60,45,u.pitch):s.ah(30,15,u.pitch),b=u._farZ-u._nearZ,w=n*u.height,E=((1-(I=y))*u.cameraToCenterDistance+I*(u._farZ+w))*m;var I;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(E-u._nearZ)/b,(E-w-u._nearZ)/b]}}},Rl=2048;class pw{constructor(n,u){this.aabb=n,this.lastCascade=u}}class ch{add(n,u){const m=this.receivers[n.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],u.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],u.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],u.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],u.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],u.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],u.max[2])):this.receivers[n.key]=new pw(u,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,u,m){const y=s.d9.fromPoints(n.points);let b=0;for(const w in this.receivers){const E=this.receivers[w];if(!E||!y.intersectsAabb(E.aabb))continue;E.aabb.min=y.closestPoint(E.aabb.min),E.aabb.max=y.closestPoint(E.aabb.max);const I=E.aabb.getCorners();for(let L=0;L<m.length;L++){let R=!0;for(const N of I){const B=[N[0]*u,N[1]*u,N[2]];if(s.af(B,B,m[L].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){R=!1;break}}if(E.lastCascade=L,b=Math.max(b,L),R)break}}return b+1}}class uh{constructor(n){this.painter=n,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ch,this._depthMode=new Qt(n.context.gl.LEQUAL,Qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,u){const m=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!u||!u.properties)return;const y=u.properties.get("shadow-intensity"),b=u.properties.get("shadow-draw-before-layer");if(!u.shadowsEnabled()||y<=0)return;let w=-1,E=0;for(const K of m.style.order){const oe=m.style._mergedLayers[K];oe.hasShadowPass()&&!oe.isHidden(n.zoom)&&(w=E),b&&b===K&&(this._drawShadowAfterLayer=E>0?E-1:0),E+=1}if(this._enabled=w>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=w);const I=m.context,L=Rl,R=Rl;if(this._cascades.length===0||Rl!==this._cascades[0].texture.size[0]){this._cascades=[];for(let K=0;K<2;++K){const oe=m._shadowMapDebug,re=I.gl,ne=I.createFramebuffer(L,R,oe?1:0,"texture"),be=new s.T(I,{width:L,height:R,data:null},re.DEPTH_COMPONENT16);if(ne.depthAttachment.set(be.texture),oe){const _e=new s.T(I,{width:L,height:R,data:null},re.RGBA8);ne.colorAttachment0.set(_e.texture)}this._cascades.push({framebuffer:ne,texture:be,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cB,scale:0})}}this.shadowDirection=Py(u);let N=0;if(n.elevation){const K=n.elevation,oe=[1e4,-1e4];K.visibleDemTiles.filter(re=>re.dem).forEach(re=>{const ne=re.dem.tree;oe[0]=Math.min(oe[0],ne.minimums[0]),oe[1]=Math.max(oe[1],ne.maximums[0])}),oe[0]!==1e4&&(N=(oe[1]-oe[0])*K.exaggeration())}const B=1.5*n.cameraToCenterDistance,U=3*B,W=new Float64Array(16);for(let K=0;K<this._cascades.length;++K){const oe=this._cascades[K];let re=n.height/50,ne=1;K===0?ne=B:(re=B,ne=U);const[be,_e]=zy(n,this.shadowDirection,re,ne,Rl,N);oe.scale=n.scale,oe.matrix=be,oe.boundingSphereRadius=_e,s.bl(W,oe.matrix),oe.frustum=s.cB.fromInvProjectionMatrix(W,1,0,!0),oe.far=ne}const G=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[G].far,this._cascades[G].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Rl,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const J=m.transform.elevation;for(const K of this._groundShadowTiles){let oe={min:0,max:0};if(J){const re=J.getMinMaxForTile(K);re&&(oe=re)}this.addShadowReceiver(K.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,u){if(!this.enabled)return;const m=this.painter,y=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),y.viewport.set([0,0,Rl,Rl]);for(let b=0;b<this._numCascadesToRender;++b){m.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:s.ao.white,depth:1});for(const w of n.order){const E=n._mergedLayers[w];if(!E.hasShadowPass()||E.isHidden(m.transform.zoom))continue;const I=n.getLayerSourceCache(E),L=I?u[I.id]:void 0;(E.type==="model"||L&&L.length)&&m.renderLayer(m,I,E,L)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,u=n.style,m=n.context,y=m.gl,b=u.directionalLight,w=u.ambientLight;if(!b||!w)return;const E=[],I=ia(n,n.longestCutoffRange);I.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const L=na(u,b,w),R=new Qt(y.LEQUAL,Qt.ReadOnly,n.depthRangeFor3D),N=new xi({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const B of this._groundShadowTiles){const U=B.toUnwrapped(),W=n.isTileAffectedByFog(B),G=n.getOrCreateProgram("groundShadow",{defines:E,overrideFog:W});this.setupShadows(U,G),n.uploadCommonUniforms(m,G,U,null,I);const J=os(n.transform.calculateProjMatrix(U),L);G.draw(n,y.TRIANGLES,R,N,Mi.multiply,fi.disabled,J,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Mi.unblended:Mi.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(n){const u=this.painter.transform,m=u.calculatePosMatrix(n,u.worldSize);return s.aB(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(n){const u=s.bz(n);return s.aB(u,this._cascades[this.painter.currentShadowCascade].matrix,n),u}setupShadows(n,u,m){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,w=b.gl,E=this._uniformValues,I=new Float64Array(16),L=y.calculatePosMatrix(n,y.worldSize);for(let R=0;R<this._cascades.length;R++)s.aB(I,this._cascades[R].matrix,L),E[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),b.activeTexture.set(w.TEXTURE0+11+R),this._cascades[R].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!m,this.useNormalOffset){const R=s.d7(n.canonical),N=2/y.tileSize*s.al/Rl,B=N*this._cascades[0].boundingSphereRadius,U=N*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(m==="vector-tile"?1:3)*(function(G){const J=s.aA((G-22)/-22,0,1);return .125*(1-J)+4*J})(y.zoom);E.u_shadow_normal_offset=[R,B*W,U*W],E.u_shadow_bias=[1e-4,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(b,E)}setupShadowsFromMatrix(n,u,m=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,w=this._uniformValues,E=new Float64Array(16);for(let I=0;I<2;I++)s.aB(E,this._cascades[I].matrix,n),w[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),y.activeTexture.set(b.TEXTURE0+11+I),this._cascades[I].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);this.useNormalOffset=m,m?(w.u_shadow_normal_offset=[1,3,3],w.u_shadow_bias=[6e-5,.0012,.012]):w.u_shadow_bias=[36e-5,.0012,.012],u.setShadowUniformValues(y,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,u,m,y){if(y[2]>=0)return{};const b=(function(I,L,R){const N=R/(1<<I.canonical.z);return new s.d9([I.canonical.x*N+I.wrap*R,I.canonical.y*N+I.wrap*R,0],[(I.canonical.x+1)*N+I.wrap*R,(I.canonical.y+1)*N+I.wrap*R,L])})(n,u,m).getCorners(),w=u/-y[2];y[0]<0?(s.d8(b[0],b[0],[y[0]*w,0,0]),s.d8(b[3],b[3],[y[0]*w,0,0])):y[0]>0&&(s.d8(b[1],b[1],[y[0]*w,0,0]),s.d8(b[2],b[2],[y[0]*w,0,0])),y[1]<0?(s.d8(b[0],b[0],[0,y[1]*w,0]),s.d8(b[1],b[1],[0,y[1]*w,0])):y[1]>0&&(s.d8(b[2],b[2],[0,y[1]*w,0]),s.d8(b[3],b[3],[0,y[1]*w,0]));const E={};return E.vertices=b,E.planes=[Md(b[1],b[0],b[4]),Md(b[2],b[1],b[5]),Md(b[3],b[2],b[6]),Md(b[0],b[3],b[7])],E}addShadowReceiver(n,u,m){this._receivers.add(n,s.d9.fromTileIdAndHeight(n,u,m))}getMaxCascadeForTile(n){const u=this._receivers.get(n);return u&&u.lastCascade?u.lastCascade:0}}function Md(p,n,u){const m=s.av([],u,n),y=s.av([],p,n),b=s.bI([],m,y),w=s.ag(b);return w===0?[0,0,1,0]:(s.c5(b,b,1/w),[b[0],b[1],b[2],-s.bJ(b,n)])}function Py(p){const n=p.properties.get("direction"),u=s.d4(n.x,n.y,n.z);u[2]=s.aA(u[2],0,75);const m=s.d6([u[0],u[1],u[2]]);return s.d5(m.x,m.y,m.z)}function na(p,n,u){const m=n.properties.get("color-use-theme")==="none",y=n.properties.get("color"),b=n.properties.get("intensity"),w=n.properties.get("direction"),E=[w.x,w.y,w.z],I=u.properties.get("color-use-theme")==="none",L=u.properties.get("color"),R=u.properties.get("intensity"),N=Math.max(s.bJ([0,0,1],E),0),B=[0,0,0];s.c5(B,L.toPremultipliedRenderColor(I?null:p.getLut(n.scope)).toArray01Linear().slice(0,3),R);const U=[0,0,0];return s.c5(U,y.toPremultipliedRenderColor(m?null:p.getLut(u.scope)).toArray01Linear().slice(0,3),N*b),s.db([B[0]>0?B[0]/(B[0]+U[0]):0,B[1]>0?B[1]/(B[1]+U[1]):0,B[2]>0?B[2]/(B[2]+U[2]):0])}function zy(p,n,u,m,y,b){const w=p.zoom,E=p.scale,I=p.worldSize,L=1/I,R=p.aspect,N=Math.sqrt(1+R*R)*Math.tan(.5*p.fovX),B=N*N,U=m-u,W=m+u;let G,J;B>U/W?(G=m,J=m*N):(G=.5*W*(1+B),J=.5*Math.sqrt(U*U+2*(m*m+u*u)*B+W*W*B*B));const K=p.projection.pixelsPerMeter(p.center.lat,I),oe=p._camera.getCameraToWorldMercator(),re=[0,0,-G*L];s.af(re,re,oe);let ne=J*L;const be=function(pt){return pt[0]/=E,pt[1]/=E,pt[2]=s.cf(pt[2],p._center.lat),pt},_e=p._edgeInsets;if(!(_e.left===0&&_e.top===0&&_e.right===0&&_e.bottom===0||_e.left===_e.right&&_e.top===_e.bottom)){const pt=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?K:1),vt=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,u,m);vt[8]=2*-p.centerOffset.x/p.width,vt[9]=2*p.centerOffset.y/p.height;const Pt=new Float64Array(16);s.cP(Pt,vt,pt);const xt=new Float64Array(16);s.bl(xt,Pt);const St=s.cB.fromInvProjectionMatrix(xt,I,w,!0);for(const Xt of St.points){const Ht=be(Xt);ne=Math.max(ne,s.c6(s.da([],re,Ht)))}}ne*=y/(y-1);const ve=Math.acos(n[2]),pe=Math.atan2(-n[0],-n[1]),he=new Jc;he.position=re,he.setPitchBearing(ve,pe);const Se=he.getWorldToCamera(I,K),ze=ne*I,Re=Math.min(p._mercatorZfromZoom(17)*I*-2,-2*ze),Ze=he.getCameraToClipOrthographic(-ze,ze,-ze,ze,Re,(ze+b*K)/n[2]),je=new Float64Array(16);s.aB(je,Ze,Se);const it=s.d5(Math.floor(1e6*re[0])/1e6*I,Math.floor(1e6*re[1])/1e6*I,0),dt=.5*y,Fe=[0,0,0];s.af(Fe,it,je),s.c5(Fe,Fe,dt);const Te=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],Ke=[0,0,0];s.av(Ke,Fe,Te),s.c5(Ke,Ke,-1/dt);const We=new Float64Array(16);return s.bA(We),s.br(We,We,Ke),s.aB(je,We,je),[je,ze]}class Ad extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,u){return s.dc(this.requestManager.transformRequest(u,s.R.Model).url).then(m=>{if(!m)return;const y=s.dd(m),b=new s.de(n,u,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b}).catch(m=>{if(m&&m.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${n} from ${u}: ${m.message}`)))})}load(n,u,m={forceReload:!1}){this.models[u]||(this.models[u]={});const y=Object.keys(n),b=[],w=[];for(const E of y){const I=n[E];this.hasURLBeenRequested(I)&&!m.forceReload||(this.modelByURL[I]={modelId:E,scope:u},b.push(this.loadModel(E,I)),w.push(E)),this.models[u][E]||(this.models[u][E]={model:null,numReferences:1})}this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+w.length,Promise.allSettled(b).then(E=>{for(let I=0;I<E.length;I++){const{status:L}=E[I];if(L==="rejected")continue;const{value:R}=E[I];this.models[u][w[I]]||(this.models[u][w[I]]={model:null,numReferences:1}),this.models[u][w[I]].model=R}this.numModelsLoading[u]-=w.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(E=>{this.fire(new s.y(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,u,m={exactIdMatch:!1}){return!!(m.exactIdMatch?this.getModel(n,u):this.getModelByURL(this.modelUris[u][n]))}getModel(n,u){return this.models[u]||(this.models[u]={}),this.models[u][n]?this.models[u][n].model:void 0}getModelByURL(n){if(!n)return null;const u=this.modelByURL[n];return u?this.models[u.scope][u.modelId].model:null}hasModelBeenAdded(n,u){return this.models[u]&&this.models[u][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,u,m){this.models[m]||(this.models[m]={}),this.modelUris[m]||(this.modelUris[m]={});const y=this.requestManager.normalizeModelURL(u);if((this.hasModel(n,m,{exactIdMatch:!0})||this.hasModelBeenAdded(n,m))&&this.modelUris[m][n]===y)this.models[m][n].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:b,modelId:w}=this.modelByURL[y];this.models[b][w].numReferences++}else this.modelUris[m][n]=y,this.load({[n]:this.modelUris[m][n]},m)}addModelURLs(n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const m=this.modelUris[u];for(const y in n)m[y]=this.requestManager.normalizeModelURL(n[y])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const m={};for(const y of n)this.hasModel(y,u,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[u][y].numReferences++:this.modelUris[u][y]&&!this.hasURLBeenRequested(y)?m[y]=this.modelUris[u][y]:!this.hasURLBeenRequested(y)&&s.df(y,!1)&&(this.modelUris[u][y]=this.requestManager.normalizeModelURL(y),m[y]=this.modelUris[u][y]);this.load(m,u)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,u,m=!1,y=!1){if(this.models[u]&&this.models[u][n]&&(this.models[u][n].numReferences--,this.models[u][n].numReferences===0||y)){const b=this.modelUris[u][n];m||delete this.modelUris[u][n],delete this.modelByURL[b];const w=this.models[u][n].model;if(!w)return;delete this.models[u][n],w.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const u of Object.keys(this.models[n])){const m=this.models[n][u].model;delete this.models[n][u],m&&m.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,u){this.models[u]||(this.models[u]={});for(const m in this.models[u])this.models[u][m].model&&this.models[u][m].model.upload(n.context)}}const hh=s.a6.colorTheme,Dl=new s.a9({data:new s.aa(hh.data)});function mw(p){if(!p.metadata||!p.metadata.content_area)return;const n=s.o.devicePixelRatio,{left:u,top:m,width:y,height:b}=p.metadata.content_area,w=u*n,E=m*n;return[w,E,w+y*n,E+b*n]}function Cy(p){if(p)return p.map(([n,u])=>[n*s.o.devicePixelRatio,u*s.o.devicePixelRatio])}class gw{constructor(n,u,m){this.id=n,this.scope=u,this.sourceCache=m,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const u=this.sourceCache.getVisibleCoordinates();if(u.length===0)return n;const m=this.sourceCache.getSource();if(!(m instanceof Fo))return n;const y=u.map(w=>this.sourceCache.getTile(w)),b=m.getImages(y,Array.from(this.pendingRequests));for(const[w,E]of b)n.set(s.I.from({name:w,iconsetId:this.id}),E),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),n}}class Xp{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",u=>this._onIndoorUpdate(u)),this._container}_createButton(n,u){const m=se("button",n,this._container);return m.type="button",m.addEventListener("click",u),m}_createSeparator(){return se("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,u){this._map&&(n.setAttribute("aria-label",u),n.textContent=u)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return this._model=n,void(this._container.style.display="none");const u=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px",u&&Array.from(this._container.children).forEach(m=>m.remove()),n.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(n.floors,n.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const n=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const u=this._map;this._model&&u&&u._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});se("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden","true"),n.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&n.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(n),this._createSeparator()}_updateBuildingsButtonState(){const n=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");n&&this._model&&(this._model.activeFloorsVisible?n.classList.remove("mapboxgl-ctrl-level-button-selected"):n.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(n,u){for(let m=0;m<n.length;m++){const y=n[m],b=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(y.id)}),w=(y.name||"").trim(),E=y.zIndex.toString(),I=w?Array.from(w).slice(0,3).join(""):E;this._setButtonTitle(b,I),this._model&&y.id===this._model.selectedFloorId&&u&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),m<n.length-1&&this._createSeparator()}}}class _w extends s.E{constructor(n){super(),this._style=n,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(n){n===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=n,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(n){this._activeFloorsVisible=n,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(n){for(const[u,m]of Object.entries(n.buildings))if(this._buildings[u])for(const y of m.floorIds)this._buildings[u].floors[y]||(this._buildings[u].floors[y]=m.floors[y]);else this._buildings[u]=m;for(const u of n.activeFloors)this._activeFloors.add(u);this._updateIndoorSelector()}getIndoorTileOptions(n,u){const m=this._style.getIndoorSourceLayers(n,u);return m&&this._indoorState?{sourceLayers:m,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Xp,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const n=this._style.map.transform,u=(function(m,y,b,w){let E=null,I=Number.MAX_SAFE_INTEGER;if(w<16)return null;for(const[L,R]of Object.entries(m)){const N=R.center;if(N){const B=y.distanceTo(s.aT.convert(N));B<I&&b.contains(N)&&(I=B,E=L)}}return E})(this._buildings,n.center,n.getBounds(),n.zoom);u!==this._closestBuildingId&&(this._closestBuildingId=u,this._updateIndoorSelector())}_updateIndoorSelector(){const n=this._buildings,u=this._closestBuildingId,m=u&&n?n[u]:void 0;if(!m)return this._removeIndoorControl(),void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let y=null;for(const w of m.floorIds)if(this._activeFloors&&this._activeFloors.has(w)){y=w;break}const b=Array.from(m.floorIds).map(w=>({id:w,name:m.floors[w].name,zIndex:m.floors[w].zIndex})).sort((w,E)=>E.zIndex-w.zIndex).filter((w,E,I)=>E===0||w.zIndex!==I[E-1].zIndex);this.fire(new s.z("selector-update",{selectedFloorId:y,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const n=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:n,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const cl=(p,n)=>Me(p,n&&n.filter(u=>u.identifier!=="source.canvas")),Ly=s.aH(un,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ry=s.aH(un,["setCenter","setZoom","setBearing","setPitch"]),Pd=new Set(["background","sky","slot","custom"]),Jp={version:8,layers:[],sources:{}},kl={duration:300,delay:0};class xs extends s.E{constructor(n,u={}){super(),this.map=n,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=Object.assign({},kl),this._buildingIndex=new ih(this),this.crossTileSymbolIndex=new Gr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=u.styleChanges||new Le,this._hasDataDrivenEmissive=!1,this.indoorManager=new _w(this),this.dispatcher=u.dispatcher?u.dispatcher:new s.D(s.dh(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new Jt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new s.di(n._requestManager,u.localFontFamily?s.dj.all:u.localIdeographFontFamily?s.dj.ideographs:s.dj.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new Ad(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._indoorDependentLayers=u.indoorDependentLayers?u.indoorDependentLayers:new Set,this._config=u.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:u.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",s.dk());const m=this;this._rtlTextPluginCallback=xs.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,w)=>{if(s.dl(b),w&&w.every(E=>E))for(const E in m._sourceCaches){const I=m._sourceCaches[E],L=I.getSource().type;L!=="vector"&&L!=="geojson"||I.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const w in this._layers){const E=this._layers[w];E.source===b.id&&this._validateLayer(E)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(s.h(n))return n;const u=s.dm(n);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${s.dn(JSON.stringify(n))}`}_diffStyle(n,u,m){this.globalId=this._getGlobalId(n);const y=(b,w)=>{try{w(null,this.setState(b,m))}catch(E){w(E,!1)}};if(typeof n=="string"){const b=this.map._requestManager.normalizeStyleURL(n),w=this.map._requestManager.transformRequest(b,s.R.Style);s.m(w,(E,I)=>{E?this.fire(new s.y(E)):I&&y(I,u)})}else typeof n=="object"&&y(n,u)}loadURL(n,u={}){this.fire(new s.z("dataloading",{dataType:"style"}));const m=typeof u.validate=="boolean"?u.validate:!s.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,u.accessToken),this.resolvedImports.add(n);const y=this.importsCache.get(n);if(y)return this._load(y,m);const b=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.m(b,(w,E)=>{if(this._request=null,w)this.fire(new s.y(w));else if(E)return this.importsCache.set(n,E),this._load(E,m)})}loadJSON(n,u={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=s.o.frame(()=>{this._request=null,this._load(n,u.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(Jp,!1)}_loadImports(n,u,m){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of n){const w=this._createFragmentStyle(b),E=new Promise(R=>{w.once("style.import.load",R),w.once("error",R)}).then(()=>this.mergeAll());if(y.push(E),this.resolvedImports.has(b.url)){w.loadEmpty();continue}const I=b.data||this.importsCache.get(b.url);I?(w.loadJSON(I,{validate:u}),this._isInternalStyle(I)&&(w.globalId=null)):b.url?w.loadURL(b.url,{validate:u}):w.loadEmpty();const L={style:w,id:b.id,config:b.config};if(m){const R=this.fragments.findIndex(({id:N})=>N===m);this.fragments=this.fragments.slice(0,R).concat(L).concat(this.fragments.slice(R))}else this.fragments.push(L)}return Promise.allSettled(y)}getImportGlobalIds(n=this,u=new Set){for(const m of n.fragments)m.style.globalId&&u.add(m.style.globalId),this.getImportGlobalIds(m.style,u);return[...u.values()]}_createFragmentStyle(n){const u=this.scope?s.B(n.id,this.scope):n.id;let m;const y=this._initialConfig&&this._initialConfig[u];(n.config||y)&&(m=Object.assign({},n.config,y));const b=new xs(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,u){if(this._isInternalStyle(n)){const b=Object.assign({},Jp,{imports:[{id:"basemap",data:n,url:""}]},n.center?{center:n.center}:{},n.bearing?{bearing:n.bearing}:{},n.pitch?{pitch:n.pitch}:{},n.zoom?{zoom:n.zoom}:{},n.light?{light:n.light}:{});return this._importedAsBasemap=!0,void this._load(b,u)}if(this.updateConfig(this._config,n.schema),u&&cl(this,Qo(n)))return;this._loaded=!0,this.stylesheet=s.dp(n);const m=()=>{for(const I in n.sources)this.addSource(I,n.sources[I],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const I in n.iconsets)this.addIconset(I,n.iconsets[I]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const b=Up(this.stylesheet.layers);if(this._order=b.map(I=>I.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const I=this.stylesheet.lights[0];this.light=new Be(I.properties,I.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Be(this.stylesheet.light)),this._layers={};for(const I of b){const L=s.du(I,this.scope,this._styleColorTheme.lut,this.options);L.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(L.fqid),this._hasAppearances=this._hasAppearances||L.getAppearances().length!==0,L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const R=this.getOwnLayerSourceCache(L),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&L.canCastShadows()&&N&&(R.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const E=this.isRootStyle();n.imports?this._loadImports(n.imports,u).then(()=>{this._reloadImports(),this.fire(new s.z(E?"style.load":"style.import.load"))}).catch(I=>{this.fire(new s.y(new Error("Failed to load imports",I))),this.fire(new s.z(E?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(E?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{m()}).catch(w=>{s.w(`Couldn't load color theme from the stylesheet: ${w}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(n=>n.style.hasAppearances())}mergeAll(){let n,u,m,y,b,w,E,I,L,R;const N={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(n=B.light),B.stylesheet.lights)for(const U of B.stylesheet.lights)U.type==="ambient"&&B.ambientLight!=null&&(u=B.ambientLight),U.type==="directional"&&B.directionalLight!=null&&(m=B.directionalLight);y=this._prioritizeTerrain(y,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(b=B.fog),B.stylesheet.snow&&B.snow!=null&&(w=B.snow),B.stylesheet.rain&&B.rain!=null&&(E=B.rain),B.stylesheet.camera!=null&&(R=B.stylesheet.camera),B.stylesheet.projection!=null&&(I=B.stylesheet.projection),B.stylesheet.transition!=null&&(L=B.stylesheet.transition),N[B.scope]=B._styleColorTheme}}),this.light=n,this.ambientLight=u,this.directionalLight=m,this.fog=b,this.snow=w,this.rain=E,this._styleColorThemeForScope=N,y===null?delete this.terrain:this.terrain=y,this.camera=R||{"camera-projection":"perspective"},this.projection=I||{name:"mercator"},this.transition=Object.assign({},kl,L),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(n){const u=m=>{for(const y of m.fragments)u(y.style);n(m)};u(this)}_prioritizeTerrain(n,u,m){const y=n&&n.drapeRenderMode===0;return m===null?u&&u.drapeRenderMode===0?u:y?n:null:u!=null&&(!n||y||u&&u.drapeRenderMode===1)?u:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{n=this._prioritizeTerrain(n,u.terrain,u.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(n=u.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},u={},m={};this.forEachFragmentStyle(y=>{for(const b in y._sourceCaches){const w=s.B(b,y.scope);n[w]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const w=s.B(b,y.scope);u[w]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const w=s.B(b,y.scope);m[w]=y._symbolSourceCaches[b]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=m}mergeIndoor(){this.forEachFragmentStyle(n=>{if(n.stylesheet&&n.stylesheet.indoor)for(const u of Object.values(n.stylesheet.indoor)){const m=u,y=s.B(m.sourceId,n.scope);this._mergedIndoor[y]=new Set(m.sourceLayers||[])}})}mergeLayers(){const n={},u=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const E of w._order){const I=w._layers[E];if(I.type==="slot"){const L=s.dq(E);if(n[L])continue;n[L]=[]}I.slot&&n[I.slot]?n[I.slot].push(I):u.push(I)}}),this._mergedOrder=[];let y=-1;const b=(w=[])=>{for(const E of w)if(E.type==="slot"){const I=s.dq(E.id);n[I]&&b(n[I]),this._mergedSlots.push(I)}else{const I=s.B(E.id,E.scope);this._mergedOrder.push(I),m[I]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(u),this._has3DLayers){const w={};for(let E=0;E<this._mergedOrder.length;++E){const I=this._mergedOrder[E];w[I]=E===y?1:E<y?m[I].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((E,I)=>w[E]-w[I])}this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?(function(u,m,y){const b=Object.assign({},m);for(const E of Object.keys(hh))b[E]===void 0&&(b[E]=hh[E].default);const w=new s.a8(Dl,u,new Map(y));return w.setTransitionOrValue(b,y),w.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))})(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,y)=>{const b="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let w=n;w.startsWith(b)||(w=b+w);const E=s.I.from("mapbox-reserved-lut"),I=new Image;I.src=w,I.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},I.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void m();this._styleColorTheme.lutLoading=!1;const{width:L,height:R,data:N}=s.o.getImageData(I);if(R>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==R*R)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new s.q({width:L,height:R},N),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(E,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:n},m()):y(new Error("Missing LUT image."))}})}getLut(n){const u=this._styleColorThemeForScope[n];return u?u.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=(function(u,m,y){let b,w,E;const I=s.o.devicePixelRatio>1?"@2x":"";let L=s.m(m.transformRequest(m.normalizeSpriteURL(u,I,".json"),s.R.SpriteJSON),(B,U)=>{L=null,E||(E=B,b=U,N())}),R=s.n(m.transformRequest(m.normalizeSpriteURL(u,I,".png"),s.R.SpriteImage),(B,U)=>{R=null,E||(E=B,w=U,N())});function N(){if(E)y(E);else if(b&&w){const B=s.o.getImageData(w),U={};for(const W in b){const{width:G,height:J,x:K,y:oe,sdf:re,pixelRatio:ne,stretchX:be,stretchY:_e,content:ve}=b[W],pe=new s.q({width:G,height:J});s.q.copy(B,pe,{x:K,y:oe},{x:0,y:0},{width:G,height:J},null),U[W]={data:pe,pixelRatio:ne!==void 0?ne:1,sdf:re!==void 0&&re,stretchX:be,stretchY:_e,content:ve,usvg:!1,version:0}}y(null,U)}}return{cancel(){L&&(L.cancel(),L=null),R&&(R.cancel(),R=null)}}})(n,this.map._requestManager,(u,m)=>{if(this._spriteRequest=null,u)this.fire(new s.y(u));else if(m){const y=new Map;for(const b in m)y.set(s.I.from(b),m[b]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(n,u){if(u.type==="sprite")return void this._loadSprite(u.url);const m=this.getOwnSourceCache(u.source);if(!m)return void this.fire(new s.y(new Error(`Source "${u.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const y=m.getSource();if(y.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${u.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const b=new gw(n,this.scope,m);this.imageManager.addImageProvider(b,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!s.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const u=this.map._spriteFormat==="auto";var m,y;this._spriteRequest=(y=(b,w)=>{if(this._spriteRequest=null,b)u?this._loadSprite(n):this.fire(new s.y(b));else if(w){const E=new Map;for(const I in w)E.set(s.I.from(I),w[I]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((m=this.map._requestManager).transformRequest(m.normalizeIconsetURL(n),s.R.Iconset),(b,w)=>{if(b)return void y(b);const E={},I=s.dg(new s.bt(w));for(const L of I.icons){const R={version:1,pixelRatio:s.o.devicePixelRatio,content:mw(L),stretchX:L.metadata?Cy(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?Cy(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};E[L.name]=R}y(null,E)}))}_validateLayer(n){const u=this.getOwnSource(n.source);if(!u)return;const m=n.sourceLayer;m&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(m)===-1)&&this.fire(new s.y(new Error(`Source layer "${m}" does not exist on source "${u.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,u)=>{const m=this.fragments[u];return m&&m.style&&(n.data=m.style.serialize()),n})}_serializeSources(){const n={};for(const u in this._sourceCaches){const m=this._sourceCaches[u].getSource();n[m.id]||(n[m.id]=m.serialize())}return n}_serializeLayers(n){const u=[];for(const m of n){const y=this._layers[m];y&&y.type!=="custom"&&u.push(y.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const n in this._mergedLayers){const u=this._mergedLayers[n];if(u._transitionablePaint&&u._transitionablePaint._values){const m=u._transitionablePaint._values["line-emissive-strength"];if(m&&m.value&&m.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const u=this.getOwnLayer(n);if(u)return u;this.fire(new s.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const u=this.getOwnSource(n);if(u)return u;this.fire(new s.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,u){const m=this.map.painter;if(m)for(let y=n.minzoom||0;y<(n.maxzoom||25.5);y++){const b=n.getProgramIds();if(b)for(const w of b){const E=n.getDefaultProgramParams(w,u.zoom,this._styleColorTheme.lut);E&&(m.style=this,this.fog&&(m._fogVisible=!0,E.overrideFog=!0,m.getOrCreateProgram(w,E)),m._fogVisible=!1,E.overrideFog=!1,m.getOrCreateProgram(w,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,m.getOrCreateProgram(w,E)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const u=this.calculateLightsBrightness();n.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const m=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const I in E){const{updatedIds:L,removedIds:R}=E[I];(L||R)&&(this._updateWorkerLayers(I,L,R),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const b={};for(const E in this._mergedSourceCaches){const I=this._mergedSourceCaches[E];b[E]=I.used,I.used=!1,I.tileCoverLift=0}for(const E of this._mergedOrder){const I=this._mergedLayers[E];if(I.visibility!=="none"&&I.recalculate(n,this._availableImages),!I.isHidden(n.zoom)){const L=this.getLayerSourceCache(I);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,n)}):this.precompilePrograms(I,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const E of w)E.sourceCache.used=!0;for(const E in b){const I=this._mergedSourceCaches[E];b[E]!==I.used&&I.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),m&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const u of n){const m=u.resolvePendingRequests(),y=this.getFragmentStyle(u.scope);y&&y.addImages(m)}}_updateTilesForChangedImages(){const n={};for(const u in this._mergedSourceCaches){const m=this._mergedSourceCaches[u].getSource().scope;n[m]=n[m]||this._changes.getUpdatedImages(m),n[m].length!==0&&this._mergedSourceCaches[u].reloadTilesForDependencies(["icons","patterns"],n[m])}for(const u in n)this._changes.resetUpdatedImages(u)}_updateWorkerLayers(n,u,m){const y=this.getFragmentStyle(n);y&&this.dispatcher.broadcast("updateLayers",{layers:u?y._serializeLayers(u):[],scope:n,removedIds:m||[],options:y.options})}setState(n,u){if(this._checkLoaded(),cl(this,Qo(n)))return!1;(n=s.dp(n)).layers=Up(n.layers);const m=(function(w,E){if(!w)return[{command:un.setStyle,args:[E]}];let I=[];try{if(!s.by(w.version,E.version))return[{command:un.setStyle,args:[E]}];if(s.by(w.center,E.center)||I.push({command:un.setCenter,args:[E.center]}),s.by(w.zoom,E.zoom)||I.push({command:un.setZoom,args:[E.zoom]}),s.by(w.bearing,E.bearing)||I.push({command:un.setBearing,args:[E.bearing]}),s.by(w.pitch,E.pitch)||I.push({command:un.setPitch,args:[E.pitch]}),s.by(w.sprite,E.sprite)||I.push({command:un.setSprite,args:[E.sprite]}),s.by(w.glyphs,E.glyphs)||I.push({command:un.setGlyphs,args:[E.glyphs]}),s.by(w.imports,E.imports)||(function(U=[],W=[],G){W=W||[];const J=(U=U||[]).map(zl),K=W.map(zl),oe=U.reduce(rh,{}),re=W.reduce(rh,{}),ne=J.slice();let be,_e,ve,pe;for(be=0,_e=0;be<J.length;be++)ve=J[be],re.hasOwnProperty(ve)?_e++:(G.push({command:un.removeImport,args:[ve]}),ne.splice(ne.indexOf(ve,_e),1));for(be=0,_e=0;be<K.length;be++)ve=K[K.length-1-be],ne[ne.length-1-be]!==ve&&(oe.hasOwnProperty(ve)?(G.push({command:un.removeImport,args:[ve]}),ne.splice(ne.lastIndexOf(ve,ne.length-_e),1)):_e++,pe=ne[ne.length-be],G.push({command:un.addImport,args:[re[ve],pe]}),ne.splice(ne.length-be,0,ve));for(const he of W){const Se=oe[he.id];Se&&(delete Se.data,s.by(Se,he)||G.push({command:un.updateImport,args:[he.id,he]}))}})(w.imports,E.imports,I),s.by(w.transition,E.transition)||I.push({command:un.setTransition,args:[E.transition]}),s.by(w.light,E.light)||I.push({command:un.setLight,args:[E.light]}),s.by(w.fog,E.fog)||I.push({command:un.setFog,args:[E.fog]}),s.by(w.snow,E.snow)||I.push({command:un.setSnow,args:[E.snow]}),s.by(w.rain,E.rain)||I.push({command:un.setRain,args:[E.rain]}),s.by(w.projection,E.projection)||I.push({command:un.setProjection,args:[E.projection]}),s.by(w.lights,E.lights)||I.push({command:un.setLights,args:[E.lights]}),s.by(w.camera,E.camera)||I.push({command:un.setCamera,args:[E.camera]}),s.by(w.iconsets,E.iconsets)||(function(U,W,G){let J;for(J in W=W||{},U=U||{})U.hasOwnProperty(J)&&(W.hasOwnProperty(J)||G.push({command:un.removeIconset,args:[J]}));for(J in W){if(!W.hasOwnProperty(J))continue;const K=W[J];U.hasOwnProperty(J)?s.by(U[J],K)||(G.push({command:un.removeIconset,args:[J]}),G.push({command:un.addIconset,args:[J,K]})):G.push({command:un.addIconset,args:[J,K]})}})(w.iconsets,E.iconsets,I),!s.by(w["color-theme"],E["color-theme"]))return[{command:un.setStyle,args:[E]}];const L={},R=[];(function(U,W,G,J){let K;for(K in W=W||{},U=U||{})U.hasOwnProperty(K)&&(W.hasOwnProperty(K)||yd(K,G,J));for(K in W){if(!W.hasOwnProperty(K))continue;const oe=W[K];U.hasOwnProperty(K)?s.by(U[K],oe)||(U[K].type==="geojson"&&oe.type==="geojson"&&Sy(U,W,K)?G.push({command:un.setGeoJSONSourceData,args:[K,oe.data]}):wy(K,W,G,J)):Hc(K,W,G)}})(w.sources,E.sources,R,L);const N=[];w.layers&&w.layers.forEach(U=>{U.source&&L[U.source]?I.push({command:un.removeLayer,args:[U.id]}):N.push(U)});let B=w.terrain;B&&L[B.source]&&(I.push({command:un.setTerrain,args:[void 0]}),B=void 0),I=I.concat(R),s.by(B,E.terrain)||I.push({command:un.setTerrain,args:[E.terrain]}),(function(U,W,G){W=W||[];const J=(U=U||[]).map(zl),K=W.map(zl),oe=U.reduce(rh,{}),re=W.reduce(rh,{}),ne=J.slice(),be=Object.create(null);let _e,ve,pe,he,Se,ze,Re;for(_e=0,ve=0;_e<J.length;_e++)pe=J[_e],re.hasOwnProperty(pe)?ve++:(G.push({command:un.removeLayer,args:[pe]}),ne.splice(ne.indexOf(pe,ve),1));for(_e=0,ve=0;_e<K.length;_e++)pe=K[K.length-1-_e],ne[ne.length-1-_e]!==pe&&(oe.hasOwnProperty(pe)?(G.push({command:un.removeLayer,args:[pe]}),ne.splice(ne.lastIndexOf(pe,ne.length-ve),1)):ve++,ze=ne[ne.length-_e],G.push({command:un.addLayer,args:[re[pe],ze]}),ne.splice(ne.length-_e,0,pe),be[pe]=!0);for(_e=0;_e<K.length;_e++)if(pe=K[_e],he=oe[pe],Se=re[pe],!be[pe]&&!s.by(he,Se))if(s.by(he.source,Se.source)&&s.by(he["source-layer"],Se["source-layer"])&&s.by(he.type,Se.type)){for(Re in nh(he.layout,Se.layout,G,pe,null,un.setLayoutProperty),nh(he.paint,Se.paint,G,pe,null,un.setPaintProperty),s.by(he.slot,Se.slot)||G.push({command:un.setSlot,args:[pe,Se.slot]}),s.by(he.filter,Se.filter)||G.push({command:un.setFilter,args:[pe,Se.filter]}),s.by(he.minzoom,Se.minzoom)&&s.by(he.maxzoom,Se.maxzoom)||G.push({command:un.setLayerZoomRange,args:[pe,Se.minzoom,Se.maxzoom]}),he)he.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?nh(he[Re],Se[Re],G,pe,Re.slice(6),un.setPaintProperty):s.by(he[Re],Se[Re])||G.push({command:un.setLayerProperty,args:[pe,Re,Se[Re]]}));for(Re in Se)Se.hasOwnProperty(Re)&&!he.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?nh(he[Re],Se[Re],G,pe,Re.slice(6),un.setPaintProperty):s.by(he[Re],Se[Re])||G.push({command:un.setLayerProperty,args:[pe,Re,Se[Re]]}))}else G.push({command:un.removeLayer,args:[pe]}),ze=ne[ne.lastIndexOf(pe)+1],G.push({command:un.addLayer,args:[Se,ze]})})(N,E.layers,I)}catch(L){console.warn("Unable to compute style diff:",L),I=[{command:un.setStyle,args:[E]}]}return I})(this.serialize(),n).filter(w=>!(w.command in Ry));if(m.length===0)return!1;const y=m.filter(w=>!(w.command in Ly));if(y.length>0)throw new Error(`Unimplemented: ${y.map(w=>w.command).join(", ")}.`);const b=[];return m.forEach(w=>{b.push(this[w.command](...w.args))}),u&&Promise.all(b).then(u).catch(u),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[u,m]of n.entries()){if(this.getImage(u))return this.fire(new s.y(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,this.scope,m),this._changes.updateImage(u,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(n,u){return this.getImage(n)?this.fire(new s.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,u),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(n,u,m=!1){this.imageManager.updateImage(n,this.scope,u),m&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(n){return this.modelManager.addModelURLs(n,this.getActualScope()),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(n,u,m={}){return this._checkLoaded(),this._validate(xe,`models.${n}`,u,null,m)||(this.modelManager.addModel(n,u,this.getActualScope()),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.getActualScope())}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.getActualScope(),!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(n,u,m={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(De,`sources.${n}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const y=cc(n,u,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const b=w=>{const E=(w?"symbol:":"other:")+y.id,I=s.B(E,this.scope),L=this._sourceCaches[E]=new es(I,y,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=L,L.onAdd(this.map)};b(!1),u.type!=="vector"&&u.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const u=this.getOwnSource(n);if(!u)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find(([b,w])=>w.type==="source"&&w.source===n);if(y)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while iconset "${y[0]}" is using it.`)))}const m=this.getOwnSourceCaches(n);for(const y of m){const b=s.dq(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,u){this._checkLoaded(),this.getOwnSource(n).setData(u),this._changes.setDirty()}getOwnSource(n){const u=this.getOwnSourceCache(n);return u&&u.getSource()}getOwnSources(){const n=[];for(const u in this._otherSourceCaches){const m=this.getOwnSourceCache(u);m&&n.push(m.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const u in n){const m=n[u]._tiles;for(const y in m){const b=m[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const b of n){if(this._validate(Ae,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(b),w.updateTransitions(u)}else this.ambientLight=new sn(b,nr(),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(b),w.updateTransitions(u)}else this.directionalLight=new sn(b,On(),this.scope,this.options)}}const m=Object.assign(u,{worldview:this.map.getWorldview()}),y=new s.ac(this.z||0,m);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,u=this.ambientLight;if(!n||!u)return;const m=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),y=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=n.properties.get("intensity"),w=n.properties.get("direction"),E=1-s.d4(w.x,w.y,w.z)[2]/90,I=m(y)*b*E,L=u.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),R=u.properties.get("intensity"),N=m(L)*R;return Number(((I+N)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(s.dr(n)){const u=s.ds(n),m=this.fragments.find(({id:b})=>b===u);if(!m)return;const y=s.dq(n);return m.style.getFragmentStyle(y)}{const u=this.fragments.find(({id:m})=>m===n);return u?u.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const u={},m=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in n){const b=this._featuresetSelectors[y]=[];for(const w of n[y].selectors){if(w.featureNamespace){const I=this.getOwnLayer(w.layer);if(!I){s.w(`Layer is undefined for selector: ${w.layer}`);continue}const L=m(I.source,I.sourceLayer);if(L in u&&u[L]!==w.featureNamespace){s.w(`"featureNamespace ${w.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}u[L]=w.featureNamespace}let E;if(w.properties)for(const I in w.properties){const L=s.U(w.properties[I]);L.result==="success"&&(E=E||{},E[I]=L.value)}b.push({layerId:w.layer,namespace:w.featureNamespace,properties:E,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const u=this.getFragmentStyle(n);if(!u||!u.stylesheet.featuresets)return[];const m=[];for(const y in u.stylesheet.featuresets)m.push({featuresetId:y,importId:u.scope?u.scope:void 0});return m}getFeaturesetLayers(n,u){const m=this.getFragmentStyle(u),y=m.stylesheet.featuresets;if(!y||!y[n])return this.fire(new s.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const w of y[n].selectors){const E=m.getOwnLayer(w.layer);E&&b.push(E)}return b}getConfigProperty(n,u){const m=this.getFragmentStyle(n);if(!m)return null;const y=s.B(u,m.scope),b=m.options.get(y),w=b?b.value||b.default:null;return w?w.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(n,u){const m=s.B(n,u);return this._mergedIndoor[m]}setIndoorData(n,u){this.indoorManager.setIndoorData(u)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(n,u,m){const y=this.getFragmentStyle(n);if(!y)return;const b=y.stylesheet.schema;if(!b||!b[u])return;const w=s.U(m);if(w.result!=="success")return void cl(this,w.value);const E=w.value.expression,I=s.B(u,y.scope),L=y.options.get(I);if(!L)return;let R;const{minValue:N,maxValue:B,stepValue:U,type:W,values:G}=b[u],J=s.U(b[u].default);J.result==="success"&&(R=J.value.expression),R?(this.options.set(I,Object.assign({},L,{value:E,default:R,minValue:N,maxValue:B,stepValue:U,type:W,values:G})),this.updateConfigDependencies(u)):this.fire(new s.y(new Error(`No schema defined for the config option "${u}" in the "${n}" fragment.`)))}getConfig(n){const u=this.getFragmentStyle(n);if(!u)return null;const m=u.stylesheet.schema;if(!m)return null;const y={};for(const b in m){const w=s.B(b,u.scope),E=u.options.get(w),I=E?E.value||E.default:null;y[b]=I?I.serialize():null}return y}setConfig(n,u){const m=this.getFragmentStyle(n);m&&(m.updateConfig(u,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const u=this.getFragmentStyle(n);return u?u.stylesheet.schema:null}setSchema(n,u){const m=this.getFragmentStyle(n);m&&(m.stylesheet.schema=u,m.updateConfig(m._config,u),this.updateConfigDependencies())}updateConfig(n,u){if(this._config=n,n||u)if(u)for(const m in u){let y,b;const w=s.U(u[m].default);if(w.result==="success"&&(y=w.value.expression),n&&n[m]!==void 0){const B=s.U(n[m]);B.result==="success"&&(b=B.value.expression)}const{minValue:E,maxValue:I,stepValue:L,type:R,values:N}=u[m];if(y){const B=s.B(m,this.scope);this.options.set(B,{default:y,value:b,minValue:E,maxValue:I,stepValue:L,type:R,values:N})}else this.fire(new s.y(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(n,u=()=>!0){for(const m of n){const y=this.getLayer(m);y&&u(y)&&(y.possiblyEvaluateVisibility(),this._updateLayer(y),this._changes.setDirty())}}updateConfigDependencies(n){this._updateLayers(this._configDependentLayers,u=>!n||u.expressionDependencies.configDependencies.has(n)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(u=>{const m=u._styleColorTheme.colorThemeOverride?u._styleColorTheme.colorThemeOverride:u._styleColorTheme.colorTheme;if(m){const y=u._evaluateColorThemeData(m);(!u._styleColorTheme.lut&&y!==""||u._styleColorTheme.lut&&y!==u._styleColorTheme.lut.data)&&u.setColorTheme(m)}}),this._changes.setDirty()}addLayer(n,u,m={}){this._checkLoaded();const y=n.id;if(this._layers[y])return void this.fire(new s.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(n.type==="custom"){if(cl(this,s.dt(n)))return;b=s.du(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=s.dp(n),n=Object.assign(n,{source:y})),this._validate(Ee,`layers.${y}`,n,{arrayIndex:-1},m))return;b=s.du(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}const w=s.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w);let E=this._order.length;if(u){const N=this._order.indexOf(u);if(N===-1)return void this.fire(new s.y(new Error(`Layer with id "${u}" does not exist on this map.`)));b.slot&&b.slot!==this._layers[u].slot?s.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`):E=N}this._order.splice(E,0,y),this._handleLayerOrderChange(),this._layers[y]=b;const I=this.getOwnLayerSourceCache(b),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&b.canCastShadows()&&L&&(I.castsShadows=!0);const R=this._changes.getRemovedLayer(b);if(R&&b.source&&I&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const N=s.B(b.source,b.scope);R.type!==b.type?this._changes.updateSourceCache(N,"clear"):(this._changes.updateSourceCache(N,"reload"),I.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(n,u){this._checkLoaded();const m=this._checkLayer(n);if(!m||n===u)return;const y=this._order.indexOf(n);this._order.splice(y,1);let b=this._order.length;if(u){const w=this._order.indexOf(u);if(w===-1)return void this.fire(new s.y(new Error(`Layer with id "${u}" does not exist on this map.`)));m.slot&&m.slot!==this._layers[u].slot?s.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`):b=w}this._order.splice(b,0,n),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(n){this._checkLoaded();const u=this._checkLayer(n);if(!u)return;u.setEventedParent(null);const m=this._order.indexOf(n);this._order.splice(m,1),delete this._layers[n],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(u.fqid),this._indoorDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const y=this.getOwnLayerSourceCache(u);if(y&&y.castsShadows){let b=!1;for(const w in this._layers)if(this._layers[w].source===u.source&&this._layers[w].canCastShadows()){b=!0;break}y.castsShadows=b}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const u in this._layers)if(this._layers[u].type===n)return!0;return!1}setLayerZoomRange(n,u,m){this._checkLoaded();const y=this._checkLayer(n);y&&(y.minzoom===u&&y.maxzoom===m||(u!=null&&(y.minzoom=u),m!=null&&(y.maxzoom=m),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,u){this._checkLoaded();const m=this._checkLayer(n);m&&m.slot!==u&&(m.slot=u,this._updateLayer(m))}setFilter(n,u,m={}){this._checkLoaded();const y=this._checkLayer(n);if(y&&!s.by(y.filter,u))return u==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(Z,`layers.${y.id}.filter`,u,{layerType:y.type},m)||(y.filter=s.dp(u),this._updateLayer(y)))}getFilter(n){const u=this._checkLayer(n);if(u)return s.dp(u.filter)}setLayoutProperty(n,u,m,y={}){this._checkLoaded();const b=this._checkLayer(n);if(b&&!s.by(b.getLayoutProperty(u),m)){if(m!=null&&(!y||y.validate!==!1)&&cl(b,ce.call(Qo,{key:`layers.${n}.layout.${u}`,layerType:b.type,objectKey:u,value:m,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(u,m),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(n,u,m,y={}){this._checkLoaded();const b=this._checkLayer(n);b&&(u==="appearances"?(b.setAppearances(m),this._changes.setDirty()):b.isPaintProperty(u)?this.setPaintProperty(n,u,m,y):this.setLayoutProperty(n,u,m,y))}getLayoutProperty(n,u){const m=this._checkLayer(n);if(m)return m.getLayoutProperty(u)}setPaintProperty(n,u,m,y={}){this._checkLoaded();const b=this._checkLayer(n);if(!b||s.by(b.getPaintProperty(u),m)||m!=null&&(!y||y.validate!==!1)&&cl(b,Q.call(Qo,{key:`layers.${n}.paint.${u}`,layerType:b.type,objectKey:u,value:m,styleSpec:s.a6})))return;const w=b.setPaintProperty(u,m);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),w&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(n,u){const m=this._checkLayer(n);if(m)return m.getPaintProperty(u)}setFeatureState(n,u){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:I,importId:L}=n.target,R=this.getFragmentStyle(L),N=R.getFeaturesetLayers(I);for(const{source:B,sourceLayer:U}of N)R.setFeatureState({id:n.id,source:B,sourceLayer:U},u)}else if("layerId"in n.target){const{layerId:I}=n.target,L=this.getLayer(I);this.setFeatureState({id:n.id,source:L.source,sourceLayer:L.sourceLayer},u)}return}const m=n.source,y=n.sourceLayer,b=this._checkSource(m);if(!b)return;const w=b.type;if(w==="geojson"&&y)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!y)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(m);for(const I of E)I.setFeatureState(y,n.id,u)}removeFeatureState(n,u){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:I,importId:L}=n.target,R=this.getFragmentStyle(L),N=R.getFeaturesetLayers(I);for(const{source:B,sourceLayer:U}of N)R.removeFeatureState({id:n.id,source:B,sourceLayer:U},u)}else if("layerId"in n.target){const{layerId:I}=n.target,L=this.getLayer(I);this.removeFeatureState({id:n.id,source:L.source,sourceLayer:L.sourceLayer},u)}return}const m=n.source,y=this._checkSource(m);if(!y)return;const b=y.type,w=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!w)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(m);for(const I of E)I.removeFeatureState(w,n.id,u)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let b;if("featuresetId"in n.target){const{featuresetId:w,importId:E}=n.target,I=this.getFragmentStyle(E),L=I.getFeaturesetLayers(w);for(const{source:R,sourceLayer:N}of L){const B=I.getFeatureState({id:n.id,source:R,sourceLayer:N});if(B&&!b)b=B;else if(!s.by(b,B))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:w}=n.target,E=this.getLayer(w);b=this.getFeatureState({id:n.id,source:E.source,sourceLayer:E.sourceLayer})}return b}const u=n.source,m=n.sourceLayer,y=this._checkSource(u);if(y){if(y.type!=="vector"||m)return n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(m,n.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),u=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateFilteredLayers(n){for(const u of Object.values(this._mergedLayers))n(u)&&this._updateLayer(u)}_updateLayer(n){this._changes.updateLayer(n);const u=this.getLayerSourceCache(n),m=s.B(n.source,n.scope),y=this._changes.getUpdatedSourceCaches();n.source&&!y[m]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),u.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const u=E=>this._mergedLayers[E].is3D(!!this.terrain),m=this.order,y={},b=[];for(let E=m.length-1;E>=0;E--){const I=m[E];if(u(I)){y[I]=E;for(const L of n){const R=L[I];if(R)for(const N of R)b.push(N)}}}b.sort((E,I)=>I.intersectionZ-E.intersectionZ);const w=[];for(let E=m.length-1;E>=0;E--){const I=m[E];if(u(I))for(let L=b.length-1;L>=0;L--){const R=b[L].feature;if(R.layer&&y[R.layer.id]<E)break;w.push(R),b.pop()}else for(const L of n){const R=L[I];if(R)for(const N of R)w.push(N.feature)}}return w}queryRasterValue(n,u,m){const y=this.getOwnSource(n);return y?y.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(u,m):(this.fire(new s.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,u,m){let y;u&&!Array.isArray(u)&&u.filter&&(this._validate(Z,"queryRenderedFeatures.filter",u.filter,null,u),y=s.b6(u.filter));const b={},w=R=>{if(Pd.has(R.type))return;const N=this.getOwnLayerSourceCache(R),B=b[N.id]=b[N.id]||{sourceCache:N,layers:{},has3DLayers:!1};R.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[R.fqid]=B.layers[R.fqid]||{styleLayer:R,targets:[]},B.layers[R.fqid].targets.push({filter:y})};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const R of u.layers){const N=this._layers[R];if(!N)return this.fire(new s.y(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];w(N)}}else for(const R in this._layers)w(this._layers[R]);const E=this._queryRenderedFeatures(n,b,m),I=this._flattenAndSortRenderedFeatures(E),L=[];for(const R of I)s.dw(R.layer.id)===this.scope&&L.push(R);return L}queryRenderedFeatureset(n,u,m){let y;u&&!Array.isArray(u)&&u.filter&&(this._validate(Z,"queryRenderedFeatures.filter",u.filter,null,u),y=s.b6(u.filter));const b="mock",w=[];if(u&&u.target)w.push(Object.assign({},u,{targetId:b,filter:y}));else{const R=this.getFeaturesetDescriptors();for(const N of R)w.push({targetId:b,filter:y,target:N});for(const{style:N}of this.fragments){const B=N.getFeaturesetDescriptors();for(const U of B)w.push({targetId:b,filter:y,target:U})}}const E=this.queryRenderedTargets(n,w,m),I=[],L=new Set;for(const R of E)for(const N of R.variants[b])Ku(N,R,L)||I.push(new s.dx(R,N));return I}queryRenderedTargets(n,u,m){const y={},b=(E,I,L,R)=>{const N=y[I.id]=y[I.id]||{sourceCache:I,layers:{},has3DLayers:!1};if(N.layers[E.fqid]=N.layers[E.fqid]||{styleLayer:E,targets:[]},E.is3D(!!this.terrain)&&(N.has3DLayers=!0),!R)return L.uniqueFeatureID=!1,void N.layers[E.fqid].targets.push(L);N.layers[E.fqid].targets.push(Object.assign({},L,{namespace:R.namespace,properties:R.properties,uniqueFeatureID:R.uniqueFeatureID}))};for(const E of u)if("featuresetId"in E.target){const{featuresetId:I,importId:L}=E.target,R=this.getFragmentStyle(L);if(!R||!R._featuresetSelectors)continue;const N=R._featuresetSelectors[I];if(!N){this.fire(new s.y(new Error(`The featureset '${I}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of N){const U=R.getOwnLayer(B.layerId);U&&!Pd.has(U.type)&&b(U,R.getOwnLayerSourceCache(U),E,B)}}else if("layerId"in E.target){const{layerId:I}=E.target,L=this.getLayer(I);if(!L||Pd.has(L.type))continue;b(L,this.getLayerSourceCache(L),E)}const w=this._queryRenderedFeatures(n,y,m);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(n,u,m){const y=[],b=!!this.map._showQueryGeometry,w=gr.createFromScreenPoints(n,m);for(const E in u){const I=Qu(w,u[E],this._availableImages,m,b,this.getActualScope());Object.keys(I).length&&y.push(I)}if(this.placement)for(const E in u){if(!u[E].sourceCache._onlySymbols)continue;const I=yy(w.screenGeometry,u[E],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(I).length&&y.push(I)}return y}querySourceFeatures(n,u){const m=u&&u.filter;m&&this._validate(Z,"querySourceFeatures.filter",m,null,u);let y=[];const b=this.getOwnSourceCaches(n);for(const w of b)y=y.concat(vy(w,u));return y}addSourceType(n,u,m){return xs.getSourceType(n)?m(new Error(`A source type called "${n}" already exists.`)):(xs.setSourceType(n,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:u.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,u,m={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const E in n)if(!s.by(n[E],y[E])){b=!0;break}if(!b)return;const w=this._getTransitionParameters();this.light.setLight(n,u,m),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,u=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),u===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=n;const y=!("source"in n)||n.source==null;if(u===1){if(this.disableElevatedTerrain)return;if("source"in m&&typeof m.source=="object"){const E="terrain-dem-src";this.addSource(E,m.source),m=s.dp(m),m=Object.assign(m,{source:E})}const b=Object.assign({},m),w={};if(this.terrain&&y){b.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(w.style=E.serialize())}if(this._validate(Ot,"terrain",b,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&u!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,u),this.fire(new s.z("data",{dataType:"style"}))}else{const b=this.terrain,w=b.get();for(const E of Object.keys(s.a6.terrain))!m.hasOwnProperty(E)&&s.a6.terrain[E].default&&(m[E]=s.a6.terrain[E].default);for(const E in n)if(!s.by(n[E],w[E])){b.set(n,this.options),this.stylesheet.terrain=n;const I=this._getTransitionParameters({duration:0});b.updateTransitions(I),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const u=this.fog=new vi(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_createSnow(n){const u=this.snow=new xr(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_createRain(n){const u=this.rain=new Qn(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!s.by(u.get(),n)){u.set(n,this.options),this.stylesheet.fog=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const u=this.snow;if(!s.by(u.get(),n)){u.set(n,this.options),this.stylesheet.snow=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const u=this.rain;if(!s.by(u.get(),n)){u.set(n,this.options),this.stylesheet.rain=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},u=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!u)return this._styleColorTheme.lut=null,void n();const m=this._evaluateColorThemeData(u);this._loadColorTheme(m).then(()=>{this.fire(new s.z("colorthemeset")),n()}).catch(y=>{s.w(`Couldn't set color theme: ${y}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,u){const m=this.getFragmentStyle(n);m&&(m._styleColorTheme.colorThemeOverride=u,m._reloadColorTheme())}_getTransitionParameters(n){return{now:s.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],u=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?n.push(m):u.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...u)}_createTerrain(n,u){const m=this.terrain=new st(n,u,this.scope,this.options,this.map.getWorldview());u===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});m.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const u=this._layers[n];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const u=this._layers[n];u.type==="symbol"&&this._updateLayer(u)}}_validate(n,u,m,y,b={}){if(b&&b.validate===!1)return!1;const w=Object.assign({},this.serialize());return cl(this,n.call(Qo,Object.assign({key:u,style:w,value:m,styleSpec:s.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const u=this.getSourceCaches(n);for(const m of u)m.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const u=this._mergedLayers[n];u._clear&&u._clear()}}reloadSource(n){const u=this.getSourceCaches(n);for(const m of u)m.resume(),m.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let u;this.directionalLight&&(u=Py(this.directionalLight));const m=new Set,y=new Set;for(const b in this._mergedLayers){const w=this._mergedLayers[b];w.type==="building"&&m.add(w.source),w.hasElevation()&&!y.has(w.source)&&y.add(w.source)}for(const b in this._mergedSourceCaches){const w=this._mergedSourceCaches[b],E=y.has(w._source.id);m.has(w._source.id)&&(w._source.reparseOverscaled=!1),w.update(n,void 0,void 0,u,E)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const u=this._sourceCaches[n];u.resume(),u.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new s.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new Hp),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(n,u,m,y,b){this.pauseablePlacement||(this.pauseablePlacement=new Hp);let w=!1,E=!1;const I={},L={};for(const G of this._mergedOrder){const J=this._mergedLayers[G];if(J.type!=="symbol")continue;const K=s.B(J.source,J.scope);let oe=I[K];if(!oe){const ne=this.getLayerSourceCache(J);if(!ne)continue;const be=ne.getRenderableIds(!0).map(_e=>ne.getTileByID(_e));L[K]=be.slice(),oe=I[K]=be.sort((_e,ve)=>ve.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(ve.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer(J,oe,n.center.lng,n.projection);w=w||re}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const R=!!(this.placement&&!n.equals(this.placement.transform)),N=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!b||this.placement.lastReplacementSourceUpdateTime!==b.updateTime)),B=R||N||w,U=(B||this.pauseablePlacement.isStale())&&m===0,W=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),n.zoom)&&m!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||U||W)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(n,this._mergedOrder,u,m,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?B&&m!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,L,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),E=!0),w&&this.pauseablePlacement.setStale()),E||w){this._buildingIndex.onNewFrame(n.zoom);for(let G=0;G<this._mergedOrder.length;G++){const J=this._mergedLayers[this._mergedOrder[G]];if(J.type!=="symbol"||J.visibility==="none")continue;const K=this.isLayerClipped(J);this.placement.updateLayerOpacities(J,I[s.B(J.source,J.scope)],G,K?b:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(s.o.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,u){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:b})=>b===n.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!u)return m.push(n),this._loadImports([n],!0);const y=m.findIndex(({id:b})=>b===u);return y===-1&&this.fire(new s.y(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,y).concat(n).concat(m.slice(y)),this._loadImports([n],!0,u)}updateImport(n,u){this._checkLoaded();const m=this.stylesheet.imports||[],y=this.getImportIndex(n);return y===-1?this:typeof u=="string"?(this.setImportUrl(n,u),this):(u.url&&u.url!==m[y].url&&this.setImportUrl(n,u.url),s.by(u.config,m[y].config)||this.setImportConfig(n,u.config,u.data.schema),s.by(u.data,m[y].data)||this.setImportData(n,u.data),this)}moveImport(n,u){this._checkLoaded();let m=this.stylesheet.imports||[];const y=this.getImportIndex(n);if(y===-1)return this;const b=this.getImportIndex(u);if(b===-1)return this;const w=m[y],E=this.fragments[y];return m=m.filter(({id:I})=>I!==n),this.fragments=this.fragments.filter(({id:I})=>I!==n),this.stylesheet.imports=m.slice(0,b).concat(w).concat(m.slice(b)),this.fragments=this.fragments.slice(0,b).concat(E).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(n,u){this._checkLoaded();const m=this.stylesheet.imports||[],y=this.getImportIndex(n);if(y===-1)return this;m[y].url=u;const b=this.fragments[y];return b.style=this._createFragmentStyle(m[y]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(u),this}setImportData(n,u){this._checkLoaded();const m=this.getImportIndex(n),y=this.stylesheet.imports||[];return m===-1?this:u?(this.fragments[m].style.setState(u),this._reloadImports(),this):(delete y[m].data,this.setImportUrl(n,y[m].url))}setImportConfig(n,u,m){this._checkLoaded();const y=this.getImportIndex(n),b=this.stylesheet.imports||[];if(y===-1)return this;u?b[y].config=u:delete b[y].config;const w=this.fragments[y];m&&w.style.stylesheet&&(w.style.stylesheet.schema=m);const E=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=u,w.style.updateConfig(u,E),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const u=this.stylesheet.imports||[],m=this.getImportIndex(n);m!==-1&&(u.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(n){const u=(this.stylesheet.imports||[]).findIndex(m=>m.id===n);return u===-1&&this.fire(new s.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),u}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const u in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[u];m&&n.push(m.getSource())}return n}getSource(n,u){const m=this.getSourceCache(n,u);return m&&m.getSource()}getLayerSource(n){const u=this.getLayerSourceCache(n);return u&&u.getSource()}getSourceCache(n,u){const m=s.B(n,u);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(n){const u=s.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[n]&&u.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&u.push(this._mergedSymbolSourceCaches[n]),u}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const u in n){const m=n[u];m==="reload"?this.reloadSource(u):m==="clear"&&this.clearSource(u)}}updateLayers(n){const u=this._changes.getUpdatedPaintProperties();for(const m of u){const y=this.getLayer(m);y&&y.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,u,m){this.imageManager.getImages(u.images,u.scope,m),this._updateTilesForChangedImages();const y=w=>{if(w){const E=u.images.map(I=>s.I.toString(I));w.setDependencies(u.tileID.key,u.type,E)}},b=s.B(u.source,u.scope);y(this._mergedOtherSourceCaches[b]),y(this._mergedSymbolSourceCaches[b]),u.images.some(w=>w.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(n,u,m){this.imageManager.rasterizeImages(u,m)}getGlyphs(n,u,m){this.glyphManager.getGlyphs(u.stacks,m)}getResource(n,u,m){return s.dz(u,m)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const u=[];return this._otherSourceCaches[n]&&u.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&u.push(this._symbolSourceCaches[n]),u}_isSourceCacheLoaded(n){const u=this.getOwnSourceCaches(n);return u.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${n}'`))),!1):u.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,u){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const m=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),y=n.type==="building";if(n.is3D(!!this.terrain)){if(m||y||u&&u.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}xs.getSourceType=function(p){return nl[p]},xs.setSourceType=function(p,n){nl[p]=n},xs.registerForPluginStateChange=s.dA;var Yp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Kp=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Yc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Kc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Qp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,zd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ds=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,dh=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,It=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,em=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,tm=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const fh=/#include\s+"([^"]+)"/g,La=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,im=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,pc=new Set(["ifdef","ifndef","elif","if","defined"]),mc=new Set;Fl(Yp,mc),Fl(Yc,mc),Fl(Kp,mc);const Ol={"_prelude_fog.vertex.glsl":zd,"_prelude_terrain.vertex.glsl":Qp,"_prelude_shadow.vertex.glsl":em,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Ds,"_prelude_shadow.fragment.glsl":tm,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":dh,"_prelude_raster_particle.glsl":It},Cd={};on("",Qp),on(Ds,zd),on(tm,em),on(dh,""),on(It,"");const Dy=on(Kp,Yc),Ld=Yp,yw=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Ld,Dy.fragmentSource].join(`
`),ky=["precision highp float;",Ld,Dy.vertexSource].join(`
`);var nm={background:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:on(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:on(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:on("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:on(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:on(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:on("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:on("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:on("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:on(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:on(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:on(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:on(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:on(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:on(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:on("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:on("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:on(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:on(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:on("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:on(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Kc),skyboxGradient:on(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Kc),skyboxCapture:on(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:on(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:on(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:on(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:on("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:on("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:on("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:on("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Fl(p,n){const u=p.split(`
`);for(let m of u){if(m=m.trimStart(),m[0]!=="#"||!m.includes("if")||m.startsWith("#endif"))continue;const y=m.match(im);if(y)for(const b of y)pc.has(b)||n.add(b)}}function on(p,n){const u=new Set,m=[],y=[];p=p.replace(fh,(w,E)=>(y.push(E),"")),n=n.replace(fh,(w,E)=>(m.push(E),""));let b=new Set(mc);Fl(p,b),Fl(n,b);for(const w of[...m,...y])Cd[w]||(Cd[w]=new Set,Fl(Ol[w],Cd[w])),b=new Set([...b,...Cd[w]]);return{fragmentSource:p=p.replace(La,(w,E,I,L,R)=>(u.add(R),E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
in ${I} ${L} ${R};
#else
uniform ${I} ${L} u_${R};
#endif
`:E==="initialize"?`
#ifdef HAS_UNIFORM_u_${R}
    ${I} ${L} ${R} = u_${R};
#endif
`:E==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${R}
    in ${I} ${L} ${R};
#endif
`:E==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(La,(w,E,I,L,R)=>{const N=`MATERIAL_ATTRIBUTE_OFFSET_${R}`,B=L==="float"?"vec2":L,U=`GET_ATTRIBUTE_${B}(a_${R}, materialInfo, ${N})`,W=R.match(/color/)?"color":B;return E==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${R}
in ${I} ${L} a_${R};
#endif
`:u.has(R)?E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
    #if !defined(${N})
        in ${I} ${B} a_${R};
    #endif
out ${I} ${L} ${R};
#else
uniform ${I} ${L} u_${R};
#endif
`:E==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${I} ${L} ${R} = u_${R};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${R})
    #ifdef ${N}
        ${R} = unpack_mix_${W}(${U}, u_${R}_t);
    #else
        ${R} = unpack_mix_${W}(a_${R}, u_${R}_t);
    #endif
#else
    ${I} ${L} ${R} = u_${R};
#endif
`:E==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${R}
    in ${I} ${L} a_${R};
    out ${I} ${L} ${R};
#endif
`:E==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${R}
    ${R} = a_${R};
#endif
`:void 0:E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
    #if !defined(${N})
        in ${I} ${B} a_${R};
    #endif
#else
uniform ${I} ${L} u_${R};
#endif
`:E==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${R}0;
in vec4 a_${R}1;
in vec4 a_${R}2;
in vec4 a_${R}3;
#else
uniform ${I} ${L} u_${R};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${I} ${B} a_${R};
#else
uniform ${I} ${L} u_${R};
#endif
`:E==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${R}
    ${I} ${L} ${R} = a_${R};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    #ifdef ${N}
        ${I} ${L} ${R} = ${U};
    #else
        ${I} ${L} ${R} = a_${R};
    #endif
#else
    ${I} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    #ifdef ${N}
        ${I} ${L} ${R} = unpack_mix_${W}(${U}, u_${R}_t);
    #else
        ${I} ${L} ${R} = unpack_mix_${W}(a_${R}, u_${R}_t);
    #endif
#else
    ${I} ${L} ${R} = u_${R};
#endif
`}),usedDefines:b,vertexIncludes:m,fragmentIncludes:y}}class vw{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,u,m,y,b,w,E,I){this.context=n;let L=this.boundPaintVertexBuffers.length!==y.length;for(let N=0;!L&&N<y.length;N++)this.boundPaintVertexBuffers[N]!==y[N]&&(L=!0);let R=this.boundDynamicVertexBuffers.length!==E.length;for(let N=0;!R&&N<E.length;N++)this.boundDynamicVertexBuffers[N]!==E[N]&&(R=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==m||L||R||this.boundIndexBuffer!==b||this.boundVertexOffset!==w)this.freshBind(u,m,y,b,w,E,I);else{n.bindVertexArrayOES.set(this.vao);for(const N of E)N&&(N.bind(),I&&N.instanceCount&&N.setVertexAttribDivisor(n.gl,u,I));b&&b.dynamicDraw&&b.bind()}}freshBind(n,u,m,y,b,w,E){const I=this.context,L=I.gl;this.vao&&this.destroy(),this.vao=I.gl.createVertexArray(),I.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=w,u.enableAttributes(L,n),u.bind(),u.setVertexAttribPointers(L,n,b);for(const R of m)R.enableAttributes(L,n),R.bind(),R.setVertexAttribPointers(L,n,b);for(const R of w)R&&(R.enableAttributes(L,n),R.bind(),R.setVertexAttribPointers(L,n,b),E&&R.instanceCount&&R.setVertexAttribDivisor(L,n,E));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function xw(p,n){const u=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new s.ae(0,m/u).toLngLat().lat,new s.ae(0,(m+1)/u).toLngLat().lat]}function bw(p,n,u,m,y,b,w){const E=p.context,I=E.gl,L=u.hillshadeFBO;if(!L)return;p.prepareDrawTile();const R=p.isTileAffectedByFog(n),N=[];p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&N.push("USE_MRT1");const B=p.getOrCreateProgram("hillshade",{overrideFog:R,defines:N});E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,L.colorAttachment0.get());const U=((K,oe,re,ne)=>{const be=re.paint.get("hillshade-shadow-color"),_e=re.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ve=re.paint.get("hillshade-highlight-color"),pe=re.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",he=re.paint.get("hillshade-accent-color"),Se=re.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ze=re.paint.get("hillshade-emissive-strength");let Re=s.an(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")Re-=K.transform.angle;else if(K.style&&K.style.enable3dLights()&&K.style.directionalLight){const je=K.style.directionalLight.properties.get("direction"),it=s.d4(je.x,je.y,je.z);Re=s.an(it[1])}const Ze=!K.options.moving;return{u_matrix:ne||K.transform.calculateProjMatrix(oe.tileID.toUnwrapped(),Ze),u_image:0,u_latrange:xw(0,oe.tileID),u_light:[re.paint.get("hillshade-exaggeration"),Re],u_shadow:be.toPremultipliedRenderColor(_e?null:re.lut),u_highlight:ve.toPremultipliedRenderColor(pe?null:re.lut),u_emissive_strength:ze,u_accent:he.toPremultipliedRenderColor(Se?null:re.lut)}})(p,u,m,p.terrain?n.projMatrix:null);p.uploadCommonUniforms(E,B,n.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:G,tileBoundsSegments:J}=p.getTileBoundsBuffers(u);B.draw(p,I.TRIANGLES,y,b,w,fi.disabled,U,m.id,W,G,J)}function rm(p,n,u){if(!n.needsDEMTextureUpload)return;const m=p.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||p.getTileTexture(u.stride);const b=u.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new s.T(m,b,y.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ww(p,n,u){const m=p.context,y=m.gl;if(!n.dem)return;const b=n.dem;if(m.activeTexture.set(y.TEXTURE1),rm(p,n,b),!n.demTexture)return;n.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const w=b.dim;m.activeTexture.set(y.TEXTURE0);let E=n.hillshadeFBO;if(!E){const B=new s.T(m,{width:w,height:w,data:null},y.RGBA8);B.bind(y.LINEAR,y.CLAMP_TO_EDGE),E=n.hillshadeFBO=m.createFramebuffer(w,w,1,"renderbuffer"),E.colorAttachment0.set(B.texture)}m.bindFramebuffer.set(E.framebuffer),m.viewport.set([0,0,w,w]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:L,tileBoundsSegments:R}=p.getMercatorTileBoundsBuffers(),N=[];p.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&N.push("USE_MRT1"),p.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(p,y.TRIANGLES,Qt.disabled,xi.disabled,Mi.unblended,fi.disabled,((B,U)=>{const W=U.stride,G=s.bC();return s.ce(G,0,s.al,-s.al,0,0,1),s.br(G,G,[0,-s.al,0]),{u_matrix:G,u_image:1,u_dimension:[W,W],u_zoom:B.overscaledZ}})(n.tileID,b),u.id,I,L,R),n.needsHillshadePrepare=!1}class Xn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Sw extends Xn{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Oy extends Xn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class om extends Xn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Rd extends Xn{getDefault(){return[!0,!0,!0,!0]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class sm extends Xn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class gc extends Xn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Qc extends Xn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const u=this.current;(n.func!==u.func||n.ref!==u.ref||n.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class ph extends Xn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class eu extends Xn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=n,this.dirty=!1}}class Fy extends Xn{getDefault(){return[0,1]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class am extends Xn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=n,this.dirty=!1}}class By extends Xn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class tu extends Xn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.BLEND):u.disable(u.BLEND),this.current=n,this.dirty=!1}}class Dd extends Xn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class kd extends Xn{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class lm extends Xn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Od extends Xn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=n,this.dirty=!1}}class mh extends Xn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Ny extends Xn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Uy=class extends Xn{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class $y extends Xn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class iu extends Xn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Vy extends Xn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Tw extends Xn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ew extends Xn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Iw extends Xn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class cm extends Xn{getDefault(){return null}set(n){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class um extends Xn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class hm extends Xn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class dm extends Xn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class jy extends Xn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Fd extends Xn{constructor(n,u){super(n),this.context=n,this.parent=u}getDefault(){return null}}class Bd extends Fd{constructor(n,u,m=0){super(n,u),this.attachmentPoint=n.gl.COLOR_ATTACHMENT0+m}setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachmentPoint,u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class nu extends Fd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class gh extends Fd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Gy extends nu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ks=(p,n,u,m)=>({u_matrix:p,u_image0:0,u_image1:1,u_skirt_height:n,u_ground_shadow_factor:u,u_emissive_texture_available:m}),Nd=(p,n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:u,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_image1:1,u_frustum_tl:w,u_frustum_tr:E,u_frustum_br:I,u_frustum_bl:L,u_globe_pos:R,u_globe_radius:N,u_viewport:B,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:U,u_far_z_cutoff:W,u_emissive_texture_available:G});function _h(p,n){return p!=null&&n!=null&&!(!p.hasData()||!n.hasData())&&p.demTexture!=null&&n.demTexture!=null&&p.tileID.key!==n.tileID.key}const ul=new class{constructor(){this.operations={}}newMorphing(p,n,u,m,y){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[p]={startTime:m,phase:0,duration:y,from:n,to:u,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const n=this.operations[p];return{from:n.from,to:n.to,phase:n.phase}}update(p){for(const n in this.operations){const u=this.operations[n];for(u.phase=(p-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,p)){delete this.operations[n];break}}}_nextOp(p,n){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=n,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Ud={0:null,1:"TERRAIN_VERTEX_MORPHING"};function $d(p,n,u){if(n===0)return 0;const m=n<1&&u===514?.25/n:1;return 6*Math.pow(1.5,22-p)*Math.max(n,1)*m}function fm(p,n){const u=1<<p.z;return!n&&(p.x===0||p.x===u-1)||p.y===0||p.y===u-1}function ru(p,n){if(!p.style||!p.style.enable3dLights())return;const u=p.context,m=u.gl;u.activeTexture.set(m.TEXTURE1),n?n.bind(m.LINEAR,m.CLAMP_TO_EDGE):p.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}const yh=p=>({u_matrix:p});function vh(p,n,u,m,y){if(y>0){const b=s.o.now(),w=(b-p.timeAdded)/y,E=n?(b-n.timeAdded)/y:-1,I=u.getSource(),L=m.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),R=!n||Math.abs(n.tileID.overscaledZ-L)>Math.abs(p.tileID.overscaledZ-L),N=R&&p.refreshedUponExpiration?1:s.aA(R?w:1-E,0,1);return n?{opacity:1,mix:1-N,isFading:w<1}:{opacity:N,mix:0,isFading:w<1}}return{opacity:1,mix:0,isFading:!1}}class Vd extends es{constructor(n){const u=cc("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",u,!1),u.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,u){n.state="loaded",u(null)}}class pm extends es{constructor(n){const u=cc("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,u,m){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,w)=>{if(b[w.key]="",!this._tiles[w.key]){const E=new Pl(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);E.state="loaded",this._tiles[w.key]=E}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const u=this.proxyCachedFBO[n];if(u!==void 0){const m=Object.values(u);this.renderCachePool.push(...m),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class mm extends s.aQ{constructor(n,u,m){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=u,this.projMatrix=m}}class gm extends s.bV{constructor(n,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,b]=(function(){const I=new s.bd,L=new s.b0,R=131;I.reserve(17161),L.reserve(33800);const N=s.al/128,B=s.al+N/2,U=B+N;for(let G=-N;G<U;G+=N)for(let J=-N;J<U;J+=N){const K=J<0||J>B||G<0||G>B?24575:0,oe=s.aA(Math.round(J),0,s.al),re=s.aA(Math.round(G),0,s.al);I.emplaceBack(oe+K,re)}const W=(G,J)=>{const K=J*R+G;L.emplaceBack(K+1,K,K+R),L.emplaceBack(K+R,K+R+1,K+1)};for(let G=1;G<129;G++)for(let J=1;J<129;J++)W(J,G);return[0,129].forEach(G=>{for(let J=0;J<130;J++)W(J,G),W(G,J)}),[I,L,32768]})(),w=n.context;this.gridBuffer=w.createVertexBuffer(m,s.bf.members),this.gridIndexBuffer=w.createIndexBuffer(y),this.gridSegments=s.bg.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,m.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new pm(u.map),this.orthoMatrix=s.bC(),s.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const E=w.gl;this._overlapStencilMode=new xi({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Vd(u.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,u,m){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const y=n.terrain.properties,b=n.terrain.drapeRenderMode===0,w=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const E=n.terrain&&n.terrain.scope,I=y.get("source"),L=b?this._mockSourceCache:n.getSourceCache(I,E);if(!L)return void s.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=L,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(u):y.get("exaggeration"),!u.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const R=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(u,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),u.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const u=this._previousCameraAltitude,m=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=m;const y=u!=null?m-u:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=n.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(b);let E=b-this._previousZoom;const I=this._previousUpdateTimestamp;let L=b;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(b-L)>.5&&(E=.5*(b-L+E)),E*y<0&&(L+=E)),this._evaluationZoom=L;const R=w.getExaggeration(L),N=R===w.getExaggeration(Math.max(0,L-.1));if(N&&Math.abs(R-this._exaggeration)<.01)return R;let B=Math.min(.1,.00375*(this._updateTimestamp-I));return(N||R<.1||Math.abs(E)<1e-4)&&(B=Math.min(.2,4*B)),s.ak(this._exaggeration,R,B)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=u.getIds().map(I=>{const L=u.getTileByID(I).tileID;return L.projMatrix=m.calculateProjMatrix(L.toUnwrapped()),L});(function(I,L){const R=L.transform.pointCoordinate(L.transform.getCameraPoint()),N=new s.P(R.x,R.y);I.sort((B,U)=>{if(U.overscaledZ-B.overscaledZ)return U.overscaledZ-B.overscaledZ;const W=new s.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),G=new s.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),J=N.mult(1<<B.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(W)-J.distSqr(G)})})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const I in w){const L=w[I];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,n[I],b),L.usedForTerrain))continue;const R=n[I];L.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[u.id]=y.map(I=>new mm(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const L=this.terrainTileForTile[I.key];if(!L)continue;const R=L.tileID.key;R in E||(this._visibleDemTiles.push(L),E[R]=R)}}_assignTerrainTiles(n){this._initializing||n.forEach(u=>{if(this.terrainTileForTile[u.key])return;const m=this._findTileCoveringTileID(u,this.sourceCache);m&&(this.terrainTileForTile[u.key]=m)})}_prepareDEMTextures(){const n=this.painter.context,u=n.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(u.TEXTURE1),rm(this.painter,y,b))}}_prepareDemTileUniforms(n,u,m,y){if(!u||u.demTexture==null)return!1;const b=n.tileID.canonical,w=Math.pow(2,u.tileID.canonical.z-b.z),E=y||"";return m[`u_dem_tl${E}`]=[b.x*w%1,b.y*w%1],m[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const u=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const b=y.dem.tree.minimums[0];return b>0&&n++,m+b},0);return n?u/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,u=n.gl;n.activeTexture.set(u.TEXTURE2);const m=this._getLoadedAreaMinimum(),y=new s.dL({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new s.T(n,y,u.R32F,{premultiply:!1}),b}setupElevationDraw(n,u,m){const y=this.painter.context,b=y.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let E=null,I=null,L=1;if(m&&m.morphing&&this._useVertexMorphing){const U=m.morphing.srcDemTile,W=m.morphing.dstDemTile;L=m.morphing.phase,U&&W&&(this._prepareDemTileUniforms(n,U,w,"_prev")&&(I=U),this._prepareDemTileUniforms(n,W,w)&&(E=W))}const R=U=>U&&U.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let N=null;var B;if(this.enabled?I&&E?(N=E.demTexture,y.activeTexture.set(b.TEXTURE4),I.demTexture.bind(R(I),b.CLAMP_TO_EDGE),w.u_dem_lerp=L):(E=this.terrainTileForTile[n.tileID.key],N=this._prepareDemTileUniforms(n,E,w)?E.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),N&&(w.u_dem_size=(B=N).size[0]===1?1:B.size[0]-2,N.bind(R(E),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,u,w),m&&m.useMeterToDem&&E){const U=(1<<E.tileID.canonical.z)*s.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=U}if(m&&m.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),u.setTerrainUniformValues(y,w),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,n.tileID.canonical,m&&m.useDenormalizedUpVectorScale);u.setGlobeUniformValues(y,U)}}globeUniformValues(n,u,m){const y=n.projection;return{u_tile_tl_up:y.upVector(u,0,0),u_tile_tr_up:y.upVector(u,s.al,0),u_tile_br_up:y.upVector(u,s.al,s.al),u_tile_bl_up:y.upVector(u,0,s.al),u_tile_up_scale:m?s.dM(1):y.upVectorScale(u,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const u=this.painter,m=this.painter.context;n.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(y,b,w,E,I){if(y.transform.projection.name==="globe")(function(L,R,N,B,U){const W=L.context,G=W.gl;let J,K;const oe=L.transform,re=s.dE(L,W,oe),ne=(Ze,je)=>{if(K===je)return;const it=[Ud[je],"PROJECTION_GLOBE_VIEW"];re&&it.push("CUSTOM_ANTIALIASING");const dt=L.isTileAffectedByFog(Ze);J=L.getOrCreateProgram("globeRaster",{defines:it,overrideFog:dt}),K=je},be=L.colorModeForRenderPass(),_e=new Qt(G.LEQUAL,Qt.ReadWrite,L.depthRangeFor3D);ul.update(U);const ve=s.dF(oe),pe=[s.aF(oe.center.lng),s.aJ(oe.center.lat)],he=L.globeSharedBuffers,Se=[oe.width*s.o.devicePixelRatio,oe.height*s.o.devicePixelRatio],ze=Float32Array.from(oe.globeMatrix),Re={useDenormalizedUpVectorScale:!0};{const Ze=L.transform,je=$d(Ze.zoom,R.exaggeration(),R.sourceCache._source.tileSize);K=-1;const it=G.TRIANGLES;for(const dt of B){const Fe=N.getTile(dt),Te=xi.disabled,Ke=R.prevTerrainTileForTile[dt.key],We=R.terrainTileForTile[dt.key];_h(Ke,We)&&ul.newMorphing(dt.key,Ke,We,U,250),ru(L,Fe.emissiveTexture),W.activeTexture.set(G.TEXTURE0),Fe.texture&&Fe.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const pt=ul.getMorphValuesForProxy(dt.key),vt=pt?1:0;pt&&Object.assign(Re,{morphing:{srcDemTile:pt.from,dstDemTile:pt.to,phase:s.dD(pt.phase)}});const Pt=s.dG(dt.canonical),xt=s.dH(Pt.getCenter().lat),St=s.dI(dt.canonical,Pt,xt,Ze.worldSize/Ze._pixelsPerMercatorPixel),Xt=s.bk(s.dJ(dt.canonical)),Ht=L.emissiveMode==="mrt-fallback"?1:0,Rt=Nd(Ze.expandedFarZProjMatrix,ze,ve,Xt,s.aj(Ze.zoom),pe,Ze.frustumCorners.TL,Ze.frustumCorners.TR,Ze.frustumCorners.BR,Ze.frustumCorners.BL,Ze.globeCenterInViewSpace,Ze.globeRadius,Se,je,Ze._farZ,Ht,St);if(ne(dt,vt),J&&(R.setupElevationDraw(Fe,J,Re),L.uploadCommonUniforms(W,J,dt.toUnwrapped()),he)){const[Gt,si,pi]=he.getGridBuffers(xt,je!==0);J.draw(L,it,_e,Te,be,fi.backCCW,Rt,"globe_raster",Gt,si,pi)}}}if(he&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const Ze=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Ze.push("CUSTOM_ANTIALIASING"),J=L.getOrCreateProgram("globeRaster",{defines:Ze});for(const je of B){const{x:it,y:dt,z:Fe}=je.canonical,Te=dt===0,Ke=dt===(1<<Fe)-1,[We,pt,vt,Pt]=he.getPoleBuffers(Fe,!1);if(Pt&&(Te||Ke)){const xt=N.getTile(je);ru(L,xt.emissiveTexture),W.activeTexture.set(G.TEXTURE0),xt.texture&&xt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let St=s.dK(Fe,it,oe);const Xt=s.bk(s.dJ(je.canonical)),Ht=L.emissiveMode==="mrt-fallback"?1:0,Rt=(Gt,si)=>Gt.draw(L,G.TRIANGLES,_e,xi.disabled,be,fi.disabled,Nd(oe.expandedFarZProjMatrix,St,St,Xt,0,pe,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Se,0,oe._farZ,Ht),"globe_pole_raster",si,vt,Pt);R.setupElevationDraw(xt,J,Re),L.uploadCommonUniforms(W,J,je.toUnwrapped()),Te&&L.renderDefaultNorthPole&&Rt(J,We),Ke&&L.renderDefaultSouthPole&&(St=s.cS(s.bC(),St,[1,-1,1]),Rt(J,pt))}}}})(y,b,w,E,I);else{const L=y.context,R=L.gl;let N,B;const U=y.shadowRenderer,W=ia(y,y.longestCutoffRange),G=be=>{if(B===be)return;const _e=[];_e.push(Ud[be]),W.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),U&&(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&_e.push("NORMAL_OFFSET")),N=y.getOrCreateProgram("terrainRaster",{defines:_e}),B=be},J=y.colorModeForRenderPass(),K=new Qt(R.LEQUAL,Qt.ReadWrite,y.depthRangeFor3D);ul.update(I);const oe=y.transform,re=$d(oe.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let ne=[0,0,0];if(U){const be=y.style.directionalLight,_e=y.style.ambientLight;be&&_e&&(ne=na(y.style,be,_e))}{B=-1;const be=R.TRIANGLES,[_e,ve]=[b.gridIndexBuffer,b.gridSegments];for(const pe of E){const he=w.getTile(pe),Se=xi.disabled,ze=b.prevTerrainTileForTile[pe.key],Re=b.terrainTileForTile[pe.key];_h(ze,Re)&&ul.newMorphing(pe.key,ze,Re,I,250),ru(y,he.emissiveTexture),L.activeTexture.set(R.TEXTURE0),he.texture&&he.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const Ze=ul.getMorphValuesForProxy(pe.key),je=Ze?1:0;let it;Ze&&(it={morphing:{srcDemTile:Ze.from,dstDemTile:Ze.to,phase:s.dD(Ze.phase)}});const dt=y.emissiveMode==="mrt-fallback"?1:0,Fe=ks(pe.projMatrix,fm(pe.canonical,oe.renderWorldCopies)?re/10:re,ne,dt);if(G(je),!N)continue;b.setupElevationDraw(he,N,it);const Te=pe.toUnwrapped();U&&U.setupShadows(Te,N),y.uploadCommonUniforms(L,N,Te,null,W),N.draw(y,be,K,Se,J,fi.backCCW,Fe,"terrain_raster",b.gridBuffer,_e,ve)}}}})(u,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const u=this.painter,m=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],w=this._drapedRenderBatches.shift(),E=u.style.order,I=[];this._updateFBOs(u.emissiveMode==="mrt-fallback");let L=0;for(const R of b){const N=y.getTileByID(R.proxyTileKey),B=y.proxyCachedFBO[R.key]?y.proxyCachedFBO[R.key][n]:void 0,U=B!==void 0?y.renderCache[B]:this.pool[L++],W=B!==void 0;if(N.texture=U.tex,N.emissiveTexture=U.emissiveTex,W&&!U.dirty){I.push(N.tileID);continue}m.bindFramebuffer.set(U.fb.framebuffer);const G=m.gl;let J;G.drawBuffers(u.emissiveMode==="mrt-fallback"?[G.COLOR_ATTACHMENT0,G.COLOR_ATTACHMENT1]:[G.COLOR_ATTACHMENT0]),this.renderedToTile=!1,U.dirty&&(m.clear({color:s.ao.transparent,stencil:0}),U.dirty=!1);for(let K=w.start;K<=w.end;++K){const oe=u.style._mergedLayers[E[K]];if(oe.isHidden(u.transform.zoom))continue;const re=u.style.getLayerSourceCache(oe),ne=re?this.proxyToSource[R.key][re.id]:[R];if(!ne)continue;const be=ne;m.viewport.set([0,0,U.fb.width,U.fb.height]),J!==(re?re.id:null)&&(this._setupStencil(U,ne,oe,re),J=re?re.id:null),u.renderLayer(u,re,oe,be)}if(G.drawBuffers([G.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const K of this._pendingGroundEffectLayers){const oe=u.style._mergedLayers[E[K]];if(oe.isHidden(u.transform.zoom))continue;const re=u.style.getLayerSourceCache(oe),ne=re?this.proxyToSource[R.key][re.id]:[R];if(!ne)continue;const be=ne;m.viewport.set([0,0,U.fb.width,U.fb.height]),J!==(re?re.id:null)&&(this._setupStencil(U,ne,oe,re),J=re?re.id:null),u.renderLayer(u,re,oe,be)}this.renderedToTile?(U.dirty=!0,I.push(N.tileID)):W||--L,L===5&&(L=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),w.end+1}postRender(){}isLayerOrderingCorrect(n){const u=n.order.length;let m=-1,y=u;for(let b=0;b<u;++b)this._style.isLayerDraped(n._mergedLayers[n.order[b]])?m=Math.max(m,b):y=Math.min(y,b);return y>m}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{n=Math.min(n,u.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,u,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const w=b.tileID,E=1<<w.overscaledZ,{x:I,y:L}=w.canonical,R=I/E,N=(I+1)/E,B=L/E,U=(L+1)/E;return{minx:R,miny:B,maxx:N,maxy:U,t:b.dem.tree.raycastRoot(R,B,N,U,n,u,m),tile:b}});y.sort((b,w)=>(b.t!==null?b.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const w=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,u,m);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,u=n.gl,m=this.drapeBufferSize;n.activeTexture.set(u.TEXTURE0);const y=new s.T(n,{width:m[0],height:m[1],data:null},u.RGBA8);y.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=n.createFramebuffer(m[0],m[1],1,null);let w;return b.colorAttachment0.set(y.texture),this._emissiveTexture&&(w=new s.T(n,{width:m[0],height:m[1],data:null},u.R8),w.bind(u.LINEAR,u.CLAMP_TO_EDGE),b.createColorAttachment(n,1),b.colorAttachment1.set(w.texture)),b.depthAttachment=new Gy(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:y,emissiveTex:w,dirty:!1}}_updateFBOs(n){if(this._emissiveTexture!==n){for(const u of this.pool)this._updateFBO(u,n);for(const u of this.proxySourceCache.renderCache)this._updateFBO(u,n);this._emissiveTexture=n}}_updateFBO(n,u){const m=n.fb,y=this.painter.context,b=y.gl,w=this.drapeBufferSize;if(u){const E=new s.T(y,{width:w[0],height:w[1],data:null},b.R8);E.bind(b.LINEAR,b.CLAMP_TO_EDGE),n.emissiveTex=E,m.createColorAttachment(y,1),m.colorAttachment1.set(E.texture)}else n.emissiveTex=void 0,m.removeColorAttachment(y,1);n.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const u=this._style._mergedLayers[n],m=u.isHidden(this.painter.transform.zoom);return u.type==="hillshade"||u.type==="custom"?!m&&u.shouldRedrape():!m&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const m of this._style.getSources())if(m instanceof ea){n=!0;break}if(!n)return;const u={};for(let m=0;m<this._style.order.length;++m){const y=this._style._mergedLayers[this._style.order[m]],b=this._style.getLayerSourceCache(y);if(!b||u[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="line")continue;const w=y.widthExpression(),E=y.emissiveStrengthExpression();if(w instanceof s.ad||E instanceof s.ad){u[b.id]=!0;for(const I of this.proxyCoords){const L=this.proxyToSource[I.key][b.id];if(L)for(const R of L)this._clearRenderCacheForTile(b.id,R)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof fa){n=!0;break}if(!n)return;const u={};for(let m=0;m<this._style.order.length;++m){const y=this._style._mergedLayers[this._style.order[m]],b=this._style.getLayerSourceCache(y);if(!b||u[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const w=y.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const I=this.proxyToSource[E.key][b.id];if(I)for(const L of I){const R=vh(b.getTile(L),b.findLoadedParent(L,0),b,this.painter.transform,w);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(b.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,u=n.length;if(u===0)return;const m=[];this._pendingGroundEffectLayers=[];let y,b=0,w=this._style._mergedLayers[n[b]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++b<u;)w=this._style._mergedLayers[n[b]];for(;b<u;++b){const E=this._style._mergedLayers[n[b]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?y===void 0&&(y=b):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(m.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&m.push({start:y,end:b-1}),m.length!==0){const E=m[m.length-1];this._pendingGroundEffectLayers.every(I=>I>E.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(n){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const w=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let E=0;E<w.length;++E){const I=Object.values(w[E]);u.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let w=m.length-1;w>=0;w--){const E=m[w];if(u.getTileByID(E.key),u.proxyCachedFBO[E.key]!==void 0){const I=n[E.key],L=this.proxyToSource[E.key];let R=0;for(const N in L){const B=L[N],U=I[N];if(!U||U.length!==B.length||B.some((W,G)=>W!==U[G]||y[N]&&y[N].hasOwnProperty(W.key))){R=-1;break}++R}for(const N in u.proxyCachedFBO[E.key])u.renderCache[u.proxyCachedFBO[E.key][N]].dirty=R<0||R!==Object.values(I).length}}const b=[...this._drapedRenderBatches];b.sort((w,E)=>E.end-E.start-(w.end-w.start));for(const w of b)for(const E of m){if(u.proxyCachedFBO[E.key])continue;let I=u.renderCachePool.pop();I===void 0&&u.renderCache.length<50&&(I=u.renderCache.length,u.renderCache.push(this._createFBO())),I!==void 0&&(u.proxyCachedFBO[E.key]={},u.proxyCachedFBO[E.key][w.start]=I,u.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(n,u,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,w=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let E;if(m.isTileClipped())E=u.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):xi.disabled}_renderTileClippingMasks(n,u){const m=this.painter,y=this.painter.context,b=y.gl;m._tileClippingMaskIDs={},y.setColorMode(Mi.disabled),y.setDepthMode(Qt.disabled);const w=m.getOrCreateProgram("clippingMask");for(const E of n){const I=m._tileClippingMaskIDs[E.key]=--u;w.draw(m,b.TRIANGLES,Qt.disabled,new xi({func:b.ALWAYS,mask:0},I,255,b.KEEP,b.KEEP,b.REPLACE),Mi.disabled,fi.disabled,yh(E.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(n){const u=this.painter.transform;if(n.x<0||n.x>u.width||n.y<0||n.y>u.height)return null;const m=[n.x,n.y,1,1];s.aC(m,m,u.pixelMatrixInverse),s.cK(m,m,1/m[3]),m[0]/=u.worldSize,m[1]/=u.worldSize;const y=u._camera.position,b=s.cf(1,u.center.lat),w=[y[0],y[1],y[2]/b,0],E=s.da([],m.slice(0,3),w);s.aw(E,E);const I=this.raycast(w,E,this._exaggeration);return I!==null&&I?(s.bH(w,w,E,I),w[3]=w[2],w[2]*=b,w):null}_setupProxiedCoordsForOrtho(n,u,m){if(n.getSource()instanceof s.aU)return this._setupProxiedCoordsForImageSource(n,u,m);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let I=0;I<b.length;I++){const L=b[I],R=this._findTileCoveringTileID(L,n);if(R){const N=this._createProxiedId(L,R,m[L.key]&&m[L.key][n.id]);y.push(N),this.proxyToSource[L.key][n.id]=[N]}}let w=!1;const E=new Set;for(let I=0;I<u.length;I++){const L=n.getTile(u[I]);if(!L||!L.hasData())continue;const R=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==L.tileID.canonical.z){const N=this.proxyToSource[R.tileID.key][n.id],B=this._createProxiedId(R.tileID,L,m[R.tileID.key]&&m[R.tileID.key][n.id]);N?N.splice(N.length-1,0,B):this.proxyToSource[R.tileID.key][n.id]=[B];const U=this.proxyToSource[R.tileID.key][n.id];E.has(U)||E.add(U),y.push(B),w=!0}}if(this._sourceTilesOverlap[n.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const I of E)I.sort((L,R)=>R.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(n,u,m){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords,w=n.getSource(),E=w.tileID;if(!E)return;const I=new s.P(E.x,E.y)._div(1<<E.z),L=w.coordinates.map(s.ae.fromLngLat).reduce((N,B)=>(N.min.x=Math.min(N.min.x,B.x-I.x),N.min.y=Math.min(N.min.y,B.y-I.y),N.max.x=Math.max(N.max.x,B.x-I.x),N.max.y=Math.max(N.max.y,B.y-I.y),N),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(N,B)=>{const U=N.wrap+N.canonical.x/(1<<N.canonical.z),W=N.canonical.y/(1<<N.canonical.z),G=s.al/(1<<N.canonical.z),J=B.wrap+B.canonical.x/(1<<B.canonical.z),K=B.canonical.y/(1<<B.canonical.z);return U+G<J+L.min.x||U>J+L.max.x||W+G<K+L.min.y||W>K+L.max.y};for(let N=0;N<b.length;N++){const B=b[N];for(let U=0;U<u.length;U++){const W=n.getTile(u[U]);if(!W||!W.hasData()||R(B,W.tileID))continue;const G=this._createProxiedId(B,W,m[B.key]&&m[B.key][n.id]),J=this.proxyToSource[B.key][n.id];J?J.push(G):this.proxyToSource[B.key][n.id]=[G],y.push(G)}}}_createProxiedId(n,u,m){let y=this.orthoMatrix;if(m){const b=m.find(w=>w.key===u.tileID.key);if(b)return b}if(u.tileID.key!==n.key){const b=n.canonical.z-u.tileID.canonical.z;let w,E,I;y=s.bC();const L=u.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(w=s.al>>b,E=w*((u.tileID.canonical.x<<b)-n.canonical.x+L),I=w*((u.tileID.canonical.y<<b)-n.canonical.y)):(w=s.al<<-b,E=s.al*(u.tileID.canonical.x-(n.canonical.x+L<<-b)),I=s.al*(u.tileID.canonical.y-(n.canonical.y<<-b))),s.ce(y,0,w,0,w,0,1),s.br(y,y,[E,I,0])}return new mm(u.tileID,n.key,y)}_findTileCoveringTileID(n,u){let m=u.getTile(n);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[u.id],b=y[n.key];if(m=b?u.getTileByID(b):null,m&&m.hasData()||b===null)return m;let w=m?m.tileID:n,E=w.overscaledZ;const I=u.getSource().minzoom,L=[];if(!b){const N=u.getSource().maxzoom;if(n.canonical.z>=N){const B=n.canonical.z-N;u.getSource().reparseOverscaled?(E=Math.max(n.canonical.z+2,u.transform.tileZoom),w=new s.aQ(E,n.wrap,N,n.canonical.x>>B,n.canonical.y>>B)):B!==0&&(E=N,w=new s.aQ(E,n.wrap,N,n.canonical.x>>B,n.canonical.y>>B))}w.key!==n.key&&(L.push(w.key),m=u.getTile(w))}const R=N=>{L.forEach(B=>{y[B]=N}),L.length=0};for(E-=1;E>=I&&(!m||!m.hasData());E--){m&&R(m.tileID.key);const N=w.calculateScaledKey(E);if(m=u.getTileByID(N),m&&m.hasData())break;const B=y[N];if(B===null)break;B===void 0?L.push(N):m=u.getTileByID(B)}return R(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,u){let m=this._tilesDirty[n];m||(m=this._tilesDirty[n]={}),m[u.key]=!0}}function ou(p,n,u){const m=(function(E,I,L){const R=s.bJ(I,E),N=s.bJ(L,[.2126,.7152,.0722]),B=(W,G,J)=>(1-J)*W+J*G,U=B(1-.3*Math.min(N,1),1,Math.min(R+1,1));return B(.92,1,Math.asin(s.aA(I[2],-1,1))/Math.PI+.5)*U})(p,[0,0,1],n),y=[0,0,0];s.c5(y,u.slice(0,3),m);const b=[0,0,0];s.c5(b,n.slice(0,3),p[2]);const w=[0,0,0];return s.d8(w,y,b),s.db(w)}const Mw=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Aw=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Hy{static cacheKey(n,u,m,y){const b=[u];y&&b.push(y.cacheKey);for(const w of m)n.usedDefines.has(w)&&b.push(w);return b.join("/")}constructor(n,u,m,y,b,w){const E=n.gl;this.program=E.createProgram(),this.configuration=y,this.name=u,this.fixedDefines=[...w];const I=`#version 300 es
${(y?y.defines():[]).concat(w.map(G=>`#define ${G}`)).join(`
`)}`,L=[I,yw];for(const G of m.fragmentIncludes)L.push(Ol[G]);L.push(m.fragmentSource);const R=L.join(`
`),N=[I,ky];for(const G of m.vertexIncludes)N.push(Ol[G]);this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&m.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&N.push("uniform int u_instanceID;"),N.push(m.vertexSource);let B=N.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(B=B.replaceAll("gl_InstanceID","u_instanceID"));const U=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(U,R),E.compileShader(U),E.attachShader(this.program,U);const W=E.createShader(E.VERTEX_SHADER);E.isContextLost()?this.failedToCreate=!0:(E.shaderSource(W,B),E.compileShader(W),E.attachShader(this.program,W),this.attributes={},E.linkProgram(this.program),E.deleteShader(W),E.deleteShader(U),this.fixedUniforms=b(n),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=y?y.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(G=>({u_instanceID:new s.ch(G)}))(n)),(w.includes("TERRAIN")||u.includes("symbol")||u.includes("circle"))&&(this.terrainUniforms=(G=>({u_dem:new s.ch(G),u_dem_prev:new s.ch(G),u_dem_tl:new s.ck(G),u_dem_scale:new s.cj(G),u_dem_tl_prev:new s.ck(G),u_dem_scale_prev:new s.cj(G),u_dem_size:new s.cj(G),u_dem_lerp:new s.cj(G),u_exaggeration:new s.cj(G),u_depth:new s.ch(G),u_depth_size_inv:new s.ck(G),u_depth_range_unpack:new s.ck(G),u_occluder_half_size:new s.cj(G),u_occlusion_depth_offset:new s.cj(G),u_meter_to_dem:new s.cj(G),u_label_plane_matrix_inv:new s.cl(G)}))(n)),w.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new s.ci(G),u_tile_tr_up:new s.ci(G),u_tile_br_up:new s.ci(G),u_tile_bl_up:new s.ci(G),u_tile_up_scale:new s.cj(G)}))(n)),w.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new s.cl(G),u_fog_range:new s.ck(G),u_fog_color:new s.d3(G),u_fog_horizon_blend:new s.cj(G),u_fog_vertical_limit:new s.ck(G),u_fog_temporal_offset:new s.cj(G),u_frustum_tl:new s.ci(G),u_frustum_tr:new s.ci(G),u_frustum_br:new s.ci(G),u_frustum_bl:new s.ci(G),u_globe_pos:new s.ci(G),u_globe_radius:new s.cj(G),u_globe_transition:new s.cj(G),u_is_globe:new s.ch(G),u_viewport:new s.ck(G)}))(n)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new s.d3(G)}))(n)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new s.ci(G),u_lighting_directional_dir:new s.ci(G),u_lighting_directional_color:new s.ci(G),u_ground_radiance:new s.ci(G)}))(n)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new s.cl(G),u_light_matrix_1:new s.cl(G),u_fade_range:new s.ck(G),u_shadow_normal_offset:new s.ci(G),u_shadow_intensity:new s.cj(G),u_shadow_texel_size:new s.cj(G),u_shadow_map_resolution:new s.cj(G),u_shadow_direction:new s.ci(G),u_shadow_bias:new s.ci(G),u_shadowmap_0:new s.ch(G),u_shadowmap_1:new s.ch(G)}))(n)))}getAttributeLocation(n,u){let m=this.attributes[u];return m===void 0&&(m=this.attributes[u]=n.getAttribLocation(this.program,u)),m}setTerrainUniformValues(n,u){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)m[y]&&m[y].set(this.program,y,u[y])}}setGlobeUniformValues(n,u){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)m[y]&&m[y].set(this.program,y,u[y])}}setFogUniformValues(n,u){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)m[y].set(this.program,y,u[y])}}setCutoffUniformValues(n,u){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)m[y].set(this.program,y,u[y])}}setLightsUniformValues(n,u){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)m[y].set(this.program,y,u[y])}}setShadowUniformValues(n,u){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;n.program.set(this.program);for(const y in u)m[y].set(this.program,y,u[y])}_drawDebugWireframe(n,u,m,y,b,w,E,I,L,R){const N=n.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;const B=n.context;if(!(!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||n._terrain&&n._terrain.renderingToTexture||!Mw.includes(this.name))||!(!N.layers3D||!Aw.includes(this.name))))return;const U=B.gl,W=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,b,B);if(!W)return;const G=[...this.fixedDefines,"DEBUG_WIREFRAME"],J=n.getOrCreateProgram(this.name,{config:this.configuration,defines:G});B.program.set(J.program);const K=(ne,be,_e)=>{if(be[ne]&&_e[ne])for(const ve in be[ne])_e[ne][ve]&&_e[ne][ve].set(_e.program,ve,be[ne][ve].current)};L&&L.setUniforms(J.program,B,J.binderUniforms,E,{zoom:I}),K("fixedUniforms",this,J),K("terrainUniforms",this,J),K("globeUniforms",this,J),K("fogUniforms",this,J),K("lightsUniforms",this,J),K("shadowUniforms",this,J),W.bind(),B.setColorMode(new Mi([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],s.ao.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Qt(u.func===U.LESS?U.LEQUAL:u.func,Qt.ReadOnly,u.range)),B.setStencilMode(xi.disabled);const oe=3*w.primitiveLength*2,re=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ne=R||1;for(let be=0;be<ne;++be)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),U.drawElements(U.LINES,oe,U.UNSIGNED_SHORT,re)}else R&&R>1?U.drawElementsInstanced(U.LINES,oe,U.UNSIGNED_SHORT,re,R):U.drawElements(U.LINES,oe,U.UNSIGNED_SHORT,re);b.bind(),B.program.set(this.program),B.setDepthMode(u),B.setStencilMode(m),B.setColorMode(y)}checkUniforms(n,u,m){if(this.fixedDefines.includes(u)){for(const y of Object.keys(m))if(!m[y].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${y} not set but required by ${u} being defined`)}}draw(n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J){const K=n.context,oe=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(m),K.setStencilMode(y),K.setColorMode(b),K.setCullFace(w);for(const[pe,he]of this.fixedUniformsEntries)he.set(this.program,pe,E[pe]);W&&W.setUniforms(this.program,K,this.binderUniforms,B,{zoom:U});const re={[oe.POINTS]:1,[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[u];this.checkUniforms(I,"RENDER_SHADOWS",this.shadowUniforms);const ne=G||[],be=W?W.getPaintVertexBuffers():[],_e=u===oe.TRIANGLES&&R,ve=J&&J>0?1:void 0;for(const pe of N.get()){const he=pe.vaos||(pe.vaos={});if((he[I]||(he[I]=new vw)).bind(K,this,L,be,R,pe.vertexOffset,ne,ve),this.forceManualRenderingForInstanceIDShaders){const Se=J||1;for(let ze=0;ze<Se;++ze)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ze),R?oe.drawElements(u,pe.primitiveLength*re,oe.UNSIGNED_SHORT,pe.primitiveOffset*re*2):oe.drawArrays(u,pe.vertexOffset,pe.vertexLength)}else J&&J>1?oe.drawElementsInstanced(u,pe.primitiveLength*re,oe.UNSIGNED_SHORT,pe.primitiveOffset*re*2,J):R?oe.drawElements(u,pe.primitiveLength*re,oe.UNSIGNED_SHORT,pe.primitiveOffset*re*2):oe.drawArrays(u,pe.vertexOffset,pe.vertexLength);_e&&this._drawDebugWireframe(n,m,y,b,R,pe,B,U,W,J)}}}function Zy(p,n,u=0){const m=Math.pow(2,n.tileID.overscaledZ),y=n.tileSize*Math.pow(2,p.transform.tileZoom)/m,b=y*(n.tileID.canonical.x+n.tileID.wrap*m),w=y*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(n,1,p.transform.tileZoom),u_pixel_coord_upper:[b>>16,w>>16],u_pixel_coord_lower:[65535&b,65535&w],u_pattern_transition:u}}const jd={terrain:0,flat:1},Pw=s.bC(),Gd=(p,n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J,K)=>{const oe=n.style.light,re=oe.properties.get("position"),ne=[re.x,re.y,re.z],be=s.dO();oe.properties.get("anchor")==="viewport"&&(s.dP(be,-n.transform.angle),s.dQ(ne,ne,be));const _e=oe.properties.get("color").toPremultipliedRenderColor(null),ve=n.transform,pe={u_matrix:p,u_lightpos:ne,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+u,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Pw,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:jd[L],u_base_type:jd[R],u_ao:y,u_edge_radius:b,u_width_scale:w,u_flood_light_color:W,u_vertical_scale:G,u_flood_light_intensity:J,u_ground_shadow_factor:K};return ve.projection.name==="globe"&&(pe.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],pe.u_zoom_transition=N,pe.u_inv_rot_matrix=U,pe.u_merc_center=B,pe.u_up_dir=ve.projection.upVector(new s.cD(0,0,0),B[0]*s.al,B[1]*s.al),pe.u_height_lift=I),pe},_m=(p,n,u,m,y,b)=>({u_matrix:p,u_edge_radius:n,u_width_scale:u,u_vertical_scale:m,u_height_type:jd[y],u_base_type:jd[b]}),Wy=(p,n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J,K)=>{const oe=Gd(p,n,u,m,y,b,w,E,L,R,N,B,U,W,G,J,1,[0,0,0]),re={u_height_factor:-Math.pow(2,E.overscaledZ)/I.tileSize/8};return Object.assign(oe,Zy(n,I,K),re)},_c=(p,n,u)=>({u_matrix:p,u_emissive_strength:n,u_ground_shadow_factor:u}),ym=(p,n,u,m,y,b=0)=>Object.assign(_c(p,n,y),Zy(u,m,b)),qy=(p,n,u,m)=>({u_matrix:p,u_world:u,u_emissive_strength:n,u_ground_shadow_factor:m}),Xy=(p,n,u,m,y,b,w=0)=>Object.assign(ym(p,n,u,m,b,w),{u_world:y}),vm=(p,n)=>({u_matrix:p,u_depth_bias:n}),Bl=(p,n)=>({u_matrix:p,u_ground_shadow_factor:n}),yc=(p,n,u,m,y)=>({u_matrix:p,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:u,u_height_scale:m,u_reset_depth:y}),Hd=(p,n,u,m,y,b,w,E,I)=>({u_matrix:p,u_normal_matrix:n,u_opacity:u,u_faux_facade_ao_intensity:m,u_camera_pos:y,u_tile_to_meter:b,u_facade_emissive_chance:w,u_flood_light_color:E,u_flood_light_intensity:I}),Jy=p=>({u_matrix:p}),Nl=p=>({u_matrix:p}),xm=(p,n,u,m,y,b,w,E)=>{const I=s.al/b.tileSize;return{u_matrix:p,u_inv_rot_matrix:n,u_camera_to_center_distance:u.getCameraToCenterDistance(E),u_extrude_scale:[u.pixelsToGLUnits[0]/I,u.pixelsToGLUnits[1]/I],u_zoom_transition:m,u_tile_id:w,u_merc_center:y}},Zd=(p,n,u,m)=>({u_matrix:p,u_inv_matrix:n,u_camera_to_center_distance:u.getCameraToCenterDistance(m),u_viewport_size:[u.width,u.height]}),bm=(p,n,u=1)=>({u_matrix:p,u_color:n,u_overlay:0,u_overlay_scale:u}),Yy=s.bC(),wm=(p,n,u,m,y,b,w)=>{const E=p.transform,I=E.projection.name==="globe",L=I?s.dR(E.zoom,n.canonical)*E._pixelsPerMercatorPixel:s.ay(u,1,b),R={u_matrix:n.projMatrix,u_extrude_scale:L,u_intensity:w,u_inv_rot_matrix:Yy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){R.u_inv_rot_matrix=m,R.u_merc_center=y,R.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],R.u_zoom_transition=s.aj(E.zoom);const N=y[0]*s.al,B=y[1]*s.al;R.u_up_dir=E.projection.upVector(new s.cD(0,0,0),N,B)}return R};function Wd(p,[n,u,m,y],[b,w]){if(b===w)return[0,0,0,0];const E=255*(p-1)/(p*(w-b));return[n*E,u*E,m*E,y*E]}function Ky(p,n,[u,m]){return u===m?0:.5/p+(n-u)*(p-1)/(p*(m-u))}const Sm=(p,n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J,K,oe,re,ne)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:u,u_merc_matrix:m,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:L,u_fade_t:R.mix,u_opacity:R.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:s.dT(N.paint.get("raster-saturation")),u_contrast_factor:s.dS(N.paint.get("raster-contrast")),u_spin_weights:xh(N.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:U,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:I,u_colorization_mix:Wd(s.dU,G,K),u_colorization_offset:Ky(s.dU,J,K),u_color_ramp:W,u_texture_offset:[re/(oe+2*re),oe/(oe+2*re)],u_texture_res:[oe+2*re,oe+2*re],u_emissive_strength:ne});function xh(p){p*=Math.PI/180;const n=Math.sin(p),u=Math.cos(p);return[(2*u+1)/3,(-Math.sqrt(3)*n-u+1)/3,(Math.sqrt(3)*n-u+1)/3]}const su=.05,zw=(p,n,u,m,y,b,w,E,I,L,R,N)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:u,u_merc_matrix:m,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:L,u_fade_t:R.mix,u_opacity:R.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:I}),Qy=(p,n,u,m,y,b,w,E,I,L)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_tile_offset:u,u_velocity:m,u_color_ramp:b,u_velocity_res:y,u_max_speed:w,u_uv_offset:E,u_data_scale:[255*I[0],255*I[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[su,su]}),Cw=(p,n,u,m,y,b,w,E,I,L)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_velocity:u,u_velocity_res:m,u_max_speed:y,u_speed_factor:b,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*I[0],255*I[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[su,su]}),qd=s.bC(),bh=(p,n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J,K,oe,re,ne,be,_e,ve)=>{const pe=y.transform,he={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:pe.getCameraToCenterDistance(oe),u_rotate_symbol:+u,u_aspect_ratio:pe.width/pe.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+L,u_elevation_from_sea:I?1:0,u_pitch_with_map:+m,u_texsize:R,u_texsize_icon:N,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:qd,u_up_vector:[0,-1,0],u_color_adj_mat:be,u_icon_transition:_e||0,u_gamma_scale:m?y.transform.getCameraToCenterDistance(oe)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ve||1,u_ground_shadow_factor:re,u_inv_matrix:s.bl(s.bC(),w),u_normal_scale:ne,u_lutTexture:10};return oe.name==="globe"&&(he.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],he.u_zoom_transition=W,he.u_inv_rot_matrix=J,he.u_merc_center=G,he.u_camera_forward=pe._camera.forward(),he.u_ecef_origin=s.dV(pe.globeMatrix,U.toUnwrapped()),he.u_tile_matrix=Float32Array.from(pe.globeMatrix),he.u_up_vector=K),he},Ul=(p,n,u,m)=>({u_matrix:p,u_emissive_strength:n,u_opacity:u,u_color:m}),wh=(p,n,u,m,y,b,w,E,I)=>Object.assign((function(L,R,N,B,U,W){const{width:G,height:J}=B.imageManager.getPixelSize(R),K=Math.pow(2,W.tileID.overscaledZ),oe=W.tileSize*Math.pow(2,B.transform.tileZoom)/K,re=oe*(W.tileID.canonical.x+W.tileID.wrap*K),ne=oe*W.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[G,J],u_pattern_size:N.displaySize,u_pattern_units_to_pixels:U?[B.transform.width,-1*B.transform.height]:[1/s.ay(W,1,B.transform.tileZoom),1/s.ay(W,1,B.transform.tileZoom)],u_pixel_coord_upper:[re>>16,ne>>16],u_pixel_coord_lower:[65535&re,65535&ne]}})(0,b,w,m,E,I),{u_matrix:p,u_emissive_strength:n,u_opacity:u}),vc=new Float32Array(s.bA([])),Xd=(p,n,u,m,y,b,w,E,I,L,R,N,B,U=[0,0,0],W,G,J)=>{const K=y.style.light,oe=K.properties.get("position"),re=[-oe.x,-oe.y,oe.z],ne=s.dO();K.properties.get("anchor")==="viewport"&&(s.dP(ne,-y.transform.angle),s.dQ(re,re,ne));const be=R.alphaMode==="MASK",_e=K.properties.get("color").toNonPremultipliedRenderColor(null),ve=B.paint.get("model-ambient-occlusion-intensity"),pe=B.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return pe.a=B.paint.get("model-color-mix-intensity").constantOr(0),J&&(pe.r=J[0],pe.g=J[1],pe.b=J[2],pe.a=J[3]),G&&(pe.r=G.color.r,pe.g=G.color.g,pe.b=G.color.b,pe.a=G.colorMix,N=G.emissionStrength,b*=G.opacity),{u_matrix:p,u_lighting_matrix:n,u_normal_matrix:u,u_node_matrix:m||vc,u_lightpos:re,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_camera_pos:U,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+be,u_alphaCutoff:R.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:I,u_roughnessFactor:L,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:pe.toArray01(),u_aoIntensity:ve,u_emissive_strength:N,u_occlusionTextureTransform:W||[0,0,0,0]}},Sh=(p,n=vc,u=vc)=>({u_matrix:p,u_instance:n,u_node_matrix:u}),Jd={fillExtrusion:p=>({u_matrix:new s.cl(p),u_lightpos:new s.ci(p),u_lightintensity:new s.cj(p),u_lightcolor:new s.ci(p),u_vertical_gradient:new s.cj(p),u_opacity:new s.cj(p),u_edge_radius:new s.cj(p),u_width_scale:new s.cj(p),u_ao:new s.ck(p),u_height_type:new s.ch(p),u_base_type:new s.ch(p),u_tile_id:new s.ci(p),u_zoom_transition:new s.cj(p),u_inv_rot_matrix:new s.cl(p),u_merc_center:new s.ck(p),u_up_dir:new s.ci(p),u_height_lift:new s.cj(p),u_flood_light_color:new s.ci(p),u_vertical_scale:new s.cj(p),u_flood_light_intensity:new s.cj(p),u_ground_shadow_factor:new s.ci(p)}),fillExtrusionDepth:p=>({u_matrix:new s.cl(p),u_edge_radius:new s.cj(p),u_width_scale:new s.cj(p),u_vertical_scale:new s.cj(p),u_height_type:new s.ch(p),u_base_type:new s.ch(p)}),fillExtrusionPattern:p=>({u_matrix:new s.cl(p),u_lightpos:new s.ci(p),u_lightintensity:new s.cj(p),u_lightcolor:new s.ci(p),u_vertical_gradient:new s.cj(p),u_height_factor:new s.cj(p),u_edge_radius:new s.cj(p),u_width_scale:new s.cj(p),u_ao:new s.ck(p),u_height_type:new s.ch(p),u_base_type:new s.ch(p),u_tile_id:new s.ci(p),u_zoom_transition:new s.cj(p),u_inv_rot_matrix:new s.cl(p),u_merc_center:new s.ck(p),u_up_dir:new s.ci(p),u_height_lift:new s.cj(p),u_image:new s.ch(p),u_texsize:new s.ck(p),u_pixel_coord_upper:new s.ck(p),u_pixel_coord_lower:new s.ck(p),u_tile_units_to_pixels:new s.cj(p),u_opacity:new s.cj(p),u_pattern_transition:new s.cj(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new s.cl(p),u_opacity:new s.cj(p),u_ao_pass:new s.cj(p),u_meter_to_tile:new s.cj(p),u_ao:new s.ck(p),u_flood_light_intensity:new s.cj(p),u_flood_light_color:new s.ci(p),u_attenuation:new s.cj(p),u_edge_radius:new s.cj(p),u_fb:new s.ch(p),u_fb_size:new s.cj(p),u_dynamic_offset:new s.cj(p)}),fill:p=>({u_matrix:new s.cl(p),u_emissive_strength:new s.cj(p),u_ground_shadow_factor:new s.ci(p)}),fillPattern:p=>({u_matrix:new s.cl(p),u_emissive_strength:new s.cj(p),u_image:new s.ch(p),u_texsize:new s.ck(p),u_pixel_coord_upper:new s.ck(p),u_pixel_coord_lower:new s.ck(p),u_tile_units_to_pixels:new s.cj(p),u_ground_shadow_factor:new s.ci(p),u_pattern_transition:new s.cj(p)}),fillOutline:p=>({u_matrix:new s.cl(p),u_emissive_strength:new s.cj(p),u_world:new s.ck(p),u_ground_shadow_factor:new s.ci(p)}),fillOutlinePattern:p=>({u_matrix:new s.cl(p),u_emissive_strength:new s.cj(p),u_world:new s.ck(p),u_image:new s.ch(p),u_texsize:new s.ck(p),u_pixel_coord_upper:new s.ck(p),u_pixel_coord_lower:new s.ck(p),u_tile_units_to_pixels:new s.cj(p),u_ground_shadow_factor:new s.ci(p),u_pattern_transition:new s.cj(p)}),building:p=>({u_matrix:new s.cl(p),u_normal_matrix:new s.cl(p),u_opacity:new s.cj(p),u_faux_facade_ao_intensity:new s.cj(p),u_camera_pos:new s.ci(p),u_tile_to_meter:new s.cj(p),u_facade_emissive_chance:new s.cj(p),u_flood_light_color:new s.ci(p),u_flood_light_intensity:new s.cj(p)}),buildingBloom:p=>({u_matrix:new s.cl(p)}),buildingDepth:p=>({u_matrix:new s.cl(p)}),elevatedStructuresDepth:p=>({u_matrix:new s.cl(p),u_depth_bias:new s.cj(p)}),elevatedStructures:p=>({u_matrix:new s.cl(p),u_ground_shadow_factor:new s.ci(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new s.cl(p),u_camera_pos:new s.ci(p),u_depth_bias:new s.cj(p),u_height_scale:new s.cj(p),u_reset_depth:new s.cj(p)}),circle:s.dY,collisionBox:p=>({u_matrix:new s.cl(p),u_inv_rot_matrix:new s.cl(p),u_camera_to_center_distance:new s.cj(p),u_extrude_scale:new s.ck(p),u_zoom_transition:new s.cj(p),u_merc_center:new s.ck(p),u_tile_id:new s.ci(p)}),collisionCircle:p=>({u_matrix:new s.cl(p),u_inv_matrix:new s.cl(p),u_camera_to_center_distance:new s.cj(p),u_viewport_size:new s.ck(p)}),debug:p=>({u_color:new s.dB(p),u_matrix:new s.cl(p),u_overlay:new s.ch(p),u_overlay_scale:new s.cj(p)}),clippingMask:p=>({u_matrix:new s.cl(p)}),heatmap:p=>({u_extrude_scale:new s.cj(p),u_intensity:new s.cj(p),u_matrix:new s.cl(p),u_inv_rot_matrix:new s.cl(p),u_merc_center:new s.ck(p),u_tile_id:new s.ci(p),u_zoom_transition:new s.cj(p),u_up_dir:new s.ci(p)}),heatmapTexture:p=>({u_image:new s.ch(p),u_color_ramp:new s.ch(p),u_opacity:new s.cj(p)}),hillshade:p=>({u_matrix:new s.cl(p),u_image:new s.ch(p),u_latrange:new s.ck(p),u_light:new s.ck(p),u_shadow:new s.dB(p),u_highlight:new s.dB(p),u_emissive_strength:new s.cj(p),u_accent:new s.dB(p)}),hillshadePrepare:p=>({u_matrix:new s.cl(p),u_image:new s.ch(p),u_dimension:new s.ck(p),u_zoom:new s.cj(p)}),line:s.dX,linePattern:s.dW,raster:p=>({u_matrix:new s.cl(p),u_normalize_matrix:new s.cl(p),u_globe_matrix:new s.cl(p),u_merc_matrix:new s.cl(p),u_grid_matrix:new s.dC(p),u_tl_parent:new s.ck(p),u_scale_parent:new s.cj(p),u_fade_t:new s.cj(p),u_opacity:new s.cj(p),u_image0:new s.ch(p),u_image1:new s.ch(p),u_brightness_low:new s.cj(p),u_brightness_high:new s.cj(p),u_saturation_factor:new s.cj(p),u_contrast_factor:new s.cj(p),u_spin_weights:new s.ci(p),u_perspective_transform:new s.ck(p),u_raster_elevation:new s.cj(p),u_zoom_transition:new s.cj(p),u_merc_center:new s.ck(p),u_cutoff_params:new s.d3(p),u_colorization_mix:new s.d3(p),u_colorization_offset:new s.cj(p),u_color_ramp:new s.ch(p),u_texture_offset:new s.ck(p),u_texture_res:new s.ck(p),u_emissive_strength:new s.cj(p)}),rasterParticle:p=>({u_matrix:new s.cl(p),u_normalize_matrix:new s.cl(p),u_globe_matrix:new s.cl(p),u_merc_matrix:new s.cl(p),u_grid_matrix:new s.dC(p),u_tl_parent:new s.ck(p),u_scale_parent:new s.cj(p),u_fade_t:new s.cj(p),u_opacity:new s.cj(p),u_image0:new s.ch(p),u_image1:new s.ch(p),u_raster_elevation:new s.cj(p),u_zoom_transition:new s.cj(p),u_merc_center:new s.ck(p),u_cutoff_params:new s.d3(p)}),rasterParticleTexture:p=>({u_texture:new s.ch(p),u_opacity:new s.cj(p)}),rasterParticleDraw:p=>({u_particle_texture:new s.ch(p),u_particle_texture_side_len:new s.cj(p),u_tile_offset:new s.ck(p),u_velocity:new s.ch(p),u_color_ramp:new s.ch(p),u_velocity_res:new s.ck(p),u_max_speed:new s.cj(p),u_uv_offset:new s.ck(p),u_data_scale:new s.ck(p),u_data_offset:new s.cj(p),u_particle_pos_scale:new s.cj(p),u_particle_pos_offset:new s.ck(p)}),rasterParticleUpdate:p=>({u_particle_texture:new s.ch(p),u_particle_texture_side_len:new s.cj(p),u_velocity:new s.ch(p),u_velocity_res:new s.ck(p),u_max_speed:new s.cj(p),u_speed_factor:new s.cj(p),u_reset_rate:new s.cj(p),u_rand_seed:new s.cj(p),u_uv_offset:new s.ck(p),u_data_scale:new s.ck(p),u_data_offset:new s.cj(p),u_particle_pos_scale:new s.cj(p),u_particle_pos_offset:new s.ck(p)}),symbol:p=>({u_is_size_zoom_constant:new s.ch(p),u_is_size_feature_constant:new s.ch(p),u_size_t:new s.cj(p),u_size:new s.cj(p),u_camera_to_center_distance:new s.cj(p),u_rotate_symbol:new s.ch(p),u_aspect_ratio:new s.cj(p),u_fade_change:new s.cj(p),u_matrix:new s.cl(p),u_label_plane_matrix:new s.cl(p),u_coord_matrix:new s.cl(p),u_is_text:new s.ch(p),u_elevation_from_sea:new s.ch(p),u_pitch_with_map:new s.ch(p),u_texsize:new s.ck(p),u_texsize_icon:new s.ck(p),u_texture:new s.ch(p),u_texture_icon:new s.ch(p),u_gamma_scale:new s.cj(p),u_device_pixel_ratio:new s.cj(p),u_tile_id:new s.ci(p),u_zoom_transition:new s.cj(p),u_inv_rot_matrix:new s.cl(p),u_merc_center:new s.ck(p),u_camera_forward:new s.ci(p),u_tile_matrix:new s.cl(p),u_up_vector:new s.ci(p),u_ecef_origin:new s.ci(p),u_is_halo:new s.ch(p),u_icon_transition:new s.cj(p),u_color_adj_mat:new s.cl(p),u_scale_factor:new s.cj(p),u_ground_shadow_factor:new s.ci(p),u_inv_matrix:new s.cl(p),u_normal_scale:new s.cj(p),u_lutTexture:new s.ch(p)}),background:p=>({u_matrix:new s.cl(p),u_emissive_strength:new s.cj(p),u_opacity:new s.cj(p),u_color:new s.dB(p)}),backgroundPattern:p=>({u_matrix:new s.cl(p),u_emissive_strength:new s.cj(p),u_opacity:new s.cj(p),u_image:new s.ch(p),u_pattern_tl:new s.ck(p),u_pattern_br:new s.ck(p),u_texsize:new s.ck(p),u_pattern_size:new s.ck(p),u_pixel_coord_upper:new s.ck(p),u_pixel_coord_lower:new s.ck(p),u_pattern_units_to_pixels:new s.ck(p)}),terrainRaster:p=>({u_matrix:new s.cl(p),u_image0:new s.ch(p),u_image1:new s.ch(p),u_skirt_height:new s.cj(p),u_ground_shadow_factor:new s.ci(p),u_emissive_texture_available:new s.cj(p)}),skybox:p=>({u_matrix:new s.cl(p),u_sun_direction:new s.ci(p),u_cubemap:new s.ch(p),u_opacity:new s.cj(p),u_temporal_offset:new s.cj(p)}),skyboxGradient:p=>({u_matrix:new s.cl(p),u_color_ramp:new s.ch(p),u_center_direction:new s.ci(p),u_radius:new s.cj(p),u_opacity:new s.cj(p),u_temporal_offset:new s.cj(p)}),skyboxCapture:p=>({u_matrix_3f:new s.dC(p),u_sun_direction:new s.ci(p),u_sun_intensity:new s.cj(p),u_color_tint_r:new s.d3(p),u_color_tint_m:new s.d3(p),u_luminance:new s.cj(p)}),globeRaster:p=>({u_proj_matrix:new s.cl(p),u_globe_matrix:new s.cl(p),u_normalize_matrix:new s.cl(p),u_merc_matrix:new s.cl(p),u_zoom_transition:new s.cj(p),u_merc_center:new s.ck(p),u_image0:new s.ch(p),u_image1:new s.ch(p),u_grid_matrix:new s.dC(p),u_skirt_height:new s.cj(p),u_far_z_cutoff:new s.cj(p),u_frustum_tl:new s.ci(p),u_frustum_tr:new s.ci(p),u_frustum_br:new s.ci(p),u_frustum_bl:new s.ci(p),u_globe_pos:new s.ci(p),u_globe_radius:new s.cj(p),u_viewport:new s.ck(p),u_emissive_texture_available:new s.cj(p)}),globeAtmosphere:p=>({u_frustum_tl:new s.ci(p),u_frustum_tr:new s.ci(p),u_frustum_br:new s.ci(p),u_frustum_bl:new s.ci(p),u_horizon:new s.cj(p),u_transition:new s.cj(p),u_fadeout_range:new s.cj(p),u_atmosphere_fog_color:new s.d3(p),u_high_color:new s.d3(p),u_space_color:new s.d3(p),u_temporal_offset:new s.cj(p),u_horizon_angle:new s.cj(p)}),model:p=>({u_matrix:new s.cl(p),u_lighting_matrix:new s.cl(p),u_normal_matrix:new s.cl(p),u_node_matrix:new s.cl(p),u_lightpos:new s.ci(p),u_lightintensity:new s.cj(p),u_lightcolor:new s.ci(p),u_camera_pos:new s.ci(p),u_opacity:new s.cj(p),u_baseColorFactor:new s.d3(p),u_emissiveFactor:new s.d3(p),u_metallicFactor:new s.cj(p),u_roughnessFactor:new s.cj(p),u_baseTextureIsAlpha:new s.ch(p),u_alphaMask:new s.ch(p),u_alphaCutoff:new s.cj(p),u_baseColorTexture:new s.ch(p),u_metallicRoughnessTexture:new s.ch(p),u_normalTexture:new s.ch(p),u_occlusionTexture:new s.ch(p),u_emissionTexture:new s.ch(p),u_lutTexture:new s.ch(p),u_color_mix:new s.d3(p),u_aoIntensity:new s.cj(p),u_emissive_strength:new s.cj(p),u_occlusionTextureTransform:new s.d3(p)}),modelDepth:p=>({u_matrix:new s.cl(p),u_instance:new s.cl(p),u_node_matrix:new s.cl(p)}),groundShadow:p=>({u_matrix:new s.cl(p),u_ground_shadow_factor:new s.ci(p)}),stars:p=>({u_matrix:new s.cl(p),u_up:new s.ci(p),u_right:new s.ci(p),u_intensity_multiplier:new s.cj(p)}),snowParticle:p=>({u_modelview:new s.cl(p),u_projection:new s.cl(p),u_time:new s.cj(p),u_cam_pos:new s.ci(p),u_velocityConeAperture:new s.cj(p),u_velocity:new s.cj(p),u_horizontalOscillationRadius:new s.cj(p),u_horizontalOscillationRate:new s.cj(p),u_boxSize:new s.cj(p),u_billboardSize:new s.cj(p),u_simpleShapeParameters:new s.ck(p),u_screenSize:new s.ck(p),u_thinningCenterPos:new s.ck(p),u_thinningShape:new s.ci(p),u_thinningAffectedRatio:new s.cj(p),u_thinningParticleOffset:new s.cj(p),u_particleColor:new s.d3(p),u_direction:new s.ci(p)}),rainParticle:p=>({u_modelview:new s.cl(p),u_projection:new s.cl(p),u_time:new s.cj(p),u_cam_pos:new s.ci(p),u_texScreen:new s.ch(p),u_velocityConeAperture:new s.cj(p),u_velocity:new s.cj(p),u_boxSize:new s.cj(p),u_rainDropletSize:new s.ck(p),u_distortionStrength:new s.cj(p),u_rainDirection:new s.ci(p),u_color:new s.d3(p),u_screenSize:new s.ck(p),u_thinningCenterPos:new s.ck(p),u_thinningShape:new s.ci(p),u_thinningAffectedRatio:new s.cj(p),u_thinningParticleOffset:new s.cj(p),u_shapeDirectionalPower:new s.cj(p),u_shapeNormalPower:new s.cj(p),u_mode:new s.cj(p)}),vignette:p=>({u_vignetteShape:new s.ci(p),u_vignetteColor:new s.d3(p)}),occlusion:p=>({u_matrix:new s.cl(p),u_anchorPos:new s.ci(p),u_screenSizePx:new s.ck(p),u_occluderSizePx:new s.ck(p),u_color:new s.d3(p)})};class Ra{constructor(n,u,m,y){this.id=Ra.uniqueIdxCounter,Ra.uniqueIdxCounter++,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Ra.uniqueIdxCounter,Ra.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ra.uniqueIdxCounter=0;const ev={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Lw{constructor(n,u,m,y,b,w){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=y,this.instanceCount=w,this.context=n;const E=n.gl;this.buffer=E.createBuffer(),n.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||b||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,u){for(let m=0;m<this.attributes.length;m++){const y=u.getAttributeLocation(n,this.attributes[m].name);y!==-1&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,u,m){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],w=u.getAttributeLocation(n,b.name);w!==-1&&n.vertexAttribPointer(w,b.components,n[ev[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(n,u,m){for(let y=0;y<this.attributes.length;y++){const b=u.getAttributeLocation(n,this.attributes[y].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(b,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xc{constructor(n,u,m,y,b){this.context=n,this.width=u,this.height=m;const w=this.framebuffer=n.gl.createFramebuffer();y>0&&(this.colorAttachment0=new Bd(n,w,0)),y>1&&(this.colorAttachment1=new Bd(n,w,1)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new nu(n,w):new gh(n,w))}createColorAttachment(n,u){u===0?this.colorAttachment0=new Bd(n,this.framebuffer,0):u===1&&(this.colorAttachment1=new Bd(n,this.framebuffer,1))}removeColorAttachment(n,u){const m=this.context.gl;let y;u===0?(y=this.colorAttachment0.get(),this.colorAttachment0=void 0):u===1&&(y=this.colorAttachment1.get(),this.colorAttachment1=void 0),y&&m.deleteTexture(y)}destroy(){const n=this.context.gl;if(this.colorAttachment0){const u=this.colorAttachment0.get();u&&n.deleteTexture(u)}if(this.colorAttachment1){const u=this.colorAttachment1.get();u&&n.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&n.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&n.deleteTexture(u)}n.deleteFramebuffer(this.framebuffer)}}class Yd{constructor(n,u){this.gl=n,this.clearColor=new Sw(this),this.clearDepth=new Oy(this),this.clearStencil=new om(this),this.colorMask=new Rd(this),this.depthMask=new sm(this),this.stencilMask=new gc(this),this.stencilFunc=new Qc(this),this.stencilOp=new ph(this),this.stencilTest=new eu(this),this.depthRange=new Fy(this),this.depthTest=new am(this),this.depthFunc=new By(this),this.blend=new tu(this),this.blendFunc=new Dd(this),this.blendColor=new kd(this),this.blendEquation=new lm(this),this.cullFace=new Od(this),this.cullFaceSide=new mh(this),this.frontFace=new Ny(this),this.program=new Uy(this),this.activeTexture=new $y(this),this.viewport=new iu(this),this.bindFramebuffer=new Vy(this),this.bindRenderbuffer=new Tw(this),this.bindTexture=new Ew(this),this.bindVertexBuffer=new Iw(this),this.bindElementBuffer=new cm(this),this.bindVertexArrayOES=new um(this),this.pixelStoreUnpack=new hm(this),this.pixelStoreUnpackPremultiplyAlpha=new dm(this),this.pixelStoreUnpackFlipY=new jy(this),this.options=u?Object.assign({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=u&&!!u.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=n.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,u,m){return new Ra(this,n,u,m)}createVertexBuffer(n,u,m,y,b){return new Lw(this,n,u,m,y,b)}createRenderbuffer(n,u,m){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,n,u,m),this.bindRenderbuffer.set(null),b}createFramebuffer(n,u,m,y){return new xc(this,n,u,m,y)}clear({color:n,depth:u,stencil:m,colorMask:y}){const b=this.gl;let w=0;n&&(w|=b.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),u!==void 0&&(w|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),m!==void 0&&(w|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),b.clear(w)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){s.by(n.blendFunction,Mi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let jt;function Tm(p,n,u,m,y,b,w){const E=p.context,I=E.gl,L=p.transform,R=[s.aF(L.center.lng),s.aJ(L.center.lat)],N=u.layout.get("symbol-placement"),B=u.layout.get("text-variable-anchor"),U=u.layout.get("icon-rotation-alignment")==="map",W=u.layout.get("text-rotation-alignment")==="map",G=N!=="point",J=[];let K=0,oe=0;for(let pe=0;pe<m.length;pe++){const he=m[pe],Se=n.getTile(he),ze=Se.getBucket(u);if(!ze)continue;const Re=ze.getProjection().createInversionMatrix(L,he.canonical),Ze=[],je=dw(he,ze,L),it=!w&&U&&G,dt=w&&W&&G,Fe=B&&ze.hasTextData(),Te=ze.hasIconTextFit()&&Fe&&ze.hasIconData(),Ke=it||dt||w&&Fe||Te,We=ze.projection.name==="globe",pt=We?s.aj(L.zoom):0;We&&(Ze.push("PROJECTION_GLOBE_VIEW"),Ke&&Ze.push("PROJECTED_POS_ON_VIEWPORT"));const vt=p.getOrCreateProgram("collisionBox",{defines:Ze});let Pt=je;y[0]===0&&y[1]===0||(Pt=p.translatePosMatrix(je,Se,y,b));const xt=w?ze.textCollisionBox:ze.iconCollisionBox,St=ze.collisionCircleArray;if(St.length>0){const Ht=s.bC(),Rt=Pt;s.cP(Ht,ze.placementInvProjMatrix,L.glCoordMatrix),s.cP(Ht,Ht,ze.placementViewportMatrix),J.push({circleArray:St,circleOffset:oe,transform:Rt,invTransform:Ht,projection:ze.getProjection()}),K+=St.length/4,oe=K}if(!xt)continue;p.terrain&&p.terrain.setupElevationDraw(Se,vt);const Xt=We?[he.canonical.x,he.canonical.y,1<<he.canonical.z]:[0,0,0];vt.draw(p,I.LINES,Qt.disabled,xi.disabled,p.colorModeForRenderPass(),fi.disabled,xm(Pt,Re,L,pt,R,Se,Xt,ze.getProjection()),u.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,L.zoom,null,[xt.collisionVertexBuffer,xt.collisionVertexBufferExt])}if(!w||!J.length)return;const re=p.getOrCreateProgram("collisionCircle"),ne=new s.dZ;ne.resize(4*K),ne._trim();let be=0;for(const pe of J)for(let he=0;he<pe.circleArray.length/4;he++){const Se=4*he,ze=pe.circleArray[Se+0],Re=pe.circleArray[Se+1],Ze=pe.circleArray[Se+2],je=pe.circleArray[Se+3];ne.emplace(be++,ze,Re,Ze,je,0),ne.emplace(be++,ze,Re,Ze,je,1),ne.emplace(be++,ze,Re,Ze,je,2),ne.emplace(be++,ze,Re,Ze,je,3)}(!jt||jt.length<2*K)&&(jt=(function(pe){const he=2*pe,Se=new s.b0;Se.resize(he),Se._trim();for(let ze=0;ze<he;ze++){const Re=6*ze;Se.uint16[Re+0]=4*ze+0,Se.uint16[Re+1]=4*ze+1,Se.uint16[Re+2]=4*ze+2,Se.uint16[Re+3]=4*ze+2,Se.uint16[Re+4]=4*ze+3,Se.uint16[Re+5]=4*ze+0}return Se})(K));const _e=E.createIndexBuffer(jt,!0),ve=E.createVertexBuffer(ne,s.d_.members,!0);for(const pe of J){const he=Zd(pe.transform,pe.invTransform,L,pe.projection);re.draw(p,I.TRIANGLES,Qt.disabled,xi.disabled,p.colorModeForRenderPass(),fi.disabled,he,u.id,ve,_e,s.bg.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,L.zoom)}ve.destroy(),_e.destroy()}const pa=s.bC();function hl(p){const n=p._camera.getWorldToCamera(p.worldSize,1),u=s.aB([],n,p.globeMatrix);s.bl(u,u);const m=[0,0,0],y=[0,1,0,0];return s.aC(y,y,u),m[0]=y[0],m[1]=y[1],m[2]=y[2],s.aw(m,m),m}function tv({width:p,height:n,anchor:u,textOffset:m,textScale:y},b){const{horizontalAlign:w,verticalAlign:E}=s.c1(u),I=-(w-.5)*p,L=-(E-.5)*n,R=s.c2(u,m);return new s.P((I/y+R[0])*b,(L/y+R[1])*b)}function iv(p,n,u,m,y,b,w,E,I,L){const R=p.text.placedSymbolArray,N=p.text.dynamicLayoutVertexArray,B=p.icon.dynamicLayoutVertexArray,U={},W=p.getProjection(),G=Zc(w,W,y),J=y.elevation,K=W.upVectorScale(w.canonical,y.center.lat,y.worldSize).metersToTile;N.clear();for(let oe=0;oe<R.length;oe++){const re=R.get(oe),{tileAnchorX:ne,tileAnchorY:be,numGlyphs:_e}=re,ve=re.hidden||!re.crossTileID||p.allowVerticalPlacement&&!re.placedOrientation?null:m[re.crossTileID];if(ve){let pe=0,he=0,Se=0;const ze=p.elevationType==="road";if(J||ze){const We=ze?p.getElevationFeatureForText(oe):null,pt=s.bV.getAtTileOffset(w,new s.P(ne,be),J,We),[vt,Pt,xt]=W.upVector(w.canonical,ne,be);pe=pt*vt*K,he=pt*Pt*K,Se=pt*xt*K}let[Re,Ze,je,it]=ta(re.projectedAnchorX+pe,re.projectedAnchorY+he,re.projectedAnchorZ+Se,u?G:b);const dt=xd(y.getCameraToCenterDistance(W),it);let Fe=s.bM(p.textSizeData,I,re)*dt/s.bY;u&&(Fe*=p.tilePixelRatio/E);const Te=tv(ve,Fe);u?({x:Re,y:Ze,z:je}=W.projectTilePoint(ne+Te.x,be+Te.y,w.canonical),[Re,Ze,je]=ta(Re+pe,Ze+he,je+Se,b)):(n&&Te._rotate(-y.angle),Re+=Te.x,Ze+=Te.y,je=0);const Ke=p.allowVerticalPlacement&&re.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let We=0;We<_e;We++)s.bO(N,Re,Ze,je,Ke);L&&re.associatedIconIndex>=0&&(U[re.associatedIconIndex]={x:Re,y:Ze,z:je,angle:Ke})}else Bo(_e,N)}if(L){B.clear();const oe=p.icon.placedSymbolArray;for(let re=0;re<oe.length;re++){const ne=oe.get(re),{numGlyphs:be}=ne,_e=U[re];if(ne.hidden||!_e)Bo(be,B);else{const{x:ve,y:pe,z:he,angle:Se}=_e;for(let ze=0;ze<be;ze++)s.bO(B,ve,pe,he,Se)}}p.icon.dynamicLayoutVertexBuffer.updateData(B)}p.text.dynamicLayoutVertexBuffer.updateData(N)}function Kd(p,n,u,m,y,b,w={}){const E=u.paint.get("icon-translate"),I=u.paint.get("text-translate"),L=u.paint.get("icon-translate-anchor"),R=u.paint.get("text-translate-anchor"),N=u.layout.get("icon-rotation-alignment"),B=u.layout.get("text-rotation-alignment"),U=u.layout.get("icon-pitch-alignment"),W=u.layout.get("text-pitch-alignment"),G=u.layout.get("icon-keep-upright"),J=u.layout.get("text-keep-upright"),K=u.paint.get("icon-color-saturation"),oe=u.paint.get("icon-color-contrast"),re=u.paint.get("icon-color-brightness-min"),ne=u.paint.get("icon-color-brightness-max"),be=u.layout.get("symbol-elevation-reference")==="sea",_e=u.layout.get("icon-image-use-theme")==="none",ve=p.context,pe=ve.gl,he=p.transform,Se=N==="map",ze=B==="map",Re=U==="map",Ze=W==="map",je=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let it=!1;const dt=p.depthModeForSublayer(0,Qt.ReadOnly),Fe=new Qt(p.context.gl.LEQUAL,Qt.ReadOnly,p.depthRangeFor3D),Te=[s.aF(he.center.lng),s.aJ(he.center.lat)],Ke=u.layout.get("text-variable-anchor"),We=he.projection.name==="globe",pt=[],vt=[0,-1,0];for(const Pt of m){const xt=n.getTile(Pt),St=xt.getBucket(u);if(!St||St.projection.name==="mercator"&&We||St.fullyClipped)continue;const Xt=St.projection.name==="globe",Ht=Xt?s.aj(he.zoom):0,Rt=Zc(Pt,St.getProjection(),he),Gt=he.calculatePixelsToTileUnitsMatrix(xt),si=Ke&&St.hasTextData(),pi=St.hasIconTextFit()&&si&&St.hasIconData(),Ni=St.getProjection().createInversionMatrix(he,Pt.canonical),en=(1<<xt.tileID.canonical.z)*s.al/p.transform.worldSize,Ei=_n=>{let Yi=[0,0,0];if(_n){const Bi=p.style.directionalLight,Nn=p.style.ambientLight;Bi&&Nn&&(Yi=na(p.style,Bi,Nn))}return Yi},ln=_n=>{he.depthOcclusionForSymbolsAndCircles&&(u.hasOcclusionOpacityProperties||p.terrain)&&(_n.push("DEPTH_D24"),_n.push("DEPTH_OCCLUSION"))},Ri=_n=>{u.lut&&!_e&&(u.lut.texture||(u.lut.texture=new s.d$(p.context,u.lut.image,[u.lut.image.height,u.lut.image.height,u.lut.image.height],ve.gl.RGBA8)),ve.activeTexture.set(ve.gl.TEXTURE0+10),u.lut.texture&&u.lut.texture.bind(ve.gl.LINEAR,ve.gl.CLAMP_TO_EDGE),_n.push("APPLY_LUT_ON_GPU"))},En=()=>{const _n=Se&&u.layout.get("symbol-placement")!=="point",Yi=[];ln(Yi),Ri(Yi);const Bi=_n||pi,Nn=St.elevationType==="road",hr=p.shadowRenderer,jn=Nn&&Re&&!!hr&&hr.enabled,Wn=Ei(jn),jo=Nn&&Re&&!p.terrain?Fe:dt,as=u.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&Re&&Yi.push("PITCH_WITH_MAP_TERRAIN"),Xt&&(Yi.push("PROJECTION_GLOBE_VIEW"),Bi&&Yi.push("PROJECTED_POS_ON_VIEWPORT")),as>0&&St.hasAnySecondaryIcon&&Yi.push("ICON_TRANSITION"),!St.icon.zOffsetVertexBuffer||Nn&&p.terrain||Yi.push("Z_OFFSET"),K===0&&oe===0&&re===0&&ne===1||Yi.push("COLOR_ADJUSTMENT"),St.sdfIcons&&Yi.push("RENDER_SDF"),jn&&Yi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Nn&&Re&&!p.terrain&&St.icon.orientationVertexBuffer&&Yi.push("ELEVATED_ROADS");const ro=St.icon.programConfigurations.get(u.id),yn=p.getOrCreateProgram("symbol",{config:ro,defines:Yi}),bs=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],Eo=St.iconSizeData,Go=s.bK(Eo,he.zoom),oa=Re||!he.isOrthographic,Ho=hc(Rt,xt.tileID.canonical,Re,Se,he,St.getProjection(),Gt),rr=ts(Rt,xt.tileID.canonical,Re,Se,he,St.getProjection(),Gt),Ir=p.translatePosMatrix(rr,xt,E,L,!0),Gn=p.translatePosMatrix(Rt,xt,E,L),Cr=Bi?pa:Ho,Io=Se&&!Re&&!_n;let br=vt;!We&&!he.mercatorFromTransition||Se||(br=hl(he));const ws=Xt?br:vt,Nh=u.getColorAdjustmentMatrix(K,oe,re,ne),Fa=bh(Eo.kind,Go,Io,Re,p,Gn,Cr,Ir,be,!1,bs,[0,0],0,Pt,Ht,Te,Ni,ws,St.getProjection(),Wn,en,Nh,as,null),yu=xt.imageAtlasTexture?xt.imageAtlasTexture:null,vu=u.layout.get("icon-size").constantOr(0)!==1||St.iconsNeedLinear,Ss=St.sdfIcons||p.options.rotating||p.options.zooming||vu||oa?pe.LINEAR:pe.NEAREST,Ba=St.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,Na=p.terrain&&Re&&_n?s.bl(s.bC(),Ho):pa;if(_n&&St.icon){const Ns=s.bV.getAtTileOffsetFunc(Pt,he.center.lat,he.worldSize,St.getProjection()),pl=al(Rt,xt.tileID.canonical,Re,Se,he,St.getProjection(),Gt),Ec=u.layout.get("icon-size-scale-range"),ff=s.aA(p.scaleFactor,Ec[0],Ec[1]);bn(St,Rt,p,!1,pl,rr,Re,G,Ns,Pt,ff)}return{program:yn,buffers:St.icon,uniformValues:Fa,atlasTexture:yu,atlasTextureIcon:null,atlasInterpolation:Ss,atlasInterpolationIcon:null,isSDF:St.sdfIcons,hasHalo:Ba,depthMode:jo,tile:xt,renderWithShadows:jn,labelPlaneMatrixInv:Na}},wn=()=>{const _n=ze&&u.layout.get("symbol-placement")!=="point",Yi=[],Bi=_n||Ke||pi,Nn=St.elevationType==="road",hr=p.shadowRenderer,jn=Nn&&Ze&&!!hr&&hr.enabled,Wn=Ei(jn),jo=Nn&&Ze&&!p.terrain?Fe:dt;p.terrainRenderModeElevated()&&Ze&&Yi.push("PITCH_WITH_MAP_TERRAIN"),Xt&&(Yi.push("PROJECTION_GLOBE_VIEW"),Bi&&Yi.push("PROJECTED_POS_ON_VIEWPORT")),!St.text.zOffsetVertexBuffer||Nn&&p.terrain||Yi.push("Z_OFFSET"),St.iconsInText&&Yi.push("RENDER_TEXT_AND_SYMBOL"),Yi.push("RENDER_SDF"),jn&&Yi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Nn&&Ze&&!p.terrain&&St.text.orientationVertexBuffer&&Yi.push("ELEVATED_ROADS"),ln(Yi);const as=St.text.programConfigurations.get(u.id),ro=p.getOrCreateProgram("symbol",{config:as,defines:Yi});let yn,bs=[0,0],Eo=null;const Go=St.textSizeData;St.iconsInText&&(bs=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],Eo=xt.imageAtlasTexture?xt.imageAtlasTexture:null,yn=Ze||!he.isOrthographic||p.options.rotating||p.options.zooming||Go.kind==="composite"||Go.kind==="camera"?pe.LINEAR:pe.NEAREST);const oa=xt.glyphAtlasTexture?xt.glyphAtlasTexture.size:[0,0],Ho=u.layout.get("text-size-scale-range"),rr=s.aA(p.scaleFactor,Ho[0],Ho[1]),Ir=s.bK(Go,he.zoom,rr),Gn=hc(Rt,xt.tileID.canonical,Ze,ze,he,St.getProjection(),Gt),Cr=ts(Rt,xt.tileID.canonical,Ze,ze,he,St.getProjection(),Gt),Io=p.translatePosMatrix(Cr,xt,I,R,!0),br=p.translatePosMatrix(Rt,xt,I,R),ws=Bi?pa:Gn,Nh=ze&&!Ze&&!_n;let Fa=vt;!We&&!he.mercatorFromTransition||ze||(Fa=hl(he));const yu=bh(Go.kind,Ir,Nh,Ze,p,br,ws,Io,be,!0,oa,bs,0,Pt,Ht,Te,Ni,Xt?Fa:vt,St.getProjection(),Wn,en,null,null,rr),vu=xt.glyphAtlasTexture?xt.glyphAtlasTexture:null,Ss=pe.LINEAR,Ba=u.paint.get("text-halo-width").constantOr(1)!==0,Na=p.terrain&&Ze&&_n?s.bl(s.bC(),Gn):pa;if(_n&&St.text){const Ns=s.bV.getAtTileOffsetFunc(Pt,he.center.lat,he.worldSize,St.getProjection()),pl=al(Rt,xt.tileID.canonical,Ze,ze,he,St.getProjection(),Gt);bn(St,Rt,p,!0,pl,Cr,Ze,J,Ns,Pt,rr)}return{program:ro,buffers:St.text,uniformValues:yu,atlasTexture:vu,atlasTextureIcon:Eo,atlasInterpolation:Ss,atlasInterpolationIcon:yn,isSDF:!0,hasHalo:Ba,depthMode:jo,tile:xt,renderWithShadows:jn,labelPlaneMatrixInv:Na}},Mn=St.icon.segments.get().length,tn=St.text.segments.get().length,Fi=Mn&&!w.onlyText?En():null,gn=tn&&!w.onlyIcons?wn():null,tr=u.paint.get("icon-opacity").constantOr(1),ir=u.paint.get("text-opacity").constantOr(1);if(je&&St.canOverlap){it=!0;const _n=tr&&!w.onlyText?St.icon.segments.get():[],Yi=ir&&!w.onlyIcons?St.text.segments.get():[];for(const Bi of _n)pt.push({segments:new s.bg([Bi]),sortKey:Bi.sortKey,state:Fi});for(const Bi of Yi)pt.push({segments:new s.bg([Bi]),sortKey:Bi.sortKey,state:gn})}else w.onlyText||pt.push({segments:tr?St.icon.segments:new s.bg([]),sortKey:0,state:Fi}),w.onlyIcons||pt.push({segments:ir?St.text.segments:new s.bg([]),sortKey:0,state:gn})}it&&pt.sort((Pt,xt)=>Pt.sortKey-xt.sortKey);for(const Pt of pt){const xt=Pt.state;if(xt)if(p.terrain?p.terrain.setupElevationDraw(xt.tile,xt.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:xt.labelPlaneMatrixInv}):p.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,xt.program),ve.activeTexture.set(pe.TEXTURE0),xt.atlasTexture&&xt.atlasTexture.bind(xt.atlasInterpolation,pe.CLAMP_TO_EDGE,!0),xt.atlasTextureIcon&&(ve.activeTexture.set(pe.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,pe.CLAMP_TO_EDGE,!0)),xt.renderWithShadows&&p.shadowRenderer.setupShadows(xt.tile.tileID.toUnwrapped(),xt.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,xt.program),xt.hasHalo){const St=xt.uniformValues;St.u_is_halo=1,Qd(xt.buffers,Pt.segments,u,p,xt.program,xt.depthMode,y,b,St,2),St.u_is_halo=0}else{if(xt.isSDF){const St=xt.uniformValues;xt.hasHalo&&(St.u_is_halo=1,Qd(xt.buffers,Pt.segments,u,p,xt.program,xt.depthMode,y,b,St,1)),St.u_is_halo=0}Qd(xt.buffers,Pt.segments,u,p,xt.program,xt.depthMode,y,b,xt.uniformValues,1)}}}function Qd(p,n,u,m,y,b,w,E,I,L){const R=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];y.draw(m,m.context.gl.TRIANGLES,b,w,E,fi.disabled,I,u.id,p.layoutVertexBuffer,p.indexBuffer,n,u.paint,m.transform.zoom,p.programConfigurations.get(u.id),R,L)}function Em(p,n){const u=1<<p.canonical.z,m=(n.x*u-p.canonical.x-p.wrap*u)*s.al,y=(n.y*u-p.canonical.y)*s.al,b=s.e8(n.z,n.y);return s.d5(m,y,b)}function Im(p,n,u,m,y){if(!u.layout||u.layout.get("fill-elevation-reference")==="none"||u.paint.get("fill-opacity").constantOr(1)===0)return;const b=p.context.gl,w=new Qt(p.context.gl.LEQUAL,Qt.ReadWrite,p.depthRangeFor3D),E=new Qt(p.context.gl.GREATER,Qt.ReadWrite,p.depthRangeFor3D),I=(function(U){let W=.01;return U.isOrthographic&&(W=s.ak(1e-4,W,s.d0(U.pitch>=Ca?1:U.pitch/Ca))),2*W})(p.transform),L=p.transform.getFreeCameraOptions().position,R="elevatedStructuresDepthReconstruct",N=p.getOrCreateProgram(R,{defines:["DEPTH_RECONSTRUCTION"]}),B=p.getOrCreateProgram(R);for(const U of m){const W=n.getTile(U),G=W.getBucket(u);if(!G)continue;const J=G.elevatedStructures;if(!J)continue;const K=G.elevationBufferData.heightRange,oe=Em(U.toUnwrapped(),L),re=p.translatePosMatrix(U.projMatrix,W,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));let ne,be,_e,ve;if(y==="initialize"){if(!K||K.min>=1||J.depthSegments.segments[0].primitiveLength===0)continue;ne=yc(re,oe,I,1,0),be=w,_e=J.depthSegments,ve=N}else if(y==="reset"){if(!K||K.min>=0||J.maskSegments.segments[0].primitiveLength===0)continue;ne=yc(re,oe,0,0,1),be=E,_e=J.maskSegments,ve=N}else if(y==="geometry"){if(J.depthSegments.segments[0].primitiveLength===0)continue;ne=yc(re,oe,I,1,0),be=w,_e=J.depthSegments,ve=B}ve.draw(p,b.TRIANGLES,be,xi.disabled,Mi.disabled,fi.disabled,ne,u.id,J.vertexBuffer,J.indexBuffer,_e,u.paint,p.transform.zoom)}}function au(p,n,u,m){const{painter:y,sourceCache:b,layer:w,coords:E,colorMode:I,elevationType:L,terrainEnabled:R,pass:N}=p,B=y.context.gl,U=w.paint.get("fill-pattern"),W=w.paint.get("fill-pattern-cross-fade"),G=U.constantOr(null);let J=L;L!=="road"||n&&!R||(J="none");const K=J==="road",oe=p.painter.shadowRenderer,re=K&&!!oe&&oe.enabled,ne=new Qt(y.context.gl.LEQUAL,Qt.ReadOnly,y.depthRangeFor3D);let be=[0,0,0];if(re){const he=y.style.directionalLight,Se=y.style.ambientLight;he&&Se&&(be=na(y.style,he,Se))}const _e=U&&U.constantOr(1),ve=y.terrain&&y.terrain.renderingToTexture,pe=(he,Se)=>{let ze,Re,Ze,je,it;Se?(ze=_e&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ze=B.LINES):(ze=_e?"fillPattern":"fill",Ze=B.TRIANGLES);for(const dt of E){const Fe=b.getTile(dt);if(_e&&!Fe.patternsLoaded())continue;const Te=Fe.getBucket(w);if(!Te)continue;const Ke=n?Te.elevationBufferData:Te.bufferData;if(Ke.isEmpty())continue;y.prepareDrawTile();const We=Ke.programConfigurations.get(w.id),pt=y.isTileAffectedByFog(dt),vt=[],Pt=[];K&&(vt.push("ELEVATED_ROADS"),Pt.push(Ke.elevatedLayoutVertexBuffer)),re&&vt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ve&&u&&vt.push("USE_MRT1"),_e&&(y.context.activeTexture.set(B.TEXTURE0),Fe.imageAtlasTexture&&Fe.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),We.updatePaintBuffers());let xt=!1;if(G&&Fe.imageAtlas){const Gt=Fe.imageAtlas,si=s.e3.from(G),pi=si.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Ni=si.getSecondary(),en=Gt.patternPositions.get(pi),Ei=Ni?Gt.patternPositions.get(Ni.scaleSelf(s.o.devicePixelRatio).toString()):null;xt=!!en&&!!Ei,en&&We.setConstantPatternPositions(en,Ei)}W>0&&(xt||We.getPatternTransitionVertexBuffer("fill-pattern"))&&vt.push("FILL_PATTERN_TRANSITION");const St=y.getOrCreateProgram(ze,{config:We,overrideFog:pt,defines:vt}),Xt=y.translatePosMatrix(dt.projMatrix,Fe,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));re&&oe.setupShadows(Fe.tileID.toUnwrapped(),St,"vector-tile");const Ht=w.paint.get("fill-emissive-strength");if(Se){je=Ke.lineIndexBuffer,it=Ke.lineSegments;const Gt=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];Re=ze==="fillOutlinePattern"&&_e?Xy(Xt,Ht,y,Fe,Gt,be,W):qy(Xt,Ht,Gt,be)}else je=Ke.indexBuffer,it=Ke.triangleSegments,Re=_e?ym(Xt,Ht,y,Fe,be,W):_c(Xt,Ht,be);y.uploadCommonUniforms(y.context,St,dt.toUnwrapped());let Rt=he;(L==="road"&&!R||L==="offset")&&(Rt=ne),St.draw(y,Ze,Rt,m||y.stencilModeForClipping(dt),I,fi.disabled,Re,w.id,Ke.layoutVertexBuffer,je,it,w.paint,y.transform.zoom,We,Pt)}};y.renderPass===N&&pe(y.depthModeForSublayer(1,y.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly),!1),J==="none"&&y.renderPass==="translucent"&&w.paint.get("fill-antialias")&&pe(y.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly),!0)}function lu(p,n,u,m,y,b,w,E){u.resetLayerRenderingStats(p);const I=p.context,L=I.gl,R=p.transform,N=u.paint.get("fill-extrusion-pattern"),B=u.paint.get("fill-extrusion-pattern-cross-fade"),U=N.constantOr(null),W=N.constantOr(1),G=u.paint.get("fill-extrusion-opacity"),J=p.style.enable3dLights(),K=u.paint.get(J&&!W?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),oe=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],re=u.layout.get("fill-extrusion-edge-radius"),ne=re>0&&!u.paint.get("fill-extrusion-rounded-roof"),be=ne?0:re,_e=R.projection.name==="globe"?s.eb():0,ve=R.projection.name==="globe",pe=ve?s.aj(R.zoom):0,he=[s.aF(R.center.lng),s.aJ(R.center.lat)],Se=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ze=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Se?null:u.lut).toArray01().slice(0,3),Re=u.paint.get("fill-extrusion-flood-light-intensity"),Ze=u.paint.get("fill-extrusion-vertical-scale"),je=u.paint.get("fill-extrusion-line-width").constantOr(1)!==0,it=u.paint.get("fill-extrusion-height-alignment"),dt=u.paint.get("fill-extrusion-base-alignment"),Fe=ia(p,u.paint.get("fill-extrusion-cutoff-fade-range")),Te=[];let Ke;ve&&Te.push("PROJECTION_GLOBE_VIEW"),oe[0]>0&&Te.push("FAUX_AO"),ne&&Te.push("ZERO_ROOF_RADIUS"),E&&Te.push("HAS_CENTROID"),Re>0&&Te.push("FLOOD_LIGHT"),Fe.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),je&&Te.push("RENDER_WALL_MODE");const We=p.renderPass==="shadow",pt=p.shadowRenderer,vt=We&&!!pt,Pt=We?fi.disabled:fi.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let xt=[0,0,0];if(pt){const Ht=p.style.directionalLight,Rt=p.style.ambientLight;Ht&&Rt&&(xt=na(p.style,Ht,Rt)),We||(Te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),pt.useNormalOffset&&Te.push("NORMAL_OFFSET")),Ke=Te.concat(["SHADOWS_SINGLE_CASCADE"])}const St=vt?"fillExtrusionDepth":W?"fillExtrusionPattern":"fillExtrusion",Xt=u.getLayerRenderingStats();for(const Ht of m){const Rt=n.getTile(Ht),Gt=Rt.getBucket(u);if(!Gt||Gt.projection.name!==R.projection.name)continue;let si=!1;pt&&(si=pt.getMaxCascadeForTile(Ht.toUnwrapped())===0);const pi=p.isTileAffectedByFog(Ht),Ni=Gt.programConfigurations.get(u.id);let en=!1;if(U&&Rt.imageAtlas){const tn=Rt.imageAtlas,Fi=s.e3.from(U),gn=Fi.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),tr=Fi.getSecondary(),ir=tn.patternPositions.get(gn),_n=tr?tn.patternPositions.get(tr.scaleSelf(s.o.devicePixelRatio).toString()):null;en=!!ir&&!!_n,ir&&Ni.setConstantPatternPositions(ir,_n)}B>0&&(en||Ni.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Te.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ei=p.getOrCreateProgram(St,{config:Ni,defines:si?Ke:Te,overrideFog:pi});if(p.terrain&&p.terrain.setupElevationDraw(Rt,Ei,{useMeterToDem:!0}),!Gt.centroidVertexBuffer){const tn=Ei.getAttributeLocation(L,"a_centroid_pos");tn!==-1&&L.vertexAttrib2f(tn,0,0)}!We&&pt&&pt.setupShadows(Rt.tileID.toUnwrapped(),Ei,"vector-tile"),W&&(p.context.activeTexture.set(L.TEXTURE0),Rt.imageAtlasTexture&&Rt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ni.updatePaintBuffers());const ln=u.paint.get("fill-extrusion-vertical-gradient"),Ri=1/Gt.tileToMeter;let En;if(We&&pt){if(Mm(Rt.tileID,Gt.maxHeight,p))continue;const tn=pt.calculateShadowPassMatrixFromTile(Rt.tileID.toUnwrapped());En=_m(tn,be,Ri,Ze,it,dt)}else{const tn=p.translatePosMatrix(Ht.expandedProjMatrix,Rt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Fi=R.projection.createInversionMatrix(R,Ht.canonical);En=W?Wy(tn,p,ln,G,oe,be,Ri,Ht,Rt,_e,it,dt,pe,he,Fi,ze,Ze,B):Gd(tn,p,ln,G,oe,be,Ri,Ht,_e,it,dt,pe,he,Fi,ze,Ze,Re,xt)}p.uploadCommonUniforms(I,Ei,Ht.toUnwrapped(),null,Fe);let wn=Gt.segments;if(R.projection.name==="mercator"&&!We&&(wn=Gt.getVisibleSegments(Rt.tileID,p.terrain,p.transform.getFrustum(0)),!wn.get().length))continue;if(Xt)if(We)for(const tn of wn.get())Xt.numRenderedVerticesInShadowPass+=tn.primitiveLength;else for(const tn of wn.get())Xt.numRenderedVerticesInTransparentPass+=tn.primitiveLength;const Mn=[];(p.terrain||E)&&Mn.push(Gt.centroidVertexBuffer),ve&&Mn.push(Gt.layoutVertexExtBuffer),je&&Mn.push(Gt.wallVertexBuffer),Ei.draw(p,I.gl.TRIANGLES,y,b,w,Pt,En,u.id,Gt.layoutVertexBuffer,Gt.indexBuffer,wn,u.paint,p.transform.zoom,Ni,Mn)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class Th{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Da(p,n,u,m,y,b,w,E,I,L,R,N,B,U,W,G,J,K,oe,re){const ne=n.context,be=ne.gl,_e=n.transform,ve=n.transform.zoom,pe=[],he=p.translate,Se=p.translateAnchor,ze=p.edgeRadius,Re=ia(n,p.cutoffFadeRange);R==="clear"?(pe.push("CLEAR_SUBPASS"),re&&(pe.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(be.TEXTURE0),re.bind(be.LINEAR,be.CLAMP_TO_EDGE))):R==="sdf"?pe.push("SDF_SUBPASS"):R==="emissive"&&(pe.push("USE_MRT1"),ne.activeTexture.set(be.TEXTURE0),re.bind(be.LINEAR,be.CLAMP_TO_EDGE)),K&&pe.push("HAS_CENTROID"),Re.shouldRenderCutoff&&pe.push("RENDER_CUTOFF");const Ze=(je,it,dt,Fe,Te)=>{let Ke=pe;it.groundRadiusBuffer!=null&&(Ke=pe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const We=it.programConfigurations.get(m.id),pt=n.isTileAffectedByFog(je),vt=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:We,defines:Ke,overrideFog:pt}),Pt=((St,Xt,Ht,Rt,Gt,si,pi,Ni,en,Ei,ln)=>({u_matrix:Xt,u_opacity:Ht,u_ao_pass:Rt?1:0,u_meter_to_tile:Gt,u_ao:si,u_flood_light_intensity:pi,u_flood_light_color:Ni,u_attenuation:en,u_edge_radius:Ei,u_fb:0,u_fb_size:ln,u_dynamic_offset:1}))(0,Fe,N,L,Te,[B,U*Te],W,G,J,ve>=17?0:ze*Te,re?re.size[0]:0),xt=[];K&&xt.push(it.hiddenByLandmarkVertexBuffer),it.groundRadiusBuffer!=null&&xt.push(it.groundRadiusBuffer),n.uploadCommonUniforms(ne,vt,je.toUnwrapped(),null,Re),vt.draw(n,ne.gl.TRIANGLES,b,w,E,I,Pt,m.id,it.vertexBuffer,it.indexBuffer,dt,m.paint,ve,We,xt)};for(const je of y){const it=u.getTile(je),dt=it.getBucket(m);if(!dt||dt.projection.name!==_e.projection.name||!dt.groundEffect||dt.groundEffect&&!dt.groundEffect.hasData())continue;const Fe=dt.groundEffect,Te=1/dt.tileToMeter;{const Ke=n.translatePosMatrix(je.projMatrix,it,he,Se),We=Fe.getDefaultSegment();Ze(je,Fe,We,Ke,Te)}if(oe)for(let Ke=0;Ke<4;Ke++){const We=s.e9[Ke](je),pt=u.getTile(We);if(!pt)continue;const vt=pt.getBucket(m);if(!vt||vt.projection.name!==_e.projection.name||!vt.groundEffect||vt.groundEffect&&!vt.groundEffect.hasData())continue;const Pt=vt.groundEffect;let xt,St;Ke===0?(xt=[-s.al,0,0],St=1):Ke===1?(xt=[s.al,0,0],St=0):Ke===2?(xt=[0,-s.al,0],St=3):(xt=[0,s.al,0],St=2);const Xt=Pt.regionSegments[St];if(!Xt)continue;const Ht=new Float32Array(16);s.br(Ht,je.projMatrix,xt),Ze(je,Pt,Xt,n.translatePosMatrix(Ht,it,he,Se),Te)}}}function nv(p,n,u,m,y,b,w){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const E=b?b.findDEMTileFor(u):null;if(!(E&&E.dem||w))return;b&&E&&E.dem&&m.selfDEMTileTimestamp!==E.dem._timestamp&&(m.borderDoneWithNeighborZ=[-1,-1,-1,-1],m.selfDEMTileTimestamp=E.dem._timestamp);const I=(J,K)=>{(J.flags|K.flags)&s.ec?(J.flags|=s.ec,K.flags|=s.ec):(J.flags&=~s.ec,K.flags&=~s.ec)},L=J=>new s.P(Math.ceil((J+s.ed)*s.ee),0),R=J=>{const K=n.getSource().minzoom,oe=ne=>{const be=n.getTileByID(ne);if(be&&be.hasData())return be.getBucket(y)},re=[0,-1,1];for(const ne of re){if(J.overscaledZ+ne<K)continue;const be=oe(J.calculateScaledKey(J.overscaledZ+ne));if(be)return be}},N=[0,0,0],B=(J,K)=>(N[0]=Math.min(J.min.y,K.min.y),N[1]=Math.max(J.max.y,K.max.y),N[2]=s.al-K.min.x>J.max.x?K.min.x-s.al:J.max.x,N),U=(J,K)=>(N[0]=Math.min(J.min.x,K.min.x),N[1]=Math.max(J.max.x,K.max.x),N[2]=s.al-K.min.y>J.max.y?K.min.y-s.al:J.max.y,N),W=[(J,K)=>B(J,K),(J,K)=>B(K,J),(J,K)=>U(J,K),(J,K)=>U(K,J)],G=(J,K,oe,re,ne,be,_e)=>{if(!b)return 0;const ve=[[be?oe:J,be?J:oe,0],[be?oe:K,be?K:oe,0]],pe=_e<0?s.al+_e:_e,he=[be?pe:(J+K)/2,be?(J+K)/2:pe,0];return oe===0&&_e<0||oe!==0&&_e>0?b.getForTilePoints(ne,[he],!0,re):ve.push(he),b.getForTilePoints(u,ve,!0,E),Math.max(ve[0][2],ve[1][2],he[2])/b.exaggeration()};for(let J=0;J<4;J++){const K=m.borderFeatureIndices[J];if(K.length===0)continue;const oe=s.e9[J](u),re=R(oe);if(!(re&&re instanceof s.ea))continue;const ne=b?b.findDEMTileFor(oe):null;if(!(ne&&ne.dem||w)||(b&&ne&&ne.dem&&m.borderDEMTileTimestamp[J]!==ne.dem._timestamp&&(m.borderDoneWithNeighborZ[J]=-1,m.borderDEMTileTimestamp[J]=ne.dem._timestamp),m.borderDoneWithNeighborZ[J]===re.canonical.z))continue;re.centroidVertexArray.length===0&&re.createCentroidsBuffer();const be=(J<2?1:5)-J,_e=re.borderDoneWithNeighborZ[be]!==m.canonical.z,ve=re.borderFeatureIndices[be];let pe=0;if(m.canonical.z!==re.canonical.z){for(const he of K)m.showCentroid(m.featuresOnBorder[he]);if(_e)for(const he of ve)re.showCentroid(re.featuresOnBorder[he]);m.borderDoneWithNeighborZ[J]=re.canonical.z,re.borderDoneWithNeighborZ[be]=m.canonical.z}for(const he of K){const Se=m.featuresOnBorder[he],ze=m.centroidData[Se.centroidDataIndex],Re=Se.borders[J];let Ze;for(;pe<ve.length;){Ze=re.featuresOnBorder[ve[pe]];const je=Ze.borders[be];if(je[1]>Re[0]+3||je[0]>Re[0]-3)break;re.showCentroid(Ze),pe++}if(Ze&&pe<ve.length){const je=pe;let it=0;for(;!(Ze.borders[be][0]>Re[1]-3)&&(it++,++pe!==ve.length);)Ze=re.featuresOnBorder[ve[pe]];Ze=re.featuresOnBorder[ve[je]];let dt=!1;if(it>=1){const Ke=Ze.borders[be];Math.abs(Re[0]-Ke[0])<3&&Math.abs(Re[1]-Ke[1])<3&&(it=1,dt=!0,pe=je+1)}else if(it===0){m.showCentroid(Se);continue}const Fe=re.centroidData[Ze.centroidDataIndex];w&&dt&&I(ze,Fe);const Te=Se.intersectsCount()>1||Ze.intersectsCount()>1;if(it>1)pe=je,ze.centroidXY=Fe.centroidXY=new s.P(0,0);else if(ne&&ne.dem&&!Te){const Ke=W[J](ze,Fe),We=J%2?s.al-1:0,pt=G(Ke[0],Math.min(s.al-1,Ke[1]),We,ne,oe,J<2,Ke[2]);ze.centroidXY=Fe.centroidXY=L(pt)}else Te?ze.centroidXY=Fe.centroidXY=new s.P(0,0):(ze.centroidXY=m.encodeBorderCentroid(Se),Fe.centroidXY=re.encodeBorderCentroid(Ze));m.writeCentroidToBuffer(ze),re.writeCentroidToBuffer(Fe)}else m.showCentroid(Se)}m.borderDoneWithNeighborZ[J]=re.canonical.z,re.borderDoneWithNeighborZ[be]=m.canonical.z}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const rv=[1,0,0],ov=[0,1,0],sv=[0,0,1];function Mm(p,n,u){const m=u.transform,y=u.shadowRenderer;if(!y)return!0;const b=p.toUnwrapped(),w=m.tileSize*y._cascades[u.currentShadowCascade].scale;let E=n;if(m.elevation){const G=m.elevation.getMinMaxForTile(p);G&&(E+=G.max)}const I=[...y.shadowDirection];I[2]=-I[2];const L=y.computeSimplifiedTileShadowVolume(b,E,w,I);if(!L)return!1;const R=[rv,ov,sv,I,[I[0],0,I[2]],[0,I[1],I[2]]],N=m.projection.name==="globe",B=m.scaleZoom(w),U=s.cB.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,B,!N),W=y.getCurrentCascadeFrustum();return U.intersectsPrecise(L.vertices,L.planes,R)===0||W.intersectsPrecise(L.vertices,L.planes,R)===0}function cu(p){const{painter:n,source:u,layer:m,coords:y}=p;let b=p.defines;const w=n.context,E=n.renderPass==="shadow",I=n.renderPass==="light-beam",L=n.shadowRenderer,R=s.ef(n.transform.center.lat,n.transform.zoom),N=ia(n,m.paint.get("building-cutoff-fade-range"));N.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),p.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const B of y){const U=u.getTile(B),W=U.getBucket(m);if(!W)continue;L&&L.getMaxCascadeForTile(B.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const G=W.programConfigurations.get(m.id);let J,K,oe,re=n.translatePosMatrix(B.expandedProjMatrix,U,[0,0],"map");if(re=s.cS(s.bC(),re,[1,1,p.verticalScale]),E&&L){if(Mm(U.tileID,W.maxHeight*R,n))continue;let be=L.calculateShadowPassMatrixFromTile(U.tileID.toUnwrapped());be=s.cS(s.bC(),be,[1,1,p.verticalScale]),oe=Nl(be),J=K=n.getOrCreateProgram("buildingDepth",{config:G,defines:b,overrideFog:!1})}else if(I)J=K=n.getOrCreateProgram("buildingBloom",{config:G,defines:b,overrideFog:!1}),oe=Jy(re);else{const be=n.transform.calculatePosMatrix(B.toUnwrapped(),n.transform.worldSize);s.cS(be,be,[1,1,p.verticalScale]);const _e=s.bC();s.cS(_e,be,[1,-1,1/R]),s.bl(_e,_e),s.eg(_e,_e);const ve=n.transform.getFreeCameraOptions().position,pe=1<<B.canonical.z;if(oe=Hd(re,_e,p.opacity,p.facadeAOIntensity,[((ve.x-B.wrap)*pe-B.canonical.x)*s.al,(ve.y*pe-B.canonical.y)*s.al,ve.z*pe*s.al],W.tileToMeter,p.facadeEmissiveChance,p.floodLightColor,p.floodLightIntensity),K=n.getOrCreateProgram("building",{config:G,defines:b,overrideFog:!1}),p.depthOnly===!0)J=K;else{const he=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);J=n.getOrCreateProgram("building",{config:G,defines:he,overrideFog:!1})}L&&(L.setupShadowsFromMatrix(be,K,!0),J!==K&&L.setupShadowsFromMatrix(be,J,!0))}const ne=(be,_e)=>{if(I){const ve=be.entranceBloom;_e.draw(n,w.gl.TRIANGLES,p.depthMode,xi.disabled,p.blendMode,fi.disabled,oe,m.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segmentsBucket,m.paint,n.transform.zoom,G,[ve.layoutAttenuationBuffer,ve.layoutColorBuffer])}else{const ve=be.segmentsBucket;let pe=[be.layoutNormalBuffer,be.layoutCentroidBuffer,be.layoutColorBuffer,be.layoutFloodLightDataBuffer];be.layoutFacadePaintBuffer&&(pe=pe.concat([be.layoutFacadeDataBuffer,be.layoutFacadeVerticalRangeBuffer,be.layoutFacadePaintBuffer])),_e.draw(n,w.gl.TRIANGLES,p.depthMode,xi.disabled,p.blendMode,E?fi.disabled:fi.backCW,oe,m.id,be.layoutVertexBuffer,be.indexBuffer,ve,m.paint,n.transform.zoom,G,pe)}};n.uploadCommonUniforms(w,K,B.toUnwrapped(),null,N),W.buildingWithoutFacade&&ne(W.buildingWithoutFacade,K),W.buildingWithFacade&&(J!==K&&n.uploadCommonUniforms(w,J,B.toUnwrapped(),null,N),ne(W.buildingWithFacade,J))}}function ef(p,n,u,m,y,b,w,E,I,L,R,N,B){const U=p.context.gl,W=p.depthModeForSublayer(1,Qt.ReadOnly,U.LEQUAL,!0),G=.1*(1-(J=R))+3*J;var J;const K=p._showOverdrawInspector,oe=N,re=new Th;K||Da(re,p,n,u,m,W,new xi({func:U.ALWAYS,mask:255},255,255,U.KEEP,U.KEEP,U.REPLACE),new Mi([U.ONE,U.ONE,U.ONE,U.ONE],s.ao.transparent,[!1,!1,!1,!0],U.MIN),fi.disabled,y,"sdf",b,w,E,I,L,G,oe,!1);{const ne=K?xi.disabled:new xi({func:U.EQUAL,mask:255},255,255,U.KEEP,U.DECR,U.DECR),be=K?p.colorModeForRenderPass():new Mi([U.ONE_MINUS_DST_ALPHA,U.DST_ALPHA,U.ONE,U.ONE],s.ao.transparent,[!0,!0,!0,!0]);Da(re,p,n,u,m,W,ne,be,fi.disabled,y,"color",b,w,E,I,L,G,oe,!1)}}function Am(p){return[p[0]*s.eh,p[1]*s.eh,p[2]*s.eh,0]}function tf(p,n,u,m,y,b,w,E,I){const L=m.getSource(),R=u.globeSharedBuffers;if(!R)return;let N,B,U;if(n&&(N=m.getTile(n)),L instanceof s.aU?(B=L.texture,U=s.dK(0,0,u.transform)):N&&n&&(B=N.texture,U=s.dK(n.canonical.z,n.canonical.x,u.transform)),!B||!U)return;p||(U=s.cS(s.bC(),U,[1,-1,1]));const W=u.context,G=W.gl,J=y.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,K=u.colorModeForDrapableLayerRenderPass(b),oe=w.defines;oe.push("GLOBE_POLES");const re=new Qt(G.LEQUAL,Qt.ReadWrite,u.depthRangeFor3D),ne=Float32Array.from(u.transform.expandedFarZProjMatrix),be=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),W.activeTexture.set(G.TEXTURE0),B.bind(J,G.CLAMP_TO_EDGE),W.activeTexture.set(G.TEXTURE1),B.bind(J,G.CLAMP_TO_EDGE),"useMipmap"in B&&W.extTextureFilterAnisotropic&&u.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const[_e,ve,pe,he]=n?R.getPoleBuffers(n.canonical.z,!1):R.getPoleBuffers(0,!0),Se=y.paint.get("raster-elevation");let ze;p?(ze=_e,u.renderDefaultNorthPole=Se!==0):(ze=ve,u.renderDefaultSouthPole=Se!==0);const Re=Am(w.mix),Ze=((it,dt,Fe,Te,Ke,We,pt,vt,Pt,xt,St,Xt,Ht)=>Sm(it,dt,Fe,new Float32Array(16),new Float32Array(9),[0,0],Te,[0,0],[0,0,0,0],1,{opacity:1,mix:0},We,[0,0],vt,2,xt,St,Xt,1,0,Ht))(ne,be,U,s.aj(u.transform.zoom),0,y,0,Se,0,Re,w.offset,w.range,b),je=u.getOrCreateProgram("raster",{defines:oe});u.uploadCommonUniforms(W,je,null),je.draw(u,G.TRIANGLES,re,I,K,E,Ze,y.id,ze,pe,he)}function av(p){if(p.isOrthographic)return[0,0,0,0];const n=p._nearZ,u=p.projection.farthestPixelDistance(p),m=u-n,y=.2*p.height,b=n+y;return[n,u,(b-y-n)/m,(b-n)/m]}function lv(p,n,u,m){if(p)return n instanceof Fo&&p instanceof _d?n.getTextureDescriptor(p,u,!0):{texture:p.texture,mix:Am(m.mix),offset:m.offset,buffer:0,tileSize:1}}var Pm=s.ei([{name:"a_index",type:"Int16",components:1}]);class cv{constructor(n,u,m,y){const b={width:m[0],height:m[1],data:null},w=n.gl;this.targetColorTexture=new s.T(n,b,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,b,w.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(u,y),this.lastInvalidatedAt=0}updateParticleTexture(n,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,y=u.width*u.height;this.particleTexture0=new s.T(this.context,u,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,u,m.RGBA8,{premultiply:!1,useMipmap:!1});const b=new s.ej;b.reserve(y);for(let w=0;w<y;w++)b.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(b,Pm.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function zm(p,n,u){if(!p)return null;const m=n.getTextureDescriptor(p,u,!0);if(!m)return null;let{texture:y,mix:b,offset:w,tileSize:E,buffer:I,format:L}=m;if(!y||!L)return null;let R=!1;return L==="uint32"&&(R=!0,b[3]=0,b=Wd(s.ek,b,[0,u.paint.get("raster-particle-max-speed")]),w=Ky(s.ek,w,[0,u.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[I/(E+2*I),E/(E+2*I)],tileSize:E,scalarData:R,scale:b,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function uv(p){const n=p._nearZ,u=p.projection.farthestPixelDistance(p),m=u-n,y=.2*p.height,b=n+y;return[n,u,(b-y-n)/m,(b-n)/m]}const Cm=new s.ao(1,0,0,1),Lm=new s.ao(0,1,0,1),Rm=new s.ao(0,0,1,1),Rw=new s.ao(1,0,1,1),Dw=new s.ao(0,1,1,1);function hv(p,n,u,m,y,b){for(let w=0;w<u.length;w++)if(y){const L=new s.ao(m.r*.8,m.g*.8,m.b*.8,1);$l(p,n,u[w],m,-1,-1,b),$l(p,n,u[w],m,-1,1,b),$l(p,n,u[w],m,1,1,b),$l(p,n,u[w],m,1,-1,b),$l(p,n,u[w],L,0,0,b)}else $l(p,n,u[w],m,0,0,b)}function $l(p,n,u,m,y,b,w){const E=p.context,I=p.transform,L=E.gl,R=I.projection.name==="globe",N=R?["PROJECTION_GLOBE_VIEW"]:[];let B=s.bz(u.projMatrix);if(R&&s.aj(I.zoom)>0){const Re=s.bj(u.canonical,I),Ze=s.el(Re);B=s.aB(new Float32Array(16),I.globeMatrix,Ze),s.aB(B,I.projMatrix,B)}const U=s.bC();U[12]+=2*y/(s.o.devicePixelRatio*I.width),U[13]+=2*b/(s.o.devicePixelRatio*I.height),s.aB(B,U,B);const W=p.getOrCreateProgram("debug",{defines:N}),G=n.getTileByID(u.key);p.terrain&&p.terrain.setupElevationDraw(G,W);const J=Qt.disabled,K=xi.disabled,oe=p.colorModeForRenderPass(),re="$debug";E.activeTexture.set(L.TEXTURE0),p.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),R?G._makeGlobeTileDebugBuffers(p.context,I):G._makeDebugTileBoundsBuffers(p.context,I.projection);const ne=G._tileDebugBuffer||p.debugBuffer,be=G._tileDebugIndexBuffer||p.debugIndexBuffer,_e=G._tileDebugSegments||p.debugSegments;if(W.draw(p,L.LINE_STRIP,J,K,oe,fi.disabled,bm(B,m.toPremultipliedRenderColor(null)),re,ne,be,_e,null,null,null,[G._globeTileDebugBorderBuffer]),w){const Re=G.latestRawTileData,Ze=Math.floor((Re&&Re.byteLength||0)/1024);let je=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(je+=` => ${u.overscaledZ}`),je+=` ${G.state}`,je+=` ${Ze}kb`,(function(it,dt){it.initDebugOverlayCanvas();const Fe=it.debugOverlayCanvas,Te=it.context.gl,Ke=it.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Fe.width,Fe.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(dt,5,5),Ke.strokeText(dt,5,5),it.debugOverlayTexture.update(Fe),it.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)})(p,je)}const ve=n.getTile(u).tileSize,pe=512/Math.min(ve,512)*(u.overscaledZ/I.zoom)*.5,he=G._tileDebugTextBuffer||p.debugBuffer,Se=G._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,ze=G._tileDebugTextSegments||p.debugSegments;W.draw(p,L.TRIANGLES,J,K,Mi.alphaBlended,fi.disabled,bm(B,s.ao.transparent.toPremultipliedRenderColor(null),pe),re,he,Se,ze,null,null,null,[G._globeTileDebugTextBuffer])}function dv(p,n,u,m){nf(p,0,n+u/2,p.transform.width,u,m)}function Dm(p,n,u,m){nf(p,n-u/2,0,u,p.transform.height,m)}function nf(p,n,u,m,y,b){const w=p.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(n*s.o.devicePixelRatio,u*s.o.devicePixelRatio,m*s.o.devicePixelRatio,y*s.o.devicePixelRatio),w.clear({color:b}),E.disable(E.SCISSOR_TEST)}const fv=s.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:kw}=fv;function Vl(p,n,u,m){p.emplaceBack(n,u,m)}class ss{constructor(n){this.vertexArray=new s.em,this.indices=new s.b0,Vl(this.vertexArray,-1,-1,1),Vl(this.vertexArray,1,-1,1),Vl(this.vertexArray,-1,1,1),Vl(this.vertexArray,1,1,1),Vl(this.vertexArray,-1,-1,-1),Vl(this.vertexArray,1,-1,-1),Vl(this.vertexArray,-1,1,-1),Vl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,kw),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function jl(p,n,u,m,y,b){const w=p.context.gl,E=n.paint.get("sky-atmosphere-color"),I=n.paint.get("sky-atmosphere-halo-color"),L=n.paint.get("sky-atmosphere-sun-intensity"),R=((N,B,U,W,G)=>({u_matrix_3f:N,u_sun_direction:B,u_sun_intensity:U,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(s.eo(s.dO(),m),y,L,E.toPremultipliedRenderColor(null),I.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),u.draw(p,w.TRIANGLES,Qt.disabled,xi.disabled,Mi.unblended,fi.frontCW,R,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Uo=s.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Gl{constructor(n){const u=new s.ep;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const m=new s.b0;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(u,Uo.members),this.indexBuffer=n.createIndexBuffer(m),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const pv=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class km{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Om{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Mi([1,Ll,1,Ll],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Mi([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new km,this.updateNeeded=!0}update(n){const u=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Gl(u);const m=this.params.sizeRange,y=this.params.intensityRange,b=(function(R){const N=s.eq(30),B=[];for(let U=0;U<R;++U){const W=2*Math.PI*N(),G=Math.acos(1-2*N())-.5*Math.PI;B.push(s.d5(Math.cos(G)*Math.cos(W),Math.cos(G)*Math.sin(W),Math.sin(G)))}return B})(this.params.starsCount),w=s.eq(300),E=new s.er,I=new s.b0;let L=0;for(let R=0;R<b.length;++R){const N=s.c5([],b[R],200),B=Math.max(0,1+.01*m*(1*w()-.5)),U=Math.max(0,1+.01*y*(1*w()-.5));E.emplaceBack(N[0],N[1],N[2],-1,-1,B,U),E.emplaceBack(N[0],N[1],N[2],1,-1,B,U),E.emplaceBack(N[0],N[1],N[2],1,1,B,U),E.emplaceBack(N[0],N[1],N[2],-1,1,B,U),I.emplaceBack(L+0,L+1,L+2),I.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=u.createVertexBuffer(E,pv.members),this.starsIdx=u.createIndexBuffer(I),this.starsSegments=s.bg.simpleSegment(0,0,E.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,u){const m=n.context,y=m.gl,b=n.transform,w=new Qt(y.LEQUAL,Qt.ReadOnly,[0,1]),E=s.aj(b.zoom),I=n.style.getLut(u.scope),L=u.properties.get("color-use-theme")==="none",R=u.properties.get("color").toNonPremultipliedRenderColor(L?null:I),N=u.properties.get("high-color-use-theme")==="none",B=u.properties.get("high-color").toNonPremultipliedRenderColor(N?null:I),U=u.properties.get("space-color-use-theme")==="none",W=u.properties.get("space-color").toNonPremultipliedRenderColor(U?null:I),G=5e-4,J=s.es(u.properties.get("horizon-blend"),0,1,G,.25),K=s.dE(n,m,b)&&J===G?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,oe=n.frameCounter/1e3%1,re=s.ag(b.globeCenterInViewSpace),ne=Math.sqrt(Math.pow(re,2)-Math.pow(K,2)),be=Math.acos(ne/re),_e=ve=>{const pe=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&pe.push("ALPHA_PASS");const he=n.getOrCreateProgram("globeAtmosphere",{defines:pe}),Se=((Re,Ze,je,it,dt,Fe,Te,Ke,We,pt,vt,Pt)=>({u_frustum_tl:Re,u_frustum_tr:Ze,u_frustum_br:je,u_frustum_bl:it,u_horizon:dt,u_transition:Fe,u_fadeout_range:Te,u_atmosphere_fog_color:Ke.toArray01(),u_high_color:We.toArray01(),u_space_color:pt.toArray01(),u_temporal_offset:vt,u_horizon_angle:Pt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,E,J,R,B,W,oe,be);n.uploadCommonUniforms(m,he);const ze=this.atmosphereBuffer;ze&&he.draw(n,y.TRIANGLES,w,xi.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,fi.backCW,Se,ve?"atmosphere_glow_alpha":"atmosphere_glow",ze.vertexBuffer,ze.indexBuffer,ze.segments)};_e(!1),_e(!0)}drawStars(n,u){const m=s.aA(u.properties.get("star-intensity"),0,1);if(m===0)return;const y=n.context,b=y.gl,w=n.transform,E=n.getOrCreateProgram("stars"),I=s.c7([]);s.c9(I,I,-w._pitch),s.c8(I,I,-w.angle),s.c9(I,I,s.an(w._center.lat)),s.et(I,I,-s.an(w._center.lng));const L=s.cc(new Float32Array(16),I),R=s.aB([],w.starsProjMatrix,L),N=s.eo([],L),B=s.eu([],N),U=[0,1,0];s.dQ(U,U,B),s.c5(U,U,this.params.sizeMultiplier);const W=[1,0,0];s.dQ(W,W,B),s.c5(W,W,this.params.sizeMultiplier);const G=(J=U,K=W,oe=m,{u_matrix:Float32Array.from(R),u_up:J,u_right:K,u_intensity_multiplier:oe});var J,K,oe;n.uploadCommonUniforms(y,E),this.starsVx&&this.starsIdx&&E.draw(n,b.TRIANGLES,Qt.disabled,xi.disabled,this.colorModeAlphaBlendedWriteRGB,fi.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Fm{constructor(){this.visibleTiles=[]}updateBorders(n,u){const m=[],y=[],b=n._getRenderableCoordinates(!1,!0);for(const I of b){const L=n.getTile(I);if(!L.hasData())continue;const R=L.getBucket(u);R&&(R.isEmpty()||(m.push(I.key),y.push({bucket:R,tileID:I.canonical})))}let w=m.length!==this.visibleTiles.length;if(!w){m.sort();for(let I=0;I<m.length;I++)if(m[I]!==this.visibleTiles[I]){w=!0;break}}if(!w)return;const E=new Set;this.visibleTiles=m,y.sort((I,L)=>I.tileID.z-L.tileID.z||I.tileID.x-L.tileID.x||I.tileID.y-L.tileID.y);for(const I of y){const L=new Array,R=new Array,N=I.bucket;for(const B of N.featuresOnBorder)E.has(B.featureId)?R.push(B.footprintIndex):(E.add(B.featureId),L.push(B.footprintIndex));N.updateFootprintHiddenFlags(L,s.ev,!1),N.updateFootprintHiddenFlags(R,s.ev,!0)}}}function Bm(p,n){const u=[...p],m=n.cameraWorldSizeForFog/n.worldSize,y=s.bA([]);return s.cS(y,y,[m,m,1]),s.aB(u,y,u),s.aB(u,n.worldToFogMatrix,u),u}function ma(p,n,u,m,y){const b=u.material,w=m.context,{baseColorTexture:E,metallicRoughnessTexture:I}=b.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:R,emissionTexture:N}=b;function B(W,G,J){if(W&&(p.push(G),w.activeTexture.set(w.gl.TEXTURE0+J),W.gfxTexture)){const{minFilter:K,magFilter:oe,wrapS:re,wrapT:ne}=W.sampler;W.gfxTexture.bindExtraParam(K,oe,re,ne)}}B(E,"HAS_TEXTURE_u_baseColorTexture",5),B(I,"HAS_TEXTURE_u_metallicRoughnessTexture",6),B(L,"HAS_TEXTURE_u_normalTexture",7),B(R,"HAS_TEXTURE_u_occlusionTexture",8),B(N,"HAS_TEXTURE_u_emissionTexture",9),y&&(y.texture||(y.texture=new s.d$(m.context,y.image,[y.image.height,y.image.height,y.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+10),y.texture&&y.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(u.texcoordBuffer)),u.colorBuffer&&(p.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(u.colorBuffer)),u.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(u.normalBuffer)),u.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(u.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||p.push("DIFFUSE_SHADED");const U=m.shadowRenderer;U&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&p.push("NORMAL_OFFSET"))}function An(p,n,u,m,y,b){const w=p.modelOpacity,E=n.context,I=new Qt(n.context.gl.LEQUAL,p.isLightMesh?Qt.ReadOnly:Qt.ReadWrite,n.depthRangeFor3D),L=n.transform,R=p.mesh,N=R.material,B=N.pbrMetallicRoughness,U=n.style.fog;let W;W=n.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:s.aB([],m.zScaleMatrix,p.nodeModelMatrix),s.aB(W,m.negCameraPosMatrix,W);const G=s.bl([],W);s.eg(G,G);const J=u.paint.get("model-color-use-theme").constantOr("default")==="none",K=u.paint.get("model-emissive-strength").constantOr(0),oe=Xd(new Float32Array(p.worldViewProjection),new Float32Array(W),new Float32Array(G),null,n,w,B.baseColorFactor,N.emissiveFactor,B.metallicFactor,B.roughnessFactor,N,K,u,void 0,void 0,p.materialOverride,p.modelColor),re={defines:[]},ne=[],be=n.shadowRenderer;be&&(be.useNormalOffset=!1),ma(re.defines,ne,R,n,J?null:u.lut);let _e=null;if(U){const he=Bm(p.nodeModelMatrix,n.transform);if(_e=new Float32Array(he),L.projection.name!=="globe"){const Se=R.aabb.min,ze=R.aabb.max,[Re,Ze]=U.getOpacityForBounds(he,Se[0],Se[1],ze[0],ze[1]);re.overrideFog=Re>=Ft||Ze>=Ft}}const ve=ia(n,u.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");const pe=n.getOrCreateProgram("model",re);n.uploadCommonUniforms(E,pe,null,_e,ve),n.renderPass!=="shadow"&&be&&be.setupShadowsFromMatrix(p.nodeModelMatrix,pe),pe.draw(n,E.gl.TRIANGLES,I,y,b,R.material.doubleSided?fi.disabled:fi.backCCW,oe,u.id,R.vertexBuffer,R.indexBuffer,R.segments,u.paint,n.transform.zoom,void 0,ne)}function Eh(p,n){return p.style._importedAsBasemap?"basemap":n.scope}function Ih(p,n,u,m,y,b,w,E,I,L){const R=p.transform,N=!!n.isGeometryBloom&&n.isGeometryBloom;if(N&&p.renderPass==="shadow")return;const B=R.projection.name==="globe"?s.eD(u,R):[...u];s.aB(B,B,n.globalMatrix);const U=s.aB([],m,B);if(n.meshes)for(const W of n.meshes){const G=E.get(W.material.name);if(G&&G.opacity<=0)continue;if(W.material.alphaMode!=="BLEND"){w.push({mesh:W,depth:0,modelIndex:y,worldViewProjection:U,nodeModelMatrix:B,isLightMesh:N,materialOverride:G,modelOpacity:I,modelColor:L});continue}const J=s.af([],W.centroid,U);!R.isOrthographic&&J[2]<=0||b.push({mesh:W,depth:J[2],modelIndex:y,worldViewProjection:U,nodeModelMatrix:B,isLightMesh:N,materialOverride:G,modelOpacity:I,modelColor:L})}if(n.children)for(const W of n.children)Ih(p,W,u,m,y,b,w,E,I,L)}function uu(p,n,u,m){const y=u.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),w=y.getShadowPassColorMode(),E=y.calculateShadowPassMatrixFromMatrix(n),I=Sh(E);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,b,xi.disabled,w,fi.disabled,I,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,u.transform.zoom,void 0,void 0)}function mv(p,n,u,m,y,b){for(const w of y){const E=Object.assign({},m);E.part=w;const I={type:"Unknown",id:n,properties:E},L={orientation:p.paint.get("model-rotation").evaluate(I,u)};b.set(w,L)}}function gv(p,n,u,m,y,b){for(const w of y){const E=Object.assign({},m);E.part=w;const I={type:"Unknown",id:n,properties:E},L={color:p.paint.get("model-color").evaluate(I,u),colorMix:p.paint.get("model-color-mix-intensity").evaluate(I,u),opacity:p.paint.get("model-opacity").evaluate(I,u),emissionStrength:p.paint.get("model-emissive-strength").evaluate(I,u)};b.set(w,L)}}function Nm(p,n,u,m,y){let b=!1;for(const E of m)E.modelOpacity!==1&&(An(E,p,n,y[E.modelIndex],xi.disabled,Mi.disabled),b=!0);for(const E of m)An(E,p,n,y[E.modelIndex],E.modelOpacity!==1?p.stencilModeFor3D():xi.disabled,p.colorModeForRenderPass());b&&p.resetStencilClippingMasks();const w=Mi.additive;for(const E of u)An(E,p,n,y[E.modelIndex],xi.disabled,E.isLightMesh?w:p.colorModeForRenderPass())}function bc(p,n,u){const m=n.updateZoomBasedPaintProperties(),y=(function(b,w,E){let I,L,R,N=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&N>0){const B=b.terrain,U=B.findDEMTileFor(E);U&&U.dem?I=s.eF.create(B,E,U):N=0}if(N===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),N===w.validForExaggeration&&(N===0||I&&I._demTile&&I._demTile.tileID===w.validForDEMTile.id&&I._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const B in w.instancesPerModel){const U=w.instancesPerModel[B];for(let W=0;W<U.instancedDataArray.length;++W){const G=(I?N*I.getElevationAt(0|U.instancedDataArray.float32[16*W],0|U.instancedDataArray.float32[16*W+1],!0,!0):0)+U.instancesEvaluatedElevation[W];U.instancedDataArray.float32[16*W+6]=G,L=L?Math.min(w.terrainElevationMin,G):G,R=R?Math.max(w.terrainElevationMax,G):G}}return w.terrainElevationMin=L||0,w.terrainElevationMax=R||0,w.validForExaggeration=N,w.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0})(p,n,u);(m||y)&&(n.uploaded=!1,n.upload(p.context))}const $o={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d9([0,0,0],[s.al,s.al,0])};function bt(p,n){const u=1<<p.canonical.z,m=n.getFreeCameraOptions().position,y=n.elevation,b=p.canonical.x/u,w=(p.canonical.x+1)/u,E=p.canonical.y/u,I=(p.canonical.y+1)/u;let L=n._centerAltitude;if(y){const U=y.getMinMaxForTile(p);U&&U.max>L&&(L=U.max)}const R=s.aA(m.x,b,w)-m.x,N=s.aA(m.y,E,I)-m.y,B=s.cf(L,n.center.lat)-m.z;return n._zoomFromMercatorZ(Math.sqrt(R*R+N*N+B*B))}function zt(p,n,u,m,y,b,w){const E=p.context,I=p.renderPass==="shadow",L=p.shadowRenderer,R=I&&L?L.getShadowPassDepthMode():new Qt(E.gl.LEQUAL,Qt.ReadWrite,p.depthRangeFor3D),N=p.isTileAffectedByFog(b),B=p.transform.projection.name==="globe";if(u.meshes)for(const U of u.meshes){const W=B?[]:["MODEL_POSITION_ON_GPU"],G=[];let J,K,oe;const re=!B&&m.instancedDataArray.length>20;re&&W.push("INSTANCED_ARRAYS");const ne=ia(p,n.paint.get("model-cutoff-fade-range"));if(ne.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),I&&L)J=p.getOrCreateProgram("modelDepth",{defines:W}),K=Sh(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(u.globalMatrix)),oe=L.getShadowPassColorMode();else{ma(W,G,U,p,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),J=p.getOrCreateProgram("model",{defines:W,overrideFog:N});const _e=U.material,ve=_e.pbrMetallicRoughness,pe=n.paint.get("model-opacity").constantOr(1),he=n.paint.get("model-emissive-strength").constantOr(0);K=Xd(b.expandedProjMatrix,Float32Array.from(u.globalMatrix),new Float32Array(16),null,p,pe,ve.baseColorFactor,_e.emissiveFactor,ve.metallicFactor,ve.roughnessFactor,_e,he,n,y),L&&(w.shadowUniformsInitialized?J.setShadowUniformValues(E,L.getShadowUniformValues()):(L.setupShadows(b.toUnwrapped(),J,"model-tile"),w.shadowUniformsInitialized=!0)),oe=ne.shouldRenderCutoff||pe<1||_e.alphaMode!=="OPAQUE"?Mi.alphaBlended:Mi.unblended}p.uploadCommonUniforms(E,J,b.toUnwrapped(),null,ne);const be=U.material.doubleSided?fi.disabled:fi.backCCW;if(re)G.push(m.instancedDataBuffer),J.draw(p,E.gl.TRIANGLES,R,xi.disabled,oe,be,K,n.id,U.vertexBuffer,U.indexBuffer,U.segments,n.paint,p.transform.zoom,void 0,G,m.instancedDataArray.length);else{const _e=I?"u_instance":"u_normal_matrix";for(let ve=0;ve<m.instancedDataArray.length;++ve)K[_e]=new Float32Array(m.instancedDataArray.arrayBuffer,64*ve,16),J.draw(p,E.gl.TRIANGLES,R,xi.disabled,oe,be,K,n.id,U.vertexBuffer,U.indexBuffer,U.segments,n.paint,p.transform.zoom,void 0,G)}}if(u.children)for(const U of u.children)zt(p,n,U,m,y,b,w)}const hu=[1,-1,1];function ur(p,n,u,m){if(!u.modelManager)return!0;const y=u.modelManager;if(!u.shadowRenderer)return!0;const b=u.shadowRenderer,w=n.aabb;let E=!0,I=p.maxHeight;if(I===0){let R=0;for(const N in p.instancesPerModel){const B=y.getModel(N,m);B?R=Math.max(R,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):E=!1}I=p.maxScale*R*1.41+p.maxVerticalOffset,E&&(p.maxHeight=I)}w.max[2]=I,w.min[2]+=p.terrainElevationMin,w.max[2]+=p.terrainElevationMax,s.af(w.min,w.min,n.tileMatrix),s.af(w.max,w.max,n.tileMatrix);const L=w.intersects(b.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=L===2),L===0}function ke(p,n){const u=p.uniformValues.u_cutoff_params[0],m=p.uniformValues.u_cutoff_params[1],y=p.uniformValues.u_cutoff_params[2],b=p.uniformValues.u_cutoff_params[3];return m===u||b===y?1:s.aA(((n-u)/(m-u)-y)/(b-y),0,1)}function _v(p,n,u,m){if(n.pitch<20)return 1;const y=n.getWorldToCameraMatrix();s.aB(y,y,p);const b=s.bU(u.min[0],u.min[1],u.min[2],1);let w=s.aC(s.eG(),b,y),E=w,I=w;b[1]=u.max[1],w=s.aC(s.eG(),b,y),E=w[1]<E[1]?w:E,I=w[1]>I[1]?w:I,b[0]=u.max[0],w=s.aC(s.eG(),b,y),E=w[1]<E[1]?w:E,I=w[1]>I[1]?w:I,b[1]=u.min[1],w=s.aC(s.eG(),b,y),E=w[1]<E[1]?w:E,I=w[1]>I[1]?w:I;const L=s.aA(m[0],0,1),R=100*n.pixelsPerMeter*s.aA(m[1],0,1),N=s.aA(m[2],0,1),B=s.eH(s.eG(),E,I,L),U=Math.tan(.5*n.fovX),W=-B[2]*U;if(R===0)return B[1]<-Math.abs(W)?N:1;const G=(-Math.abs(W)-B[1])/R,J=(oe,re,ne)=>(1-ne)*oe+ne*re,K=s.aA(J(1,N,G),N,1);return J(1,K,s.aA((n.pitch-20)/20,0,1))}class rf{}class Um{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,u,m){{const N=this._storage.get(u.id);if(N)return N.lastUsedFrameIdx=n,N.buf}const y=m.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),w=new ArrayBuffer(b),E=new Int16Array(w);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const I=new s.eJ;for(let N=0;N<b/2;N+=3){const B=E[N],U=E[N+1],W=E[N+2];I.emplaceBack(B,U),I.emplaceBack(U,W),I.emplaceBack(W,B)}const L=m.bindVertexArrayOES.current,R=new rf;return R.buf=new Ra(m,I),R.lastUsedFrameIdx=n,this._storage.set(u.id,R),m.bindVertexArrayOES.set(L),R.buf}update(n){for(const[u,m]of this._storage)n-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(u))}destroy(){for(const[n,u]of this._storage)u.buf.destroy(),this._storage.delete(n)}}class $m{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const yv=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Vm{constructor(n){this.revealStart=11,this.revealRange=2}}const du=s.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Ow{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,u){const m=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new s.eK,E=new s.b0;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),E.emplaceBack(0,1,2),E.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(w,du.members),this.vignetteIdx=n.context.createIndexBuffer(E)}const y=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,m);const w={u_vignetteShape:(b={vignetteShape:[u.start,u.range,Math.pow(10,u.fadePower)],vignetteColor:[u.color.r,u.color.g,u.color.b,u.color.a*u.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};m.draw(n,n.context.gl.TRIANGLES,Qt.disabled,xi.disabled,Mi.alphaBlended,fi.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,y)}var b}}class Fw{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,u){const m=n.getFreeCameraOptions().position,y=m.toAltitude(),b=m.toLngLat(),w=s.an(b.lng),E=s.an(b.lat),I=n.pixelsPerMeter/u,L=w*s.eM,R=s.eM*Math.log(Math.tan(Math.PI/4+E/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const N=-this._offsetYPrev+R,B=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*I,this._accumulatedOffsetY+=N*I,this._accumulatedElevation+=B*I,this._offsetXPrev=L,this._offsetYPrev=R,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function jm(p,n){return[-(p[0]-Math.floor(p[0]/n)*n),-(p[1]-Math.floor(p[1]/n)*n),-(p[2]-Math.floor(p[2]/n)*n)]}function Mh(p){const n=s.eq(1323123451230),u=[];for(let m=0;m<p;++m){const y=2*n()-1,b=2*n()-1,w=2*n()-1;u.push(s.d5(y,b,w))}return u}function ka(p,n,u,m,y){const b=s.aA((y-u)/(m-u),0,1);return(1-b)*p+b*n}class Gm{constructor(n){this._movement=new Fw,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ow,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,u){const m=n.transform;this._movement.update(m,this._ppmScaleFactor);const y=m.starsProjMatrix,b=s.c7([]);s.c9(b,b,s.an(90)-m._pitch),s.c8(b,b,-m.angle);const w=s.cc(new Float32Array(16),b),E=s.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),I=s.eg([],E),L=s.aB([],I,w),R=Date.now()/1e3;return this._accumulatedTimeFromStart+=(R-this._prevTime)*u,this._prevTime=R,{projectionMatrix:y,modelviewMatrix:L}}}class vv extends Gm{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Vm("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const u=n.context;if(!this.particlesVx){const m=Mh(this.particlesCount),y=new s.eN,b=new s.b0;let w=0;const E=s.eq(1323123451230);for(let I=0;I<m.length;++I){const L=m[I],R=[2*E()-1,E(),E(),E()];y.emplaceBack(L[0],L[1],L[2],-1,-1,...R),y.emplaceBack(L[0],L[1],L[2],1,-1,...R),y.emplaceBack(L[0],L[1],L[2],1,1,...R),y.emplaceBack(L[0],L[1],L[2],-1,1,...R),b.emplaceBack(w+0,w+1,w+2),b.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=u.createVertexBuffer(y,yv.members),this.particlesIdx=u.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const u=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},m=n.transform.zoom;if(u.revealStart>m)return;const y=ka(0,1,u.revealStart,u.revealStart+u.revealRange,m);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let w=[-b.direction.x,b.direction.y,-100];s.aw(w,w);const E=structuredClone(this._vignetteParams);E.strength*=y,b.overrideStyleParameters||(b.intensity=n.style.rain.state.density,b.timeFactor=n.style.rain.state.intensity,b.color=structuredClone(n.style.rain.state.color),w=structuredClone(n.style.rain.state.direction),b.screenThinning.intensity=n.style.rain.state.centerThinning,b.dropletSizeX=n.style.rain.state.dropletSize[0],b.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],b.distortionStrength=100*n.style.rain.state.distortionStrength,E.strength=1,E.color=structuredClone(n.style.rain.state.vignetteColor));const I=this.updateOnRender(n,b.timeFactor),L=n.context,R=L.gl,N=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new s.T(L,{width:n.width,height:n.height,data:null},R.RGBA8)),b.distortionStrength>0&&(L.activeTexture.set(R.TEXTURE0),this.screenTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),R.copyTexSubImage2D(R.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const B=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(L,B),L.activeTexture.set(R.TEXTURE0),this.screenTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const U=[b.color.r,b.color.g,b.color.b,b.color.a],W=(G,J)=>{const K=jm(this._movement.getPosition(),G),oe=b.dropletSizeX,re=b.dropletSizeX*b.dropletSizeYScale,ne=n.width/2,be=n.height/2,_e=ka(0,b.screenThinning.start,0,1,b.screenThinning.intensity),ve=ka(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),pe=ka(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),he=(Se={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:G,rainDropletSize:[oe,re],distortionStrength:b.distortionStrength,rainDirection:w,color:U,screenSize:[N.width,N.height],thinningCenterPos:[ne,be],thinningShape:[_e,ve,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:pe,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_texScreen:0,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_boxSize:Se.boxSize,u_rainDropletSize:Se.rainDropletSize,u_distortionStrength:Se.distortionStrength,u_rainDirection:Se.rainDirection,u_color:Se.color,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_shapeDirectionalPower:Se.shapeDirectionalPower,u_shapeNormalPower:Se.shapeNormalPower,u_mode:Se.mode});var Se;const ze=Math.round(b.intensity*this.particlesCount),Re=s.bg.simpleSegment(0,0,4*ze,2*ze);B.draw(n,R.TRIANGLES,Qt.disabled,xi.disabled,Mi.alphaBlended,fi.disabled,he,"rain_particles",this.particlesVx,this.particlesIdx,Re)};b.distortionStrength>0&&W(b.boxSize,!0),W(b.boxSize,!1),this._vignette.draw(n,E)}}const of=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ah extends Gm{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Vm("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const u=n.context;if(!this.particlesVx){const m=Mh(this.particlesCount),y=new s.eO,b=new s.b0;let w=0;const E=s.eq(1323123451230);for(let I=0;I<m.length;++I){const L=m[I],R=E(),N=E(),B=E(),U=[I/m.length,R,N,B],W=[E(),E()];y.emplaceBack(L[0],L[1],L[2],-1,-1,...U,...W),y.emplaceBack(L[0],L[1],L[2],1,-1,...U,...W),y.emplaceBack(L[0],L[1],L[2],1,1,...U,...W),y.emplaceBack(L[0],L[1],L[2],-1,1,...U,...W),b.emplaceBack(w+0,w+1,w+2),b.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=u.createVertexBuffer(y,of.members),this.particlesIdx=u.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const u=structuredClone(this._params);let m=[-u.direction.x,u.direction.y,-100];s.aw(m,m);const y=structuredClone(this._vignetteParams),b=u.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=n.transform.zoom;if(b.revealStart>w)return;const E=ka(0,1,b.revealStart,b.revealStart+b.revealRange,w);y.strength*=E,u.overrideStyleParameters||(u.intensity=n.style.snow.state.density,u.timeFactor=n.style.snow.state.intensity,u.color=structuredClone(n.style.snow.state.color),m=structuredClone(n.style.snow.state.direction),u.screenThinning.intensity=n.style.snow.state.centerThinning,u.billboardSize=2.79*n.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(n.style.snow.state.vignetteColor));const I=this.updateOnRender(n,u.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=n.context,R=L.gl,N=n.transform,B=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(L,B),((U,W,G)=>{const J=jm(this._movement.getPosition(),U),K=N.width/2,oe=N.height/2,re=ka(0,G.screenThinning.start,0,1,G.screenThinning.intensity),ne=ka(.001,G.screenThinning.range,0,1,G.screenThinning.intensity),be=ka(0,G.screenThinning.particleOffset,0,1,G.screenThinning.intensity),_e=(ve={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:G.velocityConeAperture,velocity:G.velocity,horizontalOscillationRadius:G.horizontalOscillationRadius,horizontalOscillationRate:G.horizontalOscillationRate,boxSize:U,billboardSize:1*G.billboardSize,simpleShapeParameters:[G.shapeFadeStart,G.shapeFadePower],screenSize:[N.width,N.height],thinningCenterPos:[K,oe],thinningShape:[re,ne,Math.pow(10,G.screenThinning.fadePower)],thinningAffectedRatio:G.screenThinning.affectedRatio,thinningParticleOffset:be,color:[G.color.r,G.color.g,G.color.b,G.color.a],direction:m},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const pe=Math.round(G.intensity*this.particlesCount),he=s.bg.simpleSegment(0,0,4*pe,2*pe);this.particlesVx&&this.particlesIdx&&B.draw(n,R.TRIANGLES,Qt.disabled,xi.disabled,Mi.alphaBlended,fi.disabled,_e,"snow_particles",this.particlesVx,this.particlesIdx,he)})(u.boxSize,0,u),this._vignette.draw(n,y)}}const wc={symbol:function(p,n,u,m,y){if(p.renderPass!=="translucent")return;const b=xi.disabled,w=p.colorModeForRenderPass(),E=u.layout.get("text-variable-anchor"),I=u.layout.get("text-size-scale-range"),L=s.aA(p.scaleFactor,I[0],I[1]);E&&(function(B,U,W,G,J,K,oe,re){const ne=U.transform,be=J==="map",_e=K==="map";for(const ve of B){const pe=G.getTile(ve),he=pe.getBucket(W);if(!he||!he.text||!he.text.segments.get().length)continue;const Se=s.bK(he.textSizeData,ne.zoom,re),ze=Zc(ve,he.getProjection(),ne),Re=ne.calculatePixelsToTileUnitsMatrix(pe),Ze=hc(ze,pe.tileID.canonical,_e,be,ne,he.getProjection(),Re),je=he.hasIconTextFit()&&he.hasIconData();Se&&iv(he,be,_e,oe,ne,Ze,ve,Math.pow(2,ne.zoom-pe.tileID.overscaledZ),Se,je)}})(m,p,u,n,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),y,L);const R=u.paint.get("icon-opacity").constantOr(1)!==0,N=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(R||N)?Kd(p,n,u,m,b,w):(R&&Kd(p,n,u,m,b,w,{onlyIcons:!0}),N&&Kd(p,n,u,m,b,w,{onlyText:!0})),n.map.showCollisionBoxes&&(Tm(p,n,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Tm(p,n,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(p,n,u,m){if(p.renderPass!=="translucent")return;const y=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),w=u.paint.get("circle-stroke-opacity"),E=u.layout.get("circle-sort-key").constantOr(1)!==void 0,I=u.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||w.constantOr(1)===0))return;const L=p.context,R=L.gl,N=p.transform,B=!(!p.terrain||!p.terrain.enabled),U=u.layout.get("circle-elevation-reference"),W=p.depthModeForSublayer(0,Qt.ReadOnly),G=new Qt(p.context.gl.LEQUAL,Qt.ReadOnly,p.depthRangeFor3D),J=U==="none"||B?W:G,K=xi.disabled,oe=p.colorModeForDrapableLayerRenderPass(I),re=N.projection.name==="globe",ne=[s.aF(N.center.lng),s.aJ(N.center.lat)],be=[];for(let ve=0;ve<m.length;ve++){const pe=m[ve],he=n.getTile(pe),Se=he.getBucket(u);if(!Se||Se.projection.name!==N.projection.name)continue;const ze=Se.programConfigurations.get(u.id),Re=Se.layoutVertexBuffer,Ze=Se.globeExtVertexBuffer,je=Se.indexBuffer,it=s.e0(u),dt=[Ze],Fe=p.isTileAffectedByFog(pe);re&&it.push("PROJECTION_GLOBE_VIEW"),it.push("DEPTH_D24"),p.terrain&&N.depthOcclusionForSymbolsAndCircles&&it.push("DEPTH_OCCLUSION"),Se.hasElevation&&!p.terrain&&(it.push("ELEVATED_ROADS"),dt.push(Se.elevatedLayoutVertexBuffer));const Te=p.getOrCreateProgram("circle",{config:ze,defines:it,overrideFog:Fe}),Ke=N.projection.createInversionMatrix(N,pe.canonical),We={programConfiguration:ze,program:Te,layoutVertexBuffer:Re,dynamicBuffers:dt,indexBuffer:je,uniformValues:s.e1(p,pe,he,Ke,ne,u),tile:he};if(E){const pt=Se.segments.get();for(const vt of pt)be.push({segments:new s.bg([vt]),sortKey:vt.sortKey,state:We})}else be.push({segments:Se.segments,sortKey:0,state:We})}E&&be.sort((ve,pe)=>ve.sortKey-pe.sortKey);const _e={useDepthForOcclusion:N.depthOcclusionForSymbolsAndCircles};for(const ve of be){const{programConfiguration:pe,program:he,layoutVertexBuffer:Se,dynamicBuffers:ze,indexBuffer:Re,uniformValues:Ze,tile:je}=ve.state,it=ve.segments;p.terrain&&p.terrain.setupElevationDraw(je,he,_e),p.uploadCommonUniforms(L,he,je.tileID.toUnwrapped()),he.draw(p,R.TRIANGLES,J,K,oe,fi.disabled,Ze,u.id,Se,Re,it,u.paint,N.zoom,pe,ze)}},heatmap:function(p,n,u,m){if(u.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const y=p.context,b=y.gl,w=xi.disabled,E=new Mi([b.ONE,b.ONE,b.ONE,b.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(U,W,G,J){const K=U.gl,oe=W.width*J,re=W.height*J;U.activeTexture.set(K.TEXTURE1),U.viewport.set([0,0,oe,re]);let ne=G.heatmapFbo;if(!ne||ne&&(ne.width!==oe||ne.height!==re)){ne&&ne.destroy();const be=K.createTexture();K.bindTexture(K.TEXTURE_2D,be),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),ne=G.heatmapFbo=U.createFramebuffer(oe,re,1,null),(function(_e,ve,pe,he,Se,ze){const Re=_e.gl;Re.texImage2D(Re.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,Se,ze,0,Re.RGBA,_e.extRenderToTextureHalfFloat?Re.HALF_FLOAT:Re.UNSIGNED_BYTE,null),he.colorAttachment0.set(pe)})(U,0,be,ne,oe,re)}else K.bindTexture(K.TEXTURE_2D,ne.colorAttachment0.get()),U.bindFramebuffer.set(ne.framebuffer)})(y,p,u,p.transform.projection.name==="globe"?.5:.25),y.clear({color:s.ao.transparent});const I=p.transform,L=I.projection.name==="globe",R=L?["PROJECTION_GLOBE_VIEW"]:[],N=L?fi.frontCCW:fi.disabled,B=[s.aF(I.center.lng),s.aJ(I.center.lat)];for(let U=0;U<m.length;U++){const W=m[U];if(n.hasRenderableParent(W))continue;const G=n.getTile(W),J=G.getBucket(u);if(!J||J.projection.name!==I.projection.name)continue;const K=p.isTileAffectedByFog(W),oe=J.programConfigurations.get(u.id),re=p.getOrCreateProgram("heatmap",{config:oe,defines:R,overrideFog:K}),{zoom:ne}=p.transform;p.terrain&&p.terrain.setupElevationDraw(G,re),p.uploadCommonUniforms(y,re,W.toUnwrapped());const be=I.projection.createInversionMatrix(I,W.canonical);re.draw(p,b.TRIANGLES,Qt.disabled,w,E,N,wm(p,W,G,be,B,ne,u.paint.get("heatmap-intensity")),u.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,u.paint,p.transform.zoom,oe,L?[J.globeExtVertexBuffer]:null)}y.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),(function(y,b){const w=y.context,E=w.gl,I=b.heatmapFbo;if(!I)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,I.colorAttachment0.get()),w.activeTexture.set(E.TEXTURE1);let L=b.colorRampTexture;L||(L=b.colorRampTexture=new s.T(w,b.colorRamp,E.RGBA8)),L.bind(E.LINEAR,E.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,E.TRIANGLES,Qt.disabled,xi.disabled,y.colorModeForRenderPass(),fi.disabled,((R,N)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)})(p,u))},line:function(p,n,u,m){if(p.renderPass!=="translucent")return;const y=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const w=u.paint.get("line-emissive-strength").isConstant(),E=u.paint.get("line-emissive-strength").constantOr(0),I=u.paint.get("line-occlusion-opacity"),L=u.layout.get("line-elevation-reference"),R=u.layout.get("line-width-unit")==="meters",N=L==="sea",B=!(!p.terrain||!p.terrain.enabled),U=p.context,W=U.gl;if(u.hasElevatedBuckets&&p.transform.projection.name==="globe")return;const G=u.layout.get("line-cross-slope"),J=G!==void 0,K=G<1,oe=p.colorModeForDrapableLayerRenderPass(w?E:null),re=p.terrain&&p.terrain.renderingToTexture,ne=re?1:s.o.devicePixelRatio,be=u.paint.get("line-dasharray"),_e=be.constantOr(1),ve=u.layout.get("line-cap"),pe=be.constantOr(null),he=ve.constantOr(null),Se=u.paint.get("line-pattern"),ze=Se.constantOr(1),Re=u.paint.get("line-pattern-cross-fade"),Ze=Se.constantOr(null),je=u.paint.get("line-opacity").constantOr(1);let it=!ze&&je!==1||p.depthOcclusion&&I>0&&I<1;const dt=u.paint.get("line-gradient"),Fe=ze?"linePattern":"line",Te=s.e2(u);let Ke;if(re&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(it=!1),I!==0&&p.depthOcclusion){const Pt=u.paint._values["line-opacity"];Pt&&Pt.value&&Pt.value.kind==="constant"?Ke=Pt.value:s.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&Te.push("VARIABLE_LINE_WIDTH"),re&&(p.emissiveMode!=="dual-source-blending"||w?p.emissiveMode==="mrt-fallback"&&Te.push("USE_MRT1"):Te.push("DUAL_SOURCE_BLENDING"));const We=(Pt,xt,St,Xt,Ht,Rt)=>{for(const Gt of Pt){const si=n.getTile(Gt);if(ze&&!si.patternsLoaded())continue;const pi=si.getBucket(u);if(!pi||pi.elevationType!=="none"&&!Ht||pi.elevationType==="none"&&Ht)continue;p.prepareDrawTile();const Ni=[...xt],en=p.shadowRenderer,Ei=pi.elevationType==="road"&&!!en&&en.enabled;let ln=[0,0,0];if(Ei){const Bi=p.style.directionalLight,Nn=p.style.ambientLight;Bi&&Nn&&(ln=na(p.style,Bi,Nn)),Ni.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Ri=pi.programConfigurations.get(u.id);let En=!1;if(Ze&&si.imageAtlas){const Bi=s.e3.from(Ze),Nn=Bi.getPrimary().scaleSelf(ne).toString(),hr=si.imageAtlas.patternPositions.get(Nn),jn=Bi.getSecondary(),Wn=jn?si.imageAtlas.patternPositions.get(jn.scaleSelf(ne).toString()):null;En=!!hr&&!!Wn,hr&&Ri.setConstantPatternPositions(hr,Wn)}Re>0&&(En||Ri.getPatternTransitionVertexBuffer("line-pattern"))&&Ni.push("LINE_PATTERN_TRANSITION");const wn=p.isTileAffectedByFog(Gt),Mn=p.getOrCreateProgram(Fe,{config:Ri,defines:Ni,overrideFog:wn});if(!ze&&pe&&he&&si.lineAtlas){const Bi=si.lineAtlas.getDash(pe,he);Bi&&Ri.setConstantPatternPositions(Bi)}Ei&&en.setupShadows(si.tileID.toUnwrapped(),Mn,"vector-tile");let[tn,Fi]=u.paint.get("line-trim-offset");(he==="round"||he==="square")&&tn!==Fi&&(tn===0&&(tn-=1),Fi===1&&(Fi+=1));const gn=re?Gt.projMatrix:null,tr=R?1/pi.tileToMeter/s.ay(si,1,p.transform.zoom):1,ir=R?1/pi.tileToMeter/s.ay(si,1,Math.floor(p.transform.zoom)):1,_n=ze?s.e4(p,si,u,gn,ne,tr,ir,[tn,Fi],ln,Re):s.e5(p,si,u,gn,pi.lineClipsArray.length,ne,tr,ir,[tn,Fi],ln);if(dt){const Bi=pi.gradients[u.id];let Nn=Bi.texture;if(u.gradientVersion!==Bi.version){let hr=256;if(u.stepInterpolant){const jn=n.getSource().maxzoom,Wn=Gt.canonical.z===jn?Math.ceil(1<<p.transform.maxZoom-Gt.canonical.z):1;hr=s.aA(s.e6(pi.maxLineLength/s.al*1024*Wn),256,U.maxTextureSize)}Bi.gradient=s.e7({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:hr,image:Bi.gradient||void 0,clips:pi.lineClipsArray}),Bi.texture?Bi.texture.update(Bi.gradient):Bi.texture=new s.T(U,Bi.gradient,W.RGBA8),Bi.version=u.gradientVersion,Nn=Bi.texture}U.activeTexture.set(W.TEXTURE1),Nn.bind(u.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}_e&&(U.activeTexture.set(W.TEXTURE0),si.lineAtlasTexture&&si.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Ri.updatePaintBuffers()),ze&&(U.activeTexture.set(W.TEXTURE0),si.imageAtlasTexture&&si.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Ri.updatePaintBuffers()),Ht&&!N&&p.terrain.setupElevationDraw(si,Mn),p.uploadCommonUniforms(U,Mn,Gt.toUnwrapped());const Yi=Bi=>{Ke!=null&&(Ke.value=je*I),Mn.draw(p,W.TRIANGLES,St,Bi,oe,fi.disabled,_n,u.id,pi.layoutVertexBuffer,pi.indexBuffer,pi.segments,u.paint,p.transform.zoom,Ri,[pi.layoutVertexBuffer2,pi.patternVertexBuffer,pi.zOffsetVertexBuffer]),Ke!=null&&(Ke.value=je)};if(it&&!Ht){const Bi=p.stencilModeForClipping(Gt).ref;Bi===0&&re&&U.clear({stencil:0});const Nn={func:W.EQUAL,mask:255};_n.u_alpha_discard_threshold=.8,Yi(new xi(Nn,Bi,255,W.KEEP,W.KEEP,W.INVERT)),_n.u_alpha_discard_threshold=0,Yi(new xi(Nn,Bi,255,W.KEEP,W.KEEP,W.KEEP))}else _n.u_alpha_discard_threshold=it&&Ht&&Rt?.8:0,Yi(Ht?Xt:p.stencilModeForClipping(Gt))}};let pt=p.depthModeForSublayer(0,Qt.ReadOnly);const vt=new Qt(p.depthOcclusion?W.GREATER:W.LEQUAL,Qt.ReadOnly,p.depthRangeFor3D);if(u.hasNonElevatedBuckets){const Pt=!re&&p.terrain;I!==0&&Pt?s.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has line-z-offset enabled.`):Pt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${u.id}.`):We(m,Te,pt,xi.disabled,!1,!0)}if(u.hasElevatedBuckets){L==="hd-road-markup"?B||(pt=vt,Te.push("ELEVATED_ROADS")):(Te.push("ELEVATED"),pt=vt,J&&Te.push(K?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),N&&Te.push("ELEVATION_REFERENCE_SEA"));const Pt=it?p.stencilModeFor3D():xi.disabled;p.forceTerrainMode=!0,We(m,Te,pt,Pt,!0,!0),it&&We(m,Te,pt,Pt,!0,!1),p.forceTerrainMode=!1}it&&(p.resetStencilClippingMasks(),re&&U.clear({stencil:0})),I===0||p.depthOcclusion||re||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,n,u,m){const y=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const w=u.paint.get("fill-emissive-strength"),E=p.colorModeForDrapableLayerRenderPass(w),I=u.paint.get("fill-pattern"),L=p.opaquePassEnabledForLayer()&&!I.constantOr(1)&&y.constantOr(s.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let R="none";u.layout.get("fill-elevation-reference")!=="none"?R="road":u.paint.get("fill-z-offset").constantOr(1)!==0&&(R="offset");const N=!(!p.terrain||!p.terrain.enabled),B={painter:p,sourceCache:n,layer:u,coords:m,colorMode:E,elevationType:R,terrainEnabled:N,pass:L};if(p.renderPass==="shadow")return void(p.shadowRenderer&&R==="road"&&!N&&(function(W){const{painter:G,sourceCache:J,layer:K,coords:oe}=W,re=G.context.gl,ne=W.painter.shadowRenderer;for(const be of oe){const _e=J.getTile(be),ve=_e.getBucket(K);if(!ve)continue;const pe=ve.elevatedStructures;if(!pe||!pe.shadowCasterSegments||pe.shadowCasterSegments.segments[0].primitiveLength===0)continue;G.prepareDrawTile();const he=ve.bufferData.programConfigurations.get(K.id),Se=G.isTileAffectedByFog(be),ze=G.getOrCreateProgram("elevatedStructuresDepth",{config:he,overrideFog:Se}),Re=ne.calculateShadowPassMatrixFromTile(_e.tileID.toUnwrapped());G.uploadCommonUniforms(G.context,ze,be.toUnwrapped());const Ze=vm(Re,0);ze.draw(G,re.TRIANGLES,ne.getShadowPassDepthMode(),xi.disabled,ne.getShadowPassColorMode(),fi.disabled,Ze,K.id,pe.vertexBuffer,pe.indexBuffer,pe.shadowCasterSegments,K.paint,G.transform.zoom,he)}})(B));const U=p.emissiveMode==="mrt-fallback";if(R!=="offset"){if(au(B,!1,U),R==="road"){const W=!N&&p.renderPass==="translucent";W&&Im(p,n,u,m,"geometry"),au(B,!0,U,xi.disabled),W&&(function(G){const{painter:J,sourceCache:K,layer:oe,coords:re,colorMode:ne}=G,be=J.context.gl,_e=G.painter.shadowRenderer,ve=!!_e&&_e.enabled,pe=new Qt(J.context.gl.LEQUAL,Qt.ReadOnly,J.depthRangeFor3D);let he=[0,0,0];if(ve){const ze=J.style.directionalLight,Re=J.style.ambientLight;ze&&Re&&(he=na(J.style,ze,Re))}const Se=ze=>{for(const Re of re){const Ze=K.getTile(Re),je=Ze.getBucket(oe);if(!je)continue;const it=je.elevatedStructures;if(!it)continue;let dt,Fe;if(ze?(dt=it.renderableBridgeSegments,Fe=it.bridgeProgramConfigurations.get(oe.id)):(dt=it.renderableTunnelSegments,Fe=it.tunnelProgramConfigurations.get(oe.id)),!dt||dt.segments[0].primitiveLength===0)continue;Fe.updatePaintBuffers(),J.prepareDrawTile();const Te=J.isTileAffectedByFog(Re),Ke=[];ve&&Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const We=J.getOrCreateProgram("elevatedStructures",{config:Fe,overrideFog:Te,defines:Ke}),pt=J.translatePosMatrix(Re.projMatrix,Ze,oe.paint.get("fill-translate"),oe.paint.get("fill-translate-anchor"));ve&&_e.setupShadows(Ze.tileID.toUnwrapped(),We,"vector-tile");const vt=Bl(pt,he);J.uploadCommonUniforms(J.context,We,Re.toUnwrapped()),We.draw(J,be.TRIANGLES,pe,xi.disabled,ne,fi.backCCW,vt,oe.id,it.vertexBuffer,it.indexBuffer,dt,oe.paint,J.transform.zoom,Fe,[it.vertexBufferNormal])}};Se(!0),Se(!1)})(B)}}else au(B,!1,U,p.stencilModeFor3D())},"fill-extrusion":function(p,n,u,m){const y=u.paint.get("fill-extrusion-opacity"),b=p.context,w=b.gl,E=p.terrain,I=E&&E.renderingToTexture;if(y===0)return;const L=p.emissiveMode==="mrt-fallback",R=p.conflationActive&&p.style.isLayerClipped(u,n.getSource()),N=p.style.order.indexOf(u.fqid);if(R&&(function(B,U,W,G,J){for(const K of G){const oe=U.getTile(K).getBucket(W);oe&&(oe.updateReplacement(K,B.replacementSource,J),oe.uploadCentroid(B.context))}})(p,n,u,m,N),E||R)for(const B of m){const U=n.getTile(B).getBucket(u);U&&nv(p.context,n,B,U,u,E,R)}if(p.renderPass==="shadow"&&p.shadowRenderer){const B=p.shadowRenderer;if(E&&y<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const U=B.getShadowPassDepthMode(),W=B.getShadowPassColorMode();lu(p,n,u,m,U,xi.disabled,W,R)}else if(p.renderPass==="translucent"){const B=!u.paint.get("fill-extrusion-pattern").constantOr(1),U=u.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!I&&U.a!==0){const W=new Qt(p.context.gl.LEQUAL,Qt.ReadWrite,p.depthRangeFor3D);y===1&&B?lu(p,n,u,m,W,xi.disabled,Mi.unblended,R):(lu(p,n,u,m,W,xi.disabled,Mi.disabled,R),lu(p,n,u,m,W,p.stencilModeFor3D(),p.colorModeForRenderPass(),R),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&B&&(!E&&p.transform.projection.name!=="globe"||I)){const W=u.paint.get("fill-extrusion-opacity"),G=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),J=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),K=u.paint.get("fill-extrusion-flood-light-intensity"),oe=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",re=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(oe?null:u.lut).toArray01().slice(0,3),ne=G>0&&J>0,be=K>0,_e=(he,Se,ze)=>(1-ze)*he+ze*Se,ve=new Th;ve.translate=u.paint.get("fill-extrusion-translate"),ve.translateAnchor=u.paint.get("fill-extrusion-translate-anchor"),ve.edgeRadius=u.layout.get("fill-extrusion-edge-radius"),ve.cutoffFadeRange=u.paint.get("fill-extrusion-cutoff-fade-range");const pe=he=>{const Se=p.depthModeForSublayer(1,Qt.ReadOnly,w.LEQUAL,!0),ze=u.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=_e(.1,3,ze),Ze=p._showOverdrawInspector;if(!Ze){const je=new xi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),it=new Mi([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);Da(ve,p,n,u,m,Se,je,it,fi.disabled,he,"sdf",W,G,J,K,re,Re,R,!1)}{const je=Ze?xi.disabled:new xi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),it=Ze?p.colorModeForRenderPass():new Mi([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],s.ao.transparent,[!0,!0,!0,!0]);Da(ve,p,n,u,m,Se,je,it,fi.disabled,he,"color",W,G,J,K,re,Re,R,!1)}};if(I){const he=()=>{const ze=E.drapeBufferSize[0],Re=E.drapeBufferSize[1];let Ze=E.framebufferCopyTexture;return Ze&&(!Ze||Ze.size[0]===ze&&Ze.size[1]===Re)||(Ze&&Ze.destroy(),Ze=E.framebufferCopyTexture=new s.T(b,new s.q({width:ze,height:Re}),w.RGBA8)),Ze.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,ze,Re),Ze},Se=(ze,Re,Ze)=>{const je=p.depthModeForSublayer(1,Qt.ReadOnly,w.LEQUAL,!1),it=u.paint.get(ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),dt=_e(.1,3,it);{const Fe=new Mi([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0]);Da(ve,p,n,u,m,je,xi.disabled,Fe,fi.disabled,ze,"clear",W,G,J,K,re,dt,R,Re)}{const Fe=new xi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Te=new Mi([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);Da(ve,p,n,u,m,je,Fe,Te,fi.disabled,ze,"sdf",W,G,J,K,re,dt,R,Re)}L&&!ze&&(Ze=he());{const Fe=ze?w.ZERO:w.ONE_MINUS_DST_ALPHA,Te=new xi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ke=new Mi([Fe,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],s.ao.transparent,[!0,!0,!0,!0]);Da(ve,p,n,u,m,je,Te,Ke,fi.disabled,ze,"color",W,G,J,K,re,dt,R,Re)}if(!L||ze){const Fe=new Mi([w.ONE,w.ONE,w.ONE,ze?w.ZERO:w.ONE],s.ao.transparent,[!1,!1,!1,!0],ze?w.FUNC_ADD:w.MAX);Da(ve,p,n,u,m,je,xi.disabled,Fe,fi.disabled,ze,"clear",W,G,J,K,re,dt,R,Re,Ze)}else{w.drawBuffers([w.NONE,w.COLOR_ATTACHMENT1]);const Fe=new xi({func:w.EQUAL,mask:255},254,255,w.KEEP,w.DECR,w.DECR),Te=new Mi([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!0,!1,!1,!1],w.MAX);Da(ve,p,n,u,m,je,Fe,Te,fi.disabled,ze,"emissive",W,G,J,K,re,dt,R,Re,Ze),w.drawBuffers([w.COLOR_ATTACHMENT0])}};if(ne||be){let ze;p.prepareDrawTile(),L&&!ne||(ze=he()),ne&&Se(!0,!1,ze),be&&Se(!1,!0,ze)}}else ne&&pe(!0),be&&pe(!1),(ne||be)&&p.resetStencilClippingMasks()}}},building:function(p,n,u,m){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);const y=u.paint.get("building-ambient-occlusion-ground-intensity"),b=u.paint.get("building-ambient-occlusion-ground-radius"),w=u.paint.get("building-ambient-occlusion-ground-attenuation"),E=u.paint.get("building-opacity");if(E<=0)return;let I=y>0&&b>0,L=!0;const R=u.paint.get("building-vertical-scale");if(R<=0)return;p.shadowRenderer||(L=!1);const N=p.conflationActive&&p.style.isLayerClipped(u,n.getSource()),B=p.style.order.indexOf(u.fqid);if((function(U,W,G,J,K,oe){for(const re of oe){const ne=W.getTile(re).getBucket(G);ne&&(K&&ne.updateReplacement(re,U.replacementSource,J),ne.uploadUpdatedIndexBuffer(U.context))}})(p,n,u,B,N,m),(function(U,W,G,J){for(const K of J){const oe=W.getTile(K).getBucket(G);oe&&oe.needsEvaluation()&&oe.uploadUpdatedColorBuffer(U.context)}})(p,n,u,m),u.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){const U=p.shadowRenderer,W=[],G=U.getShadowPassDepthMode();cu({painter:p,source:n,layer:u,coords:m,defines:W,blendMode:U.getShadowPassColorMode(),depthMode:G,opacity:E,verticalScale:R,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(p.renderPass==="translucent"){let U=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];L&&(U=U.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer&&p.shadowRenderer.useNormalOffset&&(U=U.concat("NORMAL_OFFSET"));const W=u.paint.get("building-facade-emissive-chance"),G=u.paint.get("building-ambient-occlusion-intensity"),J=u.paint.get("building-flood-light-intensity"),K=u.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",oe=u.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(K?null:u.lut).toArray01().slice(0,3),re=u.paint.get("building-flood-light-ground-attenuation"),ne=J>0,be=new Qt(p.context.gl.LEQUAL,Qt.ReadWrite,p.depthRangeFor3D);E<1&&cu({painter:p,source:n,layer:u,coords:m,defines:U,blendMode:Mi.disabled,depthMode:be,opacity:E,verticalScale:R,facadeEmissiveChance:W,facadeAOIntensity:G,floodLightIntensity:J,floodLightColor:oe,depthOnly:!0});const _e=p.colorModeForRenderPass();cu({painter:p,source:n,layer:u,coords:m,defines:U,blendMode:_e,depthMode:be,opacity:E,verticalScale:R,facadeEmissiveChance:W,facadeAOIntensity:G,floodLightIntensity:J,floodLightColor:oe}),I&&ef(p,n,u,m,!0,E,y,b,J,oe,w,N),ne&&ef(p,n,u,m,!1,E,y,b,J,oe,re,N)}else if(p.renderPass==="light-beam"){const U=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],W=new Qt(p.context.gl.LEQUAL,Qt.ReadOnly,p.depthRangeFor3D);cu({painter:p,source:n,layer:u,coords:m,defines:U,blendMode:Mi.alphaBlended,depthMode:W,opacity:E,verticalScale:R,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,n,u,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const y=p.context,b=p.terrain&&p.terrain.renderingToTexture,[w,E]=p.renderPass!=="translucent"||b?[{},m]:p.stencilConfigForOverlap(m);for(const I of E){const L=n.getTile(I);if(L.needsHillshadePrepare&&p.renderPass==="offscreen")ww(p,L,u);else if(p.renderPass==="translucent"){const R=p.depthModeForSublayer(0,Qt.ReadOnly),N=u.paint.get("hillshade-emissive-strength"),B=p.colorModeForDrapableLayerRenderPass(N),U=b&&p.terrain?p.terrain.stencilModeForRTTOverlap(I):w[I.overscaledZ];bw(p,I,L,u,R,U,B)}}y.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,n,u,m,y,b){if(p.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const w=p.transform.projection.name==="globe",E=u.paint.get("raster-elevation")!==0,I=E&&w;if(p.renderElevatedRasterBackface&&!I)return;const L=p.context,R=L.gl,N=n.getSource(),B=(function(_e,ve,pe,he,Se){const ze=ve.paint.get("raster-color"),Re=_e.type==="raster-array",Ze=[],je=ve.paint.get("raster-resampling"),it=ve.paint.get("raster-color-mix");let dt=ve.paint.get("raster-color-range");const Fe=[it[0],it[1],it[2],0],Te=it[3];let Ke=je==="nearest"?he.NEAREST:he.LINEAR;if(Re&&(Ze.push("RASTER_ARRAY"),ze||Ze.push("RASTER_COLOR"),je==="linear"&&Ze.push("RASTER_ARRAY_LINEAR"),Ke=he.NEAREST,!dt&&_e.rasterLayers)){const We=_e.rasterLayers.find(({id:pt})=>pt===ve.sourceLayer);We&&We.fields&&We.fields.range&&(dt=We.fields.range)}if(dt=dt||[0,1],ze){Ze.push("RASTER_COLOR"),pe.activeTexture.set(he.TEXTURE2),ve.updateColorRamp(dt);let We=ve.colorRampTexture;We||(We=ve.colorRampTexture=new s.T(pe,ve.colorRamp,he.RGBA8)),We.bind(Ke,he.CLAMP_TO_EDGE)}return Se&&Ze.push("USE_MRT1"),{mix:Fe,range:dt,offset:Te,defines:Ze,resampling:Ke}})(N,u,L,R,p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback");if(N instanceof s.aU&&!m.length&&!w)return;const U=u.paint.get("raster-emissive-strength"),W=p.colorModeForDrapableLayerRenderPass(U),G=p.terrain&&p.terrain.renderingToTexture,J=!p.options.moving,K=u.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;if(N instanceof s.aU&&!m.length&&(N.onNorthPole||N.onSouthPole)){const _e=E?p.stencilModeFor3D():xi.disabled;return void tf(!!N.onNorthPole,null,p,n,u,U,B,fi.disabled,_e)}if(!m.length)return;const[oe,re]=N instanceof s.aU||G?[{},m]:p.stencilConfigForOverlap(m),ne=re[re.length-1].overscaledZ;I&&B.defines.push("PROJECTION_GLOBE_VIEW"),E&&B.defines.push("RENDER_CUTOFF");const be=(_e,ve,pe)=>{for(const he of _e){const Se=he.toUnwrapped(),ze=n.getTile(he);if(G&&(!ze||!ze.hasData()))continue;L.activeTexture.set(R.TEXTURE0);const Re=lv(ze,N,u,B);if(!Re||!Re.texture)continue;const{texture:Ze,mix:je,offset:it,tileSize:dt,buffer:Fe}=Re;let Te,Ke;G?(Te=Qt.disabled,Ke=he.projMatrix):E?(Te=new Qt(R.LEQUAL,Qt.ReadWrite,p.depthRangeFor3D),Ke=w?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Se,J)):(Te=p.depthModeForSublayer(he.overscaledZ-ne,u.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,R.LESS),Ke=p.transform.calculateProjMatrix(Se,J));const We=p.terrain&&G?p.terrain.stencilModeForRTTOverlap(he):oe[he.overscaledZ],pt=b?0:u.paint.get("raster-fade-duration");ze.registerFadeDuration(pt);const vt=n.findLoadedParent(he,0),Pt=vh(ze,vt,n,p.transform,pt);let xt,St;!Pt.isFading&&ze.refreshedUponExpiration&&(ze.refreshedUponExpiration=!1),p.terrain&&p.terrain.prepareDrawTile(),L.activeTexture.set(R.TEXTURE0),Ze.bind(K,R.CLAMP_TO_EDGE),L.activeTexture.set(R.TEXTURE1),vt?(vt.texture&&vt.texture.bind(K,R.CLAMP_TO_EDGE),xt=Math.pow(2,vt.tileID.overscaledZ-ze.tileID.overscaledZ),St=[ze.tileID.canonical.x*xt%1,ze.tileID.canonical.y*xt%1]):Ze.bind(K,R.CLAMP_TO_EDGE),"useMipmap"in Ze&&L.extTextureFilterAnisotropic&&p.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Xt=p.transform;let Ht;const Rt=E?av(Xt):[0,0,0,0];let Gt,si,pi,Ni,en,Ei=0;if(I&&N instanceof s.aU&&N.coordinates.length>3)Gt=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0)))),si=Float32Array.from(Xt.globeMatrix),pi=Float32Array.from(s.dF(Xt)),Ni=[s.aF(Xt.center.lng),s.aJ(Xt.center.lat)],Ht=N.elevatedGlobePerspectiveTransform,en=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const wn=s.dG(he.canonical);Ei=s.dH(wn.getCenter().lat),Gt=Float32Array.from(s.bk(s.dJ(he.canonical))),si=Float32Array.from(Xt.globeMatrix),pi=Float32Array.from(s.dF(Xt)),Ni=[s.aF(Xt.center.lng),s.aJ(Xt.center.lat)],Ht=[0,0],en=Float32Array.from(s.dI(he.canonical,wn,Ei,Xt.worldSize/Xt._pixelsPerMercatorPixel))}else Ht=N instanceof s.aU?N.perspectiveTransform:[0,0],Gt=new Float32Array(16),si=new Float32Array(9),pi=new Float32Array(16),Ni=[0,0],en=new Float32Array(9);const ln=Sm(Ke,Gt,si,pi,en,St||[0,0],s.aj(p.transform.zoom),Ni,Rt,xt||1,Pt,u,Ht,E?u.paint.get("raster-elevation"):0,2,je,it,B.range,dt,Fe,U),Ri=p.isTileAffectedByFog(he),En=p.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Ri});if(p.uploadCommonUniforms(L,En,Se),N instanceof s.aU){const wn=N.elevatedGlobeVertexBuffer,Mn=N.elevatedGlobeIndexBuffer;if(G||!w)N.boundsBuffer&&N.boundsSegments&&En.draw(p,R.TRIANGLES,Te,xi.disabled,W,fi.disabled,ln,u.id,N.boundsBuffer,p.quadTriangleIndexBuffer,N.boundsSegments);else if(wn&&Mn){const tn=Xt.zoom<=s.c_?N.elevatedGlobeSegments:N.getSegmentsForLongitude(Xt.center.lng);tn&&En.draw(p,R.TRIANGLES,Te,xi.disabled,W,ve,ln,u.id,wn,Mn,tn)}}else if(I){Te=new Qt(R.LEQUAL,Qt.ReadOnly,p.depthRangeFor3D);const wn=p.globeSharedBuffers;if(wn){const[Mn,tn,Fi]=wn.getGridBuffers(Ei,!1);En.draw(p,R.TRIANGLES,Te,pe||We,p.colorModeForRenderPass(),ve,ln,u.id,Mn,tn,Fi)}}else{const{tileBoundsBuffer:wn,tileBoundsIndexBuffer:Mn,tileBoundsSegments:tn}=p.getTileBoundsBuffers(ze);En.draw(p,R.TRIANGLES,Te,We,W,fi.disabled,ln,u.id,wn,Mn,tn)}}if(!(N instanceof s.aU)&&I)for(const he of _e){const Se=he.canonical.y===(1<<he.canonical.z)-1;he.canonical.y===0&&tf(!0,he,p,n,u,U,B,ve,pe||xi.disabled),Se&&tf(!1,he,p,n,u,U,B,ve===fi.frontCW?fi.backCW:fi.frontCW,pe||xi.disabled)}};I?be(re,p.renderElevatedRasterBackface?fi.backCW:fi.frontCW,p.stencilModeFor3D()):be(re,fi.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,n,u,m,y,b){p.renderPass==="offscreen"&&(function(w,E,I,L){if(!L.length)return;const R=w.context,N=R.gl,B=E.getSource();if(!(B instanceof Fo))return;const U=Math.ceil(Math.sqrt(I.paint.get("raster-particle-count")));let W=I.particlePositionRGBAImage;if(!W||W.width!==U){const re=(function(ne){const be=ne*ne,_e=new Uint8Array(4*be),ve=function(he){return he|=0,he=Math.imul(2747636419^he,2654435769),he=Math.imul(he^he>>>16,2654435769),((he=Math.imul(he^he>>>16,2654435769))>>>0)/4294967296},pe=.9090909090909091;for(let he=0;he<be;he++){const Se=pe*(ve(2*he+0)+su),ze=pe*(ve(2*he+1)+su),Re=255*Se%1,Ze=255*ze%1,je=Re,it=ze-Ze/255,dt=Ze;_e[4*he+0]=255*(Se-Re/255),_e[4*he+1]=255*je,_e[4*he+2]=255*it,_e[4*he+3]=255*dt}return _e})(U);W=I.particlePositionRGBAImage=new s.q({width:U,height:U},re)}let G=I.particleFramebuffer;G?G.width!==U&&(G.destroy(),G=I.particleFramebuffer=R.createFramebuffer(U,U,1,null)):G=I.particleFramebuffer=R.createFramebuffer(U,U,1,null);const J=[];for(const re of L){const ne=E.getTile(re);if(!(ne instanceof _d))continue;const be=zm(ne,B,I);if(!be)continue;const _e=[ne.tileSize,ne.tileSize];let ve=I.tileFramebuffer;ve||(ve=I.tileFramebuffer=R.createFramebuffer(_e[0],_e[1],1,null));let pe=ne.rasterParticleState;pe||(pe=ne.rasterParticleState=new cv(R,re,_e,W));const he=pe.update(I.lastInvalidatedAt);pe.particleTextureDimension!==U&&pe.updateParticleTexture(re,W);const Se=pe.targetColorTexture;pe.targetColorTexture=pe.backgroundColorTexture,pe.backgroundColorTexture=Se;const ze=pe.particleTexture0;pe.particleTexture0=pe.particleTexture1,pe.particleTexture1=ze,J.push([re,be,pe,he])}if(J.length===0)return;const K=s.o.now(),oe=I.previousDrawTimestamp?.001*(K-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=K,I.hasColorMap()){R.activeTexture.set(N.TEXTURE0+2);let re=I.colorRampTexture;re||(re=I.colorRampTexture=new s.T(R,I.colorRamp,N.RGBA8)),re.bind(N.LINEAR,N.CLAMP_TO_EDGE)}R.bindFramebuffer.set(I.tileFramebuffer.framebuffer),(function(re,ne,be){const _e=re.context,ve=_e.gl,pe=ne.tileFramebuffer;_e.activeTexture.set(ve.TEXTURE0);const he={u_texture:0,u_opacity:1.05*(ze=ne.paint.get("raster-particle-fade-opacity-factor"))/(ze+.05)},Se=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ze;for(const Re of be){const[,,Ze,je]=Re;pe.colorAttachment0.set(Ze.targetColorTexture.texture),_e.viewport.set([0,0,pe.width,pe.height]),_e.clear({color:s.ao.transparent}),je&&(Ze.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),Se.draw(re,ve.TRIANGLES,Qt.disabled,xi.disabled,Mi.alphaBlended,fi.disabled,he,ne.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}})(w,I,J),(function(re,ne,be,_e){const ve=re.context,pe=ve.gl,he=be.tileFramebuffer,Se=re.transform.projection.name==="globe",ze=be.paint.get("raster-particle-max-speed");for(const Re of _e){const[Ze,je,it]=Re;ve.activeTexture.set(pe.TEXTURE0+0),je.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),he.colorAttachment0.set(it.targetColorTexture.texture);const dt=re.getOrCreateProgram("rasterParticleDraw",{defines:je.defines,overrideFog:!1});ve.activeTexture.set(pe.TEXTURE0+1);const Fe=je.scalarData?[]:[0,1,2,3].map(We=>s.e9[We](Ze));Fe.push(Ze);const Te=Ze.canonical.x,Ke=Ze.canonical.y;for(const We of Fe){const pt=ne.getTile(Se?We.wrapped():We);if(!pt)continue;const vt=pt.rasterParticleState;if(!vt)continue;const Pt=We.canonical.x+(1<<We.canonical.z)*(We.wrap-Ze.wrap),xt=We.canonical.y;vt.particleTexture0.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const St=Qy(1,vt.particleTexture0.size[0],[Pt-Te,xt-Ke],0,je.texture.size,2,ze,je.textureOffset,je.scale,je.offset);dt.draw(re,pe.POINTS,Qt.disabled,xi.disabled,Mi.alphaBlended,fi.disabled,St,be.id,vt.particleIndexBuffer,void 0,vt.particleSegment)}}})(w,E,I,J),R.bindFramebuffer.set(I.particleFramebuffer.framebuffer),(function(re,ne,be,_e){const ve=re.context,pe=ve.gl,he=ne.paint.get("raster-particle-max-speed"),Se=_e*ne.paint.get("raster-particle-speed-factor")*.15,ze=(function(Ze){return Math.pow(Ze,6)})(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),Re=ne.particleFramebuffer;ve.viewport.set([0,0,Re.width,Re.height]);for(const Ze of be){const[,je,it]=Ze;ve.activeTexture.set(pe.TEXTURE0+0),je.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),ve.activeTexture.set(pe.TEXTURE0+1);const dt=it.particleTexture0;dt.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const Fe=Cw(1,dt.size[0],0,je.texture.size,he,Se,ze,je.textureOffset,je.scale,je.offset);Re.colorAttachment0.set(it.particleTexture1.texture),ve.clear({color:s.ao.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:je.defines}).draw(re,pe.TRIANGLES,Qt.disabled,xi.disabled,Mi.unblended,fi.disabled,Fe,ne.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}})(w,I,J,oe)})(p,n,u,m),p.renderPass==="translucent"&&((function(w,E,I,L){const R=w.context,N=R.gl,B=E.getSource().tileSize,U=5*(1-s.ah(s.cL,s.cL+1,w.transform.zoom))*B+I.paint.get("raster-particle-elevation"),W=!w.options.moving,G=w.transform.projection.name==="globe";if(!L.length)return;const[J,K]=w.stencilConfigForOverlap(L),oe=[];G&&oe.push("PROJECTION_GLOBE_VIEW");const re=w.stencilModeFor3D();for(const ne of K){const be=ne.toUnwrapped(),_e=E.getTile(ne);if(!_e.rasterParticleState)continue;const ve=_e.rasterParticleState,pe=100;_e.registerFadeDuration(pe);const he=E.findLoadedParent(ne,0),Se=vh(_e,he,E,w.transform,pe);let ze,Re;w.terrain&&w.terrain.prepareDrawTile(),R.activeTexture.set(N.TEXTURE0),ve.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),R.activeTexture.set(N.TEXTURE1),he&&he.rasterParticleState?(he.rasterParticleState.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ze=Math.pow(2,he.tileID.overscaledZ-_e.tileID.overscaledZ),Re=[_e.tileID.canonical.x*ze%1,_e.tileID.canonical.y*ze%1]):ve.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Ze=G?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(be,W),je=w.transform,it=uv(je),dt=s.dG(ne.canonical),Fe=s.dH(dt.getCenter().lat);let Te,Ke,We,pt,vt;G?(Te=Float32Array.from(s.bk(s.dJ(ne.canonical))),Ke=Float32Array.from(je.globeMatrix),We=Float32Array.from(s.dF(je)),pt=[s.aF(je.center.lng),s.aJ(je.center.lat)],vt=Float32Array.from(s.dI(ne.canonical,dt,Fe,je.worldSize/je._pixelsPerMercatorPixel))):(Te=new Float32Array(16),Ke=new Float32Array(9),We=new Float32Array(16),pt=[0,0],vt=new Float32Array(9));const Pt=zw(Ze,Te,Ke,We,vt,Re||[0,0],s.aj(w.transform.zoom),pt,it,ze||1,Se,U),xt=w.isTileAffectedByFog(ne),St=w.getOrCreateProgram("rasterParticle",{defines:oe,overrideFog:xt});if(w.uploadCommonUniforms(R,St,be),G){const Xt=new Qt(N.LEQUAL,Qt.ReadOnly,w.depthRangeFor3D),Ht=0,Rt=w.globeSharedBuffers;if(Rt){const[Gt,si,pi]=Rt.getGridBuffers(Fe,Ht!==0);St.draw(w,N.TRIANGLES,Xt,re,Mi.alphaBlended,w.renderElevatedRasterBackface?fi.frontCCW:fi.backCCW,Pt,I.id,Gt,si,pi)}}else{const Xt=w.depthModeForSublayer(0,Qt.ReadOnly),Ht=J[ne.overscaledZ],{tileBoundsBuffer:Rt,tileBoundsIndexBuffer:Gt,tileBoundsSegments:si}=w.getTileBoundsBuffers(_e);St.draw(w,N.TRIANGLES,Xt,Ht,Mi.alphaBlended,fi.disabled,Pt,I.id,Rt,Gt,si)}}w.resetStencilClippingMasks()})(p,n,u,m),p.style.map.triggerRepaint())},background:function(p,n,u,m){const y=u.paint.get("background-color"),b=u.paint.get("background-color-use-theme").constantOr("default")==="none",w=u.paint.get("background-opacity"),E=u.paint.get("background-emissive-strength"),I=u.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const L=p.context,R=L.gl,N=p.transform,B=N.tileSize,U=u.paint.get("background-pattern");let W;if(U!==void 0&&(U===null||(W=p.imageManager.getPattern(s.I.from(U.toString()),u.scope,p.style.getLut(u.scope)),!W)))return;const G=!U&&y.a===1&&w===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==G)return;const J=xi.disabled,K=p.depthModeForSublayer(0,G==="opaque"?Qt.ReadWrite:Qt.ReadOnly),oe=p.colorModeForDrapableLayerRenderPass(E),re=U?"backgroundPattern":"background";let ne,be=m;be||(ne=p.getBackgroundTiles(),be=Object.values(ne).map(ve=>ve.tileID)),U&&(L.activeTexture.set(R.TEXTURE0),p.imageManager.bind(p.context,u.scope));const _e=[];if(p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&_e.push("USE_MRT1"),I){const ve=p.getOrCreateProgram(re,{overrideFog:!1,overrideRtt:!0,defines:_e}),pe=new Float32Array(s.bA([])),he=new s.aQ(0,0,0,0,0),Se=U?wh(pe,E,w,p,0,u.scope,W,I,{tileID:he,tileSize:B}):Ul(pe,E,w,y.toPremultipliedRenderColor(b?null:u.lut));return void ve.draw(p,R.TRIANGLES,K,J,oe,fi.disabled,Se,u.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}for(const ve of be){const pe=p.isTileAffectedByFog(ve),he=p.getOrCreateProgram(re,{overrideFog:pe,defines:_e}),Se=ve.toUnwrapped(),ze=m?ve.projMatrix:p.transform.calculateProjMatrix(Se);p.prepareDrawTile();const Re=n?n.getTile(ve):ne?ne[ve.key]:new Pl(ve,B,N.zoom,p),Ze=U?wh(ze,E,w,p,0,u.scope,W,I,{tileID:ve,tileSize:B}):Ul(ze,E,w,y.toPremultipliedRenderColor(b?null:u.lut));p.uploadCommonUniforms(L,he,Se);const{tileBoundsBuffer:je,tileBoundsIndexBuffer:it,tileBoundsSegments:dt}=p.getTileBoundsBuffers(Re);he.draw(p,R.TRIANGLES,K,J,oe,fi.disabled,Ze,u.id,je,it,dt)}},sky:function(p,n,u){const m=p._atmosphere?s.aj(p.transform.zoom):1,y=u.paint.get("sky-opacity")*m;if(y===0)return;const b=p.context,w=u.paint.get("sky-type"),E=new Qt(b.gl.LEQUAL,Qt.ReadOnly,[0,1]),I=p.frameCounter/1e3%1;w==="atmosphere"?p.renderPass==="offscreen"?u.needsSkyboxCapture(p)&&((function(L,R){const N=L.context,B=N.gl;let U=R.skyboxFbo;if(!U){U=R.skyboxFbo=N.createFramebuffer(32,32,1,null),R.skyboxGeometry=new ss(N),R.skyboxTexture=N.gl.createTexture(),B.bindTexture(B.TEXTURE_CUBE_MAP,R.skyboxTexture),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAG_FILTER,B.LINEAR);for(let K=0;K<6;++K)B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,B.RGBA,32,32,0,B.RGBA,B.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(U.framebuffer),N.viewport.set([0,0,32,32]);const W=R.getCenter(L,!0),G=L.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);s.bA(J),s.en(J,J,.5*-Math.PI),jl(L,R,G,J,W,0),s.bA(J),s.en(J,J,.5*Math.PI),jl(L,R,G,J,W,1),s.bA(J),s.cU(J,J,.5*-Math.PI),jl(L,R,G,J,W,2),s.bA(J),s.cU(J,J,.5*Math.PI),jl(L,R,G,J,W,3),s.bA(J),jl(L,R,G,J,W,4),s.bA(J),s.en(J,J,Math.PI),jl(L,R,G,J,W,5),N.viewport.set([0,0,L.width,L.height])})(p,u),u.markSkyboxValid(p)):p.renderPass==="sky"&&(function(L,R,N,B,U){const W=L.context,G=W.gl,J=L.transform,K=L.getOrCreateProgram("skybox");W.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,R.skyboxTexture);const oe=((re,ne,be,_e,ve)=>({u_matrix:re,u_sun_direction:ne,u_cubemap:0,u_opacity:_e,u_temporal_offset:ve}))(J.skyboxMatrix,R.getCenter(L,!1),0,B,U);L.uploadCommonUniforms(W,K),K.draw(L,G.TRIANGLES,N,xi.disabled,L.colorModeForRenderPass(),fi.backCW,oe,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)})(p,u,E,y,I):w==="gradient"&&p.renderPass==="sky"&&(function(L,R,N,B,U){const W=L.context,G=W.gl,J=L.transform,K=L.getOrCreateProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new ss(W)),W.activeTexture.set(G.TEXTURE0);let oe=R.colorRampTexture;oe||(oe=R.colorRampTexture=new s.T(W,R.colorRamp,G.RGBA8)),oe.bind(G.LINEAR,G.CLAMP_TO_EDGE);const re=((ne,be,_e,ve,pe)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:be,u_radius:s.an(_e),u_opacity:ve,u_temporal_offset:pe}))(J.skyboxMatrix,R.getCenter(L,!1),R.paint.get("sky-gradient-radius"),B,U);L.uploadCommonUniforms(W,K),K.draw(L,G.TRIANGLES,N,xi.disabled,L.colorModeForRenderPass(),fi.backCW,re,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)})(p,u,E,y,I)},custom:function(p,n,u,m){const y=p.context,b=u.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&u.isDraped(n)){if(p.renderPass==="offscreen"){const w=b.prerender;if(w){if(p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const E=p.transform.pointMerc;w.call(b,y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),s.aj(p.transform.zoom),[E.x,E.y],p.transform.pixelsPerMeterRatio)}else w.call(b,y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const E=b.renderToTile;if(E){const I=m[0].canonical,L={x:I.x+m[0].wrap*(b.wrapTileId?0:1<<I.z),y:I.y,z:I.z};y.setDepthMode(Qt.disabled),y.setStencilMode(xi.disabled),y.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),E.call(b,y.gl,L),y.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),y.setStencilMode(xi.disabled);const w=b.renderingMode==="3d"?new Qt(p.context.gl.LEQUAL,Qt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Qt.ReadOnly);if(y.setDepthMode(w),p.transform.projection.name==="globe"){const E=p.transform.pointMerc;b.render(y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),s.aj(p.transform.zoom),[E.x,E.y],p.transform.pixelsPerMeterRatio)}else b.render(y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState(),y.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,n,u,m){if(p.renderPass==="opaque")return;const y=u.paint.get("model-opacity").constantOr(1),b=u.paint.get("model-elevation-reference"),w=b==="ground",E=b==="ground";if(y===0)return;const I=u.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!I||p.terrain&&y<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const L=p.shadowRenderer,R=u.paint.get("model-receive-shadows");L&&(L.useNormalOffset=!0,R||(L.enabled=!1));const N=()=>{L&&(L.useNormalOffset=!0,R||(L.enabled=!0))},B=n.getSource();if(p.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return(function(ne,be,_e,ve,pe){const he=ne.transform,Se=he.projection.name==="globe",ze=he.getFreeCameraOptions().position;if(!ne.modelManager)return;const Re=ne.modelManager;_e.modelManager=Re;const Ze=ne.shadowRenderer;if(!_e._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const je=_e._unevaluatedLayout._values["model-id"],it=Object.assign({},_e.layout.get("model-id").parameters),dt=ne.style.order.indexOf(_e.fqid),Fe=_e.paint.get("model-opacity").constantOr(1);for(const Te of ve){const Ke=be.getTile(Te).getBucket(_e);if(!Ke||Ke.projection.name!==he.projection.name)continue;const We=Ke.getModelUris();if(We&&!Ke.modelsRequested&&(Re.addModelsFromBucket(We,pe),Ke.modelsRequested=!0),Se)it.zoom=Te.overscaledZ;else{const Rt=bt(Te,he);it.zoom=Rt}const pt=je.possiblyEvaluate(it);if(bc(ne,Ke,Te),$o.shadowUniformsInitialized=!1,$o.useSingleShadowCascade=!!Ze&&Ze.getMaxCascadeForTile(Te.toUnwrapped())===0,ne.renderPass==="shadow"&&Ze){if(ne.currentShadowCascade===1&&Ke.isInsideFirstShadowMapFrustum)continue;const Rt=he.calculatePosMatrix(Te.toUnwrapped(),he.worldSize);if($o.tileMatrix.set(Rt),$o.shadowTileMatrix=Float32Array.from(Ze.calculateShadowPassMatrixFromMatrix(Rt)),$o.aabb.min=[0,0,0],$o.aabb.max[0]=$o.aabb.max[1]=s.al,$o.aabb.max[2]=0,ur(Ke,$o,ne,_e.scope))continue}const vt=1<<Te.canonical.z,Pt=[((ze.x-Te.wrap)*vt-Te.canonical.x)*s.al,(ze.y*vt-Te.canonical.y)*s.al,ze.z*vt*s.al];ne.conflationActive&&Object.keys(Ke.instancesPerModel).length>0&&ne.style.isLayerClipped(_e,be.getSource())&&Ke.updateReplacement(Te,ne.replacementSource,dt,_e.scope)&&(Ke.uploaded=!1,Ke.upload(ne.context));let xt=0;const St=new Array,Xt=new Array,Ht=new Array;for(let Rt in Ke.instancesPerModel){const Gt=Ke.instancesPerModel[Rt];Gt.features.length>0&&!Se&&(Rt=pt.evaluate(Gt.features[0].feature,{}));const si=Re.getModel(Rt,pe);if(si||Re.hasURLBeenRequested(Rt)||Ke.modelUris.includes(Rt)||(Ke.modelUris.push(Rt),Ke.modelsRequested=!1),si&&si.uploaded)if(Se){const pi=s.c5([],[ze.x,ze.y,ze.z],ne.transform.worldSize);s.ew(pi,pi);for(let Ni=0;Ni<Gt.instancedDataArray.length;++Ni){const en=[0,0,0],Ei=[1,1,1],ln=s.ex(),Ri=Gt.tileCoordinatesForInstance(Ni),En=Gt.transformForInstance(Ni);s.ey(Ei,En),s.ez(ln,En),s.eA(en,ln);const wn=Gt.translationForInstance(Ni),Mn=new s.aT(0,0);s.eB(Ke.canonical,Mn,Ri.x,Ri.y);const tn=s.bC();s.eC(tn,si,ne.transform,Mn,en,Ei,wn,!0,!1,!1);const Fi=Gt.colorForInstance(Ni),gn=s.bA([]),tr=s.ef(Mn.lat,ne.transform.zoom),ir=s.bq([],[1,1,1/tr]);s.br(gn,gn,pi),Ht.push({zScaleMatrix:ir,negCameraPosMatrix:gn});for(const _n of si.nodes)Ih(ne,_n,tn,ne.transform.expandedFarZProjMatrix,xt,St,Xt,si.materialOverrides,Fe,Fi);++xt}}else for(const pi of si.nodes)zt(ne,_e,pi,Gt,Pt,Te,$o)}if(Se)if(ne.renderPass==="shadow"){for(const Rt of Xt)uu(Rt.mesh,Rt.nodeModelMatrix,ne,_e);for(const Rt of St)uu(Rt.mesh,Rt.nodeModelMatrix,ne,_e)}else Nm(ne,_e,St,Xt,Ht)}})(p,n,u,m,Eh(p,u)),void N();if(!B.loaded())return;if(B.type==="batched-model")return(function(ne,be,_e,ve){_e.resetLayerRenderingStats(ne);const pe=ne.context,he=ne.transform,Se=ne.style.fog,ze=ne.shadowRenderer;if(he.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${he.projection.name} projection is not yet implemented`);const Re=ne.transform.getFreeCameraOptions().position,Ze=s.c5([],[Re.x,Re.y,Re.z],ne.transform.worldSize),je=s.ew([],Ze),it=s.bA([]),dt=s.ef(he.center.lat,he.zoom),Fe=s.bq([],[1,1,1/dt]);s.br(it,it,je);const Te=_e.paint.get("model-opacity").constantOr(1),Ke=new Qt(pe.gl.LEQUAL,Qt.ReadWrite,ne.depthRangeFor3D),We=new Qt(pe.gl.LEQUAL,Qt.ReadOnly,ne.depthRangeFor3D),pt=new s.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),vt=ne.renderPass==="shadow",Pt=vt&&ze?ze.getCurrentCascadeFrustum():he.getFrustum(he.scaleZoom(he.worldSize)),xt=_e.paint.get("model-front-cutoff"),St=xt[2]<1,Xt=ia(ne,_e.paint.get("model-cutoff-fade-range")),Ht=_e.getLayerRenderingStats();(function(Rt,Gt,si,pi){const Ni=Rt.terrain?Rt.terrain.exaggeration():0,en=Rt.transform.zoom;for(const Ei of pi){const ln=Gt.getTile(Ei).getBucket(si);ln&&(ln.setFilter(si.filter),Rt.conflationActive&&ln.updateReplacement(Ei,Rt.replacementSource),ln.evaluateTransform(Rt,si),Rt.terrain&&Ni>0&&ln.elevationUpdate(Rt.terrain,Ni,Ei,si.source),ln.needsReEvaluation(Rt,en,si)&&ln.evaluate(si))}})(ne,be,_e,ve),(function(){let Rt,Gt,si;St?(Rt=ve.length-1,Gt=-1,si=-1):(Rt=0,Gt=ve.length,si=1);const pi=new Float64Array(16),Ni=s.cA(),en=new s.P(0,0);for(let Ei=Rt;Ei!==Gt;Ei+=si){const ln=ve[Ei],Ri=be.getTile(ln).getBucket(_e);if(!Ri||!Ri.uploaded)continue;let En=!1;ze&&(En=ze.getMaxCascadeForTile(ln.toUnwrapped())===0);const wn=he.calculatePosMatrix(ln.toUnwrapped(),he.worldSize),Mn=Ri.modelTraits;!vt&&St&&(s.bl(pi,wn),s.af(Ni,Ze,pi),en.x=Ni[0],en.y=Ni[1]);const tn=[];Ri.setFilter(_e.filter);for(const Fi of Ri.getNodesInfo()){if(Fi.hiddenByReplacement||!Fi.node.meshes)continue;const gn=Fi.node;let tr=0;ne.terrain&&gn.elevation&&(tr=gn.elevation*ne.terrain.exaggeration());const ir=(()=>{const yn=Fi.aabb;return pt.min=[...yn.min],pt.max=[...yn.max],pt.min[2]+=tr,pt.max[2]+=tr,s.af(pt.min,pt.min,wn),s.af(pt.max,pt.max,wn),pt})(),_n=Fi.evaluatedScale;if(_n[0]<=1&&_n[1]<=1&&_n[2]<=1&&ir.intersects(Pt)===0)continue;if(!vt&&St){const yn=.16666666666666666;Fi.cameraCollisionOpacity=Ze[0]>ir.min[0]&&Ze[0]<ir.max[0]&&Ze[1]>ir.min[1]&&Ze[1]<ir.max[1]&&Ze[2]*dt<ir.max[2]&&gn.footprint&&s.c0(en,gn.footprint)?Math.max(Fi.cameraCollisionOpacity-yn,0):Math.min(1,Fi.cameraCollisionOpacity+yn)}const Yi=[...wn],Bi=1/s.d7(ln.canonical),Nn=gn.anchor?gn.anchor[0]:0,hr=gn.anchor?gn.anchor[1]:0;s.br(Yi,Yi,[Nn*(_n[0]-1)+Fi.evaluatedTranslation[0]*Bi,hr*(_n[1]-1)+Fi.evaluatedTranslation[1]*Bi,tr+Fi.evaluatedTranslation[2]]),s.cq(_n,s.eE)||s.cS(Yi,Yi,_n);const jn=s.aB([],Yi,gn.globalMatrix),Wn=s.aB([],he.expandedFarZProjMatrix,jn),jo=s.aB([],he.expandedFarZProjMatrix,Yi),as=s.aC([],[Nn,hr,tr,1],Wn)[2];gn.hidden=!1;let ro=Te;vt||(St&&(ro*=Fi.cameraCollisionOpacity,ro*=_v(Yi,he,Fi.aabb,xt)),ro*=ke(Xt,as)),ro!==0?tn.push({nodeInfo:Fi,depth:as,opacity:ro,wvpForNode:Wn,wvpForTile:jo,nodeModelMatrix:jn,tileModelMatrix:Yi}):gn.hidden=!0}vt||tn.sort((Fi,gn)=>!St||Fi.opacity===1&&gn.opacity===1?Fi.depth<gn.depth?-1:1:Fi.opacity===1?-1:gn.opacity===1?1:Fi.depth>gn.depth?-1:1);for(const Fi of tn){const gn=Fi.nodeInfo,tr=gn.node;let ir=s.aB([],Fe,Fi.tileModelMatrix);s.aB(ir,it,ir);const _n=s.bl([],ir);s.eg(_n,_n),s.cS(_n,_n,hu),ir=s.aB(ir,ir,tr.globalMatrix);const Yi=ne.renderPass==="light-beam",Bi=_e.paint.get("model-color-use-theme").constantOr("default")==="none",Nn=Mn&s.eI.HasMapboxMeshFeatures,hr=Nn?0:gn.evaluatedRMEA[0][2];for(let jn=0;jn<tr.meshes.length;++jn){const Wn=tr.meshes[jn],jo=jn===tr.lightMeshIndex;let as=Fi.wvpForNode;if(jo){if(!Yi&&!ne.terrain&&ne.shadowRenderer){ne.currentLayer<ne.firstLightBeamLayer&&(ne.firstLightBeamLayer=ne.currentLayer);continue}as=Fi.wvpForTile}else if(Yi)continue;const ro={defines:[]},yn=[];if(!vt&&ze&&(ze.useNormalOffset=!!Wn.normalBuffer),ma(ro.defines,yn,Wn,ne,Bi?null:_e.lut),Nn||ro.defines.push("DIFFUSE_SHADED"),En&&ro.defines.push("SHADOWS_SINGLE_CASCADE"),Ht&&(vt?Ht.numRenderedVerticesInShadowPass+=Wn.vertexArray.length:Ht.numRenderedVerticesInTransparentPass+=Wn.vertexArray.length),vt){uu(Wn,Fi.nodeModelMatrix,ne,_e);continue}let bs=null;if(Se){const Ir=Bm(Fi.nodeModelMatrix,ne.transform);if(bs=new Float32Array(Ir),he.projection.name!=="globe"){const Gn=Wn.aabb.min,Cr=Wn.aabb.max,[Io,br]=Se.getOpacityForBounds(Ir,Gn[0],Gn[1],Cr[0],Cr[1]);ro.overrideFog=Io>=Ft||br>=Ft}}const Eo=Wn.material;let Go;Eo.occlusionTexture&&Eo.occlusionTexture.offsetScale&&(Go=Eo.occlusionTexture.offsetScale,ro.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const oa=ne.getOrCreateProgram("model",ro);!vt&&ze&&ze.setupShadowsFromMatrix(Fi.tileModelMatrix,oa,ze.useNormalOffset),ne.uploadCommonUniforms(pe,oa,null,bs);const Ho=Eo.pbrMetallicRoughness;Ho.metallicFactor=.9,Ho.roughnessFactor=.5;const rr=Xd(new Float32Array(as),new Float32Array(ir),new Float32Array(_n),new Float32Array(tr.globalMatrix),ne,Fi.opacity,Ho.baseColorFactor,Eo.emissiveFactor,Ho.metallicFactor,Ho.roughnessFactor,Eo,hr,_e,[0,0,0],Go);!jo&&(gn.hasTranslucentParts||Fi.opacity<1)&&oa.draw(ne,pe.gl.TRIANGLES,Ke,xi.disabled,Mi.disabled,fi.backCCW,rr,_e.id,Wn.vertexBuffer,Wn.indexBuffer,Wn.segments,_e.paint,ne.transform.zoom,void 0,yn),oa.draw(ne,pe.gl.TRIANGLES,jo?We:Ke,xi.disabled,jo||Fi.opacity<1||gn.hasTranslucentParts?Mi.alphaBlended:Mi.unblended,fi.backCCW,rr,_e.id,Wn.vertexBuffer,Wn.indexBuffer,Wn.segments,_e.paint,ne.transform.zoom,void 0,yn)}}}})()})(p,n,u,m),void N();if(B.type!=="model")return;const U=B.getModels(),W=[],G=p.transform.getFreeCameraOptions().position,J=s.c5([],[G.x,G.y,G.z],p.transform.worldSize);s.ew(J,J);const K=[],oe=[];let re=0;for(const ne of U){const be=n.getFeatureState("",ne.id),_e={type:"Unknown",id:ne.id,properties:ne.featureProperties},ve=u.paint.get("model-rotation").evaluate(_e,be),pe=u.paint.get("model-scale").evaluate(_e,be),he=u.paint.get("model-translation").evaluate(_e,be),Se=u.paint.get("model-opacity").evaluate(_e,be);mv(u,ne.id,be,ne.featureProperties,ne.nodeOverrideNames,ne.nodeOverrides),gv(u,ne.id,be,ne.featureProperties,ne.materialOverrideNames,ne.materialOverrides),ne.nodeOverrides.size>0&&ne.computeBoundsAndApplyParent(),ne.computeModelMatrix(p,ve,pe,he,E,w,!1);const ze=s.bA([]),Re=s.ef(ne.position.lat,p.transform.zoom),Ze=s.bq([],[1,1,1/Re]);s.br(ze,ze,J),W.push({zScaleMatrix:Ze,negCameraPosMatrix:ze});for(const je of ne.nodes)Ih(p,je,ne.matrix,p.transform.expandedFarZProjMatrix,re,K,oe,ne.materialOverrides,Se);re++}if(K.sort((ne,be)=>be.depth-ne.depth),p.renderPass!=="shadow")Nm(p,u,K,oe,W),N();else{for(const ne of oe)uu(ne.mesh,ne.nodeModelMatrix,p,u);for(const ne of K)uu(ne.mesh,ne.nodeModelMatrix,p,u);N()}}},Hm={line:function(p,n,u){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const m=n.getVisibleCoordinates();for(const y of m){const b=n.getTile(y).getBucket(p);if(b&&(b.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,n,u){const m=n.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,Eh(u,p)));if(m.type==="batched-model"||m.type!=="model")return;const y=m.getModels();for(const b of y)b.upload(u.context)},raster:function(p,n,u){const m=n.getSource();if(!(m instanceof Fo&&m.loaded()))return;const y=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!y)return;const b=p.paint.get("raster-array-band")||m.getInitialBand(y);if(b==null)return;const w=n.getIds().map(E=>n.getTileByID(E));for(const E of w)E.updateNeeded(p.id,b)&&m.prepareTile(E,y,p.id,b)},"raster-particle":function(p,n,u){const m=n.getSource();if(!(m instanceof Fo&&m.loaded()))return;const y=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!y)return;const b=p.paint.get("raster-particle-array-band")||m.getInitialBand(y);if(b==null)return;const w=n.getIds().map(E=>n.getTileByID(E));for(const E of w)E.updateNeeded(p.id,b)&&m.prepareTile(E,y,p.id,b)}},Zm={fill:Im},xv={fill:function(p,n,u,m){if(!u.layout||u.layout.get("fill-elevation-reference")==="none"||u.paint.get("fill-opacity").constantOr(1)===0)return;const y=p.context.gl,b=new Qt(y.LEQUAL,Qt.ReadOnly,p.depthRangeFor3D),w=new xi({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),E=p.transform.getFreeCameraOptions().position,I=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const L of m){const R=n.getTile(L),N=R.getBucket(u);if(!N)continue;const B=N.elevatedStructures;if(!B||B.depthSegments.segments[0].primitiveLength===0)continue;const U=Em(L.toUnwrapped(),E),W=p.translatePosMatrix(L.projMatrix,R,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),G=yc(W,U,0,1,0);I.draw(p,y.TRIANGLES,b,w,Mi.disabled,fi.disabled,G,u.id,B.vertexBuffer,B.indexBuffer,B.depthSegments,u.paint,p.transform.zoom)}}};class bv{constructor(n,u,m,y,b){this.context=new Yd(n,u),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const I of w)this._debugParams.enabledLayers[I]=!0;for(const I of w);this.occlusionParams=new $m,this.setup(),this.numSublayers=es.maxUnderzooming+es.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new uh(this),this._wireframeDebugCache=new Um,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const E=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,E,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=b,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(n,u){const m=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new gm(this,n));const y=this._terrain;this.transform.elevation=m?y:null,y.update(n,this.transform,u),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(n){const u=n.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=u.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const b=m+.78*(y-m);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new gm(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,u){if(this.width=n*s.o.devicePixelRatio,this.height=u*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const n=this.context,u=new s.bd;u.emplaceBack(0,0),u.emplaceBack(s.al,0),u.emplaceBack(0,s.al),u.emplaceBack(s.al,s.al),this.tileExtentBuffer=n.createVertexBuffer(u,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const m=new s.bd;m.emplaceBack(0,0),m.emplaceBack(s.al,0),m.emplaceBack(0,s.al),m.emplaceBack(s.al,s.al),this.debugBuffer=n.createVertexBuffer(m,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const y=new s.bd;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const b=new s.b1;b.emplaceBack(0,0,0,0),b.emplaceBack(s.al,0,s.al,0),b.emplaceBack(0,s.al,0,s.al),b.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=n.createVertexBuffer(b,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const w=new s.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const E=new s.be;for(const L of[0,1,3,2,0])E.emplaceBack(L);this.debugIndexBuffer=n.createIndexBuffer(E),this.emptyTexture=new s.T(n,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=s.bC();const I=this.context.gl;this.stencilClearMode=new xi({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Qt.disabled,this.stencilClearMode,Mi.disabled,fi.disabled,yh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,u,m){if(!u||this.currentStencilSource===u.id||!n.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const I of m)if(this._tileClippingMaskIDs[I.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=u.id;const y=this.context,b=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(Mi.disabled),y.setDepthMode(Qt.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of m){const I=u.getTile(E),L=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:N,tileBoundsSegments:B}=this.getTileBoundsBuffers(I);w.draw(this,b.TRIANGLES,Qt.disabled,new xi({func:b.ALWAYS,mask:0},L,255,b.KEEP,b.KEEP,b.REPLACE),Mi.disabled,fi.disabled,yh(E.projMatrix),"$clipping",R,N,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,u=this.context.gl;return new xi({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const u=this.context.gl;return new xi({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(n){const u=this.context.gl,m=n.sort((w,E)=>E.overscaledZ-w.overscaledZ),y=m[m.length-1].overscaledZ,b=m[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const w={};for(let E=0;E<b;E++)w[E+y]=new xi({func:u.GEQUAL,mask:255},E+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[w,m]}return[{[y]:xi.disabled},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Mi([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mi.unblended:Mi.alphaBlended}colorModeForDrapableLayerRenderPass(n){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?n!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Mi([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,n??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Mi([u.ONE,u.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,u.ONE_MINUS_SRC_ALPHA],s.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(n,u,m,y=!1){if(this.depthOcclusion)return new Qt(this.context.gl.GREATER,Qt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Qt.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Qt(m||this.context.gl.LEQUAL,u,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,u=Math.ceil(this.width),m=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===u&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),u!==0&&m!==0&&(this.depthFBO=new xc(this.context,u,m,0,"texture"),this.depthTexture=new s.T(this.context,{width:u,height:m,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),n.bindTexture(n.TEXTURE_2D,b),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,u,m,0,0,u,m,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,u)=>n+u/this._fpsHistory.length,0))}render(n,u){const m=s.o.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=u;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(b).filter(Fe=>{const Te=y[Fe];return!(Te.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Te.type]});let E=w(),I=!1,L=!1,R=null,N=0,B=!1;for(const Fe of E){const Te=y[Fe];Te.visibility!=="none"&&(Te.type==="circle"?I=!0:Te.type==="building"?(R=Te,++N):Te.type==="symbol"&&(Te.hasOcclusionOpacityProperties?L=!0:I=!0))}this.updateEmissiveMode();let U=E.map(Fe=>y[Fe]);const W=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();for(const Fe in W){const Te=W[Fe];Te.used&&(Te.prepare(this.context),Te.getSource().usedInConflation&&++N)}let G=!1;for(const Fe of U)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(G=!0),this.prepareLayer(Fe));const J={},K={},oe={},re={},ne={};for(const Fe in W){const Te=W[Fe];J[Fe]=Te.getVisibleCoordinates(),K[Fe]=J[Fe].slice().reverse(),oe[Fe]=Te.getVisibleCoordinates(!0).reverse(),re[Fe]=Te.getShadowCasterCoordinates(),ne[Fe]=Te.sortCoordinatesByDistance(J[Fe])}const be=Fe=>{const Te=this.style.getLayerSourceCache(Fe);return Te&&Te.used?Te.getSource():null};if(N||G||this._clippingActiveLastFrame){const Fe=[],Te=[];let Ke=0;for(const We of U)this.isSourceForClippingOrConflation(We,be(We))&&(Fe.push(We),Te.push(Ke)),Ke++;if(Fe&&(G||Fe.length>1)||this._clippingActiveLastFrame){G=!1;const We=[];for(let pt=0;pt<Fe.length;pt++){const vt=Fe[pt],Pt=Te[pt],xt=this.style.getLayerSourceCache(vt);if(!xt||!xt.used||!xt.getSource().usedInConflation&&vt.type!=="clip"&&vt.type!=="building")continue;let St=s.eQ,Xt=s.b_.None;const Ht=[];let Rt=!0;if(vt.type==="building")St=s.eS;else if(vt.type==="clip")if(St=Pt,vt.isHidden(this.transform.zoom))Rt=!1;else{if(!vt.layout){Rt=!1;continue}for(const Gt of vt.layout.get("clip-layer-types"))Xt|=Gt==="model"?s.b_.Model:Gt==="symbol"?s.b_.Symbol:s.b_.FillExtrusion;for(const Gt of vt.layout.get("clip-layer-scope"))Ht.push(Gt);G=!0}Rt&&We.push({layer:vt.fqid,cache:xt,order:St,clipMask:Xt,clipScope:Ht})}this.replacementSource.setSources(We),B=!0}}this._clippingActiveLastFrame=G,B||this.replacementSource.clear(),this.conflationActive=B,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<U.length;Fe++){const Te=U[Fe];if(Te.visibility==="none")continue;const Ke=Te.cutoffRange();if(this.longestCutoffRange=Math.max(Ke,this.longestCutoffRange),Ke>0){const We=be(Te);We&&(this.minCutoffZoom=Math.max(We.minzoom,this.minCutoffZoom)),Te.minzoom&&(this.minCutoffZoom=Math.max(Te.minzoom,this.minCutoffZoom))}Te.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const _e=this.style&&this.style.fog;_e?(this._fogVisible=_e.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=_e.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(oe),this.opaquePassCutoff=0,E=w(),U=E.map(Fe=>y[Fe]));const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in W)for(const Te of J[Fe]){let Ke={min:0,max:0};this.terrain&&(Ke=this.terrain.getMinMaxForTile(Te)||Ke),ve.addShadowReceiver(Te.toUnwrapped(),Ke.min,Ke.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Om(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),he=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(pe&&!this._snow&&(this._snow=new Ah(this)),!pe&&this._snow&&(this._snow.destroy(),delete this._snow),he&&!this._rain&&(this._rain=new vv(this)),!he&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),R){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Fm);const Fe=this.style.getLayerSourceCache(R);this.buildingTileBorderManager.updateBorders(Fe,R)}if(!zi.has(this.context.gl))return;this.renderPass="offscreen";for(const Fe of U){const Te=n.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const Ke=Te?K[Te.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||Ke&&Ke.length)&&this.renderLayer(this,Te,Fe,Ke)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,re)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ze=(()=>{if(u.showOverdrawInspector)return s.ao.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const Te=this.style.getLut(Fe.scope);if(!Se){const Ke=Fe.properties.get("color-use-theme")==="none",We=Fe.properties.get("color").toNonPremultipliedRenderColor(Ke?null:Te).toArray01();return new s.ao(...We)}if(Se){const Ke=Fe.properties.get("space-color-use-theme")==="none",We=Fe.properties.get("space-color").toNonPremultipliedRenderColor(Ke?null:Te).toArray01();return new s.ao(...We)}}return s.ao.transparent})();if(this.context.clear({color:ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=U[this.currentLayer],Te=n.getLayerSourceCache(Fe);if(Fe.isSky())continue;const Ke=Te?(Fe.is3D(b)?ne:K)[Te.id]:void 0;this._renderTileClippingMasks(Fe,Te,Ke),this.renderLayer(this,Te,Fe,Ke)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const Fe=U[this.currentLayer],Te=n.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,Te,Fe,Te?K[Te.id]:void 0)}function Re(Fe,Te){let Ke;return Te&&(Ke=(Fe.type==="symbol"?oe:Fe.is3D(b)?ne:K)[Te.id]),Ke}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const Fe=U[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){const Te=n.getLayerSourceCache(Fe);this.renderLayer(this,Te,Fe,Re(Fe,Te))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const Ze=ve?ve.getGroundShadowLayerIndex():-1;let je=!1,it=-1;for(let Fe=0;Fe<E.length;++Fe){const Te=U[Fe];Te.isHidden(this.transform.zoom)||Te.is3D(b)&&(it=Fe)}L&&it===-1&&(I=!0);let dt=!1;for(;this.currentLayer<E.length;){const Fe=U[this.currentLayer],Te=n.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!dt&&Fe.is3D(b)&&!b){const Ke=this.currentLayer,We=pt=>{for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const vt=U[this.currentLayer];if(Zm[vt.type]){const Pt=this.style.getLayerSourceCache(vt);Zm[vt.type](this,Pt,vt,Re(vt,Pt),pt)}}};We("initialize"),We("reset"),this.currentLayer=Ke,dt=!0}if(I&&!je&&this.terrain&&!this.transform.isOrthographic&&(je=!0,this.blitDepth()),L&&it!==-1&&this.currentLayer===it+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Fe,Te,Te?J[Te.id]:void 0),this.renderLayer(this,Te,Fe,Re(Fe,Te)),!this.terrain&&ve&&this.currentLayer===Ze){{this.clearStencil(),this.resetStencilClippingMasks();const Ke=this.currentLayer;for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const We=U[this.currentLayer];if(xv[We.type]){const pt=this.style.getLayerSourceCache(We);xv[We.type](this,pt,We,Re(We,pt))}}this.currentLayer=Ke}if(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ke=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ke;this.currentLayer++){const We=U[this.currentLayer];if(!We.hasLightBeamPass())continue;const pt=n.getLayerSourceCache(We);this.renderLayer(this,pt,We,pt?K[pt.id]:void 0)}this.currentLayer=Ke,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ke=this.currentLayer;this.depthOcclusion=!0;for(const We of this.layersWithOcclusionOpacity){this.currentLayer=We;const pt=U[this.currentLayer],vt=n.getLayerSourceCache(pt),Pt=vt?K[vt.id]:void 0;this.terrain||this._renderTileClippingMasks(pt,vt,vt?J[vt.id]:void 0),this.renderLayer(this,vt,pt,Pt)}this.depthOcclusion=!1,this.currentLayer=Ke,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;U.forEach(Te=>{const Ke=n.getLayerSourceCache(Te);Ke&&!Te.isHidden(this.transform.zoom)&&Ke.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<Ke.getSource().maxzoom)&&(Fe=Ke)}),Fe&&this.options.showTileBoundaries&&hv(this,Fe,Fe.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&hv(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Fe){const Te=Fe.transform.padding;dv(Fe,Fe.transform.height-(Te.top||0),3,Cm),dv(Fe,Te.bottom||0,3,Lm),Dm(Fe,Te.left||0,3,Rm),Dm(Fe,Fe.transform.width-(Te.right||0),3,Rw);const Ke=Fe.transform.centerPoint;(function(We,pt,vt,Pt){nf(We,pt-1,vt-10,2,20,Pt),nf(We,pt-10,vt-1,20,2,Pt)})(Fe,Ke.x,Fe.transform.height-Ke.y,Dw)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),B||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:u}=this.transform.projection,m=!u||!u.includes(n.type);if(Hm[n.type]&&(m||this.terrain&&n.type==="custom")){const y=this.style.getLayerSourceCache(n);Hm[n.type](n,y,this)}this.gpuTimingEnd()}renderLayer(n,u,m,y){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(m.type)&&(!n.terrain||m.type!=="custom")||m.type==="clip"||wc[m.type](n,u,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,m=this.context.gl;let y=this.gpuTimers[n.id];y||(y=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:m.createQuery()}),y.calls++,m.beginQuery(u.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,u=this.context.gl,m=u.createQuery();this.deferredRenderGpuTimeQueries.push(m),u.beginQuery(n.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const u={};for(const m in n){const y=n[m],b=this.context.extTimerQuery,w=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),u[m]=w}return u}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.gl;let m=0;for(const y of n)m+=u.getQueryParameter(y,u.QUERY_RESULT)/1e6,u.deleteQuery(y);return m}translatePosMatrix(n,u,m,y,b){if(!m[0]&&!m[1])return n;const w=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(w){const L=Math.sin(w),R=Math.cos(w);m=[m[0]*R-m[1]*L,m[0]*L+m[1]*R]}const E=[b?m[0]:s.ay(u,m[0],this.transform.zoom),b?m[1]:s.ay(u,m[1],this.transform.zoom),0],I=new Float32Array(16);return s.br(I,n,E),I}saveTileTexture(n){if(n.context!==this.context)return;const u=n.size[0],m=this._tileTextures[u];m?m.push(n):this._tileTextures[u]=[n]}getTileTexture(n){const u=this._tileTextures[n];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,u,m){const y=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||u!==void 0&&!u||b.push("FOG"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,u){this.cache=this.cache||{};const m=u&&u.defines||[],y=u&&u.config,b=this.currentGlobalDefines(n,u&&u.overrideFog,u&&u.overrideRtt).concat(m),w=Hy.cacheKey(nm[n],n,b,y);return this.cache[w]||(this.cache[w]=new Hy(this.context,n,nm[n],y,Jd[n],b)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,u){if(this.style.enable3dLights()){const m=this.style.directionalLight,y=this.style.ambientLight;if(m&&y){const b=((w,E,I)=>{const L=w.properties.get("direction"),R=w.properties.get("color-use-theme")==="none",N=w.properties.get("color").toNonPremultipliedRenderColor(R?null:I.getLut(w.scope)).toArray01(),B=w.properties.get("intensity"),U=E.properties.get("color-use-theme")==="none",W=E.properties.get("color").toNonPremultipliedRenderColor(U?null:I.getLut(E.scope)).toArray01(),G=E.properties.get("intensity"),J=[L.x,L.y,L.z],K=s.dN(W,G),oe=s.dN(N,B);return{u_lighting_ambient_color:K,u_lighting_directional_dir:J,u_lighting_directional_color:oe,u_ground_radiance:ou(J,oe,K)}})(m,y,this.style);u.setLightsUniformValues(n,b)}}}uploadCommonUniforms(n,u,m,y,b){if(this.uploadCommonLightUniforms(n,u),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const E=w.getOpacity(this.transform.pitch),I=((L,R,N,B,U,W,G,J,K,oe,re,ne)=>{const be=L.transform,_e=R.properties.get("color-use-theme")==="none",ve=R.properties.get("color").toNonPremultipliedRenderColor(_e?null:L.style.getLut(R.scope)).toArray01();ve[3]=B;const pe=L.frameCounter/1e3%1,[he,Se]=R.properties.get("vertical-range");return{u_fog_matrix:N?be.calculateFogTileMatrix(N):ne||L.identityMat,u_fog_range:R.getFovAdjustedRange(be._fov),u_fog_color:ve,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,Se),Se],u_fog_temporal_offset:pe,u_frustum_tl:U,u_frustum_tr:W,u_frustum_br:G,u_frustum_bl:J,u_globe_pos:K,u_globe_radius:oe,u_viewport:re,u_globe_transition:s.aj(be.zoom),u_is_globe:+(be.projection.name==="globe")}})(this,w,m,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],y);u.setFogUniformValues(n,I)}b&&u.setCutoffUniformValues(n,b.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,u=n.createTexture();return n.bindTexture(n.TEXTURE_2D,u),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,u=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)u[y.key]=n[y.key]||new Pl(y,512,this.transform.tileZoom,this,void 0,this.worldview);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,u){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!u||u.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[n.key];return u||(this._cachedTileFogOpacities[n.key]=u=this.style.fog.getOpacityForTile(n)),u[0]>=Ft||u[1]>=Ft}setupDepthForOcclusion(n,u,m){const y=this.context,b=y.gl,w=!!m;var E;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),w||u.setTerrainUniformValues(y,m)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const n=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=n?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function wv(p,n){let u=!1,m=null;const y=()=>{m=null,u&&(p(),m=setTimeout(y,n),u=!1)};return()=>(u=!0,m||y(),m)}class Vo{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wv(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const u=Sv(n);if(this._hashName){const m=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map(w=>{const E=w.split("=")[0];return E===m?(y=!0,`${E}=${u}`):w}).filter(w=>w);return y||b.push(`${m}=${u}`),`#${b.join("&")}`}return`#${u}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let u;return n.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(m=>isNaN(Number(m)))){const m=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(u[3]||0):n.getBearing();return n.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Sv(p,n){const u=p.getCenter(),m=Math.round(100*p.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),w=Math.round(u.lng*b)/b,E=Math.round(u.lat*b)/b,I=p.getBearing(),L=p.getPitch();let R=n?`/${w}/${E}/${m}`:`${m}/${E}/${w}`;return(I||L)&&(R+="/"+Math.round(10*I)/10),L&&(R+=`/${Math.round(L)}`),R}const Hl={linearity:.3,easing:s.eT(0,0,.3,1)},Bw=Object.assign({deceleration:2500,maxSpeed:1400},Hl),Zn=Object.assign({deceleration:20,maxSpeed:1400},Hl),Ki=Object.assign({deceleration:1e3,maxSpeed:360},Hl),Tv=Object.assign({deceleration:1e3,maxSpeed:90},Hl);class Zl{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,u=s.o.now();for(;n.length>0&&u-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(u.pan.mag()){const b=fl(u.pan.mag(),m,Object.assign({},Bw,n||{}));y.offset=u.pan.mult(b.amount/u.pan.mag()),y.center=this._map.transform.center,dl(y,b)}if(u.zoom){const b=fl(u.zoom,m,Zn);y.zoom=this._map.transform.zoom+b.amount,dl(y,b)}if(u.bearing){const b=fl(u.bearing,m,Ki);y.bearing=this._map.transform.bearing+s.aA(b.amount,-179,179),dl(y,b)}if(u.pitch){const b=fl(u.pitch,m,Tv);y.pitch=this._map.transform.pitch+b.amount,dl(y,b)}if(y.zoom||y.bearing){const b=u.pinchAround===void 0?u.around:u.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function dl(p,n){(!p.duration||p.duration<n.duration)&&(p.duration=n.duration,p.easing=n.easing)}function fl(p,n,u){const{maxSpeed:m,linearity:y,deceleration:b}=u,w=s.aA(p*y/(n/1e3),-m,m),E=Math.abs(w)/(b*y);return{easing:u.easing,duration:1e3*E,amount:w*(E/2)}}class yo extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,m,y={}){const b=At(u.getCanvasContainer(),m),w=u.unproject(b);super(n,Object.assign({point:b,lngLat:w,originalEvent:m},y)),this._defaultPrevented=!1,this.target=u}}class fu extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,m){const y=n==="touchend"?m.changedTouches:m.touches,b=ft(u.getCanvasContainer(),y),w=b.map(I=>u.unproject(I)),E=b.reduce((I,L,R,N)=>I.add(L.div(N.length)),new s.P(0,0));super(n,{points:b,point:E,lngLats:w,lngLat:u.unproject(E),originalEvent:m}),this._defaultPrevented=!1}}class Wm extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class qm{constructor(n,u){this._map=n,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Wm(this._map,n))}mousedown(n,u){return this._mousedownPos=u,this._firePreventable(new yo(n.type,this._map,n))}mouseup(n){this._map.fire(new yo(n.type,this._map,n))}preclick(n){const u=new MouseEvent("preclick",n);this._map.fire(new yo(u.type,this._map,u))}click(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(n),this._map.fire(new yo(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new yo(n.type,this._map,n))}mouseover(n){this._map.fire(new yo(n.type,this._map,n))}mouseout(n){this._map.fire(new yo(n.type,this._map,n))}touchstart(n){return this._firePreventable(new fu(n.type,this._map,n))}touchmove(n){this._map.fire(new fu(n.type,this._map,n))}touchend(n){this._map.fire(new fu(n.type,this._map,n))}touchcancel(n){this._map.fire(new fu(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xm{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new yo(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new yo(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ra{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(Ue(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(n,u){if(!this._active)return;const m=u,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(m)||!this._box&&m.dist(y)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const w=Math.min(y.x,m.x),E=Math.max(y.x,m.x),I=Math.min(y.y,m.y),L=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${I}px)`,this._box.style.width=E-w+"px",this._box.style.height=L-I+"px")})}mouseupWindow(n,u){if(!this._active)return;const m=this._startPos,y=u;if(m&&n.button===0){if(this.reset(),Ye(),m.x!==y.x||m.y!==y.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ne(),delete this._startPos,delete this._lastPos}_fireEvent(n,u){return this._map.fire(new s.z(n,{originalEvent:u}))}}function Oa(p,n){const u={};for(let m=0;m<p.length;m++)u[p[m].identifier]=n[m];return u}class pu{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=(function(y){const b=new s.P(0,0);for(const w of y)b._add(w);return b.div(y.length)})(u),this.touches=Oa(m,u)))}touchmove(n,u,m){if(this.aborted||!this.centroid)return;const y=Oa(m,u);for(const b in this.touches){const w=y[b];(!w||w.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,u,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class mu{constructor(n){this.singleTap=new pu(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,u,m){this.singleTap.touchstart(n,u,m)}touchmove(n,u,m){this.singleTap.touchmove(n,u,m)}touchend(n,u,m){const y=this.singleTap.touchend(n,u,m);if(y){const b=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(y)<30;if(b&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Jm{constructor(){this._zoomIn=new mu({numTouches:1,numTaps:2}),this._zoomOut=new mu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,u,m){this._zoomIn.touchstart(n,u,m),this._zoomOut.touchstart(n,u,m)}touchmove(n,u,m){this._zoomIn.touchmove(n,u,m),this._zoomOut.touchmove(n,u,m)}touchend(n,u,m){const y=this._zoomIn.touchend(n,u,m),b=this._zoomOut.touchend(n,u,m);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(y)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ym=0,Wl=2,Km={[Ym]:1,[Wl]:2},Os={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Ph{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,u){return!1}_move(n,u){return{}}mousedown(n,u){if(this._lastPoint)return;const m=wt(n);this._correctButton(n,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(n,u){const m=this._lastPoint;if(m){if(n.preventDefault(),this._eventButton!=null&&(function(y,b){const w=Km[b];return y.buttons===void 0||(y.buttons&w)!==w})(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}}mouseupWindow(n){this._lastPoint&&wt(n)===this._eventButton&&(this._moved&&Ye(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sf extends Ph{mousedown(n,u){super.mousedown(n,u),this._lastPoint&&(this._active=!0)}_correctButton(n,u){return u===0&&!n.ctrlKey}_move(n,u){return{around:u,panDelta:u.sub(n)}}}class af extends Ph{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Os[n.pitchRotateKey]:void 0}_correctButton(n,u){return this._pitchRotateKey?u===0&&n[this._pitchRotateKey]:u===0&&n.ctrlKey||u===2}_move(n,u){const m=.8*(u.x-n.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class lf extends Ph{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Os[n.pitchRotateKey]:void 0}_correctButton(n,u){return this._pitchRotateKey?u===0&&n[this._pitchRotateKey]:u===0&&n.ctrlKey||u===2}_move(n,u){const m=-.5*(u.y-n.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Hr{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,u,m){return this._calculateTransform(n,u,m)}touchmove(n,u,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!s.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,u,m)}}touchend(n,u,m){this._calculateTransform(n,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,u,m){m.length>0&&(this._active=!0);const y=Oa(m,u),b=new s.P(0,0),w=new s.P(0,0);let E=0;for(const L in y){const R=y[L],N=this._touches[L];N&&(b._add(R),w._add(R.sub(N)),E++,y[L]=R)}if(this._touches=y,E<this._minTouches||!w.mag())return;const I=w.div(E);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(E),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class zh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,u,m){return{}}touchstart(n,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(n,u,m){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[b,w]=y,E=gu(m,u,b),I=gu(m,u,w);if(!E||!I)return;const L=this._aroundCenter?null:E.add(I).div(2);return this._move([E,I],L,n)}touchend(n,u,m){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,w=gu(m,u,y),E=gu(m,u,b);w&&E||(this._active&&Ye(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function gu(p,n,u){for(let m=0;m<p.length;m++)if(p[m].identifier===u)return n[m]}function cf(p,n){return Math.log2(p/n)}class Sc extends zh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,u){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(cf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:cf(this._distance,m),pinchAround:u}}}function uf(p,n){return 180*p.angleWith(n)/Math.PI}class Qm extends zh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,u){const m=this._vector;if(this._vector=n[0].sub(n[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:uf(this._vector,m),pinchAround:u}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const u=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const y=uf(n,m);return Math.abs(y)<u}}function Ch(p){return Math.abs(p.y)>Math.abs(p.x)}class Tc extends zh{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Ch(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,u,m){const y=this._lastPoints;if(!y)return;const b=n[0].sub(y[0]),w=n[1].sub(y[1]);return this._map._cooperativeGestures&&!s.eU()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(b,w,m.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+w.y)/2*-.5})}gestureBeginsVertically(n,u,m){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,b=u.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const w=n.y>0==u.y>0;return Ch(n)&&Ch(u)&&w}}const eg={panStep:100,bearingStep:15,pitchStep:10};class Lh{constructor(){const n=eg;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let u=0,m=0,y=0,b=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:E=>{const I=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:tg,zoom:u?Math.round(I)+u*(n.shiftKey?2:1):I,bearing:E.getBearing()+m*this._bearingStep,pitch:E.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function tg(p){return p*(2-p)}const Rh=4.000244140625,ig=1/450;class hf{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ig,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=s.o.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,u!==0&&u%Rh===0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=u,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=At(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Rh?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&R!==0&&(R=1/R);const N=u(),B=Math.pow(2,N),U=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(U*R))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:u(),y=this._startZoom,b=this._easing;let w,E=!1;if(this._type==="wheel"&&y&&b){const L=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),R=b(L);w=s.ak(y,m,R),L<1?this._frameId||(this._frameId=!0):E=!0}else w=m,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=w-u();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let u=s.eV;if(this._prevEase){const m=this._prevEase,y=(s.o.now()-m.start)/m.duration,b=m.easing(y+.01)-m.easing(y),w=.27/Math.sqrt(b*b+1e-4)*.01,E=Math.sqrt(.0729-w*w);u=s.eT(w,E,.25,1)}return this._prevEase={start:s.o.now(),duration:n,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ev{constructor(n,u){this._clickZoom=n,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Iv{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,u){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(n.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mv{constructor(){this._tap=new mu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,u,m){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(n,u,m))}touchmove(n,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=u[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,u,m)}touchend(n,u,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(n,u,m)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Av{constructor(n,u,m){this._el=n,this._mousePan=u,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pv{constructor(n,u,m){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zv{constructor(n,u,m,y){this._el=n,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Dh=p=>p.zoom||p.drag||p.pitch||p.rotate;class Cv extends s.z{}class Lv{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,u){const m=s.av([],u,n);this.radius=s.ag(m[2]<0?s.eX([],m,this.constants):[m[0],m[1],0])}projectRay(n){s.eX(n,n,this.constants),s.aw(n,n),s.eY(n,n,this.constants);const u=s.c5([],n,this.radius);if(u[2]>0){const m=s.c5([],[0,0,1],s.bJ(u,[0,0,1])),y=s.c5([],s.aw([],[u[0],u[1],0]),this.radius),b=s.d8([],u,s.c5([],s.av([],s.d8([],y,m),u),2));u[0]=b[0],u[1]=b[1]}return u}}function kh(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Rv{constructor(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zl(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Lv,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),s.aY(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,w]of this._listeners){const E=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,E,w)}}destroy(){for(const[n,u,m]of this._listeners){const y=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(u,y,m)}}_addDefaultHandlers(n){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new qm(u,n));const y=u.boxZoom=new ra(u,n);this._add("boxZoom",y);const b=new Jm,w=new Iv;u.doubleClickZoom=new Ev(w,b),this._add("tapZoom",b),this._add("clickZoom",w);const E=new Mv;this._add("tapDragZoom",E);const I=u.touchPitch=new Tc(u);this._add("touchPitch",I);const L=new af(n),R=new lf(n);u.dragRotate=new Pv(n,L,R),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const N=new sf(n),B=new Hr(u,n);u.dragPan=new Av(m,N,B),this._add("mousePan",N),this._add("touchPan",B,["touchZoom","touchRotate"]);const U=new Qm,W=new Sc;u.touchZoomRotate=new zv(m,W,U,E),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Xm(u));const G=u.scrollZoom=new hf(u,this);this._add("scrollZoom",G,["mousePan"]);const J=u.keyboard=new Lh;this._add("keyboard",J);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[K]&&u[K].enable(n[K])}_add(n,u,m){this._handlers.push({handlerName:n,handler:u,allowed:m}),this._handlersById[n]=u}stop(n){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,u,m){for(const y in n)if(y!==m&&(!u||u.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const u=[];for(const m of n)this._el.contains(m.target)&&u.push(m);return u}handleEvent(n,u){this._updatingCamera=!0;const m=n.type==="renderFrame",y=m?void 0:n,b={needsRenderFrame:!1},w={},E={},I=n.touches?this._getMapTouches(n.touches):void 0,L=I?ft(this._el,I):m?void 0:At(this._el,n);for(const{handlerName:B,handler:U,allowed:W}of this._handlers){if(!U.isEnabled())continue;let G;this._blockedByActive(E,W,B)?U.reset():U[u||n.type]&&(G=U[u||n.type](n,L,I),this.mergeHandlerResult(b,w,G,B,y),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||U.isActive())&&(E[B]=U)}const R={};for(const B in this._previousActiveHandlers)E[B]||(R[B]=y);this._previousActiveHandlers=E,(Object.keys(R).length||kh(b))&&(this._changes.push([b,w,R]),this._triggerRenderFrame()),(Object.keys(E).length||kh(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=b;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(n,u,m,y,b){if(!m)return;Object.assign(n,m);const w={handlerName:y,originalEvent:m.originalEvent||b};m.zoomDelta!==void 0&&(u.zoom=w),m.panDelta!==void 0&&(u.drag=w),m.pitchDelta!==void 0&&(u.pitch=w),m.bearingDelta!==void 0&&(u.rotate=w)}_applyChanges(){const n={},u={},m={};for(const[y,b,w]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),Object.assign(u,b),Object.assign(m,w);this._updateMapTransform(n,u,m),this._changes=[]}_updateMapTransform(n,u,m){const y=this._map,b=y.transform,w=oe=>[oe.x,oe.y,oe.z];if((()=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!kh(n)){const oe=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),oe!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!kh(n))return void this._fireEvents(u,m,!0);let{panDelta:E,zoomDelta:I,bearingDelta:L,pitchDelta:R,around:N,aroundCoord:B,pinchAround:U}=n;b._isCameraConstrained&&(I>0&&(I=0),b._isCameraConstrained=!1),U!==void 0&&(N=U),(I||(oe=>u[oe]&&!this._eventsInProgress[oe])("drag"))&&N&&(this._dragOrigin=w(b.pointCoordinate3D(N)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),N=N||y.transform.centerPoint,L&&(b.bearing+=L),R&&(b.pitch+=R),b._updateCameraState();const W=[0,0,0];if(E)if(b.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N).dir),re=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N.sub(E)).dir);W[0]=re[0]-oe[0],W[1]=re[1]-oe[1]}else{const oe=b.pointCoordinate(N);if(b.projection.name==="globe"){E=E.rotate(-b.angle);const re=b._pixelsPerMercatorPixel/b.worldSize;W[0]=-E.x*s.eW(s.a$(oe.y))*re,W[1]=-E.y*s.eW(b.center.lat)*re}else{const re=b.pointCoordinate(N.sub(E));oe&&re&&(W[0]=re.x-oe.x,W[1]=re.y-oe.y)}}const G=b.zoom,J=[0,0,0];if(I){const oe=w(B||b.pointCoordinate3D(N)),re={dir:s.aw([],s.av([],oe,b._camera.position))};if(re.dir[2]<0){const ne=b.zoomDeltaToMovement(oe,I);s.c5(J,re.dir,ne)}}const K=s.d8(W,W,J);b._translateCameraConstrained(K),I&&Math.abs(b.zoom-G)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,m,!0)}_fireEvents(n,u,m){const y=Dh(this._eventsInProgress),b=Dh(n),w={};for(const R in n){const{originalEvent:N}=n[R];this._eventsInProgress[R]||(w[`${R}start`]=N),this._eventsInProgress[R]=n[R]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const R in w)this._fireEvent(R,w[R]);b&&this._fireEvent("move",b.originalEvent);for(const R in n){const{originalEvent:N}=n[R];this._fireEvent(R,N)}const E={};let I;for(const R in this._eventsInProgress){const{handlerName:N,originalEvent:B}=this._eventsInProgress[R];this._handlersById[N].isActive()||(delete this._eventsInProgress[R],I=u[N]||B,E[`${R}end`]=I)}for(const R in E)this._fireEvent(R,E[R]);const L=Dh(this._eventsInProgress);if(m&&(y||b)&&!L){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;R?(N(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:I})):(this._map.fire(new s.z("moveend",{originalEvent:I})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,u){this._map.fire(new s.z(n,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Cv("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ng="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Dv extends s.E{constructor(n,u){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(n,u){return this.jumpTo({center:n},u)}panBy(n,u,m){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},u),m)}panTo(n,u,m){return this.easeTo(Object.assign({center:n},u),m)}getZoom(){return this.transform.zoom}setZoom(n,u){return this.jumpTo({zoom:n},u),this}zoomTo(n,u,m){return this.easeTo(Object.assign({zoom:n},u),m)}zoomIn(n,u){return this.zoomTo(this.getZoom()+1,n,u),this}zoomOut(n,u){return this.zoomTo(this.getZoom()-1,n,u),this}getBearing(){return this.transform.bearing}setBearing(n,u){return this.jumpTo({bearing:n},u),this}getPadding(){return this.transform.padding}setPadding(n,u){return this.jumpTo({padding:n},u),this}rotateTo(n,u,m){return this.easeTo(Object.assign({bearing:n},u),m)}resetNorth(n,u){return this.rotateTo(0,Object.assign({duration:1e3},n),u),this}resetNorthPitch(n,u){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),u),this}snapToNorth(n,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,u):this}getPitch(){return this.transform.pitch}setPitch(n,u){return this.jumpTo({pitch:n},u),this}cameraForBounds(n,u){n=s.aI.convert(n);const m=u&&u.bearing||0,y=u&&u.pitch||0,b=n.getNorthWest(),w=n.getSouthEast();return this._cameraForBounds(this.transform,b,w,m,y,u)}_extendPadding(n){const u={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},u,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},u,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,u){const m=u.max[0]-u.min[0],y=u.max[1]-u.min[1];return m/y>n.aspect?m/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,u,m,y,b,w){const E=n.clone(),I=this._extendCameraOptions(w);E.bearing=y,E.pitch=b;const L=s.aT.convert(u),R=s.aT.convert(m),N=.5*(L.lat+R.lat),B=.5*(L.lng+R.lng),U=s.eZ(N,B),W=s.aw([],U),G=s.aw([],s.bI([],W,[0,1,0])),J=s.bI([],G,W),K=[G[0],G[1],G[2],0,J[0],J[1],J[2],0,W[0],W[1],W[2],0,0,0,0,1],oe=[U,s.eZ(L.lat,L.lng),s.eZ(R.lat,L.lng),s.eZ(R.lat,R.lng),s.eZ(L.lat,R.lng),s.eZ(N,L.lng),s.eZ(N,R.lng),s.eZ(L.lat,B),s.eZ(R.lat,B)];let re=s.d9.fromPoints(oe.map(We=>[s.bJ(G,We),s.bJ(J,We),s.bJ(W,We)]));const ne=s.af([],re.center,K);s.e_(ne)===0&&s.e$(ne,0,0,1),s.aw(ne,ne),s.c5(ne,ne,s.aD),E.center=s.f0(ne);const be=E.getWorldToCameraMatrix(),_e=s.bl(new Float64Array(16),be);re=s.d9.applyTransform(re,s.aB([],be,K));const ve=this._extendAABB(re,E,I,y);if(!ve)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=ve,s.af(ne,ne,be);const pe=.5*(re.max[2]-re.min[2]),he=this._minimumAABBFrustumDistance(E,re),Se=s.c5([],[0,0,1],pe),ze=s.d8(Se,ne,Se),Re=he+(E.pitch===0?0:s.bG(ne,ze)),Ze=E.globeCenterInViewSpace,je=s.av([],ne,[Ze[0],Ze[1],Ze[2]]);s.aw(je,je),s.c5(je,je,Re);const it=s.d8([],ne,je);s.af(it,it,_e);const dt=s.eM/s.aD,Fe=s.ag(it),Te=s.cf(Math.max(Fe*dt-s.eM,Number.EPSILON),0),Ke=Math.min(E.zoomFromMercatorZAdjusted(Te),I.maxZoom);return Ke>.5*(s.c_+s.cL)?(E.setProjection({name:"mercator"}),E.zoom=Ke,this._cameraForBounds(E,u,m,y,b,w)):{center:E.center,zoom:Ke,bearing:y,pitch:b}}_extendAABB(n,u,m,y){const b=.5*((m.padding.left||0)+(m.padding.right||0)),w=.5*((m.padding.top||0)+(m.padding.bottom||0)),E=w,I=b,L=b,R=w,N=u.width-(I+L),B=u.height-(E+R),U=s.av([],n.max,n.min),W=Math.min(N/U[0],B/U[1]),G=Math.min(u.scaleZoom(u.scale*W),m.maxZoom);if(isNaN(G))return null;const J=u.scale/u.zoomScale(G),K=new s.d9([n.min[0]-I*J,n.min[1]-R*J,n.min[2]],[n.max[0]+L*J,n.max[1]+E*J,n.max[2]]),oe=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new s.P(m.offset.x,m.offset.y):s.P.convert(m.offset)).rotate(-s.an(y));return K.center[0]-=oe.x*J,K.center[1]+=oe.y*J,K}queryTerrainElevation(n,u){const m=this.transform.elevation;return m?(u=Object.assign({},{exaggerated:!0},u),m.getAtPoint(s.ae.fromLngLat(n),null,u.exaggerated)):null}_cameraForBounds(n,u,m,y,b,w){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,u,m,y,b,w);const E=n.clone(),I=this._extendCameraOptions(w);E.bearing=y,E.pitch=b;const L=s.aT.convert(u),R=s.aT.convert(m),N=new s.aT(L.lng,R.lat),B=new s.aT(R.lng,L.lat),U=E.project(L),W=E.project(R),G=this.queryTerrainElevation(L),J=this.queryTerrainElevation(R),K=this.queryTerrainElevation(N),oe=this.queryTerrainElevation(B),re=[[U.x,U.y,Math.min(G||0,J||0,K||0,oe||0)],[W.x,W.y,Math.max(G||0,J||0,K||0,oe||0)]];let ne=s.d9.fromPoints(re);const be=E.getWorldToCameraMatrix(),_e=s.bl(new Float64Array(16),be);ne=s.d9.applyTransform(ne,be);const ve=this._extendAABB(ne,E,I,y);if(!ve)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=ve;const pe=.5*s.av([],ne.max,ne.min)[2],he=this._minimumAABBFrustumDistance(E,ne),Se=[0,0,1,0];s.aC(Se,Se,be),s.f1(Se,Se);const ze=s.c5([],Se,he+pe),Re=s.d8([],ne.center,ze);s.af(ne.center,ne.center,_e),s.af(Re,Re,_e);const Ze=E.unproject(new s.P(ne.center[0],ne.center[1])),je=s.f2(E.projection,Ze),it=Math.pow(2,je),dt=Math.min(E._zoomFromMercatorZ(Re[2]*E.pixelsPerMeter*it/E.worldSize),I.maxZoom);return E.mercatorFromTransition&&dt<.5*(s.c_+s.cL)?(E.setProjection({name:"globe"}),E.zoom=dt,this._cameraForBounds(E,u,m,y,b,w)):{center:Ze,zoom:dt,bearing:y,pitch:b}}fitBounds(n,u,m){const y=this.cameraForBounds(n,u);return this._fitInternal(y,u,m)}fitScreenCoordinates(n,u,m,y,b){const w=s.P.convert(n),E=s.P.convert(u),I=new s.P(Math.min(w.x,E.x),Math.min(w.y,E.y)),L=new s.P(Math.max(w.x,E.x),Math.max(w.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,E))return this;const R=this.transform.pointLocation3D(I),N=this.transform.pointLocation3D(L),B=this.transform.pointLocation3D(new s.P(I.x,L.y)),U=this.transform.pointLocation3D(new s.P(L.x,I.y)),W=[Math.min(R.lng,N.lng,B.lng,U.lng),Math.min(R.lat,N.lat,B.lat,U.lat)],G=[Math.max(R.lng,N.lng,B.lng,U.lng),Math.max(R.lat,N.lat,B.lat,U.lat)],J=y&&y.pitch?y.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,W,G,m,J,y);return this._fitInternal(K,y,b)}_fitInternal(n,u,m){return n?(u=Object.assign(n,u)).linear?this.easeTo(u,m):this.flyTo(u,m):this}jumpTo(n,u){this.stop();const m=n.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,w=!1;"zoom"in n&&m.zoom!==+n.zoom&&(y=!0,m.zoom=+n.zoom),n.center!==void 0&&(m.center=s.aT.convert(n.center)),"bearing"in n&&m.bearing!==+n.bearing&&(b=!0,m.bearing=+n.bearing),"pitch"in n&&m.pitch!==+n.pitch&&(w=!0,m.pitch=+n.pitch);const E=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!m.isPaddingEqual(E))if(n.retainPadding===!1){const I=m.clone();I.padding=E,m.setLocationAtPoint(m.center,I.centerPoint)}else m.padding=E;return n.preloadOnly?(this._preloadTiles(m),this):(this.fire(new s.z("movestart",u)).fire(new s.z("move",u)),y&&this.fire(new s.z("zoomstart",u)).fire(new s.z("zoom",u)).fire(new s.z("zoomend",u)),b&&this.fire(new s.z("rotatestart",u)).fire(new s.z("rotate",u)).fire(new s.z("rotateend",u)),w&&this.fire(new s.z("pitchstart",u)).fire(new s.z("pitch",u)).fire(new s.z("pitchend",u)),this.fire(new s.z("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(ng),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,u){const m=this.transform;if(!m.projection.supportsFreeCamera)return s.w(ng),this;this.stop();const y=m.zoom,b=m.pitch,w=m.bearing;m.setFreeCameraOptions(n);const E=y!==m.zoom,I=b!==m.pitch,L=w!==m.bearing;return this.fire(new s.z("movestart",u)).fire(new s.z("move",u)),E&&this.fire(new s.z("zoomstart",u)).fire(new s.z("zoom",u)).fire(new s.z("zoomend",u)),L&&this.fire(new s.z("rotatestart",u)).fire(new s.z("rotate",u)).fire(new s.z("rotateend",u)),I&&this.fire(new s.z("pitchstart",u)).fire(new s.z("pitch",u)).fire(new s.z("pitchend",u)),this.fire(new s.z("moveend",u)),this}easeTo(n,u){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:s.eV},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const m=this.transform,y=this.getZoom(),b=this.getBearing(),w=this.getPitch(),E=this.getPadding(),I="zoom"in n?+n.zoom:y,L="bearing"in n?this._normalizeBearing(n.bearing,b):b,R="pitch"in n?+n.pitch:w,N=this._extendPadding(n.padding),B=s.P.convert(n.offset);let U,W,G;if(m.projection.name==="globe"){const Se=s.ae.fromLngLat(m.center),ze=B.rotate(-m.angle);Se.x+=ze.x/m.worldSize,Se.y+=ze.y/m.worldSize;const Re=Se.toLngLat(),Ze=s.aT.convert(n.center||Re);this._normalizeCenter(Ze),U=m.centerPoint.add(ze),W=new s.P(Se.x,Se.y).mult(m.worldSize),G=new s.P(s.aF(Ze.lng),s.aJ(Ze.lat)).mult(m.worldSize).sub(W)}else{U=m.centerPoint.add(B);const Se=m.pointLocation(U),ze=s.aT.convert(n.center||Se);this._normalizeCenter(ze),W=m.project(Se),G=m.project(ze).sub(W)}const J=m.zoomScale(I-y);let K,oe;n.around&&(K=s.aT.convert(n.around),oe=m.locationPoint(K));const re=this._zooming||I!==y,ne=this._rotating||b!==L,be=this._pitching||R!==w,_e=!m.isPaddingEqual(N),ve=n.retainPadding===!1?m.clone():m,pe=Se=>ze=>{if(re&&(Se.zoom=s.ak(y,I,ze)),ne&&(Se.bearing=s.ak(b,L,ze)),be&&(Se.pitch=s.ak(w,R,ze)),_e&&(ve.interpolatePadding(E,N,ze),U=ve.centerPoint.add(B)),K)Se.setLocationAtPoint(K,oe);else{const Re=Se.zoomScale(Se.zoom-y),Ze=I>y?Math.min(2,J):Math.max(.5,J),je=Math.pow(Ze,1-ze),it=Se.unproject(W.add(G.mult(ze*je)).mult(Re));Se.setLocationAtPoint(Se.renderWorldCopies?it.wrap():it,U)}return n.preloadOnly||this._fireMoveEvents(u),Se};if(n.preloadOnly){const Se=this._emulate(pe,n.duration,m);return this._preloadTiles(Se),this}const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ne,this._pitching=be,this._padding=_e,this._easeId=n.easeId,this._prepareEase(u,n.noMoveStart,he),this._ease(pe(m),Se=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(u,Se)},n),this}_prepareEase(n,u,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||m.moving||this.fire(new s.z("movestart",n)),this._zooming&&!m.zooming&&this.fire(new s.z("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new s.z("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new s.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.z("move",n)),this._zooming&&this.fire(new s.z("zoom",n)),this._rotating&&this.fire(new s.z("rotate",n)),this._pitching&&this.fire(new s.z("pitch",n))}_afterEase(n,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new s.z("zoomend",n)),y&&this.fire(new s.z("rotateend",n)),b&&this.fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n))}flyTo(n,u){if(this._prefersReducedMotion(n)){const We=s.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(We,u)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eV},n);const m=this.transform,y=this.getZoom(),b=this.getBearing(),w=this.getPitch(),E=this.getPadding(),I="zoom"in n?s.aA(+n.zoom,m.minZoom,m.maxZoom):y,L="bearing"in n?this._normalizeBearing(n.bearing,b):b,R="pitch"in n?+n.pitch:w,N=this._extendPadding(n.padding),B=m.zoomScale(I-y),U=s.P.convert(n.offset);let W=m.centerPoint.add(U);const G=m.pointLocation(W),J=s.aT.convert(n.center||G);this._normalizeCenter(J);const K=m.project(G),oe=m.project(J).sub(K);let re=n.curve;const ne=Math.max(m.width,m.height),be=ne/B,_e=oe.mag();if("minZoom"in n){const We=s.aA(Math.min(n.minZoom,y,I),m.minZoom,m.maxZoom),pt=ne/m.zoomScale(We-y);re=Math.sqrt(pt/_e*2)}const ve=re*re;function pe(We){const pt=(be*be-ne*ne+(We?-1:1)*ve*ve*_e*_e)/(2*(We?be:ne)*ve*_e);return Math.log(Math.sqrt(pt*pt+1)-pt)}function he(We){return(Math.exp(We)-Math.exp(-We))/2}function Se(We){return(Math.exp(We)+Math.exp(-We))/2}const ze=pe(0);let Re=function(We){return Se(ze)/Se(ze+re*We)},Ze=function(We){return ne*((Se(ze)*(he(pt=ze+re*We)/Se(pt))-he(ze))/ve)/_e;var pt},je=(pe(1)-ze)/re;if(Math.abs(_e)<1e-6||!isFinite(je)){if(Math.abs(ne-be)<1e-6)return this.easeTo(n,u);const We=be<ne?-1:1;je=Math.abs(Math.log(be/ne))/re,Ze=function(){return 0},Re=function(pt){return Math.exp(We*re*pt)}}n.duration="duration"in n?+n.duration:1e3*je/("screenSpeed"in n?+n.screenSpeed/re:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const it=b!==L,dt=R!==w,Fe=!m.isPaddingEqual(N),Te=n.retainPadding===!1?m.clone():m,Ke=We=>pt=>{const vt=pt*je,Pt=1/Re(vt);We.zoom=pt===1?I:y+We.scaleZoom(Pt),it&&(We.bearing=s.ak(b,L,pt)),dt&&(We.pitch=s.ak(w,R,pt)),Fe&&(Te.interpolatePadding(E,N,pt),W=Te.centerPoint.add(U));const xt=pt===1?J:We.unproject(K.add(oe.mult(Ze(vt))).mult(Pt));return We.setLocationAtPoint(We.renderWorldCopies?xt.wrap():xt,W),We._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(u),We};if(n.preloadOnly){const We=this._emulate(Ke,n.duration,m);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=it,this._pitching=dt,this._padding=Fe,this._prepareEase(u,!1),this._ease(Ke(m),()=>this._afterEase(u),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,u)}if(!n){const m=this.handlers;m&&m.stop(!1)}return this}_ease(n,u,m){m.animate===!1||m.duration===0?(n(1),u()):(this._easeStart=s.o.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,u){n=s.bT(n,-180,180);const m=Math.abs(n-u);return Math.abs(n-360-u)<m&&(n-=360),Math.abs(n+360-u)<m&&(n+=360),n}_normalizeCenter(n){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const m=n.lng-u.center.lng;n.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,u,m){const y=Math.ceil(15*u/1e3),b=[],w=n(m.clone());for(let E=0;E<=y;E++){const I=w(E/y);b.push(I.clone())}return b}_preloadTiles(n,u){}}class kv{constructor(n={}){this.options=n,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const u=this.options&&this.options.compact,m=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=se("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const y=se("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",m),this._innerContainer=se("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(n){const m=u.reduce((y,b,w)=>(b.value&&(y+=`${b.key}=${b.value}${w<u.length-1?"&":""}`),y),"?");n.href=`${s.e.FEEDBACK_URL}/${m}#${Sv(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const u=this._map.style._mergedSourceCaches;for(const y in u){const b=u[y];if(b.used){const w=b.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((y,b)=>y.length-b.length),n=n.filter((y,b)=>{for(let w=b+1;w<n.length;w++)if(n[w].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const m=n.map(y=>(function(b){const w=new DOMParser().parseFromString(b,"text/html");return Array.from(w.body.querySelectorAll("*")).reverse().forEach(E=>{const I=E.textContent||"";if(E.tagName!=="A")return void E.replaceWith(...E.childNodes);const L=E.getAttribute("href");if(!L||!/^(https?:|mailto:)/i.test(L))return void E.replaceWith(w.createTextNode(I));const R=w.createElement("a");R.href=L,R.textContent=I,R.rel="noopener nofollow";const N=E.getAttribute("class");N&&(R.className=N),E.replaceWith(R)}),w.body.innerHTML})(y)).join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ov{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=se("div","mapboxgl-ctrl");const u=se("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const u in n){const m=n[u].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Fv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u}remove(n){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const y of m)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class er{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const u=s.dD((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,u,m){this._start=this.getValue(u),this._end=n,this._startTime=u,this._endTime=u+m}}const Bv={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use âŒ˜ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Nv extends s.z{constructor(n,u,m,y){const{point:b,lngLat:w,originalEvent:E,target:I}=n;super(n.type,{point:b,lngLat:w,originalEvent:E,target:I}),this.preventDefault=()=>{n.preventDefault()},this.id=u,this.interaction=m,this.feature=y}}class Nw{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,u){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const m=u.filter;let y=u.type;m&&this.filters.set(n,s.b6(m)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,u)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(n,u),this.typeById.set(n,y)}get(n){const u=this.typeById.get(n);if(!u)return;const m=this.interactionsByType.get(u);return m?m.get(n):void 0}remove(n){const u=this.typeById.get(n);if(!u)return;this.typeById.delete(n),this.filters.delete(n);const m=this.interactionsByType.get(u);m&&(m.delete(n),u==="mouseenter"||u==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):m.size===0&&this.map.off(u,this.handleType))}queryTargets(n,u){const m=[];for(const[y,b]of u)b.target&&m.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(n,m,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const u=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());u.length&&(n.type="mouseenter",this.handleType(n,u));const m=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||m.set(b.id,b);m.size&&(n.type="mouseleave",this.handleType(n,Array.from(m.values())))}handleOut(n){const u=Array.from(this.hoveredFeatures.values()).map(({feature:m})=>m);u.length&&(n.type="mouseleave",this.handleType(n,u)),this.hoveredFeatures.clear()}handleType(n,u){const m=n.type==="mouseenter";if(m&&!this.interactionsByType.has(n.type))return void s.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(n.type)).reverse(),b=!!u;u=u||this.queryTargets(n.point,y);let w=!1;const E=new Set;for(const I of u){for(const[L,R]of y){if(!R.target)continue;const N=I.variants?I.variants[L]:null;if(N){for(const B of N){if(Ku(B,I,E,L))continue;const U=new s.dx(I,B),W=Cs(B,I,L);b&&U.id!==void 0&&(U.state=this.map.getFeatureState(U));const G=m?this.prevHoveredFeatures.get(W):null,J=new Nv(n,L,R,U),K=G?G.stop:R.handler(J);if(m&&this.hoveredFeatures.set(W,{feature:I,stop:K}),K!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[I,L]of y){const{handler:R,target:N}=L;if(!N&&R(new Nv(n,I,L,null))!==!1)break}}}function Uw(p,n){if(Array.isArray(p)&&Array.isArray(n)){const u=new Set(p),m=new Set(n);return u.size===m.size&&p.every(y=>m.has(y))}return s.by(p,n)}const Oh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Uv={showCompass:!0,showZoom:!0,visualizePitch:!1};class rg{constructor(n,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new af({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,m&&(this.mousePitch=new lf({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),Ue()}move(n,u){const m=this.map,y=this.mouseRotate.mousemoveWindow(n,u),b=y&&y.bearingDelta;if(b&&m.setBearing(m.getBearing()+b),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,u),E=w&&w.pitchDelta;E&&m.setPitch(m.getPitch()+E)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ne(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),At(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,At(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ft(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=ft(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Fh(p,n,u){if(p=new s.aT(p.lng,p.lat),n){const m=new s.aT(p.lng-360,p.lat),y=new s.aT(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-u.center.lng)/360),w=u.locationPoint3D(p).distSqr(n),E=n.x<0||n.y<0||n.x>u.width||n.y>u.height;u.locationPoint3D(m).distSqr(n)<w&&(E||Math.abs(m.lng-u.center.lng)<b)?p=m:u.locationPoint3D(y).distSqr(n)<w&&(E||Math.abs(y.lng-u.center.lng)<b)&&(p=y)}for(;Math.abs(p.lng-u.center.lng)>180;){const m=u.locationPoint3D(p);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;p.lng>u.center.lng?p.lng-=360:p.lng+=360}return p}const ga={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Fs={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class zr extends s.E{constructor(n,u){super(),(n instanceof HTMLElement||u)&&(n=Object.assign({element:n},u)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:m="center",color:y="#3FB1CE",scale:b=1,draggable:w=!1,clickTolerance:E=0,rotation:I=Fs.rotation,rotationAlignment:L=Fs.rotationAlignment,pitchAlignment:R=Fs.pitchAlignment,occludedOpacity:N=Fs.occludedOpacity,altitude:B=Fs.altitude}=n||{};this._anchor=m,this._color=y,this._scale=b,this._draggable=w,this._clickTolerance=E,this._rotation=I,this._rotationAlignment=L,this._pitchAlignment=R,this._occludedOpacity=N,this._altitude=B,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",G=>{G.preventDefault()}),this._element.addEventListener("mousedown",G=>{G.preventDefault()});const U=this._element.classList;for(const G in ga)U.remove(`mapboxgl-marker-anchor-${G}`);U.add(`mapboxgl-marker-anchor-${this._anchor}`);const W=n&&n.className?n.className.trim().split(/\s+/):[];U.add(...W),this._popup=null}_createDefaultMarker(){const n=se("div"),u=fe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const m=fe("radialGradient",{id:"shadowGradient"},fe("defs",{},u));fe("stop",{offset:"10%","stop-opacity":.4},m),fe("stop",{offset:"100%","stop-opacity":.05},m),fe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u)}return fe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),fe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),fe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.aT.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||Fs.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const u=n.code,m=n.charCode||n.keyCode;u!=="Space"&&u!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(n){const u=n.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,u=this._pos;if(!n||!u)return!1;const m=n.unproject(u,this._altitude),y=n.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(m)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const u=this._pos;if(!u||u.x<0||u.x>n.transform.width||u.y<0||u.y>n.transform.height)return void this._clearFadeTimer();const m=n.unproject(u,this._altitude);let y;n._showingGlobe()&&s.f5(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(m),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${ga[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const n=this._pos,u=this._map,m=this.getPitchAlignment();if(!u||!n||m!=="map")return"";if(!u._showingGlobe()){const I=u.getPitch();return I?`rotateX(${I}deg)`:""}const y=s.cX(s.f6(u.transform,this._lngLat)),b=n.sub(s.f7(u.transform)),w=Math.abs(b.x)+Math.abs(b.y);if(w===0)return"";const E=y/w;return`rotateX(${-b.y*E}deg) rotateY(${b.x*E}deg)`}_calculateZTransform(){const n=this._pos,u=this._map;if(!u||!n)return"";let m=0;const y=this.getRotationAlignment();if(y==="map")if(u._showingGlobe()){const b=u.project(new s.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=u.project(new s.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);m=s.cX(Math.atan2(w.y,w.x))-90}else m=-u.getBearing();else if(y==="horizon"){const b=s.ah(4,6,u.getZoom()),w=s.f7(u.transform);w.y+=b*u.transform.height;const E=n.sub(w),I=s.cX(Math.atan2(E.y,E.x));m=(I>90?I-270:I+90)*(1-b)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Fh(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const u=this._map;if(!u)return;const m=this._pointerdownPos,y=this._positionDelta;if(m&&y){if(!this._isDragging){const b=this._clickTolerance||u._clickTolerance;if(n.point.dist(m)<b)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=u.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(n){const u=this._map,m=this._pos;u&&m&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(m),this._pointerdownPos=n.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const u=this._map;return u&&(n?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||Fs.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||Fs.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||Fs.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||Fs.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},Bh={maxWidth:100,unit:"metric"},df={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},$v={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},$w=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _u(p=new s.P(0,0),n="bottom"){if(typeof p=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(n){case"top":return new s.P(0,p);case"top-left":return new s.P(u,u);case"top-right":return new s.P(-u,u);case"bottom":return new s.P(0,-p);case"bottom-left":return new s.P(u,-u);case"bottom-right":return new s.P(-u,-u);case"left":return new s.P(p,0);case"right":return new s.P(-p,0)}return new s.P(0,0)}return p instanceof s.P||Array.isArray(p)?s.P.convert(p):s.P.convert(p[n]||[0,0])}return{version:P,supported:ee.supported,setRTLTextPlugin:s.fb,getRTLTextPluginStatus:s.fa,Map:class extends Dv{constructor(p){O.mark(C.create);const n=p;if((p=Object.assign({},Oh,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&s.f3(window)&&(p.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Id(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Fv,this._domRenderTaskQueue=new Fv,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},Bv,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new er(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new ht(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){const u=document.getElementById(p.container);if(!u)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=u}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Rv(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||s.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new Vo(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const u=p.bounds;u&&(this.resize(),this.fitBounds(u,Object.assign({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new kv({customAttribution:p.customAttribution})),this._logoControl=new Ov,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new s.z(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new s.z(`${u.dataType}dataloading`,u))}),this._interactions=new Nw(this)}_getMapId(){return this._mapId}addControl(p,n){if(n===void 0&&(n=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[n];return n.indexOf("bottom")!==-1?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(p);return n>-1&&this._controls.splice(n,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.z("movestart",p)).fire(new s.z("move",p)),this.fire(new s.z("resize",p)),n&&this.fire(new s.z("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(s.aI.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(n=>n==="auto"?navigator.language:n):p}setLanguage(p){const n=this._parseLanguage(p);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,n=p.projection.name;let u;n==="globe"&&p.zoom>=s.cL?(p.setMercatorFromTransition(),u=!0):n==="mercator"&&p.zoom<s.cL&&(p.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,n){return this._updateProjection(p||n||{name:"mercator"})}_updateProjection(p){let n;const u=this.transform.mercatorFromTransition;n=p.name==="globe"&&this.transform.zoom>=s.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate();const m=this.transform.getProjection().name==="mercator"&&u!==this.transform.mercatorFromTransition;return(n||m)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,n){return this.transform.locationPoint3D(s.aT.convert(p),n)}unproject(p,n){return this.transform.pointLocation3D(s.P.convert(p),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,n,u){const m=y=>{let b=[];if(Array.isArray(n)){const w=n.filter(E=>this.getLayer(E));b=w.length?this.queryRenderedFeatures(y,{layers:w}):[]}else b=this.queryRenderedFeatures(y,{target:n});return b};if(p==="mouseenter"||p==="mouseover"){let y=!1;return{listener:u,targets:n,delegates:{mousemove:w=>{const E=m(w.point);E.length?y||(y=!0,u.call(this,new yo(p,this,w.originalEvent,{features:E}))):y=!1},mouseout:()=>{y=!1}}}}if(p==="mouseleave"||p==="mouseout"){let y=!1;return{listener:u,targets:n,delegates:{mousemove:E=>{m(E.point).length?y=!0:y&&(y=!1,u.call(this,new yo(p,this,E.originalEvent)))},mouseout:E=>{y&&(y=!1,u.call(this,new yo(p,this,E.originalEvent)))}}}}{const y=b=>{const w=m(b.point);w.length&&(b.features=w,u.call(this,b),delete b.features)};return{listener:u,targets:n,delegates:{[p]:y}}}}on(p,n,u){if(typeof n=="function"||u===void 0)return super.on(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._createDelegatedListener(p,n,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(p,n,u){if(typeof n=="function"||u===void 0)return super.once(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._createDelegatedListener(p,n,u);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(p,n,u){if(typeof n=="function"||u===void 0)return super.off(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._delegatedListeners?this._delegatedListeners[p]:void 0;return m&&(y=>{for(let b=0;b<y.length;b++){const w=y[b];if(w.listener===u&&Uw(w.targets,n)){for(const E in w.delegates)this.off(E,w.delegates[E]);return y.splice(b,1),this}}})(m),this}queryRenderedFeatures(p,n){if(!this.style)return[];if(p===void 0||p instanceof s.P||Array.isArray(p)||n!==void 0||(n=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!n){const b=this.style.queryRenderedFeatures(p,void 0,this.transform),w=this.style.queryRenderedFeatureset(p,void 0,this.transform);return b.concat(w)}let u=!0;if(n.target&&(u=this._isTargetValid(n.target),u&&!n.layers))return this.style.queryRenderedFeatureset(p,n,this.transform);let m=!0;if(n.layers&&Array.isArray(n.layers)){for(const b of n.layers)if(!this._isValidId(b)){m=!1;break}if(m&&!n.target)return this.style.queryRenderedFeatures(p,n,this.transform)}let y=[];return m&&(y=y.concat(this.style.queryRenderedFeatures(p,n,this.transform))),u&&(y=y.concat(this.style.queryRenderedFeatureset(p,n,this.transform))),y}querySourceFeatures(p,n){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,n)}queryRasterValue(p,n,u){return this._isValidId(p)?this.style.queryRasterValue(p,n,u):Promise.resolve(null)}isPointOnSurface(p){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(p))}addInteraction(p,n){return this._interactions.add(p,n),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&p&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(p,(u,m)=>{if(u){const y=typeof u=="string"?u:u instanceof Error?u.message:u.error;s.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(p,n)}else m&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(p,n))}_getUIString(p){const n=this._locale[p];if(n==null)throw new Error(`Missing UI string '${p}'`);return n}_updateStyle(p,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const u=Object.assign({},n);n&&n.config&&(u.initialConfig=n.config,delete u.config),this.style=new xs(this,u).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new xs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dr(p)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(const n of p)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(p)}addSource(p,n){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,n),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,n,u){this._lazyInitEmptyStyle(),this.style.addSourceType(p,n,u)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,n,{pixelRatio:u=1,sdf:m=!1,stretchX:y,stretchY:b,content:w}={}){this._lazyInitEmptyStyle();const E=s.I.from(p);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:I,height:L,data:R}=s.o.getImageData(n);this.style.addImage(E,{data:new s.q({width:I,height:L},R),pixelRatio:u,stretchX:y,stretchY:b,content:w,sdf:m,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:L}=n,R=n;this.style.addImage(E,{data:new s.q({width:I,height:L},new Uint8Array(R.data)),pixelRatio:u,stretchX:y,stretchY:b,content:w,sdf:m,usvg:!1,version:0,userImage:R}),R.onAdd&&R.onAdd(this,p)}}updateImage(p,n){this._lazyInitEmptyStyle();const u=s.I.from(p),m=this.style.getImage(u);if(!m)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.o.getImageData(n):n,{width:b,height:w,data:E}=y;if(b===void 0||w===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(m.usvg?m.icon.usvg_tree.width:m.data.width)||w!==(m.usvg?m.icon.usvg_tree.height:m.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${b}, ${w})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`)));const I=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let L=!1;m.usvg?(m.data=new s.q({width:b,height:w},new Uint8Array(E)),m.usvg=!1,m.icon=void 0,L=!0):m.data.replace(E,I),this.style.updateImage(u,m,L)}hasImage(p){return p?!!this.style&&!!this.style.getImage(s.I.from(p)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(s.I.from(p))}loadImage(p,n){s.n(this._requestManager.transformRequest(p,s.R.Image),(u,m)=>{n(u,m instanceof HTMLImageElement?s.o.getImageData(m):m)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,n){this._lazyInitEmptyStyle(),this.style.addModel(p,n)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,n){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,n),this._update(!0)):this}getSlot(p){const n=this.getLayer(p);return n&&n.slot||null}setSlot(p,n){return this.style.setSlot(p,n),this.style.mergeLayers(),this._update(!0)}addImport(p,n){return this.style.addImport(p,n).catch(u=>this.fire(new s.y(new Error("Failed to add import",u)))),this}updateImport(p,n){return typeof n!="string"&&n.id!==p?(this.removeImport(p),this.addImport(n)):(this.style.updateImport(p,n),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,n){return this.style.moveImport(p,n),this._update(!0)}moveLayer(p,n){return this._isValidId(p)?(this.style.moveLayer(p,n),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const n=this.style.getOwnLayer(p);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,n,u){return this._isValidId(p)?(this.style.setLayerZoomRange(p,n,u),this._update(!0)):this}setFilter(p,n,u={}){return this._isValidId(p)?(this.style.setFilter(p,n,u),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,n,u,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,n,u,m),this._update(!0)):this}getPaintProperty(p,n){return this._isValidId(p)?this.style.getPaintProperty(p,n):null}setLayoutProperty(p,n,u,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,n,u,m),this._update(!0)):this}getLayoutProperty(p,n){return this._isValidId(p)?this.style.getLayoutProperty(p,n):null}setLayerProperty(p,n,u,m={}){return this._isValidId(p)?(n==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(p,n,u,m),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,n){return this.style.setSchema(p,n),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,n){return this.style.setConfig(p,n),this._update(!0)}getConfigProperty(p,n){return this.style.getConfigProperty(p,n)}setConfigProperty(p,n,u){return this.style.setConfigProperty(p,n,u),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const n=p[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,n),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aT.convert(p),this.transform):0}setFeatureState(p,n){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,n),this._update())}removeFeatureState(p,n){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,n),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.style.indoorManager.selectFloor(p)}_setIndoorActiveFloorsVisibility(p){this.style.indoorManager.setActiveFloorsVisibility(p)}getIndoorTileOptions(p,n){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(p,n):null}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let u,m,y,b=this._container;for(;b&&(!m||!y);){const w=window.getComputedStyle(b).transform;w&&w!=="none"&&(u=w.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(m=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(y=u[3])),b=b.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=se("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=se("div","mapboxgl-canvas-container",p);this._canvas=se("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=se("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{m[y]=se("div",`mapboxgl-ctrl-${y}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,n){const u=s.o.devicePixelRatio||1;this._canvas.width=u*Math.ceil(p),this._canvas.height=u*Math.ceil(n),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${n}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const n=this._markers.indexOf(p);n!==-1&&this._markers.splice(n,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const n=this._popups.indexOf(p);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const p=Object.assign({},ee.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",p);n?(Ve(n,!0),this.painter=new bv(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",u=>{if(u.dataType==="source"){const m=this.transform.elevation?this.transform.elevation._source():null;m&&u.sourceCacheId===m.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),s.k.testSupport(n)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let n;this.fire(new s.z("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,m=s.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=y.createQuery(),y.beginQuery(u.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,L=this.transform.pitch,R=s.o.now(),N=new s.ac(I,{now:R,fadeDuration:b,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(N)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(m),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(m),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,O.mark(C.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const I=s.o.now()-m;y.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const L=y.getQueryParameter(n,y.QUERY_RESULT)/1e6;y.deleteQuery(n),this.fire(new s.z("gpu-timing-frame",{cpuTime:I,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(I);this.fire(new s.z("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(I);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:L}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(E||this._repaint)this.triggerRepaint();else{const I=this.idle();if(I&&(w=this._updateAverageElevation(m,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,O.mark(C.fullLoad),this._performanceMetricsCollection&&qt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const n of this._markers)p&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!p||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(p,n=!1){const u=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(n||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=p;const w=Math.abs(y-b);if(w>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(b),u(b);this._averageElevation.easeTo(b,p,300)}else if(w>1e-4)return this._averageElevation.jumpTo(b),u(b)}return!!this._averageElevation.isEasing(p)&&u(this._averageElevation.getValue(p))}_authenticate(){ji(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===Qe||p.status===401)){const n=this.painter.context.gl;Ve(n,!1),this._logoControl instanceof Ov&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Un(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&pr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Di(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){hn(this._requestManager._customAccessToken)}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const u=this.painter.context.gl,m=u.createFramebuffer();function y(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const w=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,w),w}return u.bindFramebuffer(u.FRAMEBUFFER,m),this._canvasPixelComparison(y(p),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(p,n,u){let m=u[1]-u[0];const y=p.length/4;for(let b=0;b<n.length;b++){const w=n[b];let E=0;for(let I=0;I<w.length;I+=4)w[I]===p[I]&&w[I+1]===p[I+1]&&w[I+2]===p[I+2]&&w[I+3]===p[I+3]&&(E+=1);m+=(u[b+2]-u[b+1])*(1-E/y)}return m}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),zi.delete(this.painter.context.gl),hi.remove(),Rn.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=s.o.frame(n=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(n)}))}_preloadTiles(p){const n=this.style?this.style.getSourceCaches():[];return s.bw(n,(u,m)=>u._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this.style&&p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,n){s.f4(p,n)}get version(){return P}},NavigationControl:class{constructor(p={}){this.options=Object.assign({},Uv,p),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:n}):u.resetNorth({},{originalEvent:n}))}),this._compassIcon=se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const n=p.getZoom(),u=n===p.getMaxZoom(),m=n===p.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rg(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,n){const u=se("button",p,this._container);return u.type="button",u.addEventListener("click",n),u}_setButtonTitle(p,n){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${n}`);p.setAttribute("aria-label",u),p.firstElementChild&&p.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends s.E{constructor(p={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},Bs,p),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=wv(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const n=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,p(u)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>n(u.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(p){const n=this._map.getMaxBounds(),u=p.coords;return!!n&&(u.longitude<n.getWest()||u.longitude>n.getEast()||u.latitude<n.getSouth()||u.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:p.coords,timestamp:p.timestamp},p.toJSON?{toJSON:p.toJSON.bind(p)}:{}))),this._finish()}}_updateCamera(p){const n=new s.aT(p.coords.longitude,p.coords.latitude),u=p.coords.accuracy,m=this._map.getBearing(),y=Object.assign({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(u),y,{geolocateSource:!0})}_updateMarker(p){if(p){const n=new s.aT(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,n=s.cf(1,p._center.lat)*p.worldSize,u=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",{code:p.code,message:p.message,PERMISSION_DENIED:p.PERMISSION_DENIED,POSITION_UNAVAILABLE:p.POSITION_UNAVAILABLE,TIMEOUT:p.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const p=this.options.positionOptions.timeout;p&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},p))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=se("button","mapboxgl-ctrl-geolocate",this._container),se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se("div","mapboxgl-user-location"),this._dotElement.appendChild(se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new zr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(p){return this.options.followUserLocation=p??Bs.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new s.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const p=()=>{const n="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(n,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:kv,ScaleControl:class{constructor(p={}){this.options=Object.assign({},Bh,p),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,n=this._map,u=n._containerHeight/2,m=n._containerWidth/2-p/2,y=n.unproject([m,u]),b=n.unproject([m+p,u]),w=y.distanceTo(b);if(this.options.unit==="imperial"){const E=3.2808*w;E>5280?this._setScale(p,E/5280,"mile"):this._setScale(p,E,"foot")}else this.options.unit==="nautical"?this._setScale(p,w/1852,"nautical-mile"):w>=1e3?this._setScale(p,w/1e3,"kilometer"):this._setScale(p,w,"meter")}_setScale(p,n,u){this._map._requestDomTask(()=>{const m=(function(b){const w=Math.pow(10,`${Math.floor(b)}`.length-1);let E=b/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:(function(I){const L=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*L)/L})(E),w*E})(n),y=m/n;this._container.innerHTML=u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(m):`${m}&nbsp;${df[u]}`,this._container.style.width=p*y+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);se("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Xp,Popup:class extends s.E{constructor(p){super(),this.options=Object.assign(Object.create($v),p),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=s.aT.convert(p),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const n=document.createDocumentFragment(),u=document.createElement("body");let m;for(u.innerHTML=p;m=u.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=se("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(p),this.options.closeButton){const u=this._closeButton=se("button","mapboxgl-popup-close-button",n);u.type="button",u.setAttribute("aria-label","Close popup"),u.innerHTML='<span aria-hidden="true">&#215;</span>',u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let n;return this._classList.delete(p)?n=!1:(this._classList.add(p),n=!0),this._updateClassList(),n}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const n=this._map,u=this._container,m=this._pos;if(!n||!u||!m)return"bottom";const y=u.offsetWidth,b=u.offsetHeight,w=m.x<y/2,E=m.x>n.transform.width-y/2;if(m.y+p<b)return w?"top-left":E?"top-right":"top";if(m.y>n.transform.height-b){if(w)return"bottom-left";if(E)return"bottom-right"}return w?"left":E?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),p.className=n.join(" ")}_update(p){const n=this._map,u=this._content;if(!n||!this._lngLat&&!this._trackPointer||!u)return;let m=this._container;if(m||(m=this._container=se("div","mapboxgl-popup",n.getContainer()),this._tip=se("div","mapboxgl-popup-tip",m),m.appendChild(u)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fh(this._lngLat,this._pos,n.transform)),!this._trackPointer||p){const y=this._pos=this._trackPointer&&p instanceof s.P?p:n.project(this._lngLat,this._altitude),b=_u(this.options.offset),w=this._anchor=this._getAnchor(b.y),E=_u(this.options.offset,w),I=y.add(E).round();n._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${ga[w]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&n._showingGlobe()){const y=s.f5(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector($w);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:zr,Style:xs,LngLat:s.aT,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:Ay,Evented:s.E,config:s.e,prewarm:s.f9,clearPrewarmedResources:s.f8,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(p){s.e.ACCESS_TOKEN=p},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(p){s.e.API_URL=p},get workerCount(){return s.fi.workerCount},set workerCount(p){s.fi.workerCount=p},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){s.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){s.fh(p)},get workerUrl(){return s.fg.workerUrl},set workerUrl(p){s.fg.workerUrl=p},get workerClass(){return s.fg.workerClass},set workerClass(p){s.fg.workerClass=p},get workerParams(){return s.fg.workerParams},set workerParams(p){s.fg.workerParams=p},get dracoUrl(){return s.ff()},set dracoUrl(p){s.fe(p)},get meshoptUrl(){return s.fd()},set meshoptUrl(p){s.fc(p)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var x=l;return x}))})(T0)),T0.exports}var w7=b7();const $0=v7(w7),UB="126",S7=0,AC=1,T7=2,$B=1,E7=2,l_=3,ew=0,Yo=1,tw=2,VB=1,u_=0,h_=1,PC=2,zC=3,CC=4,I7=5,op=100,M7=101,A7=102,LC=103,RC=104,P7=200,z7=201,C7=202,L7=203,jB=204,GB=205,R7=206,D7=207,k7=208,O7=209,F7=210,B7=0,N7=1,U7=2,lT=3,$7=4,V7=5,j7=6,G7=7,iw=0,H7=1,Z7=2,d_=0,W7=1,q7=2,X7=3,J7=4,Y7=5,HB=300,o2=301,s2=302,DC=303,kC=304,a2=306,l2=307,cT=1e3,wa=1001,uT=1002,qs=1003,OC=1004,FC=1005,ds=1006,K7=1007,nw=1008,c2=1009,Q7=1010,eX=1011,V0=1012,tX=1013,E0=1014,Bu=1015,j0=1016,iX=1017,nX=1018,rX=1019,f_=1020,oX=1021,rd=1022,El=1023,sX=1024,aX=1025,fp=1026,P_=1027,lX=1028,cX=1029,uX=1030,hX=1031,dX=1032,fX=1033,BC=33776,NC=33777,UC=33778,$C=33779,VC=35840,jC=35841,GC=35842,HC=35843,pX=36196,ZC=37492,WC=37496,mX=37808,gX=37809,_X=37810,yX=37811,vX=37812,xX=37813,bX=37814,wX=37815,SX=37816,TX=37817,EX=37818,IX=37819,MX=37820,AX=37821,PX=36492,zX=37840,CX=37841,LX=37842,RX=37843,DX=37844,kX=37845,OX=37846,FX=37847,BX=37848,NX=37849,UX=37850,$X=37851,VX=37852,jX=37853,GX=2200,HX=2201,ZX=2202,G0=2300,H0=2301,bS=2302,lp=2400,cp=2401,Z0=2402,u2=2500,ZB=2501,WX=0,my=3e3,WB=3001,qX=3007,XX=3002,JX=3003,YX=3004,KX=3005,QX=3006,eJ=3200,tJ=3201,Cp=0,iJ=1,wS=7680,nJ=519,rw=35044,z_=35048,qC="300 es";function Yu(){}Object.assign(Yu.prototype,{addEventListener:function(i,e){this._listeners===void 0&&(this._listeners={});const o=this._listeners;o[i]===void 0&&(o[i]=[]),o[i].indexOf(e)===-1&&o[i].push(e)},hasEventListener:function(i,e){if(this._listeners===void 0)return!1;const o=this._listeners;return o[i]!==void 0&&o[i].indexOf(e)!==-1},removeEventListener:function(i,e){if(this._listeners===void 0)return;const h=this._listeners[i];if(h!==void 0){const l=h.indexOf(e);l!==-1&&h.splice(l,1)}},dispatchEvent:function(i){if(this._listeners===void 0)return;const o=this._listeners[i.type];if(o!==void 0){i.target=this;const h=o.slice(0);for(let l=0,f=h.length;l<f;l++)h[l].call(this,i)}}});const cs=[];for(let i=0;i<256;i++)cs[i]=(i<16?"0":"")+i.toString(16);let Xx=1234567;const Bn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,o=Math.random()*4294967295|0,h=Math.random()*4294967295|0;return(cs[i&255]+cs[i>>8&255]+cs[i>>16&255]+cs[i>>24&255]+"-"+cs[e&255]+cs[e>>8&255]+"-"+cs[e>>16&15|64]+cs[e>>24&255]+"-"+cs[o&63|128]+cs[o>>8&255]+"-"+cs[o>>16&255]+cs[o>>24&255]+cs[h&255]+cs[h>>8&255]+cs[h>>16&255]+cs[h>>24&255]).toUpperCase()},clamp:function(i,e,o){return Math.max(e,Math.min(o,i))},euclideanModulo:function(i,e){return(i%e+e)%e},mapLinear:function(i,e,o,h,l){return h+(i-e)*(l-h)/(o-e)},lerp:function(i,e,o){return(1-o)*i+o*e},damp:function(i,e,o,h){return Bn.lerp(i,e,1-Math.exp(-o*h))},pingpong:function(i,e=1){return e-Math.abs(Bn.euclideanModulo(i,e*2)-e)},smoothstep:function(i,e,o){return i<=e?0:i>=o?1:(i=(i-e)/(o-e),i*i*(3-2*i))},smootherstep:function(i,e,o){return i<=e?0:i>=o?1:(i=(i-e)/(o-e),i*i*i*(i*(i*6-15)+10))},randInt:function(i,e){return i+Math.floor(Math.random()*(e-i+1))},randFloat:function(i,e){return i+Math.random()*(e-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){return i!==void 0&&(Xx=i%2147483647),Xx=Xx*16807%2147483647,(Xx-1)/2147483646},degToRad:function(i){return i*Bn.DEG2RAD},radToDeg:function(i){return i*Bn.RAD2DEG},isPowerOfTwo:function(i){return(i&i-1)===0&&i!==0},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,e,o,h,l){const f=Math.cos,x=Math.sin,s=f(o/2),P=x(o/2),C=f((e+h)/2),O=x((e+h)/2),F=f((e-h)/2),V=x((e-h)/2),q=f((h-e)/2),ee=x((h-e)/2);switch(l){case"XYX":i.set(s*O,P*F,P*V,s*C);break;case"YZY":i.set(P*V,s*O,P*F,s*C);break;case"ZXZ":i.set(P*F,P*V,s*O,s*C);break;case"XZX":i.set(s*O,P*ee,P*q,s*C);break;case"YXY":i.set(P*q,s*O,P*ee,s*C);break;case"ZYZ":i.set(P*ee,P*q,s*O,s*C);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+l)}}};class gi{constructor(e=0,o=0){this.x=e,this.y=o}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,o){return this.x=e,this.y=o,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,o){switch(e){case 0:this.x=o;break;case 1:this.y=o;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,o){return o!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,o)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,o){return this.x=e.x+o.x,this.y=e.y+o.y,this}addScaledVector(e,o){return this.x+=e.x*o,this.y+=e.y*o,this}sub(e,o){return o!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,o)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,o){return this.x=e.x-o.x,this.y=e.y-o.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const o=this.x,h=this.y,l=e.elements;return this.x=l[0]*o+l[3]*h+l[6],this.y=l[1]*o+l[4]*h+l[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,o){return this.x=Math.max(e.x,Math.min(o.x,this.x)),this.y=Math.max(e.y,Math.min(o.y,this.y)),this}clampScalar(e,o){return this.x=Math.max(e,Math.min(o,this.x)),this.y=Math.max(e,Math.min(o,this.y)),this}clampLength(e,o){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(e,Math.min(o,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const o=this.x-e.x,h=this.y-e.y;return o*o+h*h}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,o){return this.x+=(e.x-this.x)*o,this.y+=(e.y-this.y)*o,this}lerpVectors(e,o,h){return this.x=e.x+(o.x-e.x)*h,this.y=e.y+(o.y-e.y)*h,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,o=0){return this.x=e[o],this.y=e[o+1],this}toArray(e=[],o=0){return e[o]=this.x,e[o+1]=this.y,e}fromBufferAttribute(e,o,h){return h!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(o),this.y=e.getY(o),this}rotateAround(e,o){const h=Math.cos(o),l=Math.sin(o),f=this.x-e.x,x=this.y-e.y;return this.x=f*h-x*l+e.x,this.y=f*l+x*h+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}gi.prototype.isVector2=!0;class fs{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,o,h,l,f,x,s,P,C){const O=this.elements;return O[0]=e,O[1]=l,O[2]=s,O[3]=o,O[4]=f,O[5]=P,O[6]=h,O[7]=x,O[8]=C,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const o=this.elements,h=e.elements;return o[0]=h[0],o[1]=h[1],o[2]=h[2],o[3]=h[3],o[4]=h[4],o[5]=h[5],o[6]=h[6],o[7]=h[7],o[8]=h[8],this}extractBasis(e,o,h){return e.setFromMatrix3Column(this,0),o.setFromMatrix3Column(this,1),h.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const o=e.elements;return this.set(o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,o){const h=e.elements,l=o.elements,f=this.elements,x=h[0],s=h[3],P=h[6],C=h[1],O=h[4],F=h[7],V=h[2],q=h[5],ee=h[8],se=l[0],fe=l[3],ae=l[6],ie=l[1],tt=l[4],Ue=l[7],Ne=l[2],Ce=l[5],Ye=l[8];return f[0]=x*se+s*ie+P*Ne,f[3]=x*fe+s*tt+P*Ce,f[6]=x*ae+s*Ue+P*Ye,f[1]=C*se+O*ie+F*Ne,f[4]=C*fe+O*tt+F*Ce,f[7]=C*ae+O*Ue+F*Ye,f[2]=V*se+q*ie+ee*Ne,f[5]=V*fe+q*tt+ee*Ce,f[8]=V*ae+q*Ue+ee*Ye,this}multiplyScalar(e){const o=this.elements;return o[0]*=e,o[3]*=e,o[6]*=e,o[1]*=e,o[4]*=e,o[7]*=e,o[2]*=e,o[5]*=e,o[8]*=e,this}determinant(){const e=this.elements,o=e[0],h=e[1],l=e[2],f=e[3],x=e[4],s=e[5],P=e[6],C=e[7],O=e[8];return o*x*O-o*s*C-h*f*O+h*s*P+l*f*C-l*x*P}invert(){const e=this.elements,o=e[0],h=e[1],l=e[2],f=e[3],x=e[4],s=e[5],P=e[6],C=e[7],O=e[8],F=O*x-s*C,V=s*P-O*f,q=C*f-x*P,ee=o*F+h*V+l*q;if(ee===0)return this.set(0,0,0,0,0,0,0,0,0);const se=1/ee;return e[0]=F*se,e[1]=(l*C-O*h)*se,e[2]=(s*h-l*x)*se,e[3]=V*se,e[4]=(O*o-l*P)*se,e[5]=(l*f-s*o)*se,e[6]=q*se,e[7]=(h*P-C*o)*se,e[8]=(x*o-h*f)*se,this}transpose(){let e;const o=this.elements;return e=o[1],o[1]=o[3],o[3]=e,e=o[2],o[2]=o[6],o[6]=e,e=o[5],o[5]=o[7],o[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const o=this.elements;return e[0]=o[0],e[1]=o[3],e[2]=o[6],e[3]=o[1],e[4]=o[4],e[5]=o[7],e[6]=o[2],e[7]=o[5],e[8]=o[8],this}setUvTransform(e,o,h,l,f,x,s){const P=Math.cos(f),C=Math.sin(f);return this.set(h*P,h*C,-h*(P*x+C*s)+x+e,-l*C,l*P,-l*(-C*x+P*s)+s+o,0,0,1),this}scale(e,o){const h=this.elements;return h[0]*=e,h[3]*=e,h[6]*=e,h[1]*=o,h[4]*=o,h[7]*=o,this}rotate(e){const o=Math.cos(e),h=Math.sin(e),l=this.elements,f=l[0],x=l[3],s=l[6],P=l[1],C=l[4],O=l[7];return l[0]=o*f+h*P,l[3]=o*x+h*C,l[6]=o*s+h*O,l[1]=-h*f+o*P,l[4]=-h*x+o*C,l[7]=-h*s+o*O,this}translate(e,o){const h=this.elements;return h[0]+=e*h[2],h[3]+=e*h[5],h[6]+=e*h[8],h[1]+=o*h[2],h[4]+=o*h[5],h[7]+=o*h[8],this}equals(e){const o=this.elements,h=e.elements;for(let l=0;l<9;l++)if(o[l]!==h[l])return!1;return!0}fromArray(e,o=0){for(let h=0;h<9;h++)this.elements[h]=e[h+o];return this}toArray(e=[],o=0){const h=this.elements;return e[o]=h[0],e[o+1]=h[1],e[o+2]=h[2],e[o+3]=h[3],e[o+4]=h[4],e[o+5]=h[5],e[o+6]=h[6],e[o+7]=h[7],e[o+8]=h[8],e}clone(){return new this.constructor().fromArray(this.elements)}}fs.prototype.isMatrix3=!0;let Uf;const Lp={getDataURL:function(i){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;let e;if(i instanceof HTMLCanvasElement)e=i;else{Uf===void 0&&(Uf=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Uf.width=i.width,Uf.height=i.height;const o=Uf.getContext("2d");i instanceof ImageData?o.putImageData(i,0,0):o.drawImage(i,0,0,i.width,i.height),e=Uf}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let rJ=0;class ps extends Yu{constructor(e=ps.DEFAULT_IMAGE,o=ps.DEFAULT_MAPPING,h=wa,l=wa,f=ds,x=nw,s=El,P=c2,C=1,O=my){super(),Object.defineProperty(this,"id",{value:rJ++}),this.uuid=Bn.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=o,this.wrapS=h,this.wrapT=l,this.magFilter=f,this.minFilter=x,this.anisotropy=C,this.format=s,this.internalFormat=null,this.type=P,this.offset=new gi(0,0),this.repeat=new gi(1,1),this.center=new gi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new fs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=O,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const o=e===void 0||typeof e=="string";if(!o&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const h={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const l=this.image;if(l.uuid===void 0&&(l.uuid=Bn.generateUUID()),!o&&e.images[l.uuid]===void 0){let f;if(Array.isArray(l)){f=[];for(let x=0,s=l.length;x<s;x++)l[x].isDataTexture?f.push(SS(l[x].image)):f.push(SS(l[x]))}else f=SS(l);e.images[l.uuid]={uuid:l.uuid,url:f}}h.image=l.uuid}return o||(e.textures[this.uuid]=h),h}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==HB)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case cT:e.x=e.x-Math.floor(e.x);break;case wa:e.x=e.x<0?0:1;break;case uT:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case cT:e.y=e.y-Math.floor(e.y);break;case wa:e.y=e.y<0?0:1;break;case uT:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}ps.DEFAULT_IMAGE=void 0;ps.DEFAULT_MAPPING=HB;ps.prototype.isTexture=!0;function SS(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?Lp.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Lr{constructor(e=0,o=0,h=0,l=1){this.x=e,this.y=o,this.z=h,this.w=l}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,o,h,l){return this.x=e,this.y=o,this.z=h,this.w=l,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,o){switch(e){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;case 3:this.w=o;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,o){return o!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,o)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,o){return this.x=e.x+o.x,this.y=e.y+o.y,this.z=e.z+o.z,this.w=e.w+o.w,this}addScaledVector(e,o){return this.x+=e.x*o,this.y+=e.y*o,this.z+=e.z*o,this.w+=e.w*o,this}sub(e,o){return o!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,o)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,o){return this.x=e.x-o.x,this.y=e.y-o.y,this.z=e.z-o.z,this.w=e.w-o.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const o=this.x,h=this.y,l=this.z,f=this.w,x=e.elements;return this.x=x[0]*o+x[4]*h+x[8]*l+x[12]*f,this.y=x[1]*o+x[5]*h+x[9]*l+x[13]*f,this.z=x[2]*o+x[6]*h+x[10]*l+x[14]*f,this.w=x[3]*o+x[7]*h+x[11]*l+x[15]*f,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const o=Math.sqrt(1-e.w*e.w);return o<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/o,this.y=e.y/o,this.z=e.z/o),this}setAxisAngleFromRotationMatrix(e){let o,h,l,f;const P=e.elements,C=P[0],O=P[4],F=P[8],V=P[1],q=P[5],ee=P[9],se=P[2],fe=P[6],ae=P[10];if(Math.abs(O-V)<.01&&Math.abs(F-se)<.01&&Math.abs(ee-fe)<.01){if(Math.abs(O+V)<.1&&Math.abs(F+se)<.1&&Math.abs(ee+fe)<.1&&Math.abs(C+q+ae-3)<.1)return this.set(1,0,0,0),this;o=Math.PI;const tt=(C+1)/2,Ue=(q+1)/2,Ne=(ae+1)/2,Ce=(O+V)/4,Ye=(F+se)/4,At=(ee+fe)/4;return tt>Ue&&tt>Ne?tt<.01?(h=0,l=.707106781,f=.707106781):(h=Math.sqrt(tt),l=Ce/h,f=Ye/h):Ue>Ne?Ue<.01?(h=.707106781,l=0,f=.707106781):(l=Math.sqrt(Ue),h=Ce/l,f=At/l):Ne<.01?(h=.707106781,l=.707106781,f=0):(f=Math.sqrt(Ne),h=Ye/f,l=At/f),this.set(h,l,f,o),this}let ie=Math.sqrt((fe-ee)*(fe-ee)+(F-se)*(F-se)+(V-O)*(V-O));return Math.abs(ie)<.001&&(ie=1),this.x=(fe-ee)/ie,this.y=(F-se)/ie,this.z=(V-O)/ie,this.w=Math.acos((C+q+ae-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,o){return this.x=Math.max(e.x,Math.min(o.x,this.x)),this.y=Math.max(e.y,Math.min(o.y,this.y)),this.z=Math.max(e.z,Math.min(o.z,this.z)),this.w=Math.max(e.w,Math.min(o.w,this.w)),this}clampScalar(e,o){return this.x=Math.max(e,Math.min(o,this.x)),this.y=Math.max(e,Math.min(o,this.y)),this.z=Math.max(e,Math.min(o,this.z)),this.w=Math.max(e,Math.min(o,this.w)),this}clampLength(e,o){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(e,Math.min(o,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,o){return this.x+=(e.x-this.x)*o,this.y+=(e.y-this.y)*o,this.z+=(e.z-this.z)*o,this.w+=(e.w-this.w)*o,this}lerpVectors(e,o,h){return this.x=e.x+(o.x-e.x)*h,this.y=e.y+(o.y-e.y)*h,this.z=e.z+(o.z-e.z)*h,this.w=e.w+(o.w-e.w)*h,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,o=0){return this.x=e[o],this.y=e[o+1],this.z=e[o+2],this.w=e[o+3],this}toArray(e=[],o=0){return e[o]=this.x,e[o+1]=this.y,e[o+2]=this.z,e[o+3]=this.w,e}fromBufferAttribute(e,o,h){return h!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(o),this.y=e.getY(o),this.z=e.getZ(o),this.w=e.getW(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Lr.prototype.isVector4=!0;class od extends Yu{constructor(e,o,h){super(),this.width=e,this.height=o,this.depth=1,this.scissor=new Lr(0,0,e,o),this.scissorTest=!1,this.viewport=new Lr(0,0,e,o),h=h||{},this.texture=new ps(void 0,h.mapping,h.wrapS,h.wrapT,h.magFilter,h.minFilter,h.format,h.type,h.anisotropy,h.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=o,this.texture.image.depth=1,this.texture.generateMipmaps=h.generateMipmaps!==void 0?h.generateMipmaps:!1,this.texture.minFilter=h.minFilter!==void 0?h.minFilter:ds,this.depthBuffer=h.depthBuffer!==void 0?h.depthBuffer:!0,this.stencilBuffer=h.stencilBuffer!==void 0?h.stencilBuffer:!1,this.depthTexture=h.depthTexture!==void 0?h.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,o,h=1){(this.width!==e||this.height!==o||this.depth!==h)&&(this.width=e,this.height=o,this.depth=h,this.texture.image.width=e,this.texture.image.height=o,this.texture.image.depth=h,this.dispose()),this.viewport.set(0,0,e,o),this.scissor.set(0,0,e,o)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}od.prototype.isWebGLRenderTarget=!0;class oJ extends od{constructor(e,o,h){super(e,o,h),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}oJ.prototype.isWebGLMultisampleRenderTarget=!0;class Xs{constructor(e=0,o=0,h=0,l=1){this._x=e,this._y=o,this._z=h,this._w=l}static slerp(e,o,h,l){return h.copy(e).slerp(o,l)}static slerpFlat(e,o,h,l,f,x,s){let P=h[l+0],C=h[l+1],O=h[l+2],F=h[l+3];const V=f[x+0],q=f[x+1],ee=f[x+2],se=f[x+3];if(s===0){e[o+0]=P,e[o+1]=C,e[o+2]=O,e[o+3]=F;return}if(s===1){e[o+0]=V,e[o+1]=q,e[o+2]=ee,e[o+3]=se;return}if(F!==se||P!==V||C!==q||O!==ee){let fe=1-s;const ae=P*V+C*q+O*ee+F*se,ie=ae>=0?1:-1,tt=1-ae*ae;if(tt>Number.EPSILON){const Ne=Math.sqrt(tt),Ce=Math.atan2(Ne,ae*ie);fe=Math.sin(fe*Ce)/Ne,s=Math.sin(s*Ce)/Ne}const Ue=s*ie;if(P=P*fe+V*Ue,C=C*fe+q*Ue,O=O*fe+ee*Ue,F=F*fe+se*Ue,fe===1-s){const Ne=1/Math.sqrt(P*P+C*C+O*O+F*F);P*=Ne,C*=Ne,O*=Ne,F*=Ne}}e[o]=P,e[o+1]=C,e[o+2]=O,e[o+3]=F}static multiplyQuaternionsFlat(e,o,h,l,f,x){const s=h[l],P=h[l+1],C=h[l+2],O=h[l+3],F=f[x],V=f[x+1],q=f[x+2],ee=f[x+3];return e[o]=s*ee+O*F+P*q-C*V,e[o+1]=P*ee+O*V+C*F-s*q,e[o+2]=C*ee+O*q+s*V-P*F,e[o+3]=O*ee-s*F-P*V-C*q,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,o,h,l){return this._x=e,this._y=o,this._z=h,this._w=l,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,o){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const h=e._x,l=e._y,f=e._z,x=e._order,s=Math.cos,P=Math.sin,C=s(h/2),O=s(l/2),F=s(f/2),V=P(h/2),q=P(l/2),ee=P(f/2);switch(x){case"XYZ":this._x=V*O*F+C*q*ee,this._y=C*q*F-V*O*ee,this._z=C*O*ee+V*q*F,this._w=C*O*F-V*q*ee;break;case"YXZ":this._x=V*O*F+C*q*ee,this._y=C*q*F-V*O*ee,this._z=C*O*ee-V*q*F,this._w=C*O*F+V*q*ee;break;case"ZXY":this._x=V*O*F-C*q*ee,this._y=C*q*F+V*O*ee,this._z=C*O*ee+V*q*F,this._w=C*O*F-V*q*ee;break;case"ZYX":this._x=V*O*F-C*q*ee,this._y=C*q*F+V*O*ee,this._z=C*O*ee-V*q*F,this._w=C*O*F+V*q*ee;break;case"YZX":this._x=V*O*F+C*q*ee,this._y=C*q*F+V*O*ee,this._z=C*O*ee-V*q*F,this._w=C*O*F-V*q*ee;break;case"XZY":this._x=V*O*F-C*q*ee,this._y=C*q*F-V*O*ee,this._z=C*O*ee+V*q*F,this._w=C*O*F+V*q*ee;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+x)}return o!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,o){const h=o/2,l=Math.sin(h);return this._x=e.x*l,this._y=e.y*l,this._z=e.z*l,this._w=Math.cos(h),this._onChangeCallback(),this}setFromRotationMatrix(e){const o=e.elements,h=o[0],l=o[4],f=o[8],x=o[1],s=o[5],P=o[9],C=o[2],O=o[6],F=o[10],V=h+s+F;if(V>0){const q=.5/Math.sqrt(V+1);this._w=.25/q,this._x=(O-P)*q,this._y=(f-C)*q,this._z=(x-l)*q}else if(h>s&&h>F){const q=2*Math.sqrt(1+h-s-F);this._w=(O-P)/q,this._x=.25*q,this._y=(l+x)/q,this._z=(f+C)/q}else if(s>F){const q=2*Math.sqrt(1+s-h-F);this._w=(f-C)/q,this._x=(l+x)/q,this._y=.25*q,this._z=(P+O)/q}else{const q=2*Math.sqrt(1+F-h-s);this._w=(x-l)/q,this._x=(f+C)/q,this._y=(P+O)/q,this._z=.25*q}return this._onChangeCallback(),this}setFromUnitVectors(e,o){let l=e.dot(o)+1;return l<1e-6?(l=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=l):(this._x=0,this._y=-e.z,this._z=e.y,this._w=l)):(this._x=e.y*o.z-e.z*o.y,this._y=e.z*o.x-e.x*o.z,this._z=e.x*o.y-e.y*o.x,this._w=l),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Bn.clamp(this.dot(e),-1,1)))}rotateTowards(e,o){const h=this.angleTo(e);if(h===0)return this;const l=Math.min(1,o/h);return this.slerp(e,l),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,o){return o!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,o)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,o){const h=e._x,l=e._y,f=e._z,x=e._w,s=o._x,P=o._y,C=o._z,O=o._w;return this._x=h*O+x*s+l*C-f*P,this._y=l*O+x*P+f*s-h*C,this._z=f*O+x*C+h*P-l*s,this._w=x*O-h*s-l*P-f*C,this._onChangeCallback(),this}slerp(e,o){if(o===0)return this;if(o===1)return this.copy(e);const h=this._x,l=this._y,f=this._z,x=this._w;let s=x*e._w+h*e._x+l*e._y+f*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=x,this._x=h,this._y=l,this._z=f,this;const P=1-s*s;if(P<=Number.EPSILON){const q=1-o;return this._w=q*x+o*this._w,this._x=q*h+o*this._x,this._y=q*l+o*this._y,this._z=q*f+o*this._z,this.normalize(),this._onChangeCallback(),this}const C=Math.sqrt(P),O=Math.atan2(C,s),F=Math.sin((1-o)*O)/C,V=Math.sin(o*O)/C;return this._w=x*F+this._w*V,this._x=h*F+this._x*V,this._y=l*F+this._y*V,this._z=f*F+this._z*V,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,o=0){return this._x=e[o],this._y=e[o+1],this._z=e[o+2],this._w=e[o+3],this._onChangeCallback(),this}toArray(e=[],o=0){return e[o]=this._x,e[o+1]=this._y,e[o+2]=this._z,e[o+3]=this._w,e}fromBufferAttribute(e,o){return this._x=e.getX(o),this._y=e.getY(o),this._z=e.getZ(o),this._w=e.getW(o),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Xs.prototype.isQuaternion=!0;class He{constructor(e=0,o=0,h=0){this.x=e,this.y=o,this.z=h}set(e,o,h){return h===void 0&&(h=this.z),this.x=e,this.y=o,this.z=h,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,o){switch(e){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,o){return o!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,o)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,o){return this.x=e.x+o.x,this.y=e.y+o.y,this.z=e.z+o.z,this}addScaledVector(e,o){return this.x+=e.x*o,this.y+=e.y*o,this.z+=e.z*o,this}sub(e,o){return o!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,o)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,o){return this.x=e.x-o.x,this.y=e.y-o.y,this.z=e.z-o.z,this}multiply(e,o){return o!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,o)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,o){return this.x=e.x*o.x,this.y=e.y*o.y,this.z=e.z*o.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(XC.setFromEuler(e))}applyAxisAngle(e,o){return this.applyQuaternion(XC.setFromAxisAngle(e,o))}applyMatrix3(e){const o=this.x,h=this.y,l=this.z,f=e.elements;return this.x=f[0]*o+f[3]*h+f[6]*l,this.y=f[1]*o+f[4]*h+f[7]*l,this.z=f[2]*o+f[5]*h+f[8]*l,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const o=this.x,h=this.y,l=this.z,f=e.elements,x=1/(f[3]*o+f[7]*h+f[11]*l+f[15]);return this.x=(f[0]*o+f[4]*h+f[8]*l+f[12])*x,this.y=(f[1]*o+f[5]*h+f[9]*l+f[13])*x,this.z=(f[2]*o+f[6]*h+f[10]*l+f[14])*x,this}applyQuaternion(e){const o=this.x,h=this.y,l=this.z,f=e.x,x=e.y,s=e.z,P=e.w,C=P*o+x*l-s*h,O=P*h+s*o-f*l,F=P*l+f*h-x*o,V=-f*o-x*h-s*l;return this.x=C*P+V*-f+O*-s-F*-x,this.y=O*P+V*-x+F*-f-C*-s,this.z=F*P+V*-s+C*-x-O*-f,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const o=this.x,h=this.y,l=this.z,f=e.elements;return this.x=f[0]*o+f[4]*h+f[8]*l,this.y=f[1]*o+f[5]*h+f[9]*l,this.z=f[2]*o+f[6]*h+f[10]*l,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,o){return this.x=Math.max(e.x,Math.min(o.x,this.x)),this.y=Math.max(e.y,Math.min(o.y,this.y)),this.z=Math.max(e.z,Math.min(o.z,this.z)),this}clampScalar(e,o){return this.x=Math.max(e,Math.min(o,this.x)),this.y=Math.max(e,Math.min(o,this.y)),this.z=Math.max(e,Math.min(o,this.z)),this}clampLength(e,o){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(e,Math.min(o,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,o){return this.x+=(e.x-this.x)*o,this.y+=(e.y-this.y)*o,this.z+=(e.z-this.z)*o,this}lerpVectors(e,o,h){return this.x=e.x+(o.x-e.x)*h,this.y=e.y+(o.y-e.y)*h,this.z=e.z+(o.z-e.z)*h,this}cross(e,o){return o!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,o)):this.crossVectors(this,e)}crossVectors(e,o){const h=e.x,l=e.y,f=e.z,x=o.x,s=o.y,P=o.z;return this.x=l*P-f*s,this.y=f*x-h*P,this.z=h*s-l*x,this}projectOnVector(e){const o=e.lengthSq();if(o===0)return this.set(0,0,0);const h=e.dot(this)/o;return this.copy(e).multiplyScalar(h)}projectOnPlane(e){return TS.copy(this).projectOnVector(e),this.sub(TS)}reflect(e){return this.sub(TS.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const o=Math.sqrt(this.lengthSq()*e.lengthSq());if(o===0)return Math.PI/2;const h=this.dot(e)/o;return Math.acos(Bn.clamp(h,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const o=this.x-e.x,h=this.y-e.y,l=this.z-e.z;return o*o+h*h+l*l}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,o,h){const l=Math.sin(o)*e;return this.x=l*Math.sin(h),this.y=Math.cos(o)*e,this.z=l*Math.cos(h),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,o,h){return this.x=e*Math.sin(o),this.y=h,this.z=e*Math.cos(o),this}setFromMatrixPosition(e){const o=e.elements;return this.x=o[12],this.y=o[13],this.z=o[14],this}setFromMatrixScale(e){const o=this.setFromMatrixColumn(e,0).length(),h=this.setFromMatrixColumn(e,1).length(),l=this.setFromMatrixColumn(e,2).length();return this.x=o,this.y=h,this.z=l,this}setFromMatrixColumn(e,o){return this.fromArray(e.elements,o*4)}setFromMatrix3Column(e,o){return this.fromArray(e.elements,o*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,o=0){return this.x=e[o],this.y=e[o+1],this.z=e[o+2],this}toArray(e=[],o=0){return e[o]=this.x,e[o+1]=this.y,e[o+2]=this.z,e}fromBufferAttribute(e,o,h){return h!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(o),this.y=e.getY(o),this.z=e.getZ(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}He.prototype.isVector3=!0;const TS=new He,XC=new Xs;class tl{constructor(e=new He(1/0,1/0,1/0),o=new He(-1/0,-1/0,-1/0)){this.min=e,this.max=o}set(e,o){return this.min.copy(e),this.max.copy(o),this}setFromArray(e){let o=1/0,h=1/0,l=1/0,f=-1/0,x=-1/0,s=-1/0;for(let P=0,C=e.length;P<C;P+=3){const O=e[P],F=e[P+1],V=e[P+2];O<o&&(o=O),F<h&&(h=F),V<l&&(l=V),O>f&&(f=O),F>x&&(x=F),V>s&&(s=V)}return this.min.set(o,h,l),this.max.set(f,x,s),this}setFromBufferAttribute(e){let o=1/0,h=1/0,l=1/0,f=-1/0,x=-1/0,s=-1/0;for(let P=0,C=e.count;P<C;P++){const O=e.getX(P),F=e.getY(P),V=e.getZ(P);O<o&&(o=O),F<h&&(h=F),V<l&&(l=V),O>f&&(f=O),F>x&&(x=F),V>s&&(s=V)}return this.min.set(o,h,l),this.max.set(f,x,s),this}setFromPoints(e){this.makeEmpty();for(let o=0,h=e.length;o<h;o++)this.expandByPoint(e[o]);return this}setFromCenterAndSize(e,o){const h=Jg.copy(o).multiplyScalar(.5);return this.min.copy(e).sub(h),this.max.copy(e).add(h),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new He),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new He),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const o=e.geometry;o!==void 0&&(o.boundingBox===null&&o.computeBoundingBox(),ES.copy(o.boundingBox),ES.applyMatrix4(e.matrixWorld),this.union(ES));const h=e.children;for(let l=0,f=h.length;l<f;l++)this.expandByObject(h[l]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,o){return o===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),o=new He),o.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Jg),Jg.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let o,h;return e.normal.x>0?(o=e.normal.x*this.min.x,h=e.normal.x*this.max.x):(o=e.normal.x*this.max.x,h=e.normal.x*this.min.x),e.normal.y>0?(o+=e.normal.y*this.min.y,h+=e.normal.y*this.max.y):(o+=e.normal.y*this.max.y,h+=e.normal.y*this.min.y),e.normal.z>0?(o+=e.normal.z*this.min.z,h+=e.normal.z*this.max.z):(o+=e.normal.z*this.max.z,h+=e.normal.z*this.min.z),o<=-e.constant&&h>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Yg),Jx.subVectors(this.max,Yg),$f.subVectors(e.a,Yg),Vf.subVectors(e.b,Yg),jf.subVectors(e.c,Yg),zu.subVectors(Vf,$f),Cu.subVectors(jf,Vf),Kh.subVectors($f,jf);let o=[0,-zu.z,zu.y,0,-Cu.z,Cu.y,0,-Kh.z,Kh.y,zu.z,0,-zu.x,Cu.z,0,-Cu.x,Kh.z,0,-Kh.x,-zu.y,zu.x,0,-Cu.y,Cu.x,0,-Kh.y,Kh.x,0];return!IS(o,$f,Vf,jf,Jx)||(o=[1,0,0,0,1,0,0,0,1],!IS(o,$f,Vf,jf,Jx))?!1:(Yx.crossVectors(zu,Cu),o=[Yx.x,Yx.y,Yx.z],IS(o,$f,Vf,jf,Jx))}clampPoint(e,o){return o===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),o=new He),o.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Jg.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=this.getSize(Jg).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Lc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Lc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Lc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Lc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Lc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Lc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Lc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Lc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Lc),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}tl.prototype.isBox3=!0;const Lc=[new He,new He,new He,new He,new He,new He,new He,new He],Jg=new He,ES=new tl,$f=new He,Vf=new He,jf=new He,zu=new He,Cu=new He,Kh=new He,Yg=new He,Jx=new He,Yx=new He,Qh=new He;function IS(i,e,o,h,l){for(let f=0,x=i.length-3;f<=x;f+=3){Qh.fromArray(i,f);const s=l.x*Math.abs(Qh.x)+l.y*Math.abs(Qh.y)+l.z*Math.abs(Qh.z),P=e.dot(Qh),C=o.dot(Qh),O=h.dot(Qh);if(Math.max(-Math.max(P,C,O),Math.min(P,C,O))>s)return!1}return!0}const sJ=new tl;class Rp{constructor(e=new He,o=-1){this.center=e,this.radius=o}set(e,o){return this.center.copy(e),this.radius=o,this}setFromPoints(e,o){const h=this.center;o!==void 0?h.copy(o):sJ.setFromPoints(e).getCenter(h);let l=0;for(let f=0,x=e.length;f<x;f++)l=Math.max(l,h.distanceToSquared(e[f]));return this.radius=Math.sqrt(l),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const o=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=o*o}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,o){const h=this.center.distanceToSquared(e);return o===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),o=new He),o.copy(e),h>this.radius*this.radius&&(o.sub(this.center).normalize(),o.multiplyScalar(this.radius).add(this.center)),o}getBoundingBox(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new tl),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Rc=new He,MS=new He,Kx=new He,Lu=new He,AS=new He,Qx=new He,PS=new He;class gd{constructor(e=new He,o=new He(0,0,-1)){this.origin=e,this.direction=o}set(e,o){return this.origin.copy(e),this.direction.copy(o),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,o){return o===void 0&&(console.warn("THREE.Ray: .at() target is now required"),o=new He),o.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Rc)),this}closestPointToPoint(e,o){o===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),o=new He),o.subVectors(e,this.origin);const h=o.dot(this.direction);return h<0?o.copy(this.origin):o.copy(this.direction).multiplyScalar(h).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const o=Rc.subVectors(e,this.origin).dot(this.direction);return o<0?this.origin.distanceToSquared(e):(Rc.copy(this.direction).multiplyScalar(o).add(this.origin),Rc.distanceToSquared(e))}distanceSqToSegment(e,o,h,l){MS.copy(e).add(o).multiplyScalar(.5),Kx.copy(o).sub(e).normalize(),Lu.copy(this.origin).sub(MS);const f=e.distanceTo(o)*.5,x=-this.direction.dot(Kx),s=Lu.dot(this.direction),P=-Lu.dot(Kx),C=Lu.lengthSq(),O=Math.abs(1-x*x);let F,V,q,ee;if(O>0)if(F=x*P-s,V=x*s-P,ee=f*O,F>=0)if(V>=-ee)if(V<=ee){const se=1/O;F*=se,V*=se,q=F*(F+x*V+2*s)+V*(x*F+V+2*P)+C}else V=f,F=Math.max(0,-(x*V+s)),q=-F*F+V*(V+2*P)+C;else V=-f,F=Math.max(0,-(x*V+s)),q=-F*F+V*(V+2*P)+C;else V<=-ee?(F=Math.max(0,-(-x*f+s)),V=F>0?-f:Math.min(Math.max(-f,-P),f),q=-F*F+V*(V+2*P)+C):V<=ee?(F=0,V=Math.min(Math.max(-f,-P),f),q=V*(V+2*P)+C):(F=Math.max(0,-(x*f+s)),V=F>0?f:Math.min(Math.max(-f,-P),f),q=-F*F+V*(V+2*P)+C);else V=x>0?-f:f,F=Math.max(0,-(x*V+s)),q=-F*F+V*(V+2*P)+C;return h&&h.copy(this.direction).multiplyScalar(F).add(this.origin),l&&l.copy(Kx).multiplyScalar(V).add(MS),q}intersectSphere(e,o){Rc.subVectors(e.center,this.origin);const h=Rc.dot(this.direction),l=Rc.dot(Rc)-h*h,f=e.radius*e.radius;if(l>f)return null;const x=Math.sqrt(f-l),s=h-x,P=h+x;return s<0&&P<0?null:s<0?this.at(P,o):this.at(s,o)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const o=e.normal.dot(this.direction);if(o===0)return e.distanceToPoint(this.origin)===0?0:null;const h=-(this.origin.dot(e.normal)+e.constant)/o;return h>=0?h:null}intersectPlane(e,o){const h=this.distanceToPlane(e);return h===null?null:this.at(h,o)}intersectsPlane(e){const o=e.distanceToPoint(this.origin);return o===0||e.normal.dot(this.direction)*o<0}intersectBox(e,o){let h,l,f,x,s,P;const C=1/this.direction.x,O=1/this.direction.y,F=1/this.direction.z,V=this.origin;return C>=0?(h=(e.min.x-V.x)*C,l=(e.max.x-V.x)*C):(h=(e.max.x-V.x)*C,l=(e.min.x-V.x)*C),O>=0?(f=(e.min.y-V.y)*O,x=(e.max.y-V.y)*O):(f=(e.max.y-V.y)*O,x=(e.min.y-V.y)*O),h>x||f>l||((f>h||h!==h)&&(h=f),(x<l||l!==l)&&(l=x),F>=0?(s=(e.min.z-V.z)*F,P=(e.max.z-V.z)*F):(s=(e.max.z-V.z)*F,P=(e.min.z-V.z)*F),h>P||s>l)||((s>h||h!==h)&&(h=s),(P<l||l!==l)&&(l=P),l<0)?null:this.at(h>=0?h:l,o)}intersectsBox(e){return this.intersectBox(e,Rc)!==null}intersectTriangle(e,o,h,l,f){AS.subVectors(o,e),Qx.subVectors(h,e),PS.crossVectors(AS,Qx);let x=this.direction.dot(PS),s;if(x>0){if(l)return null;s=1}else if(x<0)s=-1,x=-x;else return null;Lu.subVectors(this.origin,e);const P=s*this.direction.dot(Qx.crossVectors(Lu,Qx));if(P<0)return null;const C=s*this.direction.dot(AS.cross(Lu));if(C<0||P+C>x)return null;const O=-s*Lu.dot(PS);return O<0?null:this.at(O/x,f)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class nn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,o,h,l,f,x,s,P,C,O,F,V,q,ee,se,fe){const ae=this.elements;return ae[0]=e,ae[4]=o,ae[8]=h,ae[12]=l,ae[1]=f,ae[5]=x,ae[9]=s,ae[13]=P,ae[2]=C,ae[6]=O,ae[10]=F,ae[14]=V,ae[3]=q,ae[7]=ee,ae[11]=se,ae[15]=fe,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new nn().fromArray(this.elements)}copy(e){const o=this.elements,h=e.elements;return o[0]=h[0],o[1]=h[1],o[2]=h[2],o[3]=h[3],o[4]=h[4],o[5]=h[5],o[6]=h[6],o[7]=h[7],o[8]=h[8],o[9]=h[9],o[10]=h[10],o[11]=h[11],o[12]=h[12],o[13]=h[13],o[14]=h[14],o[15]=h[15],this}copyPosition(e){const o=this.elements,h=e.elements;return o[12]=h[12],o[13]=h[13],o[14]=h[14],this}setFromMatrix3(e){const o=e.elements;return this.set(o[0],o[3],o[6],0,o[1],o[4],o[7],0,o[2],o[5],o[8],0,0,0,0,1),this}extractBasis(e,o,h){return e.setFromMatrixColumn(this,0),o.setFromMatrixColumn(this,1),h.setFromMatrixColumn(this,2),this}makeBasis(e,o,h){return this.set(e.x,o.x,h.x,0,e.y,o.y,h.y,0,e.z,o.z,h.z,0,0,0,0,1),this}extractRotation(e){const o=this.elements,h=e.elements,l=1/Gf.setFromMatrixColumn(e,0).length(),f=1/Gf.setFromMatrixColumn(e,1).length(),x=1/Gf.setFromMatrixColumn(e,2).length();return o[0]=h[0]*l,o[1]=h[1]*l,o[2]=h[2]*l,o[3]=0,o[4]=h[4]*f,o[5]=h[5]*f,o[6]=h[6]*f,o[7]=0,o[8]=h[8]*x,o[9]=h[9]*x,o[10]=h[10]*x,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const o=this.elements,h=e.x,l=e.y,f=e.z,x=Math.cos(h),s=Math.sin(h),P=Math.cos(l),C=Math.sin(l),O=Math.cos(f),F=Math.sin(f);if(e.order==="XYZ"){const V=x*O,q=x*F,ee=s*O,se=s*F;o[0]=P*O,o[4]=-P*F,o[8]=C,o[1]=q+ee*C,o[5]=V-se*C,o[9]=-s*P,o[2]=se-V*C,o[6]=ee+q*C,o[10]=x*P}else if(e.order==="YXZ"){const V=P*O,q=P*F,ee=C*O,se=C*F;o[0]=V+se*s,o[4]=ee*s-q,o[8]=x*C,o[1]=x*F,o[5]=x*O,o[9]=-s,o[2]=q*s-ee,o[6]=se+V*s,o[10]=x*P}else if(e.order==="ZXY"){const V=P*O,q=P*F,ee=C*O,se=C*F;o[0]=V-se*s,o[4]=-x*F,o[8]=ee+q*s,o[1]=q+ee*s,o[5]=x*O,o[9]=se-V*s,o[2]=-x*C,o[6]=s,o[10]=x*P}else if(e.order==="ZYX"){const V=x*O,q=x*F,ee=s*O,se=s*F;o[0]=P*O,o[4]=ee*C-q,o[8]=V*C+se,o[1]=P*F,o[5]=se*C+V,o[9]=q*C-ee,o[2]=-C,o[6]=s*P,o[10]=x*P}else if(e.order==="YZX"){const V=x*P,q=x*C,ee=s*P,se=s*C;o[0]=P*O,o[4]=se-V*F,o[8]=ee*F+q,o[1]=F,o[5]=x*O,o[9]=-s*O,o[2]=-C*O,o[6]=q*F+ee,o[10]=V-se*F}else if(e.order==="XZY"){const V=x*P,q=x*C,ee=s*P,se=s*C;o[0]=P*O,o[4]=-F,o[8]=C*O,o[1]=V*F+se,o[5]=x*O,o[9]=q*F-ee,o[2]=ee*F-q,o[6]=s*O,o[10]=se*F+V}return o[3]=0,o[7]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromQuaternion(e){return this.compose(aJ,e,lJ)}lookAt(e,o,h){const l=this.elements;return xa.subVectors(e,o),xa.lengthSq()===0&&(xa.z=1),xa.normalize(),Ru.crossVectors(h,xa),Ru.lengthSq()===0&&(Math.abs(h.z)===1?xa.x+=1e-4:xa.z+=1e-4,xa.normalize(),Ru.crossVectors(h,xa)),Ru.normalize(),e0.crossVectors(xa,Ru),l[0]=Ru.x,l[4]=e0.x,l[8]=xa.x,l[1]=Ru.y,l[5]=e0.y,l[9]=xa.y,l[2]=Ru.z,l[6]=e0.z,l[10]=xa.z,this}multiply(e,o){return o!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,o)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,o){const h=e.elements,l=o.elements,f=this.elements,x=h[0],s=h[4],P=h[8],C=h[12],O=h[1],F=h[5],V=h[9],q=h[13],ee=h[2],se=h[6],fe=h[10],ae=h[14],ie=h[3],tt=h[7],Ue=h[11],Ne=h[15],Ce=l[0],Ye=l[4],At=l[8],ft=l[12],wt=l[1],Et=l[5],Dt=l[9],Qe=l[13],ht=l[2],_t=l[6],yt=l[10],Nt=l[14],ei=l[3],mi=l[7],Pi=l[11],Ai=l[15];return f[0]=x*Ce+s*wt+P*ht+C*ei,f[4]=x*Ye+s*Et+P*_t+C*mi,f[8]=x*At+s*Dt+P*yt+C*Pi,f[12]=x*ft+s*Qe+P*Nt+C*Ai,f[1]=O*Ce+F*wt+V*ht+q*ei,f[5]=O*Ye+F*Et+V*_t+q*mi,f[9]=O*At+F*Dt+V*yt+q*Pi,f[13]=O*ft+F*Qe+V*Nt+q*Ai,f[2]=ee*Ce+se*wt+fe*ht+ae*ei,f[6]=ee*Ye+se*Et+fe*_t+ae*mi,f[10]=ee*At+se*Dt+fe*yt+ae*Pi,f[14]=ee*ft+se*Qe+fe*Nt+ae*Ai,f[3]=ie*Ce+tt*wt+Ue*ht+Ne*ei,f[7]=ie*Ye+tt*Et+Ue*_t+Ne*mi,f[11]=ie*At+tt*Dt+Ue*yt+Ne*Pi,f[15]=ie*ft+tt*Qe+Ue*Nt+Ne*Ai,this}multiplyScalar(e){const o=this.elements;return o[0]*=e,o[4]*=e,o[8]*=e,o[12]*=e,o[1]*=e,o[5]*=e,o[9]*=e,o[13]*=e,o[2]*=e,o[6]*=e,o[10]*=e,o[14]*=e,o[3]*=e,o[7]*=e,o[11]*=e,o[15]*=e,this}determinant(){const e=this.elements,o=e[0],h=e[4],l=e[8],f=e[12],x=e[1],s=e[5],P=e[9],C=e[13],O=e[2],F=e[6],V=e[10],q=e[14],ee=e[3],se=e[7],fe=e[11],ae=e[15];return ee*(+f*P*F-l*C*F-f*s*V+h*C*V+l*s*q-h*P*q)+se*(+o*P*q-o*C*V+f*x*V-l*x*q+l*C*O-f*P*O)+fe*(+o*C*F-o*s*q-f*x*F+h*x*q+f*s*O-h*C*O)+ae*(-l*s*O-o*P*F+o*s*V+l*x*F-h*x*V+h*P*O)}transpose(){const e=this.elements;let o;return o=e[1],e[1]=e[4],e[4]=o,o=e[2],e[2]=e[8],e[8]=o,o=e[6],e[6]=e[9],e[9]=o,o=e[3],e[3]=e[12],e[12]=o,o=e[7],e[7]=e[13],e[13]=o,o=e[11],e[11]=e[14],e[14]=o,this}setPosition(e,o,h){const l=this.elements;return e.isVector3?(l[12]=e.x,l[13]=e.y,l[14]=e.z):(l[12]=e,l[13]=o,l[14]=h),this}invert(){const e=this.elements,o=e[0],h=e[1],l=e[2],f=e[3],x=e[4],s=e[5],P=e[6],C=e[7],O=e[8],F=e[9],V=e[10],q=e[11],ee=e[12],se=e[13],fe=e[14],ae=e[15],ie=F*fe*C-se*V*C+se*P*q-s*fe*q-F*P*ae+s*V*ae,tt=ee*V*C-O*fe*C-ee*P*q+x*fe*q+O*P*ae-x*V*ae,Ue=O*se*C-ee*F*C+ee*s*q-x*se*q-O*s*ae+x*F*ae,Ne=ee*F*P-O*se*P-ee*s*V+x*se*V+O*s*fe-x*F*fe,Ce=o*ie+h*tt+l*Ue+f*Ne;if(Ce===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ye=1/Ce;return e[0]=ie*Ye,e[1]=(se*V*f-F*fe*f-se*l*q+h*fe*q+F*l*ae-h*V*ae)*Ye,e[2]=(s*fe*f-se*P*f+se*l*C-h*fe*C-s*l*ae+h*P*ae)*Ye,e[3]=(F*P*f-s*V*f-F*l*C+h*V*C+s*l*q-h*P*q)*Ye,e[4]=tt*Ye,e[5]=(O*fe*f-ee*V*f+ee*l*q-o*fe*q-O*l*ae+o*V*ae)*Ye,e[6]=(ee*P*f-x*fe*f-ee*l*C+o*fe*C+x*l*ae-o*P*ae)*Ye,e[7]=(x*V*f-O*P*f+O*l*C-o*V*C-x*l*q+o*P*q)*Ye,e[8]=Ue*Ye,e[9]=(ee*F*f-O*se*f-ee*h*q+o*se*q+O*h*ae-o*F*ae)*Ye,e[10]=(x*se*f-ee*s*f+ee*h*C-o*se*C-x*h*ae+o*s*ae)*Ye,e[11]=(O*s*f-x*F*f-O*h*C+o*F*C+x*h*q-o*s*q)*Ye,e[12]=Ne*Ye,e[13]=(O*se*l-ee*F*l+ee*h*V-o*se*V-O*h*fe+o*F*fe)*Ye,e[14]=(ee*s*l-x*se*l-ee*h*P+o*se*P+x*h*fe-o*s*fe)*Ye,e[15]=(x*F*l-O*s*l+O*h*P-o*F*P-x*h*V+o*s*V)*Ye,this}scale(e){const o=this.elements,h=e.x,l=e.y,f=e.z;return o[0]*=h,o[4]*=l,o[8]*=f,o[1]*=h,o[5]*=l,o[9]*=f,o[2]*=h,o[6]*=l,o[10]*=f,o[3]*=h,o[7]*=l,o[11]*=f,this}getMaxScaleOnAxis(){const e=this.elements,o=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],h=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],l=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(o,h,l))}makeTranslation(e,o,h){return this.set(1,0,0,e,0,1,0,o,0,0,1,h,0,0,0,1),this}makeRotationX(e){const o=Math.cos(e),h=Math.sin(e);return this.set(1,0,0,0,0,o,-h,0,0,h,o,0,0,0,0,1),this}makeRotationY(e){const o=Math.cos(e),h=Math.sin(e);return this.set(o,0,h,0,0,1,0,0,-h,0,o,0,0,0,0,1),this}makeRotationZ(e){const o=Math.cos(e),h=Math.sin(e);return this.set(o,-h,0,0,h,o,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,o){const h=Math.cos(o),l=Math.sin(o),f=1-h,x=e.x,s=e.y,P=e.z,C=f*x,O=f*s;return this.set(C*x+h,C*s-l*P,C*P+l*s,0,C*s+l*P,O*s+h,O*P-l*x,0,C*P-l*s,O*P+l*x,f*P*P+h,0,0,0,0,1),this}makeScale(e,o,h){return this.set(e,0,0,0,0,o,0,0,0,0,h,0,0,0,0,1),this}makeShear(e,o,h){return this.set(1,o,h,0,e,1,h,0,e,o,1,0,0,0,0,1),this}compose(e,o,h){const l=this.elements,f=o._x,x=o._y,s=o._z,P=o._w,C=f+f,O=x+x,F=s+s,V=f*C,q=f*O,ee=f*F,se=x*O,fe=x*F,ae=s*F,ie=P*C,tt=P*O,Ue=P*F,Ne=h.x,Ce=h.y,Ye=h.z;return l[0]=(1-(se+ae))*Ne,l[1]=(q+Ue)*Ne,l[2]=(ee-tt)*Ne,l[3]=0,l[4]=(q-Ue)*Ce,l[5]=(1-(V+ae))*Ce,l[6]=(fe+ie)*Ce,l[7]=0,l[8]=(ee+tt)*Ye,l[9]=(fe-ie)*Ye,l[10]=(1-(V+se))*Ye,l[11]=0,l[12]=e.x,l[13]=e.y,l[14]=e.z,l[15]=1,this}decompose(e,o,h){const l=this.elements;let f=Gf.set(l[0],l[1],l[2]).length();const x=Gf.set(l[4],l[5],l[6]).length(),s=Gf.set(l[8],l[9],l[10]).length();this.determinant()<0&&(f=-f),e.x=l[12],e.y=l[13],e.z=l[14],vl.copy(this);const C=1/f,O=1/x,F=1/s;return vl.elements[0]*=C,vl.elements[1]*=C,vl.elements[2]*=C,vl.elements[4]*=O,vl.elements[5]*=O,vl.elements[6]*=O,vl.elements[8]*=F,vl.elements[9]*=F,vl.elements[10]*=F,o.setFromRotationMatrix(vl),h.x=f,h.y=x,h.z=s,this}makePerspective(e,o,h,l,f,x){x===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,P=2*f/(o-e),C=2*f/(h-l),O=(o+e)/(o-e),F=(h+l)/(h-l),V=-(x+f)/(x-f),q=-2*x*f/(x-f);return s[0]=P,s[4]=0,s[8]=O,s[12]=0,s[1]=0,s[5]=C,s[9]=F,s[13]=0,s[2]=0,s[6]=0,s[10]=V,s[14]=q,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,o,h,l,f,x){const s=this.elements,P=1/(o-e),C=1/(h-l),O=1/(x-f),F=(o+e)*P,V=(h+l)*C,q=(x+f)*O;return s[0]=2*P,s[4]=0,s[8]=0,s[12]=-F,s[1]=0,s[5]=2*C,s[9]=0,s[13]=-V,s[2]=0,s[6]=0,s[10]=-2*O,s[14]=-q,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const o=this.elements,h=e.elements;for(let l=0;l<16;l++)if(o[l]!==h[l])return!1;return!0}fromArray(e,o=0){for(let h=0;h<16;h++)this.elements[h]=e[h+o];return this}toArray(e=[],o=0){const h=this.elements;return e[o]=h[0],e[o+1]=h[1],e[o+2]=h[2],e[o+3]=h[3],e[o+4]=h[4],e[o+5]=h[5],e[o+6]=h[6],e[o+7]=h[7],e[o+8]=h[8],e[o+9]=h[9],e[o+10]=h[10],e[o+11]=h[11],e[o+12]=h[12],e[o+13]=h[13],e[o+14]=h[14],e[o+15]=h[15],e}}nn.prototype.isMatrix4=!0;const Gf=new He,vl=new nn,aJ=new He(0,0,0),lJ=new He(1,1,1),Ru=new He,e0=new He,xa=new He,JC=new nn,YC=new Xs;class Dp{constructor(e=0,o=0,h=0,l=Dp.DefaultOrder){this._x=e,this._y=o,this._z=h,this._order=l}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,o,h,l){return this._x=e,this._y=o,this._z=h,this._order=l||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,o,h){const l=Bn.clamp,f=e.elements,x=f[0],s=f[4],P=f[8],C=f[1],O=f[5],F=f[9],V=f[2],q=f[6],ee=f[10];switch(o=o||this._order,o){case"XYZ":this._y=Math.asin(l(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(-F,ee),this._z=Math.atan2(-s,x)):(this._x=Math.atan2(q,O),this._z=0);break;case"YXZ":this._x=Math.asin(-l(F,-1,1)),Math.abs(F)<.9999999?(this._y=Math.atan2(P,ee),this._z=Math.atan2(C,O)):(this._y=Math.atan2(-V,x),this._z=0);break;case"ZXY":this._x=Math.asin(l(q,-1,1)),Math.abs(q)<.9999999?(this._y=Math.atan2(-V,ee),this._z=Math.atan2(-s,O)):(this._y=0,this._z=Math.atan2(C,x));break;case"ZYX":this._y=Math.asin(-l(V,-1,1)),Math.abs(V)<.9999999?(this._x=Math.atan2(q,ee),this._z=Math.atan2(C,x)):(this._x=0,this._z=Math.atan2(-s,O));break;case"YZX":this._z=Math.asin(l(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(-F,O),this._y=Math.atan2(-V,x)):(this._x=0,this._y=Math.atan2(P,ee));break;case"XZY":this._z=Math.asin(-l(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(q,O),this._y=Math.atan2(P,x)):(this._x=Math.atan2(-F,ee),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+o)}return this._order=o,h!==!1&&this._onChangeCallback(),this}setFromQuaternion(e,o,h){return JC.makeRotationFromQuaternion(e),this.setFromRotationMatrix(JC,o,h)}setFromVector3(e,o){return this.set(e.x,e.y,e.z,o||this._order)}reorder(e){return YC.setFromEuler(this),this.setFromQuaternion(YC,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],o=0){return e[o]=this._x,e[o+1]=this._y,e[o+2]=this._z,e[o+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new He(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Dp.prototype.isEuler=!0;Dp.DefaultOrder="XYZ";Dp.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class qB{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}}let cJ=0;const KC=new He,Hf=new Xs,Dc=new nn,t0=new He,Kg=new He,uJ=new He,hJ=new Xs,QC=new He(1,0,0),eL=new He(0,1,0),tL=new He(0,0,1),dJ={type:"added"},iL={type:"removed"};function Dn(){Object.defineProperty(this,"id",{value:cJ++}),this.uuid=Bn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Dn.DefaultUp.clone();const i=new He,e=new Dp,o=new Xs,h=new He(1,1,1);function l(){o.setFromEuler(e,!1)}function f(){e.setFromQuaternion(o,void 0,!1)}e._onChange(l),o._onChange(f),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:h},modelViewMatrix:{value:new nn},normalMatrix:{value:new fs}}),this.matrix=new nn,this.matrixWorld=new nn,this.matrixAutoUpdate=Dn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new qB,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Dn.DefaultUp=new He(0,1,0);Dn.DefaultMatrixAutoUpdate=!0;Dn.prototype=Object.assign(Object.create(Yu.prototype),{constructor:Dn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(i){return this.quaternion.premultiply(i),this},setRotationFromAxisAngle:function(i,e){this.quaternion.setFromAxisAngle(i,e)},setRotationFromEuler:function(i){this.quaternion.setFromEuler(i,!0)},setRotationFromMatrix:function(i){this.quaternion.setFromRotationMatrix(i)},setRotationFromQuaternion:function(i){this.quaternion.copy(i)},rotateOnAxis:function(i,e){return Hf.setFromAxisAngle(i,e),this.quaternion.multiply(Hf),this},rotateOnWorldAxis:function(i,e){return Hf.setFromAxisAngle(i,e),this.quaternion.premultiply(Hf),this},rotateX:function(i){return this.rotateOnAxis(QC,i)},rotateY:function(i){return this.rotateOnAxis(eL,i)},rotateZ:function(i){return this.rotateOnAxis(tL,i)},translateOnAxis:function(i,e){return KC.copy(i).applyQuaternion(this.quaternion),this.position.add(KC.multiplyScalar(e)),this},translateX:function(i){return this.translateOnAxis(QC,i)},translateY:function(i){return this.translateOnAxis(eL,i)},translateZ:function(i){return this.translateOnAxis(tL,i)},localToWorld:function(i){return i.applyMatrix4(this.matrixWorld)},worldToLocal:function(i){return i.applyMatrix4(Dc.copy(this.matrixWorld).invert())},lookAt:function(i,e,o){i.isVector3?t0.copy(i):t0.set(i,e,o);const h=this.parent;this.updateWorldMatrix(!0,!1),Kg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Dc.lookAt(Kg,t0,this.up):Dc.lookAt(t0,Kg,this.up),this.quaternion.setFromRotationMatrix(Dc),h&&(Dc.extractRotation(h.matrixWorld),Hf.setFromRotationMatrix(Dc),this.quaternion.premultiply(Hf.invert()))},add:function(i){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.parent!==null&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(dJ)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)},remove:function(i){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.remove(arguments[o]);return this}const e=this.children.indexOf(i);return e!==-1&&(i.parent=null,this.children.splice(e,1),i.dispatchEvent(iL)),this},clear:function(){for(let i=0;i<this.children.length;i++){const e=this.children[i];e.parent=null,e.dispatchEvent(iL)}return this.children.length=0,this},attach:function(i){return this.updateWorldMatrix(!0,!1),Dc.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),Dc.multiply(i.parent.matrixWorld)),i.applyMatrix4(Dc),this.add(i),i.updateWorldMatrix(!1,!0),this},getObjectById:function(i){return this.getObjectByProperty("id",i)},getObjectByName:function(i){return this.getObjectByProperty("name",i)},getObjectByProperty:function(i,e){if(this[i]===e)return this;for(let o=0,h=this.children.length;o<h;o++){const f=this.children[o].getObjectByProperty(i,e);if(f!==void 0)return f}},getWorldPosition:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),i=new He),this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new Xs),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kg,i,uJ),i},getWorldScale:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new He),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kg,hJ,i),i},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),i=new He),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return i.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(i){i(this);const e=this.children;for(let o=0,h=e.length;o<h;o++)e[o].traverse(i)},traverseVisible:function(i){if(this.visible===!1)return;i(this);const e=this.children;for(let o=0,h=e.length;o<h;o++)e[o].traverseVisible(i)},traverseAncestors:function(i){const e=this.parent;e!==null&&(i(e),e.traverseAncestors(i))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);const e=this.children;for(let o=0,h=e.length;o<h;o++)e[o].updateMatrixWorld(i)},updateWorldMatrix:function(i,e){const o=this.parent;if(i===!0&&o!==null&&o.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const h=this.children;for(let l=0,f=h.length;l<f;l++)h[l].updateWorldMatrix(!1,!0)}},toJSON:function(i){const e=i===void 0||typeof i=="string",o={};e&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},o.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const h={};h.uuid=this.uuid,h.type=this.type,this.name!==""&&(h.name=this.name),this.castShadow===!0&&(h.castShadow=!0),this.receiveShadow===!0&&(h.receiveShadow=!0),this.visible===!1&&(h.visible=!1),this.frustumCulled===!1&&(h.frustumCulled=!1),this.renderOrder!==0&&(h.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(h.userData=this.userData),h.layers=this.layers.mask,h.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(h.matrixAutoUpdate=!1),this.isInstancedMesh&&(h.type="InstancedMesh",h.count=this.count,h.instanceMatrix=this.instanceMatrix.toJSON());function l(x,s){return x[s.uuid]===void 0&&(x[s.uuid]=s.toJSON(i)),s.uuid}if(this.isMesh||this.isLine||this.isPoints){h.geometry=l(i.geometries,this.geometry);const x=this.geometry.parameters;if(x!==void 0&&x.shapes!==void 0){const s=x.shapes;if(Array.isArray(s))for(let P=0,C=s.length;P<C;P++){const O=s[P];l(i.shapes,O)}else l(i.shapes,s)}}if(this.isSkinnedMesh&&(h.bindMode=this.bindMode,h.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(i.skeletons,this.skeleton),h.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const x=[];for(let s=0,P=this.material.length;s<P;s++)x.push(l(i.materials,this.material[s]));h.material=x}else h.material=l(i.materials,this.material);if(this.children.length>0){h.children=[];for(let x=0;x<this.children.length;x++)h.children.push(this.children[x].toJSON(i).object)}if(this.animations.length>0){h.animations=[];for(let x=0;x<this.animations.length;x++){const s=this.animations[x];h.animations.push(l(i.animations,s))}}if(e){const x=f(i.geometries),s=f(i.materials),P=f(i.textures),C=f(i.images),O=f(i.shapes),F=f(i.skeletons),V=f(i.animations);x.length>0&&(o.geometries=x),s.length>0&&(o.materials=s),P.length>0&&(o.textures=P),C.length>0&&(o.images=C),O.length>0&&(o.shapes=O),F.length>0&&(o.skeletons=F),V.length>0&&(o.animations=V)}return o.object=h,o;function f(x){const s=[];for(const P in x){const C=x[P];delete C.metadata,s.push(C)}return s}},clone:function(i){return new this.constructor().copy(this,i)},copy:function(i,e=!0){if(this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData=JSON.parse(JSON.stringify(i.userData)),e===!0)for(let o=0;o<i.children.length;o++){const h=i.children[o];this.add(h.clone())}return this}});const zS=new He,fJ=new He,pJ=new fs;class nc{constructor(e=new He(1,0,0),o=0){this.normal=e,this.constant=o}set(e,o){return this.normal.copy(e),this.constant=o,this}setComponents(e,o,h,l){return this.normal.set(e,o,h),this.constant=l,this}setFromNormalAndCoplanarPoint(e,o){return this.normal.copy(e),this.constant=-o.dot(this.normal),this}setFromCoplanarPoints(e,o,h){const l=zS.subVectors(h,o).cross(fJ.subVectors(e,o)).normalize();return this.setFromNormalAndCoplanarPoint(l,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,o){return o===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),o=new He),o.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,o){o===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),o=new He);const h=e.delta(zS),l=this.normal.dot(h);if(l===0)return this.distanceToPoint(e.start)===0?o.copy(e.start):void 0;const f=-(e.start.dot(this.normal)+this.constant)/l;if(!(f<0||f>1))return o.copy(h).multiplyScalar(f).add(e.start)}intersectsLine(e){const o=this.distanceToPoint(e.start),h=this.distanceToPoint(e.end);return o<0&&h>0||h<0&&o>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new He),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,o){const h=o||pJ.getNormalMatrix(e),l=this.coplanarPoint(zS).applyMatrix4(e),f=this.normal.applyMatrix3(h).normalize();return this.constant=-l.dot(f),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}nc.prototype.isPlane=!0;const xl=new He,kc=new He,CS=new He,Oc=new He,Zf=new He,Wf=new He,nL=new He,LS=new He,RS=new He,DS=new He;class Oo{constructor(e=new He,o=new He,h=new He){this.a=e,this.b=o,this.c=h}static getNormal(e,o,h,l){l===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),l=new He),l.subVectors(h,o),xl.subVectors(e,o),l.cross(xl);const f=l.lengthSq();return f>0?l.multiplyScalar(1/Math.sqrt(f)):l.set(0,0,0)}static getBarycoord(e,o,h,l,f){xl.subVectors(l,o),kc.subVectors(h,o),CS.subVectors(e,o);const x=xl.dot(xl),s=xl.dot(kc),P=xl.dot(CS),C=kc.dot(kc),O=kc.dot(CS),F=x*C-s*s;if(f===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),f=new He),F===0)return f.set(-2,-1,-1);const V=1/F,q=(C*P-s*O)*V,ee=(x*O-s*P)*V;return f.set(1-q-ee,ee,q)}static containsPoint(e,o,h,l){return this.getBarycoord(e,o,h,l,Oc),Oc.x>=0&&Oc.y>=0&&Oc.x+Oc.y<=1}static getUV(e,o,h,l,f,x,s,P){return this.getBarycoord(e,o,h,l,Oc),P.set(0,0),P.addScaledVector(f,Oc.x),P.addScaledVector(x,Oc.y),P.addScaledVector(s,Oc.z),P}static isFrontFacing(e,o,h,l){return xl.subVectors(h,o),kc.subVectors(e,o),xl.cross(kc).dot(l)<0}set(e,o,h){return this.a.copy(e),this.b.copy(o),this.c.copy(h),this}setFromPointsAndIndices(e,o,h,l){return this.a.copy(e[o]),this.b.copy(e[h]),this.c.copy(e[l]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return xl.subVectors(this.c,this.b),kc.subVectors(this.a,this.b),xl.cross(kc).length()*.5}getMidpoint(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new He),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Oo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new nc),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,o){return Oo.getBarycoord(e,this.a,this.b,this.c,o)}getUV(e,o,h,l,f){return Oo.getUV(e,this.a,this.b,this.c,o,h,l,f)}containsPoint(e){return Oo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Oo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,o){o===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),o=new He);const h=this.a,l=this.b,f=this.c;let x,s;Zf.subVectors(l,h),Wf.subVectors(f,h),LS.subVectors(e,h);const P=Zf.dot(LS),C=Wf.dot(LS);if(P<=0&&C<=0)return o.copy(h);RS.subVectors(e,l);const O=Zf.dot(RS),F=Wf.dot(RS);if(O>=0&&F<=O)return o.copy(l);const V=P*F-O*C;if(V<=0&&P>=0&&O<=0)return x=P/(P-O),o.copy(h).addScaledVector(Zf,x);DS.subVectors(e,f);const q=Zf.dot(DS),ee=Wf.dot(DS);if(ee>=0&&q<=ee)return o.copy(f);const se=q*C-P*ee;if(se<=0&&C>=0&&ee<=0)return s=C/(C-ee),o.copy(h).addScaledVector(Wf,s);const fe=O*ee-q*F;if(fe<=0&&F-O>=0&&q-ee>=0)return nL.subVectors(f,l),s=(F-O)/(F-O+(q-ee)),o.copy(l).addScaledVector(nL,s);const ae=1/(fe+se+V);return x=se*ae,s=V*ae,o.copy(h).addScaledVector(Zf,x).addScaledVector(Wf,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let mJ=0;function fo(){Object.defineProperty(this,"id",{value:mJ++}),this.uuid=Bn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=h_,this.side=ew,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=jB,this.blendDst=GB,this.blendEquation=op,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=lT,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=nJ,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=wS,this.stencilZFail=wS,this.stencilZPass=wS,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}fo.prototype=Object.assign(Object.create(Yu.prototype),{constructor:fo,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(i){if(i!==void 0)for(const e in i){const o=i[e];if(o===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=o===VB;continue}const h=this[e];if(h===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}h&&h.isColor?h.set(o):h&&h.isVector3&&o&&o.isVector3?h.copy(o):this[e]=o}},toJSON:function(i){const e=i===void 0||typeof i=="string";e&&(i={textures:{},images:{}});const o={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.color&&this.color.isColor&&(o.color=this.color.getHex()),this.roughness!==void 0&&(o.roughness=this.roughness),this.metalness!==void 0&&(o.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(o.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(o.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(o.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(o.specular=this.specular.getHex()),this.shininess!==void 0&&(o.shininess=this.shininess),this.clearcoat!==void 0&&(o.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(o.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(o.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(o.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(o.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,o.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(o.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(o.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(o.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(o.lightMap=this.lightMap.toJSON(i).uuid,o.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(o.aoMap=this.aoMap.toJSON(i).uuid,o.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(o.bumpMap=this.bumpMap.toJSON(i).uuid,o.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(o.normalMap=this.normalMap.toJSON(i).uuid,o.normalMapType=this.normalMapType,o.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(o.displacementMap=this.displacementMap.toJSON(i).uuid,o.displacementScale=this.displacementScale,o.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(o.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(o.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(o.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(o.specularMap=this.specularMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(o.envMap=this.envMap.toJSON(i).uuid,o.reflectivity=this.reflectivity,o.refractionRatio=this.refractionRatio,this.combine!==void 0&&(o.combine=this.combine),this.envMapIntensity!==void 0&&(o.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(o.gradientMap=this.gradientMap.toJSON(i).uuid),this.size!==void 0&&(o.size=this.size),this.sizeAttenuation!==void 0&&(o.sizeAttenuation=this.sizeAttenuation),this.blending!==h_&&(o.blending=this.blending),this.side!==ew&&(o.side=this.side),this.vertexColors&&(o.vertexColors=!0),this.opacity<1&&(o.opacity=this.opacity),this.transparent===!0&&(o.transparent=this.transparent),o.depthFunc=this.depthFunc,o.depthTest=this.depthTest,o.depthWrite=this.depthWrite,o.stencilWrite=this.stencilWrite,o.stencilWriteMask=this.stencilWriteMask,o.stencilFunc=this.stencilFunc,o.stencilRef=this.stencilRef,o.stencilFuncMask=this.stencilFuncMask,o.stencilFail=this.stencilFail,o.stencilZFail=this.stencilZFail,o.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(o.rotation=this.rotation),this.polygonOffset===!0&&(o.polygonOffset=!0),this.polygonOffsetFactor!==0&&(o.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(o.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(o.linewidth=this.linewidth),this.dashSize!==void 0&&(o.dashSize=this.dashSize),this.gapSize!==void 0&&(o.gapSize=this.gapSize),this.scale!==void 0&&(o.scale=this.scale),this.dithering===!0&&(o.dithering=!0),this.alphaTest>0&&(o.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(o.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(o.wireframe=this.wireframe),this.wireframeLinewidth>1&&(o.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(o.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(o.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(o.morphTargets=!0),this.morphNormals===!0&&(o.morphNormals=!0),this.skinning===!0&&(o.skinning=!0),this.flatShading===!0&&(o.flatShading=this.flatShading),this.visible===!1&&(o.visible=!1),this.toneMapped===!1&&(o.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(o.userData=this.userData);function h(l){const f=[];for(const x in l){const s=l[x];delete s.metadata,f.push(s)}return f}if(e){const l=h(i.textures),f=h(i.images);l.length>0&&(o.textures=l),f.length>0&&(o.images=f)}return o},clone:function(){return new this.constructor().copy(this)},copy:function(i){this.name=i.name,this.fog=i.fog,this.blending=i.blending,this.side=i.side,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;const e=i.clippingPlanes;let o=null;if(e!==null){const h=e.length;o=new Array(h);for(let l=0;l!==h;++l)o[l]=e[l].clone()}return this.clippingPlanes=o,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData=JSON.parse(JSON.stringify(i.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(fo.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});const XB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},bl={h:0,s:0,l:0},i0={h:0,s:0,l:0};function kS(i,e,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?i+(e-i)*6*o:o<1/2?e:o<2/3?i+(e-i)*6*(2/3-o):i}function OS(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function FS(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}class mn{constructor(e,o,h){return o===void 0&&h===void 0?this.set(e):this.setRGB(e,o,h)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,o,h){return this.r=e,this.g=o,this.b=h,this}setHSL(e,o,h){if(e=Bn.euclideanModulo(e,1),o=Bn.clamp(o,0,1),h=Bn.clamp(h,0,1),o===0)this.r=this.g=this.b=h;else{const l=h<=.5?h*(1+o):h+o-h*o,f=2*h-l;this.r=kS(f,l,e+1/3),this.g=kS(f,l,e),this.b=kS(f,l,e-1/3)}return this}setStyle(e){function o(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let h;if(h=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let l;const f=h[1],x=h[2];switch(f){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(x))return this.r=Math.min(255,parseInt(l[1],10))/255,this.g=Math.min(255,parseInt(l[2],10))/255,this.b=Math.min(255,parseInt(l[3],10))/255,o(l[4]),this;if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(x))return this.r=Math.min(100,parseInt(l[1],10))/100,this.g=Math.min(100,parseInt(l[2],10))/100,this.b=Math.min(100,parseInt(l[3],10))/100,o(l[4]),this;break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(x)){const s=parseFloat(l[1])/360,P=parseInt(l[2],10)/100,C=parseInt(l[3],10)/100;return o(l[4]),this.setHSL(s,P,C)}break}}else if(h=/^\#([A-Fa-f\d]+)$/.exec(e)){const l=h[1],f=l.length;if(f===3)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(f===6)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const o=XB[e];return o!==void 0?this.setHex(o):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,o=2){return this.r=Math.pow(e.r,o),this.g=Math.pow(e.g,o),this.b=Math.pow(e.b,o),this}copyLinearToGamma(e,o=2){const h=o>0?1/o:1;return this.r=Math.pow(e.r,h),this.g=Math.pow(e.g,h),this.b=Math.pow(e.b,h),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=OS(e.r),this.g=OS(e.g),this.b=OS(e.b),this}copyLinearToSRGB(e){return this.r=FS(e.r),this.g=FS(e.g),this.b=FS(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const o=this.r,h=this.g,l=this.b,f=Math.max(o,h,l),x=Math.min(o,h,l);let s,P;const C=(x+f)/2;if(x===f)s=0,P=0;else{const O=f-x;switch(P=C<=.5?O/(f+x):O/(2-f-x),f){case o:s=(h-l)/O+(h<l?6:0);break;case h:s=(l-o)/O+2;break;case l:s=(o-h)/O+4;break}s/=6}return e.h=s,e.s=P,e.l=C,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,o,h){return this.getHSL(bl),bl.h+=e,bl.s+=o,bl.l+=h,this.setHSL(bl.h,bl.s,bl.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,o){return this.r=e.r+o.r,this.g=e.g+o.g,this.b=e.b+o.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,o){return this.r+=(e.r-this.r)*o,this.g+=(e.g-this.g)*o,this.b+=(e.b-this.b)*o,this}lerpColors(e,o,h){return this.r=e.r+(o.r-e.r)*h,this.g=e.g+(o.g-e.g)*h,this.b=e.b+(o.b-e.b)*h,this}lerpHSL(e,o){this.getHSL(bl),e.getHSL(i0);const h=Bn.lerp(bl.h,i0.h,o),l=Bn.lerp(bl.s,i0.s,o),f=Bn.lerp(bl.l,i0.l,o);return this.setHSL(h,l,f),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,o=0){return this.r=e[o],this.g=e[o+1],this.b=e[o+2],this}toArray(e=[],o=0){return e[o]=this.r,e[o+1]=this.g,e[o+2]=this.b,e}fromBufferAttribute(e,o){return this.r=e.getX(o),this.g=e.getY(o),this.b=e.getZ(o),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}mn.NAMES=XB;mn.prototype.isColor=!0;mn.prototype.r=1;mn.prototype.g=1;mn.prototype.b=1;class h2 extends fo{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new mn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=iw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this}}h2.prototype.isMeshBasicMaterial=!0;const Vr=new He,n0=new gi;function qn(i,e,o){if(Array.isArray(i))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=i,this.itemSize=e,this.count=i!==void 0?i.length/e:0,this.normalized=o===!0,this.usage=rw,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(qn.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});Object.assign(qn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this},copyAt:function(i,e,o){i*=this.itemSize,o*=e.itemSize;for(let h=0,l=this.itemSize;h<l;h++)this.array[i+h]=e.array[o+h];return this},copyArray:function(i){return this.array.set(i),this},copyColorsArray:function(i){const e=this.array;let o=0;for(let h=0,l=i.length;h<l;h++){let f=i[h];f===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",h),f=new mn),e[o++]=f.r,e[o++]=f.g,e[o++]=f.b}return this},copyVector2sArray:function(i){const e=this.array;let o=0;for(let h=0,l=i.length;h<l;h++){let f=i[h];f===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",h),f=new gi),e[o++]=f.x,e[o++]=f.y}return this},copyVector3sArray:function(i){const e=this.array;let o=0;for(let h=0,l=i.length;h<l;h++){let f=i[h];f===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",h),f=new He),e[o++]=f.x,e[o++]=f.y,e[o++]=f.z}return this},copyVector4sArray:function(i){const e=this.array;let o=0;for(let h=0,l=i.length;h<l;h++){let f=i[h];f===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",h),f=new Lr),e[o++]=f.x,e[o++]=f.y,e[o++]=f.z,e[o++]=f.w}return this},applyMatrix3:function(i){if(this.itemSize===2)for(let e=0,o=this.count;e<o;e++)n0.fromBufferAttribute(this,e),n0.applyMatrix3(i),this.setXY(e,n0.x,n0.y);else if(this.itemSize===3)for(let e=0,o=this.count;e<o;e++)Vr.fromBufferAttribute(this,e),Vr.applyMatrix3(i),this.setXYZ(e,Vr.x,Vr.y,Vr.z);return this},applyMatrix4:function(i){for(let e=0,o=this.count;e<o;e++)Vr.x=this.getX(e),Vr.y=this.getY(e),Vr.z=this.getZ(e),Vr.applyMatrix4(i),this.setXYZ(e,Vr.x,Vr.y,Vr.z);return this},applyNormalMatrix:function(i){for(let e=0,o=this.count;e<o;e++)Vr.x=this.getX(e),Vr.y=this.getY(e),Vr.z=this.getZ(e),Vr.applyNormalMatrix(i),this.setXYZ(e,Vr.x,Vr.y,Vr.z);return this},transformDirection:function(i){for(let e=0,o=this.count;e<o;e++)Vr.x=this.getX(e),Vr.y=this.getY(e),Vr.z=this.getZ(e),Vr.transformDirection(i),this.setXYZ(e,Vr.x,Vr.y,Vr.z);return this},set:function(i,e=0){return this.array.set(i,e),this},getX:function(i){return this.array[i*this.itemSize]},setX:function(i,e){return this.array[i*this.itemSize]=e,this},getY:function(i){return this.array[i*this.itemSize+1]},setY:function(i,e){return this.array[i*this.itemSize+1]=e,this},getZ:function(i){return this.array[i*this.itemSize+2]},setZ:function(i,e){return this.array[i*this.itemSize+2]=e,this},getW:function(i){return this.array[i*this.itemSize+3]},setW:function(i,e){return this.array[i*this.itemSize+3]=e,this},setXY:function(i,e,o){return i*=this.itemSize,this.array[i+0]=e,this.array[i+1]=o,this},setXYZ:function(i,e,o,h){return i*=this.itemSize,this.array[i+0]=e,this.array[i+1]=o,this.array[i+2]=h,this},setXYZW:function(i,e,o,h,l){return i*=this.itemSize,this.array[i+0]=e,this.array[i+1]=o,this.array[i+2]=h,this.array[i+3]=l,this},onUpload:function(i){return this.onUploadCallback=i,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function hT(i,e,o){qn.call(this,new Int8Array(i),e,o)}hT.prototype=Object.create(qn.prototype);hT.prototype.constructor=hT;function dT(i,e,o){qn.call(this,new Uint8Array(i),e,o)}dT.prototype=Object.create(qn.prototype);dT.prototype.constructor=dT;function fT(i,e,o){qn.call(this,new Uint8ClampedArray(i),e,o)}fT.prototype=Object.create(qn.prototype);fT.prototype.constructor=fT;function pT(i,e,o){qn.call(this,new Int16Array(i),e,o)}pT.prototype=Object.create(qn.prototype);pT.prototype.constructor=pT;function C_(i,e,o){qn.call(this,new Uint16Array(i),e,o)}C_.prototype=Object.create(qn.prototype);C_.prototype.constructor=C_;function mT(i,e,o){qn.call(this,new Int32Array(i),e,o)}mT.prototype=Object.create(qn.prototype);mT.prototype.constructor=mT;function L_(i,e,o){qn.call(this,new Uint32Array(i),e,o)}L_.prototype=Object.create(qn.prototype);L_.prototype.constructor=L_;function W0(i,e,o){qn.call(this,new Uint16Array(i),e,o)}W0.prototype=Object.create(qn.prototype);W0.prototype.constructor=W0;W0.prototype.isFloat16BufferAttribute=!0;function Or(i,e,o){qn.call(this,new Float32Array(i),e,o)}Or.prototype=Object.create(qn.prototype);Or.prototype.constructor=Or;function gT(i,e,o){qn.call(this,new Float64Array(i),e,o)}gT.prototype=Object.create(qn.prototype);gT.prototype.constructor=gT;function JB(i){if(i.length===0)return-1/0;let e=i[0];for(let o=1,h=i.length;o<h;++o)i[o]>e&&(e=i[o]);return e}let gJ=0;const tc=new nn,BS=new Dn,qf=new He,ba=new tl,Qg=new tl,Xo=new He;function _r(){Object.defineProperty(this,"id",{value:gJ++}),this.uuid=Bn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}_r.prototype=Object.assign(Object.create(Yu.prototype),{constructor:_r,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(i){return Array.isArray(i)?this.index=new(JB(i)>65535?L_:C_)(i,1):this.index=i,this},getAttribute:function(i){return this.attributes[i]},setAttribute:function(i,e){return this.attributes[i]=e,this},deleteAttribute:function(i){return delete this.attributes[i],this},hasAttribute:function(i){return this.attributes[i]!==void 0},addGroup:function(i,e,o=0){this.groups.push({start:i,count:e,materialIndex:o})},clearGroups:function(){this.groups=[]},setDrawRange:function(i,e){this.drawRange.start=i,this.drawRange.count=e},applyMatrix4:function(i){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(i),e.needsUpdate=!0);const o=this.attributes.normal;if(o!==void 0){const l=new fs().getNormalMatrix(i);o.applyNormalMatrix(l),o.needsUpdate=!0}const h=this.attributes.tangent;return h!==void 0&&(h.transformDirection(i),h.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(i){return tc.makeRotationX(i),this.applyMatrix4(tc),this},rotateY:function(i){return tc.makeRotationY(i),this.applyMatrix4(tc),this},rotateZ:function(i){return tc.makeRotationZ(i),this.applyMatrix4(tc),this},translate:function(i,e,o){return tc.makeTranslation(i,e,o),this.applyMatrix4(tc),this},scale:function(i,e,o){return tc.makeScale(i,e,o),this.applyMatrix4(tc),this},lookAt:function(i){return BS.lookAt(i),BS.updateMatrix(),this.applyMatrix4(BS.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(qf).negate(),this.translate(qf.x,qf.y,qf.z),this},setFromPoints:function(i){const e=[];for(let o=0,h=i.length;o<h;o++){const l=i[o];e.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new Or(e,3)),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new tl);const i=this.attributes.position,e=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new He(-1/0,-1/0,-1/0),new He(1/0,1/0,1/0));return}if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),e)for(let o=0,h=e.length;o<h;o++){const l=e[o];ba.setFromBufferAttribute(l),this.morphTargetsRelative?(Xo.addVectors(this.boundingBox.min,ba.min),this.boundingBox.expandByPoint(Xo),Xo.addVectors(this.boundingBox.max,ba.max),this.boundingBox.expandByPoint(Xo)):(this.boundingBox.expandByPoint(ba.min),this.boundingBox.expandByPoint(ba.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Rp);const i=this.attributes.position,e=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new He,1/0);return}if(i){const o=this.boundingSphere.center;if(ba.setFromBufferAttribute(i),e)for(let l=0,f=e.length;l<f;l++){const x=e[l];Qg.setFromBufferAttribute(x),this.morphTargetsRelative?(Xo.addVectors(ba.min,Qg.min),ba.expandByPoint(Xo),Xo.addVectors(ba.max,Qg.max),ba.expandByPoint(Xo)):(ba.expandByPoint(Qg.min),ba.expandByPoint(Qg.max))}ba.getCenter(o);let h=0;for(let l=0,f=i.count;l<f;l++)Xo.fromBufferAttribute(i,l),h=Math.max(h,o.distanceToSquared(Xo));if(e)for(let l=0,f=e.length;l<f;l++){const x=e[l],s=this.morphTargetsRelative;for(let P=0,C=x.count;P<C;P++)Xo.fromBufferAttribute(x,P),s&&(qf.fromBufferAttribute(i,P),Xo.add(qf)),h=Math.max(h,o.distanceToSquared(Xo))}this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){const i=this.index,e=this.attributes;if(i===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const o=i.array,h=e.position.array,l=e.normal.array,f=e.uv.array,x=h.length/3;e.tangent===void 0&&this.setAttribute("tangent",new qn(new Float32Array(4*x),4));const s=e.tangent.array,P=[],C=[];for(let ft=0;ft<x;ft++)P[ft]=new He,C[ft]=new He;const O=new He,F=new He,V=new He,q=new gi,ee=new gi,se=new gi,fe=new He,ae=new He;function ie(ft,wt,Et){O.fromArray(h,ft*3),F.fromArray(h,wt*3),V.fromArray(h,Et*3),q.fromArray(f,ft*2),ee.fromArray(f,wt*2),se.fromArray(f,Et*2),F.sub(O),V.sub(O),ee.sub(q),se.sub(q);const Dt=1/(ee.x*se.y-se.x*ee.y);isFinite(Dt)&&(fe.copy(F).multiplyScalar(se.y).addScaledVector(V,-ee.y).multiplyScalar(Dt),ae.copy(V).multiplyScalar(ee.x).addScaledVector(F,-se.x).multiplyScalar(Dt),P[ft].add(fe),P[wt].add(fe),P[Et].add(fe),C[ft].add(ae),C[wt].add(ae),C[Et].add(ae))}let tt=this.groups;tt.length===0&&(tt=[{start:0,count:o.length}]);for(let ft=0,wt=tt.length;ft<wt;++ft){const Et=tt[ft],Dt=Et.start,Qe=Et.count;for(let ht=Dt,_t=Dt+Qe;ht<_t;ht+=3)ie(o[ht+0],o[ht+1],o[ht+2])}const Ue=new He,Ne=new He,Ce=new He,Ye=new He;function At(ft){Ce.fromArray(l,ft*3),Ye.copy(Ce);const wt=P[ft];Ue.copy(wt),Ue.sub(Ce.multiplyScalar(Ce.dot(wt))).normalize(),Ne.crossVectors(Ye,wt);const Dt=Ne.dot(C[ft])<0?-1:1;s[ft*4]=Ue.x,s[ft*4+1]=Ue.y,s[ft*4+2]=Ue.z,s[ft*4+3]=Dt}for(let ft=0,wt=tt.length;ft<wt;++ft){const Et=tt[ft],Dt=Et.start,Qe=Et.count;for(let ht=Dt,_t=Dt+Qe;ht<_t;ht+=3)At(o[ht+0]),At(o[ht+1]),At(o[ht+2])}},computeVertexNormals:function(){const i=this.index,e=this.getAttribute("position");if(e!==void 0){let o=this.getAttribute("normal");if(o===void 0)o=new qn(new Float32Array(e.count*3),3),this.setAttribute("normal",o);else for(let F=0,V=o.count;F<V;F++)o.setXYZ(F,0,0,0);const h=new He,l=new He,f=new He,x=new He,s=new He,P=new He,C=new He,O=new He;if(i)for(let F=0,V=i.count;F<V;F+=3){const q=i.getX(F+0),ee=i.getX(F+1),se=i.getX(F+2);h.fromBufferAttribute(e,q),l.fromBufferAttribute(e,ee),f.fromBufferAttribute(e,se),C.subVectors(f,l),O.subVectors(h,l),C.cross(O),x.fromBufferAttribute(o,q),s.fromBufferAttribute(o,ee),P.fromBufferAttribute(o,se),x.add(C),s.add(C),P.add(C),o.setXYZ(q,x.x,x.y,x.z),o.setXYZ(ee,s.x,s.y,s.z),o.setXYZ(se,P.x,P.y,P.z)}else for(let F=0,V=e.count;F<V;F+=3)h.fromBufferAttribute(e,F+0),l.fromBufferAttribute(e,F+1),f.fromBufferAttribute(e,F+2),C.subVectors(f,l),O.subVectors(h,l),C.cross(O),o.setXYZ(F+0,C.x,C.y,C.z),o.setXYZ(F+1,C.x,C.y,C.z),o.setXYZ(F+2,C.x,C.y,C.z);this.normalizeNormals(),o.needsUpdate=!0}},merge:function(i,e){if(!(i&&i.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",i);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const o=this.attributes;for(const h in o){if(i.attributes[h]===void 0)continue;const f=o[h].array,x=i.attributes[h],s=x.array,P=x.itemSize*e,C=Math.min(s.length,f.length-P);for(let O=0,F=P;O<C;O++,F++)f[F]=s[O]}return this},normalizeNormals:function(){const i=this.attributes.normal;for(let e=0,o=i.count;e<o;e++)Xo.fromBufferAttribute(i,e),Xo.normalize(),i.setXYZ(e,Xo.x,Xo.y,Xo.z)},toNonIndexed:function(){function i(x,s){const P=x.array,C=x.itemSize,O=x.normalized,F=new P.constructor(s.length*C);let V=0,q=0;for(let ee=0,se=s.length;ee<se;ee++){V=s[ee]*C;for(let fe=0;fe<C;fe++)F[q++]=P[V++]}return new qn(F,C,O)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new _r,o=this.index.array,h=this.attributes;for(const x in h){const s=h[x],P=i(s,o);e.setAttribute(x,P)}const l=this.morphAttributes;for(const x in l){const s=[],P=l[x];for(let C=0,O=P.length;C<O;C++){const F=P[C],V=i(F,o);s.push(V)}e.morphAttributes[x]=s}e.morphTargetsRelative=this.morphTargetsRelative;const f=this.groups;for(let x=0,s=f.length;x<s;x++){const P=f[x];e.addGroup(P.start,P.count,P.materialIndex)}return e},toJSON:function(){const i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){const s=this.parameters;for(const P in s)s[P]!==void 0&&(i[P]=s[P]);return i}i.data={attributes:{}};const e=this.index;e!==null&&(i.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const o=this.attributes;for(const s in o){const P=o[s],C=P.toJSON(i.data);P.name!==""&&(C.name=P.name),i.data.attributes[s]=C}const h={};let l=!1;for(const s in this.morphAttributes){const P=this.morphAttributes[s],C=[];for(let O=0,F=P.length;O<F;O++){const V=P[O],q=V.toJSON(i.data);V.name!==""&&(q.name=V.name),C.push(q)}C.length>0&&(h[s]=C,l=!0)}l&&(i.data.morphAttributes=h,i.data.morphTargetsRelative=this.morphTargetsRelative);const f=this.groups;f.length>0&&(i.data.groups=JSON.parse(JSON.stringify(f)));const x=this.boundingSphere;return x!==null&&(i.data.boundingSphere={center:x.center.toArray(),radius:x.radius}),i},clone:function(){return new _r().copy(this)},copy:function(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=i.name;const o=i.index;o!==null&&this.setIndex(o.clone(e));const h=i.attributes;for(const P in h){const C=h[P];this.setAttribute(P,C.clone(e))}const l=i.morphAttributes;for(const P in l){const C=[],O=l[P];for(let F=0,V=O.length;F<V;F++)C.push(O[F].clone(e));this.morphAttributes[P]=C}this.morphTargetsRelative=i.morphTargetsRelative;const f=i.groups;for(let P=0,C=f.length;P<C;P++){const O=f[P];this.addGroup(O.start,O.count,O.materialIndex)}const x=i.boundingBox;x!==null&&(this.boundingBox=x.clone());const s=i.boundingSphere;return s!==null&&(this.boundingSphere=s.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const rL=new nn,Xf=new gd,NS=new Rp,Du=new He,ku=new He,Ou=new He,US=new He,$S=new He,VS=new He,r0=new He,o0=new He,s0=new He,a0=new gi,l0=new gi,c0=new gi,jS=new He,u0=new He;function lr(i=new _r,e=new h2){Dn.call(this),this.type="Mesh",this.geometry=i,this.material=e,this.updateMorphTargets()}lr.prototype=Object.assign(Object.create(Dn.prototype),{constructor:lr,isMesh:!0,copy:function(i){return Dn.prototype.copy.call(this,i),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const e=i.morphAttributes,o=Object.keys(e);if(o.length>0){const h=e[o[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,f=h.length;l<f;l++){const x=h[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[x]=l}}}}else{const e=i.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(i,e){const o=this.geometry,h=this.material,l=this.matrixWorld;if(h===void 0||(o.boundingSphere===null&&o.computeBoundingSphere(),NS.copy(o.boundingSphere),NS.applyMatrix4(l),i.ray.intersectsSphere(NS)===!1)||(rL.copy(l).invert(),Xf.copy(i.ray).applyMatrix4(rL),o.boundingBox!==null&&Xf.intersectsBox(o.boundingBox)===!1))return;let f;if(o.isBufferGeometry){const x=o.index,s=o.attributes.position,P=o.morphAttributes.position,C=o.morphTargetsRelative,O=o.attributes.uv,F=o.attributes.uv2,V=o.groups,q=o.drawRange;if(x!==null)if(Array.isArray(h))for(let ee=0,se=V.length;ee<se;ee++){const fe=V[ee],ae=h[fe.materialIndex],ie=Math.max(fe.start,q.start),tt=Math.min(fe.start+fe.count,q.start+q.count);for(let Ue=ie,Ne=tt;Ue<Ne;Ue+=3){const Ce=x.getX(Ue),Ye=x.getX(Ue+1),At=x.getX(Ue+2);f=h0(this,ae,i,Xf,s,P,C,O,F,Ce,Ye,At),f&&(f.faceIndex=Math.floor(Ue/3),f.face.materialIndex=fe.materialIndex,e.push(f))}}else{const ee=Math.max(0,q.start),se=Math.min(x.count,q.start+q.count);for(let fe=ee,ae=se;fe<ae;fe+=3){const ie=x.getX(fe),tt=x.getX(fe+1),Ue=x.getX(fe+2);f=h0(this,h,i,Xf,s,P,C,O,F,ie,tt,Ue),f&&(f.faceIndex=Math.floor(fe/3),e.push(f))}}else if(s!==void 0)if(Array.isArray(h))for(let ee=0,se=V.length;ee<se;ee++){const fe=V[ee],ae=h[fe.materialIndex],ie=Math.max(fe.start,q.start),tt=Math.min(fe.start+fe.count,q.start+q.count);for(let Ue=ie,Ne=tt;Ue<Ne;Ue+=3){const Ce=Ue,Ye=Ue+1,At=Ue+2;f=h0(this,ae,i,Xf,s,P,C,O,F,Ce,Ye,At),f&&(f.faceIndex=Math.floor(Ue/3),f.face.materialIndex=fe.materialIndex,e.push(f))}}else{const ee=Math.max(0,q.start),se=Math.min(s.count,q.start+q.count);for(let fe=ee,ae=se;fe<ae;fe+=3){const ie=fe,tt=fe+1,Ue=fe+2;f=h0(this,h,i,Xf,s,P,C,O,F,ie,tt,Ue),f&&(f.faceIndex=Math.floor(fe/3),e.push(f))}}}else o.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});function _J(i,e,o,h,l,f,x,s){let P;if(e.side===Yo?P=h.intersectTriangle(x,f,l,!0,s):P=h.intersectTriangle(l,f,x,e.side!==tw,s),P===null)return null;u0.copy(s),u0.applyMatrix4(i.matrixWorld);const C=o.ray.origin.distanceTo(u0);return C<o.near||C>o.far?null:{distance:C,point:u0.clone(),object:i}}function h0(i,e,o,h,l,f,x,s,P,C,O,F){Du.fromBufferAttribute(l,C),ku.fromBufferAttribute(l,O),Ou.fromBufferAttribute(l,F);const V=i.morphTargetInfluences;if(e.morphTargets&&f&&V){r0.set(0,0,0),o0.set(0,0,0),s0.set(0,0,0);for(let ee=0,se=f.length;ee<se;ee++){const fe=V[ee],ae=f[ee];fe!==0&&(US.fromBufferAttribute(ae,C),$S.fromBufferAttribute(ae,O),VS.fromBufferAttribute(ae,F),x?(r0.addScaledVector(US,fe),o0.addScaledVector($S,fe),s0.addScaledVector(VS,fe)):(r0.addScaledVector(US.sub(Du),fe),o0.addScaledVector($S.sub(ku),fe),s0.addScaledVector(VS.sub(Ou),fe)))}Du.add(r0),ku.add(o0),Ou.add(s0)}i.isSkinnedMesh&&e.skinning&&(i.boneTransform(C,Du),i.boneTransform(O,ku),i.boneTransform(F,Ou));const q=_J(i,e,o,h,Du,ku,Ou,jS);if(q){s&&(a0.fromBufferAttribute(s,C),l0.fromBufferAttribute(s,O),c0.fromBufferAttribute(s,F),q.uv=Oo.getUV(jS,Du,ku,Ou,a0,l0,c0,new gi)),P&&(a0.fromBufferAttribute(P,C),l0.fromBufferAttribute(P,O),c0.fromBufferAttribute(P,F),q.uv2=Oo.getUV(jS,Du,ku,Ou,a0,l0,c0,new gi));const ee={a:C,b:O,c:F,normal:new He,materialIndex:0};Oo.getNormal(Du,ku,Ou,ee.normal),q.face=ee}return q}class Jo extends _r{constructor(e=1,o=1,h=1,l=1,f=1,x=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:o,depth:h,widthSegments:l,heightSegments:f,depthSegments:x};const s=this;l=Math.floor(l),f=Math.floor(f),x=Math.floor(x);const P=[],C=[],O=[],F=[];let V=0,q=0;ee("z","y","x",-1,-1,h,o,e,x,f,0),ee("z","y","x",1,-1,h,o,-e,x,f,1),ee("x","z","y",1,1,e,h,o,l,x,2),ee("x","z","y",1,-1,e,h,-o,l,x,3),ee("x","y","z",1,-1,e,o,h,l,f,4),ee("x","y","z",-1,-1,e,o,-h,l,f,5),this.setIndex(P),this.setAttribute("position",new Or(C,3)),this.setAttribute("normal",new Or(O,3)),this.setAttribute("uv",new Or(F,2));function ee(se,fe,ae,ie,tt,Ue,Ne,Ce,Ye,At,ft){const wt=Ue/Ye,Et=Ne/At,Dt=Ue/2,Qe=Ne/2,ht=Ce/2,_t=Ye+1,yt=At+1;let Nt=0,ei=0;const mi=new He;for(let Pi=0;Pi<yt;Pi++){const Ai=Pi*Et-Qe;for(let dn=0;dn<_t;dn++){const wi=dn*wt-Dt;mi[se]=wi*ie,mi[fe]=Ai*tt,mi[ae]=ht,C.push(mi.x,mi.y,mi.z),mi[se]=0,mi[fe]=0,mi[ae]=Ce>0?1:-1,O.push(mi.x,mi.y,mi.z),F.push(dn/Ye),F.push(1-Pi/At),Nt+=1}}for(let Pi=0;Pi<At;Pi++)for(let Ai=0;Ai<Ye;Ai++){const dn=V+Ai+_t*Pi,wi=V+Ai+_t*(Pi+1),Rn=V+(Ai+1)+_t*(Pi+1),Un=V+(Ai+1)+_t*Pi;P.push(dn,wi,Un),P.push(wi,Rn,Un),ei+=6}s.addGroup(q,ei,ft),q+=ei,V+=Nt}}}function Tp(i){const e={};for(const o in i){e[o]={};for(const h in i[o]){const l=i[o][h];l&&(l.isColor||l.isMatrix3||l.isMatrix4||l.isVector2||l.isVector3||l.isVector4||l.isTexture||l.isQuaternion)?e[o][h]=l.clone():Array.isArray(l)?e[o][h]=l.slice():e[o][h]=l}}return e}function As(i){const e={};for(let o=0;o<i.length;o++){const h=Tp(i[o]);for(const l in h)e[l]=h[l]}return e}const yJ={clone:Tp,merge:As};var vJ=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,xJ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function Xa(i){fo.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=vJ,this.fragmentShader=xJ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,i!==void 0&&(i.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(i))}Xa.prototype=Object.create(fo.prototype);Xa.prototype.constructor=Xa;Xa.prototype.isShaderMaterial=!0;Xa.prototype.copy=function(i){return fo.prototype.copy.call(this,i),this.fragmentShader=i.fragmentShader,this.vertexShader=i.vertexShader,this.uniforms=Tp(i.uniforms),this.defines=Object.assign({},i.defines),this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.lights=i.lights,this.clipping=i.clipping,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.extensions=Object.assign({},i.extensions),this.glslVersion=i.glslVersion,this};Xa.prototype.toJSON=function(i){const e=fo.prototype.toJSON.call(this,i);e.glslVersion=this.glslVersion,e.uniforms={};for(const h in this.uniforms){const f=this.uniforms[h].value;f&&f.isTexture?e.uniforms[h]={type:"t",value:f.toJSON(i).uuid}:f&&f.isColor?e.uniforms[h]={type:"c",value:f.getHex()}:f&&f.isVector2?e.uniforms[h]={type:"v2",value:f.toArray()}:f&&f.isVector3?e.uniforms[h]={type:"v3",value:f.toArray()}:f&&f.isVector4?e.uniforms[h]={type:"v4",value:f.toArray()}:f&&f.isMatrix3?e.uniforms[h]={type:"m3",value:f.toArray()}:f&&f.isMatrix4?e.uniforms[h]={type:"m4",value:f.toArray()}:e.uniforms[h]={value:f}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const o={};for(const h in this.extensions)this.extensions[h]===!0&&(o[h]=!0);return Object.keys(o).length>0&&(e.extensions=o),e};function hd(){Dn.call(this),this.type="Camera",this.matrixWorldInverse=new nn,this.projectionMatrix=new nn,this.projectionMatrixInverse=new nn}hd.prototype=Object.assign(Object.create(Dn.prototype),{constructor:hd,isCamera:!0,copy:function(i,e){return Dn.prototype.copy.call(this,i,e),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),i=new He),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return i.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(i){Dn.prototype.updateMatrixWorld.call(this,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(i,e){Dn.prototype.updateWorldMatrix.call(this,i,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return new this.constructor().copy(this)}});function Ws(i=50,e=1,o=.1,h=2e3){hd.call(this),this.type="PerspectiveCamera",this.fov=i,this.zoom=1,this.near=o,this.far=h,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Ws.prototype=Object.assign(Object.create(hd.prototype),{constructor:Ws,isPerspectiveCamera:!0,copy:function(i,e){return hd.prototype.copy.call(this,i,e),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this},setFocalLength:function(i){const e=.5*this.getFilmHeight()/i;this.fov=Bn.RAD2DEG*2*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const i=Math.tan(Bn.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/i},getEffectiveFOV:function(){return Bn.RAD2DEG*2*Math.atan(Math.tan(Bn.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(i,e,o,h,l,f){this.aspect=i/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=e,this.view.offsetX=o,this.view.offsetY=h,this.view.width=l,this.view.height=f,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const i=this.near;let e=i*Math.tan(Bn.DEG2RAD*.5*this.fov)/this.zoom,o=2*e,h=this.aspect*o,l=-.5*h;const f=this.view;if(this.view!==null&&this.view.enabled){const s=f.fullWidth,P=f.fullHeight;l+=f.offsetX*h/s,e-=f.offsetY*o/P,h*=f.width/s,o*=f.height/P}const x=this.filmOffset;x!==0&&(l+=i*x/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+h,e,e-o,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){const e=Dn.prototype.toJSON.call(this,i);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const Jf=90,Yf=1;class d2 extends Dn{constructor(e,o,h){if(super(),this.type="CubeCamera",h.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=h;const l=new Ws(Jf,Yf,e,o);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new He(1,0,0)),this.add(l);const f=new Ws(Jf,Yf,e,o);f.layers=this.layers,f.up.set(0,-1,0),f.lookAt(new He(-1,0,0)),this.add(f);const x=new Ws(Jf,Yf,e,o);x.layers=this.layers,x.up.set(0,0,1),x.lookAt(new He(0,1,0)),this.add(x);const s=new Ws(Jf,Yf,e,o);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new He(0,-1,0)),this.add(s);const P=new Ws(Jf,Yf,e,o);P.layers=this.layers,P.up.set(0,-1,0),P.lookAt(new He(0,0,1)),this.add(P);const C=new Ws(Jf,Yf,e,o);C.layers=this.layers,C.up.set(0,-1,0),C.lookAt(new He(0,0,-1)),this.add(C)}update(e,o){this.parent===null&&this.updateMatrixWorld();const h=this.renderTarget,[l,f,x,s,P,C]=this.children,O=e.xr.enabled,F=e.getRenderTarget();e.xr.enabled=!1;const V=h.texture.generateMipmaps;h.texture.generateMipmaps=!1,e.setRenderTarget(h,0),e.render(o,l),e.setRenderTarget(h,1),e.render(o,f),e.setRenderTarget(h,2),e.render(o,x),e.setRenderTarget(h,3),e.render(o,s),e.setRenderTarget(h,4),e.render(o,P),h.texture.generateMipmaps=V,e.setRenderTarget(h,5),e.render(o,C),e.setRenderTarget(F),e.xr.enabled=O}}class ow extends ps{constructor(e,o,h,l,f,x,s,P,C,O){e=e!==void 0?e:[],o=o!==void 0?o:o2,s=s!==void 0?s:rd,super(e,o,h,l,f,x,s,P,C,O),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}ow.prototype.isCubeTexture=!0;class YB extends od{constructor(e,o,h){Number.isInteger(o)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),o=h),super(e,e,o),o=o||{},this.texture=new ow(void 0,o.mapping,o.wrapS,o.wrapT,o.magFilter,o.minFilter,o.format,o.type,o.anisotropy,o.encoding),this.texture.generateMipmaps=o.generateMipmaps!==void 0?o.generateMipmaps:!1,this.texture.minFilter=o.minFilter!==void 0?o.minFilter:ds,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,o){this.texture.type=o.type,this.texture.format=El,this.texture.encoding=o.encoding,this.texture.generateMipmaps=o.generateMipmaps,this.texture.minFilter=o.minFilter,this.texture.magFilter=o.magFilter;const h={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},l=new Jo(5,5,5),f=new Xa({name:"CubemapFromEquirect",uniforms:Tp(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,side:Yo,blending:u_});f.uniforms.tEquirect.value=o;const x=new lr(l,f),s=o.minFilter;return o.minFilter===nw&&(o.minFilter=ds),new d2(1,10,this).update(e,x),o.minFilter=s,x.geometry.dispose(),x.material.dispose(),this}clear(e,o,h,l){const f=e.getRenderTarget();for(let x=0;x<6;x++)e.setRenderTarget(this,x),e.clear(o,h,l);e.setRenderTarget(f)}}YB.prototype.isWebGLCubeRenderTarget=!0;class f2 extends ps{constructor(e,o,h,l,f,x,s,P,C,O,F,V){super(null,x,s,P,C,O,l,f,F,V),this.image={data:e||null,width:o||1,height:h||1},this.magFilter=C!==void 0?C:qs,this.minFilter=O!==void 0?O:qs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}f2.prototype.isDataTexture=!0;const Kf=new Rp,d0=new He;class sw{constructor(e=new nc,o=new nc,h=new nc,l=new nc,f=new nc,x=new nc){this.planes=[e,o,h,l,f,x]}set(e,o,h,l,f,x){const s=this.planes;return s[0].copy(e),s[1].copy(o),s[2].copy(h),s[3].copy(l),s[4].copy(f),s[5].copy(x),this}copy(e){const o=this.planes;for(let h=0;h<6;h++)o[h].copy(e.planes[h]);return this}setFromProjectionMatrix(e){const o=this.planes,h=e.elements,l=h[0],f=h[1],x=h[2],s=h[3],P=h[4],C=h[5],O=h[6],F=h[7],V=h[8],q=h[9],ee=h[10],se=h[11],fe=h[12],ae=h[13],ie=h[14],tt=h[15];return o[0].setComponents(s-l,F-P,se-V,tt-fe).normalize(),o[1].setComponents(s+l,F+P,se+V,tt+fe).normalize(),o[2].setComponents(s+f,F+C,se+q,tt+ae).normalize(),o[3].setComponents(s-f,F-C,se-q,tt-ae).normalize(),o[4].setComponents(s-x,F-O,se-ee,tt-ie).normalize(),o[5].setComponents(s+x,F+O,se+ee,tt+ie).normalize(),this}intersectsObject(e){const o=e.geometry;return o.boundingSphere===null&&o.computeBoundingSphere(),Kf.copy(o.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Kf)}intersectsSprite(e){return Kf.center.set(0,0,0),Kf.radius=.7071067811865476,Kf.applyMatrix4(e.matrixWorld),this.intersectsSphere(Kf)}intersectsSphere(e){const o=this.planes,h=e.center,l=-e.radius;for(let f=0;f<6;f++)if(o[f].distanceToPoint(h)<l)return!1;return!0}intersectsBox(e){const o=this.planes;for(let h=0;h<6;h++){const l=o[h];if(d0.x=l.normal.x>0?e.max.x:e.min.x,d0.y=l.normal.y>0?e.max.y:e.min.y,d0.z=l.normal.z>0?e.max.z:e.min.z,l.distanceToPoint(d0)<0)return!1}return!0}containsPoint(e){const o=this.planes;for(let h=0;h<6;h++)if(o[h].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function KB(){let i=null,e=!1,o=null,h=null;function l(f,x){o(f,x),h=i.requestAnimationFrame(l)}return{start:function(){e!==!0&&o!==null&&(h=i.requestAnimationFrame(l),e=!0)},stop:function(){i.cancelAnimationFrame(h),e=!1},setAnimationLoop:function(f){o=f},setContext:function(f){i=f}}}function bJ(i,e){const o=e.isWebGL2,h=new WeakMap;function l(C,O){const F=C.array,V=C.usage,q=i.createBuffer();i.bindBuffer(O,q),i.bufferData(O,F,V),C.onUploadCallback();let ee=5126;return F instanceof Float32Array?ee=5126:F instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):F instanceof Uint16Array?C.isFloat16BufferAttribute?o?ee=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):ee=5123:F instanceof Int16Array?ee=5122:F instanceof Uint32Array?ee=5125:F instanceof Int32Array?ee=5124:F instanceof Int8Array?ee=5120:F instanceof Uint8Array&&(ee=5121),{buffer:q,type:ee,bytesPerElement:F.BYTES_PER_ELEMENT,version:C.version}}function f(C,O,F){const V=O.array,q=O.updateRange;i.bindBuffer(F,C),q.count===-1?i.bufferSubData(F,0,V):(o?i.bufferSubData(F,q.offset*V.BYTES_PER_ELEMENT,V,q.offset,q.count):i.bufferSubData(F,q.offset*V.BYTES_PER_ELEMENT,V.subarray(q.offset,q.offset+q.count)),q.count=-1)}function x(C){return C.isInterleavedBufferAttribute&&(C=C.data),h.get(C)}function s(C){C.isInterleavedBufferAttribute&&(C=C.data);const O=h.get(C);O&&(i.deleteBuffer(O.buffer),h.delete(C))}function P(C,O){if(C.isGLBufferAttribute){const V=h.get(C);(!V||V.version<C.version)&&h.set(C,{buffer:C.buffer,type:C.type,bytesPerElement:C.elementSize,version:C.version});return}C.isInterleavedBufferAttribute&&(C=C.data);const F=h.get(C);F===void 0?h.set(C,l(C,O)):F.version<C.version&&(f(F.buffer,C,O),F.version=C.version)}return{get:x,remove:s,update:P}}class wJ extends _r{constructor(e=1,o=1,h=1,l=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:o,widthSegments:h,heightSegments:l};const f=e/2,x=o/2,s=Math.floor(h),P=Math.floor(l),C=s+1,O=P+1,F=e/s,V=o/P,q=[],ee=[],se=[],fe=[];for(let ae=0;ae<O;ae++){const ie=ae*V-x;for(let tt=0;tt<C;tt++){const Ue=tt*F-f;ee.push(Ue,-ie,0),se.push(0,0,1),fe.push(tt/s),fe.push(1-ae/P)}}for(let ae=0;ae<P;ae++)for(let ie=0;ie<s;ie++){const tt=ie+C*ae,Ue=ie+C*(ae+1),Ne=ie+1+C*(ae+1),Ce=ie+1+C*ae;q.push(tt,Ue,Ce),q.push(Ue,Ne,Ce)}this.setIndex(q),this.setAttribute("position",new Or(ee,3)),this.setAttribute("normal",new Or(se,3)),this.setAttribute("uv",new Or(fe,2))}}var SJ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,TJ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,EJ=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,IJ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,MJ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,AJ="vec3 transformed = vec3( position );",PJ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,zJ=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,CJ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,LJ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,RJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,DJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,kJ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,OJ=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,FJ=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,BJ=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,NJ=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor.xyz *= color.xyz;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,UJ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,$J=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,VJ=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,jJ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,GJ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,HJ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,ZJ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,WJ="gl_FragColor = linearToOutputTexel( gl_FragColor );",qJ=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,XJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,JJ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,YJ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,KJ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,QJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,eY=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,tY=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,iY=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,nY=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,rY=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,oY=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,sY=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,aY=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lY=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,cY=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,uY=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,hY=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,dY=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,fY=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,pY=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,mY=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,gY=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,_Y=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,yY=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,vY=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,xY=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,bY=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,wY=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,SY=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,TY=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,EY=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,IY=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,MY=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,AY=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,PY=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,zY=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,CY=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,LY=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,RY=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,DY=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,kY=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,OY=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,FY=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,BY=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,NY=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,UY=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,$Y=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,VY=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,jY=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,GY=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,HY=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,ZY=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,WY=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,qY=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,XY=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,JY=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,YY=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,KY=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,QY=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,eK=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tK=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,iK=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,nK=`#ifdef USE_TRANSMISSIONMAP
	totalTransmission *= texture2D( transmissionMap, vUv ).r;
#endif`,rK=`#ifdef USE_TRANSMISSIONMAP
	uniform sampler2D transmissionMap;
#endif`,oK=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,sK=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,aK=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,lK=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,cK=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uK=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,hK=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,dK=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,fK=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,pK=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,mK=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,gK=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,_K=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,yK=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vK=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,xK=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,bK=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,wK=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,SK=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,TK=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,EK=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,IK=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MK=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,AK=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PK=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,zK=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CK=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LK=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,RK=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,DK=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSMISSION
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSMISSION
	uniform float transmission;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <transmissionmap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef TRANSMISSION
		float totalTransmission = transmission;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <transmissionmap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSMISSION
		diffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kK=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,OK=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,FK=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,BK=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,NK=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,UK=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,$K=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,VK=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,jK=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const Yn={alphamap_fragment:SJ,alphamap_pars_fragment:TJ,alphatest_fragment:EJ,aomap_fragment:IJ,aomap_pars_fragment:MJ,begin_vertex:AJ,beginnormal_vertex:PJ,bsdfs:zJ,bumpmap_pars_fragment:CJ,clipping_planes_fragment:LJ,clipping_planes_pars_fragment:RJ,clipping_planes_pars_vertex:DJ,clipping_planes_vertex:kJ,color_fragment:OJ,color_pars_fragment:FJ,color_pars_vertex:BJ,color_vertex:NJ,common:UJ,cube_uv_reflection_fragment:$J,defaultnormal_vertex:VJ,displacementmap_pars_vertex:jJ,displacementmap_vertex:GJ,emissivemap_fragment:HJ,emissivemap_pars_fragment:ZJ,encodings_fragment:WJ,encodings_pars_fragment:qJ,envmap_fragment:XJ,envmap_common_pars_fragment:JJ,envmap_pars_fragment:YJ,envmap_pars_vertex:KJ,envmap_physical_pars_fragment:cY,envmap_vertex:QJ,fog_vertex:eY,fog_pars_vertex:tY,fog_fragment:iY,fog_pars_fragment:nY,gradientmap_pars_fragment:rY,lightmap_fragment:oY,lightmap_pars_fragment:sY,lights_lambert_vertex:aY,lights_pars_begin:lY,lights_toon_fragment:uY,lights_toon_pars_fragment:hY,lights_phong_fragment:dY,lights_phong_pars_fragment:fY,lights_physical_fragment:pY,lights_physical_pars_fragment:mY,lights_fragment_begin:gY,lights_fragment_maps:_Y,lights_fragment_end:yY,logdepthbuf_fragment:vY,logdepthbuf_pars_fragment:xY,logdepthbuf_pars_vertex:bY,logdepthbuf_vertex:wY,map_fragment:SY,map_pars_fragment:TY,map_particle_fragment:EY,map_particle_pars_fragment:IY,metalnessmap_fragment:MY,metalnessmap_pars_fragment:AY,morphnormal_vertex:PY,morphtarget_pars_vertex:zY,morphtarget_vertex:CY,normal_fragment_begin:LY,normal_fragment_maps:RY,normalmap_pars_fragment:DY,clearcoat_normal_fragment_begin:kY,clearcoat_normal_fragment_maps:OY,clearcoat_pars_fragment:FY,packing:BY,premultiplied_alpha_fragment:NY,project_vertex:UY,dithering_fragment:$Y,dithering_pars_fragment:VY,roughnessmap_fragment:jY,roughnessmap_pars_fragment:GY,shadowmap_pars_fragment:HY,shadowmap_pars_vertex:ZY,shadowmap_vertex:WY,shadowmask_pars_fragment:qY,skinbase_vertex:XY,skinning_pars_vertex:JY,skinning_vertex:YY,skinnormal_vertex:KY,specularmap_fragment:QY,specularmap_pars_fragment:eK,tonemapping_fragment:tK,tonemapping_pars_fragment:iK,transmissionmap_fragment:nK,transmissionmap_pars_fragment:rK,uv_pars_fragment:oK,uv_pars_vertex:sK,uv_vertex:aK,uv2_pars_fragment:lK,uv2_pars_vertex:cK,uv2_vertex:uK,worldpos_vertex:hK,background_frag:dK,background_vert:fK,cube_frag:pK,cube_vert:mK,depth_frag:gK,depth_vert:_K,distanceRGBA_frag:yK,distanceRGBA_vert:vK,equirect_frag:xK,equirect_vert:bK,linedashed_frag:wK,linedashed_vert:SK,meshbasic_frag:TK,meshbasic_vert:EK,meshlambert_frag:IK,meshlambert_vert:MK,meshmatcap_frag:AK,meshmatcap_vert:PK,meshtoon_frag:zK,meshtoon_vert:CK,meshphong_frag:LK,meshphong_vert:RK,meshphysical_frag:DK,meshphysical_vert:kK,normal_frag:OK,normal_vert:FK,points_frag:BK,points_vert:NK,shadow_frag:UK,shadow_vert:$K,sprite_frag:VK,sprite_vert:jK},Ci={common:{diffuse:{value:new mn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new fs},uv2Transform:{value:new fs},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new gi(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new mn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new mn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new fs}},sprite:{diffuse:{value:new mn(15658734)},opacity:{value:1},center:{value:new gi(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new fs}}},rc={basic:{uniforms:As([Ci.common,Ci.specularmap,Ci.envmap,Ci.aomap,Ci.lightmap,Ci.fog]),vertexShader:Yn.meshbasic_vert,fragmentShader:Yn.meshbasic_frag},lambert:{uniforms:As([Ci.common,Ci.specularmap,Ci.envmap,Ci.aomap,Ci.lightmap,Ci.emissivemap,Ci.fog,Ci.lights,{emissive:{value:new mn(0)}}]),vertexShader:Yn.meshlambert_vert,fragmentShader:Yn.meshlambert_frag},phong:{uniforms:As([Ci.common,Ci.specularmap,Ci.envmap,Ci.aomap,Ci.lightmap,Ci.emissivemap,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,Ci.fog,Ci.lights,{emissive:{value:new mn(0)},specular:{value:new mn(1118481)},shininess:{value:30}}]),vertexShader:Yn.meshphong_vert,fragmentShader:Yn.meshphong_frag},standard:{uniforms:As([Ci.common,Ci.envmap,Ci.aomap,Ci.lightmap,Ci.emissivemap,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,Ci.roughnessmap,Ci.metalnessmap,Ci.fog,Ci.lights,{emissive:{value:new mn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Yn.meshphysical_vert,fragmentShader:Yn.meshphysical_frag},toon:{uniforms:As([Ci.common,Ci.aomap,Ci.lightmap,Ci.emissivemap,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,Ci.gradientmap,Ci.fog,Ci.lights,{emissive:{value:new mn(0)}}]),vertexShader:Yn.meshtoon_vert,fragmentShader:Yn.meshtoon_frag},matcap:{uniforms:As([Ci.common,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,Ci.fog,{matcap:{value:null}}]),vertexShader:Yn.meshmatcap_vert,fragmentShader:Yn.meshmatcap_frag},points:{uniforms:As([Ci.points,Ci.fog]),vertexShader:Yn.points_vert,fragmentShader:Yn.points_frag},dashed:{uniforms:As([Ci.common,Ci.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Yn.linedashed_vert,fragmentShader:Yn.linedashed_frag},depth:{uniforms:As([Ci.common,Ci.displacementmap]),vertexShader:Yn.depth_vert,fragmentShader:Yn.depth_frag},normal:{uniforms:As([Ci.common,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,{opacity:{value:1}}]),vertexShader:Yn.normal_vert,fragmentShader:Yn.normal_frag},sprite:{uniforms:As([Ci.sprite,Ci.fog]),vertexShader:Yn.sprite_vert,fragmentShader:Yn.sprite_frag},background:{uniforms:{uvTransform:{value:new fs},t2D:{value:null}},vertexShader:Yn.background_vert,fragmentShader:Yn.background_frag},cube:{uniforms:As([Ci.envmap,{opacity:{value:1}}]),vertexShader:Yn.cube_vert,fragmentShader:Yn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Yn.equirect_vert,fragmentShader:Yn.equirect_frag},distanceRGBA:{uniforms:As([Ci.common,Ci.displacementmap,{referencePosition:{value:new He},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Yn.distanceRGBA_vert,fragmentShader:Yn.distanceRGBA_frag},shadow:{uniforms:As([Ci.lights,Ci.fog,{color:{value:new mn(0)},opacity:{value:1}}]),vertexShader:Yn.shadow_vert,fragmentShader:Yn.shadow_frag}};rc.physical={uniforms:As([rc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new gi(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new mn(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Yn.meshphysical_vert,fragmentShader:Yn.meshphysical_frag};function GK(i,e,o,h,l){const f=new mn(0);let x=0,s,P,C=null,O=0,F=null;function V(ee,se,fe,ae){let ie=se.isScene===!0?se.background:null;ie&&ie.isTexture&&(ie=e.get(ie));const tt=i.xr,Ue=tt.getSession&&tt.getSession();Ue&&Ue.environmentBlendMode==="additive"&&(ie=null),ie===null?q(f,x):ie&&ie.isColor&&(q(ie,1),ae=!0),(i.autoClear||ae)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),ie&&(ie.isCubeTexture||ie.isWebGLCubeRenderTarget||ie.mapping===a2)?(P===void 0&&(P=new lr(new Jo(1,1,1),new Xa({name:"BackgroundCubeMaterial",uniforms:Tp(rc.cube.uniforms),vertexShader:rc.cube.vertexShader,fragmentShader:rc.cube.fragmentShader,side:Yo,depthTest:!1,depthWrite:!1,fog:!1})),P.geometry.deleteAttribute("normal"),P.geometry.deleteAttribute("uv"),P.onBeforeRender=function(Ne,Ce,Ye){this.matrixWorld.copyPosition(Ye.matrixWorld)},Object.defineProperty(P.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),h.update(P)),ie.isWebGLCubeRenderTarget&&(ie=ie.texture),P.material.uniforms.envMap.value=ie,P.material.uniforms.flipEnvMap.value=ie.isCubeTexture&&ie._needsFlipEnvMap?-1:1,(C!==ie||O!==ie.version||F!==i.toneMapping)&&(P.material.needsUpdate=!0,C=ie,O=ie.version,F=i.toneMapping),ee.unshift(P,P.geometry,P.material,0,0,null)):ie&&ie.isTexture&&(s===void 0&&(s=new lr(new wJ(2,2),new Xa({name:"BackgroundMaterial",uniforms:Tp(rc.background.uniforms),vertexShader:rc.background.vertexShader,fragmentShader:rc.background.fragmentShader,side:ew,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),h.update(s)),s.material.uniforms.t2D.value=ie,ie.matrixAutoUpdate===!0&&ie.updateMatrix(),s.material.uniforms.uvTransform.value.copy(ie.matrix),(C!==ie||O!==ie.version||F!==i.toneMapping)&&(s.material.needsUpdate=!0,C=ie,O=ie.version,F=i.toneMapping),ee.unshift(s,s.geometry,s.material,0,0,null))}function q(ee,se){o.buffers.color.setClear(ee.r,ee.g,ee.b,se,l)}return{getClearColor:function(){return f},setClearColor:function(ee,se=1){f.set(ee),x=se,q(f,x)},getClearAlpha:function(){return x},setClearAlpha:function(ee){x=ee,q(f,x)},render:V}}function HK(i,e,o,h){const l=i.getParameter(34921),f=h.isWebGL2?null:e.get("OES_vertex_array_object"),x=h.isWebGL2||f!==null,s={},P=se(null);let C=P;function O(Qe,ht,_t,yt,Nt){let ei=!1;if(x){const mi=ee(yt,_t,ht);C!==mi&&(C=mi,V(C.object)),ei=fe(yt,Nt),ei&&ae(yt,Nt)}else{const mi=ht.wireframe===!0;(C.geometry!==yt.id||C.program!==_t.id||C.wireframe!==mi)&&(C.geometry=yt.id,C.program=_t.id,C.wireframe=mi,ei=!0)}Qe.isInstancedMesh===!0&&(ei=!0),Nt!==null&&o.update(Nt,34963),ei&&(Ye(Qe,ht,_t,yt),Nt!==null&&i.bindBuffer(34963,o.get(Nt).buffer))}function F(){return h.isWebGL2?i.createVertexArray():f.createVertexArrayOES()}function V(Qe){return h.isWebGL2?i.bindVertexArray(Qe):f.bindVertexArrayOES(Qe)}function q(Qe){return h.isWebGL2?i.deleteVertexArray(Qe):f.deleteVertexArrayOES(Qe)}function ee(Qe,ht,_t){const yt=_t.wireframe===!0;let Nt=s[Qe.id];Nt===void 0&&(Nt={},s[Qe.id]=Nt);let ei=Nt[ht.id];ei===void 0&&(ei={},Nt[ht.id]=ei);let mi=ei[yt];return mi===void 0&&(mi=se(F()),ei[yt]=mi),mi}function se(Qe){const ht=[],_t=[],yt=[];for(let Nt=0;Nt<l;Nt++)ht[Nt]=0,_t[Nt]=0,yt[Nt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ht,enabledAttributes:_t,attributeDivisors:yt,object:Qe,attributes:{},index:null}}function fe(Qe,ht){const _t=C.attributes,yt=Qe.attributes;let Nt=0;for(const ei in yt){const mi=_t[ei],Pi=yt[ei];if(mi===void 0||mi.attribute!==Pi||mi.data!==Pi.data)return!0;Nt++}return C.attributesNum!==Nt||C.index!==ht}function ae(Qe,ht){const _t={},yt=Qe.attributes;let Nt=0;for(const ei in yt){const mi=yt[ei],Pi={};Pi.attribute=mi,mi.data&&(Pi.data=mi.data),_t[ei]=Pi,Nt++}C.attributes=_t,C.attributesNum=Nt,C.index=ht}function ie(){const Qe=C.newAttributes;for(let ht=0,_t=Qe.length;ht<_t;ht++)Qe[ht]=0}function tt(Qe){Ue(Qe,0)}function Ue(Qe,ht){const _t=C.newAttributes,yt=C.enabledAttributes,Nt=C.attributeDivisors;_t[Qe]=1,yt[Qe]===0&&(i.enableVertexAttribArray(Qe),yt[Qe]=1),Nt[Qe]!==ht&&((h.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[h.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Qe,ht),Nt[Qe]=ht)}function Ne(){const Qe=C.newAttributes,ht=C.enabledAttributes;for(let _t=0,yt=ht.length;_t<yt;_t++)ht[_t]!==Qe[_t]&&(i.disableVertexAttribArray(_t),ht[_t]=0)}function Ce(Qe,ht,_t,yt,Nt,ei){h.isWebGL2===!0&&(_t===5124||_t===5125)?i.vertexAttribIPointer(Qe,ht,_t,Nt,ei):i.vertexAttribPointer(Qe,ht,_t,yt,Nt,ei)}function Ye(Qe,ht,_t,yt){if(h.isWebGL2===!1&&(Qe.isInstancedMesh||yt.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;ie();const Nt=yt.attributes,ei=_t.getAttributes(),mi=ht.defaultAttributeValues;for(const Pi in ei){const Ai=ei[Pi];if(Ai>=0){const dn=Nt[Pi];if(dn!==void 0){const wi=dn.normalized,Rn=dn.itemSize,Un=o.get(dn);if(Un===void 0)continue;const Zt=Un.buffer,pr=Un.type,zn=Un.bytesPerElement;if(dn.isInterleavedBufferAttribute){const Di=dn.data,Ii=Di.stride,hn=dn.offset;Di&&Di.isInstancedInterleavedBuffer?(Ue(Ai,Di.meshPerAttribute),yt._maxInstanceCount===void 0&&(yt._maxInstanceCount=Di.meshPerAttribute*Di.count)):tt(Ai),i.bindBuffer(34962,Zt),Ce(Ai,Rn,pr,wi,Ii*zn,hn*zn)}else dn.isInstancedBufferAttribute?(Ue(Ai,dn.meshPerAttribute),yt._maxInstanceCount===void 0&&(yt._maxInstanceCount=dn.meshPerAttribute*dn.count)):tt(Ai),i.bindBuffer(34962,Zt),Ce(Ai,Rn,pr,wi,0,0)}else if(Pi==="instanceMatrix"){const wi=o.get(Qe.instanceMatrix);if(wi===void 0)continue;const Rn=wi.buffer,Un=wi.type;Ue(Ai+0,1),Ue(Ai+1,1),Ue(Ai+2,1),Ue(Ai+3,1),i.bindBuffer(34962,Rn),i.vertexAttribPointer(Ai+0,4,Un,!1,64,0),i.vertexAttribPointer(Ai+1,4,Un,!1,64,16),i.vertexAttribPointer(Ai+2,4,Un,!1,64,32),i.vertexAttribPointer(Ai+3,4,Un,!1,64,48)}else if(Pi==="instanceColor"){const wi=o.get(Qe.instanceColor);if(wi===void 0)continue;const Rn=wi.buffer,Un=wi.type;Ue(Ai,1),i.bindBuffer(34962,Rn),i.vertexAttribPointer(Ai,3,Un,!1,12,0)}else if(mi!==void 0){const wi=mi[Pi];if(wi!==void 0)switch(wi.length){case 2:i.vertexAttrib2fv(Ai,wi);break;case 3:i.vertexAttrib3fv(Ai,wi);break;case 4:i.vertexAttrib4fv(Ai,wi);break;default:i.vertexAttrib1fv(Ai,wi)}}}}Ne()}function At(){Et();for(const Qe in s){const ht=s[Qe];for(const _t in ht){const yt=ht[_t];for(const Nt in yt)q(yt[Nt].object),delete yt[Nt];delete ht[_t]}delete s[Qe]}}function ft(Qe){if(s[Qe.id]===void 0)return;const ht=s[Qe.id];for(const _t in ht){const yt=ht[_t];for(const Nt in yt)q(yt[Nt].object),delete yt[Nt];delete ht[_t]}delete s[Qe.id]}function wt(Qe){for(const ht in s){const _t=s[ht];if(_t[Qe.id]===void 0)continue;const yt=_t[Qe.id];for(const Nt in yt)q(yt[Nt].object),delete yt[Nt];delete _t[Qe.id]}}function Et(){Dt(),C!==P&&(C=P,V(C.object))}function Dt(){P.geometry=null,P.program=null,P.wireframe=!1}return{setup:O,reset:Et,resetDefaultState:Dt,dispose:At,releaseStatesOfGeometry:ft,releaseStatesOfProgram:wt,initAttributes:ie,enableAttribute:tt,disableUnusedAttributes:Ne}}function ZK(i,e,o,h){const l=h.isWebGL2;let f;function x(C){f=C}function s(C,O){i.drawArrays(f,C,O),o.update(O,f,1)}function P(C,O,F){if(F===0)return;let V,q;if(l)V=i,q="drawArraysInstanced";else if(V=e.get("ANGLE_instanced_arrays"),q="drawArraysInstancedANGLE",V===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}V[q](f,C,O,F),o.update(O,f,F)}this.setMode=x,this.render=s,this.renderInstances=P}function WK(i,e,o){let h;function l(){if(h!==void 0)return h;if(e.has("EXT_texture_filter_anisotropic")===!0){const Ce=e.get("EXT_texture_filter_anisotropic");h=i.getParameter(Ce.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else h=0;return h}function f(Ce){if(Ce==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Ce="mediump"}return Ce==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const x=typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&i instanceof WebGL2ComputeRenderingContext;let s=o.precision!==void 0?o.precision:"highp";const P=f(s);P!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",P,"instead."),s=P);const C=o.logarithmicDepthBuffer===!0,O=i.getParameter(34930),F=i.getParameter(35660),V=i.getParameter(3379),q=i.getParameter(34076),ee=i.getParameter(34921),se=i.getParameter(36347),fe=i.getParameter(36348),ae=i.getParameter(36349),ie=F>0,tt=x||e.has("OES_texture_float"),Ue=ie&&tt,Ne=x?i.getParameter(36183):0;return{isWebGL2:x,getMaxAnisotropy:l,getMaxPrecision:f,precision:s,logarithmicDepthBuffer:C,maxTextures:O,maxVertexTextures:F,maxTextureSize:V,maxCubemapSize:q,maxAttributes:ee,maxVertexUniforms:se,maxVaryings:fe,maxFragmentUniforms:ae,vertexTextures:ie,floatFragmentTextures:tt,floatVertexTextures:Ue,maxSamples:Ne}}function qK(i){const e=this;let o=null,h=0,l=!1,f=!1;const x=new nc,s=new fs,P={value:null,needsUpdate:!1};this.uniform=P,this.numPlanes=0,this.numIntersection=0,this.init=function(F,V,q){const ee=F.length!==0||V||h!==0||l;return l=V,o=O(F,q,0),h=F.length,ee},this.beginShadows=function(){f=!0,O(null)},this.endShadows=function(){f=!1,C()},this.setState=function(F,V,q){const ee=F.clippingPlanes,se=F.clipIntersection,fe=F.clipShadows,ae=i.get(F);if(!l||ee===null||ee.length===0||f&&!fe)f?O(null):C();else{const ie=f?0:h,tt=ie*4;let Ue=ae.clippingState||null;P.value=Ue,Ue=O(ee,V,tt,q);for(let Ne=0;Ne!==tt;++Ne)Ue[Ne]=o[Ne];ae.clippingState=Ue,this.numIntersection=se?this.numPlanes:0,this.numPlanes+=ie}};function C(){P.value!==o&&(P.value=o,P.needsUpdate=h>0),e.numPlanes=h,e.numIntersection=0}function O(F,V,q,ee){const se=F!==null?F.length:0;let fe=null;if(se!==0){if(fe=P.value,ee!==!0||fe===null){const ae=q+se*4,ie=V.matrixWorldInverse;s.getNormalMatrix(ie),(fe===null||fe.length<ae)&&(fe=new Float32Array(ae));for(let tt=0,Ue=q;tt!==se;++tt,Ue+=4)x.copy(F[tt]).applyMatrix4(ie,s),x.normal.toArray(fe,Ue),fe[Ue+3]=x.constant}P.value=fe,P.needsUpdate=!0}return e.numPlanes=se,e.numIntersection=0,fe}}function XK(i){let e=new WeakMap;function o(x,s){return s===DC?x.mapping=o2:s===kC&&(x.mapping=s2),x}function h(x){if(x&&x.isTexture){const s=x.mapping;if(s===DC||s===kC)if(e.has(x)){const P=e.get(x).texture;return o(P,x.mapping)}else{const P=x.image;if(P&&P.height>0){const C=i.getRenderTarget(),O=new YB(P.height/2);return O.fromEquirectangularTexture(i,x),e.set(x,O),i.setRenderTarget(C),x.addEventListener("dispose",l),o(O.texture,x.mapping)}else return null}}return x}function l(x){const s=x.target;s.removeEventListener("dispose",l);const P=e.get(s);P!==void 0&&(e.delete(s),P.dispose())}function f(){e=new WeakMap}return{get:h,dispose:f}}function JK(i){const e={};function o(h){if(e[h]!==void 0)return e[h];let l;switch(h){case"WEBGL_depth_texture":l=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":l=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":l=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":l=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:l=i.getExtension(h)}return e[h]=l,l}return{has:function(h){return o(h)!==null},init:function(h){h.isWebGL2?o("EXT_color_buffer_float"):(o("WEBGL_depth_texture"),o("OES_texture_float"),o("OES_texture_half_float"),o("OES_texture_half_float_linear"),o("OES_standard_derivatives"),o("OES_element_index_uint"),o("OES_vertex_array_object"),o("ANGLE_instanced_arrays")),o("OES_texture_float_linear"),o("EXT_color_buffer_half_float")},get:function(h){const l=o(h);return l===null&&console.warn("THREE.WebGLRenderer: "+h+" extension not supported."),l}}}function YK(i,e,o,h){const l={},f=new WeakMap;function x(F){const V=F.target;V.index!==null&&e.remove(V.index);for(const ee in V.attributes)e.remove(V.attributes[ee]);V.removeEventListener("dispose",x),delete l[V.id];const q=f.get(V);q&&(e.remove(q),f.delete(V)),h.releaseStatesOfGeometry(V),V.isInstancedBufferGeometry===!0&&delete V._maxInstanceCount,o.memory.geometries--}function s(F,V){return l[V.id]===!0||(V.addEventListener("dispose",x),l[V.id]=!0,o.memory.geometries++),V}function P(F){const V=F.attributes;for(const ee in V)e.update(V[ee],34962);const q=F.morphAttributes;for(const ee in q){const se=q[ee];for(let fe=0,ae=se.length;fe<ae;fe++)e.update(se[fe],34962)}}function C(F){const V=[],q=F.index,ee=F.attributes.position;let se=0;if(q!==null){const ie=q.array;se=q.version;for(let tt=0,Ue=ie.length;tt<Ue;tt+=3){const Ne=ie[tt+0],Ce=ie[tt+1],Ye=ie[tt+2];V.push(Ne,Ce,Ce,Ye,Ye,Ne)}}else{const ie=ee.array;se=ee.version;for(let tt=0,Ue=ie.length/3-1;tt<Ue;tt+=3){const Ne=tt+0,Ce=tt+1,Ye=tt+2;V.push(Ne,Ce,Ce,Ye,Ye,Ne)}}const fe=new(JB(V)>65535?L_:C_)(V,1);fe.version=se;const ae=f.get(F);ae&&e.remove(ae),f.set(F,fe)}function O(F){const V=f.get(F);if(V){const q=F.index;q!==null&&V.version<q.version&&C(F)}else C(F);return f.get(F)}return{get:s,update:P,getWireframeAttribute:O}}function KK(i,e,o,h){const l=h.isWebGL2;let f;function x(V){f=V}let s,P;function C(V){s=V.type,P=V.bytesPerElement}function O(V,q){i.drawElements(f,q,s,V*P),o.update(q,f,1)}function F(V,q,ee){if(ee===0)return;let se,fe;if(l)se=i,fe="drawElementsInstanced";else if(se=e.get("ANGLE_instanced_arrays"),fe="drawElementsInstancedANGLE",se===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}se[fe](f,q,s,V*P,ee),o.update(q,f,ee)}this.setMode=x,this.setIndex=C,this.render=O,this.renderInstances=F}function QK(i){const e={geometries:0,textures:0},o={frame:0,calls:0,triangles:0,points:0,lines:0};function h(f,x,s){switch(o.calls++,x){case 4:o.triangles+=s*(f/3);break;case 1:o.lines+=s*(f/2);break;case 3:o.lines+=s*(f-1);break;case 2:o.lines+=s*f;break;case 0:o.points+=s*f;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",x);break}}function l(){o.frame++,o.calls=0,o.triangles=0,o.points=0,o.lines=0}return{memory:e,render:o,programs:null,autoReset:!0,reset:l,update:h}}function eQ(i,e){return i[0]-e[0]}function tQ(i,e){return Math.abs(e[1])-Math.abs(i[1])}function iQ(i){const e={},o=new Float32Array(8),h=[];for(let f=0;f<8;f++)h[f]=[f,0];function l(f,x,s,P){const C=f.morphTargetInfluences,O=C===void 0?0:C.length;let F=e[x.id];if(F===void 0){F=[];for(let fe=0;fe<O;fe++)F[fe]=[fe,0];e[x.id]=F}for(let fe=0;fe<O;fe++){const ae=F[fe];ae[0]=fe,ae[1]=C[fe]}F.sort(tQ);for(let fe=0;fe<8;fe++)fe<O&&F[fe][1]?(h[fe][0]=F[fe][0],h[fe][1]=F[fe][1]):(h[fe][0]=Number.MAX_SAFE_INTEGER,h[fe][1]=0);h.sort(eQ);const V=s.morphTargets&&x.morphAttributes.position,q=s.morphNormals&&x.morphAttributes.normal;let ee=0;for(let fe=0;fe<8;fe++){const ae=h[fe],ie=ae[0],tt=ae[1];ie!==Number.MAX_SAFE_INTEGER&&tt?(V&&x.getAttribute("morphTarget"+fe)!==V[ie]&&x.setAttribute("morphTarget"+fe,V[ie]),q&&x.getAttribute("morphNormal"+fe)!==q[ie]&&x.setAttribute("morphNormal"+fe,q[ie]),o[fe]=tt,ee+=tt):(V&&x.hasAttribute("morphTarget"+fe)===!0&&x.deleteAttribute("morphTarget"+fe),q&&x.hasAttribute("morphNormal"+fe)===!0&&x.deleteAttribute("morphNormal"+fe),o[fe]=0)}const se=x.morphTargetsRelative?1:1-ee;P.getUniforms().setValue(i,"morphTargetBaseInfluence",se),P.getUniforms().setValue(i,"morphTargetInfluences",o)}return{update:l}}function nQ(i,e,o,h){let l=new WeakMap;function f(P){const C=h.render.frame,O=P.geometry,F=e.get(P,O);return l.get(F)!==C&&(e.update(F),l.set(F,C)),P.isInstancedMesh&&(P.hasEventListener("dispose",s)===!1&&P.addEventListener("dispose",s),o.update(P.instanceMatrix,34962),P.instanceColor!==null&&o.update(P.instanceColor,34962)),F}function x(){l=new WeakMap}function s(P){const C=P.target;C.removeEventListener("dispose",s),o.remove(C.instanceMatrix),C.instanceColor!==null&&o.remove(C.instanceColor)}return{update:f,dispose:x}}class QB extends ps{constructor(e=null,o=1,h=1,l=1){super(null),this.image={data:e,width:o,height:h,depth:l},this.magFilter=qs,this.minFilter=qs,this.wrapR=wa,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}QB.prototype.isDataTexture2DArray=!0;class e4 extends ps{constructor(e=null,o=1,h=1,l=1){super(null),this.image={data:e,width:o,height:h,depth:l},this.magFilter=qs,this.minFilter=qs,this.wrapR=wa,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}e4.prototype.isDataTexture3D=!0;const t4=new ps,rQ=new QB,oQ=new e4,i4=new ow,oL=[],sL=[],aL=new Float32Array(16),lL=new Float32Array(9),cL=new Float32Array(4);function kp(i,e,o){const h=i[0];if(h<=0||h>0)return i;const l=e*o;let f=oL[l];if(f===void 0&&(f=new Float32Array(l),oL[l]=f),e!==0){h.toArray(f,0);for(let x=1,s=0;x!==e;++x)s+=o,i[x].toArray(f,s)}return f}function Ja(i,e){if(i.length!==e.length)return!1;for(let o=0,h=i.length;o<h;o++)if(i[o]!==e[o])return!1;return!0}function Sa(i,e){for(let o=0,h=e.length;o<h;o++)i[o]=e[o]}function n4(i,e){let o=sL[e];o===void 0&&(o=new Int32Array(e),sL[e]=o);for(let h=0;h!==e;++h)o[h]=i.allocateTextureUnit();return o}function sQ(i,e){const o=this.cache;o[0]!==e&&(i.uniform1f(this.addr,e),o[0]=e)}function aQ(i,e){const o=this.cache;if(e.x!==void 0)(o[0]!==e.x||o[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),o[0]=e.x,o[1]=e.y);else{if(Ja(o,e))return;i.uniform2fv(this.addr,e),Sa(o,e)}}function lQ(i,e){const o=this.cache;if(e.x!==void 0)(o[0]!==e.x||o[1]!==e.y||o[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),o[0]=e.x,o[1]=e.y,o[2]=e.z);else if(e.r!==void 0)(o[0]!==e.r||o[1]!==e.g||o[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),o[0]=e.r,o[1]=e.g,o[2]=e.b);else{if(Ja(o,e))return;i.uniform3fv(this.addr,e),Sa(o,e)}}function cQ(i,e){const o=this.cache;if(e.x!==void 0)(o[0]!==e.x||o[1]!==e.y||o[2]!==e.z||o[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),o[0]=e.x,o[1]=e.y,o[2]=e.z,o[3]=e.w);else{if(Ja(o,e))return;i.uniform4fv(this.addr,e),Sa(o,e)}}function uQ(i,e){const o=this.cache,h=e.elements;if(h===void 0){if(Ja(o,e))return;i.uniformMatrix2fv(this.addr,!1,e),Sa(o,e)}else{if(Ja(o,h))return;cL.set(h),i.uniformMatrix2fv(this.addr,!1,cL),Sa(o,h)}}function hQ(i,e){const o=this.cache,h=e.elements;if(h===void 0){if(Ja(o,e))return;i.uniformMatrix3fv(this.addr,!1,e),Sa(o,e)}else{if(Ja(o,h))return;lL.set(h),i.uniformMatrix3fv(this.addr,!1,lL),Sa(o,h)}}function dQ(i,e){const o=this.cache,h=e.elements;if(h===void 0){if(Ja(o,e))return;i.uniformMatrix4fv(this.addr,!1,e),Sa(o,e)}else{if(Ja(o,h))return;aL.set(h),i.uniformMatrix4fv(this.addr,!1,aL),Sa(o,h)}}function fQ(i,e,o){const h=this.cache,l=o.allocateTextureUnit();h[0]!==l&&(i.uniform1i(this.addr,l),h[0]=l),o.safeSetTexture2D(e||t4,l)}function pQ(i,e,o){const h=this.cache,l=o.allocateTextureUnit();h[0]!==l&&(i.uniform1i(this.addr,l),h[0]=l),o.setTexture2DArray(e||rQ,l)}function mQ(i,e,o){const h=this.cache,l=o.allocateTextureUnit();h[0]!==l&&(i.uniform1i(this.addr,l),h[0]=l),o.setTexture3D(e||oQ,l)}function gQ(i,e,o){const h=this.cache,l=o.allocateTextureUnit();h[0]!==l&&(i.uniform1i(this.addr,l),h[0]=l),o.safeSetTextureCube(e||i4,l)}function _Q(i,e){const o=this.cache;o[0]!==e&&(i.uniform1i(this.addr,e),o[0]=e)}function yQ(i,e){const o=this.cache;Ja(o,e)||(i.uniform2iv(this.addr,e),Sa(o,e))}function vQ(i,e){const o=this.cache;Ja(o,e)||(i.uniform3iv(this.addr,e),Sa(o,e))}function xQ(i,e){const o=this.cache;Ja(o,e)||(i.uniform4iv(this.addr,e),Sa(o,e))}function bQ(i,e){const o=this.cache;o[0]!==e&&(i.uniform1ui(this.addr,e),o[0]=e)}function wQ(i){switch(i){case 5126:return sQ;case 35664:return aQ;case 35665:return lQ;case 35666:return cQ;case 35674:return uQ;case 35675:return hQ;case 35676:return dQ;case 5124:case 35670:return _Q;case 35667:case 35671:return yQ;case 35668:case 35672:return vQ;case 35669:case 35673:return xQ;case 5125:return bQ;case 35678:case 36198:case 36298:case 36306:case 35682:return fQ;case 35679:case 36299:case 36307:return mQ;case 35680:case 36300:case 36308:case 36293:return gQ;case 36289:case 36303:case 36311:case 36292:return pQ}}function SQ(i,e){i.uniform1fv(this.addr,e)}function TQ(i,e){i.uniform1iv(this.addr,e)}function EQ(i,e){i.uniform2iv(this.addr,e)}function IQ(i,e){i.uniform3iv(this.addr,e)}function MQ(i,e){i.uniform4iv(this.addr,e)}function AQ(i,e){const o=kp(e,this.size,2);i.uniform2fv(this.addr,o)}function PQ(i,e){const o=kp(e,this.size,3);i.uniform3fv(this.addr,o)}function zQ(i,e){const o=kp(e,this.size,4);i.uniform4fv(this.addr,o)}function CQ(i,e){const o=kp(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,o)}function LQ(i,e){const o=kp(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,o)}function RQ(i,e){const o=kp(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,o)}function DQ(i,e,o){const h=e.length,l=n4(o,h);i.uniform1iv(this.addr,l);for(let f=0;f!==h;++f)o.safeSetTexture2D(e[f]||t4,l[f])}function kQ(i,e,o){const h=e.length,l=n4(o,h);i.uniform1iv(this.addr,l);for(let f=0;f!==h;++f)o.safeSetTextureCube(e[f]||i4,l[f])}function OQ(i){switch(i){case 5126:return SQ;case 35664:return AQ;case 35665:return PQ;case 35666:return zQ;case 35674:return CQ;case 35675:return LQ;case 35676:return RQ;case 5124:case 35670:return TQ;case 35667:case 35671:return EQ;case 35668:case 35672:return IQ;case 35669:case 35673:return MQ;case 35678:case 36198:case 36298:case 36306:case 35682:return DQ;case 35680:case 36300:case 36308:case 36293:return kQ}}function FQ(i,e,o){this.id=i,this.addr=o,this.cache=[],this.setValue=wQ(e.type)}function r4(i,e,o){this.id=i,this.addr=o,this.cache=[],this.size=e.size,this.setValue=OQ(e.type)}r4.prototype.updateCache=function(i){const e=this.cache;i instanceof Float32Array&&e.length!==i.length&&(this.cache=new Float32Array(i.length)),Sa(e,i)};function o4(i){this.id=i,this.seq=[],this.map={}}o4.prototype.setValue=function(i,e,o){const h=this.seq;for(let l=0,f=h.length;l!==f;++l){const x=h[l];x.setValue(i,e[x.id],o)}};const GS=/(\w+)(\])?(\[|\.)?/g;function uL(i,e){i.seq.push(e),i.map[e.id]=e}function BQ(i,e,o){const h=i.name,l=h.length;for(GS.lastIndex=0;;){const f=GS.exec(h),x=GS.lastIndex;let s=f[1];const P=f[2]==="]",C=f[3];if(P&&(s=s|0),C===void 0||C==="["&&x+2===l){uL(o,C===void 0?new FQ(s,i,e):new r4(s,i,e));break}else{let F=o.map[s];F===void 0&&(F=new o4(s),uL(o,F)),o=F}}}function Uu(i,e){this.seq=[],this.map={};const o=i.getProgramParameter(e,35718);for(let h=0;h<o;++h){const l=i.getActiveUniform(e,h),f=i.getUniformLocation(e,l.name);BQ(l,f,this)}}Uu.prototype.setValue=function(i,e,o,h){const l=this.map[e];l!==void 0&&l.setValue(i,o,h)};Uu.prototype.setOptional=function(i,e,o){const h=e[o];h!==void 0&&this.setValue(i,o,h)};Uu.upload=function(i,e,o,h){for(let l=0,f=e.length;l!==f;++l){const x=e[l],s=o[x.id];s.needsUpdate!==!1&&x.setValue(i,s.value,h)}};Uu.seqWithValue=function(i,e){const o=[];for(let h=0,l=i.length;h!==l;++h){const f=i[h];f.id in e&&o.push(f)}return o};function hL(i,e,o){const h=i.createShader(e);return i.shaderSource(h,o),i.compileShader(h),h}let NQ=0;function UQ(i){const e=i.split(`
`);for(let o=0;o<e.length;o++)e[o]=o+1+": "+e[o];return e.join(`
`)}function s4(i){switch(i){case my:return["Linear","( value )"];case WB:return["sRGB","( value )"];case XX:return["RGBE","( value )"];case YX:return["RGBM","( value, 7.0 )"];case KX:return["RGBM","( value, 16.0 )"];case QX:return["RGBD","( value, 256.0 )"];case qX:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case JX:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function dL(i,e,o){const h=i.getShaderParameter(e,35713),l=i.getShaderInfoLog(e).trim();if(h&&l==="")return"";const f=i.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+o+`
`+l+UQ(f)}function e_(i,e){const o=s4(e);return"vec4 "+i+"( vec4 value ) { return "+o[0]+"ToLinear"+o[1]+"; }"}function $Q(i,e){const o=s4(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+o[0]+o[1]+"; }"}function VQ(i,e){let o;switch(e){case W7:o="Linear";break;case q7:o="Reinhard";break;case X7:o="OptimizedCineon";break;case J7:o="ACESFilmic";break;case Y7:o="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),o="Linear"}return"vec3 "+i+"( vec3 color ) { return "+o+"ToneMapping( color ); }"}function jQ(i){return[i.extensionDerivatives||i.envMapCubeUV||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(c_).join(`
`)}function GQ(i){const e=[];for(const o in i){const h=i[o];h!==!1&&e.push("#define "+o+" "+h)}return e.join(`
`)}function HQ(i,e){const o={},h=i.getProgramParameter(e,35721);for(let l=0;l<h;l++){const x=i.getActiveAttrib(e,l).name;o[x]=i.getAttribLocation(e,x)}return o}function c_(i){return i!==""}function fL(i,e){return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pL(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ZQ=/^[ \t]*#include +<([\w\d./]+)>/gm;function _T(i){return i.replace(ZQ,WQ)}function WQ(i,e){const o=Yn[e];if(o===void 0)throw new Error("Can not resolve #include <"+e+">");return _T(o)}const qQ=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,XQ=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function mL(i){return i.replace(XQ,a4).replace(qQ,JQ)}function JQ(i,e,o,h){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),a4(i,e,o,h)}function a4(i,e,o,h){let l="";for(let f=parseInt(e);f<parseInt(o);f++)l+=h.replace(/\[\s*i\s*\]/g,"[ "+f+" ]").replace(/UNROLLED_LOOP_INDEX/g,f);return l}function gL(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function YQ(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===$B?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===E7?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===l_&&(e="SHADOWMAP_TYPE_VSM"),e}function KQ(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case o2:case s2:e="ENVMAP_TYPE_CUBE";break;case a2:case l2:e="ENVMAP_TYPE_CUBE_UV";break}return e}function QQ(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case s2:case l2:e="ENVMAP_MODE_REFRACTION";break}return e}function eee(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case iw:e="ENVMAP_BLENDING_MULTIPLY";break;case H7:e="ENVMAP_BLENDING_MIX";break;case Z7:e="ENVMAP_BLENDING_ADD";break}return e}function tee(i,e,o,h){const l=i.getContext(),f=o.defines;let x=o.vertexShader,s=o.fragmentShader;const P=YQ(o),C=KQ(o),O=QQ(o),F=eee(o),V=i.gammaFactor>0?i.gammaFactor:1,q=o.isWebGL2?"":jQ(o),ee=GQ(f),se=l.createProgram();let fe,ae,ie=o.glslVersion?"#version "+o.glslVersion+`
`:"";o.isRawShaderMaterial?(fe=[ee].filter(c_).join(`
`),fe.length>0&&(fe+=`
`),ae=[q,ee].filter(c_).join(`
`),ae.length>0&&(ae+=`
`)):(fe=[gL(o),"#define SHADER_NAME "+o.shaderName,ee,o.instancing?"#define USE_INSTANCING":"",o.instancingColor?"#define USE_INSTANCING_COLOR":"",o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+V,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+O:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&o.flatShading===!1?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+P:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&o.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(c_).join(`
`),ae=[q,gL(o),"#define SHADER_NAME "+o.shaderName,ee,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+V,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+C:"",o.envMap?"#define "+O:"",o.envMap?"#define "+F:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.sheen?"#define USE_SHEEN":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors||o.instancingColor?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+P:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&o.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(o.extensionShaderTextureLOD||o.envMap)&&o.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",o.toneMapping!==d_?"#define TONE_MAPPING":"",o.toneMapping!==d_?Yn.tonemapping_pars_fragment:"",o.toneMapping!==d_?VQ("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",Yn.encodings_pars_fragment,o.map?e_("mapTexelToLinear",o.mapEncoding):"",o.matcap?e_("matcapTexelToLinear",o.matcapEncoding):"",o.envMap?e_("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMap?e_("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.lightMap?e_("lightMapTexelToLinear",o.lightMapEncoding):"",$Q("linearToOutputTexel",o.outputEncoding),o.depthPacking?"#define DEPTH_PACKING "+o.depthPacking:"",`
`].filter(c_).join(`
`)),x=_T(x),x=fL(x,o),x=pL(x,o),s=_T(s),s=fL(s,o),s=pL(s,o),x=mL(x),s=mL(s),o.isWebGL2&&o.isRawShaderMaterial!==!0&&(ie=`#version 300 es
`,fe=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+fe,ae=["#define varying in",o.glslVersion===qC?"":"out highp vec4 pc_fragColor;",o.glslVersion===qC?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ae);const tt=ie+fe+x,Ue=ie+ae+s,Ne=hL(l,35633,tt),Ce=hL(l,35632,Ue);if(l.attachShader(se,Ne),l.attachShader(se,Ce),o.index0AttributeName!==void 0?l.bindAttribLocation(se,0,o.index0AttributeName):o.morphTargets===!0&&l.bindAttribLocation(se,0,"position"),l.linkProgram(se),i.debug.checkShaderErrors){const ft=l.getProgramInfoLog(se).trim(),wt=l.getShaderInfoLog(Ne).trim(),Et=l.getShaderInfoLog(Ce).trim();let Dt=!0,Qe=!0;if(l.getProgramParameter(se,35714)===!1){Dt=!1;const ht=dL(l,Ne,"vertex"),_t=dL(l,Ce,"fragment");console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(se,35715),"gl.getProgramInfoLog",ft,ht,_t)}else ft!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",ft):(wt===""||Et==="")&&(Qe=!1);Qe&&(this.diagnostics={runnable:Dt,programLog:ft,vertexShader:{log:wt,prefix:fe},fragmentShader:{log:Et,prefix:ae}})}l.deleteShader(Ne),l.deleteShader(Ce);let Ye;this.getUniforms=function(){return Ye===void 0&&(Ye=new Uu(l,se)),Ye};let At;return this.getAttributes=function(){return At===void 0&&(At=HQ(l,se)),At},this.destroy=function(){h.releaseStatesOfProgram(this),l.deleteProgram(se),this.program=void 0},this.name=o.shaderName,this.id=NQ++,this.cacheKey=e,this.usedTimes=1,this.program=se,this.vertexShader=Ne,this.fragmentShader=Ce,this}function iee(i,e,o,h,l,f){const x=[],s=h.isWebGL2,P=h.logarithmicDepthBuffer,C=h.floatVertexTextures,O=h.maxVertexUniforms,F=h.vertexTextures;let V=h.precision;const q={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},ee=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function se(Ce){const At=Ce.skeleton.bones;if(C)return 1024;{const wt=Math.floor((O-20)/4),Et=Math.min(wt,At.length);return Et<At.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+At.length+" bones. This GPU supports "+Et+"."),0):Et}}function fe(Ce){let Ye;return Ce&&Ce.isTexture?Ye=Ce.encoding:Ce&&Ce.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),Ye=Ce.texture.encoding):Ye=my,Ye}function ae(Ce,Ye,At,ft,wt){const Et=ft.fog,Dt=Ce.isMeshStandardMaterial?ft.environment:null,Qe=e.get(Ce.envMap||Dt),ht=q[Ce.type],_t=wt.isSkinnedMesh?se(wt):0;Ce.precision!==null&&(V=h.getMaxPrecision(Ce.precision),V!==Ce.precision&&console.warn("THREE.WebGLProgram.getParameters:",Ce.precision,"not supported, using",V,"instead."));let yt,Nt;if(ht){const Pi=rc[ht];yt=Pi.vertexShader,Nt=Pi.fragmentShader}else yt=Ce.vertexShader,Nt=Ce.fragmentShader;const ei=i.getRenderTarget();return{isWebGL2:s,shaderID:ht,shaderName:Ce.type,vertexShader:yt,fragmentShader:Nt,defines:Ce.defines,isRawShaderMaterial:Ce.isRawShaderMaterial===!0,glslVersion:Ce.glslVersion,precision:V,instancing:wt.isInstancedMesh===!0,instancingColor:wt.isInstancedMesh===!0&&wt.instanceColor!==null,supportsVertexTextures:F,outputEncoding:ei!==null?fe(ei.texture):i.outputEncoding,map:!!Ce.map,mapEncoding:fe(Ce.map),matcap:!!Ce.matcap,matcapEncoding:fe(Ce.matcap),envMap:!!Qe,envMapMode:Qe&&Qe.mapping,envMapEncoding:fe(Qe),envMapCubeUV:!!Qe&&(Qe.mapping===a2||Qe.mapping===l2),lightMap:!!Ce.lightMap,lightMapEncoding:fe(Ce.lightMap),aoMap:!!Ce.aoMap,emissiveMap:!!Ce.emissiveMap,emissiveMapEncoding:fe(Ce.emissiveMap),bumpMap:!!Ce.bumpMap,normalMap:!!Ce.normalMap,objectSpaceNormalMap:Ce.normalMapType===iJ,tangentSpaceNormalMap:Ce.normalMapType===Cp,clearcoatMap:!!Ce.clearcoatMap,clearcoatRoughnessMap:!!Ce.clearcoatRoughnessMap,clearcoatNormalMap:!!Ce.clearcoatNormalMap,displacementMap:!!Ce.displacementMap,roughnessMap:!!Ce.roughnessMap,metalnessMap:!!Ce.metalnessMap,specularMap:!!Ce.specularMap,alphaMap:!!Ce.alphaMap,gradientMap:!!Ce.gradientMap,sheen:!!Ce.sheen,transmissionMap:!!Ce.transmissionMap,combine:Ce.combine,vertexTangents:Ce.normalMap&&Ce.vertexTangents,vertexColors:Ce.vertexColors,vertexUvs:!!Ce.map||!!Ce.bumpMap||!!Ce.normalMap||!!Ce.specularMap||!!Ce.alphaMap||!!Ce.emissiveMap||!!Ce.roughnessMap||!!Ce.metalnessMap||!!Ce.clearcoatMap||!!Ce.clearcoatRoughnessMap||!!Ce.clearcoatNormalMap||!!Ce.displacementMap||!!Ce.transmissionMap,uvsVertexOnly:!(Ce.map||Ce.bumpMap||Ce.normalMap||Ce.specularMap||Ce.alphaMap||Ce.emissiveMap||Ce.roughnessMap||Ce.metalnessMap||Ce.clearcoatNormalMap||Ce.transmissionMap)&&!!Ce.displacementMap,fog:!!Et,useFog:Ce.fog,fogExp2:Et&&Et.isFogExp2,flatShading:!!Ce.flatShading,sizeAttenuation:Ce.sizeAttenuation,logarithmicDepthBuffer:P,skinning:Ce.skinning&&_t>0,maxBones:_t,useVertexTexture:C,morphTargets:Ce.morphTargets,morphNormals:Ce.morphNormals,maxMorphTargets:i.maxMorphTargets,maxMorphNormals:i.maxMorphNormals,numDirLights:Ye.directional.length,numPointLights:Ye.point.length,numSpotLights:Ye.spot.length,numRectAreaLights:Ye.rectArea.length,numHemiLights:Ye.hemi.length,numDirLightShadows:Ye.directionalShadowMap.length,numPointLightShadows:Ye.pointShadowMap.length,numSpotLightShadows:Ye.spotShadowMap.length,numClippingPlanes:f.numPlanes,numClipIntersection:f.numIntersection,dithering:Ce.dithering,shadowMapEnabled:i.shadowMap.enabled&&At.length>0,shadowMapType:i.shadowMap.type,toneMapping:Ce.toneMapped?i.toneMapping:d_,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:Ce.premultipliedAlpha,alphaTest:Ce.alphaTest,doubleSided:Ce.side===tw,flipSided:Ce.side===Yo,depthPacking:Ce.depthPacking!==void 0?Ce.depthPacking:!1,index0AttributeName:Ce.index0AttributeName,extensionDerivatives:Ce.extensions&&Ce.extensions.derivatives,extensionFragDepth:Ce.extensions&&Ce.extensions.fragDepth,extensionDrawBuffers:Ce.extensions&&Ce.extensions.drawBuffers,extensionShaderTextureLOD:Ce.extensions&&Ce.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||o.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||o.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||o.has("EXT_shader_texture_lod"),customProgramCacheKey:Ce.customProgramCacheKey()}}function ie(Ce){const Ye=[];if(Ce.shaderID?Ye.push(Ce.shaderID):(Ye.push(Ce.fragmentShader),Ye.push(Ce.vertexShader)),Ce.defines!==void 0)for(const At in Ce.defines)Ye.push(At),Ye.push(Ce.defines[At]);if(Ce.isRawShaderMaterial===!1){for(let At=0;At<ee.length;At++)Ye.push(Ce[ee[At]]);Ye.push(i.outputEncoding),Ye.push(i.gammaFactor)}return Ye.push(Ce.customProgramCacheKey),Ye.join()}function tt(Ce){const Ye=q[Ce.type];let At;if(Ye){const ft=rc[Ye];At=yJ.clone(ft.uniforms)}else At=Ce.uniforms;return At}function Ue(Ce,Ye){let At;for(let ft=0,wt=x.length;ft<wt;ft++){const Et=x[ft];if(Et.cacheKey===Ye){At=Et,++At.usedTimes;break}}return At===void 0&&(At=new tee(i,Ye,Ce,l),x.push(At)),At}function Ne(Ce){if(--Ce.usedTimes===0){const Ye=x.indexOf(Ce);x[Ye]=x[x.length-1],x.pop(),Ce.destroy()}}return{getParameters:ae,getProgramCacheKey:ie,getUniforms:tt,acquireProgram:Ue,releaseProgram:Ne,programs:x}}function nee(){let i=new WeakMap;function e(f){let x=i.get(f);return x===void 0&&(x={},i.set(f,x)),x}function o(f){i.delete(f)}function h(f,x,s){i.get(f)[x]=s}function l(){i=new WeakMap}return{get:e,remove:o,update:h,dispose:l}}function ree(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.program!==e.program?i.program.id-e.program.id:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function oee(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function _L(i){const e=[];let o=0;const h=[],l=[],f={id:-1};function x(){o=0,h.length=0,l.length=0}function s(V,q,ee,se,fe,ae){let ie=e[o];const tt=i.get(ee);return ie===void 0?(ie={id:V.id,object:V,geometry:q,material:ee,program:tt.program||f,groupOrder:se,renderOrder:V.renderOrder,z:fe,group:ae},e[o]=ie):(ie.id=V.id,ie.object=V,ie.geometry=q,ie.material=ee,ie.program=tt.program||f,ie.groupOrder=se,ie.renderOrder=V.renderOrder,ie.z=fe,ie.group=ae),o++,ie}function P(V,q,ee,se,fe,ae){const ie=s(V,q,ee,se,fe,ae);(ee.transparent===!0?l:h).push(ie)}function C(V,q,ee,se,fe,ae){const ie=s(V,q,ee,se,fe,ae);(ee.transparent===!0?l:h).unshift(ie)}function O(V,q){h.length>1&&h.sort(V||ree),l.length>1&&l.sort(q||oee)}function F(){for(let V=o,q=e.length;V<q;V++){const ee=e[V];if(ee.id===null)break;ee.id=null,ee.object=null,ee.geometry=null,ee.material=null,ee.program=null,ee.group=null}}return{opaque:h,transparent:l,init:x,push:P,unshift:C,finish:F,sort:O}}function see(i){let e=new WeakMap;function o(l,f){let x;return e.has(l)===!1?(x=new _L(i),e.set(l,[x])):f>=e.get(l).length?(x=new _L(i),e.get(l).push(x)):x=e.get(l)[f],x}function h(){e=new WeakMap}return{get:o,dispose:h}}function aee(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let o;switch(e.type){case"DirectionalLight":o={direction:new He,color:new mn};break;case"SpotLight":o={position:new He,direction:new He,color:new mn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":o={position:new He,color:new mn,distance:0,decay:0};break;case"HemisphereLight":o={direction:new He,skyColor:new mn,groundColor:new mn};break;case"RectAreaLight":o={color:new mn,position:new He,halfWidth:new He,halfHeight:new He};break}return i[e.id]=o,o}}}function lee(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let o;switch(e.type){case"DirectionalLight":o={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gi};break;case"SpotLight":o={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gi};break;case"PointLight":o={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gi,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=o,o}}}let cee=0;function uee(i,e){return(e.castShadow?1:0)-(i.castShadow?1:0)}function hee(i,e){const o=new aee,h=lee(),l={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let O=0;O<9;O++)l.probe.push(new He);const f=new He,x=new nn,s=new nn;function P(O){let F=0,V=0,q=0;for(let Ye=0;Ye<9;Ye++)l.probe[Ye].set(0,0,0);let ee=0,se=0,fe=0,ae=0,ie=0,tt=0,Ue=0,Ne=0;O.sort(uee);for(let Ye=0,At=O.length;Ye<At;Ye++){const ft=O[Ye],wt=ft.color,Et=ft.intensity,Dt=ft.distance,Qe=ft.shadow&&ft.shadow.map?ft.shadow.map.texture:null;if(ft.isAmbientLight)F+=wt.r*Et,V+=wt.g*Et,q+=wt.b*Et;else if(ft.isLightProbe)for(let ht=0;ht<9;ht++)l.probe[ht].addScaledVector(ft.sh.coefficients[ht],Et);else if(ft.isDirectionalLight){const ht=o.get(ft);if(ht.color.copy(ft.color).multiplyScalar(ft.intensity),ft.castShadow){const _t=ft.shadow,yt=h.get(ft);yt.shadowBias=_t.bias,yt.shadowNormalBias=_t.normalBias,yt.shadowRadius=_t.radius,yt.shadowMapSize=_t.mapSize,l.directionalShadow[ee]=yt,l.directionalShadowMap[ee]=Qe,l.directionalShadowMatrix[ee]=ft.shadow.matrix,tt++}l.directional[ee]=ht,ee++}else if(ft.isSpotLight){const ht=o.get(ft);if(ht.position.setFromMatrixPosition(ft.matrixWorld),ht.color.copy(wt).multiplyScalar(Et),ht.distance=Dt,ht.coneCos=Math.cos(ft.angle),ht.penumbraCos=Math.cos(ft.angle*(1-ft.penumbra)),ht.decay=ft.decay,ft.castShadow){const _t=ft.shadow,yt=h.get(ft);yt.shadowBias=_t.bias,yt.shadowNormalBias=_t.normalBias,yt.shadowRadius=_t.radius,yt.shadowMapSize=_t.mapSize,l.spotShadow[fe]=yt,l.spotShadowMap[fe]=Qe,l.spotShadowMatrix[fe]=ft.shadow.matrix,Ne++}l.spot[fe]=ht,fe++}else if(ft.isRectAreaLight){const ht=o.get(ft);ht.color.copy(wt).multiplyScalar(Et),ht.halfWidth.set(ft.width*.5,0,0),ht.halfHeight.set(0,ft.height*.5,0),l.rectArea[ae]=ht,ae++}else if(ft.isPointLight){const ht=o.get(ft);if(ht.color.copy(ft.color).multiplyScalar(ft.intensity),ht.distance=ft.distance,ht.decay=ft.decay,ft.castShadow){const _t=ft.shadow,yt=h.get(ft);yt.shadowBias=_t.bias,yt.shadowNormalBias=_t.normalBias,yt.shadowRadius=_t.radius,yt.shadowMapSize=_t.mapSize,yt.shadowCameraNear=_t.camera.near,yt.shadowCameraFar=_t.camera.far,l.pointShadow[se]=yt,l.pointShadowMap[se]=Qe,l.pointShadowMatrix[se]=ft.shadow.matrix,Ue++}l.point[se]=ht,se++}else if(ft.isHemisphereLight){const ht=o.get(ft);ht.skyColor.copy(ft.color).multiplyScalar(Et),ht.groundColor.copy(ft.groundColor).multiplyScalar(Et),l.hemi[ie]=ht,ie++}}ae>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(l.rectAreaLTC1=Ci.LTC_FLOAT_1,l.rectAreaLTC2=Ci.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(l.rectAreaLTC1=Ci.LTC_HALF_1,l.rectAreaLTC2=Ci.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),l.ambient[0]=F,l.ambient[1]=V,l.ambient[2]=q;const Ce=l.hash;(Ce.directionalLength!==ee||Ce.pointLength!==se||Ce.spotLength!==fe||Ce.rectAreaLength!==ae||Ce.hemiLength!==ie||Ce.numDirectionalShadows!==tt||Ce.numPointShadows!==Ue||Ce.numSpotShadows!==Ne)&&(l.directional.length=ee,l.spot.length=fe,l.rectArea.length=ae,l.point.length=se,l.hemi.length=ie,l.directionalShadow.length=tt,l.directionalShadowMap.length=tt,l.pointShadow.length=Ue,l.pointShadowMap.length=Ue,l.spotShadow.length=Ne,l.spotShadowMap.length=Ne,l.directionalShadowMatrix.length=tt,l.pointShadowMatrix.length=Ue,l.spotShadowMatrix.length=Ne,Ce.directionalLength=ee,Ce.pointLength=se,Ce.spotLength=fe,Ce.rectAreaLength=ae,Ce.hemiLength=ie,Ce.numDirectionalShadows=tt,Ce.numPointShadows=Ue,Ce.numSpotShadows=Ne,l.version=cee++)}function C(O,F){let V=0,q=0,ee=0,se=0,fe=0;const ae=F.matrixWorldInverse;for(let ie=0,tt=O.length;ie<tt;ie++){const Ue=O[ie];if(Ue.isDirectionalLight){const Ne=l.directional[V];Ne.direction.setFromMatrixPosition(Ue.matrixWorld),f.setFromMatrixPosition(Ue.target.matrixWorld),Ne.direction.sub(f),Ne.direction.transformDirection(ae),V++}else if(Ue.isSpotLight){const Ne=l.spot[ee];Ne.position.setFromMatrixPosition(Ue.matrixWorld),Ne.position.applyMatrix4(ae),Ne.direction.setFromMatrixPosition(Ue.matrixWorld),f.setFromMatrixPosition(Ue.target.matrixWorld),Ne.direction.sub(f),Ne.direction.transformDirection(ae),ee++}else if(Ue.isRectAreaLight){const Ne=l.rectArea[se];Ne.position.setFromMatrixPosition(Ue.matrixWorld),Ne.position.applyMatrix4(ae),s.identity(),x.copy(Ue.matrixWorld),x.premultiply(ae),s.extractRotation(x),Ne.halfWidth.set(Ue.width*.5,0,0),Ne.halfHeight.set(0,Ue.height*.5,0),Ne.halfWidth.applyMatrix4(s),Ne.halfHeight.applyMatrix4(s),se++}else if(Ue.isPointLight){const Ne=l.point[q];Ne.position.setFromMatrixPosition(Ue.matrixWorld),Ne.position.applyMatrix4(ae),q++}else if(Ue.isHemisphereLight){const Ne=l.hemi[fe];Ne.direction.setFromMatrixPosition(Ue.matrixWorld),Ne.direction.transformDirection(ae),Ne.direction.normalize(),fe++}}}return{setup:P,setupView:C,state:l}}function yL(i,e){const o=new hee(i,e),h=[],l=[];function f(){h.length=0,l.length=0}function x(F){h.push(F)}function s(F){l.push(F)}function P(){o.setup(h)}function C(F){o.setupView(h,F)}return{init:f,state:{lightsArray:h,shadowsArray:l,lights:o},setupLights:P,setupLightsView:C,pushLight:x,pushShadow:s}}function dee(i,e){let o=new WeakMap;function h(f,x=0){let s;return o.has(f)===!1?(s=new yL(i,e),o.set(f,[s])):x>=o.get(f).length?(s=new yL(i,e),o.get(f).push(s)):s=o.get(f)[x],s}function l(){o=new WeakMap}return{get:h,dispose:l}}class l4 extends fo{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=eJ,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}l4.prototype.isMeshDepthMaterial=!0;class c4 extends fo{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new He,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}c4.prototype.isMeshDistanceMaterial=!0;var fee=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,pee=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function u4(i,e,o){let h=new sw;const l=new gi,f=new gi,x=new Lr,s=[],P=[],C={},O={0:Yo,1:ew,2:tw},F=new Xa({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new gi},radius:{value:4}},vertexShader:pee,fragmentShader:fee}),V=F.clone();V.defines.HORIZONTAL_PASS=1;const q=new _r;q.setAttribute("position",new qn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const ee=new lr(q,F),se=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=$B,this.render=function(Ne,Ce,Ye){if(se.enabled===!1||se.autoUpdate===!1&&se.needsUpdate===!1||Ne.length===0)return;const At=i.getRenderTarget(),ft=i.getActiveCubeFace(),wt=i.getActiveMipmapLevel(),Et=i.state;Et.setBlending(u_),Et.buffers.color.setClear(1,1,1,1),Et.buffers.depth.setTest(!0),Et.setScissorTest(!1);for(let Dt=0,Qe=Ne.length;Dt<Qe;Dt++){const ht=Ne[Dt],_t=ht.shadow;if(_t===void 0){console.warn("THREE.WebGLShadowMap:",ht,"has no shadow.");continue}if(_t.autoUpdate===!1&&_t.needsUpdate===!1)continue;l.copy(_t.mapSize);const yt=_t.getFrameExtents();if(l.multiply(yt),f.copy(_t.mapSize),(l.x>o||l.y>o)&&(l.x>o&&(f.x=Math.floor(o/yt.x),l.x=f.x*yt.x,_t.mapSize.x=f.x),l.y>o&&(f.y=Math.floor(o/yt.y),l.y=f.y*yt.y,_t.mapSize.y=f.y)),_t.map===null&&!_t.isPointLightShadow&&this.type===l_){const ei={minFilter:ds,magFilter:ds,format:El};_t.map=new od(l.x,l.y,ei),_t.map.texture.name=ht.name+".shadowMap",_t.mapPass=new od(l.x,l.y,ei),_t.camera.updateProjectionMatrix()}if(_t.map===null){const ei={minFilter:qs,magFilter:qs,format:El};_t.map=new od(l.x,l.y,ei),_t.map.texture.name=ht.name+".shadowMap",_t.camera.updateProjectionMatrix()}i.setRenderTarget(_t.map),i.clear();const Nt=_t.getViewportCount();for(let ei=0;ei<Nt;ei++){const mi=_t.getViewport(ei);x.set(f.x*mi.x,f.y*mi.y,f.x*mi.z,f.y*mi.w),Et.viewport(x),_t.updateMatrices(ht,ei),h=_t.getFrustum(),Ue(Ce,Ye,_t.camera,ht,this.type)}!_t.isPointLightShadow&&this.type===l_&&fe(_t,Ye),_t.needsUpdate=!1}se.needsUpdate=!1,i.setRenderTarget(At,ft,wt)};function fe(Ne,Ce){const Ye=e.update(ee);F.uniforms.shadow_pass.value=Ne.map.texture,F.uniforms.resolution.value=Ne.mapSize,F.uniforms.radius.value=Ne.radius,i.setRenderTarget(Ne.mapPass),i.clear(),i.renderBufferDirect(Ce,null,Ye,F,ee,null),V.uniforms.shadow_pass.value=Ne.mapPass.texture,V.uniforms.resolution.value=Ne.mapSize,V.uniforms.radius.value=Ne.radius,i.setRenderTarget(Ne.map),i.clear(),i.renderBufferDirect(Ce,null,Ye,V,ee,null)}function ae(Ne,Ce,Ye){const At=Ne<<0|Ce<<1|Ye<<2;let ft=s[At];return ft===void 0&&(ft=new l4({depthPacking:tJ,morphTargets:Ne,skinning:Ce}),s[At]=ft),ft}function ie(Ne,Ce,Ye){const At=Ne<<0|Ce<<1|Ye<<2;let ft=P[At];return ft===void 0&&(ft=new c4({morphTargets:Ne,skinning:Ce}),P[At]=ft),ft}function tt(Ne,Ce,Ye,At,ft,wt,Et){let Dt=null,Qe=ae,ht=Ne.customDepthMaterial;if(At.isPointLight===!0&&(Qe=ie,ht=Ne.customDistanceMaterial),ht===void 0){let _t=!1;Ye.morphTargets===!0&&(_t=Ce.morphAttributes&&Ce.morphAttributes.position&&Ce.morphAttributes.position.length>0);let yt=!1;Ne.isSkinnedMesh===!0&&(Ye.skinning===!0?yt=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",Ne));const Nt=Ne.isInstancedMesh===!0;Dt=Qe(_t,yt,Nt)}else Dt=ht;if(i.localClippingEnabled&&Ye.clipShadows===!0&&Ye.clippingPlanes.length!==0){const _t=Dt.uuid,yt=Ye.uuid;let Nt=C[_t];Nt===void 0&&(Nt={},C[_t]=Nt);let ei=Nt[yt];ei===void 0&&(ei=Dt.clone(),Nt[yt]=ei),Dt=ei}return Dt.visible=Ye.visible,Dt.wireframe=Ye.wireframe,Et===l_?Dt.side=Ye.shadowSide!==null?Ye.shadowSide:Ye.side:Dt.side=Ye.shadowSide!==null?Ye.shadowSide:O[Ye.side],Dt.clipShadows=Ye.clipShadows,Dt.clippingPlanes=Ye.clippingPlanes,Dt.clipIntersection=Ye.clipIntersection,Dt.wireframeLinewidth=Ye.wireframeLinewidth,Dt.linewidth=Ye.linewidth,At.isPointLight===!0&&Dt.isMeshDistanceMaterial===!0&&(Dt.referencePosition.setFromMatrixPosition(At.matrixWorld),Dt.nearDistance=ft,Dt.farDistance=wt),Dt}function Ue(Ne,Ce,Ye,At,ft){if(Ne.visible===!1)return;if(Ne.layers.test(Ce.layers)&&(Ne.isMesh||Ne.isLine||Ne.isPoints)&&(Ne.castShadow||Ne.receiveShadow&&ft===l_)&&(!Ne.frustumCulled||h.intersectsObject(Ne))){Ne.modelViewMatrix.multiplyMatrices(Ye.matrixWorldInverse,Ne.matrixWorld);const Dt=e.update(Ne),Qe=Ne.material;if(Array.isArray(Qe)){const ht=Dt.groups;for(let _t=0,yt=ht.length;_t<yt;_t++){const Nt=ht[_t],ei=Qe[Nt.materialIndex];if(ei&&ei.visible){const mi=tt(Ne,Dt,ei,At,Ye.near,Ye.far,ft);i.renderBufferDirect(Ye,null,Dt,mi,Ne,Nt)}}}else if(Qe.visible){const ht=tt(Ne,Dt,Qe,At,Ye.near,Ye.far,ft);i.renderBufferDirect(Ye,null,Dt,ht,Ne,null)}}const Et=Ne.children;for(let Dt=0,Qe=Et.length;Dt<Qe;Dt++)Ue(Et[Dt],Ce,Ye,At,ft)}}function mee(i,e,o){const h=o.isWebGL2;function l(){let rt=!1;const oi=new Lr;let Si=null;const _i=new Lr(0,0,0,0);return{setMask:function(Kt){Si!==Kt&&!rt&&(i.colorMask(Kt,Kt,Kt,Kt),Si=Kt)},setLocked:function(Kt){rt=Kt},setClear:function(Kt,Wi,Xi,Vi,Ji){Ji===!0&&(Kt*=Vi,Wi*=Vi,Xi*=Vi),oi.set(Kt,Wi,Xi,Vi),_i.equals(oi)===!1&&(i.clearColor(Kt,Wi,Xi,Vi),_i.copy(oi))},reset:function(){rt=!1,Si=null,_i.set(-1,0,0,0)}}}function f(){let rt=!1,oi=null,Si=null,_i=null;return{setTest:function(Kt){Kt?Pi(2929):Ai(2929)},setMask:function(Kt){oi!==Kt&&!rt&&(i.depthMask(Kt),oi=Kt)},setFunc:function(Kt){if(Si!==Kt){if(Kt)switch(Kt){case B7:i.depthFunc(512);break;case N7:i.depthFunc(519);break;case U7:i.depthFunc(513);break;case lT:i.depthFunc(515);break;case $7:i.depthFunc(514);break;case V7:i.depthFunc(518);break;case j7:i.depthFunc(516);break;case G7:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);Si=Kt}},setLocked:function(Kt){rt=Kt},setClear:function(Kt){_i!==Kt&&(i.clearDepth(Kt),_i=Kt)},reset:function(){rt=!1,oi=null,Si=null,_i=null}}}function x(){let rt=!1,oi=null,Si=null,_i=null,Kt=null,Wi=null,Xi=null,Vi=null,Ji=null;return{setTest:function(ki){rt||(ki?Pi(2960):Ai(2960))},setMask:function(ki){oi!==ki&&!rt&&(i.stencilMask(ki),oi=ki)},setFunc:function(ki,mr,Er){(Si!==ki||_i!==mr||Kt!==Er)&&(i.stencilFunc(ki,mr,Er),Si=ki,_i=mr,Kt=Er)},setOp:function(ki,mr,Er){(Wi!==ki||Xi!==mr||Vi!==Er)&&(i.stencilOp(ki,mr,Er),Wi=ki,Xi=mr,Vi=Er)},setLocked:function(ki){rt=ki},setClear:function(ki){Ji!==ki&&(i.clearStencil(ki),Ji=ki)},reset:function(){rt=!1,oi=null,Si=null,_i=null,Kt=null,Wi=null,Xi=null,Vi=null,Ji=null}}}const s=new l,P=new f,C=new x;let O={},F=null,V=!1,q=null,ee=null,se=null,fe=null,ae=null,ie=null,tt=null,Ue=!1,Ne=null,Ce=null,Ye=null,At=null,ft=null;const wt=i.getParameter(35661);let Et=!1,Dt=0;const Qe=i.getParameter(7938);Qe.indexOf("WebGL")!==-1?(Dt=parseFloat(/^WebGL (\d)/.exec(Qe)[1]),Et=Dt>=1):Qe.indexOf("OpenGL ES")!==-1&&(Dt=parseFloat(/^OpenGL ES (\d)/.exec(Qe)[1]),Et=Dt>=2);let ht=null,_t={};const yt=new Lr,Nt=new Lr;function ei(rt,oi,Si){const _i=new Uint8Array(4),Kt=i.createTexture();i.bindTexture(rt,Kt),i.texParameteri(rt,10241,9728),i.texParameteri(rt,10240,9728);for(let Wi=0;Wi<Si;Wi++)i.texImage2D(oi+Wi,0,6408,1,1,0,6408,5121,_i);return Kt}const mi={};mi[3553]=ei(3553,3553,1),mi[34067]=ei(34067,34069,6),s.setClear(0,0,0,1),P.setClear(1),C.setClear(0),Pi(2929),P.setFunc(lT),pr(!1),zn(AC),Pi(2884),Un(u_);function Pi(rt){O[rt]!==!0&&(i.enable(rt),O[rt]=!0)}function Ai(rt){O[rt]!==!1&&(i.disable(rt),O[rt]=!1)}function dn(rt){return F!==rt?(i.useProgram(rt),F=rt,!0):!1}const wi={[op]:32774,[M7]:32778,[A7]:32779};if(h)wi[LC]=32775,wi[RC]=32776;else{const rt=e.get("EXT_blend_minmax");rt!==null&&(wi[LC]=rt.MIN_EXT,wi[RC]=rt.MAX_EXT)}const Rn={[P7]:0,[z7]:1,[C7]:768,[jB]:770,[F7]:776,[k7]:774,[R7]:772,[L7]:769,[GB]:771,[O7]:775,[D7]:773};function Un(rt,oi,Si,_i,Kt,Wi,Xi,Vi){if(rt===u_){V===!0&&(Ai(3042),V=!1);return}if(V===!1&&(Pi(3042),V=!0),rt!==I7){if(rt!==q||Vi!==Ue){if((ee!==op||ae!==op)&&(i.blendEquation(32774),ee=op,ae=op),Vi)switch(rt){case h_:i.blendFuncSeparate(1,771,1,771);break;case PC:i.blendFunc(1,1);break;case zC:i.blendFuncSeparate(0,0,769,771);break;case CC:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",rt);break}else switch(rt){case h_:i.blendFuncSeparate(770,771,1,771);break;case PC:i.blendFunc(770,1);break;case zC:i.blendFunc(0,769);break;case CC:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",rt);break}se=null,fe=null,ie=null,tt=null,q=rt,Ue=Vi}return}Kt=Kt||oi,Wi=Wi||Si,Xi=Xi||_i,(oi!==ee||Kt!==ae)&&(i.blendEquationSeparate(wi[oi],wi[Kt]),ee=oi,ae=Kt),(Si!==se||_i!==fe||Wi!==ie||Xi!==tt)&&(i.blendFuncSeparate(Rn[Si],Rn[_i],Rn[Wi],Rn[Xi]),se=Si,fe=_i,ie=Wi,tt=Xi),q=rt,Ue=null}function Zt(rt,oi){rt.side===tw?Ai(2884):Pi(2884);let Si=rt.side===Yo;oi&&(Si=!Si),pr(Si),rt.blending===h_&&rt.transparent===!1?Un(u_):Un(rt.blending,rt.blendEquation,rt.blendSrc,rt.blendDst,rt.blendEquationAlpha,rt.blendSrcAlpha,rt.blendDstAlpha,rt.premultipliedAlpha),P.setFunc(rt.depthFunc),P.setTest(rt.depthTest),P.setMask(rt.depthWrite),s.setMask(rt.colorWrite);const _i=rt.stencilWrite;C.setTest(_i),_i&&(C.setMask(rt.stencilWriteMask),C.setFunc(rt.stencilFunc,rt.stencilRef,rt.stencilFuncMask),C.setOp(rt.stencilFail,rt.stencilZFail,rt.stencilZPass)),Ii(rt.polygonOffset,rt.polygonOffsetFactor,rt.polygonOffsetUnits)}function pr(rt){Ne!==rt&&(rt?i.frontFace(2304):i.frontFace(2305),Ne=rt)}function zn(rt){rt!==S7?(Pi(2884),rt!==Ce&&(rt===AC?i.cullFace(1029):rt===T7?i.cullFace(1028):i.cullFace(1032))):Ai(2884),Ce=rt}function Di(rt){rt!==Ye&&(Et&&i.lineWidth(rt),Ye=rt)}function Ii(rt,oi,Si){rt?(Pi(32823),(At!==oi||ft!==Si)&&(i.polygonOffset(oi,Si),At=oi,ft=Si)):Ai(32823)}function hn(rt){rt?Pi(3089):Ai(3089)}function ti(rt){rt===void 0&&(rt=33984+wt-1),ht!==rt&&(i.activeTexture(rt),ht=rt)}function qt(rt,oi){ht===null&&ti();let Si=_t[ht];Si===void 0&&(Si={type:void 0,texture:void 0},_t[ht]=Si),(Si.type!==rt||Si.texture!==oi)&&(i.bindTexture(rt,oi||mi[rt]),Si.type=rt,Si.texture=oi)}function hi(){const rt=_t[ht];rt!==void 0&&rt.type!==void 0&&(i.bindTexture(rt.type,null),rt.type=void 0,rt.texture=void 0)}function ji(){try{i.compressedTexImage2D.apply(i,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function zi(){try{i.texImage2D.apply(i,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function Ve(){try{i.texImage3D.apply(i,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function Le(rt){yt.equals(rt)===!1&&(i.scissor(rt.x,rt.y,rt.z,rt.w),yt.copy(rt))}function Wt(rt){Nt.equals(rt)===!1&&(i.viewport(rt.x,rt.y,rt.z,rt.w),Nt.copy(rt))}function Jt(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),O={},ht=null,_t={},F=null,V=!1,q=null,ee=null,se=null,fe=null,ae=null,ie=null,tt=null,Ue=!1,Ne=null,Ce=null,Ye=null,At=null,ft=null,s.reset(),P.reset(),C.reset()}return{buffers:{color:s,depth:P,stencil:C},enable:Pi,disable:Ai,useProgram:dn,setBlending:Un,setMaterial:Zt,setFlipSided:pr,setCullFace:zn,setLineWidth:Di,setPolygonOffset:Ii,setScissorTest:hn,activeTexture:ti,bindTexture:qt,unbindTexture:hi,compressedTexImage2D:ji,texImage2D:zi,texImage3D:Ve,scissor:Le,viewport:Wt,reset:Jt}}function gee(i,e,o,h,l,f,x){const s=l.isWebGL2,P=l.maxTextures,C=l.maxCubemapSize,O=l.maxTextureSize,F=l.maxSamples,V=new WeakMap;let q,ee=!1;try{ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function se(Ve,Le){return ee?new OffscreenCanvas(Ve,Le):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function fe(Ve,Le,Wt,Jt){let rt=1;if((Ve.width>Jt||Ve.height>Jt)&&(rt=Jt/Math.max(Ve.width,Ve.height)),rt<1||Le===!0)if(typeof HTMLImageElement<"u"&&Ve instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ve instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ve instanceof ImageBitmap){const oi=Le?Bn.floorPowerOfTwo:Math.floor,Si=oi(rt*Ve.width),_i=oi(rt*Ve.height);q===void 0&&(q=se(Si,_i));const Kt=Wt?se(Si,_i):q;return Kt.width=Si,Kt.height=_i,Kt.getContext("2d").drawImage(Ve,0,0,Si,_i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ve.width+"x"+Ve.height+") to ("+Si+"x"+_i+")."),Kt}else return"data"in Ve&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ve.width+"x"+Ve.height+")."),Ve;return Ve}function ae(Ve){return Bn.isPowerOfTwo(Ve.width)&&Bn.isPowerOfTwo(Ve.height)}function ie(Ve){return s?!1:Ve.wrapS!==wa||Ve.wrapT!==wa||Ve.minFilter!==qs&&Ve.minFilter!==ds}function tt(Ve,Le){return Ve.generateMipmaps&&Le&&Ve.minFilter!==qs&&Ve.minFilter!==ds}function Ue(Ve,Le,Wt,Jt){i.generateMipmap(Ve);const rt=h.get(Le);rt.__maxMipLevel=Math.log2(Math.max(Wt,Jt))}function Ne(Ve,Le,Wt){if(s===!1)return Le;if(Ve!==null){if(i[Ve]!==void 0)return i[Ve];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ve+"'")}let Jt=Le;return Le===6403&&(Wt===5126&&(Jt=33326),Wt===5131&&(Jt=33325),Wt===5121&&(Jt=33321)),Le===6407&&(Wt===5126&&(Jt=34837),Wt===5131&&(Jt=34843),Wt===5121&&(Jt=32849)),Le===6408&&(Wt===5126&&(Jt=34836),Wt===5131&&(Jt=34842),Wt===5121&&(Jt=32856)),(Jt===33325||Jt===33326||Jt===34842||Jt===34836)&&e.get("EXT_color_buffer_float"),Jt}function Ce(Ve){return Ve===qs||Ve===OC||Ve===FC?9728:9729}function Ye(Ve){const Le=Ve.target;Le.removeEventListener("dispose",Ye),ft(Le),Le.isVideoTexture&&V.delete(Le),x.memory.textures--}function At(Ve){const Le=Ve.target;Le.removeEventListener("dispose",At),wt(Le),x.memory.textures--}function ft(Ve){const Le=h.get(Ve);Le.__webglInit!==void 0&&(i.deleteTexture(Le.__webglTexture),h.remove(Ve))}function wt(Ve){const Le=Ve.texture,Wt=h.get(Ve),Jt=h.get(Le);if(Ve){if(Jt.__webglTexture!==void 0&&i.deleteTexture(Jt.__webglTexture),Ve.depthTexture&&Ve.depthTexture.dispose(),Ve.isWebGLCubeRenderTarget)for(let rt=0;rt<6;rt++)i.deleteFramebuffer(Wt.__webglFramebuffer[rt]),Wt.__webglDepthbuffer&&i.deleteRenderbuffer(Wt.__webglDepthbuffer[rt]);else i.deleteFramebuffer(Wt.__webglFramebuffer),Wt.__webglDepthbuffer&&i.deleteRenderbuffer(Wt.__webglDepthbuffer),Wt.__webglMultisampledFramebuffer&&i.deleteFramebuffer(Wt.__webglMultisampledFramebuffer),Wt.__webglColorRenderbuffer&&i.deleteRenderbuffer(Wt.__webglColorRenderbuffer),Wt.__webglDepthRenderbuffer&&i.deleteRenderbuffer(Wt.__webglDepthRenderbuffer);h.remove(Le),h.remove(Ve)}}let Et=0;function Dt(){Et=0}function Qe(){const Ve=Et;return Ve>=P&&console.warn("THREE.WebGLTextures: Trying to use "+Ve+" texture units while this GPU supports only "+P),Et+=1,Ve}function ht(Ve,Le){const Wt=h.get(Ve);if(Ve.isVideoTexture&&ti(Ve),Ve.version>0&&Wt.__version!==Ve.version){const Jt=Ve.image;if(Jt===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Jt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{dn(Wt,Ve,Le);return}}o.activeTexture(33984+Le),o.bindTexture(3553,Wt.__webglTexture)}function _t(Ve,Le){const Wt=h.get(Ve);if(Ve.version>0&&Wt.__version!==Ve.version){dn(Wt,Ve,Le);return}o.activeTexture(33984+Le),o.bindTexture(35866,Wt.__webglTexture)}function yt(Ve,Le){const Wt=h.get(Ve);if(Ve.version>0&&Wt.__version!==Ve.version){dn(Wt,Ve,Le);return}o.activeTexture(33984+Le),o.bindTexture(32879,Wt.__webglTexture)}function Nt(Ve,Le){const Wt=h.get(Ve);if(Ve.version>0&&Wt.__version!==Ve.version){wi(Wt,Ve,Le);return}o.activeTexture(33984+Le),o.bindTexture(34067,Wt.__webglTexture)}const ei={[cT]:10497,[wa]:33071,[uT]:33648},mi={[qs]:9728,[OC]:9984,[FC]:9986,[ds]:9729,[K7]:9985,[nw]:9987};function Pi(Ve,Le,Wt){if(Wt?(i.texParameteri(Ve,10242,ei[Le.wrapS]),i.texParameteri(Ve,10243,ei[Le.wrapT]),(Ve===32879||Ve===35866)&&i.texParameteri(Ve,32882,ei[Le.wrapR]),i.texParameteri(Ve,10240,mi[Le.magFilter]),i.texParameteri(Ve,10241,mi[Le.minFilter])):(i.texParameteri(Ve,10242,33071),i.texParameteri(Ve,10243,33071),(Ve===32879||Ve===35866)&&i.texParameteri(Ve,32882,33071),(Le.wrapS!==wa||Le.wrapT!==wa)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(Ve,10240,Ce(Le.magFilter)),i.texParameteri(Ve,10241,Ce(Le.minFilter)),Le.minFilter!==qs&&Le.minFilter!==ds&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const Jt=e.get("EXT_texture_filter_anisotropic");if(Le.type===Bu&&e.has("OES_texture_float_linear")===!1||s===!1&&Le.type===j0&&e.has("OES_texture_half_float_linear")===!1)return;(Le.anisotropy>1||h.get(Le).__currentAnisotropy)&&(i.texParameterf(Ve,Jt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Le.anisotropy,l.getMaxAnisotropy())),h.get(Le).__currentAnisotropy=Le.anisotropy)}}function Ai(Ve,Le){Ve.__webglInit===void 0&&(Ve.__webglInit=!0,Le.addEventListener("dispose",Ye),Ve.__webglTexture=i.createTexture(),x.memory.textures++)}function dn(Ve,Le,Wt){let Jt=3553;Le.isDataTexture2DArray&&(Jt=35866),Le.isDataTexture3D&&(Jt=32879),Ai(Ve,Le),o.activeTexture(33984+Wt),o.bindTexture(Jt,Ve.__webglTexture),i.pixelStorei(37440,Le.flipY),i.pixelStorei(37441,Le.premultiplyAlpha),i.pixelStorei(3317,Le.unpackAlignment),i.pixelStorei(37443,0);const rt=ie(Le)&&ae(Le.image)===!1,oi=fe(Le.image,rt,!1,O),Si=ae(oi)||s,_i=f.convert(Le.format);let Kt=f.convert(Le.type),Wi=Ne(Le.internalFormat,_i,Kt);Pi(Jt,Le,Si);let Xi;const Vi=Le.mipmaps;if(Le.isDepthTexture)Wi=6402,s?Le.type===Bu?Wi=36012:Le.type===E0?Wi=33190:Le.type===f_?Wi=35056:Wi=33189:Le.type===Bu&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Le.format===fp&&Wi===6402&&Le.type!==V0&&Le.type!==E0&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Le.type=V0,Kt=f.convert(Le.type)),Le.format===P_&&Wi===6402&&(Wi=34041,Le.type!==f_&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Le.type=f_,Kt=f.convert(Le.type))),o.texImage2D(3553,0,Wi,oi.width,oi.height,0,_i,Kt,null);else if(Le.isDataTexture)if(Vi.length>0&&Si){for(let Ji=0,ki=Vi.length;Ji<ki;Ji++)Xi=Vi[Ji],o.texImage2D(3553,Ji,Wi,Xi.width,Xi.height,0,_i,Kt,Xi.data);Le.generateMipmaps=!1,Ve.__maxMipLevel=Vi.length-1}else o.texImage2D(3553,0,Wi,oi.width,oi.height,0,_i,Kt,oi.data),Ve.__maxMipLevel=0;else if(Le.isCompressedTexture){for(let Ji=0,ki=Vi.length;Ji<ki;Ji++)Xi=Vi[Ji],Le.format!==El&&Le.format!==rd?_i!==null?o.compressedTexImage2D(3553,Ji,Wi,Xi.width,Xi.height,0,Xi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):o.texImage2D(3553,Ji,Wi,Xi.width,Xi.height,0,_i,Kt,Xi.data);Ve.__maxMipLevel=Vi.length-1}else if(Le.isDataTexture2DArray)o.texImage3D(35866,0,Wi,oi.width,oi.height,oi.depth,0,_i,Kt,oi.data),Ve.__maxMipLevel=0;else if(Le.isDataTexture3D)o.texImage3D(32879,0,Wi,oi.width,oi.height,oi.depth,0,_i,Kt,oi.data),Ve.__maxMipLevel=0;else if(Vi.length>0&&Si){for(let Ji=0,ki=Vi.length;Ji<ki;Ji++)Xi=Vi[Ji],o.texImage2D(3553,Ji,Wi,_i,Kt,Xi);Le.generateMipmaps=!1,Ve.__maxMipLevel=Vi.length-1}else o.texImage2D(3553,0,Wi,_i,Kt,oi),Ve.__maxMipLevel=0;tt(Le,Si)&&Ue(Jt,Le,oi.width,oi.height),Ve.__version=Le.version,Le.onUpdate&&Le.onUpdate(Le)}function wi(Ve,Le,Wt){if(Le.image.length!==6)return;Ai(Ve,Le),o.activeTexture(33984+Wt),o.bindTexture(34067,Ve.__webglTexture),i.pixelStorei(37440,Le.flipY),i.pixelStorei(37441,Le.premultiplyAlpha),i.pixelStorei(3317,Le.unpackAlignment),i.pixelStorei(37443,0);const Jt=Le&&(Le.isCompressedTexture||Le.image[0].isCompressedTexture),rt=Le.image[0]&&Le.image[0].isDataTexture,oi=[];for(let Ji=0;Ji<6;Ji++)!Jt&&!rt?oi[Ji]=fe(Le.image[Ji],!1,!0,C):oi[Ji]=rt?Le.image[Ji].image:Le.image[Ji];const Si=oi[0],_i=ae(Si)||s,Kt=f.convert(Le.format),Wi=f.convert(Le.type),Xi=Ne(Le.internalFormat,Kt,Wi);Pi(34067,Le,_i);let Vi;if(Jt){for(let Ji=0;Ji<6;Ji++){Vi=oi[Ji].mipmaps;for(let ki=0;ki<Vi.length;ki++){const mr=Vi[ki];Le.format!==El&&Le.format!==rd?Kt!==null?o.compressedTexImage2D(34069+Ji,ki,Xi,mr.width,mr.height,0,mr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):o.texImage2D(34069+Ji,ki,Xi,mr.width,mr.height,0,Kt,Wi,mr.data)}}Ve.__maxMipLevel=Vi.length-1}else{Vi=Le.mipmaps;for(let Ji=0;Ji<6;Ji++)if(rt){o.texImage2D(34069+Ji,0,Xi,oi[Ji].width,oi[Ji].height,0,Kt,Wi,oi[Ji].data);for(let ki=0;ki<Vi.length;ki++){const Er=Vi[ki].image[Ji].image;o.texImage2D(34069+Ji,ki+1,Xi,Er.width,Er.height,0,Kt,Wi,Er.data)}}else{o.texImage2D(34069+Ji,0,Xi,Kt,Wi,oi[Ji]);for(let ki=0;ki<Vi.length;ki++){const mr=Vi[ki];o.texImage2D(34069+Ji,ki+1,Xi,Kt,Wi,mr.image[Ji])}}Ve.__maxMipLevel=Vi.length}tt(Le,_i)&&Ue(34067,Le,Si.width,Si.height),Ve.__version=Le.version,Le.onUpdate&&Le.onUpdate(Le)}function Rn(Ve,Le,Wt,Jt){const rt=Le.texture,oi=f.convert(rt.format),Si=f.convert(rt.type),_i=Ne(rt.internalFormat,oi,Si);Jt===32879||Jt===35866?o.texImage3D(Jt,0,_i,Le.width,Le.height,Le.depth,0,oi,Si,null):o.texImage2D(Jt,0,_i,Le.width,Le.height,0,oi,Si,null),i.bindFramebuffer(36160,Ve),i.framebufferTexture2D(36160,Wt,Jt,h.get(rt).__webglTexture,0),i.bindFramebuffer(36160,null)}function Un(Ve,Le,Wt){if(i.bindRenderbuffer(36161,Ve),Le.depthBuffer&&!Le.stencilBuffer){let Jt=33189;if(Wt){const rt=Le.depthTexture;rt&&rt.isDepthTexture&&(rt.type===Bu?Jt=36012:rt.type===E0&&(Jt=33190));const oi=hn(Le);i.renderbufferStorageMultisample(36161,oi,Jt,Le.width,Le.height)}else i.renderbufferStorage(36161,Jt,Le.width,Le.height);i.framebufferRenderbuffer(36160,36096,36161,Ve)}else if(Le.depthBuffer&&Le.stencilBuffer){if(Wt){const Jt=hn(Le);i.renderbufferStorageMultisample(36161,Jt,35056,Le.width,Le.height)}else i.renderbufferStorage(36161,34041,Le.width,Le.height);i.framebufferRenderbuffer(36160,33306,36161,Ve)}else{const Jt=Le.texture,rt=f.convert(Jt.format),oi=f.convert(Jt.type),Si=Ne(Jt.internalFormat,rt,oi);if(Wt){const _i=hn(Le);i.renderbufferStorageMultisample(36161,_i,Si,Le.width,Le.height)}else i.renderbufferStorage(36161,Si,Le.width,Le.height)}i.bindRenderbuffer(36161,null)}function Zt(Ve,Le){if(Le&&Le.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,Ve),!(Le.depthTexture&&Le.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!h.get(Le.depthTexture).__webglTexture||Le.depthTexture.image.width!==Le.width||Le.depthTexture.image.height!==Le.height)&&(Le.depthTexture.image.width=Le.width,Le.depthTexture.image.height=Le.height,Le.depthTexture.needsUpdate=!0),ht(Le.depthTexture,0);const Jt=h.get(Le.depthTexture).__webglTexture;if(Le.depthTexture.format===fp)i.framebufferTexture2D(36160,36096,3553,Jt,0);else if(Le.depthTexture.format===P_)i.framebufferTexture2D(36160,33306,3553,Jt,0);else throw new Error("Unknown depthTexture format")}function pr(Ve){const Le=h.get(Ve),Wt=Ve.isWebGLCubeRenderTarget===!0;if(Ve.depthTexture){if(Wt)throw new Error("target.depthTexture not supported in Cube render targets");Zt(Le.__webglFramebuffer,Ve)}else if(Wt){Le.__webglDepthbuffer=[];for(let Jt=0;Jt<6;Jt++)i.bindFramebuffer(36160,Le.__webglFramebuffer[Jt]),Le.__webglDepthbuffer[Jt]=i.createRenderbuffer(),Un(Le.__webglDepthbuffer[Jt],Ve,!1)}else i.bindFramebuffer(36160,Le.__webglFramebuffer),Le.__webglDepthbuffer=i.createRenderbuffer(),Un(Le.__webglDepthbuffer,Ve,!1);i.bindFramebuffer(36160,null)}function zn(Ve){const Le=Ve.texture,Wt=h.get(Ve),Jt=h.get(Le);Ve.addEventListener("dispose",At),Jt.__webglTexture=i.createTexture(),x.memory.textures++;const rt=Ve.isWebGLCubeRenderTarget===!0,oi=Ve.isWebGLMultisampleRenderTarget===!0,Si=Le.isDataTexture3D||Le.isDataTexture2DArray,_i=ae(Ve)||s;if(s&&Le.format===rd&&(Le.type===Bu||Le.type===j0)&&(Le.format=El,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),rt){Wt.__webglFramebuffer=[];for(let Kt=0;Kt<6;Kt++)Wt.__webglFramebuffer[Kt]=i.createFramebuffer()}else if(Wt.__webglFramebuffer=i.createFramebuffer(),oi)if(s){Wt.__webglMultisampledFramebuffer=i.createFramebuffer(),Wt.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,Wt.__webglColorRenderbuffer);const Kt=f.convert(Le.format),Wi=f.convert(Le.type),Xi=Ne(Le.internalFormat,Kt,Wi),Vi=hn(Ve);i.renderbufferStorageMultisample(36161,Vi,Xi,Ve.width,Ve.height),i.bindFramebuffer(36160,Wt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,Wt.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),Ve.depthBuffer&&(Wt.__webglDepthRenderbuffer=i.createRenderbuffer(),Un(Wt.__webglDepthRenderbuffer,Ve,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(rt){o.bindTexture(34067,Jt.__webglTexture),Pi(34067,Le,_i);for(let Kt=0;Kt<6;Kt++)Rn(Wt.__webglFramebuffer[Kt],Ve,36064,34069+Kt);tt(Le,_i)&&Ue(34067,Le,Ve.width,Ve.height),o.bindTexture(34067,null)}else{let Kt=3553;Si&&(s?Kt=Le.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),o.bindTexture(Kt,Jt.__webglTexture),Pi(Kt,Le,_i),Rn(Wt.__webglFramebuffer,Ve,36064,Kt),tt(Le,_i)&&Ue(3553,Le,Ve.width,Ve.height),o.bindTexture(3553,null)}Ve.depthBuffer&&pr(Ve)}function Di(Ve){const Le=Ve.texture,Wt=ae(Ve)||s;if(tt(Le,Wt)){const Jt=Ve.isWebGLCubeRenderTarget?34067:3553,rt=h.get(Le).__webglTexture;o.bindTexture(Jt,rt),Ue(Jt,Le,Ve.width,Ve.height),o.bindTexture(Jt,null)}}function Ii(Ve){if(Ve.isWebGLMultisampleRenderTarget)if(s){const Le=h.get(Ve);i.bindFramebuffer(36008,Le.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Le.__webglFramebuffer);const Wt=Ve.width,Jt=Ve.height;let rt=16384;Ve.depthBuffer&&(rt|=256),Ve.stencilBuffer&&(rt|=1024),i.blitFramebuffer(0,0,Wt,Jt,0,0,Wt,Jt,rt,9728),i.bindFramebuffer(36160,Le.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function hn(Ve){return s&&Ve.isWebGLMultisampleRenderTarget?Math.min(F,Ve.samples):0}function ti(Ve){const Le=x.render.frame;V.get(Ve)!==Le&&(V.set(Ve,Le),Ve.update())}let qt=!1,hi=!1;function ji(Ve,Le){Ve&&Ve.isWebGLRenderTarget&&(qt===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),qt=!0),Ve=Ve.texture),ht(Ve,Le)}function zi(Ve,Le){Ve&&Ve.isWebGLCubeRenderTarget&&(hi===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),hi=!0),Ve=Ve.texture),Nt(Ve,Le)}this.allocateTextureUnit=Qe,this.resetTextureUnits=Dt,this.setTexture2D=ht,this.setTexture2DArray=_t,this.setTexture3D=yt,this.setTextureCube=Nt,this.setupRenderTarget=zn,this.updateRenderTargetMipmap=Di,this.updateMultisampleRenderTarget=Ii,this.safeSetTexture2D=ji,this.safeSetTextureCube=zi}function _ee(i,e,o){const h=o.isWebGL2;function l(f){let x;if(f===c2)return 5121;if(f===iX)return 32819;if(f===nX)return 32820;if(f===rX)return 33635;if(f===Q7)return 5120;if(f===eX)return 5122;if(f===V0)return 5123;if(f===tX)return 5124;if(f===E0)return 5125;if(f===Bu)return 5126;if(f===j0)return h?5131:(x=e.get("OES_texture_half_float"),x!==null?x.HALF_FLOAT_OES:null);if(f===oX)return 6406;if(f===rd)return 6407;if(f===El)return 6408;if(f===sX)return 6409;if(f===aX)return 6410;if(f===fp)return 6402;if(f===P_)return 34041;if(f===lX)return 6403;if(f===cX)return 36244;if(f===uX)return 33319;if(f===hX)return 33320;if(f===dX)return 36248;if(f===fX)return 36249;if(f===BC||f===NC||f===UC||f===$C)if(x=e.get("WEBGL_compressed_texture_s3tc"),x!==null){if(f===BC)return x.COMPRESSED_RGB_S3TC_DXT1_EXT;if(f===NC)return x.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(f===UC)return x.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(f===$C)return x.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(f===VC||f===jC||f===GC||f===HC)if(x=e.get("WEBGL_compressed_texture_pvrtc"),x!==null){if(f===VC)return x.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(f===jC)return x.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(f===GC)return x.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(f===HC)return x.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(f===pX)return x=e.get("WEBGL_compressed_texture_etc1"),x!==null?x.COMPRESSED_RGB_ETC1_WEBGL:null;if((f===ZC||f===WC)&&(x=e.get("WEBGL_compressed_texture_etc"),x!==null)){if(f===ZC)return x.COMPRESSED_RGB8_ETC2;if(f===WC)return x.COMPRESSED_RGBA8_ETC2_EAC}if(f===mX||f===gX||f===_X||f===yX||f===vX||f===xX||f===bX||f===wX||f===SX||f===TX||f===EX||f===IX||f===MX||f===AX||f===zX||f===CX||f===LX||f===RX||f===DX||f===kX||f===OX||f===FX||f===BX||f===NX||f===UX||f===$X||f===VX||f===jX)return x=e.get("WEBGL_compressed_texture_astc"),x!==null?f:null;if(f===PX)return x=e.get("EXT_texture_compression_bptc"),x!==null?f:null;if(f===f_)return h?34042:(x=e.get("WEBGL_depth_texture"),x!==null?x.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:l}}function yT(i=[]){Ws.call(this),this.cameras=i}yT.prototype=Object.assign(Object.create(Ws.prototype),{constructor:yT,isArrayCamera:!0});class up extends Dn{constructor(){super(),this.type="Group"}}up.prototype.isGroup=!0;function p_(){this._targetRay=null,this._grip=null,this._hand=null}Object.assign(p_.prototype,{constructor:p_,getHandSpace:function(){return this._hand===null&&(this._hand=new up,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new up,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new up,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this},disconnect:function(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this},update:function(i,e,o){let h=null,l=null,f=null;const x=this._targetRay,s=this._grip,P=this._hand;if(i&&e.session.visibilityState!=="visible-blurred")if(P&&i.hand){f=!0;for(const ee of i.hand.values()){const se=e.getJointPose(ee,o);if(P.joints[ee.jointName]===void 0){const ae=new up;ae.matrixAutoUpdate=!1,ae.visible=!1,P.joints[ee.jointName]=ae,P.add(ae)}const fe=P.joints[ee.jointName];se!==null&&(fe.matrix.fromArray(se.transform.matrix),fe.matrix.decompose(fe.position,fe.rotation,fe.scale),fe.jointRadius=se.radius),fe.visible=se!==null}const C=P.joints["index-finger-tip"],O=P.joints["thumb-tip"],F=C.position.distanceTo(O.position),V=.02,q=.005;P.inputState.pinching&&F>V+q?(P.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!P.inputState.pinching&&F<=V-q&&(P.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else x!==null&&(h=e.getPose(i.targetRaySpace,o),h!==null&&(x.matrix.fromArray(h.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale))),s!==null&&i.gripSpace&&(l=e.getPose(i.gripSpace,o),l!==null&&(s.matrix.fromArray(l.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale)));return x!==null&&(x.visible=h!==null),s!==null&&(s.visible=l!==null),P!==null&&(P.visible=f!==null),this}});function h4(i,e){const o=this;let h=null,l=1,f=null,x="local-floor",s=null;const P=[],C=new Map,O=new Ws;O.layers.enable(1),O.viewport=new Lr;const F=new Ws;F.layers.enable(2),F.viewport=new Lr;const V=[O,F],q=new yT;q.layers.enable(1),q.layers.enable(2);let ee=null,se=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(wt){let Et=P[wt];return Et===void 0&&(Et=new p_,P[wt]=Et),Et.getTargetRaySpace()},this.getControllerGrip=function(wt){let Et=P[wt];return Et===void 0&&(Et=new p_,P[wt]=Et),Et.getGripSpace()},this.getHand=function(wt){let Et=P[wt];return Et===void 0&&(Et=new p_,P[wt]=Et),Et.getHandSpace()};function fe(wt){const Et=C.get(wt.inputSource);Et&&Et.dispatchEvent({type:wt.type,data:wt.inputSource})}function ae(){C.forEach(function(wt,Et){wt.disconnect(Et)}),C.clear(),ee=null,se=null,i.setFramebuffer(null),i.setRenderTarget(i.getRenderTarget()),ft.stop(),o.isPresenting=!1,o.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(wt){l=wt,o.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(wt){x=wt,o.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return f},this.getSession=function(){return h},this.setSession=async function(wt){if(h=wt,h!==null){h.addEventListener("select",fe),h.addEventListener("selectstart",fe),h.addEventListener("selectend",fe),h.addEventListener("squeeze",fe),h.addEventListener("squeezestart",fe),h.addEventListener("squeezeend",fe),h.addEventListener("end",ae),h.addEventListener("inputsourceschange",ie);const Et=e.getContextAttributes();Et.xrCompatible!==!0&&await e.makeXRCompatible();const Dt={antialias:Et.antialias,alpha:Et.alpha,depth:Et.depth,stencil:Et.stencil,framebufferScaleFactor:l},Qe=new XRWebGLLayer(h,e,Dt);h.updateRenderState({baseLayer:Qe}),f=await h.requestReferenceSpace(x),ft.setContext(h),ft.start(),o.isPresenting=!0,o.dispatchEvent({type:"sessionstart"})}};function ie(wt){const Et=h.inputSources;for(let Dt=0;Dt<P.length;Dt++)C.set(Et[Dt],P[Dt]);for(let Dt=0;Dt<wt.removed.length;Dt++){const Qe=wt.removed[Dt],ht=C.get(Qe);ht&&(ht.dispatchEvent({type:"disconnected",data:Qe}),C.delete(Qe))}for(let Dt=0;Dt<wt.added.length;Dt++){const Qe=wt.added[Dt],ht=C.get(Qe);ht&&ht.dispatchEvent({type:"connected",data:Qe})}}const tt=new He,Ue=new He;function Ne(wt,Et,Dt){tt.setFromMatrixPosition(Et.matrixWorld),Ue.setFromMatrixPosition(Dt.matrixWorld);const Qe=tt.distanceTo(Ue),ht=Et.projectionMatrix.elements,_t=Dt.projectionMatrix.elements,yt=ht[14]/(ht[10]-1),Nt=ht[14]/(ht[10]+1),ei=(ht[9]+1)/ht[5],mi=(ht[9]-1)/ht[5],Pi=(ht[8]-1)/ht[0],Ai=(_t[8]+1)/_t[0],dn=yt*Pi,wi=yt*Ai,Rn=Qe/(-Pi+Ai),Un=Rn*-Pi;Et.matrixWorld.decompose(wt.position,wt.quaternion,wt.scale),wt.translateX(Un),wt.translateZ(Rn),wt.matrixWorld.compose(wt.position,wt.quaternion,wt.scale),wt.matrixWorldInverse.copy(wt.matrixWorld).invert();const Zt=yt+Rn,pr=Nt+Rn,zn=dn-Un,Di=wi+(Qe-Un),Ii=ei*Nt/pr*Zt,hn=mi*Nt/pr*Zt;wt.projectionMatrix.makePerspective(zn,Di,Ii,hn,Zt,pr)}function Ce(wt,Et){Et===null?wt.matrixWorld.copy(wt.matrix):wt.matrixWorld.multiplyMatrices(Et.matrixWorld,wt.matrix),wt.matrixWorldInverse.copy(wt.matrixWorld).invert()}this.getCamera=function(wt){q.near=F.near=O.near=wt.near,q.far=F.far=O.far=wt.far,(ee!==q.near||se!==q.far)&&(h.updateRenderState({depthNear:q.near,depthFar:q.far}),ee=q.near,se=q.far);const Et=wt.parent,Dt=q.cameras;Ce(q,Et);for(let ht=0;ht<Dt.length;ht++)Ce(Dt[ht],Et);wt.matrixWorld.copy(q.matrixWorld),wt.matrix.copy(q.matrix),wt.matrix.decompose(wt.position,wt.quaternion,wt.scale);const Qe=wt.children;for(let ht=0,_t=Qe.length;ht<_t;ht++)Qe[ht].updateMatrixWorld(!0);return Dt.length===2?Ne(q,O,F):q.projectionMatrix.copy(O.projectionMatrix),q};let Ye=null;function At(wt,Et){if(s=Et.getViewerPose(f),s!==null){const Qe=s.views,ht=h.renderState.baseLayer;i.setFramebuffer(ht.framebuffer);let _t=!1;Qe.length!==q.cameras.length&&(q.cameras.length=0,_t=!0);for(let yt=0;yt<Qe.length;yt++){const Nt=Qe[yt],ei=ht.getViewport(Nt),mi=V[yt];mi.matrix.fromArray(Nt.transform.matrix),mi.projectionMatrix.fromArray(Nt.projectionMatrix),mi.viewport.set(ei.x,ei.y,ei.width,ei.height),yt===0&&q.matrix.copy(mi.matrix),_t===!0&&q.cameras.push(mi)}}const Dt=h.inputSources;for(let Qe=0;Qe<P.length;Qe++){const ht=P[Qe],_t=Dt[Qe];ht.update(_t,Et,f)}Ye&&Ye(wt,Et)}const ft=new KB;ft.setAnimationLoop(At),this.setAnimationLoop=function(wt){Ye=wt},this.dispose=function(){}}Object.assign(h4.prototype,Yu.prototype);function yee(i){function e(ae,ie){ae.fogColor.value.copy(ie.color),ie.isFog?(ae.fogNear.value=ie.near,ae.fogFar.value=ie.far):ie.isFogExp2&&(ae.fogDensity.value=ie.density)}function o(ae,ie,tt,Ue){ie.isMeshBasicMaterial?h(ae,ie):ie.isMeshLambertMaterial?(h(ae,ie),P(ae,ie)):ie.isMeshToonMaterial?(h(ae,ie),O(ae,ie)):ie.isMeshPhongMaterial?(h(ae,ie),C(ae,ie)):ie.isMeshStandardMaterial?(h(ae,ie),ie.isMeshPhysicalMaterial?V(ae,ie):F(ae,ie)):ie.isMeshMatcapMaterial?(h(ae,ie),q(ae,ie)):ie.isMeshDepthMaterial?(h(ae,ie),ee(ae,ie)):ie.isMeshDistanceMaterial?(h(ae,ie),se(ae,ie)):ie.isMeshNormalMaterial?(h(ae,ie),fe(ae,ie)):ie.isLineBasicMaterial?(l(ae,ie),ie.isLineDashedMaterial&&f(ae,ie)):ie.isPointsMaterial?x(ae,ie,tt,Ue):ie.isSpriteMaterial?s(ae,ie):ie.isShadowMaterial?(ae.color.value.copy(ie.color),ae.opacity.value=ie.opacity):ie.isShaderMaterial&&(ie.uniformsNeedUpdate=!1)}function h(ae,ie){ae.opacity.value=ie.opacity,ie.color&&ae.diffuse.value.copy(ie.color),ie.emissive&&ae.emissive.value.copy(ie.emissive).multiplyScalar(ie.emissiveIntensity),ie.map&&(ae.map.value=ie.map),ie.alphaMap&&(ae.alphaMap.value=ie.alphaMap),ie.specularMap&&(ae.specularMap.value=ie.specularMap);const tt=i.get(ie).envMap;if(tt){ae.envMap.value=tt,ae.flipEnvMap.value=tt.isCubeTexture&&tt._needsFlipEnvMap?-1:1,ae.reflectivity.value=ie.reflectivity,ae.refractionRatio.value=ie.refractionRatio;const Ce=i.get(tt).__maxMipLevel;Ce!==void 0&&(ae.maxMipLevel.value=Ce)}ie.lightMap&&(ae.lightMap.value=ie.lightMap,ae.lightMapIntensity.value=ie.lightMapIntensity),ie.aoMap&&(ae.aoMap.value=ie.aoMap,ae.aoMapIntensity.value=ie.aoMapIntensity);let Ue;ie.map?Ue=ie.map:ie.specularMap?Ue=ie.specularMap:ie.displacementMap?Ue=ie.displacementMap:ie.normalMap?Ue=ie.normalMap:ie.bumpMap?Ue=ie.bumpMap:ie.roughnessMap?Ue=ie.roughnessMap:ie.metalnessMap?Ue=ie.metalnessMap:ie.alphaMap?Ue=ie.alphaMap:ie.emissiveMap?Ue=ie.emissiveMap:ie.clearcoatMap?Ue=ie.clearcoatMap:ie.clearcoatNormalMap?Ue=ie.clearcoatNormalMap:ie.clearcoatRoughnessMap&&(Ue=ie.clearcoatRoughnessMap),Ue!==void 0&&(Ue.isWebGLRenderTarget&&(Ue=Ue.texture),Ue.matrixAutoUpdate===!0&&Ue.updateMatrix(),ae.uvTransform.value.copy(Ue.matrix));let Ne;ie.aoMap?Ne=ie.aoMap:ie.lightMap&&(Ne=ie.lightMap),Ne!==void 0&&(Ne.isWebGLRenderTarget&&(Ne=Ne.texture),Ne.matrixAutoUpdate===!0&&Ne.updateMatrix(),ae.uv2Transform.value.copy(Ne.matrix))}function l(ae,ie){ae.diffuse.value.copy(ie.color),ae.opacity.value=ie.opacity}function f(ae,ie){ae.dashSize.value=ie.dashSize,ae.totalSize.value=ie.dashSize+ie.gapSize,ae.scale.value=ie.scale}function x(ae,ie,tt,Ue){ae.diffuse.value.copy(ie.color),ae.opacity.value=ie.opacity,ae.size.value=ie.size*tt,ae.scale.value=Ue*.5,ie.map&&(ae.map.value=ie.map),ie.alphaMap&&(ae.alphaMap.value=ie.alphaMap);let Ne;ie.map?Ne=ie.map:ie.alphaMap&&(Ne=ie.alphaMap),Ne!==void 0&&(Ne.matrixAutoUpdate===!0&&Ne.updateMatrix(),ae.uvTransform.value.copy(Ne.matrix))}function s(ae,ie){ae.diffuse.value.copy(ie.color),ae.opacity.value=ie.opacity,ae.rotation.value=ie.rotation,ie.map&&(ae.map.value=ie.map),ie.alphaMap&&(ae.alphaMap.value=ie.alphaMap);let tt;ie.map?tt=ie.map:ie.alphaMap&&(tt=ie.alphaMap),tt!==void 0&&(tt.matrixAutoUpdate===!0&&tt.updateMatrix(),ae.uvTransform.value.copy(tt.matrix))}function P(ae,ie){ie.emissiveMap&&(ae.emissiveMap.value=ie.emissiveMap)}function C(ae,ie){ae.specular.value.copy(ie.specular),ae.shininess.value=Math.max(ie.shininess,1e-4),ie.emissiveMap&&(ae.emissiveMap.value=ie.emissiveMap),ie.bumpMap&&(ae.bumpMap.value=ie.bumpMap,ae.bumpScale.value=ie.bumpScale,ie.side===Yo&&(ae.bumpScale.value*=-1)),ie.normalMap&&(ae.normalMap.value=ie.normalMap,ae.normalScale.value.copy(ie.normalScale),ie.side===Yo&&ae.normalScale.value.negate()),ie.displacementMap&&(ae.displacementMap.value=ie.displacementMap,ae.displacementScale.value=ie.displacementScale,ae.displacementBias.value=ie.displacementBias)}function O(ae,ie){ie.gradientMap&&(ae.gradientMap.value=ie.gradientMap),ie.emissiveMap&&(ae.emissiveMap.value=ie.emissiveMap),ie.bumpMap&&(ae.bumpMap.value=ie.bumpMap,ae.bumpScale.value=ie.bumpScale,ie.side===Yo&&(ae.bumpScale.value*=-1)),ie.normalMap&&(ae.normalMap.value=ie.normalMap,ae.normalScale.value.copy(ie.normalScale),ie.side===Yo&&ae.normalScale.value.negate()),ie.displacementMap&&(ae.displacementMap.value=ie.displacementMap,ae.displacementScale.value=ie.displacementScale,ae.displacementBias.value=ie.displacementBias)}function F(ae,ie){ae.roughness.value=ie.roughness,ae.metalness.value=ie.metalness,ie.roughnessMap&&(ae.roughnessMap.value=ie.roughnessMap),ie.metalnessMap&&(ae.metalnessMap.value=ie.metalnessMap),ie.emissiveMap&&(ae.emissiveMap.value=ie.emissiveMap),ie.bumpMap&&(ae.bumpMap.value=ie.bumpMap,ae.bumpScale.value=ie.bumpScale,ie.side===Yo&&(ae.bumpScale.value*=-1)),ie.normalMap&&(ae.normalMap.value=ie.normalMap,ae.normalScale.value.copy(ie.normalScale),ie.side===Yo&&ae.normalScale.value.negate()),ie.displacementMap&&(ae.displacementMap.value=ie.displacementMap,ae.displacementScale.value=ie.displacementScale,ae.displacementBias.value=ie.displacementBias),i.get(ie).envMap&&(ae.envMapIntensity.value=ie.envMapIntensity)}function V(ae,ie){F(ae,ie),ae.reflectivity.value=ie.reflectivity,ae.clearcoat.value=ie.clearcoat,ae.clearcoatRoughness.value=ie.clearcoatRoughness,ie.sheen&&ae.sheen.value.copy(ie.sheen),ie.clearcoatMap&&(ae.clearcoatMap.value=ie.clearcoatMap),ie.clearcoatRoughnessMap&&(ae.clearcoatRoughnessMap.value=ie.clearcoatRoughnessMap),ie.clearcoatNormalMap&&(ae.clearcoatNormalScale.value.copy(ie.clearcoatNormalScale),ae.clearcoatNormalMap.value=ie.clearcoatNormalMap,ie.side===Yo&&ae.clearcoatNormalScale.value.negate()),ae.transmission.value=ie.transmission,ie.transmissionMap&&(ae.transmissionMap.value=ie.transmissionMap)}function q(ae,ie){ie.matcap&&(ae.matcap.value=ie.matcap),ie.bumpMap&&(ae.bumpMap.value=ie.bumpMap,ae.bumpScale.value=ie.bumpScale,ie.side===Yo&&(ae.bumpScale.value*=-1)),ie.normalMap&&(ae.normalMap.value=ie.normalMap,ae.normalScale.value.copy(ie.normalScale),ie.side===Yo&&ae.normalScale.value.negate()),ie.displacementMap&&(ae.displacementMap.value=ie.displacementMap,ae.displacementScale.value=ie.displacementScale,ae.displacementBias.value=ie.displacementBias)}function ee(ae,ie){ie.displacementMap&&(ae.displacementMap.value=ie.displacementMap,ae.displacementScale.value=ie.displacementScale,ae.displacementBias.value=ie.displacementBias)}function se(ae,ie){ie.displacementMap&&(ae.displacementMap.value=ie.displacementMap,ae.displacementScale.value=ie.displacementScale,ae.displacementBias.value=ie.displacementBias),ae.referencePosition.value.copy(ie.referencePosition),ae.nearDistance.value=ie.nearDistance,ae.farDistance.value=ie.farDistance}function fe(ae,ie){ie.bumpMap&&(ae.bumpMap.value=ie.bumpMap,ae.bumpScale.value=ie.bumpScale,ie.side===Yo&&(ae.bumpScale.value*=-1)),ie.normalMap&&(ae.normalMap.value=ie.normalMap,ae.normalScale.value.copy(ie.normalScale),ie.side===Yo&&ae.normalScale.value.negate()),ie.displacementMap&&(ae.displacementMap.value=ie.displacementMap,ae.displacementScale.value=ie.displacementScale,ae.displacementBias.value=ie.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:o}}function vee(){const i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.style.display="block",i}function kr(i){i=i||{};const e=i.canvas!==void 0?i.canvas:vee(),o=i.context!==void 0?i.context:null,h=i.alpha!==void 0?i.alpha:!1,l=i.depth!==void 0?i.depth:!0,f=i.stencil!==void 0?i.stencil:!0,x=i.antialias!==void 0?i.antialias:!1,s=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,P=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,C=i.powerPreference!==void 0?i.powerPreference:"default",O=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let F=null,V=null;const q=[],ee=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=my,this.physicallyCorrectLights=!1,this.toneMapping=d_,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const se=this;let fe=!1,ae=null,ie=0,tt=0,Ue=null,Ne=null,Ce=-1,Ye=null;const At=new Lr,ft=new Lr;let wt=null,Et=e.width,Dt=e.height,Qe=1,ht=null,_t=null;const yt=new Lr(0,0,Et,Dt),Nt=new Lr(0,0,Et,Dt);let ei=!1;const mi=new sw;let Pi=!1,Ai=!1;const dn=new nn,wi=new He,Rn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Un(){return Ue===null?Qe:1}let Zt=o;function pr(De,Lt){for(let Ae=0;Ae<De.length;Ae++){const Ot=De[Ae],yi=e.getContext(Ot,Lt);if(yi!==null)return yi}return null}try{const De={alpha:h,depth:l,stencil:f,antialias:x,premultipliedAlpha:s,preserveDrawingBuffer:P,powerPreference:C,failIfMajorPerformanceCaveat:O};if(e.addEventListener("webglcontextlost",Er,!1),e.addEventListener("webglcontextrestored",Il,!1),Zt===null){const Lt=["webgl2","webgl","experimental-webgl"];if(se.isWebGL1Renderer===!0&&Lt.shift(),Zt=pr(Lt,De),Zt===null)throw pr(Lt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Zt.getShaderPrecisionFormat===void 0&&(Zt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(De){throw console.error("THREE.WebGLRenderer: "+De.message),De}let zn,Di,Ii,hn,ti,qt,hi,ji,zi,Ve,Le,Wt,Jt,rt,oi,Si,_i,Kt,Wi,Xi,Vi;function Ji(){zn=new JK(Zt),Di=new WK(Zt,zn,i),zn.init(Di),Xi=new _ee(Zt,zn,Di),Ii=new mee(Zt,zn,Di),Ii.scissor(ft.copy(Nt).multiplyScalar(Qe).floor()),Ii.viewport(At.copy(yt).multiplyScalar(Qe).floor()),hn=new QK,ti=new nee,qt=new gee(Zt,zn,Ii,ti,Di,Xi,hn),hi=new XK(se),ji=new bJ(Zt,Di),Vi=new HK(Zt,zn,ji,Di),zi=new YK(Zt,ji,hn,Vi),Ve=new nQ(Zt,zi,ji,hn),_i=new iQ(Zt),oi=new qK(ti),Le=new iee(se,hi,zn,Di,Vi,oi),Wt=new yee(ti),Jt=new see(ti),rt=new dee(zn,Di),Si=new GK(se,hi,Ii,Ve,s),Kt=new ZK(Zt,zn,hn,Di),Wi=new KK(Zt,zn,hn,Di),hn.programs=Le.programs,se.capabilities=Di,se.extensions=zn,se.properties=ti,se.renderLists=Jt,se.state=Ii,se.info=hn}Ji();const ki=new h4(se,Zt);this.xr=ki;const mr=new u4(se,Ve,Di.maxTextureSize);this.shadowMap=mr,this.getContext=function(){return Zt},this.getContextAttributes=function(){return Zt.getContextAttributes()},this.forceContextLoss=function(){const De=zn.get("WEBGL_lose_context");De&&De.loseContext()},this.forceContextRestore=function(){const De=zn.get("WEBGL_lose_context");De&&De.restoreContext()},this.getPixelRatio=function(){return Qe},this.setPixelRatio=function(De){De!==void 0&&(Qe=De,this.setSize(Et,Dt,!1))},this.getSize=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),De=new gi),De.set(Et,Dt)},this.setSize=function(De,Lt,Ae){if(ki.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Et=De,Dt=Lt,e.width=Math.floor(De*Qe),e.height=Math.floor(Lt*Qe),Ae!==!1&&(e.style.width=De+"px",e.style.height=Lt+"px"),this.setViewport(0,0,De,Lt)},this.getDrawingBufferSize=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),De=new gi),De.set(Et*Qe,Dt*Qe).floor()},this.setDrawingBufferSize=function(De,Lt,Ae){Et=De,Dt=Lt,Qe=Ae,e.width=Math.floor(De*Ae),e.height=Math.floor(Lt*Ae),this.setViewport(0,0,De,Lt)},this.getCurrentViewport=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),De=new Lr),De.copy(At)},this.getViewport=function(De){return De.copy(yt)},this.setViewport=function(De,Lt,Ae,Ot){De.isVector4?yt.set(De.x,De.y,De.z,De.w):yt.set(De,Lt,Ae,Ot),Ii.viewport(At.copy(yt).multiplyScalar(Qe).floor())},this.getScissor=function(De){return De.copy(Nt)},this.setScissor=function(De,Lt,Ae,Ot){De.isVector4?Nt.set(De.x,De.y,De.z,De.w):Nt.set(De,Lt,Ae,Ot),Ii.scissor(ft.copy(Nt).multiplyScalar(Qe).floor())},this.getScissorTest=function(){return ei},this.setScissorTest=function(De){Ii.setScissorTest(ei=De)},this.setOpaqueSort=function(De){ht=De},this.setTransparentSort=function(De){_t=De},this.getClearColor=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),De=new mn),De.copy(Si.getClearColor())},this.setClearColor=function(){Si.setClearColor.apply(Si,arguments)},this.getClearAlpha=function(){return Si.getClearAlpha()},this.setClearAlpha=function(){Si.setClearAlpha.apply(Si,arguments)},this.clear=function(De,Lt,Ae){let Ot=0;(De===void 0||De)&&(Ot|=16384),(Lt===void 0||Lt)&&(Ot|=256),(Ae===void 0||Ae)&&(Ot|=1024),Zt.clear(Ot)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Er,!1),e.removeEventListener("webglcontextrestored",Il,!1),Jt.dispose(),rt.dispose(),ti.dispose(),hi.dispose(),Ve.dispose(),Vi.dispose(),ki.dispose(),_s.stop()};function Er(De){De.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),fe=!0}function Il(){console.log("THREE.WebGLRenderer: Context Restored."),fe=!1,Ji()}function Ys(De){const Lt=De.target;Lt.removeEventListener("dispose",Ys),mo(Lt)}function mo(De){Ks(De),ti.remove(De)}function Ks(De){const Lt=ti.get(De).program;Lt!==void 0&&Le.releaseProgram(Lt)}function ua(De,Lt){De.render(function(Ae){se.renderBufferImmediate(Ae,Lt)})}this.renderBufferImmediate=function(De,Lt){Vi.initAttributes();const Ae=ti.get(De);De.hasPositions&&!Ae.position&&(Ae.position=Zt.createBuffer()),De.hasNormals&&!Ae.normal&&(Ae.normal=Zt.createBuffer()),De.hasUvs&&!Ae.uv&&(Ae.uv=Zt.createBuffer()),De.hasColors&&!Ae.color&&(Ae.color=Zt.createBuffer());const Ot=Lt.getAttributes();De.hasPositions&&(Zt.bindBuffer(34962,Ae.position),Zt.bufferData(34962,De.positionArray,35048),Vi.enableAttribute(Ot.position),Zt.vertexAttribPointer(Ot.position,3,5126,!1,0,0)),De.hasNormals&&(Zt.bindBuffer(34962,Ae.normal),Zt.bufferData(34962,De.normalArray,35048),Vi.enableAttribute(Ot.normal),Zt.vertexAttribPointer(Ot.normal,3,5126,!1,0,0)),De.hasUvs&&(Zt.bindBuffer(34962,Ae.uv),Zt.bufferData(34962,De.uvArray,35048),Vi.enableAttribute(Ot.uv),Zt.vertexAttribPointer(Ot.uv,2,5126,!1,0,0)),De.hasColors&&(Zt.bindBuffer(34962,Ae.color),Zt.bufferData(34962,De.colorArray,35048),Vi.enableAttribute(Ot.color),Zt.vertexAttribPointer(Ot.color,3,5126,!1,0,0)),Vi.disableUnusedAttributes(),Zt.drawArrays(4,0,De.count),De.count=0},this.renderBufferDirect=function(De,Lt,Ae,Ot,yi,Cn){Lt===null&&(Lt=Rn);const ii=yi.isMesh&&yi.matrixWorld.determinant()<0,Ee=lc(De,Lt,Ot,yi);Ii.setMaterial(Ot,ii);let Z=Ae.index;const Q=Ae.attributes.position;if(Z===null){if(Q===void 0||Q.count===0)return}else if(Z.count===0)return;let ce=1;Ot.wireframe===!0&&(Z=zi.getWireframeAttribute(Ae),ce=2),(Ot.morphTargets||Ot.morphNormals)&&_i.update(yi,Ae,Ot,Ee),Vi.setup(yi,Ot,Ee,Ae,Z);let xe,de=Kt;Z!==null&&(xe=ji.get(Z),de=Wi,de.setIndex(xe));const Me=Z!==null?Z.count:Q.count,Oe=Ae.drawRange.start*ce,Pe=Ae.drawRange.count*ce,Be=Cn!==null?Cn.start*ce:0,gt=Cn!==null?Cn.count*ce:1/0,st=Math.max(Oe,Be),Ft=Math.min(Me,Oe+Pe,Be+gt)-1,ri=Math.max(0,Ft-st+1);if(ri!==0){if(yi.isMesh)Ot.wireframe===!0?(Ii.setLineWidth(Ot.wireframeLinewidth*Un()),de.setMode(1)):de.setMode(4);else if(yi.isLine){let ci=Ot.linewidth;ci===void 0&&(ci=1),Ii.setLineWidth(ci*Un()),yi.isLineSegments?de.setMode(1):yi.isLineLoop?de.setMode(2):de.setMode(3)}else yi.isPoints?de.setMode(0):yi.isSprite&&de.setMode(4);if(yi.isInstancedMesh)de.renderInstances(st,ri,yi.count);else if(Ae.isInstancedBufferGeometry){const ci=Math.min(Ae.instanceCount,Ae._maxInstanceCount);de.renderInstances(st,ri,ci)}else de.render(st,ri)}},this.compile=function(De,Lt){V=rt.get(De),V.init(),De.traverseVisible(function(Ot){Ot.isLight&&Ot.layers.test(Lt.layers)&&(V.pushLight(Ot),Ot.castShadow&&V.pushShadow(Ot))}),V.setupLights();const Ae=new WeakMap;De.traverse(function(Ot){const yi=Ot.material;if(yi)if(Array.isArray(yi))for(let Cn=0;Cn<yi.length;Cn++){const ii=yi[Cn];Ae.has(ii)===!1&&(yr(ii,De,Ot),Ae.set(ii))}else Ae.has(yi)===!1&&(yr(yi,De,Ot),Ae.set(yi))})};let Qs=null;function ha(De){ki.isPresenting||Qs&&Qs(De)}const _s=new KB;_s.setAnimationLoop(ha),typeof window<"u"&&_s.setContext(window),this.setAnimationLoop=function(De){Qs=De,ki.setAnimationLoop(De),De===null?_s.stop():_s.start()},this.render=function(De,Lt){let Ae,Ot;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Ae=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),Ot=arguments[3]),Lt!==void 0&&Lt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(fe===!0)return;Vi.resetDefaultState(),Ce=-1,Ye=null,De.autoUpdate===!0&&De.updateMatrixWorld(),Lt.parent===null&&Lt.updateMatrixWorld(),ki.enabled===!0&&ki.isPresenting===!0&&(Lt=ki.getCamera(Lt)),De.isScene===!0&&De.onBeforeRender(se,De,Lt,Ae||Ue),V=rt.get(De,ee.length),V.init(),ee.push(V),dn.multiplyMatrices(Lt.projectionMatrix,Lt.matrixWorldInverse),mi.setFromProjectionMatrix(dn),Ai=this.localClippingEnabled,Pi=oi.init(this.clippingPlanes,Ai,Lt),F=Jt.get(De,q.length),F.init(),q.push(F),da(De,Lt,0,se.sortObjects),F.finish(),se.sortObjects===!0&&F.sort(ht,_t),Pi===!0&&oi.beginShadows();const yi=V.state.shadowsArray;mr.render(yi,De,Lt),V.setupLights(),V.setupLightsView(Lt),Pi===!0&&oi.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ae!==void 0&&this.setRenderTarget(Ae),Si.render(F,De,Lt,Ot);const Cn=F.opaque,ii=F.transparent;Cn.length>0&&il(Cn,De,Lt),ii.length>0&&il(ii,De,Lt),De.isScene===!0&&De.onAfterRender(se,De,Lt),Ue!==null&&(qt.updateRenderTargetMipmap(Ue),qt.updateMultisampleRenderTarget(Ue)),Ii.buffers.depth.setTest(!0),Ii.buffers.depth.setMask(!0),Ii.buffers.color.setMask(!0),Ii.setPolygonOffset(!1),ee.pop(),ee.length>0?V=ee[ee.length-1]:V=null,q.pop(),q.length>0?F=q[q.length-1]:F=null};function da(De,Lt,Ae,Ot){if(De.visible===!1)return;if(De.layers.test(Lt.layers)){if(De.isGroup)Ae=De.renderOrder;else if(De.isLOD)De.autoUpdate===!0&&De.update(Lt);else if(De.isLight)V.pushLight(De),De.castShadow&&V.pushShadow(De);else if(De.isSprite){if(!De.frustumCulled||mi.intersectsSprite(De)){Ot&&wi.setFromMatrixPosition(De.matrixWorld).applyMatrix4(dn);const ii=Ve.update(De),Ee=De.material;Ee.visible&&F.push(De,ii,Ee,Ae,wi.z,null)}}else if(De.isImmediateRenderObject)Ot&&wi.setFromMatrixPosition(De.matrixWorld).applyMatrix4(dn),F.push(De,null,De.material,Ae,wi.z,null);else if((De.isMesh||De.isLine||De.isPoints)&&(De.isSkinnedMesh&&De.skeleton.frame!==hn.render.frame&&(De.skeleton.update(),De.skeleton.frame=hn.render.frame),!De.frustumCulled||mi.intersectsObject(De))){Ot&&wi.setFromMatrixPosition(De.matrixWorld).applyMatrix4(dn);const ii=Ve.update(De),Ee=De.material;if(Array.isArray(Ee)){const Z=ii.groups;for(let Q=0,ce=Z.length;Q<ce;Q++){const xe=Z[Q],de=Ee[xe.materialIndex];de&&de.visible&&F.push(De,ii,de,Ae,wi.z,xe)}}else Ee.visible&&F.push(De,ii,Ee,Ae,wi.z,null)}}const Cn=De.children;for(let ii=0,Ee=Cn.length;ii<Ee;ii++)da(Cn[ii],Lt,Ae,Ot)}function il(De,Lt,Ae){const Ot=Lt.isScene===!0?Lt.overrideMaterial:null;for(let yi=0,Cn=De.length;yi<Cn;yi++){const ii=De[yi],Ee=ii.object,Z=ii.geometry,Q=Ot===null?ii.material:Ot,ce=ii.group;if(Ae.isArrayCamera){const xe=Ae.cameras;for(let de=0,Me=xe.length;de<Me;de++){const Oe=xe[de];Ee.layers.test(Oe.layers)&&(Ii.viewport(At.copy(Oe.viewport)),V.setupLightsView(Oe),$n(Ee,Lt,Oe,Z,Q,ce))}}else $n(Ee,Lt,Ae,Z,Q,ce)}}function $n(De,Lt,Ae,Ot,yi,Cn){if(De.onBeforeRender(se,Lt,Ae,Ot,yi,Cn),De.modelViewMatrix.multiplyMatrices(Ae.matrixWorldInverse,De.matrixWorld),De.normalMatrix.getNormalMatrix(De.modelViewMatrix),De.isImmediateRenderObject){const ii=lc(Ae,Lt,yi,De);Ii.setMaterial(yi),Vi.reset(),ua(De,ii)}else se.renderBufferDirect(Ae,Lt,Ot,yi,De,Cn);De.onAfterRender(se,Lt,Ae,Ot,yi,Cn)}function yr(De,Lt,Ae){Lt.isScene!==!0&&(Lt=Rn);const Ot=ti.get(De),yi=V.state.lights,Cn=V.state.shadowsArray,ii=yi.state.version,Ee=Le.getParameters(De,yi.state,Cn,Lt,Ae),Z=Le.getProgramCacheKey(Ee);let Q=Ot.program,ce=!0;if(Ot.environment=De.isMeshStandardMaterial?Lt.environment:null,Ot.fog=Lt.fog,Ot.envMap=hi.get(De.envMap||Ot.environment),Q===void 0)De.addEventListener("dispose",Ys);else if(Q.cacheKey!==Z)Ks(De);else if(Ot.lightsStateVersion!==ii)ce=!1;else{if(Ee.shaderID!==void 0)return;ce=!1}ce&&(Ee.uniforms=Le.getUniforms(De),De.onBeforeCompile(Ee,se),Q=Le.acquireProgram(Ee,Z),Ot.program=Q,Ot.uniforms=Ee.uniforms,Ot.outputEncoding=Ee.outputEncoding);const xe=Ot.uniforms;(!De.isShaderMaterial&&!De.isRawShaderMaterial||De.clipping===!0)&&(Ot.numClippingPlanes=oi.numPlanes,Ot.numIntersection=oi.numIntersection,xe.clippingPlanes=oi.uniform),Ot.needsLights=Qo(De),Ot.lightsStateVersion=ii,Ot.needsLights&&(xe.ambientLightColor.value=yi.state.ambient,xe.lightProbe.value=yi.state.probe,xe.directionalLights.value=yi.state.directional,xe.directionalLightShadows.value=yi.state.directionalShadow,xe.spotLights.value=yi.state.spot,xe.spotLightShadows.value=yi.state.spotShadow,xe.rectAreaLights.value=yi.state.rectArea,xe.ltc_1.value=yi.state.rectAreaLTC1,xe.ltc_2.value=yi.state.rectAreaLTC2,xe.pointLights.value=yi.state.point,xe.pointLightShadows.value=yi.state.pointShadow,xe.hemisphereLights.value=yi.state.hemi,xe.directionalShadowMap.value=yi.state.directionalShadowMap,xe.directionalShadowMatrix.value=yi.state.directionalShadowMatrix,xe.spotShadowMap.value=yi.state.spotShadowMap,xe.spotShadowMatrix.value=yi.state.spotShadowMatrix,xe.pointShadowMap.value=yi.state.pointShadowMap,xe.pointShadowMatrix.value=yi.state.pointShadowMatrix);const de=Ot.program.getUniforms(),Me=Uu.seqWithValue(de.seq,xe);Ot.uniformsList=Me}function lc(De,Lt,Ae,Ot){Lt.isScene!==!0&&(Lt=Rn),qt.resetTextureUnits();const yi=Lt.fog,Cn=Ae.isMeshStandardMaterial?Lt.environment:null,ii=Ue===null?se.outputEncoding:Ue.texture.encoding,Ee=hi.get(Ae.envMap||Cn),Z=ti.get(Ae),Q=V.state.lights;if(Pi===!0&&(Ai===!0||De!==Ye)){const Be=De===Ye&&Ae.id===Ce;oi.setState(Ae,De,Be)}Ae.version===Z.__version?(Ae.fog&&Z.fog!==yi||Z.environment!==Cn||Z.needsLights&&Z.lightsStateVersion!==Q.state.version||Z.numClippingPlanes!==void 0&&(Z.numClippingPlanes!==oi.numPlanes||Z.numIntersection!==oi.numIntersection)||Z.outputEncoding!==ii||Z.envMap!==Ee)&&yr(Ae,Lt,Ot):(yr(Ae,Lt,Ot),Z.__version=Ae.version);let ce=!1,xe=!1,de=!1;const Me=Z.program,Oe=Me.getUniforms(),Pe=Z.uniforms;if(Ii.useProgram(Me.program)&&(ce=!0,xe=!0,de=!0),Ae.id!==Ce&&(Ce=Ae.id,xe=!0),ce||Ye!==De){if(Oe.setValue(Zt,"projectionMatrix",De.projectionMatrix),Di.logarithmicDepthBuffer&&Oe.setValue(Zt,"logDepthBufFC",2/(Math.log(De.far+1)/Math.LN2)),Ye!==De&&(Ye=De,xe=!0,de=!0),Ae.isShaderMaterial||Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshStandardMaterial||Ae.envMap){const Be=Oe.map.cameraPosition;Be!==void 0&&Be.setValue(Zt,wi.setFromMatrixPosition(De.matrixWorld))}(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial)&&Oe.setValue(Zt,"isOrthographic",De.isOrthographicCamera===!0),(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial||Ae.isShadowMaterial||Ae.skinning)&&Oe.setValue(Zt,"viewMatrix",De.matrixWorldInverse)}if(Ae.skinning){Oe.setOptional(Zt,Ot,"bindMatrix"),Oe.setOptional(Zt,Ot,"bindMatrixInverse");const Be=Ot.skeleton;if(Be){const gt=Be.bones;if(Di.floatVertexTextures){if(Be.boneTexture===null){let st=Math.sqrt(gt.length*4);st=Bn.ceilPowerOfTwo(st),st=Math.max(st,4);const Ft=new Float32Array(st*st*4);Ft.set(Be.boneMatrices);const ri=new f2(Ft,st,st,El,Bu);Be.boneMatrices=Ft,Be.boneTexture=ri,Be.boneTextureSize=st}Oe.setValue(Zt,"boneTexture",Be.boneTexture,qt),Oe.setValue(Zt,"boneTextureSize",Be.boneTextureSize)}else Oe.setOptional(Zt,Be,"boneMatrices")}}return(xe||Z.receiveShadow!==Ot.receiveShadow)&&(Z.receiveShadow=Ot.receiveShadow,Oe.setValue(Zt,"receiveShadow",Ot.receiveShadow)),xe&&(Oe.setValue(Zt,"toneMappingExposure",se.toneMappingExposure),Z.needsLights&&Ml(Pe,de),yi&&Ae.fog&&Wt.refreshFogUniforms(Pe,yi),Wt.refreshMaterialUniforms(Pe,Ae,Qe,Dt),Uu.upload(Zt,Z.uniformsList,Pe,qt)),Ae.isShaderMaterial&&Ae.uniformsNeedUpdate===!0&&(Uu.upload(Zt,Z.uniformsList,Pe,qt),Ae.uniformsNeedUpdate=!1),Ae.isSpriteMaterial&&Oe.setValue(Zt,"center",Ot.center),Oe.setValue(Zt,"modelViewMatrix",Ot.modelViewMatrix),Oe.setValue(Zt,"normalMatrix",Ot.normalMatrix),Oe.setValue(Zt,"modelMatrix",Ot.matrixWorld),Me}function Ml(De,Lt){De.ambientLightColor.needsUpdate=Lt,De.lightProbe.needsUpdate=Lt,De.directionalLights.needsUpdate=Lt,De.directionalLightShadows.needsUpdate=Lt,De.pointLights.needsUpdate=Lt,De.pointLightShadows.needsUpdate=Lt,De.spotLights.needsUpdate=Lt,De.spotLightShadows.needsUpdate=Lt,De.rectAreaLights.needsUpdate=Lt,De.hemisphereLights.needsUpdate=Lt}function Qo(De){return De.isMeshLambertMaterial||De.isMeshToonMaterial||De.isMeshPhongMaterial||De.isMeshStandardMaterial||De.isShadowMaterial||De.isShaderMaterial&&De.lights===!0}this.setFramebuffer=function(De){ae!==De&&Ue===null&&Zt.bindFramebuffer(36160,De),ae=De},this.getActiveCubeFace=function(){return ie},this.getActiveMipmapLevel=function(){return tt},this.getRenderTarget=function(){return Ue},this.setRenderTarget=function(De,Lt=0,Ae=0){Ue=De,ie=Lt,tt=Ae,De&&ti.get(De).__webglFramebuffer===void 0&&qt.setupRenderTarget(De);let Ot=ae,yi=!1,Cn=!1;if(De){const ii=De.texture;(ii.isDataTexture3D||ii.isDataTexture2DArray)&&(Cn=!0);const Ee=ti.get(De).__webglFramebuffer;De.isWebGLCubeRenderTarget?(Ot=Ee[Lt],yi=!0):De.isWebGLMultisampleRenderTarget?Ot=ti.get(De).__webglMultisampledFramebuffer:Ot=Ee,At.copy(De.viewport),ft.copy(De.scissor),wt=De.scissorTest}else At.copy(yt).multiplyScalar(Qe).floor(),ft.copy(Nt).multiplyScalar(Qe).floor(),wt=ei;if(Ne!==Ot&&(Zt.bindFramebuffer(36160,Ot),Ne=Ot),Ii.viewport(At),Ii.scissor(ft),Ii.setScissorTest(wt),yi){const ii=ti.get(De.texture);Zt.framebufferTexture2D(36160,36064,34069+Lt,ii.__webglTexture,Ae)}else if(Cn){const ii=ti.get(De.texture),Ee=Lt||0;Zt.framebufferTextureLayer(36160,36064,ii.__webglTexture,Ae||0,Ee)}},this.readRenderTargetPixels=function(De,Lt,Ae,Ot,yi,Cn,ii){if(!(De&&De.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ee=ti.get(De).__webglFramebuffer;if(De.isWebGLCubeRenderTarget&&ii!==void 0&&(Ee=Ee[ii]),Ee){let Z=!1;Ee!==Ne&&(Zt.bindFramebuffer(36160,Ee),Z=!0);try{const Q=De.texture,ce=Q.format,xe=Q.type;if(ce!==El&&Xi.convert(ce)!==Zt.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const de=xe===j0&&(zn.has("EXT_color_buffer_half_float")||Di.isWebGL2&&zn.has("EXT_color_buffer_float"));if(xe!==c2&&Xi.convert(xe)!==Zt.getParameter(35738)&&!(xe===Bu&&(Di.isWebGL2||zn.has("OES_texture_float")||zn.has("WEBGL_color_buffer_float")))&&!de){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Zt.checkFramebufferStatus(36160)===36053?Lt>=0&&Lt<=De.width-Ot&&Ae>=0&&Ae<=De.height-yi&&Zt.readPixels(Lt,Ae,Ot,yi,Xi.convert(ce),Xi.convert(xe),Cn):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Z&&Zt.bindFramebuffer(36160,Ne)}}},this.copyFramebufferToTexture=function(De,Lt,Ae=0){const Ot=Math.pow(2,-Ae),yi=Math.floor(Lt.image.width*Ot),Cn=Math.floor(Lt.image.height*Ot),ii=Xi.convert(Lt.format);qt.setTexture2D(Lt,0),Zt.copyTexImage2D(3553,Ae,ii,De.x,De.y,yi,Cn,0),Ii.unbindTexture()},this.copyTextureToTexture=function(De,Lt,Ae,Ot=0){const yi=Lt.image.width,Cn=Lt.image.height,ii=Xi.convert(Ae.format),Ee=Xi.convert(Ae.type);qt.setTexture2D(Ae,0),Zt.pixelStorei(37440,Ae.flipY),Zt.pixelStorei(37441,Ae.premultiplyAlpha),Zt.pixelStorei(3317,Ae.unpackAlignment),Lt.isDataTexture?Zt.texSubImage2D(3553,Ot,De.x,De.y,yi,Cn,ii,Ee,Lt.image.data):Lt.isCompressedTexture?Zt.compressedTexSubImage2D(3553,Ot,De.x,De.y,Lt.mipmaps[0].width,Lt.mipmaps[0].height,ii,Lt.mipmaps[0].data):Zt.texSubImage2D(3553,Ot,De.x,De.y,ii,Ee,Lt.image),Ot===0&&Ae.generateMipmaps&&Zt.generateMipmap(3553),Ii.unbindTexture()},this.copyTextureToTexture3D=function(De,Lt,Ae,Ot,yi=0){if(se.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const{width:Cn,height:ii,data:Ee}=Ae.image,Z=Xi.convert(Ot.format),Q=Xi.convert(Ot.type);let ce;if(Ot.isDataTexture3D)qt.setTexture3D(Ot,0),ce=32879;else if(Ot.isDataTexture2DArray)qt.setTexture2DArray(Ot,0),ce=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Zt.pixelStorei(37440,Ot.flipY),Zt.pixelStorei(37441,Ot.premultiplyAlpha),Zt.pixelStorei(3317,Ot.unpackAlignment);const xe=Zt.getParameter(3314),de=Zt.getParameter(32878),Me=Zt.getParameter(3316),Oe=Zt.getParameter(3315),Pe=Zt.getParameter(32877);Zt.pixelStorei(3314,Cn),Zt.pixelStorei(32878,ii),Zt.pixelStorei(3316,De.min.x),Zt.pixelStorei(3315,De.min.y),Zt.pixelStorei(32877,De.min.z),Zt.texSubImage3D(ce,yi,Lt.x,Lt.y,Lt.z,De.max.x-De.min.x+1,De.max.y-De.min.y+1,De.max.z-De.min.z+1,Z,Q,Ee),Zt.pixelStorei(3314,xe),Zt.pixelStorei(32878,de),Zt.pixelStorei(3316,Me),Zt.pixelStorei(3315,Oe),Zt.pixelStorei(32877,Pe),yi===0&&Ot.generateMipmaps&&Zt.generateMipmap(ce),Ii.unbindTexture()},this.initTexture=function(De){qt.setTexture2D(De,0),Ii.unbindTexture()},this.resetState=function(){Ii.reset(),Vi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class xee extends kr{}xee.prototype.isWebGL1Renderer=!0;class p2 extends Dn{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,o){return super.copy(e,o),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const o=super.toJSON(e);return this.background!==null&&(o.object.background=this.background.toJSON(e)),this.environment!==null&&(o.object.environment=this.environment.toJSON(e)),this.fog!==null&&(o.object.fog=this.fog.toJSON()),o}}p2.prototype.isScene=!0;function Ga(i,e){this.array=i,this.stride=e,this.count=i!==void 0?i.length/e:0,this.usage=rw,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Bn.generateUUID()}Object.defineProperty(Ga.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});Object.assign(Ga.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this},copyAt:function(i,e,o){i*=this.stride,o*=e.stride;for(let h=0,l=this.stride;h<l;h++)this.array[i+h]=e.array[o+h];return this},set:function(i,e=0){return this.array.set(i,e),this},clone:function(i){i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Bn.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),o=new Ga(e,this.stride);return o.setUsage(this.usage),o},onUpload:function(i){return this.onUploadCallback=i,this},toJSON:function(i){return i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Bn.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const ed=new He;function R_(i,e,o,h){this.name="",this.data=i,this.itemSize=e,this.offset=o,this.normalized=h===!0}Object.defineProperties(R_.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(i){this.data.needsUpdate=i}}});Object.assign(R_.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(i){for(let e=0,o=this.data.count;e<o;e++)ed.x=this.getX(e),ed.y=this.getY(e),ed.z=this.getZ(e),ed.applyMatrix4(i),this.setXYZ(e,ed.x,ed.y,ed.z);return this},setX:function(i,e){return this.data.array[i*this.data.stride+this.offset]=e,this},setY:function(i,e){return this.data.array[i*this.data.stride+this.offset+1]=e,this},setZ:function(i,e){return this.data.array[i*this.data.stride+this.offset+2]=e,this},setW:function(i,e){return this.data.array[i*this.data.stride+this.offset+3]=e,this},getX:function(i){return this.data.array[i*this.data.stride+this.offset]},getY:function(i){return this.data.array[i*this.data.stride+this.offset+1]},getZ:function(i){return this.data.array[i*this.data.stride+this.offset+2]},getW:function(i){return this.data.array[i*this.data.stride+this.offset+3]},setXY:function(i,e,o){return i=i*this.data.stride+this.offset,this.data.array[i+0]=e,this.data.array[i+1]=o,this},setXYZ:function(i,e,o,h){return i=i*this.data.stride+this.offset,this.data.array[i+0]=e,this.data.array[i+1]=o,this.data.array[i+2]=h,this},setXYZW:function(i,e,o,h,l){return i=i*this.data.stride+this.offset,this.data.array[i+0]=e,this.data.array[i+1]=o,this.data.array[i+2]=h,this.data.array[i+3]=l,this},clone:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let o=0;o<this.count;o++){const h=o*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)e.push(this.data.array[h+l])}return new qn(new this.array.constructor(e),this.itemSize,this.normalized)}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new R_(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let o=0;o<this.count;o++){const h=o*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)e.push(this.data.array[h+l])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});class d4 extends fo{constructor(e){super(),this.type="SpriteMaterial",this.color=new mn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}d4.prototype.isSpriteMaterial=!0;let Qf;const t_=new He,ep=new He,tp=new He,ip=new gi,i_=new gi,f4=new nn,f0=new He,n_=new He,p0=new He,vL=new gi,HS=new gi,xL=new gi;class bee extends Dn{constructor(e){if(super(),this.type="Sprite",Qf===void 0){Qf=new _r;const o=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),h=new Ga(o,5);Qf.setIndex([0,1,2,0,2,3]),Qf.setAttribute("position",new R_(h,3,0,!1)),Qf.setAttribute("uv",new R_(h,2,3,!1))}this.geometry=Qf,this.material=e!==void 0?e:new d4,this.center=new gi(.5,.5)}raycast(e,o){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ep.setFromMatrixScale(this.matrixWorld),f4.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),tp.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ep.multiplyScalar(-tp.z);const h=this.material.rotation;let l,f;h!==0&&(f=Math.cos(h),l=Math.sin(h));const x=this.center;m0(f0.set(-.5,-.5,0),tp,x,ep,l,f),m0(n_.set(.5,-.5,0),tp,x,ep,l,f),m0(p0.set(.5,.5,0),tp,x,ep,l,f),vL.set(0,0),HS.set(1,0),xL.set(1,1);let s=e.ray.intersectTriangle(f0,n_,p0,!1,t_);if(s===null&&(m0(n_.set(-.5,.5,0),tp,x,ep,l,f),HS.set(0,1),s=e.ray.intersectTriangle(f0,p0,n_,!1,t_),s===null))return;const P=e.ray.origin.distanceTo(t_);P<e.near||P>e.far||o.push({distance:P,point:t_.clone(),uv:Oo.getUV(t_,f0,n_,p0,vL,HS,xL,new gi),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}bee.prototype.isSprite=!0;function m0(i,e,o,h,l,f){ip.subVectors(i,o).addScalar(.5).multiply(h),l!==void 0?(i_.x=f*ip.x-l*ip.y,i_.y=l*ip.x+f*ip.y):i_.copy(ip),i.copy(e),i.x+=i_.x,i.y+=i_.y,i.applyMatrix4(f4)}const bL=new He,wL=new Lr,SL=new Lr,wee=new He,TL=new nn;function vT(i,e){lr.call(this,i,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new nn,this.bindMatrixInverse=new nn}vT.prototype=Object.assign(Object.create(lr.prototype),{constructor:vT,isSkinnedMesh:!0,copy:function(i){return lr.prototype.copy.call(this,i),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,this},bind:function(i,e){this.skeleton=i,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const i=new Lr,e=this.geometry.attributes.skinWeight;for(let o=0,h=e.count;o<h;o++){i.x=e.getX(o),i.y=e.getY(o),i.z=e.getZ(o),i.w=e.getW(o);const l=1/i.manhattanLength();l!==1/0?i.multiplyScalar(l):i.set(1,0,0,0),e.setXYZW(o,i.x,i.y,i.z,i.w)}},updateMatrixWorld:function(i){lr.prototype.updateMatrixWorld.call(this,i),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(i,e){const o=this.skeleton,h=this.geometry;wL.fromBufferAttribute(h.attributes.skinIndex,i),SL.fromBufferAttribute(h.attributes.skinWeight,i),bL.fromBufferAttribute(h.attributes.position,i).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let l=0;l<4;l++){const f=SL.getComponent(l);if(f!==0){const x=wL.getComponent(l);TL.multiplyMatrices(o.bones[x].matrixWorld,o.boneInverses[x]),e.addScaledVector(wee.copy(bL).applyMatrix4(TL),f)}}return e.applyMatrix4(this.bindMatrixInverse)}});function EL(){Dn.call(this),this.type="Bone"}EL.prototype=Object.assign(Object.create(Dn.prototype),{constructor:EL,isBone:!0});const IL=new nn,ML=new nn,g0=[],r_=new lr;function AL(i,e,o){lr.call(this,i,e),this.instanceMatrix=new qn(new Float32Array(o*16),16),this.instanceColor=null,this.count=o,this.frustumCulled=!1}AL.prototype=Object.assign(Object.create(lr.prototype),{constructor:AL,isInstancedMesh:!0,copy:function(i){return lr.prototype.copy.call(this,i),this.instanceMatrix.copy(i.instanceMatrix),i.instanceColor!==null&&(this.instanceColor=i.instanceColor.clone()),this.count=i.count,this},getColorAt:function(i,e){e.fromArray(this.instanceColor.array,i*3)},getMatrixAt:function(i,e){e.fromArray(this.instanceMatrix.array,i*16)},raycast:function(i,e){const o=this.matrixWorld,h=this.count;if(r_.geometry=this.geometry,r_.material=this.material,r_.material!==void 0)for(let l=0;l<h;l++){this.getMatrixAt(l,IL),ML.multiplyMatrices(o,IL),r_.matrixWorld=ML,r_.raycast(i,g0);for(let f=0,x=g0.length;f<x;f++){const s=g0[f];s.instanceId=l,s.object=this,e.push(s)}g0.length=0}},setColorAt:function(i,e){this.instanceColor===null&&(this.instanceColor=new qn(new Float32Array(this.count*3),3)),e.toArray(this.instanceColor.array,i*3)},setMatrixAt:function(i,e){e.toArray(this.instanceMatrix.array,i*16)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});class gy extends fo{constructor(e){super(),this.type="LineBasicMaterial",this.color=new mn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}gy.prototype.isLineBasicMaterial=!0;const PL=new He,zL=new He,CL=new nn,ZS=new gd,_0=new Rp;function D_(i=new _r,e=new gy){Dn.call(this),this.type="Line",this.geometry=i,this.material=e,this.updateMorphTargets()}D_.prototype=Object.assign(Object.create(Dn.prototype),{constructor:D_,isLine:!0,copy:function(i){return Dn.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(i.index===null){const e=i.attributes.position,o=[0];for(let h=1,l=e.count;h<l;h++)PL.fromBufferAttribute(e,h-1),zL.fromBufferAttribute(e,h),o[h]=o[h-1],o[h]+=PL.distanceTo(zL);i.setAttribute("lineDistance",new Or(o,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(i,e){const o=this.geometry,h=this.matrixWorld,l=i.params.Line.threshold;if(o.boundingSphere===null&&o.computeBoundingSphere(),_0.copy(o.boundingSphere),_0.applyMatrix4(h),_0.radius+=l,i.ray.intersectsSphere(_0)===!1)return;CL.copy(h).invert(),ZS.copy(i.ray).applyMatrix4(CL);const f=l/((this.scale.x+this.scale.y+this.scale.z)/3),x=f*f,s=new He,P=new He,C=new He,O=new He,F=this.isLineSegments?2:1;if(o.isBufferGeometry){const V=o.index,ee=o.attributes.position;if(V!==null){const se=V.array;for(let fe=0,ae=se.length-1;fe<ae;fe+=F){const ie=se[fe],tt=se[fe+1];if(s.fromBufferAttribute(ee,ie),P.fromBufferAttribute(ee,tt),ZS.distanceSqToSegment(s,P,O,C)>x)continue;O.applyMatrix4(this.matrixWorld);const Ne=i.ray.origin.distanceTo(O);Ne<i.near||Ne>i.far||e.push({distance:Ne,point:C.clone().applyMatrix4(this.matrixWorld),index:fe,face:null,faceIndex:null,object:this})}}else for(let se=0,fe=ee.count-1;se<fe;se+=F){if(s.fromBufferAttribute(ee,se),P.fromBufferAttribute(ee,se+1),ZS.distanceSqToSegment(s,P,O,C)>x)continue;O.applyMatrix4(this.matrixWorld);const ie=i.ray.origin.distanceTo(O);ie<i.near||ie>i.far||e.push({distance:ie,point:C.clone().applyMatrix4(this.matrixWorld),index:se,face:null,faceIndex:null,object:this})}}else o.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const e=i.morphAttributes,o=Object.keys(e);if(o.length>0){const h=e[o[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,f=h.length;l<f;l++){const x=h[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[x]=l}}}}else{const e=i.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const LL=new He,RL=new He;function q0(i,e){D_.call(this,i,e),this.type="LineSegments"}q0.prototype=Object.assign(Object.create(D_.prototype),{constructor:q0,isLineSegments:!0,computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(i.index===null){const e=i.attributes.position,o=[];for(let h=0,l=e.count;h<l;h+=2)LL.fromBufferAttribute(e,h),RL.fromBufferAttribute(e,h+1),o[h]=h===0?0:o[h-1],o[h+1]=o[h]+LL.distanceTo(RL);i.setAttribute("lineDistance",new Or(o,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});class See extends D_{constructor(e,o){super(e,o),this.type="LineLoop"}}See.prototype.isLineLoop=!0;class p4 extends fo{constructor(e){super(),this.type="PointsMaterial",this.color=new mn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}p4.prototype.isPointsMaterial=!0;const DL=new nn,xT=new gd,y0=new Rp,v0=new He;function kL(i=new _r,e=new p4){Dn.call(this),this.type="Points",this.geometry=i,this.material=e,this.updateMorphTargets()}kL.prototype=Object.assign(Object.create(Dn.prototype),{constructor:kL,isPoints:!0,copy:function(i){return Dn.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},raycast:function(i,e){const o=this.geometry,h=this.matrixWorld,l=i.params.Points.threshold;if(o.boundingSphere===null&&o.computeBoundingSphere(),y0.copy(o.boundingSphere),y0.applyMatrix4(h),y0.radius+=l,i.ray.intersectsSphere(y0)===!1)return;DL.copy(h).invert(),xT.copy(i.ray).applyMatrix4(DL);const f=l/((this.scale.x+this.scale.y+this.scale.z)/3),x=f*f;if(o.isBufferGeometry){const s=o.index,C=o.attributes.position;if(s!==null){const O=s.array;for(let F=0,V=O.length;F<V;F++){const q=O[F];v0.fromBufferAttribute(C,q),OL(v0,q,x,h,i,e,this)}}else for(let O=0,F=C.count;O<F;O++)v0.fromBufferAttribute(C,O),OL(v0,O,x,h,i,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const e=i.morphAttributes,o=Object.keys(e);if(o.length>0){const h=e[o[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,f=h.length;l<f;l++){const x=h[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[x]=l}}}}else{const e=i.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});function OL(i,e,o,h,l,f,x){const s=xT.distanceSqToPoint(i);if(s<o){const P=new He;xT.closestPointToPoint(i,P),P.applyMatrix4(h);const C=l.ray.origin.distanceTo(P);if(C<l.near||C>l.far)return;f.push({distance:C,distanceToRay:Math.sqrt(s),point:P,index:e,face:null,object:x})}}class Tee extends ps{constructor(e,o,h,l,f,x,s,P,C){super(e,o,h,l,f,x,s,P,C),this.format=s!==void 0?s:rd,this.minFilter=x!==void 0?x:ds,this.magFilter=f!==void 0?f:ds,this.generateMipmaps=!1;const O=this;function F(){O.needsUpdate=!0,e.requestVideoFrameCallback(F)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(F)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Tee.prototype.isVideoTexture=!0;class m4 extends ps{constructor(e,o,h,l,f,x,s,P,C,O,F,V){super(null,x,s,P,C,O,l,f,F,V),this.image={width:o,height:h},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}m4.prototype.isCompressedTexture=!0;class Eee extends ps{constructor(e,o,h,l,f,x,s,P,C){super(e,o,h,l,f,x,s,P,C),this.needsUpdate=!0}}Eee.prototype.isCanvasTexture=!0;class Iee extends ps{constructor(e,o,h,l,f,x,s,P,C,O){if(O=O!==void 0?O:fp,O!==fp&&O!==P_)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");h===void 0&&O===fp&&(h=V0),h===void 0&&O===P_&&(h=f_),super(null,l,f,x,s,P,O,h,C),this.image={width:e,height:o},this.magFilter=s!==void 0?s:qs,this.minFilter=P!==void 0?P:qs,this.flipY=!1,this.generateMipmaps=!1}}Iee.prototype.isDepthTexture=!0;class Mee extends _r{constructor(e=1,o=1,h=1,l=8,f=1,x=!1,s=0,P=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:o,height:h,radialSegments:l,heightSegments:f,openEnded:x,thetaStart:s,thetaLength:P};const C=this;l=Math.floor(l),f=Math.floor(f);const O=[],F=[],V=[],q=[];let ee=0;const se=[],fe=h/2;let ae=0;ie(),x===!1&&(e>0&&tt(!0),o>0&&tt(!1)),this.setIndex(O),this.setAttribute("position",new Or(F,3)),this.setAttribute("normal",new Or(V,3)),this.setAttribute("uv",new Or(q,2));function ie(){const Ue=new He,Ne=new He;let Ce=0;const Ye=(o-e)/h;for(let At=0;At<=f;At++){const ft=[],wt=At/f,Et=wt*(o-e)+e;for(let Dt=0;Dt<=l;Dt++){const Qe=Dt/l,ht=Qe*P+s,_t=Math.sin(ht),yt=Math.cos(ht);Ne.x=Et*_t,Ne.y=-wt*h+fe,Ne.z=Et*yt,F.push(Ne.x,Ne.y,Ne.z),Ue.set(_t,Ye,yt).normalize(),V.push(Ue.x,Ue.y,Ue.z),q.push(Qe,1-wt),ft.push(ee++)}se.push(ft)}for(let At=0;At<l;At++)for(let ft=0;ft<f;ft++){const wt=se[ft][At],Et=se[ft+1][At],Dt=se[ft+1][At+1],Qe=se[ft][At+1];O.push(wt,Et,Qe),O.push(Et,Dt,Qe),Ce+=6}C.addGroup(ae,Ce,0),ae+=Ce}function tt(Ue){const Ne=ee,Ce=new gi,Ye=new He;let At=0;const ft=Ue===!0?e:o,wt=Ue===!0?1:-1;for(let Dt=1;Dt<=l;Dt++)F.push(0,fe*wt,0),V.push(0,wt,0),q.push(.5,.5),ee++;const Et=ee;for(let Dt=0;Dt<=l;Dt++){const ht=Dt/l*P+s,_t=Math.cos(ht),yt=Math.sin(ht);Ye.x=ft*yt,Ye.y=fe*wt,Ye.z=ft*_t,F.push(Ye.x,Ye.y,Ye.z),V.push(0,wt,0),Ce.x=_t*.5+.5,Ce.y=yt*.5*wt+.5,q.push(Ce.x,Ce.y),ee++}for(let Dt=0;Dt<l;Dt++){const Qe=Ne+Dt,ht=Et+Dt;Ue===!0?O.push(ht,ht+1,Qe):O.push(ht+1,ht,Qe),At+=3}C.addGroup(ae,At,Ue===!0?1:2),ae+=At}}}const Aee={triangulate:function(i,e,o){o=o||2;const h=e&&e.length,l=h?e[0]*o:i.length;let f=g4(i,0,l,o,!0);const x=[];if(!f||f.next===f.prev)return x;let s,P,C,O,F,V,q;if(h&&(f=Ree(i,e,f,o)),i.length>80*o){s=C=i[0],P=O=i[1];for(let ee=o;ee<l;ee+=o)F=i[ee],V=i[ee+1],F<s&&(s=F),V<P&&(P=V),F>C&&(C=F),V>O&&(O=V);q=Math.max(C-s,O-P),q=q!==0?1/q:0}return k_(f,x,o,s,P,q),x}};function g4(i,e,o,h,l){let f,x;if(l===Gee(i,e,o,h)>0)for(f=e;f<o;f+=h)x=FL(f,i[f],i[f+1],x);else for(f=o-h;f>=e;f-=h)x=FL(f,i[f],i[f+1],x);return x&&aw(x,x.next)&&(F_(x),x=x.next),x}function Zu(i,e){if(!i)return i;e||(e=i);let o=i,h;do if(h=!1,!o.steiner&&(aw(o,o.next)||co(o.prev,o,o.next)===0)){if(F_(o),o=e=o.prev,o===o.next)break;h=!0}else o=o.next;while(h||o!==e);return e}function k_(i,e,o,h,l,f,x){if(!i)return;!x&&f&&Bee(i,h,l,f);let s=i,P,C;for(;i.prev!==i.next;){if(P=i.prev,C=i.next,f?zee(i,h,l,f):Pee(i)){e.push(P.i/o),e.push(i.i/o),e.push(C.i/o),F_(i),i=C.next,s=C.next;continue}if(i=C,i===s){x?x===1?(i=Cee(Zu(i),e,o),k_(i,e,o,h,l,f,2)):x===2&&Lee(i,e,o,h,l,f):k_(Zu(i),e,o,h,l,f,1);break}}}function Pee(i){const e=i.prev,o=i,h=i.next;if(co(e,o,h)>=0)return!1;let l=i.next.next;for(;l!==i.prev;){if(hp(e.x,e.y,o.x,o.y,h.x,h.y,l.x,l.y)&&co(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function zee(i,e,o,h){const l=i.prev,f=i,x=i.next;if(co(l,f,x)>=0)return!1;const s=l.x<f.x?l.x<x.x?l.x:x.x:f.x<x.x?f.x:x.x,P=l.y<f.y?l.y<x.y?l.y:x.y:f.y<x.y?f.y:x.y,C=l.x>f.x?l.x>x.x?l.x:x.x:f.x>x.x?f.x:x.x,O=l.y>f.y?l.y>x.y?l.y:x.y:f.y>x.y?f.y:x.y,F=bT(s,P,e,o,h),V=bT(C,O,e,o,h);let q=i.prevZ,ee=i.nextZ;for(;q&&q.z>=F&&ee&&ee.z<=V;){if(q!==i.prev&&q!==i.next&&hp(l.x,l.y,f.x,f.y,x.x,x.y,q.x,q.y)&&co(q.prev,q,q.next)>=0||(q=q.prevZ,ee!==i.prev&&ee!==i.next&&hp(l.x,l.y,f.x,f.y,x.x,x.y,ee.x,ee.y)&&co(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;q&&q.z>=F;){if(q!==i.prev&&q!==i.next&&hp(l.x,l.y,f.x,f.y,x.x,x.y,q.x,q.y)&&co(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;ee&&ee.z<=V;){if(ee!==i.prev&&ee!==i.next&&hp(l.x,l.y,f.x,f.y,x.x,x.y,ee.x,ee.y)&&co(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Cee(i,e,o){let h=i;do{const l=h.prev,f=h.next.next;!aw(l,f)&&_4(l,h,h.next,f)&&O_(l,f)&&O_(f,l)&&(e.push(l.i/o),e.push(h.i/o),e.push(f.i/o),F_(h),F_(h.next),h=i=f),h=h.next}while(h!==i);return Zu(h)}function Lee(i,e,o,h,l,f){let x=i;do{let s=x.next.next;for(;s!==x.prev;){if(x.i!==s.i&&$ee(x,s)){let P=y4(x,s);x=Zu(x,x.next),P=Zu(P,P.next),k_(x,e,o,h,l,f),k_(P,e,o,h,l,f);return}s=s.next}x=x.next}while(x!==i)}function Ree(i,e,o,h){const l=[];let f,x,s,P,C;for(f=0,x=e.length;f<x;f++)s=e[f]*h,P=f<x-1?e[f+1]*h:i.length,C=g4(i,s,P,h,!1),C===C.next&&(C.steiner=!0),l.push(Uee(C));for(l.sort(Dee),f=0;f<l.length;f++)kee(l[f],o),o=Zu(o,o.next);return o}function Dee(i,e){return i.x-e.x}function kee(i,e){if(e=Oee(i,e),e){const o=y4(e,i);Zu(e,e.next),Zu(o,o.next)}}function Oee(i,e){let o=e;const h=i.x,l=i.y;let f=-1/0,x;do{if(l<=o.y&&l>=o.next.y&&o.next.y!==o.y){const V=o.x+(l-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(V<=h&&V>f){if(f=V,V===h){if(l===o.y)return o;if(l===o.next.y)return o.next}x=o.x<o.next.x?o:o.next}}o=o.next}while(o!==e);if(!x)return null;if(h===f)return x;const s=x,P=x.x,C=x.y;let O=1/0,F;o=x;do h>=o.x&&o.x>=P&&h!==o.x&&hp(l<C?h:f,l,P,C,l<C?f:h,l,o.x,o.y)&&(F=Math.abs(l-o.y)/(h-o.x),O_(o,i)&&(F<O||F===O&&(o.x>x.x||o.x===x.x&&Fee(x,o)))&&(x=o,O=F)),o=o.next;while(o!==s);return x}function Fee(i,e){return co(i.prev,i,e.prev)<0&&co(e.next,i,i.next)<0}function Bee(i,e,o,h){let l=i;do l.z===null&&(l.z=bT(l.x,l.y,e,o,h)),l.prevZ=l.prev,l.nextZ=l.next,l=l.next;while(l!==i);l.prevZ.nextZ=null,l.prevZ=null,Nee(l)}function Nee(i){let e,o,h,l,f,x,s,P,C=1;do{for(o=i,i=null,f=null,x=0;o;){for(x++,h=o,s=0,e=0;e<C&&(s++,h=h.nextZ,!!h);e++);for(P=C;s>0||P>0&&h;)s!==0&&(P===0||!h||o.z<=h.z)?(l=o,o=o.nextZ,s--):(l=h,h=h.nextZ,P--),f?f.nextZ=l:i=l,l.prevZ=f,f=l;o=h}f.nextZ=null,C*=2}while(x>1);return i}function bT(i,e,o,h,l){return i=32767*(i-o)*l,e=32767*(e-h)*l,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function Uee(i){let e=i,o=i;do(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next;while(e!==i);return o}function hp(i,e,o,h,l,f,x,s){return(l-x)*(e-s)-(i-x)*(f-s)>=0&&(i-x)*(h-s)-(o-x)*(e-s)>=0&&(o-x)*(f-s)-(l-x)*(h-s)>=0}function $ee(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!Vee(i,e)&&(O_(i,e)&&O_(e,i)&&jee(i,e)&&(co(i.prev,i,e.prev)||co(i,e.prev,e))||aw(i,e)&&co(i.prev,i,i.next)>0&&co(e.prev,e,e.next)>0)}function co(i,e,o){return(e.y-i.y)*(o.x-e.x)-(e.x-i.x)*(o.y-e.y)}function aw(i,e){return i.x===e.x&&i.y===e.y}function _4(i,e,o,h){const l=b0(co(i,e,o)),f=b0(co(i,e,h)),x=b0(co(o,h,i)),s=b0(co(o,h,e));return!!(l!==f&&x!==s||l===0&&x0(i,o,e)||f===0&&x0(i,h,e)||x===0&&x0(o,i,h)||s===0&&x0(o,e,h))}function x0(i,e,o){return e.x<=Math.max(i.x,o.x)&&e.x>=Math.min(i.x,o.x)&&e.y<=Math.max(i.y,o.y)&&e.y>=Math.min(i.y,o.y)}function b0(i){return i>0?1:i<0?-1:0}function Vee(i,e){let o=i;do{if(o.i!==i.i&&o.next.i!==i.i&&o.i!==e.i&&o.next.i!==e.i&&_4(o,o.next,i,e))return!0;o=o.next}while(o!==i);return!1}function O_(i,e){return co(i.prev,i,i.next)<0?co(i,e,i.next)>=0&&co(i,i.prev,e)>=0:co(i,e,i.prev)<0||co(i,i.next,e)<0}function jee(i,e){let o=i,h=!1;const l=(i.x+e.x)/2,f=(i.y+e.y)/2;do o.y>f!=o.next.y>f&&o.next.y!==o.y&&l<(o.next.x-o.x)*(f-o.y)/(o.next.y-o.y)+o.x&&(h=!h),o=o.next;while(o!==i);return h}function y4(i,e){const o=new wT(i.i,i.x,i.y),h=new wT(e.i,e.x,e.y),l=i.next,f=e.prev;return i.next=e,e.prev=i,o.next=l,l.prev=o,h.next=o,o.prev=h,f.next=h,h.prev=f,h}function FL(i,e,o,h){const l=new wT(i,e,o);return h?(l.next=h.next,l.prev=h,h.next.prev=l,h.next=l):(l.prev=l,l.next=l),l}function F_(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function wT(i,e,o){this.i=i,this.x=e,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gee(i,e,o,h){let l=0;for(let f=e,x=o-h;f<o;f+=h)l+=(i[x]-i[f])*(i[f+1]+i[x+1]),x=f;return l}const sd={area:function(i){const e=i.length;let o=0;for(let h=e-1,l=0;l<e;h=l++)o+=i[h].x*i[l].y-i[l].x*i[h].y;return o*.5},isClockWise:function(i){return sd.area(i)<0},triangulateShape:function(i,e){const o=[],h=[],l=[];BL(i),NL(o,i);let f=i.length;e.forEach(BL);for(let s=0;s<e.length;s++)h.push(f),f+=e[s].length,NL(o,e[s]);const x=Aee.triangulate(o,h);for(let s=0;s<x.length;s+=3)l.push(x.slice(s,s+3));return l}};function BL(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function NL(i,e){for(let o=0;o<e.length;o++)i.push(e[o].x),i.push(e[o].y)}class lw extends _r{constructor(e,o){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:o},e=Array.isArray(e)?e:[e];const h=this,l=[],f=[];for(let s=0,P=e.length;s<P;s++){const C=e[s];x(C)}this.setAttribute("position",new Or(l,3)),this.setAttribute("uv",new Or(f,2)),this.computeVertexNormals();function x(s){const P=[],C=o.curveSegments!==void 0?o.curveSegments:12,O=o.steps!==void 0?o.steps:1;let F=o.depth!==void 0?o.depth:100,V=o.bevelEnabled!==void 0?o.bevelEnabled:!0,q=o.bevelThickness!==void 0?o.bevelThickness:6,ee=o.bevelSize!==void 0?o.bevelSize:q-2,se=o.bevelOffset!==void 0?o.bevelOffset:0,fe=o.bevelSegments!==void 0?o.bevelSegments:3;const ae=o.extrudePath,ie=o.UVGenerator!==void 0?o.UVGenerator:Hee;o.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),F=o.amount);let tt,Ue=!1,Ne,Ce,Ye,At;ae&&(tt=ae.getSpacedPoints(O),Ue=!0,V=!1,Ne=ae.computeFrenetFrames(O,!1),Ce=new He,Ye=new He,At=new He),V||(fe=0,q=0,ee=0,se=0);const ft=s.extractPoints(C);let wt=ft.shape;const Et=ft.holes;if(!sd.isClockWise(wt)){wt=wt.reverse();for(let ti=0,qt=Et.length;ti<qt;ti++){const hi=Et[ti];sd.isClockWise(hi)&&(Et[ti]=hi.reverse())}}const Qe=sd.triangulateShape(wt,Et),ht=wt;for(let ti=0,qt=Et.length;ti<qt;ti++){const hi=Et[ti];wt=wt.concat(hi)}function _t(ti,qt,hi){return qt||console.error("THREE.ExtrudeGeometry: vec does not exist"),qt.clone().multiplyScalar(hi).add(ti)}const yt=wt.length,Nt=Qe.length;function ei(ti,qt,hi){let ji,zi,Ve;const Le=ti.x-qt.x,Wt=ti.y-qt.y,Jt=hi.x-ti.x,rt=hi.y-ti.y,oi=Le*Le+Wt*Wt,Si=Le*rt-Wt*Jt;if(Math.abs(Si)>Number.EPSILON){const _i=Math.sqrt(oi),Kt=Math.sqrt(Jt*Jt+rt*rt),Wi=qt.x-Wt/_i,Xi=qt.y+Le/_i,Vi=hi.x-rt/Kt,Ji=hi.y+Jt/Kt,ki=((Vi-Wi)*rt-(Ji-Xi)*Jt)/(Le*rt-Wt*Jt);ji=Wi+Le*ki-ti.x,zi=Xi+Wt*ki-ti.y;const mr=ji*ji+zi*zi;if(mr<=2)return new gi(ji,zi);Ve=Math.sqrt(mr/2)}else{let _i=!1;Le>Number.EPSILON?Jt>Number.EPSILON&&(_i=!0):Le<-Number.EPSILON?Jt<-Number.EPSILON&&(_i=!0):Math.sign(Wt)===Math.sign(rt)&&(_i=!0),_i?(ji=-Wt,zi=Le,Ve=Math.sqrt(oi)):(ji=Le,zi=Wt,Ve=Math.sqrt(oi/2))}return new gi(ji/Ve,zi/Ve)}const mi=[];for(let ti=0,qt=ht.length,hi=qt-1,ji=ti+1;ti<qt;ti++,hi++,ji++)hi===qt&&(hi=0),ji===qt&&(ji=0),mi[ti]=ei(ht[ti],ht[hi],ht[ji]);const Pi=[];let Ai,dn=mi.concat();for(let ti=0,qt=Et.length;ti<qt;ti++){const hi=Et[ti];Ai=[];for(let ji=0,zi=hi.length,Ve=zi-1,Le=ji+1;ji<zi;ji++,Ve++,Le++)Ve===zi&&(Ve=0),Le===zi&&(Le=0),Ai[ji]=ei(hi[ji],hi[Ve],hi[Le]);Pi.push(Ai),dn=dn.concat(Ai)}for(let ti=0;ti<fe;ti++){const qt=ti/fe,hi=q*Math.cos(qt*Math.PI/2),ji=ee*Math.sin(qt*Math.PI/2)+se;for(let zi=0,Ve=ht.length;zi<Ve;zi++){const Le=_t(ht[zi],mi[zi],ji);pr(Le.x,Le.y,-hi)}for(let zi=0,Ve=Et.length;zi<Ve;zi++){const Le=Et[zi];Ai=Pi[zi];for(let Wt=0,Jt=Le.length;Wt<Jt;Wt++){const rt=_t(Le[Wt],Ai[Wt],ji);pr(rt.x,rt.y,-hi)}}}const wi=ee+se;for(let ti=0;ti<yt;ti++){const qt=V?_t(wt[ti],dn[ti],wi):wt[ti];Ue?(Ye.copy(Ne.normals[0]).multiplyScalar(qt.x),Ce.copy(Ne.binormals[0]).multiplyScalar(qt.y),At.copy(tt[0]).add(Ye).add(Ce),pr(At.x,At.y,At.z)):pr(qt.x,qt.y,0)}for(let ti=1;ti<=O;ti++)for(let qt=0;qt<yt;qt++){const hi=V?_t(wt[qt],dn[qt],wi):wt[qt];Ue?(Ye.copy(Ne.normals[ti]).multiplyScalar(hi.x),Ce.copy(Ne.binormals[ti]).multiplyScalar(hi.y),At.copy(tt[ti]).add(Ye).add(Ce),pr(At.x,At.y,At.z)):pr(hi.x,hi.y,F/O*ti)}for(let ti=fe-1;ti>=0;ti--){const qt=ti/fe,hi=q*Math.cos(qt*Math.PI/2),ji=ee*Math.sin(qt*Math.PI/2)+se;for(let zi=0,Ve=ht.length;zi<Ve;zi++){const Le=_t(ht[zi],mi[zi],ji);pr(Le.x,Le.y,F+hi)}for(let zi=0,Ve=Et.length;zi<Ve;zi++){const Le=Et[zi];Ai=Pi[zi];for(let Wt=0,Jt=Le.length;Wt<Jt;Wt++){const rt=_t(Le[Wt],Ai[Wt],ji);Ue?pr(rt.x,rt.y+tt[O-1].y,tt[O-1].x+hi):pr(rt.x,rt.y,F+hi)}}}Rn(),Un();function Rn(){const ti=l.length/3;if(V){let qt=0,hi=yt*qt;for(let ji=0;ji<Nt;ji++){const zi=Qe[ji];zn(zi[2]+hi,zi[1]+hi,zi[0]+hi)}qt=O+fe*2,hi=yt*qt;for(let ji=0;ji<Nt;ji++){const zi=Qe[ji];zn(zi[0]+hi,zi[1]+hi,zi[2]+hi)}}else{for(let qt=0;qt<Nt;qt++){const hi=Qe[qt];zn(hi[2],hi[1],hi[0])}for(let qt=0;qt<Nt;qt++){const hi=Qe[qt];zn(hi[0]+yt*O,hi[1]+yt*O,hi[2]+yt*O)}}h.addGroup(ti,l.length/3-ti,0)}function Un(){const ti=l.length/3;let qt=0;Zt(ht,qt),qt+=ht.length;for(let hi=0,ji=Et.length;hi<ji;hi++){const zi=Et[hi];Zt(zi,qt),qt+=zi.length}h.addGroup(ti,l.length/3-ti,1)}function Zt(ti,qt){let hi=ti.length;for(;--hi>=0;){const ji=hi;let zi=hi-1;zi<0&&(zi=ti.length-1);for(let Ve=0,Le=O+fe*2;Ve<Le;Ve++){const Wt=yt*Ve,Jt=yt*(Ve+1),rt=qt+ji+Wt,oi=qt+zi+Wt,Si=qt+zi+Jt,_i=qt+ji+Jt;Di(rt,oi,Si,_i)}}}function pr(ti,qt,hi){P.push(ti),P.push(qt),P.push(hi)}function zn(ti,qt,hi){Ii(ti),Ii(qt),Ii(hi);const ji=l.length/3,zi=ie.generateTopUV(h,l,ji-3,ji-2,ji-1);hn(zi[0]),hn(zi[1]),hn(zi[2])}function Di(ti,qt,hi,ji){Ii(ti),Ii(qt),Ii(ji),Ii(qt),Ii(hi),Ii(ji);const zi=l.length/3,Ve=ie.generateSideWallUV(h,l,zi-6,zi-3,zi-2,zi-1);hn(Ve[0]),hn(Ve[1]),hn(Ve[3]),hn(Ve[1]),hn(Ve[2]),hn(Ve[3])}function Ii(ti){l.push(P[ti*3+0]),l.push(P[ti*3+1]),l.push(P[ti*3+2])}function hn(ti){f.push(ti.x),f.push(ti.y)}}}toJSON(){const e=_r.prototype.toJSON.call(this),o=this.parameters.shapes,h=this.parameters.options;return Zee(o,h,e)}}const Hee={generateTopUV:function(i,e,o,h,l){const f=e[o*3],x=e[o*3+1],s=e[h*3],P=e[h*3+1],C=e[l*3],O=e[l*3+1];return[new gi(f,x),new gi(s,P),new gi(C,O)]},generateSideWallUV:function(i,e,o,h,l,f){const x=e[o*3],s=e[o*3+1],P=e[o*3+2],C=e[h*3],O=e[h*3+1],F=e[h*3+2],V=e[l*3],q=e[l*3+1],ee=e[l*3+2],se=e[f*3],fe=e[f*3+1],ae=e[f*3+2];return Math.abs(s-O)<.01?[new gi(x,1-P),new gi(C,1-F),new gi(V,1-ee),new gi(se,1-ae)]:[new gi(s,1-P),new gi(O,1-F),new gi(q,1-ee),new gi(fe,1-ae)]}};function Zee(i,e,o){if(o.shapes=[],Array.isArray(i))for(let h=0,l=i.length;h<l;h++){const f=i[h];o.shapes.push(f.uuid)}else o.shapes.push(i.uuid);return e.extrudePath!==void 0&&(o.options.extrudePath=e.extrudePath.toJSON()),o}function ST(i,e,o){_r.call(this),this.type="ParametricGeometry",this.parameters={func:i,slices:e,stacks:o};const h=[],l=[],f=[],x=[],s=1e-5,P=new He,C=new He,O=new He,F=new He,V=new He;i.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const q=e+1;for(let ee=0;ee<=o;ee++){const se=ee/o;for(let fe=0;fe<=e;fe++){const ae=fe/e;i(ae,se,C),l.push(C.x,C.y,C.z),ae-s>=0?(i(ae-s,se,O),F.subVectors(C,O)):(i(ae+s,se,O),F.subVectors(O,C)),se-s>=0?(i(ae,se-s,O),V.subVectors(C,O)):(i(ae,se+s,O),V.subVectors(O,C)),P.crossVectors(F,V).normalize(),f.push(P.x,P.y,P.z),x.push(ae,se)}}for(let ee=0;ee<o;ee++)for(let se=0;se<e;se++){const fe=ee*q+se,ae=ee*q+se+1,ie=(ee+1)*q+se+1,tt=(ee+1)*q+se;h.push(fe,ae,tt),h.push(ae,ie,tt)}this.setIndex(h),this.setAttribute("position",new Or(l,3)),this.setAttribute("normal",new Or(f,3)),this.setAttribute("uv",new Or(x,2))}ST.prototype=Object.create(_r.prototype);ST.prototype.constructor=ST;class Wee extends _r{constructor(e,o=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:o};const h=[],l=[],f=[],x=[];let s=0,P=0;if(Array.isArray(e)===!1)C(e);else for(let O=0;O<e.length;O++)C(e[O]),this.addGroup(s,P,O),s+=P,P=0;this.setIndex(h),this.setAttribute("position",new Or(l,3)),this.setAttribute("normal",new Or(f,3)),this.setAttribute("uv",new Or(x,2));function C(O){const F=l.length/3,V=O.extractPoints(o);let q=V.shape;const ee=V.holes;sd.isClockWise(q)===!1&&(q=q.reverse());for(let fe=0,ae=ee.length;fe<ae;fe++){const ie=ee[fe];sd.isClockWise(ie)===!0&&(ee[fe]=ie.reverse())}const se=sd.triangulateShape(q,ee);for(let fe=0,ae=ee.length;fe<ae;fe++){const ie=ee[fe];q=q.concat(ie)}for(let fe=0,ae=q.length;fe<ae;fe++){const ie=q[fe];l.push(ie.x,ie.y,0),f.push(0,0,1),x.push(ie.x,ie.y)}for(let fe=0,ae=se.length;fe<ae;fe++){const ie=se[fe],tt=ie[0]+F,Ue=ie[1]+F,Ne=ie[2]+F;h.push(tt,Ue,Ne),P+=3}}}toJSON(){const e=_r.prototype.toJSON.call(this),o=this.parameters.shapes;return qee(o,e)}}function qee(i,e){if(e.shapes=[],Array.isArray(i))for(let o=0,h=i.length;o<h;o++){const l=i[o];e.shapes.push(l.uuid)}else e.shapes.push(i.uuid);return e}class Xee extends fo{constructor(e){super(),this.type="ShadowMaterial",this.color=new mn(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}Xee.prototype.isShadowMaterial=!0;class Jee extends Xa{constructor(e){super(e),this.type="RawShaderMaterial"}}Jee.prototype.isRawShaderMaterial=!0;function Wu(i){fo.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new mn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new gi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(i)}Wu.prototype=Object.create(fo.prototype);Wu.prototype.constructor=Wu;Wu.prototype.isMeshStandardMaterial=!0;Wu.prototype.copy=function(i){return fo.prototype.copy.call(this,i),this.defines={STANDARD:""},this.color.copy(i.color),this.roughness=i.roughness,this.metalness=i.metalness,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.roughnessMap=i.roughnessMap,this.metalnessMap=i.metalnessMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.envMapIntensity=i.envMapIntensity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.flatShading=i.flatShading,this.vertexTangents=i.vertexTangents,this};function Ep(i){Wu.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new gi(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Bn.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(i)}Ep.prototype=Object.create(Wu.prototype);Ep.prototype.constructor=Ep;Ep.prototype.isMeshPhysicalMaterial=!0;Ep.prototype.copy=function(i){return Wu.prototype.copy.call(this,i),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=i.clearcoat,this.clearcoatMap=i.clearcoatMap,this.clearcoatRoughness=i.clearcoatRoughness,this.clearcoatRoughnessMap=i.clearcoatRoughnessMap,this.clearcoatNormalMap=i.clearcoatNormalMap,this.clearcoatNormalScale.copy(i.clearcoatNormalScale),this.reflectivity=i.reflectivity,i.sheen?this.sheen=(this.sheen||new mn).copy(i.sheen):this.sheen=null,this.transmission=i.transmission,this.transmissionMap=i.transmissionMap,this};class ic extends fo{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new mn(16777215),this.specular=new mn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new gi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=iw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}ic.prototype.isMeshPhongMaterial=!0;class Yee extends fo{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new mn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new gi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}Yee.prototype.isMeshToonMaterial=!0;class Kee extends fo{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new gi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}Kee.prototype.isMeshNormalMaterial=!0;class Qee extends fo{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new mn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=iw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}Qee.prototype.isMeshLambertMaterial=!0;class ete extends fo{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new mn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new gi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}ete.prototype.isMeshMatcapMaterial=!0;class tte extends gy{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}tte.prototype.isLineDashedMaterial=!0;const Qr={arraySlice:function(i,e,o){return Qr.isTypedArray(i)?new i.constructor(i.subarray(e,o!==void 0?o:i.length)):i.slice(e,o)},convertArray:function(i,e,o){return!i||!o&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){function e(l,f){return i[l]-i[f]}const o=i.length,h=new Array(o);for(let l=0;l!==o;++l)h[l]=l;return h.sort(e),h},sortedArray:function(i,e,o){const h=i.length,l=new i.constructor(h);for(let f=0,x=0;x!==h;++f){const s=o[f]*e;for(let P=0;P!==e;++P)l[x++]=i[s+P]}return l},flattenJSON:function(i,e,o,h){let l=1,f=i[0];for(;f!==void 0&&f[h]===void 0;)f=i[l++];if(f===void 0)return;let x=f[h];if(x!==void 0)if(Array.isArray(x))do x=f[h],x!==void 0&&(e.push(f.time),o.push.apply(o,x)),f=i[l++];while(f!==void 0);else if(x.toArray!==void 0)do x=f[h],x!==void 0&&(e.push(f.time),x.toArray(o,o.length)),f=i[l++];while(f!==void 0);else do x=f[h],x!==void 0&&(e.push(f.time),o.push(x)),f=i[l++];while(f!==void 0)},subclip:function(i,e,o,h,l=30){const f=i.clone();f.name=e;const x=[];for(let P=0;P<f.tracks.length;++P){const C=f.tracks[P],O=C.getValueSize(),F=[],V=[];for(let q=0;q<C.times.length;++q){const ee=C.times[q]*l;if(!(ee<o||ee>=h)){F.push(C.times[q]);for(let se=0;se<O;++se)V.push(C.values[q*O+se])}}F.length!==0&&(C.times=Qr.convertArray(F,C.times.constructor),C.values=Qr.convertArray(V,C.values.constructor),x.push(C))}f.tracks=x;let s=1/0;for(let P=0;P<f.tracks.length;++P)s>f.tracks[P].times[0]&&(s=f.tracks[P].times[0]);for(let P=0;P<f.tracks.length;++P)f.tracks[P].shift(-1*s);return f.resetDuration(),f},makeClipAdditive:function(i,e=0,o=i,h=30){h<=0&&(h=30);const l=o.tracks.length,f=e/h;for(let x=0;x<l;++x){const s=o.tracks[x],P=s.ValueTypeName;if(P==="bool"||P==="string")continue;const C=i.tracks.find(function(ae){return ae.name===s.name&&ae.ValueTypeName===P});if(C===void 0)continue;let O=0;const F=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(O=F/3);let V=0;const q=C.getValueSize();C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(V=q/3);const ee=s.times.length-1;let se;if(f<=s.times[0]){const ae=O,ie=F-O;se=Qr.arraySlice(s.values,ae,ie)}else if(f>=s.times[ee]){const ae=ee*F+O,ie=ae+F-O;se=Qr.arraySlice(s.values,ae,ie)}else{const ae=s.createInterpolant(),ie=O,tt=F-O;ae.evaluate(f),se=Qr.arraySlice(ae.resultBuffer,ie,tt)}P==="quaternion"&&new Xs().fromArray(se).normalize().conjugate().toArray(se);const fe=C.times.length;for(let ae=0;ae<fe;++ae){const ie=ae*q+V;if(P==="quaternion")Xs.multiplyQuaternionsFlat(C.values,ie,se,0,C.values,ie);else{const tt=q-V*2;for(let Ue=0;Ue<tt;++Ue)C.values[ie+Ue]-=se[Ue]}}}return i.blendMode=ZB,i}};function Za(i,e,o,h){this.parameterPositions=i,this._cachedIndex=0,this.resultBuffer=h!==void 0?h:new e.constructor(o),this.sampleValues=e,this.valueSize=o}Object.assign(Za.prototype,{evaluate:function(i){const e=this.parameterPositions;let o=this._cachedIndex,h=e[o],l=e[o-1];e:{t:{let f;i:{n:if(!(i<h)){for(let x=o+2;;){if(h===void 0){if(i<l)break n;return o=e.length,this._cachedIndex=o,this.afterEnd_(o-1,i,l)}if(o===x)break;if(l=h,h=e[++o],i<h)break t}f=e.length;break i}if(!(i>=l)){const x=e[1];i<x&&(o=2,l=x);for(let s=o-2;;){if(l===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,h);if(o===s)break;if(h=l,l=e[--o-1],i>=l)break t}f=o,o=0;break i}break e}for(;o<f;){const x=o+f>>>1;i<e[x]?f=x:o=x+1}if(h=e[o],l=e[o-1],l===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,h);if(h===void 0)return o=e.length,this._cachedIndex=o,this.afterEnd_(o-1,l,i)}this._cachedIndex=o,this.intervalChanged_(o,l,h)}return this.interpolate_(o,l,i,h)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(i){const e=this.resultBuffer,o=this.sampleValues,h=this.valueSize,l=i*h;for(let f=0;f!==h;++f)e[f]=o[l+f];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});Object.assign(Za.prototype,{beforeStart_:Za.prototype.copySampleValue_,afterEnd_:Za.prototype.copySampleValue_});function TT(i,e,o,h){Za.call(this,i,e,o,h),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}TT.prototype=Object.assign(Object.create(Za.prototype),{constructor:TT,DefaultSettings_:{endingStart:lp,endingEnd:lp},intervalChanged_:function(i,e,o){const h=this.parameterPositions;let l=i-2,f=i+1,x=h[l],s=h[f];if(x===void 0)switch(this.getSettings_().endingStart){case cp:l=i,x=2*e-o;break;case Z0:l=h.length-2,x=e+h[l]-h[l+1];break;default:l=i,x=o}if(s===void 0)switch(this.getSettings_().endingEnd){case cp:f=i,s=2*o-e;break;case Z0:f=1,s=o+h[1]-h[0];break;default:f=i-1,s=e}const P=(o-e)*.5,C=this.valueSize;this._weightPrev=P/(e-x),this._weightNext=P/(s-o),this._offsetPrev=l*C,this._offsetNext=f*C},interpolate_:function(i,e,o,h){const l=this.resultBuffer,f=this.sampleValues,x=this.valueSize,s=i*x,P=s-x,C=this._offsetPrev,O=this._offsetNext,F=this._weightPrev,V=this._weightNext,q=(o-e)/(h-e),ee=q*q,se=ee*q,fe=-F*se+2*F*ee-F*q,ae=(1+F)*se+(-1.5-2*F)*ee+(-.5+F)*q+1,ie=(-1-V)*se+(1.5+V)*ee+.5*q,tt=V*se-V*ee;for(let Ue=0;Ue!==x;++Ue)l[Ue]=fe*f[C+Ue]+ae*f[P+Ue]+ie*f[s+Ue]+tt*f[O+Ue];return l}});function X0(i,e,o,h){Za.call(this,i,e,o,h)}X0.prototype=Object.assign(Object.create(Za.prototype),{constructor:X0,interpolate_:function(i,e,o,h){const l=this.resultBuffer,f=this.sampleValues,x=this.valueSize,s=i*x,P=s-x,C=(o-e)/(h-e),O=1-C;for(let F=0;F!==x;++F)l[F]=f[P+F]*O+f[s+F]*C;return l}});function ET(i,e,o,h){Za.call(this,i,e,o,h)}ET.prototype=Object.assign(Object.create(Za.prototype),{constructor:ET,interpolate_:function(i){return this.copySampleValue_(i-1)}});class ac{constructor(e,o,h,l){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(o===void 0||o.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Qr.convertArray(o,this.TimeBufferType),this.values=Qr.convertArray(h,this.ValueBufferType),this.setInterpolation(l||this.DefaultInterpolation)}static toJSON(e){const o=e.constructor;let h;if(o.toJSON!==this.toJSON)h=o.toJSON(e);else{h={name:e.name,times:Qr.convertArray(e.times,Array),values:Qr.convertArray(e.values,Array)};const l=e.getInterpolation();l!==e.DefaultInterpolation&&(h.interpolation=l)}return h.type=e.ValueTypeName,h}InterpolantFactoryMethodDiscrete(e){return new ET(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new X0(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new TT(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let o;switch(e){case G0:o=this.InterpolantFactoryMethodDiscrete;break;case H0:o=this.InterpolantFactoryMethodLinear;break;case bS:o=this.InterpolantFactoryMethodSmooth;break}if(o===void 0){const h="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(h);return console.warn("THREE.KeyframeTrack:",h),this}return this.createInterpolant=o,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return G0;case this.InterpolantFactoryMethodLinear:return H0;case this.InterpolantFactoryMethodSmooth:return bS}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const o=this.times;for(let h=0,l=o.length;h!==l;++h)o[h]+=e}return this}scale(e){if(e!==1){const o=this.times;for(let h=0,l=o.length;h!==l;++h)o[h]*=e}return this}trim(e,o){const h=this.times,l=h.length;let f=0,x=l-1;for(;f!==l&&h[f]<e;)++f;for(;x!==-1&&h[x]>o;)--x;if(++x,f!==0||x!==l){f>=x&&(x=Math.max(x,1),f=x-1);const s=this.getValueSize();this.times=Qr.arraySlice(h,f,x),this.values=Qr.arraySlice(this.values,f*s,x*s)}return this}validate(){let e=!0;const o=this.getValueSize();o-Math.floor(o)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const h=this.times,l=this.values,f=h.length;f===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let x=null;for(let s=0;s!==f;s++){const P=h[s];if(typeof P=="number"&&isNaN(P)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,P),e=!1;break}if(x!==null&&x>P){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,P,x),e=!1;break}x=P}if(l!==void 0&&Qr.isTypedArray(l))for(let s=0,P=l.length;s!==P;++s){const C=l[s];if(isNaN(C)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,C),e=!1;break}}return e}optimize(){const e=Qr.arraySlice(this.times),o=Qr.arraySlice(this.values),h=this.getValueSize(),l=this.getInterpolation()===bS,f=e.length-1;let x=1;for(let s=1;s<f;++s){let P=!1;const C=e[s],O=e[s+1];if(C!==O&&(s!==1||C!==e[0]))if(l)P=!0;else{const F=s*h,V=F-h,q=F+h;for(let ee=0;ee!==h;++ee){const se=o[F+ee];if(se!==o[V+ee]||se!==o[q+ee]){P=!0;break}}}if(P){if(s!==x){e[x]=e[s];const F=s*h,V=x*h;for(let q=0;q!==h;++q)o[V+q]=o[F+q]}++x}}if(f>0){e[x]=e[f];for(let s=f*h,P=x*h,C=0;C!==h;++C)o[P+C]=o[s+C];++x}return x!==e.length?(this.times=Qr.arraySlice(e,0,x),this.values=Qr.arraySlice(o,0,x*h)):(this.times=e,this.values=o),this}clone(){const e=Qr.arraySlice(this.times,0),o=Qr.arraySlice(this.values,0),h=this.constructor,l=new h(this.name,e,o);return l.createInterpolant=this.createInterpolant,l}}ac.prototype.TimeBufferType=Float32Array;ac.prototype.ValueBufferType=Float32Array;ac.prototype.DefaultInterpolation=H0;class Op extends ac{}Op.prototype.ValueTypeName="bool";Op.prototype.ValueBufferType=Array;Op.prototype.DefaultInterpolation=G0;Op.prototype.InterpolantFactoryMethodLinear=void 0;Op.prototype.InterpolantFactoryMethodSmooth=void 0;class v4 extends ac{}v4.prototype.ValueTypeName="color";class J0 extends ac{}J0.prototype.ValueTypeName="number";function IT(i,e,o,h){Za.call(this,i,e,o,h)}IT.prototype=Object.assign(Object.create(Za.prototype),{constructor:IT,interpolate_:function(i,e,o,h){const l=this.resultBuffer,f=this.sampleValues,x=this.valueSize,s=(o-e)/(h-e);let P=i*x;for(let C=P+x;P!==C;P+=4)Xs.slerpFlat(l,0,f,P-x,f,P,s);return l}});class _y extends ac{InterpolantFactoryMethodLinear(e){return new IT(this.times,this.values,this.getValueSize(),e)}}_y.prototype.ValueTypeName="quaternion";_y.prototype.DefaultInterpolation=H0;_y.prototype.InterpolantFactoryMethodSmooth=void 0;class Fp extends ac{}Fp.prototype.ValueTypeName="string";Fp.prototype.ValueBufferType=Array;Fp.prototype.DefaultInterpolation=G0;Fp.prototype.InterpolantFactoryMethodLinear=void 0;Fp.prototype.InterpolantFactoryMethodSmooth=void 0;class Y0 extends ac{}Y0.prototype.ValueTypeName="vector";class UL{constructor(e,o=-1,h,l=u2){this.name=e,this.tracks=h,this.duration=o,this.blendMode=l,this.uuid=Bn.generateUUID(),this.duration<0&&this.resetDuration()}static parse(e){const o=[],h=e.tracks,l=1/(e.fps||1);for(let x=0,s=h.length;x!==s;++x)o.push(nte(h[x]).scale(l));const f=new this(e.name,e.duration,o,e.blendMode);return f.uuid=e.uuid,f}static toJSON(e){const o=[],h=e.tracks,l={name:e.name,duration:e.duration,tracks:o,uuid:e.uuid,blendMode:e.blendMode};for(let f=0,x=h.length;f!==x;++f)o.push(ac.toJSON(h[f]));return l}static CreateFromMorphTargetSequence(e,o,h,l){const f=o.length,x=[];for(let s=0;s<f;s++){let P=[],C=[];P.push((s+f-1)%f,s,(s+1)%f),C.push(0,1,0);const O=Qr.getKeyframeOrder(P);P=Qr.sortedArray(P,1,O),C=Qr.sortedArray(C,1,O),!l&&P[0]===0&&(P.push(f),C.push(C[0])),x.push(new J0(".morphTargetInfluences["+o[s].name+"]",P,C).scale(1/h))}return new this(e,-1,x)}static findByName(e,o){let h=e;if(!Array.isArray(e)){const l=e;h=l.geometry&&l.geometry.animations||l.animations}for(let l=0;l<h.length;l++)if(h[l].name===o)return h[l];return null}static CreateClipsFromMorphTargetSequences(e,o,h){const l={},f=/^([\w-]*?)([\d]+)$/;for(let s=0,P=e.length;s<P;s++){const C=e[s],O=C.name.match(f);if(O&&O.length>1){const F=O[1];let V=l[F];V||(l[F]=V=[]),V.push(C)}}const x=[];for(const s in l)x.push(this.CreateFromMorphTargetSequence(s,l[s],o,h));return x}static parseAnimation(e,o){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const h=function(F,V,q,ee,se){if(q.length!==0){const fe=[],ae=[];Qr.flattenJSON(q,fe,ae,ee),fe.length!==0&&se.push(new F(V,fe,ae))}},l=[],f=e.name||"default",x=e.fps||30,s=e.blendMode;let P=e.length||-1;const C=e.hierarchy||[];for(let F=0;F<C.length;F++){const V=C[F].keys;if(!(!V||V.length===0))if(V[0].morphTargets){const q={};let ee;for(ee=0;ee<V.length;ee++)if(V[ee].morphTargets)for(let se=0;se<V[ee].morphTargets.length;se++)q[V[ee].morphTargets[se]]=-1;for(const se in q){const fe=[],ae=[];for(let ie=0;ie!==V[ee].morphTargets.length;++ie){const tt=V[ee];fe.push(tt.time),ae.push(tt.morphTarget===se?1:0)}l.push(new J0(".morphTargetInfluence["+se+"]",fe,ae))}P=q.length*x}else{const q=".bones["+o[F].name+"]";h(Y0,q+".position",V,"pos",l),h(_y,q+".quaternion",V,"rot",l),h(Y0,q+".scale",V,"scl",l)}}return l.length===0?null:new this(f,P,l,s)}resetDuration(){const e=this.tracks;let o=0;for(let h=0,l=e.length;h!==l;++h){const f=this.tracks[h];o=Math.max(o,f.times[f.times.length-1])}return this.duration=o,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let o=0;o<this.tracks.length;o++)e=e&&this.tracks[o].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let o=0;o<this.tracks.length;o++)e.push(this.tracks[o].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ite(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return J0;case"vector":case"vector2":case"vector3":case"vector4":return Y0;case"color":return v4;case"quaternion":return _y;case"bool":case"boolean":return Op;case"string":return Fp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function nte(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=ite(i.type);if(i.times===void 0){const o=[],h=[];Qr.flattenJSON(i.keys,o,h,"value"),i.times=o,i.values=h}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const Ip={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};function rte(i,e,o){const h=this;let l=!1,f=0,x=0,s;const P=[];this.onStart=void 0,this.onLoad=i,this.onProgress=e,this.onError=o,this.itemStart=function(C){x++,l===!1&&h.onStart!==void 0&&h.onStart(C,f,x),l=!0},this.itemEnd=function(C){f++,h.onProgress!==void 0&&h.onProgress(C,f,x),f===x&&(l=!1,h.onLoad!==void 0&&h.onLoad())},this.itemError=function(C){h.onError!==void 0&&h.onError(C)},this.resolveURL=function(C){return s?s(C):C},this.setURLModifier=function(C){return s=C,this},this.addHandler=function(C,O){return P.push(C,O),this},this.removeHandler=function(C){const O=P.indexOf(C);return O!==-1&&P.splice(O,2),this},this.getHandler=function(C){for(let O=0,F=P.length;O<F;O+=2){const V=P[O],q=P[O+1];if(V.global&&(V.lastIndex=0),V.test(C))return q}return null}}const ote=new rte;function Js(i){this.manager=i!==void 0?i:ote,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Js.prototype,{load:function(){},loadAsync:function(i,e){const o=this;return new Promise(function(h,l){o.load(i,h,e,l)})},parse:function(){},setCrossOrigin:function(i){return this.crossOrigin=i,this},setWithCredentials:function(i){return this.withCredentials=i,this},setPath:function(i){return this.path=i,this},setResourcePath:function(i){return this.resourcePath=i,this},setRequestHeader:function(i){return this.requestHeader=i,this}});const wl={};function K0(i){Js.call(this,i)}K0.prototype=Object.assign(Object.create(Js.prototype),{constructor:K0,load:function(i,e,o,h){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const l=this,f=Ip.get(i);if(f!==void 0)return l.manager.itemStart(i),setTimeout(function(){e&&e(f),l.manager.itemEnd(i)},0),f;if(wl[i]!==void 0){wl[i].push({onLoad:e,onProgress:o,onError:h});return}const x=/^data:(.*?)(;base64)?,(.*)$/,s=i.match(x);let P;if(s){const C=s[1],O=!!s[2];let F=s[3];F=decodeURIComponent(F),O&&(F=atob(F));try{let V;const q=(this.responseType||"").toLowerCase();switch(q){case"arraybuffer":case"blob":const ee=new Uint8Array(F.length);for(let fe=0;fe<F.length;fe++)ee[fe]=F.charCodeAt(fe);q==="blob"?V=new Blob([ee.buffer],{type:C}):V=ee.buffer;break;case"document":V=new DOMParser().parseFromString(F,C);break;case"json":V=JSON.parse(F);break;default:V=F;break}setTimeout(function(){e&&e(V),l.manager.itemEnd(i)},0)}catch(V){setTimeout(function(){h&&h(V),l.manager.itemError(i),l.manager.itemEnd(i)},0)}}else{wl[i]=[],wl[i].push({onLoad:e,onProgress:o,onError:h}),P=new XMLHttpRequest,P.open("GET",i,!0),P.addEventListener("load",function(C){const O=this.response,F=wl[i];if(delete wl[i],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Ip.add(i,O);for(let V=0,q=F.length;V<q;V++){const ee=F[V];ee.onLoad&&ee.onLoad(O)}l.manager.itemEnd(i)}else{for(let V=0,q=F.length;V<q;V++){const ee=F[V];ee.onError&&ee.onError(C)}l.manager.itemError(i),l.manager.itemEnd(i)}},!1),P.addEventListener("progress",function(C){const O=wl[i];for(let F=0,V=O.length;F<V;F++){const q=O[F];q.onProgress&&q.onProgress(C)}},!1),P.addEventListener("error",function(C){const O=wl[i];delete wl[i];for(let F=0,V=O.length;F<V;F++){const q=O[F];q.onError&&q.onError(C)}l.manager.itemError(i),l.manager.itemEnd(i)},!1),P.addEventListener("abort",function(C){const O=wl[i];delete wl[i];for(let F=0,V=O.length;F<V;F++){const q=O[F];q.onError&&q.onError(C)}l.manager.itemError(i),l.manager.itemEnd(i)},!1),this.responseType!==void 0&&(P.responseType=this.responseType),this.withCredentials!==void 0&&(P.withCredentials=this.withCredentials),P.overrideMimeType&&P.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const C in this.requestHeader)P.setRequestHeader(C,this.requestHeader[C]);P.send(null)}return l.manager.itemStart(i),P},setResponseType:function(i){return this.responseType=i,this},setMimeType:function(i){return this.mimeType=i,this}});function $L(i){Js.call(this,i)}$L.prototype=Object.assign(Object.create(Js.prototype),{constructor:$L,load:function(i,e,o,h){const l=this,f=[],x=new m4,s=new K0(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(l.withCredentials);let P=0;function C(O){s.load(i[O],function(F){const V=l.parse(F,!0);f[O]={width:V.width,height:V.height,format:V.format,mipmaps:V.mipmaps},P+=1,P===6&&(V.mipmapCount===1&&(x.minFilter=ds),x.image=f,x.format=V.format,x.needsUpdate=!0,e&&e(x))},o,h)}if(Array.isArray(i))for(let O=0,F=i.length;O<F;++O)C(O);else s.load(i,function(O){const F=l.parse(O,!0);if(F.isCubemap){const V=F.mipmaps.length/F.mipmapCount;for(let q=0;q<V;q++){f[q]={mipmaps:[]};for(let ee=0;ee<F.mipmapCount;ee++)f[q].mipmaps.push(F.mipmaps[q*F.mipmapCount+ee]),f[q].format=F.format,f[q].width=F.width,f[q].height=F.height}x.image=f}else x.image.width=F.width,x.image.height=F.height,x.mipmaps=F.mipmaps;F.mipmapCount===1&&(x.minFilter=ds),x.format=F.format,x.needsUpdate=!0,e&&e(x)},o,h);return x}});class x4 extends Js{constructor(e){super(e)}load(e,o,h,l){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const f=this,x=Ip.get(e);if(x!==void 0)return f.manager.itemStart(e),setTimeout(function(){o&&o(x),f.manager.itemEnd(e)},0),x;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function P(){s.removeEventListener("load",P,!1),s.removeEventListener("error",C,!1),Ip.add(e,this),o&&o(this),f.manager.itemEnd(e)}function C(O){s.removeEventListener("load",P,!1),s.removeEventListener("error",C,!1),l&&l(O),f.manager.itemError(e),f.manager.itemEnd(e)}return s.addEventListener("load",P,!1),s.addEventListener("error",C,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),f.manager.itemStart(e),s.src=e,s}}class ste extends Js{constructor(e){super(e)}load(e,o,h,l){const f=new ow,x=new x4(this.manager);x.setCrossOrigin(this.crossOrigin),x.setPath(this.path);let s=0;function P(C){x.load(e[C],function(O){f.images[C]=O,s++,s===6&&(f.needsUpdate=!0,o&&o(f))},void 0,l)}for(let C=0;C<e.length;++C)P(C);return f}}function VL(i){Js.call(this,i)}VL.prototype=Object.assign(Object.create(Js.prototype),{constructor:VL,load:function(i,e,o,h){const l=this,f=new f2,x=new K0(this.manager);return x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(l.withCredentials),x.load(i,function(s){const P=l.parse(s);P&&(P.image!==void 0?f.image=P.image:P.data!==void 0&&(f.image.width=P.width,f.image.height=P.height,f.image.data=P.data),f.wrapS=P.wrapS!==void 0?P.wrapS:wa,f.wrapT=P.wrapT!==void 0?P.wrapT:wa,f.magFilter=P.magFilter!==void 0?P.magFilter:ds,f.minFilter=P.minFilter!==void 0?P.minFilter:ds,f.anisotropy=P.anisotropy!==void 0?P.anisotropy:1,P.encoding!==void 0&&(f.encoding=P.encoding),P.flipY!==void 0&&(f.flipY=P.flipY),P.format!==void 0&&(f.format=P.format),P.type!==void 0&&(f.type=P.type),P.mipmaps!==void 0&&(f.mipmaps=P.mipmaps,f.minFilter=nw),P.mipmapCount===1&&(f.minFilter=ds),f.needsUpdate=!0,e&&e(f,P))},o,h),f}});function MT(i){Js.call(this,i)}MT.prototype=Object.assign(Object.create(Js.prototype),{constructor:MT,load:function(i,e,o,h){const l=new ps,f=new x4(this.manager);return f.setCrossOrigin(this.crossOrigin),f.setPath(this.path),f.load(i,function(x){l.image=x;const s=i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0;l.format=s?rd:El,l.needsUpdate=!0,e!==void 0&&e(l)},o,h),l}});function la(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(la.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(i,e){const o=this.getUtoTmapping(i);return this.getPoint(o,e)},getPoints:function(i=5){const e=[];for(let o=0;o<=i;o++)e.push(this.getPoint(o/i));return e},getSpacedPoints:function(i=5){const e=[];for(let o=0;o<=i;o++)e.push(this.getPointAt(o/i));return e},getLength:function(){const i=this.getLengths();return i[i.length-1]},getLengths:function(i){if(i===void 0&&(i=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===i+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let o,h=this.getPoint(0),l=0;e.push(0);for(let f=1;f<=i;f++)o=this.getPoint(f/i),l+=o.distanceTo(h),e.push(l),h=o;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(i,e){const o=this.getLengths();let h=0;const l=o.length;let f;e?f=e:f=i*o[l-1];let x=0,s=l-1,P;for(;x<=s;)if(h=Math.floor(x+(s-x)/2),P=o[h]-f,P<0)x=h+1;else if(P>0)s=h-1;else{s=h;break}if(h=s,o[h]===f)return h/(l-1);const C=o[h],F=o[h+1]-C,V=(f-C)/F;return(h+V)/(l-1)},getTangent:function(i,e){let h=i-1e-4,l=i+1e-4;h<0&&(h=0),l>1&&(l=1);const f=this.getPoint(h),x=this.getPoint(l),s=e||(f.isVector2?new gi:new He);return s.copy(x).sub(f).normalize(),s},getTangentAt:function(i,e){const o=this.getUtoTmapping(i);return this.getTangent(o,e)},computeFrenetFrames:function(i,e){const o=new He,h=[],l=[],f=[],x=new He,s=new nn;for(let V=0;V<=i;V++){const q=V/i;h[V]=this.getTangentAt(q,new He),h[V].normalize()}l[0]=new He,f[0]=new He;let P=Number.MAX_VALUE;const C=Math.abs(h[0].x),O=Math.abs(h[0].y),F=Math.abs(h[0].z);C<=P&&(P=C,o.set(1,0,0)),O<=P&&(P=O,o.set(0,1,0)),F<=P&&o.set(0,0,1),x.crossVectors(h[0],o).normalize(),l[0].crossVectors(h[0],x),f[0].crossVectors(h[0],l[0]);for(let V=1;V<=i;V++){if(l[V]=l[V-1].clone(),f[V]=f[V-1].clone(),x.crossVectors(h[V-1],h[V]),x.length()>Number.EPSILON){x.normalize();const q=Math.acos(Bn.clamp(h[V-1].dot(h[V]),-1,1));l[V].applyMatrix4(s.makeRotationAxis(x,q))}f[V].crossVectors(h[V],l[V])}if(e===!0){let V=Math.acos(Bn.clamp(l[0].dot(l[i]),-1,1));V/=i,h[0].dot(x.crossVectors(l[0],l[i]))>0&&(V=-V);for(let q=1;q<=i;q++)l[q].applyMatrix4(s.makeRotationAxis(h[q],V*q)),f[q].crossVectors(h[q],l[q])}return{tangents:h,normals:l,binormals:f}},clone:function(){return new this.constructor().copy(this)},copy:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this},toJSON:function(){const i={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return i.arcLengthDivisions=this.arcLengthDivisions,i.type=this.type,i},fromJSON:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}});class cw extends la{constructor(e=0,o=0,h=1,l=1,f=0,x=Math.PI*2,s=!1,P=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=o,this.xRadius=h,this.yRadius=l,this.aStartAngle=f,this.aEndAngle=x,this.aClockwise=s,this.aRotation=P}getPoint(e,o){const h=o||new gi,l=Math.PI*2;let f=this.aEndAngle-this.aStartAngle;const x=Math.abs(f)<Number.EPSILON;for(;f<0;)f+=l;for(;f>l;)f-=l;f<Number.EPSILON&&(x?f=0:f=l),this.aClockwise===!0&&!x&&(f===l?f=-l:f=f-l);const s=this.aStartAngle+e*f;let P=this.aX+this.xRadius*Math.cos(s),C=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){const O=Math.cos(this.aRotation),F=Math.sin(this.aRotation),V=P-this.aX,q=C-this.aY;P=V*O-q*F+this.aX,C=V*F+q*O+this.aY}return h.set(P,C)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}cw.prototype.isEllipseCurve=!0;class b4 extends cw{constructor(e,o,h,l,f,x){super(e,o,h,h,l,f,x),this.type="ArcCurve"}}b4.prototype.isArcCurve=!0;function m2(){let i=0,e=0,o=0,h=0;function l(f,x,s,P){i=f,e=s,o=-3*f+3*x-2*s-P,h=2*f-2*x+s+P}return{initCatmullRom:function(f,x,s,P,C){l(x,s,C*(s-f),C*(P-x))},initNonuniformCatmullRom:function(f,x,s,P,C,O,F){let V=(x-f)/C-(s-f)/(C+O)+(s-x)/O,q=(s-x)/O-(P-x)/(O+F)+(P-s)/F;V*=O,q*=O,l(x,s,V,q)},calc:function(f){const x=f*f,s=x*f;return i+e*f+o*x+h*s}}}const w0=new He,WS=new m2,qS=new m2,XS=new m2;class w4 extends la{constructor(e=[],o=!1,h="centripetal",l=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=o,this.curveType=h,this.tension=l}getPoint(e,o=new He){const h=o,l=this.points,f=l.length,x=(f-(this.closed?0:1))*e;let s=Math.floor(x),P=x-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/f)+1)*f:P===0&&s===f-1&&(s=f-2,P=1);let C,O;this.closed||s>0?C=l[(s-1)%f]:(w0.subVectors(l[0],l[1]).add(l[0]),C=w0);const F=l[s%f],V=l[(s+1)%f];if(this.closed||s+2<f?O=l[(s+2)%f]:(w0.subVectors(l[f-1],l[f-2]).add(l[f-1]),O=w0),this.curveType==="centripetal"||this.curveType==="chordal"){const q=this.curveType==="chordal"?.5:.25;let ee=Math.pow(C.distanceToSquared(F),q),se=Math.pow(F.distanceToSquared(V),q),fe=Math.pow(V.distanceToSquared(O),q);se<1e-4&&(se=1),ee<1e-4&&(ee=se),fe<1e-4&&(fe=se),WS.initNonuniformCatmullRom(C.x,F.x,V.x,O.x,ee,se,fe),qS.initNonuniformCatmullRom(C.y,F.y,V.y,O.y,ee,se,fe),XS.initNonuniformCatmullRom(C.z,F.z,V.z,O.z,ee,se,fe)}else this.curveType==="catmullrom"&&(WS.initCatmullRom(C.x,F.x,V.x,O.x,this.tension),qS.initCatmullRom(C.y,F.y,V.y,O.y,this.tension),XS.initCatmullRom(C.z,F.z,V.z,O.z,this.tension));return h.set(WS.calc(P),qS.calc(P),XS.calc(P)),h}copy(e){super.copy(e),this.points=[];for(let o=0,h=e.points.length;o<h;o++){const l=e.points[o];this.points.push(l.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let o=0,h=this.points.length;o<h;o++){const l=this.points[o];e.points.push(l.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let o=0,h=e.points.length;o<h;o++){const l=e.points[o];this.points.push(new He().fromArray(l))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}w4.prototype.isCatmullRomCurve3=!0;function jL(i,e,o,h,l){const f=(h-e)*.5,x=(l-o)*.5,s=i*i,P=i*s;return(2*o-2*h+f+x)*P+(-3*o+3*h-2*f-x)*s+f*i+o}function ate(i,e){const o=1-i;return o*o*e}function lte(i,e){return 2*(1-i)*i*e}function cte(i,e){return i*i*e}function m_(i,e,o,h){return ate(i,e)+lte(i,o)+cte(i,h)}function ute(i,e){const o=1-i;return o*o*o*e}function hte(i,e){const o=1-i;return 3*o*o*i*e}function dte(i,e){return 3*(1-i)*i*i*e}function fte(i,e){return i*i*i*e}function g_(i,e,o,h,l){return ute(i,e)+hte(i,o)+dte(i,h)+fte(i,l)}class g2 extends la{constructor(e=new gi,o=new gi,h=new gi,l=new gi){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=o,this.v2=h,this.v3=l}getPoint(e,o=new gi){const h=o,l=this.v0,f=this.v1,x=this.v2,s=this.v3;return h.set(g_(e,l.x,f.x,x.x,s.x),g_(e,l.y,f.y,x.y,s.y)),h}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}g2.prototype.isCubicBezierCurve=!0;class S4 extends la{constructor(e=new He,o=new He,h=new He,l=new He){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=o,this.v2=h,this.v3=l}getPoint(e,o=new He){const h=o,l=this.v0,f=this.v1,x=this.v2,s=this.v3;return h.set(g_(e,l.x,f.x,x.x,s.x),g_(e,l.y,f.y,x.y,s.y),g_(e,l.z,f.z,x.z,s.z)),h}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}S4.prototype.isCubicBezierCurve3=!0;class uw extends la{constructor(e=new gi,o=new gi){super(),this.type="LineCurve",this.v1=e,this.v2=o}getPoint(e,o=new gi){const h=o;return e===1?h.copy(this.v2):(h.copy(this.v2).sub(this.v1),h.multiplyScalar(e).add(this.v1)),h}getPointAt(e,o){return this.getPoint(e,o)}getTangent(e,o){const h=o||new gi;return h.copy(this.v2).sub(this.v1).normalize(),h}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}uw.prototype.isLineCurve=!0;class pte extends la{constructor(e=new He,o=new He){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=o}getPoint(e,o=new He){const h=o;return e===1?h.copy(this.v2):(h.copy(this.v2).sub(this.v1),h.multiplyScalar(e).add(this.v1)),h}getPointAt(e,o){return this.getPoint(e,o)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class _2 extends la{constructor(e=new gi,o=new gi,h=new gi){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=o,this.v2=h}getPoint(e,o=new gi){const h=o,l=this.v0,f=this.v1,x=this.v2;return h.set(m_(e,l.x,f.x,x.x),m_(e,l.y,f.y,x.y)),h}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}_2.prototype.isQuadraticBezierCurve=!0;class T4 extends la{constructor(e=new He,o=new He,h=new He){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=o,this.v2=h}getPoint(e,o=new He){const h=o,l=this.v0,f=this.v1,x=this.v2;return h.set(m_(e,l.x,f.x,x.x),m_(e,l.y,f.y,x.y),m_(e,l.z,f.z,x.z)),h}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}T4.prototype.isQuadraticBezierCurve3=!0;class y2 extends la{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,o=new gi){const h=o,l=this.points,f=(l.length-1)*e,x=Math.floor(f),s=f-x,P=l[x===0?x:x-1],C=l[x],O=l[x>l.length-2?l.length-1:x+1],F=l[x>l.length-3?l.length-1:x+2];return h.set(jL(s,P.x,C.x,O.x,F.x),jL(s,P.y,C.y,O.y,F.y)),h}copy(e){super.copy(e),this.points=[];for(let o=0,h=e.points.length;o<h;o++){const l=e.points[o];this.points.push(l.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let o=0,h=this.points.length;o<h;o++){const l=this.points[o];e.points.push(l.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let o=0,h=e.points.length;o<h;o++){const l=e.points[o];this.points.push(new gi().fromArray(l))}return this}}y2.prototype.isSplineCurve=!0;var mte=Object.freeze({__proto__:null,ArcCurve:b4,CatmullRomCurve3:w4,CubicBezierCurve:g2,CubicBezierCurve3:S4,EllipseCurve:cw,LineCurve:uw,LineCurve3:pte,QuadraticBezierCurve:_2,QuadraticBezierCurve3:T4,SplineCurve:y2});class gte extends la{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),o=this.curves[this.curves.length-1].getPoint(1);e.equals(o)||this.curves.push(new uw(o,e))}getPoint(e){const o=e*this.getLength(),h=this.getCurveLengths();let l=0;for(;l<h.length;){if(h[l]>=o){const f=h[l]-o,x=this.curves[l],s=x.getLength(),P=s===0?0:1-f/s;return x.getPointAt(P)}l++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let o=0;for(let h=0,l=this.curves.length;h<l;h++)o+=this.curves[h].getLength(),e.push(o);return this.cacheLengths=e,e}getSpacedPoints(e=40){const o=[];for(let h=0;h<=e;h++)o.push(this.getPoint(h/e));return this.autoClose&&o.push(o[0]),o}getPoints(e=12){const o=[];let h;for(let l=0,f=this.curves;l<f.length;l++){const x=f[l],s=x&&x.isEllipseCurve?e*2:x&&(x.isLineCurve||x.isLineCurve3)?1:x&&x.isSplineCurve?e*x.points.length:e,P=x.getPoints(s);for(let C=0;C<P.length;C++){const O=P[C];h&&h.equals(O)||(o.push(O),h=O)}}return this.autoClose&&o.length>1&&!o[o.length-1].equals(o[0])&&o.push(o[0]),o}copy(e){super.copy(e),this.curves=[];for(let o=0,h=e.curves.length;o<h;o++){const l=e.curves[o];this.curves.push(l.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let o=0,h=this.curves.length;o<h;o++){const l=this.curves[o];e.curves.push(l.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let o=0,h=e.curves.length;o<h;o++){const l=e.curves[o];this.curves.push(new mte[l.type]().fromJSON(l))}return this}}class AT extends gte{constructor(e){super(),this.type="Path",this.currentPoint=new gi,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let o=1,h=e.length;o<h;o++)this.lineTo(e[o].x,e[o].y);return this}moveTo(e,o){return this.currentPoint.set(e,o),this}lineTo(e,o){const h=new uw(this.currentPoint.clone(),new gi(e,o));return this.curves.push(h),this.currentPoint.set(e,o),this}quadraticCurveTo(e,o,h,l){const f=new _2(this.currentPoint.clone(),new gi(e,o),new gi(h,l));return this.curves.push(f),this.currentPoint.set(h,l),this}bezierCurveTo(e,o,h,l,f,x){const s=new g2(this.currentPoint.clone(),new gi(e,o),new gi(h,l),new gi(f,x));return this.curves.push(s),this.currentPoint.set(f,x),this}splineThru(e){const o=[this.currentPoint.clone()].concat(e),h=new y2(o);return this.curves.push(h),this.currentPoint.copy(e[e.length-1]),this}arc(e,o,h,l,f,x){const s=this.currentPoint.x,P=this.currentPoint.y;return this.absarc(e+s,o+P,h,l,f,x),this}absarc(e,o,h,l,f,x){return this.absellipse(e,o,h,h,l,f,x),this}ellipse(e,o,h,l,f,x,s,P){const C=this.currentPoint.x,O=this.currentPoint.y;return this.absellipse(e+C,o+O,h,l,f,x,s,P),this}absellipse(e,o,h,l,f,x,s,P){const C=new cw(e,o,h,l,f,x,s,P);if(this.curves.length>0){const F=C.getPoint(0);F.equals(this.currentPoint)||this.lineTo(F.x,F.y)}this.curves.push(C);const O=C.getPoint(1);return this.currentPoint.copy(O),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class v2 extends AT{constructor(e){super(e),this.uuid=Bn.generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(e){const o=[];for(let h=0,l=this.holes.length;h<l;h++)o[h]=this.holes[h].getPoints(e);return o}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let o=0,h=e.holes.length;o<h;o++){const l=e.holes[o];this.holes.push(l.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let o=0,h=this.holes.length;o<h;o++){const l=this.holes[o];e.holes.push(l.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let o=0,h=e.holes.length;o<h;o++){const l=e.holes[o];this.holes.push(new AT().fromJSON(l))}return this}}class sc extends Dn{constructor(e,o=1){super(),this.type="Light",this.color=new mn(e),this.intensity=o}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const o=super.toJSON(e);return o.object.color=this.color.getHex(),o.object.intensity=this.intensity,this.groundColor!==void 0&&(o.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(o.object.distance=this.distance),this.angle!==void 0&&(o.object.angle=this.angle),this.decay!==void 0&&(o.object.decay=this.decay),this.penumbra!==void 0&&(o.object.penumbra=this.penumbra),this.shadow!==void 0&&(o.object.shadow=this.shadow.toJSON()),o}}sc.prototype.isLight=!0;class _te extends sc{constructor(e,o,h){super(e,h),this.type="HemisphereLight",this.position.copy(Dn.DefaultUp),this.updateMatrix(),this.groundColor=new mn(o)}copy(e){return sc.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}_te.prototype.isHemisphereLight=!0;const GL=new nn,HL=new He,ZL=new He;class x2{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new gi(512,512),this.map=null,this.mapPass=null,this.matrix=new nn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new sw,this._frameExtents=new gi(1,1),this._viewportCount=1,this._viewports=[new Lr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const o=this.camera,h=this.matrix;HL.setFromMatrixPosition(e.matrixWorld),o.position.copy(HL),ZL.setFromMatrixPosition(e.target.matrixWorld),o.lookAt(ZL),o.updateMatrixWorld(),GL.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this._frustum.setFromProjectionMatrix(GL),h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(o.projectionMatrix),h.multiply(o.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class E4 extends x2{constructor(){super(new Ws(50,1,.5,500)),this.focus=1}updateMatrices(e){const o=this.camera,h=Bn.RAD2DEG*2*e.angle*this.focus,l=this.mapSize.width/this.mapSize.height,f=e.distance||o.far;(h!==o.fov||l!==o.aspect||f!==o.far)&&(o.fov=h,o.aspect=l,o.far=f,o.updateProjectionMatrix()),super.updateMatrices(e)}}E4.prototype.isSpotLightShadow=!0;class yte extends sc{constructor(e,o,h=0,l=Math.PI/3,f=0,x=1){super(e,o),this.type="SpotLight",this.position.copy(Dn.DefaultUp),this.updateMatrix(),this.target=new Dn,this.distance=h,this.angle=l,this.penumbra=f,this.decay=x,this.shadow=new E4}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}yte.prototype.isSpotLight=!0;const WL=new nn,o_=new He,JS=new He;class I4 extends x2{constructor(){super(new Ws(90,1,.5,500)),this._frameExtents=new gi(4,2),this._viewportCount=6,this._viewports=[new Lr(2,1,1,1),new Lr(0,1,1,1),new Lr(3,1,1,1),new Lr(1,1,1,1),new Lr(3,0,1,1),new Lr(1,0,1,1)],this._cubeDirections=[new He(1,0,0),new He(-1,0,0),new He(0,0,1),new He(0,0,-1),new He(0,1,0),new He(0,-1,0)],this._cubeUps=[new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,0,1),new He(0,0,-1)]}updateMatrices(e,o=0){const h=this.camera,l=this.matrix;o_.setFromMatrixPosition(e.matrixWorld),h.position.copy(o_),JS.copy(h.position),JS.add(this._cubeDirections[o]),h.up.copy(this._cubeUps[o]),h.lookAt(JS),h.updateMatrixWorld(),l.makeTranslation(-o_.x,-o_.y,-o_.z),WL.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),this._frustum.setFromProjectionMatrix(WL)}}I4.prototype.isPointLightShadow=!0;class M4 extends sc{constructor(e,o,h=0,l=1){super(e,o),this.type="PointLight",this.distance=h,this.decay=l,this.shadow=new I4}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}M4.prototype.isPointLight=!0;class A4 extends hd{constructor(e=-1,o=1,h=1,l=-1,f=.1,x=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=o,this.top=h,this.bottom=l,this.near=f,this.far=x,this.updateProjectionMatrix()}copy(e,o){return super.copy(e,o),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,o,h,l,f,x){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=o,this.view.offsetX=h,this.view.offsetY=l,this.view.width=f,this.view.height=x,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),o=(this.top-this.bottom)/(2*this.zoom),h=(this.right+this.left)/2,l=(this.top+this.bottom)/2;let f=h-e,x=h+e,s=l+o,P=l-o;if(this.view!==null&&this.view.enabled){const C=(this.right-this.left)/this.view.fullWidth/this.zoom,O=(this.top-this.bottom)/this.view.fullHeight/this.zoom;f+=C*this.view.offsetX,x=f+C*this.view.width,s-=O*this.view.offsetY,P=s-O*this.view.height}this.projectionMatrix.makeOrthographic(f,x,s,P,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const o=Dn.prototype.toJSON.call(this,e);return o.object.zoom=this.zoom,o.object.left=this.left,o.object.right=this.right,o.object.top=this.top,o.object.bottom=this.bottom,o.object.near=this.near,o.object.far=this.far,this.view!==null&&(o.object.view=Object.assign({},this.view)),o}}A4.prototype.isOrthographicCamera=!0;class P4 extends x2{constructor(){super(new A4(-5,5,5,-5,.5,500))}}P4.prototype.isDirectionalLightShadow=!0;class PT extends sc{constructor(e,o){super(e,o),this.type="DirectionalLight",this.position.copy(Dn.DefaultUp),this.updateMatrix(),this.target=new Dn,this.shadow=new P4}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}PT.prototype.isDirectionalLight=!0;class z4 extends sc{constructor(e,o){super(e,o),this.type="AmbientLight"}}z4.prototype.isAmbientLight=!0;class vte extends sc{constructor(e,o,h=10,l=10){super(e,o),this.type="RectAreaLight",this.width=h,this.height=l}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const o=super.toJSON(e);return o.object.width=this.width,o.object.height=this.height,o}}vte.prototype.isRectAreaLight=!0;class C4{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new He)}set(e){for(let o=0;o<9;o++)this.coefficients[o].copy(e[o]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,o){const h=e.x,l=e.y,f=e.z,x=this.coefficients;return o.copy(x[0]).multiplyScalar(.282095),o.addScaledVector(x[1],.488603*l),o.addScaledVector(x[2],.488603*f),o.addScaledVector(x[3],.488603*h),o.addScaledVector(x[4],1.092548*(h*l)),o.addScaledVector(x[5],1.092548*(l*f)),o.addScaledVector(x[6],.315392*(3*f*f-1)),o.addScaledVector(x[7],1.092548*(h*f)),o.addScaledVector(x[8],.546274*(h*h-l*l)),o}getIrradianceAt(e,o){const h=e.x,l=e.y,f=e.z,x=this.coefficients;return o.copy(x[0]).multiplyScalar(.886227),o.addScaledVector(x[1],2*.511664*l),o.addScaledVector(x[2],2*.511664*f),o.addScaledVector(x[3],2*.511664*h),o.addScaledVector(x[4],2*.429043*h*l),o.addScaledVector(x[5],2*.429043*l*f),o.addScaledVector(x[6],.743125*f*f-.247708),o.addScaledVector(x[7],2*.429043*h*f),o.addScaledVector(x[8],.429043*(h*h-l*l)),o}add(e){for(let o=0;o<9;o++)this.coefficients[o].add(e.coefficients[o]);return this}addScaledSH(e,o){for(let h=0;h<9;h++)this.coefficients[h].addScaledVector(e.coefficients[h],o);return this}scale(e){for(let o=0;o<9;o++)this.coefficients[o].multiplyScalar(e);return this}lerp(e,o){for(let h=0;h<9;h++)this.coefficients[h].lerp(e.coefficients[h],o);return this}equals(e){for(let o=0;o<9;o++)if(!this.coefficients[o].equals(e.coefficients[o]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,o=0){const h=this.coefficients;for(let l=0;l<9;l++)h[l].fromArray(e,o+l*3);return this}toArray(e=[],o=0){const h=this.coefficients;for(let l=0;l<9;l++)h[l].toArray(e,o+l*3);return e}static getBasisAt(e,o){const h=e.x,l=e.y,f=e.z;o[0]=.282095,o[1]=.488603*l,o[2]=.488603*f,o[3]=.488603*h,o[4]=1.092548*h*l,o[5]=1.092548*l*f,o[6]=.315392*(3*f*f-1),o[7]=1.092548*h*f,o[8]=.546274*(h*h-l*l)}}C4.prototype.isSphericalHarmonics3=!0;class b2 extends sc{constructor(e=new C4,o=1){super(void 0,o),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const o=super.toJSON(e);return o.object.sh=this.sh.toArray(),o}}b2.prototype.isLightProbe=!0;const xte={decodeText:function(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let e="";for(let o=0,h=i.length;o<h;o++)e+=String.fromCharCode(i[o]);try{return decodeURIComponent(escape(e))}catch{return e}},extractUrlBase:function(i){const e=i.lastIndexOf("/");return e===-1?"./":i.substr(0,e+1)}};function zT(){_r.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}zT.prototype=Object.assign(Object.create(_r.prototype),{constructor:zT,isInstancedBufferGeometry:!0,copy:function(i){return _r.prototype.copy.call(this,i),this.instanceCount=i.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const i=_r.prototype.toJSON.call(this);return i.instanceCount=this.instanceCount,i.isInstancedBufferGeometry=!0,i}});function qL(i,e,o,h){typeof o=="number"&&(h=o,o=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),qn.call(this,i,e,o),this.meshPerAttribute=h||1}qL.prototype=Object.assign(Object.create(qn.prototype),{constructor:qL,isInstancedBufferAttribute:!0,copy:function(i){return qn.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},toJSON:function(){const i=qn.prototype.toJSON.call(this);return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}});function XL(i){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Js.call(this,i),this.options={premultiplyAlpha:"none"}}XL.prototype=Object.assign(Object.create(Js.prototype),{constructor:XL,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(i,e,o,h){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const l=this,f=Ip.get(i);if(f!==void 0)return l.manager.itemStart(i),setTimeout(function(){e&&e(f),l.manager.itemEnd(i)},0),f;const x={};x.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",x.headers=this.requestHeader,fetch(i,x).then(function(s){return s.blob()}).then(function(s){return createImageBitmap(s,Object.assign(l.options,{colorSpaceConversion:"none"}))}).then(function(s){Ip.add(i,s),e&&e(s),l.manager.itemEnd(i)}).catch(function(s){h&&h(s),l.manager.itemError(i),l.manager.itemEnd(i)}),l.manager.itemStart(i)}});class bte extends b2{constructor(e,o,h=1){super(void 0,h);const l=new mn().set(e),f=new mn().set(o),x=new He(l.r,l.g,l.b),s=new He(f.r,f.g,f.b),P=Math.sqrt(Math.PI),C=P*Math.sqrt(.75);this.sh.coefficients[0].copy(x).add(s).multiplyScalar(P),this.sh.coefficients[1].copy(x).sub(s).multiplyScalar(C)}}bte.prototype.isHemisphereLightProbe=!0;class wte extends b2{constructor(e,o=1){super(void 0,o);const h=new mn().set(e);this.sh.coefficients[0].set(h.r,h.g,h.b).multiplyScalar(2*Math.sqrt(Math.PI))}}wte.prototype.isAmbientLightProbe=!0;new nn;new nn;class Ste{constructor(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=JL(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const o=JL();e=(o-this.oldTime)/1e3,this.oldTime=o,this.elapsedTime+=e}return e}}function JL(){return(typeof performance>"u"?Date:performance).now()}class Tte{constructor(e,o,h){this.binding=e,this.valueSize=h;let l,f,x;switch(o){case"quaternion":l=this._slerp,f=this._slerpAdditive,x=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(h*6),this._workIndex=5;break;case"string":case"bool":l=this._select,f=this._select,x=this._setAdditiveIdentityOther,this.buffer=new Array(h*5);break;default:l=this._lerp,f=this._lerpAdditive,x=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(h*5)}this._mixBufferRegion=l,this._mixBufferRegionAdditive=f,this._setIdentity=x,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,o){const h=this.buffer,l=this.valueSize,f=e*l+l;let x=this.cumulativeWeight;if(x===0){for(let s=0;s!==l;++s)h[f+s]=h[s];x=o}else{x+=o;const s=o/x;this._mixBufferRegion(h,f,0,s,l)}this.cumulativeWeight=x}accumulateAdditive(e){const o=this.buffer,h=this.valueSize,l=h*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(o,l,0,e,h),this.cumulativeWeightAdditive+=e}apply(e){const o=this.valueSize,h=this.buffer,l=e*o+o,f=this.cumulativeWeight,x=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,f<1){const P=o*this._origIndex;this._mixBufferRegion(h,l,P,1-f,o)}x>0&&this._mixBufferRegionAdditive(h,l,this._addIndex*o,1,o);for(let P=o,C=o+o;P!==C;++P)if(h[P]!==h[P+o]){s.setValue(h,l);break}}saveOriginalState(){const e=this.binding,o=this.buffer,h=this.valueSize,l=h*this._origIndex;e.getValue(o,l);for(let f=h,x=l;f!==x;++f)o[f]=o[l+f%h];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,o=e+this.valueSize;for(let h=e;h<o;h++)this.buffer[h]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,o=this._addIndex*this.valueSize;for(let h=0;h<this.valueSize;h++)this.buffer[o+h]=this.buffer[e+h]}_select(e,o,h,l,f){if(l>=.5)for(let x=0;x!==f;++x)e[o+x]=e[h+x]}_slerp(e,o,h,l){Xs.slerpFlat(e,o,e,o,e,h,l)}_slerpAdditive(e,o,h,l,f){const x=this._workIndex*f;Xs.multiplyQuaternionsFlat(e,x,e,o,e,h),Xs.slerpFlat(e,o,e,o,e,x,l)}_lerp(e,o,h,l,f){const x=1-l;for(let s=0;s!==f;++s){const P=o+s;e[P]=e[P]*x+e[h+s]*l}}_lerpAdditive(e,o,h,l,f){for(let x=0;x!==f;++x){const s=o+x;e[s]=e[s]+e[h+x]*l}}}const w2="\\[\\]\\.:\\/",Ete=new RegExp("["+w2+"]","g"),S2="[^"+w2+"]",Ite="[^"+w2.replace("\\.","")+"]",Mte=/((?:WC+[\/:])*)/.source.replace("WC",S2),Ate=/(WCOD+)?/.source.replace("WCOD",Ite),Pte=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",S2),zte=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",S2),Cte=new RegExp("^"+Mte+Ate+Pte+zte+"$"),Lte=["material","materials","bones"];function L4(i,e,o){const h=o||Wa.parseTrackName(e);this._targetGroup=i,this._bindings=i.subscribe_(e,h)}Object.assign(L4.prototype,{getValue:function(i,e){this.bind();const o=this._targetGroup.nCachedObjects_,h=this._bindings[o];h!==void 0&&h.getValue(i,e)},setValue:function(i,e){const o=this._bindings;for(let h=this._targetGroup.nCachedObjects_,l=o.length;h!==l;++h)o[h].setValue(i,e)},bind:function(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,o=i.length;e!==o;++e)i[e].bind()},unbind:function(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,o=i.length;e!==o;++e)i[e].unbind()}});function Wa(i,e,o){this.path=e,this.parsedPath=o||Wa.parseTrackName(e),this.node=Wa.findNode(i,this.parsedPath.nodeName)||i,this.rootNode=i}Object.assign(Wa,{Composite:L4,create:function(i,e,o){return i&&i.isAnimationObjectGroup?new Wa.Composite(i,e,o):new Wa(i,e,o)},sanitizeNodeName:function(i){return i.replace(/\s/g,"_").replace(Ete,"")},parseTrackName:function(i){const e=Cte.exec(i);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+i);const o={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},h=o.nodeName&&o.nodeName.lastIndexOf(".");if(h!==void 0&&h!==-1){const l=o.nodeName.substring(h+1);Lte.indexOf(l)!==-1&&(o.nodeName=o.nodeName.substring(0,h),o.objectName=l)}if(o.propertyName===null||o.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return o},findNode:function(i,e){if(!e||e===""||e==="."||e===-1||e===i.name||e===i.uuid)return i;if(i.skeleton){const o=i.skeleton.getBoneByName(e);if(o!==void 0)return o}if(i.children){const o=function(l){for(let f=0;f<l.length;f++){const x=l[f];if(x.name===e||x.uuid===e)return x;const s=o(x.children);if(s)return s}return null},h=o(i.children);if(h)return h}return null}});Object.assign(Wa.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,o){e[o]=this.node[this.propertyName]},function(e,o){const h=this.resolvedProperty;for(let l=0,f=h.length;l!==f;++l)e[o++]=h[l]},function(e,o){e[o]=this.resolvedProperty[this.propertyIndex]},function(e,o){this.resolvedProperty.toArray(e,o)}],SetterByBindingTypeAndVersioning:[[function(e,o){this.targetObject[this.propertyName]=e[o]},function(e,o){this.targetObject[this.propertyName]=e[o],this.targetObject.needsUpdate=!0},function(e,o){this.targetObject[this.propertyName]=e[o],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,o){const h=this.resolvedProperty;for(let l=0,f=h.length;l!==f;++l)h[l]=e[o++]},function(e,o){const h=this.resolvedProperty;for(let l=0,f=h.length;l!==f;++l)h[l]=e[o++];this.targetObject.needsUpdate=!0},function(e,o){const h=this.resolvedProperty;for(let l=0,f=h.length;l!==f;++l)h[l]=e[o++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,o){this.resolvedProperty[this.propertyIndex]=e[o]},function(e,o){this.resolvedProperty[this.propertyIndex]=e[o],this.targetObject.needsUpdate=!0},function(e,o){this.resolvedProperty[this.propertyIndex]=e[o],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,o){this.resolvedProperty.fromArray(e,o)},function(e,o){this.resolvedProperty.fromArray(e,o),this.targetObject.needsUpdate=!0},function(e,o){this.resolvedProperty.fromArray(e,o),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,o){this.bind(),this.getValue(e,o)},setValue:function(e,o){this.bind(),this.setValue(e,o)},bind:function(){let i=this.node;const e=this.parsedPath,o=e.objectName,h=e.propertyName;let l=e.propertyIndex;if(i||(i=Wa.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!i){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(o){let P=e.objectIndex;switch(o){case"materials":if(!i.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!i.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}i=i.material.materials;break;case"bones":if(!i.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}i=i.skeleton.bones;for(let C=0;C<i.length;C++)if(i[C].name===P){P=C;break}break;default:if(i[o]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}i=i[o]}if(P!==void 0){if(i[P]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);return}i=i[P]}}const f=i[h];if(f===void 0){const P=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+P+"."+h+" but it wasn't found.",i);return}let x=this.Versioning.None;this.targetObject=i,i.needsUpdate!==void 0?x=this.Versioning.NeedsUpdate:i.matrixWorldNeedsUpdate!==void 0&&(x=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(l!==void 0){if(h==="morphTargetInfluences"){if(!i.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(i.geometry.isBufferGeometry){if(!i.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}i.morphTargetDictionary[l]!==void 0&&(l=i.morphTargetDictionary[l])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}s=this.BindingType.ArrayElement,this.resolvedProperty=f,this.propertyIndex=l}else f.fromArray!==void 0&&f.toArray!==void 0?(s=this.BindingType.HasFromToArray,this.resolvedProperty=f):Array.isArray(f)?(s=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=h;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][x]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});Object.assign(Wa.prototype,{_getValue_unbound:Wa.prototype.getValue,_setValue_unbound:Wa.prototype.setValue});class Rte{constructor(e,o,h=null,l=o.blendMode){this._mixer=e,this._clip=o,this._localRoot=h,this.blendMode=l;const f=o.tracks,x=f.length,s=new Array(x),P={endingStart:lp,endingEnd:lp};for(let C=0;C!==x;++C){const O=f[C].createInterpolant(null);s[C]=O,O.settings=P}this._interpolantSettings=P,this._interpolants=s,this._propertyBindings=new Array(x),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=HX,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,o){return this.loop=e,this.repetitions=o,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,o,h){if(e.fadeOut(o),this.fadeIn(o),h){const l=this._clip.duration,f=e._clip.duration,x=f/l,s=l/f;e.warp(1,x,o),this.warp(s,1,o)}return this}crossFadeTo(e,o,h){return e.crossFadeFrom(this,o,h)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,o,h){const l=this._mixer,f=l.time,x=this.timeScale;let s=this._timeScaleInterpolant;s===null&&(s=l._lendControlInterpolant(),this._timeScaleInterpolant=s);const P=s.parameterPositions,C=s.sampleValues;return P[0]=f,P[1]=f+h,C[0]=e/x,C[1]=o/x,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,o,h,l){if(!this.enabled){this._updateWeight(e);return}const f=this._startTime;if(f!==null){const P=(e-f)*h;if(P<0||h===0)return;this._startTime=null,o=h*P}o*=this._updateTimeScale(e);const x=this._updateTime(o),s=this._updateWeight(e);if(s>0){const P=this._interpolants,C=this._propertyBindings;switch(this.blendMode){case ZB:for(let O=0,F=P.length;O!==F;++O)P[O].evaluate(x),C[O].accumulateAdditive(s);break;case u2:default:for(let O=0,F=P.length;O!==F;++O)P[O].evaluate(x),C[O].accumulate(l,s)}}}_updateWeight(e){let o=0;if(this.enabled){o=this.weight;const h=this._weightInterpolant;if(h!==null){const l=h.evaluate(e)[0];o*=l,e>h.parameterPositions[1]&&(this.stopFading(),l===0&&(this.enabled=!1))}}return this._effectiveWeight=o,o}_updateTimeScale(e){let o=0;if(!this.paused){o=this.timeScale;const h=this._timeScaleInterpolant;if(h!==null){const l=h.evaluate(e)[0];o*=l,e>h.parameterPositions[1]&&(this.stopWarping(),o===0?this.paused=!0:this.timeScale=o)}}return this._effectiveTimeScale=o,o}_updateTime(e){const o=this._clip.duration,h=this.loop;let l=this.time+e,f=this._loopCount;const x=h===ZX;if(e===0)return f===-1?l:x&&(f&1)===1?o-l:l;if(h===GX){f===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(l>=o)l=o;else if(l<0)l=0;else{this.time=l;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=l,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(f===-1&&(e>=0?(f=0,this._setEndings(!0,this.repetitions===0,x)):this._setEndings(this.repetitions===0,!0,x)),l>=o||l<0){const s=Math.floor(l/o);l-=o*s,f+=Math.abs(s);const P=this.repetitions-f;if(P<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,l=e>0?o:0,this.time=l,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(P===1){const C=e<0;this._setEndings(C,!C,x)}else this._setEndings(!1,!1,x);this._loopCount=f,this.time=l,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}else this.time=l;if(x&&(f&1)===1)return o-l}return l}_setEndings(e,o,h){const l=this._interpolantSettings;h?(l.endingStart=cp,l.endingEnd=cp):(e?l.endingStart=this.zeroSlopeAtStart?cp:lp:l.endingStart=Z0,o?l.endingEnd=this.zeroSlopeAtEnd?cp:lp:l.endingEnd=Z0)}_scheduleFading(e,o,h){const l=this._mixer,f=l.time;let x=this._weightInterpolant;x===null&&(x=l._lendControlInterpolant(),this._weightInterpolant=x);const s=x.parameterPositions,P=x.sampleValues;return s[0]=f,P[0]=o,s[1]=f+e,P[1]=h,this}}class Dte extends Yu{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,o){const h=e._localRoot||this._root,l=e._clip.tracks,f=l.length,x=e._propertyBindings,s=e._interpolants,P=h.uuid,C=this._bindingsByRootAndName;let O=C[P];O===void 0&&(O={},C[P]=O);for(let F=0;F!==f;++F){const V=l[F],q=V.name;let ee=O[q];if(ee!==void 0)x[F]=ee;else{if(ee=x[F],ee!==void 0){ee._cacheIndex===null&&(++ee.referenceCount,this._addInactiveBinding(ee,P,q));continue}const se=o&&o._propertyBindings[F].binding.parsedPath;ee=new Tte(Wa.create(h,q,se),V.ValueTypeName,V.getValueSize()),++ee.referenceCount,this._addInactiveBinding(ee,P,q),x[F]=ee}s[F].resultBuffer=ee.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const h=(e._localRoot||this._root).uuid,l=e._clip.uuid,f=this._actionsByClip[l];this._bindAction(e,f&&f.knownActions[0]),this._addInactiveAction(e,l,h)}const o=e._propertyBindings;for(let h=0,l=o.length;h!==l;++h){const f=o[h];f.useCount++===0&&(this._lendBinding(f),f.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const o=e._propertyBindings;for(let h=0,l=o.length;h!==l;++h){const f=o[h];--f.useCount===0&&(f.restoreOriginalState(),this._takeBackBinding(f))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const o=e._cacheIndex;return o!==null&&o<this._nActiveActions}_addInactiveAction(e,o,h){const l=this._actions,f=this._actionsByClip;let x=f[o];if(x===void 0)x={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,f[o]=x;else{const s=x.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=l.length,l.push(e),x.actionByRoot[h]=e}_removeInactiveAction(e){const o=this._actions,h=o[o.length-1],l=e._cacheIndex;h._cacheIndex=l,o[l]=h,o.pop(),e._cacheIndex=null;const f=e._clip.uuid,x=this._actionsByClip,s=x[f],P=s.knownActions,C=P[P.length-1],O=e._byClipCacheIndex;C._byClipCacheIndex=O,P[O]=C,P.pop(),e._byClipCacheIndex=null;const F=s.actionByRoot,V=(e._localRoot||this._root).uuid;delete F[V],P.length===0&&delete x[f],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const o=e._propertyBindings;for(let h=0,l=o.length;h!==l;++h){const f=o[h];--f.referenceCount===0&&this._removeInactiveBinding(f)}}_lendAction(e){const o=this._actions,h=e._cacheIndex,l=this._nActiveActions++,f=o[l];e._cacheIndex=l,o[l]=e,f._cacheIndex=h,o[h]=f}_takeBackAction(e){const o=this._actions,h=e._cacheIndex,l=--this._nActiveActions,f=o[l];e._cacheIndex=l,o[l]=e,f._cacheIndex=h,o[h]=f}_addInactiveBinding(e,o,h){const l=this._bindingsByRootAndName,f=this._bindings;let x=l[o];x===void 0&&(x={},l[o]=x),x[h]=e,e._cacheIndex=f.length,f.push(e)}_removeInactiveBinding(e){const o=this._bindings,h=e.binding,l=h.rootNode.uuid,f=h.path,x=this._bindingsByRootAndName,s=x[l],P=o[o.length-1],C=e._cacheIndex;P._cacheIndex=C,o[C]=P,o.pop(),delete s[f],Object.keys(s).length===0&&delete x[l]}_lendBinding(e){const o=this._bindings,h=e._cacheIndex,l=this._nActiveBindings++,f=o[l];e._cacheIndex=l,o[l]=e,f._cacheIndex=h,o[h]=f}_takeBackBinding(e){const o=this._bindings,h=e._cacheIndex,l=--this._nActiveBindings,f=o[l];e._cacheIndex=l,o[l]=e,f._cacheIndex=h,o[h]=f}_lendControlInterpolant(){const e=this._controlInterpolants,o=this._nActiveControlInterpolants++;let h=e[o];return h===void 0&&(h=new X0(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),h.__cacheIndex=o,e[o]=h),h}_takeBackControlInterpolant(e){const o=this._controlInterpolants,h=e.__cacheIndex,l=--this._nActiveControlInterpolants,f=o[l];e.__cacheIndex=l,o[l]=e,f.__cacheIndex=h,o[h]=f}clipAction(e,o,h){const l=o||this._root,f=l.uuid;let x=typeof e=="string"?UL.findByName(l,e):e;const s=x!==null?x.uuid:e,P=this._actionsByClip[s];let C=null;if(h===void 0&&(x!==null?h=x.blendMode:h=u2),P!==void 0){const F=P.actionByRoot[f];if(F!==void 0&&F.blendMode===h)return F;C=P.knownActions[0],x===null&&(x=C._clip)}if(x===null)return null;const O=new Rte(this,x,o,h);return this._bindAction(O,C),this._addInactiveAction(O,s,f),O}existingAction(e,o){const h=o||this._root,l=h.uuid,f=typeof e=="string"?UL.findByName(h,e):e,x=f?f.uuid:e,s=this._actionsByClip[x];return s!==void 0&&s.actionByRoot[l]||null}stopAllAction(){const e=this._actions,o=this._nActiveActions;for(let h=o-1;h>=0;--h)e[h].stop();return this}update(e){e*=this.timeScale;const o=this._actions,h=this._nActiveActions,l=this.time+=e,f=Math.sign(e),x=this._accuIndex^=1;for(let C=0;C!==h;++C)o[C]._update(l,e,f,x);const s=this._bindings,P=this._nActiveBindings;for(let C=0;C!==P;++C)s[C].apply(x);return this}setTime(e){this.time=0;for(let o=0;o<this._actions.length;o++)this._actions[o].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const o=this._actions,h=e.uuid,l=this._actionsByClip,f=l[h];if(f!==void 0){const x=f.knownActions;for(let s=0,P=x.length;s!==P;++s){const C=x[s];this._deactivateAction(C);const O=C._cacheIndex,F=o[o.length-1];C._cacheIndex=null,C._byClipCacheIndex=null,F._cacheIndex=O,o[O]=F,o.pop(),this._removeInactiveBindingsForAction(C)}delete l[h]}}uncacheRoot(e){const o=e.uuid,h=this._actionsByClip;for(const x in h){const s=h[x].actionByRoot,P=s[o];P!==void 0&&(this._deactivateAction(P),this._removeInactiveAction(P))}const l=this._bindingsByRootAndName,f=l[o];if(f!==void 0)for(const x in f){const s=f[x];s.restoreOriginalState(),this._removeInactiveBinding(s)}}uncacheAction(e,o){const h=this.existingAction(e,o);h!==null&&(this._deactivateAction(h),this._removeInactiveAction(h))}}Dte.prototype._controlInterpolantsResultBuffer=new Float32Array(1);function YL(i,e,o){Ga.call(this,i,e),this.meshPerAttribute=o||1}YL.prototype=Object.assign(Object.create(Ga.prototype),{constructor:YL,isInstancedInterleavedBuffer:!0,copy:function(i){return Ga.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},clone:function(i){const e=Ga.prototype.clone.call(this,i);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(i){const e=Ga.prototype.toJSON.call(this,i);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}});function R4(i,e,o,h,l){this.buffer=i,this.type=e,this.itemSize=o,this.elementSize=h,this.count=l,this.version=0}Object.defineProperty(R4.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});Object.assign(R4.prototype,{isGLBufferAttribute:!0,setBuffer:function(i){return this.buffer=i,this},setType:function(i,e){return this.type=i,this.elementSize=e,this},setItemSize:function(i){return this.itemSize=i,this},setCount:function(i){return this.count=i,this}});function D4(i,e,o=0,h=1/0){this.ray=new gd(i,e),this.near=o,this.far=h,this.camera=null,this.layers=new qB,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function KL(i,e){return i.distance-e.distance}function CT(i,e,o,h){if(i.layers.test(e.layers)&&i.raycast(e,o),h===!0){const l=i.children;for(let f=0,x=l.length;f<x;f++)CT(l[f],e,o,!0)}}Object.assign(D4.prototype,{set:function(i,e){this.ray.set(i,e)},setFromCamera:function(i,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(i.x,i.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(i,e=!1,o=[]){return CT(i,this,o,e),o.sort(KL),o},intersectObjects:function(i,e=!1,o=[]){for(let h=0,l=i.length;h<l;h++)CT(i[h],this,o,e);return o.sort(KL),o}});function Q0(i){Dn.call(this),this.material=i,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Q0.prototype=Object.create(Dn.prototype);Q0.prototype.constructor=Q0;Q0.prototype.isImmediateRenderObject=!0;const Fu=new He,S0=new nn,YS=new nn;class kte extends q0{constructor(e){const o=k4(e),h=new _r,l=[],f=[],x=new mn(0,0,1),s=new mn(0,1,0);for(let C=0;C<o.length;C++){const O=o[C];O.parent&&O.parent.isBone&&(l.push(0,0,0),l.push(0,0,0),f.push(x.r,x.g,x.b),f.push(s.r,s.g,s.b))}h.setAttribute("position",new Or(l,3)),h.setAttribute("color",new Or(f,3));const P=new gy({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(h,P),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=o,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const o=this.bones,h=this.geometry,l=h.getAttribute("position");YS.copy(this.root.matrixWorld).invert();for(let f=0,x=0;f<o.length;f++){const s=o[f];s.parent&&s.parent.isBone&&(S0.multiplyMatrices(YS,s.matrixWorld),Fu.setFromMatrixPosition(S0),l.setXYZ(x,Fu.x,Fu.y,Fu.z),S0.multiplyMatrices(YS,s.parent.matrixWorld),Fu.setFromMatrixPosition(S0),l.setXYZ(x+1,Fu.x,Fu.y,Fu.z),x+=2)}h.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function k4(i){const e=[];i&&i.isBone&&e.push(i);for(let o=0;o<i.children.length;o++)e.push.apply(e,k4(i.children[o]));return e}class Ote extends q0{constructor(e=10,o=10,h=4473924,l=8947848){h=new mn(h),l=new mn(l);const f=o/2,x=e/o,s=e/2,P=[],C=[];for(let V=0,q=0,ee=-s;V<=o;V++,ee+=x){P.push(-s,0,ee,s,0,ee),P.push(ee,0,-s,ee,0,s);const se=V===f?h:l;se.toArray(C,q),q+=3,se.toArray(C,q),q+=3,se.toArray(C,q),q+=3,se.toArray(C,q),q+=3}const O=new _r;O.setAttribute("position",new Or(P,3)),O.setAttribute("color",new Or(C,3));const F=new gy({vertexColors:!0,toneMapped:!1});super(O,F),this.type="GridHelper"}}const Fte=new Float32Array(1);new Int32Array(Fte.buffer);const Bte=new h2({side:Yo,depthWrite:!1,depthTest:!1});new lr(new Jo,Bte);la.create=function(i,e){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(la.prototype),i.prototype.constructor=i,i.prototype.getPoint=e,i};AT.prototype.fromPoints=function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)};Ote.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};kte.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Js.prototype.extractUrlBase=function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),xte.extractUrlBase(i)};Js.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};tl.prototype.center=function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)};tl.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};tl.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};tl.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};tl.prototype.size=function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)};Rp.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};sw.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)};Bn.random16=function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()};Bn.nearestPowerOfTwo=function(i){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Bn.floorPowerOfTwo(i)};Bn.nextPowerOfTwo=function(i){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Bn.ceilPowerOfTwo(i)};fs.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};fs.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};fs.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};fs.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};fs.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};fs.prototype.getInverse=function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};nn.prototype.extractPosition=function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)};nn.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};nn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new He().setFromMatrixColumn(this,3)};nn.prototype.setRotationFromQuaternion=function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)};nn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};nn.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};nn.prototype.multiplyVector4=function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};nn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};nn.prototype.rotateAxis=function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)};nn.prototype.crossVector=function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};nn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};nn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};nn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};nn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};nn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};nn.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};nn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};nn.prototype.makeFrustum=function(i,e,o,h,l,f){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,e,h,o,l,f)};nn.prototype.getInverse=function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};nc.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)};Xs.prototype.multiplyVector3=function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)};Xs.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};gd.prototype.isIntersectionBox=function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};gd.prototype.isIntersectionPlane=function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)};gd.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};Oo.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Oo.prototype.barycoordFromPoint=function(i,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,e)};Oo.prototype.midpoint=function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)};Oo.prototypenormal=function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)};Oo.prototype.plane=function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)};Oo.barycoordFromPoint=function(i,e,o,h,l){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Oo.getBarycoord(i,e,o,h,l)};Oo.normal=function(i,e,o,h){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Oo.getNormal(i,e,o,h)};v2.prototype.extractAllPoints=function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)};v2.prototype.extrude=function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new lw(this,i)};v2.prototype.makeGeometry=function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Wee(this,i)};gi.prototype.fromAttribute=function(i,e,o){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,o)};gi.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};gi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};He.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};He.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};He.prototype.getPositionFromMatrix=function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)};He.prototype.getScaleFromMatrix=function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)};He.prototype.getColumnFromMatrix=function(i,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,i)};He.prototype.applyProjection=function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)};He.prototype.fromAttribute=function(i,e,o){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,o)};He.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};He.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Lr.prototype.fromAttribute=function(i,e,o){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,o)};Lr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Dn.prototype.getChildByName=function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)};Dn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Dn.prototype.translate=function(i,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,i)};Dn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Dn.prototype.applyMatrix=function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(Dn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});lr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(lr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),WX},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});vT.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(la.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(i){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=i}});Ws.prototype.setLens=function(i,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(i)};Object.defineProperties(sc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}});Object.defineProperties(qn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===z_},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(z_)}}});qn.prototype.setDynamic=function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?z_:rw),this};qn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},qn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};_r.prototype.addIndex=function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)};_r.prototype.addAttribute=function(i,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new qn(arguments[1],arguments[2]))):i==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(i,e)};_r.prototype.addDrawCall=function(i,e,o){o!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,e)};_r.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};_r.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};_r.prototype.removeAttribute=function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)};_r.prototype.applyMatrix=function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(_r.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Object.defineProperties(zT.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(i){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=i}}});Object.defineProperties(D4.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(i){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=i}}});Object.defineProperties(Ga.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===z_},set:function(i){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(i)}}});Ga.prototype.setDynamic=function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?z_:rw),this};Ga.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};lw.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};lw.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};lw.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};p2.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(fo.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new mn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===VB}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}}});Object.defineProperties(ic.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Ep.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(i){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=i}}});Object.defineProperties(Xa.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}});kr.prototype.clearTarget=function(i,e,o,h){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(e,o,h)};kr.prototype.animate=function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)};kr.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};kr.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};kr.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};kr.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};kr.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};kr.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};kr.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};kr.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};kr.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};kr.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};kr.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};kr.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};kr.prototype.enableScissorTest=function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)};kr.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};kr.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};kr.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};kr.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};kr.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};kr.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};kr.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};kr.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};kr.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};kr.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(kr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?WB:my}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(u4.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(od.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}});d2.prototype.updateCubeMap=function(i,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,e)};d2.prototype.clear=function(i,e,o,h){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,e,o,h)};Lp.crossOrigin=void 0;Lp.loadTexture=function(i,e,o,h){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const l=new MT;l.setCrossOrigin(this.crossOrigin);const f=l.load(i,o,void 0,h);return e&&(f.mapping=e),f};Lp.loadTextureCube=function(i,e,o,h){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const l=new ste;l.setCrossOrigin(this.crossOrigin);const f=l.load(i,o,void 0,h);return e&&(f.mapping=e),f};Lp.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Lp.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:UB}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=UB);let LT="",eb="";const Bc=new y7({name:"OASIS GeoMap",version:"1.0.0"});let $t,Fc=null,__={markers:!0,heatmap:!1,deserts:!1},Nu=null,Sl=null,RT=null,T2=!1,y_=!1,v_=null,I0=null;function Ko(i){return document.getElementById(i)}function Nte(i){return i.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim()}function ad(i,e){console.log(`[OASIS] ${e?"âœ…":"âš ï¸"} ${i}`)}const np=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],rp=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];function Ute(i,e){const o=.5*(Math.sqrt(3)-1),h=(3-Math.sqrt(3))/6,l=(i+e)*o,f=Math.floor(i+l),x=Math.floor(e+l),s=(f+x)*h,P=i-(f-s),C=e-(x-s),O=P>C?1:0,F=P>C?0:1,V=P-O+h,q=C-F+h,ee=P-1+2*h,se=C-1+2*h,fe=f&255,ae=x&255,ie=np[fe+np[ae]]%12,tt=np[fe+O+np[ae+F]]%12,Ue=np[fe+1+np[ae+1]]%12;let Ne=0,Ce=0,Ye=0,At=.5-P*P-C*C;At>=0&&(At*=At,Ne=At*At*(rp[ie][0]*P+rp[ie][1]*C));let ft=.5-V*V-q*q;ft>=0&&(ft*=ft,Ce=ft*ft*(rp[tt][0]*V+rp[tt][1]*q));let wt=.5-ee*ee-se*se;return wt>=0&&(wt*=wt,Ye=wt*wt*(rp[Ue][0]*ee+rp[Ue][1]*se)),70*(Ne+Ce+Ye)}function O4(i,e,o,h){const f=(o-i)*Math.PI/180,x=(h-e)*Math.PI/180,s=Math.sin(f/2)**2+Math.cos(i*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(x/2)**2;return 6371*2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))}const $te=[{names:["specialties","specialty"],terms:["radiology","imaging"]},{names:["equipment"],terms:["x-ray","xray","ct scan","ct","mri","ultrasound","imaging","radiograph","fluoroscop"]},{names:["procedures","procedure"],terms:["x-ray","xray","ct scan","mri","ultrasound","imaging","radiograph"]},{names:["capability"],terms:["radiology","imaging","x-ray","xray","ct","mri","ultrasound"]}];function Vte(i,e,o){for(const h of e){const l=i[h];if(!l)continue;let f;try{f=typeof l=="string"?JSON.parse(l):Array.isArray(l)?l:[l]}catch{f=[String(l)]}for(const x of f){const s=String(x).toLowerCase();for(const P of o)if(s.includes(P))return!0}}return!1}function jte(i){const e=i==null?void 0:i.features;if(!e||e.length===0)return;const o=e.map(h=>{const[l,f]=h.geometry.coordinates;return{lat:f,lng:l}});for(let h=0;h<e.length;h++){let l=1/0;for(let f=0;f<o.length;f++){if(h===f)continue;const x=O4(o[h].lat,o[h].lng,o[f].lat,o[f].lng);x<l&&(l=x)}e[h].properties.distance=l===1/0?null:l}}function Gte(i){const e=[];return i!=null&&i.features&&i.features.forEach((o,h)=>{var x;const l=o.properties||{};if($te.some(s=>Vte(l,s.names,s.terms))&&((x=o.geometry)!=null&&x.coordinates)){const[s,P]=o.geometry.coordinates;e.push({lng:s,lat:P,id:String(l.pk_unique_id??l.id??`_idx_${h}`)})}}),e}function Hte(i){if(i.length===0)return{type:"FeatureCollection",features:[]};const e=4.5,o=11.2,h=-3.3,l=1.3,f=.1,x=[];let s=0;for(let P=e;P<=o;P+=f)for(let C=h;C<=l;C+=f){let O=1/0;for(const F of i){const V=O4(P,C,F.lat,F.lng);V<O&&(O=V)}x.push({lng:C,lat:P,dist:O}),O>s&&(s=O)}return{type:"FeatureCollection",features:x.map(P=>({type:"Feature",geometry:{type:"Point",coordinates:[P.lng,P.lat]},properties:{heat:s>0?P.dist/s:0}}))}}function Zte(i,e,o){const[h,l]=i,f=[],x=72;for(let s=0;s<=x;s++){const P=s%x*(2*Math.PI/x),C=o+Math.cos(P)*2.5,O=o*.7+Math.sin(P)*2.5,F=1+Ute(C,O)*.25,V=e*F,q=l+V/111.32*Math.cos(P),ee=h+V/(111.32*Math.cos(l*Math.PI/180))*Math.sin(P);f.push([ee,q])}return{type:"Polygon",coordinates:[f]}}function Wte(i){const e=[{label:"30min",km:20},{label:"60min",km:40},{label:"120min",km:70}],o=[];for(const h of i){const l=Math.abs(Math.sin(h.lng*73856.093+h.lat*19349.663)*43758.5453);for(const f of e)o.push({type:"Feature",geometry:Zte([h.lng,h.lat],f.km,l+f.km),properties:{ring:f.label,facilityId:h.id}})}return{type:"FeatureCollection",features:o}}async function qte(i,e){var l;const h=(l=(await Bc.callServerTool({name:i,arguments:e})).content)==null?void 0:l.find(f=>f.type==="text");if(h&&"text"in h){const f=h.text;try{return JSON.parse(f)}catch{throw new Error(`Failed to parse ${i} response as JSON (got ${f.slice(0,120)}â€¦)`)}}throw new Error(`No text content in ${i} response`)}function Xte(){if(!LT){ad("MAPBOX_TOKEN not set â€” add it to .env and restart MCP server",!1);return}$0.accessToken=LT,$t=new $0.Map({container:"map",style:"mapbox://styles/mapbox/standard",projection:"globe",center:[0,20],zoom:1.8,pitch:0,bearing:0,antialias:!0}),$t.on("style.load",()=>{$t.setConfigProperty("basemap","lightPreset","night"),$t.setConfigProperty("basemap","showPointOfInterestLabels",!1),$t.setConfigProperty("basemap","showTransitLabels",!1),$t.setConfigProperty("basemap","showPlaceLabels",!0),$t.setConfigProperty("basemap","showRoadLabels",!1)}),$t.on("error",i=>{var e;console.error("Mapbox error:",i.error||i),Ko("loader").classList.add("gone"),ad("Map error: "+(((e=i.error)==null?void 0:e.message)||"unknown"),!1)}),$t.on("load",()=>{$t.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),$t.setTerrain({source:"mapbox-dem",exaggeration:1.5}),setTimeout(()=>{Ko("loader").classList.add("gone"),$t.flyTo({center:[-1,8],zoom:4.5,pitch:0,bearing:0,duration:2500,essential:!0}),setTimeout(()=>{$t.flyTo({center:[-.9057,9.5439],zoom:8,pitch:50,bearing:-15,duration:2500,essential:!0})},2700)},600);const i=Jte().then(()=>{Kte()}),e=new Promise(o=>setTimeout(o,5400));Promise.all([i,e]).then(()=>{uie()})}),setTimeout(()=>{const i=Ko("loader");i.classList.contains("gone")||(i.classList.add("gone"),ad("Map load timed out â€” check console for errors",!1))},15e3)}async function Jte(){try{ad("Loading facilities via MCPâ€¦",!0),Fc=(await qte("geocode_facilities",{})).geojson||{type:"FeatureCollection",features:[]},jte(Fc),ad(`Loaded ${Fc.features.length} facilities`,!0)}catch(i){console.error("Failed to load facilities via MCP:",i),ad("Failed to load facilities: "+i.message,!1)}}function Yte(){const o=document.createElement("canvas");o.width=64,o.height=128;const h=o.getContext("2d"),l=64/2,f=28,x=h.createRadialGradient(l,f,0,l,f,28);return x.addColorStop(0,"rgba(255, 107, 53, 0.7)"),x.addColorStop(.5,"rgba(255, 107, 53, 0.15)"),x.addColorStop(1,"rgba(255, 107, 53, 0)"),h.fillStyle=x,h.fillRect(0,0,64,56),h.beginPath(),h.moveTo(l,f+14),h.lineTo(l,122),h.strokeStyle="rgba(255, 107, 53, 0.45)",h.lineWidth=2,h.stroke(),h.beginPath(),h.arc(l,124,3.5,0,Math.PI*2),h.fillStyle="rgba(255, 107, 53, 0.25)",h.fill(),h.beginPath(),h.arc(l,f,12,0,Math.PI*2),h.fillStyle="#FF6B35",h.fill(),h.strokeStyle="rgba(255, 255, 255, 0.95)",h.lineWidth=3,h.stroke(),h.beginPath(),h.arc(l,f,5,0,Math.PI*2),h.fillStyle="rgba(255, 255, 255, 0.75)",h.fill(),h.fillStyle="rgba(255, 255, 255, 0.55)",h.fillRect(l-1.2,f-6,2.4,12),h.fillRect(l-6,f-1.2,12,2.4),o}function Kte(){if(!Fc)return;$t.addSource("facilities",{type:"geojson",data:Fc}),$t.addLayer({id:"layer-heatmap",type:"heatmap",source:"facilities",slot:"middle",layout:{visibility:"none"},paint:{"heatmap-weight":["interpolate",["linear"],["length",["to-string",["get","specialties"]]],10,.2,100,.5,300,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-radius":["interpolate",["linear"],["zoom"],0,4,6,30,9,50],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.1,"rgba(26,5,48,0.6)",.25,"rgba(107,15,107,0.7)",.4,"rgba(255,68,68,0.8)",.6,"rgba(255,153,68,0.85)",.8,"rgba(255,238,68,0.9)",1,"rgba(255,255,255,1)"],"heatmap-opacity":["interpolate",["linear"],["zoom"],5,.8,12,.3]}}),$t.addLayer({id:"layer-glow",type:"circle",source:"facilities",slot:"top",paint:{"circle-radius":["interpolate",["linear"],["zoom"],4,6,8,12,12,18,16,24,20,30],"circle-color":"#FF6B35","circle-opacity":.2,"circle-blur":1}}),$t.addLayer({id:"layer-markers",type:"circle",source:"facilities",slot:"top",paint:{"circle-radius":["interpolate",["linear"],["zoom"],4,3,8,5,12,7,16,10,20,14],"circle-color":"#FF6B35","circle-opacity":1,"circle-stroke-width":["interpolate",["linear"],["zoom"],4,.5,10,1.5,16,2.5],"circle-stroke-color":"rgba(255,255,255,0.9)"}});const i=e=>{const o=e.features[0],h=e.lngLat;$t.flyTo({center:h,zoom:Math.max($t.getZoom(),14),pitch:60,duration:1500}),oie(o.properties,h)};$t.on("click","layer-markers",i),$t.on("mouseenter","layer-markers",()=>{$t.getCanvas().style.cursor="pointer"}),$t.on("mouseleave","layer-markers",()=>{$t.getCanvas().style.cursor=""}),$t.on("mouseenter","layer-glow",()=>{$t.getCanvas().style.cursor="pointer"}),$t.on("mouseleave","layer-glow",()=>{$t.getCanvas().style.cursor=""}),$t.addImage("marker-3d-pin",Yte(),{pixelRatio:2}),$t.addLayer({id:"layer-markers-3d",type:"symbol",source:"facilities",slot:"top",minzoom:15,layout:{"icon-image":"marker-3d-pin","icon-size":["interpolate",["linear"],["zoom"],15,.65,18,1,20,1.2],"icon-anchor":"bottom","icon-allow-overlap":!0,"symbol-placement":"point","symbol-z-elevate":!0},paint:{"icon-opacity":["interpolate",["linear"],["zoom"],15,0,15.5,1]}}),$t.on("click","layer-markers-3d",i),$t.on("mouseenter","layer-markers-3d",()=>{$t.getCanvas().style.cursor="pointer"}),$t.on("mouseleave","layer-markers-3d",()=>{$t.getCanvas().style.cursor=""})}function Qte(i,e=!1){$t.getSource("desert-gaps")&&($t.getLayer("desert-circles")&&$t.removeLayer("desert-circles"),$t.getLayer("desert-labels")&&$t.removeLayer("desert-labels"),$t.removeSource("desert-gaps"));const o=i.map(h=>({type:"Feature",geometry:{type:"Point",coordinates:[h.lng,h.lat]},properties:{nearest_city:h.nearest_city,distance_km:h.nearest_facility_distance_km,severity:h.severity,nearest_facility:h.nearest_facility_name}}));if($t.addSource("desert-gaps",{type:"geojson",data:{type:"FeatureCollection",features:o}}),$t.addLayer({id:"desert-circles",type:"circle",source:"desert-gaps",slot:"middle",paint:{"circle-radius":["interpolate",["linear"],["zoom"],4,20,8,40,12,60],"circle-color":["case",["==",["get","severity"],"critical"],"rgba(255,82,82,0.25)","rgba(255,152,0,0.2)"],"circle-blur":.6,"circle-stroke-width":2,"circle-stroke-color":["case",["==",["get","severity"],"critical"],"rgba(255,82,82,0.5)","rgba(255,152,0,0.4)"]}},"layer-glow"),$t.addLayer({id:"desert-labels",type:"symbol",source:"desert-gaps",slot:"top",layout:{"text-field":["concat",`DESERT
`,["get","nearest_city"]],"text-size":10,"text-anchor":"center"},paint:{"text-color":"#FF5252","text-halo-color":"#000","text-halo-width":1}}),i.length>0&&!e){const h=new $0.LngLatBounds;i.forEach(l=>h.extend([l.lng,l.lat])),$t.fitBounds(h,{padding:80,pitch:30,duration:2e3})}}function eie(i){console.log("[OASIS] renderDeploymentMarker:",i),$t.getLayer("deploy-pulse-outer")&&$t.removeLayer("deploy-pulse-outer"),$t.getLayer("deploy-pulse-inner")&&$t.removeLayer("deploy-pulse-inner"),$t.getLayer("deploy-label")&&$t.removeLayer("deploy-label"),$t.getSource("deploy-point")&&$t.removeSource("deploy-point");const e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[i.lng,i.lat]},properties:{city:i.nearest_city,distance_km:i.nearest_facility_distance_km}}]};$t.addSource("deploy-point",{type:"geojson",data:e}),$t.addLayer({id:"deploy-pulse-outer",type:"circle",source:"deploy-point",slot:"top",paint:{"circle-radius":["interpolate",["linear"],["zoom"],6,40,9,60,12,80],"circle-color":"rgba(0, 255, 136, 0.15)","circle-stroke-width":3,"circle-stroke-color":"rgba(0, 255, 136, 0.6)"}}),$t.addLayer({id:"deploy-pulse-inner",type:"circle",source:"deploy-point",slot:"top",paint:{"circle-radius":["interpolate",["linear"],["zoom"],6,10,9,16,12,22],"circle-color":"#00FF88","circle-opacity":.9,"circle-stroke-width":3,"circle-stroke-color":"#ffffff"}}),$t.addLayer({id:"deploy-label",type:"symbol",source:"deploy-point",slot:"top",layout:{"text-field":["concat",`DEPLOY HERE
`,["get","city"]],"text-size":13,"text-anchor":"top","text-offset":[0,2.5],"text-font":["DIN Pro Bold","Arial Unicode MS Bold"]},paint:{"text-color":"#00FF88","text-halo-color":"#000","text-halo-width":1.5}});let o=0;const h=setInterval(()=>{if(!$t.getLayer("deploy-pulse-outer")){clearInterval(h);return}o+=.05;const l=1+.3*Math.sin(o),f=.15+.1*Math.sin(o),x=$t.getZoom(),s=x<8?40:x<10?60:80;$t.setPaintProperty("deploy-pulse-outer","circle-radius",s*l),$t.setPaintProperty("deploy-pulse-outer","circle-color",`rgba(0, 255, 136, ${f})`)},50)}function tie(i){const e=i.toLowerCase();console.log("[OASIS] applyRegionHighlight:",e);const o=["in",e,["downcase",["coalesce",["get","region"],""]]];$t.setPaintProperty("layer-markers","circle-opacity",["case",o,1,.15]),$t.setPaintProperty("layer-markers","circle-stroke-opacity",["case",o,.9,.1]),$t.setPaintProperty("layer-glow","circle-opacity",["case",o,.2,.03])}function iie(){if(!Fc||y_)return;const i=Gte(Fc);if(console.log(`[OASIS] Found ${i.length} radiology-capable facilities`),i.length===0)return;const e=new Set(i.map(l=>l.id));Fc.features.forEach((l,f)=>{const x=l.properties||{},s=String(x.pk_unique_id??x.id??`_idx_${f}`);l.properties._isRadiology=e.has(s)?1:0}),$t.getSource("facilities").setData(Fc);const o=Wte(i);$t.addSource("isochrones",{type:"geojson",data:o});const h=Hte(i);$t.addSource("desert-grid",{type:"geojson",data:h}),$t.addLayer({id:"layer-desert-heatmap",type:"heatmap",source:"desert-grid",slot:"middle",paint:{"heatmap-weight":["get","heat"],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,.5,6,1.5,9,2.5],"heatmap-radius":["interpolate",["linear"],["zoom"],0,8,6,35,9,55],"heatmap-opacity":0,"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.1,"rgba(80,0,0,0)",.3,"rgba(180,0,0,0.3)",.5,"rgba(255,30,0,0.5)",.7,"rgba(255,80,0,0.7)",.9,"rgba(255,200,50,0.85)",1,"rgba(255,255,255,0.9)"]}}),$t.addLayer({id:"layer-isochrone-fill",type:"fill",source:"isochrones",slot:"middle",paint:{"fill-color":["case",["==",["get","ring"],"30min"],"#00FF88",["==",["get","ring"],"60min"],"#FFD740","#FF6B35"],"fill-opacity":0}}),$t.addLayer({id:"layer-isochrone-stroke-30",type:"line",source:"isochrones",slot:"middle",filter:["==",["get","ring"],"30min"],paint:{"line-color":"#00FF88","line-width":1.5,"line-opacity":0}}),$t.addLayer({id:"layer-isochrone-stroke-60",type:"line",source:"isochrones",slot:"middle",filter:["==",["get","ring"],"60min"],paint:{"line-color":"#FFD740","line-width":1.5,"line-opacity":0,"line-dasharray":[4,4]}}),$t.addLayer({id:"layer-isochrone-stroke-120",type:"line",source:"isochrones",slot:"middle",filter:["==",["get","ring"],"120min"],paint:{"line-color":"#FF6B35","line-width":1.5,"line-opacity":0,"line-dasharray":[2,4]}}),y_=!0}function nie(){const e=performance.now();function o(l){return 1-Math.pow(1-l,3)}function h(){const l=Math.min((performance.now()-e)/2e3,1),f=o(l);$t.getLayer("layer-desert-heatmap")&&$t.setPaintProperty("layer-desert-heatmap","heatmap-opacity",f*.7),$t.getLayer("layer-isochrone-fill")&&$t.setPaintProperty("layer-isochrone-fill","fill-opacity",["case",["==",["get","ring"],"30min"],f*.15,["==",["get","ring"],"60min"],f*.1,f*.08]);for(const C of["30","60","120"]){const O=`layer-isochrone-stroke-${C}`;$t.getLayer(O)&&$t.setPaintProperty(O,"line-opacity",f*.8)}const x=Math.round(255*(1-f)),s=Math.round(107+105*f),P=Math.round(53+202*f);$t.setPaintProperty("layer-markers","circle-color",["case",["==",["get","_isRadiology"],1],`rgb(${x},${s},${P})`,"#FF6B35"]),$t.setPaintProperty("layer-markers","circle-opacity",["case",["==",["get","_isRadiology"],1],1,1-f*.8]),$t.setPaintProperty("layer-glow","circle-opacity",["case",["==",["get","_isRadiology"],1],.2,Math.max(.03,.2*(1-f))]),$t.setPaintProperty("layer-markers","circle-radius",["case",["==",["get","_isRadiology"],1],["interpolate",["linear"],["zoom"],4,3+f*2,8,5+f*2,12,7+f*2,16,10+f*2,20,14+f*2],["interpolate",["linear"],["zoom"],4,3,8,5,12,7,16,10,20,14]]),$t.setPaintProperty("layer-markers","circle-stroke-color",["case",["==",["get","_isRadiology"],1],"rgba(255,255,255,0.9)",`rgba(255,255,255,${(.9*(1-f*.89)).toFixed(2)})`]),l<1?requestAnimationFrame(h):($t.setPaintProperty("layer-desert-heatmap","heatmap-opacity",["interpolate",["linear"],["zoom"],0,.7,5,.6,12,.3]),rie())}requestAnimationFrame(h)}function rie(){if(v_)return;const i=performance.now();v_=setInterval(()=>{if(!T2||!$t.getLayer("layer-markers")){F4();return}const e=(performance.now()-i)/1e3,o=Math.sin(e*2.5),h=o*3,l=.25+o*.1;$t.setPaintProperty("layer-markers","circle-radius",["case",["==",["get","_isRadiology"],1],["interpolate",["linear"],["zoom"],4,5+h,8,7+h,12,9+h,16,12+h,20,16+h],["interpolate",["linear"],["zoom"],4,3,8,5,12,7,16,10,20,14]]),$t.setPaintProperty("layer-glow","circle-opacity",["case",["==",["get","_isRadiology"],1],l,.03])},50)}function F4(){v_&&(clearInterval(v_),v_=null)}function DT(i){if(T2=i,i){if(y_||iie(),!y_)return;$t.setPaintProperty("layer-desert-heatmap","heatmap-opacity",0),$t.setPaintProperty("layer-isochrone-fill","fill-opacity",0);for(const e of["30","60","120"])$t.setPaintProperty(`layer-isochrone-stroke-${e}`,"line-opacity",0);$t.setLayoutProperty("layer-desert-heatmap","visibility","visible"),$t.setLayoutProperty("layer-isochrone-fill","visibility","visible");for(const e of["30","60","120"])$t.setLayoutProperty(`layer-isochrone-stroke-${e}`,"visibility","visible");$t.getLayer("desert-circles")&&($t.setLayoutProperty("desert-circles","visibility","visible"),$t.setLayoutProperty("desert-labels","visibility","visible")),nie()}else{if(F4(),y_){$t.setLayoutProperty("layer-desert-heatmap","visibility","none"),$t.setLayoutProperty("layer-isochrone-fill","visibility","none");for(const e of["30","60","120"])$t.setLayoutProperty(`layer-isochrone-stroke-${e}`,"visibility","none")}$t.getLayer("desert-circles")&&($t.setLayoutProperty("desert-circles","visibility","none"),$t.setLayoutProperty("desert-labels","visibility","none")),$t.setPaintProperty("layer-markers","circle-color","#FF6B35"),$t.setPaintProperty("layer-markers","circle-opacity",1),$t.setPaintProperty("layer-markers","circle-stroke-color","rgba(255,255,255,0.9)"),$t.setPaintProperty("layer-markers","circle-radius",["interpolate",["linear"],["zoom"],4,3,8,5,12,7,16,10,20,14]),$t.setPaintProperty("layer-glow","circle-opacity",.2)}}function oie(i,e){Ko("d-name").textContent=i.name||"â€”",Ko("d-type").textContent=i.facility_type||"Facility";let o=[];try{o=JSON.parse(i.specialties||"[]")}catch{}Ko("d-specs").textContent=String(o.length),Ko("d-dist").textContent=i.distance!=null?i.distance.toFixed(1)+" km":"â€”",Ko("d-city").textContent=i.city||"â€”";let h=[];try{h=JSON.parse(i.equipment||"[]").filter(Boolean)}catch{}const l=[...o.map(Nte),...h];Ko("d-caps").innerHTML=l.slice(0,12).map(x=>`<span class="cap-chip">${x}</span>`).join("")+(l.length>12?`<span class="cap-chip">+${l.length-12}</span>`:""),Ko("detail-card").classList.add("show");const f=e?[e.lng,e.lat]:i.coords||[0,0];RT=f,lie(f,i.name||"Hospital"),eb&&cie(i)}function sie(){Ko("detail-card").classList.remove("show"),Nu&&$t.getLayer(Nu)&&($t.removeLayer(Nu),Nu=null),Sl&&(Sl.pause(),Sl=null)}function aie(i){__[i]=!__[i];const e=__[i],o=document.getElementById(`tog-${i}`);switch(o&&o.classList.toggle("on",e),i){case"markers":$t.setLayoutProperty("layer-markers","visibility",e?"visible":"none"),$t.setLayoutProperty("layer-glow","visibility",e?"visible":"none"),$t.getLayer("layer-markers-3d")&&$t.setLayoutProperty("layer-markers-3d","visibility",e?"visible":"none");break;case"heatmap":$t.setLayoutProperty("layer-heatmap","visibility",e?"visible":"none"),Ko("heatmap-legend").classList.toggle("show",e);break;case"deserts":DT(e);break}}function lie(i,e){Nu&&$t.getLayer(Nu)&&$t.removeLayer(Nu);const o=$0.MercatorCoordinate.fromLngLat(i,0),h={translateX:o.x,translateY:o.y,translateZ:o.z,rotateX:Math.PI/2,rotateY:0,rotateZ:0,scale:o.meterInMercatorCoordinateUnits()},l="3d-model-hospital";Nu=l;const f={id:l,type:"custom",renderingMode:"3d",onAdd(x,s){this.camera=new hd,this.scene=new p2,this.clock=new Ste,this.scene.add(new z4(13426175,.6));const P=new PT(16777215,1);P.position.set(50,-80,120),this.scene.add(P);const C=new PT(8952268,.4);C.position.set(-40,60,80),this.scene.add(C);const O=new ic({color:15790320,specular:2236962,shininess:30}),F=new ic({color:8965375,specular:16777215,shininess:100,opacity:.6,transparent:!0}),V=new ic({color:16739125,specular:16746581,shininess:60}),q=new ic({color:16711680,emissive:16720384,emissiveIntensity:.5}),ee=new ic({color:4478310}),se=new ic({color:3359829}),fe=new up,ae=new lr(new Jo(60,30,40),O);ae.position.set(0,0,20),fe.add(ae);for(let Dt=0;Dt<5;Dt++){const Qe=5+Dt*8;fe.add(Object.assign(new lr(new Jo(56,.5,4),F),{position:new He(0,-15.3,Qe)})),fe.add(Object.assign(new lr(new Jo(56,.5,4),F),{position:new He(0,15.3,Qe)})),fe.add(Object.assign(new lr(new Jo(.5,26,4),F),{position:new He(-30.3,0,Qe)})),fe.add(Object.assign(new lr(new Jo(.5,26,4),F),{position:new He(30.3,0,Qe)}))}const ie=new Jo(20,20,16),tt=new lr(ie,O);tt.position.set(-40,0,8),fe.add(tt);const Ue=new lr(ie,O);Ue.position.set(40,0,8),fe.add(Ue);const Ne=new lr(new Jo(62,31,2),V);Ne.position.set(0,0,41),fe.add(Ne);const Ce=new lr(new Jo(64,33,1),ee);Ce.position.set(0,0,42),fe.add(Ce);const Ye=new lr(new Mee(8,8,.3,32),se);Ye.rotation.x=Math.PI/2,Ye.position.set(0,0,42.5),fe.add(Ye);const At=new ic({color:16777215});fe.add(Object.assign(new lr(new Jo(1,6,.2),At),{position:new He(-2,0,42.8)})),fe.add(Object.assign(new lr(new Jo(1,6,.2),At),{position:new He(2,0,42.8)})),fe.add(Object.assign(new lr(new Jo(5,1,.2),At),{position:new He(0,0,42.8)}));const ft=new lr(new Jo(16,8,1),V);ft.position.set(0,-19,10),fe.add(ft);const wt=new lr(new Jo(8,.5,2),q);wt.position.set(0,-15.5,22),fe.add(wt);const Et=new lr(new Jo(2,.5,8),q);Et.position.set(0,-15.5,22),fe.add(Et),this.beacon=new M4(16711680,2,200),this.beacon.position.set(0,0,48),fe.add(this.beacon),fe.add(new lr(new Jo(100,60,.5),new ic({color:4478276}))),this.scene.add(fe),this.map=x,this.renderer=new kr({canvas:x.getCanvas(),context:s,antialias:!0}),this.renderer.autoClear=!1},render(x,s){this.beacon&&this.clock&&(this.beacon.intensity=1+Math.sin(this.clock.getElapsedTime()*3)*1.5);const P=new nn().makeRotationAxis(new He(1,0,0),h.rotateX),C=new nn().makeRotationAxis(new He(0,1,0),h.rotateY),O=new nn().makeRotationAxis(new He(0,0,1),h.rotateZ),F=new nn().fromArray(s),V=new nn().makeTranslation(h.translateX,h.translateY,h.translateZ).scale(new He(h.scale,-h.scale,h.scale)).multiply(P).multiply(C).multiply(O);this.camera.projectionMatrix=F.multiply(V),this.renderer.resetState(),this.renderer.render(this.scene,this.camera)}};$t.addLayer(f)}async function cie(i){if(Sl&&(Sl.pause(),Sl=null),!eb)return;let e=[];try{e=JSON.parse(i.specialties||"[]")}catch{}const o=`${i.name||"This facility"}. ${i.city?"Located in "+i.city+".":""} ${e.length>0?"Specialties include "+e.slice(0,3).map(h=>h.replace(/([A-Z])/g," $1")).join(", ")+".":""}`;try{const h=await fetch("https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM",{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":eb},body:JSON.stringify({text:o,model_id:"eleven_monolingual_v1",voice_settings:{stability:.5,similarity_boost:.5}})});if(h.ok){const l=await h.blob();Sl=new Audio(URL.createObjectURL(l)),Sl.play()}}catch(h){console.error("ElevenLabs narration error:",h)}}function B4(i){var e,o,h;if(i.theme&&m7(i.theme),(e=i.styles)!=null&&e.variables&&g7(i.styles.variables),(h=(o=i.styles)==null?void 0:o.css)!=null&&h.fonts&&_7(i.styles.css.fonts),i.safeAreaInsets){const{top:l,right:f,bottom:x,left:s}=i.safeAreaInsets;document.body.style.padding=`${l}px ${f}px ${x}px ${s}px`}}function uie(){var o,h,l,f;if(!I0)return;const i=I0;I0=null;const e=!!i.highlight_region;console.log("[OASIS] applyToolData:",{mode:i.mode,hasHighlightRegion:e,highlight_region:i.highlight_region,gaps:(o=i.gaps)==null?void 0:o.length}),e&&tie(i.highlight_region),i.mode==="deserts"&&(((h=i.gaps)==null?void 0:h.length)>0&&Qte(i.gaps,e),DT(!0),__.deserts=!0,Ko("tog-deserts").classList.add("on"),ad(`${i.gap_count||((l=i.gaps)==null?void 0:l.length)||0} coverage gaps for ${((f=i.query)==null?void 0:f.condition)||"specialty"}`,!0)),i.narrative_focus==="deserts"&&!T2&&(DT(!0),__.deserts=!0,Ko("tog-deserts").classList.add("on")),i.narrative_focus==="impact"&&i.recommended_deployment&&eie(i.recommended_deployment)}Bc.ontoolinput=()=>{Ko("loader").classList.remove("gone")};Bc.ontoolresult=i=>{var e;try{const o=(e=i==null?void 0:i.content)==null?void 0:e.find(h=>h.type==="text");if(o&&"text"in o){const h=JSON.parse(o.text);h.config&&(LT=h.config.mapbox_token||"",eb=h.config.elevenlabs_api_key||""),I0=h,console.log("[OASIS] ontoolresult stored pendingToolData:",{mode:h.mode,highlight_region:h.highlight_region,narrative_focus:h.narrative_focus,initial_zoom:h.initial_zoom,gap_count:h.gap_count})}}catch(o){console.error("Failed to parse geo_map tool result:",o)}Xte()};Bc.onhostcontextchanged=i=>{if(B4(i),i.displayMode){x_=i.displayMode;const e=document.getElementById("tog-fullscreen");e&&e.classList.toggle("on",x_==="fullscreen"),setTimeout(()=>$t==null?void 0:$t.resize(),100)}};Bc.onteardown=async()=>(Sl&&(Sl.pause(),Sl=null),{});let x_="inline";async function hie(){const i=x_==="fullscreen"?"inline":"fullscreen";x_=(await Bc.requestDisplayMode({mode:i})).mode;const o=document.getElementById("tog-fullscreen");o&&o.classList.toggle("on",x_==="fullscreen"),setTimeout(()=>$t==null?void 0:$t.resize(),100)}Ko("btn-close-detail").addEventListener("click",sie);Ko("btn-recenter").addEventListener("click",()=>{RT&&$t&&$t.flyTo({center:RT,zoom:17,pitch:60,bearing:-15,duration:1500})});Ko("tog-fullscreen").addEventListener("click",hie);document.querySelectorAll("[data-layer]").forEach(i=>{i.addEventListener("click",()=>{aie(i.dataset.layer)})});document.querySelectorAll("[data-fly]").forEach(i=>{i.addEventListener("click",()=>{const[e,o,h]=i.dataset.fly.split(",").map(Number);$t.flyTo({center:[e,o],zoom:h,pitch:45,bearing:-15,duration:2500})})});Bc.connect().then(()=>{const i=Bc.getHostContext();i&&B4(i),Bc.sendSizeChanged({width:0,height:600}),console.log("[OASIS] Connected to Claude Desktop via MCP")});</script>
  <style rel="stylesheet" crossorigin>.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.mapboxgl-canvas{left:0;position:absolute;top:0}.mapboxgl-map:-webkit-full-screen{height:100%;width:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-webkit-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom,.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-left,.mapboxgl-ctrl-right,.mapboxgl-ctrl-top,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.mapboxgl-ctrl-top-left{left:0;top:0}.mapboxgl-ctrl-top{left:50%;top:0;transform:translate(-50%)}.mapboxgl-ctrl-top-right{right:0;top:0}.mapboxgl-ctrl-right{right:0;top:50%;transform:translateY(-50%)}.mapboxgl-ctrl-bottom-right{bottom:0;right:0}.mapboxgl-ctrl-bottom{bottom:0;left:50%;transform:translate(-50%)}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-left{left:0;top:50%;transform:translateY(-50%)}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{float:left;margin:10px 0 0 10px}.mapboxgl-ctrl-top .mapboxgl-ctrl{float:left;margin:10px 0}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{float:right;margin:10px 10px 0 0}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl,.mapboxgl-ctrl-right .mapboxgl-ctrl{float:right;margin:0 10px 10px 0}.mapboxgl-ctrl-bottom .mapboxgl-ctrl{float:left;margin:10px 0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl,.mapboxgl-ctrl-left .mapboxgl-ctrl{float:left;margin:0 0 10px 10px}.mapboxgl-ctrl-group{background:#fff;border-radius:4px}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media(-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{background-color:initial;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;overflow:hidden;padding:0;width:29px}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media(-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:initial}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl-group button:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:only-child{border-radius:inherit}.mapboxgl-ctrl button:not(:disabled):hover{background-color:#0000000d}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media(-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media(-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media(-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-buildings-toggle .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg fill='none' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3E%3Cpath d='M3.3335 11.6666C3.3335 12.5871 4.07969 13.3333 5.00016 13.3333C5.92064 13.3333 6.66683 12.5871 6.66683 11.6666L6.66683 6.66659L11.6668 6.66659C12.5873 6.66659 13.3335 5.92039 13.3335 4.99992C13.3335 4.07944 12.5873 3.33325 11.6668 3.33325H3.3335V11.6666Z' fill='currentColor'/%3E%3Cpath d='M26.6668 11.6666C26.6668 12.5871 25.9206 13.3333 25.0002 13.3333C24.0797 13.3333 23.3335 12.5871 23.3335 11.6666L23.3335 6.66659L18.3335 6.66659C17.413 6.66659 16.6668 5.92039 16.6668 4.99992C16.6668 4.07944 17.413 3.33325 18.3335 3.33325H26.6668L26.6668 11.6666Z' fill='currentColor'/%3E%3Cpath d='M13.3335 24.9999C13.3335 25.9204 12.5873 26.6666 11.6668 26.6666H3.3335V18.3333C3.3335 17.4128 4.07969 16.6666 5.00016 16.6666C5.92064 16.6666 6.66683 17.4128 6.66683 18.3333V23.3333H11.6668C12.5873 23.3333 13.3335 24.0794 13.3335 24.9999Z' fill='currentColor'/%3E%3Cpath d='M18.3335 26.6666C17.413 26.6666 16.6668 25.9204 16.6668 24.9999C16.6668 24.0794 17.413 23.3333 18.3335 23.3333H23.3335V18.3333C23.3335 17.4128 24.0797 16.6666 25.0002 16.6666C25.9206 16.6666 26.6668 17.4128 26.6668 18.3333V26.6666H18.3335Z' fill='currentColor'/%3E%3C/svg%3E");background-size:26px 26px}.mapboxgl-ctrl button.mapboxgl-ctrl-buildings-toggle.mapboxgl-ctrl-level-button-selected .mapboxgl-ctrl-icon{filter:invert(1) brightness(1)}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{animation:mapboxgl-spin 2s linear infinite}@media(-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}}@keyframes mapboxgl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='0.9' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media(-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:initial;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23000'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{background-color:#fff;border-radius:12px;box-sizing:initial;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:#0000000d}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{right:0;top:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{left:0;top:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}.mapboxgl-ctrl-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:#000000bf;text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px;white-space:nowrap}.mapboxgl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{border:10px solid #0000;height:0;width:0;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.mapboxgl-popup-close-button{background-color:initial;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.mapboxgl-popup-close-button:hover{background-color:#0000000d}.mapboxgl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:10px 10px 15px;pointer-events:auto;position:relative}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{left:0;opacity:1;position:absolute;top:0;transition:opacity .2s;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.mapboxgl-user-location-dot:before{animation:mapboxgl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.mapboxgl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading{height:0;width:0}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after,.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-bottom:7.5px solid #4aa1eb;content:"";position:absolute}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-left:7.5px solid #0000;transform:translateY(-28px) skewY(-20deg)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after{border-right:7.5px solid #0000;transform:translate(7.5px,-28px) skewY(20deg)}@keyframes mapboxgl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}@media print{.mapbox-improve-map{display:none}}.mapboxgl-scroll-zoom-blocker,.mapboxgl-touch-pan-blocker{align-items:center;background:#000000b3;color:#fff;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;height:100%;justify-content:center;left:0;opacity:0;pointer-events:none;position:absolute;text-align:center;top:0;transition:opacity .75s ease-in-out;transition-delay:1s;width:100%}.mapboxgl-scroll-zoom-blocker-show,.mapboxgl-touch-pan-blocker-show{opacity:1;transition:opacity .1s ease-in-out}.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page,.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-ctrl-separator{background-color:#e0e0e0;height:1px}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button{align-items:center;color:#333;display:flex;font-size:18px;font-weight:700;height:50px;justify-content:center;line-height:normal;padding:0;text-align:center;width:50px}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button:first-child{border-top-left-radius:8px;border-top-right-radius:8px}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button:last-child{border-bottom-left-radius:8px;border-bottom-right-radius:8px}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button:hover{background-color:#f5f5f5}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button-selected{background-color:#4a5568;color:#fff}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button-selected:hover{background-color:#2d3748}</style>
</head>
<body>

<div class="loader" id="loader">
    <div class="loader-icon">ðŸŒ´</div>
    <div class="loader-text">Initializing OASIS</div>
    <div class="loader-bar"><div class="loader-fill"></div></div>
</div>

<div id="map"></div>

<div class="top-bar glass">
    <div class="logo">ðŸŒ´<span class="status-dot"></span></div>
    <h1>OASIS</h1>
</div>

<div class="nav-pills" id="nav-pills">
    <button class="nav-pill" data-fly="-0.187,5.6037,12">Accra</button>
    <button class="nav-pill" data-fly="-1.6244,6.6885,12">Kumasi</button>
    <button class="nav-pill" data-fly="-0.8393,9.4008,11">Tamale</button>
    <button class="nav-pill" data-fly="-0.8514,10.7856,11">Bolgatanga</button>
    <button class="nav-pill" data-fly="-1.0232,7.9465,6.5">Ghana</button>
</div>

<div class="detail-card glass" id="detail-card">
    <div class="detail-header">
        <div>
            <h2 id="d-name">â€”</h2>
            <span class="type-badge" id="d-type">â€”</span>
        </div>
        <div class="detail-actions">
            <button class="recenter-btn" id="btn-recenter" title="Recenter map">&#8982;</button>
            <button class="close-btn" id="btn-close-detail">âœ•</button>
        </div>
    </div>
    <div class="detail-stats">
        <div class="stat-block"><div class="stat-val" id="d-specs">â€”</div><div class="stat-lbl">Specialties</div></div>
        <div class="stat-block"><div class="stat-val" id="d-dist">â€”</div><div class="stat-lbl">Distance</div></div>
        <div class="stat-block"><div class="stat-val" id="d-city">â€”</div><div class="stat-lbl">City</div></div>
    </div>
    <div class="detail-caps">
        <h4>Capabilities</h4>
        <div class="cap-chips" id="d-caps"></div>
    </div>
</div>

<div class="layers">
    <button class="layer-btn" id="tog-fullscreen">â›¶<span class="tip">Fullscreen</span></button>
    <button class="layer-btn on" id="tog-markers" data-layer="markers">ðŸ“<span class="tip">Markers</span></button>
    <button class="layer-btn" id="tog-heatmap" data-layer="heatmap">ðŸ”¥<span class="tip">Heatmap</span></button>
    <button class="layer-btn" id="tog-deserts" data-layer="deserts">ðŸœï¸<span class="tip">Deserts</span></button>
</div>

<div class="legend glass" id="heatmap-legend">
    <h4>Care Density</h4>
    <div class="legend-bar"></div>
    <div class="legend-labels"><span>Desert</span><span>Moderate</span><span>High</span></div>
</div>


</body>
</html>

