<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OASIS â€” Ghana Healthcare Map</title>
    <!-- All dependencies bundled by Vite - no CDN needed -->
    <style>
        :root {
            --accent: #FF6B35;
            --accent-glow: rgba(255,107,53,0.4);
            --accent-soft: rgba(255,107,53,0.15);
            --cyan: #00D4FF;
            --green: #00E676;
            --red: #FF5252;
            --yellow: #FFD740;
            --glass: rgba(10,12,20,0.82);
            --glass-border: rgba(255,255,255,0.08);
            --t1: #fff;
            --t2: rgba(255,255,255,0.6);
            --t3: rgba(255,255,255,0.35);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; overflow:hidden; background:#000; }
        #map { position:absolute; inset:0; }

        .glass {
            background: var(--glass);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.05);
        }
        .top-bar {
            position:absolute; top:20px; left:20px;
            z-index:1000; padding:10px 20px;
            display:flex; align-items:center; gap:10px;
        }
        .top-bar .logo {
            width:32px; height:32px;
            background:linear-gradient(135deg,var(--accent),#FF8F6B);
            border-radius:8px; display:flex; align-items:center; justify-content:center;
            font-size:18px; position:relative;
        }
        .top-bar .logo .status-dot {
            position:absolute; bottom:-3px; right:-3px;
            width:10px; height:10px;
            background:var(--green);
            border-radius:50%;
            border:2px solid rgba(10,12,20,0.9);
            box-shadow:0 0 6px rgba(0,230,118,0.6);
        }
        .top-bar h1 { font-size:18px; font-weight:700; color:var(--t1); letter-spacing:2px; }
        .nav-pills {
            position:absolute; bottom:20px; left:20px; z-index:1000;
            display:flex; flex-direction:column; gap:6px;
        }
        .nav-pill {
            padding:8px 14px;
            background:var(--glass); backdrop-filter:blur(24px);
            border:1px solid var(--glass-border); border-radius:10px;
            color:var(--t2); font-size:11px; font-weight:600;
            font-family:inherit; cursor:pointer; transition:all 0.3s;
            letter-spacing:0.5px;
        }
        .nav-pill:hover { background:rgba(255,255,255,0.1); color:var(--t1); transform:translateY(-2px); }
        .detail-card {
            position:absolute; bottom:56px; left:20px;
            width:320px; z-index:1000;
            display:none; overflow:hidden;
        }
        .detail-card.show { display:block; animation:slideUp 0.3s ease; }
        @keyframes slideUp { from{transform:translateY(12px);opacity:0} to{transform:translateY(0);opacity:1} }
        .detail-header {
            padding:12px 16px; display:flex; justify-content:space-between; align-items:flex-start;
            border-bottom:1px solid var(--glass-border);
        }
        .detail-header h2 { font-size:14px; font-weight:700; color:var(--t1); }
        .type-badge {
            padding:3px 8px; background:var(--accent-soft);
            border:1px solid rgba(255,107,53,0.3); border-radius:12px;
            font-size:9px; font-weight:600; color:var(--accent);
            text-transform:uppercase; letter-spacing:0.5px;
        }
        .close-btn {
            width:24px; height:24px; background:rgba(255,255,255,0.06);
            border:none; border-radius:6px; color:var(--t2); font-size:14px;
            cursor:pointer; display:flex; align-items:center; justify-content:center;
        }
        .close-btn:hover { background:rgba(255,255,255,0.1); color:var(--t1); }
        .detail-stats {
            padding:10px 16px; display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px;
        }
        .stat-block { text-align:center; }
        .stat-val { font-size:18px; font-weight:800; color:var(--t1); }
        .stat-lbl { font-size:9px; color:var(--t3); text-transform:uppercase; letter-spacing:0.5px; margin-top:2px; }
        .detail-caps {
            padding:8px 16px 12px; border-top:1px solid var(--glass-border);
        }
        .detail-caps h4 { font-size:9px; color:var(--t3); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px; }
        .cap-chips { display:flex; flex-wrap:wrap; gap:4px; }
        .cap-chip {
            padding:2px 8px; background:rgba(0,212,255,0.08);
            border:1px solid rgba(0,212,255,0.15); border-radius:4px;
            font-size:10px; color:var(--cyan);
        }
        .layers {
            position:absolute; bottom:20px; right:20px; z-index:1000;
            display:flex; flex-direction:column; gap:8px;
        }
        .layer-btn {
            width:44px; height:44px; border-radius:12px;
            display:flex; align-items:center; justify-content:center;
            font-size:18px; cursor:pointer; border:none; position:relative;
            color:var(--t2); background:var(--glass);
            backdrop-filter:blur(24px); border:1px solid var(--glass-border);
            transition:all 0.3s;
        }
        .layer-btn:hover { background:rgba(255,255,255,0.1); color:var(--t1); transform:scale(1.1); }
        .layer-btn.on { background:var(--accent-soft); border-color:var(--accent); color:var(--accent); }
        .layer-btn .tip {
            position:absolute; right:56px; background:var(--glass); border:1px solid var(--glass-border);
            padding:6px 12px; border-radius:8px; font-size:11px; white-space:nowrap;
            opacity:0; pointer-events:none; transition:opacity 0.2s; color:var(--t2);
        }
        .layer-btn:hover .tip { opacity:1; }
        .legend {
            position:absolute; top:20px; right:20px; z-index:999;
            padding:12px 16px; display:none;
        }
        .legend.show { display:block; }
        .legend h4 { font-size:10px; color:var(--t3); text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; }
        .legend-bar {
            width:120px; height:8px; border-radius:4px;
            background:linear-gradient(90deg,rgba(0,0,0,0) 0%,#1a0530 15%,#6b0f6b 30%,#ff4444 50%,#ff9944 70%,#ffee44 85%,#fff 100%);
            margin-bottom:4px;
        }
        .legend-labels { display:flex; justify-content:space-between; font-size:9px; color:var(--t3); }
        .loader {
            position:fixed; inset:0; background:#000; z-index:9999;
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            transition:opacity 1s;
        }
        .loader.gone { opacity:0; pointer-events:none; }
        .loader-icon {
            width:64px; height:64px;
            background:linear-gradient(135deg,var(--accent),#FF8F6B);
            border-radius:16px; display:flex; align-items:center; justify-content:center;
            font-size:32px; margin-bottom:24px; animation:spin 2s ease infinite;
        }
        @keyframes spin { 0%,100%{transform:rotateY(0)} 50%{transform:rotateY(180deg)} }
        .loader-text { font-size:14px; color:var(--t2); letter-spacing:3px; text-transform:uppercase; }
        .loader-bar { width:200px; height:2px; background:rgba(255,255,255,0.1); border-radius:1px; margin-top:16px; overflow:hidden; }
        .loader-fill { height:100%; background:linear-gradient(90deg,var(--accent),#FF8F6B); border-radius:1px; animation:loadbar 2s ease forwards; }
        @keyframes loadbar { from{width:0} to{width:100%} }
        .mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-right{display:none}
        .mapboxgl-popup-content {
            background:var(--glass)!important; backdrop-filter:blur(24px);
            color:var(--t1)!important; border:1px solid var(--glass-border);
            border-radius:12px!important; padding:16px!important;
            box-shadow:0 8px 32px rgba(0,0,0,0.5)!important; min-width:200px;
        }
        .mapboxgl-popup-tip { border-top-color:var(--glass)!important; }
        .mapboxgl-popup-close-button { color:var(--t2)!important; font-size:18px!important; }
    </style>
  <script type="module" crossorigin>var Z6=Object.defineProperty;var W6=(i,e,o)=>e in i?Z6(i,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[e]=o;var Is=(i,e,o)=>W6(i,typeof e!="symbol"?e+"":e,o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))h(l);new MutationObserver(l=>{for(const m of l)if(m.type==="childList")for(const x of m.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&h(x)}).observe(document,{childList:!0,subtree:!0});function o(l){const m={};return l.integrity&&(m.integrity=l.integrity),l.referrerPolicy&&(m.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?m.credentials="include":l.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function h(l){if(l.ep)return;l.ep=!0;const m=o(l);fetch(l.href,m)}})();function $t(i,e,o){function h(s,P){if(s._zod||Object.defineProperty(s,"_zod",{value:{def:P,constr:x,traits:new Set},enumerable:!1}),s._zod.traits.has(i))return;s._zod.traits.add(i),e(s,P);const C=x.prototype,F=Object.keys(C);for(let O=0;O<F.length;O++){const V=F[O];V in s||(s[V]=C[V].bind(s))}}const l=(o==null?void 0:o.Parent)??Object;class m extends l{}Object.defineProperty(m,"name",{value:i});function x(s){var P;const C=o!=null&&o.Parent?new m:this;h(C,s),(P=C._zod).deferred??(P.deferred=[]);for(const F of C._zod.deferred)F();return C}return Object.defineProperty(x,"init",{value:h}),Object.defineProperty(x,Symbol.hasInstance,{value:s=>{var P,C;return o!=null&&o.Parent&&s instanceof o.Parent?!0:(C=(P=s==null?void 0:s._zod)==null?void 0:P.traits)==null?void 0:C.has(i)}}),Object.defineProperty(x,"name",{value:i}),x}class xp extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class EL extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const IL={};function Zu(i){return IL}function ML(i){const e=Object.values(i).filter(h=>typeof h=="number");return Object.entries(i).filter(([h,l])=>e.indexOf(+h)===-1).map(([h,l])=>l)}function AT(i,e){return typeof e=="bigint"?e.toString():e}function Ab(i){return{get value(){{const e=i();return Object.defineProperty(this,"value",{value:e}),e}}}}function TE(i){return i==null}function EE(i){const e=i.startsWith("^")?1:0,o=i.endsWith("$")?i.length-1:i.length;return i.slice(e,o)}function q6(i,e){const o=(i.toString().split(".")[1]||"").length,h=e.toString();let l=(h.split(".")[1]||"").length;if(l===0&&/\d?e-\d?/.test(h)){const P=h.match(/\d?e-(\d?)/);P!=null&&P[1]&&(l=Number.parseInt(P[1]))}const m=o>l?o:l,x=Number.parseInt(i.toFixed(m).replace(".","")),s=Number.parseInt(e.toFixed(m).replace(".",""));return x%s/10**m}const VC=Symbol("evaluating");function Mr(i,e,o){let h;Object.defineProperty(i,e,{get(){if(h!==VC)return h===void 0&&(h=VC,h=o()),h},set(l){Object.defineProperty(i,e,{value:l})},configurable:!0})}function xd(i,e,o){Object.defineProperty(i,e,{value:o,writable:!0,enumerable:!0,configurable:!0})}function Qu(...i){const e={};for(const o of i){const h=Object.getOwnPropertyDescriptors(o);Object.assign(e,h)}return Object.defineProperties({},e)}function jC(i){return JSON.stringify(i)}function X6(i){return i.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const AL="captureStackTrace"in Error?Error.captureStackTrace:(...i)=>{};function P_(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}const J6=Ab(()=>{var i;if(typeof navigator<"u"&&((i=navigator==null?void 0:navigator.userAgent)!=null&&i.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Ip(i){if(P_(i)===!1)return!1;const e=i.constructor;if(e===void 0||typeof e!="function")return!0;const o=e.prototype;return!(P_(o)===!1||Object.prototype.hasOwnProperty.call(o,"isPrototypeOf")===!1)}function PL(i){return Ip(i)?{...i}:Array.isArray(i)?[...i]:i}const Y6=new Set(["string","number","symbol"]);function Mp(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function eh(i,e,o){const h=new i._zod.constr(e??i._zod.def);return(!e||o!=null&&o.parent)&&(h._zod.parent=i),h}function Ki(i){const e=i;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function K6(i){return Object.keys(i).filter(e=>i[e]._zod.optin==="optional"&&i[e]._zod.optout==="optional")}const Q6={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function ej(i,e){const o=i._zod.def,h=o.checks;if(h&&h.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const m=Qu(i._zod.def,{get shape(){const x={};for(const s in e){if(!(s in o.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&(x[s]=o.shape[s])}return xd(this,"shape",x),x},checks:[]});return eh(i,m)}function tj(i,e){const o=i._zod.def,h=o.checks;if(h&&h.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const m=Qu(i._zod.def,{get shape(){const x={...i._zod.def.shape};for(const s in e){if(!(s in o.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&delete x[s]}return xd(this,"shape",x),x},checks:[]});return eh(i,m)}function ij(i,e){if(!Ip(e))throw new Error("Invalid input to extend: expected a plain object");const o=i._zod.def.checks;if(o&&o.length>0){const m=i._zod.def.shape;for(const x in e)if(Object.getOwnPropertyDescriptor(m,x)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const l=Qu(i._zod.def,{get shape(){const m={...i._zod.def.shape,...e};return xd(this,"shape",m),m}});return eh(i,l)}function nj(i,e){if(!Ip(e))throw new Error("Invalid input to safeExtend: expected a plain object");const o=Qu(i._zod.def,{get shape(){const h={...i._zod.def.shape,...e};return xd(this,"shape",h),h}});return eh(i,o)}function rj(i,e){const o=Qu(i._zod.def,{get shape(){const h={...i._zod.def.shape,...e._zod.def.shape};return xd(this,"shape",h),h},get catchall(){return e._zod.def.catchall},checks:[]});return eh(i,o)}function oj(i,e,o){const l=e._zod.def.checks;if(l&&l.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const x=Qu(e._zod.def,{get shape(){const s=e._zod.def.shape,P={...s};if(o)for(const C in o){if(!(C in s))throw new Error(`Unrecognized key: "${C}"`);o[C]&&(P[C]=i?new i({type:"optional",innerType:s[C]}):s[C])}else for(const C in s)P[C]=i?new i({type:"optional",innerType:s[C]}):s[C];return xd(this,"shape",P),P},checks:[]});return eh(e,x)}function sj(i,e,o){const h=Qu(e._zod.def,{get shape(){const l=e._zod.def.shape,m={...l};if(o)for(const x in o){if(!(x in m))throw new Error(`Unrecognized key: "${x}"`);o[x]&&(m[x]=new i({type:"nonoptional",innerType:l[x]}))}else for(const x in l)m[x]=new i({type:"nonoptional",innerType:l[x]});return xd(this,"shape",m),m}});return eh(e,h)}function gp(i,e=0){var o;if(i.aborted===!0)return!0;for(let h=e;h<i.issues.length;h++)if(((o=i.issues[h])==null?void 0:o.continue)!==!0)return!0;return!1}function _p(i,e){return e.map(o=>{var h;return(h=o).path??(h.path=[]),o.path.unshift(i),o})}function c0(i){return typeof i=="string"?i:i==null?void 0:i.message}function Wu(i,e,o){var l,m,x,s,P,C;const h={...i,path:i.path??[]};if(!i.message){const F=c0((x=(m=(l=i.inst)==null?void 0:l._zod.def)==null?void 0:m.error)==null?void 0:x.call(m,i))??c0((s=e==null?void 0:e.error)==null?void 0:s.call(e,i))??c0((P=o.customError)==null?void 0:P.call(o,i))??c0((C=o.localeError)==null?void 0:C.call(o,i))??"Invalid input";h.message=F}return delete h.inst,delete h.continue,e!=null&&e.reportInput||delete h.input,h}function IE(i){return Array.isArray(i)?"array":typeof i=="string"?"string":"unknown"}function z_(...i){const[e,o,h]=i;return typeof e=="string"?{message:e,code:"custom",input:o,inst:h}:{...e}}const zL=(i,e)=>{i.name="$ZodError",Object.defineProperty(i,"_zod",{value:i._zod,enumerable:!1}),Object.defineProperty(i,"issues",{value:e,enumerable:!1}),i.message=JSON.stringify(e,AT,2),Object.defineProperty(i,"toString",{value:()=>i.message,enumerable:!1})},CL=$t("$ZodError",zL),RL=$t("$ZodError",zL,{Parent:Error});function aj(i,e=o=>o.message){const o={},h=[];for(const l of i.issues)l.path.length>0?(o[l.path[0]]=o[l.path[0]]||[],o[l.path[0]].push(e(l))):h.push(e(l));return{formErrors:h,fieldErrors:o}}function lj(i,e=o=>o.message){const o={_errors:[]},h=l=>{for(const m of l.issues)if(m.code==="invalid_union"&&m.errors.length)m.errors.map(x=>h({issues:x}));else if(m.code==="invalid_key")h({issues:m.issues});else if(m.code==="invalid_element")h({issues:m.issues});else if(m.path.length===0)o._errors.push(e(m));else{let x=o,s=0;for(;s<m.path.length;){const P=m.path[s];s===m.path.length-1?(x[P]=x[P]||{_errors:[]},x[P]._errors.push(e(m))):x[P]=x[P]||{_errors:[]},x=x[P],s++}}};return h(i),o}const ME=i=>(e,o,h,l)=>{const m=h?Object.assign(h,{async:!1}):{async:!1},x=e._zod.run({value:o,issues:[]},m);if(x instanceof Promise)throw new xp;if(x.issues.length){const s=new((l==null?void 0:l.Err)??i)(x.issues.map(P=>Wu(P,m,Zu())));throw AL(s,l==null?void 0:l.callee),s}return x.value},AE=i=>async(e,o,h,l)=>{const m=h?Object.assign(h,{async:!0}):{async:!0};let x=e._zod.run({value:o,issues:[]},m);if(x instanceof Promise&&(x=await x),x.issues.length){const s=new((l==null?void 0:l.Err)??i)(x.issues.map(P=>Wu(P,m,Zu())));throw AL(s,l==null?void 0:l.callee),s}return x.value},Pb=i=>(e,o,h)=>{const l=h?{...h,async:!1}:{async:!1},m=e._zod.run({value:o,issues:[]},l);if(m instanceof Promise)throw new xp;return m.issues.length?{success:!1,error:new(i??CL)(m.issues.map(x=>Wu(x,l,Zu())))}:{success:!0,data:m.value}},LL=Pb(RL),zb=i=>async(e,o,h)=>{const l=h?Object.assign(h,{async:!0}):{async:!0};let m=e._zod.run({value:o,issues:[]},l);return m instanceof Promise&&(m=await m),m.issues.length?{success:!1,error:new i(m.issues.map(x=>Wu(x,l,Zu())))}:{success:!0,data:m.value}},cj=zb(RL),uj=i=>(e,o,h)=>{const l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return ME(i)(e,o,l)},hj=i=>(e,o,h)=>ME(i)(e,o,h),dj=i=>async(e,o,h)=>{const l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return AE(i)(e,o,l)},fj=i=>async(e,o,h)=>AE(i)(e,o,h),pj=i=>(e,o,h)=>{const l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return Pb(i)(e,o,l)},mj=i=>(e,o,h)=>Pb(i)(e,o,h),gj=i=>async(e,o,h)=>{const l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return zb(i)(e,o,l)},_j=i=>async(e,o,h)=>zb(i)(e,o,h),yj=/^[cC][^\s-]{8,}$/,vj=/^[0-9a-z]+$/,xj=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,bj=/^[0-9a-vA-V]{20}$/,wj=/^[A-Za-z0-9]{27}$/,Sj=/^[a-zA-Z0-9_-]{21}$/,Tj=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Ej=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,GC=i=>i?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${i}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Ij=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Mj="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Aj(){return new RegExp(Mj,"u")}const Pj=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,zj=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,Cj=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Rj=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Lj=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,DL=/^[A-Za-z0-9_-]*$/,Dj=/^\+[1-9]\d{6,14}$/,kL="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",kj=new RegExp(`^${kL}$`);function OL(i){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof i.precision=="number"?i.precision===-1?`${e}`:i.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${i.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Oj(i){return new RegExp(`^${OL(i)}$`)}function Fj(i){const e=OL({precision:i.precision}),o=["Z"];i.local&&o.push(""),i.offset&&o.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const h=`${e}(?:${o.join("|")})`;return new RegExp(`^${kL}T(?:${h})$`)}const Bj=i=>{const e=i?`[\\s\\S]{${(i==null?void 0:i.minimum)??0},${(i==null?void 0:i.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},Nj=/^-?\d+$/,FL=/^-?\d+(?:\.\d+)?$/,Uj=/^(?:true|false)$/i,$j=/^null$/i,Vj=/^[^A-Z]*$/,jj=/^[^a-z]*$/,ua=$t("$ZodCheck",(i,e)=>{var o;i._zod??(i._zod={}),i._zod.def=e,(o=i._zod).onattach??(o.onattach=[])}),BL={number:"number",bigint:"bigint",object:"date"},NL=$t("$ZodCheckLessThan",(i,e)=>{ua.init(i,e);const o=BL[typeof e.value];i._zod.onattach.push(h=>{const l=h._zod.bag,m=(e.inclusive?l.maximum:l.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<m&&(e.inclusive?l.maximum=e.value:l.exclusiveMaximum=e.value)}),i._zod.check=h=>{(e.inclusive?h.value<=e.value:h.value<e.value)||h.issues.push({origin:o,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:h.value,inclusive:e.inclusive,inst:i,continue:!e.abort})}}),UL=$t("$ZodCheckGreaterThan",(i,e)=>{ua.init(i,e);const o=BL[typeof e.value];i._zod.onattach.push(h=>{const l=h._zod.bag,m=(e.inclusive?l.minimum:l.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>m&&(e.inclusive?l.minimum=e.value:l.exclusiveMinimum=e.value)}),i._zod.check=h=>{(e.inclusive?h.value>=e.value:h.value>e.value)||h.issues.push({origin:o,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:h.value,inclusive:e.inclusive,inst:i,continue:!e.abort})}}),Gj=$t("$ZodCheckMultipleOf",(i,e)=>{ua.init(i,e),i._zod.onattach.push(o=>{var h;(h=o._zod.bag).multipleOf??(h.multipleOf=e.value)}),i._zod.check=o=>{if(typeof o.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof o.value=="bigint"?o.value%e.value===BigInt(0):q6(o.value,e.value)===0)||o.issues.push({origin:typeof o.value,code:"not_multiple_of",divisor:e.value,input:o.value,inst:i,continue:!e.abort})}}),Hj=$t("$ZodCheckNumberFormat",(i,e)=>{var x;ua.init(i,e),e.format=e.format||"float64";const o=(x=e.format)==null?void 0:x.includes("int"),h=o?"int":"number",[l,m]=Q6[e.format];i._zod.onattach.push(s=>{const P=s._zod.bag;P.format=e.format,P.minimum=l,P.maximum=m,o&&(P.pattern=Nj)}),i._zod.check=s=>{const P=s.value;if(o){if(!Number.isInteger(P)){s.issues.push({expected:h,format:e.format,code:"invalid_type",continue:!1,input:P,inst:i});return}if(!Number.isSafeInteger(P)){P>0?s.issues.push({input:P,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:i,origin:h,inclusive:!0,continue:!e.abort}):s.issues.push({input:P,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:i,origin:h,inclusive:!0,continue:!e.abort});return}}P<l&&s.issues.push({origin:"number",input:P,code:"too_small",minimum:l,inclusive:!0,inst:i,continue:!e.abort}),P>m&&s.issues.push({origin:"number",input:P,code:"too_big",maximum:m,inclusive:!0,inst:i,continue:!e.abort})}}),Zj=$t("$ZodCheckMaxLength",(i,e)=>{var o;ua.init(i,e),(o=i._zod.def).when??(o.when=h=>{const l=h.value;return!TE(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{const l=h._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<l&&(h._zod.bag.maximum=e.maximum)}),i._zod.check=h=>{const l=h.value;if(l.length<=e.maximum)return;const x=IE(l);h.issues.push({origin:x,code:"too_big",maximum:e.maximum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),Wj=$t("$ZodCheckMinLength",(i,e)=>{var o;ua.init(i,e),(o=i._zod.def).when??(o.when=h=>{const l=h.value;return!TE(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{const l=h._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>l&&(h._zod.bag.minimum=e.minimum)}),i._zod.check=h=>{const l=h.value;if(l.length>=e.minimum)return;const x=IE(l);h.issues.push({origin:x,code:"too_small",minimum:e.minimum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),qj=$t("$ZodCheckLengthEquals",(i,e)=>{var o;ua.init(i,e),(o=i._zod.def).when??(o.when=h=>{const l=h.value;return!TE(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{const l=h._zod.bag;l.minimum=e.length,l.maximum=e.length,l.length=e.length}),i._zod.check=h=>{const l=h.value,m=l.length;if(m===e.length)return;const x=IE(l),s=m>e.length;h.issues.push({origin:x,...s?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:h.value,inst:i,continue:!e.abort})}}),Cb=$t("$ZodCheckStringFormat",(i,e)=>{var o,h;ua.init(i,e),i._zod.onattach.push(l=>{const m=l._zod.bag;m.format=e.format,e.pattern&&(m.patterns??(m.patterns=new Set),m.patterns.add(e.pattern))}),e.pattern?(o=i._zod).check??(o.check=l=>{e.pattern.lastIndex=0,!e.pattern.test(l.value)&&l.issues.push({origin:"string",code:"invalid_format",format:e.format,input:l.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:i,continue:!e.abort})}):(h=i._zod).check??(h.check=()=>{})}),Xj=$t("$ZodCheckRegex",(i,e)=>{Cb.init(i,e),i._zod.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:"regex",input:o.value,pattern:e.pattern.toString(),inst:i,continue:!e.abort})}}),Jj=$t("$ZodCheckLowerCase",(i,e)=>{e.pattern??(e.pattern=Vj),Cb.init(i,e)}),Yj=$t("$ZodCheckUpperCase",(i,e)=>{e.pattern??(e.pattern=jj),Cb.init(i,e)}),Kj=$t("$ZodCheckIncludes",(i,e)=>{ua.init(i,e);const o=Mp(e.includes),h=new RegExp(typeof e.position=="number"?`^.{${e.position}}${o}`:o);e.pattern=h,i._zod.onattach.push(l=>{const m=l._zod.bag;m.patterns??(m.patterns=new Set),m.patterns.add(h)}),i._zod.check=l=>{l.value.includes(e.includes,e.position)||l.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:l.value,inst:i,continue:!e.abort})}}),Qj=$t("$ZodCheckStartsWith",(i,e)=>{ua.init(i,e);const o=new RegExp(`^${Mp(e.prefix)}.*`);e.pattern??(e.pattern=o),i._zod.onattach.push(h=>{const l=h._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(o)}),i._zod.check=h=>{h.value.startsWith(e.prefix)||h.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:h.value,inst:i,continue:!e.abort})}}),eG=$t("$ZodCheckEndsWith",(i,e)=>{ua.init(i,e);const o=new RegExp(`.*${Mp(e.suffix)}$`);e.pattern??(e.pattern=o),i._zod.onattach.push(h=>{const l=h._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(o)}),i._zod.check=h=>{h.value.endsWith(e.suffix)||h.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:h.value,inst:i,continue:!e.abort})}}),tG=$t("$ZodCheckOverwrite",(i,e)=>{ua.init(i,e),i._zod.check=o=>{o.value=e.tx(o.value)}});class iG{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const h=e.split(`
`).filter(x=>x),l=Math.min(...h.map(x=>x.length-x.trimStart().length)),m=h.map(x=>x.slice(l)).map(x=>" ".repeat(this.indent*2)+x);for(const x of m)this.content.push(x)}compile(){const e=Function,o=this==null?void 0:this.args,l=[...((this==null?void 0:this.content)??[""]).map(m=>`  ${m}`)];return new e(...o,l.join(`
`))}}const nG={major:4,minor:3,patch:6},to=$t("$ZodType",(i,e)=>{var l;var o;i??(i={}),i._zod.def=e,i._zod.bag=i._zod.bag||{},i._zod.version=nG;const h=[...i._zod.def.checks??[]];i._zod.traits.has("$ZodCheck")&&h.unshift(i);for(const m of h)for(const x of m._zod.onattach)x(i);if(h.length===0)(o=i._zod).deferred??(o.deferred=[]),(l=i._zod.deferred)==null||l.push(()=>{i._zod.run=i._zod.parse});else{const m=(s,P,C)=>{let F=gp(s),O;for(const V of P){if(V._zod.def.when){if(!V._zod.def.when(s))continue}else if(F)continue;const J=s.issues.length,ee=V._zod.check(s);if(ee instanceof Promise&&(C==null?void 0:C.async)===!1)throw new xp;if(O||ee instanceof Promise)O=(O??Promise.resolve()).then(async()=>{await ee,s.issues.length!==J&&(F||(F=gp(s,J)))});else{if(s.issues.length===J)continue;F||(F=gp(s,J))}}return O?O.then(()=>s):s},x=(s,P,C)=>{if(gp(s))return s.aborted=!0,s;const F=m(P,h,C);if(F instanceof Promise){if(C.async===!1)throw new xp;return F.then(O=>i._zod.parse(O,C))}return i._zod.parse(F,C)};i._zod.run=(s,P)=>{if(P.skipChecks)return i._zod.parse(s,P);if(P.direction==="backward"){const F=i._zod.parse({value:s.value,issues:[]},{...P,skipChecks:!0});return F instanceof Promise?F.then(O=>x(O,s,P)):x(F,s,P)}const C=i._zod.parse(s,P);if(C instanceof Promise){if(P.async===!1)throw new xp;return C.then(F=>m(F,h,P))}return m(C,h,P)}}Mr(i,"~standard",()=>({validate:m=>{var x;try{const s=LL(i,m);return s.success?{value:s.data}:{issues:(x=s.error)==null?void 0:x.issues}}catch{return cj(i,m).then(P=>{var C;return P.success?{value:P.data}:{issues:(C=P.error)==null?void 0:C.issues}})}},vendor:"zod",version:1}))}),PE=$t("$ZodString",(i,e)=>{var o;to.init(i,e),i._zod.pattern=[...((o=i==null?void 0:i._zod.bag)==null?void 0:o.patterns)??[]].pop()??Bj(i._zod.bag),i._zod.parse=(h,l)=>{if(e.coerce)try{h.value=String(h.value)}catch{}return typeof h.value=="string"||h.issues.push({expected:"string",code:"invalid_type",input:h.value,inst:i}),h}}),io=$t("$ZodStringFormat",(i,e)=>{Cb.init(i,e),PE.init(i,e)}),rG=$t("$ZodGUID",(i,e)=>{e.pattern??(e.pattern=Ej),io.init(i,e)}),oG=$t("$ZodUUID",(i,e)=>{if(e.version){const h={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(h===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=GC(h))}else e.pattern??(e.pattern=GC());io.init(i,e)}),sG=$t("$ZodEmail",(i,e)=>{e.pattern??(e.pattern=Ij),io.init(i,e)}),aG=$t("$ZodURL",(i,e)=>{io.init(i,e),i._zod.check=o=>{try{const h=o.value.trim(),l=new URL(h);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(l.hostname)||o.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:o.value,inst:i,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(l.protocol.endsWith(":")?l.protocol.slice(0,-1):l.protocol)||o.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:o.value,inst:i,continue:!e.abort})),e.normalize?o.value=l.href:o.value=h;return}catch{o.issues.push({code:"invalid_format",format:"url",input:o.value,inst:i,continue:!e.abort})}}}),lG=$t("$ZodEmoji",(i,e)=>{e.pattern??(e.pattern=Aj()),io.init(i,e)}),cG=$t("$ZodNanoID",(i,e)=>{e.pattern??(e.pattern=Sj),io.init(i,e)}),uG=$t("$ZodCUID",(i,e)=>{e.pattern??(e.pattern=yj),io.init(i,e)}),hG=$t("$ZodCUID2",(i,e)=>{e.pattern??(e.pattern=vj),io.init(i,e)}),dG=$t("$ZodULID",(i,e)=>{e.pattern??(e.pattern=xj),io.init(i,e)}),fG=$t("$ZodXID",(i,e)=>{e.pattern??(e.pattern=bj),io.init(i,e)}),pG=$t("$ZodKSUID",(i,e)=>{e.pattern??(e.pattern=wj),io.init(i,e)}),mG=$t("$ZodISODateTime",(i,e)=>{e.pattern??(e.pattern=Fj(e)),io.init(i,e)}),gG=$t("$ZodISODate",(i,e)=>{e.pattern??(e.pattern=kj),io.init(i,e)}),_G=$t("$ZodISOTime",(i,e)=>{e.pattern??(e.pattern=Oj(e)),io.init(i,e)}),yG=$t("$ZodISODuration",(i,e)=>{e.pattern??(e.pattern=Tj),io.init(i,e)}),vG=$t("$ZodIPv4",(i,e)=>{e.pattern??(e.pattern=Pj),io.init(i,e),i._zod.bag.format="ipv4"}),xG=$t("$ZodIPv6",(i,e)=>{e.pattern??(e.pattern=zj),io.init(i,e),i._zod.bag.format="ipv6",i._zod.check=o=>{try{new URL(`http://[${o.value}]`)}catch{o.issues.push({code:"invalid_format",format:"ipv6",input:o.value,inst:i,continue:!e.abort})}}}),bG=$t("$ZodCIDRv4",(i,e)=>{e.pattern??(e.pattern=Cj),io.init(i,e)}),wG=$t("$ZodCIDRv6",(i,e)=>{e.pattern??(e.pattern=Rj),io.init(i,e),i._zod.check=o=>{const h=o.value.split("/");try{if(h.length!==2)throw new Error;const[l,m]=h;if(!m)throw new Error;const x=Number(m);if(`${x}`!==m)throw new Error;if(x<0||x>128)throw new Error;new URL(`http://[${l}]`)}catch{o.issues.push({code:"invalid_format",format:"cidrv6",input:o.value,inst:i,continue:!e.abort})}}});function $L(i){if(i==="")return!0;if(i.length%4!==0)return!1;try{return atob(i),!0}catch{return!1}}const SG=$t("$ZodBase64",(i,e)=>{e.pattern??(e.pattern=Lj),io.init(i,e),i._zod.bag.contentEncoding="base64",i._zod.check=o=>{$L(o.value)||o.issues.push({code:"invalid_format",format:"base64",input:o.value,inst:i,continue:!e.abort})}});function TG(i){if(!DL.test(i))return!1;const e=i.replace(/[-_]/g,h=>h==="-"?"+":"/"),o=e.padEnd(Math.ceil(e.length/4)*4,"=");return $L(o)}const EG=$t("$ZodBase64URL",(i,e)=>{e.pattern??(e.pattern=DL),io.init(i,e),i._zod.bag.contentEncoding="base64url",i._zod.check=o=>{TG(o.value)||o.issues.push({code:"invalid_format",format:"base64url",input:o.value,inst:i,continue:!e.abort})}}),IG=$t("$ZodE164",(i,e)=>{e.pattern??(e.pattern=Dj),io.init(i,e)});function MG(i,e=null){try{const o=i.split(".");if(o.length!==3)return!1;const[h]=o;if(!h)return!1;const l=JSON.parse(atob(h));return!("typ"in l&&(l==null?void 0:l.typ)!=="JWT"||!l.alg||e&&(!("alg"in l)||l.alg!==e))}catch{return!1}}const AG=$t("$ZodJWT",(i,e)=>{io.init(i,e),i._zod.check=o=>{MG(o.value,e.alg)||o.issues.push({code:"invalid_format",format:"jwt",input:o.value,inst:i,continue:!e.abort})}}),VL=$t("$ZodNumber",(i,e)=>{to.init(i,e),i._zod.pattern=i._zod.bag.pattern??FL,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=Number(o.value)}catch{}const l=o.value;if(typeof l=="number"&&!Number.isNaN(l)&&Number.isFinite(l))return o;const m=typeof l=="number"?Number.isNaN(l)?"NaN":Number.isFinite(l)?void 0:"Infinity":void 0;return o.issues.push({expected:"number",code:"invalid_type",input:l,inst:i,...m?{received:m}:{}}),o}}),PG=$t("$ZodNumberFormat",(i,e)=>{Hj.init(i,e),VL.init(i,e)}),zG=$t("$ZodBoolean",(i,e)=>{to.init(i,e),i._zod.pattern=Uj,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=!!o.value}catch{}const l=o.value;return typeof l=="boolean"||o.issues.push({expected:"boolean",code:"invalid_type",input:l,inst:i}),o}}),CG=$t("$ZodNull",(i,e)=>{to.init(i,e),i._zod.pattern=$j,i._zod.values=new Set([null]),i._zod.parse=(o,h)=>{const l=o.value;return l===null||o.issues.push({expected:"null",code:"invalid_type",input:l,inst:i}),o}}),RG=$t("$ZodUnknown",(i,e)=>{to.init(i,e),i._zod.parse=o=>o}),LG=$t("$ZodNever",(i,e)=>{to.init(i,e),i._zod.parse=(o,h)=>(o.issues.push({expected:"never",code:"invalid_type",input:o.value,inst:i}),o)});function HC(i,e,o){i.issues.length&&e.issues.push(..._p(o,i.issues)),e.value[o]=i.value}const DG=$t("$ZodArray",(i,e)=>{to.init(i,e),i._zod.parse=(o,h)=>{const l=o.value;if(!Array.isArray(l))return o.issues.push({expected:"array",code:"invalid_type",input:l,inst:i}),o;o.value=Array(l.length);const m=[];for(let x=0;x<l.length;x++){const s=l[x],P=e.element._zod.run({value:s,issues:[]},h);P instanceof Promise?m.push(P.then(C=>HC(C,o,x))):HC(P,o,x)}return m.length?Promise.all(m).then(()=>o):o}});function X0(i,e,o,h,l){if(i.issues.length){if(l&&!(o in h))return;e.issues.push(..._p(o,i.issues))}i.value===void 0?o in h&&(e.value[o]=void 0):e.value[o]=i.value}function jL(i){var h,l,m,x;const e=Object.keys(i.shape);for(const s of e)if(!((x=(m=(l=(h=i.shape)==null?void 0:h[s])==null?void 0:l._zod)==null?void 0:m.traits)!=null&&x.has("$ZodType")))throw new Error(`Invalid element at key "${s}": expected a Zod schema`);const o=K6(i.shape);return{...i,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(o)}}function GL(i,e,o,h,l,m){const x=[],s=l.keySet,P=l.catchall._zod,C=P.def.type,F=P.optout==="optional";for(const O in e){if(s.has(O))continue;if(C==="never"){x.push(O);continue}const V=P.run({value:e[O],issues:[]},h);V instanceof Promise?i.push(V.then(J=>X0(J,o,O,e,F))):X0(V,o,O,e,F)}return x.length&&o.issues.push({code:"unrecognized_keys",keys:x,input:e,inst:m}),i.length?Promise.all(i).then(()=>o):o}const kG=$t("$ZodObject",(i,e)=>{to.init(i,e);const o=Object.getOwnPropertyDescriptor(e,"shape");if(!(o!=null&&o.get)){const s=e.shape;Object.defineProperty(e,"shape",{get:()=>{const P={...s};return Object.defineProperty(e,"shape",{value:P}),P}})}const h=Ab(()=>jL(e));Mr(i._zod,"propValues",()=>{const s=e.shape,P={};for(const C in s){const F=s[C]._zod;if(F.values){P[C]??(P[C]=new Set);for(const O of F.values)P[C].add(O)}}return P});const l=P_,m=e.catchall;let x;i._zod.parse=(s,P)=>{x??(x=h.value);const C=s.value;if(!l(C))return s.issues.push({expected:"object",code:"invalid_type",input:C,inst:i}),s;s.value={};const F=[],O=x.shape;for(const V of x.keys){const J=O[V],ee=J._zod.optout==="optional",se=J._zod.run({value:C[V],issues:[]},P);se instanceof Promise?F.push(se.then(fe=>X0(fe,s,V,C,ee))):X0(se,s,V,C,ee)}return m?GL(F,C,s,P,h.value,i):F.length?Promise.all(F).then(()=>s):s}}),OG=$t("$ZodObjectJIT",(i,e)=>{kG.init(i,e);const o=i._zod.parse,h=Ab(()=>jL(e)),l=V=>{var it;const J=new iG(["shape","payload","ctx"]),ee=h.value,se=Ve=>{const Ne=jC(Ve);return`shape[${Ne}]._zod.run({ value: input[${Ne}], issues: [] }, ctx)`};J.write("const input = payload.value;");const fe=Object.create(null);let le=0;for(const Ve of ee.keys)fe[Ve]=`key_${le++}`;J.write("const newResult = {};");for(const Ve of ee.keys){const Ne=fe[Ve],Re=jC(Ve),Ye=V[Ve],zt=((it=Ye==null?void 0:Ye._zod)==null?void 0:it.optout)==="optional";J.write(`const ${Ne} = ${se(Ve)};`),zt?J.write(`
        if (${Ne}.issues.length) {
          if (${Re} in input) {
            payload.issues = payload.issues.concat(${Ne}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${Re}, ...iss.path] : [${Re}]
            })));
          }
        }
        
        if (${Ne}.value === undefined) {
          if (${Re} in input) {
            newResult[${Re}] = undefined;
          }
        } else {
          newResult[${Re}] = ${Ne}.value;
        }
        
      `):J.write(`
        if (${Ne}.issues.length) {
          payload.issues = payload.issues.concat(${Ne}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Re}, ...iss.path] : [${Re}]
          })));
        }
        
        if (${Ne}.value === undefined) {
          if (${Re} in input) {
            newResult[${Re}] = undefined;
          }
        } else {
          newResult[${Re}] = ${Ne}.value;
        }
        
      `)}J.write("payload.value = newResult;"),J.write("return payload;");const ie=J.compile();return(Ve,Ne)=>ie(V,Ve,Ne)};let m;const x=P_,s=!IL.jitless,C=s&&J6.value,F=e.catchall;let O;i._zod.parse=(V,J)=>{O??(O=h.value);const ee=V.value;return x(ee)?s&&C&&(J==null?void 0:J.async)===!1&&J.jitless!==!0?(m||(m=l(e.shape)),V=m(V,J),F?GL([],ee,V,J,O,i):V):o(V,J):(V.issues.push({expected:"object",code:"invalid_type",input:ee,inst:i}),V)}});function ZC(i,e,o,h){for(const m of i)if(m.issues.length===0)return e.value=m.value,e;const l=i.filter(m=>!gp(m));return l.length===1?(e.value=l[0].value,l[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:o,errors:i.map(m=>m.issues.map(x=>Wu(x,h,Zu())))}),e)}const HL=$t("$ZodUnion",(i,e)=>{to.init(i,e),Mr(i._zod,"optin",()=>e.options.some(l=>l._zod.optin==="optional")?"optional":void 0),Mr(i._zod,"optout",()=>e.options.some(l=>l._zod.optout==="optional")?"optional":void 0),Mr(i._zod,"values",()=>{if(e.options.every(l=>l._zod.values))return new Set(e.options.flatMap(l=>Array.from(l._zod.values)))}),Mr(i._zod,"pattern",()=>{if(e.options.every(l=>l._zod.pattern)){const l=e.options.map(m=>m._zod.pattern);return new RegExp(`^(${l.map(m=>EE(m.source)).join("|")})$`)}});const o=e.options.length===1,h=e.options[0]._zod.run;i._zod.parse=(l,m)=>{if(o)return h(l,m);let x=!1;const s=[];for(const P of e.options){const C=P._zod.run({value:l.value,issues:[]},m);if(C instanceof Promise)s.push(C),x=!0;else{if(C.issues.length===0)return C;s.push(C)}}return x?Promise.all(s).then(P=>ZC(P,l,i,m)):ZC(s,l,i,m)}}),FG=$t("$ZodDiscriminatedUnion",(i,e)=>{e.inclusive=!1,HL.init(i,e);const o=i._zod.parse;Mr(i._zod,"propValues",()=>{const l={};for(const m of e.options){const x=m._zod.propValues;if(!x||Object.keys(x).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(m)}"`);for(const[s,P]of Object.entries(x)){l[s]||(l[s]=new Set);for(const C of P)l[s].add(C)}}return l});const h=Ab(()=>{var x;const l=e.options,m=new Map;for(const s of l){const P=(x=s._zod.propValues)==null?void 0:x[e.discriminator];if(!P||P.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(const C of P){if(m.has(C))throw new Error(`Duplicate discriminator value "${String(C)}"`);m.set(C,s)}}return m});i._zod.parse=(l,m)=>{const x=l.value;if(!P_(x))return l.issues.push({code:"invalid_type",expected:"object",input:x,inst:i}),l;const s=h.value.get(x==null?void 0:x[e.discriminator]);return s?s._zod.run(l,m):e.unionFallback?o(l,m):(l.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:x,path:[e.discriminator],inst:i}),l)}}),BG=$t("$ZodIntersection",(i,e)=>{to.init(i,e),i._zod.parse=(o,h)=>{const l=o.value,m=e.left._zod.run({value:l,issues:[]},h),x=e.right._zod.run({value:l,issues:[]},h);return m instanceof Promise||x instanceof Promise?Promise.all([m,x]).then(([P,C])=>WC(o,P,C)):WC(o,m,x)}});function PT(i,e){if(i===e)return{valid:!0,data:i};if(i instanceof Date&&e instanceof Date&&+i==+e)return{valid:!0,data:i};if(Ip(i)&&Ip(e)){const o=Object.keys(e),h=Object.keys(i).filter(m=>o.indexOf(m)!==-1),l={...i,...e};for(const m of h){const x=PT(i[m],e[m]);if(!x.valid)return{valid:!1,mergeErrorPath:[m,...x.mergeErrorPath]};l[m]=x.data}return{valid:!0,data:l}}if(Array.isArray(i)&&Array.isArray(e)){if(i.length!==e.length)return{valid:!1,mergeErrorPath:[]};const o=[];for(let h=0;h<i.length;h++){const l=i[h],m=e[h],x=PT(l,m);if(!x.valid)return{valid:!1,mergeErrorPath:[h,...x.mergeErrorPath]};o.push(x.data)}return{valid:!0,data:o}}return{valid:!1,mergeErrorPath:[]}}function WC(i,e,o){const h=new Map;let l;for(const s of e.issues)if(s.code==="unrecognized_keys"){l??(l=s);for(const P of s.keys)h.has(P)||h.set(P,{}),h.get(P).l=!0}else i.issues.push(s);for(const s of o.issues)if(s.code==="unrecognized_keys")for(const P of s.keys)h.has(P)||h.set(P,{}),h.get(P).r=!0;else i.issues.push(s);const m=[...h].filter(([,s])=>s.l&&s.r).map(([s])=>s);if(m.length&&l&&i.issues.push({...l,keys:m}),gp(i))return i;const x=PT(e.value,o.value);if(!x.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(x.mergeErrorPath)}`);return i.value=x.data,i}const NG=$t("$ZodRecord",(i,e)=>{to.init(i,e),i._zod.parse=(o,h)=>{const l=o.value;if(!Ip(l))return o.issues.push({expected:"record",code:"invalid_type",input:l,inst:i}),o;const m=[],x=e.keyType._zod.values;if(x){o.value={};const s=new Set;for(const C of x)if(typeof C=="string"||typeof C=="number"||typeof C=="symbol"){s.add(typeof C=="number"?C.toString():C);const F=e.valueType._zod.run({value:l[C],issues:[]},h);F instanceof Promise?m.push(F.then(O=>{O.issues.length&&o.issues.push(..._p(C,O.issues)),o.value[C]=O.value})):(F.issues.length&&o.issues.push(..._p(C,F.issues)),o.value[C]=F.value)}let P;for(const C in l)s.has(C)||(P=P??[],P.push(C));P&&P.length>0&&o.issues.push({code:"unrecognized_keys",input:l,inst:i,keys:P})}else{o.value={};for(const s of Reflect.ownKeys(l)){if(s==="__proto__")continue;let P=e.keyType._zod.run({value:s,issues:[]},h);if(P instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof s=="string"&&FL.test(s)&&P.issues.length){const O=e.keyType._zod.run({value:Number(s),issues:[]},h);if(O instanceof Promise)throw new Error("Async schemas not supported in object keys currently");O.issues.length===0&&(P=O)}if(P.issues.length){e.mode==="loose"?o.value[s]=l[s]:o.issues.push({code:"invalid_key",origin:"record",issues:P.issues.map(O=>Wu(O,h,Zu())),input:s,path:[s],inst:i});continue}const F=e.valueType._zod.run({value:l[s],issues:[]},h);F instanceof Promise?m.push(F.then(O=>{O.issues.length&&o.issues.push(..._p(s,O.issues)),o.value[P.value]=O.value})):(F.issues.length&&o.issues.push(..._p(s,F.issues)),o.value[P.value]=F.value)}}return m.length?Promise.all(m).then(()=>o):o}}),UG=$t("$ZodEnum",(i,e)=>{to.init(i,e);const o=ML(e.entries),h=new Set(o);i._zod.values=h,i._zod.pattern=new RegExp(`^(${o.filter(l=>Y6.has(typeof l)).map(l=>typeof l=="string"?Mp(l):l.toString()).join("|")})$`),i._zod.parse=(l,m)=>{const x=l.value;return h.has(x)||l.issues.push({code:"invalid_value",values:o,input:x,inst:i}),l}}),$G=$t("$ZodLiteral",(i,e)=>{if(to.init(i,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");const o=new Set(e.values);i._zod.values=o,i._zod.pattern=new RegExp(`^(${e.values.map(h=>typeof h=="string"?Mp(h):h?Mp(h.toString()):String(h)).join("|")})$`),i._zod.parse=(h,l)=>{const m=h.value;return o.has(m)||h.issues.push({code:"invalid_value",values:e.values,input:m,inst:i}),h}}),VG=$t("$ZodTransform",(i,e)=>{to.init(i,e),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new EL(i.constructor.name);const l=e.transform(o.value,o);if(h.async)return(l instanceof Promise?l:Promise.resolve(l)).then(x=>(o.value=x,o));if(l instanceof Promise)throw new xp;return o.value=l,o}});function qC(i,e){return i.issues.length&&e===void 0?{issues:[],value:void 0}:i}const ZL=$t("$ZodOptional",(i,e)=>{to.init(i,e),i._zod.optin="optional",i._zod.optout="optional",Mr(i._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Mr(i._zod,"pattern",()=>{const o=e.innerType._zod.pattern;return o?new RegExp(`^(${EE(o.source)})?$`):void 0}),i._zod.parse=(o,h)=>{if(e.innerType._zod.optin==="optional"){const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(m=>qC(m,o.value)):qC(l,o.value)}return o.value===void 0?o:e.innerType._zod.run(o,h)}}),jG=$t("$ZodExactOptional",(i,e)=>{ZL.init(i,e),Mr(i._zod,"values",()=>e.innerType._zod.values),Mr(i._zod,"pattern",()=>e.innerType._zod.pattern),i._zod.parse=(o,h)=>e.innerType._zod.run(o,h)}),GG=$t("$ZodNullable",(i,e)=>{to.init(i,e),Mr(i._zod,"optin",()=>e.innerType._zod.optin),Mr(i._zod,"optout",()=>e.innerType._zod.optout),Mr(i._zod,"pattern",()=>{const o=e.innerType._zod.pattern;return o?new RegExp(`^(${EE(o.source)}|null)$`):void 0}),Mr(i._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),i._zod.parse=(o,h)=>o.value===null?o:e.innerType._zod.run(o,h)}),HG=$t("$ZodDefault",(i,e)=>{to.init(i,e),i._zod.optin="optional",Mr(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);if(o.value===void 0)return o.value=e.defaultValue,o;const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(m=>XC(m,e)):XC(l,e)}});function XC(i,e){return i.value===void 0&&(i.value=e.defaultValue),i}const ZG=$t("$ZodPrefault",(i,e)=>{to.init(i,e),i._zod.optin="optional",Mr(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>(h.direction==="backward"||o.value===void 0&&(o.value=e.defaultValue),e.innerType._zod.run(o,h))}),WG=$t("$ZodNonOptional",(i,e)=>{to.init(i,e),Mr(i._zod,"values",()=>{const o=e.innerType._zod.values;return o?new Set([...o].filter(h=>h!==void 0)):void 0}),i._zod.parse=(o,h)=>{const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(m=>JC(m,i)):JC(l,i)}});function JC(i,e){return!i.issues.length&&i.value===void 0&&i.issues.push({code:"invalid_type",expected:"nonoptional",input:i.value,inst:e}),i}const qG=$t("$ZodCatch",(i,e)=>{to.init(i,e),Mr(i._zod,"optin",()=>e.innerType._zod.optin),Mr(i._zod,"optout",()=>e.innerType._zod.optout),Mr(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(m=>(o.value=m.value,m.issues.length&&(o.value=e.catchValue({...o,error:{issues:m.issues.map(x=>Wu(x,h,Zu()))},input:o.value}),o.issues=[]),o)):(o.value=l.value,l.issues.length&&(o.value=e.catchValue({...o,error:{issues:l.issues.map(m=>Wu(m,h,Zu()))},input:o.value}),o.issues=[]),o)}}),XG=$t("$ZodPipe",(i,e)=>{to.init(i,e),Mr(i._zod,"values",()=>e.in._zod.values),Mr(i._zod,"optin",()=>e.in._zod.optin),Mr(i._zod,"optout",()=>e.out._zod.optout),Mr(i._zod,"propValues",()=>e.in._zod.propValues),i._zod.parse=(o,h)=>{if(h.direction==="backward"){const m=e.out._zod.run(o,h);return m instanceof Promise?m.then(x=>u0(x,e.in,h)):u0(m,e.in,h)}const l=e.in._zod.run(o,h);return l instanceof Promise?l.then(m=>u0(m,e.out,h)):u0(l,e.out,h)}});function u0(i,e,o){return i.issues.length?(i.aborted=!0,i):e._zod.run({value:i.value,issues:i.issues},o)}const JG=$t("$ZodReadonly",(i,e)=>{to.init(i,e),Mr(i._zod,"propValues",()=>e.innerType._zod.propValues),Mr(i._zod,"values",()=>e.innerType._zod.values),Mr(i._zod,"optin",()=>{var o,h;return(h=(o=e.innerType)==null?void 0:o._zod)==null?void 0:h.optin}),Mr(i._zod,"optout",()=>{var o,h;return(h=(o=e.innerType)==null?void 0:o._zod)==null?void 0:h.optout}),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);const l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(YC):YC(l)}});function YC(i){return i.value=Object.freeze(i.value),i}const YG=$t("$ZodCustom",(i,e)=>{ua.init(i,e),to.init(i,e),i._zod.parse=(o,h)=>o,i._zod.check=o=>{const h=o.value,l=e.fn(h);if(l instanceof Promise)return l.then(m=>KC(m,o,h,i));KC(l,o,h,i)}});function KC(i,e,o,h){if(!i){const l={code:"custom",input:o,inst:h,path:[...h._zod.def.path??[]],continue:!h._zod.def.abort};h._zod.def.params&&(l.params=h._zod.def.params),e.issues.push(z_(l))}}var QC;class KG{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...o){const h=o[0];return this._map.set(e,h),h&&typeof h=="object"&&"id"in h&&this._idmap.set(h.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const o=this._map.get(e);return o&&typeof o=="object"&&"id"in o&&this._idmap.delete(o.id),this._map.delete(e),this}get(e){const o=e._zod.parent;if(o){const h={...this.get(o)??{}};delete h.id;const l={...h,...this._map.get(e)};return Object.keys(l).length?l:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function QG(){return new KG}(QC=globalThis).__zod_globalRegistry??(QC.__zod_globalRegistry=QG());const x_=globalThis.__zod_globalRegistry;function eH(i,e){return new i({type:"string",...Ki(e)})}function tH(i,e){return new i({type:"string",format:"email",check:"string_format",abort:!1,...Ki(e)})}function eR(i,e){return new i({type:"string",format:"guid",check:"string_format",abort:!1,...Ki(e)})}function iH(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,...Ki(e)})}function nH(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Ki(e)})}function rH(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Ki(e)})}function oH(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Ki(e)})}function sH(i,e){return new i({type:"string",format:"url",check:"string_format",abort:!1,...Ki(e)})}function aH(i,e){return new i({type:"string",format:"emoji",check:"string_format",abort:!1,...Ki(e)})}function lH(i,e){return new i({type:"string",format:"nanoid",check:"string_format",abort:!1,...Ki(e)})}function cH(i,e){return new i({type:"string",format:"cuid",check:"string_format",abort:!1,...Ki(e)})}function uH(i,e){return new i({type:"string",format:"cuid2",check:"string_format",abort:!1,...Ki(e)})}function hH(i,e){return new i({type:"string",format:"ulid",check:"string_format",abort:!1,...Ki(e)})}function dH(i,e){return new i({type:"string",format:"xid",check:"string_format",abort:!1,...Ki(e)})}function fH(i,e){return new i({type:"string",format:"ksuid",check:"string_format",abort:!1,...Ki(e)})}function pH(i,e){return new i({type:"string",format:"ipv4",check:"string_format",abort:!1,...Ki(e)})}function mH(i,e){return new i({type:"string",format:"ipv6",check:"string_format",abort:!1,...Ki(e)})}function gH(i,e){return new i({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Ki(e)})}function _H(i,e){return new i({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Ki(e)})}function yH(i,e){return new i({type:"string",format:"base64",check:"string_format",abort:!1,...Ki(e)})}function vH(i,e){return new i({type:"string",format:"base64url",check:"string_format",abort:!1,...Ki(e)})}function xH(i,e){return new i({type:"string",format:"e164",check:"string_format",abort:!1,...Ki(e)})}function bH(i,e){return new i({type:"string",format:"jwt",check:"string_format",abort:!1,...Ki(e)})}function wH(i,e){return new i({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Ki(e)})}function SH(i,e){return new i({type:"string",format:"date",check:"string_format",...Ki(e)})}function TH(i,e){return new i({type:"string",format:"time",check:"string_format",precision:null,...Ki(e)})}function EH(i,e){return new i({type:"string",format:"duration",check:"string_format",...Ki(e)})}function IH(i,e){return new i({type:"number",checks:[],...Ki(e)})}function MH(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"safeint",...Ki(e)})}function AH(i,e){return new i({type:"boolean",...Ki(e)})}function PH(i,e){return new i({type:"null",...Ki(e)})}function zH(i){return new i({type:"unknown"})}function CH(i,e){return new i({type:"never",...Ki(e)})}function tR(i,e){return new NL({check:"less_than",...Ki(e),value:i,inclusive:!1})}function YS(i,e){return new NL({check:"less_than",...Ki(e),value:i,inclusive:!0})}function iR(i,e){return new UL({check:"greater_than",...Ki(e),value:i,inclusive:!1})}function KS(i,e){return new UL({check:"greater_than",...Ki(e),value:i,inclusive:!0})}function nR(i,e){return new Gj({check:"multiple_of",...Ki(e),value:i})}function WL(i,e){return new Zj({check:"max_length",...Ki(e),maximum:i})}function J0(i,e){return new Wj({check:"min_length",...Ki(e),minimum:i})}function qL(i,e){return new qj({check:"length_equals",...Ki(e),length:i})}function RH(i,e){return new Xj({check:"string_format",format:"regex",...Ki(e),pattern:i})}function LH(i){return new Jj({check:"string_format",format:"lowercase",...Ki(i)})}function DH(i){return new Yj({check:"string_format",format:"uppercase",...Ki(i)})}function kH(i,e){return new Kj({check:"string_format",format:"includes",...Ki(e),includes:i})}function OH(i,e){return new Qj({check:"string_format",format:"starts_with",...Ki(e),prefix:i})}function FH(i,e){return new eG({check:"string_format",format:"ends_with",...Ki(e),suffix:i})}function Gp(i){return new tG({check:"overwrite",tx:i})}function BH(i){return Gp(e=>e.normalize(i))}function NH(){return Gp(i=>i.trim())}function UH(){return Gp(i=>i.toLowerCase())}function $H(){return Gp(i=>i.toUpperCase())}function VH(){return Gp(i=>X6(i))}function jH(i,e,o){return new i({type:"array",element:e,...Ki(o)})}function GH(i,e,o){const h=Ki(o);return h.abort??(h.abort=!0),new i({type:"custom",check:"custom",fn:e,...h})}function HH(i,e,o){return new i({type:"custom",check:"custom",fn:e,...Ki(o)})}function ZH(i){const e=WH(o=>(o.addIssue=h=>{if(typeof h=="string")o.issues.push(z_(h,o.value,e._zod.def));else{const l=h;l.fatal&&(l.continue=!1),l.code??(l.code="custom"),l.input??(l.input=o.value),l.inst??(l.inst=e),l.continue??(l.continue=!e._zod.def.abort),o.issues.push(z_(l))}},i(o.value,o)));return e}function WH(i,e){const o=new ua({check:"custom",...Ki(e)});return o._zod.check=i,o}function XL(i){let e=(i==null?void 0:i.target)??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:i.processors??{},metadataRegistry:(i==null?void 0:i.metadata)??x_,target:e,unrepresentable:(i==null?void 0:i.unrepresentable)??"throw",override:(i==null?void 0:i.override)??(()=>{}),io:(i==null?void 0:i.io)??"output",counter:0,seen:new Map,cycles:(i==null?void 0:i.cycles)??"ref",reused:(i==null?void 0:i.reused)??"inline",external:(i==null?void 0:i.external)??void 0}}function Co(i,e,o={path:[],schemaPath:[]}){var F,O;var h;const l=i._zod.def,m=e.seen.get(i);if(m)return m.count++,o.schemaPath.includes(i)&&(m.cycle=o.path),m.schema;const x={schema:{},count:1,cycle:void 0,path:o.path};e.seen.set(i,x);const s=(O=(F=i._zod).toJSONSchema)==null?void 0:O.call(F);if(s)x.schema=s;else{const V={...o,schemaPath:[...o.schemaPath,i],path:o.path};if(i._zod.processJSONSchema)i._zod.processJSONSchema(e,x.schema,V);else{const ee=x.schema,se=e.processors[l.type];if(!se)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${l.type}`);se(i,e,ee,V)}const J=i._zod.parent;J&&(x.ref||(x.ref=J),Co(J,e,V),e.seen.get(J).isParent=!0)}const P=e.metadataRegistry.get(i);return P&&Object.assign(x.schema,P),e.io==="input"&&Xs(i)&&(delete x.schema.examples,delete x.schema.default),e.io==="input"&&x.schema._prefault&&((h=x.schema).default??(h.default=x.schema._prefault)),delete x.schema._prefault,e.seen.get(i).schema}function JL(i,e){var x,s,P,C;const o=i.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");const h=new Map;for(const F of i.seen.entries()){const O=(x=i.metadataRegistry.get(F[0]))==null?void 0:x.id;if(O){const V=h.get(O);if(V&&V!==F[0])throw new Error(`Duplicate schema id "${O}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);h.set(O,F[0])}}const l=F=>{var se;const O=i.target==="draft-2020-12"?"$defs":"definitions";if(i.external){const fe=(se=i.external.registry.get(F[0]))==null?void 0:se.id,le=i.external.uri??(it=>it);if(fe)return{ref:le(fe)};const ie=F[1].defId??F[1].schema.id??`schema${i.counter++}`;return F[1].defId=ie,{defId:ie,ref:`${le("__shared")}#/${O}/${ie}`}}if(F[1]===o)return{ref:"#"};const J=`#/${O}/`,ee=F[1].schema.id??`__schema${i.counter++}`;return{defId:ee,ref:J+ee}},m=F=>{if(F[1].schema.$ref)return;const O=F[1],{ref:V,defId:J}=l(F);O.def={...O.schema},J&&(O.defId=J);const ee=O.schema;for(const se in ee)delete ee[se];ee.$ref=V};if(i.cycles==="throw")for(const F of i.seen.entries()){const O=F[1];if(O.cycle)throw new Error(`Cycle detected: #/${(s=O.cycle)==null?void 0:s.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const F of i.seen.entries()){const O=F[1];if(e===F[0]){m(F);continue}if(i.external){const J=(P=i.external.registry.get(F[0]))==null?void 0:P.id;if(e!==F[0]&&J){m(F);continue}}if((C=i.metadataRegistry.get(F[0]))==null?void 0:C.id){m(F);continue}if(O.cycle){m(F);continue}if(O.count>1&&i.reused==="ref"){m(F);continue}}}function YL(i,e){var x,s,P;const o=i.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");const h=C=>{const F=i.seen.get(C);if(F.ref===null)return;const O=F.def??F.schema,V={...O},J=F.ref;if(F.ref=null,J){h(J);const se=i.seen.get(J),fe=se.schema;if(fe.$ref&&(i.target==="draft-07"||i.target==="draft-04"||i.target==="openapi-3.0")?(O.allOf=O.allOf??[],O.allOf.push(fe)):Object.assign(O,fe),Object.assign(O,V),C._zod.parent===J)for(const ie in O)ie==="$ref"||ie==="allOf"||ie in V||delete O[ie];if(fe.$ref&&se.def)for(const ie in O)ie==="$ref"||ie==="allOf"||ie in se.def&&JSON.stringify(O[ie])===JSON.stringify(se.def[ie])&&delete O[ie]}const ee=C._zod.parent;if(ee&&ee!==J){h(ee);const se=i.seen.get(ee);if(se!=null&&se.schema.$ref&&(O.$ref=se.schema.$ref,se.def))for(const fe in O)fe==="$ref"||fe==="allOf"||fe in se.def&&JSON.stringify(O[fe])===JSON.stringify(se.def[fe])&&delete O[fe]}i.override({zodSchema:C,jsonSchema:O,path:F.path??[]})};for(const C of[...i.seen.entries()].reverse())h(C[0]);const l={};if(i.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":i.target==="draft-07"?l.$schema="http://json-schema.org/draft-07/schema#":i.target==="draft-04"?l.$schema="http://json-schema.org/draft-04/schema#":i.target,(x=i.external)!=null&&x.uri){const C=(s=i.external.registry.get(e))==null?void 0:s.id;if(!C)throw new Error("Schema is missing an `id` property");l.$id=i.external.uri(C)}Object.assign(l,o.def??o.schema);const m=((P=i.external)==null?void 0:P.defs)??{};for(const C of i.seen.entries()){const F=C[1];F.def&&F.defId&&(m[F.defId]=F.def)}i.external||Object.keys(m).length>0&&(i.target==="draft-2020-12"?l.$defs=m:l.definitions=m);try{const C=JSON.parse(JSON.stringify(l));return Object.defineProperty(C,"~standard",{value:{...e["~standard"],jsonSchema:{input:Y0(e,"input",i.processors),output:Y0(e,"output",i.processors)}},enumerable:!1,writable:!1}),C}catch{throw new Error("Error converting schema to JSON.")}}function Xs(i,e){const o=e??{seen:new Set};if(o.seen.has(i))return!1;o.seen.add(i);const h=i._zod.def;if(h.type==="transform")return!0;if(h.type==="array")return Xs(h.element,o);if(h.type==="set")return Xs(h.valueType,o);if(h.type==="lazy")return Xs(h.getter(),o);if(h.type==="promise"||h.type==="optional"||h.type==="nonoptional"||h.type==="nullable"||h.type==="readonly"||h.type==="default"||h.type==="prefault")return Xs(h.innerType,o);if(h.type==="intersection")return Xs(h.left,o)||Xs(h.right,o);if(h.type==="record"||h.type==="map")return Xs(h.keyType,o)||Xs(h.valueType,o);if(h.type==="pipe")return Xs(h.in,o)||Xs(h.out,o);if(h.type==="object"){for(const l in h.shape)if(Xs(h.shape[l],o))return!0;return!1}if(h.type==="union"){for(const l of h.options)if(Xs(l,o))return!0;return!1}if(h.type==="tuple"){for(const l of h.items)if(Xs(l,o))return!0;return!!(h.rest&&Xs(h.rest,o))}return!1}const qH=(i,e={})=>o=>{const h=XL({...o,processors:e});return Co(i,h),JL(h,i),YL(h,i)},Y0=(i,e,o={})=>h=>{const{libraryOptions:l,target:m}=h??{},x=XL({...l??{},target:m,io:e,processors:o});return Co(i,x),JL(x,i),YL(x,i)},XH={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},JH=(i,e,o,h)=>{const l=o;l.type="string";const{minimum:m,maximum:x,format:s,patterns:P,contentEncoding:C}=i._zod.bag;if(typeof m=="number"&&(l.minLength=m),typeof x=="number"&&(l.maxLength=x),s&&(l.format=XH[s]??s,l.format===""&&delete l.format,s==="time"&&delete l.format),C&&(l.contentEncoding=C),P&&P.size>0){const F=[...P];F.length===1?l.pattern=F[0].source:F.length>1&&(l.allOf=[...F.map(O=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:O.source}))])}},YH=(i,e,o,h)=>{const l=o,{minimum:m,maximum:x,format:s,multipleOf:P,exclusiveMaximum:C,exclusiveMinimum:F}=i._zod.bag;typeof s=="string"&&s.includes("int")?l.type="integer":l.type="number",typeof F=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(l.minimum=F,l.exclusiveMinimum=!0):l.exclusiveMinimum=F),typeof m=="number"&&(l.minimum=m,typeof F=="number"&&e.target!=="draft-04"&&(F>=m?delete l.minimum:delete l.exclusiveMinimum)),typeof C=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(l.maximum=C,l.exclusiveMaximum=!0):l.exclusiveMaximum=C),typeof x=="number"&&(l.maximum=x,typeof C=="number"&&e.target!=="draft-04"&&(C<=x?delete l.maximum:delete l.exclusiveMaximum)),typeof P=="number"&&(l.multipleOf=P)},KH=(i,e,o,h)=>{o.type="boolean"},QH=(i,e,o,h)=>{e.target==="openapi-3.0"?(o.type="string",o.nullable=!0,o.enum=[null]):o.type="null"},eZ=(i,e,o,h)=>{o.not={}},tZ=(i,e,o,h)=>{},iZ=(i,e,o,h)=>{const l=i._zod.def,m=ML(l.entries);m.every(x=>typeof x=="number")&&(o.type="number"),m.every(x=>typeof x=="string")&&(o.type="string"),o.enum=m},nZ=(i,e,o,h)=>{const l=i._zod.def,m=[];for(const x of l.values)if(x===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof x=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");m.push(Number(x))}else m.push(x);if(m.length!==0)if(m.length===1){const x=m[0];o.type=x===null?"null":typeof x,e.target==="draft-04"||e.target==="openapi-3.0"?o.enum=[x]:o.const=x}else m.every(x=>typeof x=="number")&&(o.type="number"),m.every(x=>typeof x=="string")&&(o.type="string"),m.every(x=>typeof x=="boolean")&&(o.type="boolean"),m.every(x=>x===null)&&(o.type="null"),o.enum=m},rZ=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},oZ=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},sZ=(i,e,o,h)=>{const l=o,m=i._zod.def,{minimum:x,maximum:s}=i._zod.bag;typeof x=="number"&&(l.minItems=x),typeof s=="number"&&(l.maxItems=s),l.type="array",l.items=Co(m.element,e,{...h,path:[...h.path,"items"]})},aZ=(i,e,o,h)=>{var C;const l=o,m=i._zod.def;l.type="object",l.properties={};const x=m.shape;for(const F in x)l.properties[F]=Co(x[F],e,{...h,path:[...h.path,"properties",F]});const s=new Set(Object.keys(x)),P=new Set([...s].filter(F=>{const O=m.shape[F]._zod;return e.io==="input"?O.optin===void 0:O.optout===void 0}));P.size>0&&(l.required=Array.from(P)),((C=m.catchall)==null?void 0:C._zod.def.type)==="never"?l.additionalProperties=!1:m.catchall?m.catchall&&(l.additionalProperties=Co(m.catchall,e,{...h,path:[...h.path,"additionalProperties"]})):e.io==="output"&&(l.additionalProperties=!1)},lZ=(i,e,o,h)=>{const l=i._zod.def,m=l.inclusive===!1,x=l.options.map((s,P)=>Co(s,e,{...h,path:[...h.path,m?"oneOf":"anyOf",P]}));m?o.oneOf=x:o.anyOf=x},cZ=(i,e,o,h)=>{const l=i._zod.def,m=Co(l.left,e,{...h,path:[...h.path,"allOf",0]}),x=Co(l.right,e,{...h,path:[...h.path,"allOf",1]}),s=C=>"allOf"in C&&Object.keys(C).length===1,P=[...s(m)?m.allOf:[m],...s(x)?x.allOf:[x]];o.allOf=P},uZ=(i,e,o,h)=>{const l=o,m=i._zod.def;l.type="object";const x=m.keyType,s=x._zod.bag,P=s==null?void 0:s.patterns;if(m.mode==="loose"&&P&&P.size>0){const F=Co(m.valueType,e,{...h,path:[...h.path,"patternProperties","*"]});l.patternProperties={};for(const O of P)l.patternProperties[O.source]=F}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(l.propertyNames=Co(m.keyType,e,{...h,path:[...h.path,"propertyNames"]})),l.additionalProperties=Co(m.valueType,e,{...h,path:[...h.path,"additionalProperties"]});const C=x._zod.values;if(C){const F=[...C].filter(O=>typeof O=="string"||typeof O=="number");F.length>0&&(l.required=F)}},hZ=(i,e,o,h)=>{const l=i._zod.def,m=Co(l.innerType,e,h),x=e.seen.get(i);e.target==="openapi-3.0"?(x.ref=l.innerType,o.nullable=!0):o.anyOf=[m,{type:"null"}]},dZ=(i,e,o,h)=>{const l=i._zod.def;Co(l.innerType,e,h);const m=e.seen.get(i);m.ref=l.innerType},fZ=(i,e,o,h)=>{const l=i._zod.def;Co(l.innerType,e,h);const m=e.seen.get(i);m.ref=l.innerType,o.default=JSON.parse(JSON.stringify(l.defaultValue))},pZ=(i,e,o,h)=>{const l=i._zod.def;Co(l.innerType,e,h);const m=e.seen.get(i);m.ref=l.innerType,e.io==="input"&&(o._prefault=JSON.parse(JSON.stringify(l.defaultValue)))},mZ=(i,e,o,h)=>{const l=i._zod.def;Co(l.innerType,e,h);const m=e.seen.get(i);m.ref=l.innerType;let x;try{x=l.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}o.default=x},gZ=(i,e,o,h)=>{const l=i._zod.def,m=e.io==="input"?l.in._zod.def.type==="transform"?l.out:l.in:l.out;Co(m,e,h);const x=e.seen.get(i);x.ref=m},_Z=(i,e,o,h)=>{const l=i._zod.def;Co(l.innerType,e,h);const m=e.seen.get(i);m.ref=l.innerType,o.readOnly=!0},KL=(i,e,o,h)=>{const l=i._zod.def;Co(l.innerType,e,h);const m=e.seen.get(i);m.ref=l.innerType};function zE(i){return!!i._zod}function QL(i,e){return zE(i)?LL(i,e):i.safeParse(e)}function yZ(i){var o,h;if(!i)return;let e;if(zE(i)?e=(h=(o=i._zod)==null?void 0:o.def)==null?void 0:h.shape:e=i.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function vZ(i){var l;if(zE(i)){const x=(l=i._zod)==null?void 0:l.def;if(x){if(x.value!==void 0)return x.value;if(Array.isArray(x.values)&&x.values.length>0)return x.values[0]}}const o=i._def;if(o){if(o.value!==void 0)return o.value;if(Array.isArray(o.values)&&o.values.length>0)return o.values[0]}const h=i.value;if(h!==void 0)return h}const xZ=$t("ZodISODateTime",(i,e)=>{mG.init(i,e),po.init(i,e)});function eD(i){return wH(xZ,i)}const bZ=$t("ZodISODate",(i,e)=>{gG.init(i,e),po.init(i,e)});function wZ(i){return SH(bZ,i)}const SZ=$t("ZodISOTime",(i,e)=>{_G.init(i,e),po.init(i,e)});function TZ(i){return TH(SZ,i)}const EZ=$t("ZodISODuration",(i,e)=>{yG.init(i,e),po.init(i,e)});function IZ(i){return EH(EZ,i)}const MZ=(i,e)=>{CL.init(i,e),i.name="ZodError",Object.defineProperties(i,{format:{value:o=>lj(i,o)},flatten:{value:o=>aj(i,o)},addIssue:{value:o=>{i.issues.push(o),i.message=JSON.stringify(i.issues,AT,2)}},addIssues:{value:o=>{i.issues.push(...o),i.message=JSON.stringify(i.issues,AT,2)}},isEmpty:{get(){return i.issues.length===0}}})},Qa=$t("ZodError",MZ,{Parent:Error}),AZ=ME(Qa),PZ=AE(Qa),zZ=Pb(Qa),CZ=zb(Qa),RZ=uj(Qa),LZ=hj(Qa),DZ=dj(Qa),kZ=fj(Qa),OZ=pj(Qa),FZ=mj(Qa),BZ=gj(Qa),NZ=_j(Qa),no=$t("ZodType",(i,e)=>(to.init(i,e),Object.assign(i["~standard"],{jsonSchema:{input:Y0(i,"input"),output:Y0(i,"output")}}),i.toJSONSchema=qH(i,{}),i.def=e,i.type=e.type,Object.defineProperty(i,"_def",{value:e}),i.check=(...o)=>i.clone(Qu(e,{checks:[...e.checks??[],...o.map(h=>typeof h=="function"?{_zod:{check:h,def:{check:"custom"},onattach:[]}}:h)]}),{parent:!0}),i.with=i.check,i.clone=(o,h)=>eh(i,o,h),i.brand=()=>i,i.register=((o,h)=>(o.add(i,h),i)),i.parse=(o,h)=>AZ(i,o,h,{callee:i.parse}),i.safeParse=(o,h)=>zZ(i,o,h),i.parseAsync=async(o,h)=>PZ(i,o,h,{callee:i.parseAsync}),i.safeParseAsync=async(o,h)=>CZ(i,o,h),i.spa=i.safeParseAsync,i.encode=(o,h)=>RZ(i,o,h),i.decode=(o,h)=>LZ(i,o,h),i.encodeAsync=async(o,h)=>DZ(i,o,h),i.decodeAsync=async(o,h)=>kZ(i,o,h),i.safeEncode=(o,h)=>OZ(i,o,h),i.safeDecode=(o,h)=>FZ(i,o,h),i.safeEncodeAsync=async(o,h)=>BZ(i,o,h),i.safeDecodeAsync=async(o,h)=>NZ(i,o,h),i.refine=(o,h)=>i.check(z8(o,h)),i.superRefine=o=>i.check(C8(o)),i.overwrite=o=>i.check(Gp(o)),i.optional=()=>So(i),i.exactOptional=()=>_8(i),i.nullable=()=>sR(i),i.nullish=()=>So(sR(i)),i.nonoptional=o=>S8(i,o),i.array=()=>cr(i),i.or=o=>Yr([i,o]),i.and=o=>CE(i,o),i.transform=o=>CT(i,aD(o)),i.default=o=>x8(i,o),i.prefault=o=>w8(i,o),i.catch=o=>E8(i,o),i.pipe=o=>CT(i,o),i.readonly=()=>A8(i),i.describe=o=>{const h=i.clone();return x_.add(h,{description:o}),h},Object.defineProperty(i,"description",{get(){var o;return(o=x_.get(i))==null?void 0:o.description},configurable:!0}),i.meta=(...o)=>{if(o.length===0)return x_.get(i);const h=i.clone();return x_.add(h,o[0]),h},i.isOptional=()=>i.safeParse(void 0).success,i.isNullable=()=>i.safeParse(null).success,i.apply=o=>o(i),i)),tD=$t("_ZodString",(i,e)=>{PE.init(i,e),no.init(i,e),i._zod.processJSONSchema=(h,l,m)=>JH(i,h,l);const o=i._zod.bag;i.format=o.format??null,i.minLength=o.minimum??null,i.maxLength=o.maximum??null,i.regex=(...h)=>i.check(RH(...h)),i.includes=(...h)=>i.check(kH(...h)),i.startsWith=(...h)=>i.check(OH(...h)),i.endsWith=(...h)=>i.check(FH(...h)),i.min=(...h)=>i.check(J0(...h)),i.max=(...h)=>i.check(WL(...h)),i.length=(...h)=>i.check(qL(...h)),i.nonempty=(...h)=>i.check(J0(1,...h)),i.lowercase=h=>i.check(LH(h)),i.uppercase=h=>i.check(DH(h)),i.trim=()=>i.check(NH()),i.normalize=(...h)=>i.check(BH(...h)),i.toLowerCase=()=>i.check(UH()),i.toUpperCase=()=>i.check($H()),i.slugify=()=>i.check(VH())}),UZ=$t("ZodString",(i,e)=>{PE.init(i,e),tD.init(i,e),i.email=o=>i.check(tH($Z,o)),i.url=o=>i.check(sH(VZ,o)),i.jwt=o=>i.check(bH(n8,o)),i.emoji=o=>i.check(aH(jZ,o)),i.guid=o=>i.check(eR(rR,o)),i.uuid=o=>i.check(iH(h0,o)),i.uuidv4=o=>i.check(nH(h0,o)),i.uuidv6=o=>i.check(rH(h0,o)),i.uuidv7=o=>i.check(oH(h0,o)),i.nanoid=o=>i.check(lH(GZ,o)),i.guid=o=>i.check(eR(rR,o)),i.cuid=o=>i.check(cH(HZ,o)),i.cuid2=o=>i.check(uH(ZZ,o)),i.ulid=o=>i.check(hH(WZ,o)),i.base64=o=>i.check(yH(e8,o)),i.base64url=o=>i.check(vH(t8,o)),i.xid=o=>i.check(dH(qZ,o)),i.ksuid=o=>i.check(fH(XZ,o)),i.ipv4=o=>i.check(pH(JZ,o)),i.ipv6=o=>i.check(mH(YZ,o)),i.cidrv4=o=>i.check(gH(KZ,o)),i.cidrv6=o=>i.check(_H(QZ,o)),i.e164=o=>i.check(xH(i8,o)),i.datetime=o=>i.check(eD(o)),i.date=o=>i.check(wZ(o)),i.time=o=>i.check(TZ(o)),i.duration=o=>i.check(IZ(o))});function kt(i){return eH(UZ,i)}const po=$t("ZodStringFormat",(i,e)=>{io.init(i,e),tD.init(i,e)}),$Z=$t("ZodEmail",(i,e)=>{sG.init(i,e),po.init(i,e)}),rR=$t("ZodGUID",(i,e)=>{rG.init(i,e),po.init(i,e)}),h0=$t("ZodUUID",(i,e)=>{oG.init(i,e),po.init(i,e)}),VZ=$t("ZodURL",(i,e)=>{aG.init(i,e),po.init(i,e)}),jZ=$t("ZodEmoji",(i,e)=>{lG.init(i,e),po.init(i,e)}),GZ=$t("ZodNanoID",(i,e)=>{cG.init(i,e),po.init(i,e)}),HZ=$t("ZodCUID",(i,e)=>{uG.init(i,e),po.init(i,e)}),ZZ=$t("ZodCUID2",(i,e)=>{hG.init(i,e),po.init(i,e)}),WZ=$t("ZodULID",(i,e)=>{dG.init(i,e),po.init(i,e)}),qZ=$t("ZodXID",(i,e)=>{fG.init(i,e),po.init(i,e)}),XZ=$t("ZodKSUID",(i,e)=>{pG.init(i,e),po.init(i,e)}),JZ=$t("ZodIPv4",(i,e)=>{vG.init(i,e),po.init(i,e)}),YZ=$t("ZodIPv6",(i,e)=>{xG.init(i,e),po.init(i,e)}),KZ=$t("ZodCIDRv4",(i,e)=>{bG.init(i,e),po.init(i,e)}),QZ=$t("ZodCIDRv6",(i,e)=>{wG.init(i,e),po.init(i,e)}),e8=$t("ZodBase64",(i,e)=>{SG.init(i,e),po.init(i,e)}),t8=$t("ZodBase64URL",(i,e)=>{EG.init(i,e),po.init(i,e)}),i8=$t("ZodE164",(i,e)=>{IG.init(i,e),po.init(i,e)}),n8=$t("ZodJWT",(i,e)=>{AG.init(i,e),po.init(i,e)}),iD=$t("ZodNumber",(i,e)=>{VL.init(i,e),no.init(i,e),i._zod.processJSONSchema=(h,l,m)=>YH(i,h,l),i.gt=(h,l)=>i.check(iR(h,l)),i.gte=(h,l)=>i.check(KS(h,l)),i.min=(h,l)=>i.check(KS(h,l)),i.lt=(h,l)=>i.check(tR(h,l)),i.lte=(h,l)=>i.check(YS(h,l)),i.max=(h,l)=>i.check(YS(h,l)),i.int=h=>i.check(oR(h)),i.safe=h=>i.check(oR(h)),i.positive=h=>i.check(iR(0,h)),i.nonnegative=h=>i.check(KS(0,h)),i.negative=h=>i.check(tR(0,h)),i.nonpositive=h=>i.check(YS(0,h)),i.multipleOf=(h,l)=>i.check(nR(h,l)),i.step=(h,l)=>i.check(nR(h,l)),i.finite=()=>i;const o=i._zod.bag;i.minValue=Math.max(o.minimum??Number.NEGATIVE_INFINITY,o.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,i.maxValue=Math.min(o.maximum??Number.POSITIVE_INFINITY,o.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,i.isInt=(o.format??"").includes("int")||Number.isSafeInteger(o.multipleOf??.5),i.isFinite=!0,i.format=o.format??null});function Dr(i){return IH(iD,i)}const r8=$t("ZodNumberFormat",(i,e)=>{PG.init(i,e),iD.init(i,e)});function oR(i){return MH(r8,i)}const o8=$t("ZodBoolean",(i,e)=>{zG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>KH(i,o,h)});function ds(i){return AH(o8,i)}const s8=$t("ZodNull",(i,e)=>{CG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>QH(i,o,h)});function nD(i){return PH(s8,i)}const a8=$t("ZodUnknown",(i,e)=>{RG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>tZ()});function ho(){return zH(a8)}const l8=$t("ZodNever",(i,e)=>{LG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>eZ(i,o,h)});function c8(i){return CH(l8,i)}const u8=$t("ZodArray",(i,e)=>{DG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>sZ(i,o,h,l),i.element=e.element,i.min=(o,h)=>i.check(J0(o,h)),i.nonempty=o=>i.check(J0(1,o)),i.max=(o,h)=>i.check(WL(o,h)),i.length=(o,h)=>i.check(qL(o,h)),i.unwrap=()=>i.element});function cr(i,e){return jH(u8,i,e)}const rD=$t("ZodObject",(i,e)=>{OG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>aZ(i,o,h,l),Mr(i,"shape",()=>e.shape),i.keyof=()=>Aa(Object.keys(i._zod.def.shape)),i.catchall=o=>i.clone({...i._zod.def,catchall:o}),i.passthrough=()=>i.clone({...i._zod.def,catchall:ho()}),i.loose=()=>i.clone({...i._zod.def,catchall:ho()}),i.strict=()=>i.clone({...i._zod.def,catchall:c8()}),i.strip=()=>i.clone({...i._zod.def,catchall:void 0}),i.extend=o=>ij(i,o),i.safeExtend=o=>nj(i,o),i.merge=o=>rj(i,o),i.pick=o=>ej(i,o),i.omit=o=>tj(i,o),i.partial=(...o)=>oj(lD,i,o[0]),i.required=(...o)=>sj(cD,i,o[0])});function Ni(i,e){const o={type:"object",shape:i??{},...Ki(e)};return new rD(o)}function ca(i,e){return new rD({type:"object",shape:i,catchall:ho(),...Ki(e)})}const oD=$t("ZodUnion",(i,e)=>{HL.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>lZ(i,o,h,l),i.options=e.options});function Yr(i,e){return new oD({type:"union",options:i,...Ki(e)})}const h8=$t("ZodDiscriminatedUnion",(i,e)=>{oD.init(i,e),FG.init(i,e)});function sD(i,e,o){return new h8({type:"union",options:e,discriminator:i,...Ki(o)})}const d8=$t("ZodIntersection",(i,e)=>{BG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>cZ(i,o,h,l)});function CE(i,e){return new d8({type:"intersection",left:i,right:e})}const f8=$t("ZodRecord",(i,e)=>{NG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>uZ(i,o,h,l),i.keyType=e.keyType,i.valueType=e.valueType});function fo(i,e,o){return new f8({type:"record",keyType:i,valueType:e,...Ki(o)})}const zT=$t("ZodEnum",(i,e)=>{UG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(h,l,m)=>iZ(i,h,l),i.enum=e.entries,i.options=Object.values(e.entries);const o=new Set(Object.keys(e.entries));i.extract=(h,l)=>{const m={};for(const x of h)if(o.has(x))m[x]=e.entries[x];else throw new Error(`Key ${x} not found in enum`);return new zT({...e,checks:[],...Ki(l),entries:m})},i.exclude=(h,l)=>{const m={...e.entries};for(const x of h)if(o.has(x))delete m[x];else throw new Error(`Key ${x} not found in enum`);return new zT({...e,checks:[],...Ki(l),entries:m})}});function Aa(i,e){const o=Array.isArray(i)?Object.fromEntries(i.map(h=>[h,h])):i;return new zT({type:"enum",entries:o,...Ki(e)})}const p8=$t("ZodLiteral",(i,e)=>{$G.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>nZ(i,o,h),i.values=new Set(e.values),Object.defineProperty(i,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function nn(i,e){return new p8({type:"literal",values:Array.isArray(i)?i:[i],...Ki(e)})}const m8=$t("ZodTransform",(i,e)=>{VG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>oZ(i,o),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new EL(i.constructor.name);o.addIssue=m=>{if(typeof m=="string")o.issues.push(z_(m,o.value,e));else{const x=m;x.fatal&&(x.continue=!1),x.code??(x.code="custom"),x.input??(x.input=o.value),x.inst??(x.inst=i),o.issues.push(z_(x))}};const l=e.transform(o.value,o);return l instanceof Promise?l.then(m=>(o.value=m,o)):(o.value=l,o)}});function aD(i){return new m8({type:"transform",transform:i})}const lD=$t("ZodOptional",(i,e)=>{ZL.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>KL(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function So(i){return new lD({type:"optional",innerType:i})}const g8=$t("ZodExactOptional",(i,e)=>{jG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>KL(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function _8(i){return new g8({type:"optional",innerType:i})}const y8=$t("ZodNullable",(i,e)=>{GG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>hZ(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function sR(i){return new y8({type:"nullable",innerType:i})}const v8=$t("ZodDefault",(i,e)=>{HG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>fZ(i,o,h,l),i.unwrap=()=>i._zod.def.innerType,i.removeDefault=i.unwrap});function x8(i,e){return new v8({type:"default",innerType:i,get defaultValue(){return typeof e=="function"?e():PL(e)}})}const b8=$t("ZodPrefault",(i,e)=>{ZG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>pZ(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function w8(i,e){return new b8({type:"prefault",innerType:i,get defaultValue(){return typeof e=="function"?e():PL(e)}})}const cD=$t("ZodNonOptional",(i,e)=>{WG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>dZ(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function S8(i,e){return new cD({type:"nonoptional",innerType:i,...Ki(e)})}const T8=$t("ZodCatch",(i,e)=>{qG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>mZ(i,o,h,l),i.unwrap=()=>i._zod.def.innerType,i.removeCatch=i.unwrap});function E8(i,e){return new T8({type:"catch",innerType:i,catchValue:typeof e=="function"?e:()=>e})}const I8=$t("ZodPipe",(i,e)=>{XG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>gZ(i,o,h,l),i.in=e.in,i.out=e.out});function CT(i,e){return new I8({type:"pipe",in:i,out:e})}const M8=$t("ZodReadonly",(i,e)=>{JG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>_Z(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function A8(i){return new M8({type:"readonly",innerType:i})}const uD=$t("ZodCustom",(i,e)=>{YG.init(i,e),no.init(i,e),i._zod.processJSONSchema=(o,h,l)=>rZ(i,o)});function P8(i,e){return GH(uD,i??(()=>!0),e)}function z8(i,e={}){return HH(uD,i,e)}function C8(i){return ZH(i)}function hD(i,e){return CT(aD(i),e)}const sd="io.modelcontextprotocol/related-task",Rb="2.0",fs=P8(i=>i!==null&&(typeof i=="object"||typeof i=="function")),dD=Yr([kt(),Dr().int()]),fD=kt();ca({ttl:Yr([Dr(),nD()]).optional(),pollInterval:Dr().optional()});const R8=Ni({ttl:Dr().optional()}),L8=Ni({taskId:kt()}),RE=ca({progressToken:dD.optional(),[sd]:L8.optional()}),Pa=Ni({_meta:RE.optional()}),ey=Pa.extend({task:R8.optional()}),D8=i=>ey.safeParse(i).success,ps=Ni({method:kt(),params:Pa.loose().optional()}),el=Ni({_meta:RE.optional()}),tl=Ni({method:kt(),params:el.loose().optional()}),ms=ca({_meta:RE.optional()}),ty=Yr([kt(),Dr().int()]),pD=Ni({jsonrpc:nn(Rb),id:ty,...ps.shape}).strict(),aR=i=>pD.safeParse(i).success,mD=Ni({jsonrpc:nn(Rb),...tl.shape}).strict(),k8=i=>mD.safeParse(i).success,LE=Ni({jsonrpc:nn(Rb),id:ty,result:ms}).strict(),d0=i=>LE.safeParse(i).success;var Pr;(function(i){i[i.ConnectionClosed=-32e3]="ConnectionClosed",i[i.RequestTimeout=-32001]="RequestTimeout",i[i.ParseError=-32700]="ParseError",i[i.InvalidRequest=-32600]="InvalidRequest",i[i.MethodNotFound=-32601]="MethodNotFound",i[i.InvalidParams=-32602]="InvalidParams",i[i.InternalError=-32603]="InternalError",i[i.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(Pr||(Pr={}));const DE=Ni({jsonrpc:nn(Rb),id:ty.optional(),error:Ni({code:Dr().int(),message:kt(),data:ho().optional()})}).strict(),O8=i=>DE.safeParse(i).success,F8=Yr([pD,mD,LE,DE]);Yr([LE,DE]);const kE=ms.strict(),B8=el.extend({requestId:ty.optional(),reason:kt().optional()}),OE=tl.extend({method:nn("notifications/cancelled"),params:B8}),N8=Ni({src:kt(),mimeType:kt().optional(),sizes:cr(kt()).optional(),theme:Aa(["light","dark"]).optional()}),iy=Ni({icons:cr(N8).optional()}),Ap=Ni({name:kt(),title:kt().optional()}),Lb=Ap.extend({...Ap.shape,...iy.shape,version:kt(),websiteUrl:kt().optional(),description:kt().optional()}),U8=CE(Ni({applyDefaults:ds().optional()}),fo(kt(),ho())),$8=hD(i=>i&&typeof i=="object"&&!Array.isArray(i)&&Object.keys(i).length===0?{form:{}}:i,CE(Ni({form:U8.optional(),url:fs.optional()}),fo(kt(),ho()).optional())),V8=ca({list:fs.optional(),cancel:fs.optional(),requests:ca({sampling:ca({createMessage:fs.optional()}).optional(),elicitation:ca({create:fs.optional()}).optional()}).optional()}),j8=ca({list:fs.optional(),cancel:fs.optional(),requests:ca({tools:ca({call:fs.optional()}).optional()}).optional()}),G8=Ni({experimental:fo(kt(),fs).optional(),sampling:Ni({context:fs.optional(),tools:fs.optional()}).optional(),elicitation:$8.optional(),roots:Ni({listChanged:ds().optional()}).optional(),tasks:V8.optional()}),H8=Pa.extend({protocolVersion:kt(),capabilities:G8,clientInfo:Lb}),Z8=ps.extend({method:nn("initialize"),params:H8}),W8=Ni({experimental:fo(kt(),fs).optional(),logging:fs.optional(),completions:fs.optional(),prompts:Ni({listChanged:ds().optional()}).optional(),resources:Ni({subscribe:ds().optional(),listChanged:ds().optional()}).optional(),tools:Ni({listChanged:ds().optional()}).optional(),tasks:j8.optional()}),q8=ms.extend({protocolVersion:kt(),capabilities:W8,serverInfo:Lb,instructions:kt().optional()}),X8=tl.extend({method:nn("notifications/initialized"),params:el.optional()}),Db=ps.extend({method:nn("ping"),params:Pa.optional()}),J8=Ni({progress:Dr(),total:So(Dr()),message:So(kt())}),Y8=Ni({...el.shape,...J8.shape,progressToken:dD}),FE=tl.extend({method:nn("notifications/progress"),params:Y8}),K8=Pa.extend({cursor:fD.optional()}),ny=ps.extend({params:K8.optional()}),ry=ms.extend({nextCursor:fD.optional()}),Q8=Aa(["working","input_required","completed","failed","cancelled"]),oy=Ni({taskId:kt(),status:Q8,ttl:Yr([Dr(),nD()]),createdAt:kt(),lastUpdatedAt:kt(),pollInterval:So(Dr()),statusMessage:So(kt())}),BE=ms.extend({task:oy}),eW=el.merge(oy),K0=tl.extend({method:nn("notifications/tasks/status"),params:eW}),NE=ps.extend({method:nn("tasks/get"),params:Pa.extend({taskId:kt()})}),UE=ms.merge(oy),$E=ps.extend({method:nn("tasks/result"),params:Pa.extend({taskId:kt()})});ms.loose();const VE=ny.extend({method:nn("tasks/list")}),jE=ry.extend({tasks:cr(oy)}),GE=ps.extend({method:nn("tasks/cancel"),params:Pa.extend({taskId:kt()})}),tW=ms.merge(oy),gD=Ni({uri:kt(),mimeType:So(kt()),_meta:fo(kt(),ho()).optional()}),_D=gD.extend({text:kt()}),HE=kt().refine(i=>{try{return atob(i),!0}catch{return!1}},{message:"Invalid Base64 string"}),yD=gD.extend({blob:HE}),sy=Aa(["user","assistant"]),Hp=Ni({audience:cr(sy).optional(),priority:Dr().min(0).max(1).optional(),lastModified:eD({offset:!0}).optional()}),vD=Ni({...Ap.shape,...iy.shape,uri:kt(),description:So(kt()),mimeType:So(kt()),annotations:Hp.optional(),_meta:So(ca({}))}),iW=Ni({...Ap.shape,...iy.shape,uriTemplate:kt(),description:So(kt()),mimeType:So(kt()),annotations:Hp.optional(),_meta:So(ca({}))}),nW=ny.extend({method:nn("resources/list")}),rW=ry.extend({resources:cr(vD)}),oW=ny.extend({method:nn("resources/templates/list")}),sW=ry.extend({resourceTemplates:cr(iW)}),ZE=Pa.extend({uri:kt()}),aW=ZE,lW=ps.extend({method:nn("resources/read"),params:aW}),cW=ms.extend({contents:cr(Yr([_D,yD]))}),uW=tl.extend({method:nn("notifications/resources/list_changed"),params:el.optional()}),hW=ZE,dW=ps.extend({method:nn("resources/subscribe"),params:hW}),fW=ZE,pW=ps.extend({method:nn("resources/unsubscribe"),params:fW}),mW=el.extend({uri:kt()}),gW=tl.extend({method:nn("notifications/resources/updated"),params:mW}),_W=Ni({name:kt(),description:So(kt()),required:So(ds())}),yW=Ni({...Ap.shape,...iy.shape,description:So(kt()),arguments:So(cr(_W)),_meta:So(ca({}))}),vW=ny.extend({method:nn("prompts/list")}),xW=ry.extend({prompts:cr(yW)}),bW=Pa.extend({name:kt(),arguments:fo(kt(),kt()).optional()}),wW=ps.extend({method:nn("prompts/get"),params:bW}),WE=Ni({type:nn("text"),text:kt(),annotations:Hp.optional(),_meta:fo(kt(),ho()).optional()}),qE=Ni({type:nn("image"),data:HE,mimeType:kt(),annotations:Hp.optional(),_meta:fo(kt(),ho()).optional()}),XE=Ni({type:nn("audio"),data:HE,mimeType:kt(),annotations:Hp.optional(),_meta:fo(kt(),ho()).optional()}),SW=Ni({type:nn("tool_use"),name:kt(),id:kt(),input:fo(kt(),ho()),_meta:fo(kt(),ho()).optional()}),TW=Ni({type:nn("resource"),resource:Yr([_D,yD]),annotations:Hp.optional(),_meta:fo(kt(),ho()).optional()}),EW=vD.extend({type:nn("resource_link")}),ay=Yr([WE,qE,XE,EW,TW]),IW=Ni({role:sy,content:ay}),MW=ms.extend({description:kt().optional(),messages:cr(IW)}),AW=tl.extend({method:nn("notifications/prompts/list_changed"),params:el.optional()}),PW=Ni({title:kt().optional(),readOnlyHint:ds().optional(),destructiveHint:ds().optional(),idempotentHint:ds().optional(),openWorldHint:ds().optional()}),zW=Ni({taskSupport:Aa(["required","optional","forbidden"]).optional()}),JE=Ni({...Ap.shape,...iy.shape,description:kt().optional(),inputSchema:Ni({type:nn("object"),properties:fo(kt(),fs).optional(),required:cr(kt()).optional()}).catchall(ho()),outputSchema:Ni({type:nn("object"),properties:fo(kt(),fs).optional(),required:cr(kt()).optional()}).catchall(ho()).optional(),annotations:PW.optional(),execution:zW.optional(),_meta:fo(kt(),ho()).optional()}),xD=ny.extend({method:nn("tools/list")}),CW=ry.extend({tools:cr(JE)}),kb=ms.extend({content:cr(ay).default([]),structuredContent:fo(kt(),ho()).optional(),isError:ds().optional()});kb.or(ms.extend({toolResult:ho()}));const RW=ey.extend({name:kt(),arguments:fo(kt(),ho()).optional()}),bD=ps.extend({method:nn("tools/call"),params:RW}),LW=tl.extend({method:nn("notifications/tools/list_changed"),params:el.optional()});Ni({autoRefresh:ds().default(!0),debounceMs:Dr().int().nonnegative().default(300)});const wD=Aa(["debug","info","notice","warning","error","critical","alert","emergency"]),DW=Pa.extend({level:wD}),kW=ps.extend({method:nn("logging/setLevel"),params:DW}),OW=el.extend({level:wD,logger:kt().optional(),data:ho()}),FW=tl.extend({method:nn("notifications/message"),params:OW}),BW=Ni({name:kt().optional()}),NW=Ni({hints:cr(BW).optional(),costPriority:Dr().min(0).max(1).optional(),speedPriority:Dr().min(0).max(1).optional(),intelligencePriority:Dr().min(0).max(1).optional()}),UW=Ni({mode:Aa(["auto","required","none"]).optional()}),$W=Ni({type:nn("tool_result"),toolUseId:kt().describe("The unique identifier for the corresponding tool call."),content:cr(ay).default([]),structuredContent:Ni({}).loose().optional(),isError:ds().optional(),_meta:fo(kt(),ho()).optional()}),VW=sD("type",[WE,qE,XE]),Q0=sD("type",[WE,qE,XE,SW,$W]),jW=Ni({role:sy,content:Yr([Q0,cr(Q0)]),_meta:fo(kt(),ho()).optional()}),GW=ey.extend({messages:cr(jW),modelPreferences:NW.optional(),systemPrompt:kt().optional(),includeContext:Aa(["none","thisServer","allServers"]).optional(),temperature:Dr().optional(),maxTokens:Dr().int(),stopSequences:cr(kt()).optional(),metadata:fs.optional(),tools:cr(JE).optional(),toolChoice:UW.optional()}),HW=ps.extend({method:nn("sampling/createMessage"),params:GW}),ZW=ms.extend({model:kt(),stopReason:So(Aa(["endTurn","stopSequence","maxTokens"]).or(kt())),role:sy,content:VW}),WW=ms.extend({model:kt(),stopReason:So(Aa(["endTurn","stopSequence","maxTokens","toolUse"]).or(kt())),role:sy,content:Yr([Q0,cr(Q0)])}),qW=Ni({type:nn("boolean"),title:kt().optional(),description:kt().optional(),default:ds().optional()}),XW=Ni({type:nn("string"),title:kt().optional(),description:kt().optional(),minLength:Dr().optional(),maxLength:Dr().optional(),format:Aa(["email","uri","date","date-time"]).optional(),default:kt().optional()}),JW=Ni({type:Aa(["number","integer"]),title:kt().optional(),description:kt().optional(),minimum:Dr().optional(),maximum:Dr().optional(),default:Dr().optional()}),YW=Ni({type:nn("string"),title:kt().optional(),description:kt().optional(),enum:cr(kt()),default:kt().optional()}),KW=Ni({type:nn("string"),title:kt().optional(),description:kt().optional(),oneOf:cr(Ni({const:kt(),title:kt()})),default:kt().optional()}),QW=Ni({type:nn("string"),title:kt().optional(),description:kt().optional(),enum:cr(kt()),enumNames:cr(kt()).optional(),default:kt().optional()}),eq=Yr([YW,KW]),tq=Ni({type:nn("array"),title:kt().optional(),description:kt().optional(),minItems:Dr().optional(),maxItems:Dr().optional(),items:Ni({type:nn("string"),enum:cr(kt())}),default:cr(kt()).optional()}),iq=Ni({type:nn("array"),title:kt().optional(),description:kt().optional(),minItems:Dr().optional(),maxItems:Dr().optional(),items:Ni({anyOf:cr(Ni({const:kt(),title:kt()}))}),default:cr(kt()).optional()}),nq=Yr([tq,iq]),rq=Yr([QW,eq,nq]),oq=Yr([rq,qW,XW,JW]),sq=ey.extend({mode:nn("form").optional(),message:kt(),requestedSchema:Ni({type:nn("object"),properties:fo(kt(),oq),required:cr(kt()).optional()})}),aq=ey.extend({mode:nn("url"),message:kt(),elicitationId:kt(),url:kt().url()}),lq=Yr([sq,aq]),cq=ps.extend({method:nn("elicitation/create"),params:lq}),uq=el.extend({elicitationId:kt()}),hq=tl.extend({method:nn("notifications/elicitation/complete"),params:uq}),dq=ms.extend({action:Aa(["accept","decline","cancel"]),content:hD(i=>i===null?void 0:i,fo(kt(),Yr([kt(),Dr(),ds(),cr(kt())])).optional())}),fq=Ni({type:nn("ref/resource"),uri:kt()}),pq=Ni({type:nn("ref/prompt"),name:kt()}),mq=Pa.extend({ref:Yr([pq,fq]),argument:Ni({name:kt(),value:kt()}),context:Ni({arguments:fo(kt(),kt()).optional()}).optional()}),gq=ps.extend({method:nn("completion/complete"),params:mq}),_q=ms.extend({completion:ca({values:cr(kt()).max(100),total:So(Dr().int()),hasMore:So(ds())})}),yq=Ni({uri:kt().startsWith("file://"),name:kt().optional(),_meta:fo(kt(),ho()).optional()}),vq=ps.extend({method:nn("roots/list"),params:Pa.optional()}),xq=ms.extend({roots:cr(yq)}),bq=tl.extend({method:nn("notifications/roots/list_changed"),params:el.optional()});Yr([Db,Z8,gq,kW,wW,vW,nW,oW,lW,dW,pW,bD,xD,NE,$E,VE,GE]);Yr([OE,FE,X8,bq,K0]);Yr([kE,ZW,WW,dq,xq,UE,jE,BE]);Yr([Db,HW,cq,vq,NE,$E,VE,GE]);Yr([OE,FE,FW,gW,uW,LW,AW,K0,hq]);Yr([kE,q8,_q,MW,xW,rW,sW,cW,kb,CW,UE,jE,BE]);class fr extends Error{constructor(e,o,h){super(`MCP error ${e}: ${o}`),this.code=e,this.data=h,this.name="McpError"}static fromError(e,o,h){if(e===Pr.UrlElicitationRequired&&h){const l=h;if(l.elicitations)return new wq(l.elicitations,o)}return new fr(e,o,h)}}class wq extends fr{constructor(e,o=`URL elicitation${e.length>1?"s":""} required`){super(Pr.UrlElicitationRequired,o,{elicitations:e})}get elicitations(){var e;return((e=this.data)==null?void 0:e.elicitations)??[]}}function id(i){return i==="completed"||i==="failed"||i==="cancelled"}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function lR(i){const e=yZ(i),o=e==null?void 0:e.method;if(!o)throw new Error("Schema is missing a method literal");const h=vZ(o);if(typeof h!="string")throw new Error("Schema method literal must be a string");return h}function cR(i,e){const o=QL(i,e);if(!o.success)throw o.error;return o.data}const Sq=6e4;class Tq{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(OE,o=>{this._oncancel(o)}),this.setNotificationHandler(FE,o=>{this._onprogress(o)}),this.setRequestHandler(Db,o=>({})),this._taskStore=e==null?void 0:e.taskStore,this._taskMessageQueue=e==null?void 0:e.taskMessageQueue,this._taskStore&&(this.setRequestHandler(NE,async(o,h)=>{const l=await this._taskStore.getTask(o.params.taskId,h.sessionId);if(!l)throw new fr(Pr.InvalidParams,"Failed to retrieve task: Task not found");return{...l}}),this.setRequestHandler($E,async(o,h)=>{const l=async()=>{var s;const m=o.params.taskId;if(this._taskMessageQueue){let P;for(;P=await this._taskMessageQueue.dequeue(m,h.sessionId);){if(P.type==="response"||P.type==="error"){const C=P.message,F=C.id,O=this._requestResolvers.get(F);if(O)if(this._requestResolvers.delete(F),P.type==="response")O(C);else{const V=C,J=new fr(V.error.code,V.error.message,V.error.data);O(J)}else{const V=P.type==="response"?"Response":"Error";this._onerror(new Error(`${V} handler missing for request ${F}`))}continue}await((s=this._transport)==null?void 0:s.send(P.message,{relatedRequestId:h.requestId}))}}const x=await this._taskStore.getTask(m,h.sessionId);if(!x)throw new fr(Pr.InvalidParams,`Task not found: ${m}`);if(!id(x.status))return await this._waitForTaskUpdate(m,h.signal),await l();if(id(x.status)){const P=await this._taskStore.getTaskResult(m,h.sessionId);return this._clearTaskQueue(m),{...P,_meta:{...P._meta,[sd]:{taskId:m}}}}return await l()};return await l()}),this.setRequestHandler(VE,async(o,h)=>{var l;try{const{tasks:m,nextCursor:x}=await this._taskStore.listTasks((l=o.params)==null?void 0:l.cursor,h.sessionId);return{tasks:m,nextCursor:x,_meta:{}}}catch(m){throw new fr(Pr.InvalidParams,`Failed to list tasks: ${m instanceof Error?m.message:String(m)}`)}}),this.setRequestHandler(GE,async(o,h)=>{try{const l=await this._taskStore.getTask(o.params.taskId,h.sessionId);if(!l)throw new fr(Pr.InvalidParams,`Task not found: ${o.params.taskId}`);if(id(l.status))throw new fr(Pr.InvalidParams,`Cannot cancel task in terminal status: ${l.status}`);await this._taskStore.updateTaskStatus(o.params.taskId,"cancelled","Client cancelled task execution.",h.sessionId),this._clearTaskQueue(o.params.taskId);const m=await this._taskStore.getTask(o.params.taskId,h.sessionId);if(!m)throw new fr(Pr.InvalidParams,`Task not found after cancellation: ${o.params.taskId}`);return{_meta:{},...m}}catch(l){throw l instanceof fr?l:new fr(Pr.InvalidRequest,`Failed to cancel task: ${l instanceof Error?l.message:String(l)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;const o=this._requestHandlerAbortControllers.get(e.params.requestId);o==null||o.abort(e.params.reason)}_setupTimeout(e,o,h,l,m=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(l,o),startTime:Date.now(),timeout:o,maxTotalTimeout:h,resetTimeoutOnProgress:m,onTimeout:l})}_resetTimeout(e){const o=this._timeoutInfo.get(e);if(!o)return!1;const h=Date.now()-o.startTime;if(o.maxTotalTimeout&&h>=o.maxTotalTimeout)throw this._timeoutInfo.delete(e),fr.fromError(Pr.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:o.maxTotalTimeout,totalElapsed:h});return clearTimeout(o.timeoutId),o.timeoutId=setTimeout(o.onTimeout,o.timeout),!0}_cleanupTimeout(e){const o=this._timeoutInfo.get(e);o&&(clearTimeout(o.timeoutId),this._timeoutInfo.delete(e))}async connect(e){var m,x,s;if(this._transport)throw new Error("Already connected to a transport. Call close() before connecting to a new transport, or use a separate Protocol instance per connection.");this._transport=e;const o=(m=this.transport)==null?void 0:m.onclose;this._transport.onclose=()=>{o==null||o(),this._onclose()};const h=(x=this.transport)==null?void 0:x.onerror;this._transport.onerror=P=>{h==null||h(P),this._onerror(P)};const l=(s=this._transport)==null?void 0:s.onmessage;this._transport.onmessage=(P,C)=>{l==null||l(P,C),d0(P)||O8(P)?this._onresponse(P):aR(P)?this._onrequest(P,C):k8(P)?this._onnotification(P):this._onerror(new Error(`Unknown message type: ${JSON.stringify(P)}`))},await this._transport.start()}_onclose(){var h;const e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();for(const l of this._requestHandlerAbortControllers.values())l.abort();this._requestHandlerAbortControllers.clear();const o=fr.fromError(Pr.ConnectionClosed,"Connection closed");this._transport=void 0,(h=this.onclose)==null||h.call(this);for(const l of e.values())l(o)}_onerror(e){var o;(o=this.onerror)==null||o.call(this,e)}_onnotification(e){const o=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;o!==void 0&&Promise.resolve().then(()=>o(e)).catch(h=>this._onerror(new Error(`Uncaught error in notification handler: ${h}`)))}_onrequest(e,o){var F,O,V,J;const h=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,l=this._transport,m=(V=(O=(F=e.params)==null?void 0:F._meta)==null?void 0:O[sd])==null?void 0:V.taskId;if(h===void 0){const ee={jsonrpc:"2.0",id:e.id,error:{code:Pr.MethodNotFound,message:"Method not found"}};m&&this._taskMessageQueue?this._enqueueTaskMessage(m,{type:"error",message:ee,timestamp:Date.now()},l==null?void 0:l.sessionId).catch(se=>this._onerror(new Error(`Failed to enqueue error response: ${se}`))):l==null||l.send(ee).catch(se=>this._onerror(new Error(`Failed to send an error response: ${se}`)));return}const x=new AbortController;this._requestHandlerAbortControllers.set(e.id,x);const s=D8(e.params)?e.params.task:void 0,P=this._taskStore?this.requestTaskStore(e,l==null?void 0:l.sessionId):void 0,C={signal:x.signal,sessionId:l==null?void 0:l.sessionId,_meta:(J=e.params)==null?void 0:J._meta,sendNotification:async ee=>{if(x.signal.aborted)return;const se={relatedRequestId:e.id};m&&(se.relatedTask={taskId:m}),await this.notification(ee,se)},sendRequest:async(ee,se,fe)=>{var it;if(x.signal.aborted)throw new fr(Pr.ConnectionClosed,"Request was cancelled");const le={...fe,relatedRequestId:e.id};m&&!le.relatedTask&&(le.relatedTask={taskId:m});const ie=((it=le.relatedTask)==null?void 0:it.taskId)??m;return ie&&P&&await P.updateTaskStatus(ie,"input_required"),await this.request(ee,se,le)},authInfo:o==null?void 0:o.authInfo,requestId:e.id,requestInfo:o==null?void 0:o.requestInfo,taskId:m,taskStore:P,taskRequestedTtl:s==null?void 0:s.ttl,closeSSEStream:o==null?void 0:o.closeSSEStream,closeStandaloneSSEStream:o==null?void 0:o.closeStandaloneSSEStream};Promise.resolve().then(()=>{s&&this.assertTaskHandlerCapability(e.method)}).then(()=>h(e,C)).then(async ee=>{if(x.signal.aborted)return;const se={result:ee,jsonrpc:"2.0",id:e.id};m&&this._taskMessageQueue?await this._enqueueTaskMessage(m,{type:"response",message:se,timestamp:Date.now()},l==null?void 0:l.sessionId):await(l==null?void 0:l.send(se))},async ee=>{if(x.signal.aborted)return;const se={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(ee.code)?ee.code:Pr.InternalError,message:ee.message??"Internal error",...ee.data!==void 0&&{data:ee.data}}};m&&this._taskMessageQueue?await this._enqueueTaskMessage(m,{type:"error",message:se,timestamp:Date.now()},l==null?void 0:l.sessionId):await(l==null?void 0:l.send(se))}).catch(ee=>this._onerror(new Error(`Failed to send response: ${ee}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){const{progressToken:o,...h}=e.params,l=Number(o),m=this._progressHandlers.get(l);if(!m){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}const x=this._responseHandlers.get(l),s=this._timeoutInfo.get(l);if(s&&x&&s.resetTimeoutOnProgress)try{this._resetTimeout(l)}catch(P){this._responseHandlers.delete(l),this._progressHandlers.delete(l),this._cleanupTimeout(l),x(P);return}m(h)}_onresponse(e){const o=Number(e.id),h=this._requestResolvers.get(o);if(h){if(this._requestResolvers.delete(o),d0(e))h(e);else{const x=new fr(e.error.code,e.error.message,e.error.data);h(x)}return}const l=this._responseHandlers.get(o);if(l===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(o),this._cleanupTimeout(o);let m=!1;if(d0(e)&&e.result&&typeof e.result=="object"){const x=e.result;if(x.task&&typeof x.task=="object"){const s=x.task;typeof s.taskId=="string"&&(m=!0,this._taskProgressTokens.set(s.taskId,o))}}if(m||this._progressHandlers.delete(o),d0(e))l(e);else{const x=fr.fromError(e.error.code,e.error.message,e.error.data);l(x)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)==null?void 0:e.close())}async*requestStream(e,o,h){var x,s;const{task:l}=h??{};if(!l){try{yield{type:"result",result:await this.request(e,o,h)}}catch(P){yield{type:"error",error:P instanceof fr?P:new fr(Pr.InternalError,String(P))}}return}let m;try{const P=await this.request(e,BE,h);if(P.task)m=P.task.taskId,yield{type:"taskCreated",task:P.task};else throw new fr(Pr.InternalError,"Task creation did not return a task");for(;;){const C=await this.getTask({taskId:m},h);if(yield{type:"taskStatus",task:C},id(C.status)){C.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:m},o,h)}:C.status==="failed"?yield{type:"error",error:new fr(Pr.InternalError,`Task ${m} failed`)}:C.status==="cancelled"&&(yield{type:"error",error:new fr(Pr.InternalError,`Task ${m} was cancelled`)});return}if(C.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:m},o,h)};return}const F=C.pollInterval??((x=this._options)==null?void 0:x.defaultTaskPollInterval)??1e3;await new Promise(O=>setTimeout(O,F)),(s=h==null?void 0:h.signal)==null||s.throwIfAborted()}}catch(P){yield{type:"error",error:P instanceof fr?P:new fr(Pr.InternalError,String(P))}}}request(e,o,h){const{relatedRequestId:l,resumptionToken:m,onresumptiontoken:x,task:s,relatedTask:P}=h??{};return new Promise((C,F)=>{var ie,it,Ve,Ne,Re;const O=Ye=>{F(Ye)};if(!this._transport){O(new Error("Not connected"));return}if(((ie=this._options)==null?void 0:ie.enforceStrictCapabilities)===!0)try{this.assertCapabilityForMethod(e.method),s&&this.assertTaskCapability(e.method)}catch(Ye){O(Ye);return}(it=h==null?void 0:h.signal)==null||it.throwIfAborted();const V=this._requestMessageId++,J={...e,jsonrpc:"2.0",id:V};h!=null&&h.onprogress&&(this._progressHandlers.set(V,h.onprogress),J.params={...e.params,_meta:{...((Ve=e.params)==null?void 0:Ve._meta)||{},progressToken:V}}),s&&(J.params={...J.params,task:s}),P&&(J.params={...J.params,_meta:{...((Ne=J.params)==null?void 0:Ne._meta)||{},[sd]:P}});const ee=Ye=>{var pt;this._responseHandlers.delete(V),this._progressHandlers.delete(V),this._cleanupTimeout(V),(pt=this._transport)==null||pt.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:V,reason:String(Ye)}},{relatedRequestId:l,resumptionToken:m,onresumptiontoken:x}).catch(St=>this._onerror(new Error(`Failed to send cancellation: ${St}`)));const zt=Ye instanceof fr?Ye:new fr(Pr.RequestTimeout,String(Ye));F(zt)};this._responseHandlers.set(V,Ye=>{var zt;if(!((zt=h==null?void 0:h.signal)!=null&&zt.aborted)){if(Ye instanceof Error)return F(Ye);try{const pt=QL(o,Ye.result);pt.success?C(pt.data):F(pt.error)}catch(pt){F(pt)}}}),(Re=h==null?void 0:h.signal)==null||Re.addEventListener("abort",()=>{var Ye;ee((Ye=h==null?void 0:h.signal)==null?void 0:Ye.reason)});const se=(h==null?void 0:h.timeout)??Sq,fe=()=>ee(fr.fromError(Pr.RequestTimeout,"Request timed out",{timeout:se}));this._setupTimeout(V,se,h==null?void 0:h.maxTotalTimeout,fe,(h==null?void 0:h.resetTimeoutOnProgress)??!1);const le=P==null?void 0:P.taskId;if(le){const Ye=zt=>{const pt=this._responseHandlers.get(V);pt?pt(zt):this._onerror(new Error(`Response handler missing for side-channeled request ${V}`))};this._requestResolvers.set(V,Ye),this._enqueueTaskMessage(le,{type:"request",message:J,timestamp:Date.now()}).catch(zt=>{this._cleanupTimeout(V),F(zt)})}else this._transport.send(J,{relatedRequestId:l,resumptionToken:m,onresumptiontoken:x}).catch(Ye=>{this._cleanupTimeout(V),F(Ye)})})}async getTask(e,o){return this.request({method:"tasks/get",params:e},UE,o)}async getTaskResult(e,o,h){return this.request({method:"tasks/result",params:e},o,h)}async listTasks(e,o){return this.request({method:"tasks/list",params:e},jE,o)}async cancelTask(e,o){return this.request({method:"tasks/cancel",params:e},tW,o)}async notification(e,o){var s,P,C,F;if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);const h=(s=o==null?void 0:o.relatedTask)==null?void 0:s.taskId;if(h){const O={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...((P=e.params)==null?void 0:P._meta)||{},[sd]:o.relatedTask}}};await this._enqueueTaskMessage(h,{type:"notification",message:O,timestamp:Date.now()});return}if((((C=this._options)==null?void 0:C.debouncedNotificationMethods)??[]).includes(e.method)&&!e.params&&!(o!=null&&o.relatedRequestId)&&!(o!=null&&o.relatedTask)){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{var V,J;if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let O={...e,jsonrpc:"2.0"};o!=null&&o.relatedTask&&(O={...O,params:{...O.params,_meta:{...((V=O.params)==null?void 0:V._meta)||{},[sd]:o.relatedTask}}}),(J=this._transport)==null||J.send(O,o).catch(ee=>this._onerror(ee))});return}let x={...e,jsonrpc:"2.0"};o!=null&&o.relatedTask&&(x={...x,params:{...x.params,_meta:{...((F=x.params)==null?void 0:F._meta)||{},[sd]:o.relatedTask}}}),await this._transport.send(x,o)}setRequestHandler(e,o){const h=lR(e);this.assertRequestHandlerCapability(h),this._requestHandlers.set(h,(l,m)=>{const x=cR(e,l);return Promise.resolve(o(x,m))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,o){const h=lR(e);this._notificationHandlers.set(h,l=>{const m=cR(e,l);return Promise.resolve(o(m))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){const o=this._taskProgressTokens.get(e);o!==void 0&&(this._progressHandlers.delete(o),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,o,h){var m;if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");const l=(m=this._options)==null?void 0:m.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,o,h,l)}async _clearTaskQueue(e,o){if(this._taskMessageQueue){const h=await this._taskMessageQueue.dequeueAll(e,o);for(const l of h)if(l.type==="request"&&aR(l.message)){const m=l.message.id,x=this._requestResolvers.get(m);x?(x(new fr(Pr.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(m)):this._onerror(new Error(`Resolver missing for request ${m} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,o){var l,m;let h=((l=this._options)==null?void 0:l.defaultTaskPollInterval)??1e3;try{const x=await((m=this._taskStore)==null?void 0:m.getTask(e));x!=null&&x.pollInterval&&(h=x.pollInterval)}catch{}return new Promise((x,s)=>{if(o.aborted){s(new fr(Pr.InvalidRequest,"Request cancelled"));return}const P=setTimeout(x,h);o.addEventListener("abort",()=>{clearTimeout(P),s(new fr(Pr.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,o){const h=this._taskStore;if(!h)throw new Error("No task store configured");return{createTask:async l=>{if(!e)throw new Error("No request provided");return await h.createTask(l,e.id,{method:e.method,params:e.params},o)},getTask:async l=>{const m=await h.getTask(l,o);if(!m)throw new fr(Pr.InvalidParams,"Failed to retrieve task: Task not found");return m},storeTaskResult:async(l,m,x)=>{await h.storeTaskResult(l,m,x,o);const s=await h.getTask(l,o);if(s){const P=K0.parse({method:"notifications/tasks/status",params:s});await this.notification(P),id(s.status)&&this._cleanupTaskProgressHandler(l)}},getTaskResult:l=>h.getTaskResult(l,o),updateTaskStatus:async(l,m,x)=>{const s=await h.getTask(l,o);if(!s)throw new fr(Pr.InvalidParams,`Task "${l}" not found - it may have been cleaned up`);if(id(s.status))throw new fr(Pr.InvalidParams,`Cannot update task "${l}" from terminal status "${s.status}" to "${m}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await h.updateTaskStatus(l,m,x,o);const P=await h.getTask(l,o);if(P){const C=K0.parse({method:"notifications/tasks/status",params:P});await this.notification(C),id(P.status)&&this._cleanupTaskProgressHandler(l)}},listTasks:l=>h.listTasks(l,o)}}}var Eq=Object.defineProperty,$c=(i,e)=>{for(var o in e)Eq(i,o,{get:e[o],enumerable:!0,configurable:!0,set:h=>e[o]=()=>h})};class Iq{constructor(e=window.parent,o){Is(this,"eventTarget");Is(this,"eventSource");Is(this,"messageListener");Is(this,"onclose");Is(this,"onerror");Is(this,"onmessage");Is(this,"sessionId");Is(this,"setProtocolVersion");this.eventTarget=e,this.eventSource=o,this.messageListener=h=>{var m,x;if(o&&h.source!==this.eventSource){console.debug("Ignoring message from unknown source",h);return}let l=F8.safeParse(h.data);l.success?(console.debug("Parsed message",l.data),(m=this.onmessage)==null||m.call(this,l.data)):(console.error("Failed to parse message",l.error.message,h),(x=this.onerror)==null||x.call(this,Error("Invalid JSON-RPC message received: "+l.error.message)))}}async start(){window.addEventListener("message",this.messageListener)}async send(e,o){console.debug("Sending message",e),this.eventTarget.postMessage(e,"*")}async close(){var e;window.removeEventListener("message",this.messageListener),(e=this.onclose)==null||e.call(this)}}var Mq="2026-01-26",Ue={};$c(Ue,{xor:()=>NB,xid:()=>lB,void:()=>LB,uuidv7:()=>eB,uuidv6:()=>QF,uuidv4:()=>KF,uuid:()=>YF,util:()=>Kn,url:()=>tB,uppercase:()=>Gb,unknown:()=>_d,union:()=>xw,undefined:()=>CB,ulid:()=>aB,uint64:()=>PB,uint32:()=>IB,tuple:()=>yM,trim:()=>Jb,treeifyError:()=>FD,transform:()=>ww,toUpperCase:()=>Kb,toLowerCase:()=>Yb,toJSONSchema:()=>PF,templateLiteral:()=>KB,symbol:()=>zB,superRefine:()=>HM,success:()=>XB,stringbool:()=>o4,stringFormat:()=>vB,string:()=>sb,strictObject:()=>FB,startsWith:()=>Zb,slugify:()=>Qb,size:()=>_y,setErrorMap:()=>qX,set:()=>GB,safeParseAsync:()=>UF,safeParse:()=>NF,safeEncodeAsync:()=>WF,safeEncode:()=>HF,safeDecodeAsync:()=>qF,safeDecode:()=>ZF,registry:()=>wI,regexes:()=>wd,regex:()=>Vb,refine:()=>GM,record:()=>vM,readonly:()=>BM,property:()=>WI,promise:()=>QB,prettifyError:()=>ND,preprocess:()=>a4,prefault:()=>CM,positive:()=>jI,pipe:()=>k_,partialRecord:()=>$B,parseAsync:()=>BF,parse:()=>FF,overwrite:()=>jc,optional:()=>L_,object:()=>OB,number:()=>iM,nullish:()=>qB,nullable:()=>D_,null:()=>aM,normalize:()=>Xb,nonpositive:()=>HI,nonoptional:()=>RM,nonnegative:()=>ZI,never:()=>yw,negative:()=>GI,nativeEnum:()=>HB,nanoid:()=>rB,nan:()=>JB,multipleOf:()=>Cp,minSize:()=>Ju,minLength:()=>gd,mime:()=>qb,meta:()=>n4,maxSize:()=>Zp,maxLength:()=>yy,map:()=>jB,mac:()=>hB,lte:()=>Xa,lt:()=>qu,lowercase:()=>jb,looseRecord:()=>VB,looseObject:()=>BB,locales:()=>bI,literal:()=>ZB,length:()=>vy,lazy:()=>$M,ksuid:()=>cB,keyof:()=>kB,jwt:()=>yB,json:()=>s4,iso:()=>JI,ipv6:()=>dB,ipv4:()=>uB,intersection:()=>gM,int64:()=>AB,int32:()=>EB,int:()=>ab,instanceof:()=>r4,includes:()=>Hb,httpUrl:()=>iB,hostname:()=>xB,hex:()=>bB,hash:()=>wB,guid:()=>JF,gte:()=>aa,gt:()=>Xu,globalRegistry:()=>qa,getErrorMap:()=>XX,function:()=>lb,fromJSONSchema:()=>QX,formatError:()=>tI,float64:()=>TB,float32:()=>SB,flattenError:()=>eI,file:()=>WB,exactOptional:()=>IM,enum:()=>bw,endsWith:()=>Wb,encodeAsync:()=>jF,encode:()=>$F,emoji:()=>nB,email:()=>XF,e164:()=>_B,discriminatedUnion:()=>UB,describe:()=>i4,decodeAsync:()=>GF,decode:()=>VF,date:()=>DB,custom:()=>t4,cuid2:()=>sB,cuid:()=>oB,core:()=>SD,config:()=>Ls,coerce:()=>c4,codec:()=>YB,clone:()=>il,cidrv6:()=>pB,cidrv4:()=>fB,check:()=>e4,catch:()=>kM,boolean:()=>nM,bigint:()=>MB,base64url:()=>gB,base64:()=>mB,array:()=>Iy,any:()=>RB,_function:()=>lb,_default:()=>PM,_ZodString:()=>ew,ZodXor:()=>fM,ZodXID:()=>aw,ZodVoid:()=>hM,ZodUnknown:()=>cM,ZodUnion:()=>Ay,ZodUndefined:()=>oM,ZodUUID:()=>ac,ZodURL:()=>wy,ZodULID:()=>sw,ZodType:()=>Bn,ZodTuple:()=>_M,ZodTransform:()=>TM,ZodTemplateLiteral:()=>NM,ZodSymbol:()=>rM,ZodSuccess:()=>LM,ZodStringFormat:()=>Br,ZodString:()=>by,ZodSet:()=>bM,ZodRecord:()=>Py,ZodRealError:()=>Ca,ZodReadonly:()=>FM,ZodPromise:()=>VM,ZodPrefault:()=>zM,ZodPipe:()=>Ew,ZodOptional:()=>Sw,ZodObject:()=>My,ZodNumberFormat:()=>Sd,ZodNumber:()=>Sy,ZodNullable:()=>MM,ZodNull:()=>sM,ZodNonOptional:()=>Tw,ZodNever:()=>uM,ZodNanoID:()=>nw,ZodNaN:()=>OM,ZodMap:()=>xM,ZodMAC:()=>tM,ZodLiteral:()=>wM,ZodLazy:()=>UM,ZodKSUID:()=>lw,ZodJWT:()=>gw,ZodIssueCode:()=>WX,ZodIntersection:()=>mM,ZodISOTime:()=>QI,ZodISODuration:()=>eM,ZodISODateTime:()=>YI,ZodISODate:()=>KI,ZodIPv6:()=>uw,ZodIPv4:()=>cw,ZodGUID:()=>R_,ZodFunction:()=>jM,ZodFirstPartyTypeKind:()=>FT,ZodFile:()=>SM,ZodExactOptional:()=>EM,ZodError:()=>ZX,ZodEnum:()=>kp,ZodEmoji:()=>iw,ZodEmail:()=>tw,ZodE164:()=>mw,ZodDiscriminatedUnion:()=>pM,ZodDefault:()=>AM,ZodDate:()=>vw,ZodCustomStringFormat:()=>Wp,ZodCustom:()=>zy,ZodCodec:()=>Iw,ZodCatch:()=>DM,ZodCUID2:()=>ow,ZodCUID:()=>rw,ZodCIDRv6:()=>dw,ZodCIDRv4:()=>hw,ZodBoolean:()=>Ty,ZodBigIntFormat:()=>_w,ZodBigInt:()=>Ey,ZodBase64URL:()=>pw,ZodBase64:()=>fw,ZodArray:()=>dM,ZodAny:()=>lM,TimePrecision:()=>lO,NEVER:()=>TD,$output:()=>iO,$input:()=>nO,$brand:()=>ED});var SD={};$c(SD,{version:()=>Nk,util:()=>Kn,treeifyError:()=>FD,toJSONSchema:()=>PF,toDotPath:()=>BD,safeParseAsync:()=>$D,safeParse:()=>UD,safeEncodeAsync:()=>s9,safeEncode:()=>r9,safeDecodeAsync:()=>a9,safeDecode:()=>o9,registry:()=>wI,regexes:()=>wd,process:()=>kr,prettifyError:()=>ND,parseAsync:()=>DT,parse:()=>LT,meta:()=>jO,locales:()=>bI,isValidJWT:()=>u3,isValidBase64URL:()=>a3,isValidBase64:()=>pI,initializeContext:()=>Rp,globalRegistry:()=>qa,globalConfig:()=>eb,formatError:()=>tI,flattenError:()=>eI,finalize:()=>Dp,extractDefs:()=>Lp,encodeAsync:()=>i9,encode:()=>e9,describe:()=>VO,decodeAsync:()=>n9,decode:()=>t9,createToJSONSchemaMethod:()=>HO,createStandardJSONSchemaMethod:()=>C_,config:()=>Ls,clone:()=>il,_xor:()=>bX,_xid:()=>LI,_void:()=>RO,_uuidv7:()=>MI,_uuidv6:()=>II,_uuidv4:()=>EI,_uuid:()=>TI,_url:()=>$b,_uppercase:()=>Gb,_unknown:()=>zO,_union:()=>xX,_undefined:()=>MO,_ulid:()=>RI,_uint64:()=>EO,_uint32:()=>vO,_tuple:()=>TX,_trim:()=>Jb,_transform:()=>CX,_toUpperCase:()=>Kb,_toLowerCase:()=>Yb,_templateLiteral:()=>UX,_symbol:()=>IO,_superRefine:()=>UO,_success:()=>OX,_stringbool:()=>GO,_stringFormat:()=>xy,_string:()=>oO,_startsWith:()=>Zb,_slugify:()=>Qb,_size:()=>_y,_set:()=>MX,_safeParseAsync:()=>dy,_safeParse:()=>hy,_safeEncodeAsync:()=>lI,_safeEncode:()=>sI,_safeDecodeAsync:()=>cI,_safeDecode:()=>aI,_regex:()=>Vb,_refine:()=>NO,_record:()=>EX,_readonly:()=>NX,_property:()=>WI,_promise:()=>VX,_positive:()=>jI,_pipe:()=>BX,_parseAsync:()=>uy,_parse:()=>cy,_overwrite:()=>jc,_optional:()=>RX,_number:()=>fO,_nullable:()=>LX,_null:()=>AO,_normalize:()=>Xb,_nonpositive:()=>HI,_nonoptional:()=>kX,_nonnegative:()=>ZI,_never:()=>CO,_negative:()=>GI,_nativeEnum:()=>PX,_nanoid:()=>PI,_nan:()=>kO,_multipleOf:()=>Cp,_minSize:()=>Ju,_minLength:()=>gd,_min:()=>aa,_mime:()=>qb,_maxSize:()=>Zp,_maxLength:()=>yy,_max:()=>Xa,_map:()=>IX,_mac:()=>aO,_lte:()=>Xa,_lt:()=>qu,_lowercase:()=>jb,_literal:()=>zX,_length:()=>vy,_lazy:()=>$X,_ksuid:()=>DI,_jwt:()=>VI,_isoTime:()=>hO,_isoDuration:()=>dO,_isoDateTime:()=>cO,_isoDate:()=>uO,_ipv6:()=>OI,_ipv4:()=>kI,_intersection:()=>SX,_int64:()=>TO,_int32:()=>yO,_int:()=>mO,_includes:()=>Hb,_guid:()=>ob,_gte:()=>aa,_gt:()=>Xu,_float64:()=>_O,_float32:()=>gO,_file:()=>FO,_enum:()=>AX,_endsWith:()=>Wb,_encodeAsync:()=>rI,_encode:()=>iI,_emoji:()=>AI,_email:()=>SI,_e164:()=>$I,_discriminatedUnion:()=>wX,_default:()=>DX,_decodeAsync:()=>oI,_decode:()=>nI,_date:()=>LO,_custom:()=>BO,_cuid2:()=>CI,_cuid:()=>zI,_coercedString:()=>sO,_coercedNumber:()=>pO,_coercedDate:()=>DO,_coercedBoolean:()=>bO,_coercedBigint:()=>SO,_cidrv6:()=>BI,_cidrv4:()=>FI,_check:()=>$O,_catch:()=>FX,_boolean:()=>xO,_bigint:()=>wO,_base64url:()=>UI,_base64:()=>NI,_array:()=>OO,_any:()=>PO,TimePrecision:()=>lO,NEVER:()=>TD,JSONSchemaGenerator:()=>GX,JSONSchema:()=>HX,Doc:()=>Bk,$output:()=>iO,$input:()=>nO,$constructor:()=>mt,$brand:()=>ED,$ZodXor:()=>A3,$ZodXID:()=>Xk,$ZodVoid:()=>b3,$ZodUnknown:()=>v3,$ZodUnion:()=>Ub,$ZodUndefined:()=>g3,$ZodUUID:()=>$k,$ZodURL:()=>jk,$ZodULID:()=>qk,$ZodType:()=>Ln,$ZodTuple:()=>yI,$ZodTransform:()=>F3,$ZodTemplateLiteral:()=>q3,$ZodSymbol:()=>m3,$ZodSuccess:()=>j3,$ZodStringFormat:()=>Fr,$ZodString:()=>gy,$ZodSet:()=>L3,$ZodRegistry:()=>rO,$ZodRecord:()=>C3,$ZodRealError:()=>za,$ZodReadonly:()=>W3,$ZodPromise:()=>J3,$ZodPrefault:()=>$3,$ZodPipe:()=>Z3,$ZodOptional:()=>vI,$ZodObjectJIT:()=>M3,$ZodObject:()=>I3,$ZodNumberFormat:()=>f3,$ZodNumber:()=>mI,$ZodNullable:()=>N3,$ZodNull:()=>_3,$ZodNonOptional:()=>V3,$ZodNever:()=>x3,$ZodNanoID:()=>Hk,$ZodNaN:()=>H3,$ZodMap:()=>R3,$ZodMAC:()=>n3,$ZodLiteral:()=>k3,$ZodLazy:()=>Y3,$ZodKSUID:()=>Jk,$ZodJWT:()=>h3,$ZodIntersection:()=>z3,$ZodISOTime:()=>Qk,$ZodISODuration:()=>e3,$ZodISODateTime:()=>Yk,$ZodISODate:()=>Kk,$ZodIPv6:()=>i3,$ZodIPv4:()=>t3,$ZodGUID:()=>Uk,$ZodFunction:()=>X3,$ZodFile:()=>O3,$ZodExactOptional:()=>B3,$ZodError:()=>QE,$ZodEnum:()=>D3,$ZodEncodeError:()=>Ob,$ZodEmoji:()=>Gk,$ZodEmail:()=>Vk,$ZodE164:()=>c3,$ZodDiscriminatedUnion:()=>P3,$ZodDefault:()=>U3,$ZodDate:()=>w3,$ZodCustomStringFormat:()=>d3,$ZodCustom:()=>K3,$ZodCodec:()=>xI,$ZodCheckUpperCase:()=>Ck,$ZodCheckStringFormat:()=>my,$ZodCheckStartsWith:()=>Lk,$ZodCheckSizeEquals:()=>Ek,$ZodCheckRegex:()=>Pk,$ZodCheckProperty:()=>kk,$ZodCheckOverwrite:()=>Fk,$ZodCheckNumberFormat:()=>bk,$ZodCheckMultipleOf:()=>xk,$ZodCheckMinSize:()=>Tk,$ZodCheckMinLength:()=>Mk,$ZodCheckMimeType:()=>Ok,$ZodCheckMaxSize:()=>Sk,$ZodCheckMaxLength:()=>Ik,$ZodCheckLowerCase:()=>zk,$ZodCheckLessThan:()=>dI,$ZodCheckLengthEquals:()=>Ak,$ZodCheckIncludes:()=>Rk,$ZodCheckGreaterThan:()=>fI,$ZodCheckEndsWith:()=>Dk,$ZodCheckBigIntFormat:()=>wk,$ZodCheck:()=>ro,$ZodCatch:()=>G3,$ZodCUID2:()=>Wk,$ZodCUID:()=>Zk,$ZodCIDRv6:()=>o3,$ZodCIDRv4:()=>r3,$ZodBoolean:()=>gI,$ZodBigIntFormat:()=>p3,$ZodBigInt:()=>_I,$ZodBase64URL:()=>l3,$ZodBase64:()=>s3,$ZodAsyncError:()=>dd,$ZodArray:()=>S3,$ZodAny:()=>y3});var TD=Object.freeze({status:"aborted"});function mt(i,e,o){function h(s,P){if(s._zod||Object.defineProperty(s,"_zod",{value:{def:P,constr:x,traits:new Set},enumerable:!1}),s._zod.traits.has(i))return;s._zod.traits.add(i),e(s,P);let C=x.prototype,F=Object.keys(C);for(let O=0;O<F.length;O++){let V=F[O];V in s||(s[V]=C[V].bind(s))}}let l=(o==null?void 0:o.Parent)??Object;class m extends l{}Object.defineProperty(m,"name",{value:i});function x(s){var P;let C=o!=null&&o.Parent?new m:this;h(C,s),(P=C._zod).deferred??(P.deferred=[]);for(let F of C._zod.deferred)F();return C}return Object.defineProperty(x,"init",{value:h}),Object.defineProperty(x,Symbol.hasInstance,{value:s=>{var P,C;return o!=null&&o.Parent&&s instanceof o.Parent?!0:(C=(P=s==null?void 0:s._zod)==null?void 0:P.traits)==null?void 0:C.has(i)}}),Object.defineProperty(x,"name",{value:i}),x}var ED=Symbol("zod_brand");class dd extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Ob extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}var eb={};function Ls(i){return i&&Object.assign(eb,i),eb}var Kn={};$c(Kn,{unwrapMessage:()=>b_,uint8ArrayToHex:()=>Kq,uint8ArrayToBase64url:()=>Jq,uint8ArrayToBase64:()=>kD,stringifyPrimitive:()=>vn,slugify:()=>MD,shallowClone:()=>PD,safeExtend:()=>Gq,required:()=>Wq,randomString:()=>Fq,propertyKeyTypes:()=>ib,promiseAllObject:()=>Oq,primitiveTypes:()=>zD,prefixIssues:()=>Al,pick:()=>$q,partial:()=>Zq,parsedType:()=>Sn,optionalKeys:()=>CD,omit:()=>Vq,objectClone:()=>Lq,numKeys:()=>Bq,nullish:()=>bd,normalizeParams:()=>ci,mergeDefs:()=>Vc,merge:()=>Hq,jsonStringifyReplacer:()=>tb,joinValues:()=>si,issue:()=>nb,isPlainObject:()=>md,isObject:()=>Pp,hexToUint8Array:()=>Yq,getSizableOrigin:()=>Bb,getParsedType:()=>Nq,getLengthableOrigin:()=>Nb,getEnumValues:()=>YE,getElementAtPath:()=>kq,floatSafeRemainder:()=>ID,finalizeIssue:()=>Ya,extend:()=>jq,escapeRegex:()=>Nc,esc:()=>RT,defineLazy:()=>Hn,createTransparentProxy:()=>Uq,cloneDef:()=>Dq,clone:()=>il,cleanRegex:()=>Fb,cleanEnum:()=>qq,captureStackTrace:()=>KE,cached:()=>ly,base64urlToUint8Array:()=>Xq,base64ToUint8Array:()=>DD,assignProp:()=>th,assertNotEqual:()=>Pq,assertNever:()=>Cq,assertIs:()=>zq,assertEqual:()=>Aq,assert:()=>Rq,allowsEval:()=>AD,aborted:()=>ld,NUMBER_FORMAT_RANGES:()=>RD,Class:()=>Qq,BIGINT_FORMAT_RANGES:()=>LD});function Aq(i){return i}function Pq(i){return i}function zq(i){}function Cq(i){throw Error("Unexpected value in exhaustive check")}function Rq(i){}function YE(i){let e=Object.values(i).filter(o=>typeof o=="number");return Object.entries(i).filter(([o,h])=>e.indexOf(+o)===-1).map(([o,h])=>h)}function si(i,e="|"){return i.map(o=>vn(o)).join(e)}function tb(i,e){return typeof e=="bigint"?e.toString():e}function ly(i){return{get value(){{let e=i();return Object.defineProperty(this,"value",{value:e}),e}}}}function bd(i){return i==null}function Fb(i){let e=i.startsWith("^")?1:0,o=i.endsWith("$")?i.length-1:i.length;return i.slice(e,o)}function ID(i,e){let o=(i.toString().split(".")[1]||"").length,h=e.toString(),l=(h.split(".")[1]||"").length;if(l===0&&/\d?e-\d?/.test(h)){let P=h.match(/\d?e-(\d?)/);P!=null&&P[1]&&(l=Number.parseInt(P[1]))}let m=o>l?o:l,x=Number.parseInt(i.toFixed(m).replace(".","")),s=Number.parseInt(e.toFixed(m).replace(".",""));return x%s/10**m}var uR=Symbol("evaluating");function Hn(i,e,o){let h;Object.defineProperty(i,e,{get(){if(h!==uR)return h===void 0&&(h=uR,h=o()),h},set(l){Object.defineProperty(i,e,{value:l})},configurable:!0})}function Lq(i){return Object.create(Object.getPrototypeOf(i),Object.getOwnPropertyDescriptors(i))}function th(i,e,o){Object.defineProperty(i,e,{value:o,writable:!0,enumerable:!0,configurable:!0})}function Vc(...i){let e={};for(let o of i){let h=Object.getOwnPropertyDescriptors(o);Object.assign(e,h)}return Object.defineProperties({},e)}function Dq(i){return Vc(i._zod.def)}function kq(i,e){return e?e.reduce((o,h)=>o==null?void 0:o[h],i):i}function Oq(i){let e=Object.keys(i),o=e.map(h=>i[h]);return Promise.all(o).then(h=>{let l={};for(let m=0;m<e.length;m++)l[e[m]]=h[m];return l})}function Fq(i=10){let e="";for(let o=0;o<i;o++)e+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)];return e}function RT(i){return JSON.stringify(i)}function MD(i){return i.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}var KE="captureStackTrace"in Error?Error.captureStackTrace:(...i)=>{};function Pp(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}var AD=ly(()=>{var i;if(typeof navigator<"u"&&((i=navigator==null?void 0:navigator.userAgent)!=null&&i.includes("Cloudflare")))return!1;try{return new Function(""),!0}catch{return!1}});function md(i){if(Pp(i)===!1)return!1;let e=i.constructor;if(e===void 0||typeof e!="function")return!0;let o=e.prototype;return!(Pp(o)===!1||Object.prototype.hasOwnProperty.call(o,"isPrototypeOf")===!1)}function PD(i){return md(i)?{...i}:Array.isArray(i)?[...i]:i}function Bq(i){let e=0;for(let o in i)Object.prototype.hasOwnProperty.call(i,o)&&e++;return e}var Nq=i=>{let e=typeof i;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(i)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(i)?"array":i===null?"null":i.then&&typeof i.then=="function"&&i.catch&&typeof i.catch=="function"?"promise":typeof Map<"u"&&i instanceof Map?"map":typeof Set<"u"&&i instanceof Set?"set":typeof Date<"u"&&i instanceof Date?"date":typeof File<"u"&&i instanceof File?"file":"object";default:throw Error(`Unknown data type: ${e}`)}},ib=new Set(["string","number","symbol"]),zD=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Nc(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function il(i,e,o){let h=new i._zod.constr(e??i._zod.def);return(!e||o!=null&&o.parent)&&(h._zod.parent=i),h}function ci(i){let e=i;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function Uq(i){let e;return new Proxy({},{get(o,h,l){return e??(e=i()),Reflect.get(e,h,l)},set(o,h,l,m){return e??(e=i()),Reflect.set(e,h,l,m)},has(o,h){return e??(e=i()),Reflect.has(e,h)},deleteProperty(o,h){return e??(e=i()),Reflect.deleteProperty(e,h)},ownKeys(o){return e??(e=i()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(o,h){return e??(e=i()),Reflect.getOwnPropertyDescriptor(e,h)},defineProperty(o,h,l){return e??(e=i()),Reflect.defineProperty(e,h,l)}})}function vn(i){return typeof i=="bigint"?i.toString()+"n":typeof i=="string"?`"${i}"`:`${i}`}function CD(i){return Object.keys(i).filter(e=>i[e]._zod.optin==="optional"&&i[e]._zod.optout==="optional")}var RD={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},LD={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function $q(i,e){let o=i._zod.def,h=o.checks;if(h&&h.length>0)throw Error(".pick() cannot be used on object schemas containing refinements");let l=Vc(i._zod.def,{get shape(){let m={};for(let x in e){if(!(x in o.shape))throw Error(`Unrecognized key: "${x}"`);e[x]&&(m[x]=o.shape[x])}return th(this,"shape",m),m},checks:[]});return il(i,l)}function Vq(i,e){let o=i._zod.def,h=o.checks;if(h&&h.length>0)throw Error(".omit() cannot be used on object schemas containing refinements");let l=Vc(i._zod.def,{get shape(){let m={...i._zod.def.shape};for(let x in e){if(!(x in o.shape))throw Error(`Unrecognized key: "${x}"`);e[x]&&delete m[x]}return th(this,"shape",m),m},checks:[]});return il(i,l)}function jq(i,e){if(!md(e))throw Error("Invalid input to extend: expected a plain object");let o=i._zod.def.checks;if(o&&o.length>0){let l=i._zod.def.shape;for(let m in e)if(Object.getOwnPropertyDescriptor(l,m)!==void 0)throw Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}let h=Vc(i._zod.def,{get shape(){let l={...i._zod.def.shape,...e};return th(this,"shape",l),l}});return il(i,h)}function Gq(i,e){if(!md(e))throw Error("Invalid input to safeExtend: expected a plain object");let o=Vc(i._zod.def,{get shape(){let h={...i._zod.def.shape,...e};return th(this,"shape",h),h}});return il(i,o)}function Hq(i,e){let o=Vc(i._zod.def,{get shape(){let h={...i._zod.def.shape,...e._zod.def.shape};return th(this,"shape",h),h},get catchall(){return e._zod.def.catchall},checks:[]});return il(i,o)}function Zq(i,e,o){let h=e._zod.def.checks;if(h&&h.length>0)throw Error(".partial() cannot be used on object schemas containing refinements");let l=Vc(e._zod.def,{get shape(){let m=e._zod.def.shape,x={...m};if(o)for(let s in o){if(!(s in m))throw Error(`Unrecognized key: "${s}"`);o[s]&&(x[s]=i?new i({type:"optional",innerType:m[s]}):m[s])}else for(let s in m)x[s]=i?new i({type:"optional",innerType:m[s]}):m[s];return th(this,"shape",x),x},checks:[]});return il(e,l)}function Wq(i,e,o){let h=Vc(e._zod.def,{get shape(){let l=e._zod.def.shape,m={...l};if(o)for(let x in o){if(!(x in m))throw Error(`Unrecognized key: "${x}"`);o[x]&&(m[x]=new i({type:"nonoptional",innerType:l[x]}))}else for(let x in l)m[x]=new i({type:"nonoptional",innerType:l[x]});return th(this,"shape",m),m}});return il(e,h)}function ld(i,e=0){var o;if(i.aborted===!0)return!0;for(let h=e;h<i.issues.length;h++)if(((o=i.issues[h])==null?void 0:o.continue)!==!0)return!0;return!1}function Al(i,e){return e.map(o=>{var h;return(h=o).path??(h.path=[]),o.path.unshift(i),o})}function b_(i){return typeof i=="string"?i:i==null?void 0:i.message}function Ya(i,e,o){var l,m,x,s,P,C;let h={...i,path:i.path??[]};if(!i.message){let F=b_((x=(m=(l=i.inst)==null?void 0:l._zod.def)==null?void 0:m.error)==null?void 0:x.call(m,i))??b_((s=e==null?void 0:e.error)==null?void 0:s.call(e,i))??b_((P=o.customError)==null?void 0:P.call(o,i))??b_((C=o.localeError)==null?void 0:C.call(o,i))??"Invalid input";h.message=F}return delete h.inst,delete h.continue,!(e!=null&&e.reportInput)&&delete h.input,h}function Bb(i){return i instanceof Set?"set":i instanceof Map?"map":i instanceof File?"file":"unknown"}function Nb(i){return Array.isArray(i)?"array":typeof i=="string"?"string":"unknown"}function Sn(i){let e=typeof i;switch(e){case"number":return Number.isNaN(i)?"nan":"number";case"object":{if(i===null)return"null";if(Array.isArray(i))return"array";let o=i;if(o&&Object.getPrototypeOf(o)!==Object.prototype&&"constructor"in o&&o.constructor)return o.constructor.name}}return e}function nb(...i){let[e,o,h]=i;return typeof e=="string"?{message:e,code:"custom",input:o,inst:h}:{...e}}function qq(i){return Object.entries(i).filter(([e,o])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}function DD(i){let e=atob(i),o=new Uint8Array(e.length);for(let h=0;h<e.length;h++)o[h]=e.charCodeAt(h);return o}function kD(i){let e="";for(let o=0;o<i.length;o++)e+=String.fromCharCode(i[o]);return btoa(e)}function Xq(i){let e=i.replace(/-/g,"+").replace(/_/g,"/"),o="=".repeat((4-e.length%4)%4);return DD(e+o)}function Jq(i){return kD(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Yq(i){let e=i.replace(/^0x/,"");if(e.length%2!==0)throw Error("Invalid hex string length");let o=new Uint8Array(e.length/2);for(let h=0;h<e.length;h+=2)o[h/2]=Number.parseInt(e.slice(h,h+2),16);return o}function Kq(i){return Array.from(i).map(e=>e.toString(16).padStart(2,"0")).join("")}class Qq{constructor(...e){}}var OD=(i,e)=>{i.name="$ZodError",Object.defineProperty(i,"_zod",{value:i._zod,enumerable:!1}),Object.defineProperty(i,"issues",{value:e,enumerable:!1}),i.message=JSON.stringify(e,tb,2),Object.defineProperty(i,"toString",{value:()=>i.message,enumerable:!1})},QE=mt("$ZodError",OD),za=mt("$ZodError",OD,{Parent:Error});function eI(i,e=o=>o.message){let o={},h=[];for(let l of i.issues)l.path.length>0?(o[l.path[0]]=o[l.path[0]]||[],o[l.path[0]].push(e(l))):h.push(e(l));return{formErrors:h,fieldErrors:o}}function tI(i,e=o=>o.message){let o={_errors:[]},h=l=>{for(let m of l.issues)if(m.code==="invalid_union"&&m.errors.length)m.errors.map(x=>h({issues:x}));else if(m.code==="invalid_key")h({issues:m.issues});else if(m.code==="invalid_element")h({issues:m.issues});else if(m.path.length===0)o._errors.push(e(m));else{let x=o,s=0;for(;s<m.path.length;){let P=m.path[s];s!==m.path.length-1?x[P]=x[P]||{_errors:[]}:(x[P]=x[P]||{_errors:[]},x[P]._errors.push(e(m))),x=x[P],s++}}};return h(i),o}function FD(i,e=o=>o.message){let o={errors:[]},h=(l,m=[])=>{var x,s;for(let P of l.issues)if(P.code==="invalid_union"&&P.errors.length)P.errors.map(C=>h({issues:C},P.path));else if(P.code==="invalid_key")h({issues:P.issues},P.path);else if(P.code==="invalid_element")h({issues:P.issues},P.path);else{let C=[...m,...P.path];if(C.length===0){o.errors.push(e(P));continue}let F=o,O=0;for(;O<C.length;){let V=C[O],J=O===C.length-1;typeof V=="string"?(F.properties??(F.properties={}),(x=F.properties)[V]??(x[V]={errors:[]}),F=F.properties[V]):(F.items??(F.items=[]),(s=F.items)[V]??(s[V]={errors:[]}),F=F.items[V]),J&&F.errors.push(e(P)),O++}}};return h(i),o}function BD(i){let e=[],o=i.map(h=>typeof h=="object"?h.key:h);for(let h of o)typeof h=="number"?e.push(`[${h}]`):typeof h=="symbol"?e.push(`[${JSON.stringify(String(h))}]`):/[^\w$]/.test(h)?e.push(`[${JSON.stringify(h)}]`):(e.length&&e.push("."),e.push(h));return e.join("")}function ND(i){var h;let e=[],o=[...i.issues].sort((l,m)=>(l.path??[]).length-(m.path??[]).length);for(let l of o)e.push(`âœ– ${l.message}`),(h=l.path)!=null&&h.length&&e.push(`  â†’ at ${BD(l.path)}`);return e.join(`
`)}var cy=i=>(e,o,h,l)=>{let m=h?Object.assign(h,{async:!1}):{async:!1},x=e._zod.run({value:o,issues:[]},m);if(x instanceof Promise)throw new dd;if(x.issues.length){let s=new((l==null?void 0:l.Err)??i)(x.issues.map(P=>Ya(P,m,Ls())));throw KE(s,l==null?void 0:l.callee),s}return x.value},LT=cy(za),uy=i=>async(e,o,h,l)=>{let m=h?Object.assign(h,{async:!0}):{async:!0},x=e._zod.run({value:o,issues:[]},m);if(x instanceof Promise&&(x=await x),x.issues.length){let s=new((l==null?void 0:l.Err)??i)(x.issues.map(P=>Ya(P,m,Ls())));throw KE(s,l==null?void 0:l.callee),s}return x.value},DT=uy(za),hy=i=>(e,o,h)=>{let l=h?{...h,async:!1}:{async:!1},m=e._zod.run({value:o,issues:[]},l);if(m instanceof Promise)throw new dd;return m.issues.length?{success:!1,error:new(i??QE)(m.issues.map(x=>Ya(x,l,Ls())))}:{success:!0,data:m.value}},UD=hy(za),dy=i=>async(e,o,h)=>{let l=h?Object.assign(h,{async:!0}):{async:!0},m=e._zod.run({value:o,issues:[]},l);return m instanceof Promise&&(m=await m),m.issues.length?{success:!1,error:new i(m.issues.map(x=>Ya(x,l,Ls())))}:{success:!0,data:m.value}},$D=dy(za),iI=i=>(e,o,h)=>{let l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return cy(i)(e,o,l)},e9=iI(za),nI=i=>(e,o,h)=>cy(i)(e,o,h),t9=nI(za),rI=i=>async(e,o,h)=>{let l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return uy(i)(e,o,l)},i9=rI(za),oI=i=>async(e,o,h)=>uy(i)(e,o,h),n9=oI(za),sI=i=>(e,o,h)=>{let l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return hy(i)(e,o,l)},r9=sI(za),aI=i=>(e,o,h)=>hy(i)(e,o,h),o9=aI(za),lI=i=>async(e,o,h)=>{let l=h?Object.assign(h,{direction:"backward"}):{direction:"backward"};return dy(i)(e,o,l)},s9=lI(za),cI=i=>async(e,o,h)=>dy(i)(e,o,h),a9=cI(za),wd={};$c(wd,{xid:()=>HD,uuid7:()=>h9,uuid6:()=>u9,uuid4:()=>c9,uuid:()=>zp,uppercase:()=>yk,unicodeEmail:()=>YD,undefined:()=>gk,ulid:()=>GD,time:()=>ck,string:()=>hk,sha512_hex:()=>R9,sha512_base64url:()=>D9,sha512_base64:()=>L9,sha384_hex:()=>P9,sha384_base64url:()=>C9,sha384_base64:()=>z9,sha256_hex:()=>I9,sha256_base64url:()=>A9,sha256_base64:()=>M9,sha1_hex:()=>S9,sha1_base64url:()=>E9,sha1_base64:()=>T9,rfc5322Email:()=>f9,number:()=>hI,null:()=>mk,nanoid:()=>WD,md5_hex:()=>x9,md5_base64url:()=>w9,md5_base64:()=>b9,mac:()=>tk,lowercase:()=>_k,ksuid:()=>ZD,ipv6:()=>ek,ipv4:()=>QD,integer:()=>fk,idnEmail:()=>p9,html5Email:()=>d9,hostname:()=>_9,hex:()=>v9,guid:()=>XD,extendedDuration:()=>l9,emoji:()=>KD,email:()=>JD,e164:()=>ok,duration:()=>qD,domain:()=>y9,datetime:()=>uk,date:()=>ak,cuid2:()=>jD,cuid:()=>VD,cidrv6:()=>nk,cidrv4:()=>ik,browserEmail:()=>m9,boolean:()=>pk,bigint:()=>dk,base64url:()=>uI,base64:()=>rk});var VD=/^[cC][^\s-]{8,}$/,jD=/^[0-9a-z]+$/,GD=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,HD=/^[0-9a-vA-V]{20}$/,ZD=/^[A-Za-z0-9]{27}$/,WD=/^[a-zA-Z0-9_-]{21}$/,qD=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,l9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,XD=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,zp=i=>i?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${i}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,c9=zp(4),u9=zp(6),h9=zp(7),JD=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,d9=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,f9=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,YD=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,p9=YD,m9=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,g9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function KD(){return new RegExp(g9,"u")}var QD=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ek=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,tk=i=>{let e=Nc(i??":");return new RegExp(`^(?:[0-9A-F]{2}${e}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${e}){5}[0-9a-f]{2}$`)},ik=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,nk=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,rk=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,uI=/^[A-Za-z0-9_-]*$/,_9=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,y9=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,ok=/^\+[1-9]\d{6,14}$/,sk="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",ak=new RegExp(`^${sk}$`);function lk(i){return typeof i.precision=="number"?i.precision===-1?"(?:[01]\\d|2[0-3]):[0-5]\\d":i.precision===0?"(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d":`(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d\\.\\d{${i.precision}}`:"(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?"}function ck(i){return new RegExp(`^${lk(i)}$`)}function uk(i){let e=lk({precision:i.precision}),o=["Z"];i.local&&o.push(""),i.offset&&o.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let h=`${e}(?:${o.join("|")})`;return new RegExp(`^${sk}T(?:${h})$`)}var hk=i=>{let e=i?`[\\s\\S]{${(i==null?void 0:i.minimum)??0},${(i==null?void 0:i.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},dk=/^-?\d+n?$/,fk=/^-?\d+$/,hI=/^-?\d+(?:\.\d+)?$/,pk=/^(?:true|false)$/i,mk=/^null$/i,gk=/^undefined$/i,_k=/^[^A-Z]*$/,yk=/^[^a-z]*$/,v9=/^[0-9a-fA-F]*$/;function fy(i,e){return new RegExp(`^[A-Za-z0-9+/]{${i}}${e}$`)}function py(i){return new RegExp(`^[A-Za-z0-9_-]{${i}}$`)}var x9=/^[0-9a-fA-F]{32}$/,b9=fy(22,"=="),w9=py(22),S9=/^[0-9a-fA-F]{40}$/,T9=fy(27,"="),E9=py(27),I9=/^[0-9a-fA-F]{64}$/,M9=fy(43,"="),A9=py(43),P9=/^[0-9a-fA-F]{96}$/,z9=fy(64,""),C9=py(64),R9=/^[0-9a-fA-F]{128}$/,L9=fy(86,"=="),D9=py(86),ro=mt("$ZodCheck",(i,e)=>{var o;i._zod??(i._zod={}),i._zod.def=e,(o=i._zod).onattach??(o.onattach=[])}),vk={number:"number",bigint:"bigint",object:"date"},dI=mt("$ZodCheckLessThan",(i,e)=>{ro.init(i,e);let o=vk[typeof e.value];i._zod.onattach.push(h=>{let l=h._zod.bag,m=(e.inclusive?l.maximum:l.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<m&&(e.inclusive?l.maximum=e.value:l.exclusiveMaximum=e.value)}),i._zod.check=h=>{(e.inclusive?h.value<=e.value:h.value<e.value)||h.issues.push({origin:o,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:h.value,inclusive:e.inclusive,inst:i,continue:!e.abort})}}),fI=mt("$ZodCheckGreaterThan",(i,e)=>{ro.init(i,e);let o=vk[typeof e.value];i._zod.onattach.push(h=>{let l=h._zod.bag,m=(e.inclusive?l.minimum:l.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>m&&(e.inclusive?l.minimum=e.value:l.exclusiveMinimum=e.value)}),i._zod.check=h=>{(e.inclusive?h.value>=e.value:h.value>e.value)||h.issues.push({origin:o,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:h.value,inclusive:e.inclusive,inst:i,continue:!e.abort})}}),xk=mt("$ZodCheckMultipleOf",(i,e)=>{ro.init(i,e),i._zod.onattach.push(o=>{var h;(h=o._zod.bag).multipleOf??(h.multipleOf=e.value)}),i._zod.check=o=>{if(typeof o.value!=typeof e.value)throw Error("Cannot mix number and bigint in multiple_of check.");(typeof o.value=="bigint"?o.value%e.value===BigInt(0):ID(o.value,e.value)===0)||o.issues.push({origin:typeof o.value,code:"not_multiple_of",divisor:e.value,input:o.value,inst:i,continue:!e.abort})}}),bk=mt("$ZodCheckNumberFormat",(i,e)=>{var x;ro.init(i,e),e.format=e.format||"float64";let o=(x=e.format)==null?void 0:x.includes("int"),h=o?"int":"number",[l,m]=RD[e.format];i._zod.onattach.push(s=>{let P=s._zod.bag;P.format=e.format,P.minimum=l,P.maximum=m,o&&(P.pattern=fk)}),i._zod.check=s=>{let P=s.value;if(o){if(!Number.isInteger(P)){s.issues.push({expected:h,format:e.format,code:"invalid_type",continue:!1,input:P,inst:i});return}if(!Number.isSafeInteger(P)){P>0?s.issues.push({input:P,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:i,origin:h,inclusive:!0,continue:!e.abort}):s.issues.push({input:P,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:i,origin:h,inclusive:!0,continue:!e.abort});return}}P<l&&s.issues.push({origin:"number",input:P,code:"too_small",minimum:l,inclusive:!0,inst:i,continue:!e.abort}),P>m&&s.issues.push({origin:"number",input:P,code:"too_big",maximum:m,inclusive:!0,inst:i,continue:!e.abort})}}),wk=mt("$ZodCheckBigIntFormat",(i,e)=>{ro.init(i,e);let[o,h]=LD[e.format];i._zod.onattach.push(l=>{let m=l._zod.bag;m.format=e.format,m.minimum=o,m.maximum=h}),i._zod.check=l=>{let m=l.value;m<o&&l.issues.push({origin:"bigint",input:m,code:"too_small",minimum:o,inclusive:!0,inst:i,continue:!e.abort}),m>h&&l.issues.push({origin:"bigint",input:m,code:"too_big",maximum:h,inclusive:!0,inst:i,continue:!e.abort})}}),Sk=mt("$ZodCheckMaxSize",(i,e)=>{var o;ro.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!bd(l)&&l.size!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<l&&(h._zod.bag.maximum=e.maximum)}),i._zod.check=h=>{let l=h.value;l.size<=e.maximum||h.issues.push({origin:Bb(l),code:"too_big",maximum:e.maximum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),Tk=mt("$ZodCheckMinSize",(i,e)=>{var o;ro.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!bd(l)&&l.size!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>l&&(h._zod.bag.minimum=e.minimum)}),i._zod.check=h=>{let l=h.value;l.size>=e.minimum||h.issues.push({origin:Bb(l),code:"too_small",minimum:e.minimum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),Ek=mt("$ZodCheckSizeEquals",(i,e)=>{var o;ro.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!bd(l)&&l.size!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag;l.minimum=e.size,l.maximum=e.size,l.size=e.size}),i._zod.check=h=>{let l=h.value,m=l.size;if(m===e.size)return;let x=m>e.size;h.issues.push({origin:Bb(l),...x?{code:"too_big",maximum:e.size}:{code:"too_small",minimum:e.size},inclusive:!0,exact:!0,input:h.value,inst:i,continue:!e.abort})}}),Ik=mt("$ZodCheckMaxLength",(i,e)=>{var o;ro.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!bd(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<l&&(h._zod.bag.maximum=e.maximum)}),i._zod.check=h=>{let l=h.value;if(l.length<=e.maximum)return;let m=Nb(l);h.issues.push({origin:m,code:"too_big",maximum:e.maximum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),Mk=mt("$ZodCheckMinLength",(i,e)=>{var o;ro.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!bd(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>l&&(h._zod.bag.minimum=e.minimum)}),i._zod.check=h=>{let l=h.value;if(l.length>=e.minimum)return;let m=Nb(l);h.issues.push({origin:m,code:"too_small",minimum:e.minimum,inclusive:!0,input:l,inst:i,continue:!e.abort})}}),Ak=mt("$ZodCheckLengthEquals",(i,e)=>{var o;ro.init(i,e),(o=i._zod.def).when??(o.when=h=>{let l=h.value;return!bd(l)&&l.length!==void 0}),i._zod.onattach.push(h=>{let l=h._zod.bag;l.minimum=e.length,l.maximum=e.length,l.length=e.length}),i._zod.check=h=>{let l=h.value,m=l.length;if(m===e.length)return;let x=Nb(l),s=m>e.length;h.issues.push({origin:x,...s?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:h.value,inst:i,continue:!e.abort})}}),my=mt("$ZodCheckStringFormat",(i,e)=>{var o,h;ro.init(i,e),i._zod.onattach.push(l=>{let m=l._zod.bag;m.format=e.format,e.pattern&&(m.patterns??(m.patterns=new Set),m.patterns.add(e.pattern))}),e.pattern?(o=i._zod).check??(o.check=l=>{e.pattern.lastIndex=0,!e.pattern.test(l.value)&&l.issues.push({origin:"string",code:"invalid_format",format:e.format,input:l.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:i,continue:!e.abort})}):(h=i._zod).check??(h.check=()=>{})}),Pk=mt("$ZodCheckRegex",(i,e)=>{my.init(i,e),i._zod.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:"regex",input:o.value,pattern:e.pattern.toString(),inst:i,continue:!e.abort})}}),zk=mt("$ZodCheckLowerCase",(i,e)=>{e.pattern??(e.pattern=_k),my.init(i,e)}),Ck=mt("$ZodCheckUpperCase",(i,e)=>{e.pattern??(e.pattern=yk),my.init(i,e)}),Rk=mt("$ZodCheckIncludes",(i,e)=>{ro.init(i,e);let o=Nc(e.includes),h=new RegExp(typeof e.position=="number"?`^.{${e.position}}${o}`:o);e.pattern=h,i._zod.onattach.push(l=>{let m=l._zod.bag;m.patterns??(m.patterns=new Set),m.patterns.add(h)}),i._zod.check=l=>{l.value.includes(e.includes,e.position)||l.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:l.value,inst:i,continue:!e.abort})}}),Lk=mt("$ZodCheckStartsWith",(i,e)=>{ro.init(i,e);let o=new RegExp(`^${Nc(e.prefix)}.*`);e.pattern??(e.pattern=o),i._zod.onattach.push(h=>{let l=h._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(o)}),i._zod.check=h=>{h.value.startsWith(e.prefix)||h.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:h.value,inst:i,continue:!e.abort})}}),Dk=mt("$ZodCheckEndsWith",(i,e)=>{ro.init(i,e);let o=new RegExp(`.*${Nc(e.suffix)}$`);e.pattern??(e.pattern=o),i._zod.onattach.push(h=>{let l=h._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(o)}),i._zod.check=h=>{h.value.endsWith(e.suffix)||h.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:h.value,inst:i,continue:!e.abort})}});function hR(i,e,o){i.issues.length&&e.issues.push(...Al(o,i.issues))}var kk=mt("$ZodCheckProperty",(i,e)=>{ro.init(i,e),i._zod.check=o=>{let h=e.schema._zod.run({value:o.value[e.property],issues:[]},{});if(h instanceof Promise)return h.then(l=>hR(l,o,e.property));hR(h,o,e.property)}}),Ok=mt("$ZodCheckMimeType",(i,e)=>{ro.init(i,e);let o=new Set(e.mime);i._zod.onattach.push(h=>{h._zod.bag.mime=e.mime}),i._zod.check=h=>{o.has(h.value.type)||h.issues.push({code:"invalid_value",values:e.mime,input:h.value.type,inst:i,continue:!e.abort})}}),Fk=mt("$ZodCheckOverwrite",(i,e)=>{ro.init(i,e),i._zod.check=o=>{o.value=e.tx(o.value)}});class Bk{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let o=e.split(`
`).filter(m=>m),h=Math.min(...o.map(m=>m.length-m.trimStart().length)),l=o.map(m=>m.slice(h)).map(m=>" ".repeat(this.indent*2)+m);for(let m of l)this.content.push(m)}compile(){let e=Function,o=this==null?void 0:this.args,h=[...((this==null?void 0:this.content)??[""]).map(l=>`  ${l}`)];return new e(...o,h.join(`
`))}}var Nk={major:4,minor:3,patch:5},Ln=mt("$ZodType",(i,e)=>{var l;var o;i??(i={}),i._zod.def=e,i._zod.bag=i._zod.bag||{},i._zod.version=Nk;let h=[...i._zod.def.checks??[]];i._zod.traits.has("$ZodCheck")&&h.unshift(i);for(let m of h)for(let x of m._zod.onattach)x(i);if(h.length===0)(o=i._zod).deferred??(o.deferred=[]),(l=i._zod.deferred)==null||l.push(()=>{i._zod.run=i._zod.parse});else{let m=(s,P,C)=>{let F=ld(s),O;for(let V of P){if(V._zod.def.when){if(!V._zod.def.when(s))continue}else if(F)continue;let J=s.issues.length,ee=V._zod.check(s);if(ee instanceof Promise&&(C==null?void 0:C.async)===!1)throw new dd;if(O||ee instanceof Promise)O=(O??Promise.resolve()).then(async()=>{await ee,s.issues.length!==J&&(F||(F=ld(s,J)))});else{if(s.issues.length===J)continue;F||(F=ld(s,J))}}return O?O.then(()=>s):s},x=(s,P,C)=>{if(ld(s))return s.aborted=!0,s;let F=m(P,h,C);if(F instanceof Promise){if(C.async===!1)throw new dd;return F.then(O=>i._zod.parse(O,C))}return i._zod.parse(F,C)};i._zod.run=(s,P)=>{if(P.skipChecks)return i._zod.parse(s,P);if(P.direction==="backward"){let F=i._zod.parse({value:s.value,issues:[]},{...P,skipChecks:!0});return F instanceof Promise?F.then(O=>x(O,s,P)):x(F,s,P)}let C=i._zod.parse(s,P);if(C instanceof Promise){if(P.async===!1)throw new dd;return C.then(F=>m(F,h,P))}return m(C,h,P)}}Hn(i,"~standard",()=>({validate:m=>{var x;try{let s=UD(i,m);return s.success?{value:s.data}:{issues:(x=s.error)==null?void 0:x.issues}}catch{return $D(i,m).then(P=>{var C;return P.success?{value:P.data}:{issues:(C=P.error)==null?void 0:C.issues}})}},vendor:"zod",version:1}))}),gy=mt("$ZodString",(i,e)=>{var o;Ln.init(i,e),i._zod.pattern=[...((o=i==null?void 0:i._zod.bag)==null?void 0:o.patterns)??[]].pop()??hk(i._zod.bag),i._zod.parse=(h,l)=>{if(e.coerce)try{h.value=String(h.value)}catch{}return typeof h.value=="string"||h.issues.push({expected:"string",code:"invalid_type",input:h.value,inst:i}),h}}),Fr=mt("$ZodStringFormat",(i,e)=>{my.init(i,e),gy.init(i,e)}),Uk=mt("$ZodGUID",(i,e)=>{e.pattern??(e.pattern=XD),Fr.init(i,e)}),$k=mt("$ZodUUID",(i,e)=>{if(e.version){let o={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(o===void 0)throw Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=zp(o))}else e.pattern??(e.pattern=zp());Fr.init(i,e)}),Vk=mt("$ZodEmail",(i,e)=>{e.pattern??(e.pattern=JD),Fr.init(i,e)}),jk=mt("$ZodURL",(i,e)=>{Fr.init(i,e),i._zod.check=o=>{try{let h=o.value.trim(),l=new URL(h);e.hostname&&(e.hostname.lastIndex=0,!e.hostname.test(l.hostname)&&o.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:o.value,inst:i,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,!e.protocol.test(l.protocol.endsWith(":")?l.protocol.slice(0,-1):l.protocol)&&o.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:o.value,inst:i,continue:!e.abort})),e.normalize?o.value=l.href:o.value=h;return}catch{o.issues.push({code:"invalid_format",format:"url",input:o.value,inst:i,continue:!e.abort})}}}),Gk=mt("$ZodEmoji",(i,e)=>{e.pattern??(e.pattern=KD()),Fr.init(i,e)}),Hk=mt("$ZodNanoID",(i,e)=>{e.pattern??(e.pattern=WD),Fr.init(i,e)}),Zk=mt("$ZodCUID",(i,e)=>{e.pattern??(e.pattern=VD),Fr.init(i,e)}),Wk=mt("$ZodCUID2",(i,e)=>{e.pattern??(e.pattern=jD),Fr.init(i,e)}),qk=mt("$ZodULID",(i,e)=>{e.pattern??(e.pattern=GD),Fr.init(i,e)}),Xk=mt("$ZodXID",(i,e)=>{e.pattern??(e.pattern=HD),Fr.init(i,e)}),Jk=mt("$ZodKSUID",(i,e)=>{e.pattern??(e.pattern=ZD),Fr.init(i,e)}),Yk=mt("$ZodISODateTime",(i,e)=>{e.pattern??(e.pattern=uk(e)),Fr.init(i,e)}),Kk=mt("$ZodISODate",(i,e)=>{e.pattern??(e.pattern=ak),Fr.init(i,e)}),Qk=mt("$ZodISOTime",(i,e)=>{e.pattern??(e.pattern=ck(e)),Fr.init(i,e)}),e3=mt("$ZodISODuration",(i,e)=>{e.pattern??(e.pattern=qD),Fr.init(i,e)}),t3=mt("$ZodIPv4",(i,e)=>{e.pattern??(e.pattern=QD),Fr.init(i,e),i._zod.bag.format="ipv4"}),i3=mt("$ZodIPv6",(i,e)=>{e.pattern??(e.pattern=ek),Fr.init(i,e),i._zod.bag.format="ipv6",i._zod.check=o=>{try{new URL(`http://[${o.value}]`)}catch{o.issues.push({code:"invalid_format",format:"ipv6",input:o.value,inst:i,continue:!e.abort})}}}),n3=mt("$ZodMAC",(i,e)=>{e.pattern??(e.pattern=tk(e.delimiter)),Fr.init(i,e),i._zod.bag.format="mac"}),r3=mt("$ZodCIDRv4",(i,e)=>{e.pattern??(e.pattern=ik),Fr.init(i,e)}),o3=mt("$ZodCIDRv6",(i,e)=>{e.pattern??(e.pattern=nk),Fr.init(i,e),i._zod.check=o=>{let h=o.value.split("/");try{if(h.length!==2)throw Error();let[l,m]=h;if(!m)throw Error();let x=Number(m);if(`${x}`!==m||x<0||x>128)throw Error();new URL(`http://[${l}]`)}catch{o.issues.push({code:"invalid_format",format:"cidrv6",input:o.value,inst:i,continue:!e.abort})}}});function pI(i){if(i==="")return!0;if(i.length%4!==0)return!1;try{return atob(i),!0}catch{return!1}}var s3=mt("$ZodBase64",(i,e)=>{e.pattern??(e.pattern=rk),Fr.init(i,e),i._zod.bag.contentEncoding="base64",i._zod.check=o=>{pI(o.value)||o.issues.push({code:"invalid_format",format:"base64",input:o.value,inst:i,continue:!e.abort})}});function a3(i){if(!uI.test(i))return!1;let e=i.replace(/[-_]/g,h=>h==="-"?"+":"/"),o=e.padEnd(Math.ceil(e.length/4)*4,"=");return pI(o)}var l3=mt("$ZodBase64URL",(i,e)=>{e.pattern??(e.pattern=uI),Fr.init(i,e),i._zod.bag.contentEncoding="base64url",i._zod.check=o=>{a3(o.value)||o.issues.push({code:"invalid_format",format:"base64url",input:o.value,inst:i,continue:!e.abort})}}),c3=mt("$ZodE164",(i,e)=>{e.pattern??(e.pattern=ok),Fr.init(i,e)});function u3(i,e=null){try{let o=i.split(".");if(o.length!==3)return!1;let[h]=o;if(!h)return!1;let l=JSON.parse(atob(h));return!("typ"in l&&(l==null?void 0:l.typ)!=="JWT"||!l.alg||e&&(!("alg"in l)||l.alg!==e))}catch{return!1}}var h3=mt("$ZodJWT",(i,e)=>{Fr.init(i,e),i._zod.check=o=>{u3(o.value,e.alg)||o.issues.push({code:"invalid_format",format:"jwt",input:o.value,inst:i,continue:!e.abort})}}),d3=mt("$ZodCustomStringFormat",(i,e)=>{Fr.init(i,e),i._zod.check=o=>{e.fn(o.value)||o.issues.push({code:"invalid_format",format:e.format,input:o.value,inst:i,continue:!e.abort})}}),mI=mt("$ZodNumber",(i,e)=>{Ln.init(i,e),i._zod.pattern=i._zod.bag.pattern??hI,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=Number(o.value)}catch{}let l=o.value;if(typeof l=="number"&&!Number.isNaN(l)&&Number.isFinite(l))return o;let m=typeof l=="number"?Number.isNaN(l)?"NaN":Number.isFinite(l)?void 0:"Infinity":void 0;return o.issues.push({expected:"number",code:"invalid_type",input:l,inst:i,...m?{received:m}:{}}),o}}),f3=mt("$ZodNumberFormat",(i,e)=>{bk.init(i,e),mI.init(i,e)}),gI=mt("$ZodBoolean",(i,e)=>{Ln.init(i,e),i._zod.pattern=pk,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=!!o.value}catch{}let l=o.value;return typeof l=="boolean"||o.issues.push({expected:"boolean",code:"invalid_type",input:l,inst:i}),o}}),_I=mt("$ZodBigInt",(i,e)=>{Ln.init(i,e),i._zod.pattern=dk,i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=BigInt(o.value)}catch{}return typeof o.value=="bigint"||o.issues.push({expected:"bigint",code:"invalid_type",input:o.value,inst:i}),o}}),p3=mt("$ZodBigIntFormat",(i,e)=>{wk.init(i,e),_I.init(i,e)}),m3=mt("$ZodSymbol",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;return typeof l=="symbol"||o.issues.push({expected:"symbol",code:"invalid_type",input:l,inst:i}),o}}),g3=mt("$ZodUndefined",(i,e)=>{Ln.init(i,e),i._zod.pattern=gk,i._zod.values=new Set([void 0]),i._zod.optin="optional",i._zod.optout="optional",i._zod.parse=(o,h)=>{let l=o.value;return typeof l>"u"||o.issues.push({expected:"undefined",code:"invalid_type",input:l,inst:i}),o}}),_3=mt("$ZodNull",(i,e)=>{Ln.init(i,e),i._zod.pattern=mk,i._zod.values=new Set([null]),i._zod.parse=(o,h)=>{let l=o.value;return l===null||o.issues.push({expected:"null",code:"invalid_type",input:l,inst:i}),o}}),y3=mt("$ZodAny",(i,e)=>{Ln.init(i,e),i._zod.parse=o=>o}),v3=mt("$ZodUnknown",(i,e)=>{Ln.init(i,e),i._zod.parse=o=>o}),x3=mt("$ZodNever",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>(o.issues.push({expected:"never",code:"invalid_type",input:o.value,inst:i}),o)}),b3=mt("$ZodVoid",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;return typeof l>"u"||o.issues.push({expected:"void",code:"invalid_type",input:l,inst:i}),o}}),w3=mt("$ZodDate",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{if(e.coerce)try{o.value=new Date(o.value)}catch{}let l=o.value,m=l instanceof Date;return m&&!Number.isNaN(l.getTime())||o.issues.push({expected:"date",code:"invalid_type",input:l,...m?{received:"Invalid Date"}:{},inst:i}),o}});function dR(i,e,o){i.issues.length&&e.issues.push(...Al(o,i.issues)),e.value[o]=i.value}var S3=mt("$ZodArray",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;if(!Array.isArray(l))return o.issues.push({expected:"array",code:"invalid_type",input:l,inst:i}),o;o.value=Array(l.length);let m=[];for(let x=0;x<l.length;x++){let s=l[x],P=e.element._zod.run({value:s,issues:[]},h);P instanceof Promise?m.push(P.then(C=>dR(C,o,x))):dR(P,o,x)}return m.length?Promise.all(m).then(()=>o):o}});function rb(i,e,o,h,l){if(i.issues.length){if(l&&!(o in h))return;e.issues.push(...Al(o,i.issues))}i.value===void 0?o in h&&(e.value[o]=void 0):e.value[o]=i.value}function T3(i){var h,l,m,x;let e=Object.keys(i.shape);for(let s of e)if(!((x=(m=(l=(h=i.shape)==null?void 0:h[s])==null?void 0:l._zod)==null?void 0:m.traits)!=null&&x.has("$ZodType")))throw Error(`Invalid element at key "${s}": expected a Zod schema`);let o=CD(i.shape);return{...i,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(o)}}function E3(i,e,o,h,l,m){let x=[],s=l.keySet,P=l.catchall._zod,C=P.def.type,F=P.optout==="optional";for(let O in e){if(s.has(O))continue;if(C==="never"){x.push(O);continue}let V=P.run({value:e[O],issues:[]},h);V instanceof Promise?i.push(V.then(J=>rb(J,o,O,e,F))):rb(V,o,O,e,F)}return x.length&&o.issues.push({code:"unrecognized_keys",keys:x,input:e,inst:m}),i.length?Promise.all(i).then(()=>o):o}var I3=mt("$ZodObject",(i,e)=>{var x;if(Ln.init(i,e),!((x=Object.getOwnPropertyDescriptor(e,"shape"))!=null&&x.get)){let s=e.shape;Object.defineProperty(e,"shape",{get:()=>{let P={...s};return Object.defineProperty(e,"shape",{value:P}),P}})}let o=ly(()=>T3(e));Hn(i._zod,"propValues",()=>{let s=e.shape,P={};for(let C in s){let F=s[C]._zod;if(F.values){P[C]??(P[C]=new Set);for(let O of F.values)P[C].add(O)}}return P});let h=Pp,l=e.catchall,m;i._zod.parse=(s,P)=>{m??(m=o.value);let C=s.value;if(!h(C))return s.issues.push({expected:"object",code:"invalid_type",input:C,inst:i}),s;s.value={};let F=[],O=m.shape;for(let V of m.keys){let J=O[V],ee=J._zod.optout==="optional",se=J._zod.run({value:C[V],issues:[]},P);se instanceof Promise?F.push(se.then(fe=>rb(fe,s,V,C,ee))):rb(se,s,V,C,ee)}return l?E3(F,C,s,P,o.value,i):F.length?Promise.all(F).then(()=>s):s}}),M3=mt("$ZodObjectJIT",(i,e)=>{I3.init(i,e);let o=i._zod.parse,h=ly(()=>T3(e)),l=O=>{var ie,it;let V=new Bk(["shape","payload","ctx"]),J=h.value,ee=Ve=>{let Ne=RT(Ve);return`shape[${Ne}]._zod.run({ value: input[${Ne}], issues: [] }, ctx)`};V.write("const input = payload.value;");let se=Object.create(null),fe=0;for(let Ve of J.keys)se[Ve]=`key_${fe++}`;V.write("const newResult = {};");for(let Ve of J.keys){let Ne=se[Ve],Re=RT(Ve),Ye=((it=(ie=O[Ve])==null?void 0:ie._zod)==null?void 0:it.optout)==="optional";V.write(`const ${Ne} = ${ee(Ve)};`),Ye?V.write(`
        if (${Ne}.issues.length) {
          if (${Re} in input) {
            payload.issues = payload.issues.concat(${Ne}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${Re}, ...iss.path] : [${Re}]
            })));
          }
        }
        
        if (${Ne}.value === undefined) {
          if (${Re} in input) {
            newResult[${Re}] = undefined;
          }
        } else {
          newResult[${Re}] = ${Ne}.value;
        }
        
      `):V.write(`
        if (${Ne}.issues.length) {
          payload.issues = payload.issues.concat(${Ne}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Re}, ...iss.path] : [${Re}]
          })));
        }
        
        if (${Ne}.value === undefined) {
          if (${Re} in input) {
            newResult[${Re}] = undefined;
          }
        } else {
          newResult[${Re}] = ${Ne}.value;
        }
        
      `)}V.write("payload.value = newResult;"),V.write("return payload;");let le=V.compile();return(Ve,Ne)=>le(O,Ve,Ne)},m,x=Pp,s=!eb.jitless,P=s&&AD.value,C=e.catchall,F;i._zod.parse=(O,V)=>{F??(F=h.value);let J=O.value;return x(J)?s&&P&&(V==null?void 0:V.async)===!1&&V.jitless!==!0?(m||(m=l(e.shape)),O=m(O,V),C?E3([],J,O,V,F,i):O):o(O,V):(O.issues.push({expected:"object",code:"invalid_type",input:J,inst:i}),O)}});function fR(i,e,o,h){for(let m of i)if(m.issues.length===0)return e.value=m.value,e;let l=i.filter(m=>!ld(m));return l.length===1?(e.value=l[0].value,l[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:o,errors:i.map(m=>m.issues.map(x=>Ya(x,h,Ls())))}),e)}var Ub=mt("$ZodUnion",(i,e)=>{Ln.init(i,e),Hn(i._zod,"optin",()=>e.options.some(l=>l._zod.optin==="optional")?"optional":void 0),Hn(i._zod,"optout",()=>e.options.some(l=>l._zod.optout==="optional")?"optional":void 0),Hn(i._zod,"values",()=>{if(e.options.every(l=>l._zod.values))return new Set(e.options.flatMap(l=>Array.from(l._zod.values)))}),Hn(i._zod,"pattern",()=>{if(e.options.every(l=>l._zod.pattern)){let l=e.options.map(m=>m._zod.pattern);return new RegExp(`^(${l.map(m=>Fb(m.source)).join("|")})$`)}});let o=e.options.length===1,h=e.options[0]._zod.run;i._zod.parse=(l,m)=>{if(o)return h(l,m);let x=!1,s=[];for(let P of e.options){let C=P._zod.run({value:l.value,issues:[]},m);if(C instanceof Promise)s.push(C),x=!0;else{if(C.issues.length===0)return C;s.push(C)}}return x?Promise.all(s).then(P=>fR(P,l,i,m)):fR(s,l,i,m)}});function pR(i,e,o,h){let l=i.filter(m=>m.issues.length===0);return l.length===1?(e.value=l[0].value,e):(l.length===0?e.issues.push({code:"invalid_union",input:e.value,inst:o,errors:i.map(m=>m.issues.map(x=>Ya(x,h,Ls())))}):e.issues.push({code:"invalid_union",input:e.value,inst:o,errors:[],inclusive:!1}),e)}var A3=mt("$ZodXor",(i,e)=>{Ub.init(i,e),e.inclusive=!1;let o=e.options.length===1,h=e.options[0]._zod.run;i._zod.parse=(l,m)=>{if(o)return h(l,m);let x=!1,s=[];for(let P of e.options){let C=P._zod.run({value:l.value,issues:[]},m);C instanceof Promise?(s.push(C),x=!0):s.push(C)}return x?Promise.all(s).then(P=>pR(P,l,i,m)):pR(s,l,i,m)}}),P3=mt("$ZodDiscriminatedUnion",(i,e)=>{e.inclusive=!1,Ub.init(i,e);let o=i._zod.parse;Hn(i._zod,"propValues",()=>{let l={};for(let m of e.options){let x=m._zod.propValues;if(!x||Object.keys(x).length===0)throw Error(`Invalid discriminated union option at index "${e.options.indexOf(m)}"`);for(let[s,P]of Object.entries(x)){l[s]||(l[s]=new Set);for(let C of P)l[s].add(C)}}return l});let h=ly(()=>{var x;let l=e.options,m=new Map;for(let s of l){let P=(x=s._zod.propValues)==null?void 0:x[e.discriminator];if(!P||P.size===0)throw Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let C of P){if(m.has(C))throw Error(`Duplicate discriminator value "${String(C)}"`);m.set(C,s)}}return m});i._zod.parse=(l,m)=>{let x=l.value;if(!Pp(x))return l.issues.push({code:"invalid_type",expected:"object",input:x,inst:i}),l;let s=h.value.get(x==null?void 0:x[e.discriminator]);return s?s._zod.run(l,m):e.unionFallback?o(l,m):(l.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:x,path:[e.discriminator],inst:i}),l)}}),z3=mt("$ZodIntersection",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value,m=e.left._zod.run({value:l,issues:[]},h),x=e.right._zod.run({value:l,issues:[]},h);return m instanceof Promise||x instanceof Promise?Promise.all([m,x]).then(([s,P])=>mR(o,s,P)):mR(o,m,x)}});function kT(i,e){if(i===e)return{valid:!0,data:i};if(i instanceof Date&&e instanceof Date&&+i==+e)return{valid:!0,data:i};if(md(i)&&md(e)){let o=Object.keys(e),h=Object.keys(i).filter(m=>o.indexOf(m)!==-1),l={...i,...e};for(let m of h){let x=kT(i[m],e[m]);if(!x.valid)return{valid:!1,mergeErrorPath:[m,...x.mergeErrorPath]};l[m]=x.data}return{valid:!0,data:l}}if(Array.isArray(i)&&Array.isArray(e)){if(i.length!==e.length)return{valid:!1,mergeErrorPath:[]};let o=[];for(let h=0;h<i.length;h++){let l=i[h],m=e[h],x=kT(l,m);if(!x.valid)return{valid:!1,mergeErrorPath:[h,...x.mergeErrorPath]};o.push(x.data)}return{valid:!0,data:o}}return{valid:!1,mergeErrorPath:[]}}function mR(i,e,o){let h=new Map,l;for(let s of e.issues)if(s.code==="unrecognized_keys"){l??(l=s);for(let P of s.keys)h.has(P)||h.set(P,{}),h.get(P).l=!0}else i.issues.push(s);for(let s of o.issues)if(s.code==="unrecognized_keys")for(let P of s.keys)h.has(P)||h.set(P,{}),h.get(P).r=!0;else i.issues.push(s);let m=[...h].filter(([,s])=>s.l&&s.r).map(([s])=>s);if(m.length&&l&&i.issues.push({...l,keys:m}),ld(i))return i;let x=kT(e.value,o.value);if(!x.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(x.mergeErrorPath)}`);return i.value=x.data,i}var yI=mt("$ZodTuple",(i,e)=>{Ln.init(i,e);let o=e.items;i._zod.parse=(h,l)=>{let m=h.value;if(!Array.isArray(m))return h.issues.push({input:m,inst:i,expected:"tuple",code:"invalid_type"}),h;h.value=[];let x=[],s=[...o].reverse().findIndex(F=>F._zod.optin!=="optional"),P=s===-1?0:o.length-s;if(!e.rest){let F=m.length>o.length,O=m.length<P-1;if(F||O)return h.issues.push({...F?{code:"too_big",maximum:o.length,inclusive:!0}:{code:"too_small",minimum:o.length},input:m,inst:i,origin:"array"}),h}let C=-1;for(let F of o){if(C++,C>=m.length&&C>=P)continue;let O=F._zod.run({value:m[C],issues:[]},l);O instanceof Promise?x.push(O.then(V=>f0(V,h,C))):f0(O,h,C)}if(e.rest){let F=m.slice(o.length);for(let O of F){C++;let V=e.rest._zod.run({value:O,issues:[]},l);V instanceof Promise?x.push(V.then(J=>f0(J,h,C))):f0(V,h,C)}}return x.length?Promise.all(x).then(()=>h):h}});function f0(i,e,o){i.issues.length&&e.issues.push(...Al(o,i.issues)),e.value[o]=i.value}var C3=mt("$ZodRecord",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;if(!md(l))return o.issues.push({expected:"record",code:"invalid_type",input:l,inst:i}),o;let m=[],x=e.keyType._zod.values;if(x){o.value={};let s=new Set;for(let C of x)if(typeof C=="string"||typeof C=="number"||typeof C=="symbol"){s.add(typeof C=="number"?C.toString():C);let F=e.valueType._zod.run({value:l[C],issues:[]},h);F instanceof Promise?m.push(F.then(O=>{O.issues.length&&o.issues.push(...Al(C,O.issues)),o.value[C]=O.value})):(F.issues.length&&o.issues.push(...Al(C,F.issues)),o.value[C]=F.value)}let P;for(let C in l)s.has(C)||(P=P??[],P.push(C));P&&P.length>0&&o.issues.push({code:"unrecognized_keys",input:l,inst:i,keys:P})}else{o.value={};for(let s of Reflect.ownKeys(l)){if(s==="__proto__")continue;let P=e.keyType._zod.run({value:s,issues:[]},h);if(P instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(typeof s=="string"&&hI.test(s)&&P.issues.length&&P.issues.some(F=>F.code==="invalid_type"&&F.expected==="number")){let F=e.keyType._zod.run({value:Number(s),issues:[]},h);if(F instanceof Promise)throw Error("Async schemas not supported in object keys currently");F.issues.length===0&&(P=F)}if(P.issues.length){e.mode==="loose"?o.value[s]=l[s]:o.issues.push({code:"invalid_key",origin:"record",issues:P.issues.map(F=>Ya(F,h,Ls())),input:s,path:[s],inst:i});continue}let C=e.valueType._zod.run({value:l[s],issues:[]},h);C instanceof Promise?m.push(C.then(F=>{F.issues.length&&o.issues.push(...Al(s,F.issues)),o.value[P.value]=F.value})):(C.issues.length&&o.issues.push(...Al(s,C.issues)),o.value[P.value]=C.value)}}return m.length?Promise.all(m).then(()=>o):o}}),R3=mt("$ZodMap",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;if(!(l instanceof Map))return o.issues.push({expected:"map",code:"invalid_type",input:l,inst:i}),o;let m=[];o.value=new Map;for(let[x,s]of l){let P=e.keyType._zod.run({value:x,issues:[]},h),C=e.valueType._zod.run({value:s,issues:[]},h);P instanceof Promise||C instanceof Promise?m.push(Promise.all([P,C]).then(([F,O])=>{gR(F,O,o,x,l,i,h)})):gR(P,C,o,x,l,i,h)}return m.length?Promise.all(m).then(()=>o):o}});function gR(i,e,o,h,l,m,x){i.issues.length&&(ib.has(typeof h)?o.issues.push(...Al(h,i.issues)):o.issues.push({code:"invalid_key",origin:"map",input:l,inst:m,issues:i.issues.map(s=>Ya(s,x,Ls()))})),e.issues.length&&(ib.has(typeof h)?o.issues.push(...Al(h,e.issues)):o.issues.push({origin:"map",code:"invalid_element",input:l,inst:m,key:h,issues:e.issues.map(s=>Ya(s,x,Ls()))})),o.value.set(i.value,e.value)}var L3=mt("$ZodSet",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;if(!(l instanceof Set))return o.issues.push({input:l,inst:i,expected:"set",code:"invalid_type"}),o;let m=[];o.value=new Set;for(let x of l){let s=e.valueType._zod.run({value:x,issues:[]},h);s instanceof Promise?m.push(s.then(P=>_R(P,o))):_R(s,o)}return m.length?Promise.all(m).then(()=>o):o}});function _R(i,e){i.issues.length&&e.issues.push(...i.issues),e.value.add(i.value)}var D3=mt("$ZodEnum",(i,e)=>{Ln.init(i,e);let o=YE(e.entries),h=new Set(o);i._zod.values=h,i._zod.pattern=new RegExp(`^(${o.filter(l=>ib.has(typeof l)).map(l=>typeof l=="string"?Nc(l):l.toString()).join("|")})$`),i._zod.parse=(l,m)=>{let x=l.value;return h.has(x)||l.issues.push({code:"invalid_value",values:o,input:x,inst:i}),l}}),k3=mt("$ZodLiteral",(i,e)=>{if(Ln.init(i,e),e.values.length===0)throw Error("Cannot create literal schema with no valid values");let o=new Set(e.values);i._zod.values=o,i._zod.pattern=new RegExp(`^(${e.values.map(h=>typeof h=="string"?Nc(h):h?Nc(h.toString()):String(h)).join("|")})$`),i._zod.parse=(h,l)=>{let m=h.value;return o.has(m)||h.issues.push({code:"invalid_value",values:e.values,input:m,inst:i}),h}}),O3=mt("$ZodFile",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{let l=o.value;return l instanceof File||o.issues.push({expected:"file",code:"invalid_type",input:l,inst:i}),o}}),F3=mt("$ZodTransform",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new Ob(i.constructor.name);let l=e.transform(o.value,o);if(h.async)return(l instanceof Promise?l:Promise.resolve(l)).then(m=>(o.value=m,o));if(l instanceof Promise)throw new dd;return o.value=l,o}});function yR(i,e){return i.issues.length&&e===void 0?{issues:[],value:void 0}:i}var vI=mt("$ZodOptional",(i,e)=>{Ln.init(i,e),i._zod.optin="optional",i._zod.optout="optional",Hn(i._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Hn(i._zod,"pattern",()=>{let o=e.innerType._zod.pattern;return o?new RegExp(`^(${Fb(o.source)})?$`):void 0}),i._zod.parse=(o,h)=>{if(e.innerType._zod.optin==="optional"){let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(m=>yR(m,o.value)):yR(l,o.value)}return o.value===void 0?o:e.innerType._zod.run(o,h)}}),B3=mt("$ZodExactOptional",(i,e)=>{vI.init(i,e),Hn(i._zod,"values",()=>e.innerType._zod.values),Hn(i._zod,"pattern",()=>e.innerType._zod.pattern),i._zod.parse=(o,h)=>e.innerType._zod.run(o,h)}),N3=mt("$ZodNullable",(i,e)=>{Ln.init(i,e),Hn(i._zod,"optin",()=>e.innerType._zod.optin),Hn(i._zod,"optout",()=>e.innerType._zod.optout),Hn(i._zod,"pattern",()=>{let o=e.innerType._zod.pattern;return o?new RegExp(`^(${Fb(o.source)}|null)$`):void 0}),Hn(i._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),i._zod.parse=(o,h)=>o.value===null?o:e.innerType._zod.run(o,h)}),U3=mt("$ZodDefault",(i,e)=>{Ln.init(i,e),i._zod.optin="optional",Hn(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);if(o.value===void 0)return o.value=e.defaultValue,o;let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(m=>vR(m,e)):vR(l,e)}});function vR(i,e){return i.value===void 0&&(i.value=e.defaultValue),i}var $3=mt("$ZodPrefault",(i,e)=>{Ln.init(i,e),i._zod.optin="optional",Hn(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>(h.direction==="backward"||o.value===void 0&&(o.value=e.defaultValue),e.innerType._zod.run(o,h))}),V3=mt("$ZodNonOptional",(i,e)=>{Ln.init(i,e),Hn(i._zod,"values",()=>{let o=e.innerType._zod.values;return o?new Set([...o].filter(h=>h!==void 0)):void 0}),i._zod.parse=(o,h)=>{let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(m=>xR(m,i)):xR(l,i)}});function xR(i,e){return!i.issues.length&&i.value===void 0&&i.issues.push({code:"invalid_type",expected:"nonoptional",input:i.value,inst:e}),i}var j3=mt("$ZodSuccess",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new Ob("ZodSuccess");let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(m=>(o.value=m.issues.length===0,o)):(o.value=l.issues.length===0,o)}}),G3=mt("$ZodCatch",(i,e)=>{Ln.init(i,e),Hn(i._zod,"optin",()=>e.innerType._zod.optin),Hn(i._zod,"optout",()=>e.innerType._zod.optout),Hn(i._zod,"values",()=>e.innerType._zod.values),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(m=>(o.value=m.value,m.issues.length&&(o.value=e.catchValue({...o,error:{issues:m.issues.map(x=>Ya(x,h,Ls()))},input:o.value}),o.issues=[]),o)):(o.value=l.value,l.issues.length&&(o.value=e.catchValue({...o,error:{issues:l.issues.map(m=>Ya(m,h,Ls()))},input:o.value}),o.issues=[]),o)}}),H3=mt("$ZodNaN",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>((typeof o.value!="number"||!Number.isNaN(o.value))&&o.issues.push({input:o.value,inst:i,expected:"nan",code:"invalid_type"}),o)}),Z3=mt("$ZodPipe",(i,e)=>{Ln.init(i,e),Hn(i._zod,"values",()=>e.in._zod.values),Hn(i._zod,"optin",()=>e.in._zod.optin),Hn(i._zod,"optout",()=>e.out._zod.optout),Hn(i._zod,"propValues",()=>e.in._zod.propValues),i._zod.parse=(o,h)=>{if(h.direction==="backward"){let m=e.out._zod.run(o,h);return m instanceof Promise?m.then(x=>p0(x,e.in,h)):p0(m,e.in,h)}let l=e.in._zod.run(o,h);return l instanceof Promise?l.then(m=>p0(m,e.out,h)):p0(l,e.out,h)}});function p0(i,e,o){return i.issues.length?(i.aborted=!0,i):e._zod.run({value:i.value,issues:i.issues},o)}var xI=mt("$ZodCodec",(i,e)=>{Ln.init(i,e),Hn(i._zod,"values",()=>e.in._zod.values),Hn(i._zod,"optin",()=>e.in._zod.optin),Hn(i._zod,"optout",()=>e.out._zod.optout),Hn(i._zod,"propValues",()=>e.in._zod.propValues),i._zod.parse=(o,h)=>{if((h.direction||"forward")==="forward"){let l=e.in._zod.run(o,h);return l instanceof Promise?l.then(m=>m0(m,e,h)):m0(l,e,h)}else{let l=e.out._zod.run(o,h);return l instanceof Promise?l.then(m=>m0(m,e,h)):m0(l,e,h)}}});function m0(i,e,o){if(i.issues.length)return i.aborted=!0,i;if((o.direction||"forward")==="forward"){let h=e.transform(i.value,i);return h instanceof Promise?h.then(l=>g0(i,l,e.out,o)):g0(i,h,e.out,o)}else{let h=e.reverseTransform(i.value,i);return h instanceof Promise?h.then(l=>g0(i,l,e.in,o)):g0(i,h,e.in,o)}}function g0(i,e,o,h){return i.issues.length?(i.aborted=!0,i):o._zod.run({value:e,issues:i.issues},h)}var W3=mt("$ZodReadonly",(i,e)=>{Ln.init(i,e),Hn(i._zod,"propValues",()=>e.innerType._zod.propValues),Hn(i._zod,"values",()=>e.innerType._zod.values),Hn(i._zod,"optin",()=>{var o,h;return(h=(o=e.innerType)==null?void 0:o._zod)==null?void 0:h.optin}),Hn(i._zod,"optout",()=>{var o,h;return(h=(o=e.innerType)==null?void 0:o._zod)==null?void 0:h.optout}),i._zod.parse=(o,h)=>{if(h.direction==="backward")return e.innerType._zod.run(o,h);let l=e.innerType._zod.run(o,h);return l instanceof Promise?l.then(bR):bR(l)}});function bR(i){return i.value=Object.freeze(i.value),i}var q3=mt("$ZodTemplateLiteral",(i,e)=>{Ln.init(i,e);let o=[];for(let h of e.parts)if(typeof h=="object"&&h!==null){if(!h._zod.pattern)throw Error(`Invalid template literal part, no pattern found: ${[...h._zod.traits].shift()}`);let l=h._zod.pattern instanceof RegExp?h._zod.pattern.source:h._zod.pattern;if(!l)throw Error(`Invalid template literal part: ${h._zod.traits}`);let m=l.startsWith("^")?1:0,x=l.endsWith("$")?l.length-1:l.length;o.push(l.slice(m,x))}else if(h===null||zD.has(typeof h))o.push(Nc(`${h}`));else throw Error(`Invalid template literal part: ${h}`);i._zod.pattern=new RegExp(`^${o.join("")}$`),i._zod.parse=(h,l)=>typeof h.value!="string"?(h.issues.push({input:h.value,inst:i,expected:"string",code:"invalid_type"}),h):(i._zod.pattern.lastIndex=0,i._zod.pattern.test(h.value)||h.issues.push({input:h.value,inst:i,code:"invalid_format",format:e.format??"template_literal",pattern:i._zod.pattern.source}),h)}),X3=mt("$ZodFunction",(i,e)=>(Ln.init(i,e),i._def=e,i._zod.def=e,i.implement=o=>{if(typeof o!="function")throw Error("implement() must be called with a function");return function(...h){let l=i._def.input?LT(i._def.input,h):h,m=Reflect.apply(o,this,l);return i._def.output?LT(i._def.output,m):m}},i.implementAsync=o=>{if(typeof o!="function")throw Error("implementAsync() must be called with a function");return async function(...h){let l=i._def.input?await DT(i._def.input,h):h,m=await Reflect.apply(o,this,l);return i._def.output?await DT(i._def.output,m):m}},i._zod.parse=(o,h)=>typeof o.value!="function"?(o.issues.push({code:"invalid_type",expected:"function",input:o.value,inst:i}),o):(i._def.output&&i._def.output._zod.def.type==="promise"?o.value=i.implementAsync(o.value):o.value=i.implement(o.value),o),i.input=(...o)=>{let h=i.constructor;return Array.isArray(o[0])?new h({type:"function",input:new yI({type:"tuple",items:o[0],rest:o[1]}),output:i._def.output}):new h({type:"function",input:o[0],output:i._def.output})},i.output=o=>new i.constructor({type:"function",input:i._def.input,output:o}),i)),J3=mt("$ZodPromise",(i,e)=>{Ln.init(i,e),i._zod.parse=(o,h)=>Promise.resolve(o.value).then(l=>e.innerType._zod.run({value:l,issues:[]},h))}),Y3=mt("$ZodLazy",(i,e)=>{Ln.init(i,e),Hn(i._zod,"innerType",()=>e.getter()),Hn(i._zod,"pattern",()=>{var o,h;return(h=(o=i._zod.innerType)==null?void 0:o._zod)==null?void 0:h.pattern}),Hn(i._zod,"propValues",()=>{var o,h;return(h=(o=i._zod.innerType)==null?void 0:o._zod)==null?void 0:h.propValues}),Hn(i._zod,"optin",()=>{var o,h;return((h=(o=i._zod.innerType)==null?void 0:o._zod)==null?void 0:h.optin)??void 0}),Hn(i._zod,"optout",()=>{var o,h;return((h=(o=i._zod.innerType)==null?void 0:o._zod)==null?void 0:h.optout)??void 0}),i._zod.parse=(o,h)=>i._zod.innerType._zod.run(o,h)}),K3=mt("$ZodCustom",(i,e)=>{ro.init(i,e),Ln.init(i,e),i._zod.parse=(o,h)=>o,i._zod.check=o=>{let h=o.value,l=e.fn(h);if(l instanceof Promise)return l.then(m=>wR(m,o,h,i));wR(l,o,h,i)}});function wR(i,e,o,h){if(!i){let l={code:"custom",input:o,inst:h,path:[...h._zod.def.path??[]],continue:!h._zod.def.abort};h._zod.def.params&&(l.params=h._zod.def.params),e.issues.push(nb(l))}}var bI={};$c(bI,{zhTW:()=>_X,zhCN:()=>mX,yo:()=>vX,vi:()=>fX,uz:()=>hX,ur:()=>cX,uk:()=>tO,ua:()=>aX,tr:()=>oX,th:()=>nX,ta:()=>tX,sv:()=>Q7,sl:()=>Y7,ru:()=>X7,pt:()=>W7,ps:()=>j7,pl:()=>H7,ota:()=>$7,no:()=>N7,nl:()=>F7,ms:()=>k7,mk:()=>L7,lt:()=>C7,ko:()=>P7,km:()=>eO,kh:()=>M7,ka:()=>E7,ja:()=>S7,it:()=>b7,is:()=>v7,id:()=>_7,hy:()=>m7,hu:()=>f7,he:()=>h7,frCA:()=>c7,fr:()=>a7,fi:()=>o7,fa:()=>n7,es:()=>t7,eo:()=>Q9,en:()=>Q3,de:()=>J9,da:()=>q9,cs:()=>Z9,ca:()=>G9,bg:()=>V9,be:()=>U9,az:()=>B9,ar:()=>O9});var k9=()=>{let i={string:{unit:"Ø­Ø±Ù",verb:"Ø£Ù† ÙŠØ­ÙˆÙŠ"},file:{unit:"Ø¨Ø§ÙŠØª",verb:"Ø£Ù† ÙŠØ­ÙˆÙŠ"},array:{unit:"Ø¹Ù†ØµØ±",verb:"Ø£Ù† ÙŠØ­ÙˆÙŠ"},set:{unit:"Ø¹Ù†ØµØ±",verb:"Ø£Ù† ÙŠØ­ÙˆÙŠ"}};function e(l){return i[l]??null}let o={regex:"Ù…Ø¯Ø®Ù„",email:"Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",url:"Ø±Ø§Ø¨Ø·",emoji:"Ø¥ÙŠÙ…ÙˆØ¬ÙŠ",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø¨Ù…Ø¹ÙŠØ§Ø± ISO",date:"ØªØ§Ø±ÙŠØ® Ø¨Ù…Ø¹ÙŠØ§Ø± ISO",time:"ÙˆÙ‚Øª Ø¨Ù…Ø¹ÙŠØ§Ø± ISO",duration:"Ù…Ø¯Ø© Ø¨Ù…Ø¹ÙŠØ§Ø± ISO",ipv4:"Ø¹Ù†ÙˆØ§Ù† IPv4",ipv6:"Ø¹Ù†ÙˆØ§Ù† IPv6",cidrv4:"Ù…Ø¯Ù‰ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¨ØµÙŠØºØ© IPv4",cidrv6:"Ù…Ø¯Ù‰ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¨ØµÙŠØºØ© IPv6",base64:"Ù†ÙŽØµ Ø¨ØªØ±Ù…ÙŠØ² base64-encoded",base64url:"Ù†ÙŽØµ Ø¨ØªØ±Ù…ÙŠØ² base64url-encoded",json_string:"Ù†ÙŽØµ Ø¹Ù„Ù‰ Ù‡ÙŠØ¦Ø© JSON",e164:"Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø¨Ù…Ø¹ÙŠØ§Ø± E.164",jwt:"JWT",template_literal:"Ù…Ø¯Ø®Ù„"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ù…Ø¯Ø®Ù„Ø§Øª ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„Ø©: ÙŠÙØªØ±Ø¶ Ø¥Ø¯Ø®Ø§Ù„ instanceof ${l.expected}ØŒ ÙˆÙ„ÙƒÙ† ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ${s}`:`Ù…Ø¯Ø®Ù„Ø§Øª ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„Ø©: ÙŠÙØªØ±Ø¶ Ø¥Ø¯Ø®Ø§Ù„ ${m}ØŒ ÙˆÙ„ÙƒÙ† ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ${s}`}case"invalid_value":return l.values.length===1?`Ù…Ø¯Ø®Ù„Ø§Øª ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„Ø©: ÙŠÙØªØ±Ø¶ Ø¥Ø¯Ø®Ø§Ù„ ${vn(l.values[0])}`:`Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØªÙˆÙ‚Ø¹ Ø§Ù†ØªÙ‚Ø§Ø¡ Ø£Ø­Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª: ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?` Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù…: ÙŠÙØªØ±Ø¶ Ø£Ù† ØªÙƒÙˆÙ† ${l.origin??"Ø§Ù„Ù‚ÙŠÙ…Ø©"} ${m} ${l.maximum.toString()} ${x.unit??"Ø¹Ù†ØµØ±"}`:`Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù…: ÙŠÙØªØ±Ø¶ Ø£Ù† ØªÙƒÙˆÙ† ${l.origin??"Ø§Ù„Ù‚ÙŠÙ…Ø©"} ${m} ${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù…: ÙŠÙØªØ±Ø¶ Ù„Ù€ ${l.origin} Ø£Ù† ÙŠÙƒÙˆÙ† ${m} ${l.minimum.toString()} ${x.unit}`:`Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù…: ÙŠÙØªØ±Ø¶ Ù„Ù€ ${l.origin} Ø£Ù† ÙŠÙƒÙˆÙ† ${m} ${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Ù†ÙŽØµ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ "${l.prefix}"`:m.format==="ends_with"?`Ù†ÙŽØµ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ù€ "${m.suffix}"`:m.format==="includes"?`Ù†ÙŽØµ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ¶Ù…Ù‘ÙŽÙ† "${m.includes}"`:m.format==="regex"?`Ù†ÙŽØµ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ù†Ù…Ø· ${m.pattern}`:`${o[m.format]??l.format} ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„`}case"not_multiple_of":return`Ø±Ù‚Ù… ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ù† Ù…Ø¶Ø§Ø¹ÙØ§Øª ${l.divisor}`;case"unrecognized_keys":return`Ù…Ø¹Ø±Ù${l.keys.length>1?"Ø§Øª":""} ØºØ±ÙŠØ¨${l.keys.length>1?"Ø©":""}: ${si(l.keys,"ØŒ ")}`;case"invalid_key":return`Ù…Ø¹Ø±Ù ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„ ÙÙŠ ${l.origin}`;case"invalid_union":return"Ù…Ø¯Ø®Ù„ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„";case"invalid_element":return`Ù…Ø¯Ø®Ù„ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„ ÙÙŠ ${l.origin}`;default:return"Ù…Ø¯Ø®Ù„ ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„"}}};function O9(){return{localeError:k9()}}var F9=()=>{let i={string:{unit:"simvol",verb:"olmalÄ±dÄ±r"},file:{unit:"bayt",verb:"olmalÄ±dÄ±r"},array:{unit:"element",verb:"olmalÄ±dÄ±r"},set:{unit:"element",verb:"olmalÄ±dÄ±r"}};function e(l){return i[l]??null}let o={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`YanlÄ±ÅŸ dÉ™yÉ™r: gÃ¶zlÉ™nilÉ™n instanceof ${l.expected}, daxil olan ${s}`:`YanlÄ±ÅŸ dÉ™yÉ™r: gÃ¶zlÉ™nilÉ™n ${m}, daxil olan ${s}`}case"invalid_value":return l.values.length===1?`YanlÄ±ÅŸ dÉ™yÉ™r: gÃ¶zlÉ™nilÉ™n ${vn(l.values[0])}`:`YanlÄ±ÅŸ seÃ§im: aÅŸaÄŸÄ±dakÄ±lardan biri olmalÄ±dÄ±r: ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ã‡ox bÃ¶yÃ¼k: gÃ¶zlÉ™nilÉ™n ${l.origin??"dÉ™yÉ™r"} ${m}${l.maximum.toString()} ${x.unit??"element"}`:`Ã‡ox bÃ¶yÃ¼k: gÃ¶zlÉ™nilÉ™n ${l.origin??"dÉ™yÉ™r"} ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Ã‡ox kiÃ§ik: gÃ¶zlÉ™nilÉ™n ${l.origin} ${m}${l.minimum.toString()} ${x.unit}`:`Ã‡ox kiÃ§ik: gÃ¶zlÉ™nilÉ™n ${l.origin} ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`YanlÄ±ÅŸ mÉ™tn: "${m.prefix}" ilÉ™ baÅŸlamalÄ±dÄ±r`:m.format==="ends_with"?`YanlÄ±ÅŸ mÉ™tn: "${m.suffix}" ilÉ™ bitmÉ™lidir`:m.format==="includes"?`YanlÄ±ÅŸ mÉ™tn: "${m.includes}" daxil olmalÄ±dÄ±r`:m.format==="regex"?`YanlÄ±ÅŸ mÉ™tn: ${m.pattern} ÅŸablonuna uyÄŸun olmalÄ±dÄ±r`:`YanlÄ±ÅŸ ${o[m.format]??l.format}`}case"not_multiple_of":return`YanlÄ±ÅŸ É™dÉ™d: ${l.divisor} ilÉ™ bÃ¶lÃ¼nÉ™ bilÉ™n olmalÄ±dÄ±r`;case"unrecognized_keys":return`TanÄ±nmayan aÃ§ar${l.keys.length>1?"lar":""}: ${si(l.keys,", ")}`;case"invalid_key":return`${l.origin} daxilindÉ™ yanlÄ±ÅŸ aÃ§ar`;case"invalid_union":return"YanlÄ±ÅŸ dÉ™yÉ™r";case"invalid_element":return`${l.origin} daxilindÉ™ yanlÄ±ÅŸ dÉ™yÉ™r`;default:return"YanlÄ±ÅŸ dÉ™yÉ™r"}}};function B9(){return{localeError:F9()}}function SR(i,e,o,h){let l=Math.abs(i),m=l%10,x=l%100;return x>=11&&x<=19?h:m===1?e:m>=2&&m<=4?o:h}var N9=()=>{let i={string:{unit:{one:"ÑÑ–Ð¼Ð²Ð°Ð»",few:"ÑÑ–Ð¼Ð²Ð°Ð»Ñ‹",many:"ÑÑ–Ð¼Ð²Ð°Ð»Ð°Ñž"},verb:"Ð¼ÐµÑ†ÑŒ"},array:{unit:{one:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚",few:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹",many:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°Ñž"},verb:"Ð¼ÐµÑ†ÑŒ"},set:{unit:{one:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚",few:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹",many:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°Ñž"},verb:"Ð¼ÐµÑ†ÑŒ"},file:{unit:{one:"Ð±Ð°Ð¹Ñ‚",few:"Ð±Ð°Ð¹Ñ‚Ñ‹",many:"Ð±Ð°Ð¹Ñ‚Ð°Ñž"},verb:"Ð¼ÐµÑ†ÑŒ"}};function e(l){return i[l]??null}let o={regex:"ÑƒÐ²Ð¾Ð´",email:"email Ð°Ð´Ñ€Ð°Ñ",url:"URL",emoji:"ÑÐ¼Ð¾Ð´Ð·Ñ–",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Ð´Ð°Ñ‚Ð° Ñ– Ñ‡Ð°Ñ",date:"ISO Ð´Ð°Ñ‚Ð°",time:"ISO Ñ‡Ð°Ñ",duration:"ISO Ð¿Ñ€Ð°Ñ†ÑÐ³Ð»Ð°ÑÑ†ÑŒ",ipv4:"IPv4 Ð°Ð´Ñ€Ð°Ñ",ipv6:"IPv6 Ð°Ð´Ñ€Ð°Ñ",cidrv4:"IPv4 Ð´Ñ‹ÑÐ¿Ð°Ð·Ð¾Ð½",cidrv6:"IPv6 Ð´Ñ‹ÑÐ¿Ð°Ð·Ð¾Ð½",base64:"Ñ€Ð°Ð´Ð¾Ðº Ñƒ Ñ„Ð°Ñ€Ð¼Ð°Ñ†Ðµ base64",base64url:"Ñ€Ð°Ð´Ð¾Ðº Ñƒ Ñ„Ð°Ñ€Ð¼Ð°Ñ†Ðµ base64url",json_string:"JSON Ñ€Ð°Ð´Ð¾Ðº",e164:"Ð½ÑƒÐ¼Ð°Ñ€ E.164",jwt:"JWT",template_literal:"ÑƒÐ²Ð¾Ð´"},h={nan:"NaN",number:"Ð»Ñ–Ðº",array:"Ð¼Ð°ÑÑ–Ñž"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´: Ñ‡Ð°ÐºÐ°ÑžÑÑ instanceof ${l.expected}, Ð°Ñ‚Ñ€Ñ‹Ð¼Ð°Ð½Ð° ${s}`:`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´: Ñ‡Ð°ÐºÐ°ÑžÑÑ ${m}, Ð°Ñ‚Ñ€Ñ‹Ð¼Ð°Ð½Ð° ${s}`}case"invalid_value":return l.values.length===1?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ ${vn(l.values[0])}`:`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ð²Ð°Ñ€Ñ‹ÑÐ½Ñ‚: Ñ‡Ð°ÐºÐ°ÑžÑÑ Ð°Ð´Ð·Ñ–Ð½ Ð· ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);if(x){let s=Number(l.maximum),P=SR(s,x.unit.one,x.unit.few,x.unit.many);return`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð° Ð²ÑÐ»Ñ–ÐºÑ–: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ, ÑˆÑ‚Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÑÐ½Ð½Ðµ"} Ð¿Ð°Ð²Ñ–Ð½Ð½Ð° ${x.verb} ${m}${l.maximum.toString()} ${P}`}return`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð° Ð²ÑÐ»Ñ–ÐºÑ–: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ, ÑˆÑ‚Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÑÐ½Ð½Ðµ"} Ð¿Ð°Ð²Ñ–Ð½Ð½Ð° Ð±Ñ‹Ñ†ÑŒ ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);if(x){let s=Number(l.minimum),P=SR(s,x.unit.one,x.unit.few,x.unit.many);return`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð° Ð¼Ð°Ð»Ñ‹: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ, ÑˆÑ‚Ð¾ ${l.origin} Ð¿Ð°Ð²Ñ–Ð½Ð½Ð° ${x.verb} ${m}${l.minimum.toString()} ${P}`}return`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð° Ð¼Ð°Ð»Ñ‹: Ñ‡Ð°ÐºÐ°Ð»Ð°ÑÑ, ÑˆÑ‚Ð¾ ${l.origin} Ð¿Ð°Ð²Ñ–Ð½Ð½Ð° Ð±Ñ‹Ñ†ÑŒ ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ñ€Ð°Ð´Ð¾Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð¿Ð°Ñ‡Ñ‹Ð½Ð°Ñ†Ñ†Ð° Ð· "${m.prefix}"`:m.format==="ends_with"?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ñ€Ð°Ð´Ð¾Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð·Ð°ÐºÐ°Ð½Ñ‡Ð²Ð°Ñ†Ñ†Ð° Ð½Ð° "${m.suffix}"`:m.format==="includes"?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ñ€Ð°Ð´Ð¾Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð·Ð¼ÑÑˆÑ‡Ð°Ñ†ÑŒ "${m.includes}"`:m.format==="regex"?`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ñ€Ð°Ð´Ð¾Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð°Ð´Ð¿Ð°Ð²ÑÐ´Ð°Ñ†ÑŒ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ ${m.pattern}`:`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ${o[m.format]??l.format}`}case"not_multiple_of":return`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ Ð»Ñ–Ðº: Ð¿Ð°Ð²Ñ–Ð½ÐµÐ½ Ð±Ñ‹Ñ†ÑŒ ÐºÑ€Ð°Ñ‚Ð½Ñ‹Ð¼ ${l.divisor}`;case"unrecognized_keys":return`ÐÐµÑ€Ð°ÑÐ¿Ð°Ð·Ð½Ð°Ð½Ñ‹ ${l.keys.length>1?"ÐºÐ»ÑŽÑ‡Ñ‹":"ÐºÐ»ÑŽÑ‡"}: ${si(l.keys,", ")}`;case"invalid_key":return`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÐºÐ»ÑŽÑ‡ Ñƒ ${l.origin}`;case"invalid_union":return"ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´";case"invalid_element":return`ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ð°Ðµ Ð·Ð½Ð°Ñ‡ÑÐ½Ð½Ðµ Ñž ${l.origin}`;default:return"ÐÑÐ¿Ñ€Ð°Ð²Ñ–Ð»ÑŒÐ½Ñ‹ ÑžÐ²Ð¾Ð´"}}};function U9(){return{localeError:N9()}}var $9=()=>{let i={string:{unit:"ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°",verb:"Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð°"},file:{unit:"Ð±Ð°Ð¹Ñ‚Ð°",verb:"Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð°"},array:{unit:"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°",verb:"Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð°"},set:{unit:"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°",verb:"Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð°"}};function e(l){return i[l]??null}let o={regex:"Ð²Ñ…Ð¾Ð´",email:"Ð¸Ð¼ÐµÐ¹Ð» Ð°Ð´Ñ€ÐµÑ",url:"URL",emoji:"ÐµÐ¼Ð¾Ð´Ð¶Ð¸",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Ð²Ñ€ÐµÐ¼Ðµ",date:"ISO Ð´Ð°Ñ‚Ð°",time:"ISO Ð²Ñ€ÐµÐ¼Ðµ",duration:"ISO Ð¿Ñ€Ð¾Ð´ÑŠÐ»Ð¶Ð¸Ñ‚ÐµÐ»Ð½Ð¾ÑÑ‚",ipv4:"IPv4 Ð°Ð´Ñ€ÐµÑ",ipv6:"IPv6 Ð°Ð´Ñ€ÐµÑ",cidrv4:"IPv4 Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½",cidrv6:"IPv6 Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½",base64:"base64-ÐºÐ¾Ð´Ð¸Ñ€Ð°Ð½ Ð½Ð¸Ð·",base64url:"base64url-ÐºÐ¾Ð´Ð¸Ñ€Ð°Ð½ Ð½Ð¸Ð·",json_string:"JSON Ð½Ð¸Ð·",e164:"E.164 Ð½Ð¾Ð¼ÐµÑ€",jwt:"JWT",template_literal:"Ð²Ñ…Ð¾Ð´"},h={nan:"NaN",number:"Ñ‡Ð¸ÑÐ»Ð¾",array:"Ð¼Ð°ÑÐ¸Ð²"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´: Ð¾Ñ‡Ð°ÐºÐ²Ð°Ð½ instanceof ${l.expected}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½ ${s}`:`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´: Ð¾Ñ‡Ð°ÐºÐ²Ð°Ð½ ${m}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½ ${s}`}case"invalid_value":return l.values.length===1?`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´: Ð¾Ñ‡Ð°ÐºÐ²Ð°Ð½ ${vn(l.values[0])}`:`ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð° Ð¾Ð¿Ñ†Ð¸Ñ: Ð¾Ñ‡Ð°ÐºÐ²Ð°Ð½Ð¾ ÐµÐ´Ð½Ð¾ Ð¾Ñ‚ ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ð¢Ð²ÑŠÑ€Ð´Ðµ Ð³Ð¾Ð»ÑÐ¼Ð¾: Ð¾Ñ‡Ð°ÐºÐ²Ð° ÑÐµ ${l.origin??"ÑÑ‚Ð¾Ð¹Ð½Ð¾ÑÑ‚"} Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð° ${m}${l.maximum.toString()} ${x.unit??"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°"}`:`Ð¢Ð²ÑŠÑ€Ð´Ðµ Ð³Ð¾Ð»ÑÐ¼Ð¾: Ð¾Ñ‡Ð°ÐºÐ²Ð° ÑÐµ ${l.origin??"ÑÑ‚Ð¾Ð¹Ð½Ð¾ÑÑ‚"} Ð´Ð° Ð±ÑŠÐ´Ðµ ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Ð¢Ð²ÑŠÑ€Ð´Ðµ Ð¼Ð°Ð»ÐºÐ¾: Ð¾Ñ‡Ð°ÐºÐ²Ð° ÑÐµ ${l.origin} Ð´Ð° ÑÑŠÐ´ÑŠÑ€Ð¶Ð° ${m}${l.minimum.toString()} ${x.unit}`:`Ð¢Ð²ÑŠÑ€Ð´Ðµ Ð¼Ð°Ð»ÐºÐ¾: Ð¾Ñ‡Ð°ÐºÐ²Ð° ÑÐµ ${l.origin} Ð´Ð° Ð±ÑŠÐ´Ðµ ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;if(m.format==="starts_with")return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð½Ð¸Ð·: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð·Ð°Ð¿Ð¾Ñ‡Ð²Ð° Ñ "${m.prefix}"`;if(m.format==="ends_with")return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð½Ð¸Ð·: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð·Ð°Ð²ÑŠÑ€ÑˆÐ²Ð° Ñ "${m.suffix}"`;if(m.format==="includes")return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð½Ð¸Ð·: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð²ÐºÐ»ÑŽÑ‡Ð²Ð° "${m.includes}"`;if(m.format==="regex")return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð½Ð¸Ð·: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° ÑÑŠÐ²Ð¿Ð°Ð´Ð° Ñ ${m.pattern}`;let x="ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½";return m.format==="emoji"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð¾"),m.format==="datetime"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð¾"),m.format==="date"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð°"),m.format==="time"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð¾"),m.format==="duration"&&(x="ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð°"),`${x} ${o[m.format]??l.format}`}case"not_multiple_of":return`ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð¾ Ñ‡Ð¸ÑÐ»Ð¾: Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð±ÑŠÐ´Ðµ ÐºÑ€Ð°Ñ‚Ð½Ð¾ Ð½Ð° ${l.divisor}`;case"unrecognized_keys":return`ÐÐµÑ€Ð°Ð·Ð¿Ð¾Ð·Ð½Ð°Ñ‚${l.keys.length>1?"Ð¸":""} ÐºÐ»ÑŽÑ‡${l.keys.length>1?"Ð¾Ð²Ðµ":""}: ${si(l.keys,", ")}`;case"invalid_key":return`ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ ÐºÐ»ÑŽÑ‡ Ð² ${l.origin}`;case"invalid_union":return"ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´";case"invalid_element":return`ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð° ÑÑ‚Ð¾Ð¹Ð½Ð¾ÑÑ‚ Ð² ${l.origin}`;default:return"ÐÐµÐ²Ð°Ð»Ð¸Ð´ÐµÐ½ Ð²Ñ…Ð¾Ð´"}}};function V9(){return{localeError:$9()}}var j9=()=>{let i={string:{unit:"carÃ cters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}};function e(l){return i[l]??null}let o={regex:"entrada",email:"adreÃ§a electrÃ²nica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adreÃ§a IPv4",ipv6:"adreÃ§a IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"nÃºmero E.164",jwt:"JWT",template_literal:"entrada"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Tipus invÃ lid: s'esperava instanceof ${l.expected}, s'ha rebut ${s}`:`Tipus invÃ lid: s'esperava ${m}, s'ha rebut ${s}`}case"invalid_value":return l.values.length===1?`Valor invÃ lid: s'esperava ${vn(l.values[0])}`:`OpciÃ³ invÃ lida: s'esperava una de ${si(l.values," o ")}`;case"too_big":{let m=l.inclusive?"com a mÃ xim":"menys de",x=e(l.origin);return x?`Massa gran: s'esperava que ${l.origin??"el valor"} continguÃ©s ${m} ${l.maximum.toString()} ${x.unit??"elements"}`:`Massa gran: s'esperava que ${l.origin??"el valor"} fos ${m} ${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?"com a mÃ­nim":"mÃ©s de",x=e(l.origin);return x?`Massa petit: s'esperava que ${l.origin} continguÃ©s ${m} ${l.minimum.toString()} ${x.unit}`:`Massa petit: s'esperava que ${l.origin} fos ${m} ${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Format invÃ lid: ha de comenÃ§ar amb "${m.prefix}"`:m.format==="ends_with"?`Format invÃ lid: ha d'acabar amb "${m.suffix}"`:m.format==="includes"?`Format invÃ lid: ha d'incloure "${m.includes}"`:m.format==="regex"?`Format invÃ lid: ha de coincidir amb el patrÃ³ ${m.pattern}`:`Format invÃ lid per a ${o[m.format]??l.format}`}case"not_multiple_of":return`NÃºmero invÃ lid: ha de ser mÃºltiple de ${l.divisor}`;case"unrecognized_keys":return`Clau${l.keys.length>1?"s":""} no reconeguda${l.keys.length>1?"s":""}: ${si(l.keys,", ")}`;case"invalid_key":return`Clau invÃ lida a ${l.origin}`;case"invalid_union":return"Entrada invÃ lida";case"invalid_element":return`Element invÃ lid a ${l.origin}`;default:return"Entrada invÃ lida"}}};function G9(){return{localeError:j9()}}var H9=()=>{let i={string:{unit:"znakÅ¯",verb:"mÃ­t"},file:{unit:"bajtÅ¯",verb:"mÃ­t"},array:{unit:"prvkÅ¯",verb:"mÃ­t"},set:{unit:"prvkÅ¯",verb:"mÃ­t"}};function e(l){return i[l]??null}let o={regex:"regulÃ¡rnÃ­ vÃ½raz",email:"e-mailovÃ¡ adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a Äas ve formÃ¡tu ISO",date:"datum ve formÃ¡tu ISO",time:"Äas ve formÃ¡tu ISO",duration:"doba trvÃ¡nÃ­ ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"Å™etÄ›zec zakÃ³dovanÃ½ ve formÃ¡tu base64",base64url:"Å™etÄ›zec zakÃ³dovanÃ½ ve formÃ¡tu base64url",json_string:"Å™etÄ›zec ve formÃ¡tu JSON",e164:"ÄÃ­slo E.164",jwt:"JWT",template_literal:"vstup"},h={nan:"NaN",number:"ÄÃ­slo",string:"Å™etÄ›zec",function:"funkce",array:"pole"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`NeplatnÃ½ vstup: oÄekÃ¡vÃ¡no instanceof ${l.expected}, obdrÅ¾eno ${s}`:`NeplatnÃ½ vstup: oÄekÃ¡vÃ¡no ${m}, obdrÅ¾eno ${s}`}case"invalid_value":return l.values.length===1?`NeplatnÃ½ vstup: oÄekÃ¡vÃ¡no ${vn(l.values[0])}`:`NeplatnÃ¡ moÅ¾nost: oÄekÃ¡vÃ¡na jedna z hodnot ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Hodnota je pÅ™Ã­liÅ¡ velkÃ¡: ${l.origin??"hodnota"} musÃ­ mÃ­t ${m}${l.maximum.toString()} ${x.unit??"prvkÅ¯"}`:`Hodnota je pÅ™Ã­liÅ¡ velkÃ¡: ${l.origin??"hodnota"} musÃ­ bÃ½t ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Hodnota je pÅ™Ã­liÅ¡ malÃ¡: ${l.origin??"hodnota"} musÃ­ mÃ­t ${m}${l.minimum.toString()} ${x.unit??"prvkÅ¯"}`:`Hodnota je pÅ™Ã­liÅ¡ malÃ¡: ${l.origin??"hodnota"} musÃ­ bÃ½t ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`NeplatnÃ½ Å™etÄ›zec: musÃ­ zaÄÃ­nat na "${m.prefix}"`:m.format==="ends_with"?`NeplatnÃ½ Å™etÄ›zec: musÃ­ konÄit na "${m.suffix}"`:m.format==="includes"?`NeplatnÃ½ Å™etÄ›zec: musÃ­ obsahovat "${m.includes}"`:m.format==="regex"?`NeplatnÃ½ Å™etÄ›zec: musÃ­ odpovÃ­dat vzoru ${m.pattern}`:`NeplatnÃ½ formÃ¡t ${o[m.format]??l.format}`}case"not_multiple_of":return`NeplatnÃ© ÄÃ­slo: musÃ­ bÃ½t nÃ¡sobkem ${l.divisor}`;case"unrecognized_keys":return`NeznÃ¡mÃ© klÃ­Äe: ${si(l.keys,", ")}`;case"invalid_key":return`NeplatnÃ½ klÃ­Ä v ${l.origin}`;case"invalid_union":return"NeplatnÃ½ vstup";case"invalid_element":return`NeplatnÃ¡ hodnota v ${l.origin}`;default:return"NeplatnÃ½ vstup"}}};function Z9(){return{localeError:H9()}}var W9=()=>{let i={string:{unit:"tegn",verb:"havde"},file:{unit:"bytes",verb:"havde"},array:{unit:"elementer",verb:"indeholdt"},set:{unit:"elementer",verb:"indeholdt"}};function e(l){return i[l]??null}let o={regex:"input",email:"e-mailadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslÃ¦t",date:"ISO-dato",time:"ISO-klokkeslÃ¦t",duration:"ISO-varighed",ipv4:"IPv4-omrÃ¥de",ipv6:"IPv6-omrÃ¥de",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodet streng",base64url:"base64url-kodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},h={nan:"NaN",string:"streng",number:"tal",boolean:"boolean",array:"liste",object:"objekt",set:"sÃ¦t",file:"fil"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ugyldigt input: forventede instanceof ${l.expected}, fik ${s}`:`Ugyldigt input: forventede ${m}, fik ${s}`}case"invalid_value":return l.values.length===1?`Ugyldig vÃ¦rdi: forventede ${vn(l.values[0])}`:`Ugyldigt valg: forventede en af fÃ¸lgende ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin),s=h[l.origin]??l.origin;return x?`For stor: forventede ${s??"value"} ${x.verb} ${m} ${l.maximum.toString()} ${x.unit??"elementer"}`:`For stor: forventede ${s??"value"} havde ${m} ${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin),s=h[l.origin]??l.origin;return x?`For lille: forventede ${s} ${x.verb} ${m} ${l.minimum.toString()} ${x.unit}`:`For lille: forventede ${s} havde ${m} ${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Ugyldig streng: skal starte med "${m.prefix}"`:m.format==="ends_with"?`Ugyldig streng: skal ende med "${m.suffix}"`:m.format==="includes"?`Ugyldig streng: skal indeholde "${m.includes}"`:m.format==="regex"?`Ugyldig streng: skal matche mÃ¸nsteret ${m.pattern}`:`Ugyldig ${o[m.format]??l.format}`}case"not_multiple_of":return`Ugyldigt tal: skal vÃ¦re deleligt med ${l.divisor}`;case"unrecognized_keys":return`${l.keys.length>1?"Ukendte nÃ¸gler":"Ukendt nÃ¸gle"}: ${si(l.keys,", ")}`;case"invalid_key":return`Ugyldig nÃ¸gle i ${l.origin}`;case"invalid_union":return"Ugyldigt input: matcher ingen af de tilladte typer";case"invalid_element":return`Ugyldig vÃ¦rdi i ${l.origin}`;default:return"Ugyldigt input"}}};function q9(){return{localeError:W9()}}var X9=()=>{let i={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}};function e(l){return i[l]??null}let o={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"},h={nan:"NaN",number:"Zahl",array:"Array"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`UngÃ¼ltige Eingabe: erwartet instanceof ${l.expected}, erhalten ${s}`:`UngÃ¼ltige Eingabe: erwartet ${m}, erhalten ${s}`}case"invalid_value":return l.values.length===1?`UngÃ¼ltige Eingabe: erwartet ${vn(l.values[0])}`:`UngÃ¼ltige Option: erwartet eine von ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Zu groÃŸ: erwartet, dass ${l.origin??"Wert"} ${m}${l.maximum.toString()} ${x.unit??"Elemente"} hat`:`Zu groÃŸ: erwartet, dass ${l.origin??"Wert"} ${m}${l.maximum.toString()} ist`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Zu klein: erwartet, dass ${l.origin} ${m}${l.minimum.toString()} ${x.unit} hat`:`Zu klein: erwartet, dass ${l.origin} ${m}${l.minimum.toString()} ist`}case"invalid_format":{let m=l;return m.format==="starts_with"?`UngÃ¼ltiger String: muss mit "${m.prefix}" beginnen`:m.format==="ends_with"?`UngÃ¼ltiger String: muss mit "${m.suffix}" enden`:m.format==="includes"?`UngÃ¼ltiger String: muss "${m.includes}" enthalten`:m.format==="regex"?`UngÃ¼ltiger String: muss dem Muster ${m.pattern} entsprechen`:`UngÃ¼ltig: ${o[m.format]??l.format}`}case"not_multiple_of":return`UngÃ¼ltige Zahl: muss ein Vielfaches von ${l.divisor} sein`;case"unrecognized_keys":return`${l.keys.length>1?"Unbekannte SchlÃ¼ssel":"Unbekannter SchlÃ¼ssel"}: ${si(l.keys,", ")}`;case"invalid_key":return`UngÃ¼ltiger SchlÃ¼ssel in ${l.origin}`;case"invalid_union":return"UngÃ¼ltige Eingabe";case"invalid_element":return`UngÃ¼ltiger Wert in ${l.origin}`;default:return"UngÃ¼ltige Eingabe"}}};function J9(){return{localeError:X9()}}var Y9=()=>{let i={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"},map:{unit:"entries",verb:"to have"}};function e(l){return i[l]??null}let o={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return`Invalid input: expected ${m}, received ${s}`}case"invalid_value":return l.values.length===1?`Invalid input: expected ${vn(l.values[0])}`:`Invalid option: expected one of ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Too big: expected ${l.origin??"value"} to have ${m}${l.maximum.toString()} ${x.unit??"elements"}`:`Too big: expected ${l.origin??"value"} to be ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Too small: expected ${l.origin} to have ${m}${l.minimum.toString()} ${x.unit}`:`Too small: expected ${l.origin} to be ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Invalid string: must start with "${m.prefix}"`:m.format==="ends_with"?`Invalid string: must end with "${m.suffix}"`:m.format==="includes"?`Invalid string: must include "${m.includes}"`:m.format==="regex"?`Invalid string: must match pattern ${m.pattern}`:`Invalid ${o[m.format]??l.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${l.divisor}`;case"unrecognized_keys":return`Unrecognized key${l.keys.length>1?"s":""}: ${si(l.keys,", ")}`;case"invalid_key":return`Invalid key in ${l.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${l.origin}`;default:return"Invalid input"}}};function Q3(){return{localeError:Y9()}}var K9=()=>{let i={string:{unit:"karaktrojn",verb:"havi"},file:{unit:"bajtojn",verb:"havi"},array:{unit:"elementojn",verb:"havi"},set:{unit:"elementojn",verb:"havi"}};function e(l){return i[l]??null}let o={regex:"enigo",email:"retadreso",url:"URL",emoji:"emoÄio",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datotempo",date:"ISO-dato",time:"ISO-tempo",duration:"ISO-daÅ­ro",ipv4:"IPv4-adreso",ipv6:"IPv6-adreso",cidrv4:"IPv4-rango",cidrv6:"IPv6-rango",base64:"64-ume kodita karaktraro",base64url:"URL-64-ume kodita karaktraro",json_string:"JSON-karaktraro",e164:"E.164-nombro",jwt:"JWT",template_literal:"enigo"},h={nan:"NaN",number:"nombro",array:"tabelo",null:"senvalora"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Nevalida enigo: atendiÄis instanceof ${l.expected}, riceviÄis ${s}`:`Nevalida enigo: atendiÄis ${m}, riceviÄis ${s}`}case"invalid_value":return l.values.length===1?`Nevalida enigo: atendiÄis ${vn(l.values[0])}`:`Nevalida opcio: atendiÄis unu el ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Tro granda: atendiÄis ke ${l.origin??"valoro"} havu ${m}${l.maximum.toString()} ${x.unit??"elementojn"}`:`Tro granda: atendiÄis ke ${l.origin??"valoro"} havu ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Tro malgranda: atendiÄis ke ${l.origin} havu ${m}${l.minimum.toString()} ${x.unit}`:`Tro malgranda: atendiÄis ke ${l.origin} estu ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Nevalida karaktraro: devas komenciÄi per "${m.prefix}"`:m.format==="ends_with"?`Nevalida karaktraro: devas finiÄi per "${m.suffix}"`:m.format==="includes"?`Nevalida karaktraro: devas inkluzivi "${m.includes}"`:m.format==="regex"?`Nevalida karaktraro: devas kongrui kun la modelo ${m.pattern}`:`Nevalida ${o[m.format]??l.format}`}case"not_multiple_of":return`Nevalida nombro: devas esti oblo de ${l.divisor}`;case"unrecognized_keys":return`Nekonata${l.keys.length>1?"j":""} Ålosilo${l.keys.length>1?"j":""}: ${si(l.keys,", ")}`;case"invalid_key":return`Nevalida Ålosilo en ${l.origin}`;case"invalid_union":return"Nevalida enigo";case"invalid_element":return`Nevalida valoro en ${l.origin}`;default:return"Nevalida enigo"}}};function Q9(){return{localeError:K9()}}var e7=()=>{let i={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}};function e(l){return i[l]??null}let o={regex:"entrada",email:"direcciÃ³n de correo electrÃ³nico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duraciÃ³n ISO",ipv4:"direcciÃ³n IPv4",ipv6:"direcciÃ³n IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"nÃºmero E.164",jwt:"JWT",template_literal:"entrada"},h={nan:"NaN",string:"texto",number:"nÃºmero",boolean:"booleano",array:"arreglo",object:"objeto",set:"conjunto",file:"archivo",date:"fecha",bigint:"nÃºmero grande",symbol:"sÃ­mbolo",undefined:"indefinido",null:"nulo",function:"funciÃ³n",map:"mapa",record:"registro",tuple:"tupla",enum:"enumeraciÃ³n",union:"uniÃ³n",literal:"literal",promise:"promesa",void:"vacÃ­o",never:"nunca",unknown:"desconocido",any:"cualquiera"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Entrada invÃ¡lida: se esperaba instanceof ${l.expected}, recibido ${s}`:`Entrada invÃ¡lida: se esperaba ${m}, recibido ${s}`}case"invalid_value":return l.values.length===1?`Entrada invÃ¡lida: se esperaba ${vn(l.values[0])}`:`OpciÃ³n invÃ¡lida: se esperaba una de ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin),s=h[l.origin]??l.origin;return x?`Demasiado grande: se esperaba que ${s??"valor"} tuviera ${m}${l.maximum.toString()} ${x.unit??"elementos"}`:`Demasiado grande: se esperaba que ${s??"valor"} fuera ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin),s=h[l.origin]??l.origin;return x?`Demasiado pequeÃ±o: se esperaba que ${s} tuviera ${m}${l.minimum.toString()} ${x.unit}`:`Demasiado pequeÃ±o: se esperaba que ${s} fuera ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Cadena invÃ¡lida: debe comenzar con "${m.prefix}"`:m.format==="ends_with"?`Cadena invÃ¡lida: debe terminar en "${m.suffix}"`:m.format==="includes"?`Cadena invÃ¡lida: debe incluir "${m.includes}"`:m.format==="regex"?`Cadena invÃ¡lida: debe coincidir con el patrÃ³n ${m.pattern}`:`InvÃ¡lido ${o[m.format]??l.format}`}case"not_multiple_of":return`NÃºmero invÃ¡lido: debe ser mÃºltiplo de ${l.divisor}`;case"unrecognized_keys":return`Llave${l.keys.length>1?"s":""} desconocida${l.keys.length>1?"s":""}: ${si(l.keys,", ")}`;case"invalid_key":return`Llave invÃ¡lida en ${h[l.origin]??l.origin}`;case"invalid_union":return"Entrada invÃ¡lida";case"invalid_element":return`Valor invÃ¡lido en ${h[l.origin]??l.origin}`;default:return"Entrada invÃ¡lida"}}};function t7(){return{localeError:e7()}}var i7=()=>{let i={string:{unit:"Ú©Ø§Ø±Ø§Ú©ØªØ±",verb:"Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯"},file:{unit:"Ø¨Ø§ÛŒØª",verb:"Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯"},array:{unit:"Ø¢ÛŒØªÙ…",verb:"Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯"},set:{unit:"Ø¢ÛŒØªÙ…",verb:"Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯"}};function e(l){return i[l]??null}let o={regex:"ÙˆØ±ÙˆØ¯ÛŒ",email:"Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„",url:"URL",emoji:"Ø§ÛŒÙ…ÙˆØ¬ÛŒ",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† Ø§ÛŒØ²Ùˆ",date:"ØªØ§Ø±ÛŒØ® Ø§ÛŒØ²Ùˆ",time:"Ø²Ù…Ø§Ù† Ø§ÛŒØ²Ùˆ",duration:"Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø§ÛŒØ²Ùˆ",ipv4:"IPv4 Ø¢Ø¯Ø±Ø³",ipv6:"IPv6 Ø¢Ø¯Ø±Ø³",cidrv4:"IPv4 Ø¯Ø§Ù…Ù†Ù‡",cidrv6:"IPv6 Ø¯Ø§Ù…Ù†Ù‡",base64:"base64-encoded Ø±Ø´ØªÙ‡",base64url:"base64url-encoded Ø±Ø´ØªÙ‡",json_string:"JSON Ø±Ø´ØªÙ‡",e164:"E.164 Ø¹Ø¯Ø¯",jwt:"JWT",template_literal:"ÙˆØ±ÙˆØ¯ÛŒ"},h={nan:"NaN",number:"Ø¹Ø¯Ø¯",array:"Ø¢Ø±Ø§ÛŒÙ‡"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ù…ÛŒâ€ŒØ¨Ø§ÛŒØ³Øª instanceof ${l.expected} Ù…ÛŒâ€ŒØ¨ÙˆØ¯ØŒ ${s} Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯`:`ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ù…ÛŒâ€ŒØ¨Ø§ÛŒØ³Øª ${m} Ù…ÛŒâ€ŒØ¨ÙˆØ¯ØŒ ${s} Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯`}case"invalid_value":return l.values.length===1?`ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ù…ÛŒâ€ŒØ¨Ø§ÛŒØ³Øª ${vn(l.values[0])} Ù…ÛŒâ€ŒØ¨ÙˆØ¯`:`Ú¯Ø²ÛŒÙ†Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ù…ÛŒâ€ŒØ¨Ø§ÛŒØ³Øª ÛŒÚ©ÛŒ Ø§Ø² ${si(l.values,"|")} Ù…ÛŒâ€ŒØ¨ÙˆØ¯`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ø®ÛŒÙ„ÛŒ Ø¨Ø²Ø±Ú¯: ${l.origin??"Ù…Ù‚Ø¯Ø§Ø±"} Ø¨Ø§ÛŒØ¯ ${m}${l.maximum.toString()} ${x.unit??"Ø¹Ù†ØµØ±"} Ø¨Ø§Ø´Ø¯`:`Ø®ÛŒÙ„ÛŒ Ø¨Ø²Ø±Ú¯: ${l.origin??"Ù…Ù‚Ø¯Ø§Ø±"} Ø¨Ø§ÛŒØ¯ ${m}${l.maximum.toString()} Ø¨Ø§Ø´Ø¯`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú©: ${l.origin} Ø¨Ø§ÛŒØ¯ ${m}${l.minimum.toString()} ${x.unit} Ø¨Ø§Ø´Ø¯`:`Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú©: ${l.origin} Ø¨Ø§ÛŒØ¯ ${m}${l.minimum.toString()} Ø¨Ø§Ø´Ø¯`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Ø±Ø´ØªÙ‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ø¨Ø§ "${m.prefix}" Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯`:m.format==="ends_with"?`Ø±Ø´ØªÙ‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ø¨Ø§ "${m.suffix}" ØªÙ…Ø§Ù… Ø´ÙˆØ¯`:m.format==="includes"?`Ø±Ø´ØªÙ‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ "${m.includes}" Ø¨Ø§Ø´Ø¯`:m.format==="regex"?`Ø±Ø´ØªÙ‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø§Ù„Ú¯ÙˆÛŒ ${m.pattern} Ù…Ø·Ø§Ø¨Ù‚Øª Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯`:`${o[m.format]??l.format} Ù†Ø§Ù…Ø¹ØªØ¨Ø±`}case"not_multiple_of":return`Ø¹Ø¯Ø¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø±: Ø¨Ø§ÛŒØ¯ Ù…Ø¶Ø±Ø¨ ${l.divisor} Ø¨Ø§Ø´Ø¯`;case"unrecognized_keys":return`Ú©Ù„ÛŒØ¯${l.keys.length>1?"Ù‡Ø§ÛŒ":""} Ù†Ø§Ø´Ù†Ø§Ø³: ${si(l.keys,", ")}`;case"invalid_key":return`Ú©Ù„ÛŒØ¯ Ù†Ø§Ø´Ù†Ø§Ø³ Ø¯Ø± ${l.origin}`;case"invalid_union":return"ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±";case"invalid_element":return`Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¯Ø± ${l.origin}`;default:return"ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±"}}};function n7(){return{localeError:i7()}}var r7=()=>{let i={string:{unit:"merkkiÃ¤",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"pÃ¤ivÃ¤mÃ¤Ã¤rÃ¤n"}};function e(l){return i[l]??null}let o={regex:"sÃ¤Ã¤nnÃ¶llinen lauseke",email:"sÃ¤hkÃ¶postiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-pÃ¤ivÃ¤mÃ¤Ã¤rÃ¤",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Virheellinen tyyppi: odotettiin instanceof ${l.expected}, oli ${s}`:`Virheellinen tyyppi: odotettiin ${m}, oli ${s}`}case"invalid_value":return l.values.length===1?`Virheellinen syÃ¶te: tÃ¤ytyy olla ${vn(l.values[0])}`:`Virheellinen valinta: tÃ¤ytyy olla yksi seuraavista: ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Liian suuri: ${x.subject} tÃ¤ytyy olla ${m}${l.maximum.toString()} ${x.unit}`.trim():`Liian suuri: arvon tÃ¤ytyy olla ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Liian pieni: ${x.subject} tÃ¤ytyy olla ${m}${l.minimum.toString()} ${x.unit}`.trim():`Liian pieni: arvon tÃ¤ytyy olla ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Virheellinen syÃ¶te: tÃ¤ytyy alkaa "${m.prefix}"`:m.format==="ends_with"?`Virheellinen syÃ¶te: tÃ¤ytyy loppua "${m.suffix}"`:m.format==="includes"?`Virheellinen syÃ¶te: tÃ¤ytyy sisÃ¤ltÃ¤Ã¤ "${m.includes}"`:m.format==="regex"?`Virheellinen syÃ¶te: tÃ¤ytyy vastata sÃ¤Ã¤nnÃ¶llistÃ¤ lauseketta ${m.pattern}`:`Virheellinen ${o[m.format]??l.format}`}case"not_multiple_of":return`Virheellinen luku: tÃ¤ytyy olla luvun ${l.divisor} monikerta`;case"unrecognized_keys":return`${l.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${si(l.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return"Virheellinen syÃ¶te"}}};function o7(){return{localeError:r7()}}var s7=()=>{let i={string:{unit:"caractÃ¨res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"Ã©lÃ©ments",verb:"avoir"},set:{unit:"Ã©lÃ©ments",verb:"avoir"}};function e(l){return i[l]??null}let o={regex:"entrÃ©e",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"durÃ©e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chaÃ®ne encodÃ©e en base64",base64url:"chaÃ®ne encodÃ©e en base64url",json_string:"chaÃ®ne JSON",e164:"numÃ©ro E.164",jwt:"JWT",template_literal:"entrÃ©e"},h={nan:"NaN",number:"nombre",array:"tableau"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`EntrÃ©e invalide : instanceof ${l.expected} attendu, ${s} reÃ§u`:`EntrÃ©e invalide : ${m} attendu, ${s} reÃ§u`}case"invalid_value":return l.values.length===1?`EntrÃ©e invalide : ${vn(l.values[0])} attendu`:`Option invalide : une valeur parmi ${si(l.values,"|")} attendue`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Trop grand : ${l.origin??"valeur"} doit ${x.verb} ${m}${l.maximum.toString()} ${x.unit??"Ã©lÃ©ment(s)"}`:`Trop grand : ${l.origin??"valeur"} doit Ãªtre ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Trop petit : ${l.origin} doit ${x.verb} ${m}${l.minimum.toString()} ${x.unit}`:`Trop petit : ${l.origin} doit Ãªtre ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ChaÃ®ne invalide : doit commencer par "${m.prefix}"`:m.format==="ends_with"?`ChaÃ®ne invalide : doit se terminer par "${m.suffix}"`:m.format==="includes"?`ChaÃ®ne invalide : doit inclure "${m.includes}"`:m.format==="regex"?`ChaÃ®ne invalide : doit correspondre au modÃ¨le ${m.pattern}`:`${o[m.format]??l.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit Ãªtre un multiple de ${l.divisor}`;case"unrecognized_keys":return`ClÃ©${l.keys.length>1?"s":""} non reconnue${l.keys.length>1?"s":""} : ${si(l.keys,", ")}`;case"invalid_key":return`ClÃ© invalide dans ${l.origin}`;case"invalid_union":return"EntrÃ©e invalide";case"invalid_element":return`Valeur invalide dans ${l.origin}`;default:return"EntrÃ©e invalide"}}};function a7(){return{localeError:s7()}}var l7=()=>{let i={string:{unit:"caractÃ¨res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"Ã©lÃ©ments",verb:"avoir"},set:{unit:"Ã©lÃ©ments",verb:"avoir"}};function e(l){return i[l]??null}let o={regex:"entrÃ©e",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"durÃ©e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chaÃ®ne encodÃ©e en base64",base64url:"chaÃ®ne encodÃ©e en base64url",json_string:"chaÃ®ne JSON",e164:"numÃ©ro E.164",jwt:"JWT",template_literal:"entrÃ©e"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`EntrÃ©e invalide : attendu instanceof ${l.expected}, reÃ§u ${s}`:`EntrÃ©e invalide : attendu ${m}, reÃ§u ${s}`}case"invalid_value":return l.values.length===1?`EntrÃ©e invalide : attendu ${vn(l.values[0])}`:`Option invalide : attendu l'une des valeurs suivantes ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"â‰¤":"<",x=e(l.origin);return x?`Trop grand : attendu que ${l.origin??"la valeur"} ait ${m}${l.maximum.toString()} ${x.unit}`:`Trop grand : attendu que ${l.origin??"la valeur"} soit ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?"â‰¥":">",x=e(l.origin);return x?`Trop petit : attendu que ${l.origin} ait ${m}${l.minimum.toString()} ${x.unit}`:`Trop petit : attendu que ${l.origin} soit ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ChaÃ®ne invalide : doit commencer par "${m.prefix}"`:m.format==="ends_with"?`ChaÃ®ne invalide : doit se terminer par "${m.suffix}"`:m.format==="includes"?`ChaÃ®ne invalide : doit inclure "${m.includes}"`:m.format==="regex"?`ChaÃ®ne invalide : doit correspondre au motif ${m.pattern}`:`${o[m.format]??l.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit Ãªtre un multiple de ${l.divisor}`;case"unrecognized_keys":return`ClÃ©${l.keys.length>1?"s":""} non reconnue${l.keys.length>1?"s":""} : ${si(l.keys,", ")}`;case"invalid_key":return`ClÃ© invalide dans ${l.origin}`;case"invalid_union":return"EntrÃ©e invalide";case"invalid_element":return`Valeur invalide dans ${l.origin}`;default:return"EntrÃ©e invalide"}}};function c7(){return{localeError:l7()}}var u7=()=>{let i={string:{label:"×ž×—×¨×•×–×ª",gender:"f"},number:{label:"×ž×¡×¤×¨",gender:"m"},boolean:{label:"×¢×¨×š ×‘×•×œ×™×× ×™",gender:"m"},bigint:{label:"BigInt",gender:"m"},date:{label:"×ª××¨×™×š",gender:"m"},array:{label:"×ž×¢×¨×š",gender:"m"},object:{label:"××•×‘×™×™×§×˜",gender:"m"},null:{label:"×¢×¨×š ×¨×™×§ (null)",gender:"m"},undefined:{label:"×¢×¨×š ×œ× ×ž×•×’×“×¨ (undefined)",gender:"m"},symbol:{label:"×¡×™×ž×‘×•×œ (Symbol)",gender:"m"},function:{label:"×¤×•× ×§×¦×™×”",gender:"f"},map:{label:"×ž×¤×” (Map)",gender:"f"},set:{label:"×§×‘×•×¦×” (Set)",gender:"f"},file:{label:"×§×•×‘×¥",gender:"m"},promise:{label:"Promise",gender:"m"},NaN:{label:"NaN",gender:"m"},unknown:{label:"×¢×¨×š ×œ× ×™×“×•×¢",gender:"m"},value:{label:"×¢×¨×š",gender:"m"}},e={string:{unit:"×ª×•×•×™×",shortLabel:"×§×¦×¨",longLabel:"××¨×•×š"},file:{unit:"×‘×™×™×˜×™×",shortLabel:"×§×˜×Ÿ",longLabel:"×’×“×•×œ"},array:{unit:"×¤×¨×™×˜×™×",shortLabel:"×§×˜×Ÿ",longLabel:"×’×“×•×œ"},set:{unit:"×¤×¨×™×˜×™×",shortLabel:"×§×˜×Ÿ",longLabel:"×’×“×•×œ"},number:{unit:"",shortLabel:"×§×˜×Ÿ",longLabel:"×’×“×•×œ"}},o=C=>C?i[C]:void 0,h=C=>{let F=o(C);return F?F.label:C??i.unknown.label},l=C=>`×”${h(C)}`,m=C=>{var F;return(((F=o(C))==null?void 0:F.gender)??"m")==="f"?"×¦×¨×™×›×” ×œ×”×™×•×ª":"×¦×¨×™×š ×œ×”×™×•×ª"},x=C=>C?e[C]??null:null,s={regex:{label:"×§×œ×˜",gender:"m"},email:{label:"×›×ª×•×‘×ª ××™×ž×™×™×œ",gender:"f"},url:{label:"×›×ª×•×‘×ª ×¨×©×ª",gender:"f"},emoji:{label:"××™×ž×•×’'×™",gender:"m"},uuid:{label:"UUID",gender:"m"},nanoid:{label:"nanoid",gender:"m"},guid:{label:"GUID",gender:"m"},cuid:{label:"cuid",gender:"m"},cuid2:{label:"cuid2",gender:"m"},ulid:{label:"ULID",gender:"m"},xid:{label:"XID",gender:"m"},ksuid:{label:"KSUID",gender:"m"},datetime:{label:"×ª××¨×™×š ×•×–×ž×Ÿ ISO",gender:"m"},date:{label:"×ª××¨×™×š ISO",gender:"m"},time:{label:"×–×ž×Ÿ ISO",gender:"m"},duration:{label:"×ž×©×š ×–×ž×Ÿ ISO",gender:"m"},ipv4:{label:"×›×ª×•×‘×ª IPv4",gender:"f"},ipv6:{label:"×›×ª×•×‘×ª IPv6",gender:"f"},cidrv4:{label:"×˜×•×•×— IPv4",gender:"m"},cidrv6:{label:"×˜×•×•×— IPv6",gender:"m"},base64:{label:"×ž×—×¨×•×–×ª ×‘×‘×¡×™×¡ 64",gender:"f"},base64url:{label:"×ž×—×¨×•×–×ª ×‘×‘×¡×™×¡ 64 ×œ×›×ª×•×‘×•×ª ×¨×©×ª",gender:"f"},json_string:{label:"×ž×—×¨×•×–×ª JSON",gender:"f"},e164:{label:"×ž×¡×¤×¨ E.164",gender:"m"},jwt:{label:"JWT",gender:"m"},ends_with:{label:"×§×œ×˜",gender:"m"},includes:{label:"×§×œ×˜",gender:"m"},lowercase:{label:"×§×œ×˜",gender:"m"},starts_with:{label:"×§×œ×˜",gender:"m"},uppercase:{label:"×§×œ×˜",gender:"m"}},P={nan:"NaN"};return C=>{var F;switch(C.code){case"invalid_type":{let O=C.expected,V=P[O??""]??h(O),J=Sn(C.input),ee=P[J]??((F=i[J])==null?void 0:F.label)??J;return/^[A-Z]/.test(C.expected)?`×§×œ×˜ ×œ× ×ª×§×™×Ÿ: ×¦×¨×™×š ×œ×”×™×•×ª instanceof ${C.expected}, ×”×ª×§×‘×œ ${ee}`:`×§×œ×˜ ×œ× ×ª×§×™×Ÿ: ×¦×¨×™×š ×œ×”×™×•×ª ${V}, ×”×ª×§×‘×œ ${ee}`}case"invalid_value":{if(C.values.length===1)return`×¢×¨×š ×œ× ×ª×§×™×Ÿ: ×”×¢×¨×š ×—×™×™×‘ ×œ×”×™×•×ª ${vn(C.values[0])}`;let O=C.values.map(J=>vn(J));if(C.values.length===2)return`×¢×¨×š ×œ× ×ª×§×™×Ÿ: ×”××¤×©×¨×•×™×•×ª ×”×ž×ª××™×ž×•×ª ×”×Ÿ ${O[0]} ××• ${O[1]}`;let V=O[O.length-1];return`×¢×¨×š ×œ× ×ª×§×™×Ÿ: ×”××¤×©×¨×•×™×•×ª ×”×ž×ª××™×ž×•×ª ×”×Ÿ ${O.slice(0,-1).join(", ")} ××• ${V}`}case"too_big":{let O=x(C.origin),V=l(C.origin??"value");if(C.origin==="string")return`${(O==null?void 0:O.longLabel)??"××¨×•×š"} ×ž×“×™: ${V} ×¦×¨×™×›×” ×œ×”×›×™×œ ${C.maximum.toString()} ${(O==null?void 0:O.unit)??""} ${C.inclusive?"××• ×¤×—×•×ª":"×œ×›×œ ×”×™×•×ª×¨"}`.trim();if(C.origin==="number"){let se=C.inclusive?`×§×˜×Ÿ ××• ×©×•×•×” ×œ-${C.maximum}`:`×§×˜×Ÿ ×ž-${C.maximum}`;return`×’×“×•×œ ×ž×“×™: ${V} ×¦×¨×™×š ×œ×”×™×•×ª ${se}`}if(C.origin==="array"||C.origin==="set"){let se=C.origin==="set"?"×¦×¨×™×›×”":"×¦×¨×™×š",fe=C.inclusive?`${C.maximum} ${(O==null?void 0:O.unit)??""} ××• ×¤×—×•×ª`:`×¤×—×•×ª ×ž-${C.maximum} ${(O==null?void 0:O.unit)??""}`;return`×’×“×•×œ ×ž×“×™: ${V} ${se} ×œ×”×›×™×œ ${fe}`.trim()}let J=C.inclusive?"<=":"<",ee=m(C.origin??"value");return O!=null&&O.unit?`${O.longLabel} ×ž×“×™: ${V} ${ee} ${J}${C.maximum.toString()} ${O.unit}`:`${(O==null?void 0:O.longLabel)??"×’×“×•×œ"} ×ž×“×™: ${V} ${ee} ${J}${C.maximum.toString()}`}case"too_small":{let O=x(C.origin),V=l(C.origin??"value");if(C.origin==="string")return`${(O==null?void 0:O.shortLabel)??"×§×¦×¨"} ×ž×“×™: ${V} ×¦×¨×™×›×” ×œ×”×›×™×œ ${C.minimum.toString()} ${(O==null?void 0:O.unit)??""} ${C.inclusive?"××• ×™×•×ª×¨":"×œ×¤×—×•×ª"}`.trim();if(C.origin==="number"){let se=C.inclusive?`×’×“×•×œ ××• ×©×•×•×” ×œ-${C.minimum}`:`×’×“×•×œ ×ž-${C.minimum}`;return`×§×˜×Ÿ ×ž×“×™: ${V} ×¦×¨×™×š ×œ×”×™×•×ª ${se}`}if(C.origin==="array"||C.origin==="set"){let se=C.origin==="set"?"×¦×¨×™×›×”":"×¦×¨×™×š";if(C.minimum===1&&C.inclusive){let le=(C.origin==="set","×œ×¤×—×•×ª ×¤×¨×™×˜ ××—×“");return`×§×˜×Ÿ ×ž×“×™: ${V} ${se} ×œ×”×›×™×œ ${le}`}let fe=C.inclusive?`${C.minimum} ${(O==null?void 0:O.unit)??""} ××• ×™×•×ª×¨`:`×™×•×ª×¨ ×ž-${C.minimum} ${(O==null?void 0:O.unit)??""}`;return`×§×˜×Ÿ ×ž×“×™: ${V} ${se} ×œ×”×›×™×œ ${fe}`.trim()}let J=C.inclusive?">=":">",ee=m(C.origin??"value");return O!=null&&O.unit?`${O.shortLabel} ×ž×“×™: ${V} ${ee} ${J}${C.minimum.toString()} ${O.unit}`:`${(O==null?void 0:O.shortLabel)??"×§×˜×Ÿ"} ×ž×“×™: ${V} ${ee} ${J}${C.minimum.toString()}`}case"invalid_format":{let O=C;if(O.format==="starts_with")return`×”×ž×—×¨×•×–×ª ×—×™×™×‘×ª ×œ×”×ª×—×™×œ ×‘ "${O.prefix}"`;if(O.format==="ends_with")return`×”×ž×—×¨×•×–×ª ×—×™×™×‘×ª ×œ×”×¡×ª×™×™× ×‘ "${O.suffix}"`;if(O.format==="includes")return`×”×ž×—×¨×•×–×ª ×—×™×™×‘×ª ×œ×›×œ×•×œ "${O.includes}"`;if(O.format==="regex")return`×”×ž×—×¨×•×–×ª ×—×™×™×‘×ª ×œ×”×ª××™× ×œ×ª×‘× ×™×ª ${O.pattern}`;let V=s[O.format],J=(V==null?void 0:V.label)??O.format,ee=((V==null?void 0:V.gender)??"m")==="f"?"×ª×§×™× ×”":"×ª×§×™×Ÿ";return`${J} ×œ× ${ee}`}case"not_multiple_of":return`×ž×¡×¤×¨ ×œ× ×ª×§×™×Ÿ: ×—×™×™×‘ ×œ×”×™×•×ª ×ž×›×¤×œ×” ×©×œ ${C.divisor}`;case"unrecognized_keys":return`×ž×¤×ª×—${C.keys.length>1?"×•×ª":""} ×œ× ×ž×–×•×”${C.keys.length>1?"×™×":"×”"}: ${si(C.keys,", ")}`;case"invalid_key":return"×©×“×” ×œ× ×ª×§×™×Ÿ ×‘××•×‘×™×™×§×˜";case"invalid_union":return"×§×œ×˜ ×œ× ×ª×§×™×Ÿ";case"invalid_element":return`×¢×¨×š ×œ× ×ª×§×™×Ÿ ×‘${l(C.origin??"array")}`;default:return"×§×œ×˜ ×œ× ×ª×§×™×Ÿ"}}};function h7(){return{localeError:u7()}}var d7=()=>{let i={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}};function e(l){return i[l]??null}let o={regex:"bemenet",email:"email cÃ­m",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO idÅ‘bÃ©lyeg",date:"ISO dÃ¡tum",time:"ISO idÅ‘",duration:"ISO idÅ‘intervallum",ipv4:"IPv4 cÃ­m",ipv6:"IPv6 cÃ­m",cidrv4:"IPv4 tartomÃ¡ny",cidrv6:"IPv6 tartomÃ¡ny",base64:"base64-kÃ³dolt string",base64url:"base64url-kÃ³dolt string",json_string:"JSON string",e164:"E.164 szÃ¡m",jwt:"JWT",template_literal:"bemenet"},h={nan:"NaN",number:"szÃ¡m",array:"tÃ¶mb"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ã‰rvÃ©nytelen bemenet: a vÃ¡rt Ã©rtÃ©k instanceof ${l.expected}, a kapott Ã©rtÃ©k ${s}`:`Ã‰rvÃ©nytelen bemenet: a vÃ¡rt Ã©rtÃ©k ${m}, a kapott Ã©rtÃ©k ${s}`}case"invalid_value":return l.values.length===1?`Ã‰rvÃ©nytelen bemenet: a vÃ¡rt Ã©rtÃ©k ${vn(l.values[0])}`:`Ã‰rvÃ©nytelen opciÃ³: valamelyik Ã©rtÃ©k vÃ¡rt ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`TÃºl nagy: ${l.origin??"Ã©rtÃ©k"} mÃ©rete tÃºl nagy ${m}${l.maximum.toString()} ${x.unit??"elem"}`:`TÃºl nagy: a bemeneti Ã©rtÃ©k ${l.origin??"Ã©rtÃ©k"} tÃºl nagy: ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`TÃºl kicsi: a bemeneti Ã©rtÃ©k ${l.origin} mÃ©rete tÃºl kicsi ${m}${l.minimum.toString()} ${x.unit}`:`TÃºl kicsi: a bemeneti Ã©rtÃ©k ${l.origin} tÃºl kicsi ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Ã‰rvÃ©nytelen string: "${m.prefix}" Ã©rtÃ©kkel kell kezdÅ‘dnie`:m.format==="ends_with"?`Ã‰rvÃ©nytelen string: "${m.suffix}" Ã©rtÃ©kkel kell vÃ©gzÅ‘dnie`:m.format==="includes"?`Ã‰rvÃ©nytelen string: "${m.includes}" Ã©rtÃ©ket kell tartalmaznia`:m.format==="regex"?`Ã‰rvÃ©nytelen string: ${m.pattern} mintÃ¡nak kell megfelelnie`:`Ã‰rvÃ©nytelen ${o[m.format]??l.format}`}case"not_multiple_of":return`Ã‰rvÃ©nytelen szÃ¡m: ${l.divisor} tÃ¶bbszÃ¶rÃ¶sÃ©nek kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${l.keys.length>1?"s":""}: ${si(l.keys,", ")}`;case"invalid_key":return`Ã‰rvÃ©nytelen kulcs ${l.origin}`;case"invalid_union":return"Ã‰rvÃ©nytelen bemenet";case"invalid_element":return`Ã‰rvÃ©nytelen Ã©rtÃ©k: ${l.origin}`;default:return"Ã‰rvÃ©nytelen bemenet"}}};function f7(){return{localeError:d7()}}function TR(i,e,o){return Math.abs(i)===1?e:o}function Kf(i){if(!i)return"";let e=["Õ¡","Õ¥","Õ¨","Õ«","Õ¸","Õ¸Ö‚","Ö…"],o=i[i.length-1];return i+(e.includes(o)?"Õ¶":"Õ¨")}var p7=()=>{let i={string:{unit:{one:"Õ¶Õ·Õ¡Õ¶",many:"Õ¶Õ·Õ¡Õ¶Õ¶Õ¥Ö€"},verb:"Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡Õ¬"},file:{unit:{one:"Õ¢Õ¡ÕµÕ©",many:"Õ¢Õ¡ÕµÕ©Õ¥Ö€"},verb:"Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡Õ¬"},array:{unit:{one:"Õ¿Õ¡Ö€Ö€",many:"Õ¿Õ¡Ö€Ö€Õ¥Ö€"},verb:"Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡Õ¬"},set:{unit:{one:"Õ¿Õ¡Ö€Ö€",many:"Õ¿Õ¡Ö€Ö€Õ¥Ö€"},verb:"Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡Õ¬"}};function e(l){return i[l]??null}let o={regex:"Õ´Õ¸Ö‚Õ¿Ö„",email:"Õ§Õ¬. Õ°Õ¡Õ½ÖÕ¥",url:"URL",emoji:"Õ§Õ´Õ¸Õ»Õ«",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Õ¡Õ´Õ½Õ¡Õ©Õ«Õ¾ Ö‡ ÕªÕ¡Õ´",date:"ISO Õ¡Õ´Õ½Õ¡Õ©Õ«Õ¾",time:"ISO ÕªÕ¡Õ´",duration:"ISO Õ¿Ö‡Õ¸Õ²Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶",ipv4:"IPv4 Õ°Õ¡Õ½ÖÕ¥",ipv6:"IPv6 Õ°Õ¡Õ½ÖÕ¥",cidrv4:"IPv4 Õ´Õ«Õ»Õ¡Õ¯Õ¡ÕµÖ„",cidrv6:"IPv6 Õ´Õ«Õ»Õ¡Õ¯Õ¡ÕµÖ„",base64:"base64 Õ±Ö‡Õ¡Õ¹Õ¡ÖƒÕ¸Õ¾ Õ¿Õ¸Õ²",base64url:"base64url Õ±Ö‡Õ¡Õ¹Õ¡ÖƒÕ¸Õ¾ Õ¿Õ¸Õ²",json_string:"JSON Õ¿Õ¸Õ²",e164:"E.164 Õ°Õ¡Õ´Õ¡Ö€",jwt:"JWT",template_literal:"Õ´Õ¸Ö‚Õ¿Ö„"},h={nan:"NaN",number:"Õ©Õ«Õ¾",array:"Õ¦Õ¡Õ¶Õ£Õ¾Õ¡Õ®"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§Ö€ instanceof ${l.expected}, Õ½Õ¿Õ¡ÖÕ¾Õ¥Õ¬ Õ§ ${s}`:`ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§Ö€ ${m}, Õ½Õ¿Õ¡ÖÕ¾Õ¥Õ¬ Õ§ ${s}`}case"invalid_value":return l.values.length===1?`ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§Ö€ ${vn(l.values[1])}`:`ÕÕ­Õ¡Õ¬ Õ¿Õ¡Ö€Õ¢Õ¥Ö€Õ¡Õ¯â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§Ö€ Õ°Õ¥Õ¿Ö‡ÕµÕ¡Õ¬Õ¶Õ¥Ö€Õ«Ö Õ´Õ¥Õ¯Õ¨Õ ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);if(x){let s=Number(l.maximum),P=TR(s,x.unit.one,x.unit.many);return`Õ‰Õ¡ÖƒÕ¡Õ¦Õ¡Õ¶Ö Õ´Õ¥Õ® Õ¡Ö€ÕªÕ¥Ö„â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§, Õ¸Ö€ ${Kf(l.origin??"Õ¡Ö€ÕªÕ¥Ö„")} Õ¯Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡ ${m}${l.maximum.toString()} ${P}`}return`Õ‰Õ¡ÖƒÕ¡Õ¦Õ¡Õ¶Ö Õ´Õ¥Õ® Õ¡Ö€ÕªÕ¥Ö„â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§, Õ¸Ö€ ${Kf(l.origin??"Õ¡Ö€ÕªÕ¥Ö„")} Õ¬Õ«Õ¶Õ« ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);if(x){let s=Number(l.minimum),P=TR(s,x.unit.one,x.unit.many);return`Õ‰Õ¡ÖƒÕ¡Õ¦Õ¡Õ¶Ö ÖƒÕ¸Ö„Ö€ Õ¡Ö€ÕªÕ¥Ö„â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§, Õ¸Ö€ ${Kf(l.origin)} Õ¯Õ¸Ö‚Õ¶Õ¥Õ¶Õ¡ ${m}${l.minimum.toString()} ${P}`}return`Õ‰Õ¡ÖƒÕ¡Õ¦Õ¡Õ¶Ö ÖƒÕ¸Ö„Ö€ Õ¡Ö€ÕªÕ¥Ö„â€¤ Õ½ÕºÕ¡Õ½Õ¾Õ¸Ö‚Õ´ Õ§, Õ¸Ö€ ${Kf(l.origin)} Õ¬Õ«Õ¶Õ« ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ÕÕ­Õ¡Õ¬ Õ¿Õ¸Õ²â€¤ ÕºÕ¥Õ¿Ö„ Õ§ Õ½Õ¯Õ½Õ¾Õ« "${m.prefix}"-Õ¸Õ¾`:m.format==="ends_with"?`ÕÕ­Õ¡Õ¬ Õ¿Õ¸Õ²â€¤ ÕºÕ¥Õ¿Ö„ Õ§ Õ¡Õ¾Õ¡Ö€Õ¿Õ¾Õ« "${m.suffix}"-Õ¸Õ¾`:m.format==="includes"?`ÕÕ­Õ¡Õ¬ Õ¿Õ¸Õ²â€¤ ÕºÕ¥Õ¿Ö„ Õ§ ÕºÕ¡Ö€Õ¸Ö‚Õ¶Õ¡Õ¯Õ« "${m.includes}"`:m.format==="regex"?`ÕÕ­Õ¡Õ¬ Õ¿Õ¸Õ²â€¤ ÕºÕ¥Õ¿Ö„ Õ§ Õ°Õ¡Õ´Õ¡ÕºÕ¡Õ¿Õ¡Õ½Õ­Õ¡Õ¶Õ« ${m.pattern} Õ±Ö‡Õ¡Õ¹Õ¡ÖƒÕ«Õ¶`:`ÕÕ­Õ¡Õ¬ ${o[m.format]??l.format}`}case"not_multiple_of":return`ÕÕ­Õ¡Õ¬ Õ©Õ«Õ¾â€¤ ÕºÕ¥Õ¿Ö„ Õ§ Õ¢Õ¡Õ¦Õ´Õ¡ÕºÕ¡Õ¿Õ«Õ¯ Õ¬Õ«Õ¶Õ« ${l.divisor}-Õ«`;case"unrecognized_keys":return`Õ‰Õ³Õ¡Õ¶Õ¡Õ¹Õ¾Õ¡Õ® Õ¢Õ¡Õ¶Õ¡Õ¬Õ«${l.keys.length>1?"Õ¶Õ¥Ö€":""}. ${si(l.keys,", ")}`;case"invalid_key":return`ÕÕ­Õ¡Õ¬ Õ¢Õ¡Õ¶Õ¡Õ¬Õ« ${Kf(l.origin)}-Õ¸Ö‚Õ´`;case"invalid_union":return"ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´";case"invalid_element":return`ÕÕ­Õ¡Õ¬ Õ¡Ö€ÕªÕ¥Ö„ ${Kf(l.origin)}-Õ¸Ö‚Õ´`;default:return"ÕÕ­Õ¡Õ¬ Õ´Õ¸Ö‚Õ¿Ö„Õ¡Õ£Ö€Õ¸Ö‚Õ´"}}};function m7(){return{localeError:p7()}}var g7=()=>{let i={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}};function e(l){return i[l]??null}let o={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Input tidak valid: diharapkan instanceof ${l.expected}, diterima ${s}`:`Input tidak valid: diharapkan ${m}, diterima ${s}`}case"invalid_value":return l.values.length===1?`Input tidak valid: diharapkan ${vn(l.values[0])}`:`Pilihan tidak valid: diharapkan salah satu dari ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Terlalu besar: diharapkan ${l.origin??"value"} memiliki ${m}${l.maximum.toString()} ${x.unit??"elemen"}`:`Terlalu besar: diharapkan ${l.origin??"value"} menjadi ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Terlalu kecil: diharapkan ${l.origin} memiliki ${m}${l.minimum.toString()} ${x.unit}`:`Terlalu kecil: diharapkan ${l.origin} menjadi ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`String tidak valid: harus dimulai dengan "${m.prefix}"`:m.format==="ends_with"?`String tidak valid: harus berakhir dengan "${m.suffix}"`:m.format==="includes"?`String tidak valid: harus menyertakan "${m.includes}"`:m.format==="regex"?`String tidak valid: harus sesuai pola ${m.pattern}`:`${o[m.format]??l.format} tidak valid`}case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${l.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${l.keys.length>1?"s":""}: ${si(l.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${l.origin}`;case"invalid_union":return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${l.origin}`;default:return"Input tidak valid"}}};function _7(){return{localeError:g7()}}var y7=()=>{let i={string:{unit:"stafi",verb:"aÃ° hafa"},file:{unit:"bÃ¦ti",verb:"aÃ° hafa"},array:{unit:"hluti",verb:"aÃ° hafa"},set:{unit:"hluti",verb:"aÃ° hafa"}};function e(l){return i[l]??null}let o={regex:"gildi",email:"netfang",url:"vefslÃ³Ã°",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dagsetning og tÃ­mi",date:"ISO dagsetning",time:"ISO tÃ­mi",duration:"ISO tÃ­malengd",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded strengur",base64url:"base64url-encoded strengur",json_string:"JSON strengur",e164:"E.164 tÃ¶lugildi",jwt:"JWT",template_literal:"gildi"},h={nan:"NaN",number:"nÃºmer",array:"fylki"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Rangt gildi: ÃžÃº slÃ³st inn ${s} Ã¾ar sem Ã¡ aÃ° vera instanceof ${l.expected}`:`Rangt gildi: ÃžÃº slÃ³st inn ${s} Ã¾ar sem Ã¡ aÃ° vera ${m}`}case"invalid_value":return l.values.length===1?`Rangt gildi: gert rÃ¡Ã° fyrir ${vn(l.values[0])}`:`Ã“gilt val: mÃ¡ vera eitt af eftirfarandi ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Of stÃ³rt: gert er rÃ¡Ã° fyrir aÃ° ${l.origin??"gildi"} hafi ${m}${l.maximum.toString()} ${x.unit??"hluti"}`:`Of stÃ³rt: gert er rÃ¡Ã° fyrir aÃ° ${l.origin??"gildi"} sÃ© ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Of lÃ­tiÃ°: gert er rÃ¡Ã° fyrir aÃ° ${l.origin} hafi ${m}${l.minimum.toString()} ${x.unit}`:`Of lÃ­tiÃ°: gert er rÃ¡Ã° fyrir aÃ° ${l.origin} sÃ© ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Ã“gildur strengur: verÃ°ur aÃ° byrja Ã¡ "${m.prefix}"`:m.format==="ends_with"?`Ã“gildur strengur: verÃ°ur aÃ° enda Ã¡ "${m.suffix}"`:m.format==="includes"?`Ã“gildur strengur: verÃ°ur aÃ° innihalda "${m.includes}"`:m.format==="regex"?`Ã“gildur strengur: verÃ°ur aÃ° fylgja mynstri ${m.pattern}`:`Rangt ${o[m.format]??l.format}`}case"not_multiple_of":return`RÃ¶ng tala: verÃ°ur aÃ° vera margfeldi af ${l.divisor}`;case"unrecognized_keys":return`Ã“Ã¾ekkt ${l.keys.length>1?"ir lyklar":"ur lykill"}: ${si(l.keys,", ")}`;case"invalid_key":return`Rangur lykill Ã­ ${l.origin}`;case"invalid_union":return"Rangt gildi";case"invalid_element":return`Rangt gildi Ã­ ${l.origin}`;default:return"Rangt gildi"}}};function v7(){return{localeError:y7()}}var x7=()=>{let i={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}};function e(l){return i[l]??null}let o={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"},h={nan:"NaN",number:"numero",array:"vettore"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Input non valido: atteso instanceof ${l.expected}, ricevuto ${s}`:`Input non valido: atteso ${m}, ricevuto ${s}`}case"invalid_value":return l.values.length===1?`Input non valido: atteso ${vn(l.values[0])}`:`Opzione non valida: atteso uno tra ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Troppo grande: ${l.origin??"valore"} deve avere ${m}${l.maximum.toString()} ${x.unit??"elementi"}`:`Troppo grande: ${l.origin??"valore"} deve essere ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Troppo piccolo: ${l.origin} deve avere ${m}${l.minimum.toString()} ${x.unit}`:`Troppo piccolo: ${l.origin} deve essere ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Stringa non valida: deve iniziare con "${m.prefix}"`:m.format==="ends_with"?`Stringa non valida: deve terminare con "${m.suffix}"`:m.format==="includes"?`Stringa non valida: deve includere "${m.includes}"`:m.format==="regex"?`Stringa non valida: deve corrispondere al pattern ${m.pattern}`:`Invalid ${o[m.format]??l.format}`}case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${l.divisor}`;case"unrecognized_keys":return`Chiav${l.keys.length>1?"i":"e"} non riconosciut${l.keys.length>1?"e":"a"}: ${si(l.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${l.origin}`;case"invalid_union":return"Input non valido";case"invalid_element":return`Valore non valido in ${l.origin}`;default:return"Input non valido"}}};function b7(){return{localeError:x7()}}var w7=()=>{let i={string:{unit:"æ–‡å­—",verb:"ã§ã‚ã‚‹"},file:{unit:"ãƒã‚¤ãƒˆ",verb:"ã§ã‚ã‚‹"},array:{unit:"è¦ç´ ",verb:"ã§ã‚ã‚‹"},set:{unit:"è¦ç´ ",verb:"ã§ã‚ã‚‹"}};function e(l){return i[l]??null}let o={regex:"å…¥åŠ›å€¤",email:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",url:"URL",emoji:"çµµæ–‡å­—",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISOæ—¥æ™‚",date:"ISOæ—¥ä»˜",time:"ISOæ™‚åˆ»",duration:"ISOæœŸé–“",ipv4:"IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹",ipv6:"IPv6ã‚¢ãƒ‰ãƒ¬ã‚¹",cidrv4:"IPv4ç¯„å›²",cidrv6:"IPv6ç¯„å›²",base64:"base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ–‡å­—åˆ—",base64url:"base64urlã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ–‡å­—åˆ—",json_string:"JSONæ–‡å­—åˆ—",e164:"E.164ç•ªå·",jwt:"JWT",template_literal:"å…¥åŠ›å€¤"},h={nan:"NaN",number:"æ•°å€¤",array:"é…åˆ—"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ç„¡åŠ¹ãªå…¥åŠ›: instanceof ${l.expected}ãŒæœŸå¾…ã•ã‚Œã¾ã—ãŸãŒã€${s}ãŒå…¥åŠ›ã•ã‚Œã¾ã—ãŸ`:`ç„¡åŠ¹ãªå…¥åŠ›: ${m}ãŒæœŸå¾…ã•ã‚Œã¾ã—ãŸãŒã€${s}ãŒå…¥åŠ›ã•ã‚Œã¾ã—ãŸ`}case"invalid_value":return l.values.length===1?`ç„¡åŠ¹ãªå…¥åŠ›: ${vn(l.values[0])}ãŒæœŸå¾…ã•ã‚Œã¾ã—ãŸ`:`ç„¡åŠ¹ãªé¸æŠž: ${si(l.values,"ã€")}ã®ã„ãšã‚Œã‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`;case"too_big":{let m=l.inclusive?"ä»¥ä¸‹ã§ã‚ã‚‹":"ã‚ˆã‚Šå°ã•ã„",x=e(l.origin);return x?`å¤§ãã™ãŽã‚‹å€¤: ${l.origin??"å€¤"}ã¯${l.maximum.toString()}${x.unit??"è¦ç´ "}${m}å¿…è¦ãŒã‚ã‚Šã¾ã™`:`å¤§ãã™ãŽã‚‹å€¤: ${l.origin??"å€¤"}ã¯${l.maximum.toString()}${m}å¿…è¦ãŒã‚ã‚Šã¾ã™`}case"too_small":{let m=l.inclusive?"ä»¥ä¸Šã§ã‚ã‚‹":"ã‚ˆã‚Šå¤§ãã„",x=e(l.origin);return x?`å°ã•ã™ãŽã‚‹å€¤: ${l.origin}ã¯${l.minimum.toString()}${x.unit}${m}å¿…è¦ãŒã‚ã‚Šã¾ã™`:`å°ã•ã™ãŽã‚‹å€¤: ${l.origin}ã¯${l.minimum.toString()}${m}å¿…è¦ãŒã‚ã‚Šã¾ã™`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ç„¡åŠ¹ãªæ–‡å­—åˆ—: "${m.prefix}"ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`:m.format==="ends_with"?`ç„¡åŠ¹ãªæ–‡å­—åˆ—: "${m.suffix}"ã§çµ‚ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`:m.format==="includes"?`ç„¡åŠ¹ãªæ–‡å­—åˆ—: "${m.includes}"ã‚’å«ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™`:m.format==="regex"?`ç„¡åŠ¹ãªæ–‡å­—åˆ—: ãƒ‘ã‚¿ãƒ¼ãƒ³${m.pattern}ã«ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`:`ç„¡åŠ¹ãª${o[m.format]??l.format}`}case"not_multiple_of":return`ç„¡åŠ¹ãªæ•°å€¤: ${l.divisor}ã®å€æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`;case"unrecognized_keys":return`èªè­˜ã•ã‚Œã¦ã„ãªã„ã‚­ãƒ¼${l.keys.length>1?"ç¾¤":""}: ${si(l.keys,"ã€")}`;case"invalid_key":return`${l.origin}å†…ã®ç„¡åŠ¹ãªã‚­ãƒ¼`;case"invalid_union":return"ç„¡åŠ¹ãªå…¥åŠ›";case"invalid_element":return`${l.origin}å†…ã®ç„¡åŠ¹ãªå€¤`;default:return"ç„¡åŠ¹ãªå…¥åŠ›"}}};function S7(){return{localeError:w7()}}var T7=()=>{let i={string:{unit:"áƒ¡áƒ˜áƒ›áƒ‘áƒáƒšáƒ",verb:"áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡"},file:{unit:"áƒ‘áƒáƒ˜áƒ¢áƒ˜",verb:"áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡"},array:{unit:"áƒ”áƒšáƒ”áƒ›áƒ”áƒœáƒ¢áƒ˜",verb:"áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡"},set:{unit:"áƒ”áƒšáƒ”áƒ›áƒ”áƒœáƒ¢áƒ˜",verb:"áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡"}};function e(l){return i[l]??null}let o={regex:"áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ",email:"áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜",url:"URL",emoji:"áƒ”áƒ›áƒáƒ¯áƒ˜",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜-áƒ“áƒ áƒ",date:"áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜",time:"áƒ“áƒ áƒ",duration:"áƒ®áƒáƒœáƒ’áƒ áƒ«áƒšáƒ˜áƒ•áƒáƒ‘áƒ",ipv4:"IPv4 áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜",ipv6:"IPv6 áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜",cidrv4:"IPv4 áƒ“áƒ˜áƒáƒžáƒáƒ–áƒáƒœáƒ˜",cidrv6:"IPv6 áƒ“áƒ˜áƒáƒžáƒáƒ–áƒáƒœáƒ˜",base64:"base64-áƒ™áƒáƒ“áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜",base64url:"base64url-áƒ™áƒáƒ“áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜",json_string:"JSON áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜",e164:"E.164 áƒœáƒáƒ›áƒ”áƒ áƒ˜",jwt:"JWT",template_literal:"áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ"},h={nan:"NaN",number:"áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜",string:"áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜",boolean:"áƒ‘áƒ£áƒšáƒ”áƒáƒœáƒ˜",function:"áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ",array:"áƒ›áƒáƒ¡áƒ˜áƒ•áƒ˜"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ instanceof ${l.expected}, áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ£áƒšáƒ˜ ${s}`:`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${m}, áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ£áƒšáƒ˜ ${s}`}case"invalid_value":return l.values.length===1?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${vn(l.values[0])}`:`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ•áƒáƒ áƒ˜áƒáƒœáƒ¢áƒ˜: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜áƒ áƒ”áƒ áƒ—-áƒ”áƒ áƒ—áƒ˜ ${si(l.values,"|")}-áƒ“áƒáƒœ`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`áƒ–áƒ”áƒ“áƒ›áƒ”áƒ¢áƒáƒ“ áƒ“áƒ˜áƒ“áƒ˜: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${l.origin??"áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ"} ${x.verb} ${m}${l.maximum.toString()} ${x.unit}`:`áƒ–áƒ”áƒ“áƒ›áƒ”áƒ¢áƒáƒ“ áƒ“áƒ˜áƒ“áƒ˜: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${l.origin??"áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ"} áƒ˜áƒ§áƒáƒ¡ ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`áƒ–áƒ”áƒ“áƒ›áƒ”áƒ¢áƒáƒ“ áƒžáƒáƒ¢áƒáƒ áƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${l.origin} ${x.verb} ${m}${l.minimum.toString()} ${x.unit}`:`áƒ–áƒ”áƒ“áƒ›áƒ”áƒ¢áƒáƒ“ áƒžáƒáƒ¢áƒáƒ áƒ: áƒ›áƒáƒ¡áƒáƒšáƒáƒ“áƒœáƒ”áƒšáƒ˜ ${l.origin} áƒ˜áƒ§áƒáƒ¡ ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜: áƒ£áƒœáƒ“áƒ áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒáƒ“áƒ”áƒ¡ "${m.prefix}"-áƒ˜áƒ—`:m.format==="ends_with"?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜: áƒ£áƒœáƒ“áƒ áƒ›áƒ—áƒáƒ•áƒ áƒ“áƒ”áƒ‘áƒáƒ“áƒ”áƒ¡ "${m.suffix}"-áƒ˜áƒ—`:m.format==="includes"?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜: áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡ "${m.includes}"-áƒ¡`:m.format==="regex"?`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¡áƒ¢áƒ áƒ˜áƒœáƒ’áƒ˜: áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ”áƒ¡áƒáƒ‘áƒáƒ›áƒ”áƒ‘áƒáƒ“áƒ”áƒ¡ áƒ¨áƒáƒ‘áƒšáƒáƒœáƒ¡ ${m.pattern}`:`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ ${o[m.format]??l.format}`}case"not_multiple_of":return`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜: áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ ${l.divisor}-áƒ˜áƒ¡ áƒ¯áƒ”áƒ áƒáƒ“áƒ˜`;case"unrecognized_keys":return`áƒ£áƒªáƒœáƒáƒ‘áƒ˜ áƒ’áƒáƒ¡áƒáƒ¦áƒ”áƒ‘${l.keys.length>1?"áƒ”áƒ‘áƒ˜":"áƒ˜"}: ${si(l.keys,", ")}`;case"invalid_key":return`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ’áƒáƒ¡áƒáƒ¦áƒ”áƒ‘áƒ˜ ${l.origin}-áƒ¨áƒ˜`;case"invalid_union":return"áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ";case"invalid_element":return`áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ ${l.origin}-áƒ¨áƒ˜`;default:return"áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ"}}};function E7(){return{localeError:T7()}}var I7=()=>{let i={string:{unit:"ážáž½áž¢áž€áŸ’ážŸážš",verb:"áž‚áž½ážšáž˜áž¶áž“"},file:{unit:"áž”áŸƒ",verb:"áž‚áž½ážšáž˜áž¶áž“"},array:{unit:"áž’áž¶ážáž»",verb:"áž‚áž½ážšáž˜áž¶áž“"},set:{unit:"áž’áž¶ážáž»",verb:"áž‚áž½ážšáž˜áž¶áž“"}};function e(l){return i[l]??null}let o={regex:"áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›",email:"áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“áž¢áŸŠáž¸áž˜áŸ‚áž›",url:"URL",emoji:"ážŸáž‰áŸ’áž‰áž¶áž¢áž¶ážšáž˜áŸ’áž˜ážŽáŸ",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"áž€áž¶áž›áž”ážšáž·áž…áŸ’áž†áŸáž‘ áž“áž·áž„áž˜áŸ‰áŸ„áž„ ISO",date:"áž€áž¶áž›áž”ážšáž·áž…áŸ’áž†áŸáž‘ ISO",time:"áž˜áŸ‰áŸ„áž„ ISO",duration:"ážšáž™áŸˆáž–áŸáž› ISO",ipv4:"áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“ IPv4",ipv6:"áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“ IPv6",cidrv4:"ážŠáŸ‚áž“áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“ IPv4",cidrv6:"ážŠáŸ‚áž“áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“ IPv6",base64:"ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž¢áŸŠáž·áž€áž¼ážŠ base64",base64url:"ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž¢áŸŠáž·áž€áž¼ážŠ base64url",json_string:"ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážš JSON",e164:"áž›áŸáž E.164",jwt:"JWT",template_literal:"áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›"},h={nan:"NaN",number:"áž›áŸáž",array:"áž¢áž¶ážšáŸ (Array)",null:"áž‚áŸ’áž˜áž¶áž“ážáž˜áŸ’áž›áŸƒ (null)"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš instanceof ${l.expected} áž”áŸ‰áž»áž“áŸ’ážáŸ‚áž‘áž‘áž½áž›áž”áž¶áž“ ${s}`:`áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${m} áž”áŸ‰áž»áž“áŸ’ážáŸ‚áž‘áž‘áž½áž›áž”áž¶áž“ ${s}`}case"invalid_value":return l.values.length===1?`áž‘áž·áž“áŸ’áž“áž“áŸáž™áž”áž‰áŸ’áž…áž¼áž›áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${vn(l.values[0])}`:`áž‡áž˜áŸ’ážšáž¾ážŸáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž‡áž¶áž˜áž½áž™áž€áŸ’áž“áž»áž„áž…áŸ†ážŽáŸ„áž˜ ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`áž’áŸ†áž–áŸáž€áŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${l.origin??"ážáž˜áŸ’áž›áŸƒ"} ${m} ${l.maximum.toString()} ${x.unit??"áž’áž¶ážáž»"}`:`áž’áŸ†áž–áŸáž€áŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${l.origin??"ážáž˜áŸ’áž›áŸƒ"} ${m} ${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`ážáž¼áž…áž–áŸáž€áŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${l.origin} ${m} ${l.minimum.toString()} ${x.unit}`:`ážáž¼áž…áž–áŸáž€áŸ– ážáŸ’ážšáž¼ážœáž€áž¶ážš ${l.origin} ${m} ${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž…áž¶áž”áŸ‹áž•áŸ’ážáž¾áž˜ážŠáŸ„áž™ "${m.prefix}"`:m.format==="ends_with"?`ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž”áž‰áŸ’áž…áž”áŸ‹ážŠáŸ„áž™ "${m.suffix}"`:m.format==="includes"?`ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœáž˜áž¶áž“ "${m.includes}"`:m.format==="regex"?`ážáŸ’ážŸáŸ‚áž¢áž€áŸ’ážŸážšáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœážáŸ‚áž•áŸ’áž‚áž¼áž•áŸ’áž‚áž„áž“áž¹áž„áž‘áž˜áŸ’ážšáž„áŸ‹ážŠáŸ‚áž›áž”áž¶áž“áž€áŸ†ážŽážáŸ‹ ${m.pattern}`:`áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ${o[m.format]??l.format}`}case"not_multiple_of":return`áž›áŸážáž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáŸ– ážáŸ’ážšáž¼ážœážáŸ‚áž‡áž¶áž–áž áž»áž‚áž»ážŽáž“áŸƒ ${l.divisor}`;case"unrecognized_keys":return`ážšáž€ážƒáž¾áž‰ážŸáŸ„áž˜áž·áž“ážŸáŸ’áž‚áž¶áž›áŸ‹áŸ– ${si(l.keys,", ")}`;case"invalid_key":return`ážŸáŸ„áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáž“áŸ…áž€áŸ’áž“áž»áž„ ${l.origin}`;case"invalid_union":return"áž‘áž·áž“áŸ’áž“áž“áŸáž™áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœ";case"invalid_element":return`áž‘áž·áž“áŸ’áž“áž“áŸáž™áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœáž“áŸ…áž€áŸ’áž“áž»áž„ ${l.origin}`;default:return"áž‘áž·áž“áŸ’áž“áž“áŸáž™áž˜áž·áž“ážáŸ’ážšáž¹áž˜ážáŸ’ážšáž¼ážœ"}}};function eO(){return{localeError:I7()}}function M7(){return eO()}var A7=()=>{let i={string:{unit:"ë¬¸ìž",verb:"to have"},file:{unit:"ë°”ì´íŠ¸",verb:"to have"},array:{unit:"ê°œ",verb:"to have"},set:{unit:"ê°œ",verb:"to have"}};function e(l){return i[l]??null}let o={regex:"ìž…ë ¥",email:"ì´ë©”ì¼ ì£¼ì†Œ",url:"URL",emoji:"ì´ëª¨ì§€",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ë‚ ì§œì‹œê°„",date:"ISO ë‚ ì§œ",time:"ISO ì‹œê°„",duration:"ISO ê¸°ê°„",ipv4:"IPv4 ì£¼ì†Œ",ipv6:"IPv6 ì£¼ì†Œ",cidrv4:"IPv4 ë²”ìœ„",cidrv6:"IPv6 ë²”ìœ„",base64:"base64 ì¸ì½”ë”© ë¬¸ìžì—´",base64url:"base64url ì¸ì½”ë”© ë¬¸ìžì—´",json_string:"JSON ë¬¸ìžì—´",e164:"E.164 ë²ˆí˜¸",jwt:"JWT",template_literal:"ìž…ë ¥"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ìž˜ëª»ëœ ìž…ë ¥: ì˜ˆìƒ íƒ€ìž…ì€ instanceof ${l.expected}, ë°›ì€ íƒ€ìž…ì€ ${s}ìž…ë‹ˆë‹¤`:`ìž˜ëª»ëœ ìž…ë ¥: ì˜ˆìƒ íƒ€ìž…ì€ ${m}, ë°›ì€ íƒ€ìž…ì€ ${s}ìž…ë‹ˆë‹¤`}case"invalid_value":return l.values.length===1?`ìž˜ëª»ëœ ìž…ë ¥: ê°’ì€ ${vn(l.values[0])} ì´ì–´ì•¼ í•©ë‹ˆë‹¤`:`ìž˜ëª»ëœ ì˜µì…˜: ${si(l.values,"ë˜ëŠ” ")} ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤`;case"too_big":{let m=l.inclusive?"ì´í•˜":"ë¯¸ë§Œ",x=m==="ë¯¸ë§Œ"?"ì´ì–´ì•¼ í•©ë‹ˆë‹¤":"ì—¬ì•¼ í•©ë‹ˆë‹¤",s=e(l.origin),P=(s==null?void 0:s.unit)??"ìš”ì†Œ";return s?`${l.origin??"ê°’"}ì´ ë„ˆë¬´ í½ë‹ˆë‹¤: ${l.maximum.toString()}${P} ${m}${x}`:`${l.origin??"ê°’"}ì´ ë„ˆë¬´ í½ë‹ˆë‹¤: ${l.maximum.toString()} ${m}${x}`}case"too_small":{let m=l.inclusive?"ì´ìƒ":"ì´ˆê³¼",x=m==="ì´ìƒ"?"ì´ì–´ì•¼ í•©ë‹ˆë‹¤":"ì—¬ì•¼ í•©ë‹ˆë‹¤",s=e(l.origin),P=(s==null?void 0:s.unit)??"ìš”ì†Œ";return s?`${l.origin??"ê°’"}ì´ ë„ˆë¬´ ìž‘ìŠµë‹ˆë‹¤: ${l.minimum.toString()}${P} ${m}${x}`:`${l.origin??"ê°’"}ì´ ë„ˆë¬´ ìž‘ìŠµë‹ˆë‹¤: ${l.minimum.toString()} ${m}${x}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ìž˜ëª»ëœ ë¬¸ìžì—´: "${m.prefix}"(ìœ¼)ë¡œ ì‹œìž‘í•´ì•¼ í•©ë‹ˆë‹¤`:m.format==="ends_with"?`ìž˜ëª»ëœ ë¬¸ìžì—´: "${m.suffix}"(ìœ¼)ë¡œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤`:m.format==="includes"?`ìž˜ëª»ëœ ë¬¸ìžì—´: "${m.includes}"ì„(ë¥¼) í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤`:m.format==="regex"?`ìž˜ëª»ëœ ë¬¸ìžì—´: ì •ê·œì‹ ${m.pattern} íŒ¨í„´ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤`:`ìž˜ëª»ëœ ${o[m.format]??l.format}`}case"not_multiple_of":return`ìž˜ëª»ëœ ìˆ«ìž: ${l.divisor}ì˜ ë°°ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤`;case"unrecognized_keys":return`ì¸ì‹í•  ìˆ˜ ì—†ëŠ” í‚¤: ${si(l.keys,", ")}`;case"invalid_key":return`ìž˜ëª»ëœ í‚¤: ${l.origin}`;case"invalid_union":return"ìž˜ëª»ëœ ìž…ë ¥";case"invalid_element":return`ìž˜ëª»ëœ ê°’: ${l.origin}`;default:return"ìž˜ëª»ëœ ìž…ë ¥"}}};function P7(){return{localeError:A7()}}var c_=i=>i.charAt(0).toUpperCase()+i.slice(1);function ER(i){let e=Math.abs(i),o=e%10,h=e%100;return h>=11&&h<=19||o===0?"many":o===1?"one":"few"}var z7=()=>{let i={string:{unit:{one:"simbolis",few:"simboliai",many:"simboliÅ³"},verb:{smaller:{inclusive:"turi bÅ«ti ne ilgesnÄ— kaip",notInclusive:"turi bÅ«ti trumpesnÄ— kaip"},bigger:{inclusive:"turi bÅ«ti ne trumpesnÄ— kaip",notInclusive:"turi bÅ«ti ilgesnÄ— kaip"}}},file:{unit:{one:"baitas",few:"baitai",many:"baitÅ³"},verb:{smaller:{inclusive:"turi bÅ«ti ne didesnis kaip",notInclusive:"turi bÅ«ti maÅ¾esnis kaip"},bigger:{inclusive:"turi bÅ«ti ne maÅ¾esnis kaip",notInclusive:"turi bÅ«ti didesnis kaip"}}},array:{unit:{one:"elementÄ…",few:"elementus",many:"elementÅ³"},verb:{smaller:{inclusive:"turi turÄ—ti ne daugiau kaip",notInclusive:"turi turÄ—ti maÅ¾iau kaip"},bigger:{inclusive:"turi turÄ—ti ne maÅ¾iau kaip",notInclusive:"turi turÄ—ti daugiau kaip"}}},set:{unit:{one:"elementÄ…",few:"elementus",many:"elementÅ³"},verb:{smaller:{inclusive:"turi turÄ—ti ne daugiau kaip",notInclusive:"turi turÄ—ti maÅ¾iau kaip"},bigger:{inclusive:"turi turÄ—ti ne maÅ¾iau kaip",notInclusive:"turi turÄ—ti daugiau kaip"}}}};function e(l,m,x,s){let P=i[l]??null;return P===null?P:{unit:P.unit[m],verb:P.verb[s][x?"inclusive":"notInclusive"]}}let o={regex:"Ä¯vestis",email:"el. paÅ¡to adresas",url:"URL",emoji:"jaustukas",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO data ir laikas",date:"ISO data",time:"ISO laikas",duration:"ISO trukmÄ—",ipv4:"IPv4 adresas",ipv6:"IPv6 adresas",cidrv4:"IPv4 tinklo prefiksas (CIDR)",cidrv6:"IPv6 tinklo prefiksas (CIDR)",base64:"base64 uÅ¾koduota eilutÄ—",base64url:"base64url uÅ¾koduota eilutÄ—",json_string:"JSON eilutÄ—",e164:"E.164 numeris",jwt:"JWT",template_literal:"Ä¯vestis"},h={nan:"NaN",number:"skaiÄius",bigint:"sveikasis skaiÄius",string:"eilutÄ—",boolean:"loginÄ— reikÅ¡mÄ—",undefined:"neapibrÄ—Å¾ta reikÅ¡mÄ—",function:"funkcija",symbol:"simbolis",array:"masyvas",object:"objektas",null:"nulinÄ— reikÅ¡mÄ—"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Gautas tipas ${s}, o tikÄ—tasi - instanceof ${l.expected}`:`Gautas tipas ${s}, o tikÄ—tasi - ${m}`}case"invalid_value":return l.values.length===1?`Privalo bÅ«ti ${vn(l.values[0])}`:`Privalo bÅ«ti vienas iÅ¡ ${si(l.values,"|")} pasirinkimÅ³`;case"too_big":{let m=h[l.origin]??l.origin,x=e(l.origin,ER(Number(l.maximum)),l.inclusive??!1,"smaller");if(x!=null&&x.verb)return`${c_(m??l.origin??"reikÅ¡mÄ—")} ${x.verb} ${l.maximum.toString()} ${x.unit??"elementÅ³"}`;let s=l.inclusive?"ne didesnis kaip":"maÅ¾esnis kaip";return`${c_(m??l.origin??"reikÅ¡mÄ—")} turi bÅ«ti ${s} ${l.maximum.toString()} ${x==null?void 0:x.unit}`}case"too_small":{let m=h[l.origin]??l.origin,x=e(l.origin,ER(Number(l.minimum)),l.inclusive??!1,"bigger");if(x!=null&&x.verb)return`${c_(m??l.origin??"reikÅ¡mÄ—")} ${x.verb} ${l.minimum.toString()} ${x.unit??"elementÅ³"}`;let s=l.inclusive?"ne maÅ¾esnis kaip":"didesnis kaip";return`${c_(m??l.origin??"reikÅ¡mÄ—")} turi bÅ«ti ${s} ${l.minimum.toString()} ${x==null?void 0:x.unit}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`EilutÄ— privalo prasidÄ—ti "${m.prefix}"`:m.format==="ends_with"?`EilutÄ— privalo pasibaigti "${m.suffix}"`:m.format==="includes"?`EilutÄ— privalo Ä¯traukti "${m.includes}"`:m.format==="regex"?`EilutÄ— privalo atitikti ${m.pattern}`:`Neteisingas ${o[m.format]??l.format}`}case"not_multiple_of":return`SkaiÄius privalo bÅ«ti ${l.divisor} kartotinis.`;case"unrecognized_keys":return`NeatpaÅ¾int${l.keys.length>1?"i":"as"} rakt${l.keys.length>1?"ai":"as"}: ${si(l.keys,", ")}`;case"invalid_key":return"Rastas klaidingas raktas";case"invalid_union":return"Klaidinga Ä¯vestis";case"invalid_element":{let m=h[l.origin]??l.origin;return`${c_(m??l.origin??"reikÅ¡mÄ—")} turi klaidingÄ… Ä¯vestÄ¯`}default:return"Klaidinga Ä¯vestis"}}};function C7(){return{localeError:z7()}}var R7=()=>{let i={string:{unit:"Ð·Ð½Ð°Ñ†Ð¸",verb:"Ð´Ð° Ð¸Ð¼Ð°Ð°Ñ‚"},file:{unit:"Ð±Ð°Ñ˜Ñ‚Ð¸",verb:"Ð´Ð° Ð¸Ð¼Ð°Ð°Ñ‚"},array:{unit:"ÑÑ‚Ð°Ð²ÐºÐ¸",verb:"Ð´Ð° Ð¸Ð¼Ð°Ð°Ñ‚"},set:{unit:"ÑÑ‚Ð°Ð²ÐºÐ¸",verb:"Ð´Ð° Ð¸Ð¼Ð°Ð°Ñ‚"}};function e(l){return i[l]??null}let o={regex:"Ð²Ð½ÐµÑ",email:"Ð°Ð´Ñ€ÐµÑÐ° Ð½Ð° Ðµ-Ð¿Ð¾ÑˆÑ‚Ð°",url:"URL",emoji:"ÐµÐ¼Ð¾ÑŸÐ¸",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Ð´Ð°Ñ‚ÑƒÐ¼ Ð¸ Ð²Ñ€ÐµÐ¼Ðµ",date:"ISO Ð´Ð°Ñ‚ÑƒÐ¼",time:"ISO Ð²Ñ€ÐµÐ¼Ðµ",duration:"ISO Ð²Ñ€ÐµÐ¼ÐµÑ‚Ñ€Ð°ÐµÑšÐµ",ipv4:"IPv4 Ð°Ð´Ñ€ÐµÑÐ°",ipv6:"IPv6 Ð°Ð´Ñ€ÐµÑÐ°",cidrv4:"IPv4 Ð¾Ð¿ÑÐµÐ³",cidrv6:"IPv6 Ð¾Ð¿ÑÐµÐ³",base64:"base64-ÐµÐ½ÐºÐ¾Ð´Ð¸Ñ€Ð°Ð½Ð° Ð½Ð¸Ð·Ð°",base64url:"base64url-ÐµÐ½ÐºÐ¾Ð´Ð¸Ñ€Ð°Ð½Ð° Ð½Ð¸Ð·Ð°",json_string:"JSON Ð½Ð¸Ð·Ð°",e164:"E.164 Ð±Ñ€Ð¾Ñ˜",jwt:"JWT",template_literal:"Ð²Ð½ÐµÑ"},h={nan:"NaN",number:"Ð±Ñ€Ð¾Ñ˜",array:"Ð½Ð¸Ð·Ð°"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ð“Ñ€ÐµÑˆÐµÐ½ Ð²Ð½ÐµÑ: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° instanceof ${l.expected}, Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¾ ${s}`:`Ð“Ñ€ÐµÑˆÐµÐ½ Ð²Ð½ÐµÑ: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${m}, Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¾ ${s}`}case"invalid_value":return l.values.length===1?`Invalid input: expected ${vn(l.values[0])}`:`Ð“Ñ€ÐµÑˆÐ°Ð½Ð° Ð¾Ð¿Ñ†Ð¸Ñ˜Ð°: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ÐµÐ´Ð½Ð° ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`ÐŸÑ€ÐµÐ¼Ð½Ð¾Ð³Ñƒ Ð³Ð¾Ð»ÐµÐ¼: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${l.origin??"Ð²Ñ€ÐµÐ´Ð½Ð¾ÑÑ‚Ð°"} Ð´Ð° Ð¸Ð¼Ð° ${m}${l.maximum.toString()} ${x.unit??"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¸"}`:`ÐŸÑ€ÐµÐ¼Ð½Ð¾Ð³Ñƒ Ð³Ð¾Ð»ÐµÐ¼: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${l.origin??"Ð²Ñ€ÐµÐ´Ð½Ð¾ÑÑ‚Ð°"} Ð´Ð° Ð±Ð¸Ð´Ðµ ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`ÐŸÑ€ÐµÐ¼Ð½Ð¾Ð³Ñƒ Ð¼Ð°Ð»: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${l.origin} Ð´Ð° Ð¸Ð¼Ð° ${m}${l.minimum.toString()} ${x.unit}`:`ÐŸÑ€ÐµÐ¼Ð½Ð¾Ð³Ñƒ Ð¼Ð°Ð»: ÑÐµ Ð¾Ñ‡ÐµÐºÑƒÐ²Ð° ${l.origin} Ð´Ð° Ð±Ð¸Ð´Ðµ ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ÐÐµÐ²Ð°Ð¶ÐµÑ‡ÐºÐ° Ð½Ð¸Ð·Ð°: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð·Ð°Ð¿Ð¾Ñ‡Ð½ÑƒÐ²Ð° ÑÐ¾ "${m.prefix}"`:m.format==="ends_with"?`ÐÐµÐ²Ð°Ð¶ÐµÑ‡ÐºÐ° Ð½Ð¸Ð·Ð°: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð·Ð°Ð²Ñ€ÑˆÑƒÐ²Ð° ÑÐ¾ "${m.suffix}"`:m.format==="includes"?`ÐÐµÐ²Ð°Ð¶ÐµÑ‡ÐºÐ° Ð½Ð¸Ð·Ð°: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð²ÐºÐ»ÑƒÑ‡ÑƒÐ²Ð° "${m.includes}"`:m.format==="regex"?`ÐÐµÐ²Ð°Ð¶ÐµÑ‡ÐºÐ° Ð½Ð¸Ð·Ð°: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð¾Ð´Ð³Ð¾Ð°Ñ€Ð° Ð½Ð° Ð¿Ð°Ñ‚ÐµÑ€Ð½Ð¾Ñ‚ ${m.pattern}`:`Invalid ${o[m.format]??l.format}`}case"not_multiple_of":return`Ð“Ñ€ÐµÑˆÐµÐ½ Ð±Ñ€Ð¾Ñ˜: Ð¼Ð¾Ñ€Ð° Ð´Ð° Ð±Ð¸Ð´Ðµ Ð´ÐµÐ»Ð¸Ð² ÑÐ¾ ${l.divisor}`;case"unrecognized_keys":return`${l.keys.length>1?"ÐÐµÐ¿Ñ€ÐµÐ¿Ð¾Ð·Ð½Ð°ÐµÐ½Ð¸ ÐºÐ»ÑƒÑ‡ÐµÐ²Ð¸":"ÐÐµÐ¿Ñ€ÐµÐ¿Ð¾Ð·Ð½Ð°ÐµÐ½ ÐºÐ»ÑƒÑ‡"}: ${si(l.keys,", ")}`;case"invalid_key":return`Ð“Ñ€ÐµÑˆÐµÐ½ ÐºÐ»ÑƒÑ‡ Ð²Ð¾ ${l.origin}`;case"invalid_union":return"Ð“Ñ€ÐµÑˆÐµÐ½ Ð²Ð½ÐµÑ";case"invalid_element":return`Ð“Ñ€ÐµÑˆÐ½Ð° Ð²Ñ€ÐµÐ´Ð½Ð¾ÑÑ‚ Ð²Ð¾ ${l.origin}`;default:return"Ð“Ñ€ÐµÑˆÐµÐ½ Ð²Ð½ÐµÑ"}}};function L7(){return{localeError:R7()}}var D7=()=>{let i={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}};function e(l){return i[l]??null}let o={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"},h={nan:"NaN",number:"nombor"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Input tidak sah: dijangka instanceof ${l.expected}, diterima ${s}`:`Input tidak sah: dijangka ${m}, diterima ${s}`}case"invalid_value":return l.values.length===1?`Input tidak sah: dijangka ${vn(l.values[0])}`:`Pilihan tidak sah: dijangka salah satu daripada ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Terlalu besar: dijangka ${l.origin??"nilai"} ${x.verb} ${m}${l.maximum.toString()} ${x.unit??"elemen"}`:`Terlalu besar: dijangka ${l.origin??"nilai"} adalah ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Terlalu kecil: dijangka ${l.origin} ${x.verb} ${m}${l.minimum.toString()} ${x.unit}`:`Terlalu kecil: dijangka ${l.origin} adalah ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`String tidak sah: mesti bermula dengan "${m.prefix}"`:m.format==="ends_with"?`String tidak sah: mesti berakhir dengan "${m.suffix}"`:m.format==="includes"?`String tidak sah: mesti mengandungi "${m.includes}"`:m.format==="regex"?`String tidak sah: mesti sepadan dengan corak ${m.pattern}`:`${o[m.format]??l.format} tidak sah`}case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${l.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${si(l.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${l.origin}`;case"invalid_union":return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${l.origin}`;default:return"Input tidak sah"}}};function k7(){return{localeError:D7()}}var O7=()=>{let i={string:{unit:"tekens",verb:"heeft"},file:{unit:"bytes",verb:"heeft"},array:{unit:"elementen",verb:"heeft"},set:{unit:"elementen",verb:"heeft"}};function e(l){return i[l]??null}let o={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"},h={nan:"NaN",number:"getal"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ongeldige invoer: verwacht instanceof ${l.expected}, ontving ${s}`:`Ongeldige invoer: verwacht ${m}, ontving ${s}`}case"invalid_value":return l.values.length===1?`Ongeldige invoer: verwacht ${vn(l.values[0])}`:`Ongeldige optie: verwacht Ã©Ã©n van ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin),s=l.origin==="date"?"laat":l.origin==="string"?"lang":"groot";return x?`Te ${s}: verwacht dat ${l.origin??"waarde"} ${m}${l.maximum.toString()} ${x.unit??"elementen"} ${x.verb}`:`Te ${s}: verwacht dat ${l.origin??"waarde"} ${m}${l.maximum.toString()} is`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin),s=l.origin==="date"?"vroeg":l.origin==="string"?"kort":"klein";return x?`Te ${s}: verwacht dat ${l.origin} ${m}${l.minimum.toString()} ${x.unit} ${x.verb}`:`Te ${s}: verwacht dat ${l.origin} ${m}${l.minimum.toString()} is`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Ongeldige tekst: moet met "${m.prefix}" beginnen`:m.format==="ends_with"?`Ongeldige tekst: moet op "${m.suffix}" eindigen`:m.format==="includes"?`Ongeldige tekst: moet "${m.includes}" bevatten`:m.format==="regex"?`Ongeldige tekst: moet overeenkomen met patroon ${m.pattern}`:`Ongeldig: ${o[m.format]??l.format}`}case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${l.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${l.keys.length>1?"s":""}: ${si(l.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${l.origin}`;case"invalid_union":return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${l.origin}`;default:return"Ongeldige invoer"}}};function F7(){return{localeError:O7()}}var B7=()=>{let i={string:{unit:"tegn",verb:"Ã¥ ha"},file:{unit:"bytes",verb:"Ã¥ ha"},array:{unit:"elementer",verb:"Ã¥ inneholde"},set:{unit:"elementer",verb:"Ã¥ inneholde"}};function e(l){return i[l]??null}let o={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omrÃ¥de",ipv6:"IPv6-omrÃ¥de",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},h={nan:"NaN",number:"tall",array:"liste"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ugyldig input: forventet instanceof ${l.expected}, fikk ${s}`:`Ugyldig input: forventet ${m}, fikk ${s}`}case"invalid_value":return l.values.length===1?`Ugyldig verdi: forventet ${vn(l.values[0])}`:`Ugyldig valg: forventet en av ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`For stor(t): forventet ${l.origin??"value"} til Ã¥ ha ${m}${l.maximum.toString()} ${x.unit??"elementer"}`:`For stor(t): forventet ${l.origin??"value"} til Ã¥ ha ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`For lite(n): forventet ${l.origin} til Ã¥ ha ${m}${l.minimum.toString()} ${x.unit}`:`For lite(n): forventet ${l.origin} til Ã¥ ha ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Ugyldig streng: mÃ¥ starte med "${m.prefix}"`:m.format==="ends_with"?`Ugyldig streng: mÃ¥ ende med "${m.suffix}"`:m.format==="includes"?`Ugyldig streng: mÃ¥ inneholde "${m.includes}"`:m.format==="regex"?`Ugyldig streng: mÃ¥ matche mÃ¸nsteret ${m.pattern}`:`Ugyldig ${o[m.format]??l.format}`}case"not_multiple_of":return`Ugyldig tall: mÃ¥ vÃ¦re et multiplum av ${l.divisor}`;case"unrecognized_keys":return`${l.keys.length>1?"Ukjente nÃ¸kler":"Ukjent nÃ¸kkel"}: ${si(l.keys,", ")}`;case"invalid_key":return`Ugyldig nÃ¸kkel i ${l.origin}`;case"invalid_union":return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${l.origin}`;default:return"Ugyldig input"}}};function N7(){return{localeError:B7()}}var U7=()=>{let i={string:{unit:"harf",verb:"olmalÄ±dÄ±r"},file:{unit:"bayt",verb:"olmalÄ±dÄ±r"},array:{unit:"unsur",verb:"olmalÄ±dÄ±r"},set:{unit:"unsur",verb:"olmalÄ±dÄ±r"}};function e(l){return i[l]??null}let o={regex:"giren",email:"epostagÃ¢h",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO hengÃ¢mÄ±",date:"ISO tarihi",time:"ISO zamanÄ±",duration:"ISO mÃ¼ddeti",ipv4:"IPv4 niÅŸÃ¢nÄ±",ipv6:"IPv6 niÅŸÃ¢nÄ±",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-ÅŸifreli metin",base64url:"base64url-ÅŸifreli metin",json_string:"JSON metin",e164:"E.164 sayÄ±sÄ±",jwt:"JWT",template_literal:"giren"},h={nan:"NaN",number:"numara",array:"saf",null:"gayb"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`FÃ¢sit giren: umulan instanceof ${l.expected}, alÄ±nan ${s}`:`FÃ¢sit giren: umulan ${m}, alÄ±nan ${s}`}case"invalid_value":return l.values.length===1?`FÃ¢sit giren: umulan ${vn(l.values[0])}`:`FÃ¢sit tercih: mÃ»teberler ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Fazla bÃ¼yÃ¼k: ${l.origin??"value"}, ${m}${l.maximum.toString()} ${x.unit??"elements"} sahip olmalÄ±ydÄ±.`:`Fazla bÃ¼yÃ¼k: ${l.origin??"value"}, ${m}${l.maximum.toString()} olmalÄ±ydÄ±.`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Fazla kÃ¼Ã§Ã¼k: ${l.origin}, ${m}${l.minimum.toString()} ${x.unit} sahip olmalÄ±ydÄ±.`:`Fazla kÃ¼Ã§Ã¼k: ${l.origin}, ${m}${l.minimum.toString()} olmalÄ±ydÄ±.`}case"invalid_format":{let m=l;return m.format==="starts_with"?`FÃ¢sit metin: "${m.prefix}" ile baÅŸlamalÄ±.`:m.format==="ends_with"?`FÃ¢sit metin: "${m.suffix}" ile bitmeli.`:m.format==="includes"?`FÃ¢sit metin: "${m.includes}" ihtivÃ¢ etmeli.`:m.format==="regex"?`FÃ¢sit metin: ${m.pattern} nakÅŸÄ±na uymalÄ±.`:`FÃ¢sit ${o[m.format]??l.format}`}case"not_multiple_of":return`FÃ¢sit sayÄ±: ${l.divisor} katÄ± olmalÄ±ydÄ±.`;case"unrecognized_keys":return`TanÄ±nmayan anahtar ${l.keys.length>1?"s":""}: ${si(l.keys,", ")}`;case"invalid_key":return`${l.origin} iÃ§in tanÄ±nmayan anahtar var.`;case"invalid_union":return"Giren tanÄ±namadÄ±.";case"invalid_element":return`${l.origin} iÃ§in tanÄ±nmayan kÄ±ymet var.`;default:return"KÄ±ymet tanÄ±namadÄ±."}}};function $7(){return{localeError:U7()}}var V7=()=>{let i={string:{unit:"ØªÙˆÚ©ÙŠ",verb:"ÙˆÙ„Ø±ÙŠ"},file:{unit:"Ø¨Ø§ÛŒÙ¼Ø³",verb:"ÙˆÙ„Ø±ÙŠ"},array:{unit:"ØªÙˆÚ©ÙŠ",verb:"ÙˆÙ„Ø±ÙŠ"},set:{unit:"ØªÙˆÚ©ÙŠ",verb:"ÙˆÙ„Ø±ÙŠ"}};function e(l){return i[l]??null}let o={regex:"ÙˆØ±ÙˆØ¯ÙŠ",email:"Ø¨Ø±ÛŒÚšÙ†Ø§Ù„ÛŒÚ©",url:"ÛŒÙˆ Ø¢Ø± Ø§Ù„",emoji:"Ø§ÛŒÙ…ÙˆØ¬ÙŠ",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"Ù†ÛŒÙ¼Ù‡ Ø§Ùˆ ÙˆØ®Øª",date:"Ù†ÛÙ¼Ù‡",time:"ÙˆØ®Øª",duration:"Ù…ÙˆØ¯Ù‡",ipv4:"Ø¯ IPv4 Ù¾ØªÙ‡",ipv6:"Ø¯ IPv6 Ù¾ØªÙ‡",cidrv4:"Ø¯ IPv4 Ø³Ø§Ø­Ù‡",cidrv6:"Ø¯ IPv6 Ø³Ø§Ø­Ù‡",base64:"base64-encoded Ù…ØªÙ†",base64url:"base64url-encoded Ù…ØªÙ†",json_string:"JSON Ù…ØªÙ†",e164:"Ø¯ E.164 Ø´Ù…ÛØ±Ù‡",jwt:"JWT",template_literal:"ÙˆØ±ÙˆØ¯ÙŠ"},h={nan:"NaN",number:"Ø¹Ø¯Ø¯",array:"Ø§Ø±Û"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ù†Ø§Ø³Ù… ÙˆØ±ÙˆØ¯ÙŠ: Ø¨Ø§ÛŒØ¯ instanceof ${l.expected} ÙˆØ§ÛŒ, Ù…Ú«Ø± ${s} ØªØ±Ù„Ø§Ø³Ù‡ Ø´Ùˆ`:`Ù†Ø§Ø³Ù… ÙˆØ±ÙˆØ¯ÙŠ: Ø¨Ø§ÛŒØ¯ ${m} ÙˆØ§ÛŒ, Ù…Ú«Ø± ${s} ØªØ±Ù„Ø§Ø³Ù‡ Ø´Ùˆ`}case"invalid_value":return l.values.length===1?`Ù†Ø§Ø³Ù… ÙˆØ±ÙˆØ¯ÙŠ: Ø¨Ø§ÛŒØ¯ ${vn(l.values[0])} ÙˆØ§ÛŒ`:`Ù†Ø§Ø³Ù… Ø§Ù†ØªØ®Ø§Ø¨: Ø¨Ø§ÛŒØ¯ ÛŒÙˆ Ù„Ù‡ ${si(l.values,"|")} Ú…Ø®Ù‡ ÙˆØ§ÛŒ`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ú‰ÛŒØ± Ù„ÙˆÛŒ: ${l.origin??"Ø§Ø±Ø²ÚšØª"} Ø¨Ø§ÛŒØ¯ ${m}${l.maximum.toString()} ${x.unit??"Ø¹Ù†ØµØ±ÙˆÙ†Ù‡"} ÙˆÙ„Ø±ÙŠ`:`Ú‰ÛŒØ± Ù„ÙˆÛŒ: ${l.origin??"Ø§Ø±Ø²ÚšØª"} Ø¨Ø§ÛŒØ¯ ${m}${l.maximum.toString()} ÙˆÙŠ`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Ú‰ÛŒØ± Ú©ÙˆÚ†Ù†ÛŒ: ${l.origin} Ø¨Ø§ÛŒØ¯ ${m}${l.minimum.toString()} ${x.unit} ÙˆÙ„Ø±ÙŠ`:`Ú‰ÛŒØ± Ú©ÙˆÚ†Ù†ÛŒ: ${l.origin} Ø¨Ø§ÛŒØ¯ ${m}${l.minimum.toString()} ÙˆÙŠ`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Ù†Ø§Ø³Ù… Ù…ØªÙ†: Ø¨Ø§ÛŒØ¯ Ø¯ "${m.prefix}" Ø³Ø±Ù‡ Ù¾ÛŒÙ„ Ø´ÙŠ`:m.format==="ends_with"?`Ù†Ø§Ø³Ù… Ù…ØªÙ†: Ø¨Ø§ÛŒØ¯ Ø¯ "${m.suffix}" Ø³Ø±Ù‡ Ù¾Ø§ÛŒ ØªÙ‡ ÙˆØ±Ø³ÙŠÚ–ÙŠ`:m.format==="includes"?`Ù†Ø§Ø³Ù… Ù…ØªÙ†: Ø¨Ø§ÛŒØ¯ "${m.includes}" ÙˆÙ„Ø±ÙŠ`:m.format==="regex"?`Ù†Ø§Ø³Ù… Ù…ØªÙ†: Ø¨Ø§ÛŒØ¯ Ø¯ ${m.pattern} Ø³Ø±Ù‡ Ù…Ø·Ø§Ø¨Ù‚Øª ÙˆÙ„Ø±ÙŠ`:`${o[m.format]??l.format} Ù†Ø§Ø³Ù… Ø¯ÛŒ`}case"not_multiple_of":return`Ù†Ø§Ø³Ù… Ø¹Ø¯Ø¯: Ø¨Ø§ÛŒØ¯ Ø¯ ${l.divisor} Ù…Ø¶Ø±Ø¨ ÙˆÙŠ`;case"unrecognized_keys":return`Ù†Ø§Ø³Ù… ${l.keys.length>1?"Ú©Ù„ÛŒÚ‰ÙˆÙ†Ù‡":"Ú©Ù„ÛŒÚ‰"}: ${si(l.keys,", ")}`;case"invalid_key":return`Ù†Ø§Ø³Ù… Ú©Ù„ÛŒÚ‰ Ù¾Ù‡ ${l.origin} Ú©Û`;case"invalid_union":return"Ù†Ø§Ø³Ù…Ù‡ ÙˆØ±ÙˆØ¯ÙŠ";case"invalid_element":return`Ù†Ø§Ø³Ù… Ø¹Ù†ØµØ± Ù¾Ù‡ ${l.origin} Ú©Û`;default:return"Ù†Ø§Ø³Ù…Ù‡ ÙˆØ±ÙˆØ¯ÙŠ"}}};function j7(){return{localeError:V7()}}var G7=()=>{let i={string:{unit:"znakÃ³w",verb:"mieÄ‡"},file:{unit:"bajtÃ³w",verb:"mieÄ‡"},array:{unit:"elementÃ³w",verb:"mieÄ‡"},set:{unit:"elementÃ³w",verb:"mieÄ‡"}};function e(l){return i[l]??null}let o={regex:"wyraÅ¼enie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"ciÄ…g znakÃ³w zakodowany w formacie base64",base64url:"ciÄ…g znakÃ³w zakodowany w formacie base64url",json_string:"ciÄ…g znakÃ³w w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wejÅ›cie"},h={nan:"NaN",number:"liczba",array:"tablica"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`NieprawidÅ‚owe dane wejÅ›ciowe: oczekiwano instanceof ${l.expected}, otrzymano ${s}`:`NieprawidÅ‚owe dane wejÅ›ciowe: oczekiwano ${m}, otrzymano ${s}`}case"invalid_value":return l.values.length===1?`NieprawidÅ‚owe dane wejÅ›ciowe: oczekiwano ${vn(l.values[0])}`:`NieprawidÅ‚owa opcja: oczekiwano jednej z wartoÅ›ci ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Za duÅ¼a wartoÅ›Ä‡: oczekiwano, Å¼e ${l.origin??"wartoÅ›Ä‡"} bÄ™dzie mieÄ‡ ${m}${l.maximum.toString()} ${x.unit??"elementÃ³w"}`:`Zbyt duÅ¼(y/a/e): oczekiwano, Å¼e ${l.origin??"wartoÅ›Ä‡"} bÄ™dzie wynosiÄ‡ ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Za maÅ‚a wartoÅ›Ä‡: oczekiwano, Å¼e ${l.origin??"wartoÅ›Ä‡"} bÄ™dzie mieÄ‡ ${m}${l.minimum.toString()} ${x.unit??"elementÃ³w"}`:`Zbyt maÅ‚(y/a/e): oczekiwano, Å¼e ${l.origin??"wartoÅ›Ä‡"} bÄ™dzie wynosiÄ‡ ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`NieprawidÅ‚owy ciÄ…g znakÃ³w: musi zaczynaÄ‡ siÄ™ od "${m.prefix}"`:m.format==="ends_with"?`NieprawidÅ‚owy ciÄ…g znakÃ³w: musi koÅ„czyÄ‡ siÄ™ na "${m.suffix}"`:m.format==="includes"?`NieprawidÅ‚owy ciÄ…g znakÃ³w: musi zawieraÄ‡ "${m.includes}"`:m.format==="regex"?`NieprawidÅ‚owy ciÄ…g znakÃ³w: musi odpowiadaÄ‡ wzorcowi ${m.pattern}`:`NieprawidÅ‚ow(y/a/e) ${o[m.format]??l.format}`}case"not_multiple_of":return`NieprawidÅ‚owa liczba: musi byÄ‡ wielokrotnoÅ›ciÄ… ${l.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${l.keys.length>1?"s":""}: ${si(l.keys,", ")}`;case"invalid_key":return`NieprawidÅ‚owy klucz w ${l.origin}`;case"invalid_union":return"NieprawidÅ‚owe dane wejÅ›ciowe";case"invalid_element":return`NieprawidÅ‚owa wartoÅ›Ä‡ w ${l.origin}`;default:return"NieprawidÅ‚owe dane wejÅ›ciowe"}}};function H7(){return{localeError:G7()}}var Z7=()=>{let i={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}};function e(l){return i[l]??null}let o={regex:"padrÃ£o",email:"endereÃ§o de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"duraÃ§Ã£o ISO",ipv4:"endereÃ§o IPv4",ipv6:"endereÃ§o IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"nÃºmero E.164",jwt:"JWT",template_literal:"entrada"},h={nan:"NaN",number:"nÃºmero",null:"nulo"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Tipo invÃ¡lido: esperado instanceof ${l.expected}, recebido ${s}`:`Tipo invÃ¡lido: esperado ${m}, recebido ${s}`}case"invalid_value":return l.values.length===1?`Entrada invÃ¡lida: esperado ${vn(l.values[0])}`:`OpÃ§Ã£o invÃ¡lida: esperada uma das ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Muito grande: esperado que ${l.origin??"valor"} tivesse ${m}${l.maximum.toString()} ${x.unit??"elementos"}`:`Muito grande: esperado que ${l.origin??"valor"} fosse ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Muito pequeno: esperado que ${l.origin} tivesse ${m}${l.minimum.toString()} ${x.unit}`:`Muito pequeno: esperado que ${l.origin} fosse ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Texto invÃ¡lido: deve comeÃ§ar com "${m.prefix}"`:m.format==="ends_with"?`Texto invÃ¡lido: deve terminar com "${m.suffix}"`:m.format==="includes"?`Texto invÃ¡lido: deve incluir "${m.includes}"`:m.format==="regex"?`Texto invÃ¡lido: deve corresponder ao padrÃ£o ${m.pattern}`:`${o[m.format]??l.format} invÃ¡lido`}case"not_multiple_of":return`NÃºmero invÃ¡lido: deve ser mÃºltiplo de ${l.divisor}`;case"unrecognized_keys":return`Chave${l.keys.length>1?"s":""} desconhecida${l.keys.length>1?"s":""}: ${si(l.keys,", ")}`;case"invalid_key":return`Chave invÃ¡lida em ${l.origin}`;case"invalid_union":return"Entrada invÃ¡lida";case"invalid_element":return`Valor invÃ¡lido em ${l.origin}`;default:return"Campo invÃ¡lido"}}};function W7(){return{localeError:Z7()}}function IR(i,e,o,h){let l=Math.abs(i),m=l%10,x=l%100;return x>=11&&x<=19?h:m===1?e:m>=2&&m<=4?o:h}var q7=()=>{let i={string:{unit:{one:"ÑÐ¸Ð¼Ð²Ð¾Ð»",few:"ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°",many:"ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"},verb:"Ð¸Ð¼ÐµÑ‚ÑŒ"},file:{unit:{one:"Ð±Ð°Ð¹Ñ‚",few:"Ð±Ð°Ð¹Ñ‚Ð°",many:"Ð±Ð°Ð¹Ñ‚"},verb:"Ð¸Ð¼ÐµÑ‚ÑŒ"},array:{unit:{one:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚",few:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°",many:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²"},verb:"Ð¸Ð¼ÐµÑ‚ÑŒ"},set:{unit:{one:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚",few:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°",many:"ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²"},verb:"Ð¸Ð¼ÐµÑ‚ÑŒ"}};function e(l){return i[l]??null}let o={regex:"Ð²Ð²Ð¾Ð´",email:"email Ð°Ð´Ñ€ÐµÑ",url:"URL",emoji:"ÑÐ¼Ð¾Ð´Ð·Ð¸",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO Ð´Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ",date:"ISO Ð´Ð°Ñ‚Ð°",time:"ISO Ð²Ñ€ÐµÐ¼Ñ",duration:"ISO Ð´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ",ipv4:"IPv4 Ð°Ð´Ñ€ÐµÑ",ipv6:"IPv6 Ð°Ð´Ñ€ÐµÑ",cidrv4:"IPv4 Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½",cidrv6:"IPv6 Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½",base64:"ÑÑ‚Ñ€Ð¾ÐºÐ° Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ base64",base64url:"ÑÑ‚Ñ€Ð¾ÐºÐ° Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ base64url",json_string:"JSON ÑÑ‚Ñ€Ð¾ÐºÐ°",e164:"Ð½Ð¾Ð¼ÐµÑ€ E.164",jwt:"JWT",template_literal:"Ð²Ð²Ð¾Ð´"},h={nan:"NaN",number:"Ñ‡Ð¸ÑÐ»Ð¾",array:"Ð¼Ð°ÑÑÐ¸Ð²"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ð²Ð¾Ð´: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ instanceof ${l.expected}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ ${s}`:`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ð²Ð¾Ð´: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ ${m}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ ${s}`}case"invalid_value":return l.values.length===1?`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ð²Ð¾Ð´: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ ${vn(l.values[0])}`:`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð´Ð½Ð¾ Ð¸Ð· ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);if(x){let s=Number(l.maximum),P=IR(s,x.unit.one,x.unit.few,x.unit.many);return`Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ, Ñ‡Ñ‚Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ"} Ð±ÑƒÐ´ÐµÑ‚ Ð¸Ð¼ÐµÑ‚ÑŒ ${m}${l.maximum.toString()} ${P}`}return`Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ, Ñ‡Ñ‚Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ"} Ð±ÑƒÐ´ÐµÑ‚ ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);if(x){let s=Number(l.minimum),P=IR(s,x.unit.one,x.unit.few,x.unit.many);return`Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ, Ñ‡Ñ‚Ð¾ ${l.origin} Ð±ÑƒÐ´ÐµÑ‚ Ð¸Ð¼ÐµÑ‚ÑŒ ${m}${l.minimum.toString()} ${P}`}return`Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: Ð¾Ð¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ, Ñ‡Ñ‚Ð¾ ${l.origin} Ð±ÑƒÐ´ÐµÑ‚ ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°: Ð´Ð¾Ð»Ð¶Ð½Ð° Ð½Ð°Ñ‡Ð¸Ð½Ð°Ñ‚ÑŒÑÑ Ñ "${m.prefix}"`:m.format==="ends_with"?`ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°: Ð´Ð¾Ð»Ð¶Ð½Ð° Ð·Ð°ÐºÐ°Ð½Ñ‡Ð¸Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð° "${m.suffix}"`:m.format==="includes"?`ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°: Ð´Ð¾Ð»Ð¶Ð½Ð° ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ "${m.includes}"`:m.format==="regex"?`ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°: Ð´Ð¾Ð»Ð¶Ð½Ð° ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ ${m.pattern}`:`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ${o[m.format]??l.format}`}case"not_multiple_of":return`ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾: Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ ÐºÑ€Ð°Ñ‚Ð½Ñ‹Ð¼ ${l.divisor}`;case"unrecognized_keys":return`ÐÐµÑ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð½Ð½${l.keys.length>1?"Ñ‹Ðµ":"Ñ‹Ð¹"} ÐºÐ»ÑŽÑ‡${l.keys.length>1?"Ð¸":""}: ${si(l.keys,", ")}`;case"invalid_key":return`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ Ð² ${l.origin}`;case"invalid_union":return"ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ðµ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ";case"invalid_element":return`ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð² ${l.origin}`;default:return"ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ðµ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ"}}};function X7(){return{localeError:q7()}}var J7=()=>{let i={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}};function e(l){return i[l]??null}let o={regex:"vnos",email:"e-poÅ¡tni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in Äas",date:"ISO datum",time:"ISO Äas",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 Å¡tevilka",jwt:"JWT",template_literal:"vnos"},h={nan:"NaN",number:"Å¡tevilo",array:"tabela"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Neveljaven vnos: priÄakovano instanceof ${l.expected}, prejeto ${s}`:`Neveljaven vnos: priÄakovano ${m}, prejeto ${s}`}case"invalid_value":return l.values.length===1?`Neveljaven vnos: priÄakovano ${vn(l.values[0])}`:`Neveljavna moÅ¾nost: priÄakovano eno izmed ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Preveliko: priÄakovano, da bo ${l.origin??"vrednost"} imelo ${m}${l.maximum.toString()} ${x.unit??"elementov"}`:`Preveliko: priÄakovano, da bo ${l.origin??"vrednost"} ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Premajhno: priÄakovano, da bo ${l.origin} imelo ${m}${l.minimum.toString()} ${x.unit}`:`Premajhno: priÄakovano, da bo ${l.origin} ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Neveljaven niz: mora se zaÄeti z "${m.prefix}"`:m.format==="ends_with"?`Neveljaven niz: mora se konÄati z "${m.suffix}"`:m.format==="includes"?`Neveljaven niz: mora vsebovati "${m.includes}"`:m.format==="regex"?`Neveljaven niz: mora ustrezati vzorcu ${m.pattern}`:`Neveljaven ${o[m.format]??l.format}`}case"not_multiple_of":return`Neveljavno Å¡tevilo: mora biti veÄkratnik ${l.divisor}`;case"unrecognized_keys":return`Neprepoznan${l.keys.length>1?"i kljuÄi":" kljuÄ"}: ${si(l.keys,", ")}`;case"invalid_key":return`Neveljaven kljuÄ v ${l.origin}`;case"invalid_union":return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${l.origin}`;default:return"Neveljaven vnos"}}};function Y7(){return{localeError:J7()}}var K7=()=>{let i={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att innehÃ¥lla"},set:{unit:"objekt",verb:"att innehÃ¥lla"}};function e(l){return i[l]??null}let o={regex:"reguljÃ¤rt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad strÃ¤ng",base64url:"base64url-kodad strÃ¤ng",json_string:"JSON-strÃ¤ng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"},h={nan:"NaN",number:"antal",array:"lista"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Ogiltig inmatning: fÃ¶rvÃ¤ntat instanceof ${l.expected}, fick ${s}`:`Ogiltig inmatning: fÃ¶rvÃ¤ntat ${m}, fick ${s}`}case"invalid_value":return l.values.length===1?`Ogiltig inmatning: fÃ¶rvÃ¤ntat ${vn(l.values[0])}`:`Ogiltigt val: fÃ¶rvÃ¤ntade en av ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`FÃ¶r stor(t): fÃ¶rvÃ¤ntade ${l.origin??"vÃ¤rdet"} att ha ${m}${l.maximum.toString()} ${x.unit??"element"}`:`FÃ¶r stor(t): fÃ¶rvÃ¤ntat ${l.origin??"vÃ¤rdet"} att ha ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`FÃ¶r lite(t): fÃ¶rvÃ¤ntade ${l.origin??"vÃ¤rdet"} att ha ${m}${l.minimum.toString()} ${x.unit}`:`FÃ¶r lite(t): fÃ¶rvÃ¤ntade ${l.origin??"vÃ¤rdet"} att ha ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Ogiltig strÃ¤ng: mÃ¥ste bÃ¶rja med "${m.prefix}"`:m.format==="ends_with"?`Ogiltig strÃ¤ng: mÃ¥ste sluta med "${m.suffix}"`:m.format==="includes"?`Ogiltig strÃ¤ng: mÃ¥ste innehÃ¥lla "${m.includes}"`:m.format==="regex"?`Ogiltig strÃ¤ng: mÃ¥ste matcha mÃ¶nstret "${m.pattern}"`:`Ogiltig(t) ${o[m.format]??l.format}`}case"not_multiple_of":return`Ogiltigt tal: mÃ¥ste vara en multipel av ${l.divisor}`;case"unrecognized_keys":return`${l.keys.length>1?"OkÃ¤nda nycklar":"OkÃ¤nd nyckel"}: ${si(l.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${l.origin??"vÃ¤rdet"}`;case"invalid_union":return"Ogiltig input";case"invalid_element":return`Ogiltigt vÃ¤rde i ${l.origin??"vÃ¤rdet"}`;default:return"Ogiltig input"}}};function Q7(){return{localeError:K7()}}var eX=()=>{let i={string:{unit:"à®Žà®´à¯à®¤à¯à®¤à¯à®•à¯à®•à®³à¯",verb:"à®•à¯Šà®£à¯à®Ÿà®¿à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯"},file:{unit:"à®ªà¯ˆà®Ÿà¯à®Ÿà¯à®•à®³à¯",verb:"à®•à¯Šà®£à¯à®Ÿà®¿à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯"},array:{unit:"à®‰à®±à¯à®ªà¯à®ªà¯à®•à®³à¯",verb:"à®•à¯Šà®£à¯à®Ÿà®¿à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯"},set:{unit:"à®‰à®±à¯à®ªà¯à®ªà¯à®•à®³à¯",verb:"à®•à¯Šà®£à¯à®Ÿà®¿à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯"}};function e(l){return i[l]??null}let o={regex:"à®‰à®³à¯à®³à¯€à®Ÿà¯",email:"à®®à®¿à®©à¯à®©à®žà¯à®šà®²à¯ à®®à¯à®•à®µà®°à®¿",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO à®¤à¯‡à®¤à®¿ à®¨à¯‡à®°à®®à¯",date:"ISO à®¤à¯‡à®¤à®¿",time:"ISO à®¨à¯‡à®°à®®à¯",duration:"ISO à®•à®¾à®² à®…à®³à®µà¯",ipv4:"IPv4 à®®à¯à®•à®µà®°à®¿",ipv6:"IPv6 à®®à¯à®•à®µà®°à®¿",cidrv4:"IPv4 à®µà®°à®®à¯à®ªà¯",cidrv6:"IPv6 à®µà®°à®®à¯à®ªà¯",base64:"base64-encoded à®šà®°à®®à¯",base64url:"base64url-encoded à®šà®°à®®à¯",json_string:"JSON à®šà®°à®®à¯",e164:"E.164 à®Žà®£à¯",jwt:"JWT",template_literal:"input"},h={nan:"NaN",number:"à®Žà®£à¯",array:"à®…à®£à®¿",null:"à®µà¯†à®±à¯à®®à¯ˆ"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ instanceof ${l.expected}, à®ªà¯†à®±à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${s}`:`à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${m}, à®ªà¯†à®±à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${s}`}case"invalid_value":return l.values.length===1?`à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${vn(l.values[0])}`:`à®¤à®µà®±à®¾à®© à®µà®¿à®°à¯à®ªà¯à®ªà®®à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${si(l.values,"|")} à®‡à®²à¯ à®’à®©à¯à®±à¯`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`à®®à®¿à®• à®ªà¯†à®°à®¿à®¯à®¤à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${l.origin??"à®®à®¤à®¿à®ªà¯à®ªà¯"} ${m}${l.maximum.toString()} ${x.unit??"à®‰à®±à¯à®ªà¯à®ªà¯à®•à®³à¯"} à®†à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:`à®®à®¿à®• à®ªà¯†à®°à®¿à®¯à®¤à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${l.origin??"à®®à®¤à®¿à®ªà¯à®ªà¯"} ${m}${l.maximum.toString()} à®†à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`à®®à®¿à®•à®šà¯ à®šà®¿à®±à®¿à®¯à®¤à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${l.origin} ${m}${l.minimum.toString()} ${x.unit} à®†à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:`à®®à®¿à®•à®šà¯ à®šà®¿à®±à®¿à®¯à®¤à¯: à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ ${l.origin} ${m}${l.minimum.toString()} à®†à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`}case"invalid_format":{let m=l;return m.format==="starts_with"?`à®¤à®µà®±à®¾à®© à®šà®°à®®à¯: "${m.prefix}" à®‡à®²à¯ à®¤à¯Šà®Ÿà®™à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:m.format==="ends_with"?`à®¤à®µà®±à®¾à®© à®šà®°à®®à¯: "${m.suffix}" à®‡à®²à¯ à®®à¯à®Ÿà®¿à®µà®Ÿà¯ˆà®¯ à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:m.format==="includes"?`à®¤à®µà®±à®¾à®© à®šà®°à®®à¯: "${m.includes}" à® à®‰à®³à¯à®³à®Ÿà®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:m.format==="regex"?`à®¤à®µà®±à®¾à®© à®šà®°à®®à¯: ${m.pattern} à®®à¯à®±à¯ˆà®ªà®¾à®Ÿà¯à®Ÿà¯à®Ÿà®©à¯ à®ªà¯Šà®°à¯à®¨à¯à®¤ à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`:`à®¤à®µà®±à®¾à®© ${o[m.format]??l.format}`}case"not_multiple_of":return`à®¤à®µà®±à®¾à®© à®Žà®£à¯: ${l.divisor} à®‡à®©à¯ à®ªà®²à®®à®¾à®• à®‡à®°à¯à®•à¯à®• à®µà¯‡à®£à¯à®Ÿà¯à®®à¯`;case"unrecognized_keys":return`à®…à®Ÿà¯ˆà®¯à®¾à®³à®®à¯ à®¤à¯†à®°à®¿à®¯à®¾à®¤ à®µà®¿à®šà¯ˆ${l.keys.length>1?"à®•à®³à¯":""}: ${si(l.keys,", ")}`;case"invalid_key":return`${l.origin} à®‡à®²à¯ à®¤à®µà®±à®¾à®© à®µà®¿à®šà¯ˆ`;case"invalid_union":return"à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯";case"invalid_element":return`${l.origin} à®‡à®²à¯ à®¤à®µà®±à®¾à®© à®®à®¤à®¿à®ªà¯à®ªà¯`;default:return"à®¤à®µà®±à®¾à®© à®‰à®³à¯à®³à¯€à®Ÿà¯"}}};function tX(){return{localeError:eX()}}var iX=()=>{let i={string:{unit:"à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£",verb:"à¸„à¸§à¸£à¸¡à¸µ"},file:{unit:"à¹„à¸šà¸•à¹Œ",verb:"à¸„à¸§à¸£à¸¡à¸µ"},array:{unit:"à¸£à¸²à¸¢à¸à¸²à¸£",verb:"à¸„à¸§à¸£à¸¡à¸µ"},set:{unit:"à¸£à¸²à¸¢à¸à¸²à¸£",verb:"à¸„à¸§à¸£à¸¡à¸µ"}};function e(l){return i[l]??null}let o={regex:"à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸›à¹‰à¸­à¸™",email:"à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸­à¸µà¹€à¸¡à¸¥",url:"URL",emoji:"à¸­à¸´à¹‚à¸¡à¸ˆà¸´",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸§à¸¥à¸²à¹à¸šà¸š ISO",date:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸šà¸š ISO",time:"à¹€à¸§à¸¥à¸²à¹à¸šà¸š ISO",duration:"à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¹à¸šà¸š ISO",ipv4:"à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ IPv4",ipv6:"à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ IPv6",cidrv4:"à¸Šà¹ˆà¸§à¸‡ IP à¹à¸šà¸š IPv4",cidrv6:"à¸Šà¹ˆà¸§à¸‡ IP à¹à¸šà¸š IPv6",base64:"à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸šà¸š Base64",base64url:"à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸šà¸š Base64 à¸ªà¸³à¸«à¸£à¸±à¸š URL",json_string:"à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸šà¸š JSON",e164:"à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸žà¸—à¹Œà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸›à¸£à¸°à¹€à¸—à¸¨ (E.164)",jwt:"à¹‚à¸—à¹€à¸„à¸™ JWT",template_literal:"à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸›à¹‰à¸­à¸™"},h={nan:"NaN",number:"à¸•à¸±à¸§à¹€à¸¥à¸‚",array:"à¸­à¸²à¸£à¹Œà¹€à¸£à¸¢à¹Œ (Array)",null:"à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸² (null)"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸„à¸§à¸£à¹€à¸›à¹‡à¸™ instanceof ${l.expected} à¹à¸•à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š ${s}`:`à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸„à¸§à¸£à¹€à¸›à¹‡à¸™ ${m} à¹à¸•à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š ${s}`}case"invalid_value":return l.values.length===1?`à¸„à¹ˆà¸²à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸„à¸§à¸£à¹€à¸›à¹‡à¸™ ${vn(l.values[0])}`:`à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸„à¸§à¸£à¹€à¸›à¹‡à¸™à¸«à¸™à¸¶à¹ˆà¸‡à¹ƒà¸™ ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™":"à¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²",x=e(l.origin);return x?`à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”: ${l.origin??"à¸„à¹ˆà¸²"} à¸„à¸§à¸£à¸¡à¸µ${m} ${l.maximum.toString()} ${x.unit??"à¸£à¸²à¸¢à¸à¸²à¸£"}`:`à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”: ${l.origin??"à¸„à¹ˆà¸²"} à¸„à¸§à¸£à¸¡à¸µ${m} ${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?"à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢":"à¸¡à¸²à¸à¸à¸§à¹ˆà¸²",x=e(l.origin);return x?`à¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸à¸³à¸«à¸™à¸”: ${l.origin} à¸„à¸§à¸£à¸¡à¸µ${m} ${l.minimum.toString()} ${x.unit}`:`à¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸à¸³à¸«à¸™à¸”: ${l.origin} à¸„à¸§à¸£à¸¡à¸µ${m} ${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸‚à¸¶à¹‰à¸™à¸•à¹‰à¸™à¸”à¹‰à¸§à¸¢ "${m.prefix}"`:m.format==="ends_with"?`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸¥à¸‡à¸—à¹‰à¸²à¸¢à¸”à¹‰à¸§à¸¢ "${m.suffix}"`:m.format==="includes"?`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸¡à¸µ "${m.includes}" à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡`:m.format==="regex"?`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸•à¹‰à¸­à¸‡à¸•à¸£à¸‡à¸à¸±à¸šà¸£à¸¹à¸›à¹à¸šà¸šà¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸” ${m.pattern}`:`à¸£à¸¹à¸›à¹à¸šà¸šà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: ${o[m.format]??l.format}`}case"not_multiple_of":return`à¸•à¸±à¸§à¹€à¸¥à¸‚à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¸ˆà¸³à¸™à¸§à¸™à¸—à¸µà¹ˆà¸«à¸²à¸£à¸”à¹‰à¸§à¸¢ ${l.divisor} à¹„à¸”à¹‰à¸¥à¸‡à¸•à¸±à¸§`;case"unrecognized_keys":return`à¸žà¸šà¸„à¸µà¸¢à¹Œà¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸£à¸¹à¹‰à¸ˆà¸±à¸: ${si(l.keys,", ")}`;case"invalid_key":return`à¸„à¸µà¸¢à¹Œà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¹ƒà¸™ ${l.origin}`;case"invalid_union":return"à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: à¹„à¸¡à¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸£à¸¹à¸›à¹à¸šà¸šà¸¢à¸¹à¹€à¸™à¸µà¸¢à¸™à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”à¹„à¸§à¹‰";case"invalid_element":return`à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¹ƒà¸™ ${l.origin}`;default:return"à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡"}}};function nX(){return{localeError:iX()}}var rX=()=>{let i={string:{unit:"karakter",verb:"olmalÄ±"},file:{unit:"bayt",verb:"olmalÄ±"},array:{unit:"Ã¶ÄŸe",verb:"olmalÄ±"},set:{unit:"Ã¶ÄŸe",verb:"olmalÄ±"}};function e(l){return i[l]??null}let o={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO sÃ¼re",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aralÄ±ÄŸÄ±",cidrv6:"IPv6 aralÄ±ÄŸÄ±",base64:"base64 ile ÅŸifrelenmiÅŸ metin",base64url:"base64url ile ÅŸifrelenmiÅŸ metin",json_string:"JSON dizesi",e164:"E.164 sayÄ±sÄ±",jwt:"JWT",template_literal:"Åžablon dizesi"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`GeÃ§ersiz deÄŸer: beklenen instanceof ${l.expected}, alÄ±nan ${s}`:`GeÃ§ersiz deÄŸer: beklenen ${m}, alÄ±nan ${s}`}case"invalid_value":return l.values.length===1?`GeÃ§ersiz deÄŸer: beklenen ${vn(l.values[0])}`:`GeÃ§ersiz seÃ§enek: aÅŸaÄŸÄ±dakilerden biri olmalÄ±: ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ã‡ok bÃ¼yÃ¼k: beklenen ${l.origin??"deÄŸer"} ${m}${l.maximum.toString()} ${x.unit??"Ã¶ÄŸe"}`:`Ã‡ok bÃ¼yÃ¼k: beklenen ${l.origin??"deÄŸer"} ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Ã‡ok kÃ¼Ã§Ã¼k: beklenen ${l.origin} ${m}${l.minimum.toString()} ${x.unit}`:`Ã‡ok kÃ¼Ã§Ã¼k: beklenen ${l.origin} ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`GeÃ§ersiz metin: "${m.prefix}" ile baÅŸlamalÄ±`:m.format==="ends_with"?`GeÃ§ersiz metin: "${m.suffix}" ile bitmeli`:m.format==="includes"?`GeÃ§ersiz metin: "${m.includes}" iÃ§ermeli`:m.format==="regex"?`GeÃ§ersiz metin: ${m.pattern} desenine uymalÄ±`:`GeÃ§ersiz ${o[m.format]??l.format}`}case"not_multiple_of":return`GeÃ§ersiz sayÄ±: ${l.divisor} ile tam bÃ¶lÃ¼nebilmeli`;case"unrecognized_keys":return`TanÄ±nmayan anahtar${l.keys.length>1?"lar":""}: ${si(l.keys,", ")}`;case"invalid_key":return`${l.origin} iÃ§inde geÃ§ersiz anahtar`;case"invalid_union":return"GeÃ§ersiz deÄŸer";case"invalid_element":return`${l.origin} iÃ§inde geÃ§ersiz deÄŸer`;default:return"GeÃ§ersiz deÄŸer"}}};function oX(){return{localeError:rX()}}var sX=()=>{let i={string:{unit:"ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ–Ð²",verb:"Ð¼Ð°Ñ‚Ð¸Ð¼Ðµ"},file:{unit:"Ð±Ð°Ð¹Ñ‚Ñ–Ð²",verb:"Ð¼Ð°Ñ‚Ð¸Ð¼Ðµ"},array:{unit:"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ–Ð²",verb:"Ð¼Ð°Ñ‚Ð¸Ð¼Ðµ"},set:{unit:"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ–Ð²",verb:"Ð¼Ð°Ñ‚Ð¸Ð¼Ðµ"}};function e(l){return i[l]??null}let o={regex:"Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–",email:"Ð°Ð´Ñ€ÐµÑÐ° ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸",url:"URL",emoji:"ÐµÐ¼Ð¾Ð´Ð·Ñ–",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"Ð´Ð°Ñ‚Ð° Ñ‚Ð° Ñ‡Ð°Ñ ISO",date:"Ð´Ð°Ñ‚Ð° ISO",time:"Ñ‡Ð°Ñ ISO",duration:"Ñ‚Ñ€Ð¸Ð²Ð°Ð»Ñ–ÑÑ‚ÑŒ ISO",ipv4:"Ð°Ð´Ñ€ÐµÑÐ° IPv4",ipv6:"Ð°Ð´Ñ€ÐµÑÐ° IPv6",cidrv4:"Ð´Ñ–Ð°Ð¿Ð°Ð·Ð¾Ð½ IPv4",cidrv6:"Ð´Ñ–Ð°Ð¿Ð°Ð·Ð¾Ð½ IPv6",base64:"Ñ€ÑÐ´Ð¾Ðº Ñƒ ÐºÐ¾Ð´ÑƒÐ²Ð°Ð½Ð½Ñ– base64",base64url:"Ñ€ÑÐ´Ð¾Ðº Ñƒ ÐºÐ¾Ð´ÑƒÐ²Ð°Ð½Ð½Ñ– base64url",json_string:"Ñ€ÑÐ´Ð¾Ðº JSON",e164:"Ð½Ð¾Ð¼ÐµÑ€ E.164",jwt:"JWT",template_literal:"Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–"},h={nan:"NaN",number:"Ñ‡Ð¸ÑÐ»Ð¾",array:"Ð¼Ð°ÑÐ¸Ð²"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ instanceof ${l.expected}, Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð¾ ${s}`:`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ ${m}, Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð¾ ${s}`}case"invalid_value":return l.values.length===1?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ ${vn(l.values[0])}`:`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð° Ð¾Ð¿Ñ†Ñ–Ñ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ Ð¾Ð´Ð½Ðµ Ð· ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð¾ Ð²ÐµÐ»Ð¸ÐºÐµ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ, Ñ‰Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ"} ${x.verb} ${m}${l.maximum.toString()} ${x.unit??"ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ–Ð²"}`:`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð¾ Ð²ÐµÐ»Ð¸ÐºÐµ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ, Ñ‰Ð¾ ${l.origin??"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ"} Ð±ÑƒÐ´Ðµ ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð¾ Ð¼Ð°Ð»Ðµ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ, Ñ‰Ð¾ ${l.origin} ${x.verb} ${m}${l.minimum.toString()} ${x.unit}`:`Ð—Ð°Ð½Ð°Ð´Ñ‚Ð¾ Ð¼Ð°Ð»Ðµ: Ð¾Ñ‡Ñ–ÐºÑƒÑ”Ñ‚ÑŒÑÑ, Ñ‰Ð¾ ${l.origin} Ð±ÑƒÐ´Ðµ ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº: Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð¿Ð¾Ñ‡Ð¸Ð½Ð°Ñ‚Ð¸ÑÑ Ð· "${m.prefix}"`:m.format==="ends_with"?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº: Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð·Ð°ÐºÑ–Ð½Ñ‡ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð½Ð° "${m.suffix}"`:m.format==="includes"?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº: Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð¼Ñ–ÑÑ‚Ð¸Ñ‚Ð¸ "${m.includes}"`:m.format==="regex"?`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº: Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ñ‚Ð¸ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ ${m.pattern}`:`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ ${o[m.format]??l.format}`}case"not_multiple_of":return`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ðµ Ñ‡Ð¸ÑÐ»Ð¾: Ð¿Ð¾Ð²Ð¸Ð½Ð½Ð¾ Ð±ÑƒÑ‚Ð¸ ÐºÑ€Ð°Ñ‚Ð½Ð¸Ð¼ ${l.divisor}`;case"unrecognized_keys":return`ÐÐµÑ€Ð¾Ð·Ð¿Ñ–Ð·Ð½Ð°Ð½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡${l.keys.length>1?"Ñ–":""}: ${si(l.keys,", ")}`;case"invalid_key":return`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ Ñƒ ${l.origin}`;case"invalid_union":return"ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–";case"invalid_element":return`ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ Ñƒ ${l.origin}`;default:return"ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð²Ñ…Ñ–Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–"}}};function tO(){return{localeError:sX()}}function aX(){return tO()}var lX=()=>{let i={string:{unit:"Ø­Ø±ÙˆÙ",verb:"ÛÙˆÙ†Ø§"},file:{unit:"Ø¨Ø§Ø¦Ù¹Ø³",verb:"ÛÙˆÙ†Ø§"},array:{unit:"Ø¢Ø¦Ù¹Ù…Ø²",verb:"ÛÙˆÙ†Ø§"},set:{unit:"Ø¢Ø¦Ù¹Ù…Ø²",verb:"ÛÙˆÙ†Ø§"}};function e(l){return i[l]??null}let o={regex:"Ø§Ù† Ù¾Ù¹",email:"Ø§ÛŒ Ù…ÛŒÙ„ Ø§ÛŒÚˆØ±ÛŒØ³",url:"ÛŒÙˆ Ø¢Ø± Ø§ÛŒÙ„",emoji:"Ø§ÛŒÙ…ÙˆØ¬ÛŒ",uuid:"ÛŒÙˆ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",uuidv4:"ÛŒÙˆ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ ÙˆÛŒ 4",uuidv6:"ÛŒÙˆ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ ÙˆÛŒ 6",nanoid:"Ù†ÛŒÙ†Ùˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",guid:"Ø¬ÛŒ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",cuid:"Ø³ÛŒ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",cuid2:"Ø³ÛŒ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ 2",ulid:"ÛŒÙˆ Ø§ÛŒÙ„ Ø¢Ø¦ÛŒ ÚˆÛŒ",xid:"Ø§ÛŒÚ©Ø³ Ø¢Ø¦ÛŒ ÚˆÛŒ",ksuid:"Ú©Û’ Ø§ÛŒØ³ ÛŒÙˆ Ø¢Ø¦ÛŒ ÚˆÛŒ",datetime:"Ø¢Ø¦ÛŒ Ø§ÛŒØ³ Ø§Ùˆ ÚˆÛŒÙ¹ Ù¹Ø§Ø¦Ù…",date:"Ø¢Ø¦ÛŒ Ø§ÛŒØ³ Ø§Ùˆ ØªØ§Ø±ÛŒØ®",time:"Ø¢Ø¦ÛŒ Ø§ÛŒØ³ Ø§Ùˆ ÙˆÙ‚Øª",duration:"Ø¢Ø¦ÛŒ Ø§ÛŒØ³ Ø§Ùˆ Ù…Ø¯Øª",ipv4:"Ø¢Ø¦ÛŒ Ù¾ÛŒ ÙˆÛŒ 4 Ø§ÛŒÚˆØ±ÛŒØ³",ipv6:"Ø¢Ø¦ÛŒ Ù¾ÛŒ ÙˆÛŒ 6 Ø§ÛŒÚˆØ±ÛŒØ³",cidrv4:"Ø¢Ø¦ÛŒ Ù¾ÛŒ ÙˆÛŒ 4 Ø±ÛŒÙ†Ø¬",cidrv6:"Ø¢Ø¦ÛŒ Ù¾ÛŒ ÙˆÛŒ 6 Ø±ÛŒÙ†Ø¬",base64:"Ø¨ÛŒØ³ 64 Ø§Ù† Ú©ÙˆÚˆÚˆ Ø³Ù¹Ø±Ù†Ú¯",base64url:"Ø¨ÛŒØ³ 64 ÛŒÙˆ Ø¢Ø± Ø§ÛŒÙ„ Ø§Ù† Ú©ÙˆÚˆÚˆ Ø³Ù¹Ø±Ù†Ú¯",json_string:"Ø¬Û’ Ø§ÛŒØ³ Ø§Ùˆ Ø§ÛŒÙ† Ø³Ù¹Ø±Ù†Ú¯",e164:"Ø§ÛŒ 164 Ù†Ù…Ø¨Ø±",jwt:"Ø¬Û’ ÚˆØ¨Ù„ÛŒÙˆ Ù¹ÛŒ",template_literal:"Ø§Ù† Ù¾Ù¹"},h={nan:"NaN",number:"Ù†Ù…Ø¨Ø±",array:"Ø¢Ø±Û’",null:"Ù†Ù„"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ØºÙ„Ø· Ø§Ù† Ù¾Ù¹: instanceof ${l.expected} Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§ØŒ ${s} Ù…ÙˆØµÙˆÙ„ ÛÙˆØ§`:`ØºÙ„Ø· Ø§Ù† Ù¾Ù¹: ${m} Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§ØŒ ${s} Ù…ÙˆØµÙˆÙ„ ÛÙˆØ§`}case"invalid_value":return l.values.length===1?`ØºÙ„Ø· Ø§Ù† Ù¾Ù¹: ${vn(l.values[0])} Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§`:`ØºÙ„Ø· Ø¢Ù¾Ø´Ù†: ${si(l.values,"|")} Ù…ÛŒÚº Ø³Û’ Ø§ÛŒÚ© Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Ø¨ÛØª Ø¨Ú‘Ø§: ${l.origin??"ÙˆÛŒÙ„ÛŒÙˆ"} Ú©Û’ ${m}${l.maximum.toString()} ${x.unit??"Ø¹Ù†Ø§ØµØ±"} ÛÙˆÙ†Û’ Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Û’`:`Ø¨ÛØª Ø¨Ú‘Ø§: ${l.origin??"ÙˆÛŒÙ„ÛŒÙˆ"} Ú©Ø§ ${m}${l.maximum.toString()} ÛÙˆÙ†Ø§ Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Ø¨ÛØª Ú†Ú¾ÙˆÙ¹Ø§: ${l.origin} Ú©Û’ ${m}${l.minimum.toString()} ${x.unit} ÛÙˆÙ†Û’ Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Û’`:`Ø¨ÛØª Ú†Ú¾ÙˆÙ¹Ø§: ${l.origin} Ú©Ø§ ${m}${l.minimum.toString()} ÛÙˆÙ†Ø§ Ù…ØªÙˆÙ‚Ø¹ ØªÚ¾Ø§`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ØºÙ„Ø· Ø³Ù¹Ø±Ù†Ú¯: "${m.prefix}" Ø³Û’ Ø´Ø±ÙˆØ¹ ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`:m.format==="ends_with"?`ØºÙ„Ø· Ø³Ù¹Ø±Ù†Ú¯: "${m.suffix}" Ù¾Ø± Ø®ØªÙ… ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`:m.format==="includes"?`ØºÙ„Ø· Ø³Ù¹Ø±Ù†Ú¯: "${m.includes}" Ø´Ø§Ù…Ù„ ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`:m.format==="regex"?`ØºÙ„Ø· Ø³Ù¹Ø±Ù†Ú¯: Ù¾ÛŒÙ¹Ø±Ù† ${m.pattern} Ø³Û’ Ù…ÛŒÚ† ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`:`ØºÙ„Ø· ${o[m.format]??l.format}`}case"not_multiple_of":return`ØºÙ„Ø· Ù†Ù…Ø¨Ø±: ${l.divisor} Ú©Ø§ Ù…Ø¶Ø§Ø¹Ù ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’`;case"unrecognized_keys":return`ØºÛŒØ± ØªØ³Ù„ÛŒÙ… Ø´Ø¯Û Ú©ÛŒ${l.keys.length>1?"Ø²":""}: ${si(l.keys,"ØŒ ")}`;case"invalid_key":return`${l.origin} Ù…ÛŒÚº ØºÙ„Ø· Ú©ÛŒ`;case"invalid_union":return"ØºÙ„Ø· Ø§Ù† Ù¾Ù¹";case"invalid_element":return`${l.origin} Ù…ÛŒÚº ØºÙ„Ø· ÙˆÛŒÙ„ÛŒÙˆ`;default:return"ØºÙ„Ø· Ø§Ù† Ù¾Ù¹"}}};function cX(){return{localeError:lX()}}var uX=()=>{let i={string:{unit:"belgi",verb:"boâ€˜lishi kerak"},file:{unit:"bayt",verb:"boâ€˜lishi kerak"},array:{unit:"element",verb:"boâ€˜lishi kerak"},set:{unit:"element",verb:"boâ€˜lishi kerak"}};function e(l){return i[l]??null}let o={regex:"kirish",email:"elektron pochta manzili",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO sana va vaqti",date:"ISO sana",time:"ISO vaqt",duration:"ISO davomiylik",ipv4:"IPv4 manzil",ipv6:"IPv6 manzil",mac:"MAC manzil",cidrv4:"IPv4 diapazon",cidrv6:"IPv6 diapazon",base64:"base64 kodlangan satr",base64url:"base64url kodlangan satr",json_string:"JSON satr",e164:"E.164 raqam",jwt:"JWT",template_literal:"kirish"},h={nan:"NaN",number:"raqam",array:"massiv"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Notoâ€˜gâ€˜ri kirish: kutilgan instanceof ${l.expected}, qabul qilingan ${s}`:`Notoâ€˜gâ€˜ri kirish: kutilgan ${m}, qabul qilingan ${s}`}case"invalid_value":return l.values.length===1?`Notoâ€˜gâ€˜ri kirish: kutilgan ${vn(l.values[0])}`:`Notoâ€˜gâ€˜ri variant: quyidagilardan biri kutilgan ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`Juda katta: kutilgan ${l.origin??"qiymat"} ${m}${l.maximum.toString()} ${x.unit} ${x.verb}`:`Juda katta: kutilgan ${l.origin??"qiymat"} ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`Juda kichik: kutilgan ${l.origin} ${m}${l.minimum.toString()} ${x.unit} ${x.verb}`:`Juda kichik: kutilgan ${l.origin} ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Notoâ€˜gâ€˜ri satr: "${m.prefix}" bilan boshlanishi kerak`:m.format==="ends_with"?`Notoâ€˜gâ€˜ri satr: "${m.suffix}" bilan tugashi kerak`:m.format==="includes"?`Notoâ€˜gâ€˜ri satr: "${m.includes}" ni oâ€˜z ichiga olishi kerak`:m.format==="regex"?`Notoâ€˜gâ€˜ri satr: ${m.pattern} shabloniga mos kelishi kerak`:`Notoâ€˜gâ€˜ri ${o[m.format]??l.format}`}case"not_multiple_of":return`Notoâ€˜gâ€˜ri raqam: ${l.divisor} ning karralisi boâ€˜lishi kerak`;case"unrecognized_keys":return`Nomaâ€™lum kalit${l.keys.length>1?"lar":""}: ${si(l.keys,", ")}`;case"invalid_key":return`${l.origin} dagi kalit notoâ€˜gâ€˜ri`;case"invalid_union":return"Notoâ€˜gâ€˜ri kirish";case"invalid_element":return`${l.origin} da notoâ€˜gâ€˜ri qiymat`;default:return"Notoâ€˜gâ€˜ri kirish"}}};function hX(){return{localeError:uX()}}var dX=()=>{let i={string:{unit:"kÃ½ tá»±",verb:"cÃ³"},file:{unit:"byte",verb:"cÃ³"},array:{unit:"pháº§n tá»­",verb:"cÃ³"},set:{unit:"pháº§n tá»­",verb:"cÃ³"}};function e(l){return i[l]??null}let o={regex:"Ä‘áº§u vÃ o",email:"Ä‘á»‹a chá»‰ email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ngÃ y giá» ISO",date:"ngÃ y ISO",time:"giá» ISO",duration:"khoáº£ng thá»i gian ISO",ipv4:"Ä‘á»‹a chá»‰ IPv4",ipv6:"Ä‘á»‹a chá»‰ IPv6",cidrv4:"dáº£i IPv4",cidrv6:"dáº£i IPv6",base64:"chuá»—i mÃ£ hÃ³a base64",base64url:"chuá»—i mÃ£ hÃ³a base64url",json_string:"chuá»—i JSON",e164:"sá»‘ E.164",jwt:"JWT",template_literal:"Ä‘áº§u vÃ o"},h={nan:"NaN",number:"sá»‘",array:"máº£ng"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`Äáº§u vÃ o khÃ´ng há»£p lá»‡: mong Ä‘á»£i instanceof ${l.expected}, nháº­n Ä‘Æ°á»£c ${s}`:`Äáº§u vÃ o khÃ´ng há»£p lá»‡: mong Ä‘á»£i ${m}, nháº­n Ä‘Æ°á»£c ${s}`}case"invalid_value":return l.values.length===1?`Äáº§u vÃ o khÃ´ng há»£p lá»‡: mong Ä‘á»£i ${vn(l.values[0])}`:`TÃ¹y chá»n khÃ´ng há»£p lá»‡: mong Ä‘á»£i má»™t trong cÃ¡c giÃ¡ trá»‹ ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`QuÃ¡ lá»›n: mong Ä‘á»£i ${l.origin??"giÃ¡ trá»‹"} ${x.verb} ${m}${l.maximum.toString()} ${x.unit??"pháº§n tá»­"}`:`QuÃ¡ lá»›n: mong Ä‘á»£i ${l.origin??"giÃ¡ trá»‹"} ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`QuÃ¡ nhá»: mong Ä‘á»£i ${l.origin} ${x.verb} ${m}${l.minimum.toString()} ${x.unit}`:`QuÃ¡ nhá»: mong Ä‘á»£i ${l.origin} ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`Chuá»—i khÃ´ng há»£p lá»‡: pháº£i báº¯t Ä‘áº§u báº±ng "${m.prefix}"`:m.format==="ends_with"?`Chuá»—i khÃ´ng há»£p lá»‡: pháº£i káº¿t thÃºc báº±ng "${m.suffix}"`:m.format==="includes"?`Chuá»—i khÃ´ng há»£p lá»‡: pháº£i bao gá»“m "${m.includes}"`:m.format==="regex"?`Chuá»—i khÃ´ng há»£p lá»‡: pháº£i khá»›p vá»›i máº«u ${m.pattern}`:`${o[m.format]??l.format} khÃ´ng há»£p lá»‡`}case"not_multiple_of":return`Sá»‘ khÃ´ng há»£p lá»‡: pháº£i lÃ  bá»™i sá»‘ cá»§a ${l.divisor}`;case"unrecognized_keys":return`KhÃ³a khÃ´ng Ä‘Æ°á»£c nháº­n dáº¡ng: ${si(l.keys,", ")}`;case"invalid_key":return`KhÃ³a khÃ´ng há»£p lá»‡ trong ${l.origin}`;case"invalid_union":return"Äáº§u vÃ o khÃ´ng há»£p lá»‡";case"invalid_element":return`GiÃ¡ trá»‹ khÃ´ng há»£p lá»‡ trong ${l.origin}`;default:return"Äáº§u vÃ o khÃ´ng há»£p lá»‡"}}};function fX(){return{localeError:dX()}}var pX=()=>{let i={string:{unit:"å­—ç¬¦",verb:"åŒ…å«"},file:{unit:"å­—èŠ‚",verb:"åŒ…å«"},array:{unit:"é¡¹",verb:"åŒ…å«"},set:{unit:"é¡¹",verb:"åŒ…å«"}};function e(l){return i[l]??null}let o={regex:"è¾“å…¥",email:"ç”µå­é‚®ä»¶",url:"URL",emoji:"è¡¨æƒ…ç¬¦å·",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISOæ—¥æœŸæ—¶é—´",date:"ISOæ—¥æœŸ",time:"ISOæ—¶é—´",duration:"ISOæ—¶é•¿",ipv4:"IPv4åœ°å€",ipv6:"IPv6åœ°å€",cidrv4:"IPv4ç½‘æ®µ",cidrv6:"IPv6ç½‘æ®µ",base64:"base64ç¼–ç å­—ç¬¦ä¸²",base64url:"base64urlç¼–ç å­—ç¬¦ä¸²",json_string:"JSONå­—ç¬¦ä¸²",e164:"E.164å·ç ",jwt:"JWT",template_literal:"è¾“å…¥"},h={nan:"NaN",number:"æ•°å­—",array:"æ•°ç»„",null:"ç©ºå€¼(null)"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`æ— æ•ˆè¾“å…¥ï¼šæœŸæœ› instanceof ${l.expected}ï¼Œå®žé™…æŽ¥æ”¶ ${s}`:`æ— æ•ˆè¾“å…¥ï¼šæœŸæœ› ${m}ï¼Œå®žé™…æŽ¥æ”¶ ${s}`}case"invalid_value":return l.values.length===1?`æ— æ•ˆè¾“å…¥ï¼šæœŸæœ› ${vn(l.values[0])}`:`æ— æ•ˆé€‰é¡¹ï¼šæœŸæœ›ä»¥ä¸‹ä¹‹ä¸€ ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`æ•°å€¼è¿‡å¤§ï¼šæœŸæœ› ${l.origin??"å€¼"} ${m}${l.maximum.toString()} ${x.unit??"ä¸ªå…ƒç´ "}`:`æ•°å€¼è¿‡å¤§ï¼šæœŸæœ› ${l.origin??"å€¼"} ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`æ•°å€¼è¿‡å°ï¼šæœŸæœ› ${l.origin} ${m}${l.minimum.toString()} ${x.unit}`:`æ•°å€¼è¿‡å°ï¼šæœŸæœ› ${l.origin} ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`æ— æ•ˆå­—ç¬¦ä¸²ï¼šå¿…é¡»ä»¥ "${m.prefix}" å¼€å¤´`:m.format==="ends_with"?`æ— æ•ˆå­—ç¬¦ä¸²ï¼šå¿…é¡»ä»¥ "${m.suffix}" ç»“å°¾`:m.format==="includes"?`æ— æ•ˆå­—ç¬¦ä¸²ï¼šå¿…é¡»åŒ…å« "${m.includes}"`:m.format==="regex"?`æ— æ•ˆå­—ç¬¦ä¸²ï¼šå¿…é¡»æ»¡è¶³æ­£åˆ™è¡¨è¾¾å¼ ${m.pattern}`:`æ— æ•ˆ${o[m.format]??l.format}`}case"not_multiple_of":return`æ— æ•ˆæ•°å­—ï¼šå¿…é¡»æ˜¯ ${l.divisor} çš„å€æ•°`;case"unrecognized_keys":return`å‡ºçŽ°æœªçŸ¥çš„é”®(key): ${si(l.keys,", ")}`;case"invalid_key":return`${l.origin} ä¸­çš„é”®(key)æ— æ•ˆ`;case"invalid_union":return"æ— æ•ˆè¾“å…¥";case"invalid_element":return`${l.origin} ä¸­åŒ…å«æ— æ•ˆå€¼(value)`;default:return"æ— æ•ˆè¾“å…¥"}}};function mX(){return{localeError:pX()}}var gX=()=>{let i={string:{unit:"å­—å…ƒ",verb:"æ“æœ‰"},file:{unit:"ä½å…ƒçµ„",verb:"æ“æœ‰"},array:{unit:"é …ç›®",verb:"æ“æœ‰"},set:{unit:"é …ç›®",verb:"æ“æœ‰"}};function e(l){return i[l]??null}let o={regex:"è¼¸å…¥",email:"éƒµä»¶åœ°å€",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO æ—¥æœŸæ™‚é–“",date:"ISO æ—¥æœŸ",time:"ISO æ™‚é–“",duration:"ISO æœŸé–“",ipv4:"IPv4 ä½å€",ipv6:"IPv6 ä½å€",cidrv4:"IPv4 ç¯„åœ",cidrv6:"IPv6 ç¯„åœ",base64:"base64 ç·¨ç¢¼å­—ä¸²",base64url:"base64url ç·¨ç¢¼å­—ä¸²",json_string:"JSON å­—ä¸²",e164:"E.164 æ•¸å€¼",jwt:"JWT",template_literal:"è¼¸å…¥"},h={nan:"NaN"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ç„¡æ•ˆçš„è¼¸å…¥å€¼ï¼šé æœŸç‚º instanceof ${l.expected}ï¼Œä½†æ”¶åˆ° ${s}`:`ç„¡æ•ˆçš„è¼¸å…¥å€¼ï¼šé æœŸç‚º ${m}ï¼Œä½†æ”¶åˆ° ${s}`}case"invalid_value":return l.values.length===1?`ç„¡æ•ˆçš„è¼¸å…¥å€¼ï¼šé æœŸç‚º ${vn(l.values[0])}`:`ç„¡æ•ˆçš„é¸é …ï¼šé æœŸç‚ºä»¥ä¸‹å…¶ä¸­ä¹‹ä¸€ ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`æ•¸å€¼éŽå¤§ï¼šé æœŸ ${l.origin??"å€¼"} æ‡‰ç‚º ${m}${l.maximum.toString()} ${x.unit??"å€‹å…ƒç´ "}`:`æ•¸å€¼éŽå¤§ï¼šé æœŸ ${l.origin??"å€¼"} æ‡‰ç‚º ${m}${l.maximum.toString()}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`æ•¸å€¼éŽå°ï¼šé æœŸ ${l.origin} æ‡‰ç‚º ${m}${l.minimum.toString()} ${x.unit}`:`æ•¸å€¼éŽå°ï¼šé æœŸ ${l.origin} æ‡‰ç‚º ${m}${l.minimum.toString()}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`ç„¡æ•ˆçš„å­—ä¸²ï¼šå¿…é ˆä»¥ "${m.prefix}" é–‹é ­`:m.format==="ends_with"?`ç„¡æ•ˆçš„å­—ä¸²ï¼šå¿…é ˆä»¥ "${m.suffix}" çµå°¾`:m.format==="includes"?`ç„¡æ•ˆçš„å­—ä¸²ï¼šå¿…é ˆåŒ…å« "${m.includes}"`:m.format==="regex"?`ç„¡æ•ˆçš„å­—ä¸²ï¼šå¿…é ˆç¬¦åˆæ ¼å¼ ${m.pattern}`:`ç„¡æ•ˆçš„ ${o[m.format]??l.format}`}case"not_multiple_of":return`ç„¡æ•ˆçš„æ•¸å­—ï¼šå¿…é ˆç‚º ${l.divisor} çš„å€æ•¸`;case"unrecognized_keys":return`ç„¡æ³•è­˜åˆ¥çš„éµå€¼${l.keys.length>1?"å€‘":""}ï¼š${si(l.keys,"ã€")}`;case"invalid_key":return`${l.origin} ä¸­æœ‰ç„¡æ•ˆçš„éµå€¼`;case"invalid_union":return"ç„¡æ•ˆçš„è¼¸å…¥å€¼";case"invalid_element":return`${l.origin} ä¸­æœ‰ç„¡æ•ˆçš„å€¼`;default:return"ç„¡æ•ˆçš„è¼¸å…¥å€¼"}}};function _X(){return{localeError:gX()}}var yX=()=>{let i={string:{unit:"Ã mi",verb:"nÃ­"},file:{unit:"bytes",verb:"nÃ­"},array:{unit:"nkan",verb:"nÃ­"},set:{unit:"nkan",verb:"nÃ­"}};function e(l){return i[l]??null}let o={regex:"áº¹Ì€rá» Ã¬bÃ¡wá»lÃ©",email:"Ã dÃ­ráº¹ÌsÃ¬ Ã¬máº¹ÌlÃ¬",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"Ã kÃ³kÃ² ISO",date:"á»já»Ì ISO",time:"Ã kÃ³kÃ² ISO",duration:"Ã kÃ³kÃ² tÃ³ pÃ© ISO",ipv4:"Ã dÃ­ráº¹ÌsÃ¬ IPv4",ipv6:"Ã dÃ­ráº¹ÌsÃ¬ IPv6",cidrv4:"Ã gbÃ¨gbÃ¨ IPv4",cidrv6:"Ã gbÃ¨gbÃ¨ IPv6",base64:"á»Ì€rá»Ì€ tÃ­ a ká»Ì nÃ­ base64",base64url:"á»Ì€rá»Ì€ base64url",json_string:"á»Ì€rá»Ì€ JSON",e164:"ná»ÌmbÃ  E.164",jwt:"JWT",template_literal:"áº¹Ì€rá» Ã¬bÃ¡wá»lÃ©"},h={nan:"NaN",number:"ná»ÌmbÃ ",array:"akopá»"};return l=>{switch(l.code){case"invalid_type":{let m=h[l.expected]??l.expected,x=Sn(l.input),s=h[x]??x;return/^[A-Z]/.test(l.expected)?`ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e: a nÃ­ lÃ¡ti fi instanceof ${l.expected}, Ã má»Ì€ a rÃ­ ${s}`:`ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e: a nÃ­ lÃ¡ti fi ${m}, Ã má»Ì€ a rÃ­ ${s}`}case"invalid_value":return l.values.length===1?`ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e: a nÃ­ lÃ¡ti fi ${vn(l.values[0])}`:`Ã€á¹£Ã yÃ n aá¹£Ã¬á¹£e: yan á»Ì€kan lÃ¡ra ${si(l.values,"|")}`;case"too_big":{let m=l.inclusive?"<=":"<",x=e(l.origin);return x?`TÃ³ pá»Ì€ jÃ¹: a nÃ­ lÃ¡ti jáº¹Ì pÃ© ${l.origin??"iye"} ${x.verb} ${m}${l.maximum} ${x.unit}`:`TÃ³ pá»Ì€ jÃ¹: a nÃ­ lÃ¡ti jáº¹Ì ${m}${l.maximum}`}case"too_small":{let m=l.inclusive?">=":">",x=e(l.origin);return x?`KÃ©rÃ© ju: a nÃ­ lÃ¡ti jáº¹Ì pÃ© ${l.origin} ${x.verb} ${m}${l.minimum} ${x.unit}`:`KÃ©rÃ© ju: a nÃ­ lÃ¡ti jáº¹Ì ${m}${l.minimum}`}case"invalid_format":{let m=l;return m.format==="starts_with"?`á»ŒÌ€rá»Ì€ aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ báº¹Ì€ráº¹Ì€ páº¹Ì€lÃº "${m.prefix}"`:m.format==="ends_with"?`á»ŒÌ€rá»Ì€ aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ parÃ­ páº¹Ì€lÃº "${m.suffix}"`:m.format==="includes"?`á»ŒÌ€rá»Ì€ aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ nÃ­ "${m.includes}"`:m.format==="regex"?`á»ŒÌ€rá»Ì€ aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ bÃ¡ Ã páº¹áº¹ráº¹ mu ${m.pattern}`:`Aá¹£Ã¬á¹£e: ${o[m.format]??l.format}`}case"not_multiple_of":return`Ná»ÌmbÃ  aá¹£Ã¬á¹£e: gbá»Ìdá»Ì€ jáº¹Ì Ã¨yÃ  pÃ­pÃ­n ti ${l.divisor}`;case"unrecognized_keys":return`Bá»tÃ¬nÃ¬ Ã Ã¬má»Ì€: ${si(l.keys,", ")}`;case"invalid_key":return`Bá»tÃ¬nÃ¬ aá¹£Ã¬á¹£e nÃ­nÃº ${l.origin}`;case"invalid_union":return"ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e";case"invalid_element":return`Iye aá¹£Ã¬á¹£e nÃ­nÃº ${l.origin}`;default:return"ÃŒbÃ¡wá»lÃ© aá¹£Ã¬á¹£e"}}};function vX(){return{localeError:yX()}}var MR,iO=Symbol("ZodOutput"),nO=Symbol("ZodInput");class rO{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...o){let h=o[0];return this._map.set(e,h),h&&typeof h=="object"&&"id"in h&&this._idmap.set(h.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let o=this._map.get(e);return o&&typeof o=="object"&&"id"in o&&this._idmap.delete(o.id),this._map.delete(e),this}get(e){let o=e._zod.parent;if(o){let h={...this.get(o)??{}};delete h.id;let l={...h,...this._map.get(e)};return Object.keys(l).length?l:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function wI(){return new rO}(MR=globalThis).__zod_globalRegistry??(MR.__zod_globalRegistry=wI());var qa=globalThis.__zod_globalRegistry;function oO(i,e){return new i({type:"string",...ci(e)})}function sO(i,e){return new i({type:"string",coerce:!0,...ci(e)})}function SI(i,e){return new i({type:"string",format:"email",check:"string_format",abort:!1,...ci(e)})}function ob(i,e){return new i({type:"string",format:"guid",check:"string_format",abort:!1,...ci(e)})}function TI(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,...ci(e)})}function EI(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...ci(e)})}function II(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...ci(e)})}function MI(i,e){return new i({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...ci(e)})}function $b(i,e){return new i({type:"string",format:"url",check:"string_format",abort:!1,...ci(e)})}function AI(i,e){return new i({type:"string",format:"emoji",check:"string_format",abort:!1,...ci(e)})}function PI(i,e){return new i({type:"string",format:"nanoid",check:"string_format",abort:!1,...ci(e)})}function zI(i,e){return new i({type:"string",format:"cuid",check:"string_format",abort:!1,...ci(e)})}function CI(i,e){return new i({type:"string",format:"cuid2",check:"string_format",abort:!1,...ci(e)})}function RI(i,e){return new i({type:"string",format:"ulid",check:"string_format",abort:!1,...ci(e)})}function LI(i,e){return new i({type:"string",format:"xid",check:"string_format",abort:!1,...ci(e)})}function DI(i,e){return new i({type:"string",format:"ksuid",check:"string_format",abort:!1,...ci(e)})}function kI(i,e){return new i({type:"string",format:"ipv4",check:"string_format",abort:!1,...ci(e)})}function OI(i,e){return new i({type:"string",format:"ipv6",check:"string_format",abort:!1,...ci(e)})}function aO(i,e){return new i({type:"string",format:"mac",check:"string_format",abort:!1,...ci(e)})}function FI(i,e){return new i({type:"string",format:"cidrv4",check:"string_format",abort:!1,...ci(e)})}function BI(i,e){return new i({type:"string",format:"cidrv6",check:"string_format",abort:!1,...ci(e)})}function NI(i,e){return new i({type:"string",format:"base64",check:"string_format",abort:!1,...ci(e)})}function UI(i,e){return new i({type:"string",format:"base64url",check:"string_format",abort:!1,...ci(e)})}function $I(i,e){return new i({type:"string",format:"e164",check:"string_format",abort:!1,...ci(e)})}function VI(i,e){return new i({type:"string",format:"jwt",check:"string_format",abort:!1,...ci(e)})}var lO={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function cO(i,e){return new i({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...ci(e)})}function uO(i,e){return new i({type:"string",format:"date",check:"string_format",...ci(e)})}function hO(i,e){return new i({type:"string",format:"time",check:"string_format",precision:null,...ci(e)})}function dO(i,e){return new i({type:"string",format:"duration",check:"string_format",...ci(e)})}function fO(i,e){return new i({type:"number",checks:[],...ci(e)})}function pO(i,e){return new i({type:"number",coerce:!0,checks:[],...ci(e)})}function mO(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"safeint",...ci(e)})}function gO(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"float32",...ci(e)})}function _O(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"float64",...ci(e)})}function yO(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"int32",...ci(e)})}function vO(i,e){return new i({type:"number",check:"number_format",abort:!1,format:"uint32",...ci(e)})}function xO(i,e){return new i({type:"boolean",...ci(e)})}function bO(i,e){return new i({type:"boolean",coerce:!0,...ci(e)})}function wO(i,e){return new i({type:"bigint",...ci(e)})}function SO(i,e){return new i({type:"bigint",coerce:!0,...ci(e)})}function TO(i,e){return new i({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...ci(e)})}function EO(i,e){return new i({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...ci(e)})}function IO(i,e){return new i({type:"symbol",...ci(e)})}function MO(i,e){return new i({type:"undefined",...ci(e)})}function AO(i,e){return new i({type:"null",...ci(e)})}function PO(i){return new i({type:"any"})}function zO(i){return new i({type:"unknown"})}function CO(i,e){return new i({type:"never",...ci(e)})}function RO(i,e){return new i({type:"void",...ci(e)})}function LO(i,e){return new i({type:"date",...ci(e)})}function DO(i,e){return new i({type:"date",coerce:!0,...ci(e)})}function kO(i,e){return new i({type:"nan",...ci(e)})}function qu(i,e){return new dI({check:"less_than",...ci(e),value:i,inclusive:!1})}function Xa(i,e){return new dI({check:"less_than",...ci(e),value:i,inclusive:!0})}function Xu(i,e){return new fI({check:"greater_than",...ci(e),value:i,inclusive:!1})}function aa(i,e){return new fI({check:"greater_than",...ci(e),value:i,inclusive:!0})}function jI(i){return Xu(0,i)}function GI(i){return qu(0,i)}function HI(i){return Xa(0,i)}function ZI(i){return aa(0,i)}function Cp(i,e){return new xk({check:"multiple_of",...ci(e),value:i})}function Zp(i,e){return new Sk({check:"max_size",...ci(e),maximum:i})}function Ju(i,e){return new Tk({check:"min_size",...ci(e),minimum:i})}function _y(i,e){return new Ek({check:"size_equals",...ci(e),size:i})}function yy(i,e){return new Ik({check:"max_length",...ci(e),maximum:i})}function gd(i,e){return new Mk({check:"min_length",...ci(e),minimum:i})}function vy(i,e){return new Ak({check:"length_equals",...ci(e),length:i})}function Vb(i,e){return new Pk({check:"string_format",format:"regex",...ci(e),pattern:i})}function jb(i){return new zk({check:"string_format",format:"lowercase",...ci(i)})}function Gb(i){return new Ck({check:"string_format",format:"uppercase",...ci(i)})}function Hb(i,e){return new Rk({check:"string_format",format:"includes",...ci(e),includes:i})}function Zb(i,e){return new Lk({check:"string_format",format:"starts_with",...ci(e),prefix:i})}function Wb(i,e){return new Dk({check:"string_format",format:"ends_with",...ci(e),suffix:i})}function WI(i,e,o){return new kk({check:"property",property:i,schema:e,...ci(o)})}function qb(i,e){return new Ok({check:"mime_type",mime:i,...ci(e)})}function jc(i){return new Fk({check:"overwrite",tx:i})}function Xb(i){return jc(e=>e.normalize(i))}function Jb(){return jc(i=>i.trim())}function Yb(){return jc(i=>i.toLowerCase())}function Kb(){return jc(i=>i.toUpperCase())}function Qb(){return jc(i=>MD(i))}function OO(i,e,o){return new i({type:"array",element:e,...ci(o)})}function xX(i,e,o){return new i({type:"union",options:e,...ci(o)})}function bX(i,e,o){return new i({type:"union",options:e,inclusive:!1,...ci(o)})}function wX(i,e,o,h){return new i({type:"union",options:o,discriminator:e,...ci(h)})}function SX(i,e,o){return new i({type:"intersection",left:e,right:o})}function TX(i,e,o,h){let l=o instanceof Ln;return new i({type:"tuple",items:e,rest:l?o:null,...ci(l?h:o)})}function EX(i,e,o,h){return new i({type:"record",keyType:e,valueType:o,...ci(h)})}function IX(i,e,o,h){return new i({type:"map",keyType:e,valueType:o,...ci(h)})}function MX(i,e,o){return new i({type:"set",valueType:e,...ci(o)})}function AX(i,e,o){let h=Array.isArray(e)?Object.fromEntries(e.map(l=>[l,l])):e;return new i({type:"enum",entries:h,...ci(o)})}function PX(i,e,o){return new i({type:"enum",entries:e,...ci(o)})}function zX(i,e,o){return new i({type:"literal",values:Array.isArray(e)?e:[e],...ci(o)})}function FO(i,e){return new i({type:"file",...ci(e)})}function CX(i,e){return new i({type:"transform",transform:e})}function RX(i,e){return new i({type:"optional",innerType:e})}function LX(i,e){return new i({type:"nullable",innerType:e})}function DX(i,e,o){return new i({type:"default",innerType:e,get defaultValue(){return typeof o=="function"?o():PD(o)}})}function kX(i,e,o){return new i({type:"nonoptional",innerType:e,...ci(o)})}function OX(i,e){return new i({type:"success",innerType:e})}function FX(i,e,o){return new i({type:"catch",innerType:e,catchValue:typeof o=="function"?o:()=>o})}function BX(i,e,o){return new i({type:"pipe",in:e,out:o})}function NX(i,e){return new i({type:"readonly",innerType:e})}function UX(i,e,o){return new i({type:"template_literal",parts:e,...ci(o)})}function $X(i,e){return new i({type:"lazy",getter:e})}function VX(i,e){return new i({type:"promise",innerType:e})}function BO(i,e,o){let h=ci(o);return h.abort??(h.abort=!0),new i({type:"custom",check:"custom",fn:e,...h})}function NO(i,e,o){return new i({type:"custom",check:"custom",fn:e,...ci(o)})}function UO(i){let e=$O(o=>(o.addIssue=h=>{if(typeof h=="string")o.issues.push(nb(h,o.value,e._zod.def));else{let l=h;l.fatal&&(l.continue=!1),l.code??(l.code="custom"),l.input??(l.input=o.value),l.inst??(l.inst=e),l.continue??(l.continue=!e._zod.def.abort),o.issues.push(nb(l))}},i(o.value,o)));return e}function $O(i,e){let o=new ro({check:"custom",...ci(e)});return o._zod.check=i,o}function VO(i){let e=new ro({check:"describe"});return e._zod.onattach=[o=>{let h=qa.get(o)??{};qa.add(o,{...h,description:i})}],e._zod.check=()=>{},e}function jO(i){let e=new ro({check:"meta"});return e._zod.onattach=[o=>{let h=qa.get(o)??{};qa.add(o,{...h,...i})}],e._zod.check=()=>{},e}function GO(i,e){let o=ci(e),h=o.truthy??["true","1","yes","on","y","enabled"],l=o.falsy??["false","0","no","off","n","disabled"];o.case!=="sensitive"&&(h=h.map(V=>typeof V=="string"?V.toLowerCase():V),l=l.map(V=>typeof V=="string"?V.toLowerCase():V));let m=new Set(h),x=new Set(l),s=i.Codec??xI,P=i.Boolean??gI,C=new(i.String??gy)({type:"string",error:o.error}),F=new P({type:"boolean",error:o.error}),O=new s({type:"pipe",in:C,out:F,transform:(V,J)=>{let ee=V;return o.case!=="sensitive"&&(ee=ee.toLowerCase()),m.has(ee)?!0:x.has(ee)?!1:(J.issues.push({code:"invalid_value",expected:"stringbool",values:[...m,...x],input:J.value,inst:O,continue:!1}),{})},reverseTransform:(V,J)=>V===!0?h[0]||"true":l[0]||"false",error:o.error});return O}function xy(i,e,o,h={}){let l=ci(h),m={...ci(h),check:"string_format",type:"string",format:e,fn:typeof o=="function"?o:x=>o.test(x),...l};return o instanceof RegExp&&(m.pattern=o),new i(m)}function Rp(i){let e=(i==null?void 0:i.target)??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:i.processors??{},metadataRegistry:(i==null?void 0:i.metadata)??qa,target:e,unrepresentable:(i==null?void 0:i.unrepresentable)??"throw",override:(i==null?void 0:i.override)??(()=>{}),io:(i==null?void 0:i.io)??"output",counter:0,seen:new Map,cycles:(i==null?void 0:i.cycles)??"ref",reused:(i==null?void 0:i.reused)??"inline",external:(i==null?void 0:i.external)??void 0}}function kr(i,e,o={path:[],schemaPath:[]}){var C,F;var h;let l=i._zod.def,m=e.seen.get(i);if(m)return m.count++,o.schemaPath.includes(i)&&(m.cycle=o.path),m.schema;let x={schema:{},count:1,cycle:void 0,path:o.path};e.seen.set(i,x);let s=(F=(C=i._zod).toJSONSchema)==null?void 0:F.call(C);if(s)x.schema=s;else{let O={...o,schemaPath:[...o.schemaPath,i],path:o.path};if(i._zod.processJSONSchema)i._zod.processJSONSchema(e,x.schema,O);else{let J=x.schema,ee=e.processors[l.type];if(!ee)throw Error(`[toJSONSchema]: Non-representable type encountered: ${l.type}`);ee(i,e,J,O)}let V=i._zod.parent;V&&(x.ref||(x.ref=V),kr(V,e,O),e.seen.get(V).isParent=!0)}let P=e.metadataRegistry.get(i);return P&&Object.assign(x.schema,P),e.io==="input"&&Js(i)&&(delete x.schema.examples,delete x.schema.default),e.io==="input"&&x.schema._prefault&&((h=x.schema).default??(h.default=x.schema._prefault)),delete x.schema._prefault,e.seen.get(i).schema}function Lp(i,e){var x,s,P,C;let o=i.seen.get(e);if(!o)throw Error("Unprocessed schema. This is a bug in Zod.");let h=new Map;for(let F of i.seen.entries()){let O=(x=i.metadataRegistry.get(F[0]))==null?void 0:x.id;if(O){let V=h.get(O);if(V&&V!==F[0])throw Error(`Duplicate schema id "${O}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);h.set(O,F[0])}}let l=F=>{var ee;let O=i.target==="draft-2020-12"?"$defs":"definitions";if(i.external){let se=(ee=i.external.registry.get(F[0]))==null?void 0:ee.id,fe=i.external.uri??(ie=>ie);if(se)return{ref:fe(se)};let le=F[1].defId??F[1].schema.id??`schema${i.counter++}`;return F[1].defId=le,{defId:le,ref:`${fe("__shared")}#/${O}/${le}`}}if(F[1]===o)return{ref:"#"};let V=`#/${O}/`,J=F[1].schema.id??`__schema${i.counter++}`;return{defId:J,ref:V+J}},m=F=>{if(F[1].schema.$ref)return;let O=F[1],{ref:V,defId:J}=l(F);O.def={...O.schema},J&&(O.defId=J);let ee=O.schema;for(let se in ee)delete ee[se];ee.$ref=V};if(i.cycles==="throw")for(let F of i.seen.entries()){let O=F[1];if(O.cycle)throw Error(`Cycle detected: #/${(s=O.cycle)==null?void 0:s.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let F of i.seen.entries()){let O=F[1];if(e===F[0]){m(F);continue}if(i.external){let V=(P=i.external.registry.get(F[0]))==null?void 0:P.id;if(e!==F[0]&&V){m(F);continue}}if((C=i.metadataRegistry.get(F[0]))!=null&&C.id){m(F);continue}if(O.cycle){m(F);continue}if(O.count>1&&i.reused==="ref"){m(F);continue}}}function Dp(i,e){var x,s,P;let o=i.seen.get(e);if(!o)throw Error("Unprocessed schema. This is a bug in Zod.");let h=C=>{let F=i.seen.get(C);if(F.ref===null)return;let O=F.def??F.schema,V={...O},J=F.ref;if(F.ref=null,J){h(J);let se=i.seen.get(J),fe=se.schema;if(fe.$ref&&(i.target==="draft-07"||i.target==="draft-04"||i.target==="openapi-3.0")?(O.allOf=O.allOf??[],O.allOf.push(fe)):Object.assign(O,fe),Object.assign(O,V),C._zod.parent===J)for(let le in O)le==="$ref"||le==="allOf"||le in V||delete O[le];if(fe.$ref)for(let le in O)le==="$ref"||le==="allOf"||le in se.def&&JSON.stringify(O[le])===JSON.stringify(se.def[le])&&delete O[le]}let ee=C._zod.parent;if(ee&&ee!==J){h(ee);let se=i.seen.get(ee);if(se!=null&&se.schema.$ref&&(O.$ref=se.schema.$ref,se.def))for(let fe in O)fe==="$ref"||fe==="allOf"||fe in se.def&&JSON.stringify(O[fe])===JSON.stringify(se.def[fe])&&delete O[fe]}i.override({zodSchema:C,jsonSchema:O,path:F.path??[]})};for(let C of[...i.seen.entries()].reverse())h(C[0]);let l={};if(i.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":i.target==="draft-07"?l.$schema="http://json-schema.org/draft-07/schema#":i.target==="draft-04"?l.$schema="http://json-schema.org/draft-04/schema#":i.target,(x=i.external)!=null&&x.uri){let C=(s=i.external.registry.get(e))==null?void 0:s.id;if(!C)throw Error("Schema is missing an `id` property");l.$id=i.external.uri(C)}Object.assign(l,o.def??o.schema);let m=((P=i.external)==null?void 0:P.defs)??{};for(let C of i.seen.entries()){let F=C[1];F.def&&F.defId&&(m[F.defId]=F.def)}i.external||Object.keys(m).length>0&&(i.target==="draft-2020-12"?l.$defs=m:l.definitions=m);try{let C=JSON.parse(JSON.stringify(l));return Object.defineProperty(C,"~standard",{value:{...e["~standard"],jsonSchema:{input:C_(e,"input",i.processors),output:C_(e,"output",i.processors)}},enumerable:!1,writable:!1}),C}catch{throw Error("Error converting schema to JSON.")}}function Js(i,e){let o=e??{seen:new Set};if(o.seen.has(i))return!1;o.seen.add(i);let h=i._zod.def;if(h.type==="transform")return!0;if(h.type==="array")return Js(h.element,o);if(h.type==="set")return Js(h.valueType,o);if(h.type==="lazy")return Js(h.getter(),o);if(h.type==="promise"||h.type==="optional"||h.type==="nonoptional"||h.type==="nullable"||h.type==="readonly"||h.type==="default"||h.type==="prefault")return Js(h.innerType,o);if(h.type==="intersection")return Js(h.left,o)||Js(h.right,o);if(h.type==="record"||h.type==="map")return Js(h.keyType,o)||Js(h.valueType,o);if(h.type==="pipe")return Js(h.in,o)||Js(h.out,o);if(h.type==="object"){for(let l in h.shape)if(Js(h.shape[l],o))return!0;return!1}if(h.type==="union"){for(let l of h.options)if(Js(l,o))return!0;return!1}if(h.type==="tuple"){for(let l of h.items)if(Js(l,o))return!0;return!!(h.rest&&Js(h.rest,o))}return!1}var HO=(i,e={})=>o=>{let h=Rp({...o,processors:e});return kr(i,h),Lp(h,i),Dp(h,i)},C_=(i,e,o={})=>h=>{let{libraryOptions:l,target:m}=h??{},x=Rp({...l??{},target:m,io:e,processors:o});return kr(i,x),Lp(x,i),Dp(x,i)},jX={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},ZO=(i,e,o,h)=>{let l=o;l.type="string";let{minimum:m,maximum:x,format:s,patterns:P,contentEncoding:C}=i._zod.bag;if(typeof m=="number"&&(l.minLength=m),typeof x=="number"&&(l.maxLength=x),s&&(l.format=jX[s]??s,l.format===""&&delete l.format,s==="time"&&delete l.format),C&&(l.contentEncoding=C),P&&P.size>0){let F=[...P];F.length===1?l.pattern=F[0].source:F.length>1&&(l.allOf=[...F.map(O=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:O.source}))])}},WO=(i,e,o,h)=>{let l=o,{minimum:m,maximum:x,format:s,multipleOf:P,exclusiveMaximum:C,exclusiveMinimum:F}=i._zod.bag;typeof s=="string"&&s.includes("int")?l.type="integer":l.type="number",typeof F=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(l.minimum=F,l.exclusiveMinimum=!0):l.exclusiveMinimum=F),typeof m=="number"&&(l.minimum=m,typeof F=="number"&&e.target!=="draft-04"&&(F>=m?delete l.minimum:delete l.exclusiveMinimum)),typeof C=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(l.maximum=C,l.exclusiveMaximum=!0):l.exclusiveMaximum=C),typeof x=="number"&&(l.maximum=x,typeof C=="number"&&e.target!=="draft-04"&&(C<=x?delete l.maximum:delete l.exclusiveMaximum)),typeof P=="number"&&(l.multipleOf=P)},qO=(i,e,o,h)=>{o.type="boolean"},XO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("BigInt cannot be represented in JSON Schema")},JO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Symbols cannot be represented in JSON Schema")},YO=(i,e,o,h)=>{e.target==="openapi-3.0"?(o.type="string",o.nullable=!0,o.enum=[null]):o.type="null"},KO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Undefined cannot be represented in JSON Schema")},QO=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Void cannot be represented in JSON Schema")},eF=(i,e,o,h)=>{o.not={}},tF=(i,e,o,h)=>{},iF=(i,e,o,h)=>{},nF=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Date cannot be represented in JSON Schema")},rF=(i,e,o,h)=>{let l=i._zod.def,m=YE(l.entries);m.every(x=>typeof x=="number")&&(o.type="number"),m.every(x=>typeof x=="string")&&(o.type="string"),o.enum=m},oF=(i,e,o,h)=>{let l=i._zod.def,m=[];for(let x of l.values)if(x===void 0){if(e.unrepresentable==="throw")throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof x=="bigint"){if(e.unrepresentable==="throw")throw Error("BigInt literals cannot be represented in JSON Schema");m.push(Number(x))}else m.push(x);if(m.length!==0)if(m.length===1){let x=m[0];o.type=x===null?"null":typeof x,e.target==="draft-04"||e.target==="openapi-3.0"?o.enum=[x]:o.const=x}else m.every(x=>typeof x=="number")&&(o.type="number"),m.every(x=>typeof x=="string")&&(o.type="string"),m.every(x=>typeof x=="boolean")&&(o.type="boolean"),m.every(x=>x===null)&&(o.type="null"),o.enum=m},sF=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("NaN cannot be represented in JSON Schema")},aF=(i,e,o,h)=>{let l=o,m=i._zod.pattern;if(!m)throw Error("Pattern not found in template literal");l.type="string",l.pattern=m.source},lF=(i,e,o,h)=>{let l=o,m={type:"string",format:"binary",contentEncoding:"binary"},{minimum:x,maximum:s,mime:P}=i._zod.bag;x!==void 0&&(m.minLength=x),s!==void 0&&(m.maxLength=s),P?P.length===1?(m.contentMediaType=P[0],Object.assign(l,m)):(Object.assign(l,m),l.anyOf=P.map(C=>({contentMediaType:C}))):Object.assign(l,m)},cF=(i,e,o,h)=>{o.type="boolean"},uF=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Custom types cannot be represented in JSON Schema")},hF=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Function types cannot be represented in JSON Schema")},dF=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Transforms cannot be represented in JSON Schema")},fF=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Map cannot be represented in JSON Schema")},pF=(i,e,o,h)=>{if(e.unrepresentable==="throw")throw Error("Set cannot be represented in JSON Schema")},mF=(i,e,o,h)=>{let l=o,m=i._zod.def,{minimum:x,maximum:s}=i._zod.bag;typeof x=="number"&&(l.minItems=x),typeof s=="number"&&(l.maxItems=s),l.type="array",l.items=kr(m.element,e,{...h,path:[...h.path,"items"]})},gF=(i,e,o,h)=>{var C;let l=o,m=i._zod.def;l.type="object",l.properties={};let x=m.shape;for(let F in x)l.properties[F]=kr(x[F],e,{...h,path:[...h.path,"properties",F]});let s=new Set(Object.keys(x)),P=new Set([...s].filter(F=>{let O=m.shape[F]._zod;return e.io==="input"?O.optin===void 0:O.optout===void 0}));P.size>0&&(l.required=Array.from(P)),((C=m.catchall)==null?void 0:C._zod.def.type)==="never"?l.additionalProperties=!1:m.catchall?m.catchall&&(l.additionalProperties=kr(m.catchall,e,{...h,path:[...h.path,"additionalProperties"]})):e.io==="output"&&(l.additionalProperties=!1)},qI=(i,e,o,h)=>{let l=i._zod.def,m=l.inclusive===!1,x=l.options.map((s,P)=>kr(s,e,{...h,path:[...h.path,m?"oneOf":"anyOf",P]}));m?o.oneOf=x:o.anyOf=x},_F=(i,e,o,h)=>{let l=i._zod.def,m=kr(l.left,e,{...h,path:[...h.path,"allOf",0]}),x=kr(l.right,e,{...h,path:[...h.path,"allOf",1]}),s=C=>"allOf"in C&&Object.keys(C).length===1,P=[...s(m)?m.allOf:[m],...s(x)?x.allOf:[x]];o.allOf=P},yF=(i,e,o,h)=>{let l=o,m=i._zod.def;l.type="array";let x=e.target==="draft-2020-12"?"prefixItems":"items",s=e.target==="draft-2020-12"||e.target==="openapi-3.0"?"items":"additionalItems",P=m.items.map((V,J)=>kr(V,e,{...h,path:[...h.path,x,J]})),C=m.rest?kr(m.rest,e,{...h,path:[...h.path,s,...e.target==="openapi-3.0"?[m.items.length]:[]]}):null;e.target==="draft-2020-12"?(l.prefixItems=P,C&&(l.items=C)):e.target==="openapi-3.0"?(l.items={anyOf:P},C&&l.items.anyOf.push(C),l.minItems=P.length,!C&&(l.maxItems=P.length)):(l.items=P,C&&(l.additionalItems=C));let{minimum:F,maximum:O}=i._zod.bag;typeof F=="number"&&(l.minItems=F),typeof O=="number"&&(l.maxItems=O)},vF=(i,e,o,h)=>{var C;let l=o,m=i._zod.def;l.type="object";let x=m.keyType,s=(C=x._zod.bag)==null?void 0:C.patterns;if(m.mode==="loose"&&s&&s.size>0){let F=kr(m.valueType,e,{...h,path:[...h.path,"patternProperties","*"]});l.patternProperties={};for(let O of s)l.patternProperties[O.source]=F}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(l.propertyNames=kr(m.keyType,e,{...h,path:[...h.path,"propertyNames"]})),l.additionalProperties=kr(m.valueType,e,{...h,path:[...h.path,"additionalProperties"]});let P=x._zod.values;if(P){let F=[...P].filter(O=>typeof O=="string"||typeof O=="number");F.length>0&&(l.required=F)}},xF=(i,e,o,h)=>{let l=i._zod.def,m=kr(l.innerType,e,h),x=e.seen.get(i);e.target==="openapi-3.0"?(x.ref=l.innerType,o.nullable=!0):o.anyOf=[m,{type:"null"}]},bF=(i,e,o,h)=>{let l=i._zod.def;kr(l.innerType,e,h);let m=e.seen.get(i);m.ref=l.innerType},wF=(i,e,o,h)=>{let l=i._zod.def;kr(l.innerType,e,h);let m=e.seen.get(i);m.ref=l.innerType,o.default=JSON.parse(JSON.stringify(l.defaultValue))},SF=(i,e,o,h)=>{let l=i._zod.def;kr(l.innerType,e,h);let m=e.seen.get(i);m.ref=l.innerType,e.io==="input"&&(o._prefault=JSON.parse(JSON.stringify(l.defaultValue)))},TF=(i,e,o,h)=>{let l=i._zod.def;kr(l.innerType,e,h);let m=e.seen.get(i);m.ref=l.innerType;let x;try{x=l.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}o.default=x},EF=(i,e,o,h)=>{let l=i._zod.def,m=e.io==="input"?l.in._zod.def.type==="transform"?l.out:l.in:l.out;kr(m,e,h);let x=e.seen.get(i);x.ref=m},IF=(i,e,o,h)=>{let l=i._zod.def;kr(l.innerType,e,h);let m=e.seen.get(i);m.ref=l.innerType,o.readOnly=!0},MF=(i,e,o,h)=>{let l=i._zod.def;kr(l.innerType,e,h);let m=e.seen.get(i);m.ref=l.innerType},XI=(i,e,o,h)=>{let l=i._zod.def;kr(l.innerType,e,h);let m=e.seen.get(i);m.ref=l.innerType},AF=(i,e,o,h)=>{let l=i._zod.innerType;kr(l,e,h);let m=e.seen.get(i);m.ref=l},OT={string:ZO,number:WO,boolean:qO,bigint:XO,symbol:JO,null:YO,undefined:KO,void:QO,never:eF,any:tF,unknown:iF,date:nF,enum:rF,literal:oF,nan:sF,template_literal:aF,file:lF,success:cF,custom:uF,function:hF,transform:dF,map:fF,set:pF,array:mF,object:gF,union:qI,intersection:_F,tuple:yF,record:vF,nullable:xF,nonoptional:bF,default:wF,prefault:SF,catch:TF,pipe:EF,readonly:IF,promise:MF,optional:XI,lazy:AF};function PF(i,e){if("_idmap"in i){let h=i,l=Rp({...e,processors:OT}),m={};for(let P of h._idmap.entries()){let[C,F]=P;kr(F,l)}let x={},s={registry:h,uri:e==null?void 0:e.uri,defs:m};l.external=s;for(let P of h._idmap.entries()){let[C,F]=P;Lp(l,F),x[C]=Dp(l,F)}if(Object.keys(m).length>0){let P=l.target==="draft-2020-12"?"$defs":"definitions";x.__shared={[P]:m}}return{schemas:x}}let o=Rp({...e,processors:OT});return kr(i,o),Lp(o,i),Dp(o,i)}class GX{get metadataRegistry(){return this.ctx.metadataRegistry}get target(){return this.ctx.target}get unrepresentable(){return this.ctx.unrepresentable}get override(){return this.ctx.override}get io(){return this.ctx.io}get counter(){return this.ctx.counter}set counter(e){this.ctx.counter=e}get seen(){return this.ctx.seen}constructor(e){let o=(e==null?void 0:e.target)??"draft-2020-12";o==="draft-4"&&(o="draft-04"),o==="draft-7"&&(o="draft-07"),this.ctx=Rp({processors:OT,target:o,...(e==null?void 0:e.metadata)&&{metadata:e.metadata},...(e==null?void 0:e.unrepresentable)&&{unrepresentable:e.unrepresentable},...(e==null?void 0:e.override)&&{override:e.override},...(e==null?void 0:e.io)&&{io:e.io}})}process(e,o={path:[],schemaPath:[]}){return kr(e,this.ctx,o)}emit(e,o){o&&(o.cycles&&(this.ctx.cycles=o.cycles),o.reused&&(this.ctx.reused=o.reused),o.external&&(this.ctx.external=o.external)),Lp(this.ctx,e);let h=Dp(this.ctx,e),{"~standard":l,...m}=h;return m}}var HX={},zF={};$c(zF,{xor:()=>NB,xid:()=>lB,void:()=>LB,uuidv7:()=>eB,uuidv6:()=>QF,uuidv4:()=>KF,uuid:()=>YF,url:()=>tB,unknown:()=>_d,union:()=>xw,undefined:()=>CB,ulid:()=>aB,uint64:()=>PB,uint32:()=>IB,tuple:()=>yM,transform:()=>ww,templateLiteral:()=>KB,symbol:()=>zB,superRefine:()=>HM,success:()=>XB,stringbool:()=>o4,stringFormat:()=>vB,string:()=>sb,strictObject:()=>FB,set:()=>GB,refine:()=>GM,record:()=>vM,readonly:()=>BM,promise:()=>QB,preprocess:()=>a4,prefault:()=>CM,pipe:()=>k_,partialRecord:()=>$B,optional:()=>L_,object:()=>OB,number:()=>iM,nullish:()=>qB,nullable:()=>D_,null:()=>aM,nonoptional:()=>RM,never:()=>yw,nativeEnum:()=>HB,nanoid:()=>rB,nan:()=>JB,meta:()=>n4,map:()=>jB,mac:()=>hB,looseRecord:()=>VB,looseObject:()=>BB,literal:()=>ZB,lazy:()=>$M,ksuid:()=>cB,keyof:()=>kB,jwt:()=>yB,json:()=>s4,ipv6:()=>dB,ipv4:()=>uB,intersection:()=>gM,int64:()=>AB,int32:()=>EB,int:()=>ab,instanceof:()=>r4,httpUrl:()=>iB,hostname:()=>xB,hex:()=>bB,hash:()=>wB,guid:()=>JF,function:()=>lb,float64:()=>TB,float32:()=>SB,file:()=>WB,exactOptional:()=>IM,enum:()=>bw,emoji:()=>nB,email:()=>XF,e164:()=>_B,discriminatedUnion:()=>UB,describe:()=>i4,date:()=>DB,custom:()=>t4,cuid2:()=>sB,cuid:()=>oB,codec:()=>YB,cidrv6:()=>pB,cidrv4:()=>fB,check:()=>e4,catch:()=>kM,boolean:()=>nM,bigint:()=>MB,base64url:()=>gB,base64:()=>mB,array:()=>Iy,any:()=>RB,_function:()=>lb,_default:()=>PM,_ZodString:()=>ew,ZodXor:()=>fM,ZodXID:()=>aw,ZodVoid:()=>hM,ZodUnknown:()=>cM,ZodUnion:()=>Ay,ZodUndefined:()=>oM,ZodUUID:()=>ac,ZodURL:()=>wy,ZodULID:()=>sw,ZodType:()=>Bn,ZodTuple:()=>_M,ZodTransform:()=>TM,ZodTemplateLiteral:()=>NM,ZodSymbol:()=>rM,ZodSuccess:()=>LM,ZodStringFormat:()=>Br,ZodString:()=>by,ZodSet:()=>bM,ZodRecord:()=>Py,ZodReadonly:()=>FM,ZodPromise:()=>VM,ZodPrefault:()=>zM,ZodPipe:()=>Ew,ZodOptional:()=>Sw,ZodObject:()=>My,ZodNumberFormat:()=>Sd,ZodNumber:()=>Sy,ZodNullable:()=>MM,ZodNull:()=>sM,ZodNonOptional:()=>Tw,ZodNever:()=>uM,ZodNanoID:()=>nw,ZodNaN:()=>OM,ZodMap:()=>xM,ZodMAC:()=>tM,ZodLiteral:()=>wM,ZodLazy:()=>UM,ZodKSUID:()=>lw,ZodJWT:()=>gw,ZodIntersection:()=>mM,ZodIPv6:()=>uw,ZodIPv4:()=>cw,ZodGUID:()=>R_,ZodFunction:()=>jM,ZodFile:()=>SM,ZodExactOptional:()=>EM,ZodEnum:()=>kp,ZodEmoji:()=>iw,ZodEmail:()=>tw,ZodE164:()=>mw,ZodDiscriminatedUnion:()=>pM,ZodDefault:()=>AM,ZodDate:()=>vw,ZodCustomStringFormat:()=>Wp,ZodCustom:()=>zy,ZodCodec:()=>Iw,ZodCatch:()=>DM,ZodCUID2:()=>ow,ZodCUID:()=>rw,ZodCIDRv6:()=>dw,ZodCIDRv4:()=>hw,ZodBoolean:()=>Ty,ZodBigIntFormat:()=>_w,ZodBigInt:()=>Ey,ZodBase64URL:()=>pw,ZodBase64:()=>fw,ZodArray:()=>dM,ZodAny:()=>lM});var CF={};$c(CF,{uppercase:()=>Gb,trim:()=>Jb,toUpperCase:()=>Kb,toLowerCase:()=>Yb,startsWith:()=>Zb,slugify:()=>Qb,size:()=>_y,regex:()=>Vb,property:()=>WI,positive:()=>jI,overwrite:()=>jc,normalize:()=>Xb,nonpositive:()=>HI,nonnegative:()=>ZI,negative:()=>GI,multipleOf:()=>Cp,minSize:()=>Ju,minLength:()=>gd,mime:()=>qb,maxSize:()=>Zp,maxLength:()=>yy,lte:()=>Xa,lt:()=>qu,lowercase:()=>jb,length:()=>vy,includes:()=>Hb,gte:()=>aa,gt:()=>Xu,endsWith:()=>Wb});var JI={};$c(JI,{time:()=>DF,duration:()=>kF,datetime:()=>RF,date:()=>LF,ZodISOTime:()=>QI,ZodISODuration:()=>eM,ZodISODateTime:()=>YI,ZodISODate:()=>KI});var YI=mt("ZodISODateTime",(i,e)=>{Yk.init(i,e),Br.init(i,e)});function RF(i){return cO(YI,i)}var KI=mt("ZodISODate",(i,e)=>{Kk.init(i,e),Br.init(i,e)});function LF(i){return uO(KI,i)}var QI=mt("ZodISOTime",(i,e)=>{Qk.init(i,e),Br.init(i,e)});function DF(i){return hO(QI,i)}var eM=mt("ZodISODuration",(i,e)=>{e3.init(i,e),Br.init(i,e)});function kF(i){return dO(eM,i)}var OF=(i,e)=>{QE.init(i,e),i.name="ZodError",Object.defineProperties(i,{format:{value:o=>tI(i,o)},flatten:{value:o=>eI(i,o)},addIssue:{value:o=>{i.issues.push(o),i.message=JSON.stringify(i.issues,tb,2)}},addIssues:{value:o=>{i.issues.push(...o),i.message=JSON.stringify(i.issues,tb,2)}},isEmpty:{get(){return i.issues.length===0}}})},ZX=mt("ZodError",OF),Ca=mt("ZodError",OF,{Parent:Error}),FF=cy(Ca),BF=uy(Ca),NF=hy(Ca),UF=dy(Ca),$F=iI(Ca),VF=nI(Ca),jF=rI(Ca),GF=oI(Ca),HF=sI(Ca),ZF=aI(Ca),WF=lI(Ca),qF=cI(Ca),Bn=mt("ZodType",(i,e)=>(Ln.init(i,e),Object.assign(i["~standard"],{jsonSchema:{input:C_(i,"input"),output:C_(i,"output")}}),i.toJSONSchema=HO(i,{}),i.def=e,i.type=e.type,Object.defineProperty(i,"_def",{value:e}),i.check=(...o)=>i.clone(Kn.mergeDefs(e,{checks:[...e.checks??[],...o.map(h=>typeof h=="function"?{_zod:{check:h,def:{check:"custom"},onattach:[]}}:h)]}),{parent:!0}),i.with=i.check,i.clone=(o,h)=>il(i,o,h),i.brand=()=>i,i.register=(o,h)=>(o.add(i,h),i),i.parse=(o,h)=>FF(i,o,h,{callee:i.parse}),i.safeParse=(o,h)=>NF(i,o,h),i.parseAsync=async(o,h)=>BF(i,o,h,{callee:i.parseAsync}),i.safeParseAsync=async(o,h)=>UF(i,o,h),i.spa=i.safeParseAsync,i.encode=(o,h)=>$F(i,o,h),i.decode=(o,h)=>VF(i,o,h),i.encodeAsync=async(o,h)=>jF(i,o,h),i.decodeAsync=async(o,h)=>GF(i,o,h),i.safeEncode=(o,h)=>HF(i,o,h),i.safeDecode=(o,h)=>ZF(i,o,h),i.safeEncodeAsync=async(o,h)=>WF(i,o,h),i.safeDecodeAsync=async(o,h)=>qF(i,o,h),i.refine=(o,h)=>i.check(GM(o,h)),i.superRefine=o=>i.check(HM(o)),i.overwrite=o=>i.check(jc(o)),i.optional=()=>L_(i),i.exactOptional=()=>IM(i),i.nullable=()=>D_(i),i.nullish=()=>L_(D_(i)),i.nonoptional=o=>RM(i,o),i.array=()=>Iy(i),i.or=o=>xw([i,o]),i.and=o=>gM(i,o),i.transform=o=>k_(i,ww(o)),i.default=o=>PM(i,o),i.prefault=o=>CM(i,o),i.catch=o=>kM(i,o),i.pipe=o=>k_(i,o),i.readonly=()=>BM(i),i.describe=o=>{let h=i.clone();return qa.add(h,{description:o}),h},Object.defineProperty(i,"description",{get(){var o;return(o=qa.get(i))==null?void 0:o.description},configurable:!0}),i.meta=(...o)=>{if(o.length===0)return qa.get(i);let h=i.clone();return qa.add(h,o[0]),h},i.isOptional=()=>i.safeParse(void 0).success,i.isNullable=()=>i.safeParse(null).success,i.apply=o=>o(i),i)),ew=mt("_ZodString",(i,e)=>{gy.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(h,l,m)=>ZO(i,h,l);let o=i._zod.bag;i.format=o.format??null,i.minLength=o.minimum??null,i.maxLength=o.maximum??null,i.regex=(...h)=>i.check(Vb(...h)),i.includes=(...h)=>i.check(Hb(...h)),i.startsWith=(...h)=>i.check(Zb(...h)),i.endsWith=(...h)=>i.check(Wb(...h)),i.min=(...h)=>i.check(gd(...h)),i.max=(...h)=>i.check(yy(...h)),i.length=(...h)=>i.check(vy(...h)),i.nonempty=(...h)=>i.check(gd(1,...h)),i.lowercase=h=>i.check(jb(h)),i.uppercase=h=>i.check(Gb(h)),i.trim=()=>i.check(Jb()),i.normalize=(...h)=>i.check(Xb(...h)),i.toLowerCase=()=>i.check(Yb()),i.toUpperCase=()=>i.check(Kb()),i.slugify=()=>i.check(Qb())}),by=mt("ZodString",(i,e)=>{gy.init(i,e),ew.init(i,e),i.email=o=>i.check(SI(tw,o)),i.url=o=>i.check($b(wy,o)),i.jwt=o=>i.check(VI(gw,o)),i.emoji=o=>i.check(AI(iw,o)),i.guid=o=>i.check(ob(R_,o)),i.uuid=o=>i.check(TI(ac,o)),i.uuidv4=o=>i.check(EI(ac,o)),i.uuidv6=o=>i.check(II(ac,o)),i.uuidv7=o=>i.check(MI(ac,o)),i.nanoid=o=>i.check(PI(nw,o)),i.guid=o=>i.check(ob(R_,o)),i.cuid=o=>i.check(zI(rw,o)),i.cuid2=o=>i.check(CI(ow,o)),i.ulid=o=>i.check(RI(sw,o)),i.base64=o=>i.check(NI(fw,o)),i.base64url=o=>i.check(UI(pw,o)),i.xid=o=>i.check(LI(aw,o)),i.ksuid=o=>i.check(DI(lw,o)),i.ipv4=o=>i.check(kI(cw,o)),i.ipv6=o=>i.check(OI(uw,o)),i.cidrv4=o=>i.check(FI(hw,o)),i.cidrv6=o=>i.check(BI(dw,o)),i.e164=o=>i.check($I(mw,o)),i.datetime=o=>i.check(RF(o)),i.date=o=>i.check(LF(o)),i.time=o=>i.check(DF(o)),i.duration=o=>i.check(kF(o))});function sb(i){return oO(by,i)}var Br=mt("ZodStringFormat",(i,e)=>{Fr.init(i,e),ew.init(i,e)}),tw=mt("ZodEmail",(i,e)=>{Vk.init(i,e),Br.init(i,e)});function XF(i){return SI(tw,i)}var R_=mt("ZodGUID",(i,e)=>{Uk.init(i,e),Br.init(i,e)});function JF(i){return ob(R_,i)}var ac=mt("ZodUUID",(i,e)=>{$k.init(i,e),Br.init(i,e)});function YF(i){return TI(ac,i)}function KF(i){return EI(ac,i)}function QF(i){return II(ac,i)}function eB(i){return MI(ac,i)}var wy=mt("ZodURL",(i,e)=>{jk.init(i,e),Br.init(i,e)});function tB(i){return $b(wy,i)}function iB(i){return $b(wy,{protocol:/^https?$/,hostname:wd.domain,...Kn.normalizeParams(i)})}var iw=mt("ZodEmoji",(i,e)=>{Gk.init(i,e),Br.init(i,e)});function nB(i){return AI(iw,i)}var nw=mt("ZodNanoID",(i,e)=>{Hk.init(i,e),Br.init(i,e)});function rB(i){return PI(nw,i)}var rw=mt("ZodCUID",(i,e)=>{Zk.init(i,e),Br.init(i,e)});function oB(i){return zI(rw,i)}var ow=mt("ZodCUID2",(i,e)=>{Wk.init(i,e),Br.init(i,e)});function sB(i){return CI(ow,i)}var sw=mt("ZodULID",(i,e)=>{qk.init(i,e),Br.init(i,e)});function aB(i){return RI(sw,i)}var aw=mt("ZodXID",(i,e)=>{Xk.init(i,e),Br.init(i,e)});function lB(i){return LI(aw,i)}var lw=mt("ZodKSUID",(i,e)=>{Jk.init(i,e),Br.init(i,e)});function cB(i){return DI(lw,i)}var cw=mt("ZodIPv4",(i,e)=>{t3.init(i,e),Br.init(i,e)});function uB(i){return kI(cw,i)}var tM=mt("ZodMAC",(i,e)=>{n3.init(i,e),Br.init(i,e)});function hB(i){return aO(tM,i)}var uw=mt("ZodIPv6",(i,e)=>{i3.init(i,e),Br.init(i,e)});function dB(i){return OI(uw,i)}var hw=mt("ZodCIDRv4",(i,e)=>{r3.init(i,e),Br.init(i,e)});function fB(i){return FI(hw,i)}var dw=mt("ZodCIDRv6",(i,e)=>{o3.init(i,e),Br.init(i,e)});function pB(i){return BI(dw,i)}var fw=mt("ZodBase64",(i,e)=>{s3.init(i,e),Br.init(i,e)});function mB(i){return NI(fw,i)}var pw=mt("ZodBase64URL",(i,e)=>{l3.init(i,e),Br.init(i,e)});function gB(i){return UI(pw,i)}var mw=mt("ZodE164",(i,e)=>{c3.init(i,e),Br.init(i,e)});function _B(i){return $I(mw,i)}var gw=mt("ZodJWT",(i,e)=>{h3.init(i,e),Br.init(i,e)});function yB(i){return VI(gw,i)}var Wp=mt("ZodCustomStringFormat",(i,e)=>{d3.init(i,e),Br.init(i,e)});function vB(i,e,o={}){return xy(Wp,i,e,o)}function xB(i){return xy(Wp,"hostname",wd.hostname,i)}function bB(i){return xy(Wp,"hex",wd.hex,i)}function wB(i,e){let o=(e==null?void 0:e.enc)??"hex",h=`${i}_${o}`,l=wd[h];if(!l)throw Error(`Unrecognized hash format: ${h}`);return xy(Wp,h,l,e)}var Sy=mt("ZodNumber",(i,e)=>{mI.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(h,l,m)=>WO(i,h,l),i.gt=(h,l)=>i.check(Xu(h,l)),i.gte=(h,l)=>i.check(aa(h,l)),i.min=(h,l)=>i.check(aa(h,l)),i.lt=(h,l)=>i.check(qu(h,l)),i.lte=(h,l)=>i.check(Xa(h,l)),i.max=(h,l)=>i.check(Xa(h,l)),i.int=h=>i.check(ab(h)),i.safe=h=>i.check(ab(h)),i.positive=h=>i.check(Xu(0,h)),i.nonnegative=h=>i.check(aa(0,h)),i.negative=h=>i.check(qu(0,h)),i.nonpositive=h=>i.check(Xa(0,h)),i.multipleOf=(h,l)=>i.check(Cp(h,l)),i.step=(h,l)=>i.check(Cp(h,l)),i.finite=()=>i;let o=i._zod.bag;i.minValue=Math.max(o.minimum??Number.NEGATIVE_INFINITY,o.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,i.maxValue=Math.min(o.maximum??Number.POSITIVE_INFINITY,o.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,i.isInt=(o.format??"").includes("int")||Number.isSafeInteger(o.multipleOf??.5),i.isFinite=!0,i.format=o.format??null});function iM(i){return fO(Sy,i)}var Sd=mt("ZodNumberFormat",(i,e)=>{f3.init(i,e),Sy.init(i,e)});function ab(i){return mO(Sd,i)}function SB(i){return gO(Sd,i)}function TB(i){return _O(Sd,i)}function EB(i){return yO(Sd,i)}function IB(i){return vO(Sd,i)}var Ty=mt("ZodBoolean",(i,e)=>{gI.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>qO(i,o,h)});function nM(i){return xO(Ty,i)}var Ey=mt("ZodBigInt",(i,e)=>{_I.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(h,l,m)=>XO(i,h),i.gte=(h,l)=>i.check(aa(h,l)),i.min=(h,l)=>i.check(aa(h,l)),i.gt=(h,l)=>i.check(Xu(h,l)),i.gte=(h,l)=>i.check(aa(h,l)),i.min=(h,l)=>i.check(aa(h,l)),i.lt=(h,l)=>i.check(qu(h,l)),i.lte=(h,l)=>i.check(Xa(h,l)),i.max=(h,l)=>i.check(Xa(h,l)),i.positive=h=>i.check(Xu(BigInt(0),h)),i.negative=h=>i.check(qu(BigInt(0),h)),i.nonpositive=h=>i.check(Xa(BigInt(0),h)),i.nonnegative=h=>i.check(aa(BigInt(0),h)),i.multipleOf=(h,l)=>i.check(Cp(h,l));let o=i._zod.bag;i.minValue=o.minimum??null,i.maxValue=o.maximum??null,i.format=o.format??null});function MB(i){return wO(Ey,i)}var _w=mt("ZodBigIntFormat",(i,e)=>{p3.init(i,e),Ey.init(i,e)});function AB(i){return TO(_w,i)}function PB(i){return EO(_w,i)}var rM=mt("ZodSymbol",(i,e)=>{m3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>JO(i,o)});function zB(i){return IO(rM,i)}var oM=mt("ZodUndefined",(i,e)=>{g3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>KO(i,o)});function CB(i){return MO(oM,i)}var sM=mt("ZodNull",(i,e)=>{_3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>YO(i,o,h)});function aM(i){return AO(sM,i)}var lM=mt("ZodAny",(i,e)=>{y3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>tF()});function RB(){return PO(lM)}var cM=mt("ZodUnknown",(i,e)=>{v3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>iF()});function _d(){return zO(cM)}var uM=mt("ZodNever",(i,e)=>{x3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>eF(i,o,h)});function yw(i){return CO(uM,i)}var hM=mt("ZodVoid",(i,e)=>{b3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>QO(i,o)});function LB(i){return RO(hM,i)}var vw=mt("ZodDate",(i,e)=>{w3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(h,l,m)=>nF(i,h),i.min=(h,l)=>i.check(aa(h,l)),i.max=(h,l)=>i.check(Xa(h,l));let o=i._zod.bag;i.minDate=o.minimum?new Date(o.minimum):null,i.maxDate=o.maximum?new Date(o.maximum):null});function DB(i){return LO(vw,i)}var dM=mt("ZodArray",(i,e)=>{S3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>mF(i,o,h,l),i.element=e.element,i.min=(o,h)=>i.check(gd(o,h)),i.nonempty=o=>i.check(gd(1,o)),i.max=(o,h)=>i.check(yy(o,h)),i.length=(o,h)=>i.check(vy(o,h)),i.unwrap=()=>i.element});function Iy(i,e){return OO(dM,i,e)}function kB(i){let e=i._zod.def.shape;return bw(Object.keys(e))}var My=mt("ZodObject",(i,e)=>{M3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>gF(i,o,h,l),Kn.defineLazy(i,"shape",()=>e.shape),i.keyof=()=>bw(Object.keys(i._zod.def.shape)),i.catchall=o=>i.clone({...i._zod.def,catchall:o}),i.passthrough=()=>i.clone({...i._zod.def,catchall:_d()}),i.loose=()=>i.clone({...i._zod.def,catchall:_d()}),i.strict=()=>i.clone({...i._zod.def,catchall:yw()}),i.strip=()=>i.clone({...i._zod.def,catchall:void 0}),i.extend=o=>Kn.extend(i,o),i.safeExtend=o=>Kn.safeExtend(i,o),i.merge=o=>Kn.merge(i,o),i.pick=o=>Kn.pick(i,o),i.omit=o=>Kn.omit(i,o),i.partial=(...o)=>Kn.partial(Sw,i,o[0]),i.required=(...o)=>Kn.required(Tw,i,o[0])});function OB(i,e){let o={type:"object",shape:i??{},...Kn.normalizeParams(e)};return new My(o)}function FB(i,e){return new My({type:"object",shape:i,catchall:yw(),...Kn.normalizeParams(e)})}function BB(i,e){return new My({type:"object",shape:i,catchall:_d(),...Kn.normalizeParams(e)})}var Ay=mt("ZodUnion",(i,e)=>{Ub.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>qI(i,o,h,l),i.options=e.options});function xw(i,e){return new Ay({type:"union",options:i,...Kn.normalizeParams(e)})}var fM=mt("ZodXor",(i,e)=>{Ay.init(i,e),A3.init(i,e),i._zod.processJSONSchema=(o,h,l)=>qI(i,o,h,l),i.options=e.options});function NB(i,e){return new fM({type:"union",options:i,inclusive:!1,...Kn.normalizeParams(e)})}var pM=mt("ZodDiscriminatedUnion",(i,e)=>{Ay.init(i,e),P3.init(i,e)});function UB(i,e,o){return new pM({type:"union",options:e,discriminator:i,...Kn.normalizeParams(o)})}var mM=mt("ZodIntersection",(i,e)=>{z3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>_F(i,o,h,l)});function gM(i,e){return new mM({type:"intersection",left:i,right:e})}var _M=mt("ZodTuple",(i,e)=>{yI.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>yF(i,o,h,l),i.rest=o=>i.clone({...i._zod.def,rest:o})});function yM(i,e,o){let h=e instanceof Ln,l=h?o:e;return new _M({type:"tuple",items:i,rest:h?e:null,...Kn.normalizeParams(l)})}var Py=mt("ZodRecord",(i,e)=>{C3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>vF(i,o,h,l),i.keyType=e.keyType,i.valueType=e.valueType});function vM(i,e,o){return new Py({type:"record",keyType:i,valueType:e,...Kn.normalizeParams(o)})}function $B(i,e,o){let h=il(i);return h._zod.values=void 0,new Py({type:"record",keyType:h,valueType:e,...Kn.normalizeParams(o)})}function VB(i,e,o){return new Py({type:"record",keyType:i,valueType:e,mode:"loose",...Kn.normalizeParams(o)})}var xM=mt("ZodMap",(i,e)=>{R3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>fF(i,o),i.keyType=e.keyType,i.valueType=e.valueType,i.min=(...o)=>i.check(Ju(...o)),i.nonempty=o=>i.check(Ju(1,o)),i.max=(...o)=>i.check(Zp(...o)),i.size=(...o)=>i.check(_y(...o))});function jB(i,e,o){return new xM({type:"map",keyType:i,valueType:e,...Kn.normalizeParams(o)})}var bM=mt("ZodSet",(i,e)=>{L3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>pF(i,o),i.min=(...o)=>i.check(Ju(...o)),i.nonempty=o=>i.check(Ju(1,o)),i.max=(...o)=>i.check(Zp(...o)),i.size=(...o)=>i.check(_y(...o))});function GB(i,e){return new bM({type:"set",valueType:i,...Kn.normalizeParams(e)})}var kp=mt("ZodEnum",(i,e)=>{D3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(h,l,m)=>rF(i,h,l),i.enum=e.entries,i.options=Object.values(e.entries);let o=new Set(Object.keys(e.entries));i.extract=(h,l)=>{let m={};for(let x of h)if(o.has(x))m[x]=e.entries[x];else throw Error(`Key ${x} not found in enum`);return new kp({...e,checks:[],...Kn.normalizeParams(l),entries:m})},i.exclude=(h,l)=>{let m={...e.entries};for(let x of h)if(o.has(x))delete m[x];else throw Error(`Key ${x} not found in enum`);return new kp({...e,checks:[],...Kn.normalizeParams(l),entries:m})}});function bw(i,e){let o=Array.isArray(i)?Object.fromEntries(i.map(h=>[h,h])):i;return new kp({type:"enum",entries:o,...Kn.normalizeParams(e)})}function HB(i,e){return new kp({type:"enum",entries:i,...Kn.normalizeParams(e)})}var wM=mt("ZodLiteral",(i,e)=>{k3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>oF(i,o,h),i.values=new Set(e.values),Object.defineProperty(i,"value",{get(){if(e.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function ZB(i,e){return new wM({type:"literal",values:Array.isArray(i)?i:[i],...Kn.normalizeParams(e)})}var SM=mt("ZodFile",(i,e)=>{O3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>lF(i,o,h),i.min=(o,h)=>i.check(Ju(o,h)),i.max=(o,h)=>i.check(Zp(o,h)),i.mime=(o,h)=>i.check(qb(Array.isArray(o)?o:[o],h))});function WB(i){return FO(SM,i)}var TM=mt("ZodTransform",(i,e)=>{F3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>dF(i,o),i._zod.parse=(o,h)=>{if(h.direction==="backward")throw new Ob(i.constructor.name);o.addIssue=m=>{if(typeof m=="string")o.issues.push(Kn.issue(m,o.value,e));else{let x=m;x.fatal&&(x.continue=!1),x.code??(x.code="custom"),x.input??(x.input=o.value),x.inst??(x.inst=i),o.issues.push(Kn.issue(x))}};let l=e.transform(o.value,o);return l instanceof Promise?l.then(m=>(o.value=m,o)):(o.value=l,o)}});function ww(i){return new TM({type:"transform",transform:i})}var Sw=mt("ZodOptional",(i,e)=>{vI.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>XI(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function L_(i){return new Sw({type:"optional",innerType:i})}var EM=mt("ZodExactOptional",(i,e)=>{B3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>XI(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function IM(i){return new EM({type:"optional",innerType:i})}var MM=mt("ZodNullable",(i,e)=>{N3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>xF(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function D_(i){return new MM({type:"nullable",innerType:i})}function qB(i){return L_(D_(i))}var AM=mt("ZodDefault",(i,e)=>{U3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>wF(i,o,h,l),i.unwrap=()=>i._zod.def.innerType,i.removeDefault=i.unwrap});function PM(i,e){return new AM({type:"default",innerType:i,get defaultValue(){return typeof e=="function"?e():Kn.shallowClone(e)}})}var zM=mt("ZodPrefault",(i,e)=>{$3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>SF(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function CM(i,e){return new zM({type:"prefault",innerType:i,get defaultValue(){return typeof e=="function"?e():Kn.shallowClone(e)}})}var Tw=mt("ZodNonOptional",(i,e)=>{V3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>bF(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function RM(i,e){return new Tw({type:"nonoptional",innerType:i,...Kn.normalizeParams(e)})}var LM=mt("ZodSuccess",(i,e)=>{j3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>cF(i,o,h),i.unwrap=()=>i._zod.def.innerType});function XB(i){return new LM({type:"success",innerType:i})}var DM=mt("ZodCatch",(i,e)=>{G3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>TF(i,o,h,l),i.unwrap=()=>i._zod.def.innerType,i.removeCatch=i.unwrap});function kM(i,e){return new DM({type:"catch",innerType:i,catchValue:typeof e=="function"?e:()=>e})}var OM=mt("ZodNaN",(i,e)=>{H3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>sF(i,o)});function JB(i){return kO(OM,i)}var Ew=mt("ZodPipe",(i,e)=>{Z3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>EF(i,o,h,l),i.in=e.in,i.out=e.out});function k_(i,e){return new Ew({type:"pipe",in:i,out:e})}var Iw=mt("ZodCodec",(i,e)=>{Ew.init(i,e),xI.init(i,e)});function YB(i,e,o){return new Iw({type:"pipe",in:i,out:e,transform:o.decode,reverseTransform:o.encode})}var FM=mt("ZodReadonly",(i,e)=>{W3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>IF(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function BM(i){return new FM({type:"readonly",innerType:i})}var NM=mt("ZodTemplateLiteral",(i,e)=>{q3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>aF(i,o,h)});function KB(i,e){return new NM({type:"template_literal",parts:i,...Kn.normalizeParams(e)})}var UM=mt("ZodLazy",(i,e)=>{Y3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>AF(i,o,h,l),i.unwrap=()=>i._zod.def.getter()});function $M(i){return new UM({type:"lazy",getter:i})}var VM=mt("ZodPromise",(i,e)=>{J3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>MF(i,o,h,l),i.unwrap=()=>i._zod.def.innerType});function QB(i){return new VM({type:"promise",innerType:i})}var jM=mt("ZodFunction",(i,e)=>{X3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>hF(i,o)});function lb(i){return new jM({type:"function",input:Array.isArray(i==null?void 0:i.input)?yM(i==null?void 0:i.input):(i==null?void 0:i.input)??Iy(_d()),output:(i==null?void 0:i.output)??_d()})}var zy=mt("ZodCustom",(i,e)=>{K3.init(i,e),Bn.init(i,e),i._zod.processJSONSchema=(o,h,l)=>uF(i,o)});function e4(i){let e=new ro({check:"custom"});return e._zod.check=i,e}function t4(i,e){return BO(zy,i??(()=>!0),e)}function GM(i,e={}){return NO(zy,i,e)}function HM(i){return UO(i)}var i4=VO,n4=jO;function r4(i,e={}){let o=new zy({type:"custom",check:"custom",fn:h=>h instanceof i,abort:!0,...Kn.normalizeParams(e)});return o._zod.bag.Class=i,o._zod.check=h=>{h.value instanceof i||h.issues.push({code:"invalid_type",expected:i.name,input:h.value,inst:o,path:[...o._zod.def.path??[]]})},o}var o4=(...i)=>GO({Codec:Iw,Boolean:Ty,String:by},...i);function s4(i){let e=$M(()=>xw([sb(i),iM(),nM(),aM(),Iy(e),vM(sb(),e)]));return e}function a4(i,e){return k_(ww(i),e)}var WX={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};function qX(i){Ls({customError:i})}function XX(){return Ls().customError}var FT;FT||(FT={});var Ci={...zF,...CF,iso:JI},JX=new Set(["$schema","$ref","$defs","definitions","$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor","type","enum","const","anyOf","oneOf","allOf","not","properties","required","additionalProperties","patternProperties","propertyNames","minProperties","maxProperties","items","prefixItems","additionalItems","minItems","maxItems","uniqueItems","contains","minContains","maxContains","minLength","maxLength","pattern","format","minimum","maximum","exclusiveMinimum","exclusiveMaximum","multipleOf","description","default","contentEncoding","contentMediaType","contentSchema","unevaluatedItems","unevaluatedProperties","if","then","else","dependentSchemas","dependentRequired","nullable","readOnly"]);function YX(i,e){let o=i.$schema;return o==="https://json-schema.org/draft/2020-12/schema"?"draft-2020-12":o==="http://json-schema.org/draft-07/schema#"?"draft-7":o==="http://json-schema.org/draft-04/schema#"?"draft-4":e??"draft-2020-12"}function KX(i,e){if(!i.startsWith("#"))throw Error("External $ref is not supported, only local refs (#/...) are allowed");let o=i.slice(1).split("/").filter(Boolean);if(o.length===0)return e.rootSchema;let h=e.version==="draft-2020-12"?"$defs":"definitions";if(o[0]===h){let l=o[1];if(!l||!e.defs[l])throw Error(`Reference not found: ${i}`);return e.defs[l]}throw Error(`Reference not found: ${i}`)}function l4(i,e){if(i.not!==void 0){if(typeof i.not=="object"&&Object.keys(i.not).length===0)return Ci.never();throw Error("not is not supported in Zod (except { not: {} } for never)")}if(i.unevaluatedItems!==void 0)throw Error("unevaluatedItems is not supported");if(i.unevaluatedProperties!==void 0)throw Error("unevaluatedProperties is not supported");if(i.if!==void 0||i.then!==void 0||i.else!==void 0)throw Error("Conditional schemas (if/then/else) are not supported");if(i.dependentSchemas!==void 0||i.dependentRequired!==void 0)throw Error("dependentSchemas and dependentRequired are not supported");if(i.$ref){let l=i.$ref;if(e.refs.has(l))return e.refs.get(l);if(e.processing.has(l))return Ci.lazy(()=>{if(!e.refs.has(l))throw Error(`Circular reference not resolved: ${l}`);return e.refs.get(l)});e.processing.add(l);let m=KX(l,e),x=As(m,e);return e.refs.set(l,x),e.processing.delete(l),x}if(i.enum!==void 0){let l=i.enum;if(e.version==="openapi-3.0"&&i.nullable===!0&&l.length===1&&l[0]===null)return Ci.null();if(l.length===0)return Ci.never();if(l.length===1)return Ci.literal(l[0]);if(l.every(x=>typeof x=="string"))return Ci.enum(l);let m=l.map(x=>Ci.literal(x));return m.length<2?m[0]:Ci.union([m[0],m[1],...m.slice(2)])}if(i.const!==void 0)return Ci.literal(i.const);let o=i.type;if(Array.isArray(o)){let l=o.map(m=>{let x={...i,type:m};return l4(x,e)});return l.length===0?Ci.never():l.length===1?l[0]:Ci.union(l)}if(!o)return Ci.any();let h;switch(o){case"string":{let l=Ci.string();if(i.format){let m=i.format;m==="email"?l=l.check(Ci.email()):m==="uri"||m==="uri-reference"?l=l.check(Ci.url()):m==="uuid"||m==="guid"?l=l.check(Ci.uuid()):m==="date-time"?l=l.check(Ci.iso.datetime()):m==="date"?l=l.check(Ci.iso.date()):m==="time"?l=l.check(Ci.iso.time()):m==="duration"?l=l.check(Ci.iso.duration()):m==="ipv4"?l=l.check(Ci.ipv4()):m==="ipv6"?l=l.check(Ci.ipv6()):m==="mac"?l=l.check(Ci.mac()):m==="cidr"?l=l.check(Ci.cidrv4()):m==="cidr-v6"?l=l.check(Ci.cidrv6()):m==="base64"?l=l.check(Ci.base64()):m==="base64url"?l=l.check(Ci.base64url()):m==="e164"?l=l.check(Ci.e164()):m==="jwt"?l=l.check(Ci.jwt()):m==="emoji"?l=l.check(Ci.emoji()):m==="nanoid"?l=l.check(Ci.nanoid()):m==="cuid"?l=l.check(Ci.cuid()):m==="cuid2"?l=l.check(Ci.cuid2()):m==="ulid"?l=l.check(Ci.ulid()):m==="xid"?l=l.check(Ci.xid()):m==="ksuid"&&(l=l.check(Ci.ksuid()))}typeof i.minLength=="number"&&(l=l.min(i.minLength)),typeof i.maxLength=="number"&&(l=l.max(i.maxLength)),i.pattern&&(l=l.regex(new RegExp(i.pattern))),h=l;break}case"number":case"integer":{let l=o==="integer"?Ci.number().int():Ci.number();typeof i.minimum=="number"&&(l=l.min(i.minimum)),typeof i.maximum=="number"&&(l=l.max(i.maximum)),typeof i.exclusiveMinimum=="number"?l=l.gt(i.exclusiveMinimum):i.exclusiveMinimum===!0&&typeof i.minimum=="number"&&(l=l.gt(i.minimum)),typeof i.exclusiveMaximum=="number"?l=l.lt(i.exclusiveMaximum):i.exclusiveMaximum===!0&&typeof i.maximum=="number"&&(l=l.lt(i.maximum)),typeof i.multipleOf=="number"&&(l=l.multipleOf(i.multipleOf)),h=l;break}case"boolean":{h=Ci.boolean();break}case"null":{h=Ci.null();break}case"object":{let l={},m=i.properties||{},x=new Set(i.required||[]);for(let[P,C]of Object.entries(m)){let F=As(C,e);l[P]=x.has(P)?F:F.optional()}if(i.propertyNames){let P=As(i.propertyNames,e),C=i.additionalProperties&&typeof i.additionalProperties=="object"?As(i.additionalProperties,e):Ci.any();if(Object.keys(l).length===0){h=Ci.record(P,C);break}let F=Ci.object(l).passthrough(),O=Ci.looseRecord(P,C);h=Ci.intersection(F,O);break}if(i.patternProperties){let P=i.patternProperties,C=Object.keys(P),F=[];for(let V of C){let J=As(P[V],e),ee=Ci.string().regex(new RegExp(V));F.push(Ci.looseRecord(ee,J))}let O=[];if(Object.keys(l).length>0&&O.push(Ci.object(l).passthrough()),O.push(...F),O.length===0)h=Ci.object({}).passthrough();else if(O.length===1)h=O[0];else{let V=Ci.intersection(O[0],O[1]);for(let J=2;J<O.length;J++)V=Ci.intersection(V,O[J]);h=V}break}let s=Ci.object(l);i.additionalProperties===!1?h=s.strict():typeof i.additionalProperties=="object"?h=s.catchall(As(i.additionalProperties,e)):h=s.passthrough();break}case"array":{let{prefixItems:l,items:m}=i;if(l&&Array.isArray(l)){let x=l.map(P=>As(P,e)),s=m&&typeof m=="object"&&!Array.isArray(m)?As(m,e):void 0;s?h=Ci.tuple(x).rest(s):h=Ci.tuple(x),typeof i.minItems=="number"&&(h=h.check(Ci.minLength(i.minItems))),typeof i.maxItems=="number"&&(h=h.check(Ci.maxLength(i.maxItems)))}else if(Array.isArray(m)){let x=m.map(P=>As(P,e)),s=i.additionalItems&&typeof i.additionalItems=="object"?As(i.additionalItems,e):void 0;s?h=Ci.tuple(x).rest(s):h=Ci.tuple(x),typeof i.minItems=="number"&&(h=h.check(Ci.minLength(i.minItems))),typeof i.maxItems=="number"&&(h=h.check(Ci.maxLength(i.maxItems)))}else if(m!==void 0){let x=As(m,e),s=Ci.array(x);typeof i.minItems=="number"&&(s=s.min(i.minItems)),typeof i.maxItems=="number"&&(s=s.max(i.maxItems)),h=s}else h=Ci.array(Ci.any());break}default:throw Error(`Unsupported type: ${o}`)}return i.description&&(h=h.describe(i.description)),i.default!==void 0&&(h=h.default(i.default)),h}function As(i,e){if(typeof i=="boolean")return i?Ci.any():Ci.never();let o=l4(i,e),h=i.type||i.enum!==void 0||i.const!==void 0;if(i.anyOf&&Array.isArray(i.anyOf)){let s=i.anyOf.map(C=>As(C,e)),P=Ci.union(s);o=h?Ci.intersection(o,P):P}if(i.oneOf&&Array.isArray(i.oneOf)){let s=i.oneOf.map(C=>As(C,e)),P=Ci.xor(s);o=h?Ci.intersection(o,P):P}if(i.allOf&&Array.isArray(i.allOf))if(i.allOf.length===0)o=h?o:Ci.any();else{let s=h?o:As(i.allOf[0],e),P=h?0:1;for(let C=P;C<i.allOf.length;C++)s=Ci.intersection(s,As(i.allOf[C],e));o=s}i.nullable===!0&&e.version==="openapi-3.0"&&(o=Ci.nullable(o)),i.readOnly===!0&&(o=Ci.readonly(o));let l={},m=["$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor"];for(let s of m)s in i&&(l[s]=i[s]);let x=["contentEncoding","contentMediaType","contentSchema"];for(let s of x)s in i&&(l[s]=i[s]);for(let s of Object.keys(i))JX.has(s)||(l[s]=i[s]);return Object.keys(l).length>0&&e.registry.add(o,l),o}function QX(i,e){if(typeof i=="boolean")return i?Ci.any():Ci.never();let o=YX(i,e==null?void 0:e.defaultTarget),h=i.$defs||i.definitions||{},l={version:o,defs:h,refs:new Map,processing:new Set,rootSchema:i,registry:(e==null?void 0:e.registry)??qa};return As(i,l)}var c4={};$c(c4,{string:()=>eJ,number:()=>tJ,date:()=>rJ,boolean:()=>iJ,bigint:()=>nJ});function eJ(i){return sO(by,i)}function tJ(i){return pO(Sy,i)}function iJ(i){return bO(Ty,i)}function nJ(i){return SO(Ey,i)}function rJ(i){return DO(vw,i)}Ls(Q3());var oJ=Ue.union([Ue.literal("light"),Ue.literal("dark")]).describe("Color theme preference for the host environment."),O_=Ue.union([Ue.literal("inline"),Ue.literal("fullscreen"),Ue.literal("pip")]).describe("Display mode for UI presentation."),sJ=Ue.union([Ue.literal("--color-background-primary"),Ue.literal("--color-background-secondary"),Ue.literal("--color-background-tertiary"),Ue.literal("--color-background-inverse"),Ue.literal("--color-background-ghost"),Ue.literal("--color-background-info"),Ue.literal("--color-background-danger"),Ue.literal("--color-background-success"),Ue.literal("--color-background-warning"),Ue.literal("--color-background-disabled"),Ue.literal("--color-text-primary"),Ue.literal("--color-text-secondary"),Ue.literal("--color-text-tertiary"),Ue.literal("--color-text-inverse"),Ue.literal("--color-text-ghost"),Ue.literal("--color-text-info"),Ue.literal("--color-text-danger"),Ue.literal("--color-text-success"),Ue.literal("--color-text-warning"),Ue.literal("--color-text-disabled"),Ue.literal("--color-text-ghost"),Ue.literal("--color-border-primary"),Ue.literal("--color-border-secondary"),Ue.literal("--color-border-tertiary"),Ue.literal("--color-border-inverse"),Ue.literal("--color-border-ghost"),Ue.literal("--color-border-info"),Ue.literal("--color-border-danger"),Ue.literal("--color-border-success"),Ue.literal("--color-border-warning"),Ue.literal("--color-border-disabled"),Ue.literal("--color-ring-primary"),Ue.literal("--color-ring-secondary"),Ue.literal("--color-ring-inverse"),Ue.literal("--color-ring-info"),Ue.literal("--color-ring-danger"),Ue.literal("--color-ring-success"),Ue.literal("--color-ring-warning"),Ue.literal("--font-sans"),Ue.literal("--font-mono"),Ue.literal("--font-weight-normal"),Ue.literal("--font-weight-medium"),Ue.literal("--font-weight-semibold"),Ue.literal("--font-weight-bold"),Ue.literal("--font-text-xs-size"),Ue.literal("--font-text-sm-size"),Ue.literal("--font-text-md-size"),Ue.literal("--font-text-lg-size"),Ue.literal("--font-heading-xs-size"),Ue.literal("--font-heading-sm-size"),Ue.literal("--font-heading-md-size"),Ue.literal("--font-heading-lg-size"),Ue.literal("--font-heading-xl-size"),Ue.literal("--font-heading-2xl-size"),Ue.literal("--font-heading-3xl-size"),Ue.literal("--font-text-xs-line-height"),Ue.literal("--font-text-sm-line-height"),Ue.literal("--font-text-md-line-height"),Ue.literal("--font-text-lg-line-height"),Ue.literal("--font-heading-xs-line-height"),Ue.literal("--font-heading-sm-line-height"),Ue.literal("--font-heading-md-line-height"),Ue.literal("--font-heading-lg-line-height"),Ue.literal("--font-heading-xl-line-height"),Ue.literal("--font-heading-2xl-line-height"),Ue.literal("--font-heading-3xl-line-height"),Ue.literal("--border-radius-xs"),Ue.literal("--border-radius-sm"),Ue.literal("--border-radius-md"),Ue.literal("--border-radius-lg"),Ue.literal("--border-radius-xl"),Ue.literal("--border-radius-full"),Ue.literal("--border-width-regular"),Ue.literal("--shadow-hairline"),Ue.literal("--shadow-sm"),Ue.literal("--shadow-md"),Ue.literal("--shadow-lg")]).describe("CSS variable keys available to MCP apps for theming."),aJ=Ue.record(sJ.describe(`Style variables for theming MCP apps.

Individual style keys are optional - hosts may provide any subset of these values.
Values are strings containing CSS values (colors, sizes, font stacks, etc.).

Note: This type uses \`Record<K, string | undefined>\` rather than \`Partial<Record<K, string>>\`
for compatibility with Zod schema generation. Both are functionally equivalent for validation.`),Ue.union([Ue.string(),Ue.undefined()]).describe(`Style variables for theming MCP apps.

Individual style keys are optional - hosts may provide any subset of these values.
Values are strings containing CSS values (colors, sizes, font stacks, etc.).

Note: This type uses \`Record<K, string | undefined>\` rather than \`Partial<Record<K, string>>\`
for compatibility with Zod schema generation. Both are functionally equivalent for validation.`)).describe(`Style variables for theming MCP apps.

Individual style keys are optional - hosts may provide any subset of these values.
Values are strings containing CSS values (colors, sizes, font stacks, etc.).

Note: This type uses \`Record<K, string | undefined>\` rather than \`Partial<Record<K, string>>\`
for compatibility with Zod schema generation. Both are functionally equivalent for validation.`);Ue.object({method:Ue.literal("ui/open-link"),params:Ue.object({url:Ue.string().describe("URL to open in the host's browser")})});var lJ=Ue.object({isError:Ue.boolean().optional().describe("True if the host failed to open the URL (e.g., due to security policy).")}).passthrough(),cJ=Ue.object({isError:Ue.boolean().optional().describe("True if the host rejected or failed to deliver the message.")}).passthrough();Ue.object({method:Ue.literal("ui/notifications/sandbox-proxy-ready"),params:Ue.object({})});var ZM=Ue.object({connectDomains:Ue.array(Ue.string()).optional().describe("Origins for network requests (fetch/XHR/WebSocket)."),resourceDomains:Ue.array(Ue.string()).optional().describe("Origins for static resources (scripts, images, styles, fonts)."),frameDomains:Ue.array(Ue.string()).optional().describe("Origins for nested iframes (frame-src directive)."),baseUriDomains:Ue.array(Ue.string()).optional().describe("Allowed base URIs for the document (base-uri directive).")}),WM=Ue.object({camera:Ue.object({}).optional().describe("Request camera access (Permission Policy `camera` feature)."),microphone:Ue.object({}).optional().describe("Request microphone access (Permission Policy `microphone` feature)."),geolocation:Ue.object({}).optional().describe("Request geolocation access (Permission Policy `geolocation` feature)."),clipboardWrite:Ue.object({}).optional().describe("Request clipboard write access (Permission Policy `clipboard-write` feature).")});Ue.object({method:Ue.literal("ui/notifications/size-changed"),params:Ue.object({width:Ue.number().optional().describe("New width in pixels."),height:Ue.number().optional().describe("New height in pixels.")})});var uJ=Ue.object({method:Ue.literal("ui/notifications/tool-input"),params:Ue.object({arguments:Ue.record(Ue.string(),Ue.unknown().describe("Complete tool call arguments as key-value pairs.")).optional().describe("Complete tool call arguments as key-value pairs.")})}),hJ=Ue.object({method:Ue.literal("ui/notifications/tool-input-partial"),params:Ue.object({arguments:Ue.record(Ue.string(),Ue.unknown().describe("Partial tool call arguments (incomplete, may change).")).optional().describe("Partial tool call arguments (incomplete, may change).")})}),dJ=Ue.object({method:Ue.literal("ui/notifications/tool-cancelled"),params:Ue.object({reason:Ue.string().optional().describe('Optional reason for the cancellation (e.g., "user action", "timeout").')})}),fJ=Ue.object({fonts:Ue.string().optional()}),pJ=Ue.object({variables:aJ.optional().describe("CSS variables for theming the app."),css:fJ.optional().describe("CSS blocks that apps can inject.")}),mJ=Ue.object({method:Ue.literal("ui/resource-teardown"),params:Ue.object({})});Ue.record(Ue.string(),Ue.unknown());var AR=Ue.object({text:Ue.object({}).optional().describe("Host supports text content blocks."),image:Ue.object({}).optional().describe("Host supports image content blocks."),audio:Ue.object({}).optional().describe("Host supports audio content blocks."),resource:Ue.object({}).optional().describe("Host supports resource content blocks."),resourceLink:Ue.object({}).optional().describe("Host supports resource link content blocks."),structuredContent:Ue.object({}).optional().describe("Host supports structured content.")}),gJ=Ue.object({experimental:Ue.object({}).optional().describe("Experimental features (structure TBD)."),openLinks:Ue.object({}).optional().describe("Host supports opening external URLs."),serverTools:Ue.object({listChanged:Ue.boolean().optional().describe("Host supports tools/list_changed notifications.")}).optional().describe("Host can proxy tool calls to the MCP server."),serverResources:Ue.object({listChanged:Ue.boolean().optional().describe("Host supports resources/list_changed notifications.")}).optional().describe("Host can proxy resource reads to the MCP server."),logging:Ue.object({}).optional().describe("Host accepts log messages."),sandbox:Ue.object({permissions:WM.optional().describe("Permissions granted by the host (camera, microphone, geolocation)."),csp:ZM.optional().describe("CSP domains approved by the host.")}).optional().describe("Sandbox configuration applied by the host."),updateModelContext:AR.optional().describe("Host accepts context updates (ui/update-model-context) to be included in the model's context for future turns."),message:AR.optional().describe("Host supports receiving content messages (ui/message) from the view.")}),_J=Ue.object({experimental:Ue.object({}).optional().describe("Experimental features (structure TBD)."),tools:Ue.object({listChanged:Ue.boolean().optional().describe("App supports tools/list_changed notifications.")}).optional().describe("App exposes MCP-style tools that the host can call."),availableDisplayModes:Ue.array(O_).optional().describe("Display modes the app supports.")});Ue.object({method:Ue.literal("ui/notifications/initialized"),params:Ue.object({}).optional()});Ue.object({csp:ZM.optional().describe("Content Security Policy configuration."),permissions:WM.optional().describe("Sandbox permissions requested by the UI."),domain:Ue.string().optional().describe("Dedicated origin for view sandbox."),prefersBorder:Ue.boolean().optional().describe("Visual boundary preference - true if UI prefers a visible border.")});Ue.object({method:Ue.literal("ui/request-display-mode"),params:Ue.object({mode:O_.describe("The display mode being requested.")})});var yJ=Ue.object({mode:O_.describe("The display mode that was actually set. May differ from requested if not supported.")}).passthrough(),vJ=Ue.union([Ue.literal("model"),Ue.literal("app")]).describe("Tool visibility scope - who can access the tool.");Ue.object({resourceUri:Ue.string().optional(),visibility:Ue.array(vJ).optional().describe(`Who can access this tool. Default: ["model", "app"]
- "model": Tool visible to and callable by the agent
- "app": Tool callable by the app from this server only`)});Ue.object({mimeTypes:Ue.array(Ue.string()).optional().describe('Array of supported MIME types for UI resources.\nMust include `"text/html;profile=mcp-app"` for MCP Apps support.')});Ue.object({method:Ue.literal("ui/message"),params:Ue.object({role:Ue.literal("user").describe('Message role, currently only "user" is supported.'),content:Ue.array(ay).describe("Message content blocks (text, image, etc.).")})});Ue.object({method:Ue.literal("ui/notifications/sandbox-resource-ready"),params:Ue.object({html:Ue.string().describe("HTML content to load into the inner iframe."),sandbox:Ue.string().optional().describe("Optional override for the inner iframe's sandbox attribute."),csp:ZM.optional().describe("CSP configuration from resource metadata."),permissions:WM.optional().describe("Sandbox permissions from resource metadata.")})});var xJ=Ue.object({method:Ue.literal("ui/notifications/tool-result"),params:kb.describe("Standard MCP tool execution result.")}),u4=Ue.object({toolInfo:Ue.object({id:ty.optional().describe("JSON-RPC id of the tools/call request."),tool:JE.describe("Tool definition including name, inputSchema, etc.")}).optional().describe("Metadata of the tool call that instantiated this App."),theme:oJ.optional().describe("Current color theme preference."),styles:pJ.optional().describe("Style configuration for theming the app."),displayMode:O_.optional().describe("How the UI is currently displayed."),availableDisplayModes:Ue.array(O_).optional().describe("Display modes the host supports."),containerDimensions:Ue.union([Ue.object({height:Ue.number().describe("Fixed container height in pixels.")}),Ue.object({maxHeight:Ue.union([Ue.number(),Ue.undefined()]).optional().describe("Maximum container height in pixels.")})]).and(Ue.union([Ue.object({width:Ue.number().describe("Fixed container width in pixels.")}),Ue.object({maxWidth:Ue.union([Ue.number(),Ue.undefined()]).optional().describe("Maximum container width in pixels.")})])).optional().describe(`Container dimensions. Represents the dimensions of the iframe or other
container holding the app. Specify either width or maxWidth, and either height or maxHeight.`),locale:Ue.string().optional().describe("User's language and region preference in BCP 47 format."),timeZone:Ue.string().optional().describe("User's timezone in IANA format."),userAgent:Ue.string().optional().describe("Host application identifier."),platform:Ue.union([Ue.literal("web"),Ue.literal("desktop"),Ue.literal("mobile")]).optional().describe("Platform type for responsive design decisions."),deviceCapabilities:Ue.object({touch:Ue.boolean().optional().describe("Whether the device supports touch input."),hover:Ue.boolean().optional().describe("Whether the device supports hover interactions.")}).optional().describe("Device input capabilities."),safeAreaInsets:Ue.object({top:Ue.number().describe("Top safe area inset in pixels."),right:Ue.number().describe("Right safe area inset in pixels."),bottom:Ue.number().describe("Bottom safe area inset in pixels."),left:Ue.number().describe("Left safe area inset in pixels.")}).optional().describe("Mobile safe area boundaries in pixels.")}).passthrough(),bJ=Ue.object({method:Ue.literal("ui/notifications/host-context-changed"),params:u4.describe("Partial context update containing only changed fields.")});Ue.object({method:Ue.literal("ui/update-model-context"),params:Ue.object({content:Ue.array(ay).optional().describe("Context content blocks (text, image, etc.)."),structuredContent:Ue.record(Ue.string(),Ue.unknown().describe("Structured content for machine-readable context data.")).optional().describe("Structured content for machine-readable context data.")})});Ue.object({method:Ue.literal("ui/initialize"),params:Ue.object({appInfo:Lb.describe("App identification (name and version)."),appCapabilities:_J.describe("Features and capabilities this app provides."),protocolVersion:Ue.string().describe("Protocol version this app supports.")})});var wJ=Ue.object({protocolVersion:Ue.string().describe('Negotiated protocol version string (e.g., "2025-11-21").'),hostInfo:Lb.describe("Host application identification and version."),hostCapabilities:gJ.describe("Features and capabilities provided by the host."),hostContext:u4.describe("Rich context about the host environment.")}).passthrough();function SJ(i){let e=document.documentElement;e.setAttribute("data-theme",i),e.style.colorScheme=i}function TJ(i,e=document.documentElement){for(let[o,h]of Object.entries(i))h!==void 0&&e.style.setProperty(o,h)}function EJ(i){if(document.getElementById("__mcp-host-fonts"))return;let e=document.createElement("style");e.id="__mcp-host-fonts",e.textContent=i,document.head.appendChild(e)}class IJ extends Tq{constructor(o,h={},l={autoResize:!0}){super(l);Is(this,"_appInfo");Is(this,"_capabilities");Is(this,"options");Is(this,"_hostCapabilities");Is(this,"_hostInfo");Is(this,"_hostContext");Is(this,"sendOpenLink",this.openLink);this._appInfo=o,this._capabilities=h,this.options=l,this.setRequestHandler(Db,m=>(console.log("Received ping:",m.params),{})),this.onhostcontextchanged=()=>{}}getHostCapabilities(){return this._hostCapabilities}getHostVersion(){return this._hostInfo}getHostContext(){return this._hostContext}set ontoolinput(o){this.setNotificationHandler(uJ,h=>o(h.params))}set ontoolinputpartial(o){this.setNotificationHandler(hJ,h=>o(h.params))}set ontoolresult(o){this.setNotificationHandler(xJ,h=>o(h.params))}set ontoolcancelled(o){this.setNotificationHandler(dJ,h=>o(h.params))}set onhostcontextchanged(o){this.setNotificationHandler(bJ,h=>{this._hostContext={...this._hostContext,...h.params},o(h.params)})}set onteardown(o){this.setRequestHandler(mJ,(h,l)=>o(h.params,l))}set oncalltool(o){this.setRequestHandler(bD,(h,l)=>o(h.params,l))}set onlisttools(o){this.setRequestHandler(xD,(h,l)=>o(h.params,l))}assertCapabilityForMethod(o){}assertRequestHandlerCapability(o){switch(o){case"tools/call":case"tools/list":if(!this._capabilities.tools)throw Error(`Client does not support tool capability (required for ${o})`);return;case"ping":case"ui/resource-teardown":return;default:throw Error(`No handler for method ${o} registered`)}}assertNotificationCapability(o){}assertTaskCapability(o){throw Error("Tasks are not supported in MCP Apps")}assertTaskHandlerCapability(o){throw Error("Task handlers are not supported in MCP Apps")}async callServerTool(o,h){return await this.request({method:"tools/call",params:o},kb,h)}sendMessage(o,h){return this.request({method:"ui/message",params:o},cJ,h)}sendLog(o){return this.notification({method:"notifications/message",params:o})}updateModelContext(o,h){return this.request({method:"ui/update-model-context",params:o},kE,h)}openLink(o,h){return this.request({method:"ui/open-link",params:o},lJ,h)}requestDisplayMode(o,h){return this.request({method:"ui/request-display-mode",params:o},yJ,h)}sendSizeChanged(o){return this.notification({method:"ui/notifications/size-changed",params:o})}setupSizeChangedNotifications(){let o=!1,h=0,l=0,m=()=>{o||(o=!0,requestAnimationFrame(()=>{o=!1;let s=document.documentElement,P=s.style.width,C=s.style.height;s.style.width="fit-content",s.style.height="fit-content";let F=s.getBoundingClientRect();s.style.width=P,s.style.height=C;let O=window.innerWidth-s.clientWidth,V=Math.ceil(F.width+O),J=Math.ceil(F.height);(V!==h||J!==l)&&(h=V,l=J,this.sendSizeChanged({width:V,height:J}))}))};m();let x=new ResizeObserver(m);return x.observe(document.documentElement),x.observe(document.body),()=>x.disconnect()}async connect(o=new Iq(window.parent,window.parent),h){var l;await super.connect(o);try{let m=await this.request({method:"ui/initialize",params:{appCapabilities:this._capabilities,appInfo:this._appInfo,protocolVersion:Mq}},wJ,h);if(m===void 0)throw Error(`Server sent invalid initialize result: ${m}`);this._hostCapabilities=m.hostCapabilities,this._hostInfo=m.hostInfo,this._hostContext=m.hostContext,await this.notification({method:"ui/notifications/initialized"}),(l=this.options)!=null&&l.autoResize&&this.setupSizeChangedNotifications()}catch(m){throw this.close(),m}}}function MJ(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Z0={exports:{}},AJ=Z0.exports,PR;function PJ(){return PR||(PR=1,(function(i,e){(function(o,h){i.exports=h()})(AJ,(function(){var o,h,l;function m(s,P){if(!o)o=P;else if(!h)h=P;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",F={};o(F),l=P(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}m(["exports"],function(s){var P=1e-6,C=typeof Float32Array<"u"?Float32Array:Array;function F(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=r*g-d*c;return _?(a[0]=g*(_=1/_),a[1]=-c*_,a[2]=-d*_,a[3]=r*_,a):null}function O(){var a=new C(9);return C!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function V(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=t[4],v=t[5],S=t[6],T=t[7],M=t[8];return a[0]=_*M-v*T,a[1]=d*T-c*M,a[2]=c*v-d*_,a[3]=v*S-g*M,a[4]=r*M-d*S,a[5]=d*g-r*v,a[6]=g*T-_*S,a[7]=c*S-r*T,a[8]=r*_-c*g,a}function J(a,t,r){var c=t[0],d=t[1],g=t[2],_=t[3],v=t[4],S=t[5],T=t[6],M=t[7],A=t[8],z=r[0],D=r[1],k=r[2],$=r[3],H=r[4],j=r[5],q=r[6],Y=r[7],te=r[8];return a[0]=z*c+D*_+k*T,a[1]=z*d+D*v+k*M,a[2]=z*g+D*S+k*A,a[3]=$*c+H*_+j*T,a[4]=$*d+H*v+j*M,a[5]=$*g+H*S+j*A,a[6]=q*c+Y*_+te*T,a[7]=q*d+Y*v+te*M,a[8]=q*g+Y*S+te*A,a}function ee(){var a=new C(16);return C!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function se(a){var t=new C(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}function fe(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function le(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=t[4],v=t[5],S=t[6],T=t[7],M=t[8],A=t[9],z=t[10],D=t[11],k=t[12],$=t[13],H=t[14],j=t[15],q=r*v-c*_,Y=r*S-d*_,te=r*T-g*_,ue=c*S-d*v,ae=c*T-g*v,ge=d*T-g*S,ye=M*$-A*k,me=M*H-z*k,we=M*j-D*k,Ie=A*H-z*$,Je=A*j-D*$,qe=z*j-D*H,Xe=q*qe-Y*Je+te*Ie+ue*we-ae*me+ge*ye;return Xe?(a[0]=(v*qe-S*Je+T*Ie)*(Xe=1/Xe),a[1]=(d*Je-c*qe-g*Ie)*Xe,a[2]=($*ge-H*ae+j*ue)*Xe,a[3]=(z*ae-A*ge-D*ue)*Xe,a[4]=(S*we-_*qe-T*me)*Xe,a[5]=(r*qe-d*we+g*me)*Xe,a[6]=(H*te-k*ge-j*Y)*Xe,a[7]=(M*ge-z*te+D*Y)*Xe,a[8]=(_*Je-v*we+T*ye)*Xe,a[9]=(c*we-r*Je-g*ye)*Xe,a[10]=(k*ae-$*te+j*q)*Xe,a[11]=(A*te-M*ae-D*q)*Xe,a[12]=(v*me-_*Ie-S*ye)*Xe,a[13]=(r*Ie-c*me+d*ye)*Xe,a[14]=($*Y-k*ue-H*q)*Xe,a[15]=(M*ue-A*Y+z*q)*Xe,a):null}function ie(a,t,r){var c=t[0],d=t[1],g=t[2],_=t[3],v=t[4],S=t[5],T=t[6],M=t[7],A=t[8],z=t[9],D=t[10],k=t[11],$=t[12],H=t[13],j=t[14],q=t[15],Y=r[0],te=r[1],ue=r[2],ae=r[3];return a[0]=Y*c+te*v+ue*A+ae*$,a[1]=Y*d+te*S+ue*z+ae*H,a[2]=Y*g+te*T+ue*D+ae*j,a[3]=Y*_+te*M+ue*k+ae*q,a[4]=(Y=r[4])*c+(te=r[5])*v+(ue=r[6])*A+(ae=r[7])*$,a[5]=Y*d+te*S+ue*z+ae*H,a[6]=Y*g+te*T+ue*D+ae*j,a[7]=Y*_+te*M+ue*k+ae*q,a[8]=(Y=r[8])*c+(te=r[9])*v+(ue=r[10])*A+(ae=r[11])*$,a[9]=Y*d+te*S+ue*z+ae*H,a[10]=Y*g+te*T+ue*D+ae*j,a[11]=Y*_+te*M+ue*k+ae*q,a[12]=(Y=r[12])*c+(te=r[13])*v+(ue=r[14])*A+(ae=r[15])*$,a[13]=Y*d+te*S+ue*z+ae*H,a[14]=Y*g+te*T+ue*D+ae*j,a[15]=Y*_+te*M+ue*k+ae*q,a}function it(a,t,r){var c,d,g,_,v,S,T,M,A,z,D,k,$=r[0],H=r[1],j=r[2];return t===a?(a[12]=t[0]*$+t[4]*H+t[8]*j+t[12],a[13]=t[1]*$+t[5]*H+t[9]*j+t[13],a[14]=t[2]*$+t[6]*H+t[10]*j+t[14],a[15]=t[3]*$+t[7]*H+t[11]*j+t[15]):(d=t[1],g=t[2],_=t[3],v=t[4],S=t[5],T=t[6],M=t[7],A=t[8],z=t[9],D=t[10],k=t[11],a[0]=c=t[0],a[1]=d,a[2]=g,a[3]=_,a[4]=v,a[5]=S,a[6]=T,a[7]=M,a[8]=A,a[9]=z,a[10]=D,a[11]=k,a[12]=c*$+v*H+A*j+t[12],a[13]=d*$+S*H+z*j+t[13],a[14]=g*$+T*H+D*j+t[14],a[15]=_*$+M*H+k*j+t[15]),a}function Ve(a,t,r){var c=r[0],d=r[1],g=r[2];return a[0]=t[0]*c,a[1]=t[1]*c,a[2]=t[2]*c,a[3]=t[3]*c,a[4]=t[4]*d,a[5]=t[5]*d,a[6]=t[6]*d,a[7]=t[7]*d,a[8]=t[8]*g,a[9]=t[9]*g,a[10]=t[10]*g,a[11]=t[11]*g,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a}function Ne(a,t,r){var c=Math.sin(r),d=Math.cos(r),g=t[4],_=t[5],v=t[6],S=t[7],T=t[8],M=t[9],A=t[10],z=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=g*d+T*c,a[5]=_*d+M*c,a[6]=v*d+A*c,a[7]=S*d+z*c,a[8]=T*d-g*c,a[9]=M*d-_*c,a[10]=A*d-v*c,a[11]=z*d-S*c,a}function Re(a,t,r){var c=Math.sin(r),d=Math.cos(r),g=t[0],_=t[1],v=t[2],S=t[3],T=t[8],M=t[9],A=t[10],z=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*d-T*c,a[1]=_*d-M*c,a[2]=v*d-A*c,a[3]=S*d-z*c,a[8]=g*c+T*d,a[9]=_*c+M*d,a[10]=v*c+A*d,a[11]=S*c+z*d,a}function Ye(a,t,r){var c=Math.sin(r),d=Math.cos(r),g=t[0],_=t[1],v=t[2],S=t[3],T=t[4],M=t[5],A=t[6],z=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*d+T*c,a[1]=_*d+M*c,a[2]=v*d+A*c,a[3]=S*d+z*c,a[4]=T*d-g*c,a[5]=M*d-_*c,a[6]=A*d-v*c,a[7]=z*d-S*c,a}function zt(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function pt(a,t,r){var c,d,g,_=r[0],v=r[1],S=r[2],T=Math.sqrt(_*_+v*v+S*S);return T<P?null:(_*=T=1/T,v*=T,S*=T,c=Math.sin(t),d=Math.cos(t),a[0]=_*_*(g=1-d)+d,a[1]=v*_*g+S*c,a[2]=S*_*g-v*c,a[3]=0,a[4]=_*v*g-S*c,a[5]=v*v*g+d,a[6]=S*v*g+_*c,a[7]=0,a[8]=_*S*g+v*c,a[9]=v*S*g-_*c,a[10]=S*S*g+d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function St(a,t){var r=t[0],c=t[1],d=t[2],g=t[4],_=t[5],v=t[6],S=t[8],T=t[9],M=t[10];return a[0]=Math.sqrt(r*r+c*c+d*d),a[1]=Math.sqrt(g*g+_*_+v*v),a[2]=Math.sqrt(S*S+T*T+M*M),a}function Et(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=r+r,v=c+c,S=d+d,T=r*_,M=c*_,A=c*v,z=d*_,D=d*v,k=d*S,$=g*_,H=g*v,j=g*S;return a[0]=1-A-k,a[1]=M+j,a[2]=z-H,a[3]=0,a[4]=M-j,a[5]=1-T-k,a[6]=D+$,a[7]=0,a[8]=z+H,a[9]=D-$,a[10]=1-T-A,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}var Dt=ie;function Qe(){var a=new C(3);return C!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function ht(a){var t=new C(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t}function _t(a){var t=a[0],r=a[1],c=a[2];return Math.sqrt(t*t+r*r+c*c)}function yt(a,t,r){var c=new C(3);return c[0]=a,c[1]=t,c[2]=r,c}function Nt(a,t,r,c){return a[0]=t,a[1]=r,a[2]=c,a}function Qt(a,t,r){return a[0]=t[0]+r[0],a[1]=t[1]+r[1],a[2]=t[2]+r[2],a}function pi(a,t,r){return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],a}function Pi(a,t,r){return a[0]=t[0]*r[0],a[1]=t[1]*r[1],a[2]=t[2]*r[2],a}function Mi(a,t,r){return a[0]=Math.min(t[0],r[0]),a[1]=Math.min(t[1],r[1]),a[2]=Math.min(t[2],r[2]),a}function fn(a,t,r){return a[0]=Math.max(t[0],r[0]),a[1]=Math.max(t[1],r[1]),a[2]=Math.max(t[2],r[2]),a}function bi(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r,a}function Dn(a,t,r,c){return a[0]=t[0]+r[0]*c,a[1]=t[1]+r[1]*c,a[2]=t[2]+r[2]*c,a}function Un(a,t){var r=t[0]-a[0],c=t[1]-a[1],d=t[2]-a[2];return Math.sqrt(r*r+c*c+d*d)}function Ht(a,t){var r=t[0]-a[0],c=t[1]-a[1],d=t[2]-a[2];return r*r+c*c+d*d}function mr(a){var t=a[0],r=a[1],c=a[2];return t*t+r*r+c*c}function zn(a,t){return a[0]=-t[0],a[1]=-t[1],a[2]=-t[2],a}function Li(a,t){var r=t[0],c=t[1],d=t[2],g=r*r+c*c+d*d;return g>0&&(g=1/Math.sqrt(g)),a[0]=t[0]*g,a[1]=t[1]*g,a[2]=t[2]*g,a}function Ei(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]}function hn(a,t,r){var c=t[0],d=t[1],g=t[2],_=r[0],v=r[1],S=r[2];return a[0]=d*S-g*v,a[1]=g*_-c*S,a[2]=c*v-d*_,a}function ei(a,t,r,c){var d=t[0],g=t[1],_=t[2];return a[0]=d+c*(r[0]-d),a[1]=g+c*(r[1]-g),a[2]=_+c*(r[2]-_),a}function Wt(a,t,r){var c=t[0],d=t[1],g=t[2],_=r[3]*c+r[7]*d+r[11]*g+r[15];return a[0]=(r[0]*c+r[4]*d+r[8]*g+r[12])/(_=_||1),a[1]=(r[1]*c+r[5]*d+r[9]*g+r[13])/_,a[2]=(r[2]*c+r[6]*d+r[10]*g+r[14])/_,a}function ui(a,t,r){var c=t[0],d=t[1],g=t[2];return a[0]=c*r[0]+d*r[3]+g*r[6],a[1]=c*r[1]+d*r[4]+g*r[7],a[2]=c*r[2]+d*r[5]+g*r[8],a}function Vi(a,t,r){var c=r[0],d=r[1],g=r[2],_=r[3],v=t[0],S=t[1],T=t[2],M=d*T-g*S,A=g*v-c*T,z=c*S-d*v;return a[0]=v+_*(M+=M)+d*(z+=z)-g*(A+=A),a[1]=S+_*A+g*M-c*z,a[2]=T+_*z+c*A-d*M,a}function zi(a){return a[0]=0,a[1]=0,a[2]=0,a}function $e(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]}var Ce=pi,Zt=Pi,Xt=_t;function rt(){var a=new C(4);return C!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function ri(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r,a[3]=t[3]*r,a}function wi(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=r*r+c*c+d*d+g*g;return _>0&&(_=1/Math.sqrt(_)),a[0]=r*_,a[1]=c*_,a[2]=d*_,a[3]=g*_,a}function gi(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]*t[3]}function Yt(a,t,r){var c=t[0],d=t[1],g=t[2],_=t[3];return a[0]=r[0]*c+r[4]*d+r[8]*g+r[12]*_,a[1]=r[1]*c+r[5]*d+r[9]*g+r[13]*_,a[2]=r[2]*c+r[6]*d+r[10]*g+r[14]*_,a[3]=r[3]*c+r[7]*d+r[11]*g+r[15]*_,a}function Zi(){var a=new C(4);return C!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function qi(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function $i(a,t,r){r*=.5;var c=t[0],d=t[1],g=t[2],_=t[3],v=Math.sin(r),S=Math.cos(r);return a[0]=c*S+_*v,a[1]=d*S+g*v,a[2]=g*S-d*v,a[3]=_*S-c*v,a}function Xi(a,t,r){r*=.5;var c=t[0],d=t[1],g=t[2],_=t[3],v=Math.sin(r),S=Math.cos(r);return a[0]=c*S-g*v,a[1]=d*S+_*v,a[2]=g*S+c*v,a[3]=_*S-d*v,a}Qe(),rt();var Di,gr,Er,Cl=wi,Ks=(Di=Qe(),gr=yt(1,0,0),Er=yt(0,1,0),function(a,t,r){var c=Ei(t,r);return c<-.999999?(hn(Di,gr,t),Xt(Di)<1e-6&&hn(Di,Er,t),Li(Di,Di),(function(d,g,_){_*=.5;var v=Math.sin(_);d[0]=v*g[0],d[1]=v*g[1],d[2]=v*g[2],d[3]=Math.cos(_)})(a,Di,Math.PI),a):c>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(hn(Di,t,r),a[0]=Di[0],a[1]=Di[1],a[2]=Di[2],a[3]=1+c,Cl(a,a))});function mo(){var a=new C(2);return C!=Float32Array&&(a[0]=0,a[1]=0),a}function Qs(a,t){var r=new C(2);return r[0]=a,r[1]=t,r}function ha(a,t,r){return a[0]=t,a[1]=r,a}function ea(a,t,r){return a[0]=t[0]+r[0],a[1]=t[1]+r[1],a}function da(a,t,r){return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a}function gs(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a}function fa(a){var t=a[0],r=a[1];return Math.sqrt(t*t+r*r)}function nl(a,t){var r=t[0],c=t[1],d=r*r+c*c;return d>0&&(d=1/Math.sqrt(d)),a[0]=t[0]*d,a[1]=t[1]*d,a}function $n(a,t){return a[0]*t[0]+a[1]*t[1]}Zi(),Zi(),O();var yr,lc,Rl=da;function ts(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}mo();var De=(function(){if(lc)return yr;function a(t,r,c,d){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=c,this.p2y=d}return lc=1,yr=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,d=0;d<8;d++){var g=this.sampleCurveX(c)-t;if(Math.abs(g)<r)return c;var _=this.sampleCurveDerivativeX(c);if(Math.abs(_)<1e-6)break;c-=g/_}var v=0,S=1;for(c=t,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-t)<r));d++)t>g?v=c:S=c,c=.5*(S-v)+v;return c},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},yr})(),Rt=ts(De);function Ae(a,t){this.x=a,this.y=t}function Ot(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(!Ot(a[r],t[r]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const r in a)if(!Ot(a[r],t[r]))return!1;return!0}return a===t}Ae.prototype={clone(){return new Ae(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,t){return this.clone()._rotateAround(a,t)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const t=a.x-this.x,r=a.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult(a){const t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const t=Math.cos(a),r=Math.sin(a),c=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=c,this},_rotateAround(a,t){const r=Math.cos(a),c=Math.sin(a),d=t.y+c*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-c*(this.y-t.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ae},Ae.convert=function(a){if(a instanceof Ae)return a;if(Array.isArray(a))return new Ae(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new Ae(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const _i=Math.PI/180,Cn=180/Math.PI;function ti(a){return a*_i}function Ee(a){return a*Cn}const Z=[[0,0],[1,0],[1,1],[0,1]];function Q(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,r=t*a;return 4*(a<.5?r:3*(a-t)+r-.75)}function ce(a,t,r,c){const d=new Rt(a,t,r,c);return function(g){return d.solve(g)}}const xe=ce(.25,.1,.25,1);function de(a,t,r){return Math.min(r,Math.max(t,a))}function Me(a,t,r){return(r=de((r-a)/(t-a),0,1))*r*(3-2*r)}function Oe(a,t,r){const c=r-t,d=((a-t)%c+c)%c+t;return d===t?r:d}function Pe(a,t,r){if(!a.length)return r(null,[]);let c=a.length;const d=new Array(a.length);let g=null;a.forEach((_,v)=>{t(_,(S,T)=>{S&&(g=S),d[v]=T,--c===0&&r(g,d)})})}let Be=1;function gt(){return Be++}function st(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log2(a)))}function Ft(a,t){a.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function ni(a,t,r){const c={};for(const d in a)c[d]=t.call(this,a[d],d,a);return c}function li(a,t,r){const c={};for(const d in a)t.call(this,a[d],d,a)&&(c[d]=a[d]);return c}function ki(a){return Array.isArray(a)?a.map(ki):typeof a=="object"&&a?ni(a,ki):a}function ji(a,t){for(let r=0;r<a.length;r++)if(t.indexOf(a[r])>=0)return!0;return!1}const Si={};function yi(a){Si[a]||(typeof console<"u"&&console.warn(a),Si[a]=!0)}function Vn(a,t,r){return(r.y-a.y)*(t.x-a.x)>(t.y-a.y)*(r.x-a.x)}function Nr(a){let t=0;for(let r,c,d=0,g=a.length,_=g-1;d<g;_=d++)r=a[d],c=a[_],t+=(c.x-r.x)*(r.y+c.y);return t}function vr([a,t,r]){const c=ti(t+90),d=ti(r);return{x:a*Math.cos(c)*Math.sin(d),y:a*Math.sin(c)*Math.sin(d),z:a*Math.cos(d),azimuthal:t,polar:r}}function xr(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function Qn(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,c,d,g)=>{const _=d||g;return t[c]=!_||_.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let on=null;function nr(a,t){return[a[4*t],a[4*t+1],a[4*t+2],a[4*t+3]]}function On(a,t,r,c){for(;t<r;){const d=t+r>>1;a[d]<c?t=d+1:r=d}return t}function Fn(a,t,r,c){for(;t<r;){const d=t+r>>1;a[d]<=c?t=d+1:r=d}return t}function _r(a){return a>0?1/(1.001-a):1+a}function To(a){return a>0?1-1/(1.001-a):-a}function go(a,t,r){return(a-t.min)*(r.max-r.min)/(t.max-t.min)+r.min}const jr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!jr.API_URL)return null;try{const a=new URL(jr.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ll(a){return jr.API_URL_REGEX.test(a)}function Ro(a){return jr.API_SPRITE_REGEX.test(a)}let _s,ta,pa,ys,No,rl;function cc(){return _s==null&&(_s=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),_s}const ks={now:()=>ys!==void 0?ys:performance.now(),setNow(a){ys=a},restoreNow(){ys=void 0},frame(a){const t=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(a,t=0){const{width:r,height:c}=a;No||(No=document.createElement("canvas"));const d=No.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(r>No.width||c>No.height)&&(No.width=r,No.height=c),d.clearRect(-t,-t,r+2*t,c+2*t),d.drawImage(a,0,0,r,c),d.getImageData(-t,-t,r+2*t,c+2*t)},resolveURL:a=>(ta||(ta=document.createElement("a")),ta.href=a,ta.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(pa==null&&(pa=window.matchMedia("(prefers-reduced-motion: reduce)")),pa.matches)},hasCanvasFingerprintNoise(){if(rl!==void 0)return rl;if(!cc())return rl=!1,!1;const a=new OffscreenCanvas(85,1),t=a.getContext("2d",{willReadFrequently:!0});let r=0;for(let d=0;d<a.width;++d)t.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,t.fillRect(d,0,1,1);const c=t.getImageData(0,0,a.width,a.height);r=0;for(let d=0;d<c.data.length;++d)if(d%4!=3&&r++!==c.data[d])return rl=!0,!0;return rl=!1,!1}};function nh(a,t){const r=a.indexOf("?");if(r<0)return`${a}?${new URLSearchParams(t).toString()}`;const c=new URLSearchParams(a.slice(r));for(const d in t)c.set(d,t[d]);return`${a.slice(0,r)}?${c.toString()}`}function rh(a,t={persistentParams:[]}){const r=a.indexOf("?");if(r<0)return a;const c=new URLSearchParams,d=new URLSearchParams(a.slice(r));for(const _ of t.persistentParams){const v=d.get(_);v&&c.set(_,v)}const g=c.toString();return`${a.slice(0,r)}${g.length>0?`?${g}`:""}`}const Uy="mapbox-tiles";let $y=500,Kp=50;const Qp=["language","worldview","jobid"];let _o,Os;function ol(){try{return caches}catch{}}function Fs(){const a=ol();a&&_o==null&&(_o=a.open(Uy))}let La=1/0;const Hc={supported:!1,testSupport:function(a){!Dl&&uc&&(zd?jy(a):Zc=a)}};let Zc,uc,Dl=!1,zd=!1;const Vy=typeof self<"u"?self:{};function jy(a){const t=a.createTexture();a.bindTexture(a.TEXTURE_2D,t);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,uc),a.isContextLost())return;Hc.supported=!0}catch{}a.deleteTexture(t),Dl=!0}Vy.document&&(uc=Vy.document.createElement("img"),uc.onload=function(){Zc&&jy(Zc),Zc=null,zd=!0},uc.onerror=function(){Dl=!0,Zc=null},uc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const is={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(is);class oh extends Error{constructor(t,r,c){r===401&&Ll(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const sh=xr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,sl=function(a,t){if(!(/^file:/.test(r=a.url)||/^file:/.test(sh())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(c,d){const g=new AbortController,_=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:sh(),referrerPolicy:c.referrerPolicy,signal:g.signal});let v=!1,S=!1;const T=(M=_.url).indexOf("sku=")>0&&Ll(M);var M;c.type==="json"&&_.headers.set("Accept","application/json");const A=(D,k,$)=>{if(S)return;if(D&&D.message!=="SecurityError"&&yi(D.toString()),k&&$)return z(k);const H=Date.now();fetch(_).then(j=>{if(j.ok){const q=T?j.clone():null;return z(j,q,H)}return d(new oh(j.statusText,j.status,c.url))}).catch(j=>{j.name!=="AbortError"&&d(new Error(`${j.message} ${c.url}`))})},z=(D,k,$)=>{(c.type==="arrayBuffer"?D.arrayBuffer():c.type==="json"?D.json():D.text()).then(H=>{S||(k&&$&&(function(j,q,Y){if(Fs(),_o==null)return;const te=Qn(q.headers.get("Cache-Control")||"");if(te["no-store"])return;const ue={status:q.status,statusText:q.statusText,headers:new Headers};q.headers.forEach((ye,me)=>ue.headers.set(me,ye)),te["max-age"]&&ue.headers.set("Expires",new Date(Y+1e3*te["max-age"]).toUTCString());const ae=ue.headers.get("Expires");if(!ae||new Date(ae).getTime()-Y<42e4)return;let ge=rh(j.url,{persistentParams:Qp});if(q.status===206){const ye=j.headers.get("Range");if(!ye)return;ue.status=200,ge=nh(ge,{range:ye})}(function(ye,me){if(Os===void 0)try{new Response(new ReadableStream),Os=!0}catch{Os=!1}Os?me(ye.body):ye.blob().then(me).catch(we=>yi(we.message))})(q,ye=>{const me=new Response((we=q.status)!==200&&we!==404&&[101,103,204,205,304].includes(we)?null:ye,ue);var we;Fs(),_o!=null&&_o.then(Ie=>Ie.put(ge,me)).catch(Ie=>yi(Ie.message))})})(_,k,$),v=!0,d(null,H,D.headers))}).catch(H=>{S||d(new Error(H.message))})};return T?(function(D,k){if(Fs(),_o==null)return k(null);_o.then($=>{let H=rh(D.url,{persistentParams:Qp});const j=D.headers.get("Range");j&&(H=nh(H,{range:j})),$.match(H).then(q=>{const Y=(function(te){if(!te)return!1;const ue=new Date(te.headers.get("Expires")||0),ae=Qn(te.headers.get("Cache-Control")||"");return Number(ue)>Date.now()&&!ae["no-cache"]})(q);$.delete(H).catch(k),Y&&$.put(H,q.clone()).catch(k),k(null,q,Y)}).catch(k)}).catch(k)})(_,A):A(null,null),{cancel:()=>{S=!0,v||g.abort()}}})(a,t);if(xr(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,t,void 0,!0)}var r;return(function(c,d){const g=new XMLHttpRequest;g.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const _ in c.headers)g.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=c.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let _=g.response;if(c.type==="json")try{_=JSON.parse(g.response)}catch(S){return d(S)}const v=new Headers;g.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(S=>{const T=S.split(": "),M=T.shift(),A=T.join(": ");v.append(M,A)}),d(null,_,v)}else d(new oh(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}})(a,t)},ah=function(a,t){return sl(Object.assign(a,{type:"arrayBuffer"}),t)};function jw(a){const t=document.createElement("a");return t.href=a,t.protocol===location.protocol&&t.host===location.host}const em="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let un,Wc;un=[],Wc=0;const Cd=function(a,t){if(Hc.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Wc>=jr.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return un.push(g),g}Wc++;let r=!1;const c=()=>{if(!r)for(r=!0,Wc--;un.length&&Wc<jr.MAX_PARALLEL_IMAGE_REQUESTS;){const g=un.shift(),{requestParameters:_,callback:v,cancelled:S}=g;S||(g.cancel=Cd(_,v).cancel)}},d=ah(a,(g,_,v)=>{c(),g?t(g):_&&(self.createImageBitmap?(function(S,T){const M=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(M).then(A=>{T(null,A)}).catch(A=>{T(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(_,(S,T)=>t(S,T,v)):(function(S,T){const M=new Image;M.onload=()=>{T(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=em})},M.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(S)],{type:"image/png"});M.src=S.byteLength?URL.createObjectURL(A):em})(_,(S,T)=>t(S,T,v)))});return{cancel:()=>{d.cancel(),c()}}};var Gy,Hy,lh,kl={exports:{}},ch={exports:{}},Rd={exports:{}},Gw=(function(){if(lh)return kl.exports;lh=1;var a=(Gy||(Gy=1,ch.exports=function(r,c){var d,g,_,v,S,T,M,A;for(g=r.length-(d=3&r.length),_=c,S=3432918353,T=461845907,A=0;A<g;)M=255&r.charCodeAt(A)|(255&r.charCodeAt(++A))<<8|(255&r.charCodeAt(++A))<<16|(255&r.charCodeAt(++A))<<24,++A,_=27492+(65535&(v=5*(65535&(_=(_^=M=(65535&(M=(M=(65535&M)*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+(((v>>>16)+58964&65535)<<16);switch(M=0,d){case 3:M^=(255&r.charCodeAt(A+2))<<16;case 2:M^=(255&r.charCodeAt(A+1))<<8;case 1:_^=M=(65535&(M=(M=(65535&(M^=255&r.charCodeAt(A)))*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),ch.exports),t=(Hy||(Hy=1,Rd.exports=function(r,c){for(var d,g=r.length,_=c^g,v=0;g>=4;)d=1540483477*(65535&(d=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++v;switch(g){case 3:_^=(255&r.charCodeAt(v+2))<<16;case 2:_^=(255&r.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Rd.exports);return kl.exports=a,kl.exports.murmur3=a,kl.exports.murmur2=t,kl.exports})(),qc=ts(Gw);class al{constructor(t,...r){Object.assign(this,r[0]||{}),this.type=t}}class uh extends al{constructor(t,r={}){super("error",Object.assign({error:t},r))}}function Zy(a,t,r){r[a]&&r[a].indexOf(t)!==-1||(r[a]=r[a]||[],r[a].push(t))}function hc(a,t,r){if(r&&r[a]){const c=r[a].indexOf(t);c!==-1&&r[a].splice(c,1)}}class ll{on(t,r){return this._listeners=this._listeners||{},Zy(t,r,this._listeners),this}off(t,r){return hc(t,r,this._listeners),hc(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Zy(t,r,this._oneTimeListeners),this):new Promise(c=>{this.once(t,c)})}fire(t,r){const c=typeof t=="string"?new al(t,r):t,d=c.type;if(this.listens(d)){c.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const S of g)S.call(this,c);const _=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const S of _)hc(d,S,this._oneTimeListeners),S.call(this,c);const v=this._eventedParent;if(v){const S=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(c,S),v.fire(c)}}else c instanceof uh&&console.error(c.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}class ns{constructor(t){typeof t=="string"?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId)}static from(t){return new ns(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){const[r,c]=t.split("");return new ns({name:r,iconsetId:c})}static isEqual(t,r){return t.name===r.name&&t.iconsetId===r.iconsetId}toString(){return ns.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ia,Ld={},Wy=(function(){if(ia)return Ld;ia=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(g){return(g=Math.round(g))<0?0:g>255?255:g}function r(g){return t(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function c(g){return(_=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:_>1?1:_;var _}function d(g,_,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?g+(_-g)*v*6:2*v<1?_:3*v<2?g+(_-g)*(2/3-v)*6:g}try{Ld.parseCSSColor=function(g){var _,v=g.replace(/ /g,"").toLowerCase();if(v in a)return a[v].slice();if(v[0]==="#")return v.length===4?(_=parseInt(v.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:v.length===7&&(_=parseInt(v.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var S=v.indexOf("("),T=v.indexOf(")");if(S!==-1&&T+1===v.length){var M=v.substr(0,S),A=v.substr(S+1,T-(S+1)).split(","),z=1;switch(M){case"rgba":if(A.length!==4)return null;z=c(A.pop());case"rgb":return A.length!==3?null:[r(A[0]),r(A[1]),r(A[2]),z];case"hsla":if(A.length!==4)return null;z=c(A.pop());case"hsl":if(A.length!==3)return null;var D=(parseFloat(A[0])%360+360)%360/360,k=c(A[1]),$=c(A[2]),H=$<=.5?$*(k+1):$+k-$*k,j=2*$-H;return[t(255*d(j,H,D+1/3)),t(255*d(j,H,D)),t(255*d(j,H,D-1/3)),z];default:return null}}return null}}catch{}return Ld})();class bn{constructor(t,r,c,d=1){this.r=t,this.g=r,this.b=c,this.a=d}static parse(t){if(!t)return;if(t instanceof bn)return t;if(typeof t!="string")return;const r=Wy.parseCSSColor(t);return r?new bn(r[0]/255,r[1]/255,r[2]/255,r[3]):void 0}toString(){const[t,r,c,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*c)},${d})`}toNonPremultipliedRenderColor(t){const{r,g:c,b:d,a:g}=this;return new qy(t,r,c,d,g)}toPremultipliedRenderColor(t){const{r,g:c,b:d,a:g}=this;return new Xy(t,r*g,c*g,d*g,g)}clone(){return new bn(this.r,this.g,this.b,this.a)}}class tm{constructor(t,r,c,d,g,_=!1){if(this.premultiplied=!1,this.premultiplied=_,t){const v=t.image.height,S=v*v;this.premultiplied?(r=g===0?0:r/g*(v-1),c=g===0?0:c/g*(v-1),d=g===0?0:d/g*(v-1)):(r*=v-1,c*=v-1,d*=v-1),r=Math.max(0,Math.min(v-1,r)),c=Math.max(0,Math.min(v-1,c)),d=Math.max(0,Math.min(v-1,d));const T=Math.floor(r),M=Math.floor(c),A=Math.floor(d),z=Math.ceil(r),D=Math.ceil(c),k=Math.ceil(d),$=r-T,H=c-M,j=d-A,q=t.image.data,Y=4*(T+M*S+A*v),te=4*(T+M*S+k*v),ue=4*(T+D*S+A*v),ae=4*(T+D*S+k*v),ge=4*(z+M*S+A*v),ye=4*(z+M*S+k*v),me=4*(z+D*S+A*v),we=4*(z+D*S+k*v);this.r=hi(hi(hi(q[Y],q[te],j),hi(q[ue],q[ae],j),H),hi(hi(q[ge],q[ye],j),hi(q[me],q[we],j),H),$)/255*(this.premultiplied?g:1),this.g=hi(hi(hi(q[Y+1],q[te+1],j),hi(q[ue+1],q[ae+1],j),H),hi(hi(q[ge+1],q[ye+1],j),hi(q[me+1],q[we+1],j),H),$)/255*(this.premultiplied?g:1),this.b=hi(hi(hi(q[Y+2],q[te+2],j),hi(q[ue+2],q[ae+2],j),H),hi(hi(q[ge+2],q[ye+2],j),hi(q[me+2],q[we+2],j),H),$)/255*(this.premultiplied?g:1),this.a=g}else this.r=r,this.g=c,this.b=d,this.a=g}toArray(){const{r:t,g:r,b:c,a:d}=this;return[255*t,255*r,255*c,d]}toHslaArray(){let{r:t,g:r,b:c,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const k=1/d;t*=k,r*=k,c*=k}const g=Math.min(Math.max(t,0),1),_=Math.min(Math.max(r,0),1),v=Math.min(Math.max(c,0),1),S=Math.min(g,_,v),T=Math.max(g,_,v),M=T-S,A=.5*(S+T);if(M===0)return[0,0,100*A,d];const z=A>.5?M/(2-T-S):M/(T+S);let D;switch(T){case g:D=60*((_-v)/M+(_<v?6:0));break;case _:D=60*((v-g)/M+2);break;default:D=60*((g-_)/M+4)}return[D,100*z,100*A,d]}toArray01(){const{r:t,g:r,b:c,a:d}=this;return[t,r,c,d]}toArray01Scaled(t){const{r,g:c,b:d}=this;return[r*t,c*t,d*t]}toArray01Linear(){const{r:t,g:r,b:c,a:d}=this;return[Math.pow(t,2.2),Math.pow(r,2.2),Math.pow(c,2.2),d]}}class qy extends tm{constructor(t,r,c,d,g){super(t,r,c,d,g,!1)}}class Xy extends tm{constructor(t,r,c,d,g){super(t,r,c,d,g,!0)}}function hi(a,t,r){return a*(1-r)+t*r}function im(a,t,r){return a.map((c,d)=>hi(c,t[d],r))}bn.black=new bn(0,0,0,1),bn.white=new bn(1,1,1,1),bn.transparent=new bn(0,0,0,0),bn.red=new bn(1,0,0,1),bn.blue=new bn(0,0,1,1);var dc=Object.freeze({__proto__:null,array:im,color:function(a,t,r){return new bn(hi(a.r,t.r,r),hi(a.g,t.g,r),hi(a.b,t.b,r),hi(a.a,t.a,r))},number:hi});class Uo extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Dd{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[c,d]of r)this.bindings[c]=d}concat(t){return new Dd(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const rs={kind:"null"},ii={kind:"number"},xn={kind:"string"},pn={kind:"boolean"},$o={kind:"color"},Xc={kind:"object"},Tn={kind:"value"},kd={kind:"collator"},Jc={kind:"formatted"},fc={kind:"resolvedImage"};function Lo(a,t){return{kind:"array",itemType:a,N:t}}function Ar(a){if(a.kind==="array"){const t=Ar(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const Hw=[rs,ii,xn,pn,$o,Jc,Xc,Lo(Tn),fc];function hh(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!hh(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const r of Hw)if(!hh(r,t))return null}}return`Expected ${Ar(a)} but found ${Ar(t)} instead.`}function nm(a,t){return t.some(r=>r.kind===a.kind)}function dh(a,t){return t.some(r=>r==="null"?a===null:r==="array"?Array.isArray(a):r==="object"?a&&!Array.isArray(a)&&typeof a=="object":r===typeof a)}function Od(a,t){return a.kind==="array"&&t.kind==="array"?a.N===t.N&&Od(a.itemType,t.itemType):a.kind===t.kind}class rm{constructor(t,r,c){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fd{constructor(t,r,c,d,g){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=c,this.fontStack=d,this.textColor=g}}class Do{constructor(t){this.sections=t}static fromString(t){return new Do([new Fd(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||!!t.image&&t.image.hasPrimary())}static factory(t){return t instanceof Do?t:Do.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const r of this.sections){if(r.image){const d=r.image.getPrimary().id.toString();t.push(["image",d]);continue}t.push(r.text);const c={};r.fontStack&&(c["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(c["font-scale"]=r.scale),r.textColor&&(c["text-color"]=["rgba"].concat(r.textColor.toNonPremultipliedRenderColor(null).toArray())),t.push(c)}return t}}class os{constructor(t,r={}){this.id=ns.from(t),this.params=r.params,this.sx=r.sx||1,this.sy=r.sy||1}toString(){return JSON.stringify(this)}static parse(t){let r,c,d,g;try{({id:r,params:c,sx:d,sy:g}=JSON.parse(t)||{})}catch{return null}return r?new os(r,{params:c,sx:d,sy:g}):null}scaleSelf(t,r=t){return this.sx*=t,this.sy*=r,this}}class ss{constructor(t,r,c,d,g=!1){this.primaryId=ns.from(t),this.primaryOptions=r,c&&(this.secondaryId=ns.from(c)),this.secondaryOptions=d,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new os(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new os(this.secondaryId,this.secondaryOptions):null}static from(t){return typeof t=="string"?ss.build({name:t}):t}static build(t,r,c,d){return!t||typeof t=="object"&&!("name"in t)?null:new ss(t,c,r,d)}}function om(a,t,r,c){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[a,t,r,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[a,t,r,c]:[a,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ol(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof bn||a instanceof rm||a instanceof Do||a instanceof ss)return!0;if(Array.isArray(a)){for(const t of a)if(!Ol(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!Ol(a[t]))return!1;return!0}return!1}function Kr(a){if(a===null)return rs;if(typeof a=="string")return xn;if(typeof a=="boolean")return pn;if(typeof a=="number")return ii;if(a instanceof bn)return $o;if(a instanceof rm)return kd;if(a instanceof Do)return Jc;if(a instanceof ss)return fc;if(Array.isArray(a)){const t=a.length;let r;for(const c of a){const d=Kr(c);if(r){if(r===d)continue;r=Tn;break}r=d}return Lo(r||Tn,t)}return Xc}function Da(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Do||a instanceof ss||a instanceof bn?a.toString():JSON.stringify(a)}class cl{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ol(t[1]))return r.error("invalid value");const c=t[1];let d=Kr(c);const g=r.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new cl(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof bn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Do?this.value.serialize():this.value}}class Gr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Fl={string:xn,number:ii,boolean:pn,object:Xc};class Ii{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c,d=1;const g=t[0];if(g==="array"){let v,S;if(t.length>2){const T=t[1];if(typeof T!="string"||!(T in Fl)||T==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=Fl[T],d++}else v=Tn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=t[2],d++}c=Lo(v,S)}else c=Fl[g];const _=[];for(;d<t.length;d++){const v=r.parse(t[d],d,Tn);if(!v)return null;_.push(v)}return new Ii(c,_)}evaluate(t){for(let r=0;r<this.args.length;r++){const c=this.args[r].evaluate(t);if(!hh(this.type,Kr(c)))return c;if(r===this.args.length-1)throw new Gr(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${Ar(Kr(c))} but was expected to be of type ${Ar(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,r=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){r.push(c.kind);const d=t.N;(typeof d=="number"||this.args.length>1)&&r.push(d)}}return r.concat(this.args.map(c=>c.serialize()))}}class Kt{constructor(t){this.type=Jc,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return r.error("First argument must be an image or text section.");const d=[];let g=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let S=null;if(v["font-scale"]&&(S=r.parseObjectValue(v["font-scale"],_,"font-scale",ii),!S))return null;let T=null;if(v["text-font"]&&(T=r.parseObjectValue(v["text-font"],_,"text-font",Lo(xn)),!T))return null;let M=null;if(v["text-color"]&&(M=r.parseObjectValue(v["text-color"],_,"text-color",$o),!M))return null;const A=d[d.length-1];A.scale=S,A.font=T,A.textColor=M}else{const S=r.parse(t[_],_,Tn);if(!S)return null;const T=S.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:S,scale:null,font:null,textColor:null})}}return new Kt(d)}evaluate(t){return new Do(this.sections.map(r=>{const c=r.content.evaluate(t);return Od(Kr(c),fc)?new Fd("",c,null,null,null):new Fd(Da(c),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const r of this.sections){t.push(r.content.serialize());const c={};r.scale&&(c["font-scale"]=r.scale.serialize()),r.font&&(c["text-font"]=r.font.serialize()),r.textColor&&(c["text-color"]=r.textColor.serialize()),t.push(c)}return t}}class Yc{constructor(t,r,c,d){this._imageWarnHistory={},this.type=fc,this.namePrimary=t,this.nameSecondary=r,c&&(this.paramsPrimary=c.params,this.iconsetIdPrimary=c.iconset?c.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(t,r){if(t.length<2)return r.error("Expected two or more arguments.");let c=1;const d=[];function g(){if(c<t.length){const v=r.parse(t[c],c++,xn);return v?(d.push({image:v,options:{}}),!0):(r.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(c<t.length){const S=t[c];if((v=S)===null||typeof v!="object"||Array.isArray(v))return!0;const T=S.params,M=S.iconset,A=r.concat(c);if(!T&&!M)return c++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return A.error('Image options "params" should be an object'),!1;const z={},D=A.concat(void 0,"params");for(const k in T){if(!k)return D.error("Image parameter name should be non-empty"),!1;const $=D.concat(void 0,k).parse(T[k],void 0,$o,void 0,{typeAnnotation:"coerce"});if(!$)return!1;z[k]=$}d[d.length-1].options.params=z}if(M){if(typeof M!="object"||M.constructor!==Object)return A.error('Image options "iconset" should be an object'),!1;if(!M.id)return A.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=M}return c++,!0}var v;return!0}for(let v=0;v<2;v++)if(!g()||!_())return;return new Yc(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(t,r){const c={};if(r){for(const d in r)if(r[d])try{c[d]=r[d].evaluate(t)}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(t){const r={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},c=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,d=ss.build(r,c,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(d&&t.availableImages){const g=d.getPrimary().id;if(d.available=t.availableImages.some(_=>ns.isEqual(_,g)),d.available){const _=d.getSecondary()?d.getSecondary().id:null;_&&(d.available=t.availableImages.some(v=>ns.isEqual(v,_)))}}return d}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&t(this.paramsPrimary[r]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&t(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(t,r){const c={};if(r&&(c.iconset={id:r}),t){c.params={};for(const d in t)t[d]&&(c.params[d]=t[d].serialize())}return Object.keys(c).length>0?c:void 0}serialize(){const t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&t.push(r)}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&t.push(r)}return t}}function vi(a){return fh(a)?"string":di(a)?"number":sm(a)?"boolean":Array.isArray(a)?"array":a===null?"null":Bd(a)?"object":typeof a}function Bd(a){return a!=null&&!Array.isArray(a)&&typeof a!="function"&&!(a instanceof String||a instanceof Number||a instanceof Boolean)&&typeof a=="object"}function fh(a){return typeof a=="string"||a instanceof String}function di(a){return typeof a=="number"||a instanceof Number}function sm(a){return typeof a=="boolean"||a instanceof Boolean}const am={"to-boolean":pn,"to-color":$o,"to-number":ii,"to-string":xn};class ka{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[0],d=[];let g=rs;if(c==="to-array"){if(!Array.isArray(t[1]))return null;const _=t[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);g=Lo(r.expectedType.itemType,_)}else{if(!(_>0&&Ol(t[1][0])))return null;g=Lo(Kr(t[1][0]),_)}for(let v=0;v<_;v++){const S=t[1][v];let T;if(Array.isArray(S))T=r.parse(S,void 0,g.itemType);else{const M=vi(S);if(M!==g.itemType.kind)return r.error(`Expected ${g.itemType.kind} but found ${M}.`);T=r.registry.literal.parse(["literal",S===void 0?null:S],r)}if(!T)return null;d.push(T)}}else{if((c==="to-boolean"||c==="to-string")&&t.length!==2)return r.error("Expected one argument.");g=am[c];for(let _=1;_<t.length;_++){const v=r.parse(t[_],_,Tn);if(!v)return null;d.push(v)}}return new ka(g,d)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let r,c;for(const d of this.args){if(r=d.evaluate(t),c=null,r instanceof bn)return r;if(typeof r=="string"){const g=t.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(c=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:om(r[0],r[1],r[2],r[3]),!c))return new bn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Gr(c||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const c of this.args){if(r=c.evaluate(t),r===null)return 0;const d=Number(r);if(!isNaN(d))return d}throw new Gr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Do.fromString(Da(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ss.build(Da(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(r=>r.evaluate(t)):Da(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Kt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Yc(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}const Jy=["Unknown","Point","LineString","Polygon"];class Kc{constructor(t,r,c){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=r,this.iconImageUseTheme=c}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:c,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*r-t[0])+this.featureDistanceData.bearing[1]*(d*r-t[1])}return 0}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=bn.parse(t)),r}getConfig(t){return this.options?this.options.get(t):null}}class as{constructor(t,r,c,d,g){this.name=t,this.type=r,this._evaluate=c,this.args=d,this._overloadIndex=g}evaluate(t){if(!this._evaluate){const r=as.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){const c=t[0],d=as.definitions[c];if(!d)return r.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,v=[];let S=null,T=-1;for(const[M,A]of _){if(Array.isArray(M)&&M.length!==t.length-1)continue;v.push(M),T++,S=new qd(r.registry,r.path,null,r.scope,void 0,r._scope,r.options,r.iconImageUseTheme);const z=[];let D=!1;for(let k=1;k<t.length;k++){const $=t[k],H=Array.isArray(M)?M[k-1]:M.type,j=S.parse($,1+z.length,H);if(!j){D=!0;break}z.push(j)}if(!D)if(Array.isArray(M)&&M.length!==z.length)S.error(`Expected ${M.length} arguments, but found ${z.length} instead.`);else{for(let k=0;k<z.length;k++){const $=Array.isArray(M)?M[k]:M.type,H=z[k];S.concat(k+1).checkSubtype($,H.type)}if(S.errors.length===0)return new as(c,g,A,z,T)}}if(v.length===1)r.errors.push(...S.errors);else{const M=(v.length?v:_.map(([z])=>z)).map(lm).join(" | "),A=[];for(let z=1;z<t.length;z++){const D=r.parse(t[z],1+A.length);if(!D)return null;A.push(Ar(D.type))}r.error(`Expected arguments of type ${M}, but found (${A.join(", ")}) instead.`)}return null}static register(t,r){as.definitions=r;for(const c in r)t[c]=as}}function lm(a){return Array.isArray(a)?`(${a.map(Ar).join(", ")})`:`(${Ar(a.type)}...)`}class Oa{constructor(t,r,c){this.type=kd,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return r.error("Collator options argument must be an object.");const d=c["case-sensitive"]===void 0?r.parse(!1,1,pn):r.parseObjectValue(c["case-sensitive"],1,"case-sensitive",pn);if(!d)return null;const g=c["diacritic-sensitive"]===void 0?r.parse(!1,1,pn):r.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",pn);if(!g)return null;let _=null;return c.locale&&(_=r.parseObjectValue(c.locale,1,"locale",xn),!_)?null:new Oa(d,g,_)}evaluate(t){return new rm(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Nd(a,t,r=0,c=a.length-1,d=Bl){for(;c>r;){if(c-r>600){const S=c-r+1,T=t-r+1,M=Math.log(S),A=.5*Math.exp(2*M/3),z=.5*Math.sqrt(M*A*(S-A)/S)*(T-S/2<0?-1:1);Nd(a,t,Math.max(r,Math.floor(t-T*A/S+z)),Math.min(c,Math.floor(t+(S-T)*A/S+z)),d)}const g=a[t];let _=r,v=c;for(na(a,r,t),d(a[c],g)>0&&na(a,r,c);_<v;){for(na(a,_,v),_++,v--;d(a[_],g)<0;)_++;for(;d(a[v],g)>0;)v--}d(a[r],g)===0?na(a,r,v):(v++,na(a,v,c)),v<=t&&(r=v+1),t<=v&&(c=v-1)}}function na(a,t,r){const c=a[t];a[t]=a[r],a[r]=c}function Bl(a,t){return a<t?-1:a>t?1:0}function Zw(a){let t=0;for(let r,c,d=0,g=a.length,_=g-1;d<g;_=d++)r=a[d],c=a[_],t+=(c.x-r.x)*(r.y+c.y);return t}function ph(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function mh(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Ud(a,t,r){const c=a[0]-t[0],d=a[1]-t[1],g=a[0]-r[0],_=a[1]-r[1];return c*_-g*d===0&&c*g<=0&&d*_<=0}function Yy(a,t,r){return t[1]>a[1]!=r[1]>a[1]&&a[0]<(r[0]-t[0])*(a[1]-t[1])/(r[1]-t[1])+t[0]}function ra(a,t,r=!1){let c=!1;for(let d=0,g=t.length;d<g;d++){const _=t[d];for(let v=0,S=_.length,T=S-1;v<S;T=v++){const M=_[T],A=_[v];if(Ud(a,M,A))return r;Yy(a,M,A)&&(c=!c)}}return c}function Ky(a,t,r,c){const d=c[0]-r[0],g=c[1]-r[1],_=(a[0]-r[0])*g-d*(a[1]-r[1]),v=(t[0]-r[0])*g-d*(t[1]-r[1]);return _>0&&v<0||_<0&&v>0}function $d(a,t,r,c){return(d=[c[0]-r[0],c[1]-r[1]])[0]*(g=[t[0]-a[0],t[1]-a[1]])[1]-d[1]*g[0]!==0&&!(!Ky(a,t,r,c)||!Ky(r,c,a,t));var d,g}function gh(a){const t=new Ae(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new Ae(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of a[0])t.x>c.x&&(t.x=c.x),t.y>c.y&&(t.y=c.y),r.x<c.x&&(r.x=c.x),r.y<c.y&&(r.y=c.y);return{min:t,max:r}}const Nl=8192;function Ww(a,t){const r=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(r*d*Nl),Math.round(c*d*Nl)]}function Qy(a,t){for(let r=0;r<t.length;r++)if(ra(a,t[r]))return!0;return!1}function qw(a,t,r){for(const c of r)for(let d=0,g=c.length,_=g-1;d<g;_=d++)if($d(a,t,c[_],c[d]))return!0;return!1}function cm(a,t){for(let r=0;r<a.length;++r)if(!ra(a[r],t))return!1;for(let r=0;r<a.length-1;++r)if(qw(a[r],a[r+1],t))return!1;return!0}function Xw(a,t){for(let r=0;r<t.length;r++)if(cm(a,t[r]))return!0;return!1}function ul(a,t,r){const c=[];for(let d=0;d<a.length;d++){const g=[];for(let _=0;_<a[d].length;_++){const v=Ww(a[d][_],r);ph(t,v),g.push(v)}c.push(g)}return c}function ev(a,t,r){const c=[];for(let d=0;d<a.length;d++){const g=ul(a[d],t,r);c.push(g)}return c}function tv(a,t,r,c){if(a[0]<r[0]||a[0]>r[2]){const d=.5*c;let g=a[0]-r[0]>d?-c:r[0]-a[0]>d?c:0;g===0&&(g=a[0]-r[2]>d?-c:r[2]-a[0]>d?c:0),a[0]+=g}ph(t,a)}function Vd(a,t,r,c){const d=Math.pow(2,c.z)*Nl,g=[c.x*Nl,c.y*Nl],_=[];if(!a)return _;for(const v of a)for(const S of v){const T=[S.x+g[0],S.y+g[1]];tv(T,t,r,d),_.push(T)}return _}function um(a,t,r,c){const d=Math.pow(2,c.z)*Nl,g=[c.x*Nl,c.y*Nl],_=[];if(!a)return _;for(const S of a){const T=[];for(const M of S){const A=[M.x+g[0],M.y+g[1]];ph(t,A),T.push(A)}_.push(T)}if(t[2]-t[0]<=d/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of _)for(const T of S)tv(T,t,r,d)}var v;return _}class Ul{constructor(t,r){this.type=pn,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ol(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let d=0;d<c.features.length;++d){const g=c.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ul(c,c.features[d].geometry)}else if(c.type==="Feature"){const d=c.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ul(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Ul(c,c)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,c){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const v=ul(c.coordinates,g,_),S=Vd(r.geometry(),d,g,_);if(!mh(d,g))return!1;for(const T of S)if(!ra(T,v))return!1}if(c.type==="MultiPolygon"){const v=ev(c.coordinates,g,_),S=Vd(r.geometry(),d,g,_);if(!mh(d,g))return!1;for(const T of S)if(!Qy(T,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,c){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const v=ul(c.coordinates,g,_),S=um(r.geometry(),d,g,_);if(!mh(d,g))return!1;for(const T of S)if(!cm(T,v))return!1}if(c.type==="MultiPolygon"){const v=ev(c.coordinates,g,_),S=um(r.geometry(),d,g,_);if(!mh(d,g))return!1;for(const T of S)if(!Xw(T,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const vs={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},hm=1/298.257223563,dm=hm*(2-hm),Qc=Math.PI/180;class eu{static fromTile(t,r,c){const d=Math.PI*(1-2*(t+.5)/Math.pow(2,r)),g=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Qc;return new eu(g,c)}static get units(){return vs}constructor(t,r){if(t===void 0)throw new Error("No latitude given.");if(r&&!vs[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(vs).join(", ")}`);const c=6378.137*Qc*(r?vs[r]:1),d=Math.cos(t*Qc),g=1/(1-dm*(1-d*d)),_=Math.sqrt(g);this.kx=c*_*d,this.ky=c*_*g*(1-dm)}distance(t,r){const c=Bs(t[0]-r[0])*this.kx,d=(t[1]-r[1])*this.ky;return Math.sqrt(c*c+d*d)}bearing(t,r){const c=Bs(r[0]-t[0])*this.kx;return Math.atan2(c,(r[1]-t[1])*this.ky)/Qc}destination(t,r,c){const d=c*Qc;return this.offset(t,Math.sin(d)*r,Math.cos(d)*r)}offset(t,r,c){return[t[0]+r/this.kx,t[1]+c/this.ky]}lineDistance(t){let r=0;for(let c=0;c<t.length-1;c++)r+=this.distance(t[c],t[c+1]);return r}area(t){let r=0;for(let c=0;c<t.length;c++){const d=t[c];for(let g=0,_=d.length,v=_-1;g<_;v=g++)r+=Bs(d[g][0]-d[v][0])*(d[g][1]+d[v][1])*(c?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(t,r){let c=0;if(r<=0)return t[0];for(let d=0;d<t.length-1;d++){const g=t[d],_=t[d+1],v=this.distance(g,_);if(c+=v,c>r)return jd(g,_,(r-(c-v))/v)}return t[t.length-1]}pointToSegmentDistance(t,r,c){let[d,g]=r,_=Bs(c[0]-d)*this.kx,v=(c[1]-g)*this.ky;if(_!==0||v!==0){const S=(Bs(t[0]-d)*this.kx*_+(t[1]-g)*this.ky*v)/(_*_+v*v);S>1?(d=c[0],g=c[1]):S>0&&(d+=_/this.kx*S,g+=v/this.ky*S)}return _=Bs(t[0]-d)*this.kx,v=(t[1]-g)*this.ky,Math.sqrt(_*_+v*v)}pointOnLine(t,r){let c=1/0,d=t[0][0],g=t[0][1],_=0,v=0;for(let S=0;S<t.length-1;S++){let T=t[S][0],M=t[S][1],A=Bs(t[S+1][0]-T)*this.kx,z=(t[S+1][1]-M)*this.ky,D=0;A===0&&z===0||(D=(Bs(r[0]-T)*this.kx*A+(r[1]-M)*this.ky*z)/(A*A+z*z),D>1?(T=t[S+1][0],M=t[S+1][1]):D>0&&(T+=A/this.kx*D,M+=z/this.ky*D)),A=Bs(r[0]-T)*this.kx,z=(r[1]-M)*this.ky;const k=A*A+z*z;k<c&&(c=k,d=T,g=M,_=S,v=D)}return{point:[d,g],index:_,t:Math.max(0,Math.min(1,v))}}lineSlice(t,r,c){let d=this.pointOnLine(c,t),g=this.pointOnLine(c,r);if(d.index>g.index||d.index===g.index&&d.t>g.t){const T=d;d=g,g=T}const _=[d.point],v=d.index+1,S=g.index;!fm(c[v],_[0])&&v<=S&&_.push(c[v]);for(let T=v+1;T<=S;T++)_.push(c[T]);return fm(c[S],g.point)||_.push(g.point),_}lineSliceAlong(t,r,c){let d=0;const g=[];for(let _=0;_<c.length-1;_++){const v=c[_],S=c[_+1],T=this.distance(v,S);if(d+=T,d>t&&g.length===0&&g.push(jd(v,S,(t-(d-T))/T)),d>=r)return g.push(jd(v,S,(r-(d-T))/T)),g;d>t&&g.push(S)}return g}bufferPoint(t,r){const c=r/this.ky,d=r/this.kx;return[t[0]-d,t[1]-c,t[0]+d,t[1]+c]}bufferBBox(t,r){const c=r/this.ky,d=r/this.kx;return[t[0]-d,t[1]-c,t[2]+d,t[3]+c]}insideBBox(t,r){return Bs(t[0]-r[0])>=0&&Bs(t[0]-r[2])<=0&&t[1]>=r[1]&&t[1]<=r[3]}}function fm(a,t){return a[0]===t[0]&&a[1]===t[1]}function jd(a,t,r){const c=Bs(t[0]-a[0]);return[a[0]+c*r,a[1]+(t[1]-a[1])*r]}function Bs(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class _h{constructor(t=[],r=(c,d)=>c<d?-1:c>d?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:c}=this,d=r[t];for(;t>0;){const g=t-1>>1,_=r[g];if(c(d,_)>=0)break;r[t]=_,t=g}r[t]=d}_down(t){const{data:r,compare:c}=this,d=this.length>>1,g=r[t];for(;t<d;){let _=1+(t<<1);const v=_+1;if(v<this.length&&c(r[v],r[_])<0&&(_=v),c(r[_],g)>=0)break;r[t]=r[_],t=_}r[t]=g}}var It=8192;function pm(a,t){return t.dist-a.dist}function mm(a){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==a.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==a[r])return!1;return!0}function yh(a){return a[1]-a[0]+1}function Fa(a,t){const r=a[1]>=a[0]&&a[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function gm(a,t){if(a[0]>a[1])return[null,null];const r=yh(a);if(t){if(r===2)return[a,null];const c=Math.floor(r/2);return[[a[0],a[0]+c],[a[0]+c,a[1]]]}{if(r===1)return[a,null];const c=Math.floor(r/2)-1;return[[a[0],a[0]+c],[a[0]+c+1,a[1]]]}}function pc(a,t){const r=[1/0,1/0,-1/0,-1/0];if(!Fa(t,a.length))return r;for(let c=t[0];c<=t[1];++c)ph(r,a[c]);return r}function mc(a){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<a.length;++r)for(let c=0;c<a[r].length;++c)ph(t,a[r][c]);return t}function $l(a,t,r){if(mm(a)||mm(t))return NaN;let c=0,d=0;return a[2]<t[0]&&(c=t[0]-a[2]),a[0]>t[2]&&(c=a[0]-t[2]),a[1]>t[3]&&(d=a[1]-t[3]),a[3]<t[1]&&(d=t[1]-a[3]),r.distance([0,0],[c,d])}function Gd(a){return 360*a-180}function iv(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Hd(a,t){const r=Math.pow(2,t.z),c=(a.y/It+t.y)/r;return[Gd((a.x/It+t.x)/r),iv(c)]}function Jw(a,t){const r=[];for(let c=0;c<a.length;++c)r.push(Hd(a[c],t));return r}function nv(a,t,r){const c=r.pointOnLine(t,a).point;return r.distance(a,c)}function _m(a,t,r,c,d){const g=r.slice(c[0],c[1]+1);let _=1/0;for(let v=t[0];v<=t[1];++v)if((_=Math.min(_,nv(a[v],g,d)))===0)return 0;return _}function Vl(a,t,r,c,d){const g=Math.min(d.pointToSegmentDistance(a,r,c),d.pointToSegmentDistance(t,r,c)),_=Math.min(d.pointToSegmentDistance(r,a,t),d.pointToSegmentDistance(c,a,t));return Math.min(g,_)}function rn(a,t,r,c,d){if(!Fa(t,a.length)||!Fa(c,r.length))return NaN;let g=1/0;for(let _=t[0];_<t[1];++_)for(let v=c[0];v<c[1];++v){if($d(a[_],a[_+1],r[v],r[v+1]))return 0;g=Math.min(g,Vl(a[_],a[_+1],r[v],r[v+1],d))}return g}function Yw(a,t,r,c,d){if(!Fa(t,a.length)||!Fa(c,r.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let v=c[0];v<=c[1];++v)if((g=Math.min(g,d.distance(a[_],r[v])))===0)return g;return g}function Kw(a,t,r){if(ra(a,t,!0))return 0;let c=1/0;for(const d of t){const g=d.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[g-1]&&(c=Math.min(c,r.pointToSegmentDistance(a,d[g-1],d[0])))===0||(c=Math.min(c,nv(a,d,r)))===0)return c}return c}function Qw(a,t,r,c){if(!Fa(t,a.length))return NaN;for(let g=t[0];g<=t[1];++g)if(ra(a[g],r,!0))return 0;let d=1/0;for(let g=t[0];g<t[1];++g)for(const _ of r)for(let v=0,S=_.length,T=S-1;v<S;T=v++){if($d(a[g],a[g+1],_[T],_[v]))return 0;d=Math.min(d,Vl(a[g],a[g+1],_[T],_[v],c))}return d}function ym(a,t){for(const r of a)for(let c=0;c<=r.length-1;++c)if(ra(r[c],t,!0))return!0;return!1}function e1(a,t,r,c=1/0){const d=mc(a),g=mc(t);if(c!==1/0&&$l(d,g,r)>=c)return c;if(mh(d,g)){if(ym(a,t))return 0}else if(ym(t,a))return 0;let _=c;for(const v of a)for(let S=0,T=v.length,M=T-1;S<T;M=S++)for(const A of t)for(let z=0,D=A.length,k=D-1;z<D;k=z++){if($d(v[M],v[S],A[k],A[z]))return 0;_=Math.min(_,Vl(v[M],v[S],A[k],A[z],r))}return _}function Jn(a,t,r,c,d,g,_){if(g===null||_===null)return;const v=$l(pc(c,g),pc(d,_),r);v<t&&a.push({dist:v,range1:g,range2:_})}function t1(a,t,r,c,d=1/0){let g=Math.min(c.distance(a[0],r[0][0]),d);if(g===0)return g;const _=new _h([{dist:0,range1:[0,a.length-1],range2:[0,0]}],pm),v=t?50:100,S=mc(r);for(;_.length;){const T=_.pop();if(T.dist>=g)continue;const M=T.range1;if(yh(M)<=v){if(!Fa(M,a.length))return NaN;if(t){const A=Qw(a,M,r,c);if((g=Math.min(g,A))===0)return g}else for(let A=M[0];A<=M[1];++A){const z=Kw(a[A],r,c);if((g=Math.min(g,z))===0)return g}}else{const A=gm(M,t);if(A[0]!==null){const z=$l(pc(a,A[0]),S,c);z<g&&_.push({dist:z,range1:A[0],range2:[0,0]})}if(A[1]!==null){const z=$l(pc(a,A[1]),S,c);z<g&&_.push({dist:z,range1:A[1],range2:[0,0]})}}}return g}function rv(a,t,r,c,d,g=1/0){let _=Math.min(g,d.distance(a[0],r[0]));if(_===0)return _;const v=new _h([{dist:0,range1:[0,a.length-1],range2:[0,r.length-1]}],pm),S=t?50:100,T=c?50:100;for(;v.length;){const M=v.pop();if(M.dist>=_)continue;const A=M.range1,z=M.range2;if(yh(A)<=S&&yh(z)<=T){if(!Fa(A,a.length)||!Fa(z,r.length))return NaN;if(t&&c?_=Math.min(_,rn(a,A,r,z,d)):t||c?t&&!c?_=Math.min(_,_m(r,z,a,A,d)):!t&&c&&(_=Math.min(_,_m(a,A,r,z,d))):_=Math.min(_,Yw(a,A,r,z,d)),_===0)return _}else{const D=gm(A,t),k=gm(z,c);Jn(v,_,d,a,r,D[0],k[0]),Jn(v,_,d,a,r,D[0],k[1]),Jn(v,_,d,a,r,D[1],k[0]),Jn(v,_,d,a,r,D[1],k[1])}}return _}function vm(a,t,r,c,d=1/0){let g=d;const _=pc(a,[0,a.length-1]);for(const v of r)if(!(g!==1/0&&$l(_,pc(v,[0,v.length-1]),c)>=g)&&(g=Math.min(g,rv(a,t,v,!0,c,g)),g===0))return g;return g}function Zd(a,t,r,c,d=1/0){let g=d;const _=pc(a,[0,a.length-1]);for(const v of r){if(g!==1/0&&$l(_,mc(v),c)>=g)continue;const S=t1(a,t,v,c,g);if(isNaN(S))return S;if((g=Math.min(g,S))===0)return g}return g}function xm(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class gc{constructor(t,r){this.type=ii,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Ol(t[1])){const c=t[1];if(c.type==="FeatureCollection"){for(let d=0;d<c.features.length;++d)if(xm(c.features[d].geometry.type))return new gc(c,c.features[d].geometry)}else if(c.type==="Feature"){if(xm(c.geometry.type))return new gc(c,c.geometry)}else if(xm(c.type))return new gc(c,c)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const r=t.geometry(),c=t.canonicalID();if(r!=null&&c!=null){if(t.geometryType()==="Point")return(function(d,g,_){const v=[];for(const T of d)for(const M of T)v.push(Hd(M,g));const S=new eu(v[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?rv(v,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S):_.type==="MultiLineString"?vm(v,!1,_.coordinates,S):_.type==="Polygon"||_.type==="MultiPolygon"?Zd(v,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,S):null})(r,c,this.geometries);if(t.geometryType()==="LineString")return(function(d,g,_){const v=[];for(const T of d){const M=[];for(const A of T)M.push(Hd(A,g));v.push(M)}const S=new eu(v[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return vm(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,S);if(_.type==="MultiLineString"){let T=1/0;for(let M=0;M<_.coordinates.length;M++){const A=vm(_.coordinates[M],!0,v,S,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}if(_.type==="Polygon"||_.type==="MultiPolygon"){let T=1/0;for(let M=0;M<v.length;M++){const A=Zd(v[M],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,S,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}return null})(r,c,this.geometries);if(t.geometryType()==="Polygon")return(function(d,g,_){const v=[];for(const T of(function(M){const A=M.length;if(A<=1)return[M];const z=[];let D,k;for(let $=0;$<A;$++){const H=Zw(M[$]);H!==0&&(M[$].area=Math.abs(H),k===void 0&&(k=H<0),k===H<0?(D&&z.push(D),D=[M[$]]):D.push(M[$]))}return D&&z.push(D),z})(d)){const M=[];for(let A=0;A<T.length;++A)M.push(Jw(T[A],g));v.push(M)}const S=new eu(v[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Zd(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,S);if(_.type==="MultiLineString"){let T=1/0;for(let M=0;M<_.coordinates.length;M++){const A=Zd(_.coordinates[M],!0,v,S,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(T,M,A){let z=1/0;for(const D of T)for(const k of M){const $=e1(D,k,A,z);if(isNaN($))return $;if((z=Math.min(z,$))===0)return z}return z})(_.type==="Polygon"?[_.coordinates]:_.coordinates,v,S):null})(r,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function tu(a){if(a instanceof as&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ul||a instanceof gc)return!1;if(a instanceof nu)return a.featureConstant;let t=!0;return a.eachChild(r=>{t&&!tu(r)&&(t=!1)}),t}function vh(a){if(a instanceof as&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(r=>{t&&!vh(r)&&(t=!1)}),t}function iu(a,t){if(a instanceof as&&t.indexOf(a.name)>=0)return!1;let r=!0;return a.eachChild(c=>{r&&!iu(c,t)&&(r=!1)}),r}function ov(a,t,r){return[a,t,r].filter(Boolean).join("")}function bm(a,t){switch(a){case"string":return Da(t);case"number":return+t;case"boolean":return!!t;case"color":return bn.parse(t);case"formatted":return Do.fromString(Da(t));case"resolvedImage":return ss.build(Da(t))}return t}function sv(a,t,r,c){return c!==void 0&&(a=c*Math.round(a/c)),t!==void 0&&a<t&&(a=t),r!==void 0&&a>r&&(a=r),a}class nu{constructor(t,r,c,d=!1){this.type=t,this.key=r,this.scope=c,this.featureConstant=d}static parse(t,r){let c=r.expectedType;if(c==null&&(c=Tn),t.length<2||t.length>3)return r.error("Invalid number of arguments for 'config' expression.");const d=r.parse(t[1],1);if(!(d instanceof cl))return r.error("Key name of 'config' expression must be a string literal.");let g,_=!0;const v=Da(d.value);if(t.length>=3){const S=r.parse(t[2],2);if(!(S instanceof cl))return r.error("Scope of 'config' expression must be a string literal.");g=Da(S.value)}if(r.options){const S=ov(v,g,r._scope),T=r.options.get(S);T&&(_=tu(T.value||T.default))}return new nu(c,v,g,_)}evaluate(t){const r=ov(this.key,this.scope,t.scope),c=t.getConfig(r);if(!c)return null;const{type:d,value:g,values:_,minValue:v,maxValue:S,stepValue:T}=c,M=c.default.evaluate(t);let A=M;if(g){const z=t.scope;t.scope=(z||"").split("").slice(1).join(""),A=g.evaluate(t),t.scope=z}return d&&(A=bm(d,A)),A===void 0||v===void 0&&S===void 0&&T===void 0||(typeof A=="number"?A=sv(A,v,S,T):Array.isArray(A)&&(A=A.map(z=>typeof z=="number"?sv(z,v,S,T):z))),g!==void 0&&A!==void 0&&_&&!_.includes(A)&&(A=M,d&&(A=bm(d,A))),(d&&d!==this.type||A!==void 0&&!Od(Kr(A),this.type))&&(A=bm(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.scope),t}}class Wd{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const c=t[1];return r.scope.has(c)?new Wd(c,r.scope.get(c)):r.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class qd{constructor(t,r=[],c,d=new Dd,g=[],_,v,S){this.registry=t,this.path=r,this.key=r.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=d,this.errors=g,this.expectedType=c,this._scope=_,this.options=v,this.iconImageUseTheme=S}parse(t,r,c,d,g={}){return r||c?this.concat(r,null,c,d)._parse(t,g):this._parse(t,g)}parseObjectValue(t,r,c,d,g,_={}){return this.concat(r,c,d,g)._parse(t,_)}_parse(t,r){function c(d,g,_){return _==="assert"?new Ii(g,[d]):_==="coerce"?new ka(g,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(d){let g=d.parse(t,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,v=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(_,v))return null}else g=c(g,_,r.typeAnnotation||"coerce");else g=c(g,_,r.typeAnnotation||"assert")}if(!(g instanceof cl)&&g.type.kind!=="resolvedImage"&&wm(g)){const _=new Kc(this._scope,this.options,this.iconImageUseTheme);try{g=new cl(g.type,g.evaluate(_))}catch(v){return this.error(v.message),null}}return g}return ka.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,c,d){let g=typeof t=="number"?this.path.concat(t):this.path;g=typeof r=="string"?g.concat(r):g;const _=d?this.scope.concat(d):this.scope;return new qd(this.registry,g,c||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(t,...r){const c=`${this.key}${r.map(d=>`[${d}]`).join("")}`;this.errors.push(new Uo(c,t))}checkSubtype(t,r){const c=hh(t,r);return c&&this.error(c),c}}function wm(a){if(a instanceof Wd)return wm(a.boundExpression);if(a instanceof as&&a.name==="error"||a instanceof Oa||a instanceof Ul||a instanceof gc||a instanceof nu)return!1;const t=a instanceof ka||a instanceof Ii;let r=!0;return a.eachChild(c=>{r=t?r&&wm(c):r&&c instanceof cl}),!!r&&tu(a)&&iu(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Xd(a,t){const r=a.length-1;let c,d,g=0,_=r,v=0;for(;g<=_;)if(v=Math.floor((g+_)/2),c=a[v],d=a[v+1],c<=t){if(v===r||t<d)return v;g=v+1}else{if(!(c>t))throw new Gr("Input is not a number.");_=v-1}return 0}class xh{constructor(t,r,c){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[d,g]of c)this.labels.push(d),this.outputs.push(g)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const c=r.parse(t[1],1,ii);if(!c)return null;const d=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],S=t[_+1],T=_,M=_+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(d.length&&d[d.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const A=r.parse(S,M,g);if(!A)return null;g=g||A.type,d.push([v,A])}return new xh(g,c,d)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const d=this.input.evaluate(t);if(d<=r[0])return c[0].evaluate(t);const g=r.length;return d>=r[g-1]?c[g-1].evaluate(t):c[Xd(r,d)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}const av=.95047,lv=1.08883,cv=4/29,ru=6/29,uv=3*ru*ru,i1=ru*ru*ru,n1=Math.PI/180,r1=180/Math.PI;function Sm(a){return a>i1?Math.pow(a,1/3):a/uv+cv}function Tm(a){return a>ru?a*a*a:uv*(a-cv)}function Em(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Im(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function hv(a){const t=Im(a.r),r=Im(a.g),c=Im(a.b),d=Sm((.4124564*t+.3575761*r+.1804375*c)/av),g=Sm((.2126729*t+.7151522*r+.072175*c)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-Sm((.0193339*t+.119192*r+.9503041*c)/lv)),alpha:a.a}}function Jd(a){let t=(a.l+16)/116,r=isNaN(a.a)?t:t+a.a/500,c=isNaN(a.b)?t:t-a.b/200;return t=1*Tm(t),r=av*Tm(r),c=lv*Tm(c),new bn(Em(3.2404542*r-1.5371385*t-.4985314*c),Em(-.969266*r+1.8760108*t+.041556*c),Em(.0556434*r-.2040259*t+1.0572252*c),a.alpha)}function Yd(a,t,r){const c=t-a;return a+r*(c>180||c<-180?c-360*Math.round(c/360):c)}const ou={forward:hv,reverse:Jd,interpolate:function(a,t,r){return{l:hi(a.l,t.l,r),a:hi(a.a,t.a,r),b:hi(a.b,t.b,r),alpha:hi(a.alpha,t.alpha,r)}}},bh={forward:function(a){const{l:t,a:r,b:c}=hv(a),d=Math.atan2(c,r)*r1;return{h:d<0?d+360:d,c:Math.sqrt(r*r+c*c),l:t,alpha:a.a}},reverse:function(a){const t=a.h*n1,r=a.c;return Jd({l:a.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:a.alpha})},interpolate:function(a,t,r){return{h:Yd(a.h,t.h,r),c:hi(a.c,t.c,r),l:hi(a.l,t.l,r),alpha:hi(a.alpha,t.alpha,r)}}};var dv=Object.freeze({__proto__:null,hcl:bh,lab:ou});class Ns{constructor(t,r,c,d,g){this.type=t,this.operator=r,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[_,v]of g)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,r,c,d){let g=0;if(t.name==="exponential")g=Kd(r,t.base,c,d);else if(t.name==="linear")g=Kd(r,1,c,d);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new Rt(_[0],_[1],_[2],_[3]).solve(Kd(r,1,c,d))}return g}static parse(t,r){let[c,d,g,..._]=t;if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const T=d[1];if(typeof T!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:T}}else{if(d[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const T=d.slice(1);if(T.length!==4||T.some(M=>typeof M!="number"||M<0||M>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,ii),!g)return null;const v=[];let S=null;c==="interpolate-hcl"||c==="interpolate-lab"?S=$o:r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType);for(let T=0;T<_.length;T+=2){const M=_[T],A=_[T+1],z=T+3,D=T+4;if(typeof M!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(v.length&&v[v.length-1][0]>=M)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const k=r.parse(A,D,S);if(!k)return null;S=S||k.type,v.push([M,k])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new Ns(S,c,d,g,v):r.error(`Type ${Ar(S)} is not interpolatable.`)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const d=this.input.evaluate(t);if(d<=r[0])return c[0].evaluate(t);const g=r.length;if(d>=r[g-1])return c[g-1].evaluate(t);const _=Xd(r,d),v=Ns.interpolationFactor(this.interpolation,d,r[_],r[_+1]),S=c[_].evaluate(t),T=c[_+1].evaluate(t);return this.operator==="interpolate"?dc[this.type.kind.toLowerCase()](S,T,v):this.operator==="interpolate-hcl"?bh.reverse(bh.interpolate(bh.forward(S),bh.forward(T),v)):ou.reverse(ou.interpolate(ou.forward(S),ou.forward(T),v))}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)r.push(this.labels[c],this.outputs[c].serialize());return r}}function Kd(a,t,r,c){const d=c-r,g=a-r;return d===0?0:t===1?g/d:(Math.pow(t,g)-1)/(Math.pow(t,d)-1)}class wh{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let c=null;const d=r.expectedType;d&&d.kind!=="value"&&(c=d);const g=[];for(const v of t.slice(1)){const S=r.parse(v,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!S)return null;c=c||S.type,g.push(S)}const _=d&&g.some(v=>hh(d,v.type));return new wh(_?Tn:c,g)}evaluate(t){let r,c=null,d=0;for(const g of this.args){if(d++,c=g.evaluate(t),c&&c instanceof ss&&!c.available&&(r||(r=c),c=null,d===this.args.length))return r;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class hl{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=r.parse(t[g+1],g+1);if(!v)return null;c.push([_,v])}const d=r.parse(t[t.length-1],t.length-1,r.expectedType,c);return d?new hl(c,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[r,c]of this.bindings)t.push(r,c.serialize());return t.push(this.result.serialize()),t}}class Qd{constructor(t,r,c){this.type=t,this.index=r,this.input=c}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,ii),d=r.parse(t[2],2,Lo(r.expectedType||Tn));return c&&d?new Qd(d.type.itemType,c,d):null}evaluate(t){const r=this.index.evaluate(t),c=this.input.evaluate(t);if(r<0)throw new Gr("Array index out of bounds: negative index");if(r>=c.length)throw new Gr("Array index out of bounds: index exceeds array size");if(r!==Math.floor(r))throw new Gr("Array index must be an integer. Use at-interpolated for fractional indices");return c[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ef{constructor(t,r,c){this.type=t,this.index=r,this.input=c}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,ii),d=r.parse(t[2],2,Lo(r.expectedType||Tn));return c&&d?new ef(d.type.itemType,c,d):null}evaluate(t){const r=this.index.evaluate(t),c=this.input.evaluate(t);if(r<0)throw new Gr(`Array index out of bounds: ${r} < 0.`);if(r>c.length-1)throw new Gr(`Array index out of bounds: ${r} > ${c.length-1}.`);if(r===Math.floor(r))return c[r];const d=Math.floor(r),g=Math.ceil(r),_=c[d],v=c[g];if(typeof _!="number"||typeof v!="number")throw new Gr(`Cannot interpolate between non-number values at index ${r}.`);const S=r-d;return _*(1-S)+v*S}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Mm{constructor(t,r){this.type=pn,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Tn),d=r.parse(t[2],2,Tn);return c&&d?nm(c.type,[pn,xn,ii,rs,Tn])?new Mm(c,d):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(c.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!dh(r,["boolean","string","number","null"]))throw new Gr(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(Kr(r))} instead.`);if(!dh(c,["string","array"]))throw new Gr(`Expected second argument to be of type array or string, but found ${Ar(Kr(c))} instead.`);return c.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class su{constructor(t,r,c){this.type=ii,this.needle=t,this.haystack=r,this.fromIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Tn),d=r.parse(t[2],2,Tn);if(!c||!d)return null;if(!nm(c.type,[pn,xn,ii,rs,Tn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(c.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,ii);return g?new su(c,d,g):null}return new su(c,d)}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!dh(r,["boolean","string","number","null"]))throw new Gr(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(Kr(r))} instead.`);if(!dh(c,["string","array"]))throw new Gr(`Expected second argument to be of type array or string, but found ${Ar(Kr(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return c.indexOf(r,d)}return c.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Sh{constructor(t,r,c,d,g,_){this.inputType=t,this.type=r,this.input=c,this.cases=d,this.outputs=g,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let c,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);const g={},_=[];for(let T=2;T<t.length-1;T+=2){let M=t[T];const A=t[T+1];Array.isArray(M)||(M=[M]);const z=r.concat(T);if(M.length===0)return z.error("Expected at least one branch label.");for(const k of M){if(typeof k!="number"&&typeof k!="string")return z.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return z.error("Numeric branch labels must be integer values.");if(c){if(z.checkSubtype(c,Kr(k)))return null}else c=Kr(k);if(g[String(k)]!==void 0)return z.error("Branch labels must be unique.");g[String(k)]=_.length}const D=r.parse(A,T,d);if(!D)return null;d=d||D.type,_.push(D)}const v=r.parse(t[1],1,Tn);if(!v)return null;const S=r.parse(t[t.length-1],t.length-1,d);return S?v.type.kind!=="value"&&r.concat(1).checkSubtype(c,v.type)?null:new Sh(c,d,v,g,_,S):null}evaluate(t){const r=this.input.evaluate(t);return(Od(Kr(r),this.inputType)&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),c=[],d={};for(const _ of r){const v=d[this.cases[_]];v===void 0?(d[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[v][1].push(_)}const g=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of c)t.push(v.length===1?g(v[0]):v.map(g)),t.push(this.outputs[_].serialize());return t.push(this.otherwise.serialize()),t}}class Th{constructor(t,r,c){this.type=t,this.branches=r,this.otherwise=c}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const d=[];for(let _=1;_<t.length-1;_+=2){const v=r.parse(t[_],_,pn);if(!v)return null;const S=r.parse(t[_+1],_+1,c);if(!S)return null;d.push([v,S]),c=c||S.type}const g=r.parse(t[t.length-1],t.length-1,c);return g?new Th(c,d,g):null}evaluate(t){for(const[r,c]of this.branches)if(r.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,c]of this.branches)t(r),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class tf{constructor(t,r,c,d){this.type=t,this.input=r,this.beginIndex=c,this.endIndex=d}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Tn),d=r.parse(t[2],2,ii);if(!c||!d)return null;if(!nm(c.type,[Lo(Tn),xn,Tn]))return r.error(`Expected first argument to be of type array or string, but found ${Ar(c.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,ii);return g?new tf(c.type,c,d,g):null}return new tf(c.type,c,d)}evaluate(t){const r=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!dh(r,["string","array"]))throw new Gr(`Expected first argument to be of type array or string, but found ${Ar(Kr(r))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return r.slice(c,d)}return r.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Am{constructor(t,r){this.type=Lo(xn),this.str=t,this.delimiter=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,xn),d=r.parse(t[2],2,xn);return c&&d?new Am(c,d):void 0}evaluate(t){const r=this.str.evaluate(t),c=this.delimiter.evaluate(t);return r.split(c)}eachChild(t){t(this.str),t(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Pm(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function zm(a,t,r,c){return c.compare(t,r)===0}function au(a,t,r){const c=a!=="=="&&a!=="!=";return class h4{constructor(g,_,v){this.type=pn,this.lhs=g,this.rhs=_,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const v=g[0];let S=_.parse(g[1],1,Tn);if(!S)return null;if(!Pm(v,S.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Ar(S.type)}'.`);let T=_.parse(g[2],2,Tn);if(!T)return null;if(!Pm(v,T.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Ar(T.type)}'.`);if(S.type.kind!==T.type.kind&&S.type.kind!=="value"&&T.type.kind!=="value")return _.error(`Cannot compare types '${Ar(S.type)}' and '${Ar(T.type)}'.`);c&&(S.type.kind==="value"&&T.type.kind!=="value"?S=new Ii(T.type,[S]):S.type.kind!=="value"&&T.type.kind==="value"&&(T=new Ii(S.type,[T])));let M=null;if(g.length===4){if(S.type.kind!=="string"&&T.type.kind!=="string"&&S.type.kind!=="value"&&T.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(g[3],3,kd),!M)return null}return new h4(S,T,M)}evaluate(g){const _=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const S=Kr(_),T=Kr(v);if(S.kind!==T.kind||S.kind!=="string"&&S.kind!=="number")throw new Gr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${S.kind}, ${T.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const S=Kr(_),T=Kr(v);if(S.kind!=="string"||T.kind!=="string")return t(g,_,v)}return this.collator?r(g,_,v,this.collator.evaluate(g)):t(g,_,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(_=>{g.push(_.serialize())}),g}}}const o1=au("==",function(a,t,r){return t===r},zm),s1=au("!=",function(a,t,r){return t!==r},function(a,t,r,c){return!zm(0,t,r,c)}),fv=au("<",function(a,t,r){return t<r},function(a,t,r,c){return c.compare(t,r)<0}),pv=au(">",function(a,t,r){return t>r},function(a,t,r,c){return c.compare(t,r)>0}),nf=au("<=",function(a,t,r){return t<=r},function(a,t,r,c){return c.compare(t,r)<=0}),a1=au(">=",function(a,t,r){return t>=r},function(a,t,r,c){return c.compare(t,r)>=0});class rf{constructor(t,r,c,d,g,_){this.type=xn,this.number=t,this.locale=r,this.currency=c,this.unit=d,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const c=r.parse(t[1],1,ii);if(!c)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=r.parseObjectValue(d.locale,2,"locale",xn),!g))return null;let _=null;if(d.currency&&(_=r.parseObjectValue(d.currency,2,"currency",xn),!_))return null;let v=null;if(d.unit&&(v=r.parseObjectValue(d.unit,2,"unit",xn),!v))return null;let S=null;if(d["min-fraction-digits"]&&(S=r.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",ii),!S))return null;let T=null;return d["max-fraction-digits"]&&(T=r.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",ii),!T)?null:new rf(c,g,_,v,S,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Cm{constructor(t){this.type=ii,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=r.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ar(c.type)} instead.`):new Cm(c):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Gr(`Expected value to be of type string or array, but found ${Ar(Kr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}function mv(a){return function(){a=1831565813+(a|=0)|0;let t=Math.imul(a^a>>>15,1|a);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const _c={"==":o1,"!=":s1,">":pv,"<":fv,">=":a1,"<=":nf,array:Ii,at:Qd,"at-interpolated":ef,boolean:Ii,case:Th,coalesce:wh,collator:Oa,format:Kt,image:Yc,in:Mm,"index-of":su,interpolate:Ns,"interpolate-hcl":Ns,"interpolate-lab":Ns,length:Cm,let:hl,literal:cl,match:Sh,number:Ii,"number-format":rf,object:Ii,slice:tf,step:xh,string:Ii,"to-boolean":ka,"to-color":ka,"to-number":ka,"to-string":ka,var:Wd,within:Ul,distance:gc,config:nu,split:Am};function Rm(a,[t,r,c,d]){t=t.evaluate(a),r=r.evaluate(a),c=c.evaluate(a);const g=d?d.evaluate(a):1,_=om(t,r,c,g);if(_)throw new Gr(_);return new bn(t/255,r/255,c/255,g)}function gv(a,[t,r,c,d]){t=t.evaluate(a),r=r.evaluate(a),c=c.evaluate(a);const g=d?d.evaluate(a):1,_=(function(T,M,A,z){return typeof T=="number"&&T>=0&&T<=360?typeof M=="number"&&M>=0&&M<=100&&typeof A=="number"&&A>=0&&A<=100?z===void 0||typeof z=="number"&&z>=0&&z<=1?null:`Invalid hsla value [${[T,M,A,z].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof z=="number"?[T,M,A,z]:[T,M,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof z=="number"?[T,M,A,z]:[T,M,A]).join(", ")}]: 'h' must be between 0 and 360.`})(t,r,c,g);if(_)throw new Gr(_);const v=`hsla(${t}, ${r}%, ${c}%, ${g})`,S=bn.parse(v);if(!S)throw new Gr(`Failed to parse HSLA color: ${v}`);return S}function _v(a,t){return a in t}function Lm(a,t){const r=t[a];return r===void 0?null:r}function jl(a){return{type:a}}function yc(a){if(a instanceof nu)return new Set([a.key]);let t=new Set;return a.eachChild(r=>{t=new Set([...t,...yc(r)])}),t}function of(a){if(a instanceof as&&a.name==="is-active-floor")return!0;let t=!1;return a.eachChild(r=>{!t&&of(r)&&(t=!0)}),t}function yv(a){return{result:"success",value:a}}function Gl(a){return{result:"error",value:a}}function Dm(a,t){return!!a&&!!a.parameters&&a.parameters.indexOf(t)>-1}function sf(a){return a["property-type"]==="data-driven"}function km(a){return Dm(a.expression,"measure-light")}function vv(a){return Dm(a.expression,"zoom")}function Om(a){return!!a.expression&&a.expression.interpolated}function af(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function xv(a){return a}function Fm(a,t){const r=t.type==="color",c=a.stops&&typeof a.stops[0][0]=="object",d=c||!(c||a.property!==void 0),g=a.type||(Om(t)?"exponential":"interval");if(r&&((a=Object.assign({},a)).stops&&(a.stops=a.stops.map(T=>[T[0],bn.parse(T[1])])),a.default=bn.parse(a.default?a.default:t.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!dv[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let _,v,S;if(g==="exponential")_=bv;else if(g==="interval")_=l1;else if(g==="categorical"){_=lu,v=Object.create(null);for(const T of a.stops)v[T[0]]=T[1];S=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=c1}if(c){const T={},M=[];for(let D=0;D<a.stops.length;D++){const k=a.stops[D],$=k[0].zoom;T[$]===void 0&&(T[$]={zoom:$,type:a.type,property:a.property,default:a.default,stops:[]},M.push($)),T[$].stops.push([k[0].value,k[1]])}const A=[];for(const D of M)A.push([T[D].zoom,Fm(T[D],t)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Ns.interpolationFactor.bind(void 0,z),zoomStops:A.map(D=>D[0]),evaluate:({zoom:D},k)=>bv({stops:A,base:a.base},t,D).evaluate(D,k)}}if(d){const T=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Ns.interpolationFactor.bind(void 0,T),zoomStops:a.stops.map(M=>M[0]),evaluate:({zoom:M})=>_(a,t,M,v,S)}}return{kind:"source",evaluate(T,M){const A=M&&M.properties?M.properties[a.property]:void 0;return A===void 0?Eh(a.default,t.default):_(a,t,A,v,S)}}}function Eh(a,t,r){return a!==void 0?a:t!==void 0?t:r!==void 0?r:void 0}function lu(a,t,r,c,d){return Eh(typeof r===d?c[r]:void 0,a.default,t.default)}function l1(a,t,r){if(!di(r))return Eh(a.default,t.default);const c=a.stops.length;if(c===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[c-1][0])return a.stops[c-1][1];const d=Xd(a.stops.map(g=>g[0]),r);return a.stops[d][1]}function bv(a,t,r){const c=a.base!==void 0?a.base:1;if(!di(r))return Eh(a.default,t.default);const d=a.stops.length;if(d===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[d-1][0])return a.stops[d-1][1];const g=Xd(a.stops.map(M=>M[0]),r),_=(function(M,A,z,D){const k=D-z,$=M-z;return k===0?0:A===1?$/k:(Math.pow(A,$)-1)/(Math.pow(A,k)-1)})(r,c,a.stops[g][0],a.stops[g+1][0]),v=a.stops[g][1],S=a.stops[g+1][1];let T=dc[t.type]||xv;if(a.colorSpace&&a.colorSpace!=="rgb"){const M=dv[a.colorSpace];T=(A,z)=>M.reverse(M.interpolate(M.forward(A),M.forward(z),_))}return typeof v.evaluate=="function"?{evaluate(...M){const A=v.evaluate.apply(void 0,M),z=S.evaluate.apply(void 0,M);if(A!==void 0&&z!==void 0)return T(A,z,_)}}:T(v,S,_)}function c1(a,t,r){return t.type==="color"?r=bn.parse(r):t.type==="formatted"?r=Do.fromString(r.toString()):t.type==="resolvedImage"?r=ss.build(r.toString()):vi(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Eh(r,a.default,t.default)}as.register(_c,{error:[{kind:"error"},[xn],(a,[t])=>{throw new Gr(t.evaluate(a))}],typeof:[xn,[Tn],(a,[t])=>Ar(Kr(t.evaluate(a)))],"to-rgba":[Lo(ii,4),[$o],(a,[t])=>t.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Lo(ii,4),[$o],(a,[t])=>t.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[$o,[ii,ii,ii],Rm],rgba:[$o,[ii,ii,ii,ii],Rm],hsl:[$o,[ii,ii,ii],gv],hsla:[$o,[ii,ii,ii,ii],gv],has:{type:pn,overloads:[[[xn],(a,[t])=>_v(t.evaluate(a),a.properties())],[[xn,Xc],(a,[t,r])=>_v(t.evaluate(a),r.evaluate(a))]]},get:{type:Tn,overloads:[[[xn],(a,[t])=>Lm(t.evaluate(a),a.properties())],[[xn,Xc],(a,[t,r])=>Lm(t.evaluate(a),r.evaluate(a))]]},"feature-state":[Tn,[xn],(a,[t])=>Lm(t.evaluate(a),a.featureState||{})],properties:[Xc,[],a=>a.properties()],"geometry-type":[xn,[],a=>a.geometryType()],worldview:[xn,[],a=>a.globals.worldview||""],"is-active-floor":[pn,jl(xn),(a,t)=>{if(!(a.globals.activeFloors&&a.globals.activeFloors.size>0))return!1;const r=a.globals.activeFloors;return t.some(c=>{const d=c.evaluate(a);return r.has(d)})}],id:[Tn,[],a=>a.id()],zoom:[ii,[],a=>a.globals.zoom],pitch:[ii,[],a=>a.globals.pitch||0],"distance-from-center":[ii,[],a=>a.distanceFromCenter()],"measure-light":[ii,[xn],(a,[t])=>a.measureLight(t.evaluate(a))],"heatmap-density":[ii,[],a=>a.globals.heatmapDensity||0],"line-progress":[ii,[],a=>a.globals.lineProgress||0],"raster-value":[ii,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[ii,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[ii,[],a=>a.globals.skyRadialProgress||0],accumulated:[Tn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[ii,jl(ii),(a,t)=>{let r=0;for(const c of t)r+=c.evaluate(a);return r}],"*":[ii,jl(ii),(a,t)=>{let r=1;for(const c of t)r*=c.evaluate(a);return r}],"-":{type:ii,overloads:[[[ii,ii],(a,[t,r])=>t.evaluate(a)-r.evaluate(a)],[[ii],(a,[t])=>-t.evaluate(a)]]},"/":[ii,[ii,ii],(a,[t,r])=>t.evaluate(a)/r.evaluate(a)],"%":[ii,[ii,ii],(a,[t,r])=>t.evaluate(a)%r.evaluate(a)],ln2:[ii,[],()=>Math.LN2],pi:[ii,[],()=>Math.PI],e:[ii,[],()=>Math.E],"^":[ii,[ii,ii],(a,[t,r])=>Math.pow(t.evaluate(a),r.evaluate(a))],sqrt:[ii,[ii],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[ii,[ii],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[ii,[ii],(a,[t])=>Math.log(t.evaluate(a))],log2:[ii,[ii],(a,[t])=>Math.log2(t.evaluate(a))],sin:[ii,[ii],(a,[t])=>Math.sin(t.evaluate(a))],cos:[ii,[ii],(a,[t])=>Math.cos(t.evaluate(a))],tan:[ii,[ii],(a,[t])=>Math.tan(t.evaluate(a))],asin:[ii,[ii],(a,[t])=>Math.asin(t.evaluate(a))],acos:[ii,[ii],(a,[t])=>Math.acos(t.evaluate(a))],atan:[ii,[ii],(a,[t])=>Math.atan(t.evaluate(a))],min:[ii,jl(ii),(a,t)=>Math.min(...t.map(r=>r.evaluate(a)))],max:[ii,jl(ii),(a,t)=>Math.max(...t.map(r=>r.evaluate(a)))],abs:[ii,[ii],(a,[t])=>Math.abs(t.evaluate(a))],round:[ii,[ii],(a,[t])=>{const r=t.evaluate(a);return r<0?-Math.round(-r):Math.round(r)}],floor:[ii,[ii],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[ii,[ii],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[pn,[xn,Tn],(a,[t,r])=>a.properties()[t.value]===r.value],"filter-id-==":[pn,[Tn],(a,[t])=>a.id()===t.value],"filter-type-==":[pn,[xn],(a,[t])=>a.geometryType()===t.value],"filter-<":[pn,[xn,Tn],(a,[t,r])=>{const c=a.properties()[t.value],d=r.value;return typeof c==typeof d&&c<d}],"filter-id-<":[pn,[Tn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r<c}],"filter->":[pn,[xn,Tn],(a,[t,r])=>{const c=a.properties()[t.value],d=r.value;return typeof c==typeof d&&c>d}],"filter-id->":[pn,[Tn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r>c}],"filter-<=":[pn,[xn,Tn],(a,[t,r])=>{const c=a.properties()[t.value],d=r.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[pn,[Tn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r<=c}],"filter->=":[pn,[xn,Tn],(a,[t,r])=>{const c=a.properties()[t.value],d=r.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[pn,[Tn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r>=c}],"filter-has":[pn,[Tn],(a,[t])=>t.value in a.properties()],"filter-has-id":[pn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[pn,[Lo(xn)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[pn,[Lo(Tn)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[pn,[xn,Lo(Tn)],(a,[t,r])=>r.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[pn,[xn,Lo(Tn)],(a,[t,r])=>(function(c,d,g,_){for(;g<=_;){const v=g+_>>1;if(d[v]===c)return!0;d[v]>c?_=v-1:g=v+1}return!1})(a.properties()[t.value],r.value,0,r.value.length-1)],all:{type:pn,overloads:[[[pn,pn],(a,[t,r])=>t.evaluate(a)&&r.evaluate(a)],[jl(pn),(a,t)=>{for(const r of t)if(!r.evaluate(a))return!1;return!0}]]},any:{type:pn,overloads:[[[pn,pn],(a,[t,r])=>t.evaluate(a)||r.evaluate(a)],[jl(pn),(a,t)=>{for(const r of t)if(r.evaluate(a))return!0;return!1}]]},"!":[pn,[pn],(a,[t])=>!t.evaluate(a)],"is-supported-script":[pn,[xn],(a,[t])=>{const r=a.globals&&a.globals.isSupportedScript;return!r||r(t.evaluate(a))}],upcase:[xn,[xn],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[xn,[xn],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[xn,jl(Tn),(a,t)=>t.map(r=>Da(r.evaluate(a))).join("")],"resolved-locale":[xn,[kd],(a,[t])=>t.evaluate(a).resolvedLocale()],random:[ii,[ii,ii,Tn],(a,t)=>{const[r,c,d]=t.map(_=>_.evaluate(a));if(r>c||r===c)return r;let g;if(typeof d=="string")g=(function(_){let v=0;if(_.length===0)return v;for(let S=0;S<_.length;S++)v=(v<<5)-v+_.charCodeAt(S),v&=v;return v})(d);else{if(typeof d!="number")throw new Gr(`Invalid seed input: ${d}`);g=d}return r+mv(g)()*(c-r)}]});class lf{constructor(t,r,c,d,g){this.expression=t,this._warningHistory={},this._scope=c,this._options=d,this._iconImageUseTheme=g,this._evaluator=new Kc(c,d,g),this._defaultValue=r?(function(_){return _.type==="color"&&(af(_.default)||Array.isArray(_.default))?new bn(0,0,0,0):_.type==="color"?bn.parse(_.default)||null:_.default===void 0?null:_.default})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=yc(t),this.isIndoorDependent=of(t)}evaluateWithoutErrorHandling(t,r,c,d,g,_,v,S){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=c,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,c,d,g,_,v,S,T){this._evaluator||(this._evaluator=new Kc(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this._evaluator.iconImageUseTheme=T||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Gr(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){const A=M;return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function Ih(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in _c}function Hl(a,t,r,c,d){const g=new qd(_c,[],t?(function(v){const S={color:$o,string:xn,number:ii,enum:xn,boolean:pn,formatted:Jc,resolvedImage:fc};return v.type==="array"?Lo(S[v.value]||Tn,v.length):S[v.type]})(t):void 0,void 0,void 0,r,c,d),_=g.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?yv(new lf(_,t,r,c,d)):Gl(g.errors)}class Mh{constructor(t,r,c,d){this.kind=t,this._styleExpression=r,this.isLightConstant=c,this.isLineProgressConstant=d,this.isStateDependent=t!=="constant"&&!vh(r.expression),this.configDependencies=yc(r.expression),this.isIndoorDependent=of(r.expression)}evaluateWithoutErrorHandling(t,r,c,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,d,g,_)}evaluate(t,r,c,d,g,_,v){return this._styleExpression.evaluate(t,r,c,d,g,_,void 0,void 0,v)}}class vc{constructor(t,r,c,d,g,_){this.kind=t,this.zoomStops=c,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!vh(r.expression),this.isIndoorDependent=of(r.expression),this.isLightConstant=g,this.isLineProgressConstant=_,this.configDependencies=yc(r.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,r,c,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,d,g,_)}evaluate(t,r,c,d,g,_){return this._styleExpression.evaluate(t,r,c,d,g,_)}interpolationFactor(t,r,c){return this.interpolationType?Ns.interpolationFactor(this.interpolationType,t,r,c):0}}function cf(a,t,r,c,d){if((a=Hl(a,t,r,c,d)).result==="error")return a;const g=a.value.expression,_=tu(g);if(!_&&!sf(t))return Gl([new Uo("","data expressions not supported")]);const v=iu(g,["zoom","pitch","distance-from-center"]);if(!v&&!vv(t))return Gl([new Uo("","zoom expressions not supported")]);const S=iu(g,["measure-light"]);if(!S&&!km(t))return Gl([new Uo("","measure-light expression not supported")]);const T=iu(g,["line-progress"]);if(!T&&!(function(z){return Dm(z.expression,"line-progress")})(t))return Gl([new Uo("","line-progress expression not supported")]);const M=t.expression&&t.expression.relaxZoomRestriction,A=uf(g);return A||v||M?A instanceof Uo?Gl([A]):A instanceof Ns&&!Om(t)?Gl([new Uo("",'"interpolate" expressions cannot be used with this property')]):yv(A?new vc(_&&T?"camera":"composite",a.value,A.labels,A instanceof Ns?A.interpolation:void 0,S,T):new Mh(_&&T?"constant":"source",a.value,S,T)):Gl([new Uo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ah{constructor(t,r){this._parameters=t,this._specification=r,Object.assign(this,Fm(this._parameters,this._specification))}static deserialize(t){return new Ah(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function uf(a){let t=null;if(a instanceof hl)t=uf(a.result);else if(a instanceof wh){for(const r of a.args)if(t=uf(r),t)break}else(a instanceof xh||a instanceof Ns)&&a.input instanceof as&&a.input.name==="zoom"&&(t=a);return t instanceof Uo||a.eachChild(r=>{const c=uf(r);c instanceof Uo?t=c:t&&c&&t!==c&&(t=new Uo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Ba,wv,u1=(function(){if(wv)return Ba;wv=1,Ba=t;var a=3;function t(r,c,d){var g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var _=new Int32Array(this.arrayBuffer);r=_[0],this.d=(c=_[1])+2*(d=_[2]);for(var v=0;v<this.d*this.d;v++){var S=_[a+v],T=_[a+v+1];g.push(S===T?null:_.subarray(S,T))}var M=_[a+g.length+1];this.keys=_.subarray(_[a+g.length],M),this.bboxes=_.subarray(M),this.insert=this._insertReadonly}else{this.d=c+2*d;for(var A=0;A<this.d*this.d;A++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=r,this.padding=d,this.scale=c/r,this.uid=0;var z=d/c*r;this.min=-z,this.max=r+z}return t.prototype.insert=function(r,c,d,g,_){this._forEachCell(c,d,g,_,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(_)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(r,c,d,g,_,v){this.cells[_].push(v)},t.prototype.query=function(r,c,d,g,_){var v=this.min,S=this.max;if(r<=v&&c<=v&&S<=d&&S<=g&&!_)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(r,c,d,g,this._queryCell,T,{},_),T},t.prototype._queryCell=function(r,c,d,g,_,v,S,T){var M=this.cells[_];if(M!==null)for(var A=this.keys,z=this.bboxes,D=0;D<M.length;D++){var k=M[D];if(S[k]===void 0){var $=4*k;(T?T(z[$+0],z[$+1],z[$+2],z[$+3]):r<=z[$+2]&&c<=z[$+3]&&d>=z[$+0]&&g>=z[$+1])?(S[k]=!0,v.push(A[k])):S[k]=!1}}},t.prototype._forEachCell=function(r,c,d,g,_,v,S,T){for(var M=this._convertToCellCoord(r),A=this._convertToCellCoord(c),z=this._convertToCellCoord(d),D=this._convertToCellCoord(g),k=M;k<=z;k++)for(var $=A;$<=D;$++){var H=this.d*$+k;if((!T||T(this._convertFromCellCoord(k),this._convertFromCellCoord($),this._convertFromCellCoord(k+1),this._convertFromCellCoord($+1)))&&_.call(this,r,c,d,g,H,v,S,T))return}},t.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},t.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,c=a+this.cells.length+1+1,d=0,g=0;g<this.cells.length;g++)d+=this.cells[g].length;var _=new Int32Array(c+d+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var v=c,S=0;S<r.length;S++){var T=r[S];_[a+S]=v,_.set(T,v),v+=T.length}return _[a+r.length]=v,_.set(this.keys,v),_[a+r.length+1]=v+=this.keys.length,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer},Ba})(),xc=ts(u1);const hf={};function Vt(a,t,r={}){Object.defineProperty(a,"_classRegistryKey",{value:t,writable:!1}),hf[t]={klass:a,omit:r.omit||[]}}Vt(Object,"Object"),xc.serialize=function(a,t){const r=a.toArrayBuffer();return t&&t.add(r),{buffer:r}},xc.deserialize=function(a){return new xc(a.buffer)},Object.defineProperty(xc,"name",{value:"Grid"}),Vt(xc,"Grid"),delete Ae.prototype.constructor,Vt(bn,"Color"),Vt(Error,"Error"),Vt(Do,"Formatted"),Vt(Fd,"FormattedSection"),Vt(oh,"AJAXError"),Vt(ss,"ResolvedImage"),Vt(Ah,"StylePropertyFunction"),Vt(lf,"StyleExpression",{omit:["_evaluator"]}),Vt(ns,"ImageId"),Vt(os,"ImageVariant"),Vt(vc,"ZoomDependentExpression"),Vt(Mh,"ZoomConstantExpression"),Vt(as,"CompoundExpression",{omit:["_evaluate"]});for(const a in _c)hf[_c[a]._classRegistryKey]||Vt(_c[a],`Expression${a}`);function Bm(a){return a&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function ma(a,t){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Bm(a)||a instanceof ImageBitmap)return t&&t.add(a),a;if(ArrayBuffer.isView(a))return t&&t.add(a.buffer),a;if(a instanceof ImageData)return t&&t.add(a.data.buffer),a;if(Array.isArray(a)){const r=[];for(const c of a)r.push(ma(c,t));return r}if(a instanceof Map){const r={$name:"Map",entries:[]};for(const[c,d]of a.entries())r.entries.push(ma(c),ma(d,t));return r}if(a instanceof Set){const r={$name:"Set"};let c=0;for(const d of a.values())r[++c]=ma(d);return r}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const r=a.constructor,c=r._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const d=r.serialize?r.serialize(a,t):{};if(!r.serialize){for(const g in a)a.hasOwnProperty(g)&&(hf[c].omit.indexOf(g)>=0||(d[g]=ma(a[g],t)));a instanceof Error&&(d.message=a.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof a)}function dl(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Bm(a)||a instanceof ImageBitmap||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(dl);if(typeof a=="object"){const t=a.$name||"Object";if(t==="Map"){const d=a.entries||[],g=new Map;for(let _=0;_<d.length;_+=2)g.set(dl(d[_]),dl(d[_+1]));return g}if(t==="Set"){const d=new Set;for(const g of Object.keys(a))g!=="$name"&&d.add(dl(a[g]));return d}if(t==="BigInt")return BigInt(a.value);const{klass:r}=hf[t];if(!r)throw new Error(`Can't deserialize unregistered class "${t}".`);if(r.deserialize)return r.deserialize(a);const c=Object.create(r.prototype);for(const d of Object.keys(a))d!=="$name"&&(c[d]=dl(a[d]));return c}throw new Error("can't deserialize object of type "+typeof a)}const Sv=a=>a>=1536&&a<=1791,Tv=a=>a>=1872&&a<=1919,df=a=>a>=2208&&a<=2303,ff=a=>a>=11904&&a<=12031,Nm=a=>a>=12032&&a<=12255,Um=a=>a>=12272&&a<=12287,cu=a=>a>=12288&&a<=12351,uu=a=>a>=12352&&a<=12447,Ph=a=>a>=12448&&a<=12543,Na=a=>a>=12544&&a<=12591,Ev=a=>a>=12704&&a<=12735,Iv=a=>a>=12736&&a<=12783,Mv=a=>a>=12784&&a<=12799,Av=a=>a>=12800&&a<=13055,$m=a=>a>=13056&&a<=13311,hu=a=>a>=13312&&a<=19903,pf=a=>a>=19968&&a<=40959,Vm=a=>a>=40960&&a<=42127,mf=a=>a>=42128&&a<=42191,Pv=a=>a>=44032&&a<=55215,zv=a=>a>=63744&&a<=64255,jm=a=>a>=64336&&a<=65023,Cv=a=>a>=65040&&a<=65055,Gm=a=>a>=65072&&a<=65103,Rv=a=>a>=65104&&a<=65135,Hm=a=>a>=65136&&a<=65279,Zm=a=>a>=65280&&a<=65519;function Wm(a){for(const t of a)if(Zl(t.charCodeAt(0)))return!0;return!1}function h1(a){for(const t of a)if(!d1(t.charCodeAt(0)))return!1;return!0}function d1(a){return!(Sv(a)||Tv(a)||df(a)||jm(a)||Hm(a))}function Lv(a){return!(a<11904||!(Ev(a)||Na(a)||Gm(a)||zv(a)||$m(a)||ff(a)||Iv(a)||cu(a)||hu(a)||pf(a)||Av(a)||Zm(a)||uu(a)||Um(a)||Nm(a)||Mv(a)||Ph(a)||Cv(a)||mf(a)||Vm(a)))}function Zl(a){return!(a!==746&&a!==747&&(a<4352||!(Ev(a)||Na(a)||Gm(a)&&!(a>=65097&&a<=65103)||zv(a)||$m(a)||ff(a)||Iv(a)||!(!cu(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||hu(a)||pf(a)||Av(a)||(t=>t>=12592&&t<=12687)(a)||(t=>t>=43360&&t<=43391)(a)||(t=>t>=55216&&t<=55295)(a)||(t=>t>=4352&&t<=4607)(a)||Pv(a)||uu(a)||Um(a)||(t=>t>=12688&&t<=12703)(a)||Nm(a)||Mv(a)||Ph(a)&&a!==12540||!(!Zm(a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Rv(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(t=>t>=5120&&t<=5759)(a)||(t=>t>=6320&&t<=6399)(a)||Cv(a)||(t=>t>=19904&&t<=19967)(a)||Vm(a)||mf(a))))}function Dv(a){return a===12312||a===12313||a===12316||a===12540||a===12448}function qm(a){return!(Zl(a)||(function(t){return!!((r=>r>=128&&r<=255)(t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||(r=>r>=8192&&r<=8303)(t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||(r=>r>=8448&&r<=8527)(t)||(r=>r>=8528&&r<=8591)(t)||(r=>r>=8960&&r<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||(r=>r>=9216&&r<=9279)(t)&&t!==9251||(r=>r>=9280&&r<=9311)(t)||(r=>r>=9312&&r<=9471)(t)||(r=>r>=9632&&r<=9727)(t)||(r=>r>=9728&&r<=9983)(t)&&!(t>=9754&&t<=9759)||(r=>r>=11008&&r<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||cu(t)||Ph(t)||(r=>r>=57344&&r<=63743)(t)||Gm(t)||Rv(t)||Zm(t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(a))}function gf(a){return Sv(a)||Tv(a)||df(a)||jm(a)||Hm(a)}function kv(a){return a>=1424&&a<=2303||jm(a)||Hm(a)}function f1(a,t){return!(!t&&kv(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(r=>r>=6016&&r<=6143)(a))}function Wl(a){for(const t of a)if(kv(t.charCodeAt(0)))return!0;return!1}const ls={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let ql=null,Vo=ls.unavailable,Xl=null;const Ov=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Vo=ls.error),ql&&ql(a)};function Xm(){Jm.fire(new al("pluginStateChange",{pluginStatus:Vo,pluginURL:Xl}))}const Jm=new ll,Ym=function(){return Vo},Km=function(){if(Vo!==ls.deferred||!Xl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Vo=ls.loading,Xm(),Xl&&ah({url:Xl},a=>{a?Ov(a):(Vo=ls.loaded,Xm())})},ga={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Vo===ls.loaded||ga.applyArabicShaping!=null,isLoading:()=>Vo===ls.loading,setState(a){Vo=a.pluginStatus,Xl=a.pluginURL},isParsing:()=>Vo===ls.parsing,isParsed:()=>Vo===ls.parsed,getPluginURL:()=>Xl};class An{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness,this.worldview=r.worldview,this.activeFloors=r.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return(function(r,c){for(const d of r)if(!f1(d.charCodeAt(0),c))return!1;return!0})(t,ga.isLoaded())}}class zh{constructor(t,r,c,d,g){this.property=t,this.value=r,this.expression=(function(_,v,S,T,M){if(af(_))return new Ah(_,v);if(Ih(_)||Array.isArray(_)&&_.length>0){const A=cf(_,v,S,T,M);if(A.result==="error")throw new Error(A.value.map(z=>`${z.key}: ${z.message}`).join(", "));return A.value}{let A=_;return typeof _=="string"&&v.type==="color"&&(A=bn.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>A}}})(r===void 0?t.specification.default:r,t.specification,c,d,g)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,c,d){return this.property.possiblyEvaluate(this,t,r,c,d)}}class Ch{constructor(t,r,c,d){this.property=t,this.value=new zh(t,void 0,r,c,d)}transitioned(t,r){return new Fv(this.property,this.value,r,Object.assign({},t.transition,this.transition),t.now)}untransitioned(){return new Fv(this.property,this.value,null,{},0)}}class du{constructor(t,r,c,d){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=r,this._options=c,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return ki(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Ch(this._values[t].property,this._scope,this._options,this._iconImageUseTheme)),this._values[t].value=new zh(this._values[t].property,r===null?void 0:ki(r),this._scope,this._options,this._iconImageUseTheme),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].value.isIndoorDependent())}setTransitionOrValue(t,r){r&&(this._options=r);const c=this._properties.properties;if(t)for(const d in t){const g=t[d];if(d.endsWith("-transition")){const _=d.slice(0,-11);c[_]&&this.setTransition(_,g)}else c.hasOwnProperty(d)&&this.setValue(d,g)}}getTransition(t){return ki(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Ch(this._values[t].property)),this._values[t].transition=ki(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c);const d=this.getTransition(r);d!==void 0&&(t[`${r}-transition`]=d)}return t}transitioned(t,r){const c=new Bv(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(t,r._values[d]);return c}untransitioned(){const t=new Bv(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}isIndoorDependent(){return this._isIndoorDependent}}class Fv{constructor(t,r,c,d,g){const _=d.delay||0,v=d.duration||0;g=g||0,this.property=t,this.value=r,this.begin=g+_,this.end=this.begin+v,t.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(t,r,c){const d=t.now||0,g=this.value.possiblyEvaluate(t,r,c),_=this.prior;if(_){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return _.possiblyEvaluate(t,r,c);{const v=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,c),g,Q(v))}}return g}}class Bv{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,c){const d=new jo(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(t,r,c);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Qm{constructor(t,r,c,d){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=r,this._options=c,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return ki(this._values[t].value)}setValue(t,r){this._values[t]=new zh(this._values[t].property,r===null?void 0:ki(r),this._scope,this._options,this._iconImageUseTheme),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].isIndoorDependent())}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c)}return t}possiblyEvaluate(t,r,c,d){const g=new jo(this._properties);for(const _ of Object.keys(this._values))g._values[_]=this._values[_].possiblyEvaluate(t,r,c,d);return g}isIndoorDependent(){return this._isIndoorDependent}}class bc{constructor(t,r,c,d){this.property=t,this.value=r,this.parameters=c,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,c,d){return this.property.evaluate(this.value,this.parameters,t,r,c,d,this.iconImageUseTheme)}}class jo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class bt{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,c){const d=dc[this.specification.type];return d?d(t,r,c):t}}class Pt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,c,d,g){return t.expression.kind==="constant"||t.expression.kind==="camera"?new bc(this,{kind:"constant",value:t.expression.evaluate(r,null,{},c,d,void 0,g)},r):new bc(this,t.expression,r,g)}interpolate(t,r,c){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new bc(this,{kind:"constant",value:void 0},t.parameters);const d=dc[this.specification.type];return d?new bc(this,{kind:"constant",value:d(t.value.value,r.value.value,c)},t.parameters):t}evaluate(t,r,c,d,g,_,v){return t.kind==="constant"?t.value:t.evaluate(r,c,d,g,_,void 0,v)}}class fu{constructor(t){this.specification=t}possiblyEvaluate(t,r,c,d){return!!t.expression.evaluate(r,null,{},c,d)}interpolate(){return!1}}class ur{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new An(0,{});for(const c in t){const d=t[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new zh(d,void 0),_=this.defaultTransitionablePropertyValues[c]=new Ch(d);this.defaultTransitioningPropertyValues[c]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(r)}}}Vt(Pt,"DataDrivenProperty"),Vt(bt,"DataConstantProperty"),Vt(fu,"ColorRampProperty");var ke=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Nv(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function _f(a){if(Array.isArray(a))return a.map(_f);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const r in a)t[r]=_f(a[r]);return t}return Nv(a)}function eg(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!eg(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function tg(a,t="",r=null,c="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};eg(a)||(a=Rh(a));const d=a;let g=!0;try{g=(function(M){if(!pu(M))return M;let A=_f(M);return ig(A),A=Uv(A),A})(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let _=null,v=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){v=ke[`filter_${c}`];const M=Hl(g,v,t,r);if(M.result==="error")throw new Error(M.value.map(A=>`${A.key}: ${A.message}`).join(", "));_=(A,z,D)=>M.value.evaluate(A,z,{},D)}let S=null,T=null;if(g!==d){const M=Hl(d,v,t,r);if(M.result==="error")throw new Error(M.value.map(A=>`${A.key}: ${A.message}`).join(", "));S=(A,z,D,k,$)=>M.value.evaluate(A,z,{},D,void 0,void 0,k,$),T=!tu(M.value.expression)}return{filter:_,dynamicFilter:S||void 0,needGeometry:ng(g),needFeature:!!T}}function Uv(a){if(!Array.isArray(a))return a;const t=(function(r){if(p1.has(r[0])){for(let c=1;c<r.length;c++)if(pu(r[c]))return!0}return r})(a);return t===!0?t:t.map(r=>Uv(r))}function ig(a){let t=!1;const r=[];if(a[0]==="case"){for(let c=1;c<a.length-1;c+=2)t=t||pu(a[c]),r.push(a[c+1]);r.push(a[a.length-1])}else if(a[0]==="match"){t=t||pu(a[1]);for(let c=2;c<a.length-1;c+=2)r.push(a[c+1]);r.push(a[a.length-1])}else if(a[0]==="step"){t=t||pu(a[1]);for(let c=1;c<a.length-1;c+=2)r.push(a[c+1])}t&&(a.length=0,a.push("any",...r));for(let c=1;c<a.length;c++)ig(a[c])}function pu(a){if(!Array.isArray(a))return!1;if((t=a[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let r=1;r<a.length;r++)if(pu(a[r]))return!0;return!1}const p1=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function m1(a,t){return a<t?-1:a>t?1:0}function ng(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(ng(a[t]))return!0;return!1}function Rh(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?Ua(a[1],a[2],"=="):t==="!="?yf(Ua(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ua(a[1],a[2],t):t==="any"?(r=a.slice(1),["any"].concat(r.map(Rh))):t==="all"?["all"].concat(a.slice(1).map(Rh)):t==="none"?["all"].concat(a.slice(1).map(Rh).map(yf)):t==="in"?rg(a[1],a.slice(2)):t==="!in"?yf(rg(a[1],a.slice(2))):t==="has"?$v(a[1]):t!=="!has"||yf($v(a[1]));var r}function Ua(a,t,r){switch(a){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,a,t]}}function rg(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",a,["literal",t.sort(m1)]]:["filter-in-small",a,["literal",t]]}}function $v(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function yf(a){return["!",a]}const Lh="";function wc(a,t){return t?`${a}${Lh}${t}`:a}let og;const sg=()=>og||(og=new ur({"icon-size":new Pt(ke.layout_symbol["icon-size"]),"icon-image":new Pt(ke.layout_symbol["icon-image"]),"icon-rotate":new Pt(ke.layout_symbol["icon-rotate"]),"icon-offset":new Pt(ke.layout_symbol["icon-offset"]),"text-size":new Pt(ke.layout_symbol["text-size"]),"text-rotate":new Pt(ke.layout_symbol["text-rotate"]),"text-offset":new Pt(ke.layout_symbol["text-offset"])}));class Vv{constructor(t,r,c,d,g,_){const v=Hl(t,ke.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=r,c){this.properties=new jo(sg()),this.unevaluatedLayout=new Qm(sg(),d,g,_);for(const S in c)this.unevaluatedLayout.setValue(S,c[S])}}isActive(t){return!(this.condition||!t.isHidden||this.name!=="hidden")||this.condition.evaluate(t.globals,t.feature,t.featureState,t.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(t){return this.properties.get(t)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(t){return this.unevaluatedLayout._values[t]}recalculate(t,r,c){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(t,void 0,r,c))}serialize(){const t={};return t.condition=this.condition.expression.serialize(),this.name&&(t.name=this.name),this.unevaluatedLayout&&(t.properties=this.unevaluatedLayout.serialize()),t}hasIconProperties(){const t=this.hasProperty("icon-image"),r=this.hasProperty("icon-size"),c=this.hasProperty("icon-offset"),d=this.hasProperty("icon-rotate");return t||r||c||d}hasTextProperties(){const t=this.hasProperty("text-size"),r=this.hasProperty("text-offset"),c=this.hasProperty("text-rotate");return t||r||c}hasProperty(t){return this.getUnevaluatedProperty(t).value!==void 0}}const jv="-transition",Gv=new Set(["fill","line","background","hillshade","raster"]);class Go extends ll{constructor(t,r,c,d,g,_){if(super(),this.id=t.id,this.fqid=wc(this.id,c),this.type=t.type,this.scope=c,this.lut=d,this.options=g,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const v=Hl(this.filter,ke[`filter_${t.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(t.slot&&(this.slot=t.slot),t.appearances&&this.setAppearances(t.appearances),r.layout&&(this._unevaluatedLayout=new Qm(r.layout,this.scope,g,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),r.paint){this._transitionablePaint=new du(r.paint,this.scope,g);for(const v in t.paint)this.setPaintProperty(v,t.paint[v]);for(const v in t.layout)this.setLayoutProperty(v,t.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jo(r.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D(!0)&&Gv.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r){if(this.type==="custom"&&t==="visibility")return void(this.visibility=r);const c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,r),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...c.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||c.isIndoorDependent(),t==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(t){this.appearances=[],t.forEach(r=>{this.appearances.push(new Vv(r.condition,r.name,r.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return t.endsWith(jv)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}isPaintProperty(t){return!!this._transitionablePaint._properties.properties[t]}setPaintProperty(t,r){const c=this._transitionablePaint,d=c._properties.properties;if(t.endsWith(jv)){const A=t.slice(0,-11);return d[A]&&c.setTransition(A,r||void 0),!1}if(!d[t])return!1;const g=c._values[t],_=g.value.isDataDriven(),v=g.value;c.setValue(t,r),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...c.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||c.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(t);const S=c._values[t].value,T=S.isDataDriven(),M=t.endsWith("pattern")||t==="line-dasharray";return T||_||M||this._handleOverridablePaintPropertyUpdate(t,v,S)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,r,c){return null}_handleOverridablePaintPropertyUpdate(t,r,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(t.appearances=this.appearances.map(r=>r.serialize())),li(t,(r,c)=>!(r===void 0||c==="layout"&&!Object.keys(r).length||c==="paint"&&!Object.keys(r).length))}is3D(t){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof bc&&sf(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}for(const t of this.appearances)if(!vh(t.condition.expression))return!0;return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=tg(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(t,r,c){return{}}queryRadius(t){}queryIntersectsFeature(t,r,c,d,g,_,v,S,T,M){}}const Hv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Jl{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const g1=new ArrayBuffer(0);class Wn{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(t,r){return t._trim(),r&&t.arrayBuffer&&r.add(t.arrayBuffer),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,t.arrayBuffer?r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement:(r.capacity=0,r.arrayBuffer=g1),r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this._reallocCount++,this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}reserveForAdditional(t){this.reserve(this.length+t)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yi(a,t=1){let r=0,c=0;return{members:a.map(d=>{const g=Hv[d.type].BYTES_PER_ELEMENT,_=r=Zv(r,Math.max(t,g)),v=d.components||1;return c=Math.max(c,g),r+=g*v,{name:d.name,type:d.type,components:v,offset:_}}),size:Zv(r,Math.max(c,t)),alignment:t}}function Zv(a,t){return Math.ceil(a/t)*t}class Yl extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const d=2*t;return this.int16[d+0]=r,this.int16[d+1]=c,t}}Yl.prototype.bytesPerElement=4,Vt(Yl,"StructArrayLayout2i4");class fl extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=3*t;return this.int16[g+0]=r,this.int16[g+1]=c,this.int16[g+2]=d,t}}fl.prototype.bytesPerElement=6,Vt(fl,"StructArrayLayout3i6");class pl extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,c,d)}emplace(t,r,c,d,g){const _=4*t;return this.int16[_+0]=r,this.int16[_+1]=c,this.int16[_+2]=d,this.int16[_+3]=g,t}}pl.prototype.bytesPerElement=8,Vt(pl,"StructArrayLayout4i8");class yo extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}yo.prototype.bytesPerElement=4,Vt(yo,"StructArrayLayout1f4");class mu extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=4*t,_=2*t;return this.int16[g+0]=r,this.int16[g+1]=c,this.float32[_+1]=d,t}}mu.prototype.bytesPerElement=8,Vt(mu,"StructArrayLayout2i1f8");class ag extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=4*t;return this.int16[g+0]=r,this.int16[g+1]=c,this.int16[g+2]=d,t}}ag.prototype.bytesPerElement=8,Vt(ag,"StructArrayLayout3i8");class lg extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,d,g)}emplace(t,r,c,d,g,_){const v=5*t;return this.int16[v+0]=r,this.int16[v+1]=c,this.int16[v+2]=d,this.int16[v+3]=g,this.int16[v+4]=_,t}}lg.prototype.bytesPerElement=10,Vt(lg,"StructArrayLayout5i10");class cg extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,c,d,g,_,v)}emplace(t,r,c,d,g,_,v,S){const T=6*t,M=12*t,A=3*t;return this.int16[T+0]=r,this.int16[T+1]=c,this.uint8[M+4]=d,this.uint8[M+5]=g,this.uint8[M+6]=_,this.uint8[M+7]=v,this.float32[A+2]=S,t}}cg.prototype.bytesPerElement=12,Vt(cg,"StructArrayLayout2i4ub1f12");class oa extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=3*t;return this.float32[g+0]=r,this.float32[g+1]=c,this.float32[g+2]=d,t}}oa.prototype.bytesPerElement=12,Vt(oa,"StructArrayLayout3f12");class $a extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,d,g)}emplace(t,r,c,d,g,_){const v=6*t,S=3*t;return this.uint16[v+0]=r,this.uint16[v+1]=c,this.uint16[v+2]=d,this.uint16[v+3]=g,this.float32[S+2]=_,t}}$a.prototype.bytesPerElement=12,Vt($a,"StructArrayLayout4ui1f12");class gu extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,c,d)}emplace(t,r,c,d,g){const _=4*t;return this.uint16[_+0]=r,this.uint16[_+1]=c,this.uint16[_+2]=d,this.uint16[_+3]=g,t}}gu.prototype.bytesPerElement=8,Vt(gu,"StructArrayLayout4ui8");class _u extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,d,g,_)}emplace(t,r,c,d,g,_,v){const S=6*t;return this.int16[S+0]=r,this.int16[S+1]=c,this.int16[S+2]=d,this.int16[S+3]=g,this.int16[S+4]=_,this.int16[S+5]=v,t}}_u.prototype.bytesPerElement=12,Vt(_u,"StructArrayLayout6i12");class ug extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z){const D=this.length;return this.resize(D+1),this.emplace(D,t,r,c,d,g,_,v,S,T,M,A,z)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D){const k=12*t;return this.int16[k+0]=r,this.int16[k+1]=c,this.int16[k+2]=d,this.int16[k+3]=g,this.uint16[k+4]=_,this.uint16[k+5]=v,this.uint16[k+6]=S,this.uint16[k+7]=T,this.int16[k+8]=M,this.int16[k+9]=A,this.int16[k+10]=z,this.int16[k+11]=D,t}}ug.prototype.bytesPerElement=24,Vt(ug,"StructArrayLayout4i4ui4i24");class hg extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,d,g,_)}emplace(t,r,c,d,g,_,v){const S=10*t,T=5*t;return this.int16[S+0]=r,this.int16[S+1]=c,this.int16[S+2]=d,this.float32[T+2]=g,this.float32[T+3]=_,this.float32[T+4]=v,t}}hg.prototype.bytesPerElement=20,Vt(hg,"StructArrayLayout3i3f20");class Kl extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,c,d)}emplace(t,r,c,d,g){const _=4*t;return this.float32[_+0]=r,this.float32[_+1]=c,this.float32[_+2]=d,this.float32[_+3]=g,t}}Kl.prototype.bytesPerElement=16,Vt(Kl,"StructArrayLayout4f16");class dg extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}dg.prototype.bytesPerElement=4,Vt(dg,"StructArrayLayout1ul4");class Us extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const d=2*t;return this.uint16[d+0]=r,this.uint16[d+1]=c,t}}Us.prototype.bytesPerElement=4,Vt(Us,"StructArrayLayout2ui4");class Dh extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z,D){const k=this.length;return this.resize(k+1),this.emplace(k,t,r,c,d,g,_,v,S,T,M,A,z,D)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D,k){const $=20*t,H=10*t;return this.int16[$+0]=r,this.int16[$+1]=c,this.int16[$+2]=d,this.int16[$+3]=g,this.int16[$+4]=_,this.float32[H+3]=v,this.float32[H+4]=S,this.float32[H+5]=T,this.float32[H+6]=M,this.int16[$+14]=A,this.uint32[H+8]=z,this.uint16[$+18]=D,this.uint16[$+19]=k,t}}Dh.prototype.bytesPerElement=40,Vt(Dh,"StructArrayLayout5i4f1i1ul2ui40");class vf extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,c,d,g,_,v)}emplace(t,r,c,d,g,_,v,S){const T=8*t;return this.int16[T+0]=r,this.int16[T+1]=c,this.int16[T+2]=d,this.int16[T+4]=g,this.int16[T+5]=_,this.int16[T+6]=v,this.int16[T+7]=S,t}}vf.prototype.bytesPerElement=16,Vt(vf,"StructArrayLayout3i2i2i16");class xf extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,d,g)}emplace(t,r,c,d,g,_){const v=4*t,S=8*t;return this.float32[v+0]=r,this.float32[v+1]=c,this.float32[v+2]=d,this.int16[S+6]=g,this.int16[S+7]=_,t}}xf.prototype.bytesPerElement=16,Vt(xf,"StructArrayLayout2f1f2i16");class bf extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,d,g,_)}emplace(t,r,c,d,g,_,v){const S=20*t,T=5*t;return this.uint8[S+0]=r,this.uint8[S+1]=c,this.float32[T+1]=d,this.float32[T+2]=g,this.float32[T+3]=_,this.float32[T+4]=v,t}}bf.prototype.bytesPerElement=20,Vt(bf,"StructArrayLayout2ub4f20");class Hr extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,c)}emplace(t,r,c,d){const g=3*t;return this.uint16[g+0]=r,this.uint16[g+1]=c,this.uint16[g+2]=d,t}}Hr.prototype.bytesPerElement=6,Vt(Hr,"StructArrayLayout3ui6");class kh extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q,Y,te,ue){const ae=this.length;return this.resize(ae+1),this.emplace(ae,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q,Y,te,ue)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q,Y,te,ue,ae){const ge=30*t,ye=15*t,me=60*t;return this.int16[ge+0]=r,this.int16[ge+1]=c,this.int16[ge+2]=d,this.float32[ye+2]=g,this.float32[ye+3]=_,this.uint16[ge+8]=v,this.uint16[ge+9]=S,this.uint32[ye+5]=T,this.uint32[ye+6]=M,this.uint32[ye+7]=A,this.uint16[ge+16]=z,this.uint16[ge+17]=D,this.uint16[ge+18]=k,this.float32[ye+10]=$,this.float32[ye+11]=H,this.uint8[me+48]=j,this.uint8[me+49]=q,this.uint8[me+50]=Y,this.uint32[ye+13]=te,this.int16[ge+28]=ue,this.uint8[me+58]=ae,t}}kh.prototype.bytesPerElement=60,Vt(kh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class yu extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q,Y,te,ue,ae,ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q,Y,te,ue,ae,ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q,Y,te,ue,ae,ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot,Ge){const ct=20*t,et=40*t,ut=80*t;return this.float32[ct+0]=r,this.float32[ct+1]=c,this.int16[et+4]=d,this.int16[et+5]=g,this.int16[et+6]=_,this.int16[et+7]=v,this.int16[et+8]=S,this.int16[et+9]=T,this.int16[et+10]=M,this.int16[et+11]=A,this.int16[et+12]=z,this.uint16[et+13]=D,this.uint16[et+14]=k,this.uint16[et+15]=$,this.uint16[et+16]=H,this.uint16[et+17]=j,this.uint16[et+18]=q,this.uint16[et+19]=Y,this.uint16[et+20]=te,this.uint16[et+21]=ue,this.uint16[et+22]=ae,this.uint16[et+23]=ge,this.uint16[et+24]=ye,this.uint16[et+25]=me,this.uint16[et+26]=we,this.uint16[et+27]=Ie,this.uint32[ct+14]=Je,this.float32[ct+15]=qe,this.float32[ct+16]=Xe,this.float32[ct+17]=at,this.float32[ct+18]=nt,this.uint8[ut+76]=ot,this.uint16[et+39]=Ge,t}}yu.prototype.bytesPerElement=80,Vt(yu,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class wf extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,d,g,_)}emplace(t,r,c,d,g,_,v){const S=6*t;return this.float32[S+0]=r,this.float32[S+1]=c,this.float32[S+2]=d,this.float32[S+3]=g,this.float32[S+4]=_,this.float32[S+5]=v,t}}wf.prototype.bytesPerElement=24,Vt(wf,"StructArrayLayout6f24");class Sc extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,d,g)}emplace(t,r,c,d,g,_){const v=5*t;return this.float32[v+0]=r,this.float32[v+1]=c,this.float32[v+2]=d,this.float32[v+3]=g,this.float32[v+4]=_,t}}Sc.prototype.bytesPerElement=20,Vt(Sc,"StructArrayLayout5f20");class Sf extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,c,d,g,_,v)}emplace(t,r,c,d,g,_,v,S){const T=7*t;return this.float32[T+0]=r,this.float32[T+1]=c,this.float32[T+2]=d,this.float32[T+3]=g,this.float32[T+4]=_,this.float32[T+5]=v,this.float32[T+6]=S,t}}Sf.prototype.bytesPerElement=28,Vt(Sf,"StructArrayLayout7f28");class fg extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A){const z=this.length;return this.resize(z+1),this.emplace(z,t,r,c,d,g,_,v,S,T,M,A)}emplace(t,r,c,d,g,_,v,S,T,M,A,z){const D=11*t;return this.float32[D+0]=r,this.float32[D+1]=c,this.float32[D+2]=d,this.float32[D+3]=g,this.float32[D+4]=_,this.float32[D+5]=v,this.float32[D+6]=S,this.float32[D+7]=T,this.float32[D+8]=M,this.float32[D+9]=A,this.float32[D+10]=z,t}}fg.prototype.bytesPerElement=44,Vt(fg,"StructArrayLayout11f44");class Oh extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,c,d,g,_,v,S,T)}emplace(t,r,c,d,g,_,v,S,T,M){const A=9*t;return this.float32[A+0]=r,this.float32[A+1]=c,this.float32[A+2]=d,this.float32[A+3]=g,this.float32[A+4]=_,this.float32[A+5]=v,this.float32[A+6]=S,this.float32[A+7]=T,this.float32[A+8]=M,t}}Oh.prototype.bytesPerElement=36,Vt(Oh,"StructArrayLayout9f36");class Tc extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const d=2*t;return this.float32[d+0]=r,this.float32[d+1]=c,t}}Tc.prototype.bytesPerElement=8,Vt(Tc,"StructArrayLayout2f8");class pg extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,c,d)}emplace(t,r,c,d,g){const _=6*t;return this.uint32[3*t+0]=r,this.uint16[_+2]=c,this.uint16[_+3]=d,this.uint16[_+4]=g,t}}pg.prototype.bytesPerElement=12,Vt(pg,"StructArrayLayout1ul3ui12");class Fh extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Fh.prototype.bytesPerElement=2,Vt(Fh,"StructArrayLayout1ui2");class mg extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H){const j=this.length;return this.resize(j+1),this.emplace(j,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H)}emplace(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j){const q=16*t;return this.float32[q+0]=r,this.float32[q+1]=c,this.float32[q+2]=d,this.float32[q+3]=g,this.float32[q+4]=_,this.float32[q+5]=v,this.float32[q+6]=S,this.float32[q+7]=T,this.float32[q+8]=M,this.float32[q+9]=A,this.float32[q+10]=z,this.float32[q+11]=D,this.float32[q+12]=k,this.float32[q+13]=$,this.float32[q+14]=H,this.float32[q+15]=j,t}}mg.prototype.bytesPerElement=64,Vt(mg,"StructArrayLayout16f64");class Bh extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,d,g,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,c,d,g,_,v)}emplace(t,r,c,d,g,_,v,S){const T=10*t,M=5*t;return this.uint16[T+0]=r,this.uint16[T+1]=c,this.uint16[T+2]=d,this.uint16[T+3]=g,this.float32[M+2]=_,this.float32[M+3]=v,this.float32[M+4]=S,t}}Bh.prototype.bytesPerElement=20,Vt(Bh,"StructArrayLayout4ui3f20");class gg extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.int16[1*t+0]=r,t}}gg.prototype.bytesPerElement=2,Vt(gg,"StructArrayLayout1i2");class Tf extends Wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint8[1*t+0]=r,t}}Tf.prototype.bytesPerElement=1,Vt(Tf,"StructArrayLayout1ub1");class Wv extends Jl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Wv.prototype.size=40;class qv extends Dh{get(t){return new Wv(this,t)}}Vt(qv,"CollisionBoxArray");class Xv extends Jl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Xv.prototype.size=60;class Jv extends kh{get(t){return new Xv(this,t)}}Vt(Jv,"PlacedSymbolArray");class Yv extends Jl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Yv.prototype.size=80;class Kv extends yu{get(t){return new Yv(this,t)}}Vt(Kv,"SymbolInstanceArray");class Nh extends yo{getoffsetX(t){return this.float32[1*t+0]}}Vt(Nh,"GlyphOffsetArray");class Qv extends Yl{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Vt(Qv,"SymbolLineVertexArray");class ex extends Jl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ex.prototype.size=12;class Uh extends pg{get(t){return new ex(this,t)}}Vt(Uh,"FeatureIndexArray");class tx extends Us{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Vt(tx,"FillExtrusionCentroidArray");class _g extends Jl{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}_g.prototype.size=6;class ix extends fl{get(t){return new _g(this,t)}}Vt(ix,"FillExtrusionWallArray");const nx=Yi([{name:"a_pos",components:2,type:"Int16"}],4),rx=Yi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),ox=Yi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class er{constructor(t=[]){this.segments=t}_prepareSegment(t,r,c,d){let g=this.segments[this.segments.length-1];return t>er.MAX_VERTEX_ARRAY_LENGTH&&yi(`Max vertices per segment is ${er.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>er.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:r,primitiveOffset:c,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}prepareSegment(t,r,c,d){return this._prepareSegment(t,r.length,c.length,d)}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,c,d){return new er([{vertexOffset:t,primitiveOffset:r,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}function sx(a,t){return 256*(a=de(Math.floor(a),0,255))+de(Math.floor(t),0,255)}er.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vt(er,"SegmentVector");const ax=Yi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),_1=Yi([{name:"a_pattern_b",components:4,type:"Uint16"}]),y1=Yi([{name:"a_dash",components:4,type:"Uint16"}]);class $h{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,r,c,d){this.ids.push(lx(t)),this.positions.push(r,c,d)}eachPosition(t,r){const c=lx(t);let d=0,g=this.ids.length-1;for(;d<g;){const _=d+g>>1;this.ids[_]>=c?g=_:d=_+1}for(;this.ids[d]===c;)r(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(t,r){const c=new Float64Array(t.ids),d=new Uint32Array(t.positions);return yg(c,d,0,c.length-1),r&&(r.add(c.buffer),r.add(d.buffer)),{ids:c,positions:d}}static deserialize(t){const r=new $h;let c;r.ids=t.ids,r.positions=t.positions;for(const d of r.ids)d!==c&&r.uniqueIds.push(d),c=d;return r.indexed=!0,r}}function lx(a){const t=+a;return Number.isSafeInteger(t)?t:qc(String(a))}function yg(a,t,r,c){for(;r<c;){const d=a[r+c>>1];let g=r-1,_=c+1;for(;;){do g++;while(a[g]<d);do _--;while(a[_]>d);if(g>=_)break;Vh(a,g,_),Vh(t,3*g,3*_),Vh(t,3*g+1,3*_+1),Vh(t,3*g+2,3*_+2)}_-r<c-_?(yg(a,t,r,_),r=_+1):(yg(a,t,_+1,c),c=_)}}function Vh(a,t,r){const c=a[t];a[t]=a[r],a[r]=c}Vt($h,"FeaturePositionMap");class _a{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,r),this.initialized=!0),!!this.location}set(t,r,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class $s extends _a{constructor(t){super(t),this.current=0}set(t,r,c){this.fetchUniformLocation(t,r)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class Rr extends _a{constructor(t){super(t),this.current=0}set(t,r,c){this.fetchUniformLocation(t,r)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Vs extends _a{constructor(t){super(t),this.current=[0,0]}set(t,r,c){this.fetchUniformLocation(t,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class jh extends _a{constructor(t){super(t),this.current=[0,0,0]}set(t,r,c){this.fetchUniformLocation(t,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class Ef extends _a{constructor(t){super(t),this.current=[0,0,0,0]}set(t,r,c){this.fetchUniformLocation(t,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class cx extends _a{constructor(t){super(t),this.current=bn.transparent.toPremultipliedRenderColor(null)}set(t,r,c){this.fetchUniformLocation(t,r)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const v1=new Float32Array(16);class vu extends _a{constructor(t){super(t),this.current=v1}set(t,r,c){if(this.fetchUniformLocation(t,r)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let d=1;d<16;d++)if(c[d]!==this.current[d]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const M2=new Float32Array(9),f=new Float32Array(4);class n extends _a{constructor(t){super(t),this.current=f}set(t,r,c){if(this.fetchUniformLocation(t,r)){for(let d=0;d<4;d++)if(c[d]!==this.current[d]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function u(a){return[sx(255*a.r,255*a.g),sx(255*a.b,255*a.a)]}function p(a,t,r,c,d,g,_,v){return!!a&&(a.kind==="composite"||a.kind==="source"?a.evaluate(new An(0,{brightness:g,worldview:v}),t,r,d,c,_)==="none":a.value==="none")}class y{constructor(t,r,c,d){this.value=t,this.uniformNames=r.map(g=>`u_${g}`),this.type=c,this.context=d}setUniform(t,r,c,d,g){const _=d.constantOr(this.value);r.set(t,g,_ instanceof bn?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(t,r){return this.type==="color"?new cx(t):new Rr(t)}}class b{constructor(t,r){this.uniformNames=r.map(c=>`u_${c}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(t,r){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br),this.patternTransition=r?r.tl.concat(r.br):this.pattern}setUniform(t,r,c,d,g){let _=null;g!=="u_pattern"&&g!=="u_dash"||(_=this.pattern),g==="u_pattern_b"&&(_=this.patternTransition),g==="u_pixel_ratio"&&(_=this.pixelRatio),_&&r.set(t,g,_)}getBinding(t,r){return r==="u_pattern"||r==="u_pattern_b"||r==="u_dash"?new Ef(t):new Rr(t)}}class w{constructor(t,r,c,d){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,r,c,d,g,_,v,S){const T=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new An(0,{brightness:_,worldview:S}),r,{},g,d,v):this.expression.kind==="constant"&&this.expression.value,A=p(this.lutExpression,r,{},d,g,_,v,S);this.paintVertexArray.resize(t),this._setPaintValue(T,t,M,A?null:this.context.lut)}updatePaintArray(t,r,c,d,g,_,v,S){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:S},c,d,void 0,g):this.expression.kind==="constant"&&this.expression.value,M=p(this.lutExpression,c,d,g,void 0,v,void 0,S);this._setPaintValue(t,r,T,M?null:this.context.lut)}_setPaintValue(t,r,c,d){if(this.type==="color"){const g=u(c.toPremultipliedRenderColor(d));for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,g[0],g[1])}else{for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class E{constructor(t,r,c,d,g,_){this.expression=t,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=d,this.context=g,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,r,c,d,g,_,v,S){const T=this.expression.evaluate(new An(this.context.zoom,{brightness:_,worldview:S}),r,{},g,d,v),M=this.expression.evaluate(new An(this.context.zoom+1,{brightness:_,worldview:S}),r,{},g,d,v),A=p(this.lutExpression,r,{},d,g,_,v,S),z=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(z,t,T,M,A?null:this.context.lut)}updatePaintArray(t,r,c,d,g,_,v,S){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:S},c,d,void 0,g),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:S},c,d,void 0,g),A=p(this.lutExpression,c,d,g,void 0,v,void 0,S);this._setPaintValue(t,r,T,M,A?null:this.context.lut)}_setPaintValue(t,r,c,d,g){if(this.type==="color"){const _=u(c.toPremultipliedRenderColor(g)),v=u(d.toPremultipliedRenderColor(g));for(let S=t;S<r;S++)this.paintVertexArray.emplace(S,_[0],_[1],v[0],v[1])}else{for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r,c,d,g){const _=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=de(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);r.set(t,g,v)}getBinding(t,r){return new Rr(t)}}class I{constructor(t,r,c,d,g){this.expression=t,this.layerId=g,this.paintVertexAttributes=(c==="array"?y1:ax).members;for(let _=0;_<r.length;++_);this.paintVertexArray=new d,this.paintTransitionVertexArray=new gu}populatePaintArray(t,r,c,d){const g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(g,t,r.patterns&&r.patterns[this.layerId],c)}updatePaintArray(t,r,c,d,g,_,v){this._setPaintValues(t,r,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(t,r,c,d){if(!d||!c)return;const g=d[c[0]],_=d[c[1]];if(g){if(g){const{tl:v,br:S,pixelRatio:T}=g;for(let M=t;M<r;M++)this.paintVertexArray.emplace(M,v[0],v[1],S[0],S[1],T)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:S}=_;for(let T=t;T<r;T++)this.paintTransitionVertexArray.emplace(T,v[0],v[1],S[0],S[1])}}}upload(t){const r=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,r)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=t.createVertexBuffer(this.paintTransitionVertexArray,_1.members,r))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class R{constructor(t,r,c=()=>!0){this.binders={},this._buffers=[],this.context=r;const d=[];for(const g in t.paint._values){const _=t.paint.get(g);if(g.endsWith("-use-theme")||!c(g)||!(_ instanceof bc&&sf(_.property.specification)))continue;const v=B(g,t.type),S=_.value,T=_.property.specification.type,M=!!_.property.useIntegerZoom,A=g==="line-dasharray"||g.endsWith("pattern"),z=t.paint.get(`${g}-use-theme`),D=g==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||z&&z.value.kind!=="constant";if(S.kind!=="constant"||D)if(S.kind==="source"||D||A){const k=G(g,T,"source");this.binders[g]=A?new I(S,v,T,k,t.id):new w(S,v,T,k),d.push(`/a_${g}`)}else{const k=G(g,T,"composite");this.binders[g]=new E(S,v,T,M,r,k),d.push(`/z_${g}`)}else this.binders[g]=A?new b(S.value,v):new y(S.value,v,T,r),d.push(`/u_${g}`);z&&(this.binders[g].lutExpression=z.value)}this.cacheKey=d.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof w||r instanceof E?r.maxValue:0}populatePaintArrays(t,r,c,d,g,_,v,S){for(const T in this.binders){const M=this.binders[T];M.context=this.context,(M instanceof w||M instanceof E||M instanceof I)&&M.populatePaintArray(t,r,c,d,g,_,v,S)}}setConstantPatternPositions(t,r){for(const c in this.binders){const d=this.binders[c];d instanceof b&&d.setConstantPatternPositions(t,r)}}getPatternTransitionVertexBuffer(t){const r=this.binders[t];return r instanceof I?r.paintTransitionVertexBuffer:null}updatePaintArrays(t,r,c,d,g,_,v,S,T,M){let A=!1;const z=Object.keys(t),D=z.length!==0&&!S,k=D?z:r.uniqueIds;this.context.lut=g.lut;for(const $ in this.binders){const H=this.binders[$];if(H.context=this.context,(H instanceof w||H instanceof E||H instanceof I)&&H.expression&&H.expression.kind&&H.expression.kind!=="constant"&&(H.expression.isStateDependent===!0||H.expression.isLightConstant===!1)){const j=g.paint.get($);H.expression=j.value;for(const q of k){const Y=t[q.toString()];r.eachPosition(q,(te,ue,ae)=>{const ge=d.feature(te);H.updatePaintArray(ue,ae,ge,Y,_,v,T,M)})}if(!D)for(const q of c.uniqueIds){const Y=t[q.toString()];c.eachPosition(q,(te,ue,ae)=>{const ge=d.feature(te);H.updatePaintArray(ue,ae,ge,Y,_,v,T,M)})}A=!0}}return A}defines(){const t=[];for(const r in this.binders){const c=this.binders[r];(c instanceof y||c instanceof b)&&t.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const r=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof y||d instanceof b||d instanceof E)for(const g of d.uniformNames)r.push({name:g,property:c,binding:d.getBinding(t,g)})}return r}setUniforms(t,r,c,d,g){for(const{name:_,property:v,binding:S}of c)this.binders[v].setUniform(t,S,g,d.get(v),_)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const r=this.binders[t];(r instanceof w||r instanceof E||r instanceof I)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer),r instanceof I&&r.paintTransitionVertexBuffer&&this._buffers.push(r.paintTransitionVertexBuffer)}}upload(t){for(const r in this.binders){const c=this.binders[r];(c instanceof w||c instanceof E||c instanceof I)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof w||r instanceof E||r instanceof I)&&r.destroy()}}}class L{constructor(t,r,c=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new R(d,r,c);this.needsUpload=!1,this._featureMap=new $h,this._featureMapWithoutIds=new $h,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,r,c,d,g,_,v,S,T){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(t,r,d,g,_,v,S,T);r.id!==void 0?this._featureMap.add(r.id,c,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,c,d,g,_,v,S){for(const T of c)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,r,T,d,g,_,v||0,S)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const N={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function B(a,t){return N[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}const U={"line-pattern":{source:$a,composite:$a},"fill-pattern":{source:$a,composite:$a},"fill-extrusion-pattern":{source:$a,composite:$a},"line-dasharray":{source:gu,composite:gu}},W={color:{source:Tc,composite:Kl},number:{source:yo,composite:Tc}};function G(a,t,r){const c=U[a];return c&&c[r]||W[t][r]}Vt(y,"ConstantBinder"),Vt(b,"PatternConstantBinder"),Vt(w,"SourceExpressionBinder"),Vt(I,"PatternCompositeBinder"),Vt(E,"CompositeExpressionBinder"),Vt(R,"ProgramConfiguration",{omit:["_buffers"]}),Vt(L,"ProgramConfigurationSet");const X=It/Math.PI/2,K=64,oe=[K,32,16],re=-X,ne=X;function be(a,t,r,c=X){return r=ti(r),[a*Math.sin(r)*c,-t*c,a*Math.cos(r)*c]}function _e(a,t,r){return be(Math.cos(ti(a)),Math.sin(ti(a)),t,r)}const ve=63710088e-1,pe=2*Math.PI*ve;class he{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new he(Oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,c=this.lat*r,d=t.lat*r,g=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((t.lng-this.lng)*r);return ve*Math.acos(Math.min(g,1))}toBounds(t=0){const r=360*t/40075017,c=r/Math.cos(Math.PI/180*this.lat);return new Se({lng:this.lng-c,lat:this.lat-r},{lng:this.lng+c,lat:this.lat+r})}toEcef(t){return _e(this.lat,this.lng,X+t*X/ve)}static convert(t){if(t instanceof he)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new he(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new he(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Se{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof he?new he(t.lng,t.lat):he.convert(t),this}setSouthWest(t){return this._sw=t instanceof he?new he(t.lng,t.lat):he.convert(t),this}extend(t){const r=this._sw,c=this._ne;let d,g;if(t instanceof he)d=t,g=t;else{if(!(t instanceof Se))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Se.convert(t)):this.extend(he.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(he.convert(t)):this;if(d=t._sw,g=t._ne,!d||!g)return this}return r||c?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new he(d.lng,d.lat),this._ne=new he(g.lng,g.lat)),this}getCenter(){return new he((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new he(this.getWest(),this.getNorth())}getSouthEast(){return new he(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:c}=he.convert(t);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(t){if(t)return t instanceof Se?t:new Se(t)}}function ze(a){return pe*Math.cos(a*Math.PI/180)}function Le(a){return(180+a)/360}function Ze(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function je(a,t){return a/ze(t)}function tt(a){return 360*a-180}function dt(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Fe(a,t){return a*ze(dt(t))}const Te=85.051129;function Ke(a){return Math.cos(ti(de(a,-85.051129,Te)))}function We(a,t){const r=de(t,0,25.5),c=Math.pow(2,r);return Ke(a)*pe/(512*c)}function ft(a){return 1/Math.cos(a*Math.PI/180)}function vt(a,t=0){const r=Math.exp(Math.PI*(1-(a.y+t/It)/(1<<a.z)*2));return 80150034*r/(r*r+1)/It/(1<<a.z)}class At{constructor(t,r,c=0){this.x=+t,this.y=+r,this.z=+c}static fromLngLat(t,r=0){const c=he.convert(t);return new At(Le(c.lng),Ze(c.lat),je(r,c.lat))}toLngLat(){return new he(tt(this.x),dt(this.y))}toAltitude(){return Fe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/pe*ft(dt(this.y))}}function xt(a,t,r,c,d,g,_,v,S){const T=(t+c)/2,M=(r+d)/2,A=new Ae(T,M);v(A),(function(z,D,k,$,H,j){const q=k-H,Y=$-j;return Math.abs(($-D)*q-(k-z)*Y)/Math.hypot(q,Y)})(A.x,A.y,g.x,g.y,_.x,_.y)>=S?(xt(a,t,r,T,M,g,A,v,S),xt(a,T,M,c,d,A,_,v,S)):a.push(_)}function wt(a,t,r){let c=a[0],d=c.x,g=c.y;t(c);const _=[c];for(let v=1;v<a.length;v++){const S=a[v],{x:T,y:M}=S;t(S),xt(_,d,g,T,M,c,S,t,r),d=T,g=M,c=S}return _}function qt(a,t,r,c){if(c(t,r)){const d=t.add(r)._mult(.5);qt(a,t,d,c),qt(a,d,r,c)}else a.push(r)}function Gt(a,t){let r=a[0];const c=[r];for(let d=1;d<a.length;d++){const g=a[d];qt(c,r,g,t),r=g}return c}const Lt=Math.pow(2,14)-1,jt=-Lt-1;function oi(a,t){const r=Math.round(a.x*t),c=Math.round(a.y*t);return a.x=de(r,jt,Lt),a.y=de(c,jt,Lt),(r<a.x||r>a.x+1||c<a.y||c>a.y+1)&&yi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function fi(a,t,r){const c=a.loadGeometry(),d=a.extent,g=It/d;if(t&&r&&r.projection.isReprojectedInTileSpace){const _=1<<t.z,{scale:v,x:S,y:T,projection:M}=r,A=z=>{const D=tt((t.x+z.x/d)/_),k=dt((t.y+z.y/d)/_),$=M.project(D,k);z.x=($.x*v-S)*d,z.y=($.y*v-T)*d};for(let z=0;z<c.length;z++)if(a.type!==1)c[z]=wt(c[z],A,1);else{const D=[];for(const k of c[z])k.x<0||k.x>=d||k.y<0||k.y>=d||(A(k),D.push(k));c[z]=D}}for(const _ of c)for(const v of _)oi(v,g);return c}function Bi(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?fi(a):[]}}class Qi{constructor(t,r,c,d,g){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=g,t.readFields(Ti,this,r)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos,c=[];let d,g=1,_=0,v=0,S=0;for(;t.pos<r;){if(_<=0){const T=t.readVarint();g=7&T,_=T>>3}if(_--,g===1||g===2)v+=t.readSVarint(),S+=t.readSVarint(),g===1&&(d&&c.push(d),d=[]),d&&d.push(new Ae(v,S));else{if(g!==7)throw new Error(`unknown command ${g}`);d&&d.push(d[0].clone())}}return d&&c.push(d),c}bbox(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos;let c=1,d=0,g=0,_=0,v=1/0,S=-1/0,T=1/0,M=-1/0;for(;t.pos<r;){if(d<=0){const A=t.readVarint();c=7&A,d=A>>3}if(d--,c===1||c===2)g+=t.readSVarint(),_+=t.readSVarint(),g<v&&(v=g),g>S&&(S=g),_<T&&(T=_),_>M&&(M=_);else if(c!==7)throw new Error(`unknown command ${c}`)}return[v,T,S,M]}toGeoJSON(t,r,c){const d=this.extent*Math.pow(2,c),g=this.extent*t,_=this.extent*r,v=this.loadGeometry();function S(z){return[360*(z.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(z.y+_)/d)*Math.PI))-90]}function T(z){return z.map(S)}let M;if(this.type===1){const z=[];for(const k of v)z.push(k[0]);const D=T(z);M=z.length===1?{type:"Point",coordinates:D[0]}:{type:"MultiPoint",coordinates:D}}else if(this.type===2){const z=v.map(T);M=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z}}else{if(this.type!==3)throw new Error("unknown feature type");{const z=(function(k){const $=k.length;if($<=1)return[k];const H=[];let j,q;for(let Y=0;Y<$;Y++){const te=an(k[Y]);te!==0&&(q===void 0&&(q=te<0),q===te<0?(j&&H.push(j),j=[k[Y]]):j&&j.push(k[Y]))}return j&&H.push(j),H})(v),D=[];for(const k of z)D.push(k.map(T));M=D.length===1?{type:"Polygon",coordinates:D[0]}:{type:"MultiPolygon",coordinates:D}}}const A={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(A.id=this.id),A}}function Ti(a,t,r){a===1?t.id=r.readVarint():a===2?(function(c,d){const g=c.readVarint()+c.pos;for(;c.pos<g;){const _=d._keys[c.readVarint()],v=d._values[c.readVarint()];d.properties[_]=v}})(r,t):a===3?t.type=r.readVarint():a===4&&(t._geometry=r.pos)}function an(a){let t=0;for(let r,c,d=0,g=a.length,_=g-1;d<g;_=d++)r=a[d],c=a[_],t+=(c.x-r.x)*(r.y+c.y);return t}Qi.types=["Unknown","Point","LineString","Polygon"];class Ri{constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(En,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const r=this._pbf.readVarint()+this._pbf.pos;return new Qi(this._pbf,r,this.extent,this._keys,this._values)}}function En(a,t,r){a===15?t.version=r.readVarint():a===1?t.name=r.readString():a===5?t.extent=r.readVarint():a===2?t._features.push(r.pos):a===3?t._keys.push(r.readString()):a===4&&t._values.push((function(c){let d=null;const g=c.readVarint()+c.pos;for(;c.pos<g;){const _=c.readVarint()>>3;d=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(r))}class wn{constructor(t,r){this.layers=t.readFields(Mn,{},r)}}function Mn(a,t,r){if(a===3){const c=new Ri(r,r.readVarint()+r.pos);c.length&&(t[c.name]=c)}}const en="3d_elevation_id",Oi="level";class gn{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(t,r){return this._valid&&t(r(this._geometry)),this}require(t,r,c){return this.get(t,!0,r,c)}optional(t,r,c){return this.get(t,!1,r,c)}success(){return this._valid}get(t,r,c,d){const g=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?c(d?d(g):g):r&&(this._valid=!1),this}}class tr{constructor(t,r){this.featureFunc=t,this.vertexFunc=r}parseFeature(t,r,c){return this.featureFunc(t,r,c)}parseVertex(t,r,c){return this.vertexFunc(t,r,c)}}const ir=new tr((a,t,r)=>a.reset(t).require(en,c=>{r.id=c}).optional("fixed_height_relative",c=>{r.constantHeight=c},Ji.decodeRelativeHeight).geometry(c=>{r.bounds=c},gh).success(),(a,t,r)=>a.reset(t).require(en,c=>{r.id=c}).require("elevation_idx",c=>{r.idx=c}).require("extent",c=>{r.extent=c}).require("height_relative",c=>{r.height=c},Ji.decodeRelativeHeight).geometry(c=>{r.position=c},Ji.getPoint).success()),_n=new tr((a,t,r)=>a.reset(t).require(en,c=>{r.id=c}).optional("fixed_height",c=>{r.constantHeight=c},Ji.decodeMetricHeight).geometry(c=>{r.bounds=c},gh).success(),(a,t,r)=>a.reset(t).require(en,c=>{r.id=c}).require("elevation_idx",c=>{r.idx=c}).require("extent",c=>{r.extent=c}).require("height",c=>{r.height=c},Ji.decodeMetricHeight).geometry(c=>{r.position=c},Ji.getPoint).success());class Ji{static getPoint(t){return Qs(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static getVersionSchema(t){return t?t==="1.0.1"?_n:void 0:ir}static parse(t){const r=[],c=[],d=t.length,g=new gn;for(let _=0;_<d;_++){const v=t.feature(_),S=v.properties.version,T=Ji.getVersionSchema(S);if(T===void 0){yi(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const M=v.properties.type;if(!M)continue;const A=Qi.types[v.type];if(A==="Point"&&M==="curve_point"){const z={};T.parseVertex(g,v,z)&&r.push(z)}else if(A==="Polygon"&&M==="curve_meta"){const z={};T.parseFeature(g,v,z)&&c.push(z)}}return{vertices:r,features:c}}}class Fi{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,c){const d=$n(r,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1])/d;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,!0}}class Nn{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,c){const d=Ei(r,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/d;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(t,r,c){if((function(D,k){var $=D[0],H=D[1],j=D[2],q=k[0],Y=k[1],te=k[2];return Math.abs($-q)<=P*Math.max(1,Math.abs($),Math.abs(q))&&Math.abs(H-Y)<=P*Math.max(1,Math.abs(H),Math.abs(Y))&&Math.abs(j-te)<=P*Math.max(1,Math.abs(j),Math.abs(te))})(this.pos,t)||r===0)return c[0]=c[1]=c[2]=0,!1;const[d,g,_]=this.dir,v=this.pos[0]-t[0],S=this.pos[1]-t[1],T=this.pos[2]-t[2],M=d*d+g*g+_*_,A=2*(v*d+S*g+T*_),z=A*A-4*M*(v*v+S*S+T*T-r*r);if(z<0){const D=Math.max(-A/2,0),k=v+d*D,$=S+g*D,H=T+_*D,j=Math.hypot(k,$,H);return c[0]=k*r/j,c[1]=$*r/j,c[2]=H*r/j,!1}{const D=(-A-Math.sqrt(z))/(2*M);if(D<0){const k=Math.hypot(v,S,T);return c[0]=v*r/k,c[1]=S*r/k,c[2]=T*r/k,!1}return c[0]=v+d*D,c[1]=S+g*D,c[2]=T+_*D,!0}}}class hr{constructor(t,r,c,d,g){this.TL=t,this.TR=r,this.BR=c,this.BL=d,this.horizon=g}static fromInvProjectionMatrix(t,r,c){const d=[-1,1,1],g=[1,1,1],_=[1,-1,1],v=[-1,-1,1],S=Wt(d,d,t),T=Wt(g,g,t),M=Wt(_,_,t),A=Wt(v,v,t);return new hr(S,T,M,A,r/c)}}function jn(a,t,r){let c=1/0,d=-1/0;const g=[];for(const _ of a){Ce(g,_,t);const v=Ei(g,r);c=Math.min(c,v),d=Math.max(d,v)}return[c,d]}function qn(a,t){let r=!0;for(let c=0;c<a.planes.length;c++){const d=a.planes[c];let g=0;for(let _=0;_<t.length;_++)g+=+(Ei(d,t[_])+d[3]>=0);if(g===0)return 0;g!==t.length&&(r=!1)}return r?2:1}function Ho(a,t){for(const r of a.projections){const c=jn(t,a.points[0],r.axis);if(r.projection[1]<c[0]||r.projection[0]>c[1])return 0}return 1}function cs(a,t){let r=0;const c=[0,0,0,0];for(let d=0;d<a.length;d++)c[0]=a[d][0],c[1]=a[d][1],c[2]=a[d][2],c[3]=1,gi(c,t)>=0&&r++;return r}class oo{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=yn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ce([],this.points[2],this.points[3]),Ce([],this.points[0],this.points[3]),Ce([],this.points[4],this.points[0]),Ce([],this.points[5],this.points[1]),Ce([],this.points[6],this.points[2]),Ce([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const d=[0,-c[2],c[1]],g=[c[2],0,-c[0]];this.projections.push({axis:d,projection:jn(this.points,this.points[0],d)}),this.projections.push({axis:g,projection:jn(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(t,r,c,d){const g=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const M=Yt([],T,t),A=1/M[3]/r*g;return(z=M)[0]=(D=M)[0]*(k=[A,A,d?1/M[3]:A,A])[0],z[1]=D[1]*k[1],z[2]=D[2]*k[2],z[3]=D[3]*k[3],z;var z,D,k}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const M=Li([],hn([],Ce([],_[T[0]],_[T[1]]),Ce([],_[T[2]],_[T[1]]))),A=-Ei(M,_[T[1]]);return M.concat(A)}),S=[];for(let T=0;T<_.length;T++)S.push([_[T][0],_[T][1],_[T][2]]);return new oo(S,v)}intersectsPrecise(t,r,c){for(let d=0;d<r.length;d++)if(!cs(t,r[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!cs(t,this.planes[d]))return 0;for(const d of c)for(const g of this.frustumEdges){const _=hn([],d,g),v=_t(_);if(v===0)continue;bi(_,_,1/v);const S=jn(this.points,this.points[0],_),T=jn(t,this.points[0],_);if(S[0]>T[1]||T[0]>S[1])return 0}return 1}containsPoint(t){for(const r of this.planes){const c=r[3];if(Ei([r[0],r[1],r[2]],t)+c<0)return!1}return!0}}class yn{static fromPoints(t){const r=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const d of t)Mi(r,r,d),fn(c,c,d);return new yn(r,c)}static fromTileIdAndHeight(t,r,c){const d=1<<t.canonical.z,g=t.canonical.x,_=t.canonical.y;return new yn([g/d,_/d,r],[(g+1)/d,(_+1)/d,c])}static applyTransform(t,r){const c=t.getCorners();for(let d=0;d<c.length;++d)Wt(c[d],c[d],r);return yn.fromPoints(c)}static applyTransformFast(t,r){const c=[r[12],r[13],r[14]],d=[...c];for(let g=0;g<3;g++)for(let _=0;_<3;_++){const v=r[4*_+g],S=v*t.min[_],T=v*t.max[_];c[g]+=Math.min(S,T),d[g]+=Math.max(S,T)}return new yn(c,d)}static projectAabbCorners(t,r){const c=t.getCorners();for(let d=0;d<c.length;++d)Wt(c[d],c[d],r);return c}constructor(t,r){this.min=t,this.max=r,this.center=bi([],Qt([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],c=ht(this.min),d=ht(this.max);for(let g=0;g<r.length;g++)c[g]=r[g]?this.min[g]:this.center[g],d[g]=r[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new yn(c,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?qn(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?qn(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,r){return r||this.intersects(t)?Ho(t,this.getCorners()):0}intersectsPreciseFlat(t,r){return r||this.intersectsFlat(t)?Ho(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let r=0;r<3;++r)if(this.min[r]>t.max[r]||t.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t.min[r]),this.max[r]=Math.max(this.max[r],t.max[r])}encapsulatePoint(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t[r]),this.max[r]=Math.max(this.max[r],t[r])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Vt(yn,"Aabb");class xs{constructor(t,r){this.feature=t,this.metersToTile=r,this.index=0}get(){const t=this.feature.vertices[this.index],r=this.feature.vertexProps[this.index].dir,c=r[1],d=-r[0],g=(t.extent+1)*this.metersToTile;return[new Ae(Math.trunc(t.position[0]+c*g),Math.trunc(t.position[1]+d*g)),new Ae(Math.trunc(t.position[0]-c*g),Math.trunc(t.position[1]-d*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Eo{constructor(t,r,c,d,g,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[mo(),mo(),mo(),mo(),mo(),mo(),mo()],this.id=t,this.heightRange={min:c,max:c},this.safeArea=r,this.constantHeight=c,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=g,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((S=this.vertices[v.a].position)[0]===(T=this.vertices[v.b].position)[0]&&S[1]===T[1]);var S,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:Qs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const S=this.vertices[v.a].position,T=this.vertices[v.b].position,M=da(mo(),T,S),A=fa(M),z=gs(mo(),M,1/A);this.edgeProps.push({vec:M,dir:z,len:A});const D=this.vertexProps[v.a].dir,k=this.vertexProps[v.b].dir;ea(D,D,z),ea(k,k,z)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||nl(v.dir,v.dir);this.tessellate(_)}}pointElevation(t){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(t);if(r==null)return 0;const[c,d]=r;return hi(this.vertices[this.edges[c].a].height,this.vertices[this.edges[c].b].height,d)}computeSlopeNormal(t,r){const c=this.getClosestEdge(t);if(!c)return yt(0,0,1);const d=c[0],g=this.edges[d],_=this.edgeProps[d].vec,v=yt(_[0],_[1],(this.vertices[g.b].height-this.vertices[g.a].height)*r),S=yt(v[1],-v[0],0);hn(S,S,v);const T=_t(S);return T>0?bi(S,S,1/T):Nt(S,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(this.edges.length===0)return;let r=0,c=Number.POSITIVE_INFINITY,d=0;const[g,_,v,S,T,M,A]=this._tmpVec2;ha(A,t.x,t.y);const z=new Fi(A,null);for(let D=0;D<this.edges.length;D++){const k=this.edges[D],$=this.edgeProps[D].dir;z.dir=$;const H=this.vertices[k.a].position,j=this.vertices[k.b].position,q=z.intersectsPlane(H,this.vertexProps[k.a].dir,g),Y=z.intersectsPlane(j,this.vertexProps[k.b].dir,_);if(!q||!Y)continue;da(v,_,g),da(S,A,g);const te=$n(v,v),ue=te>0?$n(S,v)/te:0,ae=de(ue,0,1),ge=Math.abs((ue-ae)*this.edgeProps[D].len);da(T,A,H),ha(M,$[1],-$[0]);const ye=ge+Math.abs($n(T,M));ye<c&&(r=D,c=ye,d=ae)}return[r,d]}tessellate(t){const r=Qe(),c=Qe(),d=Qe(),g=Qe();for(let _=this.edges.length-1;_>=0;--_){const v=this.edges[_].a,S=this.edges[_].b,{position:T,height:M,extent:A}=this.vertices[v],{position:z,height:D,extent:k}=this.vertices[S],$=this.vertexProps[v].dir,H=this.vertexProps[S].dir;if(Nt(r,T[0]/t,T[1]/t,M),Nt(c,z[0]/t,z[1]/t,D),Nt(d,$[1],-$[0],0),bi(d,d,A),Nt(g,H[1],-H[0],0),bi(g,g,k),this.distSqLines(yt(r[0]+.5*d[0],r[1]+.5*d[1],r[2]+.5*d[2]),yt(c[0]-.5*g[0],c[1]-.5*g[1],c[2]-.5*g[2]),yt(r[0]-.5*d[0],r[1]-.5*d[1],r[2]-.5*d[2]),yt(c[0]+.5*g[0],c[1]+.5*g[1],c[2]+.5*g[2]))<=.0025000000000000005)continue;const j=this.vertices.length,q=ea(mo(),T,z);this.vertices.push({position:gs(q,q,.5),height:.5*(M+D),extent:.5*(A+k)});const Y=ea(mo(),$,H);this.vertexProps.push({dir:nl(Y,Y)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:v,b:j}),this.edges.push({a:j,b:S});const te=da(mo(),this.vertices[j].position,T),ue=fa(te),ae={vec:te,dir:gs(mo(),te,1/ue),len:ue};this.edgeProps.push(ae),this.edgeProps.push(ae)}}distSqLines(t,r,c,d){const g=pi(Qe(),r,t),_=pi(Qe(),d,c),v=pi(Qe(),t,c),S=Ei(g,g),T=Ei(g,_),M=Ei(g,v),A=Ei(_,_),z=Ei(_,v),D=S*A-T*T;if(D===0)return Ht(ei(g,c,d,Ei(v,_)/Ei(_,_)),t);const k=(S*z-T*M)/D;return Ht(ei(g,t,r,(T*z-M*A)/D),ei(_,c,d,k))}}class Zo{static parseFrom(t,r){const c=Ji.parse(t);if(!c)return[];let{vertices:d,features:g}=c;const _=1/vt(r);g.sort((M,A)=>M.id-A.id),d.sort((M,A)=>M.id-A.id||M.idx-A.idx),d=d.filter((M,A,z)=>A===z.findIndex(D=>D.id===M.id&&D.idx===M.idx));const v=new Array;let S=0;const T=d.length;for(const M of g){if(M.constantHeight){v.push(new Eo(M.id,M.bounds,M.constantHeight));continue}for(;S!==T&&d[S].id<M.id;)S++;if(S===T||d[S].id!==M.id)continue;const A=new Array,z=new Array,D=S;for(;S!==T&&d[S].id===M.id;){const k=d[S];if(A.push({position:k.position,height:k.height,extent:k.extent}),S!==D&&d[S-1].idx===k.idx-1){const $=S-D;z.push({a:$-1,b:$})}S++}v.push(new Eo(M.id,M.bounds,void 0,A,z,_))}return v}static getElevationFeature(t,r){if(!r)return;const c=+t.properties[en];return Number.isNaN(c)?void 0:r.find(d=>d.id===c)}}class sa{constructor(t,r){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(r)||(this.zScale=Math.pow(2,r.z-t.z),this.xOffset=(t.x*this.zScale-r.x)*It,this.yOffset=(t.y*this.zScale-r.y)*It)}constantElevation(t,r){if(t.constantHeight!=null)return this.computeBiasedHeight(t.constantHeight,r)}pointElevation(t,r,c){const d=this.constantElevation(r,c);return d??(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(t),c))}computeBiasedHeight(t,r){return r<=0?t:t+r*Me(0,r,t>=0?t:Math.abs(.5*t))}}Vt(Eo,"ElevationFeature");class Wo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Yl,this.indexArray=new Hr,this.segments=new er,this.programConfigurations=new L(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new yo),this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){const g=this.layers[0],_=[];let v=null;g.type==="circle"&&(v=g.layout.get("circle-sort-key"));for(const{feature:T,id:M,index:A,sourceLayerIndex:z}of t){const D=this.layers[0]._featureFilter.needGeometry,k=Bi(T,D);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),k,c))continue;const $=v?v.evaluate(k,{},c):void 0,H={id:M,properties:T.properties,type:T.type,sourceLayerIndex:z,index:A,geometry:D?k.geometry:fi(T,c,d),patterns:{},sortKey:$};_.push(H)}v&&_.sort((T,M)=>T.sortKey-M.sortKey);let S=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new _u,S=d.projection);for(const T of _){const{geometry:M,index:A,sourceLayerIndex:z}=T,D=t[A].feature;this.addFeature(T,M,A,r.availableImages,c,S,r.brightness,r.elevationFeatures),r.featureIndex.insert(D,M,A,z,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(t,r,c,d,g,_,v){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,ox.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,rx.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(t,r,c,d,g,_,v,S){let T;this.elevationMode!=="none"&&(T=Zo.getElevationFeature(t,S));for(const M of r)for(const A of M){const z=A.x,D=A.y;if(z<0||z>=It||D<0||D>=It)continue;if(_){const H=_.projectTilePoint(z,D,g),j=_.upVector(g,z,D);this.addGlobeExtVertex(H,j),this.addGlobeExtVertex(H,j),this.addGlobeExtVertex(H,j),this.addGlobeExtVertex(H,j)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),$=k.vertexLength;if(this.addCircleVertex(z,D,-1,-1),this.addCircleVertex(z,D,1,-1),this.addCircleVertex(z,D,1,1),this.addCircleVertex(z,D,-1,1),this.elevationMode!=="none"){const H=T?T.pointElevation(new Ae(z,D)):0;this.hasElevation=this.hasElevation||H!==0;for(let j=0;j<4;j++)this.elevatedLayoutVertexArray.emplaceBack(H)}this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+2,$+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},d,g,v,void 0,this.worldview)}addCircleVertex(t,r,c,d){this.layoutVertexArray.emplaceBack(2*t+(c+1)/2,2*r+(d+1)/2)}addGlobeExtVertex(t,r){this.globeExtVertexArray.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}}function rr(a,t){for(let r=0;r<a.length;r++)if(ws(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(ws(a,t[r]))return!0;return!!Io(a,t)}function Ir(a,t,r){return!!ws(a,t)||!!Va(t,a,r)}function Gn(a,t){if(a.length===1)return bu(t,a[0]);for(let r=0;r<t.length;r++){const c=t[r];for(let d=0;d<c.length;d++)if(ws(a,c[d]))return!0}for(let r=0;r<a.length;r++)if(bu(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(Io(a,t[r]))return!0;return!1}function Lr(a,t,r){if(a.length>1){if(Io(a,t))return!0;for(let c=0;c<t.length;c++)if(Va(t[c],a,r))return!0}for(let c=0;c<a.length;c++)if(Va(a[c],t,r))return!0;return!1}function Io(a,t){if(a.length===0||t.length===0)return!1;for(let r=0;r<a.length-1;r++){const c=a[r],d=a[r+1];for(let g=0;g<t.length-1;g++)if(br(c,d,t[g],t[g+1]))return!0}return!1}function br(a,t,r,c){return Vn(a,r,c)!==Vn(t,r,c)&&Vn(a,t,r)!==Vn(a,t,c)}function bs(a,t,r){return(a.x-r.x)*(t.y-r.y)-(a.y-r.y)*(t.x-r.x)}function Gh(a,t,r,c){const d=bs(a,t,c),g=bs(a,t,r);if(Math.sign(d)===Math.sign(g))return;const _=bs(r,c,a),v=_+g-d;return Math.sign(_)!==Math.sign(v)?[_/(_-v),g/(g-d)]:void 0}function Va(a,t,r){const c=r*r;if(t.length===1)return a.distSqr(t[0])<c;for(let d=1;d<t.length;d++)if(xu(a,t[d-1],t[d])<c)return!0;return!1}function xu(a,t,r){const c=t.distSqr(r);if(c===0)return a.distSqr(t);const d=((a.x-t.x)*(r.x-t.x)+(a.y-t.y)*(r.y-t.y))/c;return a.distSqr(d<0?t:d>1?r:r.sub(t)._mult(d)._add(t))}function bu(a,t){let r,c,d,g=!1;for(let _=0;_<a.length;_++){r=a[_];for(let v=0,S=r.length-1;v<r.length;S=v++)c=r[v],d=r[S],c.y>t.y!=d.y>t.y&&t.x<(d.x-c.x)*(t.y-c.y)/(d.y-c.y)+c.x&&(g=!g)}return g}function ws(a,t){let r=!1;for(let c=0,d=a.length-1;c<a.length;d=c++){const g=a[c],_=a[d];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(r=!r)}return r}function ja(a,t,r,c,d){for(const _ of a)if(t<=_.x&&r<=_.y&&c>=_.x&&d>=_.y)return!0;const g=[new Ae(t,r),new Ae(t,d),new Ae(c,d),new Ae(c,r)];if(a.length>2){for(const _ of g)if(ws(a,_))return!0}for(let _=0;_<a.length-1;_++)if(Ga(a[_],a[_+1],g))return!0;return!1}function Ga(a,t,r){const c=r[0],d=r[2];if(a.x<c.x&&t.x<c.x||a.x>d.x&&t.x>d.x||a.y<c.y&&t.y<c.y||a.y>d.y&&t.y>d.y)return!1;const g=Vn(a,t,r[0]);return g!==Vn(a,t,r[1])||g!==Vn(a,t,r[2])||g!==Vn(a,t,r[3])}function js(a,t,r,c,d,g){let _=t.y-a.y,v=a.x-t.x;if(g=g||0){const S=_*_+v*v;if(S===0)return!0;const T=Math.sqrt(S);_/=T,v/=T}return!((r.x-a.x)*_+(r.y-a.y)*v-g<0||(c.x-a.x)*_+(c.y-a.y)*v-g<0||(d.x-a.x)*_+(d.y-a.y)*v-g<0)}function ml(a,t,r,c,d,g,_){return!(js(a,t,c,d,g,_)||js(t,r,c,d,g,_)||js(r,a,c,d,g,_)||js(c,d,a,t,r,_)||js(d,g,a,t,r,_)||js(g,c,a,t,r,_))}function Ec(a,t,r){const c=t.paint.get(a).value;return c.kind==="constant"?c.value:r.programConfigurations.get(t.id).getMaxValue(a)}function If(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function A2(a,t,r,c,d){if(!t[0]&&!t[1])return a;const g=Ae.convert(t)._mult(d);r==="viewport"&&g._rotate(-c);const _=[];for(let v=0;v<a.length;v++)_.push(a[v].sub(g));return _}function P2(a,t,r,c){const d=Ae.convert(a)._mult(c);return t==="viewport"&&d._rotate(-r),d}let z2,C2;function R2(a,t,r){var c=2*Math.PI*6378137/256/Math.pow(2,r);return[a*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}Vt(Wo,"CircleBucket",{omit:["layers"]});class Hh{constructor(t,r,c){this.z=t,this.x=r,this.y=c,this.key=Mf(0,t,t,r,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}isChildOf(t){const r=this.z-t.z;return t.z===0||t.z<this.z&&t.x===this.x>>r&&t.y===this.y>>r}url(t,r){const c=(function(g,_,v){var S=R2(256*g,256*(_=Math.pow(2,v)-_-1),v),T=R2(256*(g+1),256*(_+1),v);return S[0]+","+S[1]+","+T[0]+","+T[1]})(this.x,this.y,this.z),d=(function(g,_,v){let S,T="";for(let M=g;M>0;M--)S=1<<M-1,T+=(_&S?1:0)+(v&S?2:0);return T})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class L2{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Mf(t,r.z,r.z,r.x,r.y)}}class qo{constructor(t,r,c,d,g){this.overscaledZ=t,this.wrap=r,this.canonical=new Hh(c,+d,+g),this.key=r===0&&t===c?this.canonical.key:Mf(r,t,c,d,g)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const r=this.canonical.z-t;return t>this.canonical.z?new qo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qo(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return Mf(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return Mf(this.wrap*+r,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new qo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new qo(r,this.wrap,r,c,d),new qo(r,this.wrap,r,c+1,d),new qo(r,this.wrap,r,c,d+1),new qo(r,this.wrap,r,c+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new qo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new qo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new L2(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Mf(a,t,r,c,d){const g=1<<Math.min(r,22);let _=g*(d%g)+c%g;return a&&r<22&&(_+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-r)))),16*(32*_+r)+(t-r)}const WU=[a=>{let t=a.canonical.x-1,r=a.wrap;return t<0&&(t=(1<<a.canonical.z)-1,r--),new qo(a.overscaledZ,r,a.canonical.z,t,a.canonical.y)},a=>{let t=a.canonical.x+1,r=a.wrap;return t===1<<a.canonical.z&&(t=0,r++),new qo(a.overscaledZ,r,a.canonical.z,t,a.canonical.y)},a=>new qo(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new qo(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Vt(Hh,"CanonicalTileID"),Vt(qo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const qU=Yi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ux}=qU,XU=Yi([{name:"a_pos_3",components:3,type:"Int16"}]);var D2=Yi([{name:"a_pos",type:"Int16",components:2}]);function hx(a){return a*X/ve}const JU=[new yn([re,re,re],[ne,ne,ne]),new yn([re,re,re],[0,0,ne]),new yn([0,re,re],[ne,0,ne]),new yn([re,0,re],[0,ne,ne]),new yn([0,0,re],[ne,ne,ne])];function k2(a,t,r,c=!0){const d=bi([],a._camera.position,a.worldSize),g=[t,r,1,1];Yt(g,g,a.pixelMatrixInverse),ri(g,g,1/g[3]);const _=Li([],Ce([],g,d)),v=a.globeMatrix,S=[v[12],v[13],v[14]],T=Ce([],S,d),M=_t(T),A=Li([],T),z=a.worldSize/(2*Math.PI),D=Ei(A,_),k=Math.asin(z/M);if(k<Math.acos(D)){if(!c)return null;const we=[],Ie=[];bi(we,_,M/D),Li(Ie,Ce(Ie,we,T)),Li(_,Qt(_,T,bi(_,Ie,Math.tan(k)*M)))}const $=[];new Nn(d,_).closestPointOnSphere(S,z,$);const H=Li([],nr(v,0)),j=Li([],nr(v,1)),q=Li([],nr(v,2)),Y=Ei(H,$),te=Ei(j,$),ue=Ei(q,$),ae=Ee(Math.asin(-te/z));let ge=Ee(Math.atan2(Y,ue));ge=a.center.lng+(function(we,Ie){const Je=(Ie-we+180)%360-180;return Je<-180?Je+360:Je})(a.center.lng,ge);const ye=Le(ge),me=de(Ze(ae),0,1);return new At(ye,me)}class YU{constructor(t,r,c){this.a=Ce([],t,c),this.b=Ce([],r,c),this.center=c;const d=Li([],this.a),g=Li([],this.b);this.angle=Math.acos(Ei(d,g))}}function x1(a,t){if(a.angle===0)return null;let r;return r=a.a[t]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[t]/a.a[t]/Math.sin(a.angle)-1/Math.tan(a.angle)),r<0||r>1?null:(function(c,d,g,_){const v=Math.sin(g);return c*(Math.sin((1-_)*g)/v)+d*(Math.sin(_*g)/v)})(a.a[t],a.b[t],a.angle,de(r,0,1))+a.center[t]}function Ql(a){if(a.z<=1)return JU[a.z+2*a.y+a.x];const t=b1(dx(a));return yn.fromPoints(t)}function Ic(a,t,r){return bi(a,a,1-r),Dn(a,a,t,r)}function O2(a,t,r){for(const c of a)Wt(c,c,t),bi(c,c,r)}function F2(a,t,r,c){const d=t/a.worldSize,g=a.globeMatrix;if(r.z<=1){const me=Ql(r).getCorners();return O2(me,g,d),yn.fromPoints(me)}const _=dx(r,c),v=b1(_,X+hx(a._tileCoverLift));O2(v,g,d);const S=Number.MAX_VALUE,T=[-S,-S,-S],M=[S,S,S];if(_.contains(a.center)){for(const Ie of v)Mi(M,M,Ie),fn(T,T,Ie);T[2]=0;const me=a.point,we=[me.x*d,me.y*d,0];return Mi(M,M,we),fn(T,T,we),new yn(M,T)}if(a._tileCoverLift>0){for(const me of v)Mi(M,M,me),fn(T,T,me);return new yn(M,T)}const A=[g[12]*d,g[13]*d,g[14]*d],z=_.getCenter(),D=de(a.center.lat,-85.051129,Te),k=de(z.lat,-85.051129,Te),$=Le(a.center.lng),H=Ze(D);let j=$-Le(z.lng);const q=H-Ze(k);j>.5?j-=1:j<-.5&&(j+=1);let Y=0;Math.abs(j)>Math.abs(q)?Y=j>=0?1:3:(Y=q>=0?0:2,Dn(A,A,[g[4]*d,g[5]*d,g[6]*d],-Math.sin(ti(q>=0?_.getSouth():_.getNorth()))*X));const te=v[Y],ue=v[(Y+1)%4],ae=new YU(te,ue,A),ge=[x1(ae,0)||te[0],x1(ae,1)||te[1],x1(ae,2)||te[2]],ye=wu(a.zoom);if(ye>0){const me=(function({x:Ie,y:Je,z:qe},Xe,at,nt,ot){const Ge=1/(1<<qe);let ct=Ie*Ge,et=ct+Ge,ut=Je*Ge,lt=ut+Ge,Bt=0;const Ut=(ct+et)/2-nt;return Ut>.5?Bt=-1:Ut<-.5&&(Bt=1),ct=((ct+Bt)*Xe-(nt*=Xe))*at+nt,et=((et+Bt)*Xe-nt)*at+nt,ut=(ut*Xe-(ot*=Xe))*at+ot,lt=(lt*Xe-ot)*at+ot,[[ct,lt,0],[et,lt,0],[et,ut,0],[ct,ut,0]]})(r,t,a._pixelsPerMercatorPixel,$,H);for(let Ie=0;Ie<v.length;Ie++)Ic(v[Ie],me[Ie],ye);const we=Qt([],me[Y],me[(Y+1)%4]);bi(we,we,.5),Ic(ge,we,ye)}for(const me of v)Mi(M,M,me),fn(T,T,me);return M[2]=Math.min(te[2],ue[2]),Mi(M,M,ge),fn(T,T,ge),new yn(M,T)}function dx({x:a,y:t,z:r},c=!1){const d=1/(1<<r),g=new he(tt(a*d),t===(1<<r)-1&&c?-90:dt((t+1)*d)),_=new he(tt((a+1)*d),t===0&&c?90:dt(t*d));return new Se(g,_)}function b1(a,t=X){const r=ti(a.getNorth()),c=ti(a.getSouth()),d=Math.cos(r),g=Math.cos(c),_=Math.sin(r),v=Math.sin(c),S=a.getWest(),T=a.getEast();return[be(g,v,S,t),be(g,v,T,t),be(d,_,T,t),be(d,_,S,t)]}function vg(a,t,r,c){const d=1<<r.z,g=(a/It+r.x)/d;return _e(dt((t/It+r.y)/d),tt(g),c)}function fx({min:a,max:t}){return 16383/Math.max(t[0]-a[0],t[1]-a[1],t[2]-a[2])}const B2=new Float64Array(16);function px(a){const t=fx(a),r=zt(B2,[t,t,t]);return it(r,r,zn([],a.min))}function w1(a){const t=(function(c,d){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=d[0],c[13]=d[1],c[14]=d[2],c[15]=1,c})(B2,a.min),r=1/fx(a);return Ve(t,t,[r,r,r])}function S1(a){const t=It/(2*Math.PI);return a/(2*Math.PI)/t}function N2(a,t){return It/(512*Math.pow(2,a))*fx(Ql(t))}function U2(a,t,r,c,d){const g=S1(r),_=[a,t,-r/(2*Math.PI)],v=fe(new Float64Array(16));return it(v,v,_),Ve(v,v,[g,g,g]),Ne(v,v,ti(-d)),Re(v,v,ti(-c)),v}function wu(a){return Me(5,6,a)}function $2(a,t){const r=_e(t.lat,t.lng),c=(function(k){const $=_e(k._center.lat,k._center.lng);let H=hn([],yt(0,1,0),$);const j=pt([],-k.angle,$);H=Wt(H,H,j),pt(j,-k._pitch,H);const q=Li([],$);return bi(q,q,hx(k.cameraToCenterDistance/k.pixelsPerMeter)),Wt(q,q,j),Qt([],$,q)})(a);return _=(d=pi([],c,r))[0],v=d[1],S=d[2],T=(g=r)[0],M=g[1],A=g[2],D=(z=Math.sqrt((_*_+v*v+S*S)*(T*T+M*M+A*A)))&&Ei(d,g)/z,Math.acos(Math.min(Math.max(D,-1),1));var d,g,_,v,S,T,M,A,z,D}function T1(a,t){return $2(a,t)>Math.PI/2*1.01}const V2=ti(85),KU=Math.cos(V2),QU=Math.sin(V2),e$=ee(),j2=a=>{const t=[];return a.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function G2(a,t,r,c,d,g,_,v,S){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(S*=a.pixelToTileUnitsFactor);const T=a.tileID.canonical,M=r.projection.upVectorScale(T,r.center.lat,r.worldSize).metersToTile;for(const A of t)for(const z of A){const D=z.add(v),k=d&&r.elevation?r.elevation.exaggeration()*d.getElevationAt(D.x,D.y,!0):0,$=r.projection.projectTilePoint(D.x,D.y,T);if(k>0){const Y=r.projection.upVector(T,D.x,D.y);$.x+=Y[0]*M*k,$.y+=Y[1]*M*k,$.z+=Y[2]*M*k}const H=g?D:t$($.x,$.y,$.z,c),j=g?a.tilespaceRays.map(Y=>n$(Y,k)):a.queryGeometry.screenGeometry,q=Yt([],[$.x,$.y,$.z,1],c);if(!_&&g?S*=q[3]/r.cameraToCenterDistance:_&&!g&&(S*=r.cameraToCenterDistance/q[3]),g){const Y=dt((z.y/It+T.y)/(1<<T.z));S/=r.projection.pixelsPerMeter(Y,1)/je(1,Y)}if(Ir(j,H,S))return!0}return!1}function t$(a,t,r,c){const d=Yt([],[a,t,r,1],c);return new Ae(d[0]/d[3],d[1]/d[3])}const H2=yt(0,0,0),i$=yt(0,0,1);function n$(a,t){const r=Qe();return H2[2]=t,a.intersectsPlane(H2,i$,r),new Ae(r[0],r[1])}class Z2 extends Wo{}let W2,q2,X2,J2;function Y2(a,{width:t,height:r},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*r*c)throw new RangeError("mismatched image size")}else d=new Uint8Array(t*r*c);return a.width=t,a.height=r,a.data=d,a}function K2(a,t,r){const{width:c,height:d}=t;c===a.width&&d===a.height||(E1(a,t,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,c),height:Math.min(a.height,d)},r,null),a.width=c,a.height=d,a.data=t.data)}function E1(a,t,r,c,d,g,_,v){if(d.width===0||d.height===0)return t;if(d.width>a.width||d.height>a.height||r.x>a.width-d.width||r.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||c.x>t.width-d.width||c.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const S=a.data,T=t.data,M=g===4&&v;for(let A=0;A<d.height;A++){const z=((r.y+A)*a.width+r.x)*g,D=((c.y+A)*t.width+c.x)*g;if(M)for(let k=0;k<d.width;k++){const $=z+k*g+3,H=D+k*g;T[H+0]=255,T[H+1]=255,T[H+2]=255,T[H+3]=S[$]}else if(_)for(let k=0;k<d.width;k++){const $=z+k*g,H=D+k*g,j=new bn(S[$+0]/255,S[$+1]/255,S[$+2]/255,S[$+3]).toNonPremultipliedRenderColor(_).toArray();T[H+0]=j[0],T[H+1]=j[1],T[H+2]=j[2],T[H+3]=j[3]}else for(let k=0;k<d.width*g;k++)T[D+k]=S[z+k]}return t}Vt(Z2,"HeatmapBucket",{omit:["layers"]});class Su{constructor(t,r){Y2(this,t,1,r)}resize(t){K2(this,new Su(t),1)}clone(){return new Su({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,d,g){E1(t,r,c,d,g,1,null)}}class Mo{constructor(t,r){Y2(this,t,4,r)}resize(t){K2(this,new Mo(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,d,g,_,v){E1(t,r,c,d,g,4,_,v)}}class Q2{constructor(t,r){this.width=t.width,this.height=t.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function xg(a){const t={},r=a.resolution||256,c=a.clips?a.clips.length:1,d=a.image||new Mo({width:r,height:c}),g=(_,v,S)=>{t[a.evaluationKey]=S;const T=a.expression.evaluate(t),M=T?T.toNonPremultipliedRenderColor(null):null;M&&(d.data[_+v+0]=Math.floor(255*M.r),d.data[_+v+1]=Math.floor(255*M.g),d.data[_+v+2]=Math.floor(255*M.b),d.data[_+v+3]=Math.floor(255*M.a))};if(a.clips)for(let _=0,v=0;_<c;++_,v+=4*r)for(let S=0,T=0;S<r;S++,T+=4){const M=S/(r-1),{start:A,end:z}=a.clips[_];g(v,T,A*(1-M)+z*M)}else for(let _=0,v=0;_<r;_++,v+=4)g(0,v,_/(r-1));return d}Vt(Su,"AlphaImage"),Vt(Mo,"RGBAImage");const r$=Yi([{name:"a_pos",components:2,type:"Int16"}],4),o$=Yi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),s$=Yi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),a$=Yi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Af(a,t,r=2){const c=t&&t.length,d=c?t[0]*r:a.length;let g=eA(a,0,d,r,!0);const _=[];if(!g||g.next===g.prev)return _;let v,S,T;if(c&&(g=(function(M,A,z,D){const k=[];for(let $=0,H=A.length;$<H;$++){const j=eA(M,A[$]*D,$<H-1?A[$+1]*D:M.length,D,!1);j===j.next&&(j.steiner=!0),k.push(m$(j))}k.sort(d$);for(let $=0;$<k.length;$++)z=f$(k[$],z);return z})(a,t,g,r)),a.length>80*r){v=a[0],S=a[1];let M=v,A=S;for(let z=r;z<d;z+=r){const D=a[z],k=a[z+1];D<v&&(v=D),k<S&&(S=k),D>M&&(M=D),k>A&&(A=k)}T=Math.max(M-v,A-S),T=T!==0?32767/T:0}return bg(g,_,r,v,S,T,0),_}function eA(a,t,r,c,d){let g;if(d===(function(_,v,S,T){let M=0;for(let A=v,z=S-T;A<S;A+=T)M+=(_[z]-_[A])*(_[A+1]+_[z+1]),z=A;return M})(a,t,r,c)>0)for(let _=t;_<r;_+=c)g=rA(_/c|0,a[_],a[_+1],g);else for(let _=r-c;_>=t;_-=c)g=rA(_/c|0,a[_],a[_+1],g);return g&&Pf(g,g.next)&&(Tg(g),g=g.next),g}function Zh(a,t){if(!a)return a;t||(t=a);let r,c=a;do if(r=!1,c.steiner||!Pf(c,c.next)&&so(c.prev,c,c.next)!==0)c=c.next;else{if(Tg(c),c=t=c.prev,c===c.next)break;r=!0}while(r||c!==t);return t}function bg(a,t,r,c,d,g,_){if(!a)return;!_&&g&&(function(S,T,M,A){let z=S;do z.z===0&&(z.z=I1(z.x,z.y,T,M,A)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==S);z.prevZ.nextZ=null,z.prevZ=null,(function(D){let k,$=1;do{let H,j=D;D=null;let q=null;for(k=0;j;){k++;let Y=j,te=0;for(let ae=0;ae<$&&(te++,Y=Y.nextZ,Y);ae++);let ue=$;for(;te>0||ue>0&&Y;)te!==0&&(ue===0||!Y||j.z<=Y.z)?(H=j,j=j.nextZ,te--):(H=Y,Y=Y.nextZ,ue--),q?q.nextZ=H:D=H,H.prevZ=q,q=H;j=Y}q.nextZ=null,$*=2}while(k>1)})(z)})(a,c,d,g);let v=a;for(;a.prev!==a.next;){const S=a.prev,T=a.next;if(g?c$(a,c,d,g):l$(a))t.push(S.i,a.i,T.i),Tg(a),a=T.next,v=T.next;else if((a=T)===v){_?_===1?bg(a=u$(Zh(a),t),t,r,c,d,g,2):_===2&&h$(a,t,r,c,d,g):bg(Zh(a),t,r,c,d,g,1);break}}}function l$(a){const t=a.prev,r=a,c=a.next;if(so(t,r,c)>=0)return!1;const d=t.x,g=r.x,_=c.x,v=t.y,S=r.y,T=c.y,M=Math.min(d,g,_),A=Math.min(v,S,T),z=Math.max(d,g,_),D=Math.max(v,S,T);let k=c.next;for(;k!==t;){if(k.x>=M&&k.x<=z&&k.y>=A&&k.y<=D&&wg(d,v,g,S,_,T,k.x,k.y)&&so(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function c$(a,t,r,c){const d=a.prev,g=a,_=a.next;if(so(d,g,_)>=0)return!1;const v=d.x,S=g.x,T=_.x,M=d.y,A=g.y,z=_.y,D=Math.min(v,S,T),k=Math.min(M,A,z),$=Math.max(v,S,T),H=Math.max(M,A,z),j=I1(D,k,t,r,c),q=I1($,H,t,r,c);let Y=a.prevZ,te=a.nextZ;for(;Y&&Y.z>=j&&te&&te.z<=q;){if(Y.x>=D&&Y.x<=$&&Y.y>=k&&Y.y<=H&&Y!==d&&Y!==_&&wg(v,M,S,A,T,z,Y.x,Y.y)&&so(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,te.x>=D&&te.x<=$&&te.y>=k&&te.y<=H&&te!==d&&te!==_&&wg(v,M,S,A,T,z,te.x,te.y)&&so(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;Y&&Y.z>=j;){if(Y.x>=D&&Y.x<=$&&Y.y>=k&&Y.y<=H&&Y!==d&&Y!==_&&wg(v,M,S,A,T,z,Y.x,Y.y)&&so(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;te&&te.z<=q;){if(te.x>=D&&te.x<=$&&te.y>=k&&te.y<=H&&te!==d&&te!==_&&wg(v,M,S,A,T,z,te.x,te.y)&&so(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function u$(a,t){let r=a;do{const c=r.prev,d=r.next.next;!Pf(c,d)&&iA(c,r,r.next,d)&&Sg(c,d)&&Sg(d,c)&&(t.push(c.i,r.i,d.i),Tg(r),Tg(r.next),r=a=d),r=r.next}while(r!==a);return Zh(r)}function h$(a,t,r,c,d,g){let _=a;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&g$(_,v)){let S=nA(_,v);return _=Zh(_,_.next),S=Zh(S,S.next),bg(_,t,r,c,d,g,0),void bg(S,t,r,c,d,g,0)}v=v.next}_=_.next}while(_!==a)}function d$(a,t){let r=a.x-t.x;return r===0&&(r=a.y-t.y,r===0)&&(r=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function f$(a,t){const r=(function(d,g){let _=g;const v=d.x,S=d.y;let T,M=-1/0;if(Pf(d,_))return _;do{if(Pf(d,_.next))return _.next;if(S<=_.y&&S>=_.next.y&&_.next.y!==_.y){const $=_.x+(S-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if($<=v&&$>M&&(M=$,T=_.x<_.next.x?_:_.next,$===v))return T}_=_.next}while(_!==g);if(!T)return null;const A=T,z=T.x,D=T.y;let k=1/0;_=T;do{if(v>=_.x&&_.x>=z&&v!==_.x&&tA(S<D?v:M,S,z,D,S<D?M:v,S,_.x,_.y)){const $=Math.abs(S-_.y)/(v-_.x);Sg(_,d)&&($<k||$===k&&(_.x>T.x||_.x===T.x&&p$(T,_)))&&(T=_,k=$)}_=_.next}while(_!==A);return T})(a,t);if(!r)return t;const c=nA(r,a);return Zh(c,c.next),Zh(r,r.next)}function p$(a,t){return so(a.prev,a,t.prev)<0&&so(t.next,a,a.next)<0}function I1(a,t,r,c,d){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-r)*d|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m$(a){let t=a,r=a;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==a);return r}function tA(a,t,r,c,d,g,_,v){return(d-_)*(t-v)>=(a-_)*(g-v)&&(a-_)*(c-v)>=(r-_)*(t-v)&&(r-_)*(g-v)>=(d-_)*(c-v)}function wg(a,t,r,c,d,g,_,v){return!(a===_&&t===v)&&tA(a,t,r,c,d,g,_,v)}function g$(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!(function(r,c){let d=r;do{if(d.i!==r.i&&d.next.i!==r.i&&d.i!==c.i&&d.next.i!==c.i&&iA(d,d.next,r,c))return!0;d=d.next}while(d!==r);return!1})(a,t)&&(Sg(a,t)&&Sg(t,a)&&(function(r,c){let d=r,g=!1;const _=(r.x+c.x)/2,v=(r.y+c.y)/2;do d.y>v!=d.next.y>v&&d.next.y!==d.y&&_<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==r);return g})(a,t)&&(so(a.prev,a,t.prev)||so(a,t.prev,t))||Pf(a,t)&&so(a.prev,a,a.next)>0&&so(t.prev,t,t.next)>0)}function so(a,t,r){return(t.y-a.y)*(r.x-t.x)-(t.x-a.x)*(r.y-t.y)}function Pf(a,t){return a.x===t.x&&a.y===t.y}function iA(a,t,r,c){const d=gx(so(a,t,r)),g=gx(so(a,t,c)),_=gx(so(r,c,a)),v=gx(so(r,c,t));return d!==g&&_!==v||!(d!==0||!mx(a,r,t))||!(g!==0||!mx(a,c,t))||!(_!==0||!mx(r,a,c))||!(v!==0||!mx(r,t,c))}function mx(a,t,r){return t.x<=Math.max(a.x,r.x)&&t.x>=Math.min(a.x,r.x)&&t.y<=Math.max(a.y,r.y)&&t.y>=Math.min(a.y,r.y)}function gx(a){return a>0?1:a<0?-1:0}function Sg(a,t){return so(a.prev,a,a.next)<0?so(a,t,a.next)>=0&&so(a,a.prev,t)>=0:so(a,t,a.prev)<0||so(a,a.next,t)<0}function nA(a,t){const r=M1(a.i,a.x,a.y),c=M1(t.i,t.x,t.y),d=a.next,g=t.prev;return a.next=t,t.prev=a,r.next=d,d.prev=r,c.next=r,r.prev=c,g.next=c,c.prev=g,c}function rA(a,t,r,c){const d=M1(a,t,r);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function Tg(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function M1(a,t,r){return{i:a,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Eg(a,t){const r=a.length;if(r<=1)return[a];const c=[];let d,g;for(let _=0;_<r;_++){const v=Nr(a[_]);v!==0&&(a[_].area=Math.abs(v),g===void 0&&(g=v<0),g===v<0?(d&&c.push(d),d=[a[_]]):d.push(a[_]))}if(d&&c.push(d),t>1)for(let _=0;_<c.length;_++)c[_].length<=t||(Nd(c[_],t,1,c[_].length-1,_$),c[_]=c[_].slice(0,t));return c}function _$(a,t){return t.area-a.area}function oA(a,t,r=1){if(!a)return null;const c=typeof a=="string"?ss.from(a).getPrimary():a.getPrimary(),d=typeof a=="string"?null:a.getSecondary();for(const g of[c,d]){if(!g)continue;const _=g.id.toString();t.has(_)||t.set(_,[]),g.scaleSelf(r),t.get(_).push(g)}return{primary:c.toString(),secondary:d?d.toString():null}}function A1(a,t,r,c){const d=c.patternDependencies;let g=!1;for(const _ of t){const v=_.paint.get(`${a}-pattern`);v.isConstant()||(g=!0),oA(v.constantOr(null),d,r)&&(g=!0)}return g}function P1(a,t,r,c,d,g){const _=g.patternDependencies;for(const v of t){const S=v.paint.get(`${a}-pattern`).value;if(S.kind!=="constant"){let T=S.evaluate({zoom:c},r,{},g.availableImages);T=T&&T.name?T.name:T;const M=oA(T,_,d);if(!M)continue;const{primary:A,secondary:z}=M;A&&(r.patterns[v.id]=[A,z].filter(Boolean))}}return r}class Mc{constructor(){this.portals=[]}static isOnBorder(t,r){return t<=0&&r<=0||t>=It&&r>=It}static evaluate(t){if(t.length===0)return new Mc;let r=[];for(const S of t)r.push(...S.portals);if(r.length===0)return new Mc;for(const S of r){const T=S.va,M=S.vb;(Mc.isOnBorder(T.x,M.x)||Mc.isOnBorder(T.y,M.y))&&(S.type="border")}const c=r.filter(S=>S.type!=="unevaluated"),d=r.filter(S=>S.type==="unevaluated");if(d.length===0)return new Mc;d.sort((S,T)=>S.hash===T.hash?S.isTunnel===T.isTunnel?0:S.isTunnel?-1:1:S.hash<T.hash?1:-1),r=c.concat(d);let g=c.length,_=g,v=g;do if(_++,_===r.length||r[g].hash!==r[_].hash){if(_-g===2){v<g&&(r[v]=r[g],r[g]=null);const S=r[v],T=r[_-1];S.type=S.isTunnel!==T.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:T.connection.a},v++}g=_}while(g!==r.length);return r.splice(v),r.sort((S,T)=>S.hash<T.hash?1:-1),{portals:r}}}Vt(Mc,"ElevationPortalGraph");class y${constructor(t,r,c){this.outPositions=t,this.outNormals=r,this.outIndices=c,this.vertexLookup=new Map}addVertex(t,r,c){let d=t[2];c!=null&&(d*=c);const g=`${t[0]},${t[1]},${t[2]},${r[0]},${r[1]},${r[2]}`,_=this.vertexLookup.get(g);if(_!=null)return _;const v=this.outPositions.length;this.vertexLookup.set(g,v);const S=Math.trunc(16384*r[0]),T=Math.trunc(16384*r[1]),M=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(t[0],t[1],d),this.outNormals.emplaceBack(S,T,M),v}addTriangle(t,r,c){this.outIndices.emplaceBack(t,r,c)}addTriangles(t,r,c){if(t.length===0)return;const d=c.length===1,g=Qe(),_=Qe();for(let v=0;v<t.length;v+=3){const S=r[t[v+0]],T=r[t[v+1]],M=r[t[v+2]],A=d?c[0]:c[t[v+1]],z=d?c[0]:c[t[v+2]];Nt(g,S.x,S.y,d?c[0]:c[t[v+0]]);const D=this.addVertex(g,_);Nt(g,T.x,T.y,A);const k=this.addVertex(g,_);Nt(g,M.x,M.y,z);const $=this.addVertex(g,_);this.outIndices.emplaceBack(D,k,$)}}addQuad(t,r,c,d,g,_){const v=this.addVertex(t,g,_),S=this.addVertex(r,g,_),T=this.addVertex(c,g,_),M=this.addVertex(d,g,_);this.addTriangle(v,S,T),this.addTriangle(T,M,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Gs{constructor(t,r,c,d){this.unevaluatedPortals=new Mc,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new mu,this.vertexNormals=new ag,this.indexArray=new Hr,this.tileToMeters=vt(t),this.bridgeProgramConfigurations=new L(r,{zoom:c,lut:d},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new L(r,{zoom:c,lut:d},g=>g!=="fill-bridge-guard-rail-color")}addVertices(t,r){const c=this.unevalVertices.length;for(let d=0;d<t.length;d++)this.unevalVertices.push(t[d]),this.unevalHeights.push(r[d]);return c}addTriangles(t,r,c){const d=c?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of t)d.push(g+r)}addRenderableRing(t,r,c,d,g,_){const v=[new Ae(g.min.x,g.min.y),new Ae(g.max.x,g.min.y),new Ae(g.max.x,g.max.y),new Ae(g.min.x,g.max.y)];for(let S=0;S<c-1;S++){const T=r+S,M=T+1,A=this.unevalVertices[T],z=this.unevalVertices[M];if(!(A.x>=g.min.x&&A.x<=g.max.x&&A.y>=g.min.y&&A.y<=g.max.y||z.x>=g.min.x&&z.x<=g.max.x&&z.y>=g.min.y&&z.y<=g.max.y||Ga(A,z,v))||this.isOnBorder(A.x,z.x)||this.isOnBorder(A.y,z.y))continue;const D=Gs.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[M]);let k,$=this.vertexHashLookup.get(Gs.computePosHash(A));$!=null?k=$.next:($=this.vertexHashLookup.get(Gs.computePosHash(z)),k=$!=null?$.prev:D),this.unevalEdges.push({polygonIdx:t,a:T,b:M,hash:D,portalHash:k,isTunnel:d,type:"unevaluated",featureInfo:_})}}addPortalCandidates(t,r,c,d,g){if(r.length!==0){this.vertexHashLookup.clear();for(const _ of r){if(_.length===0)continue;const v=_[0];let S=Gs.computeEdgeHash(v[v.length-2],v[v.length-1]);for(let T=0;T<v.length-1;T++){const M=v[T+0],A=v[T+1],z=Qs(A.x-M.x,A.y-M.y),D=fa(z);if(D===0)continue;let k="unevaluated";const $=d.pointElevation(M),H=d.pointElevation(A);Math.abs($)<.01&&Math.abs(H)<.01?k="entrance":(this.isOnBorder(M.x,A.x)||this.isOnBorder(M.y,A.y))&&(k="border");const j=Gs.computeEdgeHash(M,A);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:M,vb:A,vab:z,length:D,hash:j,isTunnel:c,type:k});const q=Gs.computePosHash(M);this.vertexHashLookup.set(q,{prev:S,next:j}),S=j}}}}construct(t){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),c=z=>{z.primitiveLength=this.indexArray.length-z.primitiveOffset},d=new y$(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);const g=r(),_=r(),v=r(),S=(z,D)=>{z.sort(($,H)=>$.type===D&&H.type!==D?-1:$.type!==D&&H.type===D?1:0);const k=z.findIndex($=>$.type!==D);return k>=0?k:z.length};let T=0;this.unevalEdges.length>0&&(T=S(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),c(v);const M=r(),A=r();if(this.unevalEdges.length>0){const z=this.unevalEdges.splice(T),D=S(z,"tunnel")+T;this.unevalEdges.push(...z),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:D})}c(M),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),c(A),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),c(_),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),c(g),this.maskSegments=er.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.depthSegments=er.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=er.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=er.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=er.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(t,r,c,d,g,_,v,S){this.bridgeProgramConfigurations.updatePaintArrays(t,r,g,c,d,_,v,S),this.tunnelProgramConfigurations.updatePaintArrays(t,r,g,c,d,_,v,S)}upload(t){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,s$.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,a$.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(t),this.tunnelProgramConfigurations.upload(t))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(t,r,c,d,g){const _=(v,S)=>{for(let T=0;T<S.length-1;T++){const M=S[T].featureIndex,A=S[T+1].vertexStart,z=t.feature(M);v.populatePaintArrays(A,z,M,{},c,r,d,void 0,g)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(t,r,c,d,g){const _=new Map;for(let v=d;v<g;v++){const S=c[v],T=S.a,M=S.b,A=Gs.computePosHash(t[T]),z=Gs.computePosHash(t[M]);let D=_.get(A);D||(D={},_.set(A,D));let k=_.get(z);k||(k={},_.set(z,k)),r[T]<=0&&r[M]<=0||(D.to=M,k.from=T)}return _}isTerminalVertex(t,r){const c=Gs.computePosHash(this.unevalVertices[t]),d=r.get(c);return!d||!d.from||!d.to}constructBridgeStructures(t,r,c,d,g,_){t.clearVertexLookup();const v=this.computeVertexConnections(r,c,d,g.min,g.max),S=1/_,T=.5*S,M=(at,nt)=>Nt(at,r[nt].x,r[nt].y,c[nt]*S),A=Qe(),z=Qe(),D=Qe(),k=Qe(),$=Qe(),H=(at,nt)=>{const ot=v.get(Gs.computePosHash(r[nt])),Ge=ot.from,ct=ot.to;if(!Ge||!ct)return;M(A,Ge),M(z,nt),M(D,ct),zi(k),$e(A,z)||(Ce($,z,A),Li(k,$)),$e(D,z)||(Ce($,D,z),Qt(k,k,Li($,$)));const et=Xt(k);return et>0?bi(at,k,1/et):void 0};let j=Number.POSITIVE_INFINITY;this.sortSubarray(d,g.min,g.max,(at,nt)=>at.featureInfo.featureIndex-nt.featureInfo.featureIndex);const q=Qe(),Y=Qe(),te=Qe(),ue=Qe(),ae=Qe(),ge=Qe(),ye=Qe(),me=Qe(),we=Qe(),Ie=[Qe(),Qe(),Qe(),Qe()],Je=[Qe(),Qe(),Qe(),Qe()],qe=[{coord:new Ae(0,0),height:0},{coord:new Ae(0,0),height:0}],Xe=(at,nt)=>at>nt;for(let at=g.min;at<g.max;at++){const nt=d[at];if(!nt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(qe,r,c,nt,Xe))continue;const[ot,Ge]=qe;if(Nt(q,ot.coord.x,ot.coord.y,S*ot.height),Nt(Y,Ge.coord.x,Ge.coord.y,S*Ge.height),$e(q,Y))continue;Ce(te,Y,q),Li(te,te);const ct=H(me,nt.a)||te,et=H(we,nt.b)||te;Nt(ue,ct[1],-ct[0],0),Li(ue,ue),Nt(ae,et[1],-et[0],0),Li(ae,ae),hn(me,ue,ct),Li(ge,me),hn(me,ae,et),Li(ye,me),Qt(Ie[0],q,bi(me,Ce(me,ue,ge),T)),Qt(Ie[1],q,bi(me,Qt(me,ue,ge),T)),Qt(Ie[2],q,bi(me,ge,T)),Ie[3]=q,Qt(Je[0],Y,bi(me,Ce(me,ae,ye),T)),Qt(Je[1],Y,bi(me,Qt(me,ae,ye),T)),Qt(Je[2],Y,bi(me,ye,T)),Je[3]=Y,j=this.addFeatureSection(nt.featureInfo.featureIndex,j,this.bridgeFeatureSections,t);const ut=t.addVertex(Ie[0],ue,_),lt=t.addVertex(Ie[1],ue,_),Bt=t.addVertex(Je[0],ae,_),Ut=t.addVertex(Je[1],ae,_);t.addTriangle(ut,lt,Bt),t.addTriangle(lt,Ut,Bt);const Tt=t.addVertex(Ie[1],ge,_),Mt=t.addVertex(Ie[2],ge,_),ai=t.addVertex(Je[1],ye,_),Jt=t.addVertex(Je[2],ye,_);t.addTriangle(Tt,Mt,ai),t.addTriangle(Mt,Jt,ai),zn(ue,ue),zn(ae,ae);const Ct=t.addVertex(Ie[2],ue,_),xi=t.addVertex(Ie[3],ue,_),Wi=t.addVertex(Je[2],ae,_),mn=t.addVertex(Je[3],ae,_);t.addTriangle(Ct,xi,Wi),t.addTriangle(xi,mn,Wi);const Gi=this.isTerminalVertex(nt.a,v),Pn=this.isTerminalVertex(nt.b,v);ot.height<.01&&Gi&&t.addQuad(Ie[3],Ie[2],Ie[1],Ie[0],zn(ct,ct),_),Ge.height<.01&&Pn&&t.addQuad(Je[0],Je[1],Je[2],Je[3],et,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}constructTunnelStructures(t,r,c,d,g,_){t.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const S=(j,q)=>j.featureInfo.featureIndex-q.featureInfo.featureIndex;this.sortSubarray(d,g.min,g.max,S),this.sortSubarray(d,_.min,_.max,S);const T=j=>Li(j,j),M=[{coord:new Ae(0,0),height:0},{coord:new Ae(0,0),height:0}],A=(j,q)=>j<q,z=Qe(),D=Qe(),k=Qe(),$=Qe(),H=Qe();for(let j=g.min;j<g.max;j++){if(!this.prepareEdgePoints(M,r,c,d[j],A))continue;const[q,Y]=M,te=T(Nt(H,-(Y.coord.y-q.coord.y),Y.coord.x-q.coord.x,0));v=this.addFeatureSection(d[j].featureInfo.featureIndex,v,this.tunnelFeatureSections,t),t.addQuad(Nt(z,q.coord.x,q.coord.y,q.height),Nt(D,Y.coord.x,Y.coord.y,Y.height),Nt(k,Y.coord.x,Y.coord.y,d[j].isTunnel?-.1:0),Nt($,q.coord.x,q.coord.y,d[j].isTunnel?-.1:0),te)}for(let j=_.min;j<_.max;j++){const q=d[j];q.isTunnel&&([q.a,q.b]=[q.b,q.a]);const Y=r[q.a],te=r[q.b],ue=T(Nt(H,-(te.y-Y.y),te.x-Y.x,0));v=this.addFeatureSection(q.featureInfo.featureIndex,v,this.tunnelFeatureSections,t),t.addQuad(Nt(z,te.x,te.y,0),Nt(D,Y.x,Y.y,0),Nt(k,Y.x,Y.y,c[q.a]+4),Nt($,te.x,te.y,c[q.b]+4),ue),t.addQuad(Nt(z,Y.x,Y.y,0),Nt(D,te.x,te.y,0),Nt(k,te.x,te.y,c[q.b]+4),Nt($,Y.x,Y.y,c[q.a]+4),ue)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}setElevatedPoint(t,r,c,d){t.coord.x=r,t.coord.y=c,t.height=d}prepareEdgePoints(t,r,c,d,g){let _=r[d.a].x,v=r[d.a].y,S=r[d.b].x,T=r[d.b].y,M=c[d.a],A=c[d.b];const z=g(M,0),D=g(A,0);if(z&&D)return this.setElevatedPoint(t[0],_,v,M),this.setElevatedPoint(t[1],S,T,A),!0;if(!z&&!D)return!1;if(z){if(!D){const k=A/(A-M);S=hi(S,_,k),T=hi(T,v,k),A=hi(A,M,k)}}else{const k=M/(M-A);_=hi(_,S,k),v=hi(v,T,k),M=hi(M,A,k)}return this.setElevatedPoint(t[0],_,v,M),this.setElevatedPoint(t[1],S,T,A),!0}prepareEdges(t,r){if(r.length===0)return;r.sort((v,S)=>v.hash===S.hash?S.polygonIdx-v.polygonIdx:S.hash>v.hash?1:-1);let c=0,d=0,g=0,_=r[c].polygonIdx;do d++,(d===r.length||r[c].hash!==r[d].hash)&&((d-c===1||r[d-1].polygonIdx!==_)&&(g<c&&(r[g]=r[c],r[c]=null),r[g].type="none",g++),c=d,c!==r.length&&(_=r[c].polygonIdx));while(c!==r.length);if(r.splice(g),r.length!==0&&t.length!==0){r.sort((T,M)=>T.portalHash<M.portalHash?1:-1);let v=0,S=0;for(;v!==r.length&&S!==t.length;){const T=r[v],M=t[S];T.portalHash>M.hash?v++:M.hash>T.portalHash?S++:(T.type=M.type,v++)}}}isOnBorder(t,r){return t<=0&&r<=0||t>=It&&r>=It}addFeatureSection(t,r,c,d){return t!==r&&(r=t,c.push({featureIndex:t,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),r}sortSubarray(t,r,c,d){const g=t.slice(r,c);g.sort(d),t.splice(r,g.length,...g)}static computeEdgeHash(t,r){return(t.y===r.y&&t.x>r.x||t.y>r.y)&&([t,r]=[r,t]),BigInt(Gs.computePosHash(t))<<32n|BigInt(Gs.computePosHash(r))}static computePosHash(t){return((65535&t.x)<<16|65535&t.y)>>>0}}function v$(a,t){return a>t?1:a<t?-1:0}class z1{constructor(t=v$,r=!1){this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!r}rotateLeft(t){var r=t.right;r&&(t.right=r.left,r.left&&(r.left.parent=t),r.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=r:t.parent.right=r:this._root=r,r&&(r.left=t),t.parent=r}rotateRight(t){var r=t.left;r&&(t.left=r.right,r.right&&(r.right.parent=t),r.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=r:t.parent.right=r:this._root=r,r&&(r.right=t),t.parent=r}_splay(t){for(;t.parent;){var r=t.parent;r.parent?r.left===t&&r.parent.left===r?(this.rotateRight(r.parent),this.rotateRight(r)):r.right===t&&r.parent.right===r?(this.rotateLeft(r.parent),this.rotateLeft(r)):r.left===t&&r.parent.right===r?(this.rotateRight(r),this.rotateLeft(r)):(this.rotateLeft(r),this.rotateRight(r)):r.left===t?this.rotateRight(r):this.rotateLeft(r)}}splay(t){for(var r,c,d,g,_;t.parent;)(c=(r=t.parent).parent)&&c.parent?((d=c.parent).left===c?d.left=t:d.right=t,t.parent=d):(t.parent=null,this._root=t),g=t.left,_=t.right,t===r.left?(c&&(c.left===r?(r.right?(c.left=r.right,c.left.parent=c):c.left=null,r.right=c,c.parent=r):(g?(c.right=g,g.parent=c):c.right=null,t.left=c,c.parent=t)),_?(r.left=_,_.parent=r):r.left=null,t.right=r,r.parent=t):(c&&(c.right===r?(r.left?(c.right=r.left,c.right.parent=c):c.right=null,r.left=c,c.parent=r):(_?(c.left=_,_.parent=c):c.left=null,t.right=c,c.parent=t)),g?(r.right=g,g.parent=r):r.right=null,t.left=r,r.parent=t)}replace(t,r){t.parent?t===t.parent.left?t.parent.left=r:t.parent.right=r:this._root=r,r&&(r.parent=t.parent)}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}insert(t,r){var c=this._root,d=null,g=this._compare;if(this._noDuplicates)for(;c;){if(d=c,g(c.key,t)===0)return;c=g(c.key,t)<0?c.right:c.left}else for(;c;)d=c,c=g(c.key,t)<0?c.right:c.left;return c={key:t,data:r,left:null,right:null,parent:d},d?g(d.key,c.key)<0?d.right=c:d.left=c:this._root=c,this.splay(c),this._size++,c}find(t){for(var r=this._root,c=this._compare;r;){var d=c(r.key,t);if(d<0)r=r.right;else{if(!(d>0))return r;r=r.left}}return null}contains(t){for(var r=this._root,c=this._compare;r;){var d=c(t,r.key);if(d===0)return!0;r=d<0?r.left:r.right}return!1}remove(t){var r=this.find(t);if(!r)return!1;if(this.splay(r),r.left)if(r.right){var c=this.minNode(r.right);c.parent!==r&&(this.replace(c,c.right),c.right=r.right,c.right.parent=c),this.replace(r,c),c.left=r.left,c.left.parent=c}else this.replace(r,r.left);else this.replace(r,r.right);return this._size--,!0}removeNode(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var r=this.minNode(t.right);r.parent!==t&&(this.replace(r,r.right),r.right=t.right,r.right.parent=r),this.replace(t,r),r.left=t.left,r.left.parent=r}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}erase(t){var r=this.find(t);if(r){this.splay(r);var c=r.left,d=r.right,g=null;c&&(c.parent=null,g=this.maxNode(c),this.splay(g),this._root=g),d&&(c?g.right=d:this._root=d,d.parent=g),this._size--}}pop(){var t=this._root,r=null;if(t){for(;t.left;)t=t.left;r={key:t.key,data:t.data},this.remove(t.key)}return r}next(t){var r=t;if(r)if(r.right)for(r=r.right;r&&r.left;)r=r.left;else for(r=t.parent;r&&r.right===t;)t=r,r=r.parent;return r}prev(t){var r=t;if(r)if(r.left)for(r=r.left;r&&r.right;)r=r.right;else for(r=t.parent;r&&r.left===t;)t=r,r=r.parent;return r}forEach(t){for(var r=this._root,c=[],d=!1,g=0;!d;)r?(c.push(r),r=r.left):c.length>0?(t(r=c.pop(),g++),r=r.right):d=!0;return this}range(t,r,c,d){const g=[],_=this._compare;let v,S=this._root;for(;g.length!==0||S;)if(S)g.push(S),S=S.left;else{if(S=g.pop(),v=_(S.key,r),v>0)break;if(_(S.key,t)>=0&&c.call(d,S))return this;S=S.right}return this}keys(){for(var t=this._root,r=[],c=[],d=!1;!d;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),c.push(t.key),t=t.right):d=!0;return c}values(){for(var t=this._root,r=[],c=[],d=!1;!d;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),c.push(t.data),t=t.right):d=!0;return c}at(t){for(var r=this._root,c=[],d=!1,g=0;!d;)if(r)c.push(r),r=r.left;else if(c.length>0){if(r=c.pop(),g===t)return r;g++,r=r.right}else d=!0;return null}load(t=[],r=[],c=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const d=t.length;return c&&R1(t,r,0,d-1,this._compare),this._root=C1(null,t,r,0,d),this._size=d,this}min(){var t=this.minNode(this._root);return t?t.key:null}max(){var t=this.maxNode(this._root);return t?t.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(t,r,c,d,g){return new z1(c,g).load(t,r,d)}}function C1(a,t,r,c,d){const g=d-c;if(g>0){const _=c+Math.floor(g/2),v={key:t[_],data:r[_],parent:a};return v.left=C1(v,t,r,c,_),v.right=C1(v,t,r,_+1,d),v}return null}function R1(a,t,r,c,d){if(r>=c)return;const g=a[r+c>>1];let _=r-1,v=c+1;for(;;){do _++;while(d(a[_],g)<0);do v--;while(d(a[v],g)>0);if(_>=v)break;let S=a[_];a[_]=a[v],a[v]=S,S=t[_],t[_]=t[v],t[v]=S}R1(a,t,r,v,d),R1(a,t,v+1,c,d)}const sA=11102230246251565e-32,Ss=134217729,x$=(3+8*sA)*sA;function L1(a,t,r,c,d){let g,_,v,S,T=t[0],M=c[0],A=0,z=0;M>T==M>-T?(g=T,T=t[++A]):(g=M,M=c[++z]);let D=0;if(A<a&&z<r)for(M>T==M>-T?(_=T+g,v=g-(_-T),T=t[++A]):(_=M+g,v=g-(_-M),M=c[++z]),g=_,v!==0&&(d[D++]=v);A<a&&z<r;)M>T==M>-T?(_=g+T,S=_-g,v=g-(_-S)+(T-S),T=t[++A]):(_=g+M,S=_-g,v=g-(_-S)+(M-S),M=c[++z]),g=_,v!==0&&(d[D++]=v);for(;A<a;)_=g+T,S=_-g,v=g-(_-S)+(T-S),T=t[++A],g=_,v!==0&&(d[D++]=v);for(;z<r;)_=g+M,S=_-g,v=g-(_-S)+(M-S),M=c[++z],g=_,v!==0&&(d[D++]=v);return g===0&&D!==0||(d[D++]=g),D}function Ig(a){return new Float64Array(a)}const zf=Ig(4),aA=Ig(8),lA=Ig(12),cA=Ig(16),Hs=Ig(4);function Mg(a,t,r){t===null?(a.inOut=!1,a.otherInOut=!0):(a.isSubject===t.isSubject?(a.inOut=!t.inOut,a.otherInOut=t.otherInOut):(a.inOut=!t.otherInOut,a.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(a.prevInResult=!uA(t,r)||t.isVertical()?t.prevInResult:t)),a.resultTransition=uA(a,r)?(function(c,d){let g,_=!c.inOut,v=!c.otherInOut;switch(d){case 0:g=_&&v;break;case 1:g=_||v;break;case 3:g=_!==v;break;case 2:g=c.isSubject?_&&!v:v&&!_}return g?1:-1})(a,r):0}function uA(a,t){switch(a.type){case 0:switch(t){case 0:return!a.otherInOut;case 1:return a.otherInOut;case 2:return a.isSubject&&a.otherInOut||!a.isSubject&&!a.otherInOut;case 3:return!0}break;case 2:return t===0||t===1;case 3:return t===2;case 1:return!1}return!1}class Cf{constructor(t,r,c,d,g){this.left=r,this.point=t,this.otherEvent=c,this.isSubject=d??!1,this.type=g||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(t){const r=this.point,c=this.otherEvent.point;return this.left?(r[0]-t[0])*(c[1]-t[1])-(c[0]-t[0])*(r[1]-t[1])>0:(c[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(c[1]-t[1])>0}isAbove(t){return!this.isBelow(t)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const t=new Cf(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.contourId=this.contourId,t.resultTransition=this.resultTransition,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}}function ec(a,t){return a[0]===t[0]&&a[1]===t[1]}function D1(a,t,r){const c=(function(d,g,_,v,S,T){const M=(g-T)*(_-S),A=(d-S)*(v-T),z=M-A;if(M===0||A===0||M>0!=A>0)return z;const D=Math.abs(M+A);return Math.abs(z)>=33306690738754716e-32*D?z:-(function(k,$,H,j,q,Y,te){let ue,ae,ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot,Ge,ct,et,ut,lt;const Bt=k-q,Ut=H-q,Tt=$-Y,Mt=j-Y;Ge=Bt*Mt,we=Ss*Bt,Ie=we-(we-Bt),Je=Bt-Ie,we=Ss*Mt,qe=we-(we-Mt),Xe=Mt-qe,ct=Je*Xe-(Ge-Ie*qe-Je*qe-Ie*Xe),et=Tt*Ut,we=Ss*Tt,Ie=we-(we-Tt),Je=Tt-Ie,we=Ss*Ut,qe=we-(we-Ut),Xe=Ut-qe,ut=Je*Xe-(et-Ie*qe-Je*qe-Ie*Xe),at=ct-ut,me=ct-at,zf[0]=ct-(at+me)+(me-ut),nt=Ge+at,me=nt-Ge,ot=Ge-(nt-me)+(at-me),at=ot-et,me=ot-at,zf[1]=ot-(at+me)+(me-et),lt=nt+at,me=lt-nt,zf[2]=nt-(lt-me)+(at-me),zf[3]=lt;let ai=(function(mn,Gi){let Pn=Gi[0];for(let sn=1;sn<4;sn++)Pn+=Gi[sn];return Pn})(0,zf),Jt=22204460492503146e-32*te;if(ai>=Jt||-ai>=Jt||(me=k-Bt,ue=k-(Bt+me)+(me-q),me=H-Ut,ge=H-(Ut+me)+(me-q),me=$-Tt,ae=$-(Tt+me)+(me-Y),me=j-Mt,ye=j-(Mt+me)+(me-Y),ue===0&&ae===0&&ge===0&&ye===0)||(Jt=11093356479670487e-47*te+x$*Math.abs(ai),ai+=Bt*ye+Mt*ue-(Tt*ge+Ut*ae),ai>=Jt||-ai>=Jt))return ai;Ge=ue*Mt,we=Ss*ue,Ie=we-(we-ue),Je=ue-Ie,we=Ss*Mt,qe=we-(we-Mt),Xe=Mt-qe,ct=Je*Xe-(Ge-Ie*qe-Je*qe-Ie*Xe),et=ae*Ut,we=Ss*ae,Ie=we-(we-ae),Je=ae-Ie,we=Ss*Ut,qe=we-(we-Ut),Xe=Ut-qe,ut=Je*Xe-(et-Ie*qe-Je*qe-Ie*Xe),at=ct-ut,me=ct-at,Hs[0]=ct-(at+me)+(me-ut),nt=Ge+at,me=nt-Ge,ot=Ge-(nt-me)+(at-me),at=ot-et,me=ot-at,Hs[1]=ot-(at+me)+(me-et),lt=nt+at,me=lt-nt,Hs[2]=nt-(lt-me)+(at-me),Hs[3]=lt;const Ct=L1(4,zf,4,Hs,aA);Ge=Bt*ye,we=Ss*Bt,Ie=we-(we-Bt),Je=Bt-Ie,we=Ss*ye,qe=we-(we-ye),Xe=ye-qe,ct=Je*Xe-(Ge-Ie*qe-Je*qe-Ie*Xe),et=Tt*ge,we=Ss*Tt,Ie=we-(we-Tt),Je=Tt-Ie,we=Ss*ge,qe=we-(we-ge),Xe=ge-qe,ut=Je*Xe-(et-Ie*qe-Je*qe-Ie*Xe),at=ct-ut,me=ct-at,Hs[0]=ct-(at+me)+(me-ut),nt=Ge+at,me=nt-Ge,ot=Ge-(nt-me)+(at-me),at=ot-et,me=ot-at,Hs[1]=ot-(at+me)+(me-et),lt=nt+at,me=lt-nt,Hs[2]=nt-(lt-me)+(at-me),Hs[3]=lt;const xi=L1(Ct,aA,4,Hs,lA);Ge=ue*ye,we=Ss*ue,Ie=we-(we-ue),Je=ue-Ie,we=Ss*ye,qe=we-(we-ye),Xe=ye-qe,ct=Je*Xe-(Ge-Ie*qe-Je*qe-Ie*Xe),et=ae*ge,we=Ss*ae,Ie=we-(we-ae),Je=ae-Ie,we=Ss*ge,qe=we-(we-ge),Xe=ge-qe,ut=Je*Xe-(et-Ie*qe-Je*qe-Ie*Xe),at=ct-ut,me=ct-at,Hs[0]=ct-(at+me)+(me-ut),nt=Ge+at,me=nt-Ge,ot=Ge-(nt-me)+(at-me),at=ot-et,me=ot-at,Hs[1]=ot-(at+me)+(me-et),lt=nt+at,me=lt-nt,Hs[2]=nt-(lt-me)+(at-me),Hs[3]=lt;const Wi=L1(xi,lA,4,Hs,cA);return cA[Wi-1]})(d,g,_,v,S,T,D)})(a[0],a[1],t[0],t[1],r[0],r[1]);return c>0?-1:c<0?1:0}function Tu(a,t){const r=a.point,c=t.point;return r[0]>c[0]?1:r[0]<c[0]?-1:r[1]!==c[1]?r[1]>c[1]?1:-1:(function(d,g,_){return d.left!==g.left?d.left?1:-1:D1(_,d.otherEvent.point,g.otherEvent.point)!==0?d.isBelow(g.otherEvent.point)?-1:1:!d.isSubject&&g.isSubject?1:-1})(a,t,r)}function Eu(a,t,r){const c=new Cf(t,!1,a,a.isSubject),d=new Cf(t,!0,a.otherEvent,a.isSubject);return ec(a.point,a.otherEvent.point)&&console.warn("what is that, a collapsed segment?",a),c.contourId=d.contourId=a.contourId,Tu(d,a.otherEvent)>0&&(a.otherEvent.left=!0,d.left=!1),a.otherEvent.otherEvent=d,a.otherEvent=c,r.push(d),r.push(c),r}function _x(a,t){return a[0]*t[1]-a[1]*t[0]}function k1(a,t){return a[0]*t[0]+a[1]*t[1]}function O1(a,t,r){const c=(function(S,T,M,A){const z=[T[0]-S[0],T[1]-S[1]],D=[A[0]-M[0],A[1]-M[1]];function k(ge,ye,me){return[ge[0]+ye*me[0],ge[1]+ye*me[1]]}const $=[M[0]-S[0],M[1]-S[1]];let H=_x(z,D),j=H*H;const q=k1(z,z);if(j>0){const ge=_x($,D)/H;if(ge<0||ge>1)return null;const ye=_x($,z)/H;return ye<0||ye>1?null:ge===0||ge===1?[k(S,ge,z)]:ye===0||ye===1?[k(M,ye,D)]:[k(S,ge,z)]}if(H=_x($,z),j=H*H,j>0)return null;const Y=k1(z,$)/q,te=Y+k1(z,D)/q,ue=Math.min(Y,te),ae=Math.max(Y,te);return ue<=1&&ae>=0?ue===1?[k(S,ue>0?ue:0,z)]:ae===0?[k(S,ae<1?ae:1,z)]:[k(S,ue>0?ue:0,z),k(S,ae<1?ae:1,z)]:null})(a.point,a.otherEvent.point,t.point,t.otherEvent.point),d=c?c.length:0;if(d===0||d===1&&(ec(a.point,t.point)||ec(a.otherEvent.point,t.otherEvent.point))||d===2&&a.isSubject===t.isSubject)return 0;if(d===1)return!ec(a.point,c[0])&&!ec(a.otherEvent.point,c[0])&&Eu(a,c[0],r),!ec(t.point,c[0])&&!ec(t.otherEvent.point,c[0])&&Eu(t,c[0],r),1;const g=[];let _=!1,v=!1;return ec(a.point,t.point)?_=!0:Tu(a,t)===1?g.push(t,a):g.push(a,t),ec(a.otherEvent.point,t.otherEvent.point)?v=!0:Tu(a.otherEvent,t.otherEvent)===1?g.push(t.otherEvent,a.otherEvent):g.push(a.otherEvent,t.otherEvent),_&&v||_?(t.type=1,a.type=t.inOut===a.inOut?2:3,_&&!v&&Eu(g[1].otherEvent,g[0].point,r),2):v?(Eu(g[0],g[1].point,r),3):g[0]!==g[3].otherEvent?(Eu(g[0],g[1].point,r),Eu(g[1],g[2].point,r),3):(Eu(g[0],g[1].point,r),Eu(g[3].otherEvent,g[2].point,r),3)}function b$(a,t){if(a===t)return 0;if(D1(a.point,a.otherEvent.point,t.point)!==0||D1(a.point,a.otherEvent.point,t.otherEvent.point)!==0)return ec(a.point,t.point)?a.isBelow(t.otherEvent.point)?-1:1:a.point[0]===t.point[0]?a.point[1]<t.point[1]?-1:1:Tu(a,t)===1?t.isAbove(a.point)?-1:1:a.isBelow(t.point)?-1:1;if(a.isSubject!==t.isSubject)return a.isSubject?-1:1;{let r=a.point,c=t.point;if(r[0]===c[0]&&r[1]===c[1])return r=a.otherEvent.point,c=t.otherEvent.point,r[0]===c[0]&&r[1]===c[1]?0:(a.contourId??0)>(t.contourId??0)?1:-1}return Tu(a,t)===1?1:-1}class w${constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function S$(a,t,r,c){let d,g=a+1,_=t[a].point;const v=t.length;for(g<v&&(d=t[g].point);g<v&&d[0]===_[0]&&d[1]===_[1];){if(!r[g])return g;g++,g<v&&(d=t[g].point)}for(g=a-1;r[g]&&g>c;)g--;return g}function T$(a,t,r){const c=new w$;if(a.prevInResult!=null){const d=a.prevInResult,g=d.outputContourId;if(d.resultTransition>0){const _=t[g];if(_.holeOf!=null){const v=_.holeOf;t[v].holeIds.push(r),c.holeOf=v,c.depth=t[g].depth}else t[g].holeIds.push(r),c.holeOf=g,c.depth=t[g].depth+1}else c.holeOf=null,c.depth=t[g].depth}else c.holeOf=null,c.depth=0;return c}const hA=Math.max,dA=Math.min;let yx=0;function fA(a,t,r,c,d,g){let _,v,S,T,M,A;for(_=0,v=a.length-1;_<v;_++){if(S=a[_],T=a[_+1],M=new Cf(S,!1,void 0,t),A=new Cf(T,!1,M,t),M.otherEvent=A,S[0]===T[0]&&S[1]===T[1])continue;M.contourId=A.contourId=r,g||(M.isExteriorRing=!1,A.isExteriorRing=!1),Tu(M,A)>0?A.left=!0:M.left=!0;const z=S[0],D=S[1];d[0]=dA(d[0],z),d[1]=dA(d[1],D),d[2]=hA(d[2],z),d[3]=hA(d[3],D),c.push(M),c.push(A)}}const vx=[];function pA(a,t,r){let c=a,d=t;typeof a[0][0][0]=="number"&&(c=[a]),typeof t[0][0][0]=="number"&&(d=[t]);let g=(function(z,D,k){let $=null;return z.length*D.length===0&&(k===0?$=vx:k===2?$=z:(k===1||k===3)&&($=z.length===0?D:z)),$})(c,d,r);if(g)return g===vx?null:g;const _=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],S=(function(z,D,k,$,H){const j=new _h(void 0,Tu);let q,Y,te,ue,ae,ge;for(te=0,ue=z.length;te<ue;te++)for(q=z[te],ae=0,ge=q.length;ae<ge;ae++)Y=ae===0,Y&&yx++,fA(q[ae],!0,yx,j,k,Y);for(te=0,ue=D.length;te<ue;te++)for(q=D[te],ae=0,ge=q.length;ae<ge;ae++)Y=ae===0,H===2&&(Y=!1),Y&&yx++,fA(q[ae],!1,yx,j,$,Y);return j})(c,d,_,v,r);if(g=(function(z,D,k,$,H){let j=null;return(k[0]>$[2]||$[0]>k[2]||k[1]>$[3]||$[1]>k[3])&&(H===0?j=vx:H===2?j=z:(H===1||H===3)&&(j=z.concat(D))),j})(c,d,_,v,r),g)return g===vx?null:g;const T=(function(z,D,k,$,H,j){const q=new z1(b$),Y=[],te=Math.min($[2],H[2]);let ue,ae,ge;for(;z.length!==0;){let ye=z.pop();if(Y.push(ye),j===0&&ye.point[0]>te||j===2&&ye.point[0]>$[2])break;if(ye.left){ae=ue=q.insert(ye),ge=q.minNode(),ue=ue!==ge?q.prev(ue):null,ae=q.next(ae);const me=ue?ue.key:null;let we;if(Mg(ye,me,j),ae&&O1(ye,ae.key,z)===2&&(Mg(ye,me,j),Mg(ae.key,ye,j)),ue&&O1(ue.key,ye,z)===2){let Ie=ue;Ie=Ie!==ge?q.prev(Ie):null,we=Ie?Ie.key:null,Mg(me,we,j),Mg(ye,me,j)}}else ye=ye.otherEvent,ae=ue=q.find(ye),ue&&ae&&(ue=ue!==ge?q.prev(ue):null,ae=q.next(ae),q.remove(ye),ae&&ue&&O1(ue.key,ae.key,z))}return Y})(S,0,0,_,v,r),M=(function(z){let D,k;const $=(function(q){let Y,te,ue,ae,ge;const ye=[];for(te=0,ue=q.length;te<ue;te++)Y=q[te],(Y.left&&Y.inResult||!Y.left&&Y.otherEvent.inResult)&&ye.push(Y);let me=!1;for(;!me;)for(me=!0,te=0,ue=ye.length;te<ue;te++)te+1<ue&&Tu(ye[te],ye[te+1])===1&&(ae=ye[te],ye[te]=ye[te+1],ye[te+1]=ae,me=!1);for(te=0,ue=ye.length;te<ue;te++)Y=ye[te],Y.otherPos=te;for(te=0,ue=ye.length;te<ue;te++)Y=ye[te],Y.left||(ge=Y.otherPos,Y.otherPos=Y.otherEvent.otherPos,Y.otherEvent.otherPos=ge);return ye})(z),H={},j=[];for(D=0,k=$.length;D<k;D++){if(H[D])continue;const q=j.length,Y=T$($[D],j,q),te=ge=>{H[ge]=!0,ge<$.length&&$[ge]&&($[ge].outputContourId=q)};let ue=D,ae=D;for(Y.points.push($[D].point);te(ue),ue=$[ue].otherPos,te(ue),Y.points.push($[ue].point),ue=S$(ue,$,H,ae),!(ue==ae||ue>=$.length)&&$[ue];);j.push(Y)}return j})(T),A=[];for(let z=0;z<M.length;z++){let D=M[z];if(D.isExterior()){let k=[D.points];for(let $=0;$<D.holeIds.length;$++)k.push(M[D.holeIds[$]].points);A.push(k)}}return A}function xx(a,t,r,c){const d=[],g=c===0?(_,v,S,T,M,A)=>{_.push(new Ae(A,S+(A-v)/(T-v)*(M-S)))}:(_,v,S,T,M,A)=>{_.push(new Ae(v+(A-S)/(M-S)*(T-v),A))};for(const _ of a){const v=[];for(const S of _){if(S.length<=2)continue;const T=[];for(let z=0;z<S.length-1;z++){const D=S[z].x,k=S[z].y,$=S[z+1].x,H=S[z+1].y,j=c===0?D:k,q=c===0?$:H;j<t?q>t&&g(T,D,k,$,H,t):j>r?q<r&&g(T,D,k,$,H,r):T.push(S[z]),q<t&&j>=t&&g(T,D,k,$,H,t),q>r&&j<=r&&g(T,D,k,$,H,r)}let M=S[S.length-1];const A=c===0?M.x:M.y;A>=t&&A<=r&&T.push(M),T.length&&(M=T[T.length-1],T[0].x===M.x&&T[0].y===M.y||T.push(T[0]),v.push(T))}v.length&&d.push(v)}return d}function E$(a,t){const r=pA(F1(a),F1([t]),0);return r==null?[]:mA(r)}function I$(a,t){let c=F1(a,65536);const d=[];for(;t.valid();t.next()){const[g,_]=t.get(),v=g.x*65536,S=g.y*65536,T=_.x*65536,M=_.y*65536,A=T-v,z=M-S,D=Math.hypot(A,z);if(D===0)continue;const k=Math.trunc(z/D*3),$=-Math.trunc(A/D*3);d.push([[[v,S],[T,M],[T+k,M+$],[v+k,S+$],[v,S]]])}return d.length>0&&(c=pA(c,d,2)),mA(c,1/65536,128)}function F1(a,t=1){return[a.map(r=>r.map(c=>[c.x*t,c.y*t]))]}function mA(a,t=1,r){return a.map(c=>c.map((d,g)=>{const _=d.map(v=>{let S=v[0],T=v[1];return r&&(S=Math.round(S/r)*r,T=Math.round(T/r)*r),new Ae(S*t,T*t)._round()});return g>0&&_.reverse(),_}))}class B1{constructor(t,r){this.layoutVertexArray=new Yl,this.indexArray=new Hr,this.lineIndexArray=new Us,this.triangleSegments=new er,this.lineSegments=new er,this.programConfigurations=new L(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new yo)}update(t,r,c,d,g,_,v,S){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,S)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,r$.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,o$.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(t,r,c,d,g,_,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,c,d,g,_,void 0,v)}}class N1{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=t.lut,this.bufferData=new B1(t,!1),this.elevationBufferData=new B1(t,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=t.sourceLayerIndex,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){this.hasPattern=A1("fill",this.layers,this.pixelRatio,r);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:S,index:T,sourceLayerIndex:M}of t){const A=this.layers[0]._featureFilter.needGeometry,z=Bi(v,A);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),z,c))continue;const D=g?g.evaluate(z,{},c,r.availableImages):void 0,k={id:S,properties:v.properties,type:v.type,sourceLayerIndex:M,index:T,geometry:A?z.geometry:fi(v,c,d),patterns:{},sortKey:D};_.push(k)}g&&_.sort((v,S)=>v.sortKey-S.sortKey);for(const v of _){const{geometry:S,index:T,sourceLayerIndex:M}=v;if(this.hasPattern){const A=P1("fill",this.layers,v,this.zoom,this.pixelRatio,r);this.patternFeatures.push(A)}else this.addFeature(v,S,T,c,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(t[T].feature,S,T,M,this.index)}}update(t,r,c,d,g,_,v){this.bufferData.update(t,r,c,d,g,_,v,this.worldview),this.elevationBufferData.update(t,r,c,d,g,_,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(t,r,c,d,g,_,v,this.worldview)}addFeatures(t,r,c,d,g,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,c,d,_,t.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(t,r,c,d,g,_=[],v,S){const T=Eg(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(t,T,d,c,S):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(t,c,g,_,d,v,this.worldview),this.elevationBufferData.populatePaintArrays(t,c,g,_,d,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(t,r,c,d,g){this.elevatedStructures&&(this.elevatedStructures.construct(t),this.elevatedStructures.populatePaintArrays(r,c,d,g,this.worldview))}addElevatedRoadFeature(t,r,c,d,g){const _=new Array,v=Zo.getElevationFeature(t,g);if(!v)return void this.addGeometry(r,this.bufferData);{const T=this.clipPolygonsToTile(r,1);T.length>0&&_.push({polygons:T,elevationFeature:v,elevationTileID:c})}const S={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(t,{},c),featureIndex:d};for(const T of _)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Gs(T.elevationTileID,this.layers,this.zoom,this.lut));const A=T.elevationFeature.isTunnel();let z=0;t.properties.hasOwnProperty(Oi)&&(z=+t.properties[Oi]),this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,T.polygons,A,T.elevationFeature,z)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const M=new sa(c,T.elevationTileID);this.addElevatedGeometry(T.polygons,M,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,S)}}addElevatedGeometry(t,r,c,d,g,_){const v={elevation:c,elevationSampler:r,bias:d,index:g,featureInfo:_},[S,T]=this.addGeometry(t,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:S,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,S),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(t,r,c){let d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,_=null;c&&(_=c.elevationSampler.constantElevation(c.elevation,c.bias),_!=null&&(d=_,g=_));const v=(S,T,M)=>{if(c!=null)if(T.push(S),_!=null)r.elevatedLayoutVertexArray.emplaceBack(_),M.push(_);else{const A=c.elevationSampler.pointElevation(S,c.elevation,c.bias);r.elevatedLayoutVertexArray.emplaceBack(A),M.push(A),d=Math.min(d,A),g=Math.max(g,A)}};for(const S of t){let T=0;for(const Y of S)T+=Y.length;const M=r.triangleSegments.prepareSegment(T,r.layoutVertexArray,r.indexArray),A=M.vertexLength,z=[],D=[],k=[],$=[],H=[],j=r.layoutVertexArray.length;for(const Y of S){if(Y.length===0)continue;Y!==S[0]&&D.push(z.length/2);const te=r.lineSegments.prepareSegment(Y.length,r.layoutVertexArray,r.lineIndexArray),ue=te.vertexLength;c&&H.push(r.layoutVertexArray.length-j),v(Y[0],k,$),r.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),r.lineIndexArray.emplaceBack(ue+Y.length-1,ue),z.push(Y[0].x),z.push(Y[0].y);for(let ae=1;ae<Y.length;ae++)v(Y[ae],k,$),r.layoutVertexArray.emplaceBack(Y[ae].x,Y[ae].y),r.lineIndexArray.emplaceBack(ue+ae-1,ue+ae),z.push(Y[ae].x),z.push(Y[ae].y);te.vertexLength+=Y.length,te.primitiveLength+=Y.length}const q=Af(z,D);for(let Y=0;Y<q.length;Y+=3)r.indexArray.emplaceBack(A+q[Y],A+q[Y+1],A+q[Y+2]);if(q.length>0&&c&&this.elevationMode==="hd-road-base"){const Y=c.elevation.isTunnel(),te=c.elevation.safeArea,ue=this.elevatedStructures.addVertices(k,$);this.elevatedStructures.addTriangles(q,ue,Y);const ae=H.length;if(ae>0){for(let ge=0;ge<ae-1;ge++)this.elevatedStructures.addRenderableRing(c.index,H[ge]+ue,H[ge+1]-H[ge],Y,te,c.featureInfo);this.elevatedStructures.addRenderableRing(c.index,H[ae-1]+ue,k.length-H[ae-1],Y,te,c.featureInfo)}}M.vertexLength+=T,M.primitiveLength+=q.length/3}return[d,g]}prepareElevatedPolygons(t,r,c){const d=1/vt(c),g=[];for(const _ of t){const v=I$(_,new xs(r,d));g.push(...v)}return g}clipPolygonsToTile(t,r){const c=-r,d=-r,g=It+r,_=It+r;let v=0;const S=[],T=[];for(;v<t.length;v++){const z=t[v],D=gh(z);(D.min.x>=c&&D.max.x<=g&&D.min.y>=d&&D.max.y<=_?S:T).push(z)}if(S.length===t.length)return t;const M=[new Ae(c,d),new Ae(g,d),new Ae(g,_),new Ae(c,_),new Ae(c,d)],A=S;for(const z of T)A.push(...E$(z,M));return A}}let gA,_A,yA,vA;Vt(N1,"FillBucket",{omit:["layers","patternFeatures"]}),Vt(B1,"FillBufferData"),Vt(Gs,"ElevatedStructures");class bx{constructor(t,r,c,d){if(this.triangleCount=r.length/3,this.min=new Ae(0,0),this.max=new Ae(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[g,_]=[t[0].clone(),t[0].clone()];for(let A=1;A<t.length;++A){const z=t[A];g.x=Math.min(g.x,z.x),g.y=Math.min(g.y,z.y),_.x=Math.max(_.x,z.x),_.y=Math.max(_.y,z.y)}if(d){const A=Math.ceil(Math.max(_.x-g.x,_.y-g.y)/d);c=Math.max(c,A)}if(c===0)return;this.min=g,this.max=_;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const S=Math.max(v.x,v.y)/c;this.cellsX=Math.max(1,Math.ceil(v.x/S)),this.cellsY=Math.max(1,Math.ceil(v.y/S)),this.xScale=1/S,this.yScale=1/S;const T=[];for(let A=0;A<this.triangleCount;A++){const z=t[r[3*A+0]].sub(this.min),D=t[r[3*A+1]].sub(this.min),k=t[r[3*A+2]].sub(this.min),$=tc(Math.floor(Math.min(z.x,D.x,k.x)),this.xScale,this.cellsX),H=tc(Math.floor(Math.max(z.x,D.x,k.x)),this.xScale,this.cellsX),j=tc(Math.floor(Math.min(z.y,D.y,k.y)),this.yScale,this.cellsY),q=tc(Math.floor(Math.max(z.y,D.y,k.y)),this.yScale,this.cellsY),Y=new Ae(0,0),te=new Ae(0,0),ue=new Ae(0,0),ae=new Ae(0,0);for(let ge=j;ge<=q;++ge){Y.y=te.y=ge*S,ue.y=ae.y=(ge+1)*S;for(let ye=$;ye<=H;++ye)Y.x=ue.x=ye*S,te.x=ae.x=(ye+1)*S,(ml(z,D,k,Y,te,ae)||ml(z,D,k,Y,ae,ue))&&T.push({cellIdx:ge*this.cellsX+ye,triIdx:A})}}if(T.length===0)return;T.sort((A,z)=>A.cellIdx-z.cellIdx||A.triIdx-z.triIdx);let M=0;for(;M<T.length;){const A=T[M].cellIdx,z={start:this.payload.length,len:0};for(;M<T.length&&T[M].cellIdx===A;)++z.len,this.payload.push(T[M++].triIdx);this.cells[A]=z}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,r){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const c=tc(t.x-this.min.x,this.xScale,this.cellsX),d=tc(t.y-this.min.y,this.yScale,this.cellsY),g=this.cells[d*this.cellsX+c];if(g){this._lazyInitLookup();for(let _=0;_<g.len;_++){const v=this.payload[g.start+_],S=Math.floor(v/8),T=1<<v%8;if(!(this.lookup[S]&T)&&(this.lookup[S]|=T,r.push(v),r.length===this.triangleCount))return}}}query(t,r,c){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>r.x||t.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const d=tc(t.x-this.min.x,this.xScale,this.cellsX),g=tc(r.x-this.min.x,this.xScale,this.cellsX),_=tc(t.y-this.min.y,this.yScale,this.cellsY),v=tc(r.y-this.min.y,this.yScale,this.cellsY);for(let S=_;S<=v;S++)for(let T=d;T<=g;T++){const M=this.cells[S*this.cellsX+T];if(M)for(let A=0;A<M.len;A++){const z=this.payload[M.start+A],D=Math.floor(z/8),k=1<<z%8;if(!(this.lookup[D]&k)&&(this.lookup[D]|=k,c.push(z),c.length===this.triangleCount))return}}}}function tc(a,t,r){return Math.max(0,Math.min(r-1,Math.floor(a*t)))}Vt(bx,"TriangleGridIndex");class xA{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){for(const c of this.footprints)r.push({footprint:c,id:t})}updateAppearances(t,r,c,d){}populate(t,r,c,d){const g=[];for(const{feature:_,id:v,index:S,sourceLayerIndex:T}of t){const M=this.layers[0]._featureFilter.needGeometry,A=Bi(_,M);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),A,c))continue;const z={id:v,properties:_.properties,type:_.type,sourceLayerIndex:T,index:S,geometry:M?A.geometry:fi(_,c,d),patterns:{}};g.push(z)}for(const _ of g){const{geometry:v,index:S,sourceLayerIndex:T}=_;this.addFeature(_,v,S,c,{},r.availableImages,r.brightness),r.featureIndex.insert(t[S].feature,v,S,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,r,c,d,g,_,v){}destroy(){}addFeature(t,r,c,d,g,_=[],v){for(const S of Eg(r,2)){const T=[],M=[],A=[],z=new Ae(1/0,1/0),D=new Ae(-1/0,-1/0);for(const H of S)if(H.length!==0){H!==S[0]&&A.push(M.length/2);for(let j=0;j<H.length;j++)M.push(H[j].x),M.push(H[j].y),T.push(H[j]),z.x=Math.min(z.x,H[j].x),z.y=Math.min(z.y,H[j].y),D.x=Math.max(D.x,H[j].x),D.y=Math.max(D.y,H[j].y)}const k=Af(M,A),$=new bx(T,k,8,256);this.footprints.push({vertices:T,indices:k,grid:$,min:z,max:D})}}}Vt(xA,"ClipBucket",{omit:["layers"]});const M$=Yi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),A$=Yi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),P$=Yi([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),z$=Yi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),C$=Yi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),R$=Yi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),L$=Yi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:D$}=M$,Ag=Number.MAX_SAFE_INTEGER,k$=Ag-1;function bA(a,t,r,c){return a.order<t||a.order===Ag||!(a.clipMask&r)||(function(d,g){return g.length!==0&&g.find(_=>_===d)===void 0})(c,a.clipScope)}function wx(a,t){return a.x-t.x||a.y-t.y}function wA(a,t){return wx(a.min,t.min)===0&&wx(a.max,t.max)===0}function U1(a,t){return!(a.min.x>t.max.x||a.max.x<t.min.x||a.min.y>t.max.y||a.max.y<t.min.y)}function Sx(a,t){if(a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(a[r].sourceId!==t[r].sourceId||!wA(a[r],t[r])||a[r].order!==t[r].order||a[r].clipMask!==t[r].clipMask||!Ot(a[r].clipScope,t[r].clipScope))return!1;return!0}function SA(a,t,r){const c=1/It,d=1/(1<<r.canonical.z),g=(t.x*c+r.canonical.x)*d+r.wrap,_=(t.y*c+r.canonical.y)*d;return{min:new Ae((a.x*c+r.canonical.x)*d+r.wrap,(a.y*c+r.canonical.y)*d),max:new Ae(g,_)}}function O$(a,t,r){const c=1<<r.canonical.z,d=((t.x-r.wrap)*c-r.canonical.x)*It,g=(t.y*c-r.canonical.y)*It;return{min:new Ae(((a.x-r.wrap)*c-r.canonical.x)*It,(a.y*c-r.canonical.y)*It),max:new Ae(d,g)}}function $1(a,t,r,c,d,g,_){const v=a.indices,S=a.vertices,T=[];for(let M=c;M<c+d;M+=3){const A=t[r[M+0]+g],z=t[r[M+1]+g],D=t[r[M+2]+g],k=Math.min(A.x,z.x,D.x),$=Math.max(A.x,z.x,D.x),H=Math.min(A.y,z.y,D.y),j=Math.max(A.y,z.y,D.y);T.length=0,a.grid.query(new Ae(k,H),new Ae($,j),T);for(let q=0;q<T.length;q++){const Y=T[q];if(ml(S[v[3*Y+0]],S[v[3*Y+1]],S[v[3*Y+2]],A,z,D,_))return!0}}return!1}function TA(a,t,r,c){if(!a||!r)return!1;let d=a.vertices;if(!t.canonical.equals(c.canonical)||t.wrap!==c.wrap){if(r.vertices.length<a.vertices.length)return TA(r,c,a,t);const g=t.canonical,_=c.canonical,v=Math.pow(2,_.z-g.z);d=a.vertices.map(S=>new Ae((S.x+g.x*It)*v-_.x*It,(S.y+g.y*It)*v-_.y*It))}return $1(r,d,a.indices,0,a.indices.length,0,0)}function EA(a,t,r,c){const d=Math.pow(2,c.z-r.z);return new Ae((a+r.x*It)*d-c.x*It,(t+r.y*It)*d-c.y*It)}function IA(a,t){const r=[];t.grid.queryPoint(a,r);const c=t.indices,d=t.vertices;for(let g=0;g<r.length;g++){const _=r[g];if(ws([d[c[3*_+0]],d[c[3*_+1]],d[c[3*_+2]]],a))return!0}return!1}const V1=[new Ae(0,0),new Ae(It,0),new Ae(It,It),new Ae(0,It)];function MA(a,t){const r=[];let c=[];if(!t||a.length<2)return[a];if(a.length===2)return Ga(a[0],a[1],V1)?[a]:[];for(let d=0;d<a.length+2;d++){const g=a[d%a.length],_=a[(d+1)%a.length],v=Ga(d===0?a[a.length-1]:a[(d-1)%a.length],g,V1),S=Ga(g,_,V1),T=v||S;T&&c.push(g),T&&S||c.length>0&&(c.length>1&&r.push(c),c=[])}return c.length>1&&r.push(c),r}const j1=Qi.types,F$=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],B$=["fill-extrusion-flood-light-ground-radius"],N$=Math.pow(2,13),U$=Math.pow(2,15)-1,AA=new Ae(0,1),Ac=2147483648;function Pg(a,t,r,c,d,g,_,v){a.emplaceBack((t<<1)+_,(r<<1)+g,(Math.floor(c*N$)<<1)+d,Math.round(v))}function zg(a,t,r){a.emplaceBack(t.x*It,t.y*It,r?1:0)}function Tx(a,t,r,c,d,g){a.emplaceBack(t.x,t.y,(r.x<<1)+c,(r.y<<1)+d,g)}function Cg(a,t,r){a.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class PA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class zA{constructor(){this.centroidXY=new Ae(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ae(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ae(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}}class CA{constructor(){this.acc=new Ae(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,r){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=r.x,t.min.y=t.max.y=r.y)}appendEdge(t,r,c){this.accCount++,this.acc._add(r);let d=!!this.borders;r.x<t.min.x?(t.min.x=r.x,d=!0):r.x>t.max.x&&(t.max.x=r.x,d=!0),r.y<t.min.y?(t.min.y=r.y,d=!0):r.y>t.max.y&&(t.max.y=r.y,d=!0),((r.x===0||r.x===It)&&r.x===c.x)!=((r.y===0||r.y===It)&&r.y===c.y)&&this.processBorderOverlap(r,c),d&&this.checkBorderIntersection(r,c)}checkBorderIntersection(t,r){r.x<0!=t.x<0&&this.addBorderIntersection(0,hi(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>It!=t.x>It&&this.addBorderIntersection(1,hi(r.y,t.y,(It-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,hi(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>It!=t.y>It&&this.addBorderIntersection(3,hi(r.x,t.x,(It-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];r<c[0]&&(c[0]=r),r>c[1]&&(c[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,r.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,r.x),this.addBorderIntersection(c,t.x)}}centroid(){return this.accCount===0?new Ae(0,0):new Ae(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0):0}}function RA(a,t){const r=a.add(t)._unit(),c=de(a.x*r.x+a.y*r.y,-1,1);var d,g,_;return _=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(_)))/4*U$*((d=a).x*(g=t).y-d.y*g.x<0?-1:1)}const $$=[a=>a.x<0,a=>a.x>It,a=>a.y<0,a=>a.y>It];function V$(a,t,r,c){const d=[4];if(c===0)return d;r._mult(c);const g=a.sub(r),_=t.sub(r),v=[a,t,g,_];for(let S=0;S<4;S++)for(const T of v)if($$[S](T)){d.push(S);break}return d}class G1{constructor(t){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new lg,this.indexArray=new Hr,this.programConfigurations=new L(t.layers,{zoom:t.zoom,lut:t.lut},r=>B$.includes(r)),this._segments=new er,this.hiddenByLandmarkVertexArray=new Tf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new er}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,r,c,d=!1){const g=t.length;if(g>2){let _=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let S;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const T=t[0],M=t[1];S=RA(T.sub(t[g-1])._perp()._unit(),M.sub(T)._perp()._unit())}for(let T=0;T<g;T++){const M=T===g-1?0:T+1,A=t[T],z=t[M],D=t[M===g-1?0:M+1],k=z.sub(A)._perp()._unit(),$=RA(k,D.sub(z)._perp()._unit()),H=S,j=$;if(H1(A,z,r)||d&&kA(A,r)&&kA(z,r)){S=$;continue}const q=v.vertexLength;Tx(this.vertexArray,A,z,1,1,H),Tx(this.vertexArray,A,z,1,0,H),Tx(this.vertexArray,A,z,0,1,j),Tx(this.vertexArray,A,z,0,0,j),v.vertexLength+=4;const Y=V$(A,z,k,c);for(const te of Y)this._segmentToGroundQuads[_].push({id:q,region:te}),this._segmentToRegionTriCounts[_][te]+=2,v.primitiveLength+=2;S=$}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),r=t.length;for(let c=0;c<r;c++)this._segmentToGroundQuads[c].sort((d,g)=>d.region-g.region);for(let c=0;c<r;c++){const d=this._segmentToGroundQuads[c],g=t[c],_=this._segmentToRegionTriCounts[c];_.reduce((S,T)=>S+T,0);let v=0;for(let S=0;S<=4;S++){const T=_[S];if(T!==0){let M=this.regionSegments[S];M||(M=this.regionSegments[S]=new er);const A={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+v,vertexLength:g.vertexLength,primitiveLength:T};M.get().push(A)}v+=T}for(let S=0;S<d.length;S++){const T=d[S].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,r,c,d,g,_,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,r,c,d,g,_,void 0,v)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,A$.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=t.createVertexBuffer(this.groundRadiusArray,P$.members)))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,r,c,d,g,_,v,S){this.hasData()&&this.programConfigurations.updatePaintArrays(t,r,c,d,g,_,v,S)}updateHiddenByLandmark(t){this.updateHiddenByLandmarkRange(t.groundVertexArrayOffset,t.groundVertexCount,!!(t.flags&Ac))}updateHiddenByLandmarkRange(t,r,c){if(!this.hasData())return;const d=r+t;if(r!==0){for(let g=t;g<d;++g)this.hiddenByLandmarkVertexArray.emplace(g,c?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,R$.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const r=this.regionSegments[t];r&&r.destroy()}}}}class Ex{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Hr,this.footprintVertices=new Yl,this.footprintSegments=[],this.layoutVertexArray=new pl,this.centroidVertexArray=new tx,this.wallVertexArray=new ix,this.indexArray=new Hr,this.programConfigurations=new L(t.layers,{zoom:t.zoom,lut:t.lut},r=>F$.includes(r)),this.segments=new er,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new G1(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){this.features=[],this.hasPattern=A1("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=vt(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:_,index:v,sourceLayerIndex:S}of t){const T=this.layers[0]._featureFilter.needGeometry,M=Bi(g,T);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),M,c))continue;const A={id:_,sourceLayerIndex:S,index:v,geometry:T?M.geometry:fi(g,c,d),properties:g.properties,type:g.type,patterns:{}},z=this.layoutVertexArray.length,D=j1[A.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:P1("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,r)});else if(this.wallMode)for(const k of A.geometry)for(const $ of MA(k,D))this.addFeature(g.id,A,[$],v,c,{},r.availableImages,d,r.brightness);else this.addFeature(g.id,A,A.geometry,v,c,{},r.availableImages,d,r.brightness);r.featureIndex.insert(g,A.geometry,v,S,this.index,z)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,r,c,d,g,_){for(const{featureId:v,feature:S}of this.features){const T=j1[S.type]==="Polygon",{geometry:M}=S;if(this.wallMode)for(const A of M)for(const z of MA(A,T))this.addFeature(v,S,[z],S.index,r,c,d,g,_);else this.addFeature(v,S,M,S.index,r,c,d,g,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,r,c,d,g,_,v){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,this.worldview),this.groundEffect.update(t,r,g,c,d,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,D$),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,C$.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,L$.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,z$.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,c,d,g,_,v,S,T){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,A=[new Ae(0,0),new Ae(It,It)],z=S.projection,D=z.name==="globe",k=this.wallMode||j1[r.type]==="Polygon",$=new CA;$.centroidDataIndex=this.centroidData.length;const H=new zA;H.buildingId=t,r.properties&&r.properties.hasOwnProperty("building_id")&&(H.buildingId=Number(r.properties.building_id));const j=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},g)<=0,q=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},g);let Y;if(H.height=q,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new _u),this.wallMode){if(D)return void yi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(c.length!==1)return;Y=(function(we){const Ie=we[0].x===we[we.length-1].x&&we[0].y===we[we.length-1].y;(function(Tt){let Mt=0;const ai=Tt.length;for(let Jt=0;Jt<ai;Jt++)Mt+=(Tt[(Jt+1)%ai].x-Tt[Jt].x)*(Tt[(Jt+1)%ai].y+Tt[Jt].y);return Mt>=0})(we)||(we=we.reverse());const qe={geometry:[],joinNormals:[],indices:[]},Xe=[],at=[],nt=[];let ot=we.length;for(;ot>=2&&we[ot-1].equals(we[ot-2]);)ot--;if(ot<(Ie?3:2))return qe;let Ge,ct,et,ut,lt,Bt=0;for(;Bt<ot-1&&we[Bt].equals(we[Bt+1]);)Bt++;Ie&&(Ge=we[ot-2],lt=we[Bt].sub(Ge)._unit()._perp());for(let Tt=Bt;Tt<ot;Tt++){if(et=Tt===ot-1?Ie?we[Bt+1]:void 0:we[Tt+1],et&&we[Tt].equals(et))continue;lt&&(ut=lt),Ge&&(ct=Ge),Ge=we[Tt],lt=et?et.sub(Ge)._unit()._perp():ut,ut=ut||lt;let Mt=ut.add(lt);Mt.x===0&&Mt.y===0||Mt._unit();const ai=Mt.x*lt.x+Mt.y*lt.y,Jt=ai!==0?1/ai:1/0,Ct=ut.x*lt.y-ut.y*lt.x>0;let xi="miter";const Wi=2;xi==="miter"&&Jt>Wi&&(xi="bevel"),xi==="bevel"&&(Jt>100&&(xi="flipbevel"),Jt<Wi&&(xi="miter"));const mn=(Gi,Pn,sn,wr)=>{const ln=new Ae(Gi.x,Gi.y),In=new Ae(Gi.x,Gi.y);ln.x+=Pn.x*wr,ln.y+=Pn.y*wr,In.x-=Pn.x*Math.max(sn,1),In.y-=Pn.y*Math.max(sn,1),nt.push(Pn),Xe.push(ln),at.push(In)};if(xi==="miter")Mt._mult(Jt),mn(Ge,Mt,0,0);else if(xi==="flipbevel")Mt=lt.mult(-1),mn(Ge,Mt,0,0),mn(Ge,Mt.mult(-1),0,0);else{const Gi=-Math.sqrt(Jt*Jt-1),Pn=Ct?Gi:0,sn=Ct?0:Gi;ct&&mn(Ge,ut,Pn,sn),et&&mn(Ge,lt,Pn,sn)}}qe.geometry=[...Xe,...at.reverse(),Xe[0]],qe.joinNormals=[...nt,...nt.reverse(),nt[nt.length-1]];const Ut=qe.geometry.length-1;for(let Tt=0;Tt<Ut/2;Tt++)if(Tt+1<Ut/2){let Mt=Tt,ai=Tt+1,Jt=Ut-1-Tt,Ct=Ut-2-Tt;Mt=Mt===0?Ut-1:Mt-1,ai=ai===0?Ut-1:ai-1,Jt=Jt===0?Ut-1:Jt-1,Ct=Ct===0?Ut-1:Ct-1,qe.indices.push(Jt),qe.indices.push(ai),qe.indices.push(Mt),qe.indices.push(Jt),qe.indices.push(Ct),qe.indices.push(ai)}return qe})(c[0]),c=[Y.geometry]}const te=(we,Ie)=>we<(Ie.length-1)/2||we===Ie.length-1,ue=this.wallMode?[c]:Eg(c,500);for(let we=ue.length-1;we>=0;we--){const Ie=ue[we];(Ie.length===0||G$(Ie[0]))&&ue.splice(we,1)}let ae;if(D)ae=NA(ue,A,g);else{ae=[];for(const we of ue)ae.push({polygon:we,bounds:A})}const ge=k?this.edgeRadius:0,ye=ge>0&&this.zoom<17,me=(we,Ie)=>{if(we.length===0)return!1;const Je=we[we.length-1];return Ie.x===Je.x&&Ie.y===Je.y};for(const{polygon:we,bounds:Ie}of ae){let Je=0,qe=0;for(const ot of we)k&&!ot[0].equals(ot[ot.length-1])&&ot.push(ot[0]),qe+=k?ot.length-1:ot.length;const Xe=this.segments.prepareSegment((k?5:4)*qe,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);const at={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},nt=new PA;if(nt.vertexOffset=this.footprintVertices.length,nt.indexOffset=3*this.footprintIndices.length,nt.ringIndices=[],k){const ot=[],Ge=[];Je=Xe.vertexLength;for(let et=0;et<we.length;et++){const ut=we[et];ut.length&&et!==0&&Ge.push(ot.length/2);const lt=[];let Bt,Ut;Bt=ut[1].sub(ut[0])._perp()._unit(),nt.ringIndices.push(ut.length-1);for(let Tt=1;Tt<ut.length;Tt++){const Mt=ut[Tt],ai=ut[Tt===ut.length-1?1:Tt+1],Jt=Mt.clone();if(ge){Ut=ai.sub(Mt)._perp()._unit();const Ct=Bt.add(Ut)._unit(),xi=ge*Math.min(4,1/(Bt.x*Ct.x+Bt.y*Ct.y));Jt.x+=xi*Ct.x,Jt.y+=xi*Ct.y,Jt.x=Math.round(Jt.x),Jt.y=Math.round(Jt.y),Bt=Ut}if(!j||ge!==0&&!ye||me(lt,Jt)||lt.push(Jt),Pg(this.layoutVertexArray,Jt.x,Jt.y,0,0,1,1,0),this.wallMode){const Ct=te(Tt,ut);zg(this.wallVertexArray,Y.joinNormals[Tt],!Ct)}Xe.vertexLength++,this.footprintVertices.emplaceBack(Mt.x,Mt.y),ot.push(Mt.x,Mt.y),D&&Cg(this.layoutVertexExtArray,z.projectTilePoint(Jt.x,Jt.y,g),z.upVector(g,Jt.x,Jt.y))}j&&(ge===0||ye)&&(lt.length!==0&&me(lt,lt[0])&&lt.pop(),this.groundEffect.addData(lt,Ie,M))}const ct=this.wallMode?Y.indices:Af(ot,Ge);for(let et=0;et<ct.length;et+=3)this.footprintIndices.emplaceBack(nt.vertexOffset+ct[et+0],nt.vertexOffset+ct[et+1],nt.vertexOffset+ct[et+2]),this.indexArray.emplaceBack(Je+ct[et],Je+ct[et+2],Je+ct[et+1]),Xe.primitiveLength++;nt.indexCount+=ct.length,nt.vertexCount+=this.footprintVertices.length-nt.vertexOffset}for(let ot=0;ot<we.length;ot++){const Ge=we[ot];$.startRing(H,Ge[0]);let ct=Ge.length>4&&OA(Ge[Ge.length-2],Ge[0],Ge[1]),et=ge?j$(Ge[Ge.length-2],Ge[0],Ge[1],ge):0;const ut=[];let lt,Bt,Ut;Bt=Ge[1].sub(Ge[0])._perp()._unit();let Tt=!0;for(let Mt=1,ai=0;Mt<Ge.length;Mt++){let Jt=Ge[Mt-1],Ct=Ge[Mt];const xi=Ge[Mt===Ge.length-1?1:Mt+1];if($.appendEdge(H,Ct,Jt),H1(Ct,Jt,Ie)){ge&&(Bt=xi.sub(Ct)._perp()._unit(),Tt=!Tt);continue}const Wi=Ct.sub(Jt)._perp(),mn=Wi.x/(Math.abs(Wi.x)+Math.abs(Wi.y)),Gi=Wi.y>0?1:0,Pn=Jt.dist(Ct);if(ai+Pn>32768&&(ai=0),ge){Ut=xi.sub(Ct)._perp()._unit();let In=DA(Jt,Ct,xi,LA(Bt,Ut),ge);isNaN(In)&&(In=0);const Yn=Ct.sub(Jt)._unit();Jt=Jt.add(Yn.mult(et))._round(),Ct=Ct.add(Yn.mult(-In))._round(),et=In,Bt=Ut,j&&this.zoom>=17&&(me(ut,Jt)||ut.push(Jt),me(ut,Ct)||ut.push(Ct))}const sn=Xe.vertexLength,wr=Ge.length>4&&OA(Jt,Ct,xi);let ln=FA(ai,ct,Tt);if(Pg(this.layoutVertexArray,Jt.x,Jt.y,mn,Gi,0,0,ln),Pg(this.layoutVertexArray,Jt.x,Jt.y,mn,Gi,0,1,ln),this.wallMode){const In=te(Mt-1,Ge),Yn=Y.joinNormals[Mt-1];zg(this.wallVertexArray,Yn,In),zg(this.wallVertexArray,Yn,In)}if(ai+=Pn,ln=FA(ai,wr,!Tt),ct=wr,Pg(this.layoutVertexArray,Ct.x,Ct.y,mn,Gi,0,0,ln),Pg(this.layoutVertexArray,Ct.x,Ct.y,mn,Gi,0,1,ln),this.wallMode){const In=te(Mt,Ge),Yn=Y.joinNormals[Mt];zg(this.wallVertexArray,Yn,In),zg(this.wallVertexArray,Yn,In)}if(Xe.vertexLength+=4,this.indexArray.emplaceBack(sn+0,sn+1,sn+2),this.indexArray.emplaceBack(sn+1,sn+3,sn+2),Xe.primitiveLength+=2,ge){const In=Je+(Mt===1?Ge.length-2:Mt-2),Yn=Mt===1?Je:In+1;if(this.indexArray.emplaceBack(sn+1,In,sn+3),this.indexArray.emplaceBack(In,Yn,sn+3),Xe.primitiveLength+=2,lt===void 0&&(lt=sn),!H1(xi,Ge[Mt],Ie)){const or=Mt===Ge.length-1?lt:Xe.vertexLength;this.indexArray.emplaceBack(sn+2,sn+3,or),this.indexArray.emplaceBack(sn+3,or+1,or),this.indexArray.emplaceBack(sn+3,Yn,or+1),Xe.primitiveLength+=3}Tt=!Tt}if(D){const In=this.layoutVertexExtArray,Yn=z.projectTilePoint(Jt.x,Jt.y,g),or=z.projectTilePoint(Ct.x,Ct.y,g),sr=z.upVector(g,Jt.x,Jt.y),Sr=z.upVector(g,Ct.x,Ct.y);Cg(In,Yn,sr),Cg(In,Yn,sr),Cg(In,or,Sr),Cg(In,or,Sr)}}k&&(Je+=Ge.length-1),j&&ge&&this.zoom>=17&&(ut.length!==0&&me(ut,ut[0])&&ut.pop(),this.groundEffect.addData(ut,Ie,M,ge>0))}this.footprintSegments.push(nt),at.triangleCount=this.indexArray.length-at.triangleArrayOffset,this.polygonSegments.push(at),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=$.borders?AA:this.encodeCentroid($,H),this.centroidData.push(H),$.borders){this.featuresOnBorder.push($);const we=this.featuresOnBorder.length-1;for(let Ie=0;Ie<$.borders.length;Ie++)$.borders[Ie][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ie].push(we)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,_,v,g,T,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(r,d,_,v,g,T,this.worldview),this.maxHeight=Math.max(this.maxHeight,q)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((r,c)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}splitToSubtiles(){const t=[];for(let v=0;v<this.centroidData.length;v++){const S=this.centroidData[v],T=+(S.min.y+S.max.y>It),M=2*T+(+(S.min.x+S.max.x>It)^T);for(let A=0;A<S.polygonSegLen;A++){const z=S.polygonSegIdx+A;t.push({centroidIdx:v,subtile:M,polygonSegmentIdx:z,triangleSegmentIdx:this.polygonSegments[z].triangleSegIdx})}}const r=new Hr;t.sort((v,S)=>v.triangleSegmentIdx===S.triangleSegmentIdx?v.subtile-S.subtile:v.triangleSegmentIdx-S.triangleSegmentIdx);let c=0,d=0,g=0;for(const v of t){if(v.triangleSegmentIdx!==c)break;g++}const _=t.length;for(;d!==t.length;){c=t[d].triangleSegmentIdx;let v=0,S=d,T=d;for(let M=S;M<g&&t[M].subtile===v;M++)T++;for(;S!==g;){const M=t[S];v=M.subtile;const A=this.centroidData[M.centroidIdx].min.clone(),z=this.centroidData[M.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=S;k<T;k++){const $=t[k],H=this.polygonSegments[$.polygonSegmentIdx],j=this.centroidData[$.centroidIdx].min,q=this.centroidData[$.centroidIdx].max,Y=this.indexArray.uint16;for(let te=H.triangleArrayOffset;te<H.triangleArrayOffset+H.triangleCount;te++)r.emplaceBack(Y[3*te],Y[3*te+1],Y[3*te+2]);D.primitiveLength+=H.triangleCount,A.x=Math.min(A.x,j.x),A.y=Math.min(A.y,j.y),z.x=Math.max(z.x,q.x),z.y=Math.max(z.y,q.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:A,max:z}),S=T;for(let k=S;k<g&&t[k].subtile===t[S].subtile;k++)T++}d=g;for(let M=d;M<_&&t[M].triangleSegmentIdx===t[d].triangleSegmentIdx;M++)g++}r._trim(),this.indexArray=r}getVisibleSegments(t,r,c){const d=new er;if(this.wallMode){for(const $ of this.triangleSubSegments)d.segments.push($.segment);return d}let g=0,_=0;const v=1<<t.canonical.z;if(r){const $=r.getMinMaxForTile(t);$&&(g=$.min,_=$.max)}_+=this.maxHeight;const S=t.toUnwrapped();let T;const M=[S.canonical.x/v+S.wrap,S.canonical.y/v],A=[(S.canonical.x+1)/v+S.wrap,(S.canonical.y+1)/v],z=($,H,j)=>[$[0]*(1-j[0])+H[0]*j[0],$[1]*(1-j[1])+H[1]*j[1]],D=[],k=[];for(const $ of this.triangleSubSegments){D[0]=$.min.x/It,D[1]=$.min.y/It,k[0]=$.max.x/It,k[1]=$.max.y/It;const H=z(M,A,D),j=z(M,A,k);if(new yn([H[0],H[1],g],[j[0],j[1],_]).intersectsPrecise(c)===0){T&&(d.segments.push(T),T=void 0);continue}const q=$.segment;T&&T.vertexOffset!==q.vertexOffset&&(d.segments.push(T),T=void 0),T?(T.vertexLength+=q.vertexLength,T.primitiveLength+=q.primitiveLength):T={vertexOffset:q.vertexOffset,primitiveLength:q.primitiveLength,vertexLength:q.vertexLength,primitiveOffset:q.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&d.segments.push(T),d}encodeCentroid(t,r){const c=t.centroid(),d=r.span(),g=Math.min(7,Math.round(d.x*this.tileToMeter/10)),_=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Ae(de(c.x,1,8191)<<3|g,de(c.y,1,8191)<<3|_)}encodeBorderCentroid(t){if(!t.borders)return new Ae(0,0);const r=t.borders,c=Number.MAX_VALUE;if(r[0][0]!==c||r[1][0]!==c){const d=r[0][0]!==c?0:1;return new Ae(6|(r[0][0]!==c?0:65528),(r[d][0]+r[d][1])/2<<3|6)}{const d=r[2][0]!==c?2:3;return new Ae((r[d][0]+r[d][1])/2<<3|6,6|(r[2][0]!==c?0:65528))}}showCentroid(t){const r=this.centroidData[t.centroidDataIndex];r.flags&=2147483647,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const r=t.vertexArrayOffset,c=t.vertexCount+t.vertexArrayOffset,d=t.flags&Ac?AA:t.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==d.y||g!==d.x){for(let _=r;_<c;++_)this.centroidVertexArray.emplace(_,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,r,c){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const d=r.getReplacementRegionsForTile(t.toUnwrapped());if(Sx(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const g=[];for(const _ of this.activeReplacements){if(_.order<c)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-t.canonical.z));if(_.footprint.buildingIds)for(const S of this.centroidData)S.flags&Ac||_.min.x>S.max.x||S.min.x>_.max.x||_.min.y>S.max.y||S.min.y>_.max.y||_.footprint.buildingIds.has(S.buildingId)&&(S.flags|=Ac);else for(const S of this.centroidData)if(!(S.flags&Ac||_.min.x>S.max.x||S.min.x>_.max.x||_.min.y>S.max.y||S.min.y>_.max.y))for(let T=0;T<S.footprintSegLen;T++){const M=this.footprintSegments[S.footprintSegIdx+T];if(g.length=0,H$(this.footprintVertices,M.vertexOffset,M.vertexCount,_.footprintTileId.canonical,t.canonical,g),$1(_.footprint,g,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-v)){S.flags|=Ac;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,r,c){let d=!1;for(let g=0;g<c.footprintSegLen;g++){const _=this.footprintSegments[c.footprintSegIdx+g];let v=0;for(const S of _.ringIndices){for(let T=v,M=S+v-1;T<S+v;M=T++){const A=this.footprintVertices.int16[2*(T+_.vertexOffset)+0],z=this.footprintVertices.int16[2*(T+_.vertexOffset)+1],D=this.footprintVertices.int16[2*(M+_.vertexOffset)+1];z>r!=D>r&&t<(this.footprintVertices.int16[2*(M+_.vertexOffset)+0]-A)*(r-z)/(D-z)+A&&(d=!d)}v=S}}return d}getHeightAtTileCoord(t,r){let c=Number.NEGATIVE_INFINITY,d=!0;const g=4*(t+It)*It+(r+It);if(this.partLookup.hasOwnProperty(g)){const _=this.partLookup[g];return _?{height:_.height,hidden:!!(_.flags&Ac)}:void 0}for(const _ of this.centroidData)t>_.max.x||_.min.x>t||r>_.max.y||_.min.y>r||_.height<=c||this.footprintContainsPoint(t,r,_)&&(c=_.height,this.partLookup[g]=_,d=!!(_.flags&Ac));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:d};this.partLookup[g]=void 0}}function LA(a,t){const r=a.add(t)._unit();return a.x*r.x+a.y*r.y}function j$(a,t,r,c){const d=t.sub(a)._perp()._unit(),g=r.sub(t)._perp()._unit();return DA(a,t,r,LA(d,g),c)}function DA(a,t,r,c,d){const g=Math.sqrt(1-c*c);return Math.min(a.dist(t)/3,t.dist(r)/3,d*g/c)}function H1(a,t,r){return a.x<r[0].x&&t.x<r[0].x||a.x>r[1].x&&t.x>r[1].x||a.y<r[0].y&&t.y<r[0].y||a.y>r[1].y&&t.y>r[1].y}function kA(a,t){return a.x<t[0].x||a.x>t[1].x||a.y<t[0].y||a.y>t[1].y}function G$(a){return a.every(t=>t.x<=0)||a.every(t=>t.x>=It)||a.every(t=>t.y<=0)||a.every(t=>t.y>=It)}function OA(a,t,r){if(a.x<0||a.x>=It||t.x<0||t.x>=It||r.x<0||r.x>=It)return!1;const c=r.sub(t),d=c.perp(),g=a.sub(t);return(c.x*g.x+c.y*g.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(g.x*g.x+g.y*g.y))>-.866&&d.x*g.x+d.y*g.y<0}function FA(a,t,r){const c=t?2|a:-3&a;return r?1|c:-2&c}function BA(){const a=Math.PI/32,t=Math.tan(a),r=ve;return r*Math.sqrt(1+2*t*t)-r}function NA(a,t,r){const c=1<<r.z,d=tt(r.x/c),g=tt((r.x+1)/c),_=dt(r.y/c),v=dt((r.y+1)/c);return(function(S,T,M,A,z=0,D){const k=[];if(!S.length||!M||!A)return k;const $=(ae,ge)=>{for(const ye of ae)k.push({polygon:ye,bounds:ge})},H=Math.ceil(Math.log2(M)),j=Math.ceil(Math.log2(A)),q=H-j,Y=[];for(let ae=0;ae<Math.abs(q);ae++)Y.push(q>0?0:1);for(let ae=0;ae<Math.min(H,j);ae++)Y.push(0),Y.push(1);let te=S;if(te=xx(te,T[0].y-z,T[1].y+z,1),te=xx(te,T[0].x-z,T[1].x+z,0),!te.length)return k;const ue=[];for(Y.length?ue.push({polygons:te,bounds:T,depth:0}):$(te,T);ue.length;){const ae=ue.pop(),ge=ae.depth,ye=Y[ge],me=ae.bounds[0],we=ae.bounds[1],Ie=ye===0?me.x:me.y,Je=ye===0?we.x:we.y,qe=D?D(ye,Ie,Je):.5*(Ie+Je),Xe=xx(ae.polygons,Ie-z,qe+z,ye),at=xx(ae.polygons,qe-z,Je+z,ye);if(Xe.length){const nt=[me,new Ae(ye===0?qe:we.x,ye===1?qe:we.y)];Y.length>ge+1?ue.push({polygons:Xe,bounds:nt,depth:ge+1}):$(Xe,nt)}if(at.length){const nt=[new Ae(ye===0?qe:me.x,ye===1?qe:me.y),we];Y.length>ge+1?ue.push({polygons:at,bounds:nt,depth:ge+1}):$(at,nt)}}return k})(a,t,Math.ceil((g-d)/11.25),Math.ceil((_-v)/11.25),1,(S,T,M)=>{if(S===0)return .5*(T+M);{const A=dt((r.y+T/It)/c);return(Ze(.5*(dt((r.y+M/It)/c)+A))*c-r.y)*It}})}function H$(a,t,r,c,d,g){const _=Math.pow(2,c.z-d.z);for(let v=0;v<r;v++){let S=a.int16[2*(v+t)+0],T=a.int16[2*(v+t)+1];S=(S+d.x*It)*_-c.x*It,T=(T+d.y*It)*_-c.y*It,g.push(new Ae(S,T))}}let UA,$A;Vt(Ex,"FillExtrusionBucket",{omit:["layers","features"]}),Vt(zA,"PartData"),Vt(PA,"FootprintSegment"),Vt(CA,"BorderCentroidData"),Vt(G1,"GroundEffect");class Wh extends Ae{constructor(t,r,c){super(t,r),this.z=c}}class VA extends Wh{constructor(t,r,c,d){super(t,r,c),this.w=d}}function jA(a,t,r,c){const d=r==="x"?"y":"x",g=(c-a[r])/(t[r]-a[r]);a[d]=Math.round(a[d]+(t[d]-a[d])*g),a[r]=c,a.hasOwnProperty("z")&&(a.z=hi(a.z,t.z,g)),a.hasOwnProperty("w")&&(a.w=hi(a.w,t.w,g))}function GA(a,t,r,c){const d=r,g=c;for(const _ of["x","y"]){let v=a,S=t;v[_]>=S[_]&&(v=t,S=a),v[_]<d&&S[_]>d&&jA(v,S,_,d),v[_]<g&&S[_]>g&&jA(S,v,_,g)}}function Ix(a,t,r,c,d,g){const _=[];for(let v=0;v<a.length;v++){const S=a[v];let T;const M=_.length;let A=0;for(let z=0;z<S.length-1;z++){let D=S[z],k=S[z+1],$=0;const H=A;let j,q;g&&($=Math.hypot(k.x-D.x,k.y-D.y),A+=$,j=D,q=k),D.x<t&&k.x<t||(D.x<t?D=new Ae(t,D.y+(t-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x<t&&(k=new Ae(t,D.y+(t-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y<r&&k.y<r||(D.y<r?D=new Ae(D.x+(r-D.y)/(k.y-D.y)*(k.x-D.x),r)._round():k.y<r&&(k=new Ae(D.x+(r-D.y)/(k.y-D.y)*(k.x-D.x),r)._round()),D.x>=c&&k.x>=c||(D.x>=c?D=new Ae(c,D.y+(c-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x>=c&&(k=new Ae(c,D.y+(c-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y>=d&&k.y>=d||(D.y>=d?D=new Ae(D.x+(d-D.y)/(k.y-D.y)*(k.x-D.x),d)._round():k.y>=d&&(k=new Ae(D.x+(d-D.y)/(k.y-D.y)*(k.x-D.x),d)._round()),T&&D.equals(T[T.length-1])||(T=[D],_.push(T),g&&g.push({progress:{min:H+HA(j,q,D)*$,max:1},parentIndex:v,prevPoint:j,nextPoint:q})),T.push(k),g&&(g[g.length-1].progress.max=H+HA(j,q,k)*$,g[g.length-1].nextPoint=q)))))}if(g&&A>0)for(let z=M;z<_.length;z++)g[z].progress.min/=A,g[z].progress.max/=A}return _}function Z$(a,t,r,c,d){if(a.length<2)return void c.push(a);const g=[];for(;t.valid();){const[T,M]=t.get();for(let A=0;A<a.length-1;A++){const z=a[A],D=a[A+1],k=Gh(z,D,T,M);if(k){const[$]=k,H=new Ae(hi(z.x,D.x,$),hi(z.y,D.y,$));g.push({t:A+$,distance:0,point:H})}}t.next()}if(g.length===0)return void c.push(a);g.sort((T,M)=>T.t-M.t);let _=0,v=0,S=[];for(c.push(S);_!==a.length;){if(v===g.length){for(;_!==a.length;)S.length!==0&&S[S.length-1].equals(a[_])||S.push(a[_]),_++;break}g[v].t<=_?(S.length!==0&&S[S.length-1].equals(g[v].point)||S.push(g[v].point),Math.trunc(g[v].t),v++):(S.length!==0&&S[S.length-1].equals(a[_])||S.push(a[_]),_++)}}function HA(a,t,r){return a.x!==t.x?(r.x-a.x)/(t.x-a.x):a.y!==t.y?(r.y-a.y)/(t.y-a.y):0}function Rg(a,t){return a.x*t.x+a.y*t.y}function ZA(a,t){if(a.length===1){let r=0;const c=t[r++];let d;for(;!d||c.equals(d);)if(d=t[r++],!d)return 1/0;for(;r<t.length;r++){const g=t[r],_=a[0],v=d.sub(c),S=g.sub(c),T=_.sub(c),M=Rg(v,v),A=Rg(v,S),z=Rg(S,S),D=Rg(T,v),k=Rg(T,S),$=M*z-A*A,H=(z*D-A*k)/$,j=(M*k-A*D)/$,q=c.z*(1-H-j)+d.z*H+g.z*j;if(isFinite(q))return q}return 1/0}{let r=1/0;for(const c of t)r=Math.min(r,c.z);return r}}function WA(a,t,r){let c=1/0;Gn(r,t)&&(c=ZA(r,t[0]));for(let d=0;d<t.length;d++){const g=t[d],_=a[d];for(let v=0;v<g.length-1;v++){const S=g[v],T=[S,g[v+1],_[v+1],_[v],S];rr(r,T)&&(c=Math.min(c,ZA(r,T)))}}return c!==1/0&&c}function qA(a,t,r,c,d,g,_,v,S,T,M){return a.projection.name==="globe"?(function(A,z,D,k,$,H,j,q,Y,te,ue){const ae=[],ge=[],ye=A.projection.upVectorScale(ue,A.center.lat,A.worldSize).metersToTile,me=[0,0,0,1],we=[0,0,0,1],Ie=(qe,Xe,at,nt)=>{qe[0]=Xe,qe[1]=at,qe[2]=nt,qe[3]=1},Je=BA();D>0&&(D+=Je),k+=Je;for(const qe of z){const Xe=[],at=[];for(const nt of qe){const ot=nt.x+$.x,Ge=nt.y+$.y,ct=A.projection.projectTilePoint(ot,Ge,ue),et=A.projection.upVector(ue,nt.x,nt.y);let ut=D,lt=k;if(j){const Bt=XA(ot,Ge,D,k,j,q,Y,te);ut+=Bt.base,lt+=Bt.top}D!==0?Ie(me,ct.x+et[0]*ye*ut,ct.y+et[1]*ye*ut,ct.z+et[2]*ye*ut):Ie(me,ct.x,ct.y,ct.z),Ie(we,ct.x+et[0]*ye*lt,ct.y+et[1]*ye*lt,ct.z+et[2]*ye*lt),Wt(me,me,H),Wt(we,we,H),Xe.push(new Wh(me[0],me[1],me[2])),at.push(new Wh(we[0],we[1],we[2]))}ae.push(Xe),ge.push(at)}return[ae,ge]})(a,t,r,c,d,g,_,v,S,T,M):_?(function(A,z,D,k,$,H,j,q,Y){const te=[],ue=[],ae=[0,0,0,1];for(const ge of A){const ye=[],me=[];for(const we of ge){const Ie=we.x+k.x,Je=we.y+k.y,qe=XA(Ie,Je,z,D,H,j,q,Y);ae[0]=Ie,ae[1]=Je,ae[2]=qe.base,ae[3]=1,Yt(ae,ae,$),ae[3]=Math.max(ae[3],1e-5);const Xe=new Wh(ae[0]/ae[3],ae[1]/ae[3],ae[2]/ae[3]);ae[0]=Ie,ae[1]=Je,ae[2]=qe.top,ae[3]=1,Yt(ae,ae,$),ae[3]=Math.max(ae[3],1e-5);const at=new Wh(ae[0]/ae[3],ae[1]/ae[3],ae[2]/ae[3]);ye.push(Xe),me.push(at)}te.push(ye),ue.push(me)}return[te,ue]})(t,r,c,d,g,_,v,S,T):(function(A,z,D,k,$){const H=[],j=[],q=$[8]*z,Y=$[9]*z,te=$[10]*z,ue=$[11]*z,ae=$[8]*D,ge=$[9]*D,ye=$[10]*D,me=$[11]*D;for(const we of A){const Ie=[],Je=[];for(const qe of we){const Xe=qe.x+k.x,at=qe.y+k.y,nt=$[0]*Xe+$[4]*at+$[12],ot=$[1]*Xe+$[5]*at+$[13],Ge=$[2]*Xe+$[6]*at+$[14],ct=$[3]*Xe+$[7]*at+$[15],et=nt+q,ut=ot+Y,lt=Ge+te,Bt=Math.max(ct+ue,1e-5),Ut=nt+ae,Tt=ot+ge,Mt=Ge+ye,ai=Math.max(ct+me,1e-5);Ie.push(new Wh(et/Bt,ut/Bt,lt/Bt)),Je.push(new Wh(Ut/ai,Tt/ai,Mt/ai))}H.push(Ie),j.push(Je)}return[H,j]})(t,r,c,d,g)}function XA(a,t,r,c,d,g,_,v){const S=_*d.getElevationAt(a,t,!0,!0),T=g[0]!==0,M=T?g[1]===0?_*(g[0]/7-450):_*(function(A,z,D){const k=Math.floor(z[0]/8),$=Math.floor(z[1]/8),H=10*(z[0]-8*k),j=10*(z[1]-8*$),q=A.getElevationAt(k,$,!0,!0),Y=A.getMeterToDEM(D),te=Math.floor(.5*(H*Y-1)),ue=Math.floor(.5*(j*Y-1)),ae=A.tileCoordToPixel(k,$),ge=2*te+1,ye=2*ue+1,me=(function(at,nt,ot,Ge,ct){return[at.getElevationAtPixel(nt,ot,!0),at.getElevationAtPixel(nt+ct,ot,!0),at.getElevationAtPixel(nt,ot+ct,!0),at.getElevationAtPixel(nt+Ge,ot+ct,!0)]})(A,ae.x-te,ae.y-ue,ge,ye),we=Math.abs(me[0]-me[1]),Ie=Math.abs(me[2]-me[3]),Je=Math.abs(me[0]-me[2])+Math.abs(me[1]-me[3]),qe=Math.min(.25,.5*Y*(we+Ie)/ge),Xe=Math.min(.25,.5*Y*Je/ye);return q+Math.max(qe*H,Xe*j)})(d,g,v):S;return{base:S+(r===0?-1:r),top:T?Math.max(M+c,S+r+2):S+c}}class W${constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class q${constructor(){this.tasks={},this.taskQueue=[],Ft(["process"],this),this.invoker=new W$(this.process),this.nextId=0}add(t,r){const c=this.nextId++,d=(function({type:g,isSymbolTile:_,zoom:v}){return v=v||0,g==="message"?0:g!=="maybePrepare"||_?g!=="parseTile"||_?g==="parseTile"&&_?300-v:g==="maybePrepare"&&_?400-v:500:200-v:100-v})(r);if(d===0){try{t()}finally{}return null}return this.tasks[c]={fn:t,metadata:r,priority:d,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<r&&(r=g.priority,t=d)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class JA{constructor(t,r,c){this.target=t,this.parent=r,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Ft(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new q$}send(t,r,c,d,g=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=_,this.callbacks[v]=c);const S=new Set;return this.target.postMessage({id:v,type:t,hasCallback:!!c,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:ma(r,S)},S),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(t){const r=t.data;if(!r)return;const c=r.id;if(c&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const d=this.cancelCallbacks[c];delete this.cancelCallbacks[c],d&&d.cancel()}else if(r.mustQueue||xr(self)){const d=this.callbacks[c],g=this.scheduler.add(()=>this.processTask(c,r),d&&d.metadata||{type:"message"});g&&(this.cancelCallbacks[c]=g)}else this.processTask(c,r)}processTask(t,r){if(delete this.cancelCallbacks[t],r.type==="<response>"){const c=this.callbacks[t];delete this.callbacks[t],c&&(r.error?c(dl(r.error)):c(null,dl(r.data)))}else{const c=new Set,d=r.hasCallback?(_,v)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:_?ma(_):null,data:ma(v,c)},c)}:()=>{},g=dl(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,g,d);else if(this.parent.getWorkerSource){const _=r.type.split("."),{source:v,scope:S}=g;this.parent.getWorkerSource(r.sourceMapId,_[0],v,S)[_[1]](g,d)}else d(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Lg={workerUrl:"",workerClass:null,workerParams:void 0};function X$(a){return Lg.workerClass!=null?new Lg.workerClass:new self.Worker(Lg.workerUrl,Object.assign({name:a},Lg.workerParams))}const Z1="mapboxgl_preloaded_worker_pool";class qh{constructor(t){this.active={},this.name=t}acquire(t,r=qh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;){const c=X$(`${this.name||""}WorkerPool: ${t}-${this.workers.length}`);this.workers.push(c)}return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Z1]}numActive(){return Object.keys(this.active).length}}qh.workerCount=2;class Rf{constructor(t,r,c="Worker",d=qh.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=gt();const g=this.workerPool.acquire(this.id,d);for(let _=0;_<g.length;_++){const v=new Rf.Actor(g[_],r,this.id);v.name=`${c} ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,r,c){Pe(this.actors,(d,g)=>{d.send(t,r,g)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Dg,W1;function Mx(){return Dg||(Dg=new qh),Dg}Rf.Actor=JA;const q1=4096;class J${constructor(t){this.module=t,this.memoryStack=this.module.malloc(q1),this.memoryStackNextFree=this.memoryStack}createIntArray(t){const r=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>q1?-1:(new Int32Array(this.module.heap32.buffer,r,t.length).set(t),r)}createFloatArray(t){const r=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>q1?-1:(new Float32Array(this.module.heapF32.buffer,r,t.length).set(t),r)}readStringBuffer(t){let r="";for(;this.module.heapU8[t]!==0;)r+=String.fromCharCode(this.module.heapU8[t]),++t;return r}setStyle(t){const r=t.normalScale;this.module.setStyle(r[0],r[1],r[2],t.tileToMeters)}setAOOptions(t,r){this.module.setAOOptions(t?1:0,r)}setMetricOptions(t,r){this.module.setMetricOptions(t?1:0,r)}setStructuralOptions(t){this.module.setStructuralOptions(t?1:0)}setFacadeOptions(t,r){this.module.setFacadeOptions(t,r?1:0)}setFauxFacadeOptions(t,r,c){this.module.setFauxFacadeOptions(t?1:0,r?1:0,c)}setFacadeClassifierOptions(t){this.module.setFacadeClassifierOptions(t)}generateMesh(t,r){this.memoryStackNextFree=this.memoryStack;for(const v of t){const S=this.createIntArray(v.ringIndices),T=this.createFloatArray(v.coordinates);if(S===-1||T===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,v.roofType,T,S,v.ringIndices.length-1)}for(const v of r){let S;S=v.entrances?JSON.parse(v.entrances):[];const T=this.createFloatArray(S),M=this.createFloatArray(v.coordinates);if(T===-1||M===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,T,S.length,M,v.coordinates.length)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const c=this.module.getMeshCount(),d=new Array(c);for(let v=0;v<c;v++){const S=this.module.getPositionsPtr(v),T=this.module.getPositionsLength(v),M=new Float32Array(this.module.heapF32.buffer,S,T),A=this.module.getNormalsPtr(v),z=this.module.getNormalsLength(v),D=new Float32Array(this.module.heapF32.buffer,A,z),k=this.module.getAOPtr(v),$=this.module.getAOLength(v),H=new Float32Array(this.module.heapF32.buffer,k,$),j=this.module.getUVPtr(v),q=this.module.getUVLength(v),Y=new Float32Array(this.module.heapF32.buffer,j,q),te=this.module.getFauxFacadePtr(v),ue=this.module.getFauxFacadeLength(v),ae=new Uint8Array(this.module.heapU8.buffer,te,ue),ge=this.module.getIndicesPtr(v),ye=this.module.getIndicesLength(v),me=new Int16Array(this.module.heap16.buffer,ge,ye),we=this.module.getBuildingPart(v);d[v]={positions:M,normals:D,ao:H,uv:Y,isFauxFacade:ae,indices:me,buildingPart:we}}const g=this.module.getRingCount(),_=[];for(let v=0;v<g;v++){const S=this.module.getRingPtr(v),T=this.module.getRingLength(v),M=new Float32Array(this.module.heapF32.buffer,S,T);_.push(M)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let kg,X1,gl,Lf,J1,Df=null,kf=null,YA=null,Ax=null;function KA(){return xr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:X1||jr.DRACO_URL}function QA(){if(xr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Lf)return Lf;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Lf=WebAssembly.validate(a)?jr.MESHOPT_SIMD_URL:jr.MESHOPT_URL,Lf}function Y$(){return Ax}const eP=5120,tP=5121,iP=5122,nP=5123,rP=5125,oP=5126,Px={[eP]:Int8Array,[tP]:Uint8Array,[iP]:Int16Array,[nP]:Uint16Array,[rP]:Uint32Array,[oP]:Float32Array},K$={[eP]:"DT_INT8",[tP]:"DT_UINT8",[iP]:"DT_INT16",[nP]:"DT_UINT16",[rP]:"DT_UINT32",[oP]:"DT_FLOAT32"},Og={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function sP(a,t,r){const c=r.json.bufferViews.length,d=r.buffers.length;t.bufferView=c,r.json.bufferViews[c]={buffer:d,byteLength:a.byteLength},r.buffers[d]=a}const Y1="KHR_draco_mesh_compression";function Q$(a,t){const r=a.extensions&&a.extensions[Y1];if(!r)return;const c=new gl.Decoder,d=uP(t,r.bufferView),g=new gl.Mesh;if(!c.DecodeArrayToMesh(d,d.byteLength,g))throw new Error("Failed to decode Draco mesh");const _=t.json.accessors[a.indices],v=Px[_.componentType],S=_.count*v.BYTES_PER_ELEMENT,T=gl._malloc(S);v===Uint16Array?c.GetTrianglesUInt16Array(g,S,T):c.GetTrianglesUInt32Array(g,S,T),sP(gl.memory.buffer.slice(T,T+S),_,t),gl._free(T);for(const M of Object.keys(r.attributes)){const A=c.GetAttributeByUniqueId(g,r.attributes[M]),z=t.json.accessors[a.attributes[M]],D=K$[z.componentType],k=z.count*Og[z.type]*Px[z.componentType].BYTES_PER_ELEMENT,$=gl._malloc(k);c.GetAttributeDataArrayForAllPoints(g,A,gl[D],k,$),sP(gl.memory.buffer.slice($,$+k),z,t),gl._free($)}c.destroy(),g.destroy(),delete a.extensions[Y1]}const zx="EXT_meshopt_compression";function e5(a,t){if(!a.extensions||!a.extensions[zx])return;const r=a.extensions[zx],c=new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),d=new Uint8Array(r.count*r.byteStride);J1.decodeGltfBuffer(d,r.count,r.byteStride,c,r.mode,r.filter),a.buffer=t.buffers.length,a.byteOffset=0,t.buffers[a.buffer]=d.buffer,delete a.extensions[zx]}const aP=1179937895,lP=new TextDecoder("utf8");function cP(a,t){return new URL(a,t).href}function t5(a,t,r,c){return fetch(cP(a.uri,c)).then(d=>d.arrayBuffer()).then(d=>{t.buffers[r]=d})}function uP(a,t){const r=a.json.bufferViews[t];return new Uint8Array(a.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function i5(a,t,r,c){if(a.uri){const d=cP(a.uri,c);return fetch(d).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{t.images[r]=g})}if(a.bufferView!==void 0){const d=uP(t,a.bufferView),g=new Blob([d],{type:a.mimeType});return createImageBitmap(g).then(_=>{t.images[r]=_})}}function hP(a,t=0,r){const c={json:null,images:[],buffers:[]};if(new Uint32Array(a,t,1)[0]===aP){const M=new Uint32Array(a,t);let A=2;const z=(M[A++]>>2)-3,D=M[A++]>>2;if(A++,c.json=JSON.parse(lP.decode(M.subarray(A,A+D))),A+=D,A<z){const k=M[A++];A++;const $=t+(A<<2);c.buffers[0]=a.slice($,$+k)}}else c.json=JSON.parse(lP.decode(new Uint8Array(a,t)));const{buffers:d,images:g,meshes:_,extensionsUsed:v,bufferViews:S}=c.json;let T=Promise.resolve();if(d){const M=[];for(let A=0;A<d.length;A++){const z=d[A];z.uri?M.push(t5(z,c,A,r)):c.buffers[A]||(c.buffers[A]=null)}T=Promise.all(M)}return T.then(()=>{const M=[],A=v&&v.includes(Y1),z=v&&v.includes(zx);if(A&&M.push((function(){if(!gl)return kg??(kg=(function(D){let k,$=null;function H(){k=new Uint8Array($.buffer)}function j(){throw new Error("Unexpected Draco error.")}const q={a:{a:j,d:function(Y,te,ue){return k.copyWithin(Y,te,te+ue)},c:function(Y){const te=k.length,ue=Math.max(Y>>>0,Math.ceil(1.2*te)),ae=Math.ceil((ue-te)/65536);try{return $.grow(ae),H(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,q):D.then(Y=>Y.arrayBuffer()).then(Y=>WebAssembly.instantiate(Y,q))).then(Y=>{const{Rb:te,Qb:ue,P:ae,T:ge,X:ye,Ja:me,La:we,Qa:Ie,Va:Je,Wa:qe,eb:Xe,jb:at,f:nt,e:ot,yb:Ge,zb:ct,Ab:et,Bb:ut,Db:lt,Gb:Bt}=Y.instance.exports;$=ot;const Ut=(()=>{let Tt=0,Mt=0,ai=0,Jt=0;return Ct=>{ai&&(te(Jt),te(Tt),Mt+=ai,ai=Tt=0),Tt||(Mt+=128,Tt=ue(Mt));const xi=Ct.length+7&-8;let Wi=Tt;xi>=Mt&&(ai=xi,Wi=Jt=ue(xi));for(let mn=0;mn<Ct.length;mn++)k[Wi+mn]=Ct[mn];return Wi}})();return H(),nt(),{memory:ot,_free:te,_malloc:ue,Mesh:class{constructor(){this.ptr=ae()}destroy(){ge(this.ptr)}},Decoder:class{constructor(){this.ptr=me()}destroy(){at(this.ptr)}DecodeArrayToMesh(Tt,Mt,ai){const Jt=Ut(Tt),Ct=we(this.ptr,Jt,Mt,ai.ptr);return!!ye(Ct)}GetAttributeByUniqueId(Tt,Mt){return{ptr:Ie(this.ptr,Tt.ptr,Mt)}}GetTrianglesUInt16Array(Tt,Mt,ai){Je(this.ptr,Tt.ptr,Mt,ai)}GetTrianglesUInt32Array(Tt,Mt,ai){qe(this.ptr,Tt.ptr,Mt,ai)}GetAttributeDataArrayForAllPoints(Tt,Mt,ai,Jt,Ct){Xe(this.ptr,Tt.ptr,Mt.ptr,ai,Jt,Ct)}},DT_INT8:Ge(),DT_UINT8:ct(),DT_INT16:et(),DT_UINT16:ut(),DT_UINT32:lt(),DT_FLOAT32:Bt()}})})(fetch(KA())),kg.then(D=>{gl=D,kg=void 0}))})()),z&&M.push((function(){if(J1)return;const D=(function(k){let $;const H=WebAssembly.instantiateStreaming(k,{}).then(Y=>{$=Y.instance,$.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(Y,te,ue,ae,ge,ye){(function(me,we,Ie,Je,qe,Xe,at){const nt=me.exports.sbrk,ot=Je+3&-4,Ge=nt(ot*qe),ct=nt(Xe.length),et=new Uint8Array(me.exports.memory.buffer);et.set(Xe,ct);const ut=we(Ge,Je,qe,ct,Xe.length);if(ut===0&&at&&at(Ge,ot,qe),Ie.set(et.subarray(Ge,Ge+Je*qe)),nt(Ge-nt(0)),ut!==0)throw new Error(`Malformed buffer data: ${ut}`)})($,$.exports[q[ge]],Y,te,ue,ae,$.exports[j[ye]])}}})(fetch(QA()));return D.ready.then(()=>{J1=D})})()),g)for(let D=0;D<g.length;D++)M.push(i5(g[D],c,D,r));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(A&&_)for(const{primitives:D}of _)for(const k of D)Q$(k,c);if(z&&_&&S)for(const D of S)e5(D,c);return c})})}function dP(a){return fetch(a).then(t=>t.arrayBuffer()).then(t=>hP(t,0,a))}function K1(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Q1(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class eS{constructor(t,r,c,d){this.context=t,this.format=c,this.useMipmap=d&&d.useMipmap,this.texture=t.gl.createTexture(),this.update(r,{premultiply:d&&d.premultiply})}update(t,r){const c=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,d=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:g}=this,{gl:_}=g,{x:v,y:S}=r&&r.position?r.position:{x:0,y:0},T=v+c,M=S+d;!this.size||this.size[0]===T&&this.size[1]===M||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!r||r.premultiply!==!1));const A=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&T>0&&M>0){const z=this.useMipmap?Math.floor(Math.log2(Math.max(T,M)))+1:1;_.texStorage2D(_.TEXTURE_2D,z,this.format,T,M),this.size=[T,M]}this.size&&(A?_.texSubImage2D(_.TEXTURE_2D,0,v,S,K1(this.format),Q1(this.format),t):"data"in t&&t.data&&_.texSubImage2D(_.TEXTURE_2D,0,v,S,c,d,K1(this.format),Q1(this.format),t.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(t,r,c=!1){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),t!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!c?t===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),r!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(t,r,c,d,g){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),r!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,r),this.magFilter=r),t!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?t===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),c!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,c),this.wrapS=c),d!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,d),this.wrapT=d),g!==this.compareMode&&(g?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,g)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=g)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Fg{constructor(t,r){this.context=t,this.texture=r}bind(t,r){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),t!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,t),this.minFilter=t),r!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrapS=r)}}const n5=Yi([{name:"a_pos_3f",components:3,type:"Float32"}]),r5=Yi([{name:"a_color_3f",components:3,type:"Float32"}]),o5=Yi([{name:"a_color_4f",components:4,type:"Float32"}]),s5=Yi([{name:"a_uv_2f",components:2,type:"Float32"}]),a5=Yi([{name:"a_normal_3f",components:3,type:"Float32"}]),l5=Yi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),c5=Yi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function fP(a,t){const r=Cx(a.projection,a.zoom,a.width,a.height),c=(function(g,_,v,S,T){const M=new he(v.lng-180*Iu,v.lat),A=new he(v.lng+180*Iu,v.lat),z=g.project(M.lng,M.lat),D=g.project(A.lng,A.lat),k=-Math.atan2(D.y-z.y,D.x-z.x),$=At.fromLngLat(v);$.y=de($.y,-1+Iu,1-Iu);const H=$.toLngLat(),j=g.project(H.lng,H.lat),q=At.fromLngLat(H);q.x+=Iu;const Y=q.toLngLat(),te=g.project(Y.lng,Y.lat),ue=mP(te.x-j.x,te.y-j.y,k),ae=At.fromLngLat(H);ae.y+=Iu;const ge=ae.toLngLat(),ye=g.project(ge.lng,ge.lat),me=mP(ye.x-j.x,ye.y-j.y,k),we=Math.abs(ue.x)/Math.abs(me.y),Ie=fe([]);Ye(Ie,Ie,-k*(1-(T?0:S)));const Je=fe([]);return Ve(Je,Je,[1,1-(1-we)*S,1]),Je[4]=-me.x/me.y*S,Ye(Je,Je,k),ie(Je,Ie,Je),Je})(a.projection,0,a.center,r,t),d=pP(a);return Ve(c,c,[d,d,1]),c}function pP(a){const t=a.projection,r=Cx(a.projection,a.zoom,a.width,a.height),c=tS(t,a.center),d=tS(t,he.convert(t.center));return Math.pow(2,c*r+(1-r)*d)}function Cx(a,t,r,c,d=1/0){const g=a.range;if(!g)return 0;const _=Math.min(d,Math.max(r,c)),v=Math.log2(_/1024);return Me(g[0]+v,g[1]+v,t)}const Iu=1/4e4;function tS(a,t){const r=de(t.lat,-85.051129,Te),c=new he(t.lng-180*Iu,r),d=new he(t.lng+180*Iu,r),g=a.project(c.lng,r),_=a.project(d.lng,r),v=At.fromLngLat(c),S=At.fromLngLat(d),T=_.x-g.x,M=_.y-g.y,A=S.x-v.x,z=S.y-v.y,D=Math.sqrt((A*A+z*z)/(T*T+M*M));return Math.log2(D)}function mP(a,t,r){const c=Math.cos(r),d=Math.sin(r);return{x:a*c-t*d,y:a*d+t*c}}function gP(a,t,r){fe(a),Ye(a,a,ti(t[2])),Ne(a,a,ti(t[0])),Re(a,a,ti(t[1])),Ve(a,a,r),ie(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Rx(a,t,r,c,d,g,_,v){const S=[r[0]-t[0],r[1]-t[1],0],T=[c[0]-t[0],c[1]-t[1],0];if(_t(S)<1e-12||_t(T)<1e-12)return qi(a);const M=hn([],S,T);Li(M,M),pi(T,c,t),S[2]=(g-d)*v,T[2]=(_-d)*v;const A=S;return hn(A,S,T),Li(A,A),Ks(a,M,A)}function Lx(a,t,r=!1){const c=wu(t.zoom),d=(function(g,_,v){const S=_.worldSize,T=[g[12],g[13],g[14]],M=dt(T[1]/S),A=tt(T[0]/S),z=fe([]),D=je(1,M)*S,k=je(1,0)*S*We(M,_.zoom),$=1/S1(S);let H=k*$;if(v){const te=Cx(_.projection,_.zoom,_.width,_.height,1024);H=$*_.projection.pixelSpaceConversion(_.center.lat,S,te)}const j=_e(M,A);Qt(j,j,bi([],Li([],j),D*H*T[2]));const q=(function(te){const ue=[te[0],te[1],te[2]];let ae=[0,1,0];const ge=hn([],ae,ue);return hn(ae,ue,ge),mr(ae)===0&&(ae=[0,1,0],hn(ge,ue,ae)),Li(ge,ge),Li(ae,ae),Li(ue,ue),[ge[0],ge[1],ge[2],0,ae[0],ae[1],ae[2],0,ue[0],ue[1],ue[2],0,te[0],te[1],te[2],1]})(j);Ve(z,z,[H,H,H*D]),it(z,z,[-T[0],-T[1],-T[2]]);const Y=ie([],_.globeMatrix,q);return ie(Y,Y,z),ie(Y,Y,g),Y})(a,t,r);if(c>0){const g=(function(_,v){const S=v.worldSize,T=je(1,0)*S*We(v.center.lat,v.zoom)/S1(S),M=je(1,v.center.lat)*S,A=fe([]);Re(A,A,ti(v.center.lng)),Ne(A,A,ti(v.center.lat)),it(A,A,[0,0,X]),Ve(A,A,[T,T,T*M]);const z=v.point;return it(A,A,[-z.x,-z.y,0]),ie(A,A,_),ie(A,v.globeMatrix,A)})(a,t);return(function(_,v,S){const T=(k,$,H)=>{const j=_t(k),q=_t($),Y=Ic(k,$,H);return bi(Y,Y,1/_t(Y)*hi(j,q,H))},M=T([_[0],_[1],_[2]],[v[0],v[1],v[2]],S),A=T([_[4],_[5],_[6]],[v[4],v[5],v[6]],S),z=T([_[8],_[9],_[10]],[v[8],v[9],v[10]],S),D=Ic([_[12],_[13],_[14]],[v[12],v[13],v[14]],S);return[M[0],M[1],M[2],0,A[0],A[1],A[2],0,z[0],z[1],z[2],0,D[0],D[1],D[2],1]})(d,g,c)}return d}function iS(a,t,r,c){const d=yn.projectAabbCorners(c,r);let g=Number.MAX_VALUE;for(let v=0;v<d.length;++v){const S=d[v];S[0]=(.5*S[0]+.5)*t.width,S[1]=(.5-.5*S[1])*t.height,S[2]<g&&(g=S[2])}const _=(function(v){const S=[];let T=0;for(let D=1;D<v.length;D++)(v[D][0]<v[T][0]||v[D][0]===v[T][0]&&v[D][1]<v[T][1])&&(T=D);let M,A=T;const z=new Uint8Array(v.length);do{if(z[A])break;S.push(new Ae(v[A][0],v[A][1])),z[A]=1,M=(A+1)%v.length;for(let D=0;D<v.length;D++){if(v[D][0]===v[M][0]&&v[D][1]===v[M][1]||v[D][0]===v[A][0]&&v[D][1]===v[A][1])continue;const k=[v[D][0]-v[A][0],v[D][1]-v[A][1]],$=[v[M][0]-v[A][0],v[M][1]-v[A][1]],H=k[0]*$[1]-k[1]*$[0];(H>0||H===0&&k[0]*$[0]+k[1]*$[1]>=0&&k[0]*k[0]+k[1]*k[1]>$[0]*$[0]+$[1]*$[1])&&(M=D)}A=M}while(A!==T);return S.length>0&&S.push(S[0]),S})(d);if(rr(a,_))return g}const Xh=64,Of={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Dx(a,t,r,c,d,g,_,v,S,T=!1){const M=r.zoom,A=r.project(c),z=We(c.lat,M),D=1/z;fe(a),it(a,a,[A.x+_[0]*D,A.y+_[1]*D,_[2]]);let k=1,$=1;const H=r.worldSize;if(T){if(r.projection.name==="mercator"){let te=0;r.elevation&&(te=r.elevation.getAtPointOrZero(new At(A.x/H,A.y/H),0));const ue=Yt([],[A.x,A.y,te,1],r.projMatrix)[3]/r.cameraToCenterDistance;k=ue,$=ue*We(r.center.lat,M)}else if(r.projection.name==="globe"){const te=Lx(a,r),ue=[0,0,0,1];Yt(ue,ue,ie([],r.projMatrix,te));const ae=ue[3]/r.cameraToCenterDistance,ge=wu(M),ye=r.projection.pixelsPerMeter(c.lat,H)*We(c.lat,M),me=r.projection.pixelsPerMeter(r.center.lat,H)*We(r.center.lat,M);k=ae/hi(ye,Ke(r.center.lat),ge),$=ae*z/ye,k*=me,$*=me}}else k=D;Ve(a,a,[k,k,$]);const j=[...a],q=t.orientation,Y=[];if(gP(Y,[q[0]+(d?d[0]:0),q[1]+(d?d[1]:0),q[2]+(d?d[2]:0)],g),ie(a,j,Y),v&&r.elevation){let te=0;const ue=[];if(S&&r.elevation){te=(function(ge,ye,me,we,Ie){const Je=ye.elevation;if(!Je)return 0;const qe=yn.projectAabbCorners(me,we),Xe=je(1,Ie.lat)*ye.worldSize,at=(function(Mt,ai){const Jt=[0,0,1],Ct=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const xi of Ct){const Wi=Mt[xi.corners[0]],mn=Mt[xi.corners[1]],Gi=Mt[xi.corners[2]],Pn=[mn[0]-Wi[0],mn[1]-Wi[1],ai*(mn[2]-Wi[2])],sn=hn(Pn,Pn,[Gi[0]-Wi[0],Gi[1]-Wi[1],ai*(Gi[2]-Wi[2])]);Li(sn,sn),xi.dotProductWithUp=Ei(sn,Jt)}return Ct.sort((xi,Wi)=>xi.dotProductWithUp-Wi.dotProductWithUp),Ct[0].corners})(qe,Xe),nt=qe[at[0]],ot=qe[at[1]],Ge=qe[at[2]],ct=qe[at[3]],et=Je.getAtPointOrZero(new At(nt[0]/ye.worldSize,nt[1]/ye.worldSize),0),ut=Je.getAtPointOrZero(new At(ot[0]/ye.worldSize,ot[1]/ye.worldSize),0),lt=Je.getAtPointOrZero(new At(Ge[0]/ye.worldSize,Ge[1]/ye.worldSize),0),Bt=Je.getAtPointOrZero(new At(ct[0]/ye.worldSize,ct[1]/ye.worldSize),0),Ut=(et+Bt)/2,Tt=(ut+lt)/2;return Ut>Tt?ut<lt?Rx(ge,ot,ct,nt,ut,Bt,et,Xe):Rx(ge,Ge,nt,ct,lt,et,Bt,Xe):et<Bt?Rx(ge,nt,ot,Ge,et,ut,lt,Xe):Rx(ge,ct,Ge,ot,Bt,lt,ut,Xe),Math.max(Ut,Tt)})(ue,r,t.aabb,a,c);const ae=ie([],Et([],ue),Y);ie(a,j,ae)}else te=r.elevation.getAtPointOrZero(new At(A.x/H,A.y/H),0);te!==0&&(a[14]+=te)}}class _P{constructor(t,r,c,d,g){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=t,this.uri=r,this.position=c!=null?new he(c[0],c[1]):new he(0,0),this.orientation=d??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,r){ie(t.globalMatrix,r,t.localMatrix);const c=this.nodeOverrides.get(t.name);if(c!==void 0){const _=[];g=c.orientation,fe(d=_),Re(d,d,ti(g[1])),Ye(d,d,ti(g[2])),Ne(d,d,ti(g[0])),ie(t.globalMatrix,t.globalMatrix,_)}var d,g;if(t.meshes)for(const _ of t.meshes){const v=yn.applyTransformFast(_.aabb,t.globalMatrix);this.aabb.encapsulate(v)}if(t.children)for(const _ of t.children)this._applyTransformations(_,t.globalMatrix)}computeBoundsAndApplyParent(){const t=fe([]);this.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.nodes)this._applyTransformations(r,t)}computeModelMatrix(t,r,c,d,g,_,v=!1){Dx(this.matrix,this,t.transform,this.position,r,c,d,g,_,v)}upload(t){if(!this.uploaded){for(const r of this.nodes)nS(r,t);for(const r of this.nodes)kx(r);this.uploaded=!0}}destroy(){for(const t of this.nodes)rS(t)}}function Bg(a,t,r=!1){a.uploaded||(a.gfxTexture=new eS(t,a.image,r?t.gl.R8:t.gl.RGBA8,{useMipmap:a.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function u5(a,t,r){a.indexBuffer=t.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=t.createVertexBuffer(a.vertexArray,n5.members,!1,!0),a.normalArray&&(a.normalBuffer=t.createVertexBuffer(a.normalArray,a5.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=t.createVertexBuffer(a.texcoordArray,s5.members,!1,!0)),a.colorArray&&(a.colorBuffer=t.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?r5:o5).members,!1,!0)),a.featureArray&&(a.pbrBuffer=t.createVertexBuffer(a.featureArray,c5.members,!0)),a.segments=er.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const c=a.material;c.pbrMetallicRoughness.baseColorTexture&&Bg(c.pbrMetallicRoughness.baseColorTexture,t),c.pbrMetallicRoughness.metallicRoughnessTexture&&Bg(c.pbrMetallicRoughness.metallicRoughnessTexture,t),c.normalTexture&&Bg(c.normalTexture,t),c.occlusionTexture&&Bg(c.occlusionTexture,t,r),c.emissionTexture&&Bg(c.emissionTexture,t)}function nS(a,t,r){if(a.meshes)for(const c of a.meshes)u5(c,t,r);if(a.children)for(const c of a.children)nS(c,t,r)}function kx(a){if(a.meshes)for(const t of a.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(a.children)for(const t of a.children)kx(t)}function h5(a){a.pbrMetallicRoughness.baseColorTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),a.pbrMetallicRoughness.metallicRoughnessTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),a.normalTexture&&a.normalTexture.gfxTexture&&a.normalTexture.gfxTexture.destroy(),a.emissionTexture&&a.emissionTexture.gfxTexture&&a.emissionTexture.gfxTexture.destroy(),a.occlusionTexture&&a.occlusionTexture.gfxTexture&&a.occlusionTexture.gfxTexture.destroy()}function rS(a){if(a.meshes)for(const t of a.meshes)t.vertexBuffer&&(t.vertexBuffer.destroy(),t.indexBuffer.destroy(),t.normalBuffer&&t.normalBuffer.destroy(),t.texcoordBuffer&&t.texcoordBuffer.destroy(),t.colorBuffer&&t.colorBuffer.destroy(),t.pbrBuffer&&t.pbrBuffer.destroy(),t.segments.destroy(),t.material&&h5(t.material));if(a.children)for(const t of a.children)rS(t)}function Jh(a,t){const r=a.json.bufferViews[t.bufferView],c=Px[t.componentType];return new c(a.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*(r.byteStride&&r.byteStride!==Og[t.type]*c.BYTES_PER_ELEMENT?r.byteStride/c.BYTES_PER_ELEMENT:Og[t.type]))}function oS(a,t,r,c){const d=Px[t.componentType],g=(function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(d),_=a.json.bufferViews[t.bufferView],v=_.byteStride?_.byteStride/d.BYTES_PER_ELEMENT:Og[t.type],S=r.float32,T=S.length/r.capacity;for(let M=0,A=0;M<t.count*v;M+=v,A+=T)for(let z=0;z<T;z++)S[A+z]=c[M+z]*g;r._trim()}function d5(a,t,r){const c=a.indices,d=a.attributes,g={};g.indexArray=new Hr;const _=t.json.accessors[c],v=_.count/3;g.indexArray.reserve(v);const S=Jh(t,_);for(let z=0;z<v;z++)g.indexArray.emplaceBack(S[3*z],S[3*z+1],S[3*z+2]);g.indexArray._trim(),g.vertexArray=new oa;const T=t.json.accessors[d.POSITION];g.vertexArray.reserve(T.count);const M=Jh(t,T);for(let z=0;z<T.count;z++)g.vertexArray.emplaceBack(M[3*z],M[3*z+1],M[3*z+2]);if(g.vertexArray._trim(),g.aabb=new yn(T.min,T.max),g.centroid=(function(z,D){const k=[0,0,0],$=z.length;if($>0){for(let H=0;H<$;H++){const j=3*z[H];k[0]+=D[j],k[1]+=D[j+1],k[2]+=D[j+2]}k[0]/=$,k[1]/=$,k[2]/=$}return k})(S,M),d.COLOR_0!==void 0){const z=t.json.accessors[d.COLOR_0],D=Og[z.type],k=Jh(t,z);g.colorArray=D===3?new oa:new Kl,g.colorArray.resize(z.count),oS(t,z,g.colorArray,k)}if(d.NORMAL!==void 0){g.normalArray=new oa;const z=t.json.accessors[d.NORMAL];g.normalArray.resize(z.count);const D=Jh(t,z);oS(t,z,g.normalArray,D)}if(d.TEXCOORD_0!==void 0&&r.length>0){g.texcoordArray=new Tc;const z=t.json.accessors[d.TEXCOORD_0];g.texcoordArray.resize(z.count);const D=Jh(t,z);oS(t,z,g.texcoordArray,D)}if(d._FEATURE_ID_RGBA4444!==void 0){const z=t.json.accessors[d._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Jh(t,z))}d._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Jh(t,t.json.accessors[d._FEATURE_RGBA4444]).buffer));const A=a.material;return g.material=(function(z,D){const{emissiveFactor:k=[0,0,0],alphaMode:$="OPAQUE",alphaCutoff:H=.5,normalTexture:j,occlusionTexture:q,emissiveTexture:Y,doubleSided:te,name:ue}=z,{baseColorFactor:ae=[1,1,1,1],metallicFactor:ge=1,roughnessFactor:ye=1,baseColorTexture:me,metallicRoughnessTexture:we}=z.pbrMetallicRoughness||{},Ie=q?D[q.index]:void 0;if(q&&q.extensions&&q.extensions.KHR_texture_transform&&Ie){const Je=q.extensions.KHR_texture_transform;Ie.offsetScale=[Je.offset[0],Je.offset[1],Je.scale[0],Je.scale[1]]}return{name:ue,pbrMetallicRoughness:{baseColorFactor:new bn(...ae),metallicFactor:ge,roughnessFactor:ye,baseColorTexture:me?D[me.index]:void 0,metallicRoughnessTexture:we?D[we.index]:void 0},doubleSided:te,emissiveFactor:new bn(...k),alphaMode:$,alphaCutoff:H,normalTexture:j?D[j.index]:void 0,occlusionTexture:Ie,emissionTexture:Y?D[Y.index]:void 0,defined:z.defined===void 0}})(A!==void 0?t.json.materials[A]:{defined:!1},r),g}function yP(a,t,r){const{matrix:c,rotation:d,translation:g,scale:_,mesh:v,extras:S,children:T,name:M}=a,A={};if(A.name=M,A.localMatrix=c||(function(z,D,k,$){var H=D[0],j=D[1],q=D[2],Y=D[3],te=H+H,ue=j+j,ae=q+q,ge=H*te,ye=H*ue,me=H*ae,we=j*ue,Ie=j*ae,Je=q*ae,qe=Y*te,Xe=Y*ue,at=Y*ae,nt=$[0],ot=$[1],Ge=$[2];return z[0]=(1-(we+Je))*nt,z[1]=(ye+at)*nt,z[2]=(me-Xe)*nt,z[3]=0,z[4]=(ye-at)*ot,z[5]=(1-(ge+Je))*ot,z[6]=(Ie+qe)*ot,z[7]=0,z[8]=(me+Xe)*Ge,z[9]=(Ie-qe)*Ge,z[10]=(1-(ge+we))*Ge,z[11]=0,z[12]=k[0],z[13]=k[1],z[14]=k[2],z[15]=1,z})([],d||[0,0,0,1],g||[0,0,0],_||[1,1,1]),A.globalMatrix=se(A.localMatrix),v!==void 0){A.meshes=r[v];const z=A.anchor=[0,0];for(const D of A.meshes){const{min:k,max:$}=D.aabb;z[0]+=k[0]+$[0],z[1]+=k[1]+$[1]}z[0]=Math.floor(z[0]/A.meshes.length/2),z[1]=Math.floor(z[1]/A.meshes.length/2)}if(S&&(S.id&&(A.id=S.id),S.lights&&(A.lights=(function(z){if(!z.length)return[];const D=(function(q){const Y=atob(q),te=new Uint8Array(Y.length);for(let ue=0;ue<Y.length;ue++)te[ue]=Y.codePointAt(ue);return te})(z),k=[],$=D.length/24,H=new Uint16Array(D.buffer),j=new Float32Array(D.buffer);for(let q=0;q<$;q++){const Y=H[2*q*6]/30,te=H[2*q*6+1]/30,ue=H[2*q*6+10]/100,ae=j[6*q+1],ge=j[6*q+2],ye=j[6*q+3],me=j[6*q+4],we=ye-ae,Ie=me-ge,Je=Math.hypot(we,Ie);k.push({pos:[ae+.5*we,ge+.5*Ie,te],normal:[Ie/Je,-we/Je,0],width:Je,height:Y,depth:ue,points:[ae,ge,ye,me]})}return k})(S.lights)),S.MAPBOX_geometry_bloom&&(A.isGeometryBloom=S.MAPBOX_geometry_bloom)),T){const z=[];for(const D of T)z.push(yP(t.json.nodes[D],t,r));A.children=z}return A}function f5(a){if(a.vertices.length===0||a.indices.length===0)return null;const t=new bx(a.vertices,a.indices,8,256),[r,c]=[t.min.clone(),t.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:t,min:r,max:c}}function p5(a){if(!a.extras||!a.extras.ground)return null;const t=a.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const r=t[0];if(!r||!Array.isArray(r)||r.length===0)return null;const c=[];for(const _ of r){if(!Array.isArray(_)||_.length!==2)continue;const v=_[0],S=_[1];typeof v=="number"&&typeof S=="number"&&c.push(new Ae(v,S))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let d=0;for(let _=0;_<c.length;_++){const v=c[_],S=c[(_+1)%c.length],T=c[(_+2)%c.length];d+=(v.x-S.x)*(T.y-S.y)-(T.x-S.x)*(v.y-S.y)}d>0&&c.reverse();const g=Af(c.flatMap(_=>[_.x,_.y]),[]);return g.length===0?null:{vertices:c,indices:g}}function m5(a,t){const r=[],c=[];let d=0;const g=[];for(const _ of a){d=r.length;const v=_.vertexArray.float32,S=_.indexArray.uint16;for(let T=0;T<_.vertexArray.length;T++)g[0]=v[3*T+0],g[1]=v[3*T+1],g[2]=v[3*T+2],Wt(g,g,t),r.push(new Ae(g[0],g[1]));for(let T=0;T<3*_.indexArray.length;T++)c.push(S[T]+d)}if(c.length%3!=0)return null;for(let _=0;_<c.length;_+=3){const v=r[c[_+0]],S=r[c[_+1]],T=r[c[_+2]];(v.x-S.x)*(T.y-S.y)-(T.x-S.x)*(v.y-S.y)>0&&([c[_+1],c[_+2]]=[c[_+2],c[_+1]])}return{vertices:r,indices:c}}function sS(a){const t=(function(S,T){const M=[],A=WebGL2RenderingContext;if(S.json.textures)for(const z of S.json.textures){const D={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};z.sampler!==void 0&&Object.assign(D,S.json.samplers[z.sampler]),M.push({image:T[z.source],sampler:D,uploaded:!1})}return M})(a,a.images),r=(function(S,T){const M=[];for(const A of S.json.meshes){const z=[];for(const D of A.primitives)z.push(d5(D,S,T));M.push(z)}return M})(a,t),{scenes:c,scene:d,nodes:g}=a.json,_=c?c[d||0].nodes:[...g.keys()],v=[];for(const S of _)v.push(yP(g[S],a,r));return(function(S,T,M){const A={},z=new Set;for(let D=0;D<S.length;D++){const k=M[T[D]];if(!k.extras)continue;const $=k.extras["mapbox:footprint:version"],H=k.extras["mapbox:footprint:id"];($||H)&&z.add(D),$==="1.0.0"&&H&&(A[H]=D)}for(let D=0;D<S.length;D++){if(z.has(D))continue;const k=S[D],$=M[T[D]];if(!$.extras)continue;let H=null;k.id in A&&(H=m5(S[A[k.id]].meshes,k.localMatrix)),H||(H=p5($)),H&&(k.footprint=f5(H))}if(z.size>0){const D=Array.from(z.values()).sort((k,$)=>k-$);for(let k=D.length-1;k>=0;k--)S.splice(D[k],1)}})(v,_,a.json.nodes),v}function g5(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const t=a.vertexArray.float32,r=a.aabb.min[0]-1,c=a.aabb.min[1]-1,d=Xh/(a.aabb.max[0]-r+2),g=Xh/(a.aabb.max[1]-c+2);for(let _=0;_<t.length;_+=3){const v=t[_+2],S=(t[_+0]-r)*d|0,T=(t[_+1]-c)*g|0;v>a.heightmap[T*Xh+S]&&(a.heightmap[T*Xh+S]=v)}}function vP(a,t,r,c,d){r.reserve(r.length+4*a.length),c.reserve(c.length+10*a.length),d.reserve(d.length+10*a.length);let g=c.length;for(const _ of a){const v=Math.min(10,Math.max(4,1.3*_.height))*t,S=[-_.normal[1],_.normal[0],0],T=Math.min(.29,.1*_.width/_.depth),M=_.width-2*_.depth*t*(T+.01),A=Dn([],_.pos,S,M/2),z=Dn([],_.pos,S,-M/2),D=[A[0],A[1],A[2]+_.height],k=[z[0],z[1],z[2]+_.height],$=Dn([],_.normal,S,T);bi($,$,v);const H=Dn([],_.normal,S,-T);bi(H,H,v),Qt($,A,$),Qt(H,z,H),A[2]+=.1,z[2]+=.1,c.emplaceBack($[0],$[1],$[2]),c.emplaceBack(H[0],H[1],H[2]),c.emplaceBack(A[0],A[1],A[2]),c.emplaceBack(z[0],z[1],z[2]),c.emplaceBack(D[0],D[1],D[2]),c.emplaceBack(k[0],k[1],k[2]),c.emplaceBack(A[0],A[1],A[2]),c.emplaceBack(z[0],z[1],z[2]),c.emplaceBack($[0],$[1],$[2]),c.emplaceBack(H[0],H[1],H[2]);const j=M/v/2;d.emplaceBack(-j-T,-1,j,.8),d.emplaceBack(j+T,-1,j,.8),d.emplaceBack(-j,0,j,1.3),d.emplaceBack(j,0,j,1.3),d.emplaceBack(j+T,-.8,j,.7),d.emplaceBack(j+T,-.8,j,.7),d.emplaceBack(0,0,j,1.3),d.emplaceBack(0,0,j,1.3),d.emplaceBack(j+T,-1.2,j,.8),d.emplaceBack(j+T,-1.2,j,.8),r.emplaceBack(6+g,4+g,8+g),r.emplaceBack(7+g,9+g,5+g),r.emplaceBack(0+g,1+g,2+g),r.emplaceBack(1+g,3+g,2+g),g+=10}}function _5(a,t){const r={};r.indexArray=new Hr,r.vertexArray=new oa,r.colorArray=new Kl,vP(a,t,r.indexArray,r.vertexArray,r.colorArray);const c={defined:!0};c.emissiveFactor=bn.black;const d={};return d.baseColorFactor=bn.white,c.pbrMetallicRoughness=d,r.material=c,r.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const xP=Yi([{name:"a_pos_3f",components:3,type:"Float32"}]),y5=Yi([{name:"a_normal_3",components:3,type:"Int16"}]),v5=Yi([{name:"a_centroid_3",components:3,type:"Int16"}]),bP=Yi([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),x5=Yi([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),b5=Yi([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),w5=Yi([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),S5=Yi([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),T5=Yi([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),wP=Qi.types,Ox=32767;function E5(a,t){const r=It+t;for(const c of a)for(const d of c)if(d.x<-t||d.x>r||d.y<-t||d.y>r)return!1;return!0}function I5(a){switch(a){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${a}`)}}class aS{constructor(){this.layoutVertexArray=new oa,this.layoutAttenuationArray=new Kl,this.layoutColorArray=new Us,this.indexArray=new Hr,this.indexArrayForConflation=new Hr,this.segmentsBucket=new er}}class lS{constructor(t){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new er,this.entranceBloom=new aS;const r=66560;this.layoutVertexArray=new oa,this.layoutVertexArray.reserve(r),this.layoutNormalArray=new fl,this.layoutNormalArray.reserve(r),this.layoutCentroidArray=new fl,this.layoutCentroidArray.reserve(r),this.layoutColorArray=new Us,this.layoutColorArray.reserve(r),this.layoutFloodLightDataArray=new Fh,this.layoutFloodLightDataArray.reserve(r),this.layoutAOArray=new Tf,this.layoutAOArray.reserve(r),this.indexArray=new Hr,this.indexArray.reserve(66560),this.indexArrayForConflation=new Hr,this.segmentsBucket=new er,this.entranceBloom=new aS,t&&(this.layoutFacadePaintArray=new Us,this.layoutFacadeDataArray=new gu,this.layoutFacadeVerticalRangeArray=new Us)}reserve(t,r,c){this.layoutVertexArray.reserveForAdditional(t),this.layoutCentroidArray.reserveForAdditional(t),this.layoutFloodLightDataArray.reserveForAdditional(t),this.layoutNormalArray.reserveForAdditional(t),this.layoutAOArray.reserveForAdditional(t),this.layoutColorArray.reserveForAdditional(t),this.indexArray.reserveForAdditional(r),c&&(this.layoutFacadePaintArray.reserveForAdditional(t),this.layoutFacadeDataArray.reserveForAdditional(t),this.layoutFacadeVerticalRangeArray.reserveForAdditional(t))}}class SP{constructor(t){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Tc,this.footprintsIndices=new Fh,this.footprintsMin=new Ae(1/0,1/0),this.footprintsMax=new Ae(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new lS(!1),this.buildingWithFacade=new lS(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.worldview=t.worldview,this.lut=t.lut,this.programConfigurations=new L(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection,this.groundEffect=new G1(t),this.groundEffect.groundRadiusArray=new yo,this.hasAppearances=null}updateFootprints(t,r){const c=new bx([],[],1),d={vertices:[],indices:new Uint32Array(0),grid:c,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};r.push({footprint:d,id:t})}updateAppearances(t,r,c,d){}prepare(){return(function(){if(Ax!=null||YA!=null)return null;if(kf!=null)return kf;const t=fetch(jr.BUILDING_GEN_URL);return kf=(function(r){let c,d,g,_,v;function S(){c=new Uint8Array(v.buffer),d=new Int16Array(v.buffer),g=new Int32Array(v.buffer),_=new Float32Array(v.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const M=()=>{},A={a:{a:T,f:function(z){const D=c.length,k=Math.max(z>>>0,Math.ceil(1.2*D)),$=Math.ceil((k-D)/65536);try{return v.grow($),S(),!0}catch{return!1}},g:T,b:M,c:M,d:M,e:M}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,A):r.then(z=>z.arrayBuffer()).then(z=>WebAssembly.instantiate(z,A))).then(z=>{const D=z.instance.exports;return(0,D.g)(),v=D.f,S(),new J$({setStyle:D.h,setAOOptions:D.i,setMetricOptions:D.j,setStructuralOptions:D.k,setFacadeOptions:D.l,setFauxFacadeOptions:D.m,setFacadeClassifierOptions:D.n,addFeature:D.o,addFacade:D.p,generateMesh:D.q,getLastError:D.r,getOuterRingLength:D.s,getMeshCount:D.t,getPositionsPtr:D.u,getPositionsLength:D.v,getNormalsPtr:D.w,getNormalsLength:D.x,getAOPtr:D.y,getAOLength:D.z,getUVPtr:D.A,getUVLength:D.B,getFauxFacadePtr:D.C,getFauxFacadeLength:D.D,getIndicesPtr:D.E,getIndicesLength:D.F,getBuildingPart:D.G,getRingCount:D.H,getRingPtr:D.I,getRingLength:D.J,malloc:D.K,free:D.L,heapU8:c,heap16:d,heap32:g,heapF32:_})})})(t).then(r=>(kf=null,Ax=r,Ax)).catch(r=>{yi("Could not load building-gen"),kf=null,YA=r}),kf})()}populate(t,r,c,d){const g=Y$();if(!g)return;const _=vt(c);this.tileToMeter=_,this.brightness=r.brightness,g.setStyle({normalScale:[1,-1,_],tileToMeters:_}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const v=new Map,S=new Map;let T=0;for(const{feature:j}of t){if(wP[j.type]!=="LineString"){v.set(j.id,j.properties.source_id);continue}const q=this.layers[0]._featureFilter.needGeometry;if(q&&!this.layers[0]._featureFilter.filter(new An(this.zoom),j,c))continue;const Y=Bi(j,q);if(!q&&!this.layers[0]._featureFilter.filter(new An(this.zoom),Y,c))continue;const te=q?Y.geometry:fi(j,c,d),ue=[];for(const me of te)for(const we of me)ue.push(we.x),ue.push(we.y);const ae={coordinates:ue,crossPerc:j.properties.cross_perc,distanceToRoad:j.properties.distance_to_road,entrances:j.properties.entrances,sourceId:0},ge=j.properties.source_id;let ye=S.get(ge);ye||(ye=[],S.set(ge,ye)),ye.push(ae),++T}this.maxHeight=0;const M=new Array,A=new Set,z=j=>{j!=null&&A.add(j)},D=(j,q)=>{j!=null&&M.push({buildingId:j,footprintIndex:q})},k=64*(t.length-T),$=k/2;this.buildingWithFacade.reserve(k,$,!0),this.buildingWithoutFacade.reserve(2*k,2*$,!1),this.footprintsIndices.reserve(16*(t.length-T)),this.footprintsVertices.reserve(8*(t.length-T));for(const{feature:j,id:q,index:Y,sourceLayerIndex:te}of t){if(wP[j.type]==="LineString")continue;const ue=this.layers[0]._featureFilter.needGeometry;if(ue&&!this.layers[0]._featureFilter.filter(new An(this.zoom),j,c))continue;let ae=null;if(j.properties&&j.properties.hasOwnProperty("building_id")&&(ae=Number(j.properties.building_id),A.has(ae)))continue;const ge=Bi(j,ue);if(!ue&&!this.layers[0]._featureFilter.filter(new An(this.zoom),ge,c))continue;const ye=ue?ge.geometry:fi(j,c,d),me=Eg(ye,500);let we=!1;for(const Hi of me)if(Hi.length!==1){we=!0;break}if(we){z(ae);continue}if(!E5(ye,163)){z(ae);continue}const Ie=this.layers[0],Je=I5(Ie.layout.get("building-roof-shape").evaluate(j,{},c)),qe=Ie.layout.get("building-base").evaluate(j,{},c),Xe=Ie.layout.get("building-height").evaluate(j,{},c),at=Ie.layout.get("building-flood-light-ground-radius").evaluate(j,{},c),nt=Ie.paint.get("building-ambient-occlusion-intensity"),ot=at/this.tileToMeter;j.properties["building-part"]="roof";const Ge=Ie.paint.get("building-color").evaluate(j,{},this.canonical).toPremultipliedRenderColor(this.lut),ct=Ie.paint.get("building-emissive-strength").evaluate(j,{},this.canonical);j.properties["building-part"]="wall";const et=Ie.paint.get("building-color").evaluate(j,{},this.canonical).toPremultipliedRenderColor(this.lut),ut=Ie.paint.get("building-emissive-strength").evaluate(j,{},this.canonical);j.properties["building-part"]="window";const lt=Ie.paint.get("building-color").evaluate(j,{},this.canonical).toPremultipliedRenderColor(this.lut),Bt=Ie.paint.get("building-emissive-strength").evaluate(j,{},this.canonical);j.properties["building-part"]="door";const Ut=Ie.paint.get("building-color").evaluate(j,{},this.canonical).toPremultipliedRenderColor(this.lut),Tt=Ie.paint.get("building-emissive-strength").evaluate(j,{},this.canonical);let Mt=Ie.layout.get("building-flood-light-wall-radius").evaluate(j,{},c);Mt=de(Mt,0,2048);const ai=Mt/2048*Ox,Jt=v.get(q),Ct=S.get(Jt)||[],xi=Ct.length!==0&&Ie.layout.get("building-facade").evaluate(j,{},c);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(xi,!1,1);let Wi=0,mn=0,Gi=0,Pn=0,sn=0,wr=0,ln=0,In=0,Yn=0,or=0,sr=0;if(xi){let Hi=Math.round(Ie.layout.get("building-facade-floors").evaluate(j,{},c));if(qe===0){Hi=Math.max(1,Hi-(Ct.length>0?1:0));let Tr=4;if(Xe>100){const qr=[10,13,15];Tr=qr[j.id?j.id%qr.length:0]}else Xe<=10&&(Tr=3);g.setFacadeOptions(Tr,!0),sn=(Xe<15?1.3:1.61803)*Tr/_}else sn=qe/_;wr=Xe/_,sn=Math.min(sn,wr),Gi=Ie.layout.get("building-facade-unit-width").evaluate(j,{},c)/_,Pn=(wr-sn)/Hi,g.setFauxFacadeOptions(!0,!0,Gi);const lo=Ie.layout.get("building-facade-window").evaluate(j,{},c);Wi=lo[0],mn=lo[1],ln=Math.floor(65535*Math.min(1,sn/It)),In=Math.floor(65535*Math.min(1,wr/It)),Yn=Math.floor(255*Wi)<<8|Math.floor(255*mn),or=Math.floor(65535*Math.min(1,Gi/It)),sr=Math.floor(65535*Math.min(1,Pn/It))}const Sr=Array(me.length),vo={x:1/0,y:1/0},Ao={x:-1/0,y:-1/0},Ur={x:0,y:0};let Wr=0;for(let Hi=0;Hi<me.length;Hi++){const lo=me[Hi];if(lo.length>0){const Tr=[],qr=Array(lo.length+1);qr[0]=0;for(let xa=0;xa<lo.length;xa++){const Ts=lo[xa];for(let qs=0;qs<Ts.length;qs++){const co=Ts[Ts.length-qs-1];vo.x=Math.min(vo.x,co.x),vo.y=Math.min(vo.y,co.y),Ao.x=Math.max(Ao.x,co.x),Ao.y=Math.max(Ao.y,co.y),Ur.x+=co.x,Ur.y+=co.y,Wr++,Tr.push(co.x),Tr.push(co.y)}qr[xa+1]=Tr.length}Sr[Hi]={id:j.id?j.id:0,height:Xe,minHeight:qe,sourceId:0,roofType:Je,coordinates:Tr,ringIndices:qr}}}Ur.x/=Wr||1,Ur.y/=Wr||1;const Qr=g.generateMesh(Sr,Ct);if(typeof Qr=="string"){yi(`Unable to generate building ${j.id}: ${Qr}`),z(ae);continue}if(Qr.meshes.length===0||Qr.modifiedPolygonRings.length===0){z(ae);continue}const Ui=xi?this.buildingWithFacade:this.buildingWithoutFacade;let ar=0;for(const Hi of Qr.meshes)ar+=Hi.positions.length/3;const dr=Ui.segmentsBucket.prepareSegment(ar,Ui.layoutVertexArray,Ui.indexArray),Ws=[];let Xo=null,xo=0,Jo=-1;const ic=Ui.layoutVertexArray.length,ko=ic+ar;Ui.layoutVertexArray.resize(ko),Ui.layoutCentroidArray.resize(ko),Ui.layoutNormalArray.resize(ko),Ui.layoutAOArray.resize(ko),Ui.layoutColorArray.resize(ko),Ui.layoutFloodLightDataArray.resize(ko),xi&&(Ui.layoutFacadePaintArray.resize(ko),Ui.layoutFacadeDataArray.resize(ko),Ui.layoutFacadeVerticalRangeArray.resize(ko));const a0=Ui.indexArray.length;let qf=0,us=ic;for(const Hi of Qr.meshes){let lo,Tr;if(Hi.buildingPart===1)lo=Ge,Tr=ct;else if(Hi.buildingPart===0)lo=et,Tr=ut;else if(Hi.buildingPart===2)lo=lt,Tr=Bt;else{if(Hi.buildingPart!==3)continue;lo=Ut,Tr=Tt}if(Tr=de(Tr,0,1),Hi.buildingPart===3){const $r=new Array;for(let Fo=0;Fo<Hi.positions.length;Fo+=12){const Cu=Hi.positions[Fo+0],wo=Hi.positions[Fo+1],Es=Hi.positions[Fo+3],Wa=Hi.positions[Fo+4],oc=Hi.positions[Fo+2],WS=Hi.positions[Fo+8]-oc,qS=1,l_=Es-Cu,Jf=Wa-wo,vl=Math.hypot(l_,Jf);$r.push({pos:[Cu+.5*l_,wo+.5*Jf,oc],normal:[Jf/vl,-l_/vl,0],width:vl,height:WS,depth:qS,points:[Cu,wo,Es,Wa]})}const bo=Ui.entranceBloom.segmentsBucket.prepareSegment(10*$r.length,Ui.entranceBloom.layoutVertexArray,Ui.entranceBloom.indexArray),Xr=Ui.entranceBloom.layoutVertexArray.length;xo=Ui.entranceBloom.indexArray.length,vP($r,.5/this.tileToMeter,Ui.entranceBloom.indexArray,Ui.entranceBloom.layoutVertexArray,Ui.entranceBloom.layoutAttenuationArray);const Oo=Ui.entranceBloom.layoutVertexArray.length-Xr;Jo=Ui.entranceBloom.indexArray.length-xo;for(let Fo=0;Fo<Oo;Fo++)Ui.entranceBloom.layoutColorArray.emplaceBack(255*Ut.r<<8|255*Ut.g,255*Ut.b<<8|51*Tt);bo.vertexLength+=Oo,bo.primitiveLength+=Jo,Xo={part:Hi.buildingPart,vertexOffset:Xr,vertexLength:Oo}}Ui.layoutVertexArray.float32.set(Hi.positions,3*us);const qr=Hi.positions.length/3;for(let $r=0;$r<qr;++$r){const bo=3*$r;qf=Math.max(qf,Hi.positions[bo+2]);const Xr=Hi.normals[bo+1]*Ox,Oo=Hi.normals[bo+2]*Ox,Fo=3*(us+$r);Ui.layoutNormalArray.int16[Fo]=Hi.normals[bo]*Ox,Ui.layoutNormalArray.int16[Fo+1]=Xr,Ui.layoutNormalArray.int16[Fo+2]=Oo;const Cu=Hi.ao[$r];Ui.layoutAOArray.uint8[us+$r]=255*Cu;const wo=1+(Cu-1)*nt,Es=255*lo.b*wo<<8|255*Tr;Ui.layoutColorArray.uint16[2*(us+$r)]=255*lo.r*wo<<8|255*lo.g*wo,Ui.layoutColorArray.uint16[2*(us+$r)+1]=Es}const xa=Math.floor(Ur.x),Ts=Math.floor(Ur.y),qs=Math.floor(Xe);for(let $r=0;$r<qr;++$r){const bo=3*(us+$r);Ui.layoutCentroidArray.int16[bo]=xa,Ui.layoutCentroidArray.int16[bo+1]=Ts,Ui.layoutCentroidArray.int16[bo+2]=qs}if(Ui.layoutFloodLightDataArray.uint16.fill(Hi.buildingPart===0?ai:0,us,us+qr),xi){const $r=255*lt.r<<8|255*lt.g,bo=255*lt.b<<8|255*Bt;for(let Xr=0;Xr<qr;++Xr){const Oo=2*(us+Xr);Ui.layoutFacadePaintArray.uint16[Oo]=$r,Ui.layoutFacadePaintArray.uint16[Oo+1]=bo}for(let Xr=0;Xr<qr;++Xr)if(Hi.isFauxFacade[Xr]){const Oo=Math.min(65535,Math.floor(Hi.uv[2*Xr]*Qr.outerRingLength));Ui.layoutFacadeDataArray.emplace(us+Xr,1|Oo,Yn,or,sr),Ui.layoutFacadeVerticalRangeArray.emplace(us+Xr,ln,In)}else Ui.layoutFacadeDataArray.emplace(us+Xr,0,0,0,0),Ui.layoutFacadeVerticalRangeArray.emplace(us+Xr,0,0)}const co=dr.vertexLength,a_=Hi.indices.length/3,rc=Ui.indexArray.length;Ui.indexArray.resize(rc+a_);for(let $r=0;$r<a_;++$r){const bo=3*$r,Xr=3*rc+bo;Ui.indexArray.uint16[Xr]=co+Hi.indices[bo],Ui.indexArray.uint16[Xr+1]=co+Hi.indices[bo+1],Ui.indexArray.uint16[Xr+2]=co+Hi.indices[bo+2]}Hi.buildingPart!==1&&Hi.buildingPart!==0&&Hi.buildingPart!==2&&Hi.buildingPart!==3||Ws.push({part:Hi.buildingPart,vertexOffset:us,vertexLength:Hi.positions.length/3}),us+=qr,dr.vertexLength+=qr,dr.primitiveLength+=Hi.indices.length/3}this.maxHeight=Math.max(this.maxHeight,qf);const l0=Ui.indexArray.length-a0,nc=this.footprintsIndices.length,Cc=this.footprintsVertices.length,zu=[],va=new Ae(1/0,1/0),Za=new Ae(-1/0,-1/0),s_=this.groundEffect.vertexArray.length;for(const Hi of Qr.modifiedPolygonRings){const lo=[],Tr=new Ae(1/0,1/0),qr=new Ae(-1/0,-1/0);for(let xa=0;xa<Hi.length;xa+=2){const Ts=Hi.length-xa-2;Tr.x=Math.min(Tr.x,Hi[Ts]),Tr.y=Math.min(Tr.y,Hi[Ts+1]),qr.x=Math.max(qr.x,Hi[Ts]),qr.y=Math.max(qr.y,Hi[Ts+1]);const qs=new Ae(Hi[Ts],Hi[Ts+1]);lo.push(qs),zu.push(qs.x,qs.y),this.footprintsVertices.emplaceBack(qs.x,qs.y)}va.x=Math.min(va.x,Tr.x),va.y=Math.min(va.y,Tr.y),Za.x=Math.max(Za.x,qr.x),Za.y=Math.max(Za.y,qr.y),this.groundEffect.addData(lo,[Tr,qr],ot)}const Xf=this.groundEffect.vertexArray.length-s_;this.groundEffect.groundRadiusArray.reserveForAdditional(Xf);for(let Hi=0;Hi<Xf;Hi++)this.groundEffect.groundRadiusArray.emplaceBack(at);(vo.x<0||Ao.x>It||vo.y<0||Ao.y>It)&&this.featuresOnBorder.push({featureId:j.id,footprintIndex:this.footprints.length});{const Hi=Af(zu,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Hi.length),this.footprintsIndices.uint16.set(Hi,nc),this.buildingIds.add(ae??j.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,va.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,va.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Za.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Za.y);const lo={footprintVertexOffset:Cc,footprintVertexLength:this.footprintsVertices.length-Cc,footprintIndexOffset:nc,footprintIndexLength:this.footprintsIndices.length-nc,min:va,max:Za,hiddenFlags:0,indicesOffset:a0,indicesLength:l0,bloomIndicesOffset:xo,bloomIndicesLength:Jo,groundEffectVertexOffset:s_,groundEffectVertexLength:Xf,hasFauxFacade:xi,height:qf,promoteId:q,feature:ge,parts:Ws,buildingBloom:Xo},Tr=this.footprints.length;j.id!==void 0&&this.featureFootprintLookup.set(j.id,Tr),D(ae,Tr),this.footprints.push(lo)}this.programConfigurations.populatePaintArrays(Ui.layoutVertexArray.length,j,Y,{},r.availableImages,c,r.brightness),this.groundEffect.addPaintPropertiesData(j,Y,{},r.availableImages,c,r.brightness),r.featureIndex.insert(j,ye,Y,te,this.index,ic)}M.forEach(({buildingId:j,footprintIndex:q})=>{A.has(j)&&(this.footprints[q].hiddenFlags|=4)});const H=new Set;this.buildingIds.forEach((j,q,Y)=>{A.has(j)||H.add(j)}),this.buildingIds=H,this.groundEffect.prepareBorderSegments()}update(t,r,c,d,g,_,v){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v),this.groundEffect.update(t,r,g,c,d,_,v),this.evaluate(this.layers[0],t),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){const r=c=>{c.layoutVertexBuffer=t.createVertexBuffer(c.layoutVertexArray,xP.members),c.layoutNormalBuffer=t.createVertexBuffer(c.layoutNormalArray,y5.members),c.layoutCentroidBuffer=t.createVertexBuffer(c.layoutCentroidArray,v5.members),c.layoutFloodLightDataBuffer=t.createVertexBuffer(c.layoutFloodLightDataArray,T5.members),c.layoutFacadeDataArray&&c.layoutFacadeDataArray.length&&(c.layoutFacadeDataBuffer=t.createVertexBuffer(c.layoutFacadeDataArray,b5.members)),c.layoutFacadeVerticalRangeArray&&c.layoutFacadeVerticalRangeArray.length&&(c.layoutFacadeVerticalRangeBuffer=t.createVertexBuffer(c.layoutFacadeVerticalRangeArray,w5.members)),c.entranceBloom.layoutVertexArray.length&&(c.entranceBloom.layoutVertexBuffer=t.createVertexBuffer(c.entranceBloom.layoutVertexArray,xP.members),c.entranceBloom.layoutAttenuationBuffer=t.createVertexBuffer(c.entranceBloom.layoutAttenuationArray,S5.members)),this.uploadUpdatedColorBuffer(t),this.uploadUpdatedIndexBuffer(t)};this.uploaded||(r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){const t=r=>{r.layoutVertexBuffer&&(r.layoutVertexBuffer.destroy(),r.layoutNormalBuffer.destroy(),r.layoutColorBuffer.destroy(),r.segmentsBucket.destroy(),r.indexBuffer&&r.indexBuffer.destroy(),r.entranceBloom.layoutVertexBuffer&&(r.entranceBloom.layoutVertexBuffer.destroy(),r.entranceBloom.layoutColorBuffer.destroy(),r.entranceBloom.layoutAttenuationBuffer.destroy(),r.entranceBloom.indexBuffer.destroy(),r.entranceBloom.segmentsBucket.destroy()))};t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(t,r,c=!0){let d=!1;const g=c?r:0,_=0|(c?-1:~r);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of t){const S=this.footprints[v],T=S.hiddenFlags&_|g;S.hiddenFlags!==T&&(S.hiddenFlags=T,d=!0,this.groundEffect.updateHiddenByLandmarkRange(S.groundEffectVertexOffset,S.groundEffectVertexLength,S.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(t){if(this.groundEffect.uploadHiddenByLandmark(t),this.indexArrayForConflationUploaded)return;const r=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};r(this.buildingWithoutFacade),r(this.buildingWithFacade);for(const d of this.footprints){const g=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let S=d.indicesOffset;S<_;S++)g.indexArrayForConflation.uint16[3*S+0]=0,g.indexArrayForConflation.uint16[3*S+1]=0,g.indexArrayForConflation.uint16[3*S+2]=0;const v=d.bloomIndicesOffset+d.bloomIndicesLength;for(let S=d.bloomIndicesOffset;S<v;S++)g.entranceBloom.indexArrayForConflation.uint16[3*S+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*S+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*S+2]=0}}const c=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=t.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=t.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(t){const r=c=>{c.layoutColorBuffer?c.layoutColorBuffer.updateData(c.layoutColorArray):c.layoutColorBuffer=t.createVertexBuffer(c.layoutColorArray,bP.members,!0),c.layoutFacadePaintArray&&(c.layoutFacadePaintBuffer?c.layoutFacadePaintBuffer.updateData(c.layoutFacadePaintArray):c.layoutFacadePaintBuffer=t.createVertexBuffer(c.layoutFacadePaintArray,x5.members,!0)),c.entranceBloom.layoutColorBuffer?c.entranceBloom.layoutColorBuffer.updateData(c.entranceBloom.layoutColorArray):c.entranceBloom.layoutColorBuffer=t.createVertexBuffer(c.entranceBloom.layoutColorArray,bP.members,!0)};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(t,r){const c=t.paint.get("building-ambient-occlusion-intensity");for(const d of this.footprints){if(4&d.hiddenFlags)continue;const g=r[d.promoteId],_=d.feature;_.properties["building-part"]="roof";const v=t.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),S=t.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="wall";const T=t.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),M=t.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="window";const A=t.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),z=t.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="door";const D=t.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),k=t.paint.get("building-emissive-strength").evaluate(_,g,this.canonical),$=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const j of d.parts){let q,Y=v;j.part===1?(Y=v,q=S):j.part===0?(Y=T,q=M):j.part===2?(Y=A,q=z):j.part===3&&(Y=D,q=k),q=de(q,0,1);for(let te=0;te<j.vertexLength;te++){const ue=j.vertexOffset+te,ae=1+($.layoutAOArray.uint8[ue]/255-1)*c;$.layoutColorArray.emplace(ue,Y.r*ae*255<<8|Y.g*ae*255,Y.b*ae*255<<8|255*q),d.hasFauxFacade&&$.layoutFacadePaintArray.emplace(ue,255*A.r<<8|255*A.g,255*A.b<<8|255*z)}}const H=d.buildingBloom;if(H)for(let j=0;j<H.vertexLength;j++)$.entranceBloom.layoutColorArray.emplace(H.vertexOffset+j,255*D.r<<8|255*D.g,255*D.b<<8|51*k)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(t,r,c){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const d=r.getReplacementRegionsForTile(t.toUnwrapped());if(Sx(this.activeReplacements,d))return;this.activeReplacements=d;for(const _ of this.footprints)_.hiddenFlags&=-2;const g=[];for(const _ of this.activeReplacements){if(_.order<c)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-t.canonical.z));for(const S of this.footprints)S.min.x>_.max.x||S.max.x<_.min.x||S.min.y>_.max.y||S.max.y<_.min.y||(g.length=0,A5(this.footprintsVertices,S.footprintVertexOffset,S.footprintVertexLength,_.footprintTileId.canonical,t.canonical,g),$1(_.footprint,g,this.footprintsIndices.uint16,S.footprintIndexOffset,S.footprintIndexLength,0,-v)&&(S.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(t){if(t.id!==void 0){const r=this.featureFootprintLookup.get(t.id);return this.footprints[r]}return null}getHeightAtTileCoord(t,r){let c=Number.NEGATIVE_INFINITY,d=!0;const g=4*(t+It)*It+(r+It);if(this.footprintLookup.hasOwnProperty(g)){const v=this.footprintLookup[g];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const _=new Ae(t,r);for(const v of this.footprints)t>v.max.x||v.min.x>t||r>v.max.y||v.min.y>r||v.height<=c||M5(_,this.footprintsVertices.float32.subarray(2*v.footprintVertexOffset,2*(v.footprintVertexOffset+v.footprintVertexLength)),this.footprintsIndices.uint16.subarray(v.footprintIndexOffset,v.footprintIndexOffset+v.footprintIndexLength))&&(c=v.height,this.footprintLookup[g]=v,d=v.hiddenFlags!==0);if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:d};this.footprintLookup[g]=void 0}}function M5(a,t,r){for(let c=0;c<r.length;c+=3){const d=r[c],g=r[c+1],_=r[c+2],v=t[2*d+0],S=t[2*d+1],T=t[2*g+0],M=t[2*g+1],A=t[2*_+0],z=t[2*_+1],D=(v-A)*(a.y-z)-(S-z)*(a.x-A),k=(T-v)*(a.y-S)-(M-S)*(a.x-v);if(D<0!=k<0&&D!==0&&k!==0)continue;const $=(A-T)*(a.y-M)-(z-M)*(a.x-T);if($===0||$<0==D+k<=0)return!0}return!1}function A5(a,t,r,c,d,g){const _=Math.pow(2,c.z-d.z);for(let v=0;v<r;v++){let S=a.float32[2*(v+t)+0],T=a.float32[2*(v+t)+1];S=(S+d.x*It)*_-c.x*It,T=(T+d.y*It)*_-c.y*It,g.push(new Ae(S,T))}}let TP,EP;Vt(SP,"BuildingBucket",{omit:["layers"]}),Vt(lS,"BuildingGeometry"),Vt(aS,"BuildingBloomGeometry");const P5=Yi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),z5=Yi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:C5}=P5,R5=Yi([{name:"a_packed",components:3,type:"Float32"}]),{members:L5}=R5,D5=Yi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:k5}=D5;class IP{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new Su({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){const c=this.getKey(t,r);return this.positions[c]}trim(){const t=this.width,r=this.height=st(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,c){const d=[];let g=t.length%2==1?-t[t.length-1]*c:0,_=t[0]*c,v=!0;d.push({left:g,right:_,isDash:v,zeroLength:t[0]===0});let S=t[0];for(let T=1;T<t.length;T++){v=!v;const M=t[T];g=S*c,S+=M,_=S*c,d.push({left:g,right:_,isDash:v,zeroLength:M===0})}return d}addRoundDash(t,r,c){const d=r/2;for(let g=-c;g<=c;g++){const _=this.width*(this.nextRow+c+g);let v=0,S=t[v];for(let T=0;T<this.width;T++){T/S.right>1&&(S=t[++v]);const M=Math.abs(T-S.left),A=Math.abs(T-S.right),z=Math.min(M,A);let D;const k=g/c*(d+1);if(S.isDash){const $=d-Math.abs(k);D=Math.sqrt(z*z+$*$)}else D=d-Math.sqrt(z*z+k*k);this.image.data[_+T]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(t,r){for(let S=t.length-1;S>=0;--S){const T=t[S],M=t[S+1];T.zeroLength?t.splice(S,1):M&&M.isDash===T.isDash&&(M.left=T.left,t.splice(S,1))}const c=t[0],d=t[t.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const g=this.width*this.nextRow;let _=0,v=t[_];for(let S=0;S<this.width;S++){S/v.right>1&&(v=t[++_]);const T=Math.abs(S-v.left),M=Math.abs(S-v.right),A=Math.min(T,M);this.image.data[g+S]=Math.max(0,Math.min(255,(v.isDash?A:-A)+r+128))}}addDash(t,r){const c=this.getKey(t,r);if(this.positions[c])return this.positions[c];const d=r==="round",g=d?7:0,_=2*g+1;if(this.nextRow+_>this.height)return yi("LineAtlas out of space"),null;t.length===0&&t.push(1);let v=0;for(let M=0;M<t.length;M++)t[M]<0&&(yi("Negative value is found in line dasharray, replacing values with 0"),t[M]=0),v+=t[M];if(v!==0){const M=this.width/v,A=this.getDashRanges(t,this.width,M);d?this.addRoundDash(A,M,g):this.addRegularDash(A,r==="square"?.5*M:0)}const S=this.nextRow+g;this.nextRow+=_;const T={tl:[S,g],br:[v,0]};return this.positions[c]=T,T}}Vt(IP,"LineAtlas");const O5=Qi.types,F5=Math.cos(Math.PI/180*37.5),B5=Math.cos(Math.PI/180*5);class cS{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new cg,this.layoutVertexArray2=new oa,this.patternVertexArray=new oa,this.indexArray=new Hr,this.programConfigurations=new L(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new er,this.maxLineLength=0,this.zOffsetVertexArray=new oa,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:128,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){this.hasPattern=A1("line",this.layers,this.pixelRatio,r);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=vt(c);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const z=this.layers[0].layout.get("line-z-offset"),D=z.isConstant()&&!z.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&D?"none":"offset",this.elevationType==="offset"&&_==="none"&&yi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const S=[];for(const{feature:z,id:D,index:k,sourceLayerIndex:$}of t){const H=this.layers[0]._featureFilter.needGeometry,j=Bi(z,H);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),j,c))continue;const q=g?g.evaluate(j,{},c):void 0,Y={id:D,properties:z.properties,type:z.type,sourceLayerIndex:$,index:k,geometry:H?j.geometry:fi(z,c,d),patterns:{},sortKey:q};S.push(Y)}g&&S.sort((z,D)=>z.sortKey-D.sortKey);const{lineAtlas:T,featureIndex:M}=r,A=this.addConstantDashes(T);for(const z of S){const{geometry:D,index:k,sourceLayerIndex:$}=z;if(A&&this.addFeatureDashes(z,T),this.hasPattern){const H=P1("line",this.layers,z,this.zoom,this.pixelRatio,r);this.patternFeatures.push(H)}else this.addFeature(z,D,k,c,T.positions,r.availableImages,r.brightness,r.elevationFeatures);M.insert(t[k].feature,D,k,$,this.index)}}addConstantDashes(t){let r=!1;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(d.kind!=="constant"||g.kind!=="constant")r=!0;else{const _=g.value,v=d.value;if(!v)continue;t.addDash(v,_)}}return r}addFeatureDashes(t,r){const c=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if(g.kind==="constant"&&_.kind==="constant")continue;let v,S;if(g.kind==="constant"){if(v=g.value,!v)continue}else v=g.evaluate({zoom:c},t);S=_.kind==="constant"?_.value:_.evaluate({zoom:c},t),r.addDash(v,S),t.patterns[d.id]=[r.getKey(v,S)]}}update(t,r,c,d,g,_,v,S){this.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,S)}addFeatures(t,r,c,d,g,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,c,d,_,t.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,L5)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,k5)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,z5.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,C5),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t,r){let c,d;if(r&&r>0?(c=`mapbox_clip_start_${r}`,d=`mapbox_clip_end_${r}`):(c="mapbox_clip_start",d="mapbox_clip_end"),t.properties&&t.properties.hasOwnProperty(c)&&t.properties.hasOwnProperty(d))return{start:+t.properties[c],end:+t.properties[d]}}addFeature(t,r,c,d,g,_,v,S){const T=this.layers[0].layout,M=T.get("line-join").evaluate(t,{}),A=T.get("line-cap").evaluate(t,{}),z=T.get("line-miter-limit"),D=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t;const k=!(!t.properties||!t.properties.hasOwnProperty("mapbox_line_metrics"))&&t.properties.mapbox_line_metrics;this.zOffsetValue=T.get("line-z-offset").value;const $=this.layers[0].paint.get("line-width").value;if($.kind!=="constant"&&$.isLineProgressConstant===!1&&(this.variableWidthValue=$),this.elevationType==="road"){const H=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(t,r,d,S,M,A,z,D)){const[j,q]=this.clipRuntimeLinesToTile(r,1);for(let Y=0;Y<j.length;Y++){const te=j[Y],ue=q[Y],ae={progress:{min:ue.progress.min,max:ue.progress.max},nextDir:this.computeSegNextDir(ue,te),prevDir:this.computeSegPrevDir(ue,te)};this.addLine(te,t,d,M,A,z,D,ae,k&&ue.parentIndex>0?ue.parentIndex:null)}this.fillNonElevatedRoadSegment(H)}}else for(let H=0;H<r.length;H++)this.addLine(r[H],t,d,M,A,z,D,void 0,k&&H>0?H:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,g,_,d,v,void 0,this.worldview)}computeSegNextDir(t,r){return t.nextPoint.sub(r.at(-2)).unit()}computeSegPrevDir(t,r){return r[1].sub(t.prevPoint).unit()}clipLinesToTile(t,r){return Ix(t,-r,-r,It+r,It+r)}clipRuntimeLinesToTile(t,r){const c=[];return[Ix(t,-r,-r,It+r,It+r,c),c]}addElevatedRoadFeature(t,r,c,d,g,_,v,S){const T=[],M=Zo.getElevationFeature(t,d);if(M){const A=this.clipLinesToTile(r,1),z=this.prepareElevatedLines(A,M,c);for(const D of z)T.push({geometry:D,elevation:M,elevationTileID:c,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const A of T){const z=this.layoutVertexArray.length;this.addLine(A.geometry,t,c,g,_,v,S);const D=new sa(c,A.elevationTileID);if(A.elevation)for(let k=z;k<this.layoutVertexArray.length;k++){const $=new Ae(this.layoutVertexArray.int16[6*k]>>1,this.layoutVertexArray.int16[6*k+1]>>1),H=D.pointElevation($,A.elevation,.05);this.updateHeightRange(H),this.zOffsetVertexArray.emplaceBack(H,0,0)}else this.fillNonElevatedRoadSegment(z)}return!0}prepareElevatedLines(t,r,c){if(r.constantHeight!=null)return t;const d=[],g=1/vt(c);for(const _ of t)Z$(_,new xs(r,g),0,d);return d}fillNonElevatedRoadSegment(t){for(let r=t;r<this.layoutVertexArray.length;r++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(t){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,t),this.heightRange.max=Math.max(this.heightRange.max,t)):this.heightRange={min:t,max:t}}addLine(t,r,c,d,g,_,v,S,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=T?this.lineFeatureClips(r,T):this.lineClips;const M=d==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const A=S&&S.progress.min>0,z=S&&S.progress.max<1;if(this.lineClips){let me={min:this.lineClips.start,max:this.lineClips.end},we=1;if(S){const qe=this.lineClips.end-this.lineClips.start;me=(function(Xe,at,nt){return{min:go(Xe.min,at,nt),max:go(Xe.max,at,nt)}})(S.progress,{min:0,max:1},me),qe>0&&(we=(me.max-me.min)/qe)}const Ie=+r.properties.mapbox_clip_feature_len,Je=+r.properties.mapbox_clip_seg_len;if(Number.isNaN(Ie)||Number.isNaN(Je)){for(let Xe=0;Xe<t.length-1;Xe++)this.totalDistance+=t[Xe].dist(t[Xe+1]);const qe=this.totalDistance/(me.max-me.min);this.totalFeatureLength=Number.isFinite(qe)?qe:0,this.lineClips.start=me.min,this.lineClips.end=me.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ie,this.distance=Je*we,this.lineClips.start=me.min,this.lineClips.end=me.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const D=O5[r.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let $=0;for(;$<k-1&&t[$].equals(t[$+1]);)$++;if(k<(D?3:2))return;d==="bevel"&&(_=1.05);const H=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let j,q,Y,te,ue,ae,ge,ye;S&&S.prevDir&&(ae=S.prevDir.perp()),S&&S.nextDir&&(ge=S.nextDir.perp()),this.e1=this.e2=-1,D&&(j=t[k-2],ue=t[$].sub(j)._unit()._perp());for(let me=$;me<k;me++){if(Y=me===k-1?D?t[$+1]:void 0:t[me+1],Y&&t[me].equals(Y))continue;ue&&(te=ue),j&&(q=j),j=t[me],ye=this.evaluateLineProgressFeatures(q?q.dist(j):0),ue=Y?Y.sub(j)._unit()._perp():te,te=te||ue;const we=q&&Y;let Ie=we?d:D||M?"butt":g;const Je=te.x*ue.x+te.y*ue.y;if(M){const et=function(ut){if(ut.patternJoinNone){const lt=ut.segmentPoints.length/2,Bt=ut.lineSoFar-ut.segmentStart;for(let Ut=0;Ut<lt;++Ut){const Tt=ut.segmentPoints[2*Ut+1],Mt=Math.round(ut.segmentPoints[2*Ut])+.5+.25*Tt;ut.patternVertexArray.emplaceBack(Mt,Bt,ut.segmentStart),ut.patternVertexArray.emplaceBack(Mt,Bt,ut.segmentStart)}ut.segmentPoints.length=0}ut.e1=ut.e2=-1};if(we&&Je<B5){this.updateDistance(q,j),this.addCurrentVertex(j,te,1,1,H,ye),et(this),this.addCurrentVertex(j,ue,-1,-1,H,ye);continue}if(q){if(!Y){this.updateDistance(q,j),this.addCurrentVertex(j,te,1,1,H,ye),et(this);continue}Ie="miter"}}let qe=te.add(ue);qe.x===0&&qe.y===0||qe._unit();const Xe=qe.x*ue.x+qe.y*ue.y,at=Xe!==0?1/Xe:1/0,nt=2*Math.sqrt(2-2*Xe),ot=Xe<F5&&q&&Y,Ge=te.x*ue.y-te.y*ue.x>0,ct=this.overscaling<=16?122880/(512*this.overscaling):0;if(we&&Ie==="round"){if(at<v)Ie="miter";else if(at<=2){const et=uS(j,-10,8202);Ie=this.elevationType==="offset"&&(et||this.hasCrossSlope)?"miter":"fakeround"}}if(Ie==="miter"&&at>_&&(Ie="bevel"),Ie==="bevel"&&(at>2&&(Ie="flipbevel"),at<_&&(Ie="miter")),q&&!(Ie==="miter"&&ot)&&this.updateDistance(q,j),Ie==="miter")if(ot){const et=j.dist(q);if(et>2*ct){const lt=j.sub(j.sub(q)._mult(ct/et)._round());this.updateDistance(q,lt),this.addCurrentVertex(lt,te,0,0,H,ye),q=lt}this.updateDistance(q,j),qe._mult(at),this.addCurrentVertex(j,qe,0,0,H,ye);const ut=j.dist(Y);if(ut>2*ct){const lt=j.add(Y.sub(j)._mult(ct/ut)._round());this.updateDistance(j,lt),this.addCurrentVertex(lt,ue,0,0,H,ye),j=lt}}else qe._mult(at),this.addCurrentVertex(j,qe,0,0,H,ye);else if(Ie==="flipbevel"){if(at>100)qe=ue.mult(-1);else{const et=at*te.add(ue).mag()/te.sub(ue).mag();qe._perp()._mult(et*(Ge?-1:1))}this.addCurrentVertex(j,qe,0,0,H,ye),this.addCurrentVertex(j,qe.mult(-1),0,0,H,ye)}else if(Ie==="bevel"||Ie==="fakeround"){ye!=null&&q&&this.addCurrentVertex(j,ge||te,-1,-1,H,ye);const et=j.dist(q)<=2*ct&&Ie!=="bevel",ut=qe.mult(Ge?1:-1);ut._mult(at);const lt=ue.mult(Ge?-1:1),Bt=te.mult(Ge?-1:1),Ut=this.evaluateLineProgressFeatures(this.distance);if(ye==null&&(this.addHalfVertex(j,ut.x,ut.y,!1,!Ge,0,H,Ut),et||this.addHalfVertex(j,ut.x+2*Bt.x,ut.y+2*Bt.y,!1,Ge,0,H,Ut)),Ie==="fakeround"){const Tt=Math.round(180*nt/Math.PI/20);this.addHalfVertex(j,Bt.x,Bt.y,!1,Ge,0,H,Ut);for(let Mt=0;Mt<Tt;Mt++){let ai=Mt/Tt;if(ai!==.5){const Ct=ai-.5;ai+=ai*Ct*(ai-1)*((1.0904+Je*(Je*(3.55645-1.43519*Je)-3.2452))*Ct*Ct+(.848013+Je*(.215638*Je-1.06021)))}const Jt=lt.sub(Bt)._mult(ai)._add(Bt)._unit();this.addHalfVertex(j,Jt.x,Jt.y,!1,Ge,0,H,Ut)}this.addHalfVertex(j,lt.x,lt.y,!1,Ge,0,H,Ut)}et||ye!=null||this.addHalfVertex(j,ut.x+2*lt.x,ut.y+2*lt.y,!1,Ge,0,H,Ut),ye!=null&&Y&&this.addCurrentVertex(j,ae||ue,1,1,H,ye)}else if(Ie==="butt")this.addCurrentVertex(j,qe,0,0,H,ye);else if(Ie==="square"){if(!q){const et=A?0:-1;this.addCurrentVertex(j,qe,et,et,H,ye)}if(this.addCurrentVertex(j,qe,0,0,H,ye),q){const et=z?0:1;this.addCurrentVertex(j,qe,et,et,H,ye)}}else if(Ie==="round"){if(q){const et=!we&&ge?ge:te;this.addCurrentVertex(j,et,0,0,H,ye),!we&&z||this.addCurrentVertex(j,et,1,1,H,ye,!0)}if(Y){const et=!we&&ae?ae:ue;!we&&A||this.addCurrentVertex(j,et,-1,-1,H,ye,!0),this.addCurrentVertex(j,et,0,0,H,ye)}}}}addVerticesTo(t,r,c,d,g,_,v,S,T,M){const A=(r.w-t.w)/this.tessellationStep|0;let z=0;const D=this.scaledDistance;if(A>1){this.lineSoFar=t.w;const $=(r.x-t.x)/A,H=(r.y-t.y)/A,j=(r.z-t.z)/A,q=(r.w-t.w)/A;for(let Y=1;Y<A;++Y){t.x+=$,t.y+=H,t.z+=j,this.lineSoFar+=q,z+=q;const te=this.evaluateLineProgressFeatures(this.prevDistance+z);this.scaledDistance=(this.prevDistance+z)/this.totalDistance,this.addHalfVertex(t,c,d,M,!1,v,T,te),this.addHalfVertex(t,g,_,M,!0,-S,T,te)}}this.lineSoFar=r.w,this.scaledDistance=D;const k=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,c,d,M,!1,v,T,k),this.addHalfVertex(r,g,_,M,!0,-S,T,k)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):yi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:r}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}}addCurrentVertex(t,r,c,d,g,_,v=!1){const S=r.x+r.y*c,T=r.y-r.x*c,M=r.y*d-r.x,A=-r.y-r.x*d;if(_!=null){const z=this.elevationType==="offset",D=-10,k=8202,$=_.zOffset,H=new VA(t.x,t.y,$,this.lineSoFar),j=!!z&&uS(t,D,k),q=this.lineSoFar,Y=this.distance;if(this.currentVertex)if(j){const te=this.currentVertexIsOutside,ue=this.currentVertex,ae=new VA(t.x,t.y,$,this.lineSoFar);if(GA(ue,ae,D,k),!uS(ae,D,k)){if(te){this.e1=this.e2=-1,this.distance-=ue.dist(H),this.lineSoFar=ue.w;const ge=this.evaluateLineProgressFeatures(ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ue,S,T,v,!1,c,g,ge),this.addHalfVertex(ue,M,A,v,!0,-d,g,ge),this.prevDistance=this.distance}this.distance=this.prevDistance+ue.dist(ae),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ue,ae,S,T,M,A,c,d,g,v),this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}}else{const te=this.currentVertex;if(this.currentVertexIsOutside){GA(te,H,D,k),this.e1=this.e2=-1,this.distance-=te.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=te.w;const ue=this.evaluateLineProgressFeatures(te.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(te,S,T,v,!1,c,g,ue),this.addHalfVertex(te,M,A,v,!0,-d,g,ue),this.prevDistance=this.distance,this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(te,H,S,T,M,A,c,d,g,v)}else j||(this.addHalfVertex(t,S,T,v,!1,c,g,_),this.addHalfVertex(t,M,A,v,!0,-d,g,_));this.currentVertex=H,this.currentVertexIsOutside=j,this.lineSoFar=q}else this.addHalfVertex(t,S,T,v,!1,c,g,_),this.addHalfVertex(t,M,A,v,!0,-d,g,_)}addHalfVertex({x:t,y:r},c,d,g,_,v,S,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(r<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=hi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const M=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),S.primitiveLength++),_?this.e2=M:this.e1=M,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,r){this.prevDistance=this.distance,this.distance+=t.dist(r),this.updateScaledDistance()}}function uS(a,t,r){return a.x<t||a.x>r||a.y<t||a.y>r}let MP,AP;function PP(a,t,r){return t*(It/(a.tileSize*Math.pow(2,r-a.tileID.overscaledZ)))}Vt(cS,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const zP=(a,t,r)=>(1-r)*a+r*t;function CP(a,t){return 1/PP(a,1,t.tileZoom)}function RP(a,t,r,c){return a.translatePosMatrix(c||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const LP=a=>{const t=[];DP(a)&&t.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=a.paint.get("line-trim-offset");r[0]===0&&r[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const c=a.layout.get("line-join").constantOr("miter")==="none",d=!!a.paint.get("line-pattern").constantOr(1);return c&&d&&t.push("LINE_JOIN_NONE"),t};function DP(a){const t=a.paint.get("line-dasharray").value;return t.kind!=="constant"||t.value}let hS;const kP=()=>hS||(hS={layout:MP||(MP=new ur({"line-cap":new Pt(ke.layout_line["line-cap"]),"line-join":new Pt(ke.layout_line["line-join"]),"line-miter-limit":new bt(ke.layout_line["line-miter-limit"]),"line-round-limit":new bt(ke.layout_line["line-round-limit"]),"line-sort-key":new Pt(ke.layout_line["line-sort-key"]),"line-z-offset":new Pt(ke.layout_line["line-z-offset"]),"line-elevation-reference":new bt(ke.layout_line["line-elevation-reference"]),"line-cross-slope":new bt(ke.layout_line["line-cross-slope"]),visibility:new bt(ke.layout_line.visibility),"line-width-unit":new bt(ke.layout_line["line-width-unit"])})),paint:AP||(AP=new ur({"line-opacity":new Pt(ke.paint_line["line-opacity"]),"line-color":new Pt(ke.paint_line["line-color"]),"line-translate":new bt(ke.paint_line["line-translate"]),"line-translate-anchor":new bt(ke.paint_line["line-translate-anchor"]),"line-width":new Pt(ke.paint_line["line-width"]),"line-gap-width":new Pt(ke.paint_line["line-gap-width"]),"line-offset":new Pt(ke.paint_line["line-offset"]),"line-blur":new Pt(ke.paint_line["line-blur"]),"line-dasharray":new Pt(ke.paint_line["line-dasharray"]),"line-pattern":new Pt(ke.paint_line["line-pattern"]),"line-pattern-cross-fade":new bt(ke.paint_line["line-pattern-cross-fade"]),"line-gradient":new fu(ke.paint_line["line-gradient"]),"line-trim-offset":new bt(ke.paint_line["line-trim-offset"]),"line-trim-fade-range":new bt(ke.paint_line["line-trim-fade-range"]),"line-trim-color":new bt(ke.paint_line["line-trim-color"]),"line-emissive-strength":new Pt(ke.paint_line["line-emissive-strength"]),"line-border-width":new Pt(ke.paint_line["line-border-width"]),"line-border-color":new Pt(ke.paint_line["line-border-color"]),"line-occlusion-opacity":new bt(ke.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},hS);class N5 extends Pt{possiblyEvaluate(t,r){return r=new An(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition,worldview:r.worldview}),super.possiblyEvaluate(t,r)}evaluate(t,r,c,d){return r=Object.assign({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,c,d)}}let Ng;function OP(a,t){return t>0?t+2*a:a}const U5=Yi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$5=Yi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),V5=Yi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const j5=Yi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),G5=Yi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),H5=Yi([{name:"a_texb",components:2,type:"Uint16"}]),Z5=Yi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),W5=Yi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const FP=Yi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),q5=Yi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yi([{name:"triangle",components:3,type:"Uint16"}]),Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Yi([{type:"Float32",name:"offsetX"}]),Yi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ao=24;function X5(a,t,r){return a.sections.forEach(c=>{c.text=(function(d,g,_){const v=g.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?d=d.toLocaleUpperCase():v==="lowercase"&&(d=d.toLocaleLowerCase()),ga.applyArabicShaping&&(d=ga.applyArabicShaping(d)),d})(c.text,t,r)}),a}const Ug={"!":"ï¸•","#":"ï¼ƒ",$:"ï¼„","%":"ï¼…","&":"ï¼†","(":"ï¸µ",")":"ï¸¶","*":"ï¼Š","+":"ï¼‹",",":"ï¸","-":"ï¸²",".":"ãƒ»","/":"ï¼",":":"ï¸“",";":"ï¸”","<":"ï¸¿","=":"ï¼",">":"ï¹€","?":"ï¸–","@":"ï¼ ","[":"ï¹‡","\\":"ï¼¼","]":"ï¹ˆ","^":"ï¼¾",_:"ï¸³","`":"ï½€","{":"ï¸·","|":"â€•","}":"ï¸¸","~":"ï½ž","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â€“":"ï¸²","â€”":"ï¸±","â€˜":"ï¹ƒ","â€™":"ï¹„","â€œ":"ï¹","â€":"ï¹‚","â€¦":"ï¸™","â€§":"ãƒ»","â‚©":"ï¿¦","ã€":"ï¸‘","ã€‚":"ï¸’","ã€ˆ":"ï¸¿","ã€‰":"ï¹€","ã€Š":"ï¸½","ã€‹":"ï¸¾","ã€Œ":"ï¹","ã€":"ï¹‚","ã€Ž":"ï¹ƒ","ã€":"ï¹„","ã€":"ï¸»","ã€‘":"ï¸¼","ã€”":"ï¸¹","ã€•":"ï¸º","ã€–":"ï¸—","ã€—":"ï¸˜","ï¼":"ï¸•","ï¼ˆ":"ï¸µ","ï¼‰":"ï¸¶","ï¼Œ":"ï¸","ï¼":"ï¸²","ï¼Ž":"ãƒ»","ï¼š":"ï¸“","ï¼›":"ï¸”","ï¼œ":"ï¸¿","ï¼ž":"ï¹€","ï¼Ÿ":"ï¸–","ï¼»":"ï¹‡","ï¼½":"ï¹ˆ","ï¼¿":"ï¸³","ï½›":"ï¸·","ï½œ":"â€•","ï½":"ï¸¸","ï½Ÿ":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸’","ï½¢":"ï¹","ï½£":"ï¹‚","â†":"â†‘","â†’":"â†“"};function J5(a){return a==="ï¸¶"||a==="ï¹ˆ"||a==="ï¸¸"||a==="ï¹„"||a==="ï¹‚"||a==="ï¸¾"||a==="ï¸¼"||a==="ï¸º"||a==="ï¸˜"||a==="ï¹€"||a==="ï¸"||a==="ï¸“"||a==="ï¸”"||a==="ï½€"||a==="ï¿£"||a==="ï¸‘"||a==="ï¸’"}function Y5(a){return a==="ï¸µ"||a==="ï¹‡"||a==="ï¸·"||a==="ï¹ƒ"||a==="ï¹"||a==="ï¸½"||a==="ï¸»"||a==="ï¸¹"||a==="ï¸—"||a==="ï¸¿"}const dS=4294967296,BP=1/dS,NP=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Fx=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,t,r=this.length){for(;this.pos<r;){const c=this.readVarint(),d=c>>3,g=this.pos;this.type=7&c,a(d,t,this),this.pos===g&&this.skip(c)}return t}readMessage(a,t){return this.readFields(a,t,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*dS;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*dS;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const t=this.buf;let r,c;return c=t[this.pos++],r=127&c,c<128?r:(c=t[this.pos++],r|=(127&c)<<7,c<128?r:(c=t[this.pos++],r|=(127&c)<<14,c<128?r:(c=t[this.pos++],r|=(127&c)<<21,c<128?r:(c=t[this.pos],r|=(15&c)<<28,(function(d,g,_){const v=_.buf;let S,T;if(T=v[_.pos++],S=(112&T)>>4,T<128||(T=v[_.pos++],S|=(127&T)<<3,T<128)||(T=v[_.pos++],S|=(127&T)<<10,T<128)||(T=v[_.pos++],S|=(127&T)<<17,T<128)||(T=v[_.pos++],S|=(127&T)<<24,T<128)||(T=v[_.pos++],S|=(1&T)<<31,T<128))return Ff(d,S,g);throw new Error("Expected varint not more than 10 bytes")})(r,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,t=this.pos;return this.pos=a,a-t>=12&&NP?NP.decode(this.buf.subarray(t,a)):(function(r,c,d){let g="",_=c;for(;_<d;){const v=r[_];let S,T,M,A=null,z=v>239?4:v>223?3:v>191?2:1;if(_+z>d)break;z===1?v<128&&(A=v):z===2?(S=r[_+1],(192&S)==128&&(A=(31&v)<<6|63&S,A<=127&&(A=null))):z===3?(S=r[_+1],T=r[_+2],(192&S)==128&&(192&T)==128&&(A=(15&v)<<12|(63&S)<<6|63&T,(A<=2047||A>=55296&&A<=57343)&&(A=null))):z===4&&(S=r[_+1],T=r[_+2],M=r[_+3],(192&S)==128&&(192&T)==128&&(192&M)==128&&(A=(15&v)<<18|(63&S)<<12|(63&T)<<6|63&M,(A<=65535||A>=1114112)&&(A=null))),A===null?(A=65533,z=1):A>65535&&(A-=65536,g+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),g+=String.fromCharCode(A),_+=z}return g})(this.buf,t,a)}readBytes(){const a=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,a);return this.pos=a,t}readPackedVarint(a=[],t){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readVarint(t));return a}readPackedSVarint(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const t=7&a;if(t===0)for(;this.buf[this.pos++]>127;);else if(t===2)this.pos=this.readVarint()+this.pos;else if(t===5)this.pos+=4;else{if(t!==1)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(a,t){this.writeVarint(a<<3|t)}realloc(a){let t=this.length||16;for(;t<this.pos+a;)t*=2;if(t!==this.length){const r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*BP),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*BP),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(t,r){let c,d;if(t>=0?(c=t%4294967296|0,d=t/4294967296|0):(c=~(-t%4294967296),d=~(-t/4294967296),4294967295^c?c=c+1|0:(c=0,d=d+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),(function(g,_,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)})(c,0,r),(function(g,_){const v=(7&g)<<4;_.buf[_.pos++]|=v|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))})(d,r)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const t=this.pos;this.pos=(function(c,d,g){for(let _,v,S=0;S<d.length;S++){if(_=d.charCodeAt(S),_>55295&&_<57344){if(!v){_>56319||S+1===d.length?(c[g++]=239,c[g++]=191,c[g++]=189):v=_;continue}if(_<56320){c[g++]=239,c[g++]=191,c[g++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(c[g++]=239,c[g++]=191,c[g++]=189,v=null);_<128?c[g++]=_:(_<2048?c[g++]=_>>6|192:(_<65536?c[g++]=_>>12|224:(c[g++]=_>>18|240,c[g++]=_>>12&63|128),c[g++]=_>>6&63|128),c[g++]=63&_|128)}return g})(this.buf,a,this.pos);const r=this.pos-t;r>=128&&UP(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const t=a.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=a[r]}writeRawMessage(a,t){this.pos++;const r=this.pos;a(t,this);const c=this.pos-r;c>=128&&UP(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c}writeMessage(a,t,r){this.writeTag(a,2),this.writeRawMessage(t,r)}writePackedVarint(a,t){t.length&&this.writeMessage(a,K5,t)}writePackedSVarint(a,t){t.length&&this.writeMessage(a,Q5,t)}writePackedBoolean(a,t){t.length&&this.writeMessage(a,iV,t)}writePackedFloat(a,t){t.length&&this.writeMessage(a,eV,t)}writePackedDouble(a,t){t.length&&this.writeMessage(a,tV,t)}writePackedFixed32(a,t){t.length&&this.writeMessage(a,nV,t)}writePackedSFixed32(a,t){t.length&&this.writeMessage(a,rV,t)}writePackedFixed64(a,t){t.length&&this.writeMessage(a,oV,t)}writePackedSFixed64(a,t){t.length&&this.writeMessage(a,sV,t)}writeBytesField(a,t){this.writeTag(a,2),this.writeBytes(t)}writeFixed32Field(a,t){this.writeTag(a,5),this.writeFixed32(t)}writeSFixed32Field(a,t){this.writeTag(a,5),this.writeSFixed32(t)}writeFixed64Field(a,t){this.writeTag(a,1),this.writeFixed64(t)}writeSFixed64Field(a,t){this.writeTag(a,1),this.writeSFixed64(t)}writeVarintField(a,t){this.writeTag(a,0),this.writeVarint(t)}writeSVarintField(a,t){this.writeTag(a,0),this.writeSVarint(t)}writeStringField(a,t){this.writeTag(a,2),this.writeString(t)}writeFloatField(a,t){this.writeTag(a,5),this.writeFloat(t)}writeDoubleField(a,t){this.writeTag(a,1),this.writeDouble(t)}writeBooleanField(a,t){this.writeVarintField(a,+t)}};function Ff(a,t,r){return r?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function UP(a,t,r){const c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(c);for(let d=r.pos-1;d>=a;d--)r.buf[d+c]=r.buf[d]}function K5(a,t){for(let r=0;r<a.length;r++)t.writeVarint(a[r])}function Q5(a,t){for(let r=0;r<a.length;r++)t.writeSVarint(a[r])}function eV(a,t){for(let r=0;r<a.length;r++)t.writeFloat(a[r])}function tV(a,t){for(let r=0;r<a.length;r++)t.writeDouble(a[r])}function iV(a,t){for(let r=0;r<a.length;r++)t.writeBoolean(a[r])}function nV(a,t){for(let r=0;r<a.length;r++)t.writeFixed32(a[r])}function rV(a,t){for(let r=0;r<a.length;r++)t.writeSFixed32(a[r])}function oV(a,t){for(let r=0;r<a.length;r++)t.writeFixed64(a[r])}function sV(a,t){for(let r=0;r<a.length;r++)t.writeSFixed64(a[r])}function aV(a,t,r){t.glyphs=[],a===1&&r.readMessage(lV,t)}function lV(a,t,r){if(a===3){const{id:c,bitmap:d,width:g,height:_,left:v,top:S,advance:T}=r.readMessage(cV,{});t.glyphs.push({id:c,bitmap:new Su({width:g+6,height:_+6},d),metrics:{width:g,height:_,left:v,top:S,advance:T}})}else a===4?t.ascender=r.readSVarint():a===5&&(t.descender=r.readSVarint())}function cV(a,t,r){a===1?t.id=r.readVarint():a===2?t.bitmap=r.readBytes():a===3?t.width=r.readVarint():a===4?t.height=r.readVarint():a===5?t.left=r.readSVarint():a===6?t.top=r.readSVarint():a===7&&(t.advance=r.readVarint())}const Zs={horizontal:1,vertical:2,horizontalOnly:3};class $g{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,r){const c=new $g;return c.scale=t||1,c.fontStack=r,c}static forImage(t){const r=new $g;return r.image=t,r}}class Bf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r,c){const d=new Bf;for(let g=0;g<t.sections.length;g++){const _=t.sections[g];_.image?d.addImageSection(_,c):d.addTextSection(_,r)}return d}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=(function(r,c){let d="";for(let g=0;g<r.length;g++){const _=r.charCodeAt(g+1)||null,v=r.charCodeAt(g-1)||null;d+=!c&&(_&&qm(_)&&!Ug[r[g+1]]||v&&qm(v)&&!Ug[r[g-1]])||!Ug[r[g]]?r[g]:Ug[r[g]]}return d})(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&Bx[this.text.charCodeAt(c)];c++)t++;let r=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&Bx[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const c=new Bf;return c.text=this.text.substring(t,r),c.sectionIndex=this.sectionIndex.slice(t,r),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push($g.forText(t.scale,t.fontStack||r));const c=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(c)}addImageSection(t,r){const c=t.image?t.image.getPrimary():null;if(!c)return void yi("Can't add FormattedSection with an empty image.");c.scaleSelf(r);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push($g.forImage(c)),this.sectionIndex.push(this.sections.length-1)):yi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fS(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$=1){const H=Bf.fromFeature(a,d,$);A===Zs.vertical&&H.verticalizePunctuation(z);let j=[];const q=(function(ge,ye,me,we,Ie,Je){if(!ge)return[];const qe=[],Xe=(function(ot,Ge,ct,et,ut,lt){let Bt=0;for(let Ut=0;Ut<ot.length();Ut++){const Tt=ot.getSection(Ut);Bt+=$P(ot.getCodePoint(Ut),Tt,et,ut,Ge,lt)}return Bt/Math.max(1,Math.ceil(Bt/ct))})(ge,ye,me,we,Ie,Je),at=ge.text.indexOf("â€‹")>=0;let nt=0;for(let ot=0;ot<ge.length();ot++){const Ge=ge.getSection(ot),ct=ge.getCodePoint(ot);if(Bx[ct]||(nt+=$P(ct,Ge,we,Ie,ye,Je)),ot<ge.length()-1){const et=Lv(ct);(uV[ct]||et||Ge.image)&&qe.push(jP(ot+1,nt,Xe,qe,hV(ct,ge.getCodePoint(ot+1),et&&at),!1))}}return GP(jP(ge.length(),nt,Xe,qe,0,!0))})(H,T,g,t,c,D),{processBidirectionalText:Y,processStyledBidirectionalText:te}=ga;if(Y&&H.sections.length===1){const ge=Y(H.toString(),q);for(const ye of ge){const me=new Bf;me.text=ye,me.sections=H.sections;for(let we=0;we<ye.length;we++)me.sectionIndex.push(0);j.push(me)}}else if(te){const ge=te(H.text,H.sectionIndex,q);for(const ye of ge){const me=new Bf;me.text=ye[0],me.sectionIndex=ye[1],me.sections=H.sections,j.push(me)}}else j=(function(ge,ye){const me=[],we=ge.text;let Ie=0;for(const Je of ye)me.push(ge.substring(Ie,Je)),Ie=Je;return Ie<we.length&&me.push(ge.substring(Ie,we.length)),me})(H,q);const ue=[],ae={positionedLines:ue,text:H.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(ge,ye,me,we,Ie,Je,qe,Xe,at,nt,ot,Ge){let ct=0,et=0,ut=0;const lt=Xe==="right"?1:Xe==="left"?0:.5;let Bt=!1;for(const Jt of Ie){const Ct=Jt.getSections();for(const xi of Ct){if(xi.image)continue;const Wi=ye[xi.fontStack];if(Wi&&(Bt=Wi.ascender!==void 0&&Wi.descender!==void 0,!Bt))break}if(!Bt)break}let Ut=0;for(const Jt of Ie){Jt.trim();const Ct=Jt.getMaxScale(),xi=(Ct-1)*ao,Wi={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Ut]=Wi;const mn=Wi.positionedGlyphs;let Gi=0;if(!Jt.length()){et+=Je,++Ut;continue}let Pn=0,sn=0;for(let ln=0;ln<Jt.length();ln++){const In=Jt.getSection(ln),Yn=Jt.getSectionIndex(ln),or=Jt.getCodePoint(ln);let sr=In.scale,Sr=null,vo=null,Ao=null,Ur=ao,Wr=0,Qr=at;Qr===Zs.vertical&&Dv(or)&&(Qr=Zs.horizontal);const Ui=!(Qr===Zs.horizontal||!ot&&!Zl(or)||ot&&(Bx[or]||gf(or)));if(In.image){const ar=we.get(In.image.toString());if(!ar)continue;Ao=In.image,ge.iconsInText=ge.iconsInText||!0,vo=ar.paddedRect;const dr=ar.displaySize;sr=sr*ao/Ge,Sr={width:dr[0],height:dr[1],left:0,top:-3,advance:Ui?dr[1]:dr[0],localGlyph:!1},Wr=Bt?-Sr.height*sr:Ct*ao-17-dr[1]*sr,Ur=Sr.advance;const Ws=(Ui?dr[0]:dr[1])*sr-ao*Ct;Ws>0&&Ws>Gi&&(Gi=Ws)}else{const ar=me[In.fontStack];if(!ar)continue;ar[or]&&(vo=ar[or]);const dr=ye[In.fontStack];if(!dr)continue;const Ws=dr.glyphs[or];if(!Ws)continue;if(Sr=Ws.metrics,Ur=or!==8203?ao:0,Bt){const Xo=dr.ascender!==void 0?Math.abs(dr.ascender):0,xo=dr.descender!==void 0?Math.abs(dr.descender):0,Jo=(Xo+xo)*sr;Pn<Jo&&(Pn=Jo,sn=(Xo-xo)/2*sr),Wr=-Xo*sr}else Wr=(Ct-sr)*ao-17}Ui?(ge.verticalizable=!0,mn.push({glyph:or,image:Ao,x:ct,y:et+Wr,vertical:Ui,scale:sr,localGlyph:Sr.localGlyph,fontStack:In.fontStack,sectionIndex:Yn,metrics:Sr,rect:vo}),ct+=Ur*sr+nt):(mn.push({glyph:or,image:Ao,x:ct,y:et+Wr,vertical:Ui,scale:sr,localGlyph:Sr.localGlyph,fontStack:In.fontStack,sectionIndex:Yn,metrics:Sr,rect:vo}),ct+=Sr.advance*sr+nt)}mn.length!==0&&(ut=Math.max(ct-nt,ut),Bt?HP(mn,lt,Gi,sn,Je*Ct/2):HP(mn,lt,Gi,0,Je/2)),ct=0;const wr=Je*Ct+Gi;Wi.lineOffset=Math.max(Gi,xi),et+=wr,++Ut}const Tt=et,{horizontalAlign:Mt,verticalAlign:ai}=pS(qe);(function(Jt,Ct,xi,Wi,mn,Gi){const Pn=(Ct-xi)*mn,sn=-Gi*Wi;for(const wr of Jt)for(const ln of wr.positionedGlyphs)ln.x+=Pn,ln.y+=sn})(ge.positionedLines,lt,Mt,ai,ut,Tt),ge.top+=-ai*Tt,ge.bottom=ge.top+Tt,ge.left+=-Mt*ut,ge.right=ge.left+ut,ge.hasBaseline=Bt})(ae,t,r,c,j,_,v,S,A,T,z,k),!(function(ge){for(const ye of ge)if(ye.positionedGlyphs.length!==0)return!1;return!0})(ue))return ae}const Bx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uV={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $P(a,t,r,c,d,g){if(t.image){const _=c.get(t.image.toString());return _?_.displaySize[0]*t.scale*ao/g+d:0}{const _=r[t.fontStack],v=_&&_.glyphs[a];return v?v.metrics.advance*t.scale+d:0}}function VP(a,t,r,c){const d=Math.pow(a-t,2);return c?a<t?d/2:2*d:d+Math.abs(r)*r}function hV(a,t,r){let c=0;return a===10&&(c-=1e4),r&&(c+=150),a!==40&&a!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function jP(a,t,r,c,d,g){let _=null,v=VP(t,r,d,g);for(const S of c){const T=VP(t-S.x,r,d,g)+S.badness;T<=v&&(_=S,v=T)}return{index:a,x:t,priorBreak:_,badness:v}}function GP(a){return a?GP(a.priorBreak).concat(a.index):[]}function pS(a){let t=.5,r=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function HP(a,t,r,c,d){if(!(t||r||c||d))return;const g=a.length-1,_=a[g],v=(_.x+_.metrics.advance*_.scale)*t;for(let S=0;S<=g;S++)a[S].x-=v,a[S].y+=r+c+d}function mS(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function Nx(a,t,r,c){const{horizontalAlign:d,verticalAlign:g}=pS(c),_=r[0]-a.displaySize[0]*d,v=r[1]-a.displaySize[1]*g;return{imagePrimary:a,imageSecondary:t,top:v,bottom:v+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function gS(a,t,r,c,d,g){const _=a.imagePrimary;let v;if(_.content){const H=_.content,j=_.pixelRatio||1;v=[H[0]/j,H[1]/j,_.displaySize[0]-H[2]/j,_.displaySize[1]-H[3]/j]}const S=t.left*g,T=t.right*g;let M,A,z,D;r==="width"||r==="both"?(D=d[0]+S-c[3],A=d[0]+T+c[1]):(D=d[0]+(S+T-_.displaySize[0])/2,A=D+_.displaySize[0]);const k=t.top*g,$=t.bottom*g;return r==="height"||r==="both"?(M=d[1]+k-c[0],z=d[1]+$+c[2]):(M=d[1]+(k+$-_.displaySize[1])/2,z=M+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:M,right:A,bottom:z,left:D,collisionPadding:v}}function ZP(a){return!a.imagePrimary.stretchX}function WP(a){return!a.imagePrimary.stretchY}function qP(a){return{width:a.right-a.left,height:a.bottom-a.top}}const Pc=128;function Yh(a,t,r,c){const{expression:d}=t;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new An(a+1,{worldview:r}),void 0,void 0,void 0,c)};if(d.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:_}=d;let v=0;for(;v<g.length&&g[v]<=a;)v++;v=Math.max(0,v-1);let S=v;for(;S<g.length&&g[S]<a+1;)S++;S=Math.min(g.length-1,S);const T=g[v],M=g[S];return d.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:M,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:M,minSize:d.evaluate(new An(T,{worldview:r}),void 0,void 0,void 0,c),maxSize:d.evaluate(new An(M,{worldview:r}),void 0,void 0,void 0,c),interpolationType:_}}}function _S(a,{uSize:t,uSizeT:r},{lowerSize:c,upperSize:d}){return a.kind==="source"?c/Pc:a.kind==="composite"?hi(c/Pc,d/Pc,r):t}function Nf(a,t,r=1){let c=0,d=0;if(a.kind==="constant")d=a.layoutSize*r;else if(a.kind!=="source"){const{interpolationType:g,minZoom:_,maxZoom:v}=a,S=g?de(Ns.interpolationFactor(g,t,_,v),0,1):0;a.kind==="camera"?d=hi(a.minSize,a.maxSize,S)*r:c=S*r}return{uSizeT:c,uSize:d}}class zc extends Ae{constructor(t,r,c,d,g){super(t,r),this.angle=d,this.z=c,g!==void 0&&(this.segment=g)}clone(){return new zc(this.x,this.y,this.z,this.angle,this.segment)}}function XP(a,t,r,c,d){if(t.segment===void 0)return!0;let g=t,_=t.segment+1,v=0;for(;v>-r/2;){if(_--,_<0)return!1;v-=a[_].dist(g),g=a[_]}v+=a[_].dist(a[_+1]),_++;const S=[];let T=0;for(;v<r/2;){const M=a[_],A=a[_+1];if(!A)return!1;let z=a[_-1].angleTo(M)-M.angleTo(A);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:z}),T+=z;v-S[0].distance>c;)T-=S.shift().angleDelta;if(T>d)return!1;_++,v+=M.dist(A)}return!0}function JP(a){let t=0;for(let r=0;r<a.length-1;r++)t+=a[r].dist(a[r+1]);return t}function YP(a,t,r){return a?.6*t*r:0}function KP(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function dV(a,t,r,c,d,g){const _=YP(r,d,g),v=KP(r,c)*g;let S=0;const T=JP(a)/2;for(let M=0;M<a.length-1;M++){const A=a[M],z=a[M+1],D=A.dist(z);if(S+D>T){const k=(T-S)/D,$=hi(A.x,z.x,k),H=hi(A.y,z.y,k),j=new zc($,H,0,z.angleTo(A),M);return!_||XP(a,j,v,_,t)?j:void 0}S+=D}}function fV(a,t,r,c,d,g,_,v,S){const T=YP(c,g,_),M=KP(c,d),A=M*_,z=a[0].x===0||a[0].x===S||a[0].y===0||a[0].y===S;return t-A<t/4&&(t=A+t/4),QP(a,z?t/2*v%t:(M/2+2*g)*_*v%t,t,T,r,A,z,!1,S)}function QP(a,t,r,c,d,g,_,v,S){const T=g/2,M=JP(a);let A=0,z=t-r,D=[];for(let k=0;k<a.length-1;k++){const $=a[k],H=a[k+1],j=$.dist(H),q=H.angleTo($);for(;z+r<A+j;){z+=r;const Y=(z-A)/j,te=hi($.x,H.x,Y),ue=hi($.y,H.y,Y);if(te>=0&&te<S&&ue>=0&&ue<S&&z-T>=0&&z+T<=M){const ae=new zc(te,ue,0,q,k);c&&!XP(a,ae,g,c,d)||D.push(ae)}}A+=j}return v||D.length||_||(D=QP(a,A/2,r,c,d,g,_,!0,S)),D}function ez(a){let t=0,r=0;for(const _ of a)t+=_.w*_.h,r=Math.max(r,_.w);a.sort((_,v)=>v.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let d=0,g=0;for(const _ of a)for(let v=c.length-1;v>=0;v--){const S=c[v];if(!(_.w>S.w||_.h>S.h)){if(_.x=S.x,_.y=S.y,g=Math.max(g,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===S.w&&_.h===S.h){const T=c.pop();T&&v<c.length&&(c[v]=T)}else _.h===S.h?(S.x+=_.w,S.w-=_.w):_.w===S.w?(S.y+=_.h,S.h-=_.h):(c.push({x:S.x+_.w,y:S.y,w:S.w-_.w,h:_.h}),S.y+=_.h,S.h-=_.h);break}}return{w:d,h:g,fill:t/(d*g)||0}}Vt(zc,"Anchor");class Vg{static getImagePositionScale(t,r,c){if(r&&t){const{sx:d,sy:g}=t;return{x:d,y:g}}return{x:c,y:c}}constructor(t,r,c,d){this.paddedRect=t;const{pixelRatio:g,version:_,stretchX:v,stretchY:S,content:T,sdf:M,usvg:A}=r;this.pixelRatio=g,this.stretchX=v,this.stretchY=S,this.content=T,this.version=_,this.padding=c,this.sdf=M,this.usvg=A,this.scale=Vg.getImagePositionScale(d,A,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function yS(a,t,r){const c=os.parse(a),d=(function(g,_,v=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*v[0])+2*_,h:(g.data?g.data.height:g.height*v[1])+2*_}})(t,r,[c.sx,c.sy]);return{bin:d,imagePosition:new Vg(d,t,r,c),imageVariant:c}}class tz{constructor(t,r,c){const d=new Map,g=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(t,d,1,_),this.addImages(r,g,2,_);const{w:v,h:S}=ez(_),T=new Mo({width:v||1,height:S||1});for(const[M,A]of t.entries()){const z=d.get(M).paddedRect;Mo.copy(A.data,T,{x:0,y:0},{x:z.x+1,y:z.y+1},A.data,null,A.sdf)}for(const[M,A]of r.entries()){const z=g.get(M),D=z.paddedRect;let k=z.padding;const $=D.x+k,H=D.y+k,j=A.data.width,q=A.data.height;k=k>1?k-1:k,Mo.copy(A.data,T,{x:0,y:0},{x:$,y:H},A.data,c),Mo.copy(A.data,T,{x:0,y:q-k},{x:$,y:H-k},{width:j,height:k},c),Mo.copy(A.data,T,{x:0,y:0},{x:$,y:H+q},{width:j,height:k},c),Mo.copy(A.data,T,{x:j-k,y:0},{x:$-k,y:H},{width:k,height:q},c),Mo.copy(A.data,T,{x:0,y:0},{x:$+j,y:H},{width:k,height:q},c),Mo.copy(A.data,T,{x:j-k,y:q-k},{x:$-k,y:H-k},{width:k,height:k},c),Mo.copy(A.data,T,{x:0,y:q-k},{x:$+j,y:H-k},{width:k,height:k},c),Mo.copy(A.data,T,{x:0,y:0},{x:$+j,y:H+q},{width:k,height:k},c),Mo.copy(A.data,T,{x:j-k,y:0},{x:$-k,y:H+q},{width:k,height:k},c)}this.lut=c,this.image=T,this.iconPositions=d,this.patternPositions=g}addImages(t,r,c,d){for(const[g,_]of t.entries()){const{bin:v,imagePosition:S,imageVariant:T}=yS(g,_,c);r.set(g,S),d.push(v),_.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(t,r,c,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>t.hasImage(g,c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const g of t.getUpdatedImages(c)){for(const _ of this.iconPositions.keys()){const v=os.parse(_);if(ns.isEqual(v.id,g)){const S=t.getImage(g,c);this.patchUpdatedImage(this.iconPositions.get(_),S,r,null)}}for(const _ of this.patternPositions.keys()){const v=os.parse(_);if(ns.isEqual(v.id,g)){const S=t.getImage(g,c);this.patchUpdatedImage(this.patternPositions.get(_),S,r,d||this.lut)}}}}patchUpdatedImage(t,r,c,d=null){if(!t||!r||t.version===r.version)return;t.version=r.version;const[g,_]=t.tl,v=t.sdf;if(this.lut||v){const S={width:r.data.width,height:r.data.height},T=new Mo(S);Mo.copy(r.data,T,{x:0,y:0},{x:0,y:0},S,d,v),c.update(T,{position:{x:g,y:_}})}else c.update(r.data,{position:{x:g,y:_}})}}Vt(Vg,"ImagePosition"),Vt(tz,"ImageAtlas",{omit:["lut"]});const jg=1e20;function iz(a,t,r,c,d,g,_,v,S){for(let T=t;T<t+c;T++)nz(a,r*g+T,g,d,_,v,S);for(let T=r;T<r+d;T++)nz(a,T*g+t,1,c,_,v,S)}function nz(a,t,r,c,d,g,_){g[0]=0,_[0]=-jg,_[1]=jg,d[0]=a[t];for(let v=1,S=0,T=0;v<c;v++){d[v]=a[t+v*r];const M=v*v;do{const A=g[S];T=(d[v]-d[A]+M-A*A)/(v-A)/2}while(T<=_[S]&&--S>-1);S++,g[S]=v,_[S]=T,_[S+1]=jg}for(let v=0,S=0;v<c;v++){for(;_[S+1]<v;)S++;const T=g[S],M=v-T;a[t+v*r]=d[T]+M*M}}const vS={none:0,ideographs:1,all:2};class Uf{constructor(t,r,c){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=c,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,r){const c=[],d=this.url||jr.GLYPHS_URL;for(const g in t)for(const _ of t[g])c.push({stack:g,id:_});Pe(c,({stack:g,id:_},v)=>{let S=this.entries[g];S||(S=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=S.glyphs[_];if(T!==void 0)return void v(null,{stack:g,id:_,glyph:T});if(T=this._tinySDF(S,g,_),T)return S.glyphs[_]=T,void v(null,{stack:g,id:_,glyph:T});const M=Math.floor(_/256);if(256*M>65535)return yi("glyphs > 65535 not supported"),void v(null,{stack:g,id:_,glyph:T});if(S.ranges[M])return void v(null,{stack:g,id:_,glyph:T});let A=S.requests[M];A||(A=S.requests[M]=[],Uf.loadGlyphRange(g,M,d,this.requestManager,(z,D)=>{if(D){S.ascender=D.ascender,S.descender=D.descender;for(const k in D.glyphs)this._doesCharSupportLocalGlyph(+k)||(S.glyphs[+k]=D.glyphs[+k]);S.ranges[M]=!0}for(const k of A)k(z,D);delete S.requests[M]})),A.push((z,D)=>{z?v(z):D&&v(null,{stack:g,id:_,glyph:D.glyphs[_]||null})})},(g,_)=>{if(g)r(g);else if(_){const v={};for(const{stack:S,id:T,glyph:M}of _)v[S]===void 0&&(v[S]={}),v[S].glyphs===void 0&&(v[S].glyphs={}),v[S].glyphs[T]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},v[S].ascender=this.entries[S].ascender,v[S].descender=this.entries[S].descender;r(null,v)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==vS.none&&(this.localGlyphMode===vS.all?!!this.localFontFamily:!!this.localFontFamily&&(pf(t)||Pv(t)||uu(t)||Ph(t)||cu(t)||hu(t)||(r=t)>=131072&&r<=173791||(c=>c>=66736&&c<=66815)(t)));var r}_tinySDF(t,r,c){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let g=t.tinySDF;if(!g){let $="400";/bold/i.test(r)?$="900":/medium/i.test(r)?$="500":/light/i.test(r)&&($="200"),g=t.tinySDF=new Uf.TinySDF({fontFamily:d,fontWeight:$,fontSize:48,buffer:6,radius:16}),g.fontWeight=$}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const _=String.fromCodePoint(c),{data:v,width:S,height:T,glyphWidth:M,glyphHeight:A,glyphLeft:z,glyphTop:D,glyphAdvance:k}=g.draw(_);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Su({width:S,height:T},v),metrics:{width:M/2,height:A/2,left:z/2,top:D/2-27,advance:k/2,localGlyph:!0}}}}function rz(a,t){return a+t[1]-t[0]}function xS(a,t,r,c,d=1){const g=[],_=a.imagePrimary,v=_.pixelRatio,S=_.paddedRect.w-2,T=_.paddedRect.h-2,M=(a.right-a.left)*d,A=(a.bottom-a.top)*d,z=_.stretchX||[[0,S]],D=_.stretchY||[[0,T]],k=z.reduce(rz,0),$=D.reduce(rz,0),H=S-k,j=T-$;let q=0,Y=k,te=0,ue=$,ae=0,ge=H,ye=0,me=j;if(_.content&&c){const Ie=_.content;q=Ux(z,0,Ie[0]),te=Ux(D,0,Ie[1]),Y=Ux(z,Ie[0],Ie[2]),ue=Ux(D,Ie[1],Ie[3]),ae=Ie[0]-q,ye=Ie[1]-te,ge=Ie[2]-Ie[0]-Y,me=Ie[3]-Ie[1]-ue}const we=(Ie,Je,qe,Xe)=>{const at=$x(Ie.stretch-q,Y,M,a.left*d),nt=Vx(Ie.fixed-ae,ge,Ie.stretch,k),ot=$x(Je.stretch-te,ue,A,a.top*d),Ge=Vx(Je.fixed-ye,me,Je.stretch,$),ct=$x(qe.stretch-q,Y,M,a.left*d),et=Vx(qe.fixed-ae,ge,qe.stretch,k),ut=$x(Xe.stretch-te,ue,A,a.top*d),lt=Vx(Xe.fixed-ye,me,Xe.stretch,$),Bt=new Ae(at,ot),Ut=new Ae(ct,ot),Tt=new Ae(ct,ut),Mt=new Ae(at,ut),ai=new Ae(nt/v,Ge/v),Jt=new Ae(et/v,lt/v),Ct=t*Math.PI/180;if(Ct){const sn=Math.sin(Ct),wr=Math.cos(Ct),ln=[wr,-sn,sn,wr];Bt._matMult(ln),Ut._matMult(ln),Mt._matMult(ln),Tt._matMult(ln)}const xi=Ie.stretch+Ie.fixed,Wi=qe.stretch+qe.fixed,mn=Je.stretch+Je.fixed,Gi=Xe.stretch+Xe.fixed,Pn=a.imageSecondary;return{tl:Bt,tr:Ut,bl:Mt,br:Tt,texPrimary:{x:_.paddedRect.x+1+xi,y:_.paddedRect.y+1+mn,w:Wi-xi,h:Gi-mn},texSecondary:Pn?{x:Pn.paddedRect.x+1+xi,y:Pn.paddedRect.y+1+mn,w:Wi-xi,h:Gi-mn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ai,pixelOffsetBR:Jt,minFontScaleX:ge/v/M,minFontScaleY:me/v/A,isSDF:r}};if(_.stretchX||_.stretchY){const Ie=oz(z,H,k),Je=oz(D,j,$);for(let qe=0;qe<Ie.length-1;qe++){const Xe=Ie[qe],at=Ie[qe+1];for(let nt=0;nt<Je.length-1;nt++)g.push(we(Xe,Je[nt],at,Je[nt+1]))}}else g.push(we({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:T+1}));return g}function pV(a,t){const r=a.stretchY||[[0,a.paddedRect.h-2]];return a.stretchX||a.stretchY?sz(a.stretchX||[[0,a.paddedRect.w-2]])*sz(r):1}function Ux(a,t,r){let c=0;for(const d of a)c+=Math.max(t,Math.min(r,d[1]))-Math.max(t,Math.min(r,d[0]));return c}function oz(a,t,r){const c=[{fixed:-1,stretch:0}];for(const[d,g]of a){const _=c[c.length-1];c.push({fixed:d-_.stretch,stretch:_.stretch}),c.push({fixed:d-_.stretch,stretch:_.stretch+(g-d)})}return c.push({fixed:t+1,stretch:r}),c}function sz(a){return 2*a.length+1}function $x(a,t,r,c){return a/t*r+c}function Vx(a,t,r,c){return a-t*r/c}function mV(a,t,r,c){const d=t+a.positionedLines[c].lineOffset;return c===0?r+d/2:r+(d+(t+a.positionedLines[c-1].lineOffset))/2}function az(a,t,r,c,d,g,_,v,S){const T=[];if(t.positionedLines.length===0)return T;const M=(S!==void 0?S:c.layout.get("text-rotate").evaluate(g,{}))*Math.PI/180,A=(function(H){const j=H[0],q=H[1],Y=j*q;return Y>0?[j,-q]:Y<0?[-j,q]:j===0?[q,j]:[q,-j]})(r);let z=Math.abs(t.top-t.bottom);for(const H of t.positionedLines)z-=H.lineOffset;const D=t.positionedLines.length,k=z/D;let $=t.top-r[1];for(let H=0;H<D;++H){const j=t.positionedLines[H];$=mV(t,k,$,H);for(const q of j.positionedGlyphs){if(!q.rect)continue;const Y=q.rect||{};let te=4,ue=!0,ae=1,ge=0;if(q.image){const Ut=_.get(q.image.toString());if(!Ut)continue;if(Ut.sdf){yi("SDF images are not supported in formatted text and will be ignored.");continue}ue=!1,ae=Ut.pixelRatio,te=1/ae}const ye=(d||v)&&q.vertical,me=q.metrics.advance*q.scale/2,we=q.metrics,Ie=q.rect;if(Ie===null)continue;v&&t.verticalizable&&(ge=q.image?me-q.metrics.width*q.scale/2:0);const Je=d?[q.x+me,q.y]:[0,0];let qe=[0,0],Xe=[0,0],at=!1;d||(ye?(Xe=[q.x+me+A[0],q.y+A[1]-ge],at=!0):qe=[q.x+me+r[0],q.y+r[1]-ge]);const nt=Ie.w*q.scale/(ae*(q.localGlyph?2:1)),ot=Ie.h*q.scale/(ae*(q.localGlyph?2:1));let Ge,ct,et,ut;if(ye){const Ut=q.y-$,Tt=new Ae(-me,me-Ut),Mt=-Math.PI/2,ai=new Ae(...Xe);Ge=new Ae(-me+qe[0],qe[1]),Ge._rotateAround(Mt,Tt)._add(ai),Ge.x+=-Ut+me,Ge.y-=(we.left-te)*q.scale;const Jt=q.image?we.advance*q.scale:ao*q.scale,Ct=String.fromCodePoint(q.glyph);J5(Ct)?Ge.x+=(1-te)*q.scale:Y5(Ct)?Ge.x+=Jt-we.height*q.scale+(-te-1)*q.scale:Ge.x+=q.image||we.width+2*te===Ie.w&&we.height+2*te===Ie.h?(Jt-ot)/2:(Jt-(we.height+2*te)*q.scale)/2,ct=new Ae(Ge.x,Ge.y-nt),et=new Ae(Ge.x+ot,Ge.y),ut=new Ae(Ge.x+ot,Ge.y-nt)}else{const Ut=(we.left-te)*q.scale-me+qe[0],Tt=(-we.top-te)*q.scale+qe[1],Mt=Ut+nt,ai=Tt+ot;Ge=new Ae(Ut,Tt),ct=new Ae(Mt,Tt),et=new Ae(Ut,ai),ut=new Ae(Mt,ai)}if(M){let Ut;Ut=d?new Ae(0,0):at?new Ae(A[0],A[1]):new Ae(r[0],r[1]),Ge._rotateAround(M,Ut),ct._rotateAround(M,Ut),et._rotateAround(M,Ut),ut._rotateAround(M,Ut)}const lt=new Ae(0,0),Bt=new Ae(0,0);T.push({tl:Ge,tr:ct,bl:et,br:ut,texPrimary:Y,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:Je,sectionIndex:q.sectionIndex,isSDF:ue,pixelOffsetTL:lt,pixelOffsetBR:Bt,minFontScaleX:0,minFontScaleY:0})}}return T}function gV(a,t=1,r=!1){let c=1/0,d=1/0,g=-1/0,_=-1/0;const v=a[0];for(let D=0;D<v.length;D++){const k=v[D];(!D||k.x<c)&&(c=k.x),(!D||k.y<d)&&(d=k.y),(!D||k.x>g)&&(g=k.x),(!D||k.y>_)&&(_=k.y)}const S=Math.min(g-c,_-d);let T=S/2;const M=new _h([],_V);if(S===0)return new Ae(c,d);for(let D=c;D<g;D+=S)for(let k=d;k<_;k+=S)M.push(new $f(D+T,k+T,T,a));let A=(function(D){let k=0,$=0,H=0;const j=D[0];for(let q=0,Y=j.length,te=Y-1;q<Y;te=q++){const ue=j[q],ae=j[te],ge=ue.x*ae.y-ae.x*ue.y;$+=(ue.x+ae.x)*ge,H+=(ue.y+ae.y)*ge,k+=3*ge}return new $f($/k,H/k,0,D)})(a),z=M.length;for(;M.length;){const D=M.pop();(D.d>A.d||!A.d)&&(A=D,r&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,z)),D.max-A.d<=t||(T=D.h/2,M.push(new $f(D.p.x-T,D.p.y-T,T,a)),M.push(new $f(D.p.x+T,D.p.y-T,T,a)),M.push(new $f(D.p.x-T,D.p.y+T,T,a)),M.push(new $f(D.p.x+T,D.p.y+T,T,a)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${A.d}`)),A.p}function _V(a,t){return t.max-a.max}Uf.loadGlyphRange=function(a,t,r,c,d){const g=256*t,_=g+255,v=c.transformRequest(c.normalizeGlyphsURL(r).replace("{fontstack}",a).replace("{range}",`${g}-${_}`),is.Glyphs);ah(v,(S,T)=>{if(S)d(S);else if(T){const M={},A=(function(z){return new Fx(z).readFields(aV,{})})(T);for(const z of A.glyphs)M[z.id]=z;d(null,{glyphs:M,ascender:A.ascender,descender:A.descender})}})},Uf.TinySDF=class{constructor({fontSize:a=24,buffer:t=3,radius:r=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:_="normal",lang:v=null}={}){this.buffer=t,this.cutoff=c,this.radius=r,this.lang=v;const S=this.size=a+4*t,T=this._createCanvas(S),M=this.ctx=T.getContext("2d",{willReadFrequently:!0});M.font=`${_} ${g} ${a}px ${d}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(a){const t=document.createElement("canvas");return t.width=t.height=a,t}draw(a){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(a),_=Math.ceil(r),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),S=Math.min(this.size-this.buffer,_+Math.ceil(c)),T=v+2*this.buffer,M=S+2*this.buffer,A=Math.max(T*M,0),z=new Uint8ClampedArray(A),D={data:z,width:T,height:M,glyphWidth:v,glyphHeight:S,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(v===0||S===0)return D;const{ctx:k,buffer:$,gridInner:H,gridOuter:j}=this;this.lang&&(k.lang=this.lang),k.clearRect($,$,v,S),k.fillText(a,$,$+_);const q=k.getImageData($,$,v,S);j.fill(jg,0,A),H.fill(0,0,A);for(let Y=0;Y<S;Y++)for(let te=0;te<v;te++){const ue=q.data[4*(Y*v+te)+3]/255;if(ue===0)continue;const ae=(Y+$)*T+te+$;if(ue===1)j[ae]=0,H[ae]=jg;else{const ge=.5-ue;j[ae]=ge>0?ge*ge:0,H[ae]=ge<0?ge*ge:0}}iz(j,0,0,T,M,T,this.f,this.v,this.z),iz(H,$,$,v,S,T,this.f,this.v,this.z);for(let Y=0;Y<A;Y++){const te=Math.sqrt(j[Y])-Math.sqrt(H[Y]);z[Y]=Math.round(255-255*(te/this.radius+this.cutoff))}return D}};class $f{constructor(t,r,c,d){this.p=new Ae(t,r),this.h=c,this.d=(function(g,_){let v=!1,S=1/0;for(let T=0;T<_.length;T++){const M=_[T];for(let A=0,z=M.length,D=z-1;A<z;D=A++){const k=M[A],$=M[D];k.y>g.y!=$.y>g.y&&g.x<($.x-k.x)*(g.y-k.y)/($.y-k.y)+k.x&&(v=!v),S=Math.min(S,xu(g,k,$))}}return(v?1:-1)*Math.sqrt(S)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const yV=Object.keys,bS=Number.POSITIVE_INFINITY,vV=Math.sqrt(2);function Mu(a,t,r,c,d){const g=mS(a)&&a.collisionPadding?a.collisionPadding:[0,0,0,0],_={top:a.top-g[1],bottom:a.bottom+g[3],left:a.left-g[0],right:a.right+g[2],scaled:!1};return c!==void 0&&(function(v,S){v.top*=S,v.bottom*=S,v.left*=S,v.right*=S,v.scaled=!0})(_,c),r&&(function(v,S){if(!S)return;const T=ti(S),M=new Ae(v.left,v.top),A=new Ae(v.right,v.top),z=new Ae(v.left,v.bottom),D=new Ae(v.right,v.bottom),k=new Ae(0,0);M._rotateAround(T,k),A._rotateAround(T,k),z._rotateAround(T,k),D._rotateAround(T,k),v.left=Math.min(M.x,A.x,z.x,D.x),v.right=Math.max(M.x,A.x,z.x,D.x),v.top=Math.min(M.y,A.y,z.y,D.y),v.bottom=Math.max(M.y,A.y,z.y,D.y)})(_,r),d&&(_.left+=d[0],_.right+=d[0],_.top+=d[1],_.bottom+=d[1]),t?{top:Math.min(t.top,_.top),bottom:Math.max(t.bottom,_.bottom),left:Math.min(t.left,_.left),right:Math.max(t.right,_.right),scaled:t.scaled||_.scaled}:_}function lz(a,[t,r]){let c=0,d=0;if(r===bS){t<0&&(t=0);const g=t/vV;switch(a){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-t;break;case"top":d=t-7}switch(a){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),a){case"top-right":case"top-left":case"top":d=r-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-r}switch(a){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,d]}function xV(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k){const $=a.layers[0],H=$.appearances;if(H.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const j={iconBBox:null,iconVerticalBBox:null},q={textBBox:null,textVerticalBBox:null},{baseIconRotate:Y,baseTextRotate:te,iconScaleFactor:ue}=(function(ge,ye,me){const we=ge.get("icon-rotate").evaluate(ye,{},me),Ie=ge.get("text-rotate").evaluate(ye,{},me),[Je,qe]=ge.get("icon-size-scale-range");return{baseIconRotate:we,baseTextRotate:Ie,iconScaleFactor:de(1,Je,qe)}})(c,d,g);t&&(j.iconBBox=Mu(t,j.iconBBox,Y,_),r)&&(j.iconVerticalBBox=Mu(r,j.iconVerticalBBox,Y+90,_));const ae=Gx(A.horizontal);ae&&(q.textBBox=Mu(ae,q.textBBox,te,1,D)),A.vertical&&(q.textVerticalBBox=Mu(A.vertical,q.textVerticalBBox,te+90,1,D));for(const ge of H)ge.hasIconProperties()&&bV(j,a,$,ge,d,g,v,Y,_,S,t,T,ue,M,k),ge.hasTextProperties()&&wV(q,$,ge,d,g,D,te,z,ae,A.vertical);return{iconBBox:j.iconBBox,iconVerticalBBox:j.iconVerticalBBox,textBBox:q.textBBox,textVerticalBBox:q.textVerticalBBox}}function bV(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k){const{appearanceIconOffset:$,appearanceIconRotate:H,appearanceIconSize:j}=cz(c,r,d,g,_,v,S,T.iconScaleFactor);let q=null,Y=null,te=null;c.hasProperty("icon-image")?te=(function(ue,ae,ge,ye,me,we,Ie,Je){let qe=null;const Xe=ae.getAppearanceValueAndResolveTokens(ge,"icon-image",ye,me,Je);if(Xe){const at=ue.getResolvedImageFromTokens(Xe),nt=ge.getUnevaluatedProperty("icon-size"),ot=Gg(at,Yh(ue.zoom,nt,ue.worldview,Je),nt,me,ue.zoom,ye,ue.pixelRatio,Ie,ue.worldview,Je);qe=we.get(ot.iconPrimary.toString())}return qe})(t,r,c,d,g,A,z,k):M&&(te=M.imagePrimary),te&&(q=Nx(te,null,$,D),t.allowVerticalPlacement&&(Y=Nx(te,null,$,D))),q&&(a.iconBBox=Mu(q,a.iconBBox,H,j)),Y&&(a.iconVerticalBBox=Mu(Y,a.iconVerticalBBox,H+90,j))}function cz(a,t,r,c,d,g,_,v){const S=a.hasProperty("icon-offset")?t.getAppearanceValueAndResolveTokens(a,"icon-offset",r,c,[]):null,T=S&&Array.isArray(S)?S:d,M=a.hasProperty("icon-rotate")?t.getAppearanceValueAndResolveTokens(a,"icon-rotate",r,c,[]):null,A=typeof M=="number"?M:g,z=a.hasProperty("icon-size")?t.getAppearanceValueAndResolveTokens(a,"icon-size",r,c,[]):null;return{appearanceIconOffset:T,appearanceIconRotate:A,appearanceIconSize:typeof z=="number"?z*v:_}}function wV(a,t,r,c,d,g,_,v,S,T){const{appearanceTextOffset:M,appearanceTextRotate:A,appearanceTextSize:z}=uz(r,t,c,d,g,_,v),D=z/v;S&&(a.textBBox=Mu(S,a.textBBox,A,D,M)),T&&(a.textVerticalBBox=Mu(T,a.textVerticalBBox,A+90,D,M))}function uz(a,t,r,c,d,g,_){const v=a.hasProperty("text-offset")?t.getAppearanceValueAndResolveTokens(a,"text-offset",r,c,[]):null,S=v&&Array.isArray(v)?[v[0]*ao,v[1]*ao]:d,T=a.hasProperty("text-rotate")?t.getAppearanceValueAndResolveTokens(a,"text-rotate",r,c,[]):null,M=typeof T=="number"?T:g,A=a.hasProperty("text-size")?t.getAppearanceValueAndResolveTokens(a,"text-size",r,c,[]):null;return{appearanceTextOffset:S,appearanceTextRotate:M,appearanceTextSize:typeof A=="number"?A:_}}function jx(a,t,r,c,d,g,_,v,S){if(!t||!t.usvg)return;const T=qP(c),M=qP(d),A=g!=="both"&&g!=="width"||!ZP(c)?1:M.width/T.width,z=g!=="both"&&g!=="height"||!WP(c)?1:M.height/T.height;r.scaleSelf(A,z);const D=r.toString();_.set(D,r),v.set(D,t);const{imagePosition:k}=yS(D,t,1);S.set(D,k)}function hz(a,t,r,c,d,g,_,v,S,T){if(!a)return;const M=(function(A,z,D,k,$,H,j){if(A.kind==="camera")return A.maxSize;if(A.kind==="composite"){const q=z.possiblyEvaluate(new An(A.maxZoom,{worldview:H}),D,j).evaluate($,{},D,j),Y=z.possiblyEvaluate(new An(A.minZoom,{worldview:H}),D,j).evaluate($,{},D,j);return Math.max(q,Y)}return z.possiblyEvaluate(new An(k,{worldview:H}),D,j).evaluate($,{},D,j)})(t,r,c,d,g,S,T);return a.scaleSelf(M*v*_)}function Gg(a,t,r,c,d,g,_,v,S,T){return{iconPrimary:hz(a.getPrimary(),t,r,c,d,g,_,v,S,T),iconSecondary:hz(a.getSecondary(),t,r,c,d,g,_,v,S,T)}}function SV(a,t,r){if(!t)return;const c=r.get(a.toString()),d=r.get(t.toString());c&&d&&(c.paddedRect.w===d.paddedRect.w&&c.paddedRect.h===d.paddedRect.h||yi(`Mismatch in icon variant sizes: ${a.toString()} and ${t.toString()}`),c.usvg!==d.usvg&&yi(`Mismatch in icon variant image types: ${a.id} and ${t.id}`))}function dz(a,t,r,c){if(!a)return;const d=t.get(r.toString());if(a.imagePrimary=d,c){const g=t.get(c.toString());a.imageSecondary=g}}function TV(a,t){for(const r in a.horizontal)fz(a.horizontal[r],t);fz(a.vertical,t)}function fz(a,t){if(a){for(const r of a.positionedLines)for(const c of r.positionedGlyphs)if(c.image!==null){const d=c.image.toString();c.rect=t.get(d).paddedRect}}}function wS(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function EV(a,t,r,c,d,g,_,v,S){const T=Gx(g.horizontal)||g.vertical,M=r.get("icon-text-fit-padding").evaluate(c,{},d);let A,z=t;return t&&S!=="none"&&(a.allowVerticalPlacement&&g.vertical&&(A=gS(t,g.vertical,S,M,v,_)),T&&(z=gS(t,T,S,M,v,_))),{defaultShapedIcon:z,verticallyShapedIcon:A}}function pz(a,t){return a*t/24}function IV(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q,Y,te,ue,ae,ge){let ye=_.textMaxSize.evaluate(t,{},z);ye===void 0?ye=v*_.textScaleFactor:ye*=_.textScaleFactor;const me=a.layers[0].layout,we=pz(v,_.textScaleFactor),Ie=Gx(r.horizontal)||r.vertical,Je=a.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((H!=="none"||Je)&&a.appearanceFeatureData&&a.featureToAppearanceIndex[t.index]<a.appearanceFeatureData.length){const Tt=a.appearanceFeatureData[a.featureToAppearanceIndex[t.index]];Tt&&(Tt.textShaping=Ie,Tt.iconTextFitPadding=me.get("icon-text-fit-padding").evaluate(t,{},z),Tt.fontScale=we,Tt.textScaleFactor=_.textScaleFactor)}const qe=D.name==="globe",Xe=a.tilePixelRatio*ye/24,at=(ut=a.overscaling,a.zoom>18&&ut>2&&(ut>>=1),Math.max(It/(512*ut),1)*me.get("symbol-spacing")),nt=me.get("text-padding")*a.tilePixelRatio,ot=me.get("icon-padding")*a.tilePixelRatio,Ge=ti(me.get("text-max-angle")),ct=me.get("icon-rotation-alignment")==="map"&&Y!=="point",et=at/2;var ut;a.hasAnyIconTextFit===!1&&H!=="none"&&(a.hasAnyIconTextFit=!0);const lt=t.properties?+t.properties[en]:null,Bt=lt&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(lt):65535,Ut=(Tt,Mt,ai)=>{if(Mt.x<0||Mt.x>=It||Mt.y<0||Mt.y>=It)return;let Jt=null;if(qe){const{x:Ct,y:xi,z:Wi}=D.projectTilePoint(Mt.x,Mt.y,ai);Jt={anchor:new zc(Ct,xi,Wi,0,void 0),up:D.upVector(ai,Mt.x,Mt.y)}}(function(Ct,xi,Wi,mn,Gi,Pn,sn,wr,ln,In,Yn,or,sr,Sr,vo,Ao,Ur,Wr,Qr,Ui,ar,dr,Ws,Xo,xo,Jo,ic,ko,a0,qf,us,l0){const nc=Ct.addToLineVertexArray(xi,mn);let Cc,zu,va,Za,s_,Xf,Hi,lo=0,Tr=0,qr=0,xa=0,Ts=-1,qs=-1;const co={};let a_=qc("");const rc=Wi?Wi.anchor:xi,$r=ko!=="none";let bo=0,Xr=0;if(ln._unevaluatedLayout.getValue("text-radial-offset")===void 0){const wo=ln.layout.get("text-offset").evaluate(ar,{},xo);bo=wo[0]*ao,Xr=wo[1]*ao}else bo=ln.layout.get("text-radial-offset").evaluate(ar,{},xo)*ao,Xr=bS;if(Ct.allowVerticalPlacement&&Gi.vertical){const wo=Gi.vertical;if(vo)Xf=ES(wo),wr&&(Hi=ES(wr));else{const Es=ln.layout.get("text-rotate").evaluate(ar,{},xo)+90;va=Hx(In,rc,xi,Yn,or,sr,wo,Sr,Es,Ao,l0),wr&&(Za=Hx(In,rc,xi,Yn,or,sr,wr,Wr,Es,null,us))}}if(Pn){const wo=ln.layout.get("icon-rotate").evaluate(ar,{},xo),Es=xS(Pn,wo,Ws,$r,dr.iconScaleFactor),Wa=wr?xS(wr,wo,Ws,$r,dr.iconScaleFactor):void 0;zu=Hx(In,rc,xi,Yn,or,sr,Pn,Wr,wo,null,qf);const oc=(function(vl,B6,RC,N6,U6,LC,DC,$6,Wte,XS){const kC=vl.layers[0],OC=kC.appearances;let Yf=B6.length;if(RC&&(Yf=Math.max(Yf,RC.length)),OC.length===0)return Yf;const[V6,j6]=N6.get("icon-size-scale-range"),G6=de(1,V6,j6);for(const JS of OC){const FC=JS.getUnevaluatedProperties();if(FC._values["icon-image"].value!==void 0){const BC=kC.getAppearanceValueAndResolveTokens(JS,"icon-image",LC,DC,XS);if(BC){const NC=vl.getResolvedImageFromTokens(BC);if(NC){const UC=JS.hasProperty("icon-size")?FC._values["icon-size"]:U6._values["icon-size"],H6=Gg(NC,Yh(vl.zoom,UC,vl.worldview,XS),UC,DC,vl.zoom,LC,vl.pixelRatio,G6,vl.worldview,XS),$C=$6.get(H6.iconPrimary.toString());$C&&(Yf=Math.max(Yf,pV($C)))}}}}return Yf})(Ct,Es,Wa,ln.layout,ln._unevaluatedLayout,ar,xo,Ct.iconAtlasPositions,0,Xo);lo=4*oc;const WS=ln.layout.get("icon-size").evaluate(ar,{},xo,Xo),qS=dr.compositeIconSizes?dr.compositeIconSizes[0].evaluate(ar,{},xo,Xo):0,l_=dr.compositeIconSizes?dr.compositeIconSizes[1].evaluate(ar,{},xo,Xo):0,Jf=TS(Ct.layerIds[0],Ct.iconSizeData,WS,dr.iconScaleFactor,qS,l_);Ct.addSymbols(Ct.icon,Es,Jf,Ui,Qr,ar,void 0,Wi,xi,nc.lineStartIndex,nc.lineLength,-1,Xo,xo,Jo,ic,Ct.symbolInstances.length,oc),Ts=Ct.icon.placedSymbolArray.length-1,Wa&&(Tr=4*oc,Ct.addSymbols(Ct.icon,Wa,Jf,Ui,Qr,ar,Zs.vertical,Wi,xi,nc.lineStartIndex,nc.lineLength,-1,Xo,xo,Jo,ic,Ct.symbolInstances.length,oc),qs=Ct.icon.placedSymbolArray.length-1)}for(const wo in Gi.horizontal){const Es=wo,Wa=Gi.horizontal[Es];Cc||(a_=qc(Wa.text),vo?s_=ES(Wa):Cc=Hx(In,rc,xi,Yn,or,sr,Wa,Sr,ln.layout.get("text-rotate").evaluate(ar,{},xo),Ao,l0));const oc=Wa.positionedLines.length===1;if(qr+=mz(Ct,Wi,xi,Wa,sn,ln,vo,ar,Ao,nc,Gi.vertical?Zs.horizontal:Zs.horizontalOnly,oc?yV(Gi.horizontal):[Es],co,Ts,dr,Xo,xo,Ct.symbolInstances.length,Jo),oc)break}Gi.vertical&&(xa+=mz(Ct,Wi,xi,Gi.vertical,sn,ln,vo,ar,Ao,nc,Zs.vertical,["vertical"],co,qs,dr,Xo,xo,Ct.symbolInstances.length,Jo));let Oo=-1;const Fo=(wo,Es)=>wo?Math.max(wo,Es):Es;Oo=Fo(s_,Oo),Oo=Fo(Xf,Oo),Oo=Fo(Hi,Oo);const Cu=Oo>-1?1:0;Ct.glyphOffsetArray.length>=65535&&yi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ar.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,ar.sortKey),Ct.symbolInstances.emplaceBack(xi.x,xi.y,rc.x,rc.y,rc.z,co.right>=0?co.right:-1,co.center>=0?co.center:-1,co.left>=0?co.left:-1,co.vertical>=0?co.vertical:-1,Ts,qs,a_,Cc!==void 0?Cc:Ct.collisionBoxArray.length,Cc!==void 0?Cc+1:Ct.collisionBoxArray.length,va!==void 0?va:Ct.collisionBoxArray.length,va!==void 0?va+1:Ct.collisionBoxArray.length,zu!==void 0?zu:Ct.collisionBoxArray.length,zu!==void 0?zu+1:Ct.collisionBoxArray.length,Za||Ct.collisionBoxArray.length,Za?Za+1:Ct.collisionBoxArray.length,Yn,qr,xa,lo,Tr,Cu,0,bo,Xr,Oo,0,$r?1:0,a0)})(a,Mt,Jt,Tt,r,c,g,d,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,nt,q,T,0,ot,ct,j,t,_,M,A,z,k,$,H,Bt,te,ue,ae)};if(Y==="line")for(const Tt of Ix(t.geometry,0,0,It,It)){const Mt=fV(Tt,at,Ge,r.vertical||Ie,c,24,Xe,a.overscaling,It);for(const ai of Mt)Ie&&MV(a,Ie.text,et,ai)||Ut(Tt,ai,z)}else if(Y==="line-center"){for(const Tt of t.geometry)if(Tt.length>1){const Mt=dV(Tt,Ge,r.vertical||Ie,c,24,Xe);Mt&&Ut(Tt,Mt,z)}}else if(t.type==="Polygon")for(const Tt of Eg(t.geometry,0)){const Mt=gV(Tt,16);Ut(Tt[0],new zc(Mt.x,Mt.y,0,0,void 0),z)}else if(t.type==="LineString")for(const Tt of t.geometry)Ut(Tt,new zc(Tt[0].x,Tt[0].y,0,0,void 0),z);else if(t.type==="Point")for(const Tt of t.geometry)for(const Mt of Tt)Ut([Mt],new zc(Mt.x,Mt.y,0,0,void 0),z)}const SS=255,Kh=SS*Pc;function mz(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q){const Y=az(0,c,S,g,_,v,d,a.allowVerticalPlacement,void 0),te=g.layout.get("text-size").evaluate(v,{},H),ue=k.compositeTextSizes?k.compositeTextSizes[0].evaluate(v,{},H):0,ae=k.compositeTextSizes?k.compositeTextSizes[1].evaluate(v,{},H):0,ge=TS(a.layerIds[0],a.textSizeData,te,k.textScaleFactor,ue,ae);a.addSymbols(a.text,Y,ge,S,_,v,M,t,r,T.lineStartIndex,T.lineLength,D,$,H,q,!1,j,Y.length);for(const ye of A)z[ye]=a.text.placedSymbolArray.length-1;return 4*Y.length}function TS(a,t,r,c,d,g){const _=t;let v=null;return _.kind==="source"?(v=[Pc*r*c],v[0]>Kh&&yi(`${a}: Value for "text-size" is >= ${SS}. Reduce your "text-size".`)):_.kind==="composite"&&(v=[Pc*d*c,Pc*g*c],(v[0]>Kh||v[1]>Kh)&&yi(`${a}: Value for "text-size" is >= ${SS}. Reduce your "text-size".`)),v}function Gx(a){for(const t in a)return a[t];return null}function Hx(a,t,r,c,d,g,_,v,S,T,M){let A,z,D,k;if(A=M?M.top:_.top,z=M?M.bottom:_.bottom,D=M?M.left:_.left,k=M?M.right:_.right,mS(_)&&_.collisionPadding){const $=_.collisionPadding;D-=$[0],A-=$[1],k+=$[2],z+=$[3]}if(S){const $=new Ae(D,A),H=new Ae(k,A),j=new Ae(D,z),q=new Ae(k,z),Y=ti(S);let te=new Ae(0,0);T&&(te=new Ae(T[0],T[1])),$._rotateAround(Y,te),H._rotateAround(Y,te),j._rotateAround(Y,te),q._rotateAround(Y,te),D=Math.min($.x,H.x,j.x,q.x),k=Math.max($.x,H.x,j.x,q.x),A=Math.min($.y,H.y,j.y,q.y),z=Math.max($.y,H.y,j.y,q.y)}return a.emplaceBack(t.x,t.y,t.z,r.x,r.y,D,A,k,z,v,c,d,g),a.length-1}function ES(a){mS(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const t=a.bottom-a.top;return t>0?Math.max(10,t):null}function MV(a,t,r,c){const d=a.compareText;if(t in d){const g=d[t];for(let _=g.length-1;_>=0;_--)if(c.dist(g[_])<r)return!0}else d[t]=[];return d[t].push(c),!1}function gz(a,t){const r=a.fovAboveCenter,c=a.elevation?a.elevation.getMinElevationBelowMSL()*t:0,d=(a._camera.position[2]*a.worldSize-c)/Math.cos(a._pitch),g=Math.sin(r)*d/Math.sin(Math.max(Math.PI/2-a._pitch-r,.01));let _=Math.sin(a._pitch)*g+d;const v=d*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let S=Math.max(a.zoom-17,0);a.isOrthographic&&(S/=10),_*=1+S}return Math.min(1.01*_,v)}function Hg(a,t){if(!t.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:t};const r=Math.pow(2,-a.z),c=a.x*r,d=(a.x+1)*r,g=a.y*r,_=(a.y+1)*r,v=tt(c),S=tt(d),T=dt(g),M=dt(_),A=t.project(v,T),z=t.project(S,T),D=t.project(S,M),k=t.project(v,M);let $=Math.min(A.x,z.x,D.x,k.x),H=Math.min(A.y,z.y,D.y,k.y),j=Math.max(A.x,z.x,D.x,k.x),q=Math.max(A.y,z.y,D.y,k.y);const Y=r/16;function te(ae,ge,ye,me,we,Ie){const Je=(ye+we)/2,qe=(me+Ie)/2,Xe=t.project(tt(Je),dt(qe)),at=Math.max(0,$-Xe.x,H-Xe.y,Xe.x-j,Xe.y-q);$=Math.min($,Xe.x),j=Math.max(j,Xe.x),H=Math.min(H,Xe.y),q=Math.max(q,Xe.y),at>Y&&(te(ae,Xe,ye,me,Je,qe),te(Xe,ge,Je,qe,we,Ie))}te(A,z,c,g,d,g),te(z,D,d,g,d,_),te(D,k,d,_,c,_),te(k,A,c,_,c,g),$-=Y,H-=Y,j+=Y,q+=Y;const ue=1/Math.max(j-$,q-H);return{scale:ue,x:$*ue,y:H*ue,x2:j*ue,y2:q*ue,projection:t}}function _z(a,{x:t,y:r},c=0){return new Ae(((t-c)*a.scale-a.x)*It,(r*a.scale-a.y)*It)}const AV=fe(new Float32Array(16));class Au{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new he(0,0)}projectTilePoint(t,r,c){return{x:t,y:r,z:0}}locationPoint(t,r,c,d=!0){return t._coordinatePoint(t.locationCoordinate(r,c),d)}pixelsPerMeter(t,r){return je(1,t)*r}pixelSpaceConversion(t,r,c){return 1}farthestPixelDistance(t){return gz(t,t.pixelsPerMeter)}pointCoordinate(t,r,c,d){const g=t.horizonLineFromTop(!1),_=new Ae(r,Math.max(g,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(_,d))}pointCoordinate3D(t,r,c){const d=new Ae(r,c);if(t.elevation)return t.elevation.pointCoordinate(d);{const g=this.pointCoordinate(t,d.x,d.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(t,r){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,r.x,r.y);const c=t.horizonLineFromTop();return r.y<c}createInversionMatrix(t,r){return AV}createTileMatrix(t,r,c){let d,g,_;const v=c.canonical,S=fe(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Hg(v,this);d=1,g=T.x+c.wrap*T.scale,_=T.y,Ve(S,S,[d/T.scale,d/T.scale,t.pixelsPerMeter/r])}else d=r/t.zoomScale(v.z),g=(v.x+Math.pow(2,v.z)*c.wrap)*d,_=v.y*d;return it(S,S,[g,_,0]),Ve(S,S,[d/It,d/It,1]),S}upVector(t,r,c){return[0,0,1]}upVectorScale(t,r,c){return{metersToTile:1}}}class PV extends Au{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[r,c]=this.parallels=t.parallels||[29.5,45.5],d=Math.sin(ti(r));this.n=(d+Math.sin(ti(c)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(t,r){const{n:c,c:d,r0:g}=this,_=ti(t-this.center[0]),v=ti(r),S=Math.sqrt(d-2*c*Math.sin(v))/c;return{x:S*Math.sin(_*c),y:S*Math.cos(_*c)-g,z:0}}unproject(t,r){const{n:c,c:d,r0:g}=this,_=g+r;let v=Math.atan2(t,Math.abs(_))*Math.sign(_);_*c<0&&(v-=Math.PI*Math.sign(t)*Math.sign(_));const S=ti(this.center[0])*c;v=Oe(v,-Math.PI-S,Math.PI-S);const T=de(Ee(v/c)+this.center[0],-180,180),M=Math.asin(de((d-(t*t+_*_)*c*c)/(2*c),-1,1)),A=de(Ee(M),-85.051129,Te);return new he(T,A)}}const Zg=1.340264,Wg=-.081106,qg=893e-6,Xg=.003796,Zx=Math.sqrt(3)/2;class zV extends Au{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(Zx*Math.sin(r)),d=c*c,g=d*d*d;return{x:.5*(t*Math.cos(c)/(Zx*(Zg+3*Wg*d+g*(7*qg+9*Xg*d)))/Math.PI+.5),y:1-.5*(c*(Zg+Wg*d+g*(qg+Xg*d))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,d=c*c,g=d*d*d;for(let M,A,z,D=0;D<12&&(A=c*(Zg+Wg*d+g*(qg+Xg*d))-r,z=Zg+3*Wg*d+g*(7*qg+9*Xg*d),M=A/z,c=de(c-M,-Math.PI/3,Math.PI/3),d=c*c,g=d*d*d,!(Math.abs(M)<1e-12));++D);const _=Zx*t*(Zg+3*Wg*d+g*(7*qg+9*Xg*d))/Math.cos(c),v=Math.asin(Math.sin(c)/Zx),S=de(180*_/Math.PI,-180,180),T=de(180*v/Math.PI,-85.051129,Te);return new he(S,T)}}class CV extends Au{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){const c=360*(t-.5),d=de(360*(.5-r),-85.051129,Te);return new he(c,d)}}const Vf=Math.PI/2;function Wx(a){return Math.tan((Vf+a)/2)}class RV extends Au{constructor(t){super(t),this.center=t.center||[0,30];const[r,c]=this.parallels=t.parallels||[30,30];let d=ti(r),g=ti(c);this.southernCenter=d+g<0,this.southernCenter&&(d=-d,g=-g);const _=Math.cos(d),v=Wx(d);this.n=d===g?Math.sin(d):Math.log(_/Math.cos(g))/Math.log(Wx(g)/v),this.f=_*Math.pow(Wx(d),this.n)/this.n}project(t,r){r=ti(r),this.southernCenter&&(r=-r),t=ti(t-this.center[0]);const c=1e-6,{n:d,f:g}=this;g>0?r<-Vf+c&&(r=-Vf+c):r>Vf-c&&(r=Vf-c);const _=g/Math.pow(Wx(r),d);let v=_*Math.sin(d*t),S=g-_*Math.cos(d*t);return v=.5*(v/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:v,y:this.southernCenter?S:1-S,z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:c,f:d}=this,g=d-r,_=Math.sign(g),v=Math.sign(c)*Math.sqrt(t*t+g*g);let S=Math.atan2(t,Math.abs(g))*_;g*c<0&&(S-=Math.PI*Math.sign(t)*_);const T=de(Ee(S/c)+this.center[0],-180,180),M=de(Ee(2*Math.atan(Math.pow(d/v,1/c))-Vf),-85.051129,Te);return new he(T,this.southernCenter?-M:M)}}class yz extends Au{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:Le(t),y:Ze(r),z:0}}unproject(t,r){const c=tt(t),d=dt(r);return new he(c,d)}}const vz=ti(Te);class LV extends Au{project(t,r){const c=(r=ti(r))*r,d=c*c;return{x:.5*((t=ti(t))*(.8707-.131979*c+d*(d*(.003971*c-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+c*(.015085+d*(.028874*c-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,d=25,g=0,_=c*c;do{_=c*c;const T=_*_;g=(c*(1.007226+_*(.015085+T*(.028874*_-.044475-.005916*T)))-r)/(1.007226+_*(.045255+T*(.259866*_-.311325-.005916*11*T))),c=de(c-g,-vz,vz)}while(Math.abs(g)>1e-6&&--d>0);_=c*c;const v=de(Ee(t/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),S=Ee(c);return new he(v,S)}}const xz=ti(Te);class DV extends Au{project(t,r){r=ti(r),t=ti(t);const c=Math.cos(r),d=2/Math.PI,g=Math.acos(c*Math.cos(t/2)),_=Math.sin(g)/g,v=.5*(t*d+2*c*Math.sin(t/2)/_)||0,S=.5*(r+Math.sin(r)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(t,r){let c=t=(2*t-.5)*Math.PI,d=r=(2*(1-r)-1)*Math.PI,g=25;const _=1e-6;let v=0,S=0;do{const T=Math.cos(d),M=Math.sin(d),A=2*M*T,z=M*M,D=T*T,k=Math.cos(c/2),$=Math.sin(c/2),H=2*k*$,j=$*$,q=1-D*k*k,Y=q?1/q:0,te=q?Math.acos(T*k)*Math.sqrt(1/q):0,ue=.5*(2*te*T*$+2*c/Math.PI)-t,ae=.5*(te*M+d)-r,ge=.5*Y*(D*j+te*T*k*z)+1/Math.PI,ye=Y*(H*A/4-te*M*$),me=.125*Y*(A*$-te*M*D*H),we=.5*Y*(z*k+te*j*T)+.5,Ie=ye*me-we*ge;v=(ae*ye-ue*we)/Ie,S=(ue*me-ae*ge)/Ie,c=de(c-v,-Math.PI,Math.PI),d=de(d-S,-xz,xz)}while((Math.abs(v)>_||Math.abs(S)>_)&&--g>0);return new he(Ee(c),Ee(d))}}class bz extends Au{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ti(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){const{scale:c,cosPhi:d}=this;return{x:ti(t)*d*c+.5,y:-Math.sin(ti(r))/d*c+.5,z:0}}unproject(t,r){const{scale:c,cosPhi:d}=this,g=-(r-.5)/c,_=de(Ee((t-.5)/c)/d,-180,180),v=Math.asin(de(g*d,-1,1)),S=de(Ee(v),-85.051129,Te);return new he(_,S)}}class kV extends yz{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,c){const d=vg(t,r,c);return Wt(d,d,px(Ql(c))),{x:d[0],y:d[1],z:d[2]}}locationPoint(t,r,c){const d=_e(r.lat,r.lng),g=Li([],d),_=c?t._centerAltitude+c:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude;Dn(d,d,g,je(1,0)*It*_);const v=fe(new Float64Array(16));return ie(v,t.pixelMatrix,t.globeMatrix),Wt(d,d,v),new Ae(d[0],d[1])}pixelsPerMeter(t,r){return je(1,0)*r}pixelSpaceConversion(t,r,c){const d=je(1,t)*r,g=hi(je(1,45)*r,d,c);return this.pixelsPerMeter(t,r)/g}createTileMatrix(t,r,c){const d=w1(Ql(c.canonical));return ie(new Float64Array(16),t.globeMatrix,d)}createInversionMatrix(t,r){const{center:c}=t,d=px(Ql(r));return Re(d,d,ti(c.lng)),Ne(d,d,ti(c.lat)),Ve(d,d,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(t,r,c,d){return k2(t,r,c,!0)||new At(0,0)}pointCoordinate3D(t,r,c){const d=this.pointCoordinate(t,r,c,0);return[d.x,d.y,d.z]}isPointAboveHorizon(t,r){return!k2(t,r.x,r.y,!1)}farthestPixelDistance(t){const r=(function(d,g){const _=d.cameraToCenterDistance,v=d._centerAltitude*g,S=d._camera,T=d._camera.forward(),M=Qt([],bi([],T,-_),[0,0,v]),A=d.worldSize/(2*Math.PI),z=[0,0,-A],D=d.width/d.height,k=Math.tan(d.fovAboveCenter),$=bi([],S.up(),k),H=bi([],S.right(),k*D),j=Li([],Qt([],Qt([],T,$),H)),q=[];let Y;if(new Nn(M,j).closestPointOnSphere(z,A,q)){const te=Qt([],q,z),ue=Ce([],te,M);Y=Math.cos(d.fovAboveCenter)*_t(ue)}else{const te=Ce([],M,z),ue=Ce([],z,M);Li(ue,ue);const ae=_t(te)-A;Y=Math.sqrt(ae*(ae+2*A));const ge=Math.acos(Y/(A+ae))-Math.acos(Ei(T,ue));Y*=Math.cos(ge)}return 1.01*Y})(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=wu(t.zoom);if(c>0){const d=gz(t,je(1,t.center.lat)*t.worldSize),g=t.worldSize/(2*Math.PI),_=Math.max(t.width,t.height)/t.worldSize*Math.PI;return hi(r,d+g*(1-Math.cos(_)),Math.pow(c,10))}return r}upVector(t,r,c){return vg(r,c,t,1)}upVectorScale(t){return{metersToTile:hx(fx(Ql(t)))}}}function wz(a){const t=a.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(a.name){case"mercator":return new yz(a);case"equirectangular":return new CV(a);case"naturalEarth":return new LV(a);case"equalEarth":return new zV(a);case"winkelTripel":return new DV(a);case"albers":return r?new bz(a):new PV(a);case"lambertConformalConic":return r?new bz(a):new RV(a);case"globe":return new kV(a)}throw new Error(`Invalid projection name: ${a.name}`)}const OV=Qi.types,FV=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jg(a,t,r,c,d,g,_,v,S,T,M,A,z){const D=v?Math.min(Kh,Math.round(v[0])):0,k=v?Math.min(Kh,Math.round(v[1])):0;a.emplaceBack(t,r,Math.round(32*c),Math.round(32*d),g,_,(D<<1)+(S?1:0),0+(k<<1),16*T,16*M,256*A,256*z)}function Yg(a,t,r){a.emplaceBack(t,r)}function Kg(a,t,r,c,d,g,_){a.emplaceBack(t,r,c,d,g,_)}const qx=(a,t,r,c)=>{for(let d=0;d<t;d++)a.emplaceBack(r[0],r[1],r[2],c[0],c[1],c[2])};function jf(a,t,r,c,d){a.emplaceBack(t,r,c,d),a.emplaceBack(t,r,c,d),a.emplaceBack(t,r,c,d),a.emplaceBack(t,r,c,d)}function BV(a){for(const t of a.sections)if(Wl(t.text))return!0;return!1}class IS{constructor(t){this.layoutVertexArray=new ug,this.indexArray=new Hr,this.programConfigurations=t,this.segments=new er,this.dynamicLayoutVertexArray=new Kl,this.opacityVertexArray=new dg,this.placedSymbolArray=new Jv,this.iconTransitioningVertexArray=new Us,this.globeExtVertexArray=new hg,this.zOffsetVertexArray=new yo,this.orientationVertexArray=new wf,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(t,r){const c=[],d=this.layoutVertexArray.uint16;for(let g=0;g<r;++g){const _=12*(t+g);c.push(...d.slice(_,_+12))}return c}updateSymbolVertexData(t,r,c,d,g,_,v,S,T,M,A,z,D){const k=this.layoutVertexArray.uint16,$=12*t;k[$]=r,k[$+1]=c,k[$+2]=d,k[$+3]=g,k[$+4]=_,k[$+5]=v,k[$+6]=S,k[$+7]=T,k[$+8]=M,k[$+9]=A,k[$+10]=z,k[$+11]=D}upload(t,r,c,d,g,_){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,U5.members,!!_),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,V5.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,FV,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,H5.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,$5.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,j5.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=t.createVertexBuffer(this.orientationVertexArray,G5.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Vt(IS,"SymbolBuffers");class MS{constructor(t,r,c){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new c,this.segments=new er,this.collisionVertexArray=new bf,this.collisionVertexArrayExt=new Kl}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Z5.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,W5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Vt(MS,"CollisionBuffers");class Xx{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fe([]),this.placementViewportMatrix=fe([]);const r=this.layers[0]._unevaluatedLayout._values;this.worldview=t.worldview,this.localizable=t.localizable,this.textSizeData=Yh(this.zoom,r["text-size"],this.worldview,t.availableImages),this.iconSizeData=Yh(this.zoom,r["icon-size"],this.worldview,t.availableImages);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.lut=t.lut,this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>Zs[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(t){const r=this.layers[0].getAppearances();if(!r||r.length===0)return!1;const c=Array.isArray(t)?t:[t];return r.some(d=>c.some(g=>d.getProperty(g)!=null))}createArrays(){this.text=new IS(new L(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new IS(new L(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new Nh,this.lineVertexArray=new Qv,this.symbolInstances=new Kv}calculateGlyphDependencies(t,r,c,d,g){for(const _ of t){const v=_.codePointAt(0);if(v===void 0)break;if(r[v]=!0,d&&g&&v<=65535){const S=Ug[_];S&&(r[S.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(t,r,c,d,g,_,v){if(!t.hasProperty("icon-size"))return v*_;let S=1;const T=t.getUnevaluatedProperties()._values["icon-size"],M=Yh(this.zoom,T,this.worldview,g),A=Nf(M,r);if(M.kind!=="constant"&&M.kind!=="camera"||(S=A.uSize),M.kind==="composite"){const{minZoom:z,maxZoom:D}=M,k=T.possiblyEvaluate(new An(z,{worldview:this.worldview}),d),$=T.possiblyEvaluate(new An(D,{worldview:this.worldview}),d),H=k.evaluate(c,{},d,g);S=H+($.evaluate(c,{},d,g)-H)*A.uSizeT}return M.kind==="source"&&(S=T.possiblyEvaluate(new An(this.zoom,{worldview:this.worldview}),d).evaluate(c,{},d,g)),S*_}updateFootprints(t,r){}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!Sx(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}getResolvedImageFromTokens(t){return typeof t=="string"?ss.build(t):t}populate(t,r,c,d){const g=this.layers[0],_=g.layout,v=this.projection.name==="globe",S=_.get("text-font"),T=_.get("text-field"),M=_.get("icon-image"),[A,z]=_.get("icon-size-scale-range"),D=de(r.scaleFactor||1,A,z),k=(T.value.kind!=="constant"||T.value.value instanceof Do&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),$=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,H=this.hasAnyAppearanceProperty("icon-image"),j=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!k&&!$&&!H)return;const q=r.iconDependencies,Y=r.glyphDependencies,te=r.availableImages,ue=new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),ae=ge=>{const ye=ge.id.toString();q.has(ye)?q.get(ye).push(ge):q.set(ye,[ge])};for(const ge of t){const{feature:ye,id:me,index:we,sourceLayerIndex:Ie}=ge,Je=g._featureFilter.needGeometry,qe=Bi(ye,Je);if(!g._featureFilter.filter(ue,qe,c))continue;if(Je||(qe.geometry=fi(ye,c,d)),v&&ye.type!==1&&c.z<=5){const ut=qe.geometry,lt=.98078528056,Bt=(Ut,Tt)=>Ei(vg(Ut.x,Ut.y,c,1),vg(Tt.x,Tt.y,c,1))<lt;for(let Ut=0;Ut<ut.length;Ut++)ut[Ut]=Gt(ut[Ut],Bt)}let Xe,at;if(k){const ut=g.getValueAndResolveTokens("text-field",qe,c,te),lt=Do.factory(ut);BV(lt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ym()==="unavailable"||this.hasRTLText&&ga.isParsed())&&(Xe=X5(lt,g,qe))}if($){const ut=g.getValueAndResolveTokens("icon-image",qe,c,te);at=this.getResolvedImageFromTokens(ut)}const nt=this.layers[0];let ot=!1;if(!at&&H){const ut=nt.getAppearances();for(const lt of ut)if(lt.getProperty("icon-image")){const Bt=nt.getAppearanceValueAndResolveTokens(lt,"icon-image",qe,c,te);if(Bt){at=this.getResolvedImageFromTokens(Bt),ot=!0;break}}}if(!Xe&&!at)continue;const Ge=this.sortFeaturesByKey?j.evaluate(qe,{},c):void 0,ct={id:me,text:Xe,icon:at,index:we,sourceLayerIndex:Ie,geometry:qe.geometry,properties:ye.properties,type:OV[ye.type],sortKey:Ge};if(this.features.push(ct),this.featureToAppearanceIndex[we]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:me,properties:ye.properties,usesAppearanceIconAsPlaceholder:ot,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),at){const ut=nt._unevaluatedLayout._values,{iconPrimary:lt,iconSecondary:Bt}=Gg(at,this.iconSizeData,ut["icon-size"],c,this.zoom,ct,this.pixelRatio,D,this.worldview,te);ae(lt),Bt&&(this.hasAnySecondaryIcon=!0,ae(Bt))}const et=nt.getAppearances();if(et.length!==0&&et.forEach(ut=>{if(!ut.getProperty("icon-image"))return;const lt=this.getCombinedIconPrimary(ut,nt,qe,c,te,ct,D);lt&&ae(lt)}),Xe){const ut=S.evaluate(qe,{},c).join(","),lt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zs.vertical)>=0;for(const Bt of Xe.sections)if(Bt.image){const Ut=Bt.image.getPrimary().scaleSelf(this.pixelRatio),Tt=Ut.id.toString(),Mt=q.get(Tt)||[];Mt.push(Ut),q.set(Tt,Mt)}else{const Ut=Wm(Xe.toString()),Tt=Bt.fontStack||ut,Mt=Y[Tt]=Y[Tt]||{};this.calculateGlyphDependencies(Bt.text,Mt,lt,this.allowVerticalPlacement,Ut)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(ge){const ye={},me={},we=[];let Ie=0;function Je(nt){we.push(ge[nt]),Ie++}function qe(nt,ot,Ge){const ct=me[nt];return delete me[nt],me[ot]=ct,we[ct].geometry[0].pop(),we[ct].geometry[0]=we[ct].geometry[0].concat(Ge[0]),ct}function Xe(nt,ot,Ge){const ct=ye[ot];return delete ye[ot],ye[nt]=ct,we[ct].geometry[0].shift(),we[ct].geometry[0]=Ge[0].concat(we[ct].geometry[0]),ct}function at(nt,ot,Ge){const ct=Ge?ot[0][ot[0].length-1]:ot[0][0];return`${nt}:${ct.x}:${ct.y}`}for(let nt=0;nt<ge.length;nt++){const ot=ge[nt],Ge=ot.geometry,ct=ot.text?ot.text.toString():null;if(!ct){Je(nt);continue}const et=at(ct,Ge),ut=at(ct,Ge,!0);if(et in me&&ut in ye&&me[et]!==ye[ut]){const lt=Xe(et,ut,Ge),Bt=qe(et,ut,we[lt].geometry);delete ye[et],delete me[ut],me[at(ct,we[Bt].geometry,!0)]=Bt,we[lt].geometry=null}else et in me?qe(et,ut,Ge):ut in ye?Xe(et,ut,Ge):(Je(nt),ye[et]=Ie-1,me[ut]=Ie-1)}return we.filter(nt=>nt.geometry)})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ge of r.elevationFeatures)this.elevationFeatureIdToIndex.set(ge.id,this.elevationFeatures.length),this.elevationFeatures.push(ge)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ge,ye)=>ge.sortKey-ye.sortKey)}getCombinedIconPrimary(t,r,c,d,g,_,v){let S,T;const M=t.getUnevaluatedProperties();if(M._values["icon-image"].value!==void 0){const A=r.getAppearanceValueAndResolveTokens(t,"icon-image",c,d,g);S=this.getResolvedImageFromTokens(A)}else{const A=r.getValueAndResolveTokens("icon-image",c,d,g);S=this.getResolvedImageFromTokens(A)}if(S){const A=t.hasProperty("icon-size")?M._values["icon-size"]:r._unevaluatedLayout._values["icon-size"];T=Gg(S,Yh(this.zoom,A,this.worldview,g),A,d,this.zoom,_,this.pixelRatio,v,this.worldview,g).iconPrimary}return T}updateSymbolInstanceIconVertices(t,r,c,d,g,_,v,S,T,M,A,z,D,k){if(t.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(r.activeAppearance===c)return{vertexOffsetDelta:t.numIconVertices,hasChanges:!1};if(c){const $=this.getCombinedIconPrimary(c,T,d,_,v,{sortKey:void 0,text:void 0,icon:null,index:t.featureIndex,sourceLayerIndex:t.featureIndex,geometry:[],properties:r.properties,type:"Point",id:r.id},M);if(!$)return{vertexOffsetDelta:0,hasChanges:!1};const H=$.toString(),j=this.iconAtlasPositions&&this.iconAtlasPositions.get(H);if(j){const{appearanceIconOffset:q,appearanceIconRotate:Y}=cz(c,T,d,_,z,k,D,M);let te=Nx(j,void 0,q,T.layout.get("icon-anchor").evaluate(d,A,_));const ue=j.sdf,ae=T.layout.get("icon-text-fit").constantOr("none");ae!=="none"&&r.textShaping&&r.iconTextFitPadding&&r.fontScale&&(te=gS(te,r.textShaping,ae,r.iconTextFitPadding,q,r.fontScale));const ge=this.calculateEffectiveAppearanceIconSize(c,S.zoom,d,_,v,M,D),ye=0,me=1+(Math.min(Kh,Math.round(ge*Pc))<<1),we=xS(te,Y,ue,ae!=="none",M);r.isUsingAppearanceIconVertexData||(r.isUsingAppearanceIconVertexData=!0,r.layoutBasedIconVertexData=this.icon.getSymbolVertexData(g,t.numIconVertices));let Ie=g;for(let qe=0;qe<we.length;++qe){const Xe=we[qe],at=r.layoutBasedIconVertexData[0]||t.tileAnchorX,nt=r.layoutBasedIconVertexData[1]||t.tileAnchorY,ot=16*Xe.pixelOffsetTL.x,Ge=16*Xe.pixelOffsetTL.y,ct=16*Xe.pixelOffsetBR.x,et=16*Xe.pixelOffsetBR.y,ut=16*Xe.minFontScaleX,lt=16*Xe.minFontScaleY;this.icon.updateSymbolVertexData(Ie,at,nt,Math.round(32*Xe.tl.x),Math.round(32*Xe.tl.y),Xe.texPrimary.x,Xe.texPrimary.y,ye,me,ot,Ge,ut,lt),this.icon.updateSymbolVertexData(Ie+1,at,nt,Math.round(32*Xe.tr.x),Math.round(32*Xe.tr.y),Xe.texPrimary.x+Xe.texPrimary.w,Xe.texPrimary.y,ye,me,ct,Ge,ut,lt),this.icon.updateSymbolVertexData(Ie+2,at,nt,Math.round(32*Xe.bl.x),Math.round(32*Xe.bl.y),Xe.texPrimary.x,Xe.texPrimary.y+Xe.texPrimary.h,ye,me,ot,et,ut,lt),this.icon.updateSymbolVertexData(Ie+3,at,nt,Math.round(32*Xe.br.x),Math.round(32*Xe.br.y),Xe.texPrimary.x+Xe.texPrimary.w,Xe.texPrimary.y+Xe.texPrimary.h,ye,me,ct,et,ut,lt),Ie+=4}const Je=t.numIconVertices-4*we.length;for(let qe=0;qe<Je;++qe)this.icon.updateSymbolVertexData(Ie+qe,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:t.numIconVertices,hasChanges:!0}}}else if(r.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(g,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(g+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(g+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(g+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:t.numIconVertices,hasChanges:!0}}else if(r.isUsingAppearanceIconVertexData){const H=r.layoutBasedIconVertexData.length/12;for(let j=0;j<H;++j){const q=j*12;this.icon.updateSymbolVertexData(g+j,r.layoutBasedIconVertexData[q+0],r.layoutBasedIconVertexData[q+1],r.layoutBasedIconVertexData[q+2],r.layoutBasedIconVertexData[q+3],r.layoutBasedIconVertexData[q+4],r.layoutBasedIconVertexData[q+5],r.layoutBasedIconVertexData[q+6],r.layoutBasedIconVertexData[q+7],r.layoutBasedIconVertexData[q+8],r.layoutBasedIconVertexData[q+9],r.layoutBasedIconVertexData[q+10],r.layoutBasedIconVertexData[q+11])}return r.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:H,hasChanges:!0}}return{vertexOffsetDelta:t.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q){const Y=t.numHorizontalGlyphVertices>0||t.numVerticalGlyphVertices>0;if(!Y)return{vertexOffsetDelta:Y?t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices:0,hasChanges:!1};if(r.activeAppearance===c)return{vertexOffsetDelta:t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices,hasChanges:!1};if(c&&r.textShaping){const{appearanceTextOffset:te,appearanceTextRotate:ue,appearanceTextSize:ae}=uz(c,v,d,_,A,D,z);r.fontScale=pz(ae,r.textScaleFactor);const ge=c.getUnevaluatedProperty("text-size");let ye=this.textSizeData,me=H,we=j;c.hasProperty("text-size")&&(ye=Yh(this.zoom,ge,this.worldview,q),me=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,we=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const Ie=r.textShaping.bottom-A[1],Je=r.textShaping.left-A[0],qe=r.textShaping.right-A[0];r.textShaping.top=te[1]+(r.textShaping.top-A[1]),r.textShaping.bottom=te[1]+Ie,r.textShaping.left=te[0]+Je,r.textShaping.right=te[0]+qe;const Xe=az(0,r.textShaping,te,v,!1,d,T,this.allowVerticalPlacement,ue),at=ae&&ye.kind==="composite"?ge.possiblyEvaluate(new An(me,{}),_).evaluate(d,M,_):k,nt=ae&&ye.kind==="composite"?ge.possiblyEvaluate(new An(we,{}),_).evaluate(d,M,_):$,ot=TS(c.name,ye,ae,S,at,nt),Ge=Array.isArray(ot)?ot[1]:ae,ct=0,et=1+(Math.min(Kh,Math.round(Ge*Pc))<<1);r.isUsingAppearanceTextVertexData||(r.isUsingAppearanceTextVertexData=!0,r.layoutBasedTextVertexData=this.text.getSymbolVertexData(g,t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices));for(let ut=0;ut<Xe.length&&ut<(t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices)/4;++ut){const lt=Xe[ut],Bt=lt.glyphOffset[1],Ut=t.tileAnchorX,Tt=t.tileAnchorY,Mt=g+4*ut;this.text.updateSymbolVertexData(Mt,Ut,Tt,Math.round(32*lt.tl.x),Math.round(32*(Bt+lt.tl.y)),lt.texPrimary.x,lt.texPrimary.y,ct,et,lt.pixelOffsetTL.x,lt.pixelOffsetTL.y,lt.minFontScaleX,lt.minFontScaleY),this.text.updateSymbolVertexData(Mt+1,Ut,Tt,Math.round(32*lt.tr.x),Math.round(32*(Bt+lt.tr.y)),lt.texPrimary.x+lt.texPrimary.w,lt.texPrimary.y,ct,et,lt.pixelOffsetBR.x,lt.pixelOffsetTL.y,lt.minFontScaleX,lt.minFontScaleY),this.text.updateSymbolVertexData(Mt+2,Ut,Tt,Math.round(32*lt.bl.x),Math.round(32*(Bt+lt.bl.y)),lt.texPrimary.x,lt.texPrimary.y+lt.texPrimary.h,ct,et,lt.pixelOffsetTL.x,lt.pixelOffsetBR.y,lt.minFontScaleX,lt.minFontScaleY),this.text.updateSymbolVertexData(Mt+3,Ut,Tt,Math.round(32*lt.br.x),Math.round(32*(Bt+lt.br.y)),lt.texPrimary.x+lt.texPrimary.w,lt.texPrimary.y+lt.texPrimary.h,ct,et,lt.pixelOffsetBR.x,lt.pixelOffsetBR.y,lt.minFontScaleX,lt.minFontScaleY)}return{vertexOffsetDelta:t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices,hasChanges:!0}}if(r.isUsingAppearanceTextVertexData){const ue=r.layoutBasedTextVertexData.length/12;for(let ae=0;ae<ue;++ae){const ge=ae*12;this.text.updateSymbolVertexData(g+ae,r.layoutBasedTextVertexData[ge+0],r.layoutBasedTextVertexData[ge+1],r.layoutBasedTextVertexData[ge+2],r.layoutBasedTextVertexData[ge+3],r.layoutBasedTextVertexData[ge+4],r.layoutBasedTextVertexData[ge+5],r.layoutBasedTextVertexData[ge+6],r.layoutBasedTextVertexData[ge+7],r.layoutBasedTextVertexData[ge+8],r.layoutBasedTextVertexData[ge+9],r.layoutBasedTextVertexData[ge+10],r.layoutBasedTextVertexData[ge+11])}return r.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:ue,hasChanges:!0}}return{vertexOffsetDelta:t.numHorizontalGlyphVertices+t.numVerticalGlyphVertices,hasChanges:!1}}update(t,r,c,d,g,_,v){this.text.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(t,r,g,c,d,_,v,this.worldview)}updateRoadElevation(t){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let r=!1;const c=vt(t),d=1/c;let g=!1,_=!1;for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v),T=yt(1,0,0),M=yt(0,1,0),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:z,numIconVertices:D,numVerticalIconVertices:k}=S,$=A>0||z>0,H=D>0,j=this.elevationFeatures[S.elevationFeatureIndex];if(j){const q=new Ae(S.tileAnchorX,S.tileAnchorY),Y=.075+j.pointElevation(q);S.zOffset!==Y&&(r=!0,S.zOffset=Y),Y!==0&&(this.hasAnyZOffset=!0);const te=j.computeSlopeNormal(q,d),ue=Ks(Zi(),yt(0,0,1),te);Vi(T,T,ue),Vi(M,M,ue),T[2]*=c,M[2]*=c,T[0]===1&&T[1]===0&&T[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(g=g||$,_=_||H)}if($&&(qx(this.text.orientationVertexArray,A,T,M),qx(this.text.orientationVertexArray,z,T,M)),H){const{placedIconSymbolIndex:q,verticalPlacedIconSymbolIndex:Y}=S;q>=0&&qx(this.icon.orientationVertexArray,D,T,M),Y>=0&&qx(this.icon.orientationVertexArray,k,T,M)}}g||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),r&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const t=(g,_,v)=>{c+=_,c>g.length&&g.resize(c);for(let S=-_;S<0;S++)g.emplace(S+c,v)},r=(g,_,v)=>{d+=_,d>g.length&&g.resize(d);for(let S=-_;S<0;S++)g.emplace(S+d,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,d=0;for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:S,numIconVertices:T}=_,M=_.zOffset,A=T>0;if((v>0||S>0)&&(t(this.text.zOffsetVertexArray,v,M),t(this.text.zOffsetVertexArray,S,M)),A){const{placedIconSymbolIndex:z,verticalPlacedIconSymbolIndex:D}=_;z>=0&&r(this.icon.zOffsetVertexArray,T,M),D>=0&&r(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t,r,c,d,g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(_=>_.appearances&&_.appearances.length>0)),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(t,r,c,d,g){if(!(t&&r&&c&&this.appearanceFeatureData))return!1;const _=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,v=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!_&&!v)return!1;const S=this.layers[0],T=S.layout;let M=1,A=0,z=!1;if(_){const[j,q]=T.get("icon-size-scale-range");M=de(1,j,q)}let D=1,k=0,$=!1;if(v){const[j,q]=T.get("text-size-scale-range");D=de(1,j,q)}const H=new Map;if(g&&c)for(const j of c){const q=g.getImage(j,S.scope);if(q){const Y=new os(j.toString());H.set(Y.toString(),q)}}for(let j=0;j<this.symbolInstances.length;j++){const q=this.symbolInstances.get(j),Y=this.featureToAppearanceIndex[q.featureIndex],te=Y!==void 0?this.appearanceFeatureData[Y]:void 0;if(!te)continue;const ue=te.id,ae=r&&ue!==void 0?r[String(ue)]:void 0,ge={type:"Point",id:te.id,properties:te.properties,geometry:[]},ye=S.appearances&&S.appearances.find(me=>me.isActive({globals:d,feature:ge,canonical:t,featureState:ae}));if(v){const me=T.get("text-size"),we=T.get("text-offset").evaluate(ge,ae,t),Ie=me.evaluate(ge,ae,t),Je=T.get("text-rotate").evaluate(ge,ae,t),qe=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,Xe=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,at=me.evaluate(ge,{zoom:qe},t),nt=me.evaluate(ge,{zoom:Xe},t),ot=this.updateSymbolInstanceTextVertices(q,te,ye,ge,k,t,S,D,H,ae,we,Ie,Je,at,nt,qe,Xe,c);k+=ot.vertexOffsetDelta,$=$||ot.hasChanges}if(_){const me=T.get("icon-offset").evaluate(ge,ae,t),we=T.get("icon-size").evaluate(ge,ae,t,c),Ie=T.get("icon-rotate").evaluate(ge,ae,t),Je=this.updateSymbolInstanceIconVertices(q,te,ye,ge,A,t,c,d,S,M,ae,me,we,Ie);A+=Je.vertexOffsetDelta,z=z||Je.hasChanges}te.activeAppearance=ye}return z&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),$&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),z||$}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=wz(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:d,y:g}of r)this.lineVertexArray.emplaceBack(d,g);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,r,c,d,g,_,v,S,T,M,A,z,D,k,$,H,j,q){const Y=t.indexArray,te=t.layoutVertexArray,ue=t.globeExtVertexArray,ae=t.segments.prepareSegment(4*q,te,Y,this.canOverlap?_.sortKey:void 0),ge=this.glyphOffsetArray.length,ye=ae.vertexLength,me=this.allowVerticalPlacement&&v===Zs.vertical?Math.PI/2:0,we=_.text&&_.text.sections;for(let qe=0;qe<r.length;qe++){const{tl:Xe,tr:at,bl:nt,br:ot,texPrimary:Ge,texSecondary:ct,pixelOffsetTL:et,pixelOffsetBR:ut,minFontScaleX:lt,minFontScaleY:Bt,glyphOffset:Ut,isSDF:Tt,sectionIndex:Mt}=r[qe],ai=ae.vertexLength,Jt=Ut[1];if(Jg(te,T.x,T.y,Xe.x,Jt+Xe.y,Ge.x,Ge.y,c,Tt,et.x,et.y,lt,Bt),Jg(te,T.x,T.y,at.x,Jt+at.y,Ge.x+Ge.w,Ge.y,c,Tt,ut.x,et.y,lt,Bt),Jg(te,T.x,T.y,nt.x,Jt+nt.y,Ge.x,Ge.y+Ge.h,c,Tt,et.x,ut.y,lt,Bt),Jg(te,T.x,T.y,ot.x,Jt+ot.y,Ge.x+Ge.w,Ge.y+Ge.h,c,Tt,ut.x,ut.y,lt,Bt),S){const{x:Ct,y:xi,z:Wi}=S.anchor,[mn,Gi,Pn]=S.up;Kg(ue,Ct,xi,Wi,mn,Gi,Pn),Kg(ue,Ct,xi,Wi,mn,Gi,Pn),Kg(ue,Ct,xi,Wi,mn,Gi,Pn),Kg(ue,Ct,xi,Wi,mn,Gi,Pn),jf(t.dynamicLayoutVertexArray,Ct,xi,Wi,me)}else jf(t.dynamicLayoutVertexArray,T.x,T.y,T.z,me);if(H){const Ct=ct||Ge;Yg(t.iconTransitioningVertexArray,Ct.x,Ct.y),Yg(t.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y),Yg(t.iconTransitioningVertexArray,Ct.x,Ct.y+Ct.h),Yg(t.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y+Ct.h)}Y.emplaceBack(ai,ai+1,ai+2),Y.emplaceBack(ai+1,ai+2,ai+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),qe!==r.length-1&&Mt===r[qe+1].sectionIndex||t.programConfigurations.populatePaintArrays(te.length,_,_.index,{},D,k,$,we&&we[Mt],this.worldview)}const Ie=q-r.length;Ie!==0&&this._addNullVertices(Ie,te,c,S,ue,t,H,ae,Y);const Je=S?S.anchor:T;t.placedSymbolArray.emplaceBack(Je.x,Je.y,Je.z,T.x,T.y,ge,this.glyphOffsetArray.length-ge,ye,M,A,T.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],v,0,0,0,z,0),t.symbolInstanceIndices.push(j)}_addNullVertices(t,r,c,d,g,_,v,S,T){for(let M=0;M<t;M++){for(let z=0;z<4;z++)Jg(r,0,0,0,0,0,0,c,!1,0,0,0,0),d&&Kg(g,0,0,0,0,0,0),jf(_.dynamicLayoutVertexArray,0,0,0,0),v&&Yg(_.iconTransitioningVertexArray,0,0);const A=S.vertexLength;T.emplaceBack(A,A+1,A+2),T.emplaceBack(A+1,A+2,A+3),S.vertexLength+=4,S.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(t,r,c,d,g,_,v){t.emplaceBack(r,c,d,g,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(t,r,c,d,g,_,v){const S=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),T=S.vertexLength,M=v.tileAnchorX,A=v.tileAnchorY;for(let D=0;D<4;D++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,r,t.padding,v.zOffset),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,M,A,new Ae(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,M,A,new Ae(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,M,A,new Ae(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,d,g,_,M,A,new Ae(t.x1,t.y2)),S.vertexLength+=4;const z=c.indexArray;z.emplaceBack(T,T+1),z.emplaceBack(T+1,T+2),z.emplaceBack(T+2,T+3),z.emplaceBack(T+3,T),S.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,c,d,g,_){for(let v=d;v<g;v++){const S=c.get(v),T=this.getSymbolInstanceTextSize(t,_,r,v);this._addCollisionDebugVertices(S,T,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(t,r,c,d,g,_){for(let v=d;v<g;v++){const S=c.get(v),T=this.getSymbolInstanceIconSize(t,r,_.placedIconSymbolIndex);this._addCollisionDebugVertices(S,T,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}generateCollisionDebugBuffers(t,r,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new MS(vf,FP.members,Us),this.iconCollisionBox=new MS(vf,FP.members,Us);const d=Nf(this.iconSizeData,t),g=Nf(this.textSizeData,t,c);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(g,t,r,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(g,t,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,t,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,t,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(t,r,c,d){const g=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:d),_=_S(this.textSizeData,t,g)/ao;return this.tilePixelRatio*_}getSymbolInstanceIconSize(t,r,c){const d=this.icon.placedSymbolArray.get(c),g=_S(this.iconSizeData,t,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(t,r,c,d){t.emplaceBack(r,-c,-c,d),t.emplaceBack(r,c,-c,d),t.emplaceBack(r,c,c,d),t.emplaceBack(r,-c,c,d)}_updateTextDebugCollisionBoxes(t,r,c,d,g,_,v){for(let S=d;S<g;S++){const T=c.get(S),M=this.getSymbolInstanceTextSize(t,_,r,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,T.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(t,r,c,d,g,_,v){for(let S=d;S<g;S++){const T=c.get(S),M=this.getSymbolInstanceIconSize(t,r,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,T.padding,_.zOffset)}}updateCollisionDebugBuffers(t,r,c,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=Nf(this.iconSizeData,t,d),_=Nf(this.textSizeData,t,c);for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(_,t,r,S.textBoxStartIndex,S.textBoxEndIndex,S,c),this._updateTextDebugCollisionBoxes(_,t,r,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,c),this._updateIconDebugCollisionBoxes(g,t,r,S.iconBoxStartIndex,S.iconBoxEndIndex,S,d),this._updateIconDebugCollisionBoxes(g,t,r,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,c,d,g,_,v,S,T){const M={};if(r<c){const{x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:Y,tileAnchorY:te,featureIndex:ue}=t.get(r);M.textBox={x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:Y,tileAnchorY:te},M.textFeatureIndex=ue}if(d<g){const{x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:Y,tileAnchorY:te,featureIndex:ue}=t.get(d);M.verticalTextBox={x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:Y,tileAnchorY:te},M.verticalTextFeatureIndex=ue}if(_<v){const{x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:Y,tileAnchorY:te,featureIndex:ue}=t.get(_);M.iconBox={x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:Y,tileAnchorY:te},M.iconFeatureIndex=ue}if(S<T){const{x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:Y,tileAnchorY:te,featureIndex:ue}=t.get(S);M.verticalIconBox={x1:A,y1:z,x2:D,y2:k,padding:$,projectedAnchorX:H,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:Y,tileAnchorY:te},M.verticalIconFeatureIndex=ue}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const c=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,r){const c=t.placedSymbolArray.get(r),d=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<d;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),c=Math.cos(t),d=[],g=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const S=this.symbolInstances.get(v);d.push(0|Math.round(r*S.tileAnchorX+c*S.tileAnchorY)),g.push(S.featureIndex)}return _.sort((v,S)=>d[v]-d[S]||g[S]-g[v]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,r){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===r?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const c=this.symbolInstances.get(r);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:T}=c;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),_>=0&&_!==g&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(t){const r=this.symbolInstances.get(this.text.symbolInstanceIndices[t]).elevationFeatureIndex;let c;return this.elevationFeatures&&r<this.elevationFeatures.length&&(c=this.elevationFeatures[r]),c}}function Sz(a,t){return t.replace(/{([^{}]+)}/g,(r,c)=>c in a?String(a[c]):"")}let Tz,Ez,AS;Vt(Xx,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Xx.addDynamicAttributes=jf;class Iz{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:rs,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Vt(Iz,"FormatSectionOverride",{omit:["defaultValue"]});const PS=()=>AS||(AS={layout:Tz||(Tz=new ur({"symbol-placement":new bt(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pt(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(ke.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new bt(ke.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new bt(ke.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new bt(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bt(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pt(ke.layout_symbol["icon-size"]),"icon-size-scale-range":new bt(ke.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Pt(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pt(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pt(ke.layout_symbol["icon-image"]),"icon-image-use-theme":new bt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Pt(ke.layout_symbol["icon-rotate"]),"icon-padding":new bt(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Pt(ke.layout_symbol["icon-offset"]),"icon-anchor":new Pt(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(ke.layout_symbol["text-rotation-alignment"]),"text-field":new Pt(ke.layout_symbol["text-field"]),"text-font":new Pt(ke.layout_symbol["text-font"]),"text-size":new Pt(ke.layout_symbol["text-size"]),"text-size-scale-range":new bt(ke.layout_symbol["text-size-scale-range"]),"text-max-width":new Pt(ke.layout_symbol["text-max-width"]),"text-line-height":new Pt(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Pt(ke.layout_symbol["text-letter-spacing"]),"text-justify":new Pt(ke.layout_symbol["text-justify"]),"text-radial-offset":new Pt(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new Pt(ke.layout_symbol["text-anchor"]),"text-max-angle":new bt(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(ke.layout_symbol["text-writing-mode"]),"text-rotate":new Pt(ke.layout_symbol["text-rotate"]),"text-padding":new bt(ke.layout_symbol["text-padding"]),"text-keep-upright":new bt(ke.layout_symbol["text-keep-upright"]),"text-transform":new Pt(ke.layout_symbol["text-transform"]),"text-offset":new Pt(ke.layout_symbol["text-offset"]),"text-allow-overlap":new bt(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bt(ke.layout_symbol["text-ignore-placement"]),"text-optional":new bt(ke.layout_symbol["text-optional"]),visibility:new bt(ke.layout_symbol.visibility)})),paint:Ez||(Ez=new ur({"icon-opacity":new Pt(ke.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Pt(ke.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Pt(ke.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Pt(ke.paint_symbol["text-emissive-strength"]),"icon-color":new Pt(ke.paint_symbol["icon-color"]),"icon-halo-color":new Pt(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pt(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pt(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(ke.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new bt(ke.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Pt(ke.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Pt(ke.paint_symbol["text-occlusion-opacity"]),"text-color":new Pt(ke.paint_symbol["text-color"],{runtimeType:$o,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Pt(ke.paint_symbol["text-halo-color"]),"text-halo-width":new Pt(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Pt(ke.paint_symbol["text-halo-blur"]),"text-translate":new bt(ke.paint_symbol["text-translate"]),"text-translate-anchor":new bt(ke.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new bt(ke.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new bt(ke.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new bt(ke.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new bt(ke.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Pt(ke.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},AS);class Jx extends Go{constructor(t,r,c,d){super(t,PS(),r,c,d,t.layout?t.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=fe([]),this.hasOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}_handleSpecialPaintPropertyUpdate(t){t!=="icon-occlusion-opacity"&&t!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(t,r){super.recalculate(t,r),this.appearances&&this.appearances.forEach(d=>{d.recalculate(t,r,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const g of c)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,r,c,d){return this._saturation===t&&this._contrast===r&&this._brightnessMin===c&&this._brightnessMax===d||(this._colorAdjustmentMatrix=(function(g,_,v,S){g=To(g),_=_r(_);const T=ee(),M=g/3,A=1-2*M,z=[A,M,M,0,M,A,M,0,M,M,A,0,0,0,0,1],D=.5-.5*_,k=S-v;return ie(T,[k,0,0,0,0,k,0,0,0,0,k,0,v,v,v,1],[_,0,0,0,0,_,0,0,0,0,_,0,D,D,D,1]),ie(T,T,z),T})(t,r,c,d),this._saturation=t,this._contrast=r,this._brightnessMin=c,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,r,c,d){const g=this.layout.get(t).evaluate(r,{},c,d),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Ih(_.value)||!g?g:Sz(r.properties,g)}getAppearanceValueAndResolveTokens(t,r,c,d,g){const _=t.getProperty(r);if(!_)return;const v=_.evaluate(c,{},d,g),S=t.getUnevaluatedProperties()._values[r];return S.isDataDriven()||Ih(S.value)||!v||typeof v!="string"?v:Sz(c.properties,v)}createBucket(t){return new Xx(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of PS().paint.overridableProperties){if(!Jx.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),c=new Iz(r),d=new lf(c,r.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new Mh("source",d):new vc("composite",d,r.value.zoomStops,r.value.interpolationType),this.paint._values[t]=new bc(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,c){return!(!this.layout||r.isDataDriven()||c.isDataDriven())&&Jx.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const c=t.get("text-field"),d=PS().paint.properties[r];let g=!1;const _=v=>{for(const S of v)if(d.overrides&&d.overrides.hasOverride(S))return void(g=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Do)_(c.value.value.sections);else if(c.value.kind==="source"){const v=T=>{g||(T instanceof cl&&Kr(T.value)===Jc?_(T.value.sections):T instanceof Kt?_(T.sections):T.eachChild(v))},S=c.value;S._styleExpression&&v(S._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,r,c){return{config:new R(this,{zoom:r,lut:c}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Mz,Az,Pz,zz;var zS=Yi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Yx(a,t,r,c,d,g,_,v){const S=[a,t,1,r,c,1,d,g,1],T=[_,v,1],M=V([],S),[A,z,D]=ui(T,T,M);return J(S,S,[A,0,0,0,z,0,0,0,D])}function Cz(a,t,r,c,d,g,_,v){const S=(function(T,M,A,z,D,k,$,H){const j=Yx(0,0,1,0,1,1,0,1),q=Yx(T,M,A,z,D,k,$,H);return J(q,q,V([],j))})(a,t,r,c,d,g,_,v);return[S[2]/S[8]/It,S[5]/S[8]/It]}function Kx(a){return[a[0],Math.min(Math.max(a[1],-85.051129),Te)]}class Rz extends ll{constructor(t,r,c,d){super(),this.id=t,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=r,this._dirty=!1}load(t,r){if(this._loaded=r||!1,this.fire(new al("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Cd(this.map._requestManager.transformRequest(this.url,is.Image),(c,d)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new uh(c)):d&&(this.image=d instanceof HTMLImageElement?ks.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Fg(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new al("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Fg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=t[0][1],c=t[0][1];for(const g of t)g[1]>c&&(c=g[1]),g[1]<r&&(r=g[1]);const d=(c+r)/2;if(d>Te?this.onNorthPole=!0:d<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=t.map(At.fromLngLat);this.tileID=(function(_){let v=1/0,S=1/0,T=-1/0,M=-1/0;for(const $ of _)v=Math.min(v,$.x),S=Math.min(S,$.y),T=Math.max(T,$.x),M=Math.max(M,$.y);const A=Math.max(T-v,M-S),z=Math.max(0,Math.floor(-Math.log2(A))),D=Math.pow(2,z);let k=Math.floor((v+T)/2*D);return k>1&&(k-=1),new Hh(z,k,Math.floor((S+M)/2*D))})(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new al("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Fg||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const j in this.tiles){const q=this.tiles[j];q.state!=="loaded"&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Hg(new Hh(0,0,0),this.map.transform.projection),c=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(j){const q=j[1].x-j[0].x,Y=j[1].y-j[0].y,te=j[2].x-j[1].x,ue=j[2].y-j[1].y,ae=j[3].x-j[2].x,ge=j[3].y-j[2].y,ye=j[0].x-j[3].x,me=j[0].y-j[3].y,we=q*ue-te*Y,Ie=te*ge-ae*ue,Je=ae*me-ye*ge,qe=ye*Y-q*me;return we>0&&Ie>0&&Je>0&&qe>0||we<0&&Ie<0&&Je<0&&qe<0})(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=Hg(this.tileID,this.map.transform.projection),[g,_,v,S]=this.coordinates.map(j=>{const q=d.projection.project(j[0],j[1]);return _z(d,q)._round()});this.perspectiveTransform=Cz(g.x,g.y,_.x,_.y,v.x,v.y,S.x,S.y);const T=this._boundsArray=new pl;T.emplaceBack(g.x,g.y,0,0),T.emplaceBack(_.x,_.y,It,0),T.emplaceBack(S.x,S.y,0,It),T.emplaceBack(v.x,v.y,It,It),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(T,zS.members),this.boundsSegments=er.simpleSegment(0,0,4,2);const M=[],A=[Kx((z=this.coordinates)[0]),Kx(z[1]),Kx(z[2]),Kx(z[3])];var z;const[D,k,$,H]=(function(j){let q=j[0][0],Y=q,te=j[0][1],ue=te;for(let ae=1;ae<j.length;ae++)j[ae][0]<q?q=j[ae][0]:j[ae][0]>Y&&(Y=j[ae][0]),j[ae][1]<te?te=j[ae][1]:j[ae][1]>ue&&(ue=j[ae][1]);return[q,te,Y-q,ue-te]})(A);{const j=new pl,[q,Y,te,ue]=(function(ot){let Ge=ot[0].x,ct=Ge,et=ot[0].y,ut=et;for(let lt=1;lt<ot.length;lt++)ot[lt].x<Ge?Ge=ot[lt].x:ot[lt].x>ct&&(ct=ot[lt].x),ot[lt].y<et?et=ot[lt].y:ot[lt].y>ut&&(ut=ot[lt].y);return[Ge,et,ct-Ge,ut-et]})(c),ae=ot=>[(ot.x-q)/te,(ot.y-Y)/ue],[ge,ye,me,we]=c.map(ae),Ie=(function(ot,Ge,ct,et,ut,lt,Bt,Ut){const Tt=Yx(0,0,1,0,1,1,0,1);return J(Tt,Tt,V([],Yx(ot,Ge,ct,et,ut,lt,Bt,Ut)))})(ge[0],ge[1],ye[0],ye[1],me[0],me[1],we[0],we[1]);this.elevatedGlobePerspectiveTransform=Cz(ge[0],ge[1],ye[0],ye[1],me[0],me[1],we[0],we[1]);const Je=(ot,Ge)=>{M.push(ot.lng);const ct=Math.round((ot.lng-D)/$*It),et=Math.round((ot.lat-k)/H*It),ut=ae(Ge),lt=ui([],[ut[0],ut[1],1],Ie),Bt=Math.round(lt[0]/lt[2]*It),Ut=Math.round(lt[1]/lt[2]*It);j.emplaceBack(ct,et,Bt,Ut)},qe=c[3].x-c[0].x,Xe=c[3].y-c[0].y,at=c[2].x-c[1].x,nt=c[2].y-c[1].y;for(let ot=0;ot<65;ot++){const Ge=ot/64,ct=[c[0].x+Ge*qe,c[0].y+Ge*Xe],et=[c[1].x+Ge*at,c[1].y+Ge*nt],ut=et[0]-ct[0],lt=et[1]-ct[1];for(let Bt=0;Bt<65;Bt++){const Ut=Bt/64,Tt={x:ct[0]+ut*Ut,y:ct[1]+lt*Ut};Je(r.projection.unproject(Tt.x,Tt.y),Tt)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(j,zS.members)}{this.maxLongitudeTriangleSize=0;let j=[],q=new Hr;const Y=(te,ue,ae)=>{q.emplaceBack(te,ue,ae);const ge=M[te],ye=M[ue],me=M[ae],we=Math.min(Math.min(ge,ye),me),Ie=Math.max(Math.max(ge,ye),me)-we;Ie>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ie),j.push(we+Ie/2)};for(let te=0;te<64;te++)for(let ue=0;ue<64;ue++){const ae=65*te+ue,ge=ae+1,ye=ae+65,me=ye+1;Y(ae,ye,ge),Y(ge,ye,me)}[j,q]=(function(te,ue){const ae=Array.from({length:te.length},(me,we)=>we);ae.sort((me,we)=>te[me]-te[we]);const ge=[],ye=new Hr;for(let me=0;me<ae.length;me++){const we=ae[me];ge.push(te[we]);const Ie=3*we,Je=Ie+1;ye.emplaceBack(ue.uint16[Ie],ue.uint16[Je],ue.uint16[Je+1])}return[ge,ye]})(j,q),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(q)}this.elevatedGlobeSegments=er.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,$/It,0,H/It,0,0,k,D,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const r=this.map.painter.context,c=r.gl;!this._dirty||this.texture instanceof Fg||(this.texture?this.texture.update(this.image):(this.texture=new eS(r,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(r)}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let d=(g=t+180)+360*Math.round((c[0]-g)/360);var g;const _=new er,v=(A,z)=>{_.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:r.segments[0].vertexLength,primitiveLength:z,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-d)<=S){const A=Fn(c,0,c.length,d+S);return A===c.length||v(A,On(c,A+1,c.length,d+360-S)-A),_}d<c[0]&&(d+=360);const T=On(c,0,c.length,d-S);if(T===c.length)return v(0,c.length),_;v(0,T-0);const M=Fn(c,T+1,c.length,d+S);return M!==c.length&&v(M,c.length-M),_}}const CS=1024,NV=(Math.pow(CS,2)-1)/268170240;class Lz extends Go{constructor(t,r,c,d){super(t,{layout:Pz||(Pz=new ur({visibility:new bt(ke.layout_raster.visibility)})),paint:zz||(zz=new ur({"raster-opacity":new bt(ke.paint_raster["raster-opacity"]),"raster-color":new fu(ke.paint_raster["raster-color"]),"raster-color-mix":new bt(ke.paint_raster["raster-color-mix"]),"raster-color-range":new bt(ke.paint_raster["raster-color-range"]),"raster-hue-rotate":new bt(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(ke.paint_raster["raster-saturation"]),"raster-contrast":new bt(ke.paint_raster["raster-contrast"]),"raster-resampling":new bt(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(ke.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new bt(ke.paint_raster["raster-emissive-strength"]),"raster-array-band":new bt(ke.paint_raster["raster-array-band"]),"raster-elevation":new bt(ke.paint_raster["raster-elevation"]),"raster-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof Rz&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[c,d]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(d)||c===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=xg({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:d}],resolution:CS}),this.colorRampTexture=null,this._curRampRange=[c,d])}is3D(t){return this.paint.get("raster-elevation")>0}}let Dz,kz,Oz,Fz,Bz;class Nz extends Go{constructor(t,r,c,d){super(t,{layout:Dz||(Dz=new ur({visibility:new bt(ke["layout_raster-particle"].visibility)})),paint:kz||(kz=new ur({"raster-particle-array-band":new bt(ke["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new bt(ke["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new fu(ke["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new bt(ke["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new bt(ke["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new bt(ke["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new bt(ke["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new bt(ke["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d),this._updateColorRamp(),this.lastInvalidatedAt=ks.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=xg({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ks.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class UV extends Go{constructor(t,r){super(t,{},r,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(t){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function RS(a,t,r){const c=[0,0,1],d=qi([]);return Xi(d,d,r?-ti(a)+Math.PI:ti(a)),$i(d,d,-ti(t)),Vi(c,c,d),Li(c,c)}const Uz={None:0,Model:1,Symbol:2,FillExtrusion:4};class Qx{constructor(t,r,c,d){this.message=(t?`${t}: `:"")+c,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)}}function LS(a,t){const r=a.indexOf("://")===-1;try{return new URL(a,r&&t?"http://example.com":void 0),!0}catch{return!1}}class $z{constructor(t,r){this.feature=t,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Vz{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new mg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(t){const r=16*t,c=this.instancedDataArray.float32;let d=Math.floor(c[r+2]);const g=1.05*(c[r+2]-d);return d/=100,[c[r]%1*1.05,c[r+1]%1*1.05,g,d]}tileCoordinatesForInstance(t){const r=16*t,c=this.instancedDataArray.float32;let d=c[r+0];return d=d>It?d-It:d,new Ae(Math.trunc(d),Math.trunc(c[r+1]))}translationForInstance(t){const r=16*t,c=this.instancedDataArray.float32;return[c[r+4],c[r+5],c[r+6]]}rotationScaleForInstance(t){const r=16*t,c=this.instancedDataArray.float32;return[c[r+7],c[r+8],c[r+9],c[r+10],c[r+11],c[r+12],c[r+13],c[r+14],c[r+15]]}transformForInstance(t){const r=16*t,c=this.instancedDataArray.float32;return[c[r+7],c[r+8],c[r+9],c[r+4],c[r+10],c[r+11],c[r+12],c[r+5],c[r+13],c[r+14],c[r+15],c[r+6],0,0,0,1]}}class DS{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaledZ=this.canonical.z+Math.log2(t.overscaling),this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=t.projection,this.index=t.index,this.worldview=t.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=t.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(t,r){}updateAppearances(t,r,c,d){}populate(t,r,c,d){this.tileToMeter=vt(c);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);const _=this.layers[0].paint.get("model-elevation-reference")==="hd-road-markup"?r.elevationFeatures:void 0;for(const{feature:v,id:S,index:T,sourceLayerIndex:M}of t){const A=S??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),z=Bi(v,g);if(!this.layers[0]._featureFilter.filter(new An(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),z,c))continue;const D={id:A,sourceLayerIndex:M,index:T,geometry:g?z.geometry:fi(v,c,d),properties:v.properties,type:v.type,patterns:{}},k=this.addFeature(D,D.geometry,z,_,c);k&&r.featureIndex.insert(v,D.geometry,T,M,this.index,this.instancesPerModel[k].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const t=this.layers[0].modelManager,r=this.layers[0].scope;let c=0;for(const d of this.modelUris){const g=t.getModel(d,r);if(!g)continue;const _=this.instancesPerModel[d];if(_){const v=.5*Un(g.aabb.max,g.aabb.min)*_.maxScale+_.maxXYTranslationDistance,S=Math.min(It,Math.max(v/this.tileToMeter,256));c=Math.max(S,c)}}return c}update(t,r,c,d){for(const g in this.instancesPerModel){const _=this.instancesPerModel[g];for(const v in t)_.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(_.features[_.idToFeaturesIndex[v]],t[v],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const c=this.instancesPerModel[r];for(const d of c.features){const g=this.layers[0],_=d.feature,v=this.canonical,S=g.paint.get("model-rotation").evaluate(_,{},v),T=g.paint.get("model-scale").evaluate(_,{},v),M=g.paint.get("model-translation").evaluate(_,{},v);$e(d.rotation,S)&&$e(d.scale,T)&&$e(d.translation,M)||(this.evaluate(d,d.featureStates,c,!0),t=!0)}}return t}updateReplacement(t,r,c,d){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const g=r.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(Sx(this.activeReplacements,g))return!1;this.activeReplacements=g;let _=!1;for(const v in this.instancesPerModel){const S=this.instancesPerModel[v],T=S.instancedDataArray;for(const M of S.features){const A=M.instancedDataOffset,z=M.instancedDataCount;for(let D=0;D<z;D++){const k=16*(D+A);let $=T.float32[k+0];const H=$>It;$=H?$-It:$;const j=Math.floor($),q=Math.floor(T.float32[k+1]);let Y=!1;for(const te of this.activeReplacements)if(!bA(te,c,Uz.Model,d)&&!(te.min.x>j||j>te.max.x||te.min.y>q||q>te.max.y)&&(Y=IA(EA(j,q,t.canonical,te.footprintTileId.canonical),te.footprint),Y))break;T.float32[k]=Y?$+It:$,_=_||Y!==H}}}return _}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const r in this.instancesPerModel){const c=this.instancesPerModel[r];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=t.createVertexBuffer(c.instancedDataArray,l5.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(t){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(t&&r&&this.modelUris&&this.modelsRequested)for(const c of this.modelUris)r.removeModel(c,"",!0)}addFeature(t,r,c,d,g){const _=this.layers[0],v=_.layout.get("model-id"),S=_.layout.get("model-allow-density-reduction"),T=v.evaluate(c,{},this.canonical);if(!T)return yi(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),T;(LS(T,!1)||this.styleDefinedModelURLs[T]!==void 0)&&(this.modelUris.includes(T)||this.modelUris.push(T)),this.instancesPerModel[T]||(this.instancesPerModel[T]=new Vz);const M=this.instancesPerModel[T],A=M.instancedDataArray,z=new $z(c,A.length);let D;d&&(D=Zo.getElevationFeature(t,d));for(const k of r)for(const $ of k){if($.x<0||$.x>=It||$.y<0||$.y>=It)continue;if(this.lookupDim!==0&&S){const j=(this.lookupDim-1)/It,q=this.lookupDim*($.y*j|0)+$.x*j|0;if(this.lookup){if(this.lookup[q]!==0)continue;this.lookup[q]=1}}this.instanceCount++;const H=A.length;if(A.resize(H+1),d){M.instancesRoadElevation||(M.instancesRoadElevation=[]);const j=D?D.pointElevation(new Ae($.x,$.y)):0;M.instancesRoadElevation.push(j)}M.instancesEvaluatedElevation.push(0),A.float32[16*H]=$.x,A.float32[16*H+1]=$.y}return z.instancedDataCount=M.instancedDataArray.length-z.instancedDataOffset,z.instancedDataCount>0&&(t.id&&(M.idToFeaturesIndex[t.id]=M.features.length),M.features.push(z),this.evaluate(z,{},M,!1)),T}getModelUris(){return this.modelUris}evaluate(t,r,c,d){const g=this.layers[0],_=t.feature,v=this.canonical,S=t.rotation=g.paint.get("model-rotation").evaluate(_,r,v),T=t.scale=g.paint.get("model-scale").evaluate(_,r,v),M=t.translation=g.paint.get("model-translation").evaluate(_,r,v),A=Object.assign({},g.paint.get("model-color").evaluate(_,r,v));A.a=g.paint.get("model-color-mix-intensity").evaluate(_,r,v);const z=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]);const D=M[0]*M[0]+M[1]*M[1],k=D>0?Math.sqrt(D):0;c.maxScale=Math.max(Math.max(c.maxScale,T[0]),Math.max(T[1],T[2])),c.maxXYTranslationDistance=Math.max(c.maxXYTranslationDistance,k),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),gP(z,S,T);const $=Math.round(100*A.a)+A.b/1.05;for(let H=0;H<t.instancedDataCount;++H){const j=t.instancedDataOffset+H,q=16*j,Y=c.instancedDataArray.float32;let te=0;d&&(te=Y[q+6]-c.instancesEvaluatedElevation[j]);const ue=0|Y[q+1];Y[q]=(0|Y[q])+A.r/1.05,Y[q+1]=ue+A.g/1.05,Y[q+2]=$,Y[q+3]=1/(v.z>10?this.tileToMeter:vt(v,ue)),Y[q+4]=M[0],Y[q+5]=M[1],Y[q+6]=M[2]+(c.instancesRoadElevation?c.instancesRoadElevation[j]:0)+te,Y[q+7]=z[0],Y[q+8]=z[1],Y[q+9]=z[2],Y[q+10]=z[4],Y[q+11]=z[5],Y[q+12]=z[6],Y[q+13]=z[8],Y[q+14]=z[9],Y[q+15]=z[10],c.instancesEvaluatedElevation[j]=M[2]}}}let jz,Gz;Vt(DS,"ModelBucket",{omit:["layers"]}),Vt(Vz,"PerModelAttributes"),Vt($z,"ModelFeature");class Gf{constructor(t,r,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=c}static create(t,r,c){const d=c||t.findDEMTileFor(r);if(!d||!d.dem)return;const g=d.dem,_=d.tileID,v=1<<r.canonical.z-_.canonical.z;return new Gf(d,g.dim/It/v,[(r.canonical.x/v-_.canonical.x)*g.dim,(r.canonical.y/v-_.canonical.y)*g.dim])}tileCoordToPixel(t,r){const c=r*this._scale+this._offset[1];return new Ae(Math.floor(t*this._scale+this._offset[0]),Math.floor(c))}getElevationAt(t,r,c,d){const g=t*this._scale+this._offset[0],_=r*this._scale+this._offset[1],v=Math.floor(g),S=Math.floor(_),T=this._dem;return d=!!d,c?hi(hi(T.get(v,S,d),T.get(v,S+1,d),_-S),hi(T.get(v+1,S,d),T.get(v+1,S+1,d),_-S),g-v):T.get(v,S,d)}getElevationAtPixel(t,r,c){return this._dem.get(t,r,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*je(1,t)*this._dem.stride}}const kS=new Float32Array(262144),Qh=new Uint8Array(262144);function Hz(a){let t=0;if(a.meshes)for(const r of a.meshes)t=Math.max(t,r.aabb.max[2]);if(a.children)for(const r of a.children)t=Math.max(t,Hz(r));return t}function Zz(a,t,r){if(a.meshes)for(const c of a.meshes){if(c.aabb.min[0]===1/0)continue;const d=yn.applyTransform(c.aabb,a.globalMatrix);r.insert(t,d.min[0],d.min[1],d.max[0],d.max[1])}if(a.children)for(const c of a.children)Zz(c,t,r)}const Wz=["","wall","door","roof","window","lamp","logo"];class qz{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:Hz(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const r=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==t&&(c.transformedAabb=yn.applyTransformFast(c.aabb,this.node.globalMatrix),r.encapsulate(c.transformedAabb)),t++;this.aabb=r}return this.aabb}}class e0{constructor(t,r,c,d,g,_,v,S){this.id=c,this.layers=t,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Of.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=Of.HasMapboxMeshFeatures),g&&(this.modelTraits|=Of.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=S,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of r)this.nodesInfo.push(new qz(T)),Zz(T,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(t,r){for(const c of this.getNodesInfo()){const d=c.node;d.footprint&&r.push({footprint:d.footprint,id:t})}}updateAppearances(t,r,c,d){}update(t){const r=Object.keys(t).length!==0;if(r&&!this.stateDependentLayers.length)return;const c=r?this.stateDependentLayers:this.layers;if(!Ot(t,this.states))for(const d of c)this.evaluate(d,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const c of r){const d=c.node;this.uploaded?this.updatePbrBuffer(d):nS(d,t,!0)}for(const c of r)kx(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let r=!1;if(!t.meshes)return r;for(const c of t.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),r=!0);return r}needsReEvaluation(t,r,c){const d=t.transform.projectionOptions,g=t.style.getBrightness(),_=this.brightness!==g;if(!this.uploaded||this.dirty||d.name!==this.projection.name||Qg(c.paint.get("model-color").value,_)||Qg(c.paint.get("model-color-mix-intensity").value,_)||Qg(c.paint.get("model-roughness").value,_)||Qg(c.paint.get("model-emissive-strength").value,_)||Qg(c.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=d,this.brightness=g;const v=this.getNodesInfo();for(const S of v)S.state=null;return!0}return!1}evaluateTransform(t,r){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const c=this.getNodesInfo(),d=this.id.canonical;for(const g of c){const _=g.feature;g.evaluatedTranslation=r.paint.get("model-translation").evaluate(_,{},d),g.evaluatedScale=r.paint.get("model-scale").evaluate(_,{},d)}}evaluate(t,r){const c=this.getNodesInfo();for(const d of c){if(!d.node.meshes)continue;const g=d.feature,_=r&&r[g.id];if(Ot(_,d.state))continue;d.state=structuredClone(_);const v=d.node.meshes&&d.node.meshes[0].featureData,S=d.evaluatedColor[2],T=d.evaluatedRMEA[2],M=this.id.canonical;if(d.hasTranslucentParts=!1,v){for(let A=0;A<Wz.length;A++){const z=Wz[A];z.length&&(g.properties.part=z);const D=t.paint.get("model-color").evaluate(g,_,M).toPremultipliedRenderColor(null),k=t.paint.get("model-color-mix-intensity").evaluate(g,_,M);d.evaluatedColor[A]=[D.r,D.g,D.b,k],d.evaluatedRMEA[A][0]=t.paint.get("model-roughness").evaluate(g,_,M),d.evaluatedRMEA[A][2]=t.paint.get("model-emissive-strength").evaluate(g,_,M),d.evaluatedRMEA[A][3]=D.a,d.emissionHeightBasedParams[A]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,_,M),!d.hasTranslucentParts&&D.a<1&&(d.hasTranslucentParts=!0)}delete g.properties.part,VV(d,S!==d.evaluatedColor[2]||T!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(g,_,M);d.evaluatedTranslation=t.paint.get("model-translation").evaluate(g,_,M),d.evaluatedScale=t.paint.get("model-scale").evaluate(g,_,M),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,r,c,d){const g=t.findDEMTileFor(c);if(g&&(g.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const _=Gf.create(t,c,g);if(!_)return;this.modelTraits&Of.HasMapboxMeshFeatures&&this.updateDEM(t,_,c,d);for(const v of this.getNodesInfo()){const S=v.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const T=S.footprint.vertices;let M=_.getElevationAt(T[0].x,T[0].y,!0,!0);for(let A=1;A<T.length;A++)M=Math.min(M,_.getElevationAt(T[A].x,T[A].y,!0,!0));S.elevation=M}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=r}}updateDEM(t,r,c,d){let g=r._dem._modifiedForSources[d];if(g===void 0&&(r._dem._modifiedForSources[d]=[],g=r._dem._modifiedForSources[d]),g.includes(c.canonical))return;const _=r._dem.dim;g.push(c.canonical);let v=!1;for(const S of this.getNodesInfo()){const T=S.node;if(!T.footprint||!T.footprint.grid)continue;const M=T.footprint.grid,A=r.tileCoordToPixel(M.min.x,M.min.y),z=r.tileCoordToPixel(M.max.x,M.max.y),D=Math.min(Math.min(_-z.y,A.x),Math.min(A.y,_-z.x));if(D<0)continue;const k=de(D,2,5);let $=Math.max(0,A.x-k),H=Math.max(0,A.y-k),j=Math.min(z.x+k,_-1),q=Math.min(z.y+k,_-1);for(let ae=H;ae<=q;++ae)for(let ge=$;ge<=j;++ge)Qh[ae*_+ge]=255;let Y=0,te=0;for(let ae=0;ae<M.cellsY;++ae)for(let ge=0;ge<M.cellsX;++ge){if(!M.cells[ae*M.cellsX+ge])continue;const ye=r.tileCoordToPixel(M.min.x+ge/M.xScale,M.min.y+ae/M.yScale),me=r.tileCoordToPixel(M.min.x+(ge+1)/M.xScale,M.min.y+(ae+1)/M.yScale);for(let we=ye.y;we<=Math.min(me.y+1,_-1);++we)for(let Ie=ye.x;Ie<=Math.min(me.x+1,_-1);++Ie)Qh[we*_+Ie]===255&&(Qh[we*_+Ie]=0,Y+=r.getElevationAtPixel(Ie,we),te++)}const ue=Y/te;$=Math.max(1,A.x-k),H=Math.max(1,A.y-k),j=Math.min(z.x+k,_-2),q=Math.min(z.y+k,_-2),v=!0;for(let ae=H;ae<=q;++ae)for(let ge=$;ge<=j;++ge)Qh[ae*_+ge]===0&&(kS[ae*_+ge]=r._dem.set(ge,ae,ue));for(let ae=1;ae<k;++ae){$=Math.max(1,A.x-ae),H=Math.max(1,A.y-ae),j=Math.min(z.x+ae,_-2),q=Math.min(z.y+ae,_-2);for(let ge=H;ge<=q;++ge)for(let ye=$;ye<=j;++ye){const me=ge*_+ye;if(Qh[me]===255){let we=0,Ie=0,Je=-1,qe=-1;for(let Xe=-1;Xe<=1;++Xe)for(let at=-1;at<=1;++at){const nt=(ge+Xe)*_+ye+at;if(Qh[nt]>=ae)continue;const ot=kS[nt],Ge=Math.abs(ot);Ge>Ie&&(we=ot,Ie=Ge,Je=at,qe=Xe)}if(Ie>.1){const Xe=1-(ae+.5*Math.abs(Je*qe))/k;let at=r._dem.get(ye,ge)+we*Xe;const nt=r._dem.get(ye+Je,ge+qe),ot=r._dem.get(ye-Je,ge-qe,!0);(at-nt)*(at-ot)>0&&(at=(nt+ot)/2),kS[me]=r._dem.set(ye,ge,at),Qh[me]=ae}}}}}v&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=ks.now())}setFilter(t){this.filter=t?tg(t):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(t=>this.filter.filter(new An(this.id.overscaledZ,{worldview:this.worldview}),t.feature,this.id.canonical)):this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const r of t)kx(r.node),rS(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(t.toUnwrapped());for(const d of this.getNodesInfo()){const g=d.node.footprint;d.hiddenByReplacement=!!g&&!c.find(_=>_.footprint===g)}}getHeightAtTileCoord(t,r){const c=[],d=[0,0,0],g=fe([]);for(const _ of this.getNodesInfo()){const v=_.node.meshes[0],S=v.transformedAabb;if(t<S.min[0]||r<S.min[1]||t>S.max[0]||r>S.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};le(g,_.node.globalMatrix),d[0]=t,d[1]=r,Wt(d,d,g);const T=(d[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Xh|0,M=Math.min(63,(d[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Xh|0)*Xh+Math.min(63,T),A=v.heightmap[M];if(!(A<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:A,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Ae(t,r),new Ae(t,r),c),c.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Qg(a,t){return a instanceof Mh&&!a.isLightConstant&&t}function $V(a,t,r,c,d,g,_,v){let S=(61440&t|(61440&t)>>4)>>8,T=(3840&t|(3840&t)>>4)>>4,M=240&t|(240&t)>>4;r[3]>0&&(S=hi(S,255*r[0],r[3]),T=hi(T,255*r[1],r[3]),M=hi(M,255*r[2],r[3]));const A=S<<8|T,z=M<<8|Math.floor(255*c[3]),D=(function(ae){const ge=de(ae,0,2);return Math.min(Math.round(.5*ge*255),255)})(c[2])<<8|15*c[0]<<4|15*c[1],k=de(d[0],0,1),$=de(d[1],0,1),H=de(d[2],0,1),j=de(d[3],0,1);let q,Y,te,ue;if(k!==$&&_!==g&&$!==k){const ae=_-g;Y=1/(ae*($-k)),te=-(g+ae*k)/(ae*($-k));const ge=de(d[4],-1,1);ue=Math.pow(10,ge),q=255*H<<8|255*j}else q=65535,Y=0,te=1,ue=1;if(a.emplaceBack(A,z,D,q,Y,te,ue),v){const ae=v.length;v.clear();for(let ge=0;ge<ae;ge++)v.emplaceBack(A,z,D,q,Y,te,ue)}}function VV(a,t,r){const c=a.node;let d=0;const g=r&Of.HasMeshoptCompression;for(const _ of c.meshes){if(c.lights&&c.lightMeshIndex===d||!_.featureData)continue;_.featureArray=new Bh,_.featureArray.reserve(_.featureData.length);let v=t;for(const S of _.featureData){const T=g?65535&S:S>>16&65535,M=g?S>>16&65535:65535&S,A=(15&M)<8?15&M:0,z=a.evaluatedRMEA[A],D=a.evaluatedColor[A],k=a.emissionHeightBasedParams[A];let $;if(v&&A===2&&c.lights&&($=new Bh,$.resize(10*c.lights.length)),$V(_.featureArray,T,D,z,k,_.aabb.min[2],_.aabb.max[2],$),$&&v){v=!1;const H=c.meshes[c.lightMeshIndex];H.featureArray=$,H.featureArray._trim()}}_.featureArray._trim(),d++}}Vt(e0,"Tiled3dModelBucket",{omit:["layers"]}),Vt(qz,"Tiled3dModelFeature");const jV=["id","tile","layer","source","sourceLayer","state"];class ed{constructor(t,r,c,d,g){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=c,this._y=d,this.properties=t?t.properties:{},this.id=g}clone(){const t=new ed(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of jV)this[r]!==void 0&&(t[r]=this[r]);return t}}class td extends ll{constructor(t,r,c,d){super(),this.id=t,this.type="model",this.models=[],this._options=r,this._modelsInfo=new Map}loadGLTFFromURI(t){return dP(this.map._requestManager.transformRequest(t,is.Model).url)}load(){for(const t in this._options.models){const r=this._options.models[t],c=this._modelsInfo.get(t);if(c){c.modelSpec=r;const d=c.model;d&&(d.position=r.position!=null?new he(r.position[0],r.position[1]):new he(0,0),d.orientation=r.orientation!=null?r.orientation:[0,0,0],td.applyModelSpecification(d,r),d.computeBoundsAndApplyParent(),this.models.push(d))}else this._modelsInfo.set(t,{modelSpec:r,model:null}),this.loadGLTFFromURI(r.uri).then(d=>{if(!d)return;const g=this._modelsInfo.get(t);if(!g)return;const _=sS(d),v=g.modelSpec,S=new _P(t,v.uri,v.position,v.orientation,_);td.applyModelSpecification(S,v),S.computeBoundsAndApplyParent(),this.models.push(S),g.model=S,this.loaded()&&this.fire(new al("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(d=>{this.fire(new uh(new Error(`Could not load model ${t} from ${r.uri}: ${d.message}`)))})}this.loaded()&&this.fire(new al("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(t,r){r.nodeOverrides&&td.convertNodeOverrides(t,r.nodeOverrides),r.materialOverrides&&td.convertMaterialOverrides(t,r.materialOverrides),r.nodeOverrideNames&&(t.nodeOverrideNames=[...r.nodeOverrideNames]),r.materialOverrideNames&&(t.materialOverrideNames=[...r.materialOverrideNames]),r.featureProperties&&(t.featureProperties=r.featureProperties)}static convertNodeOverrides(t,r){if(Array.isArray(r)&&r.every(c=>typeof c=="string")){t.nodeOverrideNames=[];for(const c of r)t.nodeOverrideNames.push(c)}else Object.entries(r).forEach(([c,d])=>{const g={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){const _=d.orientation;_&&(g.orientation=_)}t.nodeOverrides.set(c,g)})}static convertMaterialOverrides(t,r){if(Array.isArray(r)&&r.every(c=>typeof c=="string")){t.materialOverrideNames=[];for(const c of r)t.materialOverrideNames.push(c)}else Object.entries(r).forEach(([c,d])=>{const g={color:new bn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=d["model-color"];_!==void 0&&(g.color.r=_[0],g.color.g=_[1],g.color.b=_[2]);const v=d["model-color-mix-intensity"];v!==void 0&&(g.colorMix=v);const S=d["model-emissive-strength"];S!==void 0&&(g.emissionStrength=S);const T=d["model-opacity"];T!==void 0&&(g.opacity=T),t.materialOverrides.set(c,g)})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const t of this._modelsInfo.values())if(t.model==null)return!1;return!0}getModels(){return this.models}loadTile(t,r){}serialize(){return this._options}setProperty(t,r){return!1}reload(){const t=wc(this.id,this.scope);this.map.style.clearSource(t),this.models=[],this._modelsInfo.clear(),this.load()}setModels(t){this.models=[];const r=new Map;for(const c in t){const d=t[c];if(this._modelsInfo.has(c)){const g=this._modelsInfo.get(c);g&&g.modelSpec.uri===d.uri&&r.set(c,g)}}this._modelsInfo=r,this._options.models=t,this.load()}}function OS(a,t,r,c){const d=1<<a.z;t.lat=dt((c/It+a.y)/d),t.lng=tt((r/It+a.x)/d)}function GV(a,t,r,c){const d=a.getNodesInfo()[t];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let g=Number.MAX_VALUE;const _=d.node,v=r.tile,S=c.calculatePosMatrix(v.tileID.toUnwrapped(),c.worldSize),T=d.evaluatedScale;let M=0;c.elevation&&_.elevation&&(M=_.elevation*c.elevation.exaggeration()),it(S,S,[(_.anchor?_.anchor[0]:0)*(T[0]-1),(_.anchor?_.anchor[1]:0)*(T[1]-1),M]),Ve(S,S,T);const A=r.queryGeometry,z=A.isPointQuery()?A.screenBounds:A.screenGeometry,D=function($){const H=ie([],S,$.globalMatrix);ie(H,c.expandedFarZProjMatrix,H);for(let j=0;j<$.meshes.length;++j){const q=$.meshes[j];if(j===$.lightMeshIndex)continue;const Y=iS(z,c,H,q.aabb);Y!=null&&(g=Math.min(Y,g))}if($.children)for(const j of $.children)D(j)};if(D(_),g===Number.MAX_VALUE)return;const k=new he(0,0);return OS(v.tileID.canonical,k,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:g,position:k,feature:d.feature}}const HV={circle:class extends Go{constructor(a,t,r,c){super(a,{layout:z2||(z2=new ur({"circle-sort-key":new Pt(ke.layout_circle["circle-sort-key"]),"circle-elevation-reference":new bt(ke.layout_circle["circle-elevation-reference"]),visibility:new bt(ke.layout_circle.visibility)})),paint:C2||(C2=new ur({"circle-radius":new Pt(ke.paint_circle["circle-radius"]),"circle-color":new Pt(ke.paint_circle["circle-color"]),"circle-blur":new Pt(ke.paint_circle["circle-blur"]),"circle-opacity":new Pt(ke.paint_circle["circle-opacity"]),"circle-translate":new bt(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pt(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pt(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pt(ke.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new bt(ke.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c)}createBucket(a){return new Wo(a)}queryRadius(a){const t=a;return Ec("circle-radius",this,t)+Ec("circle-stroke-width",this,t)+If(this.paint.get("circle-translate"))}queryIntersectsFeature(a,t,r,c,d,g,_,v){const S=P2(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return G2(a,c,g,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,t,r){const c=j2(this);return{config:new R(this,{zoom:t,lut:r}),defines:c,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Go{createBucket(a){return new Z2(a)}constructor(a,t,r,c){super(a,{layout:W2||(W2=new ur({visibility:new bt(ke.layout_heatmap.visibility)})),paint:q2||(q2=new ur({"heatmap-radius":new Pt(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pt(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fu(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(ke.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return Ec("heatmap-radius",this,a)}queryIntersectsFeature(a,t,r,c,d,g,_,v){const S=this.paint.get("heatmap-radius").evaluate(t,r);return G2(a,c,g,_,v,!0,!0,new Ae(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,t,r){return a==="heatmap"?{config:new R(this,{zoom:t,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Go{constructor(a,t,r,c){super(a,{layout:X2||(X2=new ur({visibility:new bt(ke.layout_hillshade.visibility)})),paint:J2||(J2=new ur({"hillshade-illumination-direction":new bt(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(ke.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new bt(ke.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,t,r){return{overrideFog:!1}}},fill:class extends Go{constructor(a,t,r,c){super(a,{layout:gA||(gA=new ur({"fill-sort-key":new Pt(ke.layout_fill["fill-sort-key"]),visibility:new bt(ke.layout_fill.visibility),"fill-elevation-reference":new bt(ke.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Pt(ke.layout_fill["fill-construct-bridge-guard-rail"])})),paint:_A||(_A=new ur({"fill-antialias":new bt(ke.paint_fill["fill-antialias"]),"fill-opacity":new Pt(ke.paint_fill["fill-opacity"]),"fill-color":new Pt(ke.paint_fill["fill-color"]),"fill-outline-color":new Pt(ke.paint_fill["fill-outline-color"]),"fill-translate":new bt(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pt(ke.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new bt(ke.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new bt(ke.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Pt(ke.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Pt(ke.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Pt(ke.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c)}getProgramIds(){const a=this.paint.get("fill-pattern"),t=a&&a.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(a,t,r){return{config:new R(this,{zoom:t,lut:r}),overrideFog:!1}}recalculate(a,t){super.recalculate(a,t);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new N1(a)}queryRadius(){return If(this.paint.get("fill-translate"))}queryIntersectsFeature(a,t,r,c,d,g){return!a.queryGeometry.isAboveHorizon&&Gn(A2(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),c)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const t=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?t&&!a:t}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Go{constructor(a,t,r,c){super(a,{layout:UA||(UA=new ur({visibility:new bt(ke["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new bt(ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:$A||($A=new ur({"fill-extrusion-opacity":new bt(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pt(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pt(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new bt(ke["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Pt(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pt(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new bt(ke["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new bt(ke["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new bt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new bt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new bt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new bt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Pt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Pt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new bt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new bt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new bt(ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new bt(ke["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Pt(ke["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Pt(ke["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new bt(ke["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Ex(a)}queryRadius(){return If(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,t,r,c,d,g,_,v,S){const T=P2(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(t,r),A=this.paint.get("fill-extrusion-base").evaluate(t,r),z=[0,0],D=v&&g.elevation,k=g.elevation?g.elevation.exaggeration():1,$=a.tile.getBucket(this);if(D&&$ instanceof Ex){const te=$.centroidVertexArray,ue=S+1;ue<te.length&&(z[0]=te.geta_centroid_pos0(ue),z[1]=te.geta_centroid_pos1(ue))}if(z[0]===0&&z[1]===1)return!1;g.projection.name==="globe"&&(c=NA([c],[new Ae(0,0),new Ae(It,It)],a.tileID.canonical).map(te=>te.polygon).flat());const H=D?v:null,[j,q]=qA(g,c,A,M,T,_,H,z,k,g.center.lat,a.tileID.canonical),Y=a.queryGeometry;return WA(j,q,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},building:class extends Go{constructor(a,t,r,c){super(a,{layout:TP||(TP=new ur({visibility:new bt(ke.layout_building.visibility),"building-facade":new Pt(ke.layout_building["building-facade"]),"building-facade-floors":new Pt(ke.layout_building["building-facade-floors"]),"building-facade-unit-width":new Pt(ke.layout_building["building-facade-unit-width"]),"building-facade-window":new Pt(ke.layout_building["building-facade-window"]),"building-roof-shape":new Pt(ke.layout_building["building-roof-shape"]),"building-height":new Pt(ke.layout_building["building-height"]),"building-base":new Pt(ke.layout_building["building-base"]),"building-flood-light-wall-radius":new Pt(ke.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Pt(ke.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Pt(ke.layout_building["building-flip-roof-orientation"])})),paint:EP||(EP=new ur({"building-opacity":new bt(ke.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new bt(ke.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new bt(ke.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new bt(ke.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new bt(ke.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new bt(ke.paint_building["building-vertical-scale"]),"building-cast-shadows":new bt(ke.paint_building["building-cast-shadows"]),"building-color":new Pt(ke.paint_building["building-color"]),"building-emissive-strength":new Pt(ke.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new bt(ke.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new bt(ke.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new bt(ke.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new bt(ke.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new bt(ke.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new SP(a)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}queryRadius(a){return 0}queryIntersectsFeature(a,t,r,c,d,g,_,v,S,T){let M=this.layout.get("building-height").evaluate(t,r);const A=this.layout.get("building-base").evaluate(t,r),z=a.tile.getBucket(this).getFootprint(t);if(z){if(z.hiddenFlags!==0)return!1;M=z.height}const[D,k]=qA(g,c,A,M,new Ae(0,0),_,null,[0,0],1,g.center.lat,a.tileID.canonical),$=a.queryGeometry;return WA(D,k,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},line:class extends Go{constructor(a,t,r,c){const d=kP();super(a,d,t,r,c),d.layout&&(this.layout=new jo(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof xh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(a,t){super.recalculate(a,t),this.paint._values["line-floorwidth"]=(()=>{if(Ng)return Ng;const r=kP();return Ng=new N5(r.paint.properties["line-width"].specification),Ng.useIntegerZoom=!0,Ng})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new cS(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,t,r){const c=LP(this);return{config:new R(this,{zoom:t,lut:r}),defines:c,overrideFog:!1}}queryRadius(a){const t=a,r=OP(Ec("line-width",this,t),Ec("line-gap-width",this,t)),c=Ec("line-offset",this,t);return r/2+Math.abs(c)+If(this.paint.get("line-translate"))}queryIntersectsFeature(a,t,r,c,d,g){if(a.queryGeometry.isAboveHorizon)return!1;const _=A2(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),v=a.pixelToTileUnitsFactor/2*OP(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),S=this.paint.get("line-offset").evaluate(t,r);return S&&(c=(function(T,M){const A=[],z=new Ae(0,0);for(let D=0;D<T.length;D++){const k=T[D],$=[];for(let H=0;H<k.length;H++){const j=k[H],q=k[H+1],Y=H===0?z:j.sub(k[H-1])._unit()._perp(),te=H===k.length-1?z:q.sub(j)._unit()._perp(),ue=Y._add(te)._unit();ue._mult(1/(ue.x*te.x+ue.y*te.y)),$.push(ue._mult(M)._add(j))}A.push($)}return A})(c,S*a.pixelToTileUnitsFactor)),(function(T,M,A){for(let z=0;z<M.length;z++){const D=M[z];if(T.length>=3){for(let k=0;k<D.length;k++)if(ws(T,D[k]))return!0}if(Lr(T,D,A))return!0}return!1})(_,c,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Jx,background:class extends Go{constructor(a,t,r,c){super(a,{layout:Mz||(Mz=new ur({visibility:new bt(ke.layout_background.visibility)})),paint:Az||(Az=new ur({"background-pitch-alignment":new bt(ke.paint_background["background-pitch-alignment"]),"background-color":new bt(ke.paint_background["background-color"]),"background-pattern":new bt(ke.paint_background["background-pattern"]),"background-opacity":new bt(ke.paint_background["background-opacity"]),"background-emissive-strength":new bt(ke.paint_background["background-emissive-strength"]),"background-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,t,r){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Lz,"raster-particle":Nz,sky:class extends Go{constructor(a,t,r,c){super(a,{layout:Oz||(Oz=new ur({visibility:new bt(ke.layout_sky.visibility)})),paint:Fz||(Fz=new ur({"sky-type":new bt(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new bt(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new bt(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new bt(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new bt(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new fu(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new bt(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new bt(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new bt(ke.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=xg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(a,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),d=!c,g=a.style.light,_=g.properties.get("position");return d&&g.properties.get("anchor")==="viewport"&&yi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?RS(_.azimuthal,90-_.polar,t):RS(c[0],90-c[1],t)}const r=this.paint.get("sky-gradient-center");return RS(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends Go{constructor(a,t,r,c){super(a,{paint:Bz||(Bz=new ur({}))},t,null)}},model:class extends Go{constructor(a,t,r,c){super(a,{layout:jz||(jz=new ur({visibility:new bt(ke.layout_model.visibility),"model-id":new Pt(ke.layout_model["model-id"]),"model-allow-density-reduction":new bt(ke.layout_model["model-allow-density-reduction"])})),paint:Gz||(Gz=new ur({"model-opacity":new Pt(ke.paint_model["model-opacity"]),"model-rotation":new Pt(ke.paint_model["model-rotation"]),"model-scale":new Pt(ke.paint_model["model-scale"]),"model-translation":new Pt(ke.paint_model["model-translation"]),"model-color":new Pt(ke.paint_model["model-color"]),"model-color-mix-intensity":new Pt(ke.paint_model["model-color-mix-intensity"]),"model-type":new bt(ke.paint_model["model-type"]),"model-cast-shadows":new bt(ke.paint_model["model-cast-shadows"]),"model-receive-shadows":new bt(ke.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new bt(ke.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Pt(ke.paint_model["model-emissive-strength"]),"model-roughness":new Pt(ke.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Pt(ke.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new bt(ke.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new bt(ke.paint_model["model-front-cutoff"]),"model-elevation-reference":new bt(ke.paint_model["model-elevation-reference"]),"model-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},t,r,c),this.layer=a,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new DS(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof e0?8191:0}queryRenderedFeatures(a,t,r){const c=t.getSource();if(!(c&&c instanceof td))return{};const d=c,g={};g[this.id]=[];const _=g[this.id];let v=0;for(const S of d.models){const T=t.getFeatureState(this.sourceLayer,S.id),M={type:"Unknown",id:S.id,properties:S.featureProperties},A=this.paint.get("model-rotation").evaluate(M,T),z=this.paint.get("model-scale").evaluate(M,T),D=this.paint.get("model-translation").evaluate(M,T),k=this.paint.get("model-elevation-reference");let $=[];Dx($,S,r,S.position,A,z,D,k==="ground",k==="ground",!1),r.projection.name==="globe"&&($=Lx($,r));const H=ie([],r.projMatrix,$),j=iS(a.isPointQuery()?a.screenBounds:a.screenGeometry,r,H,S.aabb);if(j!=null){const q=new ed(void 0,0,0,0,S.id);q.layer=this.layer,q.properties=structuredClone(S.featureProperties),q.properties.layer=this.id,q.properties.uri=S.uri,q.properties.orientation=S.orientation,q.sourceLayer=this.sourceLayer,q.geometry={type:"Point",coordinates:[S.position.lng,S.position.lat]},q.state=T,q.source=this.source,_.push({featureIndex:v,feature:q,intersectionZ:j})}++v}return g}queryIntersectsFeature(a,t,r,c,d,g,_,v,S,T){if(!this.modelManager)return!1;const M=this.modelManager,A=a.tile.getBucket(this);if(!(A&&A instanceof DS))return!1;for(const z in A.instancesPerModel){const D=A.instancesPerModel[z],k=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(D.idToFeaturesIndex.hasOwnProperty(k)){const $=D.features[D.idToFeaturesIndex[k]],H=M.getModel(z,T||this.scope);if(!H)return!1;let j=[];const q=new he(0,0),Y=A.canonical;let te=Number.MAX_VALUE;for(let ue=0;ue<$.instancedDataCount;++ue){const ae=16*($.instancedDataOffset+ue),ge=D.instancedDataArray.float32,ye=[ge[ae+4],ge[ae+5],ge[ae+6]];OS(Y,q,Math.floor(ge[ae]),Math.floor(ge[ae+1])),Dx(j,H,g,q,$.rotation,$.scale,ye,!1,!1,!1),g.projection.name==="globe"&&(j=Lx(j,g));const me=ie([],g.projMatrix,j),we=a.queryGeometry,Ie=iS(we.isPointQuery()?we.screenBounds:we.screenGeometry,g,me,H.aabb);Ie!=null&&(te=Math.min(Ie,te))}return te!==Number.MAX_VALUE&&te}}return!1}_handleOverridablePaintPropertyUpdate(a,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const t=this._transitionablePaint._values[a];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof vc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Go{constructor(a,t,r,c){super(a,{layout:yA||(yA=new ur({"clip-layer-types":new bt(ke.layout_clip["clip-layer-types"]),"clip-layer-scope":new bt(ke.layout_clip["clip-layer-scope"]),visibility:new bt(ke.layout_clip.visibility)})),paint:vA||(vA=new ur({}))},t,r,c)}recalculate(a,t){super.recalculate(a,t)}createBucket(a){return new xA(a)}is3D(a){return!0}}},FS=new bn(0,0,0);function ZV(a,t,r){a===1&&t.icons.push((function(c,d){return(function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:_}=g;if(_.content_area){const{content_area:v}=_;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=g.usvg_tree.width),v.height==null&&(v.height=v.width)}if(_.text_placeholder){const{text_placeholder:v}=_;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return _.stretch_x&&_.stretch_x.length&&Xz(_,"x"),_.stretch_y&&_.stretch_y.length&&Xz(_,"y"),g})(c.readFields(WV,{name:void 0},d))})(r,r.readVarint()+r.pos))}function Xz(a,t){const r=[],c=a[`stretch_${t}`];let d=null;for(let g=0;g<c.length;g++)d===null?d=r.length===0?c[0]:r[r.length-1][1]+c[g]:(r.push([d,d+c[g]]),d=null);a[`stretch_${t}_areas`]=r}function WV(a,t,r){a===1?t.name=r.readString():a===2?t.metadata=(function(c,d){return c.readFields(qV,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)})(r,r.readVarint()+r.pos):a===3&&(t.usvg_tree=(function(c,d){return c.readFields(YV,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)})(r,r.readVarint()+r.pos),t.data="usvg_tree")}function qV(a,t,r){a===1?t.stretch_x=r.readPackedVarint():a===2?t.stretch_y=r.readPackedVarint():a===3?t.content_area=Jz(r,r.readVarint()+r.pos):a===4?t.variables.push((function(c,d){return c.readFields(JV,{name:void 0},d)})(r,r.readVarint()+r.pos)):a===5&&(t.text_placeholder=Jz(r,r.readVarint()+r.pos))}function Jz(a,t){return a.readFields(XV,{},t)}function XV(a,t,r){a===1?t.left=r.readVarint():a===2?t.width=r.readVarint():a===3?t.top=r.readVarint():a===4&&(t.height=r.readVarint())}function JV(a,t,r){a===1?t.name=r.readString():a===2&&(t.rgb_color=n0(r.readVarint()),t.value="rgb_color")}function YV(a,t,r){a===1?t.width=t.height=r.readVarint():a===2?t.height=r.readVarint():a===3?t.children.push(t0(r,r.readVarint()+r.pos)):a===4?t.linear_gradients.push((function(c,d){return c.readFields(r6,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)})(r,r.readVarint()+r.pos)):a===5?t.radial_gradients.push((function(c,d){return c.readFields(s6,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)})(r,r.readVarint()+r.pos)):a===7?t.clip_paths.push((function(c,d){return c.readFields(a6,{children:[]},d)})(r,r.readVarint()+r.pos)):a===8&&t.masks.push((function(c,d){const g=c.readFields(l6,{left:0,width:20,mask_type:1,children:[]},d);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g})(r,r.readVarint()+r.pos))}function t0(a,t){return a.readFields(KV,{},t)}function KV(a,t,r){a===1?(t.group=(function(c,d){return c.readFields(QV,{opacity:255,children:[]},d)})(r,r.readVarint()+r.pos),t.node="group"):a===2&&(t.path=(function(c,d){return c.readFields(t6,{paint_order:1,commands:[],step:1,diffs:[],rule:1},d)})(r,r.readVarint()+r.pos),t.node="path")}function QV(a,t,r){a===1?t.transform=i0(r,r.readVarint()+r.pos):a===2?t.opacity=r.readVarint():a===5?t.clip_path_idx=r.readVarint():a===6?t.mask_idx=r.readVarint():a===7&&t.children.push(t0(r,r.readVarint()+r.pos))}function i0(a,t){return a.readFields(e6,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function e6(a,t,r){a===1?t.sx=r.readFloat():a===2?t.ky=r.readFloat():a===3?t.kx=r.readFloat():a===4?t.sy=r.readFloat():a===5?t.tx=r.readFloat():a===6&&(t.ty=r.readFloat())}function t6(a,t,r){a===1?t.fill=(function(c,d){return c.readFields(i6,{rgb_color:FS,paint:"rgb_color",opacity:255},d)})(r,r.readVarint()+r.pos):a===2?t.stroke=(function(c,d){return c.readFields(n6,{rgb_color:FS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)})(r,r.readVarint()+r.pos):a===3?t.paint_order=r.readVarint():a===5?r.readPackedVarint(t.commands):a===6?t.step=r.readFloat():a===7?r.readPackedSVarint(t.diffs):a===8&&(t.rule=r.readVarint())}function i6(a,t,r){a===1?(t.rgb_color=n0(r.readVarint()),t.paint="rgb_color"):a===2?(t.linear_gradient_idx=r.readVarint(),t.paint="linear_gradient_idx"):a===3?(t.radial_gradient_idx=r.readVarint(),t.paint="radial_gradient_idx"):a===5&&(t.opacity=r.readVarint())}function n0(a){return new bn((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function n6(a,t,r){a===1?(t.rgb_color=n0(r.readVarint()),t.paint="rgb_color"):a===2?(t.linear_gradient_idx=r.readVarint(),t.paint="linear_gradient_idx"):a===3?(t.radial_gradient_idx=r.readVarint(),t.paint="radial_gradient_idx"):a===5?r.readPackedFloat(t.dasharray):a===6?t.dashoffset=r.readFloat():a===7?t.miterlimit=r.readFloat():a===8?t.opacity=r.readVarint():a===9?t.width=r.readFloat():a===10?t.linecap=r.readVarint():a===11&&(t.linejoin=r.readVarint())}function r6(a,t,r){a===1?t.transform=i0(r,r.readVarint()+r.pos):a===2?t.spread_method=r.readVarint():a===3?t.stops.push(Yz(r,r.readVarint()+r.pos)):a===4?t.x1=r.readFloat():a===5?t.y1=r.readFloat():a===6?t.x2=r.readFloat():a===7&&(t.y2=r.readFloat())}function Yz(a,t){return a.readFields(o6,{offset:0,opacity:255,rgb_color:FS},t)}function o6(a,t,r){a===1?t.offset=r.readFloat():a===2?t.opacity=r.readVarint():a===3&&(t.rgb_color=n0(r.readVarint()))}function s6(a,t,r){a===1?t.transform=i0(r,r.readVarint()+r.pos):a===2?t.spread_method=r.readVarint():a===3?t.stops.push(Yz(r,r.readVarint()+r.pos)):a===4?t.cx=r.readFloat():a===5?t.cy=r.readFloat():a===6?t.r=r.readFloat():a===7?t.fx=r.readFloat():a===8?t.fy=r.readFloat():a===9&&(t.fr=r.readFloat())}function a6(a,t,r){a===1?t.transform=i0(r,r.readVarint()+r.pos):a===2?t.clip_path_idx=r.readVarint():a===3&&t.children.push(t0(r,r.readVarint()+r.pos))}function l6(a,t,r){a===1?t.left=t.top=r.readFloat():a===2?t.width=t.height=r.readFloat():a===3?t.top=r.readFloat():a===4?t.height=r.readFloat():a===5?t.mask_type=r.readVarint():a===6?t.mask_idx=r.readVarint():a===7&&t.children.push(t0(r,r.readVarint()+r.pos))}class c6{static calculate(t={},r=[]){const c=new Map,d=new Map;if(Object.keys(t).length===0)return c;r.forEach(g=>{d.set(g.name,g.rgb_color||new bn(0,0,0))});for(const[g,_]of Object.entries(t))d.has(g)?c.set(d.get(g).toString(),_):console.warn(`Ignoring unknown image variable "${g}"`);return c}}function Hf(a,t=255,r){const c=t/255,d=a.toString(),g=r.has(d)?r.get(d).clone():a.clone();return g.a*=c,g.toString()}function e_(a,t){if(!cc()){const r=document.createElement("canvas");return r.width=a,r.height=t,r}return new OffscreenCanvas(a,t)}let BS,t_=null;function NS(a,t,r,c,d){for(const g of c.children)Kz(a,t,r,g,d)}function Kz(a,t,r,c,d){c.group?(a.save(),(function(g,_,v,S,T){const M=S.mask_idx!=null?v.masks[S.mask_idx]:null,A=S.clip_path_idx!=null?v.clip_paths[S.clip_path_idx]:null;if(S.transform&&(_=Zf(S.transform).preMultiplySelf(_)),!(function(k,$,H){return k.opacity!==255||$||H})(S,A!=null,M!=null))return void NS(g,_,v,S,T);const z=e_(g.canvas.width,g.canvas.height),D=z.getContext("2d");NS(D,_,v,S,T),A&&oC(D,_,v,A),M&&sC(D,_,v,M,T),g.globalAlpha=S.opacity/255,g.drawImage(z,0,0)})(a,t,r,c.group,d),a.restore()):c.path&&(a.save(),(function(g,_,v,S,T){g.setTransform(_),S.paint_order===1?(Qz(g,v,S,T),tC(g,v,S,T)):(tC(g,v,S,T),Qz(g,v,S,T))})(a,t,r,c.path,d),a.restore())}function Qz(a,t,r,c){const d=r.fill;if(!d)return;const g=d.opacity/255;switch(a.save(),a.beginPath(),aC(r,a),d.paint){case"rgb_color":a.fillStyle=Hf(d.rgb_color,d.opacity,c);break;case"linear_gradient_idx":{const _=t.linear_gradients[d.linear_gradient_idx];_.transform&&a.setTransform(Zf(_.transform).preMultiplySelf(a.getTransform())),a.fillStyle=iC(a,_,g,c);break}case"radial_gradient_idx":{const _=t.radial_gradients[d.radial_gradient_idx];_.transform&&a.setTransform(Zf(_.transform).preMultiplySelf(a.getTransform())),a.fillStyle=nC(a,_,g,c)}}a.fill(eC(r)),a.restore()}function eC(a){return a.rule===1?"nonzero":a.rule===2?"evenodd":void 0}function tC(a,t,r,c){const d=r.stroke;if(!d)return;const g=lC(r);a.lineWidth=d.width,a.miterLimit=d.miterlimit,a.setLineDash(d.dasharray),a.lineDashOffset=d.dashoffset;const _=d.opacity/255;switch(d.paint){case"rgb_color":a.strokeStyle=Hf(d.rgb_color,d.opacity,c);break;case"linear_gradient_idx":a.strokeStyle=iC(a,t.linear_gradients[d.linear_gradient_idx],_,c,!0);break;case"radial_gradient_idx":a.strokeStyle=nC(a,t.radial_gradients[d.radial_gradient_idx],_,c,!0)}switch(d.linejoin){case 2:case 1:a.lineJoin="miter";break;case 3:a.lineJoin="round";break;case 4:a.lineJoin="bevel"}switch(d.linecap){case 1:a.lineCap="butt";break;case 2:a.lineCap="round";break;case 3:a.lineCap="square"}a.stroke(g)}function iC(a,t,r,c,d=!1){if(t.stops.length===1){const z=t.stops[0];return Hf(z.rgb_color,z.opacity*r,c)}const{x1:g,y1:_,x2:v,y2:S}=t;let T=new DOMPoint(g,_),M=new DOMPoint(v,S);if(d){const z=Zf(t.transform);T=z.transformPoint(T),M=z.transformPoint(M)}const A=a.createLinearGradient(T.x,T.y,M.x,M.y);for(const z of t.stops)A.addColorStop(z.offset,Hf(z.rgb_color,z.opacity*r,c));return A}function nC(a,t,r,c,d=!1){if(t.stops.length===1){const j=t.stops[0];return Hf(j.rgb_color,j.opacity*r,c)}const g=Zf(t.transform),{fx:_,fy:v,fr:S,cx:T,cy:M,r:A}=t;let z=new DOMPoint(_,v),D=new DOMPoint(T,M),k=S,$=A;if(d){z=g.transformPoint(z),D=g.transformPoint(D);const j=(g.a+g.d)/2;k=S*j,$=t.r*j}const H=a.createRadialGradient(z.x,z.y,k,D.x,D.y,$);for(const j of t.stops)H.addColorStop(j.offset,Hf(j.rgb_color,j.opacity*r,c));return H}function rC(a,t,r,c){const d=c.transform?Zf(c.transform).preMultiplySelf(t):t,g=e_(a.canvas.width,a.canvas.height),_=g.getContext("2d");for(const S of c.children)if(S.group)rC(_,d,r,S.group);else if(S.path){const T=S.path,M=new Path2D;M.addPath(lC(T),d),_.fill(M,eC(T))}const v=c.clip_path_idx!=null?r.clip_paths[c.clip_path_idx]:null;v&&oC(_,d,r,v),a.globalCompositeOperation="source-over",a.drawImage(g,0,0)}function oC(a,t,r,c){const d=e_(a.canvas.width,a.canvas.height);rC(d.getContext("2d"),t,r,c),a.globalCompositeOperation="destination-in",a.drawImage(d,0,0)}function sC(a,t,r,c,d){if(c.children.length===0)return;const g=c.mask_idx!=null?r.masks[c.mask_idx]:null;g&&sC(a,t,r,g,d);const _=a.canvas.width,v=a.canvas.height,S=e_(_,v),T=S.getContext("2d"),M=c.width,A=c.height,z=c.left,D=c.top,k=new Path2D,$=new Path2D;$.rect(z,D,M,A),k.addPath($,t),T.clip(k);for(const q of c.children)Kz(T,t,r,q,d);const H=T.getImageData(0,0,_,v),j=H.data;if(c.mask_type===1)for(let q=0;q<j.length;q+=4)j[q+3]=j[q+3]/255*(.2126*j[q]+.7152*j[q+1]+.0722*j[q+2]);T.putImageData(H,0,0),a.globalCompositeOperation="destination-in",a.drawImage(S,0,0)}function Zf(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function aC(a,t){const r=a.step;let c=a.diffs[0]*r,d=a.diffs[1]*r;t.moveTo(c,d);for(let g=0,_=2;g<a.commands.length;g++)switch(a.commands[g]){case 1:c+=a.diffs[_++]*r,d+=a.diffs[_++]*r,t.moveTo(c,d);break;case 2:c+=a.diffs[_++]*r,d+=a.diffs[_++]*r,t.lineTo(c,d);break;case 3:{const v=c+a.diffs[_++]*r,S=d+a.diffs[_++]*r;c=v+a.diffs[_++]*r,d=S+a.diffs[_++]*r,t.quadraticCurveTo(v,S,c,d);break}case 4:{const v=c+a.diffs[_++]*r,S=d+a.diffs[_++]*r,T=v+a.diffs[_++]*r,M=S+a.diffs[_++]*r;c=T+a.diffs[_++]*r,d=M+a.diffs[_++]*r,t.bezierCurveTo(v,S,T,M,c,d);break}case 5:t.closePath();break}return t}function lC(a){return aC(a,new Path2D)}class r0{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const r=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,r),r}put(t,r){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,r)}delete(t){this.cache.delete(t)}}Vt(r0,"LRUCache");class US{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new Mo(t,t.data)}getFromCache(t,r,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new r0(150)),this.cacheMap.get(c).get(wc(t.toString(),r))}setInCache(t,r,c,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new r0(150));const g=this.cacheDependenciesMap.get(d),_=wc(t.id.toString(),c);g.get(_)||g.set(_,new Set);const v=this.cacheMap.get(d),S=t.toString();g.get(_).add(S),v.put(wc(t.toString(),c),r)}removeImagesFromCacheByIds(t,r,c=0){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const d=this.cacheMap.get(c),g=this.cacheDependenciesMap.get(c);for(const _ of t){const v=wc(_.toString(),r);if(g.has(v)){for(const S of g.get(v))d.delete(S);g.delete(v)}}}rasterize(t,r,c,d){const g=this.getFromCache(t,c,d);if(g)return g.clone();const _=(function(S,T){const M=c6.calculate(T.params,S.metadata?S.metadata.variables:[]),A=S.usvg_tree,z=A.width,D=A.height,k=Math.max(1,Math.round(z*T.sx)),$=Math.max(1,Math.round(D*T.sy)),H=new DOMMatrix([k/z,0,0,$/D,0,0]);return t_===null&&(t_=e_(10,10),BS=t_.getContext("2d",{willReadFrequently:!0})),t_.width=k,t_.height=$,NS(BS,H,A,A,M),BS.getImageData(0,0,k,$)})(r.icon,t),v=US._getImage(_);return this.setInCache(t,v,c,d),v.clone()}}class cC{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){const c=this.toIdx(t,r);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function uC(a,t,r,c){let d=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(r[_]<a[_]||r[_]>t[_])return null}else{const v=1/c[_];let S=(a[_]-r[_])*v,T=(t[_]-r[_])*v;if(S>T){const M=S;S=T,T=M}if(S>d&&(d=S),T<g&&(g=T),d>g)return null}return d}function hC(a,t,r,c,d,g,_,v,S,T,M){const A=c-a,z=d-t,D=g-r,k=_-a,$=v-t,H=S-r,j=M[1]*H-M[2]*$,q=M[2]*k-M[0]*H,Y=M[0]*$-M[1]*k,te=A*j+z*q+D*Y;if(Math.abs(te)<1e-15)return null;const ue=1/te,ae=T[0]-a,ge=T[1]-t,ye=T[2]-r,me=(ae*j+ge*q+ye*Y)*ue;if(me<0||me>1)return null;const we=ge*D-ye*z,Ie=ye*A-ae*D,Je=ae*z-ge*A,qe=(M[0]*we+M[1]*Ie+M[2]*Je)*ue;return qe<0||me+qe>1?null:(k*we+$*Ie+H*Je)*ue}function dC(a,t,r){return(a-t)/(r-t)}function fC(a,t,r,c,d,g,_,v,S){const T=1<<r,M=g-c,A=_-d,z=(a+1)/T*M+c,D=(t+0)/T*A+d,k=(t+1)/T*A+d;v[0]=(a+0)/T*M+c,v[1]=D,S[0]=z,S[1]=k}class pC{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=(function(g){const _=Math.ceil(Math.log2(g.dim/8)),v=[];let S=Math.ceil(Math.pow(2,_));const T=1/S,M=(D,k,$,H,j)=>{const q=H?1:0,Y=(D+1)*$-q,te=k*$,ue=(k+1)*$-q;j[0]=D*$,j[1]=te,j[2]=Y,j[3]=ue};let A=new cC(S);const z=[];for(let D=0;D<S*S;D++){M(D%S,Math.floor(D/S),T,!1,z);const k=Pu(z[0],z[1],g),$=Pu(z[2],z[1],g),H=Pu(z[2],z[3],g),j=Pu(z[0],z[3],g);A.minimums.push(Math.min(k,$,H,j)),A.maximums.push(Math.max(k,$,H,j)),A.leaves.push(1)}for(v.push(A),S/=2;S>=1;S/=2){const D=v[v.length-1];A=new cC(S);for(let k=0;k<S*S;k++){M(k%S,Math.floor(k/S),2,!0,z);const $=D.getElevation(z[0],z[1]),H=D.getElevation(z[2],z[1]),j=D.getElevation(z[2],z[3]),q=D.getElevation(z[0],z[3]),Y=D.isLeaf(z[0],z[1]),te=D.isLeaf(z[2],z[1]),ue=D.isLeaf(z[2],z[3]),ae=D.isLeaf(z[0],z[3]),ge=Math.min($.min,H.min,j.min,q.min),ye=Math.max($.max,H.max,j.max,q.max),me=Y&&te&&ue&&ae;A.maximums.push(ye),A.minimums.push(ge),A.leaves.push(ye-ge<=5&&me?1:0)}v.push(A)}return v})(this.dem),c=r.length-1,d=r[c];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(r,0,0,c,0)}raycastRoot(t,r,c,d,g,_,v=1){return uC([t,r,-100],[c,d,this.maximums[0]*v],g,_)}raycast(t,r,c,d,g,_,v=1){if(!this.nodeCount)return null;const S=this.raycastRoot(t,r,c,d,g,_,v);if(S==null)return null;const T=[],M=[],A=[],z=[],D=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:k,t:$,nodex:H,nodey:j,depth:q}=D.pop();if(this.leaves[k]){fC(H,j,q,t,r,c,d,A,z);const te=1<<q,ue=(H+0)/te,ae=(H+1)/te,ge=(j+0)/te,ye=(j+1)/te,me=Pu(ue,ge,this.dem)*v,we=Pu(ae,ge,this.dem)*v,Ie=Pu(ae,ye,this.dem)*v,Je=Pu(ue,ye,this.dem)*v,qe=hC(A[0],A[1],me,z[0],A[1],we,z[0],z[1],Ie,g,_),Xe=hC(z[0],z[1],Ie,A[0],z[1],Je,A[0],A[1],me,g,_),at=Math.min(qe!==null?qe:Number.MAX_VALUE,Xe!==null?Xe:Number.MAX_VALUE);if(at!==Number.MAX_VALUE)return at;{const nt=Dn([],g,_,$);if(mC(me,we,Je,Ie,dC(nt[0],A[0],z[0]),dC(nt[1],A[1],z[1]))>=nt[2])return $}continue}let Y=0;for(let te=0;te<this._siblingOffset.length;te++){fC((H<<1)+this._siblingOffset[te][0],(j<<1)+this._siblingOffset[te][1],q+1,t,r,c,d,A,z),A[2]=-100,z[2]=this.maximums[this.childOffsets[k]+te]*v;const ue=uC(A,z,g,_);if(ue!=null){const ae=ue;T[te]=ae;let ge=!1;for(let ye=0;ye<Y&&!ge;ye++)ae>=T[M[ye]]&&(M.splice(ye,0,te),ge=!0);ge||(M[Y]=te),Y++}}for(let te=0;te<Y;te++){const ue=M[te];D.push({idx:this.childOffsets[k]+ue,t:T[ue],nodex:(H<<1)+this._siblingOffset[ue][0],nodey:(j<<1)+this._siblingOffset[ue][1],depth:q+1})}}return null}_addNode(t,r,c){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,c,d,g){if(t[d].isLeaf(r,c)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=d-1,v=t[_];let S=0,T=0;for(let M=0;M<this._siblingOffset.length;M++){const A=2*r+this._siblingOffset[M][0],z=2*c+this._siblingOffset[M][1],D=v.getElevation(A,z),k=v.isLeaf(A,z),$=this._addNode(D.min,D.max,k);k&&(S|=1<<M),T||(T=$)}for(let M=0;M<this._siblingOffset.length;M++)S&1<<M||this._construct(t,2*r+this._siblingOffset[M][0],2*c+this._siblingOffset[M][1],_,T+M)}}function mC(a,t,r,c,d,g){return hi(hi(a,r,g),hi(t,c,g),d)}function Pu(a,t,r){const c=r.dim,d=de(a*c-.5,0,c-1),g=de(t*c-.5,0,c-1),_=Math.floor(d),v=Math.floor(g),S=Math.min(_+1,c-1),T=Math.min(v+1,c-1);return mC(r.get(_,v),r.get(S,v),r.get(_,T),r.get(S,T),d-_,g-v)}const u6={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function h6(a,t,r){return(256*a*256+256*t+r)/10-1e4}function d6(a,t,r){return 256*a+t+r/256-32768}class o0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,c,d=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void yi(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const g=this.dim=r.height-2,_=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let S=0;S<g;S++)_[this._idx(-1,S)]=_[this._idx(0,S)],_[this._idx(g,S)]=_[this._idx(g-1,S)],_[this._idx(S,-1)]=_[this._idx(S,0)],_[this._idx(S,g)]=_[this._idx(S,g-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(g,-1)]=_[this._idx(g-1,0)],_[this._idx(-1,g)]=_[this._idx(0,g-1)],_[this._idx(g,g)]=_[this._idx(g-1,g-1)]}const v=c==="terrarium"?d6:h6;for(let S=0;S<_.length;++S){const T=4*S;this.floatView[S]=v(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=ks.now()}_buildQuadTree(){this._tree=new pC(this)}get(t,r,c=!1){c&&(t=de(t,-1,this.dim),r=de(r,-1,this.dim));const d=this._idx(t,r);return this.floatView[d]}set(t,r,c){const d=this._idx(t,r),g=this.floatView[d];return this.floatView[d]=c,c-g}static getUnpackVector(t){return u6[t]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}static pack(t,r){const c=[0,0,0,0],d=o0.getUnpackVector(r);let g=Math.floor((t+d[3])/d[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Q2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=r*this.dim,g=r*this.dim+this.dim,_=c*this.dim,v=c*this.dim+this.dim;switch(r){case-1:d=g-1;break;case 1:g=d+1}switch(c){case-1:_=v-1;break;case 1:v=_+1}const S=-r*this.dim,T=-c*this.dim;for(let M=_;M<v;M++)for(let A=d;A<g;A++){const z=4*this._idx(A,M),D=4*this._idx(A+S,M+T);this.pixels[z+0]=t.pixels[D+0],this.pixels[z+1]=t.pixels[D+1],this.pixels[z+2]=t.pixels[D+2],this.pixels[z+3]=t.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function f6(a,t,r){a===1?t.headerLength=r.readFixed32():a===2?t.x=r.readVarint():a===3?t.y=r.readVarint():a===4?t.z=r.readVarint():a===5&&t.layers.push((function(c,d){return c.readFields(y6,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)})(r,r.readVarint()+r.pos))}function p6(a,t,r){a===1?(t.delta_filter=(function(c,d){return c.readFields(m6,{blockSize:0},d)})(r,r.readVarint()+r.pos),t.filter="delta_filter"):a===2?(r.readVarint(),t.filter="zigzag_filter"):a===3?(r.readVarint(),t.filter="bitshuffle_filter"):a===4&&(r.readVarint(),t.filter="byteshuffle_filter")}function m6(a,t,r){a===1&&(t.blockSize=r.readVarint())}function g6(a,t,r){a===1?(r.readVarint(),t.codec="gzip_data"):a===2?(r.readVarint(),t.codec="jpeg_image"):a===3?(r.readVarint(),t.codec="webp_image"):a===4&&(r.readVarint(),t.codec="png_image")}function _6(a,t,r){let c=0,d=0;a===1?t.firstByte=r.readFixed64():a===2?t.lastByte=r.readFixed64():a===3?t.filters.push((function(g,_){return g.readFields(p6,{},_)})(r,r.readVarint()+r.pos)):a===4?t.codec=(function(g,_){return g.readFields(g6,{},_)})(r,r.readVarint()+r.pos):a===5?d=r.readFloat():a===6?c=r.readFloat():a===7?t.bands.push(r.readString()):a===8?t.offset=r.readDouble():a===9&&(t.scale=r.readDouble()),t.offset===0&&(t.offset=d),t.scale===0&&(t.scale=c)}function y6(a,t,r){a===1?t.version=r.readVarint():a===2?t.name=r.readString():a===3?t.units=r.readString():a===4?t.tileSize=r.readVarint():a===5?t.buffer=r.readVarint():a===6?t.pixelFormat=r.readVarint():a===7&&t.dataIndex.push((function(c,d){return c.readFields(_6,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)})(r,r.readVarint()+r.pos))}function v6(a,t,r){if(a===2)(function(c,d,g){c.readFields(x6,g,d)})(r,r.readVarint()+r.pos,t);else if(a===3)throw new Error("Not implemented")}function x6(a,t,r){if(a===1){let c=0;const d=r.readVarint()+r.pos;for(;r.pos<d;)t[c++]=r.readVarint()}}function b6(a,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let r=t[3];for(let c=2;c>=1;c--){const d=c===1?1:0,g=c===2?1:0;for(let _=0;_<t[0];_++){const v=t[1]*_;for(let S=d;S<t[1];S++){const T=t[2]*(S+v);for(let M=g;M<t[2];M++){const A=t[3]*(M+T);for(let z=0;z<t[3];z++){const D=A+z;a[D]+=a[D-r]}}}}r*=t[c]}return a}function w6(a){for(let t=0,r=a.length;t<r;t++)a[t]=a[t]>>>1^-(1&a[t]);return a}function S6(a,t){switch(t){case"uint32":return a;case"uint16":for(let r=0;r<a.length;r+=2){const c=a[r],d=a[r+1];a[r]=(240&c)>>4|(61440&c)>>8|(240&d)<<4|61440&d,a[r+1]=15&c|(3840&c)>>4|(15&d)<<8|(3840&d)<<4}return a;case"uint8":for(let r=0;r<a.length;r+=4){const c=a[r],d=a[r+1],g=a[r+2],_=a[r+3];a[r+0]=(192&c)>>6|(192&d)>>4|(192&g)>>2|192&_,a[r+1]=(48&c)>>4|(48&d)>>2|48&g|(48&_)<<2,a[r+2]=(12&c)>>2|12&d|(12&g)<<2|(12&_)<<4,a[r+3]=3&c|(3&d)<<2|(3&g)<<4|(3&_)<<6}return a;default:throw new Error(`Invalid pixel format, "${t}"`)}}Vt(o0,"DEMData"),Vt(pC,"DemMinMaxQuadTree",{omit:["dem"]});var ya=Uint8Array,i_=Uint16Array,T6=Int32Array,gC=new ya([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_C=new ya([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),E6=new ya([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yC=function(a,t){for(var r=new i_(31),c=0;c<31;++c)r[c]=t+=1<<a[c-1];var d=new T6(r[30]);for(c=1;c<30;++c)for(var g=r[c];g<r[c+1];++g)d[g]=g-r[c]<<5|c;return{b:r,r:d}},vC=yC(gC,2),xC=vC.b,I6=vC.r;xC[28]=258,I6[258]=28;for(var M6=yC(_C,0).b,bC=new i_(32768),Zr=0;Zr<32768;++Zr){var Wf=(43690&Zr)>>1|(21845&Zr)<<1;bC[Zr]=((65280&(Wf=(61680&(Wf=(52428&Wf)>>2|(13107&Wf)<<2))>>4|(3855&Wf)<<4))>>8|(255&Wf)<<8)>>1}var n_=function(a,t,r){for(var c=a.length,d=0,g=new i_(t);d<c;++d)a[d]&&++g[a[d]-1];var _,v=new i_(t);for(d=1;d<t;++d)v[d]=v[d-1]+g[d-1]<<1;_=new i_(1<<t);var S=15-t;for(d=0;d<c;++d)if(a[d])for(var T=d<<4|a[d],M=t-a[d],A=v[a[d]-1]++<<M,z=A|(1<<M)-1;A<=z;++A)_[bC[A]>>S]=T;return _},r_=new ya(288);for(Zr=0;Zr<144;++Zr)r_[Zr]=8;for(Zr=144;Zr<256;++Zr)r_[Zr]=9;for(Zr=256;Zr<280;++Zr)r_[Zr]=7;for(Zr=280;Zr<288;++Zr)r_[Zr]=8;var wC=new ya(32);for(Zr=0;Zr<32;++Zr)wC[Zr]=5;var A6=n_(r_,9),P6=n_(wC,5),$S=function(a){for(var t=a[0],r=1;r<a.length;++r)a[r]>t&&(t=a[r]);return t},_l=function(a,t,r){var c=t/8|0;return(a[c]|a[c+1]<<8)>>(7&t)&r},VS=function(a,t){var r=t/8|0;return(a[r]|a[r+1]<<8|a[r+2]<<16)>>(7&t)},z6=function(a){return(a+7)/8|0},C6=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yl=function(a,t,r){var c=new Error(t||C6[a]);if(c.code=a,Error.captureStackTrace&&Error.captureStackTrace(c,yl),!r)throw c;return c},R6=new ya(0),L6=typeof TextDecoder<"u"&&new TextDecoder;try{L6.decode(R6,{stream:!0})}catch{}const D6={gzip_data:"gzip"};class Ha extends Error{constructor(t){super(t),this.name="MRTError"}}const k6={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},SC={uint32:1,uint16:2,uint8:4},O6={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let jS;class s0{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const r=this.layers[t];if(!r)throw new Ha(`Layer '${t}' not found`);return r}getHeaderLength(t){const r=new Uint8Array(t),c=new DataView(t);if(r[0]!==13)throw new Ha("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(t){const r=new Uint8Array(t),c=this.getHeaderLength(t);if(r.length<c)throw new Ha(`Expected header with length >= ${c} but got buffer of length ${r.length}`);const d=new jS(r.subarray(0,c)).readFields(f6,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Ha(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const g of d.layers)this.layers[g.name]=new TC(g,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const r=[],c=this.getLayer(t.layerName);for(let d of t.blockIndices){const g=c.dataIndex[d],_=g.firstByte-t.firstByte,v=g.lastByte-t.firstByte;if(c._blocksInProgress.has(d))continue;const S={layerName:c.name,firstByte:_,lastByte:v,pixelFormat:c.pixelFormat,blockIndex:d,blockShape:[g.bands.length].concat(c.bandShape),buffer:c.buffer,codec:g.codec.codec,filters:g.filters.map(T=>T.filter)};c._blocksInProgress.add(d),r.push(S)}return new EC(r,()=>{r.forEach(d=>c._blocksInProgress.delete(d.blockIndex))},(d,g)=>{if(r.forEach(_=>c._blocksInProgress.delete(_.blockIndex)),d)throw d;g.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class TC{constructor({version:t,name:r,units:c,tileSize:d,pixelFormat:g,buffer:_,dataIndex:v},S){if(this.version=t,this.version!==1)throw new Ha(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=r,this.units=c,this.tileSize=d,this.buffer=_,this.pixelFormat=k6[g],this.dataIndex=v,this.bandShape=[d+2*_,d+2*_,SC[this.pixelFormat]],this._decodedBlocks=new r0(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return SC[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const r=t.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,t.data)}getBlockForBand(t){let r=0;switch(typeof t){case"string":for(const[c,d]of this.dataIndex.entries()){for(const[g,_]of d.bands.entries())if(_===t)return{bandIndex:r+g,blockIndex:c,blockBandIndex:g};r+=d.bands.length}break;case"number":for(const[c,d]of this.dataIndex.entries()){if(t>=r&&t<r+d.bands.length)return{bandIndex:t,blockIndex:c,blockBandIndex:t-r};r+=d.bands.length}break;default:throw new Ha(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(t){let r=1/0,c=-1/0;const d=[],g=new Set;for(const _ of t){const{blockIndex:v}=this.getBlockForBand(_);if(v<0)throw new Ha(`Invalid band: ${JSON.stringify(_)}`);const S=this.dataIndex[v];d.includes(v)||d.push(v),g.add(v),r=Math.min(r,S.firstByte),c=Math.max(c,S.lastByte)}if(g.size>this.cacheSize)throw new Ha(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:c,blockIndices:d}}hasBand(t){const{blockIndex:r}=this.getBlockForBand(t);return r>=0}hasDataForBand(t){const{blockIndex:r}=this.getBlockForBand(t);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(t){const{blockIndex:r,blockBandIndex:c}=this.getBlockForBand(t);if(r<0)throw new Ha(`Band not found: ${JSON.stringify(t)}`);const d=this._decodedBlocks.get(r.toString());if(!d)throw new Ha(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[r],_=this.bandShape.reduce((T,M)=>T*M,1),v=c*_,S=d.subarray(v,v+_);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}s0.setPbf=function(a){jS=a};class EC{constructor(t,r,c){this.tasks=t,this._onCancel=r,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,r){this._finalized||(this._onComplete(t,r),this._finalized=!0)}}s0.performDecoding=function(a,t){const r=new Uint8Array(a);return Promise.all(t.tasks.map(c=>{const{layerName:d,firstByte:g,lastByte:_,pixelFormat:v,blockShape:S,blockIndex:T,filters:M,codec:A}=c,z=r.subarray(g,_+1),D=new Uint32Array(S[0]*S[1]*S[2]);let k;if(A!=="gzip_data")throw new Ha(`Unhandled codec: ${A}`);return k=(function($,H){if(!globalThis.DecompressionStream&&H==="gzip_data")return Promise.resolve((ue=(function(ye){ye[0]==31&&ye[1]==139&&ye[2]==8||yl(6,"invalid gzip data");var me=ye[3],we=10;4&me&&(we+=2+(ye[10]|ye[11]<<8));for(var Ie=(me>>3&1)+(me>>4&1);Ie>0;Ie-=!ye[we++]);return we+(2&me)})(j=$),ue+8>j.length&&yl(6,"invalid gzip data"),(function(ye,me,we,Ie){var Je=ye.length;if(!Je||me.f&&!me.l)return we||new ya(0);var qe=!we,Xe=qe||me.i!=2,at=me.i;qe&&(we=new ya(3*Je));var nt=function(Jo){var ic=we.length;if(Jo>ic){var ko=new ya(Math.max(2*ic,Jo));ko.set(we),we=ko}},ot=me.f||0,Ge=me.p||0,ct=me.b||0,et=me.l,ut=me.d,lt=me.m,Bt=me.n,Ut=8*Je;do{if(!et){ot=_l(ye,Ge,1);var Tt=_l(ye,Ge+1,3);if(Ge+=3,!Tt){var Mt=ye[(ln=z6(Ge)+4)-4]|ye[ln-3]<<8,ai=ln+Mt;if(ai>Je){at&&yl(0);break}Xe&&nt(ct+Mt),we.set(ye.subarray(ln,ai),ct),me.b=ct+=Mt,me.p=Ge=8*ai,me.f=ot;continue}if(Tt==1)et=A6,ut=P6,lt=9,Bt=5;else if(Tt==2){var Jt=_l(ye,Ge,31)+257,Ct=_l(ye,Ge+10,15)+4,xi=Jt+_l(ye,Ge+5,31)+1;Ge+=14;for(var Wi=new ya(xi),mn=new ya(19),Gi=0;Gi<Ct;++Gi)mn[E6[Gi]]=_l(ye,Ge+3*Gi,7);Ge+=3*Ct;var Pn=$S(mn),sn=(1<<Pn)-1,wr=n_(mn,Pn);for(Gi=0;Gi<xi;){var ln,In=wr[_l(ye,Ge,sn)];if(Ge+=15&In,(ln=In>>4)<16)Wi[Gi++]=ln;else{var Yn=0,or=0;for(ln==16?(or=3+_l(ye,Ge,3),Ge+=2,Yn=Wi[Gi-1]):ln==17?(or=3+_l(ye,Ge,7),Ge+=3):ln==18&&(or=11+_l(ye,Ge,127),Ge+=7);or--;)Wi[Gi++]=Yn}}var sr=Wi.subarray(0,Jt),Sr=Wi.subarray(Jt);lt=$S(sr),Bt=$S(Sr),et=n_(sr,lt),ut=n_(Sr,Bt)}else yl(1);if(Ge>Ut){at&&yl(0);break}}Xe&&nt(ct+131072);for(var vo=(1<<lt)-1,Ao=(1<<Bt)-1,Ur=Ge;;Ur=Ge){var Wr=(Yn=et[VS(ye,Ge)&vo])>>4;if((Ge+=15&Yn)>Ut){at&&yl(0);break}if(Yn||yl(2),Wr<256)we[ct++]=Wr;else{if(Wr==256){Ur=Ge,et=null;break}var Qr=Wr-254;Wr>264&&(Qr=_l(ye,Ge,(1<<(dr=gC[Gi=Wr-257]))-1)+xC[Gi],Ge+=dr);var Ui=ut[VS(ye,Ge)&Ao],ar=Ui>>4;if(Ui||yl(3),Ge+=15&Ui,Sr=M6[ar],ar>3){var dr=_C[ar];Sr+=VS(ye,Ge)&(1<<dr)-1,Ge+=dr}if(Ge>Ut){at&&yl(0);break}Xe&&nt(ct+131072);var Ws=ct+Qr;if(ct<Sr){var Xo=0-Sr,xo=Math.min(Sr,Ws);for(Xo+ct<0&&yl(3);ct<xo;++ct)we[ct]=Ie[Xo+ct]}for(;ct<Ws;++ct)we[ct]=we[ct-Sr]}}me.l=et,me.p=Ur,me.b=ct,me.f=ot,et&&(ot=1,me.m=lt,me.d=ut,me.n=Bt)}while(!ot);return ct!=we.length&&qe?(function(Jo,ic,ko){return(ko==null||ko>Jo.length)&&(ko=Jo.length),new ya(Jo.subarray(0,ko))})(we,0,ct):we.subarray(0,ct)})(j.subarray(ue,-8),{i:2},new ya(((Y=j)[(te=Y.length)-4]|Y[te-3]<<8|Y[te-2]<<16|Y[te-1]<<24)>>>0),q)));var j,q,Y,te,ue;const ae=D6[H];if(!ae)throw new Error(`Unhandled codec: ${H}`);const ge=new globalThis.DecompressionStream(ae);return new Response(new Blob([$]).stream().pipeThrough(ge)).arrayBuffer().then(ye=>new Uint8Array(ye))})(z,A).then($=>((function(H,j){H.readFields(v6,j)})(new jS($),D),new O6[v](D.buffer))),k.then($=>{for(let H=M.length-1;H>=0;H--)switch(M[H]){case"delta_filter":b6($,S);break;case"zigzag_filter":w6($);break;case"bitshuffle_filter":S6($,v);break;default:throw new Ha(`Unhandled filter "${M[H]}"`)}return{layerName:d,blockIndex:T,data:$}}).catch($=>{throw $})}))},Vt(EC,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Vt(s0,"MapboxRasterTile"),Vt(TC,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class IC{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const c=t[r];this._stringToNumber[c]=r,this._numberToString[r]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class MC{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xc(It,16,0),this.featureIndexArray=new Uh,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,r,c,d,g,_=0,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,g,_);const T=this.grid;for(let M=0;M<r.length;M++){const A=r[M],z=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const k=A[D];z[0]=Math.min(z[0],k.x),z[1]=Math.min(z[1],k.y),z[2]=Math.max(z[2],k.x),z[3]=Math.max(z[3],k.y)}v!==0&&(z[0]-=v,z[1]-=v,z[2]+=v,z[3]+=v),z[0]<It&&z[1]<It&&z[2]>=0&&z[3]>=0&&T.insert(S,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wn(new Fx(this.rawTileData)).layers,this.sourceLayerCoder=new IC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r){const{tilespaceGeometry:c,transform:d,tileTransform:g,pixelPosMatrix:_,availableImages:v,worldview:S}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const T=r.queryRadius?r.queryRadius:0,M=c.bufferedTilespaceBounds,A=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,($,H,j,q)=>ja(c.bufferedTilespaceGeometry,$-T,H-T,j+T,q+T));A.sort(F6);let z=null;d.elevation&&A.length>0&&(z=Gf.create(d.elevation,this.tileID));const D={};let k;for(let $=0;$<A.length;$++){const H=A[$];if(H===k)continue;k=H;const j=this.featureIndexArray.get(H);let q=null;this.is3DTile?this.loadMatchingModelFeature(D,j,t,c,d,S):this.loadMatchingFeature(D,j,t,v,S,(Y,te,ue,ae=0)=>(q||(q=fi(Y,this.tileID.canonical,g)),te.queryIntersectsFeature(c,Y,ue,q,this.z,d,_,z,ae,r.scope)))}return D}loadMatchingFeature(t,r,c,d,g,_){const{featureIndex:v,bucketIndex:S,sourceLayerIndex:T,layoutVertexArrayOffset:M}=r,A=this.bucketLayerIDs[S],z=c.layers,D=Object.keys(z);if(D.length&&!ji(D,A))return;const k=c.sourceCache,$=this.sourceLayerCoder.decode(T),H=this.vtLayers[$].feature(v),j=this.getId(H,$);for(let q=0;q<A.length;q++){const Y=A[q];if(!z[Y])continue;const{styleLayer:te,targets:ue}=z[Y];let ae={};j!==void 0&&(ae=k.getFeatureState(te.sourceLayer,j));const ge=!_||_(H,te,ae,M);if(!ge)continue;const ye=new ed(H,this.z,this.x,this.y,j);ye.tile=this.tileID.canonical,ye.state=ae;let me=this.serializedLayersCache.get(Y);me||(me=te.serialize(),me.id=Y,this.serializedLayersCache.set(Y,me)),ye.source=me.source,ye.sourceLayer=me["source-layer"],ye.layer=Object.assign({},me),ye.layer.paint=AC(me.paint,te.paint,H,ae,d),ye.layer.layout=AC(me.layout,te.layout,H,ae,d);let we=!1;for(const Ie of ue){this.updateFeatureProperties(ye,Ie);const{filter:Je}=Ie;if(Je){if(H.properties=ye.properties,Je.needGeometry){const qe=Bi(H,!0);if(!Je.filter(new An(this.tileID.overscaledZ,{worldview:g}),qe,this.tileID.canonical))continue}else if(!Je.filter(new An(this.tileID.overscaledZ,{worldview:g}),H))continue}we=!0,Ie.targetId&&this.addFeatureVariant(ye,Ie)}we&&this.appendToResult(t,Y,v,ye,ge)}}loadMatchingModelFeature(t,r,c,d,g,_){const{featureIndex:v,bucketIndex:S}=r,T=this.bucketLayerIDs[S],M=c.layers,A=Object.keys(M);if(!A.length||ji(A,T))for(let z=0;z<T.length;z++){const D=T[z],{styleLayer:k,targets:$}=M[D];if(k.type!=="model")continue;const H=d.tile,j=H.getBucket(k);if(!(j&&j instanceof e0))continue;const q=GV(j,v,d,g);if(!q)continue;const{z:Y,x:te,y:ue}=H.tileID.canonical,{feature:ae,intersectionZ:ge,position:ye}=q;let me={};ae.id!==void 0&&(me=c.sourceCache.getFeatureState(k.sourceLayer,ae.id));const we=new ed({},Y,te,ue,ae.id);we.tile=this.tileID.canonical,we.state=me,we.properties=ae.properties,we.geometry={type:"Point",coordinates:[ye.lng,ye.lat]};let Ie=this.serializedLayersCache.get(D);Ie||(Ie=k.serialize(),Ie.id=D,this.serializedLayersCache.set(D,Ie)),we.source=Ie.source,we.sourceLayer=Ie["source-layer"],we.layer=Object.assign({},Ie);let Je=!1;for(const qe of $){this.updateFeatureProperties(we,qe);const{filter:Xe}=qe;if(Xe){if(ae.properties=we.properties,Xe.needGeometry){if(!Xe.filter(new An(this.tileID.overscaledZ,{worldview:_}),ae,this.tileID.canonical))continue}else if(!Xe.filter(new An(this.tileID.overscaledZ,{worldview:_}),ae))continue}Je=!0,qe.targetId&&this.addFeatureVariant(we,qe)}Je&&this.appendToResult(t,D,v,we,ge)}}updateFeatureProperties(t,r,c){if(r.properties){const d={};for(const g in r.properties){const _=r.properties[g].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,c);_!=null&&(d[g]=_)}t.properties=d}}addFeatureVariant(t,r,c){const d={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(d.properties=t.properties),t.variants=t.variants||{},t.variants[r.targetId]=t.variants[r.targetId]||[],t.variants[r.targetId].push(d)}appendToResult(t,r,c,d,g){let _=t[r];_===void 0&&(_=t[r]=[]),_.push({featureIndex:c,feature:d,intersectionZ:g})}lookupSymbolFeatures(t,r,c,d,g,_){const v={};this.loadVTLayers();for(const S of t)this.loadMatchingFeature(v,{bucketIndex:r,sourceLayerIndex:c,featureIndex:S,layoutVertexArrayOffset:0},d,g,_);return v}loadFeature(t){const{featureIndex:r,sourceLayerIndex:c}=t;this.loadVTLayers();const d=this.sourceLayerCoder.decode(c),g=this.vtFeatures[d];if(g[r])return g[r];const _=this.vtLayers[d].feature(r);return g[r]=_,_}hasLayer(t){for(const r of this.bucketLayerIDs)for(const c of r)if(t===c)return!0;return!1}getId(t,r){let c=t.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const g=Hl(d);if(g.result!=="success"){const _=g.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void yi(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=g.value}c=this.promoteIdExpression.evaluate({zoom:0},t)}else c=t.properties[d];typeof c=="boolean"&&(c=Number(c))}return c}}function AC(a,t,r,c,d){return ni(a,(g,_)=>{const v=t instanceof jo?t.get(_):null;return v&&v.evaluate?v.evaluate(r,c,void 0,d):v})}function F6(a,t){return t-a}Vt(MC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const PC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class GS{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,c]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=c>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=PC[15&c];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new GS(v,_,g,t)}constructor(t,r=64,c=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=PC.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${c}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+S,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+S),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+S,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=r,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return HS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:v}=this,S=[0,g.length-1,0],T=[];for(;S.length;){const M=S.pop()||0,A=S.pop()||0,z=S.pop()||0;if(A-z<=v){for(let H=z;H<=A;H++){const j=_[2*H],q=_[2*H+1];j>=t&&j<=c&&q>=r&&q<=d&&T.push(g[H])}continue}const D=z+A>>1,k=_[2*D],$=_[2*D+1];k>=t&&k<=c&&$>=r&&$<=d&&T.push(g[D]),(M===0?t<=k:r<=$)&&(S.push(z),S.push(D-1),S.push(1-M)),(M===0?c>=k:d>=$)&&(S.push(D+1),S.push(A),S.push(1-M))}return T}within(t,r,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:_}=this,v=[0,d.length-1,0],S=[],T=c*c;for(;v.length;){const M=v.pop()||0,A=v.pop()||0,z=v.pop()||0;if(A-z<=_){for(let H=z;H<=A;H++)CC(g[2*H],g[2*H+1],t,r)<=T&&S.push(d[H]);continue}const D=z+A>>1,k=g[2*D],$=g[2*D+1];CC(k,$,t,r)<=T&&S.push(d[D]),(M===0?t-c<=k:r-c<=$)&&(v.push(z),v.push(D-1),v.push(1-M)),(M===0?t+c>=k:r+c>=$)&&(v.push(D+1),v.push(A),v.push(1-M))}return S}}function HS(a,t,r,c,d,g){if(d-c<=r)return;const _=c+d>>1;zC(a,t,_,c,d,g),HS(a,t,r,c,_-1,1-g),HS(a,t,r,_+1,d,1-g)}function zC(a,t,r,c,d,g){for(;d>c;){if(d-c>600){const T=d-c+1,M=r-c+1,A=Math.log(T),z=.5*Math.exp(2*A/3),D=.5*Math.sqrt(A*z*(T-z)/T)*(M-T/2<0?-1:1);zC(a,t,r,Math.max(c,Math.floor(r-M*z/T+D)),Math.min(d,Math.floor(r+(T-M)*z/T+D)),g)}const _=t[2*r+g];let v=c,S=d;for(o_(a,t,c,r),t[2*d+g]>_&&o_(a,t,c,d);v<S;){for(o_(a,t,v,S),v++,S--;t[2*v+g]<_;)v++;for(;t[2*S+g]>_;)S--}t[2*c+g]===_?o_(a,t,c,S):(S++,o_(a,t,S,d)),S<=r&&(c=S+1),r<=S&&(d=S-1)}}function o_(a,t,r,c){ZS(a,r,c),ZS(t,2*r,2*c),ZS(t,2*r+1,2*c+1)}function ZS(a,t,r){const c=a[t];a[t]=a[r],a[r]=c}function CC(a,t,r,c){const d=a-r,g=t-c;return d*d+g*g}s.$=sm,s.A=os,s.B=wc,s.C=2,s.D=Rf,s.E=ll,s.F=Vg,s.G=ez,s.H=Bd,s.I=ns,s.J=Nv,s.K=vi,s.L=di,s.M=Om,s.N=sf,s.O=vv,s.P=Ae,s.Q=Ih,s.R=is,s.S=_f,s.T=eS,s.U=Hl,s.V=Qx,s.W=cf,s.X=iu,s.Y=tu,s.Z=vh,s._=as,s.a=function(a){return jr.API_CDN_URL_REGEX.test(a)},s.a$=dt,s.a0=fh,s.a1=Wy,s.a2=eg,s.a3=class extends Qx{},s.a4=af,s.a5=km,s.a6=ke,s.a7=function(a){const t=a.value;return t?fh(t)?LS(t,!0)?[]:[new Qx(a.key,t,`invalid url "${t}"`)]:[new Qx(a.key,t,`string expected, "${vi(t)}" found`)]:[]},s.a8=du,s.a9=ur,s.aA=de,s.aB=ie,s.aC=Yt,s.aD=X,s.aE=ws,s.aF=Le,s.aG=wt,s.aH=function(a,t){const r={};for(let c=0;c<t.length;c++){const d=t[c];d in a&&(r[d]=a[d])}return r},s.aI=Se,s.aJ=Ze,s.aK=class{constructor(a){this.entries={},this.scheduler=a}request(a,t,r,c){const d=this.entries[a]=this.entries[a]||{callbacks:[]};if(d.result){const[g,_]=d.result;return this.scheduler?this.scheduler.add(()=>{c(g,_)},t):c(g,_),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=r((g,_)=>{d.result=[g,_];for(const v of d.callbacks)this.scheduler?this.scheduler.add(()=>{v(g,_)},t):v(g,_);setTimeout(()=>delete this.entries[a],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==c),d.callbacks.length||(d.cancel(),delete this.entries[a]))}}},s.aL=function(a,t,r){const c=JSON.stringify(a.request);return a.data&&(this.deduped.entries[c]={result:[null,a.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},d=>{const g=ah(a.request,(_,v,S)=>{_?d(_):v&&d(null,{rawData:v,vectorTile:r?void 0:new wn(new Fx(v)),responseHeaders:new Map(S.entries())})});return()=>{g.cancel(),d()}},t)},s.aM=function(a){return a?{cacheControl:a.get("Cache-Control"),expires:a.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=oh,s.aO=function(a){La++,La>Kp&&(a.getActor().send("enforceCacheSizeLimit",$y),La=0)},s.aP=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log2(a)))},s.aQ=qo,s.aR=Lz,s.aS=Nz,s.aT=he,s.aU=Rz,s.aV=function(a,t){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let c=0;c<a.length;c++){const d=document.createElement("source");jw(a[c])||(r.crossOrigin="Anonymous"),d.src=a[c],r.appendChild(d)}return{cancel:()=>{}}},s.aW=Fg,s.aX=td,s.aY=Ft,s.aZ=Hg,s.a_=tt,s.aa=bt,s.ab=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return vr(a.expression.evaluate(t))}interpolate(a,t,r){return{x:hi(a.x,t.x,r),y:hi(a.y,t.y,r),z:hi(a.z,t.z,r),azimuthal:hi(a.azimuthal,t.azimuthal,r),polar:hi(a.polar,t.polar,r)}}},s.ac=An,s.ad=vc,s.ae=At,s.af=Wt,s.ag=_t,s.ah=Me,s.ai=jo,s.aj=wu,s.ak=hi,s.al=It,s.am=im,s.an=ti,s.ao=bn,s.ap=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return(function([r,c]){const d=vr([1,r,c]);return{x:d.x,y:d.y,z:d.z}})(a.expression.evaluate(t))}interpolate(a,t,r){return{x:hi(a.x,t.x,r),y:hi(a.y,t.y,r),z:hi(a.z,t.z,r)}}},s.aq=function(a,t,r=0,c=!0){const d=new Ae(r,r),g=a.sub(d),_=t.add(d),v=[g,new Ae(_.x,g.y),_,new Ae(g.x,_.y)];return c&&v.push(g.clone()),v},s.ar=function(a,t){const r=[];for(let c=0;c<a.length;c++){const d=Oe(c-1,-1,a.length-1),g=Oe(c+1,-1,a.length-1),_=a[c],v=a[g],S=a[d].sub(_).unit(),T=v.sub(_).unit(),M=T.angleWithSep(S.x,S.y),A=S.add(T).unit().mult(-1*t/Math.sin(M/2));r.push(_.add(A))}return r},s.as=_z,s.at=ja,s.au=function(a,t,r=0){return yt(((t.x-r)*a.scale-a.x)*It,(t.y*a.scale-a.y)*It,Fe(t.z,t.y))},s.av=Ce,s.aw=Li,s.ax=Nn,s.ay=PP,s.az=function(a){let t=1/0,r=1/0,c=-1/0,d=-1/0;for(const g of a)t=Math.min(t,g.x),r=Math.min(r,g.y),c=Math.max(c,g.x),d=Math.max(d,g.y);return{min:new Ae(t,r),max:new Ae(c,d)}},s.b=function(a){return jr.API_FONTS_REGEX.test(a)},s.b$=EA,s.b0=Hr,s.b1=pl,s.b2=gt,s.b3=qv,s.b4=Xx,s.b5=function(){ga.isLoading()||ga.isLoaded()||Ym()!=="deferred"||Km()},s.b6=tg,s.b7=Bi,s.b8=ed,s.b9=Qn,s.bA=fe,s.bB=Ye,s.bC=ee,s.bD=function(a,t){const{x:r,y:c}=a.point,d=U2(r,c,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ie(d,d,w1(Ql(t)))},s.bE=F,s.bF=zi,s.bG=Un,s.bH=Dn,s.bI=hn,s.bJ=Ei,s.bK=Nf,s.bL=Zs,s.bM=_S,s.bN=function(a,t,r,c,d){const g=5*t+2;a.float32[g+0]=r,a.float32[g+1]=c,a.float32[g+2]=d},s.bO=jf,s.bP=Qs,s.bQ=gs,s.bR=ea,s.bS=Rl,s.bT=Oe,s.bU=function(a,t,r,c){var d=new C(4);return d[0]=a,d[1]=t,d[2]=r,d[3]=c,d},s.bV=class{isDataAvailableAtPoint(a){const t=this._source();if(this.isUsingMockSource()||!t||a.y<0||a.y>1)return!1;const r=t.getSource().maxzoom,c=1<<r,d=Math.floor(a.x),g=Math.floor((a.x-d)*c),_=Math.floor(a.y*c),v=this.findDEMTileFor(new qo(r,d,r,g,_));return!(!v||!v.dem)}getAtPointOrZero(a,t=0){return this.getAtPoint(a,t)||0}getAtPoint(a,t,r=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||a.y<0||a.y>1)return t;const d=c.getSource().maxzoom,g=1<<d,_=Math.floor(a.x),v=a.x-_,S=new qo(d,_,d,Math.floor(v*g),Math.floor(a.y*g)),T=this.findDEMTileFor(S);if(!T||!T.dem)return t;const M=T.dem,A=1<<T.tileID.canonical.z,z=(v*A-T.tileID.canonical.x)*M.dim,D=(a.y*A-T.tileID.canonical.y)*M.dim,k=Math.floor(z),$=Math.floor(D);return(r?this.exaggeration():1)*hi(hi(M.get(k,$),M.get(k,$+1),D-$),hi(M.get(k+1,$),M.get(k+1,$+1),D-$),z-k)}static getAtTileOffset(a,t,r,c){const d=1<<a.canonical.z;return c?c.pointElevation(t):r?r.getAtPointOrZero(new At(a.wrap+(a.canonical.x+t.x/It)/d,(a.canonical.y+t.y/It)/d)):0}static getAtTileOffsetFunc(a,t,r,c){return(d,g,_)=>{const v=this.getAtTileOffset(a,d,g,_),S=c.upVector(a.canonical,d.x,d.y);return bi(S,S,v*c.upVectorScale(a.canonical,t,r).metersToTile),S}}getForTilePoints(a,t,r,c){if(this.isUsingMockSource())return!1;const d=Gf.create(this,a,c);return!!d&&(t.forEach(g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],r)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(a);if(!t||!t.dem)return null;const r=t.dem.tree,c=t.tileID,d=1<<a.canonical.z-c.canonical.z;let g=a.canonical.x/d-c.canonical.x,_=a.canonical.y/d-c.canonical.y,v=0;for(let S=0;S<a.canonical.z-c.canonical.z&&!r.leaves[v];S++){g*=2,_*=2;const T=2*Math.floor(_)+Math.floor(g);v=r.childOffsets[v]+T,g%=1,_%=1}return{min:this.exaggeration()*r.minimums[v],max:this.exaggeration()*r.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let t=!1,r=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const d of a){const g=this.getMinMaxForTile(d.tileID);g&&(r=Math.min(r,g.min),c=Math.max(c,g.max),t=!0)}return t?{min:r,max:c}:null}},s.bW=Ix,s.bX=rr,s.bY=ao,s.bZ=bA,s.b_=Uz,s.ba=cS,s.bb=N1,s.bc=fi,s.bd=Yl,s.be=Fh,s.bf=D2,s.bg=er,s.bh=Af,s.bi=zS,s.bj=function(a,t){const r=wu(t.zoom);if(r===0)return Ql(a);const c=dx(a),d=b1(c),g=Le(c.getWest())*t.worldSize,_=Le(c.getEast())*t.worldSize,v=Ze(c.getNorth())*t.worldSize,S=Ze(c.getSouth())*t.worldSize,T=[g,v,0],M=[_,v,0],A=[g,S,0],z=[_,S,0],D=le([],t.globeMatrix);return Wt(T,T,D),Wt(M,M,D),Wt(A,A,D),Wt(z,z,D),d[0]=Ic(d[0],A,r),d[1]=Ic(d[1],z,r),d[2]=Ic(d[2],M,r),d[3]=Ic(d[3],T,r),yn.fromPoints(d)},s.bk=px,s.bl=le,s.bm=vg,s.bn=Ic,s.bo=fl,s.bp=XU,s.bq=zt,s.br=it,s.bs=s0,s.bt=Fx,s.bu=ah,s.bv=function(a,t){const r=[];for(const c in a)c in t||r.push(c);return r},s.bw=Pe,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=Ot,s.bz=se,s.c=Ro,s.c$=function(a,t,r){let c=0;for(let d=0;d<2;++d)a[d]>0&&(c+=(a[d]-0)*(a[d]-0)),t[d]<0&&(c+=(0-t[d])*(0-t[d]));return c},s.c0=IA,s.c1=pS,s.c2=lz,s.c3=wS,s.c4=GS,s.c5=bi,s.c6=Xt,s.c7=qi,s.c8=function(a,t,r){r*=.5;var c=t[0],d=t[1],g=t[2],_=t[3],v=Math.sin(r),S=Math.cos(r);return a[0]=c*S+d*v,a[1]=d*S-c*v,a[2]=g*S+_*v,a[3]=_*S-g*v,a},s.c9=$i,s.cA=Qe,s.cB=oo,s.cC=pP,s.cD=Hh,s.cE=F2,s.cF=function(a,t,r,c,d,g,_,v,S){if(S.name==="globe")return F2(a,t,new Hh(r,c,d),!1);const T=Hg({z:r,x:c,y:d},S);return new yn([(g+T.x/T.scale)*t,t*(T.y/T.scale),_],[(g+T.x2/T.scale)*t,t*(T.y2/T.scale),v])},s.cG=function(a,t,r){return a[0]=Math.min(t[0],r[0]),a[1]=Math.min(t[1],r[1]),a[2]=Math.min(t[2],r[2]),a[3]=Math.min(t[3],r[3]),a},s.cH=function(a,t,r){return a[0]=Math.max(t[0],r[0]),a[1]=Math.max(t[1],r[1]),a[2]=Math.max(t[2],r[2]),a[3]=Math.max(t[3],r[3]),a},s.cI=function(a){const t=Math.round((a+45+360)%360/90)%4;return Z[t]},s.cJ=Te,s.cK=ri,s.cL=6,s.cM=function(a){const t=fe(new Float64Array(16));ie(t,a.pixelMatrix,a.globeMatrix);const r=[0,re,0],c=[0,ne,0];return Wt(r,r,t),Wt(c,c,t),[r[0]>0&&r[0]<=a.width&&r[1]>0&&r[1]<=a.height&&!T1(a,new he(a.center.lat,90)),c[0]>0&&c[0]<=a.width&&c[1]>0&&c[1]<=a.height&&!T1(a,new he(a.center.lat,-90))]},s.cN=function(a,t){const{scale:r}=a.tileTransform,c=r*It/(a.tileSize*Math.pow(2,t.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return(function(d,g,_){var v=g[1],S=g[2],T=g[3],M=_[0],A=_[1];return d[0]=g[0]*M,d[1]=v*M,d[2]=S*A,d[3]=T*A,d})(new Float32Array(4),t.inverseAdjustmentMatrix,[c,c])},s.cO=Cx,s.cP=Dt,s.cQ=fP,s.cR=function(a){const t=fP(a,!0);return F([],[t[0],t[1],t[4],t[5]])},s.cS=Ve,s.cT=hr,s.cU=Ne,s.cV=function(a){const{x:t,y:r}=a.point,{lng:c,lat:d}=a._center;return U2(t,r,a.worldSize,c,d)},s.cW=Pi,s.cX=Ee,s.cY=Mf,s.cZ=Ga,s.c_=5,s.ca=nr,s.cb=function(a,t){return a[0]=-t[0],a[1]=-t[1],a[2]=-t[2],a[3]=t[3],a},s.cc=Et,s.cd=function(a,t,r,c,d){var g=1/Math.tan(t/2);if(a[0]=g/r,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,d!=null&&d!==1/0){var _=1/(c-d);a[10]=(d+c)*_,a[14]=2*d*c*_}else a[10]=-1,a[14]=-2*c;return a},s.ce=function(a,t,r,c,d,g,_){var v=1/(t-r),S=1/(c-d),T=1/(g-_);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*S,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*T,a[11]=0,a[12]=(t+r)*v,a[13]=(d+c)*S,a[14]=(_+g)*T,a[15]=1,a},s.cf=je,s.cg=function(a,t,r){a[4*t+0]=r[0],a[4*t+1]=r[1],a[4*t+2]=r[2],a[4*t+3]=r[3]},s.ch=$s,s.ci=jh,s.cj=Rr,s.ck=Vs,s.cl=vu,s.cm=wz,s.cn=function(){var a=new C(4);return C!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.co=function(a,t,r){var c=t[0],d=t[1],g=t[2],_=t[3],v=Math.sin(r),S=Math.cos(r);return a[0]=c*S+g*v,a[1]=d*S+_*v,a[2]=c*-v+g*S,a[3]=d*-v+_*S,a},s.cp=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]},s.cq=$e,s.cr=function(a){var t=a[0],r=a[1],c=a[2],d=a[3];return Math.sqrt(t*t+r*r+c*c+d*d)},s.cs=Cl,s.ct=Vi,s.cu=L2,s.cv=3,s.cw=2,s.cx=7,s.cy=6,s.cz=ei,s.d=function(a){return jr.API_TILEJSON_REGEX.test(a)},s.d$=class{constructor(a,t,r,c){this.context=a,this.format=c,this.size=r,this.texture=a.gl.createTexture();const[d,g,_]=this.size,{gl:v}=a;v.bindTexture(v.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in t&&t.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,d,g,_,0,K1(this.format),Q1(this.format),t.data)}bind(a,t){const{context:r}=this,{gl:c}=r;c.bindTexture(c.TEXTURE_3D,this.texture),a!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,a),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,a),this.minFilter=a),t!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},s.d0=function(a){return a*a*a*a*a},s.d1=ze,s.d2=45,s.d3=Ef,s.d4=function(a,t,r){const c=Math.sqrt(a*a+t*t+r*r),d=c>0?Math.acos(r/c)*Cn:0;let g=a!==0||t!==0?Math.atan2(-t,-a)*Cn+90:0;return g<0&&(g+=360),[c,g,d]},s.d5=yt,s.d6=vr,s.d7=vt,s.d8=Qt,s.d9=yn,s.dA=function(a){return a({pluginStatus:Vo,pluginURL:Xl}),Jm.on("pluginStateChange",a),a},s.dB=cx,s.dC=class extends _a{constructor(a){super(a),this.current=M2}set(a,t,r){if(this.fetchUniformLocation(a,t)){for(let c=0;c<9;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.dD=Q,s.dE=function(a,t,r){const c=wu(r.zoom),d=a.style.map._antialias,g=a.terrain&&a.terrain.exaggeration()>0;return c===0&&!d&&!g},s.dF=function(a){const t=a.pixelsPerMeter,r=t/je(1,a.center.lat),c=fe(new Float64Array(16));return it(c,c,[a.point.x,a.point.y,0]),Ve(c,c,[r,r,t]),Float32Array.from(c)},s.dG=dx,s.dH=function(a){const t=80.051129;a=de(a,-80.051129,t)/t*90;const r=Math.pow(Math.abs(Math.sin(ti(a))),3);return Math.round(r*(oe.length-1))},s.dI=function(a,t,r,c){const d=t.getNorth(),g=t.getSouth(),_=t.getWest(),v=t.getEast(),S=1<<a.z,T=v-_,M=d-g,A=T/K,z=-M/oe[r],D=[0,A,0,z,0,0,d,_,0];if(a.z>0){const k=180/c;J(D,D,[k/T+1,0,0,0,k/M+1,0,-.5*k/A,.5*k/z,1])}return D[2]=S,D[5]=a.x,D[8]=a.y,D},s.dJ=Ql,s.dK=function(a,t,r){const c=fe(new Float64Array(16)),d=(t/(1<<a)-.5)*Math.PI*2;return Re(c,r.globeMatrix,d),Float32Array.from(c)},s.dL=Q2,s.dM=hx,s.dN=function(a,t){return[Math.pow(a[0],2.2)*t,Math.pow(a[1],2.2)*t,Math.pow(a[2],2.2)*t]},s.dO=O,s.dP=function(a,t){var r=Math.sin(t),c=Math.cos(t);return a[0]=c,a[1]=r,a[2]=0,a[3]=-r,a[4]=c,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.dQ=ui,s.dR=N2,s.dS=_r,s.dT=To,s.dU=CS,s.dV=function(a,t){const r=[0,0,0];return Wt(r,r,px(Ql(t.canonical))),Wt(r,r,a),r},s.dW=a=>({u_matrix:new vu(a),u_texsize:new Vs(a),u_pixels_to_tile_units:new n(a),u_device_pixel_ratio:new Rr(a),u_width_scale:new Rr(a),u_floor_width_scale:new Rr(a),u_image:new $s(a),u_units_to_pixels:new Vs(a),u_tile_units_to_pixels:new Rr(a),u_alpha_discard_threshold:new Rr(a),u_trim_offset:new Vs(a),u_trim_fade_range:new Vs(a),u_trim_gradient_mix_range:new Vs(a),u_trim_color:new Ef(a),u_zbias_factor:new Rr(a),u_tile_to_meter:new Rr(a),u_ground_shadow_factor:new jh(a),u_pattern_transition:new Rr(a)}),s.dX=a=>({u_matrix:new vu(a),u_pixels_to_tile_units:new n(a),u_device_pixel_ratio:new Rr(a),u_width_scale:new Rr(a),u_floor_width_scale:new Rr(a),u_units_to_pixels:new Vs(a),u_dash_image:new $s(a),u_gradient_image:new $s(a),u_image_height:new Rr(a),u_texsize:new Vs(a),u_tile_units_to_pixels:new Rr(a),u_alpha_discard_threshold:new Rr(a),u_trim_offset:new Vs(a),u_trim_fade_range:new Vs(a),u_trim_gradient_mix_range:new Vs(a),u_trim_color:new Ef(a),u_zbias_factor:new Rr(a),u_tile_to_meter:new Rr(a),u_ground_shadow_factor:new jh(a)}),s.dY=a=>({u_camera_to_center_distance:new Rr(a),u_extrude_scale:new n(a),u_device_pixel_ratio:new Rr(a),u_matrix:new vu(a),u_inv_rot_matrix:new vu(a),u_merc_center:new Vs(a),u_tile_id:new jh(a),u_zoom_transition:new Rr(a),u_up_dir:new jh(a),u_emissive_strength:new Rr(a)}),s.dZ=xf,s.d_=q5,s.da=pi,s.db=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},s.dc=dP,s.dd=sS,s.de=_P,s.df=LS,s.dg=function(a,t){return a.readFields(ZV,{icons:[]},t)},s.dh=Mx,s.di=Uf,s.dj=vS,s.dk=sh,s.dl=Ov,s.dm=rh,s.dn=qc,s.dp=ki,s.dq=function(a){const t=a.indexOf(Lh);return t>=0?a.slice(0,t):a},s.dr=function(a){return a.indexOf(Lh)>=0},s.ds=function(a){const t=a.lastIndexOf(Lh);return t>=0?a.slice(t+1):""},s.dt=function(a){const t=[],r=a.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},s.du=function(a,t,r,c){return a.type==="custom"?new UV(a,t):new HV[a.type](a,t,r,c)},s.dv=li,s.dw=function(a){const t=a.indexOf(Lh);return t>=0?a.slice(t+1):""},s.dx=class extends ed{constructor(a,t){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},s.dy=Jm,s.dz=sl,s.e=jr,s.e$=Nt,s.e0=j2,s.e1=(a,t,r,c,d,g)=>{const _=a.transform,v=_.projection.name==="globe";let S;if(g.paint.get("circle-pitch-alignment")==="map")if(v){const M=N2(_.zoom,t.canonical)*_._pixelsPerMercatorPixel;S=Float32Array.from([M,0,0,M])}else S=_.calculatePixelsToTileUnitsMatrix(r);else S=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(_.projection),u_matrix:a.translatePosMatrix(t.projMatrix,r,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ks.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:e$,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(v){T.u_inv_rot_matrix=c,T.u_merc_center=d,T.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],T.u_zoom_transition=wu(_.zoom);const M=d[0]*It,A=d[1]*It;T.u_up_dir=_.projection.upVector(new Hh(0,0,0),M,A)}return T},s.e2=LP,s.e3=ss,s.e4=(a,t,r,c,d,g,_,v,S,T)=>{const M=a.transform,A=M.pitch<15?zP(.07,.7,de((14-M.zoom)/5,0,1)):.07,z=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:RP(a,t,r,c),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:CP(t,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:r.lut).toArray01(),u_zbias_factor:A,u_tile_to_meter:vt(t.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:T}},s.e5=(a,t,r,c,d,g,_,v,S,T)=>{const M=a.transform,A=M.calculatePixelsToTileUnitsMatrix(t),z=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",D=M.pitch<15?zP(.07,.7,de((14-M.zoom)/5,0,1)):.07;return{u_matrix:RP(a,t,r,c),u_pixels_to_tile_units:A,u_device_pixel_ratio:g,u_width_scale:_,u_floor_width_scale:v,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:DP(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:CP(t,a.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:r.lut).toArray01(),u_zbias_factor:D,u_tile_to_meter:vt(t.tileID.canonical,0),u_ground_shadow_factor:T}},s.e6=st,s.e7=xg,s.e8=Fe,s.e9=WU,s.eA=function(a,t){var r=2*Math.acos(t[3]),c=Math.sin(r/2);return c>P?(a[0]=t[0]/c,a[1]=t[1]/c,a[2]=t[2]/c):(a[0]=1,a[1]=0,a[2]=0),r},s.eB=OS,s.eC=Dx,s.eD=Lx,s.eE=[1,1,1],s.eF=Gf,s.eG=rt,s.eH=function(a,t,r,c){var d=t[0],g=t[1],_=t[2],v=t[3];return a[0]=d+c*(r[0]-d),a[1]=g+c*(r[1]-g),a[2]=_+c*(r[2]-_),a[3]=v+c*(r[3]-v),a},s.eI=Of,s.eJ=Us,s.eK=Tc,s.eL=function(a,t,r,c,d,g,_,v,S,T,M,A,z,D,k,$){var H=new C(16);return H[0]=a,H[1]=t,H[2]=r,H[3]=c,H[4]=d,H[5]=g,H[6]=_,H[7]=v,H[8]=S,H[9]=T,H[10]=M,H[11]=A,H[12]=z,H[13]=D,H[14]=k,H[15]=$,H},s.eM=ve,s.eN=Oh,s.eO=fg,s.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ae(1/0,1/0),max:new Ae(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,t=!1){const r=SA(new Ae(0,0),new Ae(It,It),a),c=[];if(t&&!U1(r,this._globalClipBounds))return c;for(const d of this._activeRegions){if(d.hiddenByOverlap||!U1(r,d))continue;const g=O$(d.min,d.max,a);c.push({min:g.min,max:g.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return c}setSources(a){this._setSources(a.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const r=[];for(const c of t.cache.getVisibleCoordinates()){const d=t.cache.getTile(c).buckets[t.layer];d&&d.updateFootprints(c.toUnwrapped(),r)}return r},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(a){const t=a.getFootprints();if(t.length===0)return;const r=a.getOrder(),c=a.getClipMask(),d=a.getClipScope();for(const g of t){if(!g.footprint)continue;const _=SA(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:r,clipMask:c,clipScope:d})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,r)=>t.priority-r.priority||wx(t.min,r.min)||wx(t.max,r.max)||t.order-r.order||t.clipMask-r.clipMask||(function(c,d){const g=(_,v)=>_+v;return c.length-d.length||c.reduce(g,"").localeCompare(d.reduce(g,""))})(t.clipScope,r.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let t=0;for(;!a&&t!==this._activeRegions.length;){const r=this._activeRegions[t],c=this._prevRegions[t];a=r.priority!==c.priority||!wA(r,c)||r.order!==c.order||r.clipMask!==c.clipMask||!Ot(r.clipScope,c.clipScope),this._activeRegions[t].hiddenByOverlap=c.hiddenByOverlap,++t}}if(a){++this._updateTime;for(const r of this._activeRegions)r.order!==Ag&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const t=r=>{const c=this._activeRegions;if(r>=c.length)return r;const d=c[r].priority;for(;r<c.length&&c[r].priority===d;)++r;return r};if(this._sourceIds.length>1){let r=0,c=t(r);for(;r!==c;){let d=r;const g=r;for(;d!==c;){const _=this._activeRegions[d];_.hiddenByOverlap=!1;for(let v=0;v<g;v++){const S=this._activeRegions[v];if(!S.hiddenByOverlap&&_.order===Ag&&U1(_,S)&&(_.hiddenByOverlap=TA(_.footprint,_.tileId,S.footprint,S.tileId),_.hiddenByOverlap))break}++d}r=c,c=t(r)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=a.length-1;t>=0;t--)this._addSource(a[t]);this._computeReplacement()}},s.eQ=Ag,s.eR=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,t){const r=new Yl,c=new Hr,d=[],g=a+1+2,_=t[0]+1,v=t[0]+1+(1+t.length),S=(T,M,A)=>{let z=T===g-1?T-2:T===0?T:T-1;return z+=A?24575:0,[z,M]};for(let T=0;T<g;++T)r.emplaceBack(...S(T,0,!0));for(let T=0;T<_;++T)for(let M=0;M<g;++M)r.emplaceBack(...S(M,T,(M===0||M===g-1)&&!0));for(let T=0;T<t.length;++T){const M=t[T];for(let A=0;A<g;++A)r.emplaceBack(...S(A,M,!0))}for(let T=0;T<t.length;++T){const M=c.length,A=t[T]+1+2,z=new Hr;for(let $=0;$<A-1;$++){const H=$===A-2,j=H?g*(v-t.length+T-$):g;for(let q=0;q<g-1;q++){const Y=$*g+q;$===0||H||q===0||q===g-2?(z.emplaceBack(Y+1,Y,Y+j),z.emplaceBack(Y+j,Y+j+1,Y+1)):(c.emplaceBack(Y+1,Y,Y+j),c.emplaceBack(Y+j,Y+j+1,Y+1))}}const D=er.simpleSegment(0,M,r.length,c.length-M);for(let $=0;$<z.uint16.length;$+=3)c.emplaceBack(z.uint16[$],z.uint16[$+1],z.uint16[$+2]);const k=er.simpleSegment(0,M,r.length,c.length-M);d.push({withoutSkirts:D,withSkirts:k})}return{vertices:r,indices:c,segments:d}}_createGrid(a){const t=this._fillGridMeshWithLods(K,oe);this._gridSegments=t.segments,this._gridBuffer=a.createVertexBuffer(t.vertices,D2.members),this._gridIndexBuffer=a.createIndexBuffer(t.indices,!0)}_createPoles(a){const t=new Hr;for(let _=0;_<=K;_++)t.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=a.createIndexBuffer(t,!0);const r=new Sc,c=new Sc,d=new Sc,g=new Sc;this._poleSegments=[];for(let _=0,v=0;_<5;_++){const S=360/(1<<_);r.emplaceBack(0,-X,0,.5,0),c.emplaceBack(0,-X,0,.5,1),d.emplaceBack(0,-X,0,.5,.5),g.emplaceBack(0,-X,0,.5,.5);for(let T=0;T<=K;T++){let M=T/K,A=0;const z=hi(0,S,M),[D,k,$]=be(KU,QU,z,X);r.emplaceBack(D,k,$,M,A),c.emplaceBack(D,k,$,M,1-A);const H=ti(z);M=.5+.5*Math.sin(H),A=.5+.5*Math.cos(H),d.emplaceBack(D,k,$,M,A),g.emplaceBack(D,k,$,M,1-A)}this._poleSegments.push(er.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(r,ux,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(c,ux,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(d,ux,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(g,ux,!1)}getGridBuffers(a,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},s.eS=k$,s.eT=ce,s.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eV=xe,s.eW=ft,s.eX=function(a,t,r){return a[0]=t[0]/r[0],a[1]=t[1]/r[1],a[2]=t[2]/r[2],a},s.eY=Zt,s.eZ=_e,s.e_=mr,s.ea=Ex,s.eb=BA,s.ec=Ac,s.ed=450,s.ee=7,s.ef=We,s.eg=function(a,t){if(a===t){var r=t[1],c=t[2],d=t[3],g=t[6],_=t[7],v=t[11];a[1]=t[4],a[2]=t[8],a[3]=t[12],a[4]=r,a[6]=t[9],a[7]=t[13],a[8]=c,a[9]=g,a[11]=t[14],a[12]=d,a[13]=_,a[14]=v}else a[0]=t[0],a[1]=t[4],a[2]=t[8],a[3]=t[12],a[4]=t[1],a[5]=t[5],a[6]=t[9],a[7]=t[13],a[8]=t[2],a[9]=t[6],a[10]=t[10],a[11]=t[14],a[12]=t[3],a[13]=t[7],a[14]=t[11],a[15]=t[15];return a},s.eh=NV,s.ei=Yi,s.ej=gg,s.ek=256,s.el=w1,s.em=oa,s.en=Re,s.eo=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[4],a[4]=t[5],a[5]=t[6],a[6]=t[8],a[7]=t[9],a[8]=t[10],a},s.ep=Sc,s.eq=mv,s.er=Sf,s.es=function(a,t,r,c,d){return de((a-t)/(r-t)*(d-c)+c,c,d)},s.et=Xi,s.eu=function(a,t){var r=t[0],c=t[1],d=t[2],g=t[3],_=t[4],v=t[5],S=t[6],T=t[7],M=t[8],A=M*_-v*T,z=-M*g+v*S,D=T*g-_*S,k=r*A+c*z+d*D;return k?(a[0]=A*(k=1/k),a[1]=(-M*c+d*T)*k,a[2]=(v*c-d*_)*k,a[3]=z*k,a[4]=(M*r-d*S)*k,a[5]=(-v*r+d*g)*k,a[6]=D*k,a[7]=(-T*r+c*S)*k,a[8]=(_*r-c*g)*k,a):null},s.ev=2,s.ew=zn,s.ex=Zi,s.ey=St,s.ez=function(a,t){var r=new C(3);St(r,t);var c=1/r[0],d=1/r[1],g=1/r[2],_=t[0]*c,v=t[1]*d,S=t[2]*g,T=t[4]*c,M=t[5]*d,A=t[6]*g,z=t[8]*c,D=t[9]*d,k=t[10]*g,$=_+M+k,H=0;return $>0?(H=2*Math.sqrt($+1),a[3]=.25*H,a[0]=(A-D)/H,a[1]=(z-S)/H,a[2]=(v-T)/H):_>M&&_>k?(H=2*Math.sqrt(1+_-M-k),a[3]=(A-D)/H,a[0]=.25*H,a[1]=(v+T)/H,a[2]=(z+S)/H):M>k?(H=2*Math.sqrt(1+M-_-k),a[3]=(z-S)/H,a[0]=(v+T)/H,a[1]=.25*H,a[2]=(A+D)/H):(H=2*Math.sqrt(1+k-_-M),a[3]=(v-T)/H,a[0]=(z+S)/H,a[1]=(A+D)/H,a[2]=.25*H),a},s.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(t,r)=>String.fromCharCode(+("0x"+r))))},s.f0=function([a,t,r]){const c=Math.hypot(a,t,r),d=Math.atan2(a,r),g=.5*Math.PI-Math.acos(-t/c);return new he(Ee(d),Ee(g))},s.f1=wi,s.f2=tS,s.f3=function(a){const t=a.navigator?a.navigator.userAgent:null;return!!(function(r){if(on==null){const c=r.navigator?r.navigator.userAgent:null;on=!!r.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return on})(a)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f4=function(a,t){$y=a,Kp=t},s.f5=T1,s.f6=$2,s.f7=function(a){const t=[0,0,0],r=fe(new Float64Array(16));return ie(r,a.pixelMatrix,a.globeMatrix),Wt(t,t,r),new Ae(t[0],t[1])},s.f8=function(){const a=Dg;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(Z1),Dg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f9=function(){Mx().acquire(Z1)},s.fA=o0,s.fB=Qi,s.fC=function(a){let t=0;if(new Uint32Array(a,0,1)[0]!==aP){const r=new Uint32Array(a,0,7),[,,c,d,g,_]=r;t=r.byteLength+d+g+_+g,(c!==a.byteLength||t>=a.byteLength)&&yi("Invalid b3dm header information.")}return hP(a,t)},s.fD=function(a,t){const r=sS(a);for(const c of r){for(const d of c.meshes)g5(d);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(_5(c.lights,t)))}return r},s.fE=e0,s.fF=xr,s.fG=JA,s.fH=ga,s.fI=ls,s.fJ=function(a){Fs(),_o!=null&&_o.then(t=>{t.keys().then(r=>{for(let c=0;c<r.length-a;c++)t.delete(r[c]).catch(d=>yi(d.message))}).catch(r=>yi(r.message))}).catch(t=>yi(t.message))},s.fa=Ym,s.fb=function(a,t,r=!1){if(Vo===ls.deferred||Vo===ls.loading||Vo===ls.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xl=ks.resolveURL(a),Vo=ls.deferred,ql=t,Xm(),r||Km()},s.fc=function(a){Lf=ks.resolveURL(a),Df||(Df=new Rf(Mx(),new ll)),Df.broadcast("setMeshoptUrl",Lf)},s.fd=QA,s.fe=function(a){X1=ks.resolveURL(a),Df||(Df=new Rf(Mx(),new ll)),Df.broadcast("setDracoUrl",X1)},s.ff=KA,s.fg=Lg,s.fh=function(a){const t=ol();if(!t)return;const r=t.delete(Uy);a&&r.then(()=>a()).catch(a)},s.fi=qh,s.fj=Vt,s.fk=Su,s.fl=2,s.fm=IC,s.fn=MC,s.fo=IP,s.fp=en,s.fq="hd_road_elevation",s.fr=Zo,s.fs=ni,s.ft=Mc,s.fu=yS,s.fv=1,s.fw=function(a,t,r,c,d,g,_,v=1,S,T,M,A){a.createArrays(),a.tilePixelRatio=It/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const z=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,k={};k.scaleFactor=v,k.textSizeScaleRange=z.get("text-size-scale-range"),k.iconSizeScaleRange=z.get("icon-size-scale-range");const[$,H]=k.textSizeScaleRange,[j,q]=k.iconSizeScaleRange;k.textScaleFactor=de(k.scaleFactor,$,H),k.iconScaleFactor=de(k.scaleFactor,j,q);const Y=D["text-size"],te=D["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:we,maxZoom:Ie}=a.textSizeData;k.compositeTextSizes=[Y.possiblyEvaluate(new An(we,{worldview:M}),g),Y.possiblyEvaluate(new An(Ie,{worldview:M}),g)]}if(a.iconSizeData.kind==="composite"){const{minZoom:we,maxZoom:Ie}=a.iconSizeData;k.compositeIconSizes=[te.possiblyEvaluate(new An(we,{worldview:M}),g,A),te.possiblyEvaluate(new An(Ie,{worldview:M}),g,A)]}k.layoutTextSize=Y.possiblyEvaluate(new An(_+1,{worldview:M}),g),k.layoutIconSize=te.possiblyEvaluate(new An(_+1,{worldview:M}),g,A),k.textMaxSize=Y.possiblyEvaluate(new An(18,{worldview:M}),g);const ue=z.get("symbol-placement"),ae=z.get("text-rotation-alignment")==="map"&&ue!=="point",ge=z.get("text-size");let ye=!1;const me=[];for(const we of a.features){const Ie=z.get("text-font").evaluate(we,{},g).join(","),Je=ge.evaluate(we,{},g)*k.textScaleFactor,qe=k.layoutTextSize.evaluate(we,{},g)*k.textScaleFactor,Xe=k.layoutIconSize.evaluate(we,{},g,A)*k.iconScaleFactor,at={horizontal:{},vertical:void 0},nt=we.text;let ot,Ge=[0,0];if(nt){const sn=nt.toString(),wr=z.get("text-letter-spacing").evaluate(we,{},g)*ao,ln=z.get("text-line-height").evaluate(we,{},g)*ao,In=h1(sn)?wr:0,Yn=z.get("text-anchor").evaluate(we,{},g),or=z.get("text-variable-anchor");if(!or){const Ur=z.get("text-radial-offset").evaluate(we,{},g);if(Ur)Ge=lz(Yn,[Ur*ao,bS]);else{const Wr=z.get("text-offset").evaluate(we,{},g);Ge=[Wr[0]*ao,Wr[1]*ao]}}let sr=ae?"center":z.get("text-justify").evaluate(we,{},g);const Sr=ue==="point",vo=Sr?z.get("text-max-width").evaluate(we,{},g)*ao:1/0,Ao=Ur=>{a.allowVerticalPlacement&&Wm(sn)&&(at.vertical=fS(nt,t,r,d,Ie,vo,ln,Yn,Ur,In,Ge,Zs.vertical,!0,qe,Je,S))};if(!ae&&or){const Ur=sr==="auto"?or.map(Qr=>wS(Qr)):[sr];let Wr=!1;for(let Qr=0;Qr<Ur.length;Qr++){const Ui=Ur[Qr];if(!at.horizontal[Ui])if(Wr)at.horizontal[Ui]=at.horizontal[0];else{const ar=fS(nt,t,r,d,Ie,vo,ln,"center",Ui,In,Ge,Zs.horizontal,!1,qe,Je,S);ar&&(at.horizontal[Ui]=ar,Wr=ar.positionedLines.length===1)}}Ao("left")}else{if(sr==="auto"&&(sr=wS(Yn)),Sr||z.get("text-writing-mode").indexOf("horizontal")>=0||!Wm(sn)){const Ur=fS(nt,t,r,d,Ie,vo,ln,Yn,sr,In,Ge,Zs.horizontal,!1,qe,Je,S);Ur&&(at.horizontal[sr]=Ur)}Ao(Sr?"left":sr)}}let ct,et,ut,lt,Bt,Ut,Tt=!1;const Mt=z.get("icon-text-fit").evaluate(we,{},g);if(we.icon&&we.icon.hasPrimary()){const sn=Gg(we.icon,a.iconSizeData,D["icon-size"],g,a.zoom,we,S,k.iconScaleFactor,M,A);ct=sn.iconPrimary,ut=sn.iconSecondary;const wr=ct.toString();if(et=c.get(wr),et&&(Bt=z.get("icon-offset").evaluate(we,{},g),Ut=z.get("icon-anchor").evaluate(we,{},g),ot=Nx(d.get(wr),ut?d.get(ut.toString()):void 0,Bt,Ut),Tt=et.sdf,a.sdfIcons===void 0?a.sdfIcons=et.sdf:a.sdfIcons!==et.sdf&&yi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==a.pixelRatio||z.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),ut){const ln=ut.toString();lt=c.get(ln)}}ye=ye||!(!we.icon||!we.icon.hasSecondary());const ai=Gx(at.horizontal)||at.vertical;a.iconsInText||(a.iconsInText=!!ai&&ai.iconsInText);const Jt=qe*k.textScaleFactor/ao,{defaultShapedIcon:Ct,verticallyShapedIcon:xi}=EV(a,ot,z,we,g,at,Jt,Bt,Mt);Mt!=="none"&&ot&&(ZP(ot)||WP(ot))&&(jx(0,et,ct,ot,Ct,Mt,T,c,d),jx(0,lt,ut,ot,Ct,Mt,T,c,d),xi&&(jx(0,et,ct,ot,xi,Mt,T,c,d),jx(0,lt,ut,ot,xi,Mt,T,c,d))),ot=Ct;const{iconBBox:Wi,iconVerticalBBox:mn,textBBox:Gi,textVerticalBBox:Pn}=xV(a,ot,xi,z,we,g,Xe,Bt,k,d,Ut,at,qe,Ge,A);me.push({feature:we,shapedTextOrientations:at,shapedText:ai,shapedIcon:ot,iconPrimary:ct,iconSecondary:ut,iconOffset:Bt,iconAnchor:Ut,verticallyShapedIcon:xi,layoutTextSize:qe,layoutIconSize:Xe,textOffset:Ge,isSDFIcon:Tt,iconTextFit:Mt,iconCollisionBounds:Wi,iconVerticalCollisionBounds:mn,textCollisionBounds:Gi,textVerticalCollisionBounds:Pn})}return{featureData:me,sizes:k,hasAnySecondaryIcon:ye,textAlongLine:ae,symbolPlacement:ue}},s.fx=tz,s.fy=function(a,t,r,c,d,g,_,v,S,T){a.iconAtlasPositions=T.iconPositions;const{featureData:M,hasAnySecondaryIcon:A,sizes:z,textAlongLine:D,symbolPlacement:k}=t;for(const $ of M){const{shapedIcon:H,verticallyShapedIcon:j,feature:q,shapedTextOrientations:Y,shapedText:te,layoutTextSize:ue,textOffset:ae,isSDFIcon:ge,iconPrimary:ye,iconSecondary:me,iconTextFit:we,iconOffset:Ie,iconCollisionBounds:Je,iconVerticalCollisionBounds:qe,textCollisionBounds:Xe}=$;dz(H,T.iconPositions,ye,me),dz(j,T.iconPositions,ye,me),TV(Y,T.iconPositions),SV(ye,me,T.iconPositions),(te||H)&&IV(a,q,Y,H,j,S,z,ue,0,ae,ge,c,d,_,v,A,we,Ie,D,k,Je,qe,Xe)}r&&a.generateCollisionDebugBuffers(g,a.collisionBoxArray,z.textScaleFactor)},s.fz=wn,s.g=function(a,t){return sl(Object.assign(a,{method:"GET"}),t)},s.h=function(a){return a.indexOf("mapbox:")===0},s.i=function(a){return jr.API_STYLE_REGEX.test(a)&&!Ro(a)},s.j=Ll,s.k=Hc,s.l=function(a){return decodeURIComponent(atob(a).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(a,t){return sl(Object.assign(a,{type:"json"}),t)},s.n=Cd,s.o=ks,s.p=function(a,t){return sl(Object.assign(a,{method:"POST"}),t)},s.q=Mo,s.r=cc,s.s=function(a){try{const t=self[a];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return W1||(W1=new qh("ImageRasterizer")),W1},s.u=function(){return(function a(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()},s.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},s.w=yi,s.x=US,s.y=uh,s.z=al}),m(["./shared"],function(s){function P(Ee){const Z=Ee?Ee.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function C(Ee){if(typeof Ee=="number"||typeof Ee=="boolean"||typeof Ee=="string"||Ee==null)return JSON.stringify(Ee);if(Array.isArray(Ee)){let Q="[";for(const ce of Ee)Q+=`${C(ce)},`;return`${Q}]`}let Z="{";for(const Q of Object.keys(Ee).sort())Z+=`${Q}:${C(Ee[Q])},`;return`${Z}}`}function F(Ee){let Z="";for(const Q of s.bx)Z+=`/${C(Ee[Q])}`;return Z}function O(Ee,Z){return(function Q(ce){return typeof ce=="string"&&ce===Z||(Array.isArray(ce)?ce.some(Q):!(!ce||typeof ce!="object")&&Object.values(ce).some(Q))})(Ee)}class V{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,Q){this._layerConfigs={},this._layers={},this.update(Z,[],Q)}update(Z,Q,ce){this._options=ce;for(const de of Z)this._layerConfigs[de.id]=de,(this._layers[de.id]=s.du(de,this.scope,null,this._options)).compileFilter(ce),this.keyCache[de.id]&&delete this.keyCache[de.id];for(const de of Q)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const xe=(function(de,Me){const Oe={};for(let Be=0;Be<de.length;Be++){const gt=de[Be];let st=Me&&Me[gt.id];st||(gt.type==="symbol"?st=gt.id:(st=F(gt),gt.type==="line"&&gt.paint&&O(gt.paint["line-width"],"line-progress")&&(st+=`/${C(gt.paint["line-width"])}`))),Me&&(Me[gt.id]=st);let Ft=Oe[st];Ft||(Ft=Oe[st]=[]),Ft.push(gt)}const Pe=[];for(const Be in Oe)Pe.push(Oe[Be]);return Pe})(Object.values(this._layerConfigs),this.keyCache);for(const de of xe){const Me=de.map(Ft=>this._layers[Ft.id]),Oe=Me[0];if(Oe.visibility==="none")continue;const Pe=Oe.source||"";let Be=this.familiesBySource[Pe];Be||(Be=this.familiesBySource[Pe]={});const gt=Oe.sourceLayer||"_geojsonTileLayer";let st=Be[gt];st||(st=Be[gt]=[]),st.push(Me)}}}const J=1*s.fl;class ee{constructor(Z){const Q={},ce=[];for(const Oe in Z){const Pe=Z[Oe],Be=Q[Oe]={};for(const gt in Pe.glyphs){const st=Pe.glyphs[+gt];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const Ft=st.metrics.localGlyph?J:1,ni={x:0,y:0,w:st.bitmap.width+2*Ft,h:st.bitmap.height+2*Ft};ce.push(ni),Be[gt]=ni}}const{w:xe,h:de}=s.G(ce),Me=new s.fk({width:xe||1,height:de||1});for(const Oe in Z){const Pe=Z[Oe];for(const Be in Pe.glyphs){const gt=Pe.glyphs[+Be];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const st=Q[Oe][Be],Ft=gt.metrics.localGlyph?J:1;s.fk.copy(gt.bitmap,Me,{x:0,y:0},{x:st.x+Ft,y:st.y+Ft},gt.bitmap)}}this.image=Me,this.positions=Q}}function se(Ee,Z,Q){Ee[Z]?Q&&(Ee[Z].center=Q):Ee[Z]={floorIds:new Set,center:Q||[0,0],floors:{}}}function fe(Ee,Z,Q,ce){for(const xe of Z)se(Ee,xe),Ee[xe].floors[Q]=ce,Ee[xe].floorIds.add(Q)}function le(Ee){return{id:Ee.properties.id.toString(),center:Ee.properties.center.toString().split(";").map(Number)}}function ie(Ee){return{id:Ee.properties.id.toString(),isDefault:!!Ee.properties.is_default&&Ee.properties.is_default,connections:Ee.properties.connected_floor_ids?new Set(Ee.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ee.properties.conflicted_floor_ids?new Set(Ee.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ee.properties.building_ids?new Set(Ee.properties.building_ids.toString().split(";")):new Set,name:Ee.properties.name.toString(),zIndex:Ee.properties.z_index}}function it(Ee,Z){return Z.every(Q=>Ee.properties&&Ee.properties[Q]!=null)}function Ve(Ee){return it(Ee,["type","id","name"])&&Ee.properties.type==="building"}function Ne(Ee){return it(Ee,["type","id","name","z_index"])&&Ee.properties.type==="floor"}s.fj(ee,"GlyphAtlas");class Re{constructor(Z){this.tileID=new s.aQ(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.lut=Z.lut,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.request&&Z.request.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=s.aZ(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.worldview=Z.worldview,this.localizableLayerIds=Z.localizableLayerIds,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster,this.tessellationStep=Z.tessellationStep,this.scaleFactor=Z.scaleFactor,this.worldview=Z.worldview,this.indoor=Z.indoor}parse(Z,Q,ce,xe,de,Me){this.status="parsing",this.data=Z,this.collisionBoxArray=new s.b3;const Oe=new s.fm(Object.keys(Z.layers).sort()),Pe=new s.fn(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];const Be={},gt=new s.fo(256,256),st={featureIndex:Pe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:gt,availableImages:ce,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const ki=this.indoor.indoorState.activeFloorsVisible,ji=(function(Si,yi,Vn){const Nr=(function(Qn,on){if(!Qn)return s.w("No source layers defined in indoor specification"),on;if(Qn.size===0)return on;const nr=Qn.difference(on);for(const On of nr)s.w(`Missing source layer required in indoor specification: ${On}`);return on.intersection(on)})(yi.sourceLayers,new Set(Object.keys(Si.layers))),vr=yi.indoorState,xr=(function(Qn,on,nr,On){const Fn=new Set,_r=new Set,To=new Set,go=new Map,jr={},Ll=Ro=>{const _s=go.get(Ro)||new Set;for(const ta of Fn)if((go.get(ta)||new Set).has(Ro)||_s.has(ta))return!0;return!1};for(const Ro of on){const _s=Qn.layers[Ro];if(_s)for(let ta=0;ta<_s.length;ta++){const pa=_s.feature(ta);if(Ve(pa)){const{id:ys,center:No}=le(pa);se(jr,ys,No),Fn.add(ys);continue}if(Ne(pa)){const{id:ys,isDefault:No,connections:rl,conflicts:cc,buildings:ks,name:nh,zIndex:rh}=ie(pa);fe(jr,ks,ys,{name:nh,zIndex:rh}),go.set(ys,cc),(ys===On||rl.has(On))&&Fn.add(ys),_r.add(ys),No&&To.add(ys)}}else s.w(`indoor source layer not found: ${Ro}`)}if(nr)for(const Ro of nr)_r.has(Ro)&&(Ll(Ro)||Fn.add(Ro));for(const Ro of To)Fn.has(Ro)||Ll(Ro)||Fn.add(Ro);return{buildings:jr,activeFloors:Fn}})(Si,Nr,vr.lastActiveFloors,vr.selectedFloorId);return Vn.send("setIndoorData",xr),xr})(Z,this.indoor,de);st.activeFloors=ki?ji.activeFloors:void 0}const Ft=[],ni=Q.familiesBySource[this.source];for(const ki in ni){const ji=Z.layers[ki];if(!ji)continue;let Si=!1,yi=!1,Vn=!1;for(const on of ni[ki])on[0].type==="symbol"?Si=!0:yi=!0,on[0].is3D()&&on[0].type!=="model"&&(Vn=!0);if(this.extraShadowCaster&&!Vn||this.isSymbolTile===!0&&!Si||this.isSymbolTile===!1&&!yi)continue;ji.version===1&&s.w(`Vector tile source "${this.source}" layer "${ki}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Nr=Oe.encode(ki),vr=[],xr=this.localizableLayerIds&&this.localizableLayerIds.has(ki);let Qn=!1;for(let on=0,nr=0;on<ji.length;on++){const On=ji.feature(on),Fn=Pe.getId(On,ki),_r=On.properties?On.properties.worldview:null;if(xr&&this.worldview&&typeof _r=="string")if(_r==="all")On.properties.$localized=!0;else{if(!_r.split(",").includes(this.worldview))continue;On.properties.$localized=!0,On.properties.worldview=this.worldview}!Qn&&On.properties&&On.properties.hasOwnProperty(s.fp)&&(Qn=!0),vr.push({feature:On,id:Fn,index:nr,sourceLayerIndex:Nr}),nr++}Qn&&!st.elevationFeatures&&Z.layers.hasOwnProperty(s.fq)&&(st.elevationFeatures=s.fr.parseFrom(Z.layers[s.fq],this.canonical));for(const on of ni[ki]){const nr=on[0];if(this.extraShadowCaster&&(!nr.is3D()||nr.type==="model")||this.isSymbolTile!==void 0&&nr.type==="symbol"!==this.isSymbolTile||nr.minzoom&&this.zoom<Math.floor(nr.minzoom)||nr.maxzoom&&this.zoom>=nr.maxzoom||nr.visibility==="none")continue;Ye(on,this.zoom,st.brightness,ce,this.worldview);const On=Be[nr.id]=nr.createBucket({index:Pe.bucketLayerIDs.length,layers:on,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Nr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:xe,worldview:this.worldview,localizable:xr,availableImages:ce});Pe.bucketLayerIDs.push(on.map(_r=>s.B(_r.id,_r.scope)));let Fn=On.prepare?On.prepare():null;Fn!=null?(Fn=Fn.then(()=>On.populate(vr,st,this.tileID.canonical,this.tileTransform)),Ft.push(Fn)):On.populate(vr,st,this.tileID.canonical,this.tileTransform)}}const li=()=>{let ki,ji,Si,yi,Vn,Nr;gt.trim();const vr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xr=()=>{if(ki)return this.status="done",Me(ki);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:Object.values(Be).filter(on=>!on.isEmpty()),featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:st.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ji&&Si&&yi){const on=new ee(ji),nr=new Map;for(const[_r,To]of Si.entries()){const{imagePosition:go}=s.fu(_r,To,s.fv);nr.set(_r,go)}const On={};for(const _r in Be){const To=Be[_r];To instanceof s.b4&&(Ye(To.layers,this.zoom,st.brightness,ce,this.worldview),On[_r]=s.fw(To,ji,on.positions,Si,nr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Vn,this.worldview,ce))}const Fn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(de,Si,Vn,()=>{Fn.iconsPending=!1,Qn(On,on,Fn)}),this.rasterizeIfNeeded(de,yi,Nr,()=>{Fn.patternsPending=!1,Qn(On,on,Fn)})}},Qn=(on,nr,On,Fn)=>{if(On.iconsPending||On.patternsPending)return;const _r=new s.fx(Si,yi,this.lut);for(const To in Be){const go=Be[To];if(To in on)s.fy(go,on[To],this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Si,_r);else if(go.hasPattern&&(go instanceof s.ba||go instanceof s.bb||go instanceof s.ea)){Ye(go.layers,this.zoom,st.brightness,ce,this.worldview);const jr=Object.fromEntries(_r.patternPositions);go.addFeatures(st,this.tileID.canonical,jr,ce,this.tileTransform,this.brightness)}}this.status="done",Me(null,{buckets:Object.values(Be).filter(To=>!To.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nr.image,lineAtlas:gt,imageAtlas:_r,brightness:st.brightness})};if(!this.extraShadowCaster){const on=s.fs(st.glyphDependencies,Fn=>Object.keys(Fn).map(Number));Object.keys(on).length?de.send("getGlyphs",{uid:this.uid,stacks:on},(Fn,_r)=>{ki||(ki=Fn,ji=_r,xr())},void 0,!1,vr):ji={};const nr=Array.from(st.iconDependencies.keys()).map(Fn=>s.I.parse(Fn));nr.length?de.send("getImages",{images:nr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Fn,_r)=>{ki||(ki=Fn,Si=new Map,Vn=this.updateImageMapAndGetImageTaskQueue(Si,_r,st.iconDependencies),xr())},void 0,!1,vr):(Si=new Map,Vn=new Map);const On=Array.from(st.patternDependencies.keys()).map(Fn=>s.I.parse(Fn));On.length?de.send("getImages",{images:On,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Fn,_r)=>{ki||(ki=Fn,yi=new Map,Nr=this.updateImageMapAndGetImageTaskQueue(yi,_r,st.patternDependencies),xr())},void 0,!1,vr):(yi=new Map,Nr=new Map)}if(st.elevationFeatures&&st.elevationFeatures.length>0){const on=[];for(const On of Object.values(Be))if(On instanceof s.bb){const Fn=On.getUnevaluatedPortalGraph();Fn&&on.push(Fn)}const nr=s.ft.evaluate(on);for(const On of Object.values(Be))if(On instanceof s.bb){const Fn=Z.layers[Oe.decode(On.sourceLayerIndex)];On.setEvaluatedPortalGraph(nr,Fn,this.tileID.canonical,st.availableImages,st.brightness)}}xr()};Ft.length>0?Promise.allSettled(Ft).then(li).catch(Me):li()}updateParameters(Z){this.scaleFactor=Z.scaleFactor,this.showCollisionBoxes=Z.showCollisionBoxes,this.projection=Z.projection,this.brightness=Z.brightness,this.tileTransform=s.aZ(Z.tileID.canonical,Z.projection),this.extraShadowCaster=Z.extraShadowCaster,this.lut=Z.lut,this.worldview=Z.worldview,this.indoor=Z.indoor}rasterizeIfNeeded(Z,Q,ce,xe){Array.from(Q.values()).some(de=>de.usvg)?this.rasterize(Z,Q,ce,xe):xe()}updateImageMapAndGetImageTaskQueue(Z,Q,ce){const xe=new Map;for(const de of Q.keys()){const Me=ce.get(de)||[];for(const Oe of Me){const Pe=Oe.toString(),Be=Q.get(Oe.id.toString());Be.usvg?xe.has(Pe)||(xe.set(Pe,Oe),Z.set(Pe,Object.assign({},Be))):Z.set(Pe,Be)}}return xe}rasterize(Z,Q,ce,xe){this.rasterizeTask=Z.send("rasterizeImages",{scope:this.scope,tasks:ce},(de,Me)=>{if(!de)for(const[Oe,Pe]of Me.entries()){const Be=Object.assign(Q.get(Oe),{data:Pe});Q.set(Oe,Be)}xe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ye(Ee,Z,Q,ce,xe){const de=new s.ac(Z,{brightness:Q,worldview:xe});for(const Me of Ee)Me.recalculate(de,ce)}class zt extends s.E{constructor(Z,Q,ce,xe,de,Me,Oe){super(),this.actor=Z,this.layerIndex=Q,this.availableImages=ce,this.availableModels=xe,this.loadVectorData=Me||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(Z.scheduler),this.isSpriteLoaded=de,this.scheduler=Z.scheduler,this.brightness=Oe}loadTile(Z,Q){const ce=Z.uid,xe=Z&&Z.request,de=xe&&xe.collectResourceTiming,Me=this.loading[ce]=new Re(Z);Me.abort=this.loadVectorData(Z,(Oe,Pe)=>{const Be=!this.loading[ce];if(delete this.loading[ce],Me.cancelRasterize(),Be||Oe||!Pe)return Me.status="done",Be||(this.loaded[ce]=Me),Q(Oe);const gt=Pe.rawData,st={},Ft=s.aM(Pe.responseHeaders);Ft&&Ft.expires&&(st.expires=Ft.expires),Ft&&Ft.cacheControl&&(st.cacheControl=Ft.cacheControl),Me.vectorTile=Pe.vectorTile||new s.fz(new s.bt(gt));const ni=()=>{Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(li,ki)=>{if(li||!ki)return Q(li);const ji={};if(de){const Si=P(xe);Si.length>0&&(ji.resourceTiming=JSON.parse(JSON.stringify(Si)))}Q(null,Object.assign({rawTileData:gt.slice(0),responseHeaders:Pe.responseHeaders},ki,st,ji))})};this.isSpriteLoaded?ni():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ni,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):ni()}),this.loaded=this.loaded||{},this.loaded[ce]=Me})}reloadTile(Z,Q){const ce=this.loaded,xe=Z.uid;if(ce&&ce[xe]){const de=ce[xe];de.updateParameters(Z);const Me=(Oe,Pe)=>{const Be=de.reloadCallback;Be&&(delete de.reloadCallback,de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Be)),Q(Oe,Pe)};de.status==="parsing"?de.reloadCallback=Me:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Me):Me())}else Q(null,void 0)}abortTile(Z,Q){const ce=Z.uid,xe=this.loading[ce];xe&&(xe.abort&&xe.abort(),delete this.loading[ce]),Q()}removeTile(Z,Q){const ce=this.loaded,xe=Z.uid;ce&&ce[xe]&&delete ce[xe],Q()}}class pt{loadTile(Z,Q){const{uid:ce,encoding:xe,rawImageData:de,padding:Me}=Z,Oe=ImageBitmap&&de instanceof ImageBitmap?this.getImageData(de,Me):de;Q(null,new s.fA(ce,Oe,xe,Me<1))}reloadTile(Z,Q){Q(null,null)}abortTile(Z,Q){Q()}removeTile(Z,Q){Q()}getImageData(Z,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ce=this.offscreenCanvasContext.getImageData(-Q,-Q,Z.width+2*Q,Z.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}s.bs.setPbf(s.bt);class St{constructor(Z){this._mrt=new s.bs(Z.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Z.uid,this.tileID=Z.tileID,this.source=Z.source}parse(Z,Q){const ce=this._mrt;this.status="parsing",this._entireBuffer=Z;try{ce.parseHeader(Z),this._isHeaderLoaded=!0;const xe=[];for(const de in ce.layers){const Me=ce.getLayer(de),Oe=Me.getDataRange(Me.getBandList()),Pe=ce.createDecodingTask(Oe),Be=Z.slice(Oe.firstByte,Oe.lastByte+1),gt=s.bs.performDecoding(Be,Pe).then(st=>Pe.complete(null,st)).catch(st=>Pe.complete(st,null));xe.push(gt)}Promise.allSettled(xe).then(()=>Q(null,ce)).catch(de=>Q(de))}catch(xe){Q(xe)}}}class Et{constructor(Z){this.actor=Z,this.loading={},this.loaded={}}loadTile(Z,Q){const ce=Z.uid,xe=Z.request,de=this.loading[ce]=new St(Z),{cancel:Me}=s.bu(xe,(Oe,Pe,Be)=>{const gt=!this.loading[ce];if(delete this.loading[ce],gt||Oe||!Pe)return de.status="done",gt||(this.loaded[ce]=de),Q(Oe);de.parse(Pe,(st,Ft)=>{if(st||!Ft)return Q(st);Q(null,Ft,Be)}),this.loaded[ce]=de});de.abort=Me}reloadTile(Z,Q){Q(null,void 0)}abortTile(Z,Q){const ce=Z.uid,xe=this.loading[ce];xe&&(xe.abort&&xe.abort(),delete this.loading[ce]),Q()}removeTile(Z,Q){const ce=Z.uid;this.loaded[ce]&&delete this.loaded[ce],Q()}decodeRasterArray(Z,Q){s.bs.performDecoding(Z.buffer,Z.task).then(ce=>Q(null,ce)).catch(ce=>Q(ce))}}const Dt=s.fB.prototype.toGeoJSON;class Qe{constructor(Z){this._feature=Z,this.extent=s.al,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(this._feature.type===1){const Z=[];for(const Q of this._feature.geometry)Z.push([new s.P(Q[0],Q[1])]);return Z}{const Z=[];for(const Q of this._feature.geometry){const ce=[];for(const xe of Q)ce.push(new s.P(xe[0],xe[1]));Z.push(ce)}return Z}}toGeoJSON(Z,Q,ce){return Dt.call(this,Z,Q,ce)}}class ht{constructor(Z,Q){this.name=Z,this.extent=s.al,this.length=Q.length,this._jsonFeatures=Q}feature(Z){return new Qe(this._jsonFeatures[Z])}}class _t{constructor(Z){this.layers={},this.extent=s.al;for(const Q of Object.keys(Z))this.layers[Q]=new ht(Q,Z[Q])}}const yt=64/4096;class Nt{constructor(){this.features=new Map}clear(){this.features.clear()}load(Z=[],Q){for(const ce of Z){const xe=ce.id;if(xe==null)continue;let de=this.features.get(xe);de&&this.updateCache(de,Q),ce.geometry?(de=pi(ce),this.updateCache(de,Q),this.features.set(xe,de)):this.features.delete(xe),this.updateCache(de,Q)}}updateCache(Z,Q){for(const{canonical:ce,uid:xe}of Object.values(Q)){const{z:de,x:Me,y:Oe}=ce;Qt(Z,Math.pow(2,de),Me,Oe)&&delete Q[xe]}}getTile(Z,Q,ce){const xe=Math.pow(2,Z),de=[];for(const Me of this.features.values())Qt(Me,xe,Q,ce)&&de.push(bi(Me,xe,Q,ce));return{features:de}}getFeatures(){return[...this.features.values()]}}function Qt({minX:Ee,minY:Z,maxX:Q,maxY:ce},xe,de,Me){return Ee<(de+1+yt)/xe&&Z<(Me+1+yt)/xe&&Q>(de-yt)/xe&&ce>(Me-yt)/xe}function pi(Ee){const{id:Z,geometry:Q,properties:ce}=Ee;if(!Q)return;if(Q.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:xe,coordinates:de}=Q,Me={id:Z,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Oe=Me.geometry;if(xe==="Point")Pi(de,Oe,Me);else if(xe==="MultiPoint")for(const Pe of de)Pi(Pe,Oe,Me);else if(xe==="LineString")Me.type=2,Mi(de,Oe,Me);else if(xe==="MultiLineString")Me.type=2,fn(de,Oe,Me);else if(xe==="Polygon")Me.type=3,fn(de,Oe,Me,!0);else{if(xe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Me.type=3;for(const Pe of de)fn(Pe,Oe,Me,!0)}return Me}function Pi([Ee,Z],Q,ce){const xe=s.aF(Ee);let de=s.aJ(Z);de=de<0?0:de>1?1:de,Q.push(xe,de),ce.minX=Math.min(ce.minX,xe),ce.minY=Math.min(ce.minY,de),ce.maxX=Math.max(ce.maxX,xe),ce.maxY=Math.max(ce.maxY,de)}function Mi(Ee,Z,Q,ce=!1,xe=!1){const de=[];for(const Me of Ee)Pi(Me,de,Q);Z.push(de),ce&&(function(Me,Oe){let Pe=0;for(let Be=0,gt=Me.length,st=gt-2;Be<gt;st=Be,Be+=2)Pe+=(Me[Be]-Me[st])*(Me[Be+1]+Me[st+1]);if(Pe>0===Oe)for(let Be=0,gt=Me.length;Be<gt/2;Be+=2){const st=Me[Be],Ft=Me[Be+1];Me[Be]=Me[gt-2-Be],Me[Be+1]=Me[gt-1-Be],Me[gt-2-Be]=st,Me[gt-1-Be]=Ft}})(de,xe)}function fn(Ee,Z,Q,ce=!1){for(let xe=0;xe<Ee.length;xe++)Mi(Ee[xe],Z,Q,ce,xe===0)}function bi(Ee,Z,Q,ce){const{id:xe,type:de,geometry:Me,tags:Oe}=Ee,Pe=[];if(de===1)(function(Be,gt,st,Ft,ni){for(let li=0;li<Be.length;li+=2){const ki=Math.round(s.al*(Be[li+0]*gt-st)),ji=Math.round(s.al*(Be[li+1]*gt-Ft));ni.push([ki,ji])}})(Me,Z,Q,ce,Pe);else if(de===2)for(const Be of Me)Dn(Be,Z,Q,ce,Pe);else if(de===3)for(const Be of Me)Un(Be,Z,Q,ce,Pe);return{id:xe,type:de,geometry:Pe,tags:Oe}}function Dn(Ee,Z,Q,ce,xe){const Me=s.al+128;let Oe;for(let Pe=0;Pe<Ee.length-2;Pe+=2){let Be=Math.round(s.al*(Ee[Pe+0]*Z-Q)),gt=Math.round(s.al*(Ee[Pe+1]*Z-ce)),st=Math.round(s.al*(Ee[Pe+2]*Z-Q)),Ft=Math.round(s.al*(Ee[Pe+3]*Z-ce));const ni=st-Be,li=Ft-gt;Be<-128&&st<-128||(Be<-128?(gt+=Math.round(li*((-128-Be)/ni)),Be=-128):st<-128&&(Ft=gt+Math.round(li*((-128-Be)/ni)),st=-128),gt<-128&&Ft<-128||(gt<-128?(Be+=Math.round(ni*((-128-gt)/li)),gt=-128):Ft<-128&&(st=Be+Math.round(ni*((-128-gt)/li)),Ft=-128),Be>=Me&&st>=Me||(Be>=Me?(gt+=Math.round(li*((Me-Be)/ni)),Be=Me):st>=Me&&(Ft=gt+Math.round(li*((Me-Be)/ni)),st=Me),gt>=Me&&Ft>=Me||(gt>=Me?(Be+=Math.round(ni*((Me-gt)/li)),gt=Me):Ft>=Me&&(st=Be+Math.round(ni*((Me-gt)/li)),Ft=Me),Oe&&Be===Oe[Oe.length-1][0]&&gt===Oe[Oe.length-1][1]||(Oe=[[Be,gt]],xe.push(Oe)),Oe.push([st,Ft])))))}}function Un(Ee,Z,Q,ce,xe){const de=(Q-yt)/Z,Me=(ce-yt)/Z,Oe=(Q+1+yt)/Z,Pe=(ce+1+yt)/Z;function Be(Ft,ni){let li=0;return Ft<de?li|=1:Ft>Oe&&(li|=2),ni<Me?li|=4:ni>Pe&&(li|=8),li}let gt=[];for(let Ft=1;Ft<=8;Ft*=2){let ni=Ee[Ee.length-2],li=Ee[Ee.length-1],ki=!(Be(ni,li)&Ft);for(let ji=0;ji<Ee.length;ji+=2){const Si=Ee[ji],yi=Ee[ji+1],Vn=!(Be(Si,yi)&Ft);Vn!==ki&&(8&Ft?gt.push(ni+(Si-ni)*(Pe-li)/(yi-li),Pe):4&Ft?gt.push(ni+(Si-ni)*(Me-li)/(yi-li),Me):2&Ft?gt.push(Oe,li+(yi-li)*(Oe-ni)/(Si-ni)):1&Ft&&gt.push(de,li+(yi-li)*(de-ni)/(Si-ni))),Vn&&gt.push(Si,yi),ni=Si,li=yi,ki=Vn}if(!(Ee=gt).length||Ft===8)break;gt=[]}const st=[];for(let Ft=0;Ft<gt.length;Ft+=2)st.push([Math.round(s.al*(gt[Ft]*Z-Q)),Math.round(s.al*(gt[Ft+1]*Z-ce))]);st.length&&xe.push(st)}function Ht({name:Ee,features:Z},Q){Q.writeStringField(1,Ee),Q.writeVarintField(5,s.al);const ce=new Map,xe=new Map,de={keys:ce,values:xe,feature:null};for(const Me of Z)de.feature=Me,Q.writeMessage(2,mr,de);for(const Me of ce.keys())Q.writeStringField(3,Me);for(const Me of xe.keys())Q.writeMessage(4,ei,Me)}function mr(Ee,Z){const Q=Ee.feature;Q.id!==void 0&&Number.isSafeInteger(+Q.id)&&Z.writeVarintField(1,+Q.id),Q.tags&&Z.writeMessage(2,zn,Ee),Z.writeVarintField(3,Q.type),Z.writeMessage(4,hn,Q)}function zn({keys:Ee,values:Z,feature:Q},ce){for(const xe of Object.keys(Q.tags)){let de=Q.tags[xe];if(de===null)continue;let Me=Ee.get(xe);Me===void 0&&(Me=Ee.size,Ee.set(xe,Me)),ce.writeVarint(Me);const Oe=typeof de;Oe!=="string"&&Oe!=="boolean"&&Oe!=="number"&&(de=JSON.stringify(de));let Pe=Z.get(de);Pe===void 0&&(Pe=Z.size,Z.set(de,Pe)),ce.writeVarint(Pe)}}function Li(Ee,Z){return(Z<<3)+(7&Ee)}function Ei(Ee){return Ee<<1^Ee>>31}function hn(Ee,Z){const{geometry:Q,type:ce}=Ee;let xe=0,de=0;if(ce===1){Z.writeVarint(Li(1,Q.length));for(const Me of Q){const Oe=Me[0]-xe,Pe=Me[1]-de;Z.writeVarint(Ei(Oe)),Z.writeVarint(Ei(Pe)),xe+=Oe,de+=Pe}}else for(const Me of Q){if(Me.length===0)continue;Z.writeVarint(Li(1,1));const Oe=Me.length-(ce===3?1:0);for(let Pe=0;Pe<Oe;Pe++){Pe===1&&Z.writeVarint(Li(2,Oe-1));const Be=Me[Pe][0]-xe,gt=Me[Pe][1]-de;Z.writeVarint(Ei(Be)),Z.writeVarint(Ei(gt)),xe+=Be,de+=gt}ce===3&&Z.writeVarint(Li(7,1))}}function ei(Ee,Z){const Q=typeof Ee;Q==="string"?Z.writeStringField(1,Ee):Q==="boolean"?Z.writeBooleanField(7,Ee):Q==="number"&&(Ee%1!=0?Z.writeDoubleField(3,Ee):Ee<0?Z.writeSVarintField(6,Ee):Z.writeVarintField(5,Ee))}const Wt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},ui=Math.fround||(Vi=new Float32Array(1),Ee=>(Vi[0]=+Ee,Vi[0]));var Vi;class zi{constructor(Z){this.options=Object.assign(Object.create(Wt),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:Q,minZoom:ce,maxZoom:xe}=this.options;Q&&console.time("total time");const de=`prepare ${Z.length} points`;Q&&console.time(de),this.points=Z;const Me=[];for(let Pe=0;Pe<Z.length;Pe++){const Be=Z[Pe];if(!Be.geometry)continue;const[gt,st]=Be.geometry.coordinates,Ft=ui(Zt(gt)),ni=ui(Xt(st));Me.push(Ft,ni,1/0,Pe,-1,1),this.options.reduce&&Me.push(0)}let Oe=this.trees[xe+1]=this._createTree(Me);Q&&console.timeEnd(de);for(let Pe=xe;Pe>=ce;Pe--){const Be=+Date.now();Oe=this.trees[Pe]=this._createTree(this._cluster(Oe,Pe)),Q&&console.log("z%d: %d clusters in %dms",Pe,Oe.numItems,+Date.now()-Be)}return Q&&console.timeEnd("total time"),this}getClusters(Z,Q){let ce=((Z[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,Z[1]));let de=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ce=-180,de=180;else if(ce>de){const st=this.getClusters([ce,xe,180,Me],Q),Ft=this.getClusters([-180,xe,de,Me],Q);return st.concat(Ft)}const Oe=this.trees[this._limitZoom(Q)],Pe=Oe.range(Zt(ce),Xt(Me),Zt(de),Xt(xe)),Be=Oe.data,gt=[];for(const st of Pe){const Ft=this.stride*st;gt.push(Be[Ft+5]>1?$e(Be,Ft,this.clusterProps):this.points[Be[Ft+3]])}return gt}getChildren(Z){const Q=this._getOriginId(Z),ce=this._getOriginZoom(Z),xe="No cluster with the specified id.",de=this.trees[ce];if(!de)throw new Error(xe);const Me=de.data;if(Q*this.stride>=Me.length)throw new Error(xe);const Oe=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Pe=de.within(Me[Q*this.stride],Me[Q*this.stride+1],Oe),Be=[];for(const gt of Pe){const st=gt*this.stride;Me[st+4]===Z&&Be.push(Me[st+5]>1?$e(Me,st,this.clusterProps):this.points[Me[st+3]])}if(Be.length===0)throw new Error(xe);return Be}getLeaves(Z,Q,ce){const xe=[];return this._appendLeaves(xe,Z,Q=Q||10,ce=ce||0,0),xe}getTile(Z,Q,ce){const xe=this.trees[this._limitZoom(Z)],de=Math.pow(2,Z),{extent:Me,radius:Oe}=this.options,Pe=Oe/Me,Be=(ce-Pe)/de,gt=(ce+1+Pe)/de,st={features:[]};return this._addTileFeatures(xe.range((Q-Pe)/de,Be,(Q+1+Pe)/de,gt),xe.data,Q,ce,de,st),Q===0&&this._addTileFeatures(xe.range(1-Pe/de,Be,1,gt),xe.data,de,ce,de,st),Q===de-1&&this._addTileFeatures(xe.range(0,Be,Pe/de,gt),xe.data,-1,ce,de,st),st.features.length?st:null}getClusterExpansionZoom(Z){let Q=this._getOriginZoom(Z)-1;for(;Q<=this.options.maxZoom;){const ce=this.getChildren(Z);if(Q++,ce.length!==1)break;Z=ce[0].properties.cluster_id}return Q}_appendLeaves(Z,Q,ce,xe,de){const Me=this.getChildren(Q);for(const Oe of Me){const Pe=Oe.properties;if(Pe&&Pe.cluster?de+Pe.point_count<=xe?de+=Pe.point_count:de=this._appendLeaves(Z,Pe.cluster_id,ce,xe,de):de<xe?de++:Z.push(Oe),Z.length===ce)break}return de}_createTree(Z){const Q=new s.c4(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<Z.length;ce+=this.stride)Q.add(Z[ce],Z[ce+1]);return Q.finish(),Q.data=Z,Q}_addTileFeatures(Z,Q,ce,xe,de,Me){for(const Oe of Z){const Pe=Oe*this.stride,Be=Q[Pe+5]>1;let gt,st,Ft;if(Be)gt=Ce(Q,Pe,this.clusterProps),st=Q[Pe],Ft=Q[Pe+1];else{const ki=this.points[Q[Pe+3]];gt=ki.properties;const[ji,Si]=ki.geometry.coordinates;st=Zt(ji),Ft=Xt(Si)}const ni={type:1,geometry:[[Math.round(this.options.extent*(st*de-ce)),Math.round(this.options.extent*(Ft*de-xe))]],tags:gt};let li;li=Be||this.options.generateId?Q[Pe+3]:this.points[Q[Pe+3]].id,li!==void 0&&(ni.id=li),Me.features.push(ni)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,Q){const{radius:ce,extent:xe,reduce:de,minPoints:Me}=this.options,Oe=ce/(xe*Math.pow(2,Q)),Pe=Z.data,Be=[],gt=this.stride;for(let st=0;st<Pe.length;st+=gt){if(Pe[st+2]<=Q)continue;Pe[st+2]=Q;const Ft=Pe[st],ni=Pe[st+1],li=Z.within(Pe[st],Pe[st+1],Oe),ki=Pe[st+5];let ji=ki;for(const Si of li){const yi=Si*gt;Pe[yi+2]>Q&&(ji+=Pe[yi+5])}if(ji>ki&&ji>=Me){let Si,yi=Ft*ki,Vn=ni*ki,Nr=-1;const vr=(st/gt<<5)+(Q+1)+this.points.length;for(const xr of li){const Qn=xr*gt;if(Pe[Qn+2]<=Q)continue;Pe[Qn+2]=Q;const on=Pe[Qn+5];yi+=Pe[Qn]*on,Vn+=Pe[Qn+1]*on,Pe[Qn+4]=vr,de&&(Si||(Si=this._map(Pe,st,!0),Nr=this.clusterProps.length,this.clusterProps.push(Si)),de(Si,this._map(Pe,Qn)))}Pe[st+4]=vr,Be.push(yi/ji,Vn/ji,1/0,vr,-1,ji),de&&Be.push(Nr)}else{for(let Si=0;Si<gt;Si++)Be.push(Pe[st+Si]);if(ji>1)for(const Si of li){const yi=Si*gt;if(!(Pe[yi+2]<=Q)){Pe[yi+2]=Q;for(let Vn=0;Vn<gt;Vn++)Be.push(Pe[yi+Vn])}}}}return Be}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,Q,ce){if(Z[Q+5]>1){const Me=this.clusterProps[Z[Q+6]];return ce?Object.assign({},Me):Me}const xe=this.points[Z[Q+3]].properties,de=this.options.map(xe);return ce&&de===xe?Object.assign({},de):de}}function $e(Ee,Z,Q){return{type:"Feature",id:Ee[Z+3],properties:Ce(Ee,Z,Q),geometry:{type:"Point",coordinates:[(ce=Ee[Z],360*(ce-.5)),rt(Ee[Z+1])]}};var ce}function Ce(Ee,Z,Q){const ce=Ee[Z+5],xe=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,de=Ee[Z+6],Me=de===-1?{}:Object.assign({},Q[de]);return Object.assign(Me,{cluster:!0,cluster_id:Ee[Z+3],point_count:ce,point_count_abbreviated:xe})}function Zt(Ee){return Ee/360+.5}function Xt(Ee){const Z=Math.sin(Ee*Math.PI/180),Q=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Q<0?0:Q>1?1:Q}function rt(Ee){const Z=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function ri(Ee,Z,Q,ce){let xe=ce;const de=Z+(Q-Z>>1);let Me,Oe=Q-Z;const Pe=Ee[Z],Be=Ee[Z+1],gt=Ee[Q],st=Ee[Q+1];for(let Ft=Z+3;Ft<Q;Ft+=3){const ni=wi(Ee[Ft],Ee[Ft+1],Pe,Be,gt,st);if(ni>xe)Me=Ft,xe=ni;else if(ni===xe){const li=Math.abs(Ft-de);li<Oe&&(Me=Ft,Oe=li)}}xe>ce&&(Me-Z>3&&ri(Ee,Z,Me,ce),Ee[Me+2]=xe,Q-Me>3&&ri(Ee,Me,Q,ce))}function wi(Ee,Z,Q,ce,xe,de){let Me=xe-Q,Oe=de-ce;if(Me!==0||Oe!==0){const Pe=((Ee-Q)*Me+(Z-ce)*Oe)/(Me*Me+Oe*Oe);Pe>1?(Q=xe,ce=de):Pe>0&&(Q+=Me*Pe,ce+=Oe*Pe)}return Me=Ee-Q,Oe=Z-ce,Me*Me+Oe*Oe}function gi(Ee,Z,Q,ce){const xe={id:Ee??null,type:Z,geometry:Q,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")Yt(xe,Q);else if(Z==="Polygon")Yt(xe,Q[0]);else if(Z==="MultiLineString")for(const de of Q)Yt(xe,de);else if(Z==="MultiPolygon")for(const de of Q)Yt(xe,de[0]);return xe}function Yt(Ee,Z){for(let Q=0;Q<Z.length;Q+=3)Ee.minX=Math.min(Ee.minX,Z[Q]),Ee.minY=Math.min(Ee.minY,Z[Q+1]),Ee.maxX=Math.max(Ee.maxX,Z[Q]),Ee.maxY=Math.max(Ee.maxY,Z[Q+1])}function Zi(Ee,Z,Q,ce){if(!Z.geometry)return;const xe=Z.geometry.coordinates;if(xe&&xe.length===0)return;const de=Z.geometry.type,Me=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let Oe=[],Pe=Z.id;if(Q.promoteId?Pe=Z.properties[Q.promoteId]:Q.generateId&&(Pe=ce||0),de==="Point")qi(xe,Oe);else if(de==="MultiPoint")for(const Be of xe)qi(Be,Oe);else if(de==="LineString")$i(xe,Oe,Me,!1);else if(de==="MultiLineString"){if(Q.lineMetrics){for(const Be of xe)Oe=[],$i(Be,Oe,Me,!1),Ee.push(gi(Pe,"LineString",Oe,Z.properties));return}Xi(xe,Oe,Me,!1)}else if(de==="Polygon")Xi(xe,Oe,Me,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const Be of Z.geometry.geometries)Zi(Ee,{id:Pe,geometry:Be,properties:Z.properties},Q,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Be of xe){const gt=[];Xi(Be,gt,Me,!0),Oe.push(gt)}}Ee.push(gi(Pe,de,Oe,Z.properties))}function qi(Ee,Z){Z.push(Di(Ee[0]),gr(Ee[1]),0)}function $i(Ee,Z,Q,ce){let xe,de,Me=0;for(let Pe=0;Pe<Ee.length;Pe++){const Be=Di(Ee[Pe][0]),gt=gr(Ee[Pe][1]);Z.push(Be,gt,0),Pe>0&&(Me+=ce?(xe*gt-Be*de)/2:Math.sqrt(Math.pow(Be-xe,2)+Math.pow(gt-de,2))),xe=Be,de=gt}const Oe=Z.length-3;Z[2]=1,ri(Z,0,Oe,Q),Z[Oe+2]=1,Z.size=Math.abs(Me),Z.start=0,Z.end=Z.size}function Xi(Ee,Z,Q,ce){for(let xe=0;xe<Ee.length;xe++){const de=[];$i(Ee[xe],de,Q,ce),Z.push(de)}}function Di(Ee){return Ee/360+.5}function gr(Ee){const Z=Math.sin(Ee*Math.PI/180),Q=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Q<0?0:Q>1?1:Q}function Er(Ee,Z,Q,ce,xe,de,Me,Oe){if(ce/=Z,de>=(Q/=Z)&&Me<ce)return Ee;if(Me<Q||de>=ce)return null;const Pe=[];for(const Be of Ee){const gt=Be.geometry;let st=Be.type;const Ft=xe===0?Be.minX:Be.minY,ni=xe===0?Be.maxX:Be.maxY;if(Ft>=Q&&ni<ce){Pe.push(Be);continue}if(ni<Q||Ft>=ce)continue;let li=[];if(st==="Point"||st==="MultiPoint")Cl(gt,li,Q,ce,xe);else if(st==="LineString")Ks(gt,li,Q,ce,xe,!1,Oe.lineMetrics);else if(st==="MultiLineString")Qs(gt,li,Q,ce,xe,!1);else if(st==="Polygon")Qs(gt,li,Q,ce,xe,!0);else if(st==="MultiPolygon")for(const ki of gt){const ji=[];Qs(ki,ji,Q,ce,xe,!0),ji.length&&li.push(ji)}if(li.length){if(Oe.lineMetrics&&st==="LineString"){for(const ki of li)Pe.push(gi(Be.id,st,ki,Be.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(li.length===1?(st="LineString",li=li[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=li.length===3?"Point":"MultiPoint"),Pe.push(gi(Be.id,st,li,Be.tags))}}return Pe.length?Pe:null}function Cl(Ee,Z,Q,ce,xe){for(let de=0;de<Ee.length;de+=3){const Me=Ee[de+xe];Me>=Q&&Me<=ce&&ha(Z,Ee[de],Ee[de+1],Ee[de+2])}}function Ks(Ee,Z,Q,ce,xe,de,Me){let Oe=mo(Ee);const Pe=xe===0?ea:da;let Be,gt,st=Ee.start;for(let ji=0;ji<Ee.length-3;ji+=3){const Si=Ee[ji],yi=Ee[ji+1],Vn=Ee[ji+2],Nr=Ee[ji+3],vr=Ee[ji+4],xr=xe===0?Si:yi,Qn=xe===0?Nr:vr;let on=!1;Me&&(Be=Math.sqrt(Math.pow(Si-Nr,2)+Math.pow(yi-vr,2))),xr<Q?Qn>Q&&(gt=Pe(Oe,Si,yi,Nr,vr,Q),Me&&(Oe.start=st+Be*gt)):xr>ce?Qn<ce&&(gt=Pe(Oe,Si,yi,Nr,vr,ce),Me&&(Oe.start=st+Be*gt)):ha(Oe,Si,yi,Vn),Qn<Q&&xr>=Q&&(gt=Pe(Oe,Si,yi,Nr,vr,Q),on=!0),Qn>ce&&xr<=ce&&(gt=Pe(Oe,Si,yi,Nr,vr,ce),on=!0),!de&&on&&(Me&&(Oe.end=st+Be*gt),Z.push(Oe),Oe=mo(Ee)),Me&&(st+=Be)}let Ft=Ee.length-3;const ni=Ee[Ft],li=Ee[Ft+1],ki=xe===0?ni:li;ki>=Q&&ki<=ce&&ha(Oe,ni,li,Ee[Ft+2]),Ft=Oe.length-3,de&&Ft>=3&&(Oe[Ft]!==Oe[0]||Oe[Ft+1]!==Oe[1])&&ha(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&Z.push(Oe)}function mo(Ee){const Z=[];return Z.size=Ee.size,Z.start=Ee.start,Z.end=Ee.end,Z}function Qs(Ee,Z,Q,ce,xe,de){for(const Me of Ee)Ks(Me,Z,Q,ce,xe,de,!1)}function ha(Ee,Z,Q,ce){Ee.push(Z,Q,ce)}function ea(Ee,Z,Q,ce,xe,de){const Me=(de-Z)/(ce-Z);return ha(Ee,de,Q+(xe-Q)*Me,1),Me}function da(Ee,Z,Q,ce,xe,de){const Me=(de-Q)/(xe-Q);return ha(Ee,Z+(ce-Z)*Me,de,1),Me}function gs(Ee,Z){const Q=[];for(let ce=0;ce<Ee.length;ce++){const xe=Ee[ce],de=xe.type;let Me;if(de==="Point"||de==="MultiPoint"||de==="LineString")Me=fa(xe.geometry,Z);else if(de==="MultiLineString"||de==="Polygon"){Me=[];for(const Oe of xe.geometry)Me.push(fa(Oe,Z))}else if(de==="MultiPolygon"){Me=[];for(const Oe of xe.geometry){const Pe=[];for(const Be of Oe)Pe.push(fa(Be,Z));Me.push(Pe)}}Q.push(gi(xe.id,de,Me,xe.tags))}return Q}function fa(Ee,Z){const Q=[];Q.size=Ee.size,Ee.start!==void 0&&(Q.start=Ee.start,Q.end=Ee.end);for(let ce=0;ce<Ee.length;ce+=3)Q.push(Ee[ce]+Z,Ee[ce+1],Ee[ce+2]);return Q}function nl(Ee,Z){if(Ee.transformed)return Ee;const Q=1<<Ee.z,ce=Ee.x,xe=Ee.y;for(const de of Ee.features){const Me=de.geometry,Oe=de.type;if(de.geometry=[],Oe===1)for(let Pe=0;Pe<Me.length;Pe+=2)de.geometry.push($n(Me[Pe],Me[Pe+1],Z,Q,ce,xe));else for(let Pe=0;Pe<Me.length;Pe++){const Be=[];for(let gt=0;gt<Me[Pe].length;gt+=2)Be.push($n(Me[Pe][gt],Me[Pe][gt+1],Z,Q,ce,xe));de.geometry.push(Be)}}return Ee.transformed=!0,Ee}function $n(Ee,Z,Q,ce,xe,de){return[Math.round(Q*(Ee*ce-xe)),Math.round(Q*(Z*ce-de))]}function yr(Ee,Z,Q,ce,xe){const de=Z===xe.maxZoom?0:xe.tolerance/((1<<Z)*xe.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:Ee.length,source:null,x:Q,y:ce,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Oe of Ee)lc(Me,Oe,de,xe);return Me}function lc(Ee,Z,Q,ce){const xe=Z.geometry,de=Z.type,Me=[];if(Ee.minX=Math.min(Ee.minX,Z.minX),Ee.minY=Math.min(Ee.minY,Z.minY),Ee.maxX=Math.max(Ee.maxX,Z.maxX),Ee.maxY=Math.max(Ee.maxY,Z.maxY),de==="Point"||de==="MultiPoint")for(let Oe=0;Oe<xe.length;Oe+=3)Me.push(xe[Oe],xe[Oe+1]),Ee.numPoints++,Ee.numSimplified++;else if(de==="LineString")Rl(Me,xe,Ee,Q,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let Oe=0;Oe<xe.length;Oe++)Rl(Me,xe[Oe],Ee,Q,de==="Polygon",Oe===0);else if(de==="MultiPolygon")for(let Oe=0;Oe<xe.length;Oe++){const Pe=xe[Oe];for(let Be=0;Be<Pe.length;Be++)Rl(Me,Pe[Be],Ee,Q,!0,Be===0)}if(Me.length){let Oe=Z.tags||null;if(de==="LineString"&&ce.lineMetrics){Oe={};for(const Be in Z.tags)Oe[Be]=Z.tags[Be];Oe.mapbox_clip_start=xe.start/xe.size,Oe.mapbox_clip_end=xe.end/xe.size}const Pe={geometry:Me,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Oe};Z.id!==null&&(Pe.id=Z.id),Ee.features.push(Pe)}}function Rl(Ee,Z,Q,ce,xe,de){const Me=ce*ce;if(ce>0&&Z.size<(xe?Me:ce))return void(Q.numPoints+=Z.length/3);const Oe=[];for(let Pe=0;Pe<Z.length;Pe+=3)(ce===0||Z[Pe+2]>Me)&&(Q.numSimplified++,Oe.push(Z[Pe],Z[Pe+1])),Q.numPoints++;xe&&(function(Pe,Be){let gt=0;for(let st=0,Ft=Pe.length,ni=Ft-2;st<Ft;ni=st,st+=2)gt+=(Pe[st]-Pe[ni])*(Pe[st+1]+Pe[ni+1]);if(gt>0===Be)for(let st=0,Ft=Pe.length;st<Ft/2;st+=2){const ni=Pe[st],li=Pe[st+1];Pe[st]=Pe[Ft-2-st],Pe[st+1]=Pe[Ft-1-st],Pe[Ft-2-st]=ni,Pe[Ft-1-st]=li}})(Oe,de),Ee.push(Oe)}const ts={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class De{constructor(Z,Q){const ce=(Q=this.options=(function(de,Me){for(const Oe in Me)de[Oe]=Me[Oe];return de})(Object.create(ts),Q)).debug;if(ce&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=(function(de,Me){const Oe=[];if(de.type==="FeatureCollection")for(let Pe=0;Pe<de.features.length;Pe++)Zi(Oe,de.features[Pe],Me,Pe);else Zi(Oe,de.type==="Feature"?de:{geometry:de},Me);return Oe})(Z,Q);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=(function(de,Me){const Oe=Me.buffer/Me.extent;let Pe=de;const Be=Er(de,1,-1-Oe,Oe,0,-1,2,Me),gt=Er(de,1,1-Oe,2+Oe,0,-1,2,Me);return(Be||gt)&&(Pe=Er(de,1,-Oe,1+Oe,0,-1,2,Me)||[],Be&&(Pe=gs(Be,1).concat(Pe)),gt&&(Pe=Pe.concat(gs(gt,-1)))),Pe})(xe,Q),xe.length&&this.splitTile(xe,0,0,0),ce&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,Q,ce,xe,de,Me,Oe){const Pe=[Z,Q,ce,xe],Be=this.options,gt=Be.debug;for(;Pe.length;){xe=Pe.pop(),ce=Pe.pop(),Q=Pe.pop(),Z=Pe.pop();const st=1<<Q,Ft=Rt(Q,ce,xe);let ni=this.tiles[Ft];if(!ni&&(gt>1&&console.time("creation"),ni=this.tiles[Ft]=yr(Z,Q,ce,xe,Be),this.tileCoords.push({z:Q,x:ce,y:xe}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ce,xe,ni.numFeatures,ni.numPoints,ni.numSimplified),console.timeEnd("creation"));const on=`z${Q}`;this.stats[on]=(this.stats[on]||0)+1,this.total++}if(ni.source=Z,de==null){if(Q===Be.indexMaxZoom||ni.numPoints<=Be.indexMaxPoints)continue}else{if(Q===Be.maxZoom||Q===de)continue;if(de!=null){const on=de-Q;if(ce!==Me>>on||xe!==Oe>>on)continue}}if(ni.source=null,Z.length===0)continue;gt>1&&console.time("clipping");const li=.5*Be.buffer/Be.extent,ki=.5-li,ji=.5+li,Si=1+li;let yi=null,Vn=null,Nr=null,vr=null,xr=Er(Z,st,ce-li,ce+ji,0,ni.minX,ni.maxX,Be),Qn=Er(Z,st,ce+ki,ce+Si,0,ni.minX,ni.maxX,Be);Z=null,xr&&(yi=Er(xr,st,xe-li,xe+ji,1,ni.minY,ni.maxY,Be),Vn=Er(xr,st,xe+ki,xe+Si,1,ni.minY,ni.maxY,Be),xr=null),Qn&&(Nr=Er(Qn,st,xe-li,xe+ji,1,ni.minY,ni.maxY,Be),vr=Er(Qn,st,xe+ki,xe+Si,1,ni.minY,ni.maxY,Be),Qn=null),gt>1&&console.timeEnd("clipping"),Pe.push(yi||[],Q+1,2*ce,2*xe),Pe.push(Vn||[],Q+1,2*ce,2*xe+1),Pe.push(Nr||[],Q+1,2*ce+1,2*xe),Pe.push(vr||[],Q+1,2*ce+1,2*xe+1)}}getTile(Z,Q,ce){Z=+Z,Q=+Q,ce=+ce;const xe=this.options,{extent:de,debug:Me}=xe;if(Z<0||Z>24)return null;const Oe=1<<Z,Pe=Rt(Z,Q=Q+Oe&Oe-1,ce);if(this.tiles[Pe])return nl(this.tiles[Pe],de);Me>1&&console.log("drilling down to z%d-%d-%d",Z,Q,ce);let Be,gt=Z,st=Q,Ft=ce;for(;!Be&&gt>0;)gt--,st>>=1,Ft>>=1,Be=this.tiles[Rt(gt,st,Ft)];return Be&&Be.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",gt,st,Ft),console.time("drilling down")),this.splitTile(Be.source,gt,st,Ft,Z,Q,ce),Me>1&&console.timeEnd("drilling down"),this.tiles[Pe]?nl(this.tiles[Pe],de):null):null}}function Rt(Ee,Z,Q){return 32*((1<<Ee)*Q+Z)+Ee}function Ae(Ee,Z){const Q=Ee.tileID.canonical;if(!this._geoJSONIndex)return void Z(null,null);const ce=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!ce)return void Z(null,null);const xe=Be=>Be.tags&&"3d_elevation_id"in Be.tags&&"source"in Be.tags&&Be.tags.source==="elevation",de=ce.features.filter(Be=>xe(Be));let Me={_geojsonTileLayer:ce.features};de.length>0&&(Me={_geojsonTileLayer:ce.features.filter(Be=>!xe(Be)),hd_road_elevation:de});const Oe=new _t(Me),Pe=(function(Be){const gt=new s.bt;for(const st of Object.keys(Be))gt.writeMessage(3,Ht,{name:st,features:Be[st]});return gt.finish()})(Me).buffer;Z(null,{vectorTile:Oe,rawData:Pe})}class Ot extends zt{constructor(Z,Q,ce,xe,de,Me,Oe){super(Z,Q,ce,xe,de,Ae,Oe),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new Nt}loadData(Z,Q){const ce=Z&&Z.request,xe=ce&&ce.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Z,(de,Me)=>{if(de||!Me)return Q(de);if(typeof Me!="object")return Q(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{try{if(Z.filter){const Pe=s.U(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(Be=>`${Be.key}: ${Be.message}`).join(", "));Me.features=Me.features.filter(Be=>Pe.value.evaluate({zoom:0},Be))}Z.dynamic?(Me.type==="Feature"&&(Me={type:"FeatureCollection",features:[Me]}),Z.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Me.features,this.loaded),Z.cluster&&(Me.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Z.cluster?new zi((function({superclusterOptions:Pe,clusterProperties:Be}){if(!Be||!Pe)return Pe;const gt={},st={},Ft={accumulated:null,zoom:0},ni={properties:null},li=Object.keys(Be);for(const ki of li){const[ji,Si]=Be[ki],yi=s.U(Si),Vn=s.U(typeof ji=="string"?[ji,["accumulated"],["get",ki]]:ji);gt[ki]=yi.value,st[ki]=Vn.value}return Pe.map=ki=>{ni.properties=ki;const ji={};for(const Si of li)ji[Si]=gt[Si].evaluate(Ft,ni);return ji},Pe.reduce=(ki,ji)=>{ni.properties=ji;for(const Si of li)Ft.accumulated=ki[Si],ki[Si]=st[Si].evaluate(Ft,ni)},Pe})(Z)).load(Me.features):Z.dynamic?this._dynamicIndex:(function(Pe,Be){return new De(Pe,Be)})(Me,Z.geojsonVtOptions)}catch(Pe){return Q(Pe)}const Oe={};if(xe){const Pe=P(ce);Pe&&(Oe.resourceTiming={},Oe.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Pe)))}Q(null,Oe)}})}reloadTile(Z,Q){const ce=this.loaded;return ce&&ce[Z.uid]?Z.partial?Q(null,void 0):super.reloadTile(Z,Q):this.loadTile(Z,Q)}loadGeoJSON(Z,Q){if(Z.request)s.m(Z.request,Q);else{if(typeof Z.data!="string")return Q(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return Q(null,JSON.parse(Z.data))}catch{return Q(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Z,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ce){Q(ce)}}getClusterChildren(Z,Q){try{Q(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ce){Q(ce)}}getClusterLeaves(Z,Q){try{Q(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ce){Q(ce)}}}class _i{constructor(Z,Q,ce){this.tileID=new s.aQ(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=Q,this.worldview=ce}parse(Z,Q,ce,xe){this.status="parsing";const de=new s.aQ(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Me=[],Oe=Q.familiesBySource[ce.source],Pe=new s.fn(de,ce.promoteId);Pe.bucketLayerIDs=[],Pe.is3DTile=!0,s.fC(Z).then(Be=>{if(!Be)return xe(new Error("Could not parse tile"));const gt=Be.json.extensionsUsed&&Be.json.extensionsUsed.includes("MAPBOX_mesh_features")||Be.json.asset.extras&&Be.json.asset.extras.MAPBOX_mesh_features,st=Be.json.extensionsUsed&&Be.json.extensionsUsed.includes("EXT_meshopt_compression"),Ft=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const ni in Oe)for(const li of Oe[ni]){const ki=li[0];Pe.bucketLayerIDs.push(li.map(yi=>s.B(yi.id,yi.scope))),ki.recalculate(Ft,[]);const ji=s.fD(Be,1/s.d7(ce.tileID.canonical)),Si=new s.fE(li,ji,de,gt,st,this.brightness,Pe,this.worldview);gt||(Si.needsUpload=!0),Me.push(Si),Si.evaluate(ki)}this.status="done",xe(null,{buckets:Me,featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Be=>xe(new Error(Be.message)))}}class Cn{constructor(Z,Q,ce,xe,de,Me,Oe,Pe){this.actor=Z,this.layerIndex=Q,this.availableImages=ce,this.availableModels=xe,this.brightness=Oe,this.loading={},this.loaded={},this.worldview=Pe}loadTile(Z,Q){const ce=Z.uid,xe=this.loading[ce]=new _i(Z,this.brightness,this.worldview);s.bu(Z.request,(de,Me)=>{const Oe=!this.loading[ce];return delete this.loading[ce],Oe||de?(xe.status="done",Oe||(this.loaded[ce]=xe),Q(de)):Me&&Me.byteLength!==0?void xe.parse(Me,this.layerIndex,Z,(Pe,Be)=>{xe.status="done",this.loaded=this.loaded||{},this.loaded[ce]=xe,Pe||!Be?Q(Pe):Q(null,Be)}):(xe.status="done",this.loaded[ce]=xe,Q())})}reloadTile(Z,Q){const ce=this.loaded,xe=Z.uid;if(ce&&ce[xe]){const de=ce[xe];de.projection=Z.projection,de.brightness=Z.brightness;const Me=(Oe,Pe)=>{de.reloadCallback&&(delete de.reloadCallback,this.loadTile(Z,Q)),Q(Oe,Pe)};de.status==="parsing"?de.reloadCallback=Me:de.status==="done"&&this.loadTile(Z,Q)}}abortTile(Z,Q){const ce=Z.uid;this.loading[ce]&&delete this.loading[ce],Q()}removeTile(Z,Q){const ce=this.loaded,xe=Z.uid;ce&&ce[xe]&&delete ce[xe],Q()}}class ti{constructor(Z){this.self=Z,this.actor=new s.fG(Z,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cm({name:"mercator"}),this.workerSourceTypes={vector:zt,geojson:Ot,"raster-dem":pt,"raster-array":Et,"batched-model":Cn},this.workerSources={},this.self.registerWorkerSource=(Q,ce)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=ce},this.self.registerRTLTextPlugin=Q=>{if(s.fH.isParsed())throw new Error("RTL text plugin already registered.");s.fH.setState({pluginStatus:s.fI.parsed,pluginURL:s.fH.getPluginURL()}),s.fH.applyArabicShaping=Q.applyArabicShaping,s.fH.processBidirectionalText=Q.processBidirectionalText,s.fH.processStyledBidirectionalText=Q.processStyledBidirectionalText;for(const ce of this.rtlPluginParsingListeners)ce(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Z,Q,ce){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.availableModels[Z],delete this.workerSources[Z],ce()}checkIfReady(Z,Q,ce){ce()}setReferrer(Z,Q){this.referrer=Q}spriteLoaded(Z,Q){this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={});const{scope:ce,isLoaded:xe}=Q;if(this.isSpriteLoaded[Z][ce]=xe,this.workerSources[Z]&&this.workerSources[Z][ce])for(const de in this.workerSources[Z][ce]){const Me=this.workerSources[Z][ce][de];for(const Oe in Me){const Pe=Me[Oe];Pe instanceof zt&&(Pe.isSpriteLoaded=xe,Pe.fire(new s.z("isSpriteLoaded")))}}}setImages(Z,Q,ce){this.availableImages[Z]||(this.availableImages[Z]={});const{scope:xe,images:de}=Q;if(this.availableImages[Z][xe]=de,this.workerSources[Z]&&this.workerSources[Z][xe]){for(const Me in this.workerSources[Z][xe]){const Oe=this.workerSources[Z][xe][Me];for(const Pe in Oe)Oe[Pe].availableImages=de}ce()}else ce()}setModels(Z,{scope:Q,models:ce},xe){if(this.availableModels[Z]||(this.availableModels[Z]={}),this.availableModels[Z][Q]=ce,this.workerSources[Z]&&this.workerSources[Z][Q]){for(const de in this.workerSources[Z][Q]){const Me=this.workerSources[Z][Q][de];for(const Oe in Me)Me[Oe].availableModels=ce}xe()}else xe()}setProjection(Z,Q){this.projections[Z]=s.cm(Q)}setBrightness(Z,Q,ce){this.brightness=Q,ce()}setWorldview(Z,Q,ce){this.worldview=Q,ce()}setLayers(Z,Q,ce){this.getLayerIndex(Z,Q.scope).replace(Q.layers,Q.options),ce()}updateLayers(Z,Q,ce){this.getLayerIndex(Z,Q.scope).update(Q.layers,Q.removedIds,Q.options),ce()}loadTile(Z,Q,ce){Q.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Q.type,Q.source,Q.scope).loadTile(Q,ce)}decodeRasterArray(Z,Q,ce){this.getWorkerSource(Z,Q.type,Q.source,Q.scope).decodeRasterArray(Q,ce)}reloadTile(Z,Q,ce){Q.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Q.type,Q.source,Q.scope).reloadTile(Q,ce)}abortTile(Z,Q,ce){this.getWorkerSource(Z,Q.type,Q.source,Q.scope).abortTile(Q,ce)}removeTile(Z,Q,ce){this.getWorkerSource(Z,Q.type,Q.source,Q.scope).removeTile(Q,ce)}removeSource(Z,Q,ce){if(!(this.workerSources[Z]&&this.workerSources[Z][Q.scope]&&this.workerSources[Z][Q.scope][Q.type]&&this.workerSources[Z][Q.scope][Q.type][Q.source]))return;const xe=this.workerSources[Z][Q.scope][Q.type][Q.source];delete this.workerSources[Z][Q.scope][Q.type][Q.source],xe.removeSource!==void 0?xe.removeSource(Q,ce):ce()}loadWorkerSource(Z,Q,ce){try{this.self.importScripts(Q.url),ce()}catch(xe){ce(xe)}}syncRTLPluginState(Z,Q,ce){if(s.fH.isParsed())ce(null,!0);else if(s.fH.isParsing())this.rtlPluginParsingListeners.push(ce);else try{s.fH.setState(Q);const xe=s.fH.getPluginURL();!s.fH.isLoaded()||s.fH.isParsed()||s.fH.isParsing()||xe==null||(s.fH.setState({pluginStatus:s.fI.parsing,pluginURL:s.fH.getPluginURL()}),this.self.importScripts(xe),s.fH.isParsed()?ce(null,!0):this.rtlPluginParsingListeners.push(ce))}catch(xe){ce(xe)}}setDracoUrl(Z,Q){this.dracoUrl=Q}getAvailableImages(Z,Q){this.availableImages[Z]||(this.availableImages[Z]={});let ce=this.availableImages[Z][Q];return ce||(ce=[]),ce}getAvailableModels(Z,Q){this.availableModels[Z]||(this.availableModels[Z]={});let ce=this.availableModels[Z][Q];return ce||(ce={}),ce}getLayerIndex(Z,Q){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let ce=this.layerIndexes[Z][Q];return ce||(ce=this.layerIndexes[Z][Q]=new V,ce.scope=Q),ce}getWorkerSource(Z,Q,ce,xe){const de=this.workerSources;return de[Z]||(de[Z]={}),de[Z][xe]||(de[Z][xe]={}),de[Z][xe][Q]||(de[Z][xe][Q]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),de[Z][xe][Q][ce]||(de[Z][xe][Q][ce]=new this.workerSourceTypes[Q]({send:(Me,Oe,Pe,Be,gt,st)=>this.actor.send(Me,Oe,Pe,Z,gt,st),scheduler:this.actor.scheduler},this.getLayerIndex(Z,xe),this.getAvailableImages(Z,xe),this.getAvailableModels(Z,xe),this.isSpriteLoaded[Z][xe],void 0,this.brightness,this.worldview)),de[Z][xe][Q][ce]}rasterizeImagesWorker(Z,Q,ce){const xe=new Map;for(const[de,{image:Me,imageVariant:Oe}]of Q.tasks.entries()){const Pe=this.imageRasterizer.rasterize(Oe,Me,Q.scope,Z);xe.set(de,Pe)}ce(void 0,xe)}removeRasterizedImages(Z,Q,ce){this.imageRasterizer.removeImagesFromCacheByIds(Q.imageIds,Q.scope,Z),ce()}enforceCacheSizeLimit(Z,Q){s.fJ(Q)}getWorkerPerformanceMetrics(Z,Q,ce){ce(void 0,void 0)}}return s.fF(self)&&(self.worker=new ti(self)),ti}),m(["./shared"],function(s){var P="3.18.1";const C={create:"create",load:"load",fullLoad:"fullLoad"},F={mark(f){performance.mark(f)},measure(f,n,u){performance.measure(f,n,u)}};function O(f){const n=f.name.split("?")[0];return s.a(n)&&n.includes("mapbox-gl.js")?"javascript":s.a(n)&&n.includes("mapbox-gl.css")?"css":s.b(n)?"fontRange":s.c(n)?"sprite":s.i(n)?"style":s.d(n)?"tilejson":"other"}var V,J={},ee=(function(){if(V)return J;function f(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,w,E=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(E);try{w=new Worker(I),b=!0}catch{b=!1}return w&&w.terminate(),URL.revokeObjectURL(I),b})()?(function(){var b=document.createElement("canvas");b.width=b.height=1;var w=b.getContext("2d");if(!w)return!1;var E=w.getImageData(0,0,1,1);return E&&E.width===b.width})()?(u[y=p&&p.failIfMajorPerformanceCaveat]===void 0&&(u[y]=(function(b){var w,E=(function(I){var R=document.createElement("canvas"),L=Object.create(f.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=I,R.getContext("webgl2",L)})(b);if(!E)return!1;try{w=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!w||E.isContextLost())&&(E.shaderSource(w,"void main() {}"),E.compileShader(w),E.getShaderParameter(w,E.COMPILE_STATUS)===!0)})(y)),u[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}V=1,J.supported=f,J.notSupportedReason=n;var u={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},J})();function se(f,n,u){const p=document.createElement(f);return n!=null&&(p.className=n),u&&u.appendChild(p),p}function fe(f,n,u){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(n))p.setAttributeNS(null,y,String(n[y]));return u&&u.appendChild(p),p}const le=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ie=le&&le.userSelect!==void 0?"userSelect":"WebkitUserSelect";let it;function Ve(){le&&ie&&(it=le[ie],le[ie]="none")}function Ne(){le&&ie&&(le[ie]=it)}function Re(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Re,!0)}function Ye(){window.addEventListener("click",Re,!0),window.setTimeout(()=>{window.removeEventListener("click",Re,!0)},0)}function zt(f,n){const u=f.getBoundingClientRect();return Et(f,u,n)}function pt(f,n){const u=f.getBoundingClientRect(),p=[];for(let y=0;y<n.length;y++)p.push(Et(f,u,n[y]));return p}function St(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function Et(f,n,u){const p=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new s.P((u.clientX-n.left)*p,(u.clientY-n.top)*p)}const Dt="01",Qe="NO_ACCESS_TOKEN";class ht{constructor(n,u,p){this._transformRequestFn=n,this._customAccessToken=u,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=(function(){let u="";for(let p=0;p<10;p++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Dt,u].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,u){return this._transformRequestFn&&this._transformRequestFn(n,u)||{url:n}}normalizeStyleURL(n,u){if(!s.h(n))return n;const p=yt(n);return p.params.push(`sdk=js-${P}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||u)}normalizeGlyphsURL(n,u){if(!s.h(n))return n;const p=yt(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||u)}normalizeModelURL(n,u){if(!s.h(n))return n;const p=yt(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||u)}normalizeSourceURL(n,u,p,y){if(!s.h(n))return n;const b=yt(n);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||u)}normalizeIconsetURL(n,u){const p=yt(n);return s.h(n)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||u)):Nt(p)}normalizeSpriteURL(n,u,p,y){const b=yt(n);return s.h(n)?(b.path=`/styles/v1${b.path}/sprite${u}${p}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${u}${p}`,Nt(b))}normalizeTileURL(n,u,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!s.h(n))return n;const y=yt(n);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||p&&y.authority!=="raster"&&p===512?"@2x":""}${s.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${s.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${s.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${s.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||(function(w){for(const E of w){const I=E.match(/^access_token=(.*)$/);if(I)return I[1]}return null})(y.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(n,u){const p=yt(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${p.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return u&&(b=b.filter(w=>!w.match(/^access_token=/))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(n,u){const p=!!u&&s.h(u),y=[];for(const b of n.tiles||[])s.j(b)?y.push(this.canonicalizeTileURL(b,p)):y.push(b);return y}_makeAPIURL(n,u){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=yt(s.e.API_URL);if(n.protocol=y.protocol,n.authority=y.authority,n.protocol==="http"){const b=n.params.indexOf("secure");b>=0&&n.params.splice(b,1)}if(y.path!=="/"&&(n.path=`${y.path}${n.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Nt(n);if(u=u||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter(b=>b.indexOf("access_token")===-1),n.params.push(`access_token=${u||""}`),Nt(n)}}const _t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yt(f){const n=f.match(_t);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Nt(f){const n=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${n}`}const Qt="mapbox.eventData";function pi(f){if(!f)return null;const n=f.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(s.l(n[1]))}catch{return null}}class Pi{constructor(n){this.type=n,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const u=pi(s.e.ACCESS_TOKEN);let p="";return p=u&&u.u?s.f(u.u):s.e.ACCESS_TOKEN||"",n?`${Qt}.${n}:${p}`:`${Qt}:${p}`}fetchEventData(){const n=s.s("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp");if(n)try{const b=localStorage.getItem(u);b&&(this.eventData=JSON.parse(b));const w=localStorage.getItem(p);w&&(this.anonId=w);const E=localStorage.getItem(y);E&&(this.anonIdTimestamp=Number(E));const I=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<I)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const n=s.s("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp"),b=this.anonId,w=this.anonIdTimestamp;if(n&&b)try{localStorage.setItem(p,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(u,JSON.stringify(this.eventData)),w&&localStorage.setItem(y,w.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,u,p,y){if(!s.e.EVENTS_URL)return;const b=yt(s.e.EVENTS_URL);b.params.push(`access_token=${y||s.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(n).toISOString()},E=u?Object.assign(w,u):w,I={url:Nt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=s.p(I,R=>{this.pendingRequest=null,p(R),this.saveEventData(),this.processRequests(y)})}queueRequest(n,u){this.queue.push(n),this.processRequests(u)}}class Mi extends Pi{constructor(n){super("metrics"),n&&(this.data=n)}postMetricsEvent(n){if(!s.e.EVENTS_URL||!n&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const u=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:u},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:u,payload:p}=this.queue.shift();this.postEvent(u,p,()=>{},n)}}const fn=new class extends Pi{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,n){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(u=>s.h(u)||s.j(u))&&this.queueRequest(Date.now(),n)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=pi(s.e.ACCESS_TOKEN),u=n?n.u:s.e.ACCESS_TOKEN;let p=u!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),p=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),w=new Date(y),E=(y-this.eventData.lastSuccess)/864e5;p=p||E>=1||E<-1||b.getDate()!==w.getDate()}else p=!0;p?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:Dt,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=u)},f):this.processRequests()}},bi=fn.postTurnstileEvent.bind(fn),Dn=new class extends Pi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,n,u,p){this.skuToken=n,this.errorCb=p,s.e.EVENTS_URL&&(u||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},u):this.errorCb(new Error(Qe)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:u}=this.queue.shift();n&&this.success[n]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:Dt,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f))}remove(){this.errorCb=null}},Un=Dn.postMapLoadEvent.bind(Dn),Ht=new class extends Pi{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let n=this.mapInstanceIdMap.get(f);return n||(n=s.u(),this.mapInstanceIdMap.set(f,n)),n}getEventId(f){const n=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,n+1),n}postStyleLoadEvent(f,n){const{map:u,style:p,importedStyles:y}=n;if(!s.e.EVENTS_URL||!f&&!s.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(u),w={mapInstanceId:b,eventId:this.getEventId(b),style:p};y.length&&(w.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:w},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:u}=this.queue.shift();this.postEvent(n,u,()=>{},f)}},mr=Ht.postStyleLoadEvent.bind(Ht),zn=new Mi({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Li=zn.postMetricsEvent.bind(zn),Ei=new Mi({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),hn=Ei.postMetricsEvent.bind(Ei),ei=new class extends Pi{constructor(){super("gljs.performance")}postPerformanceEvent(f,n){s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:u}=this.queue.shift(),p=(function(y){const b=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),E=(function(U){const W={};if(U){for(const G in U)if(G!=="other")for(const X of U[G]){const K=`${G}ResolveRangeMin`,oe=`${G}ResolveRangeMax`,re=`${G}RequestCount`,ne=`${G}RequestCachedCount`;W[K]=Math.min(W[K]||1/0,X.startTime),W[oe]=Math.max(W[oe]||-1/0,X.responseEnd);const be=_e=>{W[_e]===void 0&&(W[_e]=0),++W[_e]};X.transferSize!==void 0&&X.transferSize===0&&be(ne),be(re)}}return W})((function(U,W){const G={};if(U)for(const X of U){const K=W(X);G[K]===void 0&&(G[K]=[]),G[K].push(X)}return G})(b,O)),I=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=R?R.effectiveType:void 0,N={counters:[],metadata:[],attributes:[]},B=(U,W,G)=>{G!=null&&U.push({name:W,value:G.toString()})};for(const U in E)B(N.counters,U,E[U]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(B(N.counters,"interactionRangeMin",y.interactionRange[0]),B(N.counters,"interactionRangeMax",y.interactionRange[1])),w)for(const U of Object.values(C)){const W=w.find(G=>G.name===U);W&&B(N.counters,U,W.startTime)}return B(N.counters,"visibilityHidden",y.visibilityHidden),B(N.attributes,"style",(function(U){if(U)for(const W of U){const G=W.name.split("?")[0];if(s.i(G)){const X=G.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}})(b)),B(N.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),B(N.attributes,"fogEnabled",y.fogEnabled?"true":"false"),B(N.attributes,"projection",y.projection),B(N.attributes,"zoom",y.zoom),B(N.metadata,"devicePixelRatio",I),B(N.metadata,"connectionEffectiveType",L),B(N.metadata,"navigatorUserAgent",navigator.userAgent),B(N.metadata,"screenWidth",window.screen.width),B(N.metadata,"screenHeight",window.screen.height),B(N.metadata,"windowWidth",window.innerWidth),B(N.metadata,"windowHeight",window.innerHeight),B(N.metadata,"mapWidth",y.width/I),B(N.metadata,"mapHeight",y.height/I),B(N.metadata,"webglRenderer",y.renderer),B(N.metadata,"webglVendor",y.vendor),B(N.metadata,"sdkVersion",P),B(N.metadata,"sdkIdentifier","mapbox-gl-js"),N})(u);for(const y of p.metadata);for(const y of p.counters);for(const y of p.attributes);this.postEvent(n,p,()=>{},f)}},Wt=ei.postPerformanceEvent.bind(ei),ui=new class extends Pi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,n,u,p){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const y=yt(s.e.API_URL+s.e.SESSION_PATH);y.params.push(`sku=${n||""}`),y.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const b={url:Nt(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(b,w=>{this.pendingRequest=null,u(w),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,n,u,p){this.skuToken=n,this.errorCb=p,s.e.SESSION_PATH&&s.e.API_URL&&(u||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},u):this.errorCb(new Error(Qe)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:u}=this.queue.shift();n&&this.success[n]||this.getSession(u,this.skuToken,p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f)}remove(){this.errorCb=null}},Vi=ui.getSessionAPI.bind(ui),zi=new Set;function $e(f,n){n?zi.add(f):zi.delete(f)}class Ce{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,u){this._updatedSourceCaches[n]=u,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const u=n.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(n.id),this.setDirty()}removeLayer(n){const u=n.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][n.id]=n,this._updatedLayers[u].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const u in this._updatedLayers)n[u]=n[u]||{},n[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)n[u]=n[u]||{},n[u].removedIds=Object.keys(this._removedLayers[u]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,u){this._updatedImages[u]=this._updatedImages[u]||new Set,this._updatedImages[u].add(s.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Zt(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class Xt extends s.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new s.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const u=this.atlasTexture.get(n);u&&(u.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,u){this.imageProviders.has(u)||this.imageProviders.set(u,new Map),this.imageProviders.get(u).set(n.id,n)}removeImageProvider(n,u){this.imageProviders.has(u)&&this.imageProviders.get(u).delete(n)}getPendingImageProviders(){const n=[];for(const u of this.imageProviders.values())for(const p of u.values())p.hasPendingRequests()&&n.push(p);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,u){if(this.loaded.get(u)!==n&&(this.loaded.set(u,n),n)){for(const{ids:p,callback:y}of this.requestors)this._notify(p,u,y);this.requestors=[]}}hasImage(n,u){return!!this.getImage(n,u)}getImage(n,u){return this.images.get(u).get(n.toString())}addImage(n,u,p){this._validate(n,p)&&this.images.get(u).set(n.toString(),p)}_validate(n,u){let p=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "content" value`))),p=!1),p}_validateStretch(n,u){if(!n)return!0;let p=0;for(const y of n){if(y[0]<p||y[1]<y[0]||u<y[1])return!1;p=y[1]}return!0}_validateContent(n,u){return n?n.length!==4||!u.usvg&&(n[0]<0||u.data.width<n[0]||n[1]<0||u.data.height<n[1]||n[2]<0||u.data.width<n[2]||n[3]<0||u.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,u,p){const y=this.images.get(u).get(n.toString());p.version=y.version+1,this.images.get(u).set(n.toString(),p),this.updatedImages.get(u).add(n),this.removeFromImageRasterizerCache(n,u)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,u){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:u}):this.imageRasterizer.removeImagesFromCacheByIds([n],u))}removeImage(n,u){const p=this.images.get(u),y=p.get(n.toString());p.delete(n.toString()),this.patterns.get(u).delete(n.toString()),this.removeFromImageRasterizerCache(n,u),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(u=>s.I.from(u))}getImages(n,u,p){const y=[],b=[],w=this.imageProviders.get(u);for(const L of n){if(!L.iconsetId){y.push(L);continue}const N=w.get(L.iconsetId);N&&(this.getImage(L,u)?b.push(L):N.addPendingRequest(L))}if(y.length===0)return void this._notify(b,u,p);let E=!0;const I=!!this.loaded.get(u),R=this.images.get(u);if(!I)for(const L of y)R.has(L.toString())||(E=!1);I||E?this._notify(y,u,p):this.requestors.push({ids:y,scope:u,callback:p})}rasterizeImages(n,u){const p=new Map,{tasks:y,scope:b}=n;for(const[w,E]of y.entries()){const I=this.getImage(E.id,b);I&&p.set(w,{image:I,imageVariant:E})}this._rasterizeImages(b,p,u)}_rasterizeImages(n,u,p){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:u,scope:n},p);else{const y=new Map;for(const[b,{image:w,imageVariant:E}]of u.entries())y.set(b,this.imageRasterizer.rasterize(E,w,n,0));p(void 0,y)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,u,p){const y=this.images.get(u),b=new Map;for(const w of n){if(!y.get(w.toString())){if(w.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:w.name}))}const E=y.get(w.toString());if(!E){s.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const I={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)};E.usvg&&Object.assign(I,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),b.set(s.I.toString(w),I)}p(null,b)}getPixelSize(n){const{width:u,height:p}=this.atlasImage.get(n);return{width:u,height:p}}getPattern(n,u,p){const y=n.toString(),b=this.patterns.get(u),w=b.get(y),E=this.getImage(n,u);if(!E)return null;if(w){if(w.position.version===E.version)return w.position;w.position.version=E.version}else{if(E.usvg&&!E.data){const I=this.getPatternInFlightId(y,u);if(this.patternsInFlight.has(I))return null;this.patternsInFlight.add(I);const R=new s.A(n).scaleSelf(s.o.devicePixelRatio),L=new Map([[R.toString(),{image:E,imageVariant:R}]]);return this._rasterizeImages(u,L,(N,B)=>this.storePatternImage(R,u,E,p,B)),null}this.storePattern(n,u,E)}return this._updatePatternAtlas(u,p),b.get(y).position}getPatternInFlightId(n,u){return s.B(n,u)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,u,p,y,b){const w=n.toString(),E=b?b.get(w):void 0;E&&(p.data=E,this.storePattern(n.id,u,p),this._updatePatternAtlas(u,y),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),u)))}storePattern(n,u,p){const y={w:p.data.width+2*s.C,h:p.data.height+2*s.C,x:0,y:0},b=new s.F(y,p,s.C);this.patterns.get(u).set(n.toString(),{bin:y,position:b})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,u){const p=n.gl;let y=this.atlasTexture.get(u);y?this.dirty&&(y.update(this.atlasImage.get(u)),this.dirty=!1):(y=new s.T(n,this.atlasImage.get(u),p.RGBA8),this.atlasTexture.set(u,y)),y.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,u){const p=this.patterns.get(n),y=Array.from(p.values()).map(({bin:R})=>R),{w:b,h:w}=s.G(y),E=this.atlasImage.get(n);E.resize({width:b||1,height:w||1});const I=this.images.get(n);for(const[R,{bin:L,position:N}]of p.entries()){let B=N.padding;const U=L.x+B,W=L.y+B,G=I.get(R).data,X=G.width,K=G.height;B=B>1?B-1:B,s.q.copy(G,E,{x:0,y:0},{x:U,y:W},{width:X,height:K},u),s.q.copy(G,E,{x:0,y:K-B},{x:U,y:W-B},{width:X,height:B},u),s.q.copy(G,E,{x:0,y:0},{x:U,y:W+K},{width:X,height:B},u),s.q.copy(G,E,{x:X-B,y:0},{x:U-B,y:W},{width:B,height:K},u),s.q.copy(G,E,{x:0,y:0},{x:U+X,y:W},{width:B,height:K},u),s.q.copy(G,E,{x:X-B,y:K-B},{x:U-B,y:W-B},{width:B,height:B},u),s.q.copy(G,E,{x:0,y:K-B},{x:U+X,y:W-B},{width:B,height:B},u),s.q.copy(G,E,{x:0,y:0},{x:U+X,y:W+K},{width:B,height:B},u),s.q.copy(G,E,{x:X-B,y:0},{x:U-B,y:W+K},{width:B,height:B},u)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,u){const p=this.images.get(u);for(const y of n){if(this.callbackDispatchedThisFrame.get(u).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(u).add(y.toString());const b=p.get(y.toString());Zt(b)&&this.updateImage(y,u,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function rt(f){const n=f.value,u=f.valueSpec,p=f.style,y=f.styleSpec,b=f.key,w=f.arrayElementValidator||$n;if(!Array.isArray(n))return[new s.V(b,n,`array expected, ${s.K(n)} found`)];if(u.length&&n.length!==u.length)return[new s.V(b,n,`array length ${u.length} expected, length ${n.length} found`)];if(u["min-length"]&&n.length<u["min-length"])return[new s.V(b,n,`array length at least ${u["min-length"]} expected, length ${n.length} found`)];let E={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};y.$version<7&&(E.function=u.function),s.H(u.value)&&(E=u.value);let I=[];for(let R=0;R<n.length;R++)I=I.concat(w({array:n,arrayIndex:R,value:n[R],valueSpec:E,style:p,styleSpec:y,key:`${b}[${R}]`},!0));return I}function ri(f){const n=f.key,u=f.value,p=f.valueSpec;if(!s.L(u))return[new s.V(n,u,`number expected, ${s.K(u)} found`)];if(u!=u)return[new s.V(n,u,"number expected, NaN found")];if("minimum"in p){let y=p.minimum;if(Array.isArray(p.minimum)&&(y=p.minimum[f.arrayIndex]),u<y)return[new s.V(n,u,`${u} is less than the minimum value ${y}`)]}if("maximum"in p){let y=p.maximum;if(Array.isArray(p.maximum)&&(y=p.maximum[f.arrayIndex]),u>y)return[new s.V(n,u,`${u} is greater than the maximum value ${y}`)]}return[]}function wi(f){const n=f.key,u=f.value;if(!s.H(u))return[new s.V(n,u,`object expected, ${s.K(u)} found`)];const p=f.valueSpec,y=s.J(u.type);let b,w,E,I={};const R=y!=="categorical"&&u.property===void 0,L=!R,N=(function(G){const X=G.stops;return Array.isArray(X)&&Array.isArray(X[0])&&s.H(X[0][0])})(u),B=yr({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(G){if(y==="identity")return[new s.V(G.key,G.value,'identity function may not have a "stops" property')];let X=[];const K=G.value;return X=X.concat(rt({key:G.key,value:K,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:U})),Array.isArray(K)&&K.length===0&&X.push(new s.V(G.key,K,"array must have at least one stop")),X},default:function(G){return $n({key:G.key,value:G.value,valueSpec:p,style:G.style,styleSpec:G.styleSpec})}}});return y==="identity"&&R&&B.push(new s.V(f.key,f.value,'missing required property "property"')),y==="identity"||u.stops||B.push(new s.V(f.key,f.value,'missing required property "stops"')),y==="exponential"&&p.expression&&!s.M(p)&&B.push(new s.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(L&&!s.N(p)?B.push(new s.V(f.key,f.value,"property functions not supported")):R&&!s.O(p)&&B.push(new s.V(f.key,f.value,"zoom functions not supported"))),y!=="categorical"&&!N||u.property!==void 0||B.push(new s.V(f.key,f.value,'"property" property is required')),B;function U(G){let X=[];const K=G.value,oe=G.key;if(!Array.isArray(K))return[new s.V(oe,K,`array expected, ${s.K(K)} found`)];if(K.length!==2)return[new s.V(oe,K,`array length 2 expected, length ${K.length} found`)];if(N){if(!s.H(K[0]))return[new s.V(oe,K,`object expected, ${s.K(K[0])} found`)];const re=K[0];if(re.zoom===void 0)return[new s.V(oe,K,"object stop key must have zoom")];if(re.value===void 0)return[new s.V(oe,K,"object stop key must have value")];const ne=s.J(re.zoom);if(typeof ne!="number")return[new s.V(oe,re.zoom,"stop zoom values must be numbers")];if(E&&E>ne)return[new s.V(oe,re.zoom,"stop zoom values must appear in ascending order")];ne!==E&&(E=ne,w=void 0,I={}),X=X.concat(yr({key:`${oe}[0]`,value:K[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:ri,value:W}}))}else X=X.concat(W({key:`${oe}[0]`,value:K[0],style:G.style,styleSpec:G.styleSpec},K));return s.Q(s.S(K[1]))?X.concat([new s.V(`${oe}[1]`,K[1],"expressions are not allowed in function stops.")]):X.concat($n({key:`${oe}[1]`,value:K[1],valueSpec:p,style:G.style,styleSpec:G.styleSpec}))}function W(G,X){const K=s.K(G.value),oe=s.J(G.value),re=G.value!==null?G.value:X;if(b){if(K!==b)return[new s.V(G.key,re,`${K} stop domain type must match previous stop domain type ${b}`)]}else b=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof oe!="number"&&typeof oe!="string"&&typeof oe!="boolean")return[new s.V(G.key,re,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&y!=="categorical"){let ne=`number expected, ${K} found`;return s.N(p)&&y===void 0&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(G.key,re,ne)]}return y!=="categorical"||K!=="number"||typeof oe=="number"&&isFinite(oe)&&Math.floor(oe)===oe?y!=="categorical"&&K==="number"&&typeof oe=="number"&&typeof w=="number"&&w!==void 0&&oe<w?[new s.V(G.key,re,"stop domain values must appear in ascending order")]:(w=oe,y==="categorical"&&oe in I?[new s.V(G.key,re,"stop domain values must be unique")]:(I[oe]=!0,[])):[new s.V(G.key,re,`integer expected, found ${String(oe)}`)]}}function gi(f){const n=(f.expressionContext==="property"?s.W:s.U)(s.S(f.value),f.valueSpec);if(n.result==="error")return n.value.map(p=>new s.V(`${f.key}${p.key}`,f.value,p.message));const u=n.value.expression||n.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!u.outputDefined())return[new s.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!s.Z(u))return[new s.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Yt(u,f);if(f.expressionContext==="appearance")return Zi(u,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!s.X(u,["zoom","feature-state"]))return[new s.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!s.Y(u))return[new s.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yt(f,n){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const y of n.valueSpec.expression.parameters)u.delete(y);if(u.size===0)return[];const p=[];return f instanceof s._&&u.has(f.name)?[new s.V(n.key,n.value,`["${f.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(f.eachChild(y=>{p.push(...Yt(y,n))}),p)}function Zi(f,n){const u=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const y of n.valueSpec.expression.parameters)u.add(y);if(u.size===0)return[];const p=[];return f instanceof s._&&!u.has(f.name)?[new s.V(n.key,n.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(y=>{p.push(...Zi(y,n))}),p)}function qi(f){const n=f.key,u=f.value,p=f.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(s.J(u))===-1&&y.push(new s.V(n,u,`expected one of [${p.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(p.values).indexOf(s.J(u))===-1&&y.push(new s.V(n,u,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function $i(f){return s.a2(s.S(f.value))?gi(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Xi(f)}function Xi(f){const n=f.value,u=f.key;if(!Array.isArray(n))return[new s.V(u,n,`array expected, ${s.K(n)} found`)];if(n.length<1)return[new s.V(u,n,"filter array must have at least 1 element")];const p=f.styleSpec;let y=qi({key:`${u}[0]`,value:n[0],valueSpec:p.filter_operator});const b=()=>{n.length>=2&&(s.a0(n[1])||y.push(new s.V(`${u}[1]`,n[1],`string expected, ${s.K(n[1])} found`)));for(let w=2;w<n.length;w++)s.J(n[1])==="$type"?y=y.concat(qi({key:`${u}[${w}]`,value:n[w],valueSpec:p.geometry_type})):s.a0(n[w])||s.L(n[w])||s.$(n[w])||y.push(new s.V(`${u}[${w}]`,n[w],`string, number, or boolean expected, ${s.K(n[w])} found.`))};switch(s.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.J(n[1])==="$type"&&y.push(new s.V(u,n,`"$type" cannot be use with operator "${n[0]}"`)),n.length!==3&&y.push(new s.V(u,n,`filter array for operator "${n[0]}" must have 3 elements`)),b();break;case"==":case"!=":n.length!==3&&y.push(new s.V(u,n,`filter array for operator "${n[0]}" must have 3 elements`)),b();break;case"in":case"!in":b();break;case"any":case"all":case"none":for(let w=1;w<n.length;w++)y=y.concat(Xi({key:`${u}[${w}]`,value:n[w],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":n.length!==2?y.push(new s.V(u,n,`filter array for "${n[0]}" operator must have 2 elements`)):s.a0(n[1])||y.push(new s.V(`${u}[1]`,n[1],`string expected, ${s.K(n[1])} found`))}return y}function Di(f,n){const u=f.key,p=f.style,y=f.layer,b=f.styleSpec,w=f.value,E=f.objectKey,I=b[`${n}_${f.layerType}`];if(!I)return[];const R=E.match(/^(.*)-use-theme$/);if(R&&I[R[1]])return s.Q(s.S(w))?[].concat($n({key:u,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:E})):$n({key:u,value:w,valueSpec:{type:"string"},style:p,styleSpec:b});const L=E.match(/^(.*)-transition$/);if(n==="paint"&&L&&I[L[1]]&&I[L[1]].transition)return $n({key:u,value:w,valueSpec:b.transition,style:p,styleSpec:b});const N=f.valueSpec||I[E];if(!N)return[new s.a3(u,w,`unknown property "${E}"`)];let B;if(s.a0(w)&&s.N(N)&&!N.tokens&&(B=/^{([^}]+)}$/.exec(w))){const W=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new s.V(u,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${W}.`)]}const U=[];if(f.layerType==="symbol")E!=="text-field"||!p||p.glyphs||p.imports||U.push(new s.V(u,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&s.a4(s.S(w))&&s.J(w.type)==="identity"&&U.push(new s.V(u,w,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&n==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&s.N(N)&&(s.a5(N)||s.O(N))){const W=s.W(s.S(w),N).value,G="expression"in W&&W.expression||"_styleExpression"in W&&W._styleExpression&&W._styleExpression.expression;G&&!s.X(G,["measure-light"])&&(E==="model-emissive-strength"&&s.Y(G)&&s.Z(G)||U.push(new s.V(u,w,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat($n({key:f.key,value:w,valueSpec:N,style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:E}))}function gr(f){return Di(f,"paint")}function Er(f){return Di(f,"layout")}function Cl(f){let n=[];const u=f.value,p=f.key,y=f.style,b=f.styleSpec;if(!s.H(u))return[new s.V(p,u,"object expected")];u.type||u.ref||n.push(new s.V(p,u,'either "type" or "ref" is required'));let w=s.J(u.type);const E=s.J(u.ref);if(u.id){const I=s.J(u.id);for(let R=0;R<f.arrayIndex;R++){const L=y.layers[R];s.J(L.id)===I&&n.push(new s.V(p,u.id,`duplicate layer id "${I}", previously used at line ${L.id.__line__}`))}}if("ref"in u){let I;["type","source","source-layer","filter","layout"].forEach(R=>{R in u&&n.push(new s.V(p,u[R],`"${R}" is prohibited for ref layers`))}),y.layers.forEach(R=>{s.J(R.id)===E&&(I=R)}),I?I.ref?n.push(new s.V(p,u.ref,"ref cannot reference another ref layer")):w=s.J(I.type):typeof E=="string"&&n.push(new s.V(p,u.ref,`ref layer "${E}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(u.source)if(s.a0(u.source)){const I=y.sources&&y.sources[u.source],R=I&&s.J(I.type);I?R==="vector"&&w==="raster"?n.push(new s.V(p,u.source,`layer "${u.id}" requires a raster source`)):R==="raster"&&w!=="raster"?n.push(new s.V(p,u.source,`layer "${u.id}" requires a vector source`)):R!=="vector"||u["source-layer"]?R==="raster-dem"&&w!=="hillshade"?n.push(new s.V(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&u.paint&&(u.paint["line-gradient"]||u.paint["line-trim-offset"])&&R==="geojson"&&!I.lineMetrics?n.push(new s.V(p,u,`layer "${u.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&R!=="raster-array"&&n.push(new s.V(p,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):n.push(new s.V(p,u.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new s.V(p,u,`layer "${u.id}" must specify a "source-layer"`)):n.push(new s.V(p,u.source,`source "${u.source}" not found`))}else n.push(new s.V(`${p}.source`,u.source,'"source" must be a string'));else n.push(new s.V(p,u,'missing required property "source"'));return n=n.concat(yr({key:p,value:u,valueSpec:b.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$n({key:`${p}.type`,value:u.type,valueSpec:b.layer.type,style:f.style,styleSpec:f.styleSpec,object:u,objectKey:"type"}),filter:I=>$i(Object.assign({layerType:w},I)),layout:I=>yr({layer:u,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":R=>Er(Object.assign({layerType:w},R))}}),paint:I=>yr({layer:u,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":R=>gr(Object.assign({layerType:w,layer:u},R))}}),appearances(I){const R=rt({key:I.key,value:I.value,valueSpec:I.valueSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:B=>(function(U){const{key:W,layer:G,layerType:X}=U,K=s.J(U.value),oe=s.J(K.name),re=s.J(K.condition),ne=yr({key:W,value:K,valueSpec:U.styleSpec.appearance,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{condition:be=>(function(_e){const ve=[];return ve.push(...gi({key:_e.key,value:_e.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),ve})(Object.assign({layer:G,layerType:X},be)),properties:be=>(function(_e){const ve=[],{styleSpec:pe,layer:he,layerType:Se}=_e,ze=pe[`paint_${Se}`],Le=pe[`layout_${Se}`],Ze=_e.object[_e.objectKey];for(const je in Ze){const tt=je in ze?"paint":je in Le?"layout":void 0;if(!tt){ve.push(new s.V(_e.key,je,`unknown property "${je}" for layer type "${Se}"`));continue}const dt=Object.assign({},_e,{key:`${_e.key}.${je}`,object:Ze,objectKey:je,layer:he,layerType:Se,value:Ze[je],valueSpec:tt==="paint"?ze[je]:Le[je]});ve.push(...Di(dt,tt))}return ve})(Object.assign({layer:G,layerType:X},be))}});return oe!=="hidden"&&re===void 0&&ne.push(new s.V(U.key,"name",'Appearance with name different than "hidden" must have a condition')),ne})(Object.assign({layerType:w,layer:u},B))}),L=Array.isArray(I.value)?I.value:[],N=new Set;return L.forEach((B,U)=>{const W=s.J(B.name);if(W)if(N.has(W)){const G=s.J(u.id);R.push(new s.V(I.key,W,`Duplicated appearance name "${W}" for layer "${G}"`))}else N.add(W)}),R}}})),n}function Ks({key:f,value:n}){return s.a0(n)?[]:[new s.V(f,n,`string expected, ${s.K(n)} found`)]}const mo={promoteId:function f({key:n,value:u}){if(s.a0(u))return Ks({key:n,value:u});if(Array.isArray(u)){const y=[],b=s.S(u),w=s.U(b);return w.result==="error"&&w.value.forEach(E=>{y.push(new s.V(`${n}${E.key}`,null,`${E.message}`))}),s.X(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new s.V(`${n}`,null,"promoteId expression should be only feature dependent")),y}if(!s.H(u))return[new s.V(n,u,`string, expression or object expected, "${s.K(u)}" found`)];const p=[];for(const y in u)p.push(...f({key:`${n}.${y}`,value:u[y]}));return p}};function Qs(f){const n=f.value,u=f.key,p=f.styleSpec,y=f.style;if(!s.H(n))return[new s.V(u,n,`object expected, ${s.K(n)} found`)];if(!("type"in n))return[new s.V(u,n,'"type" is required')];const b=s.J(n.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in n||"tiles"in n||w.push(new s.a3(u,n,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(yr({key:u,value:n,valueSpec:p[`source_${b.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:mo})),w;case"geojson":if(w=yr({key:u,value:n,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:mo}),"cluster"in n&&"clusterProperties"in n){if(!s.H(n.clusterProperties))return[new s.V(`${u}.clusterProperties`,n,`object expected, ${s.K(n)} found`)];for(const E in n.clusterProperties){const I=n.clusterProperties[E];if(!Array.isArray(I))return[new s.V(`${u}.clusterProperties.${E}`,I,"array expected")];const[R,L]=I,N=typeof R=="string"?[R,["accumulated"],["get",E]]:R;w.push(...gi({key:`${u}.${E}.map`,value:L,expressionContext:"cluster-map"})),w.push(...gi({key:`${u}.${E}.reduce`,value:N,expressionContext:"cluster-reduce"}))}}return w;case"video":return yr({key:u,value:n,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return yr({key:u,value:n,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new s.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qi({key:`${u}.type`,value:n.type,valueSpec:{values:ha(p)}})}}function ha(f){return f.source.reduce((n,u)=>{const p=f[u];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values||{}))),n},[])}function ea(f){const n=f.value,u=f.styleSpec,p=u.light,y=f.style;if(n===void 0)return[];if(!s.H(n))return[new s.V("light",n,`object expected, ${s.K(n)} found`)];let b=[];for(const w in n){const E=w.match(/^(.*)-transition$/),I=w.match(/^(.*)-use-theme$/);b=b.concat(I&&p[I[1]]?$n({key:w,value:n[w],valueSpec:{type:"string"},style:y,styleSpec:u}):E&&p[E[1]]&&p[E[1]].transition?$n({key:w,value:n[w],valueSpec:u.transition,style:y,styleSpec:u}):p[w]?$n({key:w,value:n[w],valueSpec:p[w],style:y,styleSpec:u}):[new s.V(w,n[w],`unknown property "${w}"`)])}return b}function da(f){const n=f.value;if(!n)return[];const u=f.key;if(!s.H(n))return[new s.V(u,n,`object expected, ${s.K(n)} found`)];let p=[];const y=f.styleSpec,b=y["light-3d"],w=f.style,E=f.style.lights;for(const L of["type","id"])if(!(L in n))return p=p.concat([new s.V(u,n,`missing property "${L}"`)]),p;if(!s.a0(n.type))return p=p.concat([new s.V(`${u}.type`,n.type,"string expected")]),p;if(E)for(let L=0;L<f.arrayIndex;L++){const N=s.J(n.type),B=E[L];s.J(B.type)===N&&p.push(new s.V(u,n.id,`duplicate light type "${n.type}", previously defined at line ${B.id.__line__}`))}const I=`properties_light_${n.type}`;if(!(I in y))return p=p.concat([new s.V(`${u}.type`,n,`Invalid light type ${n.type}`)]),p;const R=y[I];for(const L in n)if(L==="properties"){const N=n[L];if(!s.H(N))return p=p.concat([new s.V("properties",N,`object expected, ${s.K(N)} found`)]),p;for(const B in N){const U=B.match(/^(.*)-transition$/),W=B.match(/^(.*)-use-theme$/);p=p.concat(W&&R[W[1]]?$n({key:L,value:N[B],valueSpec:{type:"string"},style:w,styleSpec:y}):U&&R[U[1]]&&R[U[1]].transition?$n({key:L,value:n[L],valueSpec:y.transition,style:w,styleSpec:y}):R[B]?$n({key:B,value:N[B],valueSpec:R[B],style:w,styleSpec:y}):[new s.a3(f.key,N[B],`unknown property "${B}"`)])}}else p=p.concat(b[L]?$n({key:L,value:n[L],valueSpec:b[L],style:w,styleSpec:y}):[new s.a3(L,n[L],`unknown property "${L}"`)]);return p}function gs(f){const n=f.value,u=f.key,p=f.style,y=f.styleSpec,b=y.terrain;if(n==null)return[];if(!s.H(n))return[new s.V("terrain",n,`object expected, ${s.K(n)} found`)];let w=[];for(const E in n){const I=E.match(/^(.*)-transition$/),R=E.match(/^(.*)-use-theme$/);w=w.concat(R&&b[R[1]]?$n({key:E,value:n[E],valueSpec:{type:"string"},style:p,styleSpec:y}):I&&b[I[1]]&&b[I[1]].transition?$n({key:E,value:n[E],valueSpec:y.transition,style:p,styleSpec:y}):b[E]?$n({key:E,value:n[E],valueSpec:b[E],style:p,styleSpec:y}):[new s.a3(E,n[E],`unknown property "${E}"`)])}if(n.source)if(s.a0(n.source)){const E=p.sources&&p.sources[n.source],I=E&&s.J(E.type);E?I!=="raster-dem"&&w.push(new s.V(`${u}.source`,n.source,`terrain cannot be used with a source of type ${I}, it only be used with a "raster-dem" source type`)):w.push(new s.V(`${u}.source`,n.source,`source "${n.source}" not found`))}else w.push(new s.V(`${u}.source`,n.source,"source must be a string"));else w.push(new s.V(u,n,'terrain is missing required property "source"'));return w}function fa(f){const n=f.value,u=f.style,p=f.styleSpec,y=p.fog;if(n===void 0)return[];if(!s.H(n))return[new s.V("fog",n,`object expected, ${s.K(n)} found`)];let b=[];for(const w in n){const E=w.match(/^(.*)-transition$/),I=w.match(/^(.*)-use-theme$/);b=b.concat(I&&y[I[1]]?$n({key:w,value:n[w],valueSpec:{type:"string"},style:u,styleSpec:p}):E&&y[E[1]]&&y[E[1]].transition?$n({key:w,value:n[w],valueSpec:p.transition,style:u,styleSpec:p}):y[w]?$n({key:w,value:n[w],valueSpec:y[w],style:u,styleSpec:p}):[new s.a3(w,n[w],`unknown property "${w}"`)])}return b}const nl={"*":()=>[],array:rt,boolean:function(f){const n=f.value,u=f.key;return s.$(n)?[]:[new s.V(u,n,`boolean expected, ${s.K(n)} found`)]},number:ri,color:function({key:f,value:n}){return s.a0(n)?s.a1.parseCSSColor(n)===null?[new s.V(f,n,`color expected, "${n}" found`)]:[]:[new s.V(f,n,`color expected, ${s.K(n)} found`)]},enum:qi,filter:$i,function:wi,layer:Cl,object:yr,source:Qs,model:s.a7,light:ea,"light-3d":da,terrain:gs,fog:fa,string:Ks,formatted:function(f){return Ks(f).length===0?[]:gi(f)},resolvedImage:function(f){return Ks(f).length===0?[]:gi(f)},projection:function(f){const n=f.value,u=f.styleSpec,p=u.projection,y=f.style;if(s.H(n)){let b=[];for(const w in n)b=b.concat($n({key:w,value:n[w],valueSpec:p[w],style:y,styleSpec:u}));return b}return s.a0(n)?[]:[new s.V("projection",n,`object or string expected, ${s.K(n)} found`)]},import:function(f){const n=f.key,{value:u,styleSpec:p}=f;if(!s.H(u))return[new s.V(n,u,"import must be an object")];const{data:y,...b}=u;Object.defineProperty(b,"__line__",{value:u.__line__,enumerable:!1});let w=yr(Object.assign({},f,{value:b,valueSpec:p.import}));return s.J(b.id)===""&&w.push(new s.V(`${f.key}.id`,b,"import id can't be an empty string")),y&&(w=w.concat(Rl(y,p,{key:`${f.key}.data`}))),w},iconset:function(f){const n=f.value,u=f.key,p=f.styleSpec,y=f.style;if(!s.H(n))return[new s.V(u,n,"object expected")];if(!n.type)return[new s.V(u,n,'"type" is required')];const b=s.J(n.type);let w=[];if(w=w.concat(yr({key:u,value:n,valueSpec:p[`iconset_${b}`],style:y,styleSpec:p})),(function(E,I){return!(E!=="source"||!I.source)})(b,n)){const E=y.sources&&y.sources[n.source],I=E&&s.J(E.type);E?I!=="raster-array"&&w.push(new s.V(u,n.source,`iconset cannot be used with a source of type ${String(I)}, it only be used with a "raster-array" source type`)):w.push(new s.V(u,n.source,`source "${n.source}" not found`))}return w}};function $n(f,n=!1){const u=f.value,p=f.valueSpec,y=f.styleSpec;if(p.expression){if(s.a4(s.J(u)))return wi(f);if(s.Q(s.S(u)))return gi(f)}if(p.type&&nl[p.type]){const b=nl[p.type](f);return n===!0&&b.length>0&&Array.isArray(f.value)?gi(f):b}return yr(Object.assign({},f,{valueSpec:p.type?y[p.type]:p}))}function yr(f){const n=f.key,u=f.value,p=f.valueSpec||{},y=f.objectElementValidators||{},b=f.style,w=f.styleSpec;if(!s.H(u))return[new s.V(n,u,`object expected, ${s.K(u)} found`)];let E=[];for(const I in u){const R=I.split(".")[0];let L;y[R]?L=y[R]:p[R]?L=$n:y["*"]?L=y["*"]:p["*"]&&(L=$n),L?E=E.concat(L({key:(n&&`${n}.`)+I,value:u[I],valueSpec:p[R]||p["*"],style:b,styleSpec:w,object:u,objectKey:I},u)):E.push(new s.a3(n,u[I],`unknown property "${I}"`))}for(const I in p){if(y[I])continue;const R=p[I];R.required&&R.default===void 0&&u[I]===void 0&&E.push(new s.V(n,u,`missing required property "${I}"`))}return E}function lc({key:f,value:n}){const u=Ks({key:f,value:n});if(u.length)return u;const p=n;return p.indexOf("{fontstack}")===-1&&u.push(new s.V(f,n,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&u.push(new s.V(f,n,'"glyphs" url must include a "{range}" token')),u}function Rl(f,n=s.a6,u={}){return yr({key:u.key||"",value:f,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:f,objectElementValidators:{glyphs:lc}})}function ts(f,n=s.a6){return de(Rl(f,n))}const De=f=>de(Qs(f)),Rt=f=>de(ea(f)),Ae=f=>de(da(f)),Ot=f=>de(gs(f)),_i=f=>de(fa(f)),Cn=f=>de((function(n){const u=n.value,p=n.style,y=n.styleSpec,b=y.snow;if(u===void 0)return[];if(!s.H(u))return[new s.V("snow",u,`object expected, ${s.K(u)} found`)];let w=[];for(const E in u){const I=E.match(/^(.*)-transition$/);w=w.concat(I&&b[I[1]]&&b[I[1]].transition?$n({key:E,value:u[E],valueSpec:y.transition,style:p,styleSpec:y}):b[E]?$n({key:E,value:u[E],valueSpec:b[E],style:p,styleSpec:y}):[new s.a3(E,u[E],`unknown property "${E}"`)])}return w})(f)),ti=f=>de((function(n){const u=n.value,p=n.style,y=n.styleSpec,b=y.rain;if(u===void 0)return[];if(!s.H(u))return[new s.V("rain",u,`object expected, ${s.K(u)} found`)];let w=[];for(const E in u){const I=E.match(/^(.*)-transition$/);w=w.concat(I&&b[I[1]]&&b[I[1]].transition?$n({key:E,value:u[E],valueSpec:y.transition,style:p,styleSpec:y}):b[E]?$n({key:E,value:u[E],valueSpec:b[E],style:p,styleSpec:y}):[new s.a3(E,u[E],`unknown property "${E}"`)])}return w})(f)),Ee=f=>de(Cl(f)),Z=f=>de($i(f)),Q=f=>de(gr(f)),ce=f=>de(Er(f)),xe=f=>de(s.a7(f));function de(f){return f.slice().sort((n,u)=>n.line&&u.line?n.line-u.line:0)}function Me(f,n){let u=!1;if(n&&n.length)for(const p of n)p instanceof s.a3?s.w(p.message):(f.fire(new s.y(new Error(p.message))),u=!0);return u}const Oe=s.a6.light;let Pe;class Be extends s.E{constructor(n,u="flat"){super(),this._transitionable=new s.a8(Pe||(Pe=new s.a9({anchor:new s.aa(Oe.anchor),position:new s.ab(Oe.position),color:new s.aa(Oe.color),intensity:new s.aa(Oe.intensity)}))),this.setLight(n,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,u,p={}){this._validate(Rt,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=u)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,p){return(!p||p.validate!==!1)&&Me(this,n.call(ts,Object.assign({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const gt=s.a6.terrain;let st=class extends s.E{constructor(f,n,u,p,y){super(),this.scope=u,this._transitionable=new s.a8(new s.a9({source:new s.aa(gt.source),exaggeration:new s.aa(gt.exaggeration)}),u,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=y}get(){return this._transitionable.serialize()}set(f,n){this._transitionable.setTransitionOrValue(f,n)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new s.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const n=f.value.expression;if(!n)return null;let u=-1,p=-1,y=1;for(const b of n.zoomStops)y=n.evaluate(new s.ac(b,{worldview:this.worldview})),y>.01?(u=b,p=-1):p=b;return y<.01&&u>0&&p>u?[u,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof s.ad}};const Ft=.05;function ni(f,n,u,p){const y=s.ah(45,65,u),[b,w]=li(f,p);let E=1-Math.min(1,Math.exp((n-b)/(w-b)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*y*f.alpha}function li(f,n){const u=.5/Math.tan(.5*n);return[f.range[0]+u,f.range[1]+u]}function ki(f,n,u,p,y){const b=s.af([],[n,u,p],y.mercatorFogMatrix);return ni(f,s.ag(b),y.pitch,y._fov)}function ji(f,n,u,p,y,b,w){const E=[[u,p,0],[y,p,0],[y,b,0],[u,b,0]];let I=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const L of E){const N=s.af([],L,n),B=s.ag(N);I=Math.min(I,B),R=Math.max(R,B)}return[ni(f,I,w.pitch,w._fov),ni(f,R,w.pitch,w._fov)]}const Si=s.a6.fog;class yi extends s.E{constructor(n,u,p,y){super();const b=new s.a9({range:new s.aa(Si.range),color:new s.aa(Si.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(Si["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(Si["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(Si["horizon-blend"]),"star-intensity":new s.aa(Si["star-intensity"]),"vertical-range":new s.aa(Si["vertical-range"])});this._transitionable=new s.a8(b,p,new Map(y)),this.set(n,y),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new s.ai(b),this.scope=p}get state(){const n=this._transform,u=n.projection.name==="globe",p=s.aj(n.zoom),y=this.properties.get("range"),b=[.5,3];return{range:u?[s.ak(b[0],y[0],p),s.ak(b[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,u,p={}){if(this._validate(_i,n,p))return;const y=Object.assign({},n);for(const b of Object.keys(Si))y[b]===void 0&&(y[b]=Si[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(45,65,n))*u.a}getOpacityAtLatLng(n,u){return this._transform.projection.supportsFog?(function(p,y,b){const w=s.ae.fromLngLat(y),E=b.elevation?b.elevation.getAtPointOrZero(w):0;return ki(p,w.x,w.y,E,b)})(this.state,n,u):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(n.toUnwrapped());return ji(this.state,u,0,0,s.al,s.al,this._transform)}getOpacityForBounds(n,u,p,y,b){return this._transform.projection.supportsFog?ji(this.state,n,u,p,y,b,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?li(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const p of u){const y=n.points[p];let b;if(y[2]>=0)b=y;else{const w=n.points[p-4];b=s.am(w,y,w[2]/(w[2]-y[2]))}if(ki(this.state,b[0],b[1],0,this._transform)>=Ft)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,p){return(!p||p.validate!==!1)&&Me(this,n.call(ts,Object.assign({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let Vn,Nr,vr,xr=class extends s.E{constructor(f,n,u,p){super();const y=Vn||(Vn=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(y,u,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(y),this.scope=u}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),u=this.properties.get("direction"),p=s.an(u[0]),y=-Math.max(s.an(u[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],w=this.properties.get("vignette"),E=this.properties.get("vignette-color");return E.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(f,n,u={}){if(this._validate(Cn,f,u))return;const p=Object.assign({},f),y=s.a6.snow;for(const b of Object.keys(y))p[b]===void 0&&(p[b]=y[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,u){return(!u||u.validate!==!1)&&Me(this,f.call(ts,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},Qn=class extends s.E{constructor(f,n,u,p){super();const y=Nr||(Nr=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(y,u,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(y),this.scope=u}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),u=this.properties.get("direction"),p=s.an(u[0]),y=-Math.max(s.an(u[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(f,n,u={}){if(this._validate(ti,f,u))return;const p=Object.assign({},f),y=s.a6.rain;for(const b of Object.keys(y))p[b]===void 0&&(p[b]=y[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,u){return(!u||u.validate!==!1)&&Me(this,f.call(ts,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class on extends s.E{constructor(n,u,p,y){super(),this.scope=p,this._options=n,this.properties=new s.ai(u),this._transitionable=new s.a8(u,p,new Map(y)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,u){this._options=n,this._transitionable.setTransitionOrValue(n.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const nr=()=>vr||(vr=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)}));let On;const Fn=()=>On||(On=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new s.aa(s.a6.properties_light_directional["shadow-draw-before-layer"])}));class _r{constructor(n,u,p){this.screenBounds=n,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(n,u){let p,y;if(n instanceof s.P||typeof n[0]=="number"){const b=s.P.convert(n);p=[b],y=u.isPointAboveHorizon(b)}else{const b=s.P.convert(n[0]),w=s.P.convert(n[1]),E=b.add(w)._div(2);p=[b,w],y=s.aq(b,w).every(I=>u.isPointAboveHorizon(I))&&u.isPointAboveHorizon(E)}return new _r(p,y,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const u=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],y=s.aq(u,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(y[3]=this.cameraPoint)),s.ar(y,n)}bufferedCameraGeometryGlobe(n){const u=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],y=s.aq(u,p,n),b=this.cameraPoint.clone();switch(3*((b.y>u.y)+(b.y>p.y))+((b.x>u.x)+(b.x>p.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(n,u,p,y=0){const b=Math.max(n.queryPadding,n.evaluateQueryRenderedFeaturePadding())/u._pixelsPerMercatorPixel+1,w=p?this._bufferedCameraMercator(b,u):this._bufferedScreenMercator(b,u);let E=n.tileID.wrap+(w.unwrapped?y:0);const I=w.polygon.map(X=>s.as(n.tileTransform,X,E));if(!s.at(I,0,0,s.al,s.al))return;E=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const R=this.screenGeometryMercator.polygon.map(X=>s.au(n.tileTransform,X,E)),L=R.map(X=>new s.P(X[0],X[1])),N=u.getFreeCameraOptions().position||new s.ae(0,0,0),B=s.au(n.tileTransform,N,E),U=R.map(X=>{const K=s.av(X,X,B);return s.aw(K,K),new s.ax(B,K)}),W=s.ay(n,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:U,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(G=s.az(I),G.min.x=s.aA(G.min.x,0,s.al),G.min.y=s.aA(G.min.y,0,s.al),G.max.x=s.aA(G.max.x,0,s.al),G.max.y=s.aA(G.max.y,0,s.al),G),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:W};var G}_bufferedScreenMercator(n,u){const p=jr(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),u):{polygon:this.bufferedScreenGeometry(n).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(n,u){const p=jr(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),u):{polygon:this.bufferedCameraGeometry(n).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(n,u){const p=(function(b,w){const E=s.aB([],w.pixelMatrix,w.globeMatrix),I=[0,-s.aD,0,1],R=[0,s.aD,0,1],L=[0,0,0,1];s.aC(I,I,E),s.aC(R,R,E),s.aC(L,L,E);const N=new s.P(I[0]/I[3],I[1]/I[3]),B=new s.P(R[0]/R[3],R[1]/R[3]),U=s.aE(b,N)&&I[3]<L[3],W=s.aE(b,B)&&R[3]<L[3];if(!U&&!W)return null;const G=(function(ve,pe,he){for(let Se=1;Se<ve.length;Se++){const ze=go(pe.pointCoordinate3D(ve[Se-1]).x),Le=go(pe.pointCoordinate3D(ve[Se]).x);if(he<0){if(ze<Le)return{idx:Se,t:-ze/(Le-1-ze)}}else if(Le<ze)return{idx:Se,t:(1-ze)/(Le+1-ze)}}return null})(b,w,U?-1:1);if(!G)return null;const{idx:X,t:K}=G;let oe=X>1?To(b.slice(0,X),w):[],re=X<b.length?To(b.slice(X),w):[];oe=oe.map(ve=>new s.P(go(ve.x),ve.y)),re=re.map(ve=>new s.P(go(ve.x),ve.y));const ne=[...oe];ne.length===0&&ne.push(re[re.length-1]);const be=s.ak(ne[ne.length-1].y,(re.length===0?oe[0]:re[0]).y,K);let _e;return _e=U?[new s.P(0,be),new s.P(0,0),new s.P(1,0),new s.P(1,be)]:[new s.P(1,be),new s.P(1,1),new s.P(0,1),new s.P(0,be)],ne.push(..._e),re.length===0?ne.push(oe[0]):ne.push(...re),{polygon:ne.map(ve=>new s.ae(ve.x,ve.y)),unwrapped:!1}})(n,u);if(p)return p;const y=(function(b,w){let E=!1,I=-1/0,R=0;for(let N=0;N<b.length-1;N++)b[N].x>I&&(I=b[N].x,R=N);for(let N=0;N<b.length-1;N++){const B=(R+N)%(b.length-1),U=b[B],W=b[B+1];Math.abs(U.x-W.x)>.5&&(U.x<W.x?(U.x+=1,B===0&&(b[b.length-1].x+=1)):(W.x+=1,B+1===b.length-1&&(b[0].x+=1)),E=!0)}const L=s.aF(w.center.lng);return E&&L<Math.abs(L-1)&&b.forEach(N=>{N.x-=1}),{polygon:b,unwrapped:E}})(To(n,u).map(b=>new s.P(go(b.x),b.y)),u);return{polygon:y.polygon.map(b=>new s.ae(b.x,b.y)),unwrapped:y.unwrapped}}}function To(f,n){return s.aG(f,u=>{const p=n.pointCoordinate3D(u);u.x=p.x,u.y=p.y},1/256)}function go(f){return f<0?1+f%1:f%1}function jr(f){return 100*f|0}function Ll(f,n,u,p,y){const b=function(E,I){if(E)return y(E);if(I){if(f.url&&I.tiles&&f.tiles&&delete f.tiles,I.variants){if(!Array.isArray(I.variants))return y(new Error("variants must be an array"));for(const L of I.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return y(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){I=Object.assign(I,L);break}}}const R=s.aH(Object.assign({},I,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=n.canonicalizeTileset(R,f.url),y(null,R)}},w=(function(E,I,R){if(!E)return null;if(!I&&!R)return E;R=R||E.worldview_default;const L=Object.values(E.language||{});if(L.length===0)return null;const N=Object.values(E.worldview||{});if(N.length===0)return null;const B=L.every(W=>W===I),U=N.every(W=>W===R);return B&&U?E:I in(E.language_options||{})||R in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null})(f.data,u,p);return w?s.o.frame(()=>b(null,w)):f.url?s.m(n.transformRequest(n.normalizeSourceURL(f.url,null,u,p),s.R.Source),b):s.o.frame(()=>{const{data:E,...I}=f;b(null,I)})}function Ro(f,n){const u=Math.pow(2,n.z),p=Math.floor(s.aF(f.getWest())*u),y=Math.floor(s.aJ(f.getNorth())*u),b=Math.ceil(s.aF(f.getEast())*u),w=Math.ceil(s.aJ(f.getSouth())*u);return n.x>=p&&n.x<b&&n.y>=y&&n.y<w}class _s{constructor(n,u,p){this.bounds=n?s.aI.convert(this.validateBounds(n)):null,this.minzoom=u||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const u of n)this.extraBounds.push(s.aI.convert(this.validateBounds(u)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!Ro(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const u of this.extraBounds)if(Ro(u,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const u=new _s(n.bounds,n.minzoom,n.maxzoom);return u.addExtraBounds(n.extra_bounds),u}}class ta extends s.E{constructor(n,u,p,y){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(u,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new s.aK}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Ll(this._options,this.map._requestManager,u,p,(y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.y(y));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of b.vector_layers)this.vectorLayerIds.push(w.id),b.worldview&&b.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=_s.fromTileJSON(b),bi(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(y)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,u){const p=n.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(y,s.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,E=w?{image:w.image.clone()}:null,I={request:b,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:E,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&s.h(p)&&(I.localizableLayerIds=this.localizableLayerIds),I.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=u:n.request=n.actor.send("reloadTile",I,R.bind(this));else if(n.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",I,R.bind(this),void 0,!0);else{const L=s.aL.call({deduped:this._deduped},I,(N,B)=>{if(N||!B)R.call(this,N);else{const U=s.aM(B.responseHeaders);I.data={rawData:B.rawData.slice(0),expires:U.expires,cacheControl:U.cacheControl},n.actor&&n.actor.send("loadTile",I,R.bind(this),void 0,!0)}},!0);n.request={cancel:L}}function R(L,N){return delete n.request,n.aborted?u(null):L&&L instanceof s.aN&&L.status!==404?u(L):(N&&N.resourceTiming&&(n.resourceTiming=N.resourceTiming),this.map._refreshExpiredTiles&&N&&n.setExpiryData(N),n.loadVectorData(N,this.map.painter),s.aO(this.dispatcher),u(null,N),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,u){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class pa extends s.E{constructor(n,u,p,y){super(),this.id=n,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},u),Object.assign(this,s.aH(u,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const u=this.map.getWorldview();this._tileJSONRequest=Ll(this._options,this.map._requestManager,null,u,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new s.y(p)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=_s.fromTileJSON(y),bi(y.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(p)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,u){const p=s.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=s.n(this.map._requestManager.transformRequest(y,s.R.Tile),(b,w,E)=>{if(delete n.request,n.aborted)return n.state="unloaded",u(null);if(b)return n.state="errored",u(b);if(!w)return u(null);const I=s.aM(E);this.map._refreshExpiredTiles&&n.setExpiryData(I),n.setTexture(w,this.map.painter),n.state="loaded",s.aO(this.dispatcher),u(null)})}abortTile(n,u){n.request&&(n.request.cancel(),delete n.request),u&&u()}unloadTile(n,u){n.texture&&n.texture instanceof s.T?(n.destroy(!1),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ys([f,n],u,p,{scaled:y=!0}={}){const{tileSize:b,buffer:w}=p,{x:E,y:I,z:R}=u;if(!isFinite(E)||!isFinite(I)||!isFinite(R))throw new Error("Invalid MRT header");const L=2**R,N=L*s.aF(f),B=L*s.aJ(n);return(function([U,W],G,{scaled:X=!0}={}){if(!G)throw new Error("bandView is undefined");const{data:K,tileSize:oe,buffer:re,offset:ne,scale:be,dimension:_e}=G;if(U<-re||U>oe+re||W<-re||W>oe+re)throw new Error(`Point (${U}, ${W}) out of bounds for tileSize=${oe}, buffer=${re}`);const ve=(W+re)*(oe+2*re)+(U+re);if(new Uint32Array(K.buffer)[ve]===4294967295)return null;let pe=[];pe=X?[]:new G.data.constructor(_e);for(let he=0;he<_e;he++)pe[he]=Math.round(1e12*(K[_e*ve+he]*be+ne))/1e12;return pe})([Math.min(Math.max(-w,Math.floor((N-E)*b)),b-1+w),Math.min(Math.max(-w,Math.floor((B-I)*b)),b-1+w)],p,{scaled:y})}class No extends pa{constructor(n,u,p,y){super(n,u,p,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},u)}triggerRepaint(n){const u=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);u&&u.enabled&&p&&u._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,u){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,s.R.Tile),b={request:y,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=y,n.actor||(n.actor=this.dispatcher.getActor());const w=(E,I,R)=>{if(delete n.request,n.aborted)return n.state="unloaded",u(null);if(E)return E.name==="AbortError"?void 0:(n.state="errored",u(E));if(this.map._refreshExpiredTiles&&I){const L=s.aM(R);n.setExpiryData(L)}if(this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!I)return u(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=I}u(null)};n.request=this.partial?n.fetchHeader(void 0,w.bind(this)):n.actor.send("loadTile",b,w.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,u){const p=n.texturePerLayer;if(n.flushAllQueues(),p.size){n.destroy(!1);for(const y of p.values())this.map.painter.saveTileTexture(y)}else n.destroy()}prepareTile(n,u,p,y){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(u,p,y,(b,w)=>{if(b)return n.state="errored",this.fire(new s.y(b)),void this.triggerRepaint(n);w&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(p,w,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:b})=>b===n),p=u&&u.fields,y=p&&p.bands&&p.bands;return y?y[0]:0}getTextureDescriptor(n,u,p){if(!n)return;const y=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;u instanceof s.aR?b=u.paint.get("raster-array-band"):u instanceof s.aS&&(b=u.paint.get("raster-particle-array-band"));const w=b||this.getInitialBand(y);if(w==null)return;if(!n.textureDescriptorPerLayer.get(u.id))return void this.prepareTile(n,y,u.id,w);if(n.updateNeeded(u.id,w)&&!p)return;const E=n.textureDescriptorPerLayer.get(u.id);return Object.assign({},E,{texture:n.texturePerLayer.get(u.id)})}getImages(n,u){const p=new Map;for(const y of n)for(const b of u){const[w,E]=b.split("/"),I=y.getLayer(w);if(!I||!I.hasBand(E)||!I.hasDataForBand(E))continue;const{bytes:R,tileSize:L,buffer:N}=I.getBandView(E),B=L+2*N,U={data:new s.q({width:B,height:B},R),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(b,U)}return p}queryRasterArrayValueByBandId(n,u,p){const y=u._mrt;return new Promise(b=>{const w={},E=new Set;for(const[I,R]of Object.entries(y.layers)){if(p.layerName&&I!==p.layerName)continue;const L={};w[I]=L;for(const{bands:N}of R.dataIndex)for(const B of N)p.bands&&!p.bands.includes(B)||(E.add(s.B(I,B)),u.fetchBand(I,null,B,U=>{s.o.frame(()=>{L[B]=U?null:ys([n.lng,n.lat],y,R.getBandView(B)),E.delete(s.B(I,B)),E.size===0&&b(w)})},!1))}E.size===0&&b(w)})}_loadTileForQuery(n,u){if(this._loadTileLoaded[n.uid])return void u(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(u);this._loadTilePending[n.uid]=[u];const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,s.R.Tile);n.actor.send("loadTile",{request:y,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(b,w,E)=>{if(b)return this._loadTilePending[n.uid].forEach(I=>I(b,null)),void delete this._loadTilePending[n.uid];if(!w)return this._loadTilePending[n.uid].forEach(I=>I(null,null)),void delete this._loadTilePending[n.uid];if(this.map._refreshExpiredTiles&&w){const I=s.aM(E);n.setExpiryData(I)}n._mrt=w,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach(I=>I(null,w)),this._loadTileLoaded[n.uid]=!0,delete this._loadTilePending[n.uid]},void 0,!0)}queryRasterArrayValueByAllBands(n,u,p){return new Promise((y,b)=>{this._loadTileForQuery(u,(w,E)=>{w?b(w):y(E?this.queryRasterArrayValueByBandId(n,u,p):null)})})}queryRasterArrayValue(n,u){const p=s.aT.convert(n),y=this.findLoadedParent(p);return y&&y._mrt?u.bands||!this.partial?this.queryRasterArrayValueByBandId(p,y,u):this.queryRasterArrayValueByAllBands(p,y,u):Promise.resolve(null)}findLoadedParent(n){const u=s.ae.fromLngLat(n,this.map.transform.tileSize),p=this.maxzoom+1,y=1<<p,b=Math.floor(u.x),w=Math.floor((u.x-b)*y),E=Math.floor(u.y*y),I=this.map.style.getSourceCache(this.id),R=new s.aQ(p,b,p,w,E);return I.findLoadedParent(R,this.minzoom)}}const rl={vector:ta,raster:pa,"raster-dem":class extends pa{constructor(f,n,u,p){super(f,n,u,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,b){y&&(f.state="errored",n(y)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=s.n(this.map._requestManager.transformRequest(u,s.R.Tile),(function(y,b,w){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(y)f.state="errored",n(y);else if(b){const E=s.aM(w);this.map._refreshExpiredTiles&&f.setExpiryData(E);const I=ImageBitmap&&b instanceof ImageBitmap&&s.r(),R=1-(b.width-s.aP(b.width))/2;R<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const L=I?b:s.o.getImageData(b,R),N={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:R};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",N,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const n=f.canonical,u=Math.pow(2,n.z),p=(n.x-1+u)%u,y=n.x===0?f.wrap-1:f.wrap,b=(n.x+1+u)%u,w=n.x+1===u?f.wrap+1:f.wrap,E={};return E[new s.aQ(f.overscaledZ,y,n.z,p,n.y).key]={backfilled:!1},E[new s.aQ(f.overscaledZ,w,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(E[new s.aQ(f.overscaledZ,y,n.z,p,n.y-1).key]={backfilled:!1},E[new s.aQ(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},E[new s.aQ(f.overscaledZ,w,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<u&&(E[new s.aQ(f.overscaledZ,y,n.z,p,n.y+1).key]={backfilled:!1},E[new s.aQ(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},E[new s.aQ(f.overscaledZ,w,n.z,b,n.y+1).key]={backfilled:!1}),E}},"raster-array":No,geojson:class extends s.E{constructor(f,n,u,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(p),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:s.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const u of this._data.features)n.set(u.id,u);for(const u of f.features)n.set(u.id,u);this._data.features=[...n.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterLeaves(f,n,u,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:n,offset:u},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:f},this.workerOptions);n.scope=this.scope;const u=this._data;typeof u=="string"?(n.request=this.map._requestManager.transformRequest(s.o.resolveURL(u),s.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(p,y)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.y(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new s.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,n){const u=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,y=p?{image:p.image.clone()}:null,b=this._partialReload,w={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};f.request=this.actor.send(u,w,(E,I)=>b&&!I?(f.state="loaded",n(null)):(delete f.request,f.destroy(!1),f.aborted?n(null):E?n(E):(f.loadVectorData(I,this.map.painter,u==="reloadTile"),n(null))),void 0,u==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,n){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aU{constructor(f,n,u,p){super(f,n,u,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aV(this.urls,(n,u)=>{this._loaded=!0,n?this.fire(new s.y(n)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(f,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aU,model:s.aX,"batched-model":class extends s.E{constructor(f,n,u,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Ll(this._options,this.map._requestManager,n,u,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new s.y(p))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new _s(y.bounds,this.minzoom,this.maxzoom)),bi(y.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,n){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(u,s.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=n;else{if(f.buckets){const b=Object.values(f.buckets);for(const w of b)w.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);function y(b,w){return f.aborted?n(null):b&&b.status!==404?n(b):(this.map._refreshExpiredTiles&&w&&f.setExpiryData(w),f.loadModelData(w,this.map.painter),f.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aU{constructor(f,n,u,p){super(f,n,u,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new s.y(new s.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof s.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends s.E{constructor(f,n,u,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _s(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:u,z:p}=f.canonical;return this._implementation.hasTile({x:n,y:u,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:u,y:p,z:y}=f.tileID.canonical,b=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:u,y:p,z:y},{signal:b.signal})).then((function(w){return delete f.request,f.aborted?(f.state="unloaded",n(null)):w===void 0?(f.state="errored",n(null)):w===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null)):(function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement})(w)?(this.loadTileData(f,w),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(f.state="errored",n(w))}),f.request.cancel=()=>b.abort()}loadTileData(f,n){f.setTexture(n,this.map.painter)}unloadTile(f,n){if(f.texture&&f.texture instanceof s.T?(f.destroy(!1),f.texture&&f.texture instanceof s.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:u,y:p,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:p,z:y})}n&&n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},cc=function(f,n,u,p){const y=new rl[n.type](f,n,u,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return s.aY(["load","abort","unload","serialize","prepare"],y),y};function ks(f,n,u=""){return`${u}:${n.id||""}:${n.layer.id}:${(function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:y,importId:b}=p;return`featureset:${y}${b?`:import:${b}`:""}`}})(f.target)}`}function nh(f,n,u,p=""){if(f.uniqueFeatureID){const y=ks(f,n,p);if(u.has(y))return!0;u.add(y)}return!1}function rh(f,n,u,p,y=!1,b=void 0){const w=n.sourceCache.transform,E=n.sourceCache.tilesIn(f,n.has3DLayers,y);E.sort(Kp);const I=[];for(const R of E){const L=R.tile.queryRenderedFeatures(n,R,u,p,w,y,b);Object.keys(L).length&&I.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:L})}for(const R in n.layers){const L=n.layers[R];if(L.styleLayer){const N=L.styleLayer.queryRenderedFeatures(f,n.sourceCache,p);Object.keys(N).length&&I.push({wrappedTileID:0,queryResults:N})}}return I.length===0?{}:(function(R){const L={},N={};for(const B of R){const U=B.queryResults,W=B.wrappedTileID,G=N[W]=N[W]||{};for(const X in U){const K=U[X],oe=G[X]=G[X]||{},re=L[X]=L[X]||[];for(const ne of K)oe[ne.featureIndex]||(oe[ne.featureIndex]=!0,re.push(ne))}}return L})(I)}function Uy(f,n,u,p,y,b){const w={},E=p.queryRenderedSymbols(f),I=[];for(const R of Object.keys(E).map(Number))I.push(y[R]);I.sort(Kp);for(const R of I){const L=R.featureIndex.lookupSymbolFeatures(E[R.bucketInstanceId],R.bucketIndex,R.sourceLayerIndex,n,u,b);for(const N in L){const B=w[N]=w[N]||[],U=L[N];U.sort((W,G)=>{const X=R.featureSortOrder;if(X){const K=X.indexOf(W.featureIndex);return X.indexOf(G.featureIndex)-K}return G.featureIndex-W.featureIndex});for(const W of U)B.push(W)}}return w}function $y(f,n){const u=f.getRenderableIds().map(b=>f.getTileByID(b)),p=[],y={};for(let b=0;b<u.length;b++){const w=u[b],E=w.tileID.canonical.key;y[E]||(y[E]=!0,w.querySourceFeatures(p,n))}return p}function Kp(f,n){const u=f.tileID,p=n.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}function Qp(f,n){const u={};if(!n)return u;for(const p of f){const y=p.layerIds.map(b=>n.getLayer(b)).filter(Boolean);if(y.length!==0){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(b=>y.filter(w=>w.id===b)[0]));for(const b of y)u[b.fqid]=p}}return u}const _o=32,Os=33,ol=new Uint16Array(8184);for(let f=0;f<2046;f++){let n=f+2,u=0,p=0,y=0,b=0,w=0,E=0;for(1&n?y=b=w=_o:u=p=E=_o;(n>>=1)>1;){const R=u+y>>1,L=p+b>>1;1&n?(y=u,b=p,u=w,p=E):(u=y,p=b,y=w,b=E),w=R,E=L}const I=4*f;ol[I+0]=u,ol[I+1]=p,ol[I+2]=y,ol[I+3]=b}const Fs=new Uint16Array(2178),La=new Uint8Array(1089),Hc=new Uint16Array(1089);function Zc(f){return f===0?-.03125:f===32?.03125:0}const uc={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Dl{constructor(n,u,p,y,b,w){this.tileID=n,this.uid=s.b2(),this.uses=0,this.tileSize=u,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=w,this._hasAppearances=null}registerFadeDuration(n){const u=n+this.timeAdded;u<s.o.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,u,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Qp(n.buckets,u.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof s.b4){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof s.b4&&b.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],w=u.style.getOwnLayer(y);if(!w)continue;const E=w.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,E)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,u,p){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,Qp(n.buckets,u.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n,u){for(const b in this.buckets){const w=this.buckets[b];if(w.uploadPending()){let E={},I=[],R={zoom:0,pitch:0,brightness:0,worldview:""};if(u){if(u.style){I=u.style.listImages();const L=w.layers[0],N=L.sourceLayer||"_geojsonTileLayer",B=u.style.getLayerSourceCache(L);B&&(E=B._state.getState(N,void 0))}R={zoom:u.transform.zoom||0,pitch:u.transform.pitch||0,brightness:u.style.getBrightness()||0,worldview:u.worldview||""}}w.upload(n,this.tileID.canonical,E,I,R)}}const p=n.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new s.T(n,y.image,p.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(n,u,p){if(this.imageAtlas&&this.imageAtlasTexture&&u){const b=u.style.getLut(p);this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p,b)}if(!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=u.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(u)),(this._lastUpdatedBrightness||y||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(u,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}evaluateQueryRenderedFeaturePadding(){let n=0;for(const u in this.buckets){const p=this.buckets[u];p.evaluateQueryRenderedFeaturePadding&&(n=Math.max(n,p.evaluateQueryRenderedFeaturePadding()))}return n}queryRenderedFeatures(n,u,p,y,b,w,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=this.evaluateQueryRenderedFeaturePadding(),R=(function(L,N){const B=s.bq([],[.5*L.width,.5*-L.height,1]);return s.br(B,B,[1,-1,0]),s.aB(B,B,L.calculateProjMatrix(N.toUnwrapped())),Float32Array.from(B)})(b,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:u,pixelPosMatrix:R,transform:y,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:I,scope:E})}querySourceFeatures(n,u){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),b=u?u.sourceLayer:"",w=y._geojsonTileLayer||y[b];if(!w)return;const E=s.b6(u&&u.filter),{z:I,x:R,y:L}=this.tileID.canonical,N={z:I,x:R,y:L};for(let B=0;B<w.length;B++){const U=w.feature(B);if(E.needGeometry){const X=s.b7(U,!0);if(!E.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),X,this.tileID.canonical))continue}else if(!E.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),U))continue;const W=p.getId(U,b),G=new s.b8(U,I,R,L,W);G.tile=N,n.push(G)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const u=this.expirationTime;if(n.cacheControl){const p=s.b9(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(u)if(this.expirationTime<u)y=!0;else{const b=this.expirationTime-u;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}hasAppearances(n){for(const u in this.buckets)if(n.style.hasLayer(u)&&this.buckets[u].layers.some(p=>p.appearances&&p.appearances.length>0))return!0;return!1}updateBuckets(n,u){if(!this.latestFeatureIndex||!n.style)return;const p=n.style.listImages(),y=n.style.getBrightness();for(const b in this.buckets){if(!n.style.hasLayer(b))continue;const w=this.buckets[b],E=w.layers[0],I=E.sourceLayer||"_geojsonTileLayer",R=n.style.getLayerSourceCache(E);let L={};R&&(L=R._state.getState(I,void 0));const N=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},B=Object.keys(L).length>0&&!u;w.hasAppearances=w.layers.some(G=>G.appearances&&G.appearances.length>0);const U=B?w.stateDependentLayers:w.layers;if(B&&w.stateDependentLayers.length!==0||u){const G=this.latestFeatureIndex.loadVTLayers();w.update(L,G[I],p,N,U,u,y)}if(B&&w.stateDependentLayers.length!==0||u||w.hasAppearances){const G={zoom:n.transform.zoom,pitch:n.transform.pitch,brightness:n.style.getBrightness()||0,worldview:n.worldview};w.updateAppearances(this.tileID.canonical,L,p,G,n.imageManager)}(w instanceof s.ba||w instanceof s.bb)&&n._terrain&&n._terrain.enabled&&R&&w.uploadPending()&&n._terrain._clearRenderCacheForTile(R.id,this.tileID);const W=n&&n.style&&n.style.getOwnLayer(b);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.o.now()+n}setTexture(n,u){const p=u.context,y=p.gl;this.texture=this.texture||u.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n):(this.texture=new s.T(p,n,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(n,u){const p={};for(const y of u)p[y]=!0;this.dependencies[n]=p}hasDependency(n,u){for(const p of n){const y=this.dependencies[p];if(y){for(const b of u)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const p=s.bc(uc,this.tileID.canonical,this.tileTransform)[0],y=new s.bd,b=new s.be;for(let w=0;w<p.length;w++){const{x:E,y:I}=p[w];y.emplaceBack(E,I),b.emplaceBack(w)}b.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(y,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(n,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const p=s.bc(uc,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const w=(function(E,I){const R=s.aZ(E,I),L=Math.pow(2,E.z);for(let X=0;X<Os;X++)for(let K=0;K<Os;K++){const oe=s.a_((E.x+(K+Zc(K))/_o)/L),re=s.a$((E.y+(X+Zc(X))/_o)/L),ne=I.project(oe,re),be=X*Os+K;Fs[2*be+0]=Math.round((ne.x*R.scale-R.x)*s.al),Fs[2*be+1]=Math.round((ne.y*R.scale-R.y)*s.al)}La.fill(0),Hc.fill(0);for(let X=2045;X>=0;X--){const K=4*X,oe=ol[K+0],re=ol[K+1],ne=ol[K+2],be=ol[K+3],_e=oe+ne>>1,ve=re+be>>1,pe=_e+ve-re,he=ve+oe-_e,Se=re*Os+oe,ze=be*Os+ne,Le=ve*Os+_e,Ze=Math.hypot((Fs[2*Se+0]+Fs[2*ze+0])/2-Fs[2*Le+0],(Fs[2*Se+1]+Fs[2*ze+1])/2-Fs[2*Le+1])>=16;La[Le]=La[Le]||(Ze?1:0),X<1022&&(La[Le]=La[Le]||La[(re+he>>1)*Os+(oe+pe>>1)]||La[(be+he>>1)*Os+(ne+pe>>1)])}const N=new s.b1,B=new s.b0;let U=0;function W(X,K){const oe=K*Os+X;return Hc[oe]===0&&(N.emplaceBack(Fs[2*oe+0],Fs[2*oe+1],X*s.al/_o,K*s.al/_o),Hc[oe]=++U),Hc[oe]-1}function G(X,K,oe,re,ne,be){const _e=X+oe>>1,ve=K+re>>1;if(Math.abs(X-ne)+Math.abs(K-be)>1&&La[ve*Os+_e])G(ne,be,X,K,_e,ve),G(oe,re,ne,be,_e,ve);else{const pe=W(X,K),he=W(oe,re),Se=W(ne,be);B.emplaceBack(pe,he,Se)}}return G(0,0,_o,_o,_o,0),G(_o,_o,0,0,0,_o),{vertices:N,indices:B}})(this.tileID.canonical,u);y=w.vertices,b=w.indices}else{y=new s.b1,b=new s.b0;for(const{x:E,y:I}of p)y.emplaceBack(E,I,0,0);const w=s.bh(y.int16.subarray(0,4*y.length),void 0,4);for(let E=0;E<w.length;E+=3)b.emplaceBack(w[E],w[E+1],w[E+2])}this._tileBoundsBuffer=n.createVertexBuffer(y,s.bi.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(b),this._tileBoundsSegments=s.bg.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(n,u){const p=u.projection;if(!p||p.name!=="globe"||u.freezeTileCoverage)return;const y=this.tileID.canonical,b=s.bj(y,u),w=s.bk(b),E=s.aj(u.zoom);let I;E>0&&(I=s.bl(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,y,u,w,I,E),this._makeGlobeTileDebugTextBuffer(n,y,u,w,I,E)}_globePoint(n,u,p,y,b,w,E){let I=s.bm(n,u,p);if(w){const R=1<<p.z,L=s.aF(y.center.lng),N=s.aJ(y.center.lat),B=(p.x+.5)/R-L;let U=0;B>.5?U=-1:B<-.5&&(U=1);let W=(n/s.al+p.x)/R+U,G=(u/s.al+p.y)/R;W=(W-L)*y._pixelsPerMercatorPixel+L,G=(G-N)*y._pixelsPerMercatorPixel+N;const X=[W*y.worldSize,G*y.worldSize,0];s.af(X,X,w),I=s.bn(I,X,E)}return s.af(I,I,b)}_makeGlobeTileDebugBorderBuffer(n,u,p,y,b,w){const E=new s.bd,I=new s.be,R=new s.bo,L=(B,U,W,G,X)=>{const K=(W-B)/(X-1),oe=(G-U)/(X-1),re=E.length;for(let ne=0;ne<X;ne++){const be=B+ne*K,_e=U+ne*oe;E.emplaceBack(be,_e);const ve=this._globePoint(be,_e,u,p,y,b,w);R.emplaceBack(ve[0],ve[1],ve[2]),I.emplaceBack(re+ne)}},N=s.al;L(0,0,N,0,16),L(N,0,N,N,16),L(N,N,0,N,16),L(0,N,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(I),this._tileDebugBuffer=n.createVertexBuffer(E,s.bf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(R,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,E.length,I.length)}_makeGlobeTileDebugTextBuffer(n,u,p,y,b,w){const E=s.al/4,I=new s.bd,R=new s.b0,L=new s.bo,N=25;R.reserve(32),I.reserve(N),L.reserve(N);const B=(U,W)=>N*U+W;for(let U=0;U<N;U++){const W=U*E;for(let G=0;G<N;G++){const X=G*E;I.emplaceBack(X,W);const K=this._globePoint(X,W,u,p,y,b,w);L.emplaceBack(K[0],K[1],K[2])}}for(let U=0;U<4;U++)for(let W=0;W<4;W++){const G=B(U,W),X=B(U,W+1),K=B(U+1,W),oe=B(U+1,W+1);R.emplaceBack(G,X,K),R.emplaceBack(K,X,oe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(R),this._tileDebugTextBuffer=n.createVertexBuffer(I,s.bf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(L,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,N,32)}destroy(n=!0){for(const u in this.buckets)this.buckets[u].destroy(n);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof s.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class zd extends Dl{constructor(n,u,p,y,b){super(n,u,p,y,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,u,p){const y=p.context,b=y.gl;let w=this.texturePerLayer.get(n)||p.getTileTexture(u.width);w&&w instanceof s.T?w.update(u,{premultiply:!1}):w=new s.T(y,u,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,w)}flushQueues(n){const u=this._workQueuePerLayer.get(n)||[],p=this._fetchQueuePerLayer.get(n)||[];for(;u.length;)u.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const u=this._workQueuePerLayer.get(n)||[];for(;u.length;)u.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const u=this._fetchQueuePerLayer.get(n)||[];for(;u.length;)u.pop()()}}fetchHeader(n=16384,u){const p=this._mrt=new s.bs(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.bu(y,(b,w,E)=>{if(b)u(b);else try{const I=p.getHeaderLength(w);if(I>n)return void(this.request=this.fetchHeader(I,u));p.parseHeader(w),this._isHeaderLoaded=!0;let R=0;for(const L of Object.values(p.layers))R=Math.max(R,L.dataIndex[L.dataIndex.length-1].lastByte);w.byteLength>=R&&(this.entireBuffer=w),u(null,this.entireBuffer||w,E)}catch(I){u(I)}}),this.request}fetchBandForRender(n,u,p,y){this.fetchBand(n,u,p,b=>{if(b)return void y(b);this.updateTextureDescriptor(n,u,p);const w=this.textureDescriptorPerLayer.get(u);y(null,w?w.img:null)})}fetchBand(n,u,p,y,b=!0){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void y(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void y(new Error("Can't fetch tile band without an actor"));let I;const R=s.B(String(p),s.B(this.tileID.key,n));let L=this._taskQueue.get(R);L?L.add(y):(L=new Set,L.add(y),this._taskQueue.set(R,L));const N=(G,X)=>{I.complete(G,X),G?y(G):(L.forEach(K=>K(null,X)),this._taskQueue.delete(R))},B=(G,X)=>{if(G)return y(G);const K=E.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:X,task:I},N,void 0,!0);if(u!==null){const oe=this._workQueuePerLayer.get(u)||[];oe.push(()=>{K&&K.cancel(),I.cancel()}),this._workQueuePerLayer.has(u)||this._workQueuePerLayer.set(u,oe)}};let U;try{U=w.getLayer(n)}catch(G){if(this.state==="reloading")return;throw G}if(!U)return void y(new Error(`Unknown sourceLayer "${n}"`));if(U.hasDataForBand(p))return L.forEach(G=>G(null,null)),void this._taskQueue.delete(R);const W=U.getDataRange([p]);if(I=w.createDecodingTask(W),!I||I.tasks.length)if(u!==null&&this.flushQueues(u),this.entireBuffer)B(null,this.entireBuffer.slice(W.firstByte,W.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${W.firstByte}-${W.lastByte}`}}),X=s.bu(G,B);if(u!==null){const K=this._fetchQueuePerLayer.get(u)||[];K.push(()=>{X.cancel(),I.cancel()}),this._fetchQueuePerLayer.has(u)||this._fetchQueuePerLayer.set(u,K)}}}updateNeeded(n,u){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==u||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,u,p){if(!this._mrt)return;const y=this._mrt.getLayer(n);if(!y||!y.hasBand(p)||!y.hasDataForBand(p))return;const{bytes:b,tileSize:w,buffer:E,offset:I,scale:R}=y.getBandView(p),L=w+2*E,N=new s.q({width:L,height:L},b),B=this.texturePerLayer.get(u);B&&B instanceof s.T&&B.update(N,{premultiply:!1}),this.textureDescriptorPerLayer.set(u,{layer:n,band:p,img:N,buffer:E,offset:I,tileSize:w,format:y.pixelFormat,mix:[R,256*R,65536*R,16777216*R]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const u of this.texturePerLayer.values())u&&u instanceof s.T&&u.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Vy{constructor(n,u){this.max=n,this.onRemove=u,this.reset()}reset(){for(const n in this.data)for(const u of this.data[n])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(n,u,p){const y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:u,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(n,b)},p)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value}getByKey(n){const u=this.data[n];return u?u[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,u){if(!this.has(n))return this;const p=n.wrapped().key,y=u===void 0?0:this.data[p].indexOf(u),b=this.data[p][y];return this.data[p].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(n){const u=[];for(const p in this.data)for(const y of this.data[p])n(y.value)||u.push(y);for(const p of u)this.remove(p.value.tileID,p)}}class jy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,u,p){const y=String(u);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][y]=this.stateChanges[n][y]||{},Object.assign(this.stateChanges[n][y],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==y&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][y]===null){this.deletedStates[n][y]={};for(const b in this.state[n][y])p[b]||(this.deletedStates[n][y][b]=null)}else for(const b in p)this.deletedStates[n]&&this.deletedStates[n][y]&&this.deletedStates[n][y][b]===null&&delete this.deletedStates[n][y][b]}removeFeatureState(n,u,p){if(this.deletedStates[n]===null)return;const y=String(u);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&u!==void 0)this.deletedStates[n][y]!==null&&(this.deletedStates[n][y]=this.deletedStates[n][y]||{},this.deletedStates[n][y][p]=null);else if(u!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][y])for(p in this.deletedStates[n][y]={},this.stateChanges[n][y])this.deletedStates[n][y][p]=null;else this.deletedStates[n][y]=null;else this.deletedStates[n]=null}getState(n,u){const p=this.state[n]||{},y=this.stateChanges[n]||{},b=this.deletedStates[n];if(b===null)return{};if(u!==void 0){const E=String(u),I=Object.assign({},p[E],y[E]);if(b){const R=b[u];if(R===null)return{};for(const L in R)delete I[L]}return I}const w=Object.assign({},p,y);if(b)for(const E in b)delete w[E];return w}initializeTileState(n,u){n.refreshFeatureState(u)}coalesceChanges(n,u){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const w in this.stateChanges[y])this.state[y][w]||(this.state[y][w]={}),Object.assign(this.state[y][w],this.stateChanges[y][w]),b[w]=this.state[y][w];p[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const w in this.state[y])b[w]={},this.state[y][w]={};else for(const w in this.deletedStates[y]){if(this.deletedStates[y][w]===null)this.state[y][w]={};else if(this.state[y][w])for(const E of Object.keys(this.deletedStates[y][w]))delete this.state[y][w][E];b[w]=this.state[y][w]}p[y]=p[y]||{},Object.assign(p[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const y in n)n[y].refreshFeatureState(u)}}class is extends s.E{constructor(n,u,p){super(),this.id=n,this._onlySymbols=p,u.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new Vy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new jy,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,u){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,u)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const p=this._tiles[u];p.upload(n,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(oh).map(n=>n.key)}getRenderableIds(n,u){const p=[];for(const y in this._tiles)this._isIdRenderable(+y,n,u)&&p.push(this._tiles[y]);return n?p.sort((y,b)=>{const w=y.tileID,E=b.tileID,I=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),R=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-E.overscaledZ||R.y-I.y||R.x-I.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(oh).map(y=>y.key)}hasRenderableParent(n){const u=this.findLoadedParent(n,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(n,u,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(u||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,u){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=u),this._loadTile(p,this._tileLoaded.bind(this,p,n,u)))}_tileLoaded(n,u,p,y,b){if(y){if(n.state="errored",y.status!==404)this._source.fire(new s.y(y,{tile:n}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const E=this.map.painter.terrain;this.update(this.transform,E.getScaledDemTileSize(),!0),E.resetTileLookupCache(this.id)}else this.update(this.transform)}return}n.timeAdded=s.o.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(u,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null);let w=new Map;b&&b.responseHeaders&&(w=b.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id,responseHeaders:w}))}_backfillDEM(n){const u=this.getRenderableIds();for(let y=0;y<u.length;y++){const b=u[y];if(n.neighboringTiles&&n.neighboringTiles[b]){const w=this.getTileByID(b);p(n,w),p(w,n)}}function p(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let w=b.tileID.canonical.x-y.tileID.canonical.x;const E=b.tileID.canonical.y-y.tileID.canonical.y,I=Math.pow(2,y.tileID.canonical.z),R=b.tileID.key;w===0&&E===0||Math.abs(E)>1||(Math.abs(w)>1&&(Math.abs(w+I)===1?w+=I:Math.abs(w-I)===1&&(w-=I)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,w,E),y.neighboringTiles&&y.neighboringTiles[R]&&(y.neighboringTiles[R].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,u,p,y){for(const b in this._tiles){let w=this._tiles[b];if(y[b]||!w.hasData()||w.tileID.overscaledZ<=u||w.tileID.overscaledZ>p)continue;let E=w.tileID;for(;w&&w.tileID.overscaledZ>u+1;){const R=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[R.key],w&&w.hasData()&&(E=R)}let I=E;for(;I.overscaledZ>u;)if(I=I.scaledTo(I.overscaledZ-1),n[I.key]){y[E.key]=E;break}}}findLoadedParent(n,u){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=u?p:null}for(let p=n.overscaledZ-1;p>=u;p--){const y=n.scaledTo(p),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(n){const u=this._tiles[n.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,u){u=u||this._source.tileSize;const p=Math.ceil(n.width/u)+1,y=Math.ceil(n.height/u)+1,b=Math.floor(p*y*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(E)}handleWrapJump(n){const u=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,u){const p={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),p[b.tileID.key]=b}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(n,u,p,y,b){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let E,I=this._source.maxzoom;const R=this.map&&this.map.painter?this.map.painter._terrain:null;if(R&&R.sourceCache===this&&R.attenuationRange()){const B=R.attenuationRange()[0],U=Math.floor(B)-Math.log2(R.getDemUpscale());I>U&&(I=U)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new s.aQ(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y));else if(this.tileCoverLift!==0){const B=n.clone();B.tileCoverLift=this.tileCoverLift,E=B.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&n.projection.name==="globe"&&(E.push(new s.aQ(1,0,1,0,0)),E.push(new s.aQ(1,0,1,1,0)),E.push(new s.aQ(1,0,1,0,1)),E.push(new s.aQ(1,0,1,1,1)))}else if(E=n.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);E=E.filter(U=>B(U))}}else E=[];if(E.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!sh(this._source.type)){const B=n.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),U=Math.min(B,this._source.maxzoom);if(w){const W=n.extendTileCover(E,U);for(const G of W)E.push(G)}else if(b){const W=n.extendTileCoverToNearPlane(E,this.transform.getFrustum(U),U);for(const G of W)E.push(G)}else if(this.castsShadows&&y){const W=n.extendTileCover(E,U,y,16);for(const G of W)this._shadowCasterTiles[G.key]=!0,E.push(G)}}const L=this._updateRetainedTiles(E);if(sh(this._source.type)&&E.length!==0){const B={},U={},W=Object.keys(L);for(const X of W){const K=L[X],oe=this._tiles[X];if(!oe||oe.fadeEndTime&&oe.fadeEndTime<=s.o.now())continue;const re=this.findLoadedParent(K,Math.max(K.overscaledZ-is.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),B[re.tileID.key]=re.tileID),U[X]=K}const G=E[E.length-1].overscaledZ;for(const X in this._tiles){const K=this._tiles[X];if(L[X]||!K.hasData())continue;let oe=K.tileID;for(;oe.overscaledZ>G;){oe=oe.scaledTo(oe.overscaledZ-1);const re=this._tiles[oe.key];if(re&&re.hasData()&&U[oe.key]){L[X]=K.tileID;break}}}for(const X in B)L[X]||(this._coveredTiles[X]=!0,L[X]=B[X])}for(const B in L)this._tiles[B].clearFadeHold();const N=s.bv(this._tiles,L);for(const B of N){const U=this._tiles[B];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const u={};if(n.length===0)return u;const p={},y=n.reduce((R,L)=>Math.min(R,L.overscaledZ),1/0),b=n[0].overscaledZ,w=Math.max(b-is.maxOverzooming,this._source.minzoom),E=Math.max(b+is.maxUnderzooming,this._source.minzoom),I={};for(const R of n){const L=this._addTile(R);u[R.key]=R,L.hasData()||y<this._source.maxzoom&&(I[R.key]=R)}this._retainLoadedChildren(I,y,E,u);for(const R of n){let L=this._tiles[R.key];if(L.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const B=R.children(this._source.maxzoom)[0],U=this.getTile(B);if(U&&U.hasData()){u[B.key]=B;continue}}else{const B=R.children(this._source.maxzoom);if(u[B[0].key]&&u[B[1].key]&&u[B[2].key]&&u[B[3].key])continue}let N=L.wasRequested();for(let B=R.overscaledZ-1;B>=w;--B){const U=R.scaledTo(B);if(p[U.key]||(p[U.key]=!0,L=this.getTile(U),!L&&N&&(L=this._addTile(U)),L&&(u[U.key]=U,N=L.wasRequested(),L.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const u=[];let p,y=this._tiles[n].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}u.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;y=b}for(const b of u)this._loadedParentTiles[b]=p}}_addTile(n){let u=this._tiles[n.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),u;u=this._cache.getAndRemove(n),u&&(this._setTileReloadTimer(n.key,u),u.tileID=n,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,u)));const p=!!u;if(!p){const y=this.map?this.map.painter:null,b=this._source.tileSize*n.overscaleFactor();u=this._source.type==="raster-array"?new zd(n,b,this.transform.tileZoom,y,this._isRaster):new Dl(n,b,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(u,this._tileLoaded.bind(this,u,n.key,u.state))}return u.uses++,this._tiles[n.key]=u,p||this._source.fire(new s.z("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(n,u){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=u.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const u=this._tiles[n];u&&(u.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,u,p){const y=[],b=this.transform;if(!b)return y;const w=b.projection.name==="globe",E=s.aF(b.center.lng);for(const I in this._tiles){const R=this._tiles[I];if(p&&R.clearQueryDebugViz(),R.holdingForFade())continue;let L;if(w){const N=R.tileID.canonical;if(N.z===0){const B=[Math.abs(s.aA(E,...sl(N,-1))-E),Math.abs(s.aA(E,...sl(N,1))-E)];L=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(s.aA(E,...sl(N,-1))-E),Math.abs(s.aA(E,...sl(N,0))-E),Math.abs(s.aA(E,...sl(N,1))-E)];L=[B.indexOf(Math.min(...B))-1]}}else L=[0];for(const N of L){const B=n.containsTile(R,b,u,N);B&&y.push(B)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,u){const p=this.getRenderableIds(n,u).map(b=>this._tiles[b].tileID),y=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(n){const u=n.slice(),p=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const w of u){const E=1/(1<<w.canonical.z);b[w.key]=((w.canonical.x+.5)*E+w.wrap-p[0])*y[0]+((w.canonical.y+.5)*E-p[1])*y[1]-p[2]*y[2]}return u.sort((w,E)=>b[w.key]-b[E.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(sh(this._source.type))for(const n in this._tiles){const u=this._tiles[n];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(n,u,p){this._state.updateState(n=n||"_geojsonTileLayer",u,p)}removeFeatureState(n,u,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",u,p)}getFeatureState(n,u){return this._state.getState(n=n||"_geojsonTileLayer",u)}setDependencies(n,u,p){const y=this._tiles[n];y&&y.setDependencies(u,p)}reloadTilesForDependencies(n,u){for(const p in this._tiles)this._tiles[p].hasDependency(n,u)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(n,u))}_preloadTiles(n,u){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(n,u))};return void this._source.on("data",I)}const p=new Map,y=Array.isArray(n)?n:[n],b=this.map.painter.terrain,w=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const I of y){const R=I.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of R)p.set(L.key,L);this.usedForTerrain&&I.updateElevation(!1)}const E=Array.from(p.values());s.bw(E,(I,R)=>{const L=new Dl(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(L,N=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),R(N,L)})},u)}}function oh(f,n){const u=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return f.overscaledZ-n.overscaledZ||p-u||n.canonical.y-f.canonical.y||n.canonical.x-f.canonical.x}function sh(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function sl(f,n){const u=1<<f.z;return[f.x/u+n,(f.x+1)/u+n]}is.maxOverzooming=10,is.maxUnderzooming=3;class ah{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,u=!1;for(const p in this.style._mergedLayers){const y=this.style._mergedLayers[p];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:n,visibilityChanged:u});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:n,visibilityChanged:u})}}}onNewFrame(n){this.layersGotHidden=!1;for(const u of this.layers){const p=u.layer;let y=!1;p.type==="fill-extrusion"?y=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?y=!p.isHidden(n)&&p.paint.get("building-opacity")>0:p.type==="model"&&(y=!p.isHidden(n)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&u.visible,u.visible=y}}updateZOffset(n,u){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,w=this.style.getLayerSourceCache(b);let E=1;b.type==="fill-extrusion"?E=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(E=y.visible?b.paint.get("building-vertical-scale"):0);let I=w?w.getTile(u):null;if(!I&&w)for(const R in w._tiles){const L=w._tiles[R];if(u.canonical.isChildOf(L.tileID.canonical)){I=L;break}}this.currentBuildingBuckets.push({bucket:I?I.getBucket(b):null,tileID:I?I.tileID:u,verticalScale:E})}n.hasAnyZOffset=!1;let p=!1;for(let y=0;y<n.symbolInstances.length;y++){const b=n.symbolInstances.get(y),w=b.zOffset,E=this._getHeightAtTileOffset(u,b.tileAnchorX,b.tileAnchorY);b.zOffset=E!==Number.NEGATIVE_INFINITY?E:w,p||w===b.zOffset||(p=!0),n.hasAnyZOffset||b.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,u,p,y){let b=u,w=p;if(n.canonical.z!==y.canonical.z){const E=y.canonical,I=1/(1<<n.canonical.z-E.z);b=(u+n.canonical.x*s.al)*I-E.x*s.al|0,w=(p+n.canonical.y*s.al)*I-E.y*s.al|0}return{tileX:b,tileY:w}}_getHeightAtTileOffset(n,u,p){let y,b;for(let w=0;w<this.layers.length;++w){const E=this.layers[w].layer;if(E.type!=="fill-extrusion"&&E.type!=="building")continue;const{bucket:I,tileID:R,verticalScale:L}=this.currentBuildingBuckets[w];if(!I)continue;const{tileX:N,tileY:B}=this._mapCoordToOverlappingTile(n,u,p,R),U=I.getHeightAtTileCoord(N,B);U&&U.height!==void 0&&(U.hidden?y=U.height:b=Math.max(U.height*L,b||0))}if(b!==void 0)return b;for(let w=0;w<this.layers.length;++w){const E=this.layers[w];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:I,tileID:R}=this.currentBuildingBuckets[w];if(!I)continue;const{tileX:L,tileY:N}=this._mapCoordToOverlappingTile(n,u,p,R),B=I.getHeightAtTileCoord(L,N);if(B&&!B.hidden)return B.height===void 0&&y!==void 0?Math.min(B.maxHeight,y)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function jw(f,n){const u={};for(const p in f)p!=="ref"&&(u[p]=f[p]);return s.bx.forEach(p=>{p in n&&(u[p]=n[p])}),u}function em(f){f=f.slice();const n=Object.create(null);for(let u=0;u<f.length;u++)n[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=jw(f[u],n[f[u].ref]));return f}const un={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Wc(f,n,u){u.push({command:un.addSource,args:[f,n[f]]})}function Cd(f,n,u){n.push({command:un.removeSource,args:[f]}),u[f]=!0}function Gy(f,n,u,p){Cd(f,u,p),Wc(f,n,u)}function Hy(f,n,u){let p;for(p in f[u])if(f[u].hasOwnProperty(p)&&p!=="data"&&!s.by(f[u][p],n[u][p]))return!1;for(p in n[u])if(n[u].hasOwnProperty(p)&&p!=="data"&&!s.by(f[u][p],n[u][p]))return!1;return!0}function lh(f,n,u,p,y,b){let w;for(w in n=n||{},f=f||{})f.hasOwnProperty(w)&&(s.by(f[w],n[w])||u.push({command:b,args:[p,w,n[w],y]}));for(w in n)n.hasOwnProperty(w)&&!f.hasOwnProperty(w)&&(s.by(f[w],n[w])||u.push({command:b,args:[p,w,n[w],y]}))}function kl(f){return f.id}function ch(f,n){return f[n.id]=n,f}function Rd(f,n,u){const p=n.createTileMatrix(f,f.worldSize,u.toUnwrapped());return s.aB(new Float32Array(16),f.projMatrix,p)}function Gw(f,n,u){if(n.projection.name===u.projection.name)return f.projMatrix;const p=u.clone();return p.setProjection(n.projection),Rd(p,n.getProjection(),f)}function qc(f,n,u){return n.name===u.projection.name?f.projMatrix:Rd(u,n,f)}class al{constructor(n,u){this.reset(n,u)}reset(n,u){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.aA(n,0,1);let u=1,p=this._distances[u];const y=n*this.paddedLength+this.padding;for(;p<y&&u<this._distances.length;)p=this._distances[++u];const b=u-1,w=this._distances[b],E=p-w,I=E>0?(y-w)/E:0;return this.points[b].mult(1-I).add(this.points[u].mult(I))}}class uh{constructor(n,u,p){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(u/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,u,p,y,b){this._forEachCell(u,p,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(n,u,p,y){this._forEachCell(u-y,p-y,u+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(p),this.circles.push(y)}_insertBoxCell(n,u,p,y,b,w){this.boxCells[b].push(w)}_insertCircleCell(n,u,p,y,b,w){this.circleCells[b].push(w)}_query(n,u,p,y,b,w){if(p<0||n>this.width||y<0||u>this.height)return!b&&[];const E=[];if(n<=0&&u<=0&&this.width<=p&&this.height<=y){if(b)return!0;for(let I=0;I<this.boxKeys.length;I++)E.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const R=this.circles[3*I],L=this.circles[3*I+1],N=this.circles[3*I+2];E.push({key:this.circleKeys[I],x1:R-N,y1:L-N,x2:R+N,y2:L+N})}return w?E.filter(w):E}return this._forEachCell(n,u,p,y,this._queryCell,E,{hitTest:b,seenUids:{box:{},circle:{}}},w),b?E.length>0:E}_queryCircle(n,u,p,y,b){const w=n-p,E=n+p,I=u-p,R=u+p;if(E<0||w>this.width||R<0||I>this.height)return!y&&[];const L=[];return this._forEachCell(w,I,E,R,this._queryCellCircle,L,{hitTest:y,circle:{x:n,y:u,radius:p},seenUids:{box:{},circle:{}}},b),y?L.length>0:L}query(n,u,p,y,b){return this._query(n,u,p,y,!1,b)}hitTest(n,u,p,y,b){return this._query(n,u,p,y,!0,b)}hitTestCircle(n,u,p,y){return this._queryCircle(n,u,p,!0,y)}_queryCell(n,u,p,y,b,w,E,I){const R=E.seenUids,L=this.boxCells[b];if(L!==null){const B=this.bboxes;for(const U of L)if(!R.box[U]){R.box[U]=!0;const W=4*U;if(n<=B[W+2]&&u<=B[W+3]&&p>=B[W+0]&&y>=B[W+1]&&(!I||I(this.boxKeys[U]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[U],x1:B[W],y1:B[W+1],x2:B[W+2],y2:B[W+3]})}}}const N=this.circleCells[b];if(N!==null){const B=this.circles;for(const U of N)if(!R.circle[U]){R.circle[U]=!0;const W=3*U;if(this._circleAndRectCollide(B[W],B[W+1],B[W+2],n,u,p,y)&&(!I||I(this.circleKeys[U]))){if(E.hitTest)return w.push(!0),!0;{const G=B[W],X=B[W+1],K=B[W+2];w.push({key:this.circleKeys[U],x1:G-K,y1:X-K,x2:G+K,y2:X+K})}}}}}_queryCellCircle(n,u,p,y,b,w,E,I){const R=E.circle,L=E.seenUids,N=this.boxCells[b];if(N!==null){const U=this.bboxes;for(const W of N)if(!L.box[W]){L.box[W]=!0;const G=4*W;if(this._circleAndRectCollide(R.x,R.y,R.radius,U[G+0],U[G+1],U[G+2],U[G+3])&&(!I||I(this.boxKeys[W])))return w.push(!0),!0}}const B=this.circleCells[b];if(B!==null){const U=this.circles;for(const W of B)if(!L.circle[W]){L.circle[W]=!0;const G=3*W;if(this._circlesCollide(U[G],U[G+1],U[G+2],R.x,R.y,R.radius)&&(!I||I(this.circleKeys[W])))return w.push(!0),!0}}}_forEachCell(n,u,p,y,b,w,E,I){const R=this._convertToXCellCoord(n),L=this._convertToYCellCoord(u),N=this._convertToXCellCoord(p),B=this._convertToYCellCoord(y);for(let U=R;U<=N;U++)for(let W=L;W<=B;W++)if(b.call(this,n,u,p,y,this.xCellCount*W+U,w,E,I))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,u,p,y,b,w){const E=y-n,I=b-u,R=p+w;return R*R>E*E+I*I}_circleAndRectCollide(n,u,p,y,b,w,E){const I=(w-y)/2,R=Math.abs(n-(y+I));if(R>I+p)return!1;const L=(E-b)/2,N=Math.abs(u-(b+L));if(N>L+p)return!1;if(R<=I||N<=L)return!0;const B=R-I,U=N-L;return B*B+U*U<=p*p}}const Zy=Math.tan(85*Math.PI/180);function hc(f,n,u,p,y,b,w){const E=s.bC();if(u)if(b.name==="globe"){const I=s.bD(y,n);s.aB(E,E,I)}else{const I=s.bE([],w);E[0]=I[0],E[1]=I[1],E[4]=I[2],E[5]=I[3],p||s.bB(E,E,y.angle)}else s.aB(E,y.labelPlaneMatrix,f);return E}function ll(f,n,u,p,y,b,w){const E=hc(f,n,u,p,y,b,w);return b.name==="globe"&&u||(E[2]=E[6]=E[10]=E[14]=0),E}function ns(f,n,u,p,y,b,w){if(u){if(b.name==="globe"){const E=hc(f,n,u,p,y,b,w);return s.bl(E,E),s.aB(E,f,E),E}{const E=s.bz(f),I=s.bA([]);return I[0]=w[0],I[1]=w[1],I[4]=w[2],I[5]=w[3],s.aB(E,E,I),p||s.bB(E,E,-y.angle),E}}return y.glCoordMatrix}function ia(f,n,u,p){const y=[f,n,u,1];u?s.aC(y,y,p):Dd(y,y,p);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function Ld(f,n){return Math.min(.5+f/n*.5,1.5)}function Wy(f,n){const u=f[0]/f[3],p=f[1]/f[3];return u>=-n[0]&&u<=n[0]&&p>=-n[1]&&p<=n[1]}function bn(f,n,u,p,y,b,w,E,I,R,L=1){const N=u.transform,B=p?f.textSizeData:f.iconSizeData,U=s.bK(B,u.transform.zoom,L),W=N.projection.name==="globe",G=[256/u.width*2+1,256/u.height*2+1],X=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;X.clear();let K=null;W&&(K=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const oe=f.lineVertexArray,re=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ne=u.transform.width/u.transform.height;let be,_e=!1;for(let ve=0;ve<re.length;ve++){const pe=re.get(ve),{numGlyphs:he,writingMode:Se}=pe;if(Se!==s.bL.vertical||_e||be===s.bL.horizontal||(_e=!0),be=Se,(pe.hidden||Se===s.bL.vertical)&&!_e){Uo(he,X);continue}_e=!1;const ze=new s.P(pe.tileAnchorX,pe.tileAnchorY),Le=f.elevationType==="road",Ze=!!N.elevation||Le;let{x:je,y:tt,z:dt}=N.projection.projectTilePoint(ze.x,ze.y,R.canonical),Fe=null;if(Ze){const jt=Le?f.getElevationFeatureForText(ve):null;Fe={getElevation:I,elevation:N.elevation,elevationFeature:jt};const[oi,fi,Bi]=I(ze,N.elevation,jt);je+=oi,tt+=fi,dt+=Bi}const Te=[je,tt,dt,1];if(s.aC(Te,Te,n),!Wy(Te,G)){Uo(he,X);continue}const Ke=Te[3],We=Ld(u.transform.getCameraToCenterDistance(N.projection),Ke),ft=s.bM(B,U,pe),vt=w?ft/We:ft*We,At=ia(je,tt,dt,y);if(At[3]<=0){Uo(he,X);continue}let xt={};const wt=s.an(f.layers[0].layout.get("text-max-angle")),qt=Math.cos(wt),Gt=w?null:Fe,Lt=Xy(pe,vt,!1,E,n,y,b,f.glyphOffsetArray,oe,X,K,At,ze,xt,ne,Gt,N.projection,R,w,qt);_e=Lt.useVertical,Gt&&Lt.needsFlipping&&(xt={}),(Lt.notEnoughRoom||_e||Lt.needsFlipping&&Xy(pe,vt,!0,E,n,y,b,f.glyphOffsetArray,oe,X,K,At,ze,xt,ne,Gt,N.projection,R,w,qt).notEnoughRoom)&&Uo(he,X)}p?(f.text.dynamicLayoutVertexBuffer.updateData(X),K&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(K)):(f.icon.dynamicLayoutVertexBuffer.updateData(X),K&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(K))}function tm(f,n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X){const{lineStartIndex:K,glyphStartIndex:oe,segment:re}=E,ne=oe+E.numGlyphs,be=K+E.lineLength,_e=n.getoffsetX(oe),ve=n.getoffsetX(ne-1),pe=dc(f*_e,u,p,y,b,w,re,K,be,I,R,L,N,B,!0,U,W,G,X);if(!pe)return null;const he=dc(f*ve,u,p,y,b,w,re,K,be,I,R,L,N,B,!0,U,W,G,X);return he?{first:pe,last:he}:null}function qy(f,n,u,p){return f===s.bL.horizontal&&Math.abs(p)>Math.abs(u)?{useVertical:!0}:f===s.bL.vertical?p>0?{needsFlipping:!0}:null:n!==0&&(function(y,b){return y===0||Math.abs(b/y)>Zy})(u,p)?n===1?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function Xy(f,n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X,K,oe,re){const ne=n/24,be=f.lineOffsetX*ne,_e=f.lineOffsetY*ne,{lineStartIndex:ve,glyphStartIndex:pe,numGlyphs:he,segment:Se,writingMode:ze,flipState:Le}=f,Ze=ve+f.lineLength,je=tt=>{if(L){const[Ke,We,ft]=tt.up,vt=R.length;s.bN(L,vt+0,Ke,We,ft),s.bN(L,vt+1,Ke,We,ft),s.bN(L,vt+2,Ke,We,ft),s.bN(L,vt+3,Ke,We,ft)}const[dt,Fe,Te]=tt.point;s.bO(R,dt,Fe,Te,tt.angle)};if(he>1){const tt=tm(ne,E,be,_e,u,N,B,f,I,b,U,G,!1,X,K,oe,re);if(!tt)return{notEnoughRoom:!0};if(p&&!u){let[dt,Fe,Te]=tt.first.point,[Ke,We,ft]=tt.last.point;[dt,Fe]=ia(dt,Fe,Te,w),[Ke,We]=ia(Ke,We,ft,w);const vt=qy(ze,Le,(Ke-dt)*W,We-Fe);if(f.flipState=vt&&vt.needsFlipping?1:2,vt)return vt}je(tt.first);for(let dt=pe+1;dt<pe+he-1;dt++){const Fe=dc(ne*E.getoffsetX(dt),be,_e,u,N,B,Se,ve,Ze,I,b,U,G,!1,!1,X,K,oe,re);if(!Fe)return R.length-=4*(dt-pe),{notEnoughRoom:!0};je(Fe)}je(tt.last)}else{if(p&&!u){const dt=ia(B.x,B.y,0,y),Fe=ve+Se+1,Te=new s.P(I.getx(Fe),I.gety(Fe)),Ke=ia(Te.x,Te.y,0,y),We=Ke[3]>0?Ke:im(B,Te,dt,1,y,void 0,X,K.canonical),ft=qy(ze,Le,(We[0]-dt[0])*W,We[1]-dt[1]);if(f.flipState=ft&&ft.needsFlipping?1:2,ft)return ft}const tt=dc(ne*E.getoffsetX(pe),be,_e,u,N,B,Se,ve,Ze,I,b,U,G,!1,!1,X,K,oe,re);if(!tt)return{notEnoughRoom:!0};je(tt)}return{}}function hi(f,n,u,p,y){const{x:b,y:w,z:E}=p.projectTilePoint(f.x,f.y,n);if(!y)return ia(b,w,E,u);const[I,R,L]=y.getElevation(f,y.elevation,y.elevationFeature);return ia(b+I,w+R,E+L,u)}function im(f,n,u,p,y,b,w,E){const I=hi(f.sub(n)._unit()._add(f),E,y,w,b);return s.av(I,u,I),s.aw(I,I),s.bH(I,u,I,p)}function dc(f,n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X,K,oe){const re=p?f-n:f+n;let ne=re>0?1:-1,be=0;p&&(ne*=-1,be=Math.PI),ne<0&&(be+=Math.PI);let _e=E+w+(ne>0?0:1)|0,ve=y,pe=y,he=0,Se=0;const ze=Math.abs(re),Le=[],Ze=[];let je=b,tt=je,dt=s.bF([]);const Fe=()=>im(tt,je,pe,ze-he+1,L,B,G,X.canonical);for(;he+Se<=ze;){if(_e+=ne,_e<E||_e>=I)return null;if(pe=ve,tt=je,Le.push(pe),U&&Ze.push(tt),je=new s.P(R.getx(_e),R.gety(_e)),ve=N[_e],!ve){const Gt=hi(je,X.canonical,L,G,B);ve=Gt[3]>0?N[_e]=Gt:Fe()}he+=Se;const wt=s.av([],ve,pe),qt=s.bG(pe,ve);if(u&&qt>0&&Se>0&&s.bJ(dt,wt)/(Se*qt)<oe)return null;Se=qt,dt=wt}W&&B&&(N[_e]&&(ve=Fe(),Se=s.bG(pe,ve),dt=s.av([],ve,pe)),N[_e]=ve);const Te=(ze-he)/Se,Ke=je.sub(tt)._mult(Te)._add(tt),We=s.bH([],pe,dt,Te);let ft=[0,0,1],vt=dt[0],At=dt[1];if(K&&(ft=G.upVector(X.canonical,Ke.x,Ke.y),ft[0]!==0||ft[1]!==0||ft[2]!==1)){const wt=[ft[2],0,-ft[0]],qt=s.bI([],ft,wt);s.aw(wt,wt),s.aw(qt,qt),vt=s.bJ(dt,wt),At=s.bJ(dt,qt)}if(u){const wt=s.bI([],ft,dt);s.aw(wt,wt),s.bH(We,We,wt,u*ne)}const xt=be+Math.atan2(At,vt);return Le.push(We),U&&Ze.push(Ke),{point:We,angle:xt,path:Le,tilePath:Ze,up:ft}}function Uo(f,n){const u=n.length,p=u+4*f;n.resize(p),n.float32.fill(-1/0,4*u,4*p)}function Dd(f,n,u){const p=n[0],y=n[1];return f[0]=u[0]*p+u[4]*y+u[12],f[1]=u[1]*p+u[5]*y+u[13],f[3]=u[3]*p+u[7]*y+u[15],f}const rs=100;class ii{constructor(n,u,p=new uh(n.width+200,n.height+200,25),y=new uh(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+rs,this.screenBottomBoundary=n.height+rs,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=u}placeCollisionBox(n,u,p,y,b,w,E,I,R,L,N){let B=p.projectedAnchorX,U=p.projectedAnchorY,W=p.projectedAnchorZ;const G=p.tileAnchorX,X=p.tileAnchorY,K=p.elevation,oe=p.tileID,re=n.getProjection();if(K&&oe){const[Ze,je,tt]=re.upVector(oe.canonical,p.tileAnchorX,p.tileAnchorY),dt=re.upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=Ze*K*dt,U+=je*K*dt,W+=tt*K*dt}const ne=n.projection.name==="globe",be=n.projection.name==="globe"?s.aj(this.transform.zoom):0;if(oe&&ne&&be<1&&!w){const Ze=1<<oe.canonical.z,je=s.bP(G,X);s.bQ(je,je,1/s.al),s.bR(je,je,s.bP(oe.canonical.x,oe.canonical.y)),s.bQ(je,je,1/Ze),s.bS(je,je,s.bP(y[0],y[1])),je[0]=s.bT(je[0],-.5,.5),s.bQ(je,je,s.al);const tt=s.bU(je[0],je[1],s.al/(2*Math.PI),1);s.aC(tt,tt,b),B=s.ak(B,tt[0],be),U=s.ak(U,tt[1],be),W=s.ak(W,tt[2],be)}const _e=this.projectAndGetPerspectiveRatio(L,B,U,W,p.tileID,re.name==="globe"||!!K||this.transform.pitch>0,re),ve=R*_e.perspectiveRatio,pe=(p.x1*u+E.x-p.padding)*ve+_e.point.x,he=(p.y1*u+E.y-p.padding)*ve+_e.point.y,Se=(p.x2*u+E.x+p.padding)*ve+_e.point.x,ze=(p.y2*u+E.y+p.padding)*ve+_e.point.y,Le=_e.perspectiveRatio<=.55||_e.occluded;return!this.isInsideGrid(pe,he,Se,ze)||!I&&this.grid.hitTest(pe,he,Se,ze,N)||Le?{box:[],offscreen:!1,occluded:_e.occluded}:{box:[pe,he,Se,ze],offscreen:this.isOffscreen(pe,he,Se,ze),occluded:!1}}placeCollisionCircles(n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X){const K=[],oe=this.transform.elevation,re=n.getProjection(),ne=n.elevationType==="road",be=!!oe||ne,_e=s.bV.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,re),ve=new s.P(p.tileAnchorX,p.tileAnchorY),pe=new s.P(p.tileAnchorX,p.tileAnchorY);let{x:he,y:Se,z:ze}=re.projectTilePoint(pe.x,pe.y,X.canonical),Le=null;if(be){const qt=ne?n.getElevationFeatureForText(y):null;Le={getElevation:_e,elevation:oe,elevationFeature:qt};const[Gt,Lt,jt]=_e(ve,oe,qt);he+=Gt,Se+=Lt,ze+=jt}const Ze=re.name==="globe",je=this.projectAndGetPerspectiveRatio(I,he,Se,ze,X,Ze||!!oe||this.transform.pitch>0,re),{perspectiveRatio:tt}=je,dt=(B?E/tt:E*tt)/s.bY,Fe=ia(he,Se,ze,R),Te=p.lineOffsetX*dt,Ke=p.lineOffsetY*dt,We=s.an(n.layers[0].layout.get("text-max-angle")),ft=Math.cos(We),vt=je.signedDistanceFromCamera>0?tm(dt,w,Te,Ke,ne&&p.flipState===1,Fe,pe,p,b,R,{},be&&!B?Le:null,B&&be,re,X,B,ft):null;let At=!1,xt=!1,wt=!0;if(vt&&!je.occluded){const qt=.5*W*tt+G,Gt=new s.P(-100,-100),Lt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),jt=new al,{first:oi,last:fi}=vt,Bi=oi.path.length;let Qi=[];for(let Ri=Bi-1;Ri>=1;Ri--)Qi.push(oi.path[Ri]);for(let Ri=1;Ri<fi.path.length;Ri++)Qi.push(fi.path[Ri]);const Ti=2.5*qt;L&&(Qi=Qi.map(([Ri,En,wn],Mn)=>(be&&!Ze&&(wn=_e(Mn<Bi-1?oi.tilePath[Bi-1-Mn]:fi.tilePath[Mn-Bi+2],oe,Le.elevationFeature)[2]),ia(Ri,En,wn,L))),Qi.some(Ri=>Ri[3]<=0)&&(Qi=[]));let an=[];if(Qi.length>0){let Ri=1/0,En=-1/0,wn=1/0,Mn=-1/0;for(const en of Qi)Ri=Math.min(Ri,en[0]),wn=Math.min(wn,en[1]),En=Math.max(En,en[0]),Mn=Math.max(Mn,en[1]);En>=Gt.x&&Ri<=Lt.x&&Mn>=Gt.y&&wn<=Lt.y&&(an=[Qi.map(en=>new s.P(en[0],en[1]))],(Ri<Gt.x||En>Lt.x||wn<Gt.y||Mn>Lt.y)&&(an=s.bW(an,Gt.x,Gt.y,Lt.x,Lt.y)))}for(const Ri of an){jt.reset(Ri,.25*qt);let En=0;En=jt.length<=.5*qt?1:Math.ceil(jt.paddedLength/Ti)+1;for(let wn=0;wn<En;wn++){const Mn=wn/Math.max(En-1,1),en=jt.lerp(Mn),Oi=en.x+rs,gn=en.y+rs;K.push(Oi,gn,qt,0);const tr=Oi-qt,ir=gn-qt,_n=Oi+qt,Ji=gn+qt;if(wt=wt&&this.isOffscreen(tr,ir,_n,Ji),xt=xt||this.isInsideGrid(tr,ir,_n,Ji),!u&&this.grid.hitTestCircle(Oi,gn,qt,U)&&(At=!0,!N))return{circles:[],offscreen:!1,collisionDetected:At,occluded:!1}}}}return{circles:!N&&At||!xt?[]:K,offscreen:wt,collisionDetected:At,occluded:je.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let p=1/0,y=1/0,b=-1/0,w=-1/0;for(const L of n){const N=new s.P(L.x+rs,L.y+rs);p=Math.min(p,N.x),y=Math.min(y,N.y),b=Math.max(b,N.x),w=Math.max(w,N.y),u.push(N)}const E=this.grid.query(p,y,b,w).concat(this.ignoredGrid.query(p,y,b,w)),I={},R={};for(const L of E){const N=L.key;if(I[N.bucketInstanceId]===void 0&&(I[N.bucketInstanceId]={}),I[N.bucketInstanceId][N.featureIndex])continue;const B=[new s.P(L.x1,L.y1),new s.P(L.x2,L.y1),new s.P(L.x2,L.y2),new s.P(L.x1,L.y2)];s.bX(u,B)&&(I[N.bucketInstanceId][N.featureIndex]=!0,R[N.bucketInstanceId]===void 0&&(R[N.bucketInstanceId]=[]),R[N.bucketInstanceId].push(N.featureIndex))}return R}insertCollisionBox(n,u,p,y,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,u,p,y,b){const w=u?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:y,collisionGroupID:b};for(let I=0;I<n.length;I+=4)w.insertCircle(E,n[I],n[I+1],n[I+2])}projectAndGetPerspectiveRatio(n,u,p,y,b,w,E){const I=[u,p,y,1];let R=!1;y||this.transform.pitch>0?(s.aC(I,I,n),this.fogState&&b&&E.name!=="globe"&&(R=(function(B,U,W,G,X,K){const oe=K.calculateFogTileMatrix(X),re=[U,W,G];return s.af(re,re,oe),ni(B,s.ag(re),K.pitch,K._fov)})(this.fogState,u,p,y,b.toUnwrapped(),this.transform)>.9)):Dd(I,I,n);const L=I[3];return{point:new s.P((I[0]/L+1)/2*this.transform.width+rs,(-I[1]/L+1)/2*this.transform.height+rs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/L*.5,1.5),signedDistanceFromCamera:L,occluded:w&&I[2]>L||R}}isOffscreen(n,u,p,y){return p<rs||n>=this.screenRightBoundary||y<rs||u>this.screenBottomBoundary}isInsideGrid(n,u,p,y){return p>=0&&n<this.gridRightBoundary&&y>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const n=s.bA([]);return s.br(n,n,[-100,-100,0]),n}}class xn{constructor(n,u,p,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class pn{constructor(n,u,p,y,b,w=!1){this.text=new xn(n?n.text:null,u,p,b),this.icon=new xn(n?n.icon:null,u,y,b),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $o{constructor(n,u,p,y=!1){this.text=n,this.icon=u,this.skipFade=p,this.clipped=y}}class Xc{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Tn{constructor(n,u,p,y,b){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=b}}class kd{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[n]}}function Jc(f,n,u,p,y){const{horizontalAlign:b,verticalAlign:w}=s.c1(f),E=-(b-.5)*n,I=-(w-.5)*u,R=s.c2(f,p);return new s.P(E+R[0]*y,I+R[1]*y)}function fc(f,n,u,p,y){const b=new s.P(f,n);return u&&b._rotate(p?y:-y),b}class Lo{constructor(n,u,p,y,b,w){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new ii(this.transform,b),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new kd(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(n,u,p,y,b=1){const w=p.getBucket(u),E=p.latestFeatureIndex;if(!w||!E||u.fqid!==w.layerIds[0])return;const I=w.layers[0].layout,R=w.layers[0].paint,L=p.collisionBoxArray,N=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),B=p.tileSize/s.al,U=p.tileID.toUnwrapped();this.transform.setProjection(w.projection);const W=(G=p.tileID,X=w.getProjection(),K=this.transform,X.name===this.projection?K.calculateProjMatrix(G.toUnwrapped()):Rd(K,X,G));var G,X,K;const oe=I.get("text-pitch-alignment")==="map",re=I.get("text-rotation-alignment")==="map";u.compileFilter(u.options);const ne=u.dynamicFilter(),be=u.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(p),ve=ll(W,p.tileID.canonical,oe,re,this.transform,w.getProjection(),_e);let pe=null;const he=w.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(oe){const Te=ns(W,p.tileID.canonical,oe,re,this.transform,w.getProjection(),_e);pe=s.aB([],this.transform.labelPlaneMatrix,Te)}let Se=null;ne&&p.latestFeatureIndex&&(Se={unwrappedTileID:U,dynamicFilter:ne,dynamicFilterNeedsFeature:be}),this.retainedQueryData[w.bucketInstanceId]=new Tn(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,p.tileID);const[ze,Le]=w.layers[0].layout.get("text-size-scale-range"),Ze=s.aA(b,ze,Le),[je,tt]=I.get("icon-size-scale-range"),dt=s.aA(b,je,tt),Fe={bucket:w,layout:I,paint:R,posMatrix:W,invMatrix:he,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ve,labelToScreenMatrix:pe,clippingData:Se,scale:N,textPixelRatio:B,holdingForFade:p.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:s.bK(w.textSizeData,this.transform.zoom,Ze),partiallyEvaluatedIconSize:s.bK(w.iconSizeData,this.transform.zoom,dt),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(y)for(const Te of w.sortKeyRanges){const{sortKey:Ke,symbolInstanceStart:We,symbolInstanceEnd:ft}=Te;n.push({sortKey:Ke,symbolInstanceStart:We,symbolInstanceEnd:ft,parameters:Fe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X,K,oe,re,ne,be){const{textOffset0:_e,textOffset1:ve,crossTileID:pe}=G,he=[_e,ve],Se=Jc(n,w,E,he,I),ze=this.collisionIndex.placeCollisionBox(K,I,u,p,y,b,fc(Se.x,Se.y,R,L,this.transform.angle),W,N,B,U.predicate);if(re){const Le=K.getSymbolInstanceIconSize(be,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,Le,re,p,y,b,fc(Se.x,Se.y,R,L,this.transform.angle),W,N,B,U.predicate).box.length===0)return}if(ze.box.length>0){let Le;return this.prevPlacement&&this.prevPlacement.variableOffsets[pe]&&this.prevPlacement.placements[pe]&&this.prevPlacement.placements[pe].text&&(Le=this.prevPlacement.variableOffsets[pe].anchor),this.variableOffsets[pe]={textOffset:he,width:w,height:E,anchor:n,textScale:I,prevAnchor:Le},this.markUsedJustification(K,n,G,oe),K.allowVerticalPlacement&&(this.markUsedOrientation(K,oe,G),this.placedOrientations[pe]=oe),{shift:Se,placedGlyphBoxes:ze}}}placeLayerBucketPart(n,u,p,y,b=1){const{bucket:w,layout:E,paint:I,posMatrix:R,textLabelPlaneMatrix:L,labelToScreenMatrix:N,clippingData:B,textPixelRatio:U,mercatorCenter:W,invMatrix:G,holdingForFade:X,collisionBoxArray:K,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:re,collisionGroup:ne,latestFeatureIndex:be}=n.parameters,_e=E.get("text-optional"),ve=E.get("icon-optional"),pe=E.get("text-allow-overlap"),he=E.get("icon-allow-overlap"),Se=E.get("text-rotation-alignment")==="map",ze=E.get("icon-rotation-alignment")==="map",Le=E.get("text-pitch-alignment")==="map",Ze=I.get("symbol-z-offset"),je=E.get("symbol-elevation-reference")==="sea",tt=E.get("symbol-placement"),[dt,Fe]=E.get("text-size-scale-range"),[Te,Ke]=E.get("icon-size-scale-range"),We=s.aA(b,dt,Fe),ft=s.aA(b,Te,Ke),vt=E.get("text-variable-anchor"),At=Se&&tt!=="point",xt=ze&&tt!=="point",wt=vt&&w.hasTextData(),qt=w.hasIconTextFit()&&wt&&w.hasIconData();this.transform.setProjection(w.projection);const Gt=wt||At,Lt=xt||qt;let jt=pe&&(he||!w.hasIconData()||ve),oi=he&&(pe||!w.hasTextData()||_e);const fi=!Ze.isConstant();!w.collisionArrays&&K&&w.deserializeCollisionBoxes(K),p&&y&&w.updateCollisionDebugBuffers(this.transform.zoom,K,We,ft);const Bi=(Ti,an,Ri)=>{const{crossTileID:En,numVerticalGlyphVertices:wn}=Ti;let Mn=null;if(B&&B.dynamicFilterNeedsFeature||fi){const rr=this.retainedQueryData[w.bucketInstanceId];Mn=be.loadFeature({featureIndex:Ti.featureIndex,bucketIndex:rr.bucketIndex,sourceLayerIndex:rr.sourceLayerIndex,layoutVertexArrayOffset:0});const Ir=Mn.properties?Mn.properties.worldview:null;if(w.localizable&&w.worldview&&typeof Ir=="string")if(Ir==="all")Mn.properties.$localized=!0;else{if(!Ir.split(",").includes(w.worldview))return;Mn.properties.$localized=!0,Mn.properties.worldview=w.worldview}}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:w.worldview},Mn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.P(Ti.tileAnchorX,Ti.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[En]=new $o(!1,!1,!1,!0),void u.add(En);const en=Ze.evaluate(Mn,{});if(u.has(En))return;if(X)return void(this.placements[En]=new $o(!1,!1,!1));let Oi=!1,gn=!1,tr=!0,ir=!1,_n=!1,Ji=null,Fi={box:null,offscreen:null,occluded:null},Nn={box:null},hr=null,jn=null,qn=null,Ho=0,cs=0,oo=0;Ri.textFeatureIndex?Ho=Ri.textFeatureIndex:Ti.useRuntimeCollisionCircles&&(Ho=Ti.featureIndex),Ri.verticalTextFeatureIndex&&(cs=Ri.verticalTextFeatureIndex);const yn=w.elevationFeatures?w.elevationFeatures[Ti.elevationFeatureIndex]:void 0,xs=rr=>{rr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Ir=this.transform.elevation;rr.elevation=je?en:en+s.bV.getAtTileOffset(rr.tileID,new s.P(rr.tileAnchorX,rr.tileAnchorY),Ir,yn),rr.elevation+=Ti.zOffset},Eo=Ri.textBox;if(Eo){xs(Eo);const rr=Gn=>{let Lr=s.bL.horizontal;if(w.allowVerticalPlacement&&!Gn&&this.prevPlacement){const Io=this.prevPlacement.placedOrientations[En];Io&&(this.placedOrientations[En]=Io,Lr=Io,this.markUsedOrientation(w,Lr,Ti))}return Lr},Ir=(Gn,Lr)=>{if(w.allowVerticalPlacement&&wn>0&&Ri.verticalTextBox){for(const Io of w.writingModes)if(Io===s.bL.vertical?(Fi=Lr(),Nn=Fi):Fi=Gn(),Fi&&Fi.box&&Fi.box.length)break}else Fi=Gn()};if(vt){let Gn=vt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[En]){const br=this.prevPlacement.variableOffsets[En];Gn.indexOf(br.anchor)>0&&(Gn=Gn.filter(bs=>bs!==br.anchor),Gn.unshift(br.anchor))}const Lr=(br,bs,Gh)=>{const Va=w.getSymbolInstanceTextSize(oe,Ti,this.transform.zoom,an),xu=(br.x2-br.x1)*Va+2*br.padding,bu=(br.y2-br.y1)*Va+2*br.padding,ws=Ti.hasIconTextFit&&!he?bs:null;ws&&xs(ws);let ja={box:[],offscreen:!1,occluded:!1};const Ga=pe?2*Gn.length:Gn.length;for(let js=0;js<Ga;++js){const ml=this.attemptAnchorPlacement(Gn[js%Gn.length],br,W,G,Gt,xu,bu,Va,Se,Le,U,R,ne,js>=Gn.length,Ti,an,w,Gh,ws,oe,re);if(ml&&(ja=ml.placedGlyphBoxes,ja&&ja.box&&ja.box.length)){Oi=!0,Ji=ml.shift;break}}return ja};Ir(()=>Lr(Eo,Ri.iconBox,s.bL.horizontal),()=>{const br=Ri.verticalTextBox;return br&&xs(br),w.allowVerticalPlacement&&!(Fi&&Fi.box&&Fi.box.length)&&wn>0&&br?Lr(br,Ri.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),Fi&&(Oi=Fi.box,tr=Fi.offscreen,ir=Fi.occluded);const Io=rr(!(!Fi||!Fi.box));if(!Oi&&this.prevPlacement){const br=this.prevPlacement.variableOffsets[En];br&&(this.variableOffsets[En]=br,this.markUsedJustification(w,br.anchor,Ti,Io))}}else{const Gn=(Lr,Io)=>{const br=w.getSymbolInstanceTextSize(oe,Ti,this.transform.zoom,an),bs=this.collisionIndex.placeCollisionBox(w,br,Lr,W,G,Gt,new s.P(0,0),pe,U,R,ne.predicate);return bs&&bs.box&&bs.box.length&&(this.markUsedOrientation(w,Io,Ti),this.placedOrientations[En]=Io),bs};Ir(()=>Gn(Eo,s.bL.horizontal),()=>{const Lr=Ri.verticalTextBox;return w.allowVerticalPlacement&&wn>0&&Lr?(xs(Lr),Gn(Lr,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),rr(!!(Fi&&Fi.box&&Fi.box.length))}}if(hr=Fi,Oi=hr&&hr.box&&hr.box.length>0,tr=hr&&hr.offscreen,ir=hr&&hr.occluded,Ti.useRuntimeCollisionCircles){const rr=Ti.centerJustifiedTextSymbolIndex>=0?Ti.centerJustifiedTextSymbolIndex:Ti.verticalPlacedTextSymbolIndex,Ir=w.text.placedSymbolArray.get(rr),Gn=s.bM(w.textSizeData,oe,Ir),Lr=E.get("text-padding");jn=this.collisionIndex.placeCollisionCircles(w,pe,Ir,rr,w.lineVertexArray,w.glyphOffsetArray,Gn,R,L,N,p,Le,ne.predicate,Ti.collisionCircleDiameter*Gn/s.bY,Lr,this.retainedQueryData[w.bucketInstanceId].tileID),Oi=pe||jn.circles.length>0&&!jn.collisionDetected,tr=tr&&jn.offscreen,ir=jn.occluded}if(Ri.iconFeatureIndex&&(oo=Ri.iconFeatureIndex),Ri.iconBox){const rr=Ir=>{xs(Ir);const Gn=Ti.hasIconTextFit&&Ji?fc(Ji.x,Ji.y,Se,Le,this.transform.angle):new s.P(0,0),Lr=w.getSymbolInstanceIconSize(re,this.transform.zoom,Ti.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Lr,Ir,W,G,Lt,Gn,he,U,R,ne.predicate)};Nn&&Nn.box&&Nn.box.length&&Ri.verticalIconBox?(qn=rr(Ri.verticalIconBox),gn=qn.box.length>0):(qn=rr(Ri.iconBox),gn=qn.box.length>0),tr=tr&&qn.offscreen,_n=qn.occluded}const Zo=_e||Ti.numHorizontalGlyphVertices===0&&wn===0,sa=ve||Ti.numIconVertices===0;if(Zo||sa?sa?Zo||(gn=gn&&Oi):Oi=gn&&Oi:gn=Oi=gn&&Oi,Oi&&hr&&hr.box&&this.collisionIndex.insertCollisionBox(hr.box,E.get("text-ignore-placement"),w.bucketInstanceId,Nn&&Nn.box&&cs?cs:Ho,ne.ID),gn&&qn&&this.collisionIndex.insertCollisionBox(qn.box,E.get("icon-ignore-placement"),w.bucketInstanceId,oo,ne.ID),jn&&(Oi&&this.collisionIndex.insertCollisionCircles(jn.circles,E.get("text-ignore-placement"),w.bucketInstanceId,Ho,ne.ID),p)){const rr=w.bucketInstanceId;let Ir=this.collisionCircleArrays[rr];Ir===void 0&&(Ir=this.collisionCircleArrays[rr]=new Xc);for(let Gn=0;Gn<jn.circles.length;Gn+=4)Ir.circles.push(jn.circles[Gn+0]),Ir.circles.push(jn.circles[Gn+1]),Ir.circles.push(jn.circles[Gn+2]),Ir.circles.push(jn.collisionDetected?1:0)}const Wo=w.projection.name!=="globe";jt=jt&&(Wo||!ir),oi=oi&&(Wo||!_n),this.placements[En]=new $o(Oi||jt,gn||oi,tr||w.justReloaded),u.add(En)},Qi=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,Qi),w.elevationType==="road"&&w.updateRoadElevation(Qi.canonical),w.updateZOffset(),w.sortFeaturesByY){const Ti=w.getSortedSymbolIndexes(this.transform.angle);for(let an=Ti.length-1;an>=0;--an){const Ri=Ti[an];Bi(w.symbolInstances.get(Ri),Ri,w.collisionArrays[Ri])}w.hasAnyZOffset&&s.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Ti=w.getSortedIndexesByZOffset();for(let an=0;an<Ti.length;++an){const Ri=Ti[an];Bi(w.symbolInstances.get(Ri),Ri,w.collisionArrays[Ri])}}else for(let Ti=n.symbolInstanceStart;Ti<n.symbolInstanceEnd;Ti++)Bi(w.symbolInstances.get(Ti),Ti,w.collisionArrays[Ti]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){const Ti=this.collisionCircleArrays[w.bucketInstanceId];s.bl(Ti.invProjMatrix,R),Ti.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(n,u,p,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:I,crossTileID:R}=p,L=s.c3(u),N=y===s.bL.vertical?I:L==="left"?b:L==="center"?w:L==="right"?E:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=N>=0&&b!==N?0:R),w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=N>=0&&w!==N?0:R),E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=N>=0&&E!==N?0:R),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=N>=0&&I!==N?0:R)}markUsedOrientation(n,u,p){const y=u===s.bL.horizontal||u===s.bL.horizontalOnly?u:0,b=u===s.bL.vertical?u:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:R}=p,L=n.text.placedSymbolArray;w>=0&&(L.get(w).placedOrientation=y),E>=0&&(L.get(E).placedOrientation=y),I>=0&&(L.get(I).placedOrientation=y),R>=0&&(L.get(R).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const y=u?u.symbolFadeChange(n):1,b=u?u.opacities:{},w=u?u.variableOffsets:{},E=u?u.placedOrientations:{};for(const I in this.placements){const R=this.placements[I],L=b[I];L?(this.opacities[I]=new pn(L,y,R.text,R.icon,null,R.clipped),p=p||R.text!==L.text.placed||R.icon!==L.icon.placed):(this.opacities[I]=new pn(null,y,R.text,R.icon,R.skipFade,R.clipped),p=p||R.text||R.icon)}for(const I in b){const R=b[I];if(!this.opacities[I]){const L=new pn(R,y,!1,!1);L.isHidden()||(this.opacities[I]=L,p=p||R.text.placed||R.icon.placed)}}for(const I in w)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=w[I]);for(const I in E)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=E[I]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)}updateLayerOpacities(n,u,p,y){y&&(this.lastReplacementSourceUpdateTime=y.updateTime);const b=new Set;for(const w of u){const E=w.getBucket(n);E&&w.latestFeatureIndex&&n.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,b,w,w.collisionBoxArray,p,y,w.tileID,n.scope),E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,w.tileID),E.elevationType==="road"&&E.updateRoadElevation(w.tileID.canonical),E.updateZOffset())}}updateBucketOpacities(n,u,p,y,b,w,E,I){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const R=n.layers[0].layout,L=n.layers[0].paint,N=!!n.layers[0].dynamicFilter(),B=new pn(null,0,!1,!1,!0),U=R.get("text-allow-overlap"),W=R.get("icon-allow-overlap"),G=R.get("text-variable-anchor"),X=R.get("text-rotation-alignment")==="map",K=R.get("text-pitch-alignment")==="map",oe=L.get("symbol-z-offset"),re=R.get("symbol-elevation-reference")==="sea",ne=!oe.isConstant(),be=new pn(null,0,U&&(W||!n.hasIconData()||R.get("icon-optional")),W&&(U||!n.hasTextData()||R.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const _e=(pe,he,Se)=>{for(let ze=0;ze<he/4;ze++)pe.opacityVertexArray.emplaceBack(Se)};let ve=0;w&&n.updateReplacement(E,w);for(let pe=0;pe<n.symbolInstances.length;pe++){const he=n.symbolInstances.get(pe),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:ze,crossTileID:Le,numIconVertices:Ze,tileAnchorX:je,tileAnchorY:tt}=he;let dt=null;const Fe=this.retainedQueryData[n.bucketInstanceId];ne&&he&&Fe&&(dt=p.latestFeatureIndex.loadFeature({featureIndex:he.featureIndex,bucketIndex:Fe.bucketIndex,sourceLayerIndex:Fe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Te=oe.evaluate(dt,{}),Ke=u.has(Le);let We=this.opacities[Le];Ke?We=B:We||(We=be,this.opacities[Le]=We),u.add(Le);const ft=Se>0||ze>0,vt=Ze>0,At=this.placedOrientations[Le],xt=At===s.bL.vertical,wt=At===s.bL.horizontal||At===s.bL.horizontalOnly;!ft&&!vt||We.isHidden()||ve++;let qt=!1;if((ft||vt)&&w)for(const Gt of n.activeReplacements){if(s.bZ(Gt,b,s.b_.Symbol,I)||Gt.min.x>je||je>Gt.max.x||Gt.min.y>tt||tt>Gt.max.y)continue;const Lt=s.b$(je,tt,E.canonical,Gt.footprintTileId.canonical);if(qt=s.c0(Lt,Gt.footprint),qt)break}if(ft){const Gt=qt?os:Do(We.text);_e(n.text,Se,xt?os:Gt),_e(n.text,ze,wt?os:Gt);const Lt=We.text.isHidden(),{leftJustifiedTextSymbolIndex:jt,centerJustifiedTextSymbolIndex:oi,rightJustifiedTextSymbolIndex:fi,verticalPlacedTextSymbolIndex:Bi}=he,Qi=n.text.placedSymbolArray,Ti=Lt||xt?1:0;jt>=0&&(Qi.get(jt).hidden=Ti),oi>=0&&(Qi.get(oi).hidden=Ti),fi>=0&&(Qi.get(fi).hidden=Ti),Bi>=0&&(Qi.get(Bi).hidden=Lt||wt?1:0);const an=this.variableOffsets[Le];an&&this.markUsedJustification(n,an.anchor,he,At);const Ri=this.placedOrientations[Le];Ri&&(this.markUsedJustification(n,"left",he,Ri),this.markUsedOrientation(n,Ri,he))}if(vt){const Gt=qt?os:Do(We.icon),{placedIconSymbolIndex:Lt,verticalPlacedIconSymbolIndex:jt}=he,oi=n.icon.placedSymbolArray,fi=We.icon.isHidden()?1:0;Lt>=0&&(_e(n.icon,Ze,xt?os:Gt),oi.get(Lt).hidden=fi),jt>=0&&(_e(n.icon,he.numVerticalIconVertices,wt?os:Gt),oi.get(jt).hidden=fi)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Gt=n.collisionArrays[pe];if(Gt){let Lt=new s.P(0,0),jt=!0;if(Gt.textBox||Gt.verticalTextBox){if(G){const fi=this.variableOffsets[Le];fi?(Lt=Jc(fi.anchor,fi.width,fi.height,fi.textOffset,fi.textScale),X&&Lt._rotate(K?this.transform.angle:-this.transform.angle)):jt=!1}N&&(jt=!We.clipped),Gt.textBox&&Ar(n.textCollisionBox.collisionVertexArray,We.text.placed,!jt||xt,Te,re,Lt.x,Lt.y),Gt.verticalTextBox&&Ar(n.textCollisionBox.collisionVertexArray,We.text.placed,!jt||wt,Te,re,Lt.x,Lt.y)}const oi=jt&&!!(!wt&&Gt.verticalIconBox);Gt.iconBox&&Ar(n.iconCollisionBox.collisionVertexArray,We.icon.placed,oi,Te,re,he.hasIconTextFit?Lt.x:0,he.hasIconTextFit?Lt.y:0),Gt.verticalIconBox&&Ar(n.iconCollisionBox.collisionVertexArray,We.icon.placed,!oi,Te,re,he.hasIconTextFit?Lt.x:0,he.hasIconTextFit?Lt.y:0)}}}if(n.fullyClipped=ve===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=pe.invProjMatrix,n.placementViewportMatrix=pe.viewportMatrix,n.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,u){const p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>n}isStale(){return this.stale}setStale(){this.stale=!0}}function Ar(f,n,u,p,y,b,w){f.emplaceBack(n?1:0,u?1:0,b||0,w||0,p,y?1:0),f.emplaceBack(n?1:0,u?1:0,b||0,w||0,p,y?1:0),f.emplaceBack(n?1:0,u?1:0,b||0,w||0,p,y?1:0),f.emplaceBack(n?1:0,u?1:0,b||0,w||0,p,y?1:0)}const Hw=Math.pow(2,25),hh=Math.pow(2,24),nm=Math.pow(2,17),dh=Math.pow(2,16),Od=Math.pow(2,9),rm=Math.pow(2,8),Fd=Math.pow(2,1);function Do(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,u=Math.floor(127*f.opacity);return u*Hw+n*hh+u*nm+n*dh+u*Od+n*rm+u*Fd+n}const os=0;class ss{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,u,p,y,b,w){const E=this._bucketParts;for(;this._currentTileIndex<n.length;)if(u.getBucketParts(E,y,n[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,R)=>I.sortKey-R.sortKey));this._currentPartIndex<E.length;){const I=E[this._currentPartIndex];if(u.placeLayerBucketPart(I,this._seenCrossTileIDs,p,I.symbolInstanceStart===0,w),this._currentPartIndex++,b())return!0}return!1}}class om{startNewPlacement(n,u,p,y,b,w,E,I){return this.placement=new Lo(n,y,b,w,E,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=p,this._fadeDuration=y,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(n,u,p,y,b){const w=s.o.now(),E=()=>{const I=s.o.now()-w;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&I>2};for(;this._currentPlacementIndex>=0;){const I=u[n[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&I.visibility!=="none"&&(!I.minzoom||I.minzoom<=R)&&(!I.maxzoom||I.maxzoom>R)){const L=I,N=L.layout.get("symbol-z-elevate"),B=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,U=L.layout.get("symbol-z-order"),W=U==="viewport-y"||U==="auto"&&!(U!=="viewport-y"&&B),G=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),X=W&&G,K=this._inProgressLayer=this._inProgressLayer||new ss(L),oe=s.B(I.source,I.scope);if(K.continuePlacement(N||X?y[oe]:p[oe],this.placement,this._showCollisionBoxes,I,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ol=512/s.al/2;class Kr{constructor(n,u,p){this.tileID=n,this.bucketInstanceId=p,this.index=new s.c4(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=n.canonical.x*s.al,b=n.canonical.y*s.al;for(let w=0;w<u.length;w++){const{key:E,crossTileID:I,tileAnchorX:R,tileAnchorY:L}=u.get(w),N=Math.floor((y+R)*Ol),B=Math.floor((b+L)*Ol);this.index.add(N,B),this.keys.push(E),this.crossTileIDs.push(I)}this.index.finish()}findMatches(n,u,p){const y=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),b=Ol/Math.pow(2,u.canonical.z-this.tileID.canonical.z),w=u.canonical.x*s.al,E=u.canonical.y*s.al;for(let I=0;I<n.length;I++){const R=n.get(I);if(R.crossTileID)continue;const{key:L,tileAnchorX:N,tileAnchorY:B}=R,U=Math.floor((w+N)*b),W=Math.floor((E+B)*b),G=this.index.range(U-y,W-y,U+y,W+y).sort((X,K)=>X-K);for(const X of G){const K=this.crossTileIDs[X];if(this.keys[X]===L&&!p.has(K)){p.add(K),R.crossTileID=K;break}}}}}class Da{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const u=Math.round((n-this.lng)/360);if(u!==0)for(const p in this.indexes){const y=this.indexes[p],b={};for(const w in y){const E=y[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+u),b[E.tileID.key]=E}this.indexes[p]=b}this.lng=n}addBucket(n,u,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const y=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const w=this.indexes[b];if(Number(b)>n.overscaledZ)for(const E in w){const I=w[E];I.tileID.isChildOf(n)&&I.findMatches(u.symbolInstances,n,y)}else{const E=w[n.scaledTo(Number(b)).key];E&&E.findMatches(u.symbolInstances,n,y)}}for(let b=0;b<u.symbolInstances.length;b++){const w=u.symbolInstances.get(b);w.crossTileID||(w.crossTileID=p.generate(),y.add(w.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Kr(n,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(n,u){for(const p of u.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let u=!1;for(const p in this.indexes){const y=this.indexes[p];for(const b in y)n[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[b]),delete y[b],u=!0)}return u}}class Gr{constructor(){this.layerIndexes={},this.crossTileIDs=new Da,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,u,p,y){let b=this.layerIndexes[n.fqid];b===void 0&&(b=this.layerIndexes[n.fqid]=new cl);let w=!1;const E={};y.name!=="globe"&&b.handleWrapJump(p);for(const I of u){const R=I.getBucket(n);R&&n.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(I.tileID,R,this.crossTileIDs)&&(w=!0),E[R.bucketInstanceId]=!0)}return b.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(n){const u={};n.forEach(p=>{u[p]=!0});for(const p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}const Fl=771;class Ii{constructor(n,u,p,y){this.blendFunction=n,this.blendColor=u.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=y}}Ii.Replace=[1,0,1,0],Ii.disabled=new Ii(Ii.Replace,s.ao.transparent,[!1,!1,!1,!1]),Ii.unblended=new Ii(Ii.Replace,s.ao.transparent,[!0,!0,!0,!0]),Ii.alphaBlended=new Ii([1,Fl,1,Fl],s.ao.transparent,[!0,!0,!0,!0]),Ii.alphaBlendedNonPremultiplied=new Ii([770,Fl,770,Fl],s.ao.transparent,[!0,!0,!0,!0]),Ii.multiply=new Ii([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),Ii.additive=new Ii([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class Kt{constructor(n,u,p){this.func=n,this.mask=u,this.range=p}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const Yc=7680;class vi{constructor(n,u,p,y,b,w){this.test=n,this.ref=u,this.mask=p,this.fail=y,this.depthFail=b,this.pass=w}}vi.disabled=new vi({func:519,mask:0},0,0,Yc,Yc,Yc);const Bd=1029,fh=2305;class di{constructor(n,u,p){this.enable=n,this.mode=u,this.frontFace=p}}function sm(f,n){const u=s.ca(f,3);s.cc(f,n),s.cg(f,3,u)}function am(f,n){const u=s.c7([]);return s.c8(u,u,-n),s.c9(u,u,-f),u}function ka(f,n){const u=[f[0],f[1],0],p=[n[0],n[1],0];if(s.ag(u)>=1e-15){const w=s.aw([],u);s.c5(p,w,s.bJ(p,w)),n[0]=p[0],n[1]=p[1]}const y=s.bI([],n,f);if(s.c6(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return am(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}di.disabled=new di(!1,Bd,fh),di.backCCW=new di(!0,Bd,fh),di.backCW=new di(!0,Bd,2304),di.frontCW=new di(!0,1028,2304),di.frontCCW=new di(!0,1028,fh);class Jy{constructor(n,u){this.position=n,this.orientation=u}get position(){return this._position}set position(n){if(n){const u=n instanceof s.ae?n:new s.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(u.x=s.bT(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(n,u,p){if(this.orientation=null,!this.position)return;const y=this.position,b=p||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(n)):0),w=s.ae.fromLngLat(n,b),E=[w.x-y.x,w.y-y.y,w.z-y.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=ka(E,u)}setPitchBearing(n,u){this.orientation=am(s.an(n),s.an(-u))}}class Kc{constructor(n,u){this._transform=s.bA([]),this.orientation=u,this.position=n}get mercatorPosition(){const n=this.position;return new s.ae(n[0],n[1],n[2])}get position(){const n=s.ca(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var u;n&&s.cg(this._transform,3,[(u=n)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.c7([]),n&&sm(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,u){this._orientation=am(n,u),sm(this._transform,this._orientation)}forward(){const n=s.ca(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.ca(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.ca(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,u){const p=new Float64Array(16);return s.bl(p,this.getWorldToCamera(n,u)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,u,p){const y=this.position;s.c5(y,y,-n);const b=new Float64Array(16);return s.bq(b,[p,p,p]),s.br(b,b,y),b[10]*=u,b}getWorldToCamera(n,u){const p=new Float64Array(16),y=new Float64Array(4),b=this.position;return s.cb(y,this._orientation),s.c5(b,b,-n),s.cc(p,y),s.br(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=u,p[9]*=u,p[10]*=u,p[11]*=u,p}getCameraToClipPerspective(n,u,p,y){const b=new Float64Array(16);return s.cd(b,n,u,p,y),b}getCameraToClipOrthographic(n,u,p,y,b,w){const E=new Float64Array(16);return s.ce(E,n,u,p,y,b,w),E}getDistanceToElevation(n,u=!1){const p=n===0?0:s.cf(n,u?s.a$(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new Kc([...this.position],[...this.orientation])}}const as=(f,n)=>({u_matrix:f,u_ground_shadow_factor:n});class lm{constructor(n=0,u=0,p=0,y=0){if(isNaN(n)||n<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=p,this.right=y}interpolate(n,u,p){return u.top!=null&&n.top!=null&&(this.top=s.ak(n.top,u.top,p)),u.bottom!=null&&n.bottom!=null&&(this.bottom=s.ak(n.bottom,u.bottom,p)),u.left!=null&&n.left!=null&&(this.left=s.ak(n.left,u.left,p)),u.right!=null&&n.right!=null&&(this.right=s.ak(n.right,u.right,p)),this}getCenter(n,u){const p=s.aA((this.left+n-this.right)/2,0,n),y=s.aA((this.top+u-this.bottom)/2,0,u);return new s.P(p,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new lm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Oa=15;class Nd{constructor(n,u,p,y,b,w,E){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(w),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new s.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new lm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Kc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new Nd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Oa}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,u=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=s.cm(this.projectionOptions);const p=this.getProjection(),y=!s.by(u,p);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cm({name:"mercator"});const u=n!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const u=-n*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=s.cn(),s.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const u=s.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,b=0;for(let w=0;w<u.length;w++){const E=new s.P(u[w][0]*this.width,p+u[w][1]*(this.height-p)),I=n.pointCoordinate(E);if(!I)continue;const R=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);y+=I[3]*R,b+=R}return b===0?NaN:y/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*u,y=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),w=Math.max(y-p,b);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}equals(n){const u=this.elevation,p=n.elevation,y=u!=null!=(p!=null)||u&&p&&u.exaggeration()!==p.exaggeration();return this.width===n.width&&this.height===n.height&&this.center.lng===n.center.lng&&this.center.lat===n.center.lat&&this.zoom===n.zoom&&this.bearing===n.bearing&&this.pitch===n.pitch&&this.fov===n.fov&&this.projection.name===n.projection.name&&this._edgeInsets.equals(n.padding)&&!y}computeZoomRelativeTo(n){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[u.x,u.y,u.z]:[n.x,n.y,n.z];const y=s.ag(s.av([],this._camera.position,p));return s.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let u=!1;if(n.orientation&&!s.cp(n.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];s.cq(p,this._camera.position)||(this._setCameraPosition(p),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,u=new Jy;return u.position=new s.ae(n[0],n[1],n[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(n){if(!s.cr(n))return!1;s.cs(n,n);const u=s.ct([],[0,0,-1],n),p=s.ct([],[0,-1,0],n);if(p[2]<0)return!1;const y=ka(u,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const u=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=s.aA(n[2],y/p,y/u),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,u,p){this._unmodified=!1,this._edgeInsets.interpolate(n,u,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(n){const u=[new s.cu(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),y=this.pointCoordinate(new s.P(this.width,0)),b=this.pointCoordinate(new s.P(this.width,this.height)),w=this.pointCoordinate(new s.P(0,this.height)),E=Math.floor(Math.min(p.x,y.x,b.x,w.x)),I=Math.floor(Math.max(p.x,y.x,b.x,w.x)),R=1;for(let L=E-R;L<=I+R;L++)L!==0&&u.push(new s.cu(L,n))}return u}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,u,p,y){let b=[];const w=p!=null,E=!w;if(E&&this.zoom<u||w&&p[0]===0&&p[1]===0)return b;const I=new Set,R=(N,B,U,W,G)=>{const X=s.cY(B,N,U,W,G);I.has(X)||(b.push(new s.aQ(N,B,U,W,G)),I.add(X))};for(let N=0;N<n.length;N++){const B=n[N];if(E&&B.canonical.z!==u||w&&y!==void 0&&y>B.canonical.z)continue;const U=B.canonical,W=B.overscaledZ,G=B.wrap,X=1<<U.z,K=U.x+1<X,oe=U.x>0,re=U.y+1<X,ne=U.y>0,be=B.wrap-(oe?0:1),_e=B.wrap+(K?0:1),ve=oe?U.x-1:X-1,pe=K?U.x+1:0;if(w)p[0]<0?(R(W,_e,U.z,pe,U.y),p[1]<0&&re&&(R(W,G,U.z,U.x,U.y+1),R(W,_e,U.z,pe,U.y+1)),p[1]>0&&ne&&(R(W,G,U.z,U.x,U.y-1),R(W,_e,U.z,pe,U.y-1))):p[0]>0?(R(W,be,U.z,ve,U.y),p[1]<0&&re&&(R(W,G,U.z,U.x,U.y+1),R(W,be,U.z,ve,U.y+1)),p[1]>0&&ne&&(R(W,G,U.z,U.x,U.y-1),R(W,be,U.z,ve,U.y-1))):p[1]<0&&re?R(W,G,U.z,U.x,U.y+1):ne&&R(W,G,U.z,U.x,U.y-1);else{const he=B.visibleQuadrants;1&he&&(R(W,be,U.z,ve,U.y),ne&&(R(W,G,U.z,U.x,U.y-1),R(W,be,U.z,ve,U.y-1))),2&he&&(R(W,_e,U.z,pe,U.y),ne&&(R(W,G,U.z,U.x,U.y-1),R(W,_e,U.z,pe,U.y-1))),4&he&&(R(W,be,U.z,ve,U.y),re&&(R(W,G,U.z,U.x,U.y+1),R(W,be,U.z,ve,U.y+1))),8&he&&(R(W,_e,U.z,pe,U.y),re&&(R(W,G,U.z,U.x,U.y+1),R(W,_e,U.z,pe,U.y+1)))}}const L=[];for(const N of b)b.some(B=>N.isChildOf(B))||L.push(N);if(b=L.filter(N=>!n.some(B=>!!(N.overscaledZ<u&&B.isChildOf(N))||N.equals(B)||N.isChildOf(B))),E){const N=1<<u,B=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[N*B.x,N*B.y],W=4,G=W*W;b=b.filter(X=>{const K=X.canonical.x+.5-U[0],oe=X.canonical.y+.5-U[1];return K*K+oe*oe<G})}return b}extendTileCoverToNearPlane(n,u,p){const y=[],b=new Set;for(const oe of n)b.add(oe.key);const w=(oe,re,ne,be,_e)=>{const ve=s.cY(re,oe,ne,be,_e);b.has(ve)||(y.push(new s.aQ(oe,re,ne,be,_e)),b.add(ve))},E=n.reduce((oe,re)=>Math.max(oe,re.overscaledZ),p),I=1<<p,R=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],L=new s.P(0,0),N=new s.P(0,0),B=(oe,re)=>{const ne=Math.floor(oe[0]),be=Math.floor(oe[1]),_e=(oe[0]-ne)*s.al,ve=(oe[1]-be)*s.al,pe=Math.floor(re[0]),he=Math.floor(re[1]),Se=(re[0]-pe)*s.al,ze=(re[1]-he)*s.al;for(let Le=-1;Le<=1;Le++){const Ze=ne+Le;if(!(Ze<0||Ze>=I)){L.x=_e-Le*s.al,N.x=Se-(Ze-pe)*s.al;for(let je=-1;je<=1;je++){const tt=be+je;L.y=ve-je*s.al,N.y=ze-(tt-he)*s.al,s.cZ(L,N,R)&&w(E,0,p,Ze,tt)}}}},U=u.points,W=U[s.cv],G=U[s.cw],X=this._projectToGround(W,U[s.cx]),K=this._projectToGround(G,U[s.cy]);return B(W,X),B(G,K),y}_projectToGround(n,u){return s.cz(s.cA(),n,u,n[2]/(n[2]-u[2]))}coveringTiles(n){let u=this.coveringZoomLevel(n);const p=u,y=this.elevation&&this.elevation.exaggeration(),b=y&&!n.isTerrainDEM,w=this.projection.name==="mercator";if(n.minzoom!==void 0&&u<n.minzoom)return[];n.maxzoom!==void 0&&u>n.maxzoom&&(u=n.maxzoom);const E=this.locationCoordinate(this.center),I=this.center.lat,R=1<<u,L=[R*E.x,R*E.y,0],N=this.projection.name==="globe",B=!N,U=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,B),W=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=R*s.cf(1,this.center.lat),X=this._camera.position[2]/s.cf(1,this.center.lat),K=[R*W.x,R*W.y,X*(B?1:G)],oe=N||y,re=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ne=this.isLODDisabled(!0)?u:0;let be;if(this._elevation&&n.isTerrainDEM)be=1e4*this._elevation.exaggeration();else if(this._elevation){const Te=this._elevation.getMinMaxForVisibleTiles();be=Te?Te.max:this._centerAltitude}else be=this._centerAltitude;const _e=n.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?s.cC(this):1,pe=Te=>{const We=new s.ae(Te.x+25e-6,Te.y,Te.z),ft=new s.ae(Te.x,Te.y+25e-6,Te.z),vt=Te.toLngLat(),At=We.toLngLat(),xt=ft.toLngLat(),wt=this.locationCoordinate(vt),qt=this.locationCoordinate(At),Gt=this.locationCoordinate(xt),Lt=Math.hypot(qt.x-wt.x,qt.y-wt.y),jt=Math.hypot(Gt.x-wt.x,Gt.y-wt.y);return Math.sqrt(Lt*jt)*ve/25e-6},he=Te=>{const Ke=be,We=_e;return{aabb:s.cF(this,R,0,0,0,Te,We,Ke,this.projection),zoom:0,x:0,y:0,minZ:We,maxZ:Ke,wrap:Te,fullyVisible:!1}},Se=[];let ze=[];const Le=u,Ze=n.reparseOverscaled?p:u,je=(X-this._centerAltitude)*G,tt=Te=>{if(!this._elevation||!Te.tileID||!w)return;const Ke=this._elevation.getMinMaxForTile(Te.tileID),We=Te.aabb;Ke?(We.min[2]=Ke.min,We.max[2]=Ke.max,We.center[2]=(We.min[2]+We.max[2])/2):(Te.shouldSplit=Fe(Te),Te.shouldSplit||(We.min[2]=We.max[2]=We.center[2]=this._centerAltitude))},dt=(Te,Ke)=>{if(.707*Ke<Te)return 1;const We=Ke/Te;return We/(1.4144271570014144+(Math.pow(1.1,We-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=Te=>{if(Te.zoom<ne)return!0;if(Te.zoom===Le)return!1;if(Te.shouldSplit!=null)return Te.shouldSplit;const Ke=Te.aabb.distanceX(K),We=Te.aabb.distanceY(K);let ft=je,vt=1;if(N){ft=Te.aabb.distanceZ(K);const jt=Math.pow(2,Te.zoom),oi=s.a$((Te.y+1)/jt),fi=s.a$(Te.y/jt),Bi=Math.min(Math.max(I,oi),fi),Qi=s.d1(Bi)/s.d1(I);if(vt=Bi===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Qi/this._mercatorScaleRatio),this.zoom<=s.c_&&Te.zoom===Le-1&&Qi>=.9)return!0}else if(b&&(ft=Te.aabb.distanceZ(K)*G),this.projection.isReprojectedInTileSpace&&p<=5){const jt=Math.pow(2,Te.zoom),oi=pe(new s.ae((Te.x+.5)/jt,(Te.y+.5)/jt));vt=oi>.85?1:oi}if(!w&&!N){const jt=Math.sqrt(Ke*Ke+We*We+ft*ft);let oi=(1<<Le-Te.zoom)*re*vt;return oi*=dt(Math.max(ft,je),jt),jt<oi}let At=Number.MAX_VALUE,xt=0;const wt=Te.aabb.getCorners(),qt=[];for(const jt of wt){s.av(qt,jt,K),N||(b?qt[2]*=G:qt[2]=je);const oi=s.bJ(qt,this._camera.forward());oi<At&&(At=oi,xt=Math.abs(qt[2]))}let Gt=(1<<Le-Te.zoom)*re*vt;if(Gt*=dt(Math.max(xt,je),At),At<Gt)return!0;const Lt=Te.aabb.closestPoint(L);return Lt[0]===L[0]&&Lt[1]===L[1]};if(this.renderWorldCopies)for(let Te=1;Te<=3;Te++)Se.push(he(-Te)),Se.push(he(Te));for(Se.push(he(0));Se.length>0;){const Te=Se.pop(),Ke=Te.x,We=Te.y;let ft=Te.fullyVisible;const vt=()=>this.projection.name==="globe"&&(Te.y===0||Te.y===(1<<Te.zoom)-1);if(!ft){let At=oe?Te.aabb.intersects(U):Te.aabb.intersectsFlat(U);if(At===0&&vt()){const xt=new s.cD(Te.zoom,Ke,We);At=s.cE(this,R,xt,!0).intersects(U)}if(At===0)continue;ft=At===2}if(Te.zoom===Le||!Fe(Te)){const At=Te.zoom===Le?Ze:Te.zoom;if(n.minzoom&&n.minzoom>At)continue;let xt=0;if(!ft){let Lt=oe?Te.aabb.intersectsPrecise(U):Te.aabb.intersectsPreciseFlat(U);if(Lt===0&&vt()){const jt=new s.cD(Te.zoom,Ke,We);Lt=s.cE(this,R,jt,!0).intersectsPrecise(U)}if(Lt===0)continue;if(n.calculateQuadrantVisibility)if(U.containsPoint(Te.aabb.center))xt=15;else for(let jt=0;jt<4;jt++)Te.aabb.quadrant(jt).intersects(U)!==0&&(xt|=1<<jt)}const wt=L[0]-(.5+Ke+(Te.wrap<<Te.zoom))*(1<<u-Te.zoom),qt=L[1]-.5-We,Gt=Te.tileID?Te.tileID:new s.aQ(At,Te.wrap,Te.zoom,Ke,We);n.calculateQuadrantVisibility&&(Gt.visibleQuadrants=xt),ze.push({tileID:Gt,distanceSq:wt*wt+qt*qt});continue}for(let At=0;At<4;At++){const xt=(Ke<<1)+At%2,wt=(We<<1)+(At>>1),qt={aabb:w?Te.aabb.quadrant(At):s.cF(this,R,Te.zoom+1,xt,wt,Te.wrap,Te.minZ,Te.maxZ,this.projection),zoom:Te.zoom+1,x:xt,y:wt,wrap:Te.wrap,fullyVisible:ft,tileID:void 0,shouldSplit:void 0,minZ:Te.minZ,maxZ:Te.maxZ};b&&!N&&(qt.tileID=new s.aQ(Te.zoom+1===Le?Ze:Te.zoom+1,Te.wrap,Te.zoom+1,xt,wt),tt(qt)),Se.push(qt)}}if(this.fogCullDistSq){const Te=this.fogCullDistSq,Ke=this.horizonLineFromTop();ze=ze.filter(We=>{const ft=[0,0,0,1],vt=[s.al,s.al,0,1],At=this.calculateFogTileMatrix(We.tileID.toUnwrapped());s.aC(ft,ft,At),s.aC(vt,vt,At);const xt=s.cG([],ft,vt),wt=s.cH([],ft,vt),qt=s.c$(xt,wt);if(qt===0)return!0;let Gt=!1;const Lt=this._elevation;if(Lt&&qt>Te&&Ke!==0){const jt=this.calculateProjMatrix(We.tileID.toUnwrapped());let oi;n.isTerrainDEM||(oi=Lt.getMinMaxForTile(We.tileID)),oi||(oi={min:_e,max:be});const fi=s.cI(this.rotation),Bi=[fi[0]*s.al,fi[1]*s.al,oi.max];s.af(Bi,Bi,jt),Gt=(1-Bi[1])*this.height*.5<Ke}return qt<Te||Gt})}return ze.sort((Te,Ke)=>Te.distanceSq-Ke.distanceSq).map(Te=>Te.tileID)}resize(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const u=s.aA(n.lat,-s.cJ,s.cJ),p=this.projection.project(n.lng,u);return new s.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,u){let p,y;const b=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;p=(u.x-b.x)/E,y=(u.y-b.y)/E}else{const E=this.pointCoordinate(u),I=this.pointCoordinate(b);p=E.x-I.x,y=E.y-I.y}const w=this.locationCoordinate(n);this.setLocation(new s.ae(w.x-p,w.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,u){return this.projection.locationPoint(this,n,u)}locationPoint3D(n,u){return this.projection.locationPoint(this,n,u,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,u){return this.coordinateLocation(this.pointCoordinate3D(n,u))}locationCoordinate(n,u){const p=u?s.cf(u,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new s.ae(y.x,y.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,u){const p=u??this._centerAltitude,y=[n.x,n.y,0,1],b=[n.x,n.y,1,1];s.aC(y,y,this.pixelMatrixInverse),s.aC(b,b,this.pixelMatrixInverse);const w=b[3];s.cK(y,y,1/y[3]),s.cK(b,b,1/w);const E=y[2],I=b[2];return{p0:y,p1:b,t:E===I?0:(p-E)/(I-E)}}screenPointToMercatorRay(n){const u=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return s.aC(u,u,this.pixelMatrixInverse),s.aC(p,p,this.pixelMatrixInverse),s.cK(u,u,1/u[3]),s.cK(p,p,1/p[3]),u[2]=s.cf(u[2],this._center.lat)*this.worldSize,p[2]=s.cf(p[2],this._center.lat)*this.worldSize,s.cK(u,u,1/this.worldSize),s.cK(p,p,1/this.worldSize),new s.ax([u[0],u[1],u[2]],s.aw([],s.av([],p,u)))}rayIntersectionCoordinate(n){const{p0:u,p1:p,t:y}=n,b=s.cf(u[2],this._center.lat),w=s.cf(p[2],this._center.lat);return new s.ae(s.ak(u[0],p[0],y)/this.worldSize,s.ak(u[1],p[1],y)/this.worldSize,s.ak(b,w,y))}pointCoordinate(n,u=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,u)}pointCoordinate3D(n,u){if(!this.elevation)return this.pointCoordinate(n,u);let p=this.projection.pointCoordinate3D(this,n.x,n.y);if(p)return new s.ae(p[0],p[1],p[2]);let y=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n,u);const w=.02*b,E=n.clone();for(let I=0;I<10&&b-y>w;I++){E.y=s.ak(y,b,.66);const R=this.projection.pointCoordinate3D(this,E.x,E.y);R?(b=E.y,p=R):y=E.y}return p?new s.ae(p[0],p[1],p[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.cL)return!this.isPointAboveHorizon(n);const u=this.pointCoordinate(n);return u.y>=0&&u.y<=1}_coordinatePoint(n,u){const p=u&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return s.aC(y,y,this.pixelMatrix),y[3]>0?new s.P(y[0]/y[3],y[1]/y[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:u}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.P(u,n)),w=this.pointLocation3D(new s.P(y,n)),E=this.pointLocation3D(new s.P(y,p)),I=this.pointLocation3D(new s.P(u,p));let R=Math.min(b.lng,w.lng,E.lng,I.lng),L=Math.max(b.lng,w.lng,E.lng,I.lng),N=Math.min(b.lat,w.lat,E.lat,I.lat),B=Math.max(b.lat,w.lat,E.lat,I.lat);const U=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,G=(X,K,oe,re,ne)=>{const be=(X+oe)/2,_e=(K+re)/2,ve=new s.P(be,_e),{lng:pe,lat:he}=this.pointLocation3D(ve),Se=Math.max(0,R-pe,N-he,pe-L,he-B);R=Math.min(R,pe),L=Math.max(L,pe),N=Math.min(N,he),B=Math.max(B,he),(ne<W||Se>U)&&(G(X,K,be,_e,ne+1),G(be,_e,oe,re,ne+1))};if(G(u,n,y,n,1),G(y,n,y,p,1),G(y,p,u,p,1),G(u,p,u,n,1),this.projection.name==="globe"){const[X,K]=s.cM(this);X?(B=90,L=180,R=-180):K&&(N=-90,L=180,R=-180)}return new s.aI(new s.aT(R,N),new s.aT(L,B))}_getBoundsRectangular(n,u){const{top:p,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,E=new s.P(y,p),I=new s.P(w,p),R=new s.P(w,b),L=new s.P(y,b);let N=this.pointCoordinate(E,n),B=this.pointCoordinate(I,n);const U=this.pointCoordinate(R,u),W=this.pointCoordinate(L,u),G=(X,K)=>(K.y-X.y)/(K.x-X.x);return N.y>1&&B.y>=0?N=new s.ae((1-W.y)/G(W,N)+W.x,1):N.y<0&&B.y<=1&&(N=new s.ae(-W.y/G(W,N)+W.x,0)),B.y>1&&N.y>=0?B=new s.ae((1-U.y)/G(U,B)+U.x,1):B.y<0&&N.y<=1&&(B=new s.ae(-U.y/G(U,B)+U.x,0)),new s.aI().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=n.visibleDemTiles.reduce((p,y)=>{if(y.dem){const b=y.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*n.exaggeration(),u.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-u*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.cJ,this.maxLat=s.cJ,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,u){return this.projection.createTileMatrix(this,u,n)}calculateDistanceTileData(n){const u=n.key,p=this._distanceTileDataCache;if(p[u])return p[u];const y=n.canonical,b=1/this.height,w=this.cameraWorldSize,E=w/this.zoomScale(y.z),I=(y.x+Math.pow(2,y.z)*n.wrap)*E,R=y.y*E,L=this.point;L.x*=w/this.worldSize,L.y*=w/this.worldSize;const N=this.angle,B=Math.sin(-N),U=-Math.cos(-N);return p[u]={bearing:[B,U],center:[(L.x-I)*b,(L.y-R)*b],scale:E/s.al*b},p[u]}calculateFogTileMatrix(n){const u=n.key,p=this._fogTileMatrixCache;if(p[u])return p[u];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.aB(y,this.worldToFogMatrix,y),p[u]=new Float32Array(y),p[u]}calculateProjMatrix(n,u=!1,p=!1){const y=n.key;let b;if(b=p?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const w=this.calculatePosMatrix(n,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,s.aB(w,E,w),b[y]=new Float32Array(w),b[y]}calculatePixelsToTileUnitsMatrix(n){const u=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[u])return p[u];const y=s.cN(n,this);return p[u]=y,p[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,u=s.bq([],[n,n,n]);return s.aB(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const u=s.cf(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),y=this._camera.forward(),b=s.cf(1,this._center.lat);p[2]/=b,y[2]/=b,s.aw(y,y);const w=n.raycast(p,y,n.exaggeration());if(w){const E=s.bH([],p,y,w),I=new s.ae(E[0],E[1],s.cf(E[2],s.a$(E[1]))),R=(I.z+s.ag([I.x-p[0],I.y-p[1],I.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const u=this._elevation,p=s.cf(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),b=u.getAtPointOrZero(new s.ae(...y)),w=this.pixelsPerMeter/this.worldSize*b,E=this._minimumHeightOverTerrain(),I=y[2]-w;if(I<=E)if(I<0||n){const R=this.locationCoordinate(this._center,this._centerAltitude),L=[y[0],y[1],R.z-y[2]],N=s.ag(L);L[2]-=(E-I)/this._pixelsPerMercatorPixel;const B=s.ag(L);if(B===0)return;s.c5(L,L,N/B*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],R.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const B=this.center;return B.lat=s.aA(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(B.lng=s.aA(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const u=this._unmodified,{x:p,y}=this.point;let b=0,w=p,E=y;const I=this.width/2,R=this.height/2,L=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(y-R<L&&(E=L+R),y+R>N&&(E=N-R),N-L<this.height&&(b=Math.max(b,this.height/(N-L)),E=(N+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,W=this.worldSize/2-(B+U)/2;w=(p+W+this.worldSize)%this.worldSize-W,w-I<B&&(w=B+I),w+I>U&&(w=U-I),U-B<this.width&&(b=Math.max(b,this.width/(U-B)),w=(U+B)/2)}w===p&&E===y||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(w,E))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,u=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cf(1,this.center.lat)/s.cf(1,s.d2));const y=s.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,w=this._camera.getWorldToCamera(this.worldSize,b);let E;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-n.x/this.width,I[9]=2*n.y/this.height,this.isOrthographic){let he=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Se=he*this.aspect,ze=-Se,Le=-he;Se-=n.x,ze-=n.x,he+=n.y,Le+=n.y,E=this._camera.getCameraToClipOrthographic(ze,Se,Le,he,this._nearZ,this._farZ),((Ze,je,tt,dt)=>{for(let Fe=0;Fe<16;Fe++)Ze[Fe]=s.ak(je[Fe],tt[Fe],dt)})(E,E,I,s.d0(this.pitch>=Oa?1:this.pitch/Oa))}else E=I;const R=s.cP([],I,w);let L=s.cP([],E,w);if(this.projection.isReprojectedInTileSpace){const he=this.locationCoordinate(this.center),Se=s.bA([]);s.br(Se,Se,[he.x*this.worldSize,he.y*this.worldSize,0]),s.aB(Se,Se,s.cQ(this)),s.br(Se,Se,[-he.x*this.worldSize,-he.y*this.worldSize,0]),s.aB(L,L,Se),s.aB(R,R,Se),this.inverseAdjustmentMatrix=s.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cS([],L,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=L,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),u){const he=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);he[8]=2*-n.x/this.width,he[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.cP([],he,w)}else this.expandedFarZProjMatrix=this.projMatrix;const N=s.bl([],E);this.frustumCorners=s.cT.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const B=new Float32Array(16);s.bA(B),s.cS(B,B,[1,-1,1]),s.cU(B,B,this._pitch),s.bB(B,B,this.angle);const U=s.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(U);const W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-n.x/this.width,U[9]=2*(n.y+W)/this.height,this.skyboxMatrix=s.aB(B,U,B);const G=this.point,X=G.x,K=G.y,oe=this.width%2/2,re=this.height%2/2,ne=Math.cos(this.angle),be=Math.sin(this.angle),_e=X-Math.round(X)+ne*oe+be*re,ve=K-Math.round(K)+ne*re+be*oe,pe=new Float64Array(L);if(s.br(pe,pe,[_e>.5?_e-1:_e,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=pe,L=s.bC(),s.cS(L,L,[this.width/2,-this.height/2,1]),s.br(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=s.bC(),s.cS(L,L,[1,-1,1]),s.br(L,L,[-1,-1,0]),s.cS(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},L=s.bl(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cV(this);const he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(he,he,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,u];s.c5(b,b,y),s.c5(p,p,-1),s.cW(p,p,b);const w=s.bC();s.br(w,w,p),s.cS(w,w,b),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,u,y)}_computeCameraPosition(n){const u=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*b,y.y/this.worldSize-p[1]*b,n/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((u-p)/y,1)),this._camera.position=s.bH([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,u=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),b=s.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),E=Math.max((n[2]-b)/Math.cos(p),w),I=this._zoomFromMercatorZ(E);s.bH(n,n,u,E),this._pitch=s.aA(p,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(y,-Math.PI,Math.PI),this._setZoom(s.aA(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let u=0,p=s.cL,y=0,b=1/0;for(;p-u>1e-6&&p>u;){const w=u+.5*(p-u),E=this.tileSize*Math.pow(2,w),I=this.getCameraToCenterDistance(this.projection,w,E),R=this.scaleZoom(I/(Math.max(0,n)*this.tileSize)),L=Math.abs(w-R);L<b&&(b=L,y=w),w<R?u=w:p=w}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,u){const p=Math.min(n.x,u.x),y=Math.max(n.x,u.x),b=Math.min(n.y,u.y),w=Math.max(n.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new s.P(p,b),new s.P(y,w),new s.P(p,w),new s.P(y,b)],I=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const L of E){const N=this.pointRayIntersection(L);if(N.t<0)return!0;const B=this.rayIntersectionCoordinate(N);if(B.x<I||B.y<0||B.x>R||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,u){const p=s.ag(s.av([],this._camera.position,n)),y=this._zoomFromMercatorZ(p)+u;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([u,p,y],b){const w=[u,p,y,1];s.aC(w,w,b);const E=w[3]=Math.max(w[3],1e-6);return w[0]/=E,w[1]/=E,w[2]/=E,w})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,u=this.zoom,p=this.worldSize){const y=s.cO(n,u,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,p,y);let w=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(w=s.ak(1,w,s.d0(this.pitch>=Oa?1:this.pitch/Oa))),w}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(n,n,this.globeMatrix),n}getFrustum(n){return s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const na=(f,n)=>{if(n>0&&f.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=f.transform,p=Math.max(Math.abs(u._zoom-(f.minCutoffZoom-1)),1),y=u.isLODDisabled(!1)?s.ah(60,45,u.pitch):s.ah(30,15,u.pitch),b=u._farZ-u._nearZ,w=n*u.height,E=((1-(I=y))*u.cameraToCenterDistance+I*(u._farZ+w))*p;var I;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(E-u._nearZ)/b,(E-w-u._nearZ)/b]}}},Bl=2048;class Zw{constructor(n,u){this.aabb=n,this.lastCascade=u}}class ph{add(n,u){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],u.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],u.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],u.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],u.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],u.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],u.max[2])):this.receivers[n.key]=new Zw(u,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,u,p){const y=s.d9.fromPoints(n.points);let b=0;for(const w in this.receivers){const E=this.receivers[w];if(!E||!y.intersectsAabb(E.aabb))continue;E.aabb.min=y.closestPoint(E.aabb.min),E.aabb.max=y.closestPoint(E.aabb.max);const I=E.aabb.getCorners();for(let R=0;R<p.length;R++){let L=!0;for(const N of I){const B=[N[0]*u,N[1]*u,N[2]];if(s.af(B,B,p[R].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){L=!1;break}}if(E.lastCascade=R,b=Math.max(b,R),L)break}}return b+1}}class mh{constructor(n){this.painter=n,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ph,this._depthMode=new Kt(n.context.gl.LEQUAL,Kt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,u){const p=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!u||!u.properties)return;const y=u.properties.get("shadow-intensity"),b=u.properties.get("shadow-draw-before-layer");if(!u.shadowsEnabled()||y<=0)return;let w=-1,E=0;for(const K of p.style.order){const oe=p.style._mergedLayers[K];oe.hasShadowPass()&&!oe.isHidden(n.zoom)&&(w=E),b&&b===K&&(this._drawShadowAfterLayer=E>0?E-1:0),E+=1}if(this._enabled=w>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=w);const I=p.context,R=Bl,L=Bl;if(this._cascades.length===0||Bl!==this._cascades[0].texture.size[0]){this._cascades=[];for(let K=0;K<2;++K){const oe=p._shadowMapDebug,re=I.gl,ne=I.createFramebuffer(R,L,oe?1:0,"texture"),be=new s.T(I,{width:R,height:L,data:null},re.DEPTH_COMPONENT16);if(ne.depthAttachment.set(be.texture),oe){const _e=new s.T(I,{width:R,height:L,data:null},re.RGBA8);ne.colorAttachment0.set(_e.texture)}this._cascades.push({framebuffer:ne,texture:be,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cB,scale:0})}}this.shadowDirection=Yy(u);let N=0;if(n.elevation){const K=n.elevation,oe=[1e4,-1e4];K.visibleDemTiles.filter(re=>re.dem).forEach(re=>{const ne=re.dem.tree;oe[0]=Math.min(oe[0],ne.minimums[0]),oe[1]=Math.max(oe[1],ne.maximums[0])}),oe[0]!==1e4&&(N=(oe[1]-oe[0])*K.exaggeration())}const B=1.5*n.cameraToCenterDistance,U=3*B,W=new Float64Array(16);for(let K=0;K<this._cascades.length;++K){const oe=this._cascades[K];let re=n.height/50,ne=1;K===0?ne=B:(re=B,ne=U);const[be,_e]=Ky(n,this.shadowDirection,re,ne,Bl,N);oe.scale=n.scale,oe.matrix=be,oe.boundingSphereRadius=_e,s.bl(W,oe.matrix),oe.frustum=s.cB.fromInvProjectionMatrix(W,1,0,!0),oe.far=ne}const G=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[G].far,this._cascades[G].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Bl,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const X=p.transform.elevation;for(const K of this._groundShadowTiles){let oe={min:0,max:0};if(X){const re=X.getMinMaxForTile(K);re&&(oe=re)}this.addShadowReceiver(K.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,u){if(!this.enabled)return;const p=this.painter,y=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),y.viewport.set([0,0,Bl,Bl]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:s.ao.white,depth:1});for(const w of n.order){const E=n._mergedLayers[w];if(!E.hasShadowPass()||E.isHidden(p.transform.zoom))continue;const I=n.getLayerSourceCache(E),R=I?u[I.id]:void 0;(E.type==="model"||R&&R.length)&&p.renderLayer(p,I,E,R)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,u=n.style,p=n.context,y=p.gl,b=u.directionalLight,w=u.ambientLight;if(!b||!w)return;const E=[],I=na(n,n.longestCutoffRange);I.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const R=ra(u,b,w),L=new Kt(y.LEQUAL,Kt.ReadOnly,n.depthRangeFor3D),N=new vi({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const B of this._groundShadowTiles){const U=B.toUnwrapped(),W=n.isTileAffectedByFog(B),G=n.getOrCreateProgram("groundShadow",{defines:E,overrideFog:W});this.setupShadows(U,G),n.uploadCommonUniforms(p,G,U,null,I);const X=as(n.transform.calculateProjMatrix(U),R);G.draw(n,y.TRIANGLES,L,N,Ii.multiply,di.disabled,X,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ii.unblended:Ii.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(n){const u=this.painter.transform,p=u.calculatePosMatrix(n,u.worldSize);return s.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){const u=s.bz(n);return s.aB(u,this._cascades[this.painter.currentShadowCascade].matrix,n),u}setupShadows(n,u,p){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,w=b.gl,E=this._uniformValues,I=new Float64Array(16),R=y.calculatePosMatrix(n,y.worldSize);for(let L=0;L<this._cascades.length;L++)s.aB(I,this._cascades[L].matrix,R),E[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),b.activeTexture.set(w.TEXTURE0+11+L),this._cascades[L].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const L=s.d7(n.canonical),N=2/y.tileSize*s.al/Bl,B=N*this._cascades[0].boundingSphereRadius,U=N*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(p==="vector-tile"?1:3)*(function(G){const X=s.aA((G-22)/-22,0,1);return .125*(1-X)+4*X})(y.zoom);E.u_shadow_normal_offset=[L,B*W,U*W],E.u_shadow_bias=[1e-4,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(b,E)}setupShadowsFromMatrix(n,u,p=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,w=this._uniformValues,E=new Float64Array(16);for(let I=0;I<2;I++)s.aB(E,this._cascades[I].matrix,n),w[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),y.activeTexture.set(b.TEXTURE0+11+I),this._cascades[I].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);this.useNormalOffset=p,p?(w.u_shadow_normal_offset=[1,3,3],w.u_shadow_bias=[6e-5,.0012,.012]):w.u_shadow_bias=[36e-5,.0012,.012],u.setShadowUniformValues(y,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,u,p,y){if(y[2]>=0)return{};const b=(function(I,R,L){const N=L/(1<<I.canonical.z);return new s.d9([I.canonical.x*N+I.wrap*L,I.canonical.y*N+I.wrap*L,0],[(I.canonical.x+1)*N+I.wrap*L,(I.canonical.y+1)*N+I.wrap*L,R])})(n,u,p).getCorners(),w=u/-y[2];y[0]<0?(s.d8(b[0],b[0],[y[0]*w,0,0]),s.d8(b[3],b[3],[y[0]*w,0,0])):y[0]>0&&(s.d8(b[1],b[1],[y[0]*w,0,0]),s.d8(b[2],b[2],[y[0]*w,0,0])),y[1]<0?(s.d8(b[0],b[0],[0,y[1]*w,0]),s.d8(b[1],b[1],[0,y[1]*w,0])):y[1]>0&&(s.d8(b[2],b[2],[0,y[1]*w,0]),s.d8(b[3],b[3],[0,y[1]*w,0]));const E={};return E.vertices=b,E.planes=[Ud(b[1],b[0],b[4]),Ud(b[2],b[1],b[5]),Ud(b[3],b[2],b[6]),Ud(b[0],b[3],b[7])],E}addShadowReceiver(n,u,p){this._receivers.add(n,s.d9.fromTileIdAndHeight(n,u,p))}getMaxCascadeForTile(n){const u=this._receivers.get(n);return u&&u.lastCascade?u.lastCascade:0}}function Ud(f,n,u){const p=s.av([],u,n),y=s.av([],f,n),b=s.bI([],p,y),w=s.ag(b);return w===0?[0,0,1,0]:(s.c5(b,b,1/w),[b[0],b[1],b[2],-s.bJ(b,n)])}function Yy(f){const n=f.properties.get("direction"),u=s.d4(n.x,n.y,n.z);u[2]=s.aA(u[2],0,75);const p=s.d6([u[0],u[1],u[2]]);return s.d5(p.x,p.y,p.z)}function ra(f,n,u){const p=n.properties.get("color-use-theme")==="none",y=n.properties.get("color"),b=n.properties.get("intensity"),w=n.properties.get("direction"),E=[w.x,w.y,w.z],I=u.properties.get("color-use-theme")==="none",R=u.properties.get("color"),L=u.properties.get("intensity"),N=Math.max(s.bJ([0,0,1],E),0),B=[0,0,0];s.c5(B,R.toPremultipliedRenderColor(I?null:f.getLut(n.scope)).toArray01Linear().slice(0,3),L);const U=[0,0,0];return s.c5(U,y.toPremultipliedRenderColor(p?null:f.getLut(u.scope)).toArray01Linear().slice(0,3),N*b),s.db([B[0]>0?B[0]/(B[0]+U[0]):0,B[1]>0?B[1]/(B[1]+U[1]):0,B[2]>0?B[2]/(B[2]+U[2]):0])}function Ky(f,n,u,p,y,b){const w=f.zoom,E=f.scale,I=f.worldSize,R=1/I,L=f.aspect,N=Math.sqrt(1+L*L)*Math.tan(.5*f.fovX),B=N*N,U=p-u,W=p+u;let G,X;B>U/W?(G=p,X=p*N):(G=.5*W*(1+B),X=.5*Math.sqrt(U*U+2*(p*p+u*u)*B+W*W*B*B));const K=f.projection.pixelsPerMeter(f.center.lat,I),oe=f._camera.getCameraToWorldMercator(),re=[0,0,-G*R];s.af(re,re,oe);let ne=X*R;const be=function(ft){return ft[0]/=E,ft[1]/=E,ft[2]=s.cf(ft[2],f._center.lat),ft},_e=f._edgeInsets;if(!(_e.left===0&&_e.top===0&&_e.right===0&&_e.bottom===0||_e.left===_e.right&&_e.top===_e.bottom)){const ft=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?K:1),vt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,u,p);vt[8]=2*-f.centerOffset.x/f.width,vt[9]=2*f.centerOffset.y/f.height;const At=new Float64Array(16);s.cP(At,vt,ft);const xt=new Float64Array(16);s.bl(xt,At);const wt=s.cB.fromInvProjectionMatrix(xt,I,w,!0);for(const qt of wt.points){const Gt=be(qt);ne=Math.max(ne,s.c6(s.da([],re,Gt)))}}ne*=y/(y-1);const ve=Math.acos(n[2]),pe=Math.atan2(-n[0],-n[1]),he=new Kc;he.position=re,he.setPitchBearing(ve,pe);const Se=he.getWorldToCamera(I,K),ze=ne*I,Le=Math.min(f._mercatorZfromZoom(17)*I*-2,-2*ze),Ze=he.getCameraToClipOrthographic(-ze,ze,-ze,ze,Le,(ze+b*K)/n[2]),je=new Float64Array(16);s.aB(je,Ze,Se);const tt=s.d5(Math.floor(1e6*re[0])/1e6*I,Math.floor(1e6*re[1])/1e6*I,0),dt=.5*y,Fe=[0,0,0];s.af(Fe,tt,je),s.c5(Fe,Fe,dt);const Te=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],Ke=[0,0,0];s.av(Ke,Fe,Te),s.c5(Ke,Ke,-1/dt);const We=new Float64Array(16);return s.bA(We),s.br(We,We,Ke),s.aB(je,We,je),[je,ze]}class $d extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,u){return s.dc(this.requestManager.transformRequest(u,s.R.Model).url).then(p=>{if(!p)return;const y=s.dd(p),b=new s.de(n,u,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b}).catch(p=>{if(p&&p.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${n} from ${u}: ${p.message}`)))})}load(n,u,p={forceReload:!1}){this.models[u]||(this.models[u]={});const y=Object.keys(n),b=[],w=[];for(const E of y){const I=n[E];this.hasURLBeenRequested(I)&&!p.forceReload||(this.modelByURL[I]={modelId:E,scope:u},b.push(this.loadModel(E,I)),w.push(E)),this.models[u][E]||(this.models[u][E]={model:null,numReferences:1})}this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+w.length,Promise.allSettled(b).then(E=>{for(let I=0;I<E.length;I++){const{status:R}=E[I];if(R==="rejected")continue;const{value:L}=E[I];this.models[u][w[I]]||(this.models[u][w[I]]={model:null,numReferences:1}),this.models[u][w[I]].model=L}this.numModelsLoading[u]-=w.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(E=>{this.fire(new s.y(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,u,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(n,u):this.getModelByURL(this.modelUris[u][n]))}getModel(n,u){return this.models[u]||(this.models[u]={}),this.models[u][n]?this.models[u][n].model:void 0}getModelByURL(n){if(!n)return null;const u=this.modelByURL[n];return u?this.models[u.scope][u.modelId].model:null}hasModelBeenAdded(n,u){return this.models[u]&&this.models[u][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,u,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const y=this.requestManager.normalizeModelURL(u);if((this.hasModel(n,p,{exactIdMatch:!0})||this.hasModelBeenAdded(n,p))&&this.modelUris[p][n]===y)this.models[p][n].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:b,modelId:w}=this.modelByURL[y];this.models[b][w].numReferences++}else this.modelUris[p][n]=y,this.load({[n]:this.modelUris[p][n]},p)}addModelURLs(n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const p=this.modelUris[u];for(const y in n)p[y]=this.requestManager.normalizeModelURL(n[y])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const p={};for(const y of n)this.hasModel(y,u,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[u][y].numReferences++:this.modelUris[u][y]&&!this.hasURLBeenRequested(y)?p[y]=this.modelUris[u][y]:!this.hasURLBeenRequested(y)&&s.df(y,!1)&&(this.modelUris[u][y]=this.requestManager.normalizeModelURL(y),p[y]=this.modelUris[u][y]);this.load(p,u)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,u,p=!1,y=!1){if(this.models[u]&&this.models[u][n]&&(this.models[u][n].numReferences--,this.models[u][n].numReferences===0||y)){const b=this.modelUris[u][n];p||delete this.modelUris[u][n],delete this.modelByURL[b];const w=this.models[u][n].model;if(!w)return;delete this.models[u][n],w.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const u of Object.keys(this.models[n])){const p=this.models[n][u].model;delete this.models[n][u],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,u){this.models[u]||(this.models[u]={});for(const p in this.models[u])this.models[u][p].model&&this.models[u][p].model.upload(n.context)}}const gh=s.a6.colorTheme,Nl=new s.a9({data:new s.aa(gh.data)});function Ww(f){if(!f.metadata||!f.metadata.content_area)return;const n=s.o.devicePixelRatio,{left:u,top:p,width:y,height:b}=f.metadata.content_area,w=u*n,E=p*n;return[w,E,w+y*n,E+b*n]}function Qy(f){if(f)return f.map(([n,u])=>[n*s.o.devicePixelRatio,u*s.o.devicePixelRatio])}class qw{constructor(n,u,p){this.id=n,this.scope=u,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const u=this.sourceCache.getVisibleCoordinates();if(u.length===0)return n;const p=this.sourceCache.getSource();if(!(p instanceof No))return n;const y=u.map(w=>this.sourceCache.getTile(w)),b=p.getImages(y,Array.from(this.pendingRequests));for(const[w,E]of b)n.set(s.I.from({name:w,iconsetId:this.id}),E),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),n}}class cm{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",u=>this._onIndoorUpdate(u)),this._container}_createButton(n,u){const p=se("button",n,this._container);return p.type="button",p.addEventListener("click",u),p}_createSeparator(){return se("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,u){this._map&&(n.setAttribute("aria-label",u),n.textContent=u)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return this._model=n,void(this._container.style.display="none");const u=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px",u&&Array.from(this._container.children).forEach(p=>p.remove()),n.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(n.floors,n.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const n=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const u=this._map;this._model&&u&&u._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});se("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden","true"),n.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&n.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(n),this._createSeparator()}_updateBuildingsButtonState(){const n=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");n&&this._model&&(this._model.activeFloorsVisible?n.classList.remove("mapboxgl-ctrl-level-button-selected"):n.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(n,u){for(let p=0;p<n.length;p++){const y=n[p],b=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(y.id)}),w=(y.name||"").trim(),E=y.zIndex.toString(),I=w?Array.from(w).slice(0,3).join(""):E;this._setButtonTitle(b,I),this._model&&y.id===this._model.selectedFloorId&&u&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),p<n.length-1&&this._createSeparator()}}}class Xw extends s.E{constructor(n){super(),this._style=n,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(n){n===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=n,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(n){this._activeFloorsVisible=n,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(n){for(const[u,p]of Object.entries(n.buildings))if(this._buildings[u])for(const y of p.floorIds)this._buildings[u].floors[y]||(this._buildings[u].floors[y]=p.floors[y]);else this._buildings[u]=p;for(const u of n.activeFloors)this._activeFloors.add(u);this._updateIndoorSelector()}getIndoorTileOptions(n,u){const p=this._style.getIndoorSourceLayers(n,u);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new cm,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const n=this._style.map.transform,u=(function(p,y,b,w){let E=null,I=Number.MAX_SAFE_INTEGER;if(w<16)return null;for(const[R,L]of Object.entries(p)){const N=L.center;if(N){const B=y.distanceTo(s.aT.convert(N));B<I&&b.contains(N)&&(I=B,E=R)}}return E})(this._buildings,n.center,n.getBounds(),n.zoom);u!==this._closestBuildingId&&(this._closestBuildingId=u,this._updateIndoorSelector())}_updateIndoorSelector(){const n=this._buildings,u=this._closestBuildingId,p=u&&n?n[u]:void 0;if(!p)return this._removeIndoorControl(),void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let y=null;for(const w of p.floorIds)if(this._activeFloors&&this._activeFloors.has(w)){y=w;break}const b=Array.from(p.floorIds).map(w=>({id:w,name:p.floors[w].name,zIndex:p.floors[w].zIndex})).sort((w,E)=>E.zIndex-w.zIndex).filter((w,E,I)=>E===0||w.zIndex!==I[E-1].zIndex);this.fire(new s.z("selector-update",{selectedFloorId:y,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const n=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:n,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const ul=(f,n)=>Me(f,n&&n.filter(u=>u.identifier!=="source.canvas")),ev=s.aH(un,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),tv=s.aH(un,["setCenter","setZoom","setBearing","setPitch"]),Vd=new Set(["background","sky","slot","custom"]),um={version:8,layers:[],sources:{}},Ul={duration:300,delay:0};class vs extends s.E{constructor(n,u={}){super(),this.map=n,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=Object.assign({},Ul),this._buildingIndex=new ah(this),this.crossTileSymbolIndex=new Gr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=u.styleChanges||new Ce,this._hasDataDrivenEmissive=!1,this.indoorManager=new Xw(this),this.dispatcher=u.dispatcher?u.dispatcher:new s.D(s.dh(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new Xt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new s.di(n._requestManager,u.localFontFamily?s.dj.all:u.localIdeographFontFamily?s.dj.ideographs:s.dj.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new $d(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._indoorDependentLayers=u.indoorDependentLayers?u.indoorDependentLayers:new Set,this._config=u.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:u.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",s.dk());const p=this;this._rtlTextPluginCallback=vs.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,w)=>{if(s.dl(b),w&&w.every(E=>E))for(const E in p._sourceCaches){const I=p._sourceCaches[E],R=I.getSource().type;R!=="vector"&&R!=="geojson"||I.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const w in this._layers){const E=this._layers[w];E.source===b.id&&this._validateLayer(E)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(s.h(n))return n;const u=s.dm(n);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${s.dn(JSON.stringify(n))}`}_diffStyle(n,u,p){this.globalId=this._getGlobalId(n);const y=(b,w)=>{try{w(null,this.setState(b,p))}catch(E){w(E,!1)}};if(typeof n=="string"){const b=this.map._requestManager.normalizeStyleURL(n),w=this.map._requestManager.transformRequest(b,s.R.Style);s.m(w,(E,I)=>{E?this.fire(new s.y(E)):I&&y(I,u)})}else typeof n=="object"&&y(n,u)}loadURL(n,u={}){this.fire(new s.z("dataloading",{dataType:"style"}));const p=typeof u.validate=="boolean"?u.validate:!s.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,u.accessToken),this.resolvedImports.add(n);const y=this.importsCache.get(n);if(y)return this._load(y,p);const b=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.m(b,(w,E)=>{if(this._request=null,w)this.fire(new s.y(w));else if(E)return this.importsCache.set(n,E),this._load(E,p)})}loadJSON(n,u={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=s.o.frame(()=>{this._request=null,this._load(n,u.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(um,!1)}_loadImports(n,u,p){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of n){const w=this._createFragmentStyle(b),E=new Promise(L=>{w.once("style.import.load",L),w.once("error",L)}).then(()=>this.mergeAll());if(y.push(E),this.resolvedImports.has(b.url)){w.loadEmpty();continue}const I=b.data||this.importsCache.get(b.url);I?(w.loadJSON(I,{validate:u}),this._isInternalStyle(I)&&(w.globalId=null)):b.url?w.loadURL(b.url,{validate:u}):w.loadEmpty();const R={style:w,id:b.id,config:b.config};if(p){const L=this.fragments.findIndex(({id:N})=>N===p);this.fragments=this.fragments.slice(0,L).concat(R).concat(this.fragments.slice(L))}else this.fragments.push(R)}return Promise.allSettled(y)}getImportGlobalIds(n=this,u=new Set){for(const p of n.fragments)p.style.globalId&&u.add(p.style.globalId),this.getImportGlobalIds(p.style,u);return[...u.values()]}_createFragmentStyle(n){const u=this.scope?s.B(n.id,this.scope):n.id;let p;const y=this._initialConfig&&this._initialConfig[u];(n.config||y)&&(p=Object.assign({},n.config,y));const b=new vs(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,u){if(this._isInternalStyle(n)){const b=Object.assign({},um,{imports:[{id:"basemap",data:n,url:""}]},n.center?{center:n.center}:{},n.bearing?{bearing:n.bearing}:{},n.pitch?{pitch:n.pitch}:{},n.zoom?{zoom:n.zoom}:{},n.light?{light:n.light}:{});return this._importedAsBasemap=!0,void this._load(b,u)}if(this.updateConfig(this._config,n.schema),u&&ul(this,ts(n)))return;this._loaded=!0,this.stylesheet=s.dp(n);const p=()=>{for(const I in n.sources)this.addSource(I,n.sources[I],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const I in n.iconsets)this.addIconset(I,n.iconsets[I]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const b=em(this.stylesheet.layers);if(this._order=b.map(I=>I.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const I=this.stylesheet.lights[0];this.light=new Be(I.properties,I.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Be(this.stylesheet.light)),this._layers={};for(const I of b){const R=s.du(I,this.scope,this._styleColorTheme.lut,this.options);R.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid),R.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(R.fqid),this._hasAppearances=this._hasAppearances||R.getAppearances().length!==0,R.setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R;const L=this.getOwnLayerSourceCache(R),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&R.canCastShadows()&&N&&(L.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const E=this.isRootStyle();n.imports?this._loadImports(n.imports,u).then(()=>{this._reloadImports(),this.fire(new s.z(E?"style.load":"style.import.load"))}).catch(I=>{this.fire(new s.y(new Error("Failed to load imports",I))),this.fire(new s.z(E?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(E?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{p()}).catch(w=>{s.w(`Couldn't load color theme from the stylesheet: ${w}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(n=>n.style.hasAppearances())}mergeAll(){let n,u,p,y,b,w,E,I,R,L;const N={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(n=B.light),B.stylesheet.lights)for(const U of B.stylesheet.lights)U.type==="ambient"&&B.ambientLight!=null&&(u=B.ambientLight),U.type==="directional"&&B.directionalLight!=null&&(p=B.directionalLight);y=this._prioritizeTerrain(y,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(b=B.fog),B.stylesheet.snow&&B.snow!=null&&(w=B.snow),B.stylesheet.rain&&B.rain!=null&&(E=B.rain),B.stylesheet.camera!=null&&(L=B.stylesheet.camera),B.stylesheet.projection!=null&&(I=B.stylesheet.projection),B.stylesheet.transition!=null&&(R=B.stylesheet.transition),N[B.scope]=B._styleColorTheme}}),this.light=n,this.ambientLight=u,this.directionalLight=p,this.fog=b,this.snow=w,this.rain=E,this._styleColorThemeForScope=N,y===null?delete this.terrain:this.terrain=y,this.camera=L||{"camera-projection":"perspective"},this.projection=I||{name:"mercator"},this.transition=Object.assign({},Ul,R),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(n){const u=p=>{for(const y of p.fragments)u(y.style);n(p)};u(this)}_prioritizeTerrain(n,u,p){const y=n&&n.drapeRenderMode===0;return p===null?u&&u.drapeRenderMode===0?u:y?n:null:u!=null&&(!n||y||u&&u.drapeRenderMode===1)?u:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{n=this._prioritizeTerrain(n,u.terrain,u.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(n=u.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},u={},p={};this.forEachFragmentStyle(y=>{for(const b in y._sourceCaches){const w=s.B(b,y.scope);n[w]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const w=s.B(b,y.scope);u[w]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const w=s.B(b,y.scope);p[w]=y._symbolSourceCaches[b]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle(n=>{if(n.stylesheet&&n.stylesheet.indoor)for(const u of Object.values(n.stylesheet.indoor)){const p=u,y=s.B(p.sourceId,n.scope);this._mergedIndoor[y]=new Set(p.sourceLayers||[])}})}mergeLayers(){const n={},u=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const E of w._order){const I=w._layers[E];if(I.type==="slot"){const R=s.dq(E);if(n[R])continue;n[R]=[]}I.slot&&n[I.slot]?n[I.slot].push(I):u.push(I)}}),this._mergedOrder=[];let y=-1;const b=(w=[])=>{for(const E of w)if(E.type==="slot"){const I=s.dq(E.id);n[I]&&b(n[I]),this._mergedSlots.push(I)}else{const I=s.B(E.id,E.scope);this._mergedOrder.push(I),p[I]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(u),this._has3DLayers){const w={};for(let E=0;E<this._mergedOrder.length;++E){const I=this._mergedOrder[E];w[I]=E===y?1:E<y?p[I].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((E,I)=>w[E]-w[I])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?(function(u,p,y){const b=Object.assign({},p);for(const E of Object.keys(gh))b[E]===void 0&&(b[E]=gh[E].default);const w=new s.a8(Nl,u,new Map(y));return w.setTransitionOrValue(b,y),w.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))})(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,y)=>{const b="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let w=n;w.startsWith(b)||(w=b+w);const E=s.I.from("mapbox-reserved-lut"),I=new Image;I.src=w,I.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},I.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void p();this._styleColorTheme.lutLoading=!1;const{width:R,height:L,data:N}=s.o.getImageData(I);if(L>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==L*L)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new s.q({width:R,height:L},N),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(E,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:n},p()):y(new Error("Missing LUT image."))}})}getLut(n){const u=this._styleColorThemeForScope[n];return u?u.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=(function(u,p,y){let b,w,E;const I=s.o.devicePixelRatio>1?"@2x":"";let R=s.m(p.transformRequest(p.normalizeSpriteURL(u,I,".json"),s.R.SpriteJSON),(B,U)=>{R=null,E||(E=B,b=U,N())}),L=s.n(p.transformRequest(p.normalizeSpriteURL(u,I,".png"),s.R.SpriteImage),(B,U)=>{L=null,E||(E=B,w=U,N())});function N(){if(E)y(E);else if(b&&w){const B=s.o.getImageData(w),U={};for(const W in b){const{width:G,height:X,x:K,y:oe,sdf:re,pixelRatio:ne,stretchX:be,stretchY:_e,content:ve}=b[W],pe=new s.q({width:G,height:X});s.q.copy(B,pe,{x:K,y:oe},{x:0,y:0},{width:G,height:X},null),U[W]={data:pe,pixelRatio:ne!==void 0?ne:1,sdf:re!==void 0&&re,stretchX:be,stretchY:_e,content:ve,usvg:!1,version:0}}y(null,U)}}return{cancel(){R&&(R.cancel(),R=null),L&&(L.cancel(),L=null)}}})(n,this.map._requestManager,(u,p)=>{if(this._spriteRequest=null,u)this.fire(new s.y(u));else if(p){const y=new Map;for(const b in p)y.set(s.I.from(b),p[b]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(n,u){if(u.type==="sprite")return void this._loadSprite(u.url);const p=this.getOwnSourceCache(u.source);if(!p)return void this.fire(new s.y(new Error(`Source "${u.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const y=p.getSource();if(y.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${u.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const b=new qw(n,this.scope,p);this.imageManager.addImageProvider(b,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!s.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const u=this.map._spriteFormat==="auto";var p,y;this._spriteRequest=(y=(b,w)=>{if(this._spriteRequest=null,b)u?this._loadSprite(n):this.fire(new s.y(b));else if(w){const E=new Map;for(const I in w)E.set(s.I.from(I),w[I]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(n),s.R.Iconset),(b,w)=>{if(b)return void y(b);const E={},I=s.dg(new s.bt(w));for(const R of I.icons){const L={version:1,pixelRatio:s.o.devicePixelRatio,content:Ww(R),stretchX:R.metadata?Qy(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?Qy(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};E[R.name]=L}y(null,E)}))}_validateLayer(n){const u=this.getOwnSource(n.source);if(!u)return;const p=n.sourceLayer;p&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.y(new Error(`Source layer "${p}" does not exist on source "${u.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,u)=>{const p=this.fragments[u];return p&&p.style&&(n.data=p.style.serialize()),n})}_serializeSources(){const n={};for(const u in this._sourceCaches){const p=this._sourceCaches[u].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const u=[];for(const p of n){const y=this._layers[p];y&&y.type!=="custom"&&u.push(y.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const n in this._mergedLayers){const u=this._mergedLayers[n];if(u._transitionablePaint&&u._transitionablePaint._values){const p=u._transitionablePaint._values["line-emissive-strength"];if(p&&p.value&&p.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const u=this.getOwnLayer(n);if(u)return u;this.fire(new s.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const u=this.getOwnSource(n);if(u)return u;this.fire(new s.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,u){const p=this.map.painter;if(p)for(let y=n.minzoom||0;y<(n.maxzoom||25.5);y++){const b=n.getProgramIds();if(b)for(const w of b){const E=n.getDefaultProgramParams(w,u.zoom,this._styleColorTheme.lut);E&&(p.style=this,this.fog&&(p._fogVisible=!0,E.overrideFog=!0,p.getOrCreateProgram(w,E)),p._fogVisible=!1,E.overrideFog=!1,p.getOrCreateProgram(w,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,p.getOrCreateProgram(w,E)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const u=this.calculateLightsBrightness();n.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const I in E){const{updatedIds:R,removedIds:L}=E[I];(R||L)&&(this._updateWorkerLayers(I,R,L),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const b={};for(const E in this._mergedSourceCaches){const I=this._mergedSourceCaches[E];b[E]=I.used,I.used=!1,I.tileCoverLift=0}for(const E of this._mergedOrder){const I=this._mergedLayers[E];if(I.visibility!=="none"&&I.recalculate(n,this._availableImages),!I.isHidden(n.zoom)){const R=this.getLayerSourceCache(I);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,n)}):this.precompilePrograms(I,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const E of w)E.sourceCache.used=!0;for(const E in b){const I=this._mergedSourceCaches[E];b[E]!==I.used&&I.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const u of n){const p=u.resolvePendingRequests(),y=this.getFragmentStyle(u.scope);y&&y.addImages(p)}}_updateTilesForChangedImages(){const n={};for(const u in this._mergedSourceCaches){const p=this._mergedSourceCaches[u].getSource().scope;n[p]=n[p]||this._changes.getUpdatedImages(p),n[p].length!==0&&this._mergedSourceCaches[u].reloadTilesForDependencies(["icons","patterns"],n[p])}for(const u in n)this._changes.resetUpdatedImages(u)}_updateWorkerLayers(n,u,p){const y=this.getFragmentStyle(n);y&&this.dispatcher.broadcast("updateLayers",{layers:u?y._serializeLayers(u):[],scope:n,removedIds:p||[],options:y.options})}setState(n,u){if(this._checkLoaded(),ul(this,ts(n)))return!1;(n=s.dp(n)).layers=em(n.layers);const p=(function(w,E){if(!w)return[{command:un.setStyle,args:[E]}];let I=[];try{if(!s.by(w.version,E.version))return[{command:un.setStyle,args:[E]}];if(s.by(w.center,E.center)||I.push({command:un.setCenter,args:[E.center]}),s.by(w.zoom,E.zoom)||I.push({command:un.setZoom,args:[E.zoom]}),s.by(w.bearing,E.bearing)||I.push({command:un.setBearing,args:[E.bearing]}),s.by(w.pitch,E.pitch)||I.push({command:un.setPitch,args:[E.pitch]}),s.by(w.sprite,E.sprite)||I.push({command:un.setSprite,args:[E.sprite]}),s.by(w.glyphs,E.glyphs)||I.push({command:un.setGlyphs,args:[E.glyphs]}),s.by(w.imports,E.imports)||(function(U=[],W=[],G){W=W||[];const X=(U=U||[]).map(kl),K=W.map(kl),oe=U.reduce(ch,{}),re=W.reduce(ch,{}),ne=X.slice();let be,_e,ve,pe;for(be=0,_e=0;be<X.length;be++)ve=X[be],re.hasOwnProperty(ve)?_e++:(G.push({command:un.removeImport,args:[ve]}),ne.splice(ne.indexOf(ve,_e),1));for(be=0,_e=0;be<K.length;be++)ve=K[K.length-1-be],ne[ne.length-1-be]!==ve&&(oe.hasOwnProperty(ve)?(G.push({command:un.removeImport,args:[ve]}),ne.splice(ne.lastIndexOf(ve,ne.length-_e),1)):_e++,pe=ne[ne.length-be],G.push({command:un.addImport,args:[re[ve],pe]}),ne.splice(ne.length-be,0,ve));for(const he of W){const Se=oe[he.id];Se&&(delete Se.data,s.by(Se,he)||G.push({command:un.updateImport,args:[he.id,he]}))}})(w.imports,E.imports,I),s.by(w.transition,E.transition)||I.push({command:un.setTransition,args:[E.transition]}),s.by(w.light,E.light)||I.push({command:un.setLight,args:[E.light]}),s.by(w.fog,E.fog)||I.push({command:un.setFog,args:[E.fog]}),s.by(w.snow,E.snow)||I.push({command:un.setSnow,args:[E.snow]}),s.by(w.rain,E.rain)||I.push({command:un.setRain,args:[E.rain]}),s.by(w.projection,E.projection)||I.push({command:un.setProjection,args:[E.projection]}),s.by(w.lights,E.lights)||I.push({command:un.setLights,args:[E.lights]}),s.by(w.camera,E.camera)||I.push({command:un.setCamera,args:[E.camera]}),s.by(w.iconsets,E.iconsets)||(function(U,W,G){let X;for(X in W=W||{},U=U||{})U.hasOwnProperty(X)&&(W.hasOwnProperty(X)||G.push({command:un.removeIconset,args:[X]}));for(X in W){if(!W.hasOwnProperty(X))continue;const K=W[X];U.hasOwnProperty(X)?s.by(U[X],K)||(G.push({command:un.removeIconset,args:[X]}),G.push({command:un.addIconset,args:[X,K]})):G.push({command:un.addIconset,args:[X,K]})}})(w.iconsets,E.iconsets,I),!s.by(w["color-theme"],E["color-theme"]))return[{command:un.setStyle,args:[E]}];const R={},L=[];(function(U,W,G,X){let K;for(K in W=W||{},U=U||{})U.hasOwnProperty(K)&&(W.hasOwnProperty(K)||Cd(K,G,X));for(K in W){if(!W.hasOwnProperty(K))continue;const oe=W[K];U.hasOwnProperty(K)?s.by(U[K],oe)||(U[K].type==="geojson"&&oe.type==="geojson"&&Hy(U,W,K)?G.push({command:un.setGeoJSONSourceData,args:[K,oe.data]}):Gy(K,W,G,X)):Wc(K,W,G)}})(w.sources,E.sources,L,R);const N=[];w.layers&&w.layers.forEach(U=>{U.source&&R[U.source]?I.push({command:un.removeLayer,args:[U.id]}):N.push(U)});let B=w.terrain;B&&R[B.source]&&(I.push({command:un.setTerrain,args:[void 0]}),B=void 0),I=I.concat(L),s.by(B,E.terrain)||I.push({command:un.setTerrain,args:[E.terrain]}),(function(U,W,G){W=W||[];const X=(U=U||[]).map(kl),K=W.map(kl),oe=U.reduce(ch,{}),re=W.reduce(ch,{}),ne=X.slice(),be=Object.create(null);let _e,ve,pe,he,Se,ze,Le;for(_e=0,ve=0;_e<X.length;_e++)pe=X[_e],re.hasOwnProperty(pe)?ve++:(G.push({command:un.removeLayer,args:[pe]}),ne.splice(ne.indexOf(pe,ve),1));for(_e=0,ve=0;_e<K.length;_e++)pe=K[K.length-1-_e],ne[ne.length-1-_e]!==pe&&(oe.hasOwnProperty(pe)?(G.push({command:un.removeLayer,args:[pe]}),ne.splice(ne.lastIndexOf(pe,ne.length-ve),1)):ve++,ze=ne[ne.length-_e],G.push({command:un.addLayer,args:[re[pe],ze]}),ne.splice(ne.length-_e,0,pe),be[pe]=!0);for(_e=0;_e<K.length;_e++)if(pe=K[_e],he=oe[pe],Se=re[pe],!be[pe]&&!s.by(he,Se))if(s.by(he.source,Se.source)&&s.by(he["source-layer"],Se["source-layer"])&&s.by(he.type,Se.type)){for(Le in lh(he.layout,Se.layout,G,pe,null,un.setLayoutProperty),lh(he.paint,Se.paint,G,pe,null,un.setPaintProperty),s.by(he.slot,Se.slot)||G.push({command:un.setSlot,args:[pe,Se.slot]}),s.by(he.filter,Se.filter)||G.push({command:un.setFilter,args:[pe,Se.filter]}),s.by(he.minzoom,Se.minzoom)&&s.by(he.maxzoom,Se.maxzoom)||G.push({command:un.setLayerZoomRange,args:[pe,Se.minzoom,Se.maxzoom]}),he)he.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?lh(he[Le],Se[Le],G,pe,Le.slice(6),un.setPaintProperty):s.by(he[Le],Se[Le])||G.push({command:un.setLayerProperty,args:[pe,Le,Se[Le]]}));for(Le in Se)Se.hasOwnProperty(Le)&&!he.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?lh(he[Le],Se[Le],G,pe,Le.slice(6),un.setPaintProperty):s.by(he[Le],Se[Le])||G.push({command:un.setLayerProperty,args:[pe,Le,Se[Le]]}))}else G.push({command:un.removeLayer,args:[pe]}),ze=ne[ne.lastIndexOf(pe)+1],G.push({command:un.addLayer,args:[Se,ze]})})(N,E.layers,I)}catch(R){console.warn("Unable to compute style diff:",R),I=[{command:un.setStyle,args:[E]}]}return I})(this.serialize(),n).filter(w=>!(w.command in tv));if(p.length===0)return!1;const y=p.filter(w=>!(w.command in ev));if(y.length>0)throw new Error(`Unimplemented: ${y.map(w=>w.command).join(", ")}.`);const b=[];return p.forEach(w=>{b.push(this[w.command](...w.args))}),u&&Promise.all(b).then(u).catch(u),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[u,p]of n.entries()){if(this.getImage(u))return this.fire(new s.y(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,this.scope,p),this._changes.updateImage(u,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(n,u){return this.getImage(n)?this.fire(new s.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,u),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(n,u,p=!1){this.imageManager.updateImage(n,this.scope,u),p&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(n){return this.modelManager.addModelURLs(n,this.getActualScope()),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(n,u,p={}){return this._checkLoaded(),this._validate(xe,`models.${n}`,u,null,p)||(this.modelManager.addModel(n,u,this.getActualScope()),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.getActualScope())}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.getActualScope(),!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(n,u,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(De,`sources.${n}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const y=cc(n,u,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const b=w=>{const E=(w?"symbol:":"other:")+y.id,I=s.B(E,this.scope),R=this._sourceCaches[E]=new is(I,y,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=R,R.onAdd(this.map)};b(!1),u.type!=="vector"&&u.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const u=this.getOwnSource(n);if(!u)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find(([b,w])=>w.type==="source"&&w.source===n);if(y)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while iconset "${y[0]}" is using it.`)))}const p=this.getOwnSourceCaches(n);for(const y of p){const b=s.dq(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,u){this._checkLoaded(),this.getOwnSource(n).setData(u),this._changes.setDirty()}getOwnSource(n){const u=this.getOwnSourceCache(n);return u&&u.getSource()}getOwnSources(){const n=[];for(const u in this._otherSourceCaches){const p=this.getOwnSourceCache(u);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const u in n){const p=n[u]._tiles;for(const y in p){const b=p[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const b of n){if(this._validate(Ae,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(b),w.updateTransitions(u)}else this.ambientLight=new on(b,nr(),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(b),w.updateTransitions(u)}else this.directionalLight=new on(b,Fn(),this.scope,this.options)}}const p=Object.assign(u,{worldview:this.map.getWorldview()}),y=new s.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,u=this.ambientLight;if(!n||!u)return;const p=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),y=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=n.properties.get("intensity"),w=n.properties.get("direction"),E=1-s.d4(w.x,w.y,w.z)[2]/90,I=p(y)*b*E,R=u.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),L=u.properties.get("intensity"),N=p(R)*L;return Number(((I+N)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(s.dr(n)){const u=s.ds(n),p=this.fragments.find(({id:b})=>b===u);if(!p)return;const y=s.dq(n);return p.style.getFragmentStyle(y)}{const u=this.fragments.find(({id:p})=>p===n);return u?u.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const u={},p=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in n){const b=this._featuresetSelectors[y]=[];for(const w of n[y].selectors){if(w.featureNamespace){const I=this.getOwnLayer(w.layer);if(!I){s.w(`Layer is undefined for selector: ${w.layer}`);continue}const R=p(I.source,I.sourceLayer);if(R in u&&u[R]!==w.featureNamespace){s.w(`"featureNamespace ${w.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}u[R]=w.featureNamespace}let E;if(w.properties)for(const I in w.properties){const R=s.U(w.properties[I]);R.result==="success"&&(E=E||{},E[I]=R.value)}b.push({layerId:w.layer,namespace:w.featureNamespace,properties:E,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const u=this.getFragmentStyle(n);if(!u||!u.stylesheet.featuresets)return[];const p=[];for(const y in u.stylesheet.featuresets)p.push({featuresetId:y,importId:u.scope?u.scope:void 0});return p}getFeaturesetLayers(n,u){const p=this.getFragmentStyle(u),y=p.stylesheet.featuresets;if(!y||!y[n])return this.fire(new s.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const w of y[n].selectors){const E=p.getOwnLayer(w.layer);E&&b.push(E)}return b}getConfigProperty(n,u){const p=this.getFragmentStyle(n);if(!p)return null;const y=s.B(u,p.scope),b=p.options.get(y),w=b?b.value||b.default:null;return w?w.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(n,u){const p=s.B(n,u);return this._mergedIndoor[p]}setIndoorData(n,u){this.indoorManager.setIndoorData(u)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(n,u,p){const y=this.getFragmentStyle(n);if(!y)return;const b=y.stylesheet.schema;if(!b||!b[u])return;const w=s.U(p);if(w.result!=="success")return void ul(this,w.value);const E=w.value.expression,I=s.B(u,y.scope),R=y.options.get(I);if(!R)return;let L;const{minValue:N,maxValue:B,stepValue:U,type:W,values:G}=b[u],X=s.U(b[u].default);X.result==="success"&&(L=X.value.expression),L?(this.options.set(I,Object.assign({},R,{value:E,default:L,minValue:N,maxValue:B,stepValue:U,type:W,values:G})),this.updateConfigDependencies(u)):this.fire(new s.y(new Error(`No schema defined for the config option "${u}" in the "${n}" fragment.`)))}getConfig(n){const u=this.getFragmentStyle(n);if(!u)return null;const p=u.stylesheet.schema;if(!p)return null;const y={};for(const b in p){const w=s.B(b,u.scope),E=u.options.get(w),I=E?E.value||E.default:null;y[b]=I?I.serialize():null}return y}setConfig(n,u){const p=this.getFragmentStyle(n);p&&(p.updateConfig(u,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const u=this.getFragmentStyle(n);return u?u.stylesheet.schema:null}setSchema(n,u){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=u,p.updateConfig(p._config,u),this.updateConfigDependencies())}updateConfig(n,u){if(this._config=n,n||u)if(u)for(const p in u){let y,b;const w=s.U(u[p].default);if(w.result==="success"&&(y=w.value.expression),n&&n[p]!==void 0){const B=s.U(n[p]);B.result==="success"&&(b=B.value.expression)}const{minValue:E,maxValue:I,stepValue:R,type:L,values:N}=u[p];if(y){const B=s.B(p,this.scope);this.options.set(B,{default:y,value:b,minValue:E,maxValue:I,stepValue:R,type:L,values:N})}else this.fire(new s.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(n,u=()=>!0){for(const p of n){const y=this.getLayer(p);y&&u(y)&&(y.possiblyEvaluateVisibility(),this._updateLayer(y),this._changes.setDirty())}}updateConfigDependencies(n){this._updateLayers(this._configDependentLayers,u=>!n||u.expressionDependencies.configDependencies.has(n)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(u=>{const p=u._styleColorTheme.colorThemeOverride?u._styleColorTheme.colorThemeOverride:u._styleColorTheme.colorTheme;if(p){const y=u._evaluateColorThemeData(p);(!u._styleColorTheme.lut&&y!==""||u._styleColorTheme.lut&&y!==u._styleColorTheme.lut.data)&&u.setColorTheme(p)}}),this._changes.setDirty()}addLayer(n,u,p={}){this._checkLoaded();const y=n.id;if(this._layers[y])return void this.fire(new s.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(n.type==="custom"){if(ul(this,s.dt(n)))return;b=s.du(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=s.dp(n),n=Object.assign(n,{source:y})),this._validate(Ee,`layers.${y}`,n,{arrayIndex:-1},p))return;b=s.du(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}const w=s.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w);let E=this._order.length;if(u){const N=this._order.indexOf(u);if(N===-1)return void this.fire(new s.y(new Error(`Layer with id "${u}" does not exist on this map.`)));b.slot&&b.slot!==this._layers[u].slot?s.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`):E=N}this._order.splice(E,0,y),this._handleLayerOrderChange(),this._layers[y]=b;const I=this.getOwnLayerSourceCache(b),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&b.canCastShadows()&&R&&(I.castsShadows=!0);const L=this._changes.getRemovedLayer(b);if(L&&b.source&&I&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const N=s.B(b.source,b.scope);L.type!==b.type?this._changes.updateSourceCache(N,"clear"):(this._changes.updateSourceCache(N,"reload"),I.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(n,u){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===u)return;const y=this._order.indexOf(n);this._order.splice(y,1);let b=this._order.length;if(u){const w=this._order.indexOf(u);if(w===-1)return void this.fire(new s.y(new Error(`Layer with id "${u}" does not exist on this map.`)));p.slot&&p.slot!==this._layers[u].slot?s.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`):b=w}this._order.splice(b,0,n),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(n){this._checkLoaded();const u=this._checkLayer(n);if(!u)return;u.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(u.fqid),this._indoorDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const y=this.getOwnLayerSourceCache(u);if(y&&y.castsShadows){let b=!1;for(const w in this._layers)if(this._layers[w].source===u.source&&this._layers[w].canCastShadows()){b=!0;break}y.castsShadows=b}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const u in this._layers)if(this._layers[u].type===n)return!0;return!1}setLayerZoomRange(n,u,p){this._checkLoaded();const y=this._checkLayer(n);y&&(y.minzoom===u&&y.maxzoom===p||(u!=null&&(y.minzoom=u),p!=null&&(y.maxzoom=p),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,u){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==u&&(p.slot=u,this._updateLayer(p))}setFilter(n,u,p={}){this._checkLoaded();const y=this._checkLayer(n);if(y&&!s.by(y.filter,u))return u==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(Z,`layers.${y.id}.filter`,u,{layerType:y.type},p)||(y.filter=s.dp(u),this._updateLayer(y)))}getFilter(n){const u=this._checkLayer(n);if(u)return s.dp(u.filter)}setLayoutProperty(n,u,p,y={}){this._checkLoaded();const b=this._checkLayer(n);if(b&&!s.by(b.getLayoutProperty(u),p)){if(p!=null&&(!y||y.validate!==!1)&&ul(b,ce.call(ts,{key:`layers.${n}.layout.${u}`,layerType:b.type,objectKey:u,value:p,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(u,p),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(n,u,p,y={}){this._checkLoaded();const b=this._checkLayer(n);b&&(u==="appearances"?(b.setAppearances(p),this._changes.setDirty()):b.isPaintProperty(u)?this.setPaintProperty(n,u,p,y):this.setLayoutProperty(n,u,p,y))}getLayoutProperty(n,u){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(u)}setPaintProperty(n,u,p,y={}){this._checkLoaded();const b=this._checkLayer(n);if(!b||s.by(b.getPaintProperty(u),p)||p!=null&&(!y||y.validate!==!1)&&ul(b,Q.call(ts,{key:`layers.${n}.paint.${u}`,layerType:b.type,objectKey:u,value:p,styleSpec:s.a6})))return;const w=b.setPaintProperty(u,p);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),w&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(n,u){const p=this._checkLayer(n);if(p)return p.getPaintProperty(u)}setFeatureState(n,u){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:I,importId:R}=n.target,L=this.getFragmentStyle(R),N=L.getFeaturesetLayers(I);for(const{source:B,sourceLayer:U}of N)L.setFeatureState({id:n.id,source:B,sourceLayer:U},u)}else if("layerId"in n.target){const{layerId:I}=n.target,R=this.getLayer(I);this.setFeatureState({id:n.id,source:R.source,sourceLayer:R.sourceLayer},u)}return}const p=n.source,y=n.sourceLayer,b=this._checkSource(p);if(!b)return;const w=b.type;if(w==="geojson"&&y)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!y)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(p);for(const I of E)I.setFeatureState(y,n.id,u)}removeFeatureState(n,u){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:I,importId:R}=n.target,L=this.getFragmentStyle(R),N=L.getFeaturesetLayers(I);for(const{source:B,sourceLayer:U}of N)L.removeFeatureState({id:n.id,source:B,sourceLayer:U},u)}else if("layerId"in n.target){const{layerId:I}=n.target,R=this.getLayer(I);this.removeFeatureState({id:n.id,source:R.source,sourceLayer:R.sourceLayer},u)}return}const p=n.source,y=this._checkSource(p);if(!y)return;const b=y.type,w=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!w)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(p);for(const I of E)I.removeFeatureState(w,n.id,u)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let b;if("featuresetId"in n.target){const{featuresetId:w,importId:E}=n.target,I=this.getFragmentStyle(E),R=I.getFeaturesetLayers(w);for(const{source:L,sourceLayer:N}of R){const B=I.getFeatureState({id:n.id,source:L,sourceLayer:N});if(B&&!b)b=B;else if(!s.by(b,B))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:w}=n.target,E=this.getLayer(w);b=this.getFeatureState({id:n.id,source:E.source,sourceLayer:E.sourceLayer})}return b}const u=n.source,p=n.sourceLayer,y=this._checkSource(u);if(y){if(y.type!=="vector"||p)return n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(p,n.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),u=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(n){for(const u of Object.values(this._mergedLayers))n(u)&&this._updateLayer(u)}_updateLayer(n){this._changes.updateLayer(n);const u=this.getLayerSourceCache(n),p=s.B(n.source,n.scope),y=this._changes.getUpdatedSourceCaches();n.source&&!y[p]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),u.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const u=E=>this._mergedLayers[E].is3D(!!this.terrain),p=this.order,y={},b=[];for(let E=p.length-1;E>=0;E--){const I=p[E];if(u(I)){y[I]=E;for(const R of n){const L=R[I];if(L)for(const N of L)b.push(N)}}}b.sort((E,I)=>I.intersectionZ-E.intersectionZ);const w=[];for(let E=p.length-1;E>=0;E--){const I=p[E];if(u(I))for(let R=b.length-1;R>=0;R--){const L=b[R].feature;if(L.layer&&y[L.layer.id]<E)break;w.push(L),b.pop()}else for(const R of n){const L=R[I];if(L)for(const N of L)w.push(N.feature)}}return w}queryRasterValue(n,u,p){const y=this.getOwnSource(n);return y?y.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(u,p):(this.fire(new s.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,u,p){let y;u&&!Array.isArray(u)&&u.filter&&(this._validate(Z,"queryRenderedFeatures.filter",u.filter,null,u),y=s.b6(u.filter));const b={},w=L=>{if(Vd.has(L.type))return;const N=this.getOwnLayerSourceCache(L),B=b[N.id]=b[N.id]||{sourceCache:N,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[L.fqid]=B.layers[L.fqid]||{styleLayer:L,targets:[]},B.layers[L.fqid].targets.push({filter:y})};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const L of u.layers){const N=this._layers[L];if(!N)return this.fire(new s.y(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];w(N)}}else for(const L in this._layers)w(this._layers[L]);const E=this._queryRenderedFeatures(n,b,p),I=this._flattenAndSortRenderedFeatures(E),R=[];for(const L of I)s.dw(L.layer.id)===this.scope&&R.push(L);return R}queryRenderedFeatureset(n,u,p){let y;u&&!Array.isArray(u)&&u.filter&&(this._validate(Z,"queryRenderedFeatures.filter",u.filter,null,u),y=s.b6(u.filter));const b="mock",w=[];if(u&&u.target)w.push(Object.assign({},u,{targetId:b,filter:y}));else{const L=this.getFeaturesetDescriptors();for(const N of L)w.push({targetId:b,filter:y,target:N});for(const{style:N}of this.fragments){const B=N.getFeaturesetDescriptors();for(const U of B)w.push({targetId:b,filter:y,target:U})}}const E=this.queryRenderedTargets(n,w,p),I=[],R=new Set;for(const L of E)for(const N of L.variants[b])nh(N,L,R)||I.push(new s.dx(L,N));return I}queryRenderedTargets(n,u,p){const y={},b=(E,I,R,L)=>{const N=y[I.id]=y[I.id]||{sourceCache:I,layers:{},has3DLayers:!1};if(N.layers[E.fqid]=N.layers[E.fqid]||{styleLayer:E,targets:[]},E.is3D(!!this.terrain)&&(N.has3DLayers=!0),!L)return R.uniqueFeatureID=!1,void N.layers[E.fqid].targets.push(R);N.layers[E.fqid].targets.push(Object.assign({},R,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const E of u)if("featuresetId"in E.target){const{featuresetId:I,importId:R}=E.target,L=this.getFragmentStyle(R);if(!L||!L._featuresetSelectors)continue;const N=L._featuresetSelectors[I];if(!N){this.fire(new s.y(new Error(`The featureset '${I}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of N){const U=L.getOwnLayer(B.layerId);U&&!Vd.has(U.type)&&b(U,L.getOwnLayerSourceCache(U),E,B)}}else if("layerId"in E.target){const{layerId:I}=E.target,R=this.getLayer(I);if(!R||Vd.has(R.type))continue;b(R,this.getLayerSourceCache(R),E)}const w=this._queryRenderedFeatures(n,y,p);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(n,u,p){const y=[],b=!!this.map._showQueryGeometry,w=_r.createFromScreenPoints(n,p);for(const E in u){const I=rh(w,u[E],this._availableImages,p,b,this.getActualScope());Object.keys(I).length&&y.push(I)}if(this.placement)for(const E in u){if(!u[E].sourceCache._onlySymbols)continue;const I=Uy(w.screenGeometry,u[E],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(I).length&&y.push(I)}return y}querySourceFeatures(n,u){const p=u&&u.filter;p&&this._validate(Z,"querySourceFeatures.filter",p,null,u);let y=[];const b=this.getOwnSourceCaches(n);for(const w of b)y=y.concat($y(w,u));return y}addSourceType(n,u,p){return vs.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(vs.setSourceType(n,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:u.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,u,p={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const E in n)if(!s.by(n[E],y[E])){b=!0;break}if(!b)return;const w=this._getTransitionParameters();this.light.setLight(n,u,p),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,u=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),u===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const y=!("source"in n)||n.source==null;if(u===1){if(this.disableElevatedTerrain)return;if("source"in p&&typeof p.source=="object"){const E="terrain-dem-src";this.addSource(E,p.source),p=s.dp(p),p=Object.assign(p,{source:E})}const b=Object.assign({},p),w={};if(this.terrain&&y){b.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(w.style=E.serialize())}if(this._validate(Ot,"terrain",b,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&u!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,u),this.fire(new s.z("data",{dataType:"style"}))}else{const b=this.terrain,w=b.get();for(const E of Object.keys(s.a6.terrain))!p.hasOwnProperty(E)&&s.a6.terrain[E].default&&(p[E]=s.a6.terrain[E].default);for(const E in n)if(!s.by(n[E],w[E])){b.set(n,this.options),this.stylesheet.terrain=n;const I=this._getTransitionParameters({duration:0});b.updateTransitions(I),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const u=this.fog=new yi(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_createSnow(n){const u=this.snow=new xr(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_createRain(n){const u=this.rain=new Qn(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!s.by(u.get(),n)){u.set(n,this.options),this.stylesheet.fog=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const u=this.snow;if(!s.by(u.get(),n)){u.set(n,this.options),this.stylesheet.snow=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const u=this.rain;if(!s.by(u.get(),n)){u.set(n,this.options),this.stylesheet.rain=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},u=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!u)return this._styleColorTheme.lut=null,void n();const p=this._evaluateColorThemeData(u);this._loadColorTheme(p).then(()=>{this.fire(new s.z("colorthemeset")),n()}).catch(y=>{s.w(`Couldn't set color theme: ${y}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,u){const p=this.getFragmentStyle(n);p&&(p._styleColorTheme.colorThemeOverride=u,p._reloadColorTheme())}_getTransitionParameters(n){return{now:s.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],u=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):u.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...u)}_createTerrain(n,u){const p=this.terrain=new st(n,u,this.scope,this.options,this.map.getWorldview());u===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const u=this._layers[n];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const u=this._layers[n];u.type==="symbol"&&this._updateLayer(u)}}_validate(n,u,p,y,b={}){if(b&&b.validate===!1)return!1;const w=Object.assign({},this.serialize());return ul(this,n.call(ts,Object.assign({key:u,style:w,value:p,styleSpec:s.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const u=this.getSourceCaches(n);for(const p of u)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const u=this._mergedLayers[n];u._clear&&u._clear()}}reloadSource(n){const u=this.getSourceCaches(n);for(const p of u)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let u;this.directionalLight&&(u=Yy(this.directionalLight));const p=new Set,y=new Set;for(const b in this._mergedLayers){const w=this._mergedLayers[b];w.type==="building"&&p.add(w.source),w.hasElevation()&&!y.has(w.source)&&y.add(w.source)}for(const b in this._mergedSourceCaches){const w=this._mergedSourceCaches[b],E=y.has(w._source.id);p.has(w._source.id)&&(w._source.reparseOverscaled=!1),w.update(n,void 0,void 0,u,E)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const u=this._sourceCaches[n];u.resume(),u.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new s.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new om),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(n,u,p,y,b){this.pauseablePlacement||(this.pauseablePlacement=new om);let w=!1,E=!1;const I={},R={};for(const G of this._mergedOrder){const X=this._mergedLayers[G];if(X.type!=="symbol")continue;const K=s.B(X.source,X.scope);let oe=I[K];if(!oe){const ne=this.getLayerSourceCache(X);if(!ne)continue;const be=ne.getRenderableIds(!0).map(_e=>ne.getTileByID(_e));R[K]=be.slice(),oe=I[K]=be.sort((_e,ve)=>ve.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(ve.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer(X,oe,n.center.lng,n.projection);w=w||re}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const L=!!(this.placement&&!n.equals(this.placement.transform)),N=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!b||this.placement.lastReplacementSourceUpdateTime!==b.updateTime)),B=L||N||w,U=(B||this.pauseablePlacement.isStale())&&p===0,W=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),n.zoom)&&p!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||U||W)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(n,this._mergedOrder,u,p,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?B&&p!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,R,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),E=!0),w&&this.pauseablePlacement.setStale()),E||w){this._buildingIndex.onNewFrame(n.zoom);for(let G=0;G<this._mergedOrder.length;G++){const X=this._mergedLayers[this._mergedOrder[G]];if(X.type!=="symbol"||X.visibility==="none")continue;const K=this.isLayerClipped(X);this.placement.updateLayerOpacities(X,I[s.B(X.source,X.scope)],G,K?b:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(s.o.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,u){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:b})=>b===n.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!u)return p.push(n),this._loadImports([n],!0);const y=p.findIndex(({id:b})=>b===u);return y===-1&&this.fire(new s.y(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,y).concat(n).concat(p.slice(y)),this._loadImports([n],!0,u)}updateImport(n,u){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(n);return y===-1?this:typeof u=="string"?(this.setImportUrl(n,u),this):(u.url&&u.url!==p[y].url&&this.setImportUrl(n,u.url),s.by(u.config,p[y].config)||this.setImportConfig(n,u.config,u.data.schema),s.by(u.data,p[y].data)||this.setImportData(n,u.data),this)}moveImport(n,u){this._checkLoaded();let p=this.stylesheet.imports||[];const y=this.getImportIndex(n);if(y===-1)return this;const b=this.getImportIndex(u);if(b===-1)return this;const w=p[y],E=this.fragments[y];return p=p.filter(({id:I})=>I!==n),this.fragments=this.fragments.filter(({id:I})=>I!==n),this.stylesheet.imports=p.slice(0,b).concat(w).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(E).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(n,u){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(n);if(y===-1)return this;p[y].url=u;const b=this.fragments[y];return b.style=this._createFragmentStyle(p[y]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(u),this}setImportData(n,u){this._checkLoaded();const p=this.getImportIndex(n),y=this.stylesheet.imports||[];return p===-1?this:u?(this.fragments[p].style.setState(u),this._reloadImports(),this):(delete y[p].data,this.setImportUrl(n,y[p].url))}setImportConfig(n,u,p){this._checkLoaded();const y=this.getImportIndex(n),b=this.stylesheet.imports||[];if(y===-1)return this;u?b[y].config=u:delete b[y].config;const w=this.fragments[y];p&&w.style.stylesheet&&(w.style.stylesheet.schema=p);const E=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=u,w.style.updateConfig(u,E),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(u.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const u=(this.stylesheet.imports||[]).findIndex(p=>p.id===n);return u===-1&&this.fire(new s.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),u}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const u in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[u];p&&n.push(p.getSource())}return n}getSource(n,u){const p=this.getSourceCache(n,u);return p&&p.getSource()}getLayerSource(n){const u=this.getLayerSourceCache(n);return u&&u.getSource()}getSourceCache(n,u){const p=s.B(n,u);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const u=s.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[n]&&u.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&u.push(this._mergedSymbolSourceCaches[n]),u}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const u in n){const p=n[u];p==="reload"?this.reloadSource(u):p==="clear"&&this.clearSource(u)}}updateLayers(n){const u=this._changes.getUpdatedPaintProperties();for(const p of u){const y=this.getLayer(p);y&&y.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,u,p){this.imageManager.getImages(u.images,u.scope,p),this._updateTilesForChangedImages();const y=w=>{if(w){const E=u.images.map(I=>s.I.toString(I));w.setDependencies(u.tileID.key,u.type,E)}},b=s.B(u.source,u.scope);y(this._mergedOtherSourceCaches[b]),y(this._mergedSymbolSourceCaches[b]),u.images.some(w=>w.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(n,u,p){this.imageManager.rasterizeImages(u,p)}getGlyphs(n,u,p){this.glyphManager.getGlyphs(u.stacks,p)}getResource(n,u,p){return s.dz(u,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const u=[];return this._otherSourceCaches[n]&&u.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&u.push(this._symbolSourceCaches[n]),u}_isSourceCacheLoaded(n){const u=this.getOwnSourceCaches(n);return u.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${n}'`))),!1):u.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,u){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const p=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),y=n.type==="building";if(n.is3D(!!this.terrain)){if(p||y||u&&u.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}vs.getSourceType=function(f){return rl[f]},vs.setSourceType=function(f,n){rl[f]=n},vs.registerForPluginStateChange=s.dA;var hm=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,dm=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Qc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,eu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",fm=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,jd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Bs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,_h=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,It=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,pm=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,mm=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const yh=/#include\s+"([^"]+)"/g,Fa=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,gm=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,pc=new Set(["ifdef","ifndef","elif","if","defined"]),mc=new Set;Vl(hm,mc),Vl(Qc,mc),Vl(dm,mc);const $l={"_prelude_fog.vertex.glsl":jd,"_prelude_terrain.vertex.glsl":fm,"_prelude_shadow.vertex.glsl":pm,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Bs,"_prelude_shadow.fragment.glsl":mm,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":_h,"_prelude_raster_particle.glsl":It},Gd={};rn("",fm),rn(Bs,jd),rn(mm,pm),rn(_h,""),rn(It,"");const iv=rn(dm,Qc),Hd=hm,Jw=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Hd,iv.fragmentSource].join(`
`),nv=["precision highp float;",Hd,iv.vertexSource].join(`
`);var _m={background:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:rn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:rn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:rn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:rn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:rn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:rn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:rn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:rn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:rn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:rn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:rn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:rn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:rn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:rn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:rn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:rn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:rn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:rn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,eu),skyboxGradient:rn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,eu),skyboxCapture:rn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:rn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:rn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:rn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:rn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:rn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:rn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Vl(f,n){const u=f.split(`
`);for(let p of u){if(p=p.trimStart(),p[0]!=="#"||!p.includes("if")||p.startsWith("#endif"))continue;const y=p.match(gm);if(y)for(const b of y)pc.has(b)||n.add(b)}}function rn(f,n){const u=new Set,p=[],y=[];f=f.replace(yh,(w,E)=>(y.push(E),"")),n=n.replace(yh,(w,E)=>(p.push(E),""));let b=new Set(mc);Vl(f,b),Vl(n,b);for(const w of[...p,...y])Gd[w]||(Gd[w]=new Set,Vl($l[w],Gd[w])),b=new Set([...b,...Gd[w]]);return{fragmentSource:f=f.replace(Fa,(w,E,I,R,L)=>(u.add(L),E==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${I} ${R} ${L};
#else
uniform ${I} ${R} u_${L};
#endif
`:E==="initialize"?`
#ifdef HAS_UNIFORM_u_${L}
    ${I} ${R} ${L} = u_${L};
#endif
`:E==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    in ${I} ${R} ${L};
#endif
`:E==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(Fa,(w,E,I,R,L)=>{const N=`MATERIAL_ATTRIBUTE_OFFSET_${L}`,B=R==="float"?"vec2":R,U=`GET_ATTRIBUTE_${B}(a_${L}, materialInfo, ${N})`,W=L.match(/color/)?"color":B;return E==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${L}
in ${I} ${R} a_${L};
#endif
`:u.has(L)?E==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
    #if !defined(${N})
        in ${I} ${B} a_${L};
    #endif
out ${I} ${R} ${L};
#else
uniform ${I} ${R} u_${L};
#endif
`:E==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${I} ${R} ${L} = u_${L};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${L})
    #ifdef ${N}
        ${L} = unpack_mix_${W}(${U}, u_${L}_t);
    #else
        ${L} = unpack_mix_${W}(a_${L}, u_${L}_t);
    #endif
#else
    ${I} ${R} ${L} = u_${L};
#endif
`:E==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    in ${I} ${R} a_${L};
    out ${I} ${R} ${L};
#endif
`:E==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    ${L} = a_${L};
#endif
`:void 0:E==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
    #if !defined(${N})
        in ${I} ${B} a_${L};
    #endif
#else
uniform ${I} ${R} u_${L};
#endif
`:E==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${L}0;
in vec4 a_${L}1;
in vec4 a_${L}2;
in vec4 a_${L}3;
#else
uniform ${I} ${R} u_${L};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${I} ${B} a_${L};
#else
uniform ${I} ${R} u_${L};
#endif
`:E==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    ${I} ${R} ${L} = a_${L};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    #ifdef ${N}
        ${I} ${R} ${L} = ${U};
    #else
        ${I} ${R} ${L} = a_${L};
    #endif
#else
    ${I} ${R} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    #ifdef ${N}
        ${I} ${R} ${L} = unpack_mix_${W}(${U}, u_${L}_t);
    #else
        ${I} ${R} ${L} = unpack_mix_${W}(a_${L}, u_${L}_t);
    #endif
#else
    ${I} ${R} ${L} = u_${L};
#endif
`}),usedDefines:b,vertexIncludes:p,fragmentIncludes:y}}class Yw{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,u,p,y,b,w,E,I){this.context=n;let R=this.boundPaintVertexBuffers.length!==y.length;for(let N=0;!R&&N<y.length;N++)this.boundPaintVertexBuffers[N]!==y[N]&&(R=!0);let L=this.boundDynamicVertexBuffers.length!==E.length;for(let N=0;!L&&N<E.length;N++)this.boundDynamicVertexBuffers[N]!==E[N]&&(L=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==p||R||L||this.boundIndexBuffer!==b||this.boundVertexOffset!==w)this.freshBind(u,p,y,b,w,E,I);else{n.bindVertexArrayOES.set(this.vao);for(const N of E)N&&(N.bind(),I&&N.instanceCount&&N.setVertexAttribDivisor(n.gl,u,I));b&&b.dynamicDraw&&b.bind()}}freshBind(n,u,p,y,b,w,E){const I=this.context,R=I.gl;this.vao&&this.destroy(),this.vao=I.gl.createVertexArray(),I.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=w,u.enableAttributes(R,n),u.bind(),u.setVertexAttribPointers(R,n,b);for(const L of p)L.enableAttributes(R,n),L.bind(),L.setVertexAttribPointers(R,n,b);for(const L of w)L&&(L.enableAttributes(R,n),L.bind(),L.setVertexAttribPointers(R,n,b),E&&L.instanceCount&&L.setVertexAttribDivisor(R,n,E));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Kw(f,n){const u=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new s.ae(0,p/u).toLngLat().lat,new s.ae(0,(p+1)/u).toLngLat().lat]}function Qw(f,n,u,p,y,b,w){const E=f.context,I=E.gl,R=u.hillshadeFBO;if(!R)return;f.prepareDrawTile();const L=f.isTileAffectedByFog(n),N=[];f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&N.push("USE_MRT1");const B=f.getOrCreateProgram("hillshade",{overrideFog:L,defines:N});E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment0.get());const U=((K,oe,re,ne)=>{const be=re.paint.get("hillshade-shadow-color"),_e=re.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ve=re.paint.get("hillshade-highlight-color"),pe=re.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",he=re.paint.get("hillshade-accent-color"),Se=re.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ze=re.paint.get("hillshade-emissive-strength");let Le=s.an(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")Le-=K.transform.angle;else if(K.style&&K.style.enable3dLights()&&K.style.directionalLight){const je=K.style.directionalLight.properties.get("direction"),tt=s.d4(je.x,je.y,je.z);Le=s.an(tt[1])}const Ze=!K.options.moving;return{u_matrix:ne||K.transform.calculateProjMatrix(oe.tileID.toUnwrapped(),Ze),u_image:0,u_latrange:Kw(0,oe.tileID),u_light:[re.paint.get("hillshade-exaggeration"),Le],u_shadow:be.toPremultipliedRenderColor(_e?null:re.lut),u_highlight:ve.toPremultipliedRenderColor(pe?null:re.lut),u_emissive_strength:ze,u_accent:he.toPremultipliedRenderColor(Se?null:re.lut)}})(f,u,p,f.terrain?n.projMatrix:null);f.uploadCommonUniforms(E,B,n.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:G,tileBoundsSegments:X}=f.getTileBoundsBuffers(u);B.draw(f,I.TRIANGLES,y,b,w,di.disabled,U,p.id,W,G,X)}function ym(f,n,u){if(!n.needsDEMTextureUpload)return;const p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(u.stride);const b=u.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new s.T(p,b,y.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function e1(f,n,u){const p=f.context,y=p.gl;if(!n.dem)return;const b=n.dem;if(p.activeTexture.set(y.TEXTURE1),ym(f,n,b),!n.demTexture)return;n.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const w=b.dim;p.activeTexture.set(y.TEXTURE0);let E=n.hillshadeFBO;if(!E){const B=new s.T(p,{width:w,height:w,data:null},y.RGBA8);B.bind(y.LINEAR,y.CLAMP_TO_EDGE),E=n.hillshadeFBO=p.createFramebuffer(w,w,1,"renderbuffer"),E.colorAttachment0.set(B.texture)}p.bindFramebuffer.set(E.framebuffer),p.viewport.set([0,0,w,w]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:R,tileBoundsSegments:L}=f.getMercatorTileBoundsBuffers(),N=[];f.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&N.push("USE_MRT1"),f.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(f,y.TRIANGLES,Kt.disabled,vi.disabled,Ii.unblended,di.disabled,((B,U)=>{const W=U.stride,G=s.bC();return s.ce(G,0,s.al,-s.al,0,0,1),s.br(G,G,[0,-s.al,0]),{u_matrix:G,u_image:1,u_dimension:[W,W],u_zoom:B.overscaledZ}})(n.tileID,b),u.id,I,R,L),n.needsHillshadePrepare=!1}class Jn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class t1 extends Jn{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class rv extends Jn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class vm extends Jn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Zd extends Jn{getDefault(){return[!0,!0,!0,!0]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class xm extends Jn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class gc extends Jn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class tu extends Jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const u=this.current;(n.func!==u.func||n.ref!==u.ref||n.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class vh extends Jn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class iu extends Jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=n,this.dirty=!1}}class ov extends Jn{getDefault(){return[0,1]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class bm extends Jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=n,this.dirty=!1}}class sv extends Jn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class nu extends Jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.BLEND):u.disable(u.BLEND),this.current=n,this.dirty=!1}}class Wd extends Jn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class qd extends Jn{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class wm extends Jn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Xd extends Jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=n,this.dirty=!1}}class xh extends Jn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class av extends Jn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let lv=class extends Jn{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class cv extends Jn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class ru extends Jn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class uv extends Jn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class i1 extends Jn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class n1 extends Jn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class r1 extends Jn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Sm extends Jn{getDefault(){return null}set(n){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Tm extends Jn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Em extends Jn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Im extends Jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class hv extends Jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Jd extends Jn{constructor(n,u){super(n),this.context=n,this.parent=u}getDefault(){return null}}class Yd extends Jd{constructor(n,u,p=0){super(n,u),this.attachmentPoint=n.gl.COLOR_ATTACHMENT0+p}setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachmentPoint,u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class ou extends Jd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class bh extends Jd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class dv extends ou{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Ns=(f,n,u,p)=>({u_matrix:f,u_image0:0,u_image1:1,u_skirt_height:n,u_ground_shadow_factor:u,u_emissive_texture_available:p}),Kd=(f,n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:u,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_image1:1,u_frustum_tl:w,u_frustum_tr:E,u_frustum_br:I,u_frustum_bl:R,u_globe_pos:L,u_globe_radius:N,u_viewport:B,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:U,u_far_z_cutoff:W,u_emissive_texture_available:G});function wh(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const hl=new class{constructor(){this.operations={}}newMorphing(f,n,u,p,y){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[f]={startTime:p,phase:0,duration:y,from:n,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const u=this.operations[n];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Qd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ef(f,n,u){if(n===0)return 0;const p=n<1&&u===514?.25/n:1;return 6*Math.pow(1.5,22-f)*Math.max(n,1)*p}function Mm(f,n){const u=1<<f.z;return!n&&(f.x===0||f.x===u-1)||f.y===0||f.y===u-1}function su(f,n){if(!f.style||!f.style.enable3dLights())return;const u=f.context,p=u.gl;u.activeTexture.set(p.TEXTURE1),n?n.bind(p.LINEAR,p.CLAMP_TO_EDGE):f.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}const Sh=f=>({u_matrix:f});function Th(f,n,u,p,y){if(y>0){const b=s.o.now(),w=(b-f.timeAdded)/y,E=n?(b-n.timeAdded)/y:-1,I=u.getSource(),R=p.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),L=!n||Math.abs(n.tileID.overscaledZ-R)>Math.abs(f.tileID.overscaledZ-R),N=L&&f.refreshedUponExpiration?1:s.aA(L?w:1-E,0,1);return n?{opacity:1,mix:1-N,isFading:w<1}:{opacity:N,mix:0,isFading:w<1}}return{opacity:1,mix:0,isFading:!1}}class tf extends is{constructor(n){const u=cc("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",u,!1),u.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,u){n.state="loaded",u(null)}}class Am extends is{constructor(n){const u=cc("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,u,p){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,w)=>{if(b[w.key]="",!this._tiles[w.key]){const E=new Dl(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);E.state="loaded",this._tiles[w.key]=E}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const u=this.proxyCachedFBO[n];if(u!==void 0){const p=Object.values(u);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Pm extends s.aQ{constructor(n,u,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=u,this.projMatrix=p}}class zm extends s.bV{constructor(n,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,b]=(function(){const I=new s.bd,R=new s.b0,L=131;I.reserve(17161),R.reserve(33800);const N=s.al/128,B=s.al+N/2,U=B+N;for(let G=-N;G<U;G+=N)for(let X=-N;X<U;X+=N){const K=X<0||X>B||G<0||G>B?24575:0,oe=s.aA(Math.round(X),0,s.al),re=s.aA(Math.round(G),0,s.al);I.emplaceBack(oe+K,re)}const W=(G,X)=>{const K=X*L+G;R.emplaceBack(K+1,K,K+L),R.emplaceBack(K+L,K+L+1,K+1)};for(let G=1;G<129;G++)for(let X=1;X<129;X++)W(X,G);return[0,129].forEach(G=>{for(let X=0;X<130;X++)W(X,G),W(G,X)}),[I,R,32768]})(),w=n.context;this.gridBuffer=w.createVertexBuffer(p,s.bf.members),this.gridIndexBuffer=w.createIndexBuffer(y),this.gridSegments=s.bg.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Am(u.map),this.orthoMatrix=s.bC(),s.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const E=w.gl;this._overlapStencilMode=new vi({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new tf(u.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,u,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const y=n.terrain.properties,b=n.terrain.drapeRenderMode===0,w=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const E=n.terrain&&n.terrain.scope,I=y.get("source"),R=b?this._mockSourceCache:n.getSourceCache(I,E);if(!R)return void s.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=R,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(u):y.get("exaggeration"),!u.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(u,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),u.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const u=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const y=u!=null?p-u:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=n.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(b);let E=b-this._previousZoom;const I=this._previousUpdateTimestamp;let R=b;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(b-R)>.5&&(E=.5*(b-R+E)),E*y<0&&(R+=E)),this._evaluationZoom=R;const L=w.getExaggeration(R),N=L===w.getExaggeration(Math.max(0,R-.1));if(N&&Math.abs(L-this._exaggeration)<.01)return L;let B=Math.min(.1,.00375*(this._updateTimestamp-I));return(N||L<.1||Math.abs(E)<1e-4)&&(B=Math.min(.2,4*B)),s.ak(this._exaggeration,L,B)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=u.getIds().map(I=>{const R=u.getTileByID(I).tileID;return R.projMatrix=p.calculateProjMatrix(R.toUnwrapped()),R});(function(I,R){const L=R.transform.pointCoordinate(R.transform.getCameraPoint()),N=new s.P(L.x,L.y);I.sort((B,U)=>{if(U.overscaledZ-B.overscaledZ)return U.overscaledZ-B.overscaledZ;const W=new s.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),G=new s.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),X=N.mult(1<<B.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(W)-X.distSqr(G)})})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const I in w){const R=w[I];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,n[I],b),R.usedForTerrain))continue;const L=n[I];R.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[u.id]=y.map(I=>new Pm(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const R=this.terrainTileForTile[I.key];if(!R)continue;const L=R.tileID.key;L in E||(this._visibleDemTiles.push(R),E[L]=L)}}_assignTerrainTiles(n){this._initializing||n.forEach(u=>{if(this.terrainTileForTile[u.key])return;const p=this._findTileCoveringTileID(u,this.sourceCache);p&&(this.terrainTileForTile[u.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,u=n.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(u.TEXTURE1),ym(this.painter,y,b))}}_prepareDemTileUniforms(n,u,p,y){if(!u||u.demTexture==null)return!1;const b=n.tileID.canonical,w=Math.pow(2,u.tileID.canonical.z-b.z),E=y||"";return p[`u_dem_tl${E}`]=[b.x*w%1,b.y*w%1],p[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const u=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const b=y.dem.tree.minimums[0];return b>0&&n++,p+b},0);return n?u/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,u=n.gl;n.activeTexture.set(u.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new s.dL({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new s.T(n,y,u.R32F,{premultiply:!1}),b}setupElevationDraw(n,u,p){const y=this.painter.context,b=y.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let E=null,I=null,R=1;if(p&&p.morphing&&this._useVertexMorphing){const U=p.morphing.srcDemTile,W=p.morphing.dstDemTile;R=p.morphing.phase,U&&W&&(this._prepareDemTileUniforms(n,U,w,"_prev")&&(I=U),this._prepareDemTileUniforms(n,W,w)&&(E=W))}const L=U=>U&&U.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let N=null;var B;if(this.enabled?I&&E?(N=E.demTexture,y.activeTexture.set(b.TEXTURE4),I.demTexture.bind(L(I),b.CLAMP_TO_EDGE),w.u_dem_lerp=R):(E=this.terrainTileForTile[n.tileID.key],N=this._prepareDemTileUniforms(n,E,w)?E.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),N&&(w.u_dem_size=(B=N).size[0]===1?1:B.size[0]-2,N.bind(L(E),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,u,w),p&&p.useMeterToDem&&E){const U=(1<<E.tileID.canonical.z)*s.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=U}if(p&&p.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),u.setTerrainUniformValues(y,w),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);u.setGlobeUniformValues(y,U)}}globeUniformValues(n,u,p){const y=n.projection;return{u_tile_tl_up:y.upVector(u,0,0),u_tile_tr_up:y.upVector(u,s.al,0),u_tile_br_up:y.upVector(u,s.al,s.al),u_tile_bl_up:y.upVector(u,0,s.al),u_tile_up_scale:p?s.dM(1):y.upVectorScale(u,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const u=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(y,b,w,E,I){if(y.transform.projection.name==="globe")(function(R,L,N,B,U){const W=R.context,G=W.gl;let X,K;const oe=R.transform,re=s.dE(R,W,oe),ne=(Ze,je)=>{if(K===je)return;const tt=[Qd[je],"PROJECTION_GLOBE_VIEW"];re&&tt.push("CUSTOM_ANTIALIASING");const dt=R.isTileAffectedByFog(Ze);X=R.getOrCreateProgram("globeRaster",{defines:tt,overrideFog:dt}),K=je},be=R.colorModeForRenderPass(),_e=new Kt(G.LEQUAL,Kt.ReadWrite,R.depthRangeFor3D);hl.update(U);const ve=s.dF(oe),pe=[s.aF(oe.center.lng),s.aJ(oe.center.lat)],he=R.globeSharedBuffers,Se=[oe.width*s.o.devicePixelRatio,oe.height*s.o.devicePixelRatio],ze=Float32Array.from(oe.globeMatrix),Le={useDenormalizedUpVectorScale:!0};{const Ze=R.transform,je=ef(Ze.zoom,L.exaggeration(),L.sourceCache._source.tileSize);K=-1;const tt=G.TRIANGLES;for(const dt of B){const Fe=N.getTile(dt),Te=vi.disabled,Ke=L.prevTerrainTileForTile[dt.key],We=L.terrainTileForTile[dt.key];wh(Ke,We)&&hl.newMorphing(dt.key,Ke,We,U,250),su(R,Fe.emissiveTexture),W.activeTexture.set(G.TEXTURE0),Fe.texture&&Fe.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const ft=hl.getMorphValuesForProxy(dt.key),vt=ft?1:0;ft&&Object.assign(Le,{morphing:{srcDemTile:ft.from,dstDemTile:ft.to,phase:s.dD(ft.phase)}});const At=s.dG(dt.canonical),xt=s.dH(At.getCenter().lat),wt=s.dI(dt.canonical,At,xt,Ze.worldSize/Ze._pixelsPerMercatorPixel),qt=s.bk(s.dJ(dt.canonical)),Gt=R.emissiveMode==="mrt-fallback"?1:0,Lt=Kd(Ze.expandedFarZProjMatrix,ze,ve,qt,s.aj(Ze.zoom),pe,Ze.frustumCorners.TL,Ze.frustumCorners.TR,Ze.frustumCorners.BR,Ze.frustumCorners.BL,Ze.globeCenterInViewSpace,Ze.globeRadius,Se,je,Ze._farZ,Gt,wt);if(ne(dt,vt),X&&(L.setupElevationDraw(Fe,X,Le),R.uploadCommonUniforms(W,X,dt.toUnwrapped()),he)){const[jt,oi,fi]=he.getGridBuffers(xt,je!==0);X.draw(R,tt,_e,Te,be,di.backCCW,Lt,"globe_raster",jt,oi,fi)}}}if(he&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const Ze=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Ze.push("CUSTOM_ANTIALIASING"),X=R.getOrCreateProgram("globeRaster",{defines:Ze});for(const je of B){const{x:tt,y:dt,z:Fe}=je.canonical,Te=dt===0,Ke=dt===(1<<Fe)-1,[We,ft,vt,At]=he.getPoleBuffers(Fe,!1);if(At&&(Te||Ke)){const xt=N.getTile(je);su(R,xt.emissiveTexture),W.activeTexture.set(G.TEXTURE0),xt.texture&&xt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let wt=s.dK(Fe,tt,oe);const qt=s.bk(s.dJ(je.canonical)),Gt=R.emissiveMode==="mrt-fallback"?1:0,Lt=(jt,oi)=>jt.draw(R,G.TRIANGLES,_e,vi.disabled,be,di.disabled,Kd(oe.expandedFarZProjMatrix,wt,wt,qt,0,pe,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Se,0,oe._farZ,Gt),"globe_pole_raster",oi,vt,At);L.setupElevationDraw(xt,X,Le),R.uploadCommonUniforms(W,X,je.toUnwrapped()),Te&&R.renderDefaultNorthPole&&Lt(X,We),Ke&&R.renderDefaultSouthPole&&(wt=s.cS(s.bC(),wt,[1,-1,1]),Lt(X,ft))}}}})(y,b,w,E,I);else{const R=y.context,L=R.gl;let N,B;const U=y.shadowRenderer,W=na(y,y.longestCutoffRange),G=be=>{if(B===be)return;const _e=[];_e.push(Qd[be]),W.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),U&&(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&_e.push("NORMAL_OFFSET")),N=y.getOrCreateProgram("terrainRaster",{defines:_e}),B=be},X=y.colorModeForRenderPass(),K=new Kt(L.LEQUAL,Kt.ReadWrite,y.depthRangeFor3D);hl.update(I);const oe=y.transform,re=ef(oe.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let ne=[0,0,0];if(U){const be=y.style.directionalLight,_e=y.style.ambientLight;be&&_e&&(ne=ra(y.style,be,_e))}{B=-1;const be=L.TRIANGLES,[_e,ve]=[b.gridIndexBuffer,b.gridSegments];for(const pe of E){const he=w.getTile(pe),Se=vi.disabled,ze=b.prevTerrainTileForTile[pe.key],Le=b.terrainTileForTile[pe.key];wh(ze,Le)&&hl.newMorphing(pe.key,ze,Le,I,250),su(y,he.emissiveTexture),R.activeTexture.set(L.TEXTURE0),he.texture&&he.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const Ze=hl.getMorphValuesForProxy(pe.key),je=Ze?1:0;let tt;Ze&&(tt={morphing:{srcDemTile:Ze.from,dstDemTile:Ze.to,phase:s.dD(Ze.phase)}});const dt=y.emissiveMode==="mrt-fallback"?1:0,Fe=Ns(pe.projMatrix,Mm(pe.canonical,oe.renderWorldCopies)?re/10:re,ne,dt);if(G(je),!N)continue;b.setupElevationDraw(he,N,tt);const Te=pe.toUnwrapped();U&&U.setupShadows(Te,N),y.uploadCommonUniforms(R,N,Te,null,W),N.draw(y,be,K,Se,X,di.backCCW,Fe,"terrain_raster",b.gridBuffer,_e,ve)}}}})(u,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const u=this.painter,p=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],w=this._drapedRenderBatches.shift(),E=u.style.order,I=[];this._updateFBOs(u.emissiveMode==="mrt-fallback");let R=0;for(const L of b){const N=y.getTileByID(L.proxyTileKey),B=y.proxyCachedFBO[L.key]?y.proxyCachedFBO[L.key][n]:void 0,U=B!==void 0?y.renderCache[B]:this.pool[R++],W=B!==void 0;if(N.texture=U.tex,N.emissiveTexture=U.emissiveTex,W&&!U.dirty){I.push(N.tileID);continue}p.bindFramebuffer.set(U.fb.framebuffer);const G=p.gl;let X;G.drawBuffers(u.emissiveMode==="mrt-fallback"?[G.COLOR_ATTACHMENT0,G.COLOR_ATTACHMENT1]:[G.COLOR_ATTACHMENT0]),this.renderedToTile=!1,U.dirty&&(p.clear({color:s.ao.transparent,stencil:0}),U.dirty=!1);for(let K=w.start;K<=w.end;++K){const oe=u.style._mergedLayers[E[K]];if(oe.isHidden(u.transform.zoom))continue;const re=u.style.getLayerSourceCache(oe),ne=re?this.proxyToSource[L.key][re.id]:[L];if(!ne)continue;const be=ne;p.viewport.set([0,0,U.fb.width,U.fb.height]),X!==(re?re.id:null)&&(this._setupStencil(U,ne,oe,re),X=re?re.id:null),u.renderLayer(u,re,oe,be)}if(G.drawBuffers([G.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const K of this._pendingGroundEffectLayers){const oe=u.style._mergedLayers[E[K]];if(oe.isHidden(u.transform.zoom))continue;const re=u.style.getLayerSourceCache(oe),ne=re?this.proxyToSource[L.key][re.id]:[L];if(!ne)continue;const be=ne;p.viewport.set([0,0,U.fb.width,U.fb.height]),X!==(re?re.id:null)&&(this._setupStencil(U,ne,oe,re),X=re?re.id:null),u.renderLayer(u,re,oe,be)}this.renderedToTile?(U.dirty=!0,I.push(N.tileID)):W||--R,R===5&&(R=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,u.width,u.height]),w.end+1}postRender(){}isLayerOrderingCorrect(n){const u=n.order.length;let p=-1,y=u;for(let b=0;b<u;++b)this._style.isLayerDraped(n._mergedLayers[n.order[b]])?p=Math.max(p,b):y=Math.min(y,b);return y>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{n=Math.min(n,u.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,u,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const w=b.tileID,E=1<<w.overscaledZ,{x:I,y:R}=w.canonical,L=I/E,N=(I+1)/E,B=R/E,U=(R+1)/E;return{minx:L,miny:B,maxx:N,maxy:U,t:b.dem.tree.raycastRoot(L,B,N,U,n,u,p),tile:b}});y.sort((b,w)=>(b.t!==null?b.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const w=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,u,p);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,u=n.gl,p=this.drapeBufferSize;n.activeTexture.set(u.TEXTURE0);const y=new s.T(n,{width:p[0],height:p[1],data:null},u.RGBA8);y.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=n.createFramebuffer(p[0],p[1],1,null);let w;return b.colorAttachment0.set(y.texture),this._emissiveTexture&&(w=new s.T(n,{width:p[0],height:p[1],data:null},u.R8),w.bind(u.LINEAR,u.CLAMP_TO_EDGE),b.createColorAttachment(n,1),b.colorAttachment1.set(w.texture)),b.depthAttachment=new dv(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:y,emissiveTex:w,dirty:!1}}_updateFBOs(n){if(this._emissiveTexture!==n){for(const u of this.pool)this._updateFBO(u,n);for(const u of this.proxySourceCache.renderCache)this._updateFBO(u,n);this._emissiveTexture=n}}_updateFBO(n,u){const p=n.fb,y=this.painter.context,b=y.gl,w=this.drapeBufferSize;if(u){const E=new s.T(y,{width:w[0],height:w[1],data:null},b.R8);E.bind(b.LINEAR,b.CLAMP_TO_EDGE),n.emissiveTex=E,p.createColorAttachment(y,1),p.colorAttachment1.set(E.texture)}else n.emissiveTex=void 0,p.removeColorAttachment(y,1);n.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const u=this._style._mergedLayers[n],p=u.isHidden(this.painter.transform.zoom);return u.type==="hillshade"||u.type==="custom"?!p&&u.shouldRedrape():!p&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof ta){n=!0;break}if(!n)return;const u={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(!b||u[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="line")continue;const w=y.widthExpression(),E=y.emissiveStrengthExpression();if(w instanceof s.ad||E instanceof s.ad){u[b.id]=!0;for(const I of this.proxyCoords){const R=this.proxyToSource[I.key][b.id];if(R)for(const L of R)this._clearRenderCacheForTile(b.id,L)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof pa){n=!0;break}if(!n)return;const u={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(!b||u[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const w=y.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const I=this.proxyToSource[E.key][b.id];if(I)for(const R of I){const L=Th(b.getTile(R),b.findLoadedParent(R,0),b,this.painter.transform,w);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(b.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,u=n.length;if(u===0)return;const p=[];this._pendingGroundEffectLayers=[];let y,b=0,w=this._style._mergedLayers[n[b]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++b<u;)w=this._style._mergedLayers[n[b]];for(;b<u;++b){const E=this._style._mergedLayers[n[b]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?y===void 0&&(y=b):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(p.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&p.push({start:y,end:b-1}),p.length!==0){const E=p[p.length-1];this._pendingGroundEffectLayers.every(I=>I>E.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const w=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let E=0;E<w.length;++E){const I=Object.values(w[E]);u.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let w=p.length-1;w>=0;w--){const E=p[w];if(u.getTileByID(E.key),u.proxyCachedFBO[E.key]!==void 0){const I=n[E.key],R=this.proxyToSource[E.key];let L=0;for(const N in R){const B=R[N],U=I[N];if(!U||U.length!==B.length||B.some((W,G)=>W!==U[G]||y[N]&&y[N].hasOwnProperty(W.key))){L=-1;break}++L}for(const N in u.proxyCachedFBO[E.key])u.renderCache[u.proxyCachedFBO[E.key][N]].dirty=L<0||L!==Object.values(I).length}}const b=[...this._drapedRenderBatches];b.sort((w,E)=>E.end-E.start-(w.end-w.start));for(const w of b)for(const E of p){if(u.proxyCachedFBO[E.key])continue;let I=u.renderCachePool.pop();I===void 0&&u.renderCache.length<50&&(I=u.renderCache.length,u.renderCache.push(this._createFBO())),I!==void 0&&(u.proxyCachedFBO[E.key]={},u.proxyCachedFBO[E.key][w.start]=I,u.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(n,u,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,w=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let E;if(p.isTileClipped())E=u.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):vi.disabled}_renderTileClippingMasks(n,u){const p=this.painter,y=this.painter.context,b=y.gl;p._tileClippingMaskIDs={},y.setColorMode(Ii.disabled),y.setDepthMode(Kt.disabled);const w=p.getOrCreateProgram("clippingMask");for(const E of n){const I=p._tileClippingMaskIDs[E.key]=--u;w.draw(p,b.TRIANGLES,Kt.disabled,new vi({func:b.ALWAYS,mask:0},I,255,b.KEEP,b.KEEP,b.REPLACE),Ii.disabled,di.disabled,Sh(E.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const u=this.painter.transform;if(n.x<0||n.x>u.width||n.y<0||n.y>u.height)return null;const p=[n.x,n.y,1,1];s.aC(p,p,u.pixelMatrixInverse),s.cK(p,p,1/p[3]),p[0]/=u.worldSize,p[1]/=u.worldSize;const y=u._camera.position,b=s.cf(1,u.center.lat),w=[y[0],y[1],y[2]/b,0],E=s.da([],p.slice(0,3),w);s.aw(E,E);const I=this.raycast(w,E,this._exaggeration);return I!==null&&I?(s.bH(w,w,E,I),w[3]=w[2],w[2]*=b,w):null}_setupProxiedCoordsForOrtho(n,u,p){if(n.getSource()instanceof s.aU)return this._setupProxiedCoordsForImageSource(n,u,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let I=0;I<b.length;I++){const R=b[I],L=this._findTileCoveringTileID(R,n);if(L){const N=this._createProxiedId(R,L,p[R.key]&&p[R.key][n.id]);y.push(N),this.proxyToSource[R.key][n.id]=[N]}}let w=!1;const E=new Set;for(let I=0;I<u.length;I++){const R=n.getTile(u[I]);if(!R||!R.hasData())continue;const L=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==R.tileID.canonical.z){const N=this.proxyToSource[L.tileID.key][n.id],B=this._createProxiedId(L.tileID,R,p[L.tileID.key]&&p[L.tileID.key][n.id]);N?N.splice(N.length-1,0,B):this.proxyToSource[L.tileID.key][n.id]=[B];const U=this.proxyToSource[L.tileID.key][n.id];E.has(U)||E.add(U),y.push(B),w=!0}}if(this._sourceTilesOverlap[n.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const I of E)I.sort((R,L)=>L.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(n,u,p){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords,w=n.getSource(),E=w.tileID;if(!E)return;const I=new s.P(E.x,E.y)._div(1<<E.z),R=w.coordinates.map(s.ae.fromLngLat).reduce((N,B)=>(N.min.x=Math.min(N.min.x,B.x-I.x),N.min.y=Math.min(N.min.y,B.y-I.y),N.max.x=Math.max(N.max.x,B.x-I.x),N.max.y=Math.max(N.max.y,B.y-I.y),N),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(N,B)=>{const U=N.wrap+N.canonical.x/(1<<N.canonical.z),W=N.canonical.y/(1<<N.canonical.z),G=s.al/(1<<N.canonical.z),X=B.wrap+B.canonical.x/(1<<B.canonical.z),K=B.canonical.y/(1<<B.canonical.z);return U+G<X+R.min.x||U>X+R.max.x||W+G<K+R.min.y||W>K+R.max.y};for(let N=0;N<b.length;N++){const B=b[N];for(let U=0;U<u.length;U++){const W=n.getTile(u[U]);if(!W||!W.hasData()||L(B,W.tileID))continue;const G=this._createProxiedId(B,W,p[B.key]&&p[B.key][n.id]),X=this.proxyToSource[B.key][n.id];X?X.push(G):this.proxyToSource[B.key][n.id]=[G],y.push(G)}}}_createProxiedId(n,u,p){let y=this.orthoMatrix;if(p){const b=p.find(w=>w.key===u.tileID.key);if(b)return b}if(u.tileID.key!==n.key){const b=n.canonical.z-u.tileID.canonical.z;let w,E,I;y=s.bC();const R=u.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(w=s.al>>b,E=w*((u.tileID.canonical.x<<b)-n.canonical.x+R),I=w*((u.tileID.canonical.y<<b)-n.canonical.y)):(w=s.al<<-b,E=s.al*(u.tileID.canonical.x-(n.canonical.x+R<<-b)),I=s.al*(u.tileID.canonical.y-(n.canonical.y<<-b))),s.ce(y,0,w,0,w,0,1),s.br(y,y,[E,I,0])}return new Pm(u.tileID,n.key,y)}_findTileCoveringTileID(n,u){let p=u.getTile(n);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[u.id],b=y[n.key];if(p=b?u.getTileByID(b):null,p&&p.hasData()||b===null)return p;let w=p?p.tileID:n,E=w.overscaledZ;const I=u.getSource().minzoom,R=[];if(!b){const N=u.getSource().maxzoom;if(n.canonical.z>=N){const B=n.canonical.z-N;u.getSource().reparseOverscaled?(E=Math.max(n.canonical.z+2,u.transform.tileZoom),w=new s.aQ(E,n.wrap,N,n.canonical.x>>B,n.canonical.y>>B)):B!==0&&(E=N,w=new s.aQ(E,n.wrap,N,n.canonical.x>>B,n.canonical.y>>B))}w.key!==n.key&&(R.push(w.key),p=u.getTile(w))}const L=N=>{R.forEach(B=>{y[B]=N}),R.length=0};for(E-=1;E>=I&&(!p||!p.hasData());E--){p&&L(p.tileID.key);const N=w.calculateScaledKey(E);if(p=u.getTileByID(N),p&&p.hasData())break;const B=y[N];if(B===null)break;B===void 0?R.push(N):p=u.getTileByID(B)}return L(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,u){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[u.key]=!0}}function au(f,n,u){const p=(function(E,I,R){const L=s.bJ(I,E),N=s.bJ(R,[.2126,.7152,.0722]),B=(W,G,X)=>(1-X)*W+X*G,U=B(1-.3*Math.min(N,1),1,Math.min(L+1,1));return B(.92,1,Math.asin(s.aA(I[2],-1,1))/Math.PI+.5)*U})(f,[0,0,1],n),y=[0,0,0];s.c5(y,u.slice(0,3),p);const b=[0,0,0];s.c5(b,n.slice(0,3),f[2]);const w=[0,0,0];return s.d8(w,y,b),s.db(w)}const o1=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],s1=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class fv{static cacheKey(n,u,p,y){const b=[u];y&&b.push(y.cacheKey);for(const w of p)n.usedDefines.has(w)&&b.push(w);return b.join("/")}constructor(n,u,p,y,b,w){const E=n.gl;this.program=E.createProgram(),this.configuration=y,this.name=u,this.fixedDefines=[...w];const I=`#version 300 es
${(y?y.defines():[]).concat(w.map(G=>`#define ${G}`)).join(`
`)}`,R=[I,Jw];for(const G of p.fragmentIncludes)R.push($l[G]);R.push(p.fragmentSource);const L=R.join(`
`),N=[I,nv];for(const G of p.vertexIncludes)N.push($l[G]);this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&p.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&N.push("uniform int u_instanceID;"),N.push(p.vertexSource);let B=N.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(B=B.replaceAll("gl_InstanceID","u_instanceID"));const U=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(U,L),E.compileShader(U),E.attachShader(this.program,U);const W=E.createShader(E.VERTEX_SHADER);E.isContextLost()?this.failedToCreate=!0:(E.shaderSource(W,B),E.compileShader(W),E.attachShader(this.program,W),this.attributes={},E.linkProgram(this.program),E.deleteShader(W),E.deleteShader(U),this.fixedUniforms=b(n),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=y?y.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(G=>({u_instanceID:new s.ch(G)}))(n)),(w.includes("TERRAIN")||u.includes("symbol")||u.includes("circle"))&&(this.terrainUniforms=(G=>({u_dem:new s.ch(G),u_dem_prev:new s.ch(G),u_dem_tl:new s.ck(G),u_dem_scale:new s.cj(G),u_dem_tl_prev:new s.ck(G),u_dem_scale_prev:new s.cj(G),u_dem_size:new s.cj(G),u_dem_lerp:new s.cj(G),u_exaggeration:new s.cj(G),u_depth:new s.ch(G),u_depth_size_inv:new s.ck(G),u_depth_range_unpack:new s.ck(G),u_occluder_half_size:new s.cj(G),u_occlusion_depth_offset:new s.cj(G),u_meter_to_dem:new s.cj(G),u_label_plane_matrix_inv:new s.cl(G)}))(n)),w.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new s.ci(G),u_tile_tr_up:new s.ci(G),u_tile_br_up:new s.ci(G),u_tile_bl_up:new s.ci(G),u_tile_up_scale:new s.cj(G)}))(n)),w.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new s.cl(G),u_fog_range:new s.ck(G),u_fog_color:new s.d3(G),u_fog_horizon_blend:new s.cj(G),u_fog_vertical_limit:new s.ck(G),u_fog_temporal_offset:new s.cj(G),u_frustum_tl:new s.ci(G),u_frustum_tr:new s.ci(G),u_frustum_br:new s.ci(G),u_frustum_bl:new s.ci(G),u_globe_pos:new s.ci(G),u_globe_radius:new s.cj(G),u_globe_transition:new s.cj(G),u_is_globe:new s.ch(G),u_viewport:new s.ck(G)}))(n)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new s.d3(G)}))(n)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new s.ci(G),u_lighting_directional_dir:new s.ci(G),u_lighting_directional_color:new s.ci(G),u_ground_radiance:new s.ci(G)}))(n)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new s.cl(G),u_light_matrix_1:new s.cl(G),u_fade_range:new s.ck(G),u_shadow_normal_offset:new s.ci(G),u_shadow_intensity:new s.cj(G),u_shadow_texel_size:new s.cj(G),u_shadow_map_resolution:new s.cj(G),u_shadow_direction:new s.ci(G),u_shadow_bias:new s.ci(G),u_shadowmap_0:new s.ch(G),u_shadowmap_1:new s.ch(G)}))(n)))}getAttributeLocation(n,u){let p=this.attributes[u];return p===void 0&&(p=this.attributes[u]=n.getAttribLocation(this.program,u)),p}setTerrainUniformValues(n,u){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)p[y]&&p[y].set(this.program,y,u[y])}}setGlobeUniformValues(n,u){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)p[y]&&p[y].set(this.program,y,u[y])}}setFogUniformValues(n,u){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)p[y].set(this.program,y,u[y])}}setCutoffUniformValues(n,u){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)p[y].set(this.program,y,u[y])}}setLightsUniformValues(n,u){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in u)p[y].set(this.program,y,u[y])}}setShadowUniformValues(n,u){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const y in u)p[y].set(this.program,y,u[y])}_drawDebugWireframe(n,u,p,y,b,w,E,I,R,L){const N=n.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;const B=n.context;if(!(!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||n._terrain&&n._terrain.renderingToTexture||!o1.includes(this.name))||!(!N.layers3D||!s1.includes(this.name))))return;const U=B.gl,W=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,b,B);if(!W)return;const G=[...this.fixedDefines,"DEBUG_WIREFRAME"],X=n.getOrCreateProgram(this.name,{config:this.configuration,defines:G});B.program.set(X.program);const K=(ne,be,_e)=>{if(be[ne]&&_e[ne])for(const ve in be[ne])_e[ne][ve]&&_e[ne][ve].set(_e.program,ve,be[ne][ve].current)};R&&R.setUniforms(X.program,B,X.binderUniforms,E,{zoom:I}),K("fixedUniforms",this,X),K("terrainUniforms",this,X),K("globeUniforms",this,X),K("fogUniforms",this,X),K("lightsUniforms",this,X),K("shadowUniforms",this,X),W.bind(),B.setColorMode(new Ii([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],s.ao.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Kt(u.func===U.LESS?U.LEQUAL:u.func,Kt.ReadOnly,u.range)),B.setStencilMode(vi.disabled);const oe=3*w.primitiveLength*2,re=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ne=L||1;for(let be=0;be<ne;++be)X.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),U.drawElements(U.LINES,oe,U.UNSIGNED_SHORT,re)}else L&&L>1?U.drawElementsInstanced(U.LINES,oe,U.UNSIGNED_SHORT,re,L):U.drawElements(U.LINES,oe,U.UNSIGNED_SHORT,re);b.bind(),B.program.set(this.program),B.setDepthMode(u),B.setStencilMode(p),B.setColorMode(y)}checkUniforms(n,u,p){if(this.fixedDefines.includes(u)){for(const y of Object.keys(p))if(!p[y].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${y} not set but required by ${u} being defined`)}}draw(n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X){const K=n.context,oe=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(p),K.setStencilMode(y),K.setColorMode(b),K.setCullFace(w);for(const[pe,he]of this.fixedUniformsEntries)he.set(this.program,pe,E[pe]);W&&W.setUniforms(this.program,K,this.binderUniforms,B,{zoom:U});const re={[oe.POINTS]:1,[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[u];this.checkUniforms(I,"RENDER_SHADOWS",this.shadowUniforms);const ne=G||[],be=W?W.getPaintVertexBuffers():[],_e=u===oe.TRIANGLES&&L,ve=X&&X>0?1:void 0;for(const pe of N.get()){const he=pe.vaos||(pe.vaos={});if((he[I]||(he[I]=new Yw)).bind(K,this,R,be,L,pe.vertexOffset,ne,ve),this.forceManualRenderingForInstanceIDShaders){const Se=X||1;for(let ze=0;ze<Se;++ze)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ze),L?oe.drawElements(u,pe.primitiveLength*re,oe.UNSIGNED_SHORT,pe.primitiveOffset*re*2):oe.drawArrays(u,pe.vertexOffset,pe.vertexLength)}else X&&X>1?oe.drawElementsInstanced(u,pe.primitiveLength*re,oe.UNSIGNED_SHORT,pe.primitiveOffset*re*2,X):L?oe.drawElements(u,pe.primitiveLength*re,oe.UNSIGNED_SHORT,pe.primitiveOffset*re*2):oe.drawArrays(u,pe.vertexOffset,pe.vertexLength);_e&&this._drawDebugWireframe(n,p,y,b,L,pe,B,U,W,X)}}}function pv(f,n,u=0){const p=Math.pow(2,n.tileID.overscaledZ),y=n.tileSize*Math.pow(2,f.transform.tileZoom)/p,b=y*(n.tileID.canonical.x+n.tileID.wrap*p),w=y*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(n,1,f.transform.tileZoom),u_pixel_coord_upper:[b>>16,w>>16],u_pixel_coord_lower:[65535&b,65535&w],u_pattern_transition:u}}const nf={terrain:0,flat:1},a1=s.bC(),rf=(f,n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X,K)=>{const oe=n.style.light,re=oe.properties.get("position"),ne=[re.x,re.y,re.z],be=s.dO();oe.properties.get("anchor")==="viewport"&&(s.dP(be,-n.transform.angle),s.dQ(ne,ne,be));const _e=oe.properties.get("color").toPremultipliedRenderColor(null),ve=n.transform,pe={u_matrix:f,u_lightpos:ne,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+u,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:a1,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:nf[R],u_base_type:nf[L],u_ao:y,u_edge_radius:b,u_width_scale:w,u_flood_light_color:W,u_vertical_scale:G,u_flood_light_intensity:X,u_ground_shadow_factor:K};return ve.projection.name==="globe"&&(pe.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],pe.u_zoom_transition=N,pe.u_inv_rot_matrix=U,pe.u_merc_center=B,pe.u_up_dir=ve.projection.upVector(new s.cD(0,0,0),B[0]*s.al,B[1]*s.al),pe.u_height_lift=I),pe},Cm=(f,n,u,p,y,b)=>({u_matrix:f,u_edge_radius:n,u_width_scale:u,u_vertical_scale:p,u_height_type:nf[y],u_base_type:nf[b]}),mv=(f,n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X,K)=>{const oe=rf(f,n,u,p,y,b,w,E,R,L,N,B,U,W,G,X,1,[0,0,0]),re={u_height_factor:-Math.pow(2,E.overscaledZ)/I.tileSize/8};return Object.assign(oe,pv(n,I,K),re)},_c=(f,n,u)=>({u_matrix:f,u_emissive_strength:n,u_ground_shadow_factor:u}),Rm=(f,n,u,p,y,b=0)=>Object.assign(_c(f,n,y),pv(u,p,b)),gv=(f,n,u,p)=>({u_matrix:f,u_world:u,u_emissive_strength:n,u_ground_shadow_factor:p}),_v=(f,n,u,p,y,b,w=0)=>Object.assign(Rm(f,n,u,p,b,w),{u_world:y}),Lm=(f,n)=>({u_matrix:f,u_depth_bias:n}),jl=(f,n)=>({u_matrix:f,u_ground_shadow_factor:n}),yc=(f,n,u,p,y)=>({u_matrix:f,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:u,u_height_scale:p,u_reset_depth:y}),of=(f,n,u,p,y,b,w,E,I)=>({u_matrix:f,u_normal_matrix:n,u_opacity:u,u_faux_facade_ao_intensity:p,u_camera_pos:y,u_tile_to_meter:b,u_facade_emissive_chance:w,u_flood_light_color:E,u_flood_light_intensity:I}),yv=f=>({u_matrix:f}),Gl=f=>({u_matrix:f}),Dm=(f,n,u,p,y,b,w,E)=>{const I=s.al/b.tileSize;return{u_matrix:f,u_inv_rot_matrix:n,u_camera_to_center_distance:u.getCameraToCenterDistance(E),u_extrude_scale:[u.pixelsToGLUnits[0]/I,u.pixelsToGLUnits[1]/I],u_zoom_transition:p,u_tile_id:w,u_merc_center:y}},sf=(f,n,u,p)=>({u_matrix:f,u_inv_matrix:n,u_camera_to_center_distance:u.getCameraToCenterDistance(p),u_viewport_size:[u.width,u.height]}),km=(f,n,u=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:u}),vv=s.bC(),Om=(f,n,u,p,y,b,w)=>{const E=f.transform,I=E.projection.name==="globe",R=I?s.dR(E.zoom,n.canonical)*E._pixelsPerMercatorPixel:s.ay(u,1,b),L={u_matrix:n.projMatrix,u_extrude_scale:R,u_intensity:w,u_inv_rot_matrix:vv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){L.u_inv_rot_matrix=p,L.u_merc_center=y,L.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],L.u_zoom_transition=s.aj(E.zoom);const N=y[0]*s.al,B=y[1]*s.al;L.u_up_dir=E.projection.upVector(new s.cD(0,0,0),N,B)}return L};function af(f,[n,u,p,y],[b,w]){if(b===w)return[0,0,0,0];const E=255*(f-1)/(f*(w-b));return[n*E,u*E,p*E,y*E]}function xv(f,n,[u,p]){return u===p?0:.5/f+(n-u)*(f-1)/(f*(p-u))}const Fm=(f,n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X,K,oe,re,ne)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:u,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:R,u_fade_t:L.mix,u_opacity:L.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:s.dT(N.paint.get("raster-saturation")),u_contrast_factor:s.dS(N.paint.get("raster-contrast")),u_spin_weights:Eh(N.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:U,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:I,u_colorization_mix:af(s.dU,G,K),u_colorization_offset:xv(s.dU,X,K),u_color_ramp:W,u_texture_offset:[re/(oe+2*re),oe/(oe+2*re)],u_texture_res:[oe+2*re,oe+2*re],u_emissive_strength:ne});function Eh(f){f*=Math.PI/180;const n=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*n-u+1)/3,(Math.sqrt(3)*n-u+1)/3]}const lu=.05,l1=(f,n,u,p,y,b,w,E,I,R,L,N)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:u,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:R,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:I}),bv=(f,n,u,p,y,b,w,E,I,R)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_tile_offset:u,u_velocity:p,u_color_ramp:b,u_velocity_res:y,u_max_speed:w,u_uv_offset:E,u_data_scale:[255*I[0],255*I[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[lu,lu]}),c1=(f,n,u,p,y,b,w,E,I,R)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_velocity:u,u_velocity_res:p,u_max_speed:y,u_speed_factor:b,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*I[0],255*I[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[lu,lu]}),lf=s.bC(),Ih=(f,n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X,K,oe,re,ne,be,_e,ve)=>{const pe=y.transform,he={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:pe.getCameraToCenterDistance(oe),u_rotate_symbol:+u,u_aspect_ratio:pe.width/pe.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+R,u_elevation_from_sea:I?1:0,u_pitch_with_map:+p,u_texsize:L,u_texsize_icon:N,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:lf,u_up_vector:[0,-1,0],u_color_adj_mat:be,u_icon_transition:_e||0,u_gamma_scale:p?y.transform.getCameraToCenterDistance(oe)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ve||1,u_ground_shadow_factor:re,u_inv_matrix:s.bl(s.bC(),w),u_normal_scale:ne,u_lutTexture:10};return oe.name==="globe"&&(he.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],he.u_zoom_transition=W,he.u_inv_rot_matrix=X,he.u_merc_center=G,he.u_camera_forward=pe._camera.forward(),he.u_ecef_origin=s.dV(pe.globeMatrix,U.toUnwrapped()),he.u_tile_matrix=Float32Array.from(pe.globeMatrix),he.u_up_vector=K),he},Hl=(f,n,u,p)=>({u_matrix:f,u_emissive_strength:n,u_opacity:u,u_color:p}),Mh=(f,n,u,p,y,b,w,E,I)=>Object.assign((function(R,L,N,B,U,W){const{width:G,height:X}=B.imageManager.getPixelSize(L),K=Math.pow(2,W.tileID.overscaledZ),oe=W.tileSize*Math.pow(2,B.transform.tileZoom)/K,re=oe*(W.tileID.canonical.x+W.tileID.wrap*K),ne=oe*W.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[G,X],u_pattern_size:N.displaySize,u_pattern_units_to_pixels:U?[B.transform.width,-1*B.transform.height]:[1/s.ay(W,1,B.transform.tileZoom),1/s.ay(W,1,B.transform.tileZoom)],u_pixel_coord_upper:[re>>16,ne>>16],u_pixel_coord_lower:[65535&re,65535&ne]}})(0,b,w,p,E,I),{u_matrix:f,u_emissive_strength:n,u_opacity:u}),vc=new Float32Array(s.bA([])),cf=(f,n,u,p,y,b,w,E,I,R,L,N,B,U=[0,0,0],W,G,X)=>{const K=y.style.light,oe=K.properties.get("position"),re=[-oe.x,-oe.y,oe.z],ne=s.dO();K.properties.get("anchor")==="viewport"&&(s.dP(ne,-y.transform.angle),s.dQ(re,re,ne));const be=L.alphaMode==="MASK",_e=K.properties.get("color").toNonPremultipliedRenderColor(null),ve=B.paint.get("model-ambient-occlusion-intensity"),pe=B.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return pe.a=B.paint.get("model-color-mix-intensity").constantOr(0),X&&(pe.r=X[0],pe.g=X[1],pe.b=X[2],pe.a=X[3]),G&&(pe.r=G.color.r,pe.g=G.color.g,pe.b=G.color.b,pe.a=G.colorMix,N=G.emissionStrength,b*=G.opacity),{u_matrix:f,u_lighting_matrix:n,u_normal_matrix:u,u_node_matrix:p||vc,u_lightpos:re,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_camera_pos:U,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+be,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:I,u_roughnessFactor:R,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:pe.toArray01(),u_aoIntensity:ve,u_emissive_strength:N,u_occlusionTextureTransform:W||[0,0,0,0]}},Ah=(f,n=vc,u=vc)=>({u_matrix:f,u_instance:n,u_node_matrix:u}),uf={fillExtrusion:f=>({u_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_vertical_gradient:new s.cj(f),u_opacity:new s.cj(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_ao:new s.ck(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_up_dir:new s.ci(f),u_height_lift:new s.cj(f),u_flood_light_color:new s.ci(f),u_vertical_scale:new s.cj(f),u_flood_light_intensity:new s.cj(f),u_ground_shadow_factor:new s.ci(f)}),fillExtrusionDepth:f=>({u_matrix:new s.cl(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_vertical_scale:new s.cj(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f)}),fillExtrusionPattern:f=>({u_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_vertical_gradient:new s.cj(f),u_height_factor:new s.cj(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_ao:new s.ck(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_up_dir:new s.ci(f),u_height_lift:new s.cj(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_opacity:new s.cj(f),u_pattern_transition:new s.cj(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new s.cl(f),u_opacity:new s.cj(f),u_ao_pass:new s.cj(f),u_meter_to_tile:new s.cj(f),u_ao:new s.ck(f),u_flood_light_intensity:new s.cj(f),u_flood_light_color:new s.ci(f),u_attenuation:new s.cj(f),u_edge_radius:new s.cj(f),u_fb:new s.ch(f),u_fb_size:new s.cj(f),u_dynamic_offset:new s.cj(f)}),fill:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_ground_shadow_factor:new s.ci(f)}),fillPattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_pattern_transition:new s.cj(f)}),fillOutline:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_world:new s.ck(f),u_ground_shadow_factor:new s.ci(f)}),fillOutlinePattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_world:new s.ck(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_pattern_transition:new s.cj(f)}),building:f=>({u_matrix:new s.cl(f),u_normal_matrix:new s.cl(f),u_opacity:new s.cj(f),u_faux_facade_ao_intensity:new s.cj(f),u_camera_pos:new s.ci(f),u_tile_to_meter:new s.cj(f),u_facade_emissive_chance:new s.cj(f),u_flood_light_color:new s.ci(f),u_flood_light_intensity:new s.cj(f)}),buildingBloom:f=>({u_matrix:new s.cl(f)}),buildingDepth:f=>({u_matrix:new s.cl(f)}),elevatedStructuresDepth:f=>({u_matrix:new s.cl(f),u_depth_bias:new s.cj(f)}),elevatedStructures:f=>({u_matrix:new s.cl(f),u_ground_shadow_factor:new s.ci(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new s.cl(f),u_camera_pos:new s.ci(f),u_depth_bias:new s.cj(f),u_height_scale:new s.cj(f),u_reset_depth:new s.cj(f)}),circle:s.dY,collisionBox:f=>({u_matrix:new s.cl(f),u_inv_rot_matrix:new s.cl(f),u_camera_to_center_distance:new s.cj(f),u_extrude_scale:new s.ck(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_tile_id:new s.ci(f)}),collisionCircle:f=>({u_matrix:new s.cl(f),u_inv_matrix:new s.cl(f),u_camera_to_center_distance:new s.cj(f),u_viewport_size:new s.ck(f)}),debug:f=>({u_color:new s.dB(f),u_matrix:new s.cl(f),u_overlay:new s.ch(f),u_overlay_scale:new s.cj(f)}),clippingMask:f=>({u_matrix:new s.cl(f)}),heatmap:f=>({u_extrude_scale:new s.cj(f),u_intensity:new s.cj(f),u_matrix:new s.cl(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_up_dir:new s.ci(f)}),heatmapTexture:f=>({u_image:new s.ch(f),u_color_ramp:new s.ch(f),u_opacity:new s.cj(f)}),hillshade:f=>({u_matrix:new s.cl(f),u_image:new s.ch(f),u_latrange:new s.ck(f),u_light:new s.ck(f),u_shadow:new s.dB(f),u_highlight:new s.dB(f),u_emissive_strength:new s.cj(f),u_accent:new s.dB(f)}),hillshadePrepare:f=>({u_matrix:new s.cl(f),u_image:new s.ch(f),u_dimension:new s.ck(f),u_zoom:new s.cj(f)}),line:s.dX,linePattern:s.dW,raster:f=>({u_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_grid_matrix:new s.dC(f),u_tl_parent:new s.ck(f),u_scale_parent:new s.cj(f),u_fade_t:new s.cj(f),u_opacity:new s.cj(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_brightness_low:new s.cj(f),u_brightness_high:new s.cj(f),u_saturation_factor:new s.cj(f),u_contrast_factor:new s.cj(f),u_spin_weights:new s.ci(f),u_perspective_transform:new s.ck(f),u_raster_elevation:new s.cj(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_cutoff_params:new s.d3(f),u_colorization_mix:new s.d3(f),u_colorization_offset:new s.cj(f),u_color_ramp:new s.ch(f),u_texture_offset:new s.ck(f),u_texture_res:new s.ck(f),u_emissive_strength:new s.cj(f)}),rasterParticle:f=>({u_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_grid_matrix:new s.dC(f),u_tl_parent:new s.ck(f),u_scale_parent:new s.cj(f),u_fade_t:new s.cj(f),u_opacity:new s.cj(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_raster_elevation:new s.cj(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_cutoff_params:new s.d3(f)}),rasterParticleTexture:f=>({u_texture:new s.ch(f),u_opacity:new s.cj(f)}),rasterParticleDraw:f=>({u_particle_texture:new s.ch(f),u_particle_texture_side_len:new s.cj(f),u_tile_offset:new s.ck(f),u_velocity:new s.ch(f),u_color_ramp:new s.ch(f),u_velocity_res:new s.ck(f),u_max_speed:new s.cj(f),u_uv_offset:new s.ck(f),u_data_scale:new s.ck(f),u_data_offset:new s.cj(f),u_particle_pos_scale:new s.cj(f),u_particle_pos_offset:new s.ck(f)}),rasterParticleUpdate:f=>({u_particle_texture:new s.ch(f),u_particle_texture_side_len:new s.cj(f),u_velocity:new s.ch(f),u_velocity_res:new s.ck(f),u_max_speed:new s.cj(f),u_speed_factor:new s.cj(f),u_reset_rate:new s.cj(f),u_rand_seed:new s.cj(f),u_uv_offset:new s.ck(f),u_data_scale:new s.ck(f),u_data_offset:new s.cj(f),u_particle_pos_scale:new s.cj(f),u_particle_pos_offset:new s.ck(f)}),symbol:f=>({u_is_size_zoom_constant:new s.ch(f),u_is_size_feature_constant:new s.ch(f),u_size_t:new s.cj(f),u_size:new s.cj(f),u_camera_to_center_distance:new s.cj(f),u_rotate_symbol:new s.ch(f),u_aspect_ratio:new s.cj(f),u_fade_change:new s.cj(f),u_matrix:new s.cl(f),u_label_plane_matrix:new s.cl(f),u_coord_matrix:new s.cl(f),u_is_text:new s.ch(f),u_elevation_from_sea:new s.ch(f),u_pitch_with_map:new s.ch(f),u_texsize:new s.ck(f),u_texsize_icon:new s.ck(f),u_texture:new s.ch(f),u_texture_icon:new s.ch(f),u_gamma_scale:new s.cj(f),u_device_pixel_ratio:new s.cj(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_camera_forward:new s.ci(f),u_tile_matrix:new s.cl(f),u_up_vector:new s.ci(f),u_ecef_origin:new s.ci(f),u_is_halo:new s.ch(f),u_icon_transition:new s.cj(f),u_color_adj_mat:new s.cl(f),u_scale_factor:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_inv_matrix:new s.cl(f),u_normal_scale:new s.cj(f),u_lutTexture:new s.ch(f)}),background:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_opacity:new s.cj(f),u_color:new s.dB(f)}),backgroundPattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_opacity:new s.cj(f),u_image:new s.ch(f),u_pattern_tl:new s.ck(f),u_pattern_br:new s.ck(f),u_texsize:new s.ck(f),u_pattern_size:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_pattern_units_to_pixels:new s.ck(f)}),terrainRaster:f=>({u_matrix:new s.cl(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_skirt_height:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_emissive_texture_available:new s.cj(f)}),skybox:f=>({u_matrix:new s.cl(f),u_sun_direction:new s.ci(f),u_cubemap:new s.ch(f),u_opacity:new s.cj(f),u_temporal_offset:new s.cj(f)}),skyboxGradient:f=>({u_matrix:new s.cl(f),u_color_ramp:new s.ch(f),u_center_direction:new s.ci(f),u_radius:new s.cj(f),u_opacity:new s.cj(f),u_temporal_offset:new s.cj(f)}),skyboxCapture:f=>({u_matrix_3f:new s.dC(f),u_sun_direction:new s.ci(f),u_sun_intensity:new s.cj(f),u_color_tint_r:new s.d3(f),u_color_tint_m:new s.d3(f),u_luminance:new s.cj(f)}),globeRaster:f=>({u_proj_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_grid_matrix:new s.dC(f),u_skirt_height:new s.cj(f),u_far_z_cutoff:new s.cj(f),u_frustum_tl:new s.ci(f),u_frustum_tr:new s.ci(f),u_frustum_br:new s.ci(f),u_frustum_bl:new s.ci(f),u_globe_pos:new s.ci(f),u_globe_radius:new s.cj(f),u_viewport:new s.ck(f),u_emissive_texture_available:new s.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new s.ci(f),u_frustum_tr:new s.ci(f),u_frustum_br:new s.ci(f),u_frustum_bl:new s.ci(f),u_horizon:new s.cj(f),u_transition:new s.cj(f),u_fadeout_range:new s.cj(f),u_atmosphere_fog_color:new s.d3(f),u_high_color:new s.d3(f),u_space_color:new s.d3(f),u_temporal_offset:new s.cj(f),u_horizon_angle:new s.cj(f)}),model:f=>({u_matrix:new s.cl(f),u_lighting_matrix:new s.cl(f),u_normal_matrix:new s.cl(f),u_node_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_camera_pos:new s.ci(f),u_opacity:new s.cj(f),u_baseColorFactor:new s.d3(f),u_emissiveFactor:new s.d3(f),u_metallicFactor:new s.cj(f),u_roughnessFactor:new s.cj(f),u_baseTextureIsAlpha:new s.ch(f),u_alphaMask:new s.ch(f),u_alphaCutoff:new s.cj(f),u_baseColorTexture:new s.ch(f),u_metallicRoughnessTexture:new s.ch(f),u_normalTexture:new s.ch(f),u_occlusionTexture:new s.ch(f),u_emissionTexture:new s.ch(f),u_lutTexture:new s.ch(f),u_color_mix:new s.d3(f),u_aoIntensity:new s.cj(f),u_emissive_strength:new s.cj(f),u_occlusionTextureTransform:new s.d3(f)}),modelDepth:f=>({u_matrix:new s.cl(f),u_instance:new s.cl(f),u_node_matrix:new s.cl(f)}),groundShadow:f=>({u_matrix:new s.cl(f),u_ground_shadow_factor:new s.ci(f)}),stars:f=>({u_matrix:new s.cl(f),u_up:new s.ci(f),u_right:new s.ci(f),u_intensity_multiplier:new s.cj(f)}),snowParticle:f=>({u_modelview:new s.cl(f),u_projection:new s.cl(f),u_time:new s.cj(f),u_cam_pos:new s.ci(f),u_velocityConeAperture:new s.cj(f),u_velocity:new s.cj(f),u_horizontalOscillationRadius:new s.cj(f),u_horizontalOscillationRate:new s.cj(f),u_boxSize:new s.cj(f),u_billboardSize:new s.cj(f),u_simpleShapeParameters:new s.ck(f),u_screenSize:new s.ck(f),u_thinningCenterPos:new s.ck(f),u_thinningShape:new s.ci(f),u_thinningAffectedRatio:new s.cj(f),u_thinningParticleOffset:new s.cj(f),u_particleColor:new s.d3(f),u_direction:new s.ci(f)}),rainParticle:f=>({u_modelview:new s.cl(f),u_projection:new s.cl(f),u_time:new s.cj(f),u_cam_pos:new s.ci(f),u_texScreen:new s.ch(f),u_velocityConeAperture:new s.cj(f),u_velocity:new s.cj(f),u_boxSize:new s.cj(f),u_rainDropletSize:new s.ck(f),u_distortionStrength:new s.cj(f),u_rainDirection:new s.ci(f),u_color:new s.d3(f),u_screenSize:new s.ck(f),u_thinningCenterPos:new s.ck(f),u_thinningShape:new s.ci(f),u_thinningAffectedRatio:new s.cj(f),u_thinningParticleOffset:new s.cj(f),u_shapeDirectionalPower:new s.cj(f),u_shapeNormalPower:new s.cj(f),u_mode:new s.cj(f)}),vignette:f=>({u_vignetteShape:new s.ci(f),u_vignetteColor:new s.d3(f)}),occlusion:f=>({u_matrix:new s.cl(f),u_anchorPos:new s.ci(f),u_screenSizePx:new s.ck(f),u_occluderSizePx:new s.ck(f),u_color:new s.d3(f)})};class Ba{constructor(n,u,p,y){this.id=Ba.uniqueIdxCounter,Ba.uniqueIdxCounter++,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Ba.uniqueIdxCounter,Ba.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ba.uniqueIdxCounter=0;const wv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class u1{constructor(n,u,p,y,b,w){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=y,this.instanceCount=w,this.context=n;const E=n.gl;this.buffer=E.createBuffer(),n.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||b||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,u){for(let p=0;p<this.attributes.length;p++){const y=u.getAttributeLocation(n,this.attributes[p].name);y!==-1&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,u,p){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],w=u.getAttributeLocation(n,b.name);w!==-1&&n.vertexAttribPointer(w,b.components,n[wv[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,u,p){for(let y=0;y<this.attributes.length;y++){const b=u.getAttributeLocation(n,this.attributes[y].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xc{constructor(n,u,p,y,b){this.context=n,this.width=u,this.height=p;const w=this.framebuffer=n.gl.createFramebuffer();y>0&&(this.colorAttachment0=new Yd(n,w,0)),y>1&&(this.colorAttachment1=new Yd(n,w,1)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new ou(n,w):new bh(n,w))}createColorAttachment(n,u){u===0?this.colorAttachment0=new Yd(n,this.framebuffer,0):u===1&&(this.colorAttachment1=new Yd(n,this.framebuffer,1))}removeColorAttachment(n,u){const p=this.context.gl;let y;u===0?(y=this.colorAttachment0.get(),this.colorAttachment0=void 0):u===1&&(y=this.colorAttachment1.get(),this.colorAttachment1=void 0),y&&p.deleteTexture(y)}destroy(){const n=this.context.gl;if(this.colorAttachment0){const u=this.colorAttachment0.get();u&&n.deleteTexture(u)}if(this.colorAttachment1){const u=this.colorAttachment1.get();u&&n.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&n.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&n.deleteTexture(u)}n.deleteFramebuffer(this.framebuffer)}}class hf{constructor(n,u){this.gl=n,this.clearColor=new t1(this),this.clearDepth=new rv(this),this.clearStencil=new vm(this),this.colorMask=new Zd(this),this.depthMask=new xm(this),this.stencilMask=new gc(this),this.stencilFunc=new tu(this),this.stencilOp=new vh(this),this.stencilTest=new iu(this),this.depthRange=new ov(this),this.depthTest=new bm(this),this.depthFunc=new sv(this),this.blend=new nu(this),this.blendFunc=new Wd(this),this.blendColor=new qd(this),this.blendEquation=new wm(this),this.cullFace=new Xd(this),this.cullFaceSide=new xh(this),this.frontFace=new av(this),this.program=new lv(this),this.activeTexture=new cv(this),this.viewport=new ru(this),this.bindFramebuffer=new uv(this),this.bindRenderbuffer=new i1(this),this.bindTexture=new n1(this),this.bindVertexBuffer=new r1(this),this.bindElementBuffer=new Sm(this),this.bindVertexArrayOES=new Tm(this),this.pixelStoreUnpack=new Em(this),this.pixelStoreUnpackPremultiplyAlpha=new Im(this),this.pixelStoreUnpackFlipY=new hv(this),this.options=u?Object.assign({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=u&&!!u.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=n.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,u,p){return new Ba(this,n,u,p)}createVertexBuffer(n,u,p,y,b){return new u1(this,n,u,p,y,b)}createRenderbuffer(n,u,p){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,n,u,p),this.bindRenderbuffer.set(null),b}createFramebuffer(n,u,p,y){return new xc(this,n,u,p,y)}clear({color:n,depth:u,stencil:p,colorMask:y}){const b=this.gl;let w=0;n&&(w|=b.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),u!==void 0&&(w|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),p!==void 0&&(w|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(w)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){s.by(n.blendFunction,Ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Vt;function Bm(f,n,u,p,y,b,w){const E=f.context,I=E.gl,R=f.transform,L=[s.aF(R.center.lng),s.aJ(R.center.lat)],N=u.layout.get("symbol-placement"),B=u.layout.get("text-variable-anchor"),U=u.layout.get("icon-rotation-alignment")==="map",W=u.layout.get("text-rotation-alignment")==="map",G=N!=="point",X=[];let K=0,oe=0;for(let pe=0;pe<p.length;pe++){const he=p[pe],Se=n.getTile(he),ze=Se.getBucket(u);if(!ze)continue;const Le=ze.getProjection().createInversionMatrix(R,he.canonical),Ze=[],je=Gw(he,ze,R),tt=!w&&U&&G,dt=w&&W&&G,Fe=B&&ze.hasTextData(),Te=ze.hasIconTextFit()&&Fe&&ze.hasIconData(),Ke=tt||dt||w&&Fe||Te,We=ze.projection.name==="globe",ft=We?s.aj(R.zoom):0;We&&(Ze.push("PROJECTION_GLOBE_VIEW"),Ke&&Ze.push("PROJECTED_POS_ON_VIEWPORT"));const vt=f.getOrCreateProgram("collisionBox",{defines:Ze});let At=je;y[0]===0&&y[1]===0||(At=f.translatePosMatrix(je,Se,y,b));const xt=w?ze.textCollisionBox:ze.iconCollisionBox,wt=ze.collisionCircleArray;if(wt.length>0){const Gt=s.bC(),Lt=At;s.cP(Gt,ze.placementInvProjMatrix,R.glCoordMatrix),s.cP(Gt,Gt,ze.placementViewportMatrix),X.push({circleArray:wt,circleOffset:oe,transform:Lt,invTransform:Gt,projection:ze.getProjection()}),K+=wt.length/4,oe=K}if(!xt)continue;f.terrain&&f.terrain.setupElevationDraw(Se,vt);const qt=We?[he.canonical.x,he.canonical.y,1<<he.canonical.z]:[0,0,0];vt.draw(f,I.LINES,Kt.disabled,vi.disabled,f.colorModeForRenderPass(),di.disabled,Dm(At,Le,R,ft,L,Se,qt,ze.getProjection()),u.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,R.zoom,null,[xt.collisionVertexBuffer,xt.collisionVertexBufferExt])}if(!w||!X.length)return;const re=f.getOrCreateProgram("collisionCircle"),ne=new s.dZ;ne.resize(4*K),ne._trim();let be=0;for(const pe of X)for(let he=0;he<pe.circleArray.length/4;he++){const Se=4*he,ze=pe.circleArray[Se+0],Le=pe.circleArray[Se+1],Ze=pe.circleArray[Se+2],je=pe.circleArray[Se+3];ne.emplace(be++,ze,Le,Ze,je,0),ne.emplace(be++,ze,Le,Ze,je,1),ne.emplace(be++,ze,Le,Ze,je,2),ne.emplace(be++,ze,Le,Ze,je,3)}(!Vt||Vt.length<2*K)&&(Vt=(function(pe){const he=2*pe,Se=new s.b0;Se.resize(he),Se._trim();for(let ze=0;ze<he;ze++){const Le=6*ze;Se.uint16[Le+0]=4*ze+0,Se.uint16[Le+1]=4*ze+1,Se.uint16[Le+2]=4*ze+2,Se.uint16[Le+3]=4*ze+2,Se.uint16[Le+4]=4*ze+3,Se.uint16[Le+5]=4*ze+0}return Se})(K));const _e=E.createIndexBuffer(Vt,!0),ve=E.createVertexBuffer(ne,s.d_.members,!0);for(const pe of X){const he=sf(pe.transform,pe.invTransform,R,pe.projection);re.draw(f,I.TRIANGLES,Kt.disabled,vi.disabled,f.colorModeForRenderPass(),di.disabled,he,u.id,ve,_e,s.bg.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,R.zoom)}ve.destroy(),_e.destroy()}const ma=s.bC();function dl(f){const n=f._camera.getWorldToCamera(f.worldSize,1),u=s.aB([],n,f.globeMatrix);s.bl(u,u);const p=[0,0,0],y=[0,1,0,0];return s.aC(y,y,u),p[0]=y[0],p[1]=y[1],p[2]=y[2],s.aw(p,p),p}function Sv({width:f,height:n,anchor:u,textOffset:p,textScale:y},b){const{horizontalAlign:w,verticalAlign:E}=s.c1(u),I=-(w-.5)*f,R=-(E-.5)*n,L=s.c2(u,p);return new s.P((I/y+L[0])*b,(R/y+L[1])*b)}function Tv(f,n,u,p,y,b,w,E,I,R){const L=f.text.placedSymbolArray,N=f.text.dynamicLayoutVertexArray,B=f.icon.dynamicLayoutVertexArray,U={},W=f.getProjection(),G=qc(w,W,y),X=y.elevation,K=W.upVectorScale(w.canonical,y.center.lat,y.worldSize).metersToTile;N.clear();for(let oe=0;oe<L.length;oe++){const re=L.get(oe),{tileAnchorX:ne,tileAnchorY:be,numGlyphs:_e}=re,ve=re.hidden||!re.crossTileID||f.allowVerticalPlacement&&!re.placedOrientation?null:p[re.crossTileID];if(ve){let pe=0,he=0,Se=0;const ze=f.elevationType==="road";if(X||ze){const We=ze?f.getElevationFeatureForText(oe):null,ft=s.bV.getAtTileOffset(w,new s.P(ne,be),X,We),[vt,At,xt]=W.upVector(w.canonical,ne,be);pe=ft*vt*K,he=ft*At*K,Se=ft*xt*K}let[Le,Ze,je,tt]=ia(re.projectedAnchorX+pe,re.projectedAnchorY+he,re.projectedAnchorZ+Se,u?G:b);const dt=Ld(y.getCameraToCenterDistance(W),tt);let Fe=s.bM(f.textSizeData,I,re)*dt/s.bY;u&&(Fe*=f.tilePixelRatio/E);const Te=Sv(ve,Fe);u?({x:Le,y:Ze,z:je}=W.projectTilePoint(ne+Te.x,be+Te.y,w.canonical),[Le,Ze,je]=ia(Le+pe,Ze+he,je+Se,b)):(n&&Te._rotate(-y.angle),Le+=Te.x,Ze+=Te.y,je=0);const Ke=f.allowVerticalPlacement&&re.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let We=0;We<_e;We++)s.bO(N,Le,Ze,je,Ke);R&&re.associatedIconIndex>=0&&(U[re.associatedIconIndex]={x:Le,y:Ze,z:je,angle:Ke})}else Uo(_e,N)}if(R){B.clear();const oe=f.icon.placedSymbolArray;for(let re=0;re<oe.length;re++){const ne=oe.get(re),{numGlyphs:be}=ne,_e=U[re];if(ne.hidden||!_e)Uo(be,B);else{const{x:ve,y:pe,z:he,angle:Se}=_e;for(let ze=0;ze<be;ze++)s.bO(B,ve,pe,he,Se)}}f.icon.dynamicLayoutVertexBuffer.updateData(B)}f.text.dynamicLayoutVertexBuffer.updateData(N)}function df(f,n,u,p,y,b,w={}){const E=u.paint.get("icon-translate"),I=u.paint.get("text-translate"),R=u.paint.get("icon-translate-anchor"),L=u.paint.get("text-translate-anchor"),N=u.layout.get("icon-rotation-alignment"),B=u.layout.get("text-rotation-alignment"),U=u.layout.get("icon-pitch-alignment"),W=u.layout.get("text-pitch-alignment"),G=u.layout.get("icon-keep-upright"),X=u.layout.get("text-keep-upright"),K=u.paint.get("icon-color-saturation"),oe=u.paint.get("icon-color-contrast"),re=u.paint.get("icon-color-brightness-min"),ne=u.paint.get("icon-color-brightness-max"),be=u.layout.get("symbol-elevation-reference")==="sea",_e=u.layout.get("icon-image-use-theme")==="none",ve=f.context,pe=ve.gl,he=f.transform,Se=N==="map",ze=B==="map",Le=U==="map",Ze=W==="map",je=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let tt=!1;const dt=f.depthModeForSublayer(0,Kt.ReadOnly),Fe=new Kt(f.context.gl.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D),Te=[s.aF(he.center.lng),s.aJ(he.center.lat)],Ke=u.layout.get("text-variable-anchor"),We=he.projection.name==="globe",ft=[],vt=[0,-1,0];for(const At of p){const xt=n.getTile(At),wt=xt.getBucket(u);if(!wt||wt.projection.name==="mercator"&&We||wt.fullyClipped)continue;const qt=wt.projection.name==="globe",Gt=qt?s.aj(he.zoom):0,Lt=qc(At,wt.getProjection(),he),jt=he.calculatePixelsToTileUnitsMatrix(xt),oi=Ke&&wt.hasTextData(),fi=wt.hasIconTextFit()&&oi&&wt.hasIconData(),Bi=wt.getProjection().createInversionMatrix(he,At.canonical),Qi=(1<<xt.tileID.canonical.z)*s.al/f.transform.worldSize,Ti=_n=>{let Ji=[0,0,0];if(_n){const Fi=f.style.directionalLight,Nn=f.style.ambientLight;Fi&&Nn&&(Ji=ra(f.style,Fi,Nn))}return Ji},an=_n=>{he.depthOcclusionForSymbolsAndCircles&&(u.hasOcclusionOpacityProperties||f.terrain)&&(_n.push("DEPTH_D24"),_n.push("DEPTH_OCCLUSION"))},Ri=_n=>{u.lut&&!_e&&(u.lut.texture||(u.lut.texture=new s.d$(f.context,u.lut.image,[u.lut.image.height,u.lut.image.height,u.lut.image.height],ve.gl.RGBA8)),ve.activeTexture.set(ve.gl.TEXTURE0+10),u.lut.texture&&u.lut.texture.bind(ve.gl.LINEAR,ve.gl.CLAMP_TO_EDGE),_n.push("APPLY_LUT_ON_GPU"))},En=()=>{const _n=Se&&u.layout.get("symbol-placement")!=="point",Ji=[];an(Ji),Ri(Ji);const Fi=_n||fi,Nn=wt.elevationType==="road",hr=f.shadowRenderer,jn=Nn&&Le&&!!hr&&hr.enabled,qn=Ti(jn),Ho=Nn&&Le&&!f.terrain?Fe:dt,cs=u.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Le&&Ji.push("PITCH_WITH_MAP_TERRAIN"),qt&&(Ji.push("PROJECTION_GLOBE_VIEW"),Fi&&Ji.push("PROJECTED_POS_ON_VIEWPORT")),cs>0&&wt.hasAnySecondaryIcon&&Ji.push("ICON_TRANSITION"),!wt.icon.zOffsetVertexBuffer||Nn&&f.terrain||Ji.push("Z_OFFSET"),K===0&&oe===0&&re===0&&ne===1||Ji.push("COLOR_ADJUSTMENT"),wt.sdfIcons&&Ji.push("RENDER_SDF"),jn&&Ji.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Nn&&Le&&!f.terrain&&wt.icon.orientationVertexBuffer&&Ji.push("ELEVATED_ROADS");const oo=wt.icon.programConfigurations.get(u.id),yn=f.getOrCreateProgram("symbol",{config:oo,defines:Ji}),xs=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],Eo=wt.iconSizeData,Zo=s.bK(Eo,he.zoom),sa=Le||!he.isOrthographic,Wo=hc(Lt,xt.tileID.canonical,Le,Se,he,wt.getProjection(),jt),rr=ns(Lt,xt.tileID.canonical,Le,Se,he,wt.getProjection(),jt),Ir=f.translatePosMatrix(rr,xt,E,R,!0),Gn=f.translatePosMatrix(Lt,xt,E,R),Lr=Fi?ma:Wo,Io=Se&&!Le&&!_n;let br=vt;!We&&!he.mercatorFromTransition||Se||(br=dl(he));const bs=qt?br:vt,Gh=u.getColorAdjustmentMatrix(K,oe,re,ne),Va=Ih(Eo.kind,Zo,Io,Le,f,Gn,Lr,Ir,be,!1,xs,[0,0],0,At,Gt,Te,Bi,bs,wt.getProjection(),qn,Qi,Gh,cs,null),xu=xt.imageAtlasTexture?xt.imageAtlasTexture:null,bu=u.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear,ws=wt.sdfIcons||f.options.rotating||f.options.zooming||bu||sa?pe.LINEAR:pe.NEAREST,ja=wt.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,Ga=f.terrain&&Le&&_n?s.bl(s.bC(),Wo):ma;if(_n&&wt.icon){const js=s.bV.getAtTileOffsetFunc(At,he.center.lat,he.worldSize,wt.getProjection()),ml=ll(Lt,xt.tileID.canonical,Le,Se,he,wt.getProjection(),jt),Ec=u.layout.get("icon-size-scale-range"),If=s.aA(f.scaleFactor,Ec[0],Ec[1]);bn(wt,Lt,f,!1,ml,rr,Le,G,js,At,If)}return{program:yn,buffers:wt.icon,uniformValues:Va,atlasTexture:xu,atlasTextureIcon:null,atlasInterpolation:ws,atlasInterpolationIcon:null,isSDF:wt.sdfIcons,hasHalo:ja,depthMode:Ho,tile:xt,renderWithShadows:jn,labelPlaneMatrixInv:Ga}},wn=()=>{const _n=ze&&u.layout.get("symbol-placement")!=="point",Ji=[],Fi=_n||Ke||fi,Nn=wt.elevationType==="road",hr=f.shadowRenderer,jn=Nn&&Ze&&!!hr&&hr.enabled,qn=Ti(jn),Ho=Nn&&Ze&&!f.terrain?Fe:dt;f.terrainRenderModeElevated()&&Ze&&Ji.push("PITCH_WITH_MAP_TERRAIN"),qt&&(Ji.push("PROJECTION_GLOBE_VIEW"),Fi&&Ji.push("PROJECTED_POS_ON_VIEWPORT")),!wt.text.zOffsetVertexBuffer||Nn&&f.terrain||Ji.push("Z_OFFSET"),wt.iconsInText&&Ji.push("RENDER_TEXT_AND_SYMBOL"),Ji.push("RENDER_SDF"),jn&&Ji.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Nn&&Ze&&!f.terrain&&wt.text.orientationVertexBuffer&&Ji.push("ELEVATED_ROADS"),an(Ji);const cs=wt.text.programConfigurations.get(u.id),oo=f.getOrCreateProgram("symbol",{config:cs,defines:Ji});let yn,xs=[0,0],Eo=null;const Zo=wt.textSizeData;wt.iconsInText&&(xs=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],Eo=xt.imageAtlasTexture?xt.imageAtlasTexture:null,yn=Ze||!he.isOrthographic||f.options.rotating||f.options.zooming||Zo.kind==="composite"||Zo.kind==="camera"?pe.LINEAR:pe.NEAREST);const sa=xt.glyphAtlasTexture?xt.glyphAtlasTexture.size:[0,0],Wo=u.layout.get("text-size-scale-range"),rr=s.aA(f.scaleFactor,Wo[0],Wo[1]),Ir=s.bK(Zo,he.zoom,rr),Gn=hc(Lt,xt.tileID.canonical,Ze,ze,he,wt.getProjection(),jt),Lr=ns(Lt,xt.tileID.canonical,Ze,ze,he,wt.getProjection(),jt),Io=f.translatePosMatrix(Lr,xt,I,L,!0),br=f.translatePosMatrix(Lt,xt,I,L),bs=Fi?ma:Gn,Gh=ze&&!Ze&&!_n;let Va=vt;!We&&!he.mercatorFromTransition||ze||(Va=dl(he));const xu=Ih(Zo.kind,Ir,Gh,Ze,f,br,bs,Io,be,!0,sa,xs,0,At,Gt,Te,Bi,qt?Va:vt,wt.getProjection(),qn,Qi,null,null,rr),bu=xt.glyphAtlasTexture?xt.glyphAtlasTexture:null,ws=pe.LINEAR,ja=u.paint.get("text-halo-width").constantOr(1)!==0,Ga=f.terrain&&Ze&&_n?s.bl(s.bC(),Gn):ma;if(_n&&wt.text){const js=s.bV.getAtTileOffsetFunc(At,he.center.lat,he.worldSize,wt.getProjection()),ml=ll(Lt,xt.tileID.canonical,Ze,ze,he,wt.getProjection(),jt);bn(wt,Lt,f,!0,ml,Lr,Ze,X,js,At,rr)}return{program:oo,buffers:wt.text,uniformValues:xu,atlasTexture:bu,atlasTextureIcon:Eo,atlasInterpolation:ws,atlasInterpolationIcon:yn,isSDF:!0,hasHalo:ja,depthMode:Ho,tile:xt,renderWithShadows:jn,labelPlaneMatrixInv:Ga}},Mn=wt.icon.segments.get().length,en=wt.text.segments.get().length,Oi=Mn&&!w.onlyText?En():null,gn=en&&!w.onlyIcons?wn():null,tr=u.paint.get("icon-opacity").constantOr(1),ir=u.paint.get("text-opacity").constantOr(1);if(je&&wt.canOverlap){tt=!0;const _n=tr&&!w.onlyText?wt.icon.segments.get():[],Ji=ir&&!w.onlyIcons?wt.text.segments.get():[];for(const Fi of _n)ft.push({segments:new s.bg([Fi]),sortKey:Fi.sortKey,state:Oi});for(const Fi of Ji)ft.push({segments:new s.bg([Fi]),sortKey:Fi.sortKey,state:gn})}else w.onlyText||ft.push({segments:tr?wt.icon.segments:new s.bg([]),sortKey:0,state:Oi}),w.onlyIcons||ft.push({segments:ir?wt.text.segments:new s.bg([]),sortKey:0,state:gn})}tt&&ft.sort((At,xt)=>At.sortKey-xt.sortKey);for(const At of ft){const xt=At.state;if(xt)if(f.terrain?f.terrain.setupElevationDraw(xt.tile,xt.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:xt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,xt.program),ve.activeTexture.set(pe.TEXTURE0),xt.atlasTexture&&xt.atlasTexture.bind(xt.atlasInterpolation,pe.CLAMP_TO_EDGE,!0),xt.atlasTextureIcon&&(ve.activeTexture.set(pe.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,pe.CLAMP_TO_EDGE,!0)),xt.renderWithShadows&&f.shadowRenderer.setupShadows(xt.tile.tileID.toUnwrapped(),xt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,xt.program),xt.hasHalo){const wt=xt.uniformValues;wt.u_is_halo=1,ff(xt.buffers,At.segments,u,f,xt.program,xt.depthMode,y,b,wt,2),wt.u_is_halo=0}else{if(xt.isSDF){const wt=xt.uniformValues;xt.hasHalo&&(wt.u_is_halo=1,ff(xt.buffers,At.segments,u,f,xt.program,xt.depthMode,y,b,wt,1)),wt.u_is_halo=0}ff(xt.buffers,At.segments,u,f,xt.program,xt.depthMode,y,b,xt.uniformValues,1)}}}function ff(f,n,u,p,y,b,w,E,I,R){const L=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];y.draw(p,p.context.gl.TRIANGLES,b,w,E,di.disabled,I,u.id,f.layoutVertexBuffer,f.indexBuffer,n,u.paint,p.transform.zoom,f.programConfigurations.get(u.id),L,R)}function Nm(f,n){const u=1<<f.canonical.z,p=(n.x*u-f.canonical.x-f.wrap*u)*s.al,y=(n.y*u-f.canonical.y)*s.al,b=s.e8(n.z,n.y);return s.d5(p,y,b)}function Um(f,n,u,p,y){if(!u.layout||u.layout.get("fill-elevation-reference")==="none"||u.paint.get("fill-opacity").constantOr(1)===0)return;const b=f.context.gl,w=new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D),E=new Kt(f.context.gl.GREATER,Kt.ReadWrite,f.depthRangeFor3D),I=(function(U){let W=.01;return U.isOrthographic&&(W=s.ak(1e-4,W,s.d0(U.pitch>=Oa?1:U.pitch/Oa))),2*W})(f.transform),R=f.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",N=f.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),B=f.getOrCreateProgram(L);for(const U of p){const W=n.getTile(U),G=W.getBucket(u);if(!G)continue;const X=G.elevatedStructures;if(!X)continue;const K=G.elevationBufferData.heightRange,oe=Nm(U.toUnwrapped(),R),re=f.translatePosMatrix(U.projMatrix,W,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));let ne,be,_e,ve;if(y==="initialize"){if(!K||K.min>=1||X.depthSegments.segments[0].primitiveLength===0)continue;ne=yc(re,oe,I,1,0),be=w,_e=X.depthSegments,ve=N}else if(y==="reset"){if(!K||K.min>=0||X.maskSegments.segments[0].primitiveLength===0)continue;ne=yc(re,oe,0,0,1),be=E,_e=X.maskSegments,ve=N}else if(y==="geometry"){if(X.depthSegments.segments[0].primitiveLength===0)continue;ne=yc(re,oe,I,1,0),be=w,_e=X.depthSegments,ve=B}ve.draw(f,b.TRIANGLES,be,vi.disabled,Ii.disabled,di.disabled,ne,u.id,X.vertexBuffer,X.indexBuffer,_e,u.paint,f.transform.zoom)}}function cu(f,n,u,p){const{painter:y,sourceCache:b,layer:w,coords:E,colorMode:I,elevationType:R,terrainEnabled:L,pass:N}=f,B=y.context.gl,U=w.paint.get("fill-pattern"),W=w.paint.get("fill-pattern-cross-fade"),G=U.constantOr(null);let X=R;R!=="road"||n&&!L||(X="none");const K=X==="road",oe=f.painter.shadowRenderer,re=K&&!!oe&&oe.enabled,ne=new Kt(y.context.gl.LEQUAL,Kt.ReadOnly,y.depthRangeFor3D);let be=[0,0,0];if(re){const he=y.style.directionalLight,Se=y.style.ambientLight;he&&Se&&(be=ra(y.style,he,Se))}const _e=U&&U.constantOr(1),ve=y.terrain&&y.terrain.renderingToTexture,pe=(he,Se)=>{let ze,Le,Ze,je,tt;Se?(ze=_e&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ze=B.LINES):(ze=_e?"fillPattern":"fill",Ze=B.TRIANGLES);for(const dt of E){const Fe=b.getTile(dt);if(_e&&!Fe.patternsLoaded())continue;const Te=Fe.getBucket(w);if(!Te)continue;const Ke=n?Te.elevationBufferData:Te.bufferData;if(Ke.isEmpty())continue;y.prepareDrawTile();const We=Ke.programConfigurations.get(w.id),ft=y.isTileAffectedByFog(dt),vt=[],At=[];K&&(vt.push("ELEVATED_ROADS"),At.push(Ke.elevatedLayoutVertexBuffer)),re&&vt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ve&&u&&vt.push("USE_MRT1"),_e&&(y.context.activeTexture.set(B.TEXTURE0),Fe.imageAtlasTexture&&Fe.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),We.updatePaintBuffers());let xt=!1;if(G&&Fe.imageAtlas){const jt=Fe.imageAtlas,oi=s.e3.from(G),fi=oi.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Bi=oi.getSecondary(),Qi=jt.patternPositions.get(fi),Ti=Bi?jt.patternPositions.get(Bi.scaleSelf(s.o.devicePixelRatio).toString()):null;xt=!!Qi&&!!Ti,Qi&&We.setConstantPatternPositions(Qi,Ti)}W>0&&(xt||We.getPatternTransitionVertexBuffer("fill-pattern"))&&vt.push("FILL_PATTERN_TRANSITION");const wt=y.getOrCreateProgram(ze,{config:We,overrideFog:ft,defines:vt}),qt=y.translatePosMatrix(dt.projMatrix,Fe,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));re&&oe.setupShadows(Fe.tileID.toUnwrapped(),wt,"vector-tile");const Gt=w.paint.get("fill-emissive-strength");if(Se){je=Ke.lineIndexBuffer,tt=Ke.lineSegments;const jt=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];Le=ze==="fillOutlinePattern"&&_e?_v(qt,Gt,y,Fe,jt,be,W):gv(qt,Gt,jt,be)}else je=Ke.indexBuffer,tt=Ke.triangleSegments,Le=_e?Rm(qt,Gt,y,Fe,be,W):_c(qt,Gt,be);y.uploadCommonUniforms(y.context,wt,dt.toUnwrapped());let Lt=he;(R==="road"&&!L||R==="offset")&&(Lt=ne),wt.draw(y,Ze,Lt,p||y.stencilModeForClipping(dt),I,di.disabled,Le,w.id,Ke.layoutVertexBuffer,je,tt,w.paint,y.transform.zoom,We,At)}};y.renderPass===N&&pe(y.depthModeForSublayer(1,y.renderPass==="opaque"?Kt.ReadWrite:Kt.ReadOnly),!1),X==="none"&&y.renderPass==="translucent"&&w.paint.get("fill-antialias")&&pe(y.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly),!0)}function uu(f,n,u,p,y,b,w,E){u.resetLayerRenderingStats(f);const I=f.context,R=I.gl,L=f.transform,N=u.paint.get("fill-extrusion-pattern"),B=u.paint.get("fill-extrusion-pattern-cross-fade"),U=N.constantOr(null),W=N.constantOr(1),G=u.paint.get("fill-extrusion-opacity"),X=f.style.enable3dLights(),K=u.paint.get(X&&!W?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),oe=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],re=u.layout.get("fill-extrusion-edge-radius"),ne=re>0&&!u.paint.get("fill-extrusion-rounded-roof"),be=ne?0:re,_e=L.projection.name==="globe"?s.eb():0,ve=L.projection.name==="globe",pe=ve?s.aj(L.zoom):0,he=[s.aF(L.center.lng),s.aJ(L.center.lat)],Se=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ze=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Se?null:u.lut).toArray01().slice(0,3),Le=u.paint.get("fill-extrusion-flood-light-intensity"),Ze=u.paint.get("fill-extrusion-vertical-scale"),je=u.paint.get("fill-extrusion-line-width").constantOr(1)!==0,tt=u.paint.get("fill-extrusion-height-alignment"),dt=u.paint.get("fill-extrusion-base-alignment"),Fe=na(f,u.paint.get("fill-extrusion-cutoff-fade-range")),Te=[];let Ke;ve&&Te.push("PROJECTION_GLOBE_VIEW"),oe[0]>0&&Te.push("FAUX_AO"),ne&&Te.push("ZERO_ROOF_RADIUS"),E&&Te.push("HAS_CENTROID"),Le>0&&Te.push("FLOOD_LIGHT"),Fe.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),je&&Te.push("RENDER_WALL_MODE");const We=f.renderPass==="shadow",ft=f.shadowRenderer,vt=We&&!!ft,At=We?di.disabled:di.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let xt=[0,0,0];if(ft){const Gt=f.style.directionalLight,Lt=f.style.ambientLight;Gt&&Lt&&(xt=ra(f.style,Gt,Lt)),We||(Te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ft.useNormalOffset&&Te.push("NORMAL_OFFSET")),Ke=Te.concat(["SHADOWS_SINGLE_CASCADE"])}const wt=vt?"fillExtrusionDepth":W?"fillExtrusionPattern":"fillExtrusion",qt=u.getLayerRenderingStats();for(const Gt of p){const Lt=n.getTile(Gt),jt=Lt.getBucket(u);if(!jt||jt.projection.name!==L.projection.name)continue;let oi=!1;ft&&(oi=ft.getMaxCascadeForTile(Gt.toUnwrapped())===0);const fi=f.isTileAffectedByFog(Gt),Bi=jt.programConfigurations.get(u.id);let Qi=!1;if(U&&Lt.imageAtlas){const en=Lt.imageAtlas,Oi=s.e3.from(U),gn=Oi.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),tr=Oi.getSecondary(),ir=en.patternPositions.get(gn),_n=tr?en.patternPositions.get(tr.scaleSelf(s.o.devicePixelRatio).toString()):null;Qi=!!ir&&!!_n,ir&&Bi.setConstantPatternPositions(ir,_n)}B>0&&(Qi||Bi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Te.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ti=f.getOrCreateProgram(wt,{config:Bi,defines:oi?Ke:Te,overrideFog:fi});if(f.terrain&&f.terrain.setupElevationDraw(Lt,Ti,{useMeterToDem:!0}),!jt.centroidVertexBuffer){const en=Ti.getAttributeLocation(R,"a_centroid_pos");en!==-1&&R.vertexAttrib2f(en,0,0)}!We&&ft&&ft.setupShadows(Lt.tileID.toUnwrapped(),Ti,"vector-tile"),W&&(f.context.activeTexture.set(R.TEXTURE0),Lt.imageAtlasTexture&&Lt.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Bi.updatePaintBuffers());const an=u.paint.get("fill-extrusion-vertical-gradient"),Ri=1/jt.tileToMeter;let En;if(We&&ft){if($m(Lt.tileID,jt.maxHeight,f))continue;const en=ft.calculateShadowPassMatrixFromTile(Lt.tileID.toUnwrapped());En=Cm(en,be,Ri,Ze,tt,dt)}else{const en=f.translatePosMatrix(Gt.expandedProjMatrix,Lt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Oi=L.projection.createInversionMatrix(L,Gt.canonical);En=W?mv(en,f,an,G,oe,be,Ri,Gt,Lt,_e,tt,dt,pe,he,Oi,ze,Ze,B):rf(en,f,an,G,oe,be,Ri,Gt,_e,tt,dt,pe,he,Oi,ze,Ze,Le,xt)}f.uploadCommonUniforms(I,Ti,Gt.toUnwrapped(),null,Fe);let wn=jt.segments;if(L.projection.name==="mercator"&&!We&&(wn=jt.getVisibleSegments(Lt.tileID,f.terrain,f.transform.getFrustum(0)),!wn.get().length))continue;if(qt)if(We)for(const en of wn.get())qt.numRenderedVerticesInShadowPass+=en.primitiveLength;else for(const en of wn.get())qt.numRenderedVerticesInTransparentPass+=en.primitiveLength;const Mn=[];(f.terrain||E)&&Mn.push(jt.centroidVertexBuffer),ve&&Mn.push(jt.layoutVertexExtBuffer),je&&Mn.push(jt.wallVertexBuffer),Ti.draw(f,I.gl.TRIANGLES,y,b,w,At,En,u.id,jt.layoutVertexBuffer,jt.indexBuffer,wn,u.paint,f.transform.zoom,Bi,Mn)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class Ph{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Na(f,n,u,p,y,b,w,E,I,R,L,N,B,U,W,G,X,K,oe,re){const ne=n.context,be=ne.gl,_e=n.transform,ve=n.transform.zoom,pe=[],he=f.translate,Se=f.translateAnchor,ze=f.edgeRadius,Le=na(n,f.cutoffFadeRange);L==="clear"?(pe.push("CLEAR_SUBPASS"),re&&(pe.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(be.TEXTURE0),re.bind(be.LINEAR,be.CLAMP_TO_EDGE))):L==="sdf"?pe.push("SDF_SUBPASS"):L==="emissive"&&(pe.push("USE_MRT1"),ne.activeTexture.set(be.TEXTURE0),re.bind(be.LINEAR,be.CLAMP_TO_EDGE)),K&&pe.push("HAS_CENTROID"),Le.shouldRenderCutoff&&pe.push("RENDER_CUTOFF");const Ze=(je,tt,dt,Fe,Te)=>{let Ke=pe;tt.groundRadiusBuffer!=null&&(Ke=pe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const We=tt.programConfigurations.get(p.id),ft=n.isTileAffectedByFog(je),vt=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:We,defines:Ke,overrideFog:ft}),At=((wt,qt,Gt,Lt,jt,oi,fi,Bi,Qi,Ti,an)=>({u_matrix:qt,u_opacity:Gt,u_ao_pass:Lt?1:0,u_meter_to_tile:jt,u_ao:oi,u_flood_light_intensity:fi,u_flood_light_color:Bi,u_attenuation:Qi,u_edge_radius:Ti,u_fb:0,u_fb_size:an,u_dynamic_offset:1}))(0,Fe,N,R,Te,[B,U*Te],W,G,X,ve>=17?0:ze*Te,re?re.size[0]:0),xt=[];K&&xt.push(tt.hiddenByLandmarkVertexBuffer),tt.groundRadiusBuffer!=null&&xt.push(tt.groundRadiusBuffer),n.uploadCommonUniforms(ne,vt,je.toUnwrapped(),null,Le),vt.draw(n,ne.gl.TRIANGLES,b,w,E,I,At,p.id,tt.vertexBuffer,tt.indexBuffer,dt,p.paint,ve,We,xt)};for(const je of y){const tt=u.getTile(je),dt=tt.getBucket(p);if(!dt||dt.projection.name!==_e.projection.name||!dt.groundEffect||dt.groundEffect&&!dt.groundEffect.hasData())continue;const Fe=dt.groundEffect,Te=1/dt.tileToMeter;{const Ke=n.translatePosMatrix(je.projMatrix,tt,he,Se),We=Fe.getDefaultSegment();Ze(je,Fe,We,Ke,Te)}if(oe)for(let Ke=0;Ke<4;Ke++){const We=s.e9[Ke](je),ft=u.getTile(We);if(!ft)continue;const vt=ft.getBucket(p);if(!vt||vt.projection.name!==_e.projection.name||!vt.groundEffect||vt.groundEffect&&!vt.groundEffect.hasData())continue;const At=vt.groundEffect;let xt,wt;Ke===0?(xt=[-s.al,0,0],wt=1):Ke===1?(xt=[s.al,0,0],wt=0):Ke===2?(xt=[0,-s.al,0],wt=3):(xt=[0,s.al,0],wt=2);const qt=At.regionSegments[wt];if(!qt)continue;const Gt=new Float32Array(16);s.br(Gt,je.projMatrix,xt),Ze(je,At,qt,n.translatePosMatrix(Gt,tt,he,Se),Te)}}}function Ev(f,n,u,p,y,b,w){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const E=b?b.findDEMTileFor(u):null;if(!(E&&E.dem||w))return;b&&E&&E.dem&&p.selfDEMTileTimestamp!==E.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=E.dem._timestamp);const I=(X,K)=>{(X.flags|K.flags)&s.ec?(X.flags|=s.ec,K.flags|=s.ec):(X.flags&=~s.ec,K.flags&=~s.ec)},R=X=>new s.P(Math.ceil((X+s.ed)*s.ee),0),L=X=>{const K=n.getSource().minzoom,oe=ne=>{const be=n.getTileByID(ne);if(be&&be.hasData())return be.getBucket(y)},re=[0,-1,1];for(const ne of re){if(X.overscaledZ+ne<K)continue;const be=oe(X.calculateScaledKey(X.overscaledZ+ne));if(be)return be}},N=[0,0,0],B=(X,K)=>(N[0]=Math.min(X.min.y,K.min.y),N[1]=Math.max(X.max.y,K.max.y),N[2]=s.al-K.min.x>X.max.x?K.min.x-s.al:X.max.x,N),U=(X,K)=>(N[0]=Math.min(X.min.x,K.min.x),N[1]=Math.max(X.max.x,K.max.x),N[2]=s.al-K.min.y>X.max.y?K.min.y-s.al:X.max.y,N),W=[(X,K)=>B(X,K),(X,K)=>B(K,X),(X,K)=>U(X,K),(X,K)=>U(K,X)],G=(X,K,oe,re,ne,be,_e)=>{if(!b)return 0;const ve=[[be?oe:X,be?X:oe,0],[be?oe:K,be?K:oe,0]],pe=_e<0?s.al+_e:_e,he=[be?pe:(X+K)/2,be?(X+K)/2:pe,0];return oe===0&&_e<0||oe!==0&&_e>0?b.getForTilePoints(ne,[he],!0,re):ve.push(he),b.getForTilePoints(u,ve,!0,E),Math.max(ve[0][2],ve[1][2],he[2])/b.exaggeration()};for(let X=0;X<4;X++){const K=p.borderFeatureIndices[X];if(K.length===0)continue;const oe=s.e9[X](u),re=L(oe);if(!(re&&re instanceof s.ea))continue;const ne=b?b.findDEMTileFor(oe):null;if(!(ne&&ne.dem||w)||(b&&ne&&ne.dem&&p.borderDEMTileTimestamp[X]!==ne.dem._timestamp&&(p.borderDoneWithNeighborZ[X]=-1,p.borderDEMTileTimestamp[X]=ne.dem._timestamp),p.borderDoneWithNeighborZ[X]===re.canonical.z))continue;re.centroidVertexArray.length===0&&re.createCentroidsBuffer();const be=(X<2?1:5)-X,_e=re.borderDoneWithNeighborZ[be]!==p.canonical.z,ve=re.borderFeatureIndices[be];let pe=0;if(p.canonical.z!==re.canonical.z){for(const he of K)p.showCentroid(p.featuresOnBorder[he]);if(_e)for(const he of ve)re.showCentroid(re.featuresOnBorder[he]);p.borderDoneWithNeighborZ[X]=re.canonical.z,re.borderDoneWithNeighborZ[be]=p.canonical.z}for(const he of K){const Se=p.featuresOnBorder[he],ze=p.centroidData[Se.centroidDataIndex],Le=Se.borders[X];let Ze;for(;pe<ve.length;){Ze=re.featuresOnBorder[ve[pe]];const je=Ze.borders[be];if(je[1]>Le[0]+3||je[0]>Le[0]-3)break;re.showCentroid(Ze),pe++}if(Ze&&pe<ve.length){const je=pe;let tt=0;for(;!(Ze.borders[be][0]>Le[1]-3)&&(tt++,++pe!==ve.length);)Ze=re.featuresOnBorder[ve[pe]];Ze=re.featuresOnBorder[ve[je]];let dt=!1;if(tt>=1){const Ke=Ze.borders[be];Math.abs(Le[0]-Ke[0])<3&&Math.abs(Le[1]-Ke[1])<3&&(tt=1,dt=!0,pe=je+1)}else if(tt===0){p.showCentroid(Se);continue}const Fe=re.centroidData[Ze.centroidDataIndex];w&&dt&&I(ze,Fe);const Te=Se.intersectsCount()>1||Ze.intersectsCount()>1;if(tt>1)pe=je,ze.centroidXY=Fe.centroidXY=new s.P(0,0);else if(ne&&ne.dem&&!Te){const Ke=W[X](ze,Fe),We=X%2?s.al-1:0,ft=G(Ke[0],Math.min(s.al-1,Ke[1]),We,ne,oe,X<2,Ke[2]);ze.centroidXY=Fe.centroidXY=R(ft)}else Te?ze.centroidXY=Fe.centroidXY=new s.P(0,0):(ze.centroidXY=p.encodeBorderCentroid(Se),Fe.centroidXY=re.encodeBorderCentroid(Ze));p.writeCentroidToBuffer(ze),re.writeCentroidToBuffer(Fe)}else p.showCentroid(Se)}p.borderDoneWithNeighborZ[X]=re.canonical.z,re.borderDoneWithNeighborZ[be]=p.canonical.z}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Iv=[1,0,0],Mv=[0,1,0],Av=[0,0,1];function $m(f,n,u){const p=u.transform,y=u.shadowRenderer;if(!y)return!0;const b=f.toUnwrapped(),w=p.tileSize*y._cascades[u.currentShadowCascade].scale;let E=n;if(p.elevation){const G=p.elevation.getMinMaxForTile(f);G&&(E+=G.max)}const I=[...y.shadowDirection];I[2]=-I[2];const R=y.computeSimplifiedTileShadowVolume(b,E,w,I);if(!R)return!1;const L=[Iv,Mv,Av,I,[I[0],0,I[2]],[0,I[1],I[2]]],N=p.projection.name==="globe",B=p.scaleZoom(w),U=s.cB.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,B,!N),W=y.getCurrentCascadeFrustum();return U.intersectsPrecise(R.vertices,R.planes,L)===0||W.intersectsPrecise(R.vertices,R.planes,L)===0}function hu(f){const{painter:n,source:u,layer:p,coords:y}=f;let b=f.defines;const w=n.context,E=n.renderPass==="shadow",I=n.renderPass==="light-beam",R=n.shadowRenderer,L=s.ef(n.transform.center.lat,n.transform.zoom),N=na(n,p.paint.get("building-cutoff-fade-range"));N.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const B of y){const U=u.getTile(B),W=U.getBucket(p);if(!W)continue;R&&R.getMaxCascadeForTile(B.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const G=W.programConfigurations.get(p.id);let X,K,oe,re=n.translatePosMatrix(B.expandedProjMatrix,U,[0,0],"map");if(re=s.cS(s.bC(),re,[1,1,f.verticalScale]),E&&R){if($m(U.tileID,W.maxHeight*L,n))continue;let be=R.calculateShadowPassMatrixFromTile(U.tileID.toUnwrapped());be=s.cS(s.bC(),be,[1,1,f.verticalScale]),oe=Gl(be),X=K=n.getOrCreateProgram("buildingDepth",{config:G,defines:b,overrideFog:!1})}else if(I)X=K=n.getOrCreateProgram("buildingBloom",{config:G,defines:b,overrideFog:!1}),oe=yv(re);else{const be=n.transform.calculatePosMatrix(B.toUnwrapped(),n.transform.worldSize);s.cS(be,be,[1,1,f.verticalScale]);const _e=s.bC();s.cS(_e,be,[1,-1,1/L]),s.bl(_e,_e),s.eg(_e,_e);const ve=n.transform.getFreeCameraOptions().position,pe=1<<B.canonical.z;if(oe=of(re,_e,f.opacity,f.facadeAOIntensity,[((ve.x-B.wrap)*pe-B.canonical.x)*s.al,(ve.y*pe-B.canonical.y)*s.al,ve.z*pe*s.al],W.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),K=n.getOrCreateProgram("building",{config:G,defines:b,overrideFog:!1}),f.depthOnly===!0)X=K;else{const he=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);X=n.getOrCreateProgram("building",{config:G,defines:he,overrideFog:!1})}R&&(R.setupShadowsFromMatrix(be,K,!0),X!==K&&R.setupShadowsFromMatrix(be,X,!0))}const ne=(be,_e)=>{if(I){const ve=be.entranceBloom;_e.draw(n,w.gl.TRIANGLES,f.depthMode,vi.disabled,f.blendMode,di.disabled,oe,p.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segmentsBucket,p.paint,n.transform.zoom,G,[ve.layoutAttenuationBuffer,ve.layoutColorBuffer])}else{const ve=be.segmentsBucket;let pe=[be.layoutNormalBuffer,be.layoutCentroidBuffer,be.layoutColorBuffer,be.layoutFloodLightDataBuffer];be.layoutFacadePaintBuffer&&(pe=pe.concat([be.layoutFacadeDataBuffer,be.layoutFacadeVerticalRangeBuffer,be.layoutFacadePaintBuffer])),_e.draw(n,w.gl.TRIANGLES,f.depthMode,vi.disabled,f.blendMode,E?di.disabled:di.backCW,oe,p.id,be.layoutVertexBuffer,be.indexBuffer,ve,p.paint,n.transform.zoom,G,pe)}};n.uploadCommonUniforms(w,K,B.toUnwrapped(),null,N),W.buildingWithoutFacade&&ne(W.buildingWithoutFacade,K),W.buildingWithFacade&&(X!==K&&n.uploadCommonUniforms(w,X,B.toUnwrapped(),null,N),ne(W.buildingWithFacade,X))}}function pf(f,n,u,p,y,b,w,E,I,R,L,N,B){const U=f.context.gl,W=f.depthModeForSublayer(1,Kt.ReadOnly,U.LEQUAL,!0),G=.1*(1-(X=L))+3*X;var X;const K=f._showOverdrawInspector,oe=N,re=new Ph;K||Na(re,f,n,u,p,W,new vi({func:U.ALWAYS,mask:255},255,255,U.KEEP,U.KEEP,U.REPLACE),new Ii([U.ONE,U.ONE,U.ONE,U.ONE],s.ao.transparent,[!1,!1,!1,!0],U.MIN),di.disabled,y,"sdf",b,w,E,I,R,G,oe,!1);{const ne=K?vi.disabled:new vi({func:U.EQUAL,mask:255},255,255,U.KEEP,U.DECR,U.DECR),be=K?f.colorModeForRenderPass():new Ii([U.ONE_MINUS_DST_ALPHA,U.DST_ALPHA,U.ONE,U.ONE],s.ao.transparent,[!0,!0,!0,!0]);Na(re,f,n,u,p,W,ne,be,di.disabled,y,"color",b,w,E,I,R,G,oe,!1)}}function Vm(f){return[f[0]*s.eh,f[1]*s.eh,f[2]*s.eh,0]}function mf(f,n,u,p,y,b,w,E,I){const R=p.getSource(),L=u.globeSharedBuffers;if(!L)return;let N,B,U;if(n&&(N=p.getTile(n)),R instanceof s.aU?(B=R.texture,U=s.dK(0,0,u.transform)):N&&n&&(B=N.texture,U=s.dK(n.canonical.z,n.canonical.x,u.transform)),!B||!U)return;f||(U=s.cS(s.bC(),U,[1,-1,1]));const W=u.context,G=W.gl,X=y.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,K=u.colorModeForDrapableLayerRenderPass(b),oe=w.defines;oe.push("GLOBE_POLES");const re=new Kt(G.LEQUAL,Kt.ReadWrite,u.depthRangeFor3D),ne=Float32Array.from(u.transform.expandedFarZProjMatrix),be=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),W.activeTexture.set(G.TEXTURE0),B.bind(X,G.CLAMP_TO_EDGE),W.activeTexture.set(G.TEXTURE1),B.bind(X,G.CLAMP_TO_EDGE),"useMipmap"in B&&W.extTextureFilterAnisotropic&&u.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const[_e,ve,pe,he]=n?L.getPoleBuffers(n.canonical.z,!1):L.getPoleBuffers(0,!0),Se=y.paint.get("raster-elevation");let ze;f?(ze=_e,u.renderDefaultNorthPole=Se!==0):(ze=ve,u.renderDefaultSouthPole=Se!==0);const Le=Vm(w.mix),Ze=((tt,dt,Fe,Te,Ke,We,ft,vt,At,xt,wt,qt,Gt)=>Fm(tt,dt,Fe,new Float32Array(16),new Float32Array(9),[0,0],Te,[0,0],[0,0,0,0],1,{opacity:1,mix:0},We,[0,0],vt,2,xt,wt,qt,1,0,Gt))(ne,be,U,s.aj(u.transform.zoom),0,y,0,Se,0,Le,w.offset,w.range,b),je=u.getOrCreateProgram("raster",{defines:oe});u.uploadCommonUniforms(W,je,null),je.draw(u,G.TRIANGLES,re,I,K,E,Ze,y.id,ze,pe,he)}function Pv(f){if(f.isOrthographic)return[0,0,0,0];const n=f._nearZ,u=f.projection.farthestPixelDistance(f),p=u-n,y=.2*f.height,b=n+y;return[n,u,(b-y-n)/p,(b-n)/p]}function zv(f,n,u,p){if(f)return n instanceof No&&f instanceof zd?n.getTextureDescriptor(f,u,!0):{texture:f.texture,mix:Vm(p.mix),offset:p.offset,buffer:0,tileSize:1}}var jm=s.ei([{name:"a_index",type:"Int16",components:1}]);class Cv{constructor(n,u,p,y){const b={width:p[0],height:p[1],data:null},w=n.gl;this.targetColorTexture=new s.T(n,b,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,b,w.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(u,y),this.lastInvalidatedAt=0}updateParticleTexture(n,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,y=u.width*u.height;this.particleTexture0=new s.T(this.context,u,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,u,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new s.ej;b.reserve(y);for(let w=0;w<y;w++)b.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(b,jm.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Gm(f,n,u){if(!f)return null;const p=n.getTextureDescriptor(f,u,!0);if(!p)return null;let{texture:y,mix:b,offset:w,tileSize:E,buffer:I,format:R}=p;if(!y||!R)return null;let L=!1;return R==="uint32"&&(L=!0,b[3]=0,b=af(s.ek,b,[0,u.paint.get("raster-particle-max-speed")]),w=xv(s.ek,w,[0,u.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[I/(E+2*I),E/(E+2*I)],tileSize:E,scalarData:L,scale:b,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function Rv(f){const n=f._nearZ,u=f.projection.farthestPixelDistance(f),p=u-n,y=.2*f.height,b=n+y;return[n,u,(b-y-n)/p,(b-n)/p]}const Hm=new s.ao(1,0,0,1),Zm=new s.ao(0,1,0,1),Wm=new s.ao(0,0,1,1),h1=new s.ao(1,0,1,1),d1=new s.ao(0,1,1,1);function Lv(f,n,u,p,y,b){for(let w=0;w<u.length;w++)if(y){const R=new s.ao(p.r*.8,p.g*.8,p.b*.8,1);Zl(f,n,u[w],p,-1,-1,b),Zl(f,n,u[w],p,-1,1,b),Zl(f,n,u[w],p,1,1,b),Zl(f,n,u[w],p,1,-1,b),Zl(f,n,u[w],R,0,0,b)}else Zl(f,n,u[w],p,0,0,b)}function Zl(f,n,u,p,y,b,w){const E=f.context,I=f.transform,R=E.gl,L=I.projection.name==="globe",N=L?["PROJECTION_GLOBE_VIEW"]:[];let B=s.bz(u.projMatrix);if(L&&s.aj(I.zoom)>0){const Le=s.bj(u.canonical,I),Ze=s.el(Le);B=s.aB(new Float32Array(16),I.globeMatrix,Ze),s.aB(B,I.projMatrix,B)}const U=s.bC();U[12]+=2*y/(s.o.devicePixelRatio*I.width),U[13]+=2*b/(s.o.devicePixelRatio*I.height),s.aB(B,U,B);const W=f.getOrCreateProgram("debug",{defines:N}),G=n.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(G,W);const X=Kt.disabled,K=vi.disabled,oe=f.colorModeForRenderPass(),re="$debug";E.activeTexture.set(R.TEXTURE0),f.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),L?G._makeGlobeTileDebugBuffers(f.context,I):G._makeDebugTileBoundsBuffers(f.context,I.projection);const ne=G._tileDebugBuffer||f.debugBuffer,be=G._tileDebugIndexBuffer||f.debugIndexBuffer,_e=G._tileDebugSegments||f.debugSegments;if(W.draw(f,R.LINE_STRIP,X,K,oe,di.disabled,km(B,p.toPremultipliedRenderColor(null)),re,ne,be,_e,null,null,null,[G._globeTileDebugBorderBuffer]),w){const Le=G.latestRawTileData,Ze=Math.floor((Le&&Le.byteLength||0)/1024);let je=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(je+=` => ${u.overscaledZ}`),je+=` ${G.state}`,je+=` ${Ze}kb`,(function(tt,dt){tt.initDebugOverlayCanvas();const Fe=tt.debugOverlayCanvas,Te=tt.context.gl,Ke=tt.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Fe.width,Fe.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(dt,5,5),Ke.strokeText(dt,5,5),tt.debugOverlayTexture.update(Fe),tt.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)})(f,je)}const ve=n.getTile(u).tileSize,pe=512/Math.min(ve,512)*(u.overscaledZ/I.zoom)*.5,he=G._tileDebugTextBuffer||f.debugBuffer,Se=G._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,ze=G._tileDebugTextSegments||f.debugSegments;W.draw(f,R.TRIANGLES,X,K,Ii.alphaBlended,di.disabled,km(B,s.ao.transparent.toPremultipliedRenderColor(null),pe),re,he,Se,ze,null,null,null,[G._globeTileDebugTextBuffer])}function Dv(f,n,u,p){gf(f,0,n+u/2,f.transform.width,u,p)}function qm(f,n,u,p){gf(f,n-u/2,0,u,f.transform.height,p)}function gf(f,n,u,p,y,b){const w=f.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(n*s.o.devicePixelRatio,u*s.o.devicePixelRatio,p*s.o.devicePixelRatio,y*s.o.devicePixelRatio),w.clear({color:b}),E.disable(E.SCISSOR_TEST)}const kv=s.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:f1}=kv;function Wl(f,n,u,p){f.emplaceBack(n,u,p)}class ls{constructor(n){this.vertexArray=new s.em,this.indices=new s.b0,Wl(this.vertexArray,-1,-1,1),Wl(this.vertexArray,1,-1,1),Wl(this.vertexArray,-1,1,1),Wl(this.vertexArray,1,1,1),Wl(this.vertexArray,-1,-1,-1),Wl(this.vertexArray,1,-1,-1),Wl(this.vertexArray,-1,1,-1),Wl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,f1),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function ql(f,n,u,p,y,b){const w=f.context.gl,E=n.paint.get("sky-atmosphere-color"),I=n.paint.get("sky-atmosphere-halo-color"),R=n.paint.get("sky-atmosphere-sun-intensity"),L=((N,B,U,W,G)=>({u_matrix_3f:N,u_sun_direction:B,u_sun_intensity:U,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(s.eo(s.dO(),p),y,R,E.toPremultipliedRenderColor(null),I.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),u.draw(f,w.TRIANGLES,Kt.disabled,vi.disabled,Ii.unblended,di.frontCW,L,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Vo=s.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xl{constructor(n){const u=new s.ep;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const p=new s.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(u,Vo.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ov=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Xm{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Jm{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Ii([1,Fl,1,Fl],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ii([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new Xm,this.updateNeeded=!0}update(n){const u=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Xl(u);const p=this.params.sizeRange,y=this.params.intensityRange,b=(function(L){const N=s.eq(30),B=[];for(let U=0;U<L;++U){const W=2*Math.PI*N(),G=Math.acos(1-2*N())-.5*Math.PI;B.push(s.d5(Math.cos(G)*Math.cos(W),Math.cos(G)*Math.sin(W),Math.sin(G)))}return B})(this.params.starsCount),w=s.eq(300),E=new s.er,I=new s.b0;let R=0;for(let L=0;L<b.length;++L){const N=s.c5([],b[L],200),B=Math.max(0,1+.01*p*(1*w()-.5)),U=Math.max(0,1+.01*y*(1*w()-.5));E.emplaceBack(N[0],N[1],N[2],-1,-1,B,U),E.emplaceBack(N[0],N[1],N[2],1,-1,B,U),E.emplaceBack(N[0],N[1],N[2],1,1,B,U),E.emplaceBack(N[0],N[1],N[2],-1,1,B,U),I.emplaceBack(R+0,R+1,R+2),I.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=u.createVertexBuffer(E,Ov.members),this.starsIdx=u.createIndexBuffer(I),this.starsSegments=s.bg.simpleSegment(0,0,E.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,u){const p=n.context,y=p.gl,b=n.transform,w=new Kt(y.LEQUAL,Kt.ReadOnly,[0,1]),E=s.aj(b.zoom),I=n.style.getLut(u.scope),R=u.properties.get("color-use-theme")==="none",L=u.properties.get("color").toNonPremultipliedRenderColor(R?null:I),N=u.properties.get("high-color-use-theme")==="none",B=u.properties.get("high-color").toNonPremultipliedRenderColor(N?null:I),U=u.properties.get("space-color-use-theme")==="none",W=u.properties.get("space-color").toNonPremultipliedRenderColor(U?null:I),G=5e-4,X=s.es(u.properties.get("horizon-blend"),0,1,G,.25),K=s.dE(n,p,b)&&X===G?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,oe=n.frameCounter/1e3%1,re=s.ag(b.globeCenterInViewSpace),ne=Math.sqrt(Math.pow(re,2)-Math.pow(K,2)),be=Math.acos(ne/re),_e=ve=>{const pe=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&pe.push("ALPHA_PASS");const he=n.getOrCreateProgram("globeAtmosphere",{defines:pe}),Se=((Le,Ze,je,tt,dt,Fe,Te,Ke,We,ft,vt,At)=>({u_frustum_tl:Le,u_frustum_tr:Ze,u_frustum_br:je,u_frustum_bl:tt,u_horizon:dt,u_transition:Fe,u_fadeout_range:Te,u_atmosphere_fog_color:Ke.toArray01(),u_high_color:We.toArray01(),u_space_color:ft.toArray01(),u_temporal_offset:vt,u_horizon_angle:At}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,E,X,L,B,W,oe,be);n.uploadCommonUniforms(p,he);const ze=this.atmosphereBuffer;ze&&he.draw(n,y.TRIANGLES,w,vi.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,di.backCW,Se,ve?"atmosphere_glow_alpha":"atmosphere_glow",ze.vertexBuffer,ze.indexBuffer,ze.segments)};_e(!1),_e(!0)}drawStars(n,u){const p=s.aA(u.properties.get("star-intensity"),0,1);if(p===0)return;const y=n.context,b=y.gl,w=n.transform,E=n.getOrCreateProgram("stars"),I=s.c7([]);s.c9(I,I,-w._pitch),s.c8(I,I,-w.angle),s.c9(I,I,s.an(w._center.lat)),s.et(I,I,-s.an(w._center.lng));const R=s.cc(new Float32Array(16),I),L=s.aB([],w.starsProjMatrix,R),N=s.eo([],R),B=s.eu([],N),U=[0,1,0];s.dQ(U,U,B),s.c5(U,U,this.params.sizeMultiplier);const W=[1,0,0];s.dQ(W,W,B),s.c5(W,W,this.params.sizeMultiplier);const G=(X=U,K=W,oe=p,{u_matrix:Float32Array.from(L),u_up:X,u_right:K,u_intensity_multiplier:oe});var X,K,oe;n.uploadCommonUniforms(y,E),this.starsVx&&this.starsIdx&&E.draw(n,b.TRIANGLES,Kt.disabled,vi.disabled,this.colorModeAlphaBlendedWriteRGB,di.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ym{constructor(){this.visibleTiles=[]}updateBorders(n,u){const p=[],y=[],b=n._getRenderableCoordinates(!1,!0);for(const I of b){const R=n.getTile(I);if(!R.hasData())continue;const L=R.getBucket(u);L&&(L.isEmpty()||(p.push(I.key),y.push({bucket:L,tileID:I.canonical})))}let w=p.length!==this.visibleTiles.length;if(!w){p.sort();for(let I=0;I<p.length;I++)if(p[I]!==this.visibleTiles[I]){w=!0;break}}if(!w)return;const E=new Set;this.visibleTiles=p,y.sort((I,R)=>I.tileID.z-R.tileID.z||I.tileID.x-R.tileID.x||I.tileID.y-R.tileID.y);for(const I of y){const R=new Array,L=new Array,N=I.bucket;for(const B of N.featuresOnBorder)E.has(B.featureId)?L.push(B.footprintIndex):(E.add(B.featureId),R.push(B.footprintIndex));N.updateFootprintHiddenFlags(R,s.ev,!1),N.updateFootprintHiddenFlags(L,s.ev,!0)}}}function Km(f,n){const u=[...f],p=n.cameraWorldSizeForFog/n.worldSize,y=s.bA([]);return s.cS(y,y,[p,p,1]),s.aB(u,y,u),s.aB(u,n.worldToFogMatrix,u),u}function ga(f,n,u,p,y){const b=u.material,w=p.context,{baseColorTexture:E,metallicRoughnessTexture:I}=b.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:L,emissionTexture:N}=b;function B(W,G,X){if(W&&(f.push(G),w.activeTexture.set(w.gl.TEXTURE0+X),W.gfxTexture)){const{minFilter:K,magFilter:oe,wrapS:re,wrapT:ne}=W.sampler;W.gfxTexture.bindExtraParam(K,oe,re,ne)}}B(E,"HAS_TEXTURE_u_baseColorTexture",5),B(I,"HAS_TEXTURE_u_metallicRoughnessTexture",6),B(R,"HAS_TEXTURE_u_normalTexture",7),B(L,"HAS_TEXTURE_u_occlusionTexture",8),B(N,"HAS_TEXTURE_u_emissionTexture",9),y&&(y.texture||(y.texture=new s.d$(p.context,y.image,[y.image.height,y.image.height,y.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+10),y.texture&&y.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(u.texcoordBuffer)),u.colorBuffer&&(f.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(u.colorBuffer)),u.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(u.normalBuffer)),u.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(u.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||f.push("DIFFUSE_SHADED");const U=p.shadowRenderer;U&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&f.push("NORMAL_OFFSET"))}function An(f,n,u,p,y,b){const w=f.modelOpacity,E=n.context,I=new Kt(n.context.gl.LEQUAL,f.isLightMesh?Kt.ReadOnly:Kt.ReadWrite,n.depthRangeFor3D),R=n.transform,L=f.mesh,N=L.material,B=N.pbrMetallicRoughness,U=n.style.fog;let W;W=n.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:s.aB([],p.zScaleMatrix,f.nodeModelMatrix),s.aB(W,p.negCameraPosMatrix,W);const G=s.bl([],W);s.eg(G,G);const X=u.paint.get("model-color-use-theme").constantOr("default")==="none",K=u.paint.get("model-emissive-strength").constantOr(0),oe=cf(new Float32Array(f.worldViewProjection),new Float32Array(W),new Float32Array(G),null,n,w,B.baseColorFactor,N.emissiveFactor,B.metallicFactor,B.roughnessFactor,N,K,u,void 0,void 0,f.materialOverride,f.modelColor),re={defines:[]},ne=[],be=n.shadowRenderer;be&&(be.useNormalOffset=!1),ga(re.defines,ne,L,n,X?null:u.lut);let _e=null;if(U){const he=Km(f.nodeModelMatrix,n.transform);if(_e=new Float32Array(he),R.projection.name!=="globe"){const Se=L.aabb.min,ze=L.aabb.max,[Le,Ze]=U.getOpacityForBounds(he,Se[0],Se[1],ze[0],ze[1]);re.overrideFog=Le>=Ft||Ze>=Ft}}const ve=na(n,u.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");const pe=n.getOrCreateProgram("model",re);n.uploadCommonUniforms(E,pe,null,_e,ve),n.renderPass!=="shadow"&&be&&be.setupShadowsFromMatrix(f.nodeModelMatrix,pe),pe.draw(n,E.gl.TRIANGLES,I,y,b,L.material.doubleSided?di.disabled:di.backCCW,oe,u.id,L.vertexBuffer,L.indexBuffer,L.segments,u.paint,n.transform.zoom,void 0,ne)}function zh(f,n){return f.style._importedAsBasemap?"basemap":n.scope}function Ch(f,n,u,p,y,b,w,E,I,R){const L=f.transform,N=!!n.isGeometryBloom&&n.isGeometryBloom;if(N&&f.renderPass==="shadow")return;const B=L.projection.name==="globe"?s.eD(u,L):[...u];s.aB(B,B,n.globalMatrix);const U=s.aB([],p,B);if(n.meshes)for(const W of n.meshes){const G=E.get(W.material.name);if(G&&G.opacity<=0)continue;if(W.material.alphaMode!=="BLEND"){w.push({mesh:W,depth:0,modelIndex:y,worldViewProjection:U,nodeModelMatrix:B,isLightMesh:N,materialOverride:G,modelOpacity:I,modelColor:R});continue}const X=s.af([],W.centroid,U);!L.isOrthographic&&X[2]<=0||b.push({mesh:W,depth:X[2],modelIndex:y,worldViewProjection:U,nodeModelMatrix:B,isLightMesh:N,materialOverride:G,modelOpacity:I,modelColor:R})}if(n.children)for(const W of n.children)Ch(f,W,u,p,y,b,w,E,I,R)}function du(f,n,u,p){const y=u.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),w=y.getShadowPassColorMode(),E=y.calculateShadowPassMatrixFromMatrix(n),I=Ah(E);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,b,vi.disabled,w,di.disabled,I,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,u.transform.zoom,void 0,void 0)}function Fv(f,n,u,p,y,b){for(const w of y){const E=Object.assign({},p);E.part=w;const I={type:"Unknown",id:n,properties:E},R={orientation:f.paint.get("model-rotation").evaluate(I,u)};b.set(w,R)}}function Bv(f,n,u,p,y,b){for(const w of y){const E=Object.assign({},p);E.part=w;const I={type:"Unknown",id:n,properties:E},R={color:f.paint.get("model-color").evaluate(I,u),colorMix:f.paint.get("model-color-mix-intensity").evaluate(I,u),opacity:f.paint.get("model-opacity").evaluate(I,u),emissionStrength:f.paint.get("model-emissive-strength").evaluate(I,u)};b.set(w,R)}}function Qm(f,n,u,p,y){let b=!1;for(const E of p)E.modelOpacity!==1&&(An(E,f,n,y[E.modelIndex],vi.disabled,Ii.disabled),b=!0);for(const E of p)An(E,f,n,y[E.modelIndex],E.modelOpacity!==1?f.stencilModeFor3D():vi.disabled,f.colorModeForRenderPass());b&&f.resetStencilClippingMasks();const w=Ii.additive;for(const E of u)An(E,f,n,y[E.modelIndex],vi.disabled,E.isLightMesh?w:f.colorModeForRenderPass())}function bc(f,n,u){const p=n.updateZoomBasedPaintProperties(),y=(function(b,w,E){let I,R,L,N=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&N>0){const B=b.terrain,U=B.findDEMTileFor(E);U&&U.dem?I=s.eF.create(B,E,U):N=0}if(N===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),N===w.validForExaggeration&&(N===0||I&&I._demTile&&I._demTile.tileID===w.validForDEMTile.id&&I._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const B in w.instancesPerModel){const U=w.instancesPerModel[B];for(let W=0;W<U.instancedDataArray.length;++W){const G=(I?N*I.getElevationAt(0|U.instancedDataArray.float32[16*W],0|U.instancedDataArray.float32[16*W+1],!0,!0):0)+U.instancesEvaluatedElevation[W];U.instancedDataArray.float32[16*W+6]=G,R=R?Math.min(w.terrainElevationMin,G):G,L=L?Math.max(w.terrainElevationMax,G):G}}return w.terrainElevationMin=R||0,w.terrainElevationMax=L||0,w.validForExaggeration=N,w.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,n,u);(p||y)&&(n.uploaded=!1,n.upload(f.context))}const jo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d9([0,0,0],[s.al,s.al,0])};function bt(f,n){const u=1<<f.canonical.z,p=n.getFreeCameraOptions().position,y=n.elevation,b=f.canonical.x/u,w=(f.canonical.x+1)/u,E=f.canonical.y/u,I=(f.canonical.y+1)/u;let R=n._centerAltitude;if(y){const U=y.getMinMaxForTile(f);U&&U.max>R&&(R=U.max)}const L=s.aA(p.x,b,w)-p.x,N=s.aA(p.y,E,I)-p.y,B=s.cf(R,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(L*L+N*N+B*B))}function Pt(f,n,u,p,y,b,w){const E=f.context,I=f.renderPass==="shadow",R=f.shadowRenderer,L=I&&R?R.getShadowPassDepthMode():new Kt(E.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D),N=f.isTileAffectedByFog(b),B=f.transform.projection.name==="globe";if(u.meshes)for(const U of u.meshes){const W=B?[]:["MODEL_POSITION_ON_GPU"],G=[];let X,K,oe;const re=!B&&p.instancedDataArray.length>20;re&&W.push("INSTANCED_ARRAYS");const ne=na(f,n.paint.get("model-cutoff-fade-range"));if(ne.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),I&&R)X=f.getOrCreateProgram("modelDepth",{defines:W}),K=Ah(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(u.globalMatrix)),oe=R.getShadowPassColorMode();else{ga(W,G,U,f,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),X=f.getOrCreateProgram("model",{defines:W,overrideFog:N});const _e=U.material,ve=_e.pbrMetallicRoughness,pe=n.paint.get("model-opacity").constantOr(1),he=n.paint.get("model-emissive-strength").constantOr(0);K=cf(b.expandedProjMatrix,Float32Array.from(u.globalMatrix),new Float32Array(16),null,f,pe,ve.baseColorFactor,_e.emissiveFactor,ve.metallicFactor,ve.roughnessFactor,_e,he,n,y),R&&(w.shadowUniformsInitialized?X.setShadowUniformValues(E,R.getShadowUniformValues()):(R.setupShadows(b.toUnwrapped(),X,"model-tile"),w.shadowUniformsInitialized=!0)),oe=ne.shouldRenderCutoff||pe<1||_e.alphaMode!=="OPAQUE"?Ii.alphaBlended:Ii.unblended}f.uploadCommonUniforms(E,X,b.toUnwrapped(),null,ne);const be=U.material.doubleSided?di.disabled:di.backCCW;if(re)G.push(p.instancedDataBuffer),X.draw(f,E.gl.TRIANGLES,L,vi.disabled,oe,be,K,n.id,U.vertexBuffer,U.indexBuffer,U.segments,n.paint,f.transform.zoom,void 0,G,p.instancedDataArray.length);else{const _e=I?"u_instance":"u_normal_matrix";for(let ve=0;ve<p.instancedDataArray.length;++ve)K[_e]=new Float32Array(p.instancedDataArray.arrayBuffer,64*ve,16),X.draw(f,E.gl.TRIANGLES,L,vi.disabled,oe,be,K,n.id,U.vertexBuffer,U.indexBuffer,U.segments,n.paint,f.transform.zoom,void 0,G)}}if(u.children)for(const U of u.children)Pt(f,n,U,p,y,b,w)}const fu=[1,-1,1];function ur(f,n,u,p){if(!u.modelManager)return!0;const y=u.modelManager;if(!u.shadowRenderer)return!0;const b=u.shadowRenderer,w=n.aabb;let E=!0,I=f.maxHeight;if(I===0){let L=0;for(const N in f.instancesPerModel){const B=y.getModel(N,p);B?L=Math.max(L,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):E=!1}I=f.maxScale*L*1.41+f.maxVerticalOffset,E&&(f.maxHeight=I)}w.max[2]=I,w.min[2]+=f.terrainElevationMin,w.max[2]+=f.terrainElevationMax,s.af(w.min,w.min,n.tileMatrix),s.af(w.max,w.max,n.tileMatrix);const R=w.intersects(b.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=R===2),R===0}function ke(f,n){const u=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],b=f.uniformValues.u_cutoff_params[3];return p===u||b===y?1:s.aA(((n-u)/(p-u)-y)/(b-y),0,1)}function Nv(f,n,u,p){if(n.pitch<20)return 1;const y=n.getWorldToCameraMatrix();s.aB(y,y,f);const b=s.bU(u.min[0],u.min[1],u.min[2],1);let w=s.aC(s.eG(),b,y),E=w,I=w;b[1]=u.max[1],w=s.aC(s.eG(),b,y),E=w[1]<E[1]?w:E,I=w[1]>I[1]?w:I,b[0]=u.max[0],w=s.aC(s.eG(),b,y),E=w[1]<E[1]?w:E,I=w[1]>I[1]?w:I,b[1]=u.min[1],w=s.aC(s.eG(),b,y),E=w[1]<E[1]?w:E,I=w[1]>I[1]?w:I;const R=s.aA(p[0],0,1),L=100*n.pixelsPerMeter*s.aA(p[1],0,1),N=s.aA(p[2],0,1),B=s.eH(s.eG(),E,I,R),U=Math.tan(.5*n.fovX),W=-B[2]*U;if(L===0)return B[1]<-Math.abs(W)?N:1;const G=(-Math.abs(W)-B[1])/L,X=(oe,re,ne)=>(1-ne)*oe+ne*re,K=s.aA(X(1,N,G),N,1);return X(1,K,s.aA((n.pitch-20)/20,0,1))}class _f{}class eg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,u,p){{const N=this._storage.get(u.id);if(N)return N.lastUsedFrameIdx=n,N.buf}const y=p.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),w=new ArrayBuffer(b),E=new Int16Array(w);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const I=new s.eJ;for(let N=0;N<b/2;N+=3){const B=E[N],U=E[N+1],W=E[N+2];I.emplaceBack(B,U),I.emplaceBack(U,W),I.emplaceBack(W,B)}const R=p.bindVertexArrayOES.current,L=new _f;return L.buf=new Ba(p,I),L.lastUsedFrameIdx=n,this._storage.set(u.id,L),p.bindVertexArrayOES.set(R),L.buf}update(n){for(const[u,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(u))}destroy(){for(const[n,u]of this._storage)u.buf.destroy(),this._storage.delete(n)}}class tg{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const Uv=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ig{constructor(n){this.revealStart=11,this.revealRange=2}}const pu=s.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class p1{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,u){const p=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new s.eK,E=new s.b0;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),E.emplaceBack(0,1,2),E.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(w,pu.members),this.vignetteIdx=n.context.createIndexBuffer(E)}const y=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,p);const w={u_vignetteShape:(b={vignetteShape:[u.start,u.range,Math.pow(10,u.fadePower)],vignetteColor:[u.color.r,u.color.g,u.color.b,u.color.a*u.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(n,n.context.gl.TRIANGLES,Kt.disabled,vi.disabled,Ii.alphaBlended,di.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,y)}var b}}class m1{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,u){const p=n.getFreeCameraOptions().position,y=p.toAltitude(),b=p.toLngLat(),w=s.an(b.lng),E=s.an(b.lat),I=n.pixelsPerMeter/u,R=w*s.eM,L=s.eM*Math.log(Math.tan(Math.PI/4+E/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const N=-this._offsetYPrev+L,B=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*I,this._accumulatedOffsetY+=N*I,this._accumulatedElevation+=B*I,this._offsetXPrev=R,this._offsetYPrev=L,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ng(f,n){return[-(f[0]-Math.floor(f[0]/n)*n),-(f[1]-Math.floor(f[1]/n)*n),-(f[2]-Math.floor(f[2]/n)*n)]}function Rh(f){const n=s.eq(1323123451230),u=[];for(let p=0;p<f;++p){const y=2*n()-1,b=2*n()-1,w=2*n()-1;u.push(s.d5(y,b,w))}return u}function Ua(f,n,u,p,y){const b=s.aA((y-u)/(p-u),0,1);return(1-b)*f+b*n}class rg{constructor(n){this._movement=new m1,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new p1,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,u){const p=n.transform;this._movement.update(p,this._ppmScaleFactor);const y=p.starsProjMatrix,b=s.c7([]);s.c9(b,b,s.an(90)-p._pitch),s.c8(b,b,-p.angle);const w=s.cc(new Float32Array(16),b),E=s.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),I=s.eg([],E),R=s.aB([],I,w),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*u,this._prevTime=L,{projectionMatrix:y,modelviewMatrix:R}}}class $v extends rg{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ig("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const u=n.context;if(!this.particlesVx){const p=Rh(this.particlesCount),y=new s.eN,b=new s.b0;let w=0;const E=s.eq(1323123451230);for(let I=0;I<p.length;++I){const R=p[I],L=[2*E()-1,E(),E(),E()];y.emplaceBack(R[0],R[1],R[2],-1,-1,...L),y.emplaceBack(R[0],R[1],R[2],1,-1,...L),y.emplaceBack(R[0],R[1],R[2],1,1,...L),y.emplaceBack(R[0],R[1],R[2],-1,1,...L),b.emplaceBack(w+0,w+1,w+2),b.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=u.createVertexBuffer(y,Uv.members),this.particlesIdx=u.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const u=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=n.transform.zoom;if(u.revealStart>p)return;const y=Ua(0,1,u.revealStart,u.revealStart+u.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let w=[-b.direction.x,b.direction.y,-100];s.aw(w,w);const E=structuredClone(this._vignetteParams);E.strength*=y,b.overrideStyleParameters||(b.intensity=n.style.rain.state.density,b.timeFactor=n.style.rain.state.intensity,b.color=structuredClone(n.style.rain.state.color),w=structuredClone(n.style.rain.state.direction),b.screenThinning.intensity=n.style.rain.state.centerThinning,b.dropletSizeX=n.style.rain.state.dropletSize[0],b.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],b.distortionStrength=100*n.style.rain.state.distortionStrength,E.strength=1,E.color=structuredClone(n.style.rain.state.vignetteColor));const I=this.updateOnRender(n,b.timeFactor),R=n.context,L=R.gl,N=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new s.T(R,{width:n.width,height:n.height,data:null},L.RGBA8)),b.distortionStrength>0&&(R.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const B=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(R,B),R.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const U=[b.color.r,b.color.g,b.color.b,b.color.a],W=(G,X)=>{const K=ng(this._movement.getPosition(),G),oe=b.dropletSizeX,re=b.dropletSizeX*b.dropletSizeYScale,ne=n.width/2,be=n.height/2,_e=Ua(0,b.screenThinning.start,0,1,b.screenThinning.intensity),ve=Ua(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),pe=Ua(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),he=(Se={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:G,rainDropletSize:[oe,re],distortionStrength:b.distortionStrength,rainDirection:w,color:U,screenSize:[N.width,N.height],thinningCenterPos:[ne,be],thinningShape:[_e,ve,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:pe,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:X?0:1},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_texScreen:0,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_boxSize:Se.boxSize,u_rainDropletSize:Se.rainDropletSize,u_distortionStrength:Se.distortionStrength,u_rainDirection:Se.rainDirection,u_color:Se.color,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_shapeDirectionalPower:Se.shapeDirectionalPower,u_shapeNormalPower:Se.shapeNormalPower,u_mode:Se.mode});var Se;const ze=Math.round(b.intensity*this.particlesCount),Le=s.bg.simpleSegment(0,0,4*ze,2*ze);B.draw(n,L.TRIANGLES,Kt.disabled,vi.disabled,Ii.alphaBlended,di.disabled,he,"rain_particles",this.particlesVx,this.particlesIdx,Le)};b.distortionStrength>0&&W(b.boxSize,!0),W(b.boxSize,!1),this._vignette.draw(n,E)}}const yf=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Lh extends rg{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ig("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const u=n.context;if(!this.particlesVx){const p=Rh(this.particlesCount),y=new s.eO,b=new s.b0;let w=0;const E=s.eq(1323123451230);for(let I=0;I<p.length;++I){const R=p[I],L=E(),N=E(),B=E(),U=[I/p.length,L,N,B],W=[E(),E()];y.emplaceBack(R[0],R[1],R[2],-1,-1,...U,...W),y.emplaceBack(R[0],R[1],R[2],1,-1,...U,...W),y.emplaceBack(R[0],R[1],R[2],1,1,...U,...W),y.emplaceBack(R[0],R[1],R[2],-1,1,...U,...W),b.emplaceBack(w+0,w+1,w+2),b.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=u.createVertexBuffer(y,yf.members),this.particlesIdx=u.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const u=structuredClone(this._params);let p=[-u.direction.x,u.direction.y,-100];s.aw(p,p);const y=structuredClone(this._vignetteParams),b=u.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=n.transform.zoom;if(b.revealStart>w)return;const E=Ua(0,1,b.revealStart,b.revealStart+b.revealRange,w);y.strength*=E,u.overrideStyleParameters||(u.intensity=n.style.snow.state.density,u.timeFactor=n.style.snow.state.intensity,u.color=structuredClone(n.style.snow.state.color),p=structuredClone(n.style.snow.state.direction),u.screenThinning.intensity=n.style.snow.state.centerThinning,u.billboardSize=2.79*n.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(n.style.snow.state.vignetteColor));const I=this.updateOnRender(n,u.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const R=n.context,L=R.gl,N=n.transform,B=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(R,B),((U,W,G)=>{const X=ng(this._movement.getPosition(),U),K=N.width/2,oe=N.height/2,re=Ua(0,G.screenThinning.start,0,1,G.screenThinning.intensity),ne=Ua(.001,G.screenThinning.range,0,1,G.screenThinning.intensity),be=Ua(0,G.screenThinning.particleOffset,0,1,G.screenThinning.intensity),_e=(ve={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:G.velocityConeAperture,velocity:G.velocity,horizontalOscillationRadius:G.horizontalOscillationRadius,horizontalOscillationRate:G.horizontalOscillationRate,boxSize:U,billboardSize:1*G.billboardSize,simpleShapeParameters:[G.shapeFadeStart,G.shapeFadePower],screenSize:[N.width,N.height],thinningCenterPos:[K,oe],thinningShape:[re,ne,Math.pow(10,G.screenThinning.fadePower)],thinningAffectedRatio:G.screenThinning.affectedRatio,thinningParticleOffset:be,color:[G.color.r,G.color.g,G.color.b,G.color.a],direction:p},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const pe=Math.round(G.intensity*this.particlesCount),he=s.bg.simpleSegment(0,0,4*pe,2*pe);this.particlesVx&&this.particlesIdx&&B.draw(n,L.TRIANGLES,Kt.disabled,vi.disabled,Ii.alphaBlended,di.disabled,_e,"snow_particles",this.particlesVx,this.particlesIdx,he)})(u.boxSize,0,u),this._vignette.draw(n,y)}}const wc={symbol:function(f,n,u,p,y){if(f.renderPass!=="translucent")return;const b=vi.disabled,w=f.colorModeForRenderPass(),E=u.layout.get("text-variable-anchor"),I=u.layout.get("text-size-scale-range"),R=s.aA(f.scaleFactor,I[0],I[1]);E&&(function(B,U,W,G,X,K,oe,re){const ne=U.transform,be=X==="map",_e=K==="map";for(const ve of B){const pe=G.getTile(ve),he=pe.getBucket(W);if(!he||!he.text||!he.text.segments.get().length)continue;const Se=s.bK(he.textSizeData,ne.zoom,re),ze=qc(ve,he.getProjection(),ne),Le=ne.calculatePixelsToTileUnitsMatrix(pe),Ze=hc(ze,pe.tileID.canonical,_e,be,ne,he.getProjection(),Le),je=he.hasIconTextFit()&&he.hasIconData();Se&&Tv(he,be,_e,oe,ne,Ze,ve,Math.pow(2,ne.zoom-pe.tileID.overscaledZ),Se,je)}})(p,f,u,n,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),y,R);const L=u.paint.get("icon-opacity").constantOr(1)!==0,N=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||N)?df(f,n,u,p,b,w):(L&&df(f,n,u,p,b,w,{onlyIcons:!0}),N&&df(f,n,u,p,b,w,{onlyText:!0})),n.map.showCollisionBoxes&&(Bm(f,n,u,p,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Bm(f,n,u,p,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,u,p){if(f.renderPass!=="translucent")return;const y=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),w=u.paint.get("circle-stroke-opacity"),E=u.layout.get("circle-sort-key").constantOr(1)!==void 0,I=u.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||w.constantOr(1)===0))return;const R=f.context,L=R.gl,N=f.transform,B=!(!f.terrain||!f.terrain.enabled),U=u.layout.get("circle-elevation-reference"),W=f.depthModeForSublayer(0,Kt.ReadOnly),G=new Kt(f.context.gl.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D),X=U==="none"||B?W:G,K=vi.disabled,oe=f.colorModeForDrapableLayerRenderPass(I),re=N.projection.name==="globe",ne=[s.aF(N.center.lng),s.aJ(N.center.lat)],be=[];for(let ve=0;ve<p.length;ve++){const pe=p[ve],he=n.getTile(pe),Se=he.getBucket(u);if(!Se||Se.projection.name!==N.projection.name)continue;const ze=Se.programConfigurations.get(u.id),Le=Se.layoutVertexBuffer,Ze=Se.globeExtVertexBuffer,je=Se.indexBuffer,tt=s.e0(u),dt=[Ze],Fe=f.isTileAffectedByFog(pe);re&&tt.push("PROJECTION_GLOBE_VIEW"),tt.push("DEPTH_D24"),f.terrain&&N.depthOcclusionForSymbolsAndCircles&&tt.push("DEPTH_OCCLUSION"),Se.hasElevation&&!f.terrain&&(tt.push("ELEVATED_ROADS"),dt.push(Se.elevatedLayoutVertexBuffer));const Te=f.getOrCreateProgram("circle",{config:ze,defines:tt,overrideFog:Fe}),Ke=N.projection.createInversionMatrix(N,pe.canonical),We={programConfiguration:ze,program:Te,layoutVertexBuffer:Le,dynamicBuffers:dt,indexBuffer:je,uniformValues:s.e1(f,pe,he,Ke,ne,u),tile:he};if(E){const ft=Se.segments.get();for(const vt of ft)be.push({segments:new s.bg([vt]),sortKey:vt.sortKey,state:We})}else be.push({segments:Se.segments,sortKey:0,state:We})}E&&be.sort((ve,pe)=>ve.sortKey-pe.sortKey);const _e={useDepthForOcclusion:N.depthOcclusionForSymbolsAndCircles};for(const ve of be){const{programConfiguration:pe,program:he,layoutVertexBuffer:Se,dynamicBuffers:ze,indexBuffer:Le,uniformValues:Ze,tile:je}=ve.state,tt=ve.segments;f.terrain&&f.terrain.setupElevationDraw(je,he,_e),f.uploadCommonUniforms(R,he,je.tileID.toUnwrapped()),he.draw(f,L.TRIANGLES,X,K,oe,di.disabled,Ze,u.id,Se,Le,tt,u.paint,N.zoom,pe,ze)}},heatmap:function(f,n,u,p){if(u.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,b=y.gl,w=vi.disabled,E=new Ii([b.ONE,b.ONE,b.ONE,b.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(U,W,G,X){const K=U.gl,oe=W.width*X,re=W.height*X;U.activeTexture.set(K.TEXTURE1),U.viewport.set([0,0,oe,re]);let ne=G.heatmapFbo;if(!ne||ne&&(ne.width!==oe||ne.height!==re)){ne&&ne.destroy();const be=K.createTexture();K.bindTexture(K.TEXTURE_2D,be),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),ne=G.heatmapFbo=U.createFramebuffer(oe,re,1,null),(function(_e,ve,pe,he,Se,ze){const Le=_e.gl;Le.texImage2D(Le.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?Le.RGBA16F:Le.RGBA,Se,ze,0,Le.RGBA,_e.extRenderToTextureHalfFloat?Le.HALF_FLOAT:Le.UNSIGNED_BYTE,null),he.colorAttachment0.set(pe)})(U,0,be,ne,oe,re)}else K.bindTexture(K.TEXTURE_2D,ne.colorAttachment0.get()),U.bindFramebuffer.set(ne.framebuffer)})(y,f,u,f.transform.projection.name==="globe"?.5:.25),y.clear({color:s.ao.transparent});const I=f.transform,R=I.projection.name==="globe",L=R?["PROJECTION_GLOBE_VIEW"]:[],N=R?di.frontCCW:di.disabled,B=[s.aF(I.center.lng),s.aJ(I.center.lat)];for(let U=0;U<p.length;U++){const W=p[U];if(n.hasRenderableParent(W))continue;const G=n.getTile(W),X=G.getBucket(u);if(!X||X.projection.name!==I.projection.name)continue;const K=f.isTileAffectedByFog(W),oe=X.programConfigurations.get(u.id),re=f.getOrCreateProgram("heatmap",{config:oe,defines:L,overrideFog:K}),{zoom:ne}=f.transform;f.terrain&&f.terrain.setupElevationDraw(G,re),f.uploadCommonUniforms(y,re,W.toUnwrapped());const be=I.projection.createInversionMatrix(I,W.canonical);re.draw(f,b.TRIANGLES,Kt.disabled,w,E,N,Om(f,W,G,be,B,ne,u.paint.get("heatmap-intensity")),u.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,u.paint,f.transform.zoom,oe,R?[X.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(y,b){const w=y.context,E=w.gl,I=b.heatmapFbo;if(!I)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,I.colorAttachment0.get()),w.activeTexture.set(E.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new s.T(w,b.colorRamp,E.RGBA8)),R.bind(E.LINEAR,E.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,E.TRIANGLES,Kt.disabled,vi.disabled,y.colorModeForRenderPass(),di.disabled,((L,N)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)})(f,u))},line:function(f,n,u,p){if(f.renderPass!=="translucent")return;const y=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const w=u.paint.get("line-emissive-strength").isConstant(),E=u.paint.get("line-emissive-strength").constantOr(0),I=u.paint.get("line-occlusion-opacity"),R=u.layout.get("line-elevation-reference"),L=u.layout.get("line-width-unit")==="meters",N=R==="sea",B=!(!f.terrain||!f.terrain.enabled),U=f.context,W=U.gl;if(u.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const G=u.layout.get("line-cross-slope"),X=G!==void 0,K=G<1,oe=f.colorModeForDrapableLayerRenderPass(w?E:null),re=f.terrain&&f.terrain.renderingToTexture,ne=re?1:s.o.devicePixelRatio,be=u.paint.get("line-dasharray"),_e=be.constantOr(1),ve=u.layout.get("line-cap"),pe=be.constantOr(null),he=ve.constantOr(null),Se=u.paint.get("line-pattern"),ze=Se.constantOr(1),Le=u.paint.get("line-pattern-cross-fade"),Ze=Se.constantOr(null),je=u.paint.get("line-opacity").constantOr(1);let tt=!ze&&je!==1||f.depthOcclusion&&I>0&&I<1;const dt=u.paint.get("line-gradient"),Fe=ze?"linePattern":"line",Te=s.e2(u);let Ke;if(re&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(tt=!1),I!==0&&f.depthOcclusion){const At=u.paint._values["line-opacity"];At&&At.value&&At.value.kind==="constant"?Ke=At.value:s.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&Te.push("VARIABLE_LINE_WIDTH"),re&&(f.emissiveMode!=="dual-source-blending"||w?f.emissiveMode==="mrt-fallback"&&Te.push("USE_MRT1"):Te.push("DUAL_SOURCE_BLENDING"));const We=(At,xt,wt,qt,Gt,Lt)=>{for(const jt of At){const oi=n.getTile(jt);if(ze&&!oi.patternsLoaded())continue;const fi=oi.getBucket(u);if(!fi||fi.elevationType!=="none"&&!Gt||fi.elevationType==="none"&&Gt)continue;f.prepareDrawTile();const Bi=[...xt],Qi=f.shadowRenderer,Ti=fi.elevationType==="road"&&!!Qi&&Qi.enabled;let an=[0,0,0];if(Ti){const Fi=f.style.directionalLight,Nn=f.style.ambientLight;Fi&&Nn&&(an=ra(f.style,Fi,Nn)),Bi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Ri=fi.programConfigurations.get(u.id);let En=!1;if(Ze&&oi.imageAtlas){const Fi=s.e3.from(Ze),Nn=Fi.getPrimary().scaleSelf(ne).toString(),hr=oi.imageAtlas.patternPositions.get(Nn),jn=Fi.getSecondary(),qn=jn?oi.imageAtlas.patternPositions.get(jn.scaleSelf(ne).toString()):null;En=!!hr&&!!qn,hr&&Ri.setConstantPatternPositions(hr,qn)}Le>0&&(En||Ri.getPatternTransitionVertexBuffer("line-pattern"))&&Bi.push("LINE_PATTERN_TRANSITION");const wn=f.isTileAffectedByFog(jt),Mn=f.getOrCreateProgram(Fe,{config:Ri,defines:Bi,overrideFog:wn});if(!ze&&pe&&he&&oi.lineAtlas){const Fi=oi.lineAtlas.getDash(pe,he);Fi&&Ri.setConstantPatternPositions(Fi)}Ti&&Qi.setupShadows(oi.tileID.toUnwrapped(),Mn,"vector-tile");let[en,Oi]=u.paint.get("line-trim-offset");(he==="round"||he==="square")&&en!==Oi&&(en===0&&(en-=1),Oi===1&&(Oi+=1));const gn=re?jt.projMatrix:null,tr=L?1/fi.tileToMeter/s.ay(oi,1,f.transform.zoom):1,ir=L?1/fi.tileToMeter/s.ay(oi,1,Math.floor(f.transform.zoom)):1,_n=ze?s.e4(f,oi,u,gn,ne,tr,ir,[en,Oi],an,Le):s.e5(f,oi,u,gn,fi.lineClipsArray.length,ne,tr,ir,[en,Oi],an);if(dt){const Fi=fi.gradients[u.id];let Nn=Fi.texture;if(u.gradientVersion!==Fi.version){let hr=256;if(u.stepInterpolant){const jn=n.getSource().maxzoom,qn=jt.canonical.z===jn?Math.ceil(1<<f.transform.maxZoom-jt.canonical.z):1;hr=s.aA(s.e6(fi.maxLineLength/s.al*1024*qn),256,U.maxTextureSize)}Fi.gradient=s.e7({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:hr,image:Fi.gradient||void 0,clips:fi.lineClipsArray}),Fi.texture?Fi.texture.update(Fi.gradient):Fi.texture=new s.T(U,Fi.gradient,W.RGBA8),Fi.version=u.gradientVersion,Nn=Fi.texture}U.activeTexture.set(W.TEXTURE1),Nn.bind(u.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}_e&&(U.activeTexture.set(W.TEXTURE0),oi.lineAtlasTexture&&oi.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Ri.updatePaintBuffers()),ze&&(U.activeTexture.set(W.TEXTURE0),oi.imageAtlasTexture&&oi.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Ri.updatePaintBuffers()),Gt&&!N&&f.terrain.setupElevationDraw(oi,Mn),f.uploadCommonUniforms(U,Mn,jt.toUnwrapped());const Ji=Fi=>{Ke!=null&&(Ke.value=je*I),Mn.draw(f,W.TRIANGLES,wt,Fi,oe,di.disabled,_n,u.id,fi.layoutVertexBuffer,fi.indexBuffer,fi.segments,u.paint,f.transform.zoom,Ri,[fi.layoutVertexBuffer2,fi.patternVertexBuffer,fi.zOffsetVertexBuffer]),Ke!=null&&(Ke.value=je)};if(tt&&!Gt){const Fi=f.stencilModeForClipping(jt).ref;Fi===0&&re&&U.clear({stencil:0});const Nn={func:W.EQUAL,mask:255};_n.u_alpha_discard_threshold=.8,Ji(new vi(Nn,Fi,255,W.KEEP,W.KEEP,W.INVERT)),_n.u_alpha_discard_threshold=0,Ji(new vi(Nn,Fi,255,W.KEEP,W.KEEP,W.KEEP))}else _n.u_alpha_discard_threshold=tt&&Gt&&Lt?.8:0,Ji(Gt?qt:f.stencilModeForClipping(jt))}};let ft=f.depthModeForSublayer(0,Kt.ReadOnly);const vt=new Kt(f.depthOcclusion?W.GREATER:W.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D);if(u.hasNonElevatedBuckets){const At=!re&&f.terrain;I!==0&&At?s.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has line-z-offset enabled.`):At?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${u.id}.`):We(p,Te,ft,vi.disabled,!1,!0)}if(u.hasElevatedBuckets){R==="hd-road-markup"?B||(ft=vt,Te.push("ELEVATED_ROADS")):(Te.push("ELEVATED"),ft=vt,X&&Te.push(K?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),N&&Te.push("ELEVATION_REFERENCE_SEA"));const At=tt?f.stencilModeFor3D():vi.disabled;f.forceTerrainMode=!0,We(p,Te,ft,At,!0,!0),tt&&We(p,Te,ft,At,!0,!1),f.forceTerrainMode=!1}tt&&(f.resetStencilClippingMasks(),re&&U.clear({stencil:0})),I===0||f.depthOcclusion||re||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,n,u,p){const y=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const w=u.paint.get("fill-emissive-strength"),E=f.colorModeForDrapableLayerRenderPass(w),I=u.paint.get("fill-pattern"),R=f.opaquePassEnabledForLayer()&&!I.constantOr(1)&&y.constantOr(s.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let L="none";u.layout.get("fill-elevation-reference")!=="none"?L="road":u.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const N=!(!f.terrain||!f.terrain.enabled),B={painter:f,sourceCache:n,layer:u,coords:p,colorMode:E,elevationType:L,terrainEnabled:N,pass:R};if(f.renderPass==="shadow")return void(f.shadowRenderer&&L==="road"&&!N&&(function(W){const{painter:G,sourceCache:X,layer:K,coords:oe}=W,re=G.context.gl,ne=W.painter.shadowRenderer;for(const be of oe){const _e=X.getTile(be),ve=_e.getBucket(K);if(!ve)continue;const pe=ve.elevatedStructures;if(!pe||!pe.shadowCasterSegments||pe.shadowCasterSegments.segments[0].primitiveLength===0)continue;G.prepareDrawTile();const he=ve.bufferData.programConfigurations.get(K.id),Se=G.isTileAffectedByFog(be),ze=G.getOrCreateProgram("elevatedStructuresDepth",{config:he,overrideFog:Se}),Le=ne.calculateShadowPassMatrixFromTile(_e.tileID.toUnwrapped());G.uploadCommonUniforms(G.context,ze,be.toUnwrapped());const Ze=Lm(Le,0);ze.draw(G,re.TRIANGLES,ne.getShadowPassDepthMode(),vi.disabled,ne.getShadowPassColorMode(),di.disabled,Ze,K.id,pe.vertexBuffer,pe.indexBuffer,pe.shadowCasterSegments,K.paint,G.transform.zoom,he)}})(B));const U=f.emissiveMode==="mrt-fallback";if(L!=="offset"){if(cu(B,!1,U),L==="road"){const W=!N&&f.renderPass==="translucent";W&&Um(f,n,u,p,"geometry"),cu(B,!0,U,vi.disabled),W&&(function(G){const{painter:X,sourceCache:K,layer:oe,coords:re,colorMode:ne}=G,be=X.context.gl,_e=G.painter.shadowRenderer,ve=!!_e&&_e.enabled,pe=new Kt(X.context.gl.LEQUAL,Kt.ReadOnly,X.depthRangeFor3D);let he=[0,0,0];if(ve){const ze=X.style.directionalLight,Le=X.style.ambientLight;ze&&Le&&(he=ra(X.style,ze,Le))}const Se=ze=>{for(const Le of re){const Ze=K.getTile(Le),je=Ze.getBucket(oe);if(!je)continue;const tt=je.elevatedStructures;if(!tt)continue;let dt,Fe;if(ze?(dt=tt.renderableBridgeSegments,Fe=tt.bridgeProgramConfigurations.get(oe.id)):(dt=tt.renderableTunnelSegments,Fe=tt.tunnelProgramConfigurations.get(oe.id)),!dt||dt.segments[0].primitiveLength===0)continue;Fe.updatePaintBuffers(),X.prepareDrawTile();const Te=X.isTileAffectedByFog(Le),Ke=[];ve&&Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const We=X.getOrCreateProgram("elevatedStructures",{config:Fe,overrideFog:Te,defines:Ke}),ft=X.translatePosMatrix(Le.projMatrix,Ze,oe.paint.get("fill-translate"),oe.paint.get("fill-translate-anchor"));ve&&_e.setupShadows(Ze.tileID.toUnwrapped(),We,"vector-tile");const vt=jl(ft,he);X.uploadCommonUniforms(X.context,We,Le.toUnwrapped()),We.draw(X,be.TRIANGLES,pe,vi.disabled,ne,di.backCCW,vt,oe.id,tt.vertexBuffer,tt.indexBuffer,dt,oe.paint,X.transform.zoom,Fe,[tt.vertexBufferNormal])}};Se(!0),Se(!1)})(B)}}else cu(B,!1,U,f.stencilModeFor3D())},"fill-extrusion":function(f,n,u,p){const y=u.paint.get("fill-extrusion-opacity"),b=f.context,w=b.gl,E=f.terrain,I=E&&E.renderingToTexture;if(y===0)return;const R=f.emissiveMode==="mrt-fallback",L=f.conflationActive&&f.style.isLayerClipped(u,n.getSource()),N=f.style.order.indexOf(u.fqid);if(L&&(function(B,U,W,G,X){for(const K of G){const oe=U.getTile(K).getBucket(W);oe&&(oe.updateReplacement(K,B.replacementSource,X),oe.uploadCentroid(B.context))}})(f,n,u,p,N),E||L)for(const B of p){const U=n.getTile(B).getBucket(u);U&&Ev(f.context,n,B,U,u,E,L)}if(f.renderPass==="shadow"&&f.shadowRenderer){const B=f.shadowRenderer;if(E&&y<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const U=B.getShadowPassDepthMode(),W=B.getShadowPassColorMode();uu(f,n,u,p,U,vi.disabled,W,L)}else if(f.renderPass==="translucent"){const B=!u.paint.get("fill-extrusion-pattern").constantOr(1),U=u.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!I&&U.a!==0){const W=new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D);y===1&&B?uu(f,n,u,p,W,vi.disabled,Ii.unblended,L):(uu(f,n,u,p,W,vi.disabled,Ii.disabled,L),uu(f,n,u,p,W,f.stencilModeFor3D(),f.colorModeForRenderPass(),L),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&B&&(!E&&f.transform.projection.name!=="globe"||I)){const W=u.paint.get("fill-extrusion-opacity"),G=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),K=u.paint.get("fill-extrusion-flood-light-intensity"),oe=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",re=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(oe?null:u.lut).toArray01().slice(0,3),ne=G>0&&X>0,be=K>0,_e=(he,Se,ze)=>(1-ze)*he+ze*Se,ve=new Ph;ve.translate=u.paint.get("fill-extrusion-translate"),ve.translateAnchor=u.paint.get("fill-extrusion-translate-anchor"),ve.edgeRadius=u.layout.get("fill-extrusion-edge-radius"),ve.cutoffFadeRange=u.paint.get("fill-extrusion-cutoff-fade-range");const pe=he=>{const Se=f.depthModeForSublayer(1,Kt.ReadOnly,w.LEQUAL,!0),ze=u.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Le=_e(.1,3,ze),Ze=f._showOverdrawInspector;if(!Ze){const je=new vi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),tt=new Ii([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);Na(ve,f,n,u,p,Se,je,tt,di.disabled,he,"sdf",W,G,X,K,re,Le,L,!1)}{const je=Ze?vi.disabled:new vi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),tt=Ze?f.colorModeForRenderPass():new Ii([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],s.ao.transparent,[!0,!0,!0,!0]);Na(ve,f,n,u,p,Se,je,tt,di.disabled,he,"color",W,G,X,K,re,Le,L,!1)}};if(I){const he=()=>{const ze=E.drapeBufferSize[0],Le=E.drapeBufferSize[1];let Ze=E.framebufferCopyTexture;return Ze&&(!Ze||Ze.size[0]===ze&&Ze.size[1]===Le)||(Ze&&Ze.destroy(),Ze=E.framebufferCopyTexture=new s.T(b,new s.q({width:ze,height:Le}),w.RGBA8)),Ze.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,ze,Le),Ze},Se=(ze,Le,Ze)=>{const je=f.depthModeForSublayer(1,Kt.ReadOnly,w.LEQUAL,!1),tt=u.paint.get(ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),dt=_e(.1,3,tt);{const Fe=new Ii([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0]);Na(ve,f,n,u,p,je,vi.disabled,Fe,di.disabled,ze,"clear",W,G,X,K,re,dt,L,Le)}{const Fe=new vi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Te=new Ii([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);Na(ve,f,n,u,p,je,Fe,Te,di.disabled,ze,"sdf",W,G,X,K,re,dt,L,Le)}R&&!ze&&(Ze=he());{const Fe=ze?w.ZERO:w.ONE_MINUS_DST_ALPHA,Te=new vi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ke=new Ii([Fe,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],s.ao.transparent,[!0,!0,!0,!0]);Na(ve,f,n,u,p,je,Te,Ke,di.disabled,ze,"color",W,G,X,K,re,dt,L,Le)}if(!R||ze){const Fe=new Ii([w.ONE,w.ONE,w.ONE,ze?w.ZERO:w.ONE],s.ao.transparent,[!1,!1,!1,!0],ze?w.FUNC_ADD:w.MAX);Na(ve,f,n,u,p,je,vi.disabled,Fe,di.disabled,ze,"clear",W,G,X,K,re,dt,L,Le,Ze)}else{w.drawBuffers([w.NONE,w.COLOR_ATTACHMENT1]);const Fe=new vi({func:w.EQUAL,mask:255},254,255,w.KEEP,w.DECR,w.DECR),Te=new Ii([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!0,!1,!1,!1],w.MAX);Na(ve,f,n,u,p,je,Fe,Te,di.disabled,ze,"emissive",W,G,X,K,re,dt,L,Le,Ze),w.drawBuffers([w.COLOR_ATTACHMENT0])}};if(ne||be){let ze;f.prepareDrawTile(),R&&!ne||(ze=he()),ne&&Se(!0,!1,ze),be&&Se(!1,!0,ze)}}else ne&&pe(!0),be&&pe(!1),(ne||be)&&f.resetStencilClippingMasks()}}},building:function(f,n,u,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const y=u.paint.get("building-ambient-occlusion-ground-intensity"),b=u.paint.get("building-ambient-occlusion-ground-radius"),w=u.paint.get("building-ambient-occlusion-ground-attenuation"),E=u.paint.get("building-opacity");if(E<=0)return;let I=y>0&&b>0,R=!0;const L=u.paint.get("building-vertical-scale");if(L<=0)return;f.shadowRenderer||(R=!1);const N=f.conflationActive&&f.style.isLayerClipped(u,n.getSource()),B=f.style.order.indexOf(u.fqid);if((function(U,W,G,X,K,oe){for(const re of oe){const ne=W.getTile(re).getBucket(G);ne&&(K&&ne.updateReplacement(re,U.replacementSource,X),ne.uploadUpdatedIndexBuffer(U.context))}})(f,n,u,B,N,p),(function(U,W,G,X){for(const K of X){const oe=W.getTile(K).getBucket(G);oe&&oe.needsEvaluation()&&oe.uploadUpdatedColorBuffer(U.context)}})(f,n,u,p),u.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const U=f.shadowRenderer,W=[],G=U.getShadowPassDepthMode();hu({painter:f,source:n,layer:u,coords:p,defines:W,blendMode:U.getShadowPassColorMode(),depthMode:G,opacity:E,verticalScale:L,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let U=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];R&&(U=U.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&(U=U.concat("NORMAL_OFFSET"));const W=u.paint.get("building-facade-emissive-chance"),G=u.paint.get("building-ambient-occlusion-intensity"),X=u.paint.get("building-flood-light-intensity"),K=u.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",oe=u.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(K?null:u.lut).toArray01().slice(0,3),re=u.paint.get("building-flood-light-ground-attenuation"),ne=X>0,be=new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D);E<1&&hu({painter:f,source:n,layer:u,coords:p,defines:U,blendMode:Ii.disabled,depthMode:be,opacity:E,verticalScale:L,facadeEmissiveChance:W,facadeAOIntensity:G,floodLightIntensity:X,floodLightColor:oe,depthOnly:!0});const _e=f.colorModeForRenderPass();hu({painter:f,source:n,layer:u,coords:p,defines:U,blendMode:_e,depthMode:be,opacity:E,verticalScale:L,facadeEmissiveChance:W,facadeAOIntensity:G,floodLightIntensity:X,floodLightColor:oe}),I&&pf(f,n,u,p,!0,E,y,b,X,oe,w,N),ne&&pf(f,n,u,p,!1,E,y,b,X,oe,re,N)}else if(f.renderPass==="light-beam"){const U=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],W=new Kt(f.context.gl.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D);hu({painter:f,source:n,layer:u,coords:p,defines:U,blendMode:Ii.alphaBlended,depthMode:W,opacity:E,verticalScale:L,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,n,u,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const y=f.context,b=f.terrain&&f.terrain.renderingToTexture,[w,E]=f.renderPass!=="translucent"||b?[{},p]:f.stencilConfigForOverlap(p);for(const I of E){const R=n.getTile(I);if(R.needsHillshadePrepare&&f.renderPass==="offscreen")e1(f,R,u);else if(f.renderPass==="translucent"){const L=f.depthModeForSublayer(0,Kt.ReadOnly),N=u.paint.get("hillshade-emissive-strength"),B=f.colorModeForDrapableLayerRenderPass(N),U=b&&f.terrain?f.terrain.stencilModeForRTTOverlap(I):w[I.overscaledZ];Qw(f,I,R,u,L,U,B)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,u,p,y,b){if(f.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const w=f.transform.projection.name==="globe",E=u.paint.get("raster-elevation")!==0,I=E&&w;if(f.renderElevatedRasterBackface&&!I)return;const R=f.context,L=R.gl,N=n.getSource(),B=(function(_e,ve,pe,he,Se){const ze=ve.paint.get("raster-color"),Le=_e.type==="raster-array",Ze=[],je=ve.paint.get("raster-resampling"),tt=ve.paint.get("raster-color-mix");let dt=ve.paint.get("raster-color-range");const Fe=[tt[0],tt[1],tt[2],0],Te=tt[3];let Ke=je==="nearest"?he.NEAREST:he.LINEAR;if(Le&&(Ze.push("RASTER_ARRAY"),ze||Ze.push("RASTER_COLOR"),je==="linear"&&Ze.push("RASTER_ARRAY_LINEAR"),Ke=he.NEAREST,!dt&&_e.rasterLayers)){const We=_e.rasterLayers.find(({id:ft})=>ft===ve.sourceLayer);We&&We.fields&&We.fields.range&&(dt=We.fields.range)}if(dt=dt||[0,1],ze){Ze.push("RASTER_COLOR"),pe.activeTexture.set(he.TEXTURE2),ve.updateColorRamp(dt);let We=ve.colorRampTexture;We||(We=ve.colorRampTexture=new s.T(pe,ve.colorRamp,he.RGBA8)),We.bind(Ke,he.CLAMP_TO_EDGE)}return Se&&Ze.push("USE_MRT1"),{mix:Fe,range:dt,offset:Te,defines:Ze,resampling:Ke}})(N,u,R,L,f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback");if(N instanceof s.aU&&!p.length&&!w)return;const U=u.paint.get("raster-emissive-strength"),W=f.colorModeForDrapableLayerRenderPass(U),G=f.terrain&&f.terrain.renderingToTexture,X=!f.options.moving,K=u.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(N instanceof s.aU&&!p.length&&(N.onNorthPole||N.onSouthPole)){const _e=E?f.stencilModeFor3D():vi.disabled;return void mf(!!N.onNorthPole,null,f,n,u,U,B,di.disabled,_e)}if(!p.length)return;const[oe,re]=N instanceof s.aU||G?[{},p]:f.stencilConfigForOverlap(p),ne=re[re.length-1].overscaledZ;I&&B.defines.push("PROJECTION_GLOBE_VIEW"),E&&B.defines.push("RENDER_CUTOFF");const be=(_e,ve,pe)=>{for(const he of _e){const Se=he.toUnwrapped(),ze=n.getTile(he);if(G&&(!ze||!ze.hasData()))continue;R.activeTexture.set(L.TEXTURE0);const Le=zv(ze,N,u,B);if(!Le||!Le.texture)continue;const{texture:Ze,mix:je,offset:tt,tileSize:dt,buffer:Fe}=Le;let Te,Ke;G?(Te=Kt.disabled,Ke=he.projMatrix):E?(Te=new Kt(L.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D),Ke=w?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Se,X)):(Te=f.depthModeForSublayer(he.overscaledZ-ne,u.paint.get("raster-opacity")===1?Kt.ReadWrite:Kt.ReadOnly,L.LESS),Ke=f.transform.calculateProjMatrix(Se,X));const We=f.terrain&&G?f.terrain.stencilModeForRTTOverlap(he):oe[he.overscaledZ],ft=b?0:u.paint.get("raster-fade-duration");ze.registerFadeDuration(ft);const vt=n.findLoadedParent(he,0),At=Th(ze,vt,n,f.transform,ft);let xt,wt;!At.isFading&&ze.refreshedUponExpiration&&(ze.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),R.activeTexture.set(L.TEXTURE0),Ze.bind(K,L.CLAMP_TO_EDGE),R.activeTexture.set(L.TEXTURE1),vt?(vt.texture&&vt.texture.bind(K,L.CLAMP_TO_EDGE),xt=Math.pow(2,vt.tileID.overscaledZ-ze.tileID.overscaledZ),wt=[ze.tileID.canonical.x*xt%1,ze.tileID.canonical.y*xt%1]):Ze.bind(K,L.CLAMP_TO_EDGE),"useMipmap"in Ze&&R.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const qt=f.transform;let Gt;const Lt=E?Pv(qt):[0,0,0,0];let jt,oi,fi,Bi,Qi,Ti=0;if(I&&N instanceof s.aU&&N.coordinates.length>3)jt=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0)))),oi=Float32Array.from(qt.globeMatrix),fi=Float32Array.from(s.dF(qt)),Bi=[s.aF(qt.center.lng),s.aJ(qt.center.lat)],Gt=N.elevatedGlobePerspectiveTransform,Qi=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const wn=s.dG(he.canonical);Ti=s.dH(wn.getCenter().lat),jt=Float32Array.from(s.bk(s.dJ(he.canonical))),oi=Float32Array.from(qt.globeMatrix),fi=Float32Array.from(s.dF(qt)),Bi=[s.aF(qt.center.lng),s.aJ(qt.center.lat)],Gt=[0,0],Qi=Float32Array.from(s.dI(he.canonical,wn,Ti,qt.worldSize/qt._pixelsPerMercatorPixel))}else Gt=N instanceof s.aU?N.perspectiveTransform:[0,0],jt=new Float32Array(16),oi=new Float32Array(9),fi=new Float32Array(16),Bi=[0,0],Qi=new Float32Array(9);const an=Fm(Ke,jt,oi,fi,Qi,wt||[0,0],s.aj(f.transform.zoom),Bi,Lt,xt||1,At,u,Gt,E?u.paint.get("raster-elevation"):0,2,je,tt,B.range,dt,Fe,U),Ri=f.isTileAffectedByFog(he),En=f.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Ri});if(f.uploadCommonUniforms(R,En,Se),N instanceof s.aU){const wn=N.elevatedGlobeVertexBuffer,Mn=N.elevatedGlobeIndexBuffer;if(G||!w)N.boundsBuffer&&N.boundsSegments&&En.draw(f,L.TRIANGLES,Te,vi.disabled,W,di.disabled,an,u.id,N.boundsBuffer,f.quadTriangleIndexBuffer,N.boundsSegments);else if(wn&&Mn){const en=qt.zoom<=s.c_?N.elevatedGlobeSegments:N.getSegmentsForLongitude(qt.center.lng);en&&En.draw(f,L.TRIANGLES,Te,vi.disabled,W,ve,an,u.id,wn,Mn,en)}}else if(I){Te=new Kt(L.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D);const wn=f.globeSharedBuffers;if(wn){const[Mn,en,Oi]=wn.getGridBuffers(Ti,!1);En.draw(f,L.TRIANGLES,Te,pe||We,f.colorModeForRenderPass(),ve,an,u.id,Mn,en,Oi)}}else{const{tileBoundsBuffer:wn,tileBoundsIndexBuffer:Mn,tileBoundsSegments:en}=f.getTileBoundsBuffers(ze);En.draw(f,L.TRIANGLES,Te,We,W,di.disabled,an,u.id,wn,Mn,en)}}if(!(N instanceof s.aU)&&I)for(const he of _e){const Se=he.canonical.y===(1<<he.canonical.z)-1;he.canonical.y===0&&mf(!0,he,f,n,u,U,B,ve,pe||vi.disabled),Se&&mf(!1,he,f,n,u,U,B,ve===di.frontCW?di.backCW:di.frontCW,pe||vi.disabled)}};I?be(re,f.renderElevatedRasterBackface?di.backCW:di.frontCW,f.stencilModeFor3D()):be(re,di.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,n,u,p,y,b){f.renderPass==="offscreen"&&(function(w,E,I,R){if(!R.length)return;const L=w.context,N=L.gl,B=E.getSource();if(!(B instanceof No))return;const U=Math.ceil(Math.sqrt(I.paint.get("raster-particle-count")));let W=I.particlePositionRGBAImage;if(!W||W.width!==U){const re=(function(ne){const be=ne*ne,_e=new Uint8Array(4*be),ve=function(he){return he|=0,he=Math.imul(2747636419^he,2654435769),he=Math.imul(he^he>>>16,2654435769),((he=Math.imul(he^he>>>16,2654435769))>>>0)/4294967296},pe=.9090909090909091;for(let he=0;he<be;he++){const Se=pe*(ve(2*he+0)+lu),ze=pe*(ve(2*he+1)+lu),Le=255*Se%1,Ze=255*ze%1,je=Le,tt=ze-Ze/255,dt=Ze;_e[4*he+0]=255*(Se-Le/255),_e[4*he+1]=255*je,_e[4*he+2]=255*tt,_e[4*he+3]=255*dt}return _e})(U);W=I.particlePositionRGBAImage=new s.q({width:U,height:U},re)}let G=I.particleFramebuffer;G?G.width!==U&&(G.destroy(),G=I.particleFramebuffer=L.createFramebuffer(U,U,1,null)):G=I.particleFramebuffer=L.createFramebuffer(U,U,1,null);const X=[];for(const re of R){const ne=E.getTile(re);if(!(ne instanceof zd))continue;const be=Gm(ne,B,I);if(!be)continue;const _e=[ne.tileSize,ne.tileSize];let ve=I.tileFramebuffer;ve||(ve=I.tileFramebuffer=L.createFramebuffer(_e[0],_e[1],1,null));let pe=ne.rasterParticleState;pe||(pe=ne.rasterParticleState=new Cv(L,re,_e,W));const he=pe.update(I.lastInvalidatedAt);pe.particleTextureDimension!==U&&pe.updateParticleTexture(re,W);const Se=pe.targetColorTexture;pe.targetColorTexture=pe.backgroundColorTexture,pe.backgroundColorTexture=Se;const ze=pe.particleTexture0;pe.particleTexture0=pe.particleTexture1,pe.particleTexture1=ze,X.push([re,be,pe,he])}if(X.length===0)return;const K=s.o.now(),oe=I.previousDrawTimestamp?.001*(K-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=K,I.hasColorMap()){L.activeTexture.set(N.TEXTURE0+2);let re=I.colorRampTexture;re||(re=I.colorRampTexture=new s.T(L,I.colorRamp,N.RGBA8)),re.bind(N.LINEAR,N.CLAMP_TO_EDGE)}L.bindFramebuffer.set(I.tileFramebuffer.framebuffer),(function(re,ne,be){const _e=re.context,ve=_e.gl,pe=ne.tileFramebuffer;_e.activeTexture.set(ve.TEXTURE0);const he={u_texture:0,u_opacity:1.05*(ze=ne.paint.get("raster-particle-fade-opacity-factor"))/(ze+.05)},Se=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ze;for(const Le of be){const[,,Ze,je]=Le;pe.colorAttachment0.set(Ze.targetColorTexture.texture),_e.viewport.set([0,0,pe.width,pe.height]),_e.clear({color:s.ao.transparent}),je&&(Ze.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),Se.draw(re,ve.TRIANGLES,Kt.disabled,vi.disabled,Ii.alphaBlended,di.disabled,he,ne.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}})(w,I,X),(function(re,ne,be,_e){const ve=re.context,pe=ve.gl,he=be.tileFramebuffer,Se=re.transform.projection.name==="globe",ze=be.paint.get("raster-particle-max-speed");for(const Le of _e){const[Ze,je,tt]=Le;ve.activeTexture.set(pe.TEXTURE0+0),je.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),he.colorAttachment0.set(tt.targetColorTexture.texture);const dt=re.getOrCreateProgram("rasterParticleDraw",{defines:je.defines,overrideFog:!1});ve.activeTexture.set(pe.TEXTURE0+1);const Fe=je.scalarData?[]:[0,1,2,3].map(We=>s.e9[We](Ze));Fe.push(Ze);const Te=Ze.canonical.x,Ke=Ze.canonical.y;for(const We of Fe){const ft=ne.getTile(Se?We.wrapped():We);if(!ft)continue;const vt=ft.rasterParticleState;if(!vt)continue;const At=We.canonical.x+(1<<We.canonical.z)*(We.wrap-Ze.wrap),xt=We.canonical.y;vt.particleTexture0.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const wt=bv(1,vt.particleTexture0.size[0],[At-Te,xt-Ke],0,je.texture.size,2,ze,je.textureOffset,je.scale,je.offset);dt.draw(re,pe.POINTS,Kt.disabled,vi.disabled,Ii.alphaBlended,di.disabled,wt,be.id,vt.particleIndexBuffer,void 0,vt.particleSegment)}}})(w,E,I,X),L.bindFramebuffer.set(I.particleFramebuffer.framebuffer),(function(re,ne,be,_e){const ve=re.context,pe=ve.gl,he=ne.paint.get("raster-particle-max-speed"),Se=_e*ne.paint.get("raster-particle-speed-factor")*.15,ze=(function(Ze){return Math.pow(Ze,6)})(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),Le=ne.particleFramebuffer;ve.viewport.set([0,0,Le.width,Le.height]);for(const Ze of be){const[,je,tt]=Ze;ve.activeTexture.set(pe.TEXTURE0+0),je.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),ve.activeTexture.set(pe.TEXTURE0+1);const dt=tt.particleTexture0;dt.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const Fe=c1(1,dt.size[0],0,je.texture.size,he,Se,ze,je.textureOffset,je.scale,je.offset);Le.colorAttachment0.set(tt.particleTexture1.texture),ve.clear({color:s.ao.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:je.defines}).draw(re,pe.TRIANGLES,Kt.disabled,vi.disabled,Ii.unblended,di.disabled,Fe,ne.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}})(w,I,X,oe)})(f,n,u,p),f.renderPass==="translucent"&&((function(w,E,I,R){const L=w.context,N=L.gl,B=E.getSource().tileSize,U=5*(1-s.ah(s.cL,s.cL+1,w.transform.zoom))*B+I.paint.get("raster-particle-elevation"),W=!w.options.moving,G=w.transform.projection.name==="globe";if(!R.length)return;const[X,K]=w.stencilConfigForOverlap(R),oe=[];G&&oe.push("PROJECTION_GLOBE_VIEW");const re=w.stencilModeFor3D();for(const ne of K){const be=ne.toUnwrapped(),_e=E.getTile(ne);if(!_e.rasterParticleState)continue;const ve=_e.rasterParticleState,pe=100;_e.registerFadeDuration(pe);const he=E.findLoadedParent(ne,0),Se=Th(_e,he,E,w.transform,pe);let ze,Le;w.terrain&&w.terrain.prepareDrawTile(),L.activeTexture.set(N.TEXTURE0),ve.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),L.activeTexture.set(N.TEXTURE1),he&&he.rasterParticleState?(he.rasterParticleState.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ze=Math.pow(2,he.tileID.overscaledZ-_e.tileID.overscaledZ),Le=[_e.tileID.canonical.x*ze%1,_e.tileID.canonical.y*ze%1]):ve.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Ze=G?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(be,W),je=w.transform,tt=Rv(je),dt=s.dG(ne.canonical),Fe=s.dH(dt.getCenter().lat);let Te,Ke,We,ft,vt;G?(Te=Float32Array.from(s.bk(s.dJ(ne.canonical))),Ke=Float32Array.from(je.globeMatrix),We=Float32Array.from(s.dF(je)),ft=[s.aF(je.center.lng),s.aJ(je.center.lat)],vt=Float32Array.from(s.dI(ne.canonical,dt,Fe,je.worldSize/je._pixelsPerMercatorPixel))):(Te=new Float32Array(16),Ke=new Float32Array(9),We=new Float32Array(16),ft=[0,0],vt=new Float32Array(9));const At=l1(Ze,Te,Ke,We,vt,Le||[0,0],s.aj(w.transform.zoom),ft,tt,ze||1,Se,U),xt=w.isTileAffectedByFog(ne),wt=w.getOrCreateProgram("rasterParticle",{defines:oe,overrideFog:xt});if(w.uploadCommonUniforms(L,wt,be),G){const qt=new Kt(N.LEQUAL,Kt.ReadOnly,w.depthRangeFor3D),Gt=0,Lt=w.globeSharedBuffers;if(Lt){const[jt,oi,fi]=Lt.getGridBuffers(Fe,Gt!==0);wt.draw(w,N.TRIANGLES,qt,re,Ii.alphaBlended,w.renderElevatedRasterBackface?di.frontCCW:di.backCCW,At,I.id,jt,oi,fi)}}else{const qt=w.depthModeForSublayer(0,Kt.ReadOnly),Gt=X[ne.overscaledZ],{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:jt,tileBoundsSegments:oi}=w.getTileBoundsBuffers(_e);wt.draw(w,N.TRIANGLES,qt,Gt,Ii.alphaBlended,di.disabled,At,I.id,Lt,jt,oi)}}w.resetStencilClippingMasks()})(f,n,u,p),f.style.map.triggerRepaint())},background:function(f,n,u,p){const y=u.paint.get("background-color"),b=u.paint.get("background-color-use-theme").constantOr("default")==="none",w=u.paint.get("background-opacity"),E=u.paint.get("background-emissive-strength"),I=u.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const R=f.context,L=R.gl,N=f.transform,B=N.tileSize,U=u.paint.get("background-pattern");let W;if(U!==void 0&&(U===null||(W=f.imageManager.getPattern(s.I.from(U.toString()),u.scope,f.style.getLut(u.scope)),!W)))return;const G=!U&&y.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==G)return;const X=vi.disabled,K=f.depthModeForSublayer(0,G==="opaque"?Kt.ReadWrite:Kt.ReadOnly),oe=f.colorModeForDrapableLayerRenderPass(E),re=U?"backgroundPattern":"background";let ne,be=p;be||(ne=f.getBackgroundTiles(),be=Object.values(ne).map(ve=>ve.tileID)),U&&(R.activeTexture.set(L.TEXTURE0),f.imageManager.bind(f.context,u.scope));const _e=[];if(f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&_e.push("USE_MRT1"),I){const ve=f.getOrCreateProgram(re,{overrideFog:!1,overrideRtt:!0,defines:_e}),pe=new Float32Array(s.bA([])),he=new s.aQ(0,0,0,0,0),Se=U?Mh(pe,E,w,f,0,u.scope,W,I,{tileID:he,tileSize:B}):Hl(pe,E,w,y.toPremultipliedRenderColor(b?null:u.lut));return void ve.draw(f,L.TRIANGLES,K,X,oe,di.disabled,Se,u.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}for(const ve of be){const pe=f.isTileAffectedByFog(ve),he=f.getOrCreateProgram(re,{overrideFog:pe,defines:_e}),Se=ve.toUnwrapped(),ze=p?ve.projMatrix:f.transform.calculateProjMatrix(Se);f.prepareDrawTile();const Le=n?n.getTile(ve):ne?ne[ve.key]:new Dl(ve,B,N.zoom,f),Ze=U?Mh(ze,E,w,f,0,u.scope,W,I,{tileID:ve,tileSize:B}):Hl(ze,E,w,y.toPremultipliedRenderColor(b?null:u.lut));f.uploadCommonUniforms(R,he,Se);const{tileBoundsBuffer:je,tileBoundsIndexBuffer:tt,tileBoundsSegments:dt}=f.getTileBoundsBuffers(Le);he.draw(f,L.TRIANGLES,K,X,oe,di.disabled,Ze,u.id,je,tt,dt)}},sky:function(f,n,u){const p=f._atmosphere?s.aj(f.transform.zoom):1,y=u.paint.get("sky-opacity")*p;if(y===0)return;const b=f.context,w=u.paint.get("sky-type"),E=new Kt(b.gl.LEQUAL,Kt.ReadOnly,[0,1]),I=f.frameCounter/1e3%1;w==="atmosphere"?f.renderPass==="offscreen"?u.needsSkyboxCapture(f)&&((function(R,L){const N=R.context,B=N.gl;let U=L.skyboxFbo;if(!U){U=L.skyboxFbo=N.createFramebuffer(32,32,1,null),L.skyboxGeometry=new ls(N),L.skyboxTexture=N.gl.createTexture(),B.bindTexture(B.TEXTURE_CUBE_MAP,L.skyboxTexture),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAG_FILTER,B.LINEAR);for(let K=0;K<6;++K)B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,B.RGBA,32,32,0,B.RGBA,B.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(U.framebuffer),N.viewport.set([0,0,32,32]);const W=L.getCenter(R,!0),G=R.getOrCreateProgram("skyboxCapture"),X=new Float64Array(16);s.bA(X),s.en(X,X,.5*-Math.PI),ql(R,L,G,X,W,0),s.bA(X),s.en(X,X,.5*Math.PI),ql(R,L,G,X,W,1),s.bA(X),s.cU(X,X,.5*-Math.PI),ql(R,L,G,X,W,2),s.bA(X),s.cU(X,X,.5*Math.PI),ql(R,L,G,X,W,3),s.bA(X),ql(R,L,G,X,W,4),s.bA(X),s.en(X,X,Math.PI),ql(R,L,G,X,W,5),N.viewport.set([0,0,R.width,R.height])})(f,u),u.markSkyboxValid(f)):f.renderPass==="sky"&&(function(R,L,N,B,U){const W=R.context,G=W.gl,X=R.transform,K=R.getOrCreateProgram("skybox");W.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,L.skyboxTexture);const oe=((re,ne,be,_e,ve)=>({u_matrix:re,u_sun_direction:ne,u_cubemap:0,u_opacity:_e,u_temporal_offset:ve}))(X.skyboxMatrix,L.getCenter(R,!1),0,B,U);R.uploadCommonUniforms(W,K),K.draw(R,G.TRIANGLES,N,vi.disabled,R.colorModeForRenderPass(),di.backCW,oe,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)})(f,u,E,y,I):w==="gradient"&&f.renderPass==="sky"&&(function(R,L,N,B,U){const W=R.context,G=W.gl,X=R.transform,K=R.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new ls(W)),W.activeTexture.set(G.TEXTURE0);let oe=L.colorRampTexture;oe||(oe=L.colorRampTexture=new s.T(W,L.colorRamp,G.RGBA8)),oe.bind(G.LINEAR,G.CLAMP_TO_EDGE);const re=((ne,be,_e,ve,pe)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:be,u_radius:s.an(_e),u_opacity:ve,u_temporal_offset:pe}))(X.skyboxMatrix,L.getCenter(R,!1),L.paint.get("sky-gradient-radius"),B,U);R.uploadCommonUniforms(W,K),K.draw(R,G.TRIANGLES,N,vi.disabled,R.colorModeForRenderPass(),di.backCW,re,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)})(f,u,E,y,I)},custom:function(f,n,u,p){const y=f.context,b=u.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&u.isDraped(n)){if(f.renderPass==="offscreen"){const w=b.prerender;if(w){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const E=f.transform.pointMerc;w.call(b,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[E.x,E.y],f.transform.pixelsPerMeterRatio)}else w.call(b,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const E=b.renderToTile;if(E){const I=p[0].canonical,R={x:I.x+p[0].wrap*(b.wrapTileId?0:1<<I.z),y:I.y,z:I.z};y.setDepthMode(Kt.disabled),y.setStencilMode(vi.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),E.call(b,y.gl,R),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(vi.disabled);const w=b.renderingMode==="3d"?new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Kt.ReadOnly);if(y.setDepthMode(w),f.transform.projection.name==="globe"){const E=f.transform.pointMerc;b.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[E.x,E.y],f.transform.pixelsPerMeterRatio)}else b.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,n,u,p){if(f.renderPass==="opaque")return;const y=u.paint.get("model-opacity").constantOr(1),b=u.paint.get("model-elevation-reference"),w=b==="ground",E=b==="ground";if(y===0)return;const I=u.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!I||f.terrain&&y<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const R=f.shadowRenderer,L=u.paint.get("model-receive-shadows");R&&(R.useNormalOffset=!0,L||(R.enabled=!1));const N=()=>{R&&(R.useNormalOffset=!0,L||(R.enabled=!0))},B=n.getSource();if(f.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return(function(ne,be,_e,ve,pe){const he=ne.transform,Se=he.projection.name==="globe",ze=he.getFreeCameraOptions().position;if(!ne.modelManager)return;const Le=ne.modelManager;_e.modelManager=Le;const Ze=ne.shadowRenderer;if(!_e._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const je=_e._unevaluatedLayout._values["model-id"],tt=Object.assign({},_e.layout.get("model-id").parameters),dt=ne.style.order.indexOf(_e.fqid),Fe=_e.paint.get("model-opacity").constantOr(1);for(const Te of ve){const Ke=be.getTile(Te).getBucket(_e);if(!Ke||Ke.projection.name!==he.projection.name)continue;const We=Ke.getModelUris();if(We&&!Ke.modelsRequested&&(Le.addModelsFromBucket(We,pe),Ke.modelsRequested=!0),Se)tt.zoom=Te.overscaledZ;else{const Lt=bt(Te,he);tt.zoom=Lt}const ft=je.possiblyEvaluate(tt);if(bc(ne,Ke,Te),jo.shadowUniformsInitialized=!1,jo.useSingleShadowCascade=!!Ze&&Ze.getMaxCascadeForTile(Te.toUnwrapped())===0,ne.renderPass==="shadow"&&Ze){if(ne.currentShadowCascade===1&&Ke.isInsideFirstShadowMapFrustum)continue;const Lt=he.calculatePosMatrix(Te.toUnwrapped(),he.worldSize);if(jo.tileMatrix.set(Lt),jo.shadowTileMatrix=Float32Array.from(Ze.calculateShadowPassMatrixFromMatrix(Lt)),jo.aabb.min=[0,0,0],jo.aabb.max[0]=jo.aabb.max[1]=s.al,jo.aabb.max[2]=0,ur(Ke,jo,ne,_e.scope))continue}const vt=1<<Te.canonical.z,At=[((ze.x-Te.wrap)*vt-Te.canonical.x)*s.al,(ze.y*vt-Te.canonical.y)*s.al,ze.z*vt*s.al];ne.conflationActive&&Object.keys(Ke.instancesPerModel).length>0&&ne.style.isLayerClipped(_e,be.getSource())&&Ke.updateReplacement(Te,ne.replacementSource,dt,_e.scope)&&(Ke.uploaded=!1,Ke.upload(ne.context));let xt=0;const wt=new Array,qt=new Array,Gt=new Array;for(let Lt in Ke.instancesPerModel){const jt=Ke.instancesPerModel[Lt];jt.features.length>0&&!Se&&(Lt=ft.evaluate(jt.features[0].feature,{}));const oi=Le.getModel(Lt,pe);if(oi||Le.hasURLBeenRequested(Lt)||Ke.modelUris.includes(Lt)||(Ke.modelUris.push(Lt),Ke.modelsRequested=!1),oi&&oi.uploaded)if(Se){const fi=s.c5([],[ze.x,ze.y,ze.z],ne.transform.worldSize);s.ew(fi,fi);for(let Bi=0;Bi<jt.instancedDataArray.length;++Bi){const Qi=[0,0,0],Ti=[1,1,1],an=s.ex(),Ri=jt.tileCoordinatesForInstance(Bi),En=jt.transformForInstance(Bi);s.ey(Ti,En),s.ez(an,En),s.eA(Qi,an);const wn=jt.translationForInstance(Bi),Mn=new s.aT(0,0);s.eB(Ke.canonical,Mn,Ri.x,Ri.y);const en=s.bC();s.eC(en,oi,ne.transform,Mn,Qi,Ti,wn,!0,!1,!1);const Oi=jt.colorForInstance(Bi),gn=s.bA([]),tr=s.ef(Mn.lat,ne.transform.zoom),ir=s.bq([],[1,1,1/tr]);s.br(gn,gn,fi),Gt.push({zScaleMatrix:ir,negCameraPosMatrix:gn});for(const _n of oi.nodes)Ch(ne,_n,en,ne.transform.expandedFarZProjMatrix,xt,wt,qt,oi.materialOverrides,Fe,Oi);++xt}}else for(const fi of oi.nodes)Pt(ne,_e,fi,jt,At,Te,jo)}if(Se)if(ne.renderPass==="shadow"){for(const Lt of qt)du(Lt.mesh,Lt.nodeModelMatrix,ne,_e);for(const Lt of wt)du(Lt.mesh,Lt.nodeModelMatrix,ne,_e)}else Qm(ne,_e,wt,qt,Gt)}})(f,n,u,p,zh(f,u)),void N();if(!B.loaded())return;if(B.type==="batched-model")return(function(ne,be,_e,ve){_e.resetLayerRenderingStats(ne);const pe=ne.context,he=ne.transform,Se=ne.style.fog,ze=ne.shadowRenderer;if(he.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${he.projection.name} projection is not yet implemented`);const Le=ne.transform.getFreeCameraOptions().position,Ze=s.c5([],[Le.x,Le.y,Le.z],ne.transform.worldSize),je=s.ew([],Ze),tt=s.bA([]),dt=s.ef(he.center.lat,he.zoom),Fe=s.bq([],[1,1,1/dt]);s.br(tt,tt,je);const Te=_e.paint.get("model-opacity").constantOr(1),Ke=new Kt(pe.gl.LEQUAL,Kt.ReadWrite,ne.depthRangeFor3D),We=new Kt(pe.gl.LEQUAL,Kt.ReadOnly,ne.depthRangeFor3D),ft=new s.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),vt=ne.renderPass==="shadow",At=vt&&ze?ze.getCurrentCascadeFrustum():he.getFrustum(he.scaleZoom(he.worldSize)),xt=_e.paint.get("model-front-cutoff"),wt=xt[2]<1,qt=na(ne,_e.paint.get("model-cutoff-fade-range")),Gt=_e.getLayerRenderingStats();(function(Lt,jt,oi,fi){const Bi=Lt.terrain?Lt.terrain.exaggeration():0,Qi=Lt.transform.zoom;for(const Ti of fi){const an=jt.getTile(Ti).getBucket(oi);an&&(an.setFilter(oi.filter),Lt.conflationActive&&an.updateReplacement(Ti,Lt.replacementSource),an.evaluateTransform(Lt,oi),Lt.terrain&&Bi>0&&an.elevationUpdate(Lt.terrain,Bi,Ti,oi.source),an.needsReEvaluation(Lt,Qi,oi)&&an.evaluate(oi))}})(ne,be,_e,ve),(function(){let Lt,jt,oi;wt?(Lt=ve.length-1,jt=-1,oi=-1):(Lt=0,jt=ve.length,oi=1);const fi=new Float64Array(16),Bi=s.cA(),Qi=new s.P(0,0);for(let Ti=Lt;Ti!==jt;Ti+=oi){const an=ve[Ti],Ri=be.getTile(an).getBucket(_e);if(!Ri||!Ri.uploaded)continue;let En=!1;ze&&(En=ze.getMaxCascadeForTile(an.toUnwrapped())===0);const wn=he.calculatePosMatrix(an.toUnwrapped(),he.worldSize),Mn=Ri.modelTraits;!vt&&wt&&(s.bl(fi,wn),s.af(Bi,Ze,fi),Qi.x=Bi[0],Qi.y=Bi[1]);const en=[];Ri.setFilter(_e.filter);for(const Oi of Ri.getNodesInfo()){if(Oi.hiddenByReplacement||!Oi.node.meshes)continue;const gn=Oi.node;let tr=0;ne.terrain&&gn.elevation&&(tr=gn.elevation*ne.terrain.exaggeration());const ir=(()=>{const yn=Oi.aabb;return ft.min=[...yn.min],ft.max=[...yn.max],ft.min[2]+=tr,ft.max[2]+=tr,s.af(ft.min,ft.min,wn),s.af(ft.max,ft.max,wn),ft})(),_n=Oi.evaluatedScale;if(_n[0]<=1&&_n[1]<=1&&_n[2]<=1&&ir.intersects(At)===0)continue;if(!vt&&wt){const yn=.16666666666666666;Oi.cameraCollisionOpacity=Ze[0]>ir.min[0]&&Ze[0]<ir.max[0]&&Ze[1]>ir.min[1]&&Ze[1]<ir.max[1]&&Ze[2]*dt<ir.max[2]&&gn.footprint&&s.c0(Qi,gn.footprint)?Math.max(Oi.cameraCollisionOpacity-yn,0):Math.min(1,Oi.cameraCollisionOpacity+yn)}const Ji=[...wn],Fi=1/s.d7(an.canonical),Nn=gn.anchor?gn.anchor[0]:0,hr=gn.anchor?gn.anchor[1]:0;s.br(Ji,Ji,[Nn*(_n[0]-1)+Oi.evaluatedTranslation[0]*Fi,hr*(_n[1]-1)+Oi.evaluatedTranslation[1]*Fi,tr+Oi.evaluatedTranslation[2]]),s.cq(_n,s.eE)||s.cS(Ji,Ji,_n);const jn=s.aB([],Ji,gn.globalMatrix),qn=s.aB([],he.expandedFarZProjMatrix,jn),Ho=s.aB([],he.expandedFarZProjMatrix,Ji),cs=s.aC([],[Nn,hr,tr,1],qn)[2];gn.hidden=!1;let oo=Te;vt||(wt&&(oo*=Oi.cameraCollisionOpacity,oo*=Nv(Ji,he,Oi.aabb,xt)),oo*=ke(qt,cs)),oo!==0?en.push({nodeInfo:Oi,depth:cs,opacity:oo,wvpForNode:qn,wvpForTile:Ho,nodeModelMatrix:jn,tileModelMatrix:Ji}):gn.hidden=!0}vt||en.sort((Oi,gn)=>!wt||Oi.opacity===1&&gn.opacity===1?Oi.depth<gn.depth?-1:1:Oi.opacity===1?-1:gn.opacity===1?1:Oi.depth>gn.depth?-1:1);for(const Oi of en){const gn=Oi.nodeInfo,tr=gn.node;let ir=s.aB([],Fe,Oi.tileModelMatrix);s.aB(ir,tt,ir);const _n=s.bl([],ir);s.eg(_n,_n),s.cS(_n,_n,fu),ir=s.aB(ir,ir,tr.globalMatrix);const Ji=ne.renderPass==="light-beam",Fi=_e.paint.get("model-color-use-theme").constantOr("default")==="none",Nn=Mn&s.eI.HasMapboxMeshFeatures,hr=Nn?0:gn.evaluatedRMEA[0][2];for(let jn=0;jn<tr.meshes.length;++jn){const qn=tr.meshes[jn],Ho=jn===tr.lightMeshIndex;let cs=Oi.wvpForNode;if(Ho){if(!Ji&&!ne.terrain&&ne.shadowRenderer){ne.currentLayer<ne.firstLightBeamLayer&&(ne.firstLightBeamLayer=ne.currentLayer);continue}cs=Oi.wvpForTile}else if(Ji)continue;const oo={defines:[]},yn=[];if(!vt&&ze&&(ze.useNormalOffset=!!qn.normalBuffer),ga(oo.defines,yn,qn,ne,Fi?null:_e.lut),Nn||oo.defines.push("DIFFUSE_SHADED"),En&&oo.defines.push("SHADOWS_SINGLE_CASCADE"),Gt&&(vt?Gt.numRenderedVerticesInShadowPass+=qn.vertexArray.length:Gt.numRenderedVerticesInTransparentPass+=qn.vertexArray.length),vt){du(qn,Oi.nodeModelMatrix,ne,_e);continue}let xs=null;if(Se){const Ir=Km(Oi.nodeModelMatrix,ne.transform);if(xs=new Float32Array(Ir),he.projection.name!=="globe"){const Gn=qn.aabb.min,Lr=qn.aabb.max,[Io,br]=Se.getOpacityForBounds(Ir,Gn[0],Gn[1],Lr[0],Lr[1]);oo.overrideFog=Io>=Ft||br>=Ft}}const Eo=qn.material;let Zo;Eo.occlusionTexture&&Eo.occlusionTexture.offsetScale&&(Zo=Eo.occlusionTexture.offsetScale,oo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const sa=ne.getOrCreateProgram("model",oo);!vt&&ze&&ze.setupShadowsFromMatrix(Oi.tileModelMatrix,sa,ze.useNormalOffset),ne.uploadCommonUniforms(pe,sa,null,xs);const Wo=Eo.pbrMetallicRoughness;Wo.metallicFactor=.9,Wo.roughnessFactor=.5;const rr=cf(new Float32Array(cs),new Float32Array(ir),new Float32Array(_n),new Float32Array(tr.globalMatrix),ne,Oi.opacity,Wo.baseColorFactor,Eo.emissiveFactor,Wo.metallicFactor,Wo.roughnessFactor,Eo,hr,_e,[0,0,0],Zo);!Ho&&(gn.hasTranslucentParts||Oi.opacity<1)&&sa.draw(ne,pe.gl.TRIANGLES,Ke,vi.disabled,Ii.disabled,di.backCCW,rr,_e.id,qn.vertexBuffer,qn.indexBuffer,qn.segments,_e.paint,ne.transform.zoom,void 0,yn),sa.draw(ne,pe.gl.TRIANGLES,Ho?We:Ke,vi.disabled,Ho||Oi.opacity<1||gn.hasTranslucentParts?Ii.alphaBlended:Ii.unblended,di.backCCW,rr,_e.id,qn.vertexBuffer,qn.indexBuffer,qn.segments,_e.paint,ne.transform.zoom,void 0,yn)}}}})()})(f,n,u,p),void N();if(B.type!=="model")return;const U=B.getModels(),W=[],G=f.transform.getFreeCameraOptions().position,X=s.c5([],[G.x,G.y,G.z],f.transform.worldSize);s.ew(X,X);const K=[],oe=[];let re=0;for(const ne of U){const be=n.getFeatureState("",ne.id),_e={type:"Unknown",id:ne.id,properties:ne.featureProperties},ve=u.paint.get("model-rotation").evaluate(_e,be),pe=u.paint.get("model-scale").evaluate(_e,be),he=u.paint.get("model-translation").evaluate(_e,be),Se=u.paint.get("model-opacity").evaluate(_e,be);Fv(u,ne.id,be,ne.featureProperties,ne.nodeOverrideNames,ne.nodeOverrides),Bv(u,ne.id,be,ne.featureProperties,ne.materialOverrideNames,ne.materialOverrides),ne.nodeOverrides.size>0&&ne.computeBoundsAndApplyParent(),ne.computeModelMatrix(f,ve,pe,he,E,w,!1);const ze=s.bA([]),Le=s.ef(ne.position.lat,f.transform.zoom),Ze=s.bq([],[1,1,1/Le]);s.br(ze,ze,X),W.push({zScaleMatrix:Ze,negCameraPosMatrix:ze});for(const je of ne.nodes)Ch(f,je,ne.matrix,f.transform.expandedFarZProjMatrix,re,K,oe,ne.materialOverrides,Se);re++}if(K.sort((ne,be)=>be.depth-ne.depth),f.renderPass!=="shadow")Qm(f,u,K,oe,W),N();else{for(const ne of oe)du(ne.mesh,ne.nodeModelMatrix,f,u);for(const ne of K)du(ne.mesh,ne.nodeModelMatrix,f,u);N()}}},og={line:function(f,n,u){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const p=n.getVisibleCoordinates();for(const y of p){const b=n.getTile(y).getBucket(f);if(b&&(b.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,n,u){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,zh(u,f)));if(p.type==="batched-model"||p.type!=="model")return;const y=p.getModels();for(const b of y)b.upload(u.context)},raster:function(f,n,u){const p=n.getSource();if(!(p instanceof No&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=f.paint.get("raster-array-band")||p.getInitialBand(y);if(b==null)return;const w=n.getIds().map(E=>n.getTileByID(E));for(const E of w)E.updateNeeded(f.id,b)&&p.prepareTile(E,y,f.id,b)},"raster-particle":function(f,n,u){const p=n.getSource();if(!(p instanceof No&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=f.paint.get("raster-particle-array-band")||p.getInitialBand(y);if(b==null)return;const w=n.getIds().map(E=>n.getTileByID(E));for(const E of w)E.updateNeeded(f.id,b)&&p.prepareTile(E,y,f.id,b)}},sg={fill:Um},Vv={fill:function(f,n,u,p){if(!u.layout||u.layout.get("fill-elevation-reference")==="none"||u.paint.get("fill-opacity").constantOr(1)===0)return;const y=f.context.gl,b=new Kt(y.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D),w=new vi({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),E=f.transform.getFreeCameraOptions().position,I=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const R of p){const L=n.getTile(R),N=L.getBucket(u);if(!N)continue;const B=N.elevatedStructures;if(!B||B.depthSegments.segments[0].primitiveLength===0)continue;const U=Nm(R.toUnwrapped(),E),W=f.translatePosMatrix(R.projMatrix,L,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),G=yc(W,U,0,1,0);I.draw(f,y.TRIANGLES,b,w,Ii.disabled,di.disabled,G,u.id,B.vertexBuffer,B.indexBuffer,B.depthSegments,u.paint,f.transform.zoom)}}};class jv{constructor(n,u,p,y,b){this.context=new hf(n,u),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const I of w)this._debugParams.enabledLayers[I]=!0;for(const I of w);this.occlusionParams=new tg,this.setup(),this.numSublayers=is.maxUnderzooming+is.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new mh(this),this._wireframeDebugCache=new eg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const E=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,E,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=b,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(n,u){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new zm(this,n));const y=this._terrain;this.transform.elevation=p?y:null,y.update(n,this.transform,u),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(n){const u=n.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=u.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const b=p+.78*(y-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new zm(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,u){if(this.width=n*s.o.devicePixelRatio,this.height=u*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,u=new s.bd;u.emplaceBack(0,0),u.emplaceBack(s.al,0),u.emplaceBack(0,s.al),u.emplaceBack(s.al,s.al),this.tileExtentBuffer=n.createVertexBuffer(u,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const p=new s.bd;p.emplaceBack(0,0),p.emplaceBack(s.al,0),p.emplaceBack(0,s.al),p.emplaceBack(s.al,s.al),this.debugBuffer=n.createVertexBuffer(p,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const y=new s.bd;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const b=new s.b1;b.emplaceBack(0,0,0,0),b.emplaceBack(s.al,0,s.al,0),b.emplaceBack(0,s.al,0,s.al),b.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=n.createVertexBuffer(b,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const w=new s.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const E=new s.be;for(const R of[0,1,3,2,0])E.emplaceBack(R);this.debugIndexBuffer=n.createIndexBuffer(E),this.emptyTexture=new s.T(n,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=s.bC();const I=this.context.gl;this.stencilClearMode=new vi({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Kt.disabled,this.stencilClearMode,Ii.disabled,di.disabled,Sh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,u,p){if(!u||this.currentStencilSource===u.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const I of p)if(this._tileClippingMaskIDs[I.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=u.id;const y=this.context,b=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(Ii.disabled),y.setDepthMode(Kt.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of p){const I=u.getTile(E),R=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:N,tileBoundsSegments:B}=this.getTileBoundsBuffers(I);w.draw(this,b.TRIANGLES,Kt.disabled,new vi({func:b.ALWAYS,mask:0},R,255,b.KEEP,b.KEEP,b.REPLACE),Ii.disabled,di.disabled,Sh(E.projMatrix),"$clipping",L,N,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,u=this.context.gl;return new vi({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const u=this.context.gl;return new vi({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(n){const u=this.context.gl,p=n.sort((w,E)=>E.overscaledZ-w.overscaledZ),y=p[p.length-1].overscaledZ,b=p[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const w={};for(let E=0;E<b;E++)w[E+y]=new vi({func:u.GEQUAL,mask:255},E+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[w,p]}return[{[y]:vi.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Ii([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ii.unblended:Ii.alphaBlended}colorModeForDrapableLayerRenderPass(n){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?n!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Ii([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,n??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Ii([u.ONE,u.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,u.ONE_MINUS_SRC_ALPHA],s.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(n,u,p,y=!1){if(this.depthOcclusion)return new Kt(this.context.gl.GREATER,Kt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Kt.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Kt(p||this.context.gl.LEQUAL,u,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,u=Math.ceil(this.width),p=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===u&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),u!==0&&p!==0&&(this.depthFBO=new xc(this.context,u,p,0,"texture"),this.depthTexture=new s.T(this.context,{width:u,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),n.bindTexture(n.TEXTURE_2D,b),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,u,p,0,0,u,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,u)=>n+u/this._fpsHistory.length,0))}render(n,u){const p=s.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=u;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(b).filter(Fe=>{const Te=y[Fe];return!(Te.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Te.type]});let E=w(),I=!1,R=!1,L=null,N=0,B=!1;for(const Fe of E){const Te=y[Fe];Te.visibility!=="none"&&(Te.type==="circle"?I=!0:Te.type==="building"?(L=Te,++N):Te.type==="symbol"&&(Te.hasOcclusionOpacityProperties?R=!0:I=!0))}this.updateEmissiveMode();let U=E.map(Fe=>y[Fe]);const W=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();for(const Fe in W){const Te=W[Fe];Te.used&&(Te.prepare(this.context),Te.getSource().usedInConflation&&++N)}let G=!1;for(const Fe of U)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(G=!0),this.prepareLayer(Fe));const X={},K={},oe={},re={},ne={};for(const Fe in W){const Te=W[Fe];X[Fe]=Te.getVisibleCoordinates(),K[Fe]=X[Fe].slice().reverse(),oe[Fe]=Te.getVisibleCoordinates(!0).reverse(),re[Fe]=Te.getShadowCasterCoordinates(),ne[Fe]=Te.sortCoordinatesByDistance(X[Fe])}const be=Fe=>{const Te=this.style.getLayerSourceCache(Fe);return Te&&Te.used?Te.getSource():null};if(N||G||this._clippingActiveLastFrame){const Fe=[],Te=[];let Ke=0;for(const We of U)this.isSourceForClippingOrConflation(We,be(We))&&(Fe.push(We),Te.push(Ke)),Ke++;if(Fe&&(G||Fe.length>1)||this._clippingActiveLastFrame){G=!1;const We=[];for(let ft=0;ft<Fe.length;ft++){const vt=Fe[ft],At=Te[ft],xt=this.style.getLayerSourceCache(vt);if(!xt||!xt.used||!xt.getSource().usedInConflation&&vt.type!=="clip"&&vt.type!=="building")continue;let wt=s.eQ,qt=s.b_.None;const Gt=[];let Lt=!0;if(vt.type==="building")wt=s.eS;else if(vt.type==="clip")if(wt=At,vt.isHidden(this.transform.zoom))Lt=!1;else{if(!vt.layout){Lt=!1;continue}for(const jt of vt.layout.get("clip-layer-types"))qt|=jt==="model"?s.b_.Model:jt==="symbol"?s.b_.Symbol:s.b_.FillExtrusion;for(const jt of vt.layout.get("clip-layer-scope"))Gt.push(jt);G=!0}Lt&&We.push({layer:vt.fqid,cache:xt,order:wt,clipMask:qt,clipScope:Gt})}this.replacementSource.setSources(We),B=!0}}this._clippingActiveLastFrame=G,B||this.replacementSource.clear(),this.conflationActive=B,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<U.length;Fe++){const Te=U[Fe];if(Te.visibility==="none")continue;const Ke=Te.cutoffRange();if(this.longestCutoffRange=Math.max(Ke,this.longestCutoffRange),Ke>0){const We=be(Te);We&&(this.minCutoffZoom=Math.max(We.minzoom,this.minCutoffZoom)),Te.minzoom&&(this.minCutoffZoom=Math.max(Te.minzoom,this.minCutoffZoom))}Te.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const _e=this.style&&this.style.fog;_e?(this._fogVisible=_e.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=_e.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(oe),this.opaquePassCutoff=0,E=w(),U=E.map(Fe=>y[Fe]));const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in W)for(const Te of X[Fe]){let Ke={min:0,max:0};this.terrain&&(Ke=this.terrain.getMinMaxForTile(Te)||Ke),ve.addShadowReceiver(Te.toUnwrapped(),Ke.min,Ke.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Jm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),he=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(pe&&!this._snow&&(this._snow=new Lh(this)),!pe&&this._snow&&(this._snow.destroy(),delete this._snow),he&&!this._rain&&(this._rain=new $v(this)),!he&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),L){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ym);const Fe=this.style.getLayerSourceCache(L);this.buildingTileBorderManager.updateBorders(Fe,L)}if(!zi.has(this.context.gl))return;this.renderPass="offscreen";for(const Fe of U){const Te=n.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const Ke=Te?K[Te.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||Ke&&Ke.length)&&this.renderLayer(this,Te,Fe,Ke)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,re)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ze=(()=>{if(u.showOverdrawInspector)return s.ao.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const Te=this.style.getLut(Fe.scope);if(!Se){const Ke=Fe.properties.get("color-use-theme")==="none",We=Fe.properties.get("color").toNonPremultipliedRenderColor(Ke?null:Te).toArray01();return new s.ao(...We)}if(Se){const Ke=Fe.properties.get("space-color-use-theme")==="none",We=Fe.properties.get("space-color").toNonPremultipliedRenderColor(Ke?null:Te).toArray01();return new s.ao(...We)}}return s.ao.transparent})();if(this.context.clear({color:ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=U[this.currentLayer],Te=n.getLayerSourceCache(Fe);if(Fe.isSky())continue;const Ke=Te?(Fe.is3D(b)?ne:K)[Te.id]:void 0;this._renderTileClippingMasks(Fe,Te,Ke),this.renderLayer(this,Te,Fe,Ke)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const Fe=U[this.currentLayer],Te=n.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,Te,Fe,Te?K[Te.id]:void 0)}function Le(Fe,Te){let Ke;return Te&&(Ke=(Fe.type==="symbol"?oe:Fe.is3D(b)?ne:K)[Te.id]),Ke}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const Fe=U[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){const Te=n.getLayerSourceCache(Fe);this.renderLayer(this,Te,Fe,Le(Fe,Te))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const Ze=ve?ve.getGroundShadowLayerIndex():-1;let je=!1,tt=-1;for(let Fe=0;Fe<E.length;++Fe){const Te=U[Fe];Te.isHidden(this.transform.zoom)||Te.is3D(b)&&(tt=Fe)}R&&tt===-1&&(I=!0);let dt=!1;for(;this.currentLayer<E.length;){const Fe=U[this.currentLayer],Te=n.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!dt&&Fe.is3D(b)&&!b){const Ke=this.currentLayer,We=ft=>{for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const vt=U[this.currentLayer];if(sg[vt.type]){const At=this.style.getLayerSourceCache(vt);sg[vt.type](this,At,vt,Le(vt,At),ft)}}};We("initialize"),We("reset"),this.currentLayer=Ke,dt=!0}if(I&&!je&&this.terrain&&!this.transform.isOrthographic&&(je=!0,this.blitDepth()),R&&tt!==-1&&this.currentLayer===tt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Fe,Te,Te?X[Te.id]:void 0),this.renderLayer(this,Te,Fe,Le(Fe,Te)),!this.terrain&&ve&&this.currentLayer===Ze){{this.clearStencil(),this.resetStencilClippingMasks();const Ke=this.currentLayer;for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const We=U[this.currentLayer];if(Vv[We.type]){const ft=this.style.getLayerSourceCache(We);Vv[We.type](this,ft,We,Le(We,ft))}}this.currentLayer=Ke}if(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ke=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ke;this.currentLayer++){const We=U[this.currentLayer];if(!We.hasLightBeamPass())continue;const ft=n.getLayerSourceCache(We);this.renderLayer(this,ft,We,ft?K[ft.id]:void 0)}this.currentLayer=Ke,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ke=this.currentLayer;this.depthOcclusion=!0;for(const We of this.layersWithOcclusionOpacity){this.currentLayer=We;const ft=U[this.currentLayer],vt=n.getLayerSourceCache(ft),At=vt?K[vt.id]:void 0;this.terrain||this._renderTileClippingMasks(ft,vt,vt?X[vt.id]:void 0),this.renderLayer(this,vt,ft,At)}this.depthOcclusion=!1,this.currentLayer=Ke,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;U.forEach(Te=>{const Ke=n.getLayerSourceCache(Te);Ke&&!Te.isHidden(this.transform.zoom)&&Ke.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<Ke.getSource().maxzoom)&&(Fe=Ke)}),Fe&&this.options.showTileBoundaries&&Lv(this,Fe,Fe.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Lv(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Fe){const Te=Fe.transform.padding;Dv(Fe,Fe.transform.height-(Te.top||0),3,Hm),Dv(Fe,Te.bottom||0,3,Zm),qm(Fe,Te.left||0,3,Wm),qm(Fe,Fe.transform.width-(Te.right||0),3,h1);const Ke=Fe.transform.centerPoint;(function(We,ft,vt,At){gf(We,ft-1,vt-10,2,20,At),gf(We,ft-10,vt-1,20,2,At)})(Fe,Ke.x,Fe.transform.height-Ke.y,d1)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),B||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:u}=this.transform.projection,p=!u||!u.includes(n.type);if(og[n.type]&&(p||this.terrain&&n.type==="custom")){const y=this.style.getLayerSourceCache(n);og[n.type](n,y,this)}this.gpuTimingEnd()}renderLayer(n,u,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||wc[p.type](n,u,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,p=this.context.gl;let y=this.gpuTimers[n.id];y||(y=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),y.calls++,p.beginQuery(u.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,u=this.context.gl,p=u.createQuery();this.deferredRenderGpuTimeQueries.push(p),u.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const u={};for(const p in n){const y=n[p],b=this.context.extTimerQuery,w=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),u[p]=w}return u}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.gl;let p=0;for(const y of n)p+=u.getQueryParameter(y,u.QUERY_RESULT)/1e6,u.deleteQuery(y);return p}translatePosMatrix(n,u,p,y,b){if(!p[0]&&!p[1])return n;const w=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(w){const R=Math.sin(w),L=Math.cos(w);p=[p[0]*L-p[1]*R,p[0]*R+p[1]*L]}const E=[b?p[0]:s.ay(u,p[0],this.transform.zoom),b?p[1]:s.ay(u,p[1],this.transform.zoom),0],I=new Float32Array(16);return s.br(I,n,E),I}saveTileTexture(n){if(n.context!==this.context)return;const u=n.size[0],p=this._tileTextures[u];p?p.push(n):this._tileTextures[u]=[n]}getTileTexture(n){const u=this._tileTextures[n];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,u,p){const y=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||u!==void 0&&!u||b.push("FOG"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,u){this.cache=this.cache||{};const p=u&&u.defines||[],y=u&&u.config,b=this.currentGlobalDefines(n,u&&u.overrideFog,u&&u.overrideRtt).concat(p),w=fv.cacheKey(_m[n],n,b,y);return this.cache[w]||(this.cache[w]=new fv(this.context,n,_m[n],y,uf[n],b)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,u){if(this.style.enable3dLights()){const p=this.style.directionalLight,y=this.style.ambientLight;if(p&&y){const b=((w,E,I)=>{const R=w.properties.get("direction"),L=w.properties.get("color-use-theme")==="none",N=w.properties.get("color").toNonPremultipliedRenderColor(L?null:I.getLut(w.scope)).toArray01(),B=w.properties.get("intensity"),U=E.properties.get("color-use-theme")==="none",W=E.properties.get("color").toNonPremultipliedRenderColor(U?null:I.getLut(E.scope)).toArray01(),G=E.properties.get("intensity"),X=[R.x,R.y,R.z],K=s.dN(W,G),oe=s.dN(N,B);return{u_lighting_ambient_color:K,u_lighting_directional_dir:X,u_lighting_directional_color:oe,u_ground_radiance:au(X,oe,K)}})(p,y,this.style);u.setLightsUniformValues(n,b)}}}uploadCommonUniforms(n,u,p,y,b){if(this.uploadCommonLightUniforms(n,u),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const E=w.getOpacity(this.transform.pitch),I=((R,L,N,B,U,W,G,X,K,oe,re,ne)=>{const be=R.transform,_e=L.properties.get("color-use-theme")==="none",ve=L.properties.get("color").toNonPremultipliedRenderColor(_e?null:R.style.getLut(L.scope)).toArray01();ve[3]=B;const pe=R.frameCounter/1e3%1,[he,Se]=L.properties.get("vertical-range");return{u_fog_matrix:N?be.calculateFogTileMatrix(N):ne||R.identityMat,u_fog_range:L.getFovAdjustedRange(be._fov),u_fog_color:ve,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,Se),Se],u_fog_temporal_offset:pe,u_frustum_tl:U,u_frustum_tr:W,u_frustum_br:G,u_frustum_bl:X,u_globe_pos:K,u_globe_radius:oe,u_viewport:re,u_globe_transition:s.aj(be.zoom),u_is_globe:+(be.projection.name==="globe")}})(this,w,p,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],y);u.setFogUniformValues(n,I)}b&&u.setCutoffUniformValues(n,b.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,u=n.createTexture();return n.bindTexture(n.TEXTURE_2D,u),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,u=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)u[y.key]=n[y.key]||new Dl(y,512,this.transform.tileZoom,this,void 0,this.worldview);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,u){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!u||u.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[n.key];return u||(this._cachedTileFogOpacities[n.key]=u=this.style.fog.getOpacityForTile(n)),u[0]>=Ft||u[1]>=Ft}setupDepthForOcclusion(n,u,p){const y=this.context,b=y.gl,w=!!p;var E;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),w||u.setTerrainUniformValues(y,p)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const n=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=n?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Gv(f,n){let u=!1,p=null;const y=()=>{p=null,u&&(f(),p=setTimeout(y,n),u=!1)};return()=>(u=!0,p||y(),p)}class Go{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Gv(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const u=Hv(n);if(this._hashName){const p=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map(w=>{const E=w.split("=")[0];return E===p?(y=!0,`${E}=${u}`):w}).filter(w=>w);return y||b.push(`${p}=${u}`),`#${b.join("&")}`}return`#${u}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let u;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(u=p)}),(u&&u[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(p=>isNaN(Number(p)))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(u[3]||0):n.getBearing();return n.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:p,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Hv(f,n){const u=f.getCenter(),p=Math.round(100*f.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),w=Math.round(u.lng*b)/b,E=Math.round(u.lat*b)/b,I=f.getBearing(),R=f.getPitch();let L=n?`/${w}/${E}/${p}`:`${p}/${E}/${w}`;return(I||R)&&(L+="/"+Math.round(10*I)/10),R&&(L+=`/${Math.round(R)}`),L}const Jl={linearity:.3,easing:s.eT(0,0,.3,1)},g1=Object.assign({deceleration:2500,maxSpeed:1400},Jl),Wn=Object.assign({deceleration:20,maxSpeed:1400},Jl),Yi=Object.assign({deceleration:1e3,maxSpeed:360},Jl),Zv=Object.assign({deceleration:1e3,maxSpeed:90},Jl);class Yl{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,u=s.o.now();for(;n.length>0&&u-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(u.pan.mag()){const b=pl(u.pan.mag(),p,Object.assign({},g1,n||{}));y.offset=u.pan.mult(b.amount/u.pan.mag()),y.center=this._map.transform.center,fl(y,b)}if(u.zoom){const b=pl(u.zoom,p,Wn);y.zoom=this._map.transform.zoom+b.amount,fl(y,b)}if(u.bearing){const b=pl(u.bearing,p,Yi);y.bearing=this._map.transform.bearing+s.aA(b.amount,-179,179),fl(y,b)}if(u.pitch){const b=pl(u.pitch,p,Zv);y.pitch=this._map.transform.pitch+b.amount,fl(y,b)}if(y.zoom||y.bearing){const b=u.pinchAround===void 0?u.around:u.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function fl(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function pl(f,n,u){const{maxSpeed:p,linearity:y,deceleration:b}=u,w=s.aA(f*y/(n/1e3),-p,p),E=Math.abs(w)/(b*y);return{easing:u.easing,duration:1e3*E,amount:w*(E/2)}}class yo extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,p,y={}){const b=zt(u.getCanvasContainer(),p),w=u.unproject(b);super(n,Object.assign({point:b,lngLat:w,originalEvent:p},y)),this._defaultPrevented=!1,this.target=u}}class mu extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,p){const y=n==="touchend"?p.changedTouches:p.touches,b=pt(u.getCanvasContainer(),y),w=b.map(I=>u.unproject(I)),E=b.reduce((I,R,L,N)=>I.add(R.div(N.length)),new s.P(0,0));super(n,{points:b,point:E,lngLats:w,lngLat:u.unproject(E),originalEvent:p}),this._defaultPrevented=!1}}class ag extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class lg{constructor(n,u){this._map=n,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new ag(this._map,n))}mousedown(n,u){return this._mousedownPos=u,this._firePreventable(new yo(n.type,this._map,n))}mouseup(n){this._map.fire(new yo(n.type,this._map,n))}preclick(n){const u=new MouseEvent("preclick",n);this._map.fire(new yo(u.type,this._map,u))}click(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(n),this._map.fire(new yo(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new yo(n.type,this._map,n))}mouseover(n){this._map.fire(new yo(n.type,this._map,n))}mouseout(n){this._map.fire(new yo(n.type,this._map,n))}touchstart(n){return this._firePreventable(new mu(n.type,this._map,n))}touchmove(n){this._map.fire(new mu(n.type,this._map,n))}touchend(n){this._map.fire(new mu(n.type,this._map,n))}touchcancel(n){this._map.fire(new mu(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cg{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new yo(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new yo(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class oa{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(Ve(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(n,u){if(!this._active)return;const p=u,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const w=Math.min(y.x,p.x),E=Math.max(y.x,p.x),I=Math.min(y.y,p.y),R=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${I}px)`,this._box.style.width=E-w+"px",this._box.style.height=R-I+"px")})}mouseupWindow(n,u){if(!this._active)return;const p=this._startPos,y=u;if(p&&n.button===0){if(this.reset(),Ye(),p.x!==y.x||p.y!==y.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ne(),delete this._startPos,delete this._lastPos}_fireEvent(n,u){return this._map.fire(new s.z(n,{originalEvent:u}))}}function $a(f,n){const u={};for(let p=0;p<f.length;p++)u[f[p].identifier]=n[p];return u}class gu{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=(function(y){const b=new s.P(0,0);for(const w of y)b._add(w);return b.div(y.length)})(u),this.touches=$a(p,u)))}touchmove(n,u,p){if(this.aborted||!this.centroid)return;const y=$a(p,u);for(const b in this.touches){const w=y[b];(!w||w.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,u,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class _u{constructor(n){this.singleTap=new gu(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,u,p){this.singleTap.touchstart(n,u,p)}touchmove(n,u,p){this.singleTap.touchmove(n,u,p)}touchend(n,u,p){const y=this.singleTap.touchend(n,u,p);if(y){const b=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(y)<30;if(b&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class ug{constructor(){this._zoomIn=new _u({numTouches:1,numTaps:2}),this._zoomOut=new _u({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,u,p){this._zoomIn.touchstart(n,u,p),this._zoomOut.touchstart(n,u,p)}touchmove(n,u,p){this._zoomIn.touchmove(n,u,p),this._zoomOut.touchmove(n,u,p)}touchend(n,u,p){const y=this._zoomIn.touchend(n,u,p),b=this._zoomOut.touchend(n,u,p);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(y)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const hg=0,Kl=2,dg={[hg]:1,[Kl]:2},Us={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Dh{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,u){return!1}_move(n,u){return{}}mousedown(n,u){if(this._lastPoint)return;const p=St(n);this._correctButton(n,p)&&(this._lastPoint=u,this._eventButton=p)}mousemoveWindow(n,u){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&(function(y,b){const w=dg[b];return y.buttons===void 0||(y.buttons&w)!==w})(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(p,u)}}mouseupWindow(n){this._lastPoint&&St(n)===this._eventButton&&(this._moved&&Ye(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vf extends Dh{mousedown(n,u){super.mousedown(n,u),this._lastPoint&&(this._active=!0)}_correctButton(n,u){return u===0&&!n.ctrlKey}_move(n,u){return{around:u,panDelta:u.sub(n)}}}class xf extends Dh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Us[n.pitchRotateKey]:void 0}_correctButton(n,u){return this._pitchRotateKey?u===0&&n[this._pitchRotateKey]:u===0&&n.ctrlKey||u===2}_move(n,u){const p=.8*(u.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class bf extends Dh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Us[n.pitchRotateKey]:void 0}_correctButton(n,u){return this._pitchRotateKey?u===0&&n[this._pitchRotateKey]:u===0&&n.ctrlKey||u===2}_move(n,u){const p=-.5*(u.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Hr{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,u,p){return this._calculateTransform(n,u,p)}touchmove(n,u,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,u,p)}}touchend(n,u,p){this._calculateTransform(n,u,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,u,p){p.length>0&&(this._active=!0);const y=$a(p,u),b=new s.P(0,0),w=new s.P(0,0);let E=0;for(const R in y){const L=y[R],N=this._touches[R];N&&(b._add(L),w._add(L.sub(N)),E++,y[R]=L)}if(this._touches=y,E<this._minTouches||!w.mag())return;const I=w.div(E);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(E),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class kh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,u,p){return{}}touchstart(n,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(n,u,p){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[b,w]=y,E=yu(p,u,b),I=yu(p,u,w);if(!E||!I)return;const R=this._aroundCenter?null:E.add(I).div(2);return this._move([E,I],R,n)}touchend(n,u,p){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,w=yu(p,u,y),E=yu(p,u,b);w&&E||(this._active&&Ye(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yu(f,n,u){for(let p=0;p<f.length;p++)if(f[p].identifier===u)return n[p]}function wf(f,n){return Math.log2(f/n)}class Sc extends kh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,u){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(wf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wf(this._distance,p),pinchAround:u}}}function Sf(f,n){return 180*f.angleWith(n)/Math.PI}class fg extends kh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,u){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Sf(this._vector,p),pinchAround:u}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const u=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const y=Sf(n,p);return Math.abs(y)<u}}function Oh(f){return Math.abs(f.y)>Math.abs(f.x)}class Tc extends kh{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Oh(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,u,p){const y=this._lastPoints;if(!y)return;const b=n[0].sub(y[0]),w=n[1].sub(y[1]);return this._map._cooperativeGestures&&!s.eU()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,w,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+w.y)/2*-.5})}gestureBeginsVertically(n,u,p){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,b=u.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=n.y>0==u.y>0;return Oh(n)&&Oh(u)&&w}}const pg={panStep:100,bearingStep:15,pitchStep:10};class Fh{constructor(){const n=pg;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let u=0,p=0,y=0,b=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:E=>{const I=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:mg,zoom:u?Math.round(I)+u*(n.shiftKey?2:1):I,bearing:E.getBearing()+p*this._bearingStep,pitch:E.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function mg(f){return f*(2-f)}const Bh=4.000244140625,gg=1/450;class Tf{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=gg,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=s.o.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,u!==0&&u%Bh===0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=u,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=zt(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>Bh?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&L!==0&&(L=1/L);const N=u(),B=Math.pow(2,N),U=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(U*L))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:u(),y=this._startZoom,b=this._easing;let w,E=!1;if(this._type==="wheel"&&y&&b){const R=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),L=b(R);w=s.ak(y,p,L),R<1?this._frameId||(this._frameId=!0):E=!0}else w=p,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=w-u();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let u=s.eV;if(this._prevEase){const p=this._prevEase,y=(s.o.now()-p.start)/p.duration,b=p.easing(y+.01)-p.easing(y),w=.27/Math.sqrt(b*b+1e-4)*.01,E=Math.sqrt(.0729-w*w);u=s.eT(w,E,.25,1)}return this._prevEase={start:s.o.now(),duration:n,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Wv{constructor(n,u){this._clickZoom=n,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qv{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,u){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(u)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xv{constructor(){this._tap=new _u({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,u,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=u[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,u,p))}touchmove(n,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=u[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,u,p)}touchend(n,u,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,u,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jv{constructor(n,u,p){this._el=n,this._mousePan=u,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yv{constructor(n,u,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Kv{constructor(n,u,p,y){this._el=n,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Nh=f=>f.zoom||f.drag||f.pitch||f.rotate;class Qv extends s.z{}class ex{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,u){const p=s.av([],u,n);this.radius=s.ag(p[2]<0?s.eX([],p,this.constants):[p[0],p[1],0])}projectRay(n){s.eX(n,n,this.constants),s.aw(n,n),s.eY(n,n,this.constants);const u=s.c5([],n,this.radius);if(u[2]>0){const p=s.c5([],[0,0,1],s.bJ(u,[0,0,1])),y=s.c5([],s.aw([],[u[0],u[1],0]),this.radius),b=s.d8([],u,s.c5([],s.av([],s.d8([],y,p),u),2));u[0]=b[0],u[1]=b[1]}return u}}function Uh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class tx{constructor(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yl(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ex,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),s.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,w]of this._listeners){const E=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,E,w)}}destroy(){for(const[n,u,p]of this._listeners){const y=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(u,y,p)}}_addDefaultHandlers(n){const u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new lg(u,n));const y=u.boxZoom=new oa(u,n);this._add("boxZoom",y);const b=new ug,w=new qv;u.doubleClickZoom=new Wv(w,b),this._add("tapZoom",b),this._add("clickZoom",w);const E=new Xv;this._add("tapDragZoom",E);const I=u.touchPitch=new Tc(u);this._add("touchPitch",I);const R=new xf(n),L=new bf(n);u.dragRotate=new Yv(n,R,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const N=new vf(n),B=new Hr(u,n);u.dragPan=new Jv(p,N,B),this._add("mousePan",N),this._add("touchPan",B,["touchZoom","touchRotate"]);const U=new fg,W=new Sc;u.touchZoomRotate=new Kv(p,W,U,E),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new cg(u));const G=u.scrollZoom=new Tf(u,this);this._add("scrollZoom",G,["mousePan"]);const X=u.keyboard=new Fh;this._add("keyboard",X);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[K]&&u[K].enable(n[K])}_add(n,u,p){this._handlers.push({handlerName:n,handler:u,allowed:p}),this._handlersById[n]=u}stop(n){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Nh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,u,p){for(const y in n)if(y!==p&&(!u||u.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const u=[];for(const p of n)this._el.contains(p.target)&&u.push(p);return u}handleEvent(n,u){this._updatingCamera=!0;const p=n.type==="renderFrame",y=p?void 0:n,b={needsRenderFrame:!1},w={},E={},I=n.touches?this._getMapTouches(n.touches):void 0,R=I?pt(this._el,I):p?void 0:zt(this._el,n);for(const{handlerName:B,handler:U,allowed:W}of this._handlers){if(!U.isEnabled())continue;let G;this._blockedByActive(E,W,B)?U.reset():U[u||n.type]&&(G=U[u||n.type](n,R,I),this.mergeHandlerResult(b,w,G,B,y),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||U.isActive())&&(E[B]=U)}const L={};for(const B in this._previousActiveHandlers)E[B]||(L[B]=y);this._previousActiveHandlers=E,(Object.keys(L).length||Uh(b))&&(this._changes.push([b,w,L]),this._triggerRenderFrame()),(Object.keys(E).length||Uh(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=b;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(n,u,p,y,b){if(!p)return;Object.assign(n,p);const w={handlerName:y,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(u.zoom=w),p.panDelta!==void 0&&(u.drag=w),p.pitchDelta!==void 0&&(u.pitch=w),p.bearingDelta!==void 0&&(u.rotate=w)}_applyChanges(){const n={},u={},p={};for(const[y,b,w]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),Object.assign(u,b),Object.assign(p,w);this._updateMapTransform(n,u,p),this._changes=[]}_updateMapTransform(n,u,p){const y=this._map,b=y.transform,w=oe=>[oe.x,oe.y,oe.z];if((()=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!Uh(n)){const oe=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),oe!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!Uh(n))return void this._fireEvents(u,p,!0);let{panDelta:E,zoomDelta:I,bearingDelta:R,pitchDelta:L,around:N,aroundCoord:B,pinchAround:U}=n;b._isCameraConstrained&&(I>0&&(I=0),b._isCameraConstrained=!1),U!==void 0&&(N=U),(I||(oe=>u[oe]&&!this._eventsInProgress[oe])("drag"))&&N&&(this._dragOrigin=w(b.pointCoordinate3D(N)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),N=N||y.transform.centerPoint,R&&(b.bearing+=R),L&&(b.pitch+=L),b._updateCameraState();const W=[0,0,0];if(E)if(b.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N).dir),re=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N.sub(E)).dir);W[0]=re[0]-oe[0],W[1]=re[1]-oe[1]}else{const oe=b.pointCoordinate(N);if(b.projection.name==="globe"){E=E.rotate(-b.angle);const re=b._pixelsPerMercatorPixel/b.worldSize;W[0]=-E.x*s.eW(s.a$(oe.y))*re,W[1]=-E.y*s.eW(b.center.lat)*re}else{const re=b.pointCoordinate(N.sub(E));oe&&re&&(W[0]=re.x-oe.x,W[1]=re.y-oe.y)}}const G=b.zoom,X=[0,0,0];if(I){const oe=w(B||b.pointCoordinate3D(N)),re={dir:s.aw([],s.av([],oe,b._camera.position))};if(re.dir[2]<0){const ne=b.zoomDeltaToMovement(oe,I);s.c5(X,re.dir,ne)}}const K=s.d8(W,W,X);b._translateCameraConstrained(K),I&&Math.abs(b.zoom-G)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,p,!0)}_fireEvents(n,u,p){const y=Nh(this._eventsInProgress),b=Nh(n),w={};for(const L in n){const{originalEvent:N}=n[L];this._eventsInProgress[L]||(w[`${L}start`]=N),this._eventsInProgress[L]=n[L]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in w)this._fireEvent(L,w[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in n){const{originalEvent:N}=n[L];this._fireEvent(L,N)}const E={};let I;for(const L in this._eventsInProgress){const{handlerName:N,originalEvent:B}=this._eventsInProgress[L];this._handlersById[N].isActive()||(delete this._eventsInProgress[L],I=u[N]||B,E[`${L}end`]=I)}for(const L in E)this._fireEvent(L,E[L]);const R=Nh(this._eventsInProgress);if(p&&(y||b)&&!R){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;L?(N(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:I})):(this._map.fire(new s.z("moveend",{originalEvent:I})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,u){this._map.fire(new s.z(n,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Qv("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const _g="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ix extends s.E{constructor(n,u){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(n,u){return this.jumpTo({center:n},u)}panBy(n,u,p){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},u),p)}panTo(n,u,p){return this.easeTo(Object.assign({center:n},u),p)}getZoom(){return this.transform.zoom}setZoom(n,u){return this.jumpTo({zoom:n},u),this}zoomTo(n,u,p){return this.easeTo(Object.assign({zoom:n},u),p)}zoomIn(n,u){return this.zoomTo(this.getZoom()+1,n,u),this}zoomOut(n,u){return this.zoomTo(this.getZoom()-1,n,u),this}getBearing(){return this.transform.bearing}setBearing(n,u){return this.jumpTo({bearing:n},u),this}getPadding(){return this.transform.padding}setPadding(n,u){return this.jumpTo({padding:n},u),this}rotateTo(n,u,p){return this.easeTo(Object.assign({bearing:n},u),p)}resetNorth(n,u){return this.rotateTo(0,Object.assign({duration:1e3},n),u),this}resetNorthPitch(n,u){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),u),this}snapToNorth(n,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,u):this}getPitch(){return this.transform.pitch}setPitch(n,u){return this.jumpTo({pitch:n},u),this}cameraForBounds(n,u){n=s.aI.convert(n);const p=u&&u.bearing||0,y=u&&u.pitch||0,b=n.getNorthWest(),w=n.getSouthEast();return this._cameraForBounds(this.transform,b,w,p,y,u)}_extendPadding(n){const u={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},u,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},u,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,u){const p=u.max[0]-u.min[0],y=u.max[1]-u.min[1];return p/y>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,u,p,y,b,w){const E=n.clone(),I=this._extendCameraOptions(w);E.bearing=y,E.pitch=b;const R=s.aT.convert(u),L=s.aT.convert(p),N=.5*(R.lat+L.lat),B=.5*(R.lng+L.lng),U=s.eZ(N,B),W=s.aw([],U),G=s.aw([],s.bI([],W,[0,1,0])),X=s.bI([],G,W),K=[G[0],G[1],G[2],0,X[0],X[1],X[2],0,W[0],W[1],W[2],0,0,0,0,1],oe=[U,s.eZ(R.lat,R.lng),s.eZ(L.lat,R.lng),s.eZ(L.lat,L.lng),s.eZ(R.lat,L.lng),s.eZ(N,R.lng),s.eZ(N,L.lng),s.eZ(R.lat,B),s.eZ(L.lat,B)];let re=s.d9.fromPoints(oe.map(We=>[s.bJ(G,We),s.bJ(X,We),s.bJ(W,We)]));const ne=s.af([],re.center,K);s.e_(ne)===0&&s.e$(ne,0,0,1),s.aw(ne,ne),s.c5(ne,ne,s.aD),E.center=s.f0(ne);const be=E.getWorldToCameraMatrix(),_e=s.bl(new Float64Array(16),be);re=s.d9.applyTransform(re,s.aB([],be,K));const ve=this._extendAABB(re,E,I,y);if(!ve)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=ve,s.af(ne,ne,be);const pe=.5*(re.max[2]-re.min[2]),he=this._minimumAABBFrustumDistance(E,re),Se=s.c5([],[0,0,1],pe),ze=s.d8(Se,ne,Se),Le=he+(E.pitch===0?0:s.bG(ne,ze)),Ze=E.globeCenterInViewSpace,je=s.av([],ne,[Ze[0],Ze[1],Ze[2]]);s.aw(je,je),s.c5(je,je,Le);const tt=s.d8([],ne,je);s.af(tt,tt,_e);const dt=s.eM/s.aD,Fe=s.ag(tt),Te=s.cf(Math.max(Fe*dt-s.eM,Number.EPSILON),0),Ke=Math.min(E.zoomFromMercatorZAdjusted(Te),I.maxZoom);return Ke>.5*(s.c_+s.cL)?(E.setProjection({name:"mercator"}),E.zoom=Ke,this._cameraForBounds(E,u,p,y,b,w)):{center:E.center,zoom:Ke,bearing:y,pitch:b}}_extendAABB(n,u,p,y){const b=.5*((p.padding.left||0)+(p.padding.right||0)),w=.5*((p.padding.top||0)+(p.padding.bottom||0)),E=w,I=b,R=b,L=w,N=u.width-(I+R),B=u.height-(E+L),U=s.av([],n.max,n.min),W=Math.min(N/U[0],B/U[1]),G=Math.min(u.scaleZoom(u.scale*W),p.maxZoom);if(isNaN(G))return null;const X=u.scale/u.zoomScale(G),K=new s.d9([n.min[0]-I*X,n.min[1]-L*X,n.min[2]],[n.max[0]+R*X,n.max[1]+E*X,n.max[2]]),oe=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new s.P(p.offset.x,p.offset.y):s.P.convert(p.offset)).rotate(-s.an(y));return K.center[0]-=oe.x*X,K.center[1]+=oe.y*X,K}queryTerrainElevation(n,u){const p=this.transform.elevation;return p?(u=Object.assign({},{exaggerated:!0},u),p.getAtPoint(s.ae.fromLngLat(n),null,u.exaggerated)):null}_cameraForBounds(n,u,p,y,b,w){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,u,p,y,b,w);const E=n.clone(),I=this._extendCameraOptions(w);E.bearing=y,E.pitch=b;const R=s.aT.convert(u),L=s.aT.convert(p),N=new s.aT(R.lng,L.lat),B=new s.aT(L.lng,R.lat),U=E.project(R),W=E.project(L),G=this.queryTerrainElevation(R),X=this.queryTerrainElevation(L),K=this.queryTerrainElevation(N),oe=this.queryTerrainElevation(B),re=[[U.x,U.y,Math.min(G||0,X||0,K||0,oe||0)],[W.x,W.y,Math.max(G||0,X||0,K||0,oe||0)]];let ne=s.d9.fromPoints(re);const be=E.getWorldToCameraMatrix(),_e=s.bl(new Float64Array(16),be);ne=s.d9.applyTransform(ne,be);const ve=this._extendAABB(ne,E,I,y);if(!ve)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=ve;const pe=.5*s.av([],ne.max,ne.min)[2],he=this._minimumAABBFrustumDistance(E,ne),Se=[0,0,1,0];s.aC(Se,Se,be),s.f1(Se,Se);const ze=s.c5([],Se,he+pe),Le=s.d8([],ne.center,ze);s.af(ne.center,ne.center,_e),s.af(Le,Le,_e);const Ze=E.unproject(new s.P(ne.center[0],ne.center[1])),je=s.f2(E.projection,Ze),tt=Math.pow(2,je),dt=Math.min(E._zoomFromMercatorZ(Le[2]*E.pixelsPerMeter*tt/E.worldSize),I.maxZoom);return E.mercatorFromTransition&&dt<.5*(s.c_+s.cL)?(E.setProjection({name:"globe"}),E.zoom=dt,this._cameraForBounds(E,u,p,y,b,w)):{center:Ze,zoom:dt,bearing:y,pitch:b}}fitBounds(n,u,p){const y=this.cameraForBounds(n,u);return this._fitInternal(y,u,p)}fitScreenCoordinates(n,u,p,y,b){const w=s.P.convert(n),E=s.P.convert(u),I=new s.P(Math.min(w.x,E.x),Math.min(w.y,E.y)),R=new s.P(Math.max(w.x,E.x),Math.max(w.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,E))return this;const L=this.transform.pointLocation3D(I),N=this.transform.pointLocation3D(R),B=this.transform.pointLocation3D(new s.P(I.x,R.y)),U=this.transform.pointLocation3D(new s.P(R.x,I.y)),W=[Math.min(L.lng,N.lng,B.lng,U.lng),Math.min(L.lat,N.lat,B.lat,U.lat)],G=[Math.max(L.lng,N.lng,B.lng,U.lng),Math.max(L.lat,N.lat,B.lat,U.lat)],X=y&&y.pitch?y.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,W,G,p,X,y);return this._fitInternal(K,y,b)}_fitInternal(n,u,p){return n?(u=Object.assign(n,u)).linear?this.easeTo(u,p):this.flyTo(u,p):this}jumpTo(n,u){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,w=!1;"zoom"in n&&p.zoom!==+n.zoom&&(y=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=s.aT.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(b=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(w=!0,p.pitch=+n.pitch);const E=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(E))if(n.retainPadding===!1){const I=p.clone();I.padding=E,p.setLocationAtPoint(p.center,I.centerPoint)}else p.padding=E;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.z("movestart",u)).fire(new s.z("move",u)),y&&this.fire(new s.z("zoomstart",u)).fire(new s.z("zoom",u)).fire(new s.z("zoomend",u)),b&&this.fire(new s.z("rotatestart",u)).fire(new s.z("rotate",u)).fire(new s.z("rotateend",u)),w&&this.fire(new s.z("pitchstart",u)).fire(new s.z("pitch",u)).fire(new s.z("pitchend",u)),this.fire(new s.z("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(_g),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,u){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.w(_g),this;this.stop();const y=p.zoom,b=p.pitch,w=p.bearing;p.setFreeCameraOptions(n);const E=y!==p.zoom,I=b!==p.pitch,R=w!==p.bearing;return this.fire(new s.z("movestart",u)).fire(new s.z("move",u)),E&&this.fire(new s.z("zoomstart",u)).fire(new s.z("zoom",u)).fire(new s.z("zoomend",u)),R&&this.fire(new s.z("rotatestart",u)).fire(new s.z("rotate",u)).fire(new s.z("rotateend",u)),I&&this.fire(new s.z("pitchstart",u)).fire(new s.z("pitch",u)).fire(new s.z("pitchend",u)),this.fire(new s.z("moveend",u)),this}easeTo(n,u){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:s.eV},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,y=this.getZoom(),b=this.getBearing(),w=this.getPitch(),E=this.getPadding(),I="zoom"in n?+n.zoom:y,R="bearing"in n?this._normalizeBearing(n.bearing,b):b,L="pitch"in n?+n.pitch:w,N=this._extendPadding(n.padding),B=s.P.convert(n.offset);let U,W,G;if(p.projection.name==="globe"){const Se=s.ae.fromLngLat(p.center),ze=B.rotate(-p.angle);Se.x+=ze.x/p.worldSize,Se.y+=ze.y/p.worldSize;const Le=Se.toLngLat(),Ze=s.aT.convert(n.center||Le);this._normalizeCenter(Ze),U=p.centerPoint.add(ze),W=new s.P(Se.x,Se.y).mult(p.worldSize),G=new s.P(s.aF(Ze.lng),s.aJ(Ze.lat)).mult(p.worldSize).sub(W)}else{U=p.centerPoint.add(B);const Se=p.pointLocation(U),ze=s.aT.convert(n.center||Se);this._normalizeCenter(ze),W=p.project(Se),G=p.project(ze).sub(W)}const X=p.zoomScale(I-y);let K,oe;n.around&&(K=s.aT.convert(n.around),oe=p.locationPoint(K));const re=this._zooming||I!==y,ne=this._rotating||b!==R,be=this._pitching||L!==w,_e=!p.isPaddingEqual(N),ve=n.retainPadding===!1?p.clone():p,pe=Se=>ze=>{if(re&&(Se.zoom=s.ak(y,I,ze)),ne&&(Se.bearing=s.ak(b,R,ze)),be&&(Se.pitch=s.ak(w,L,ze)),_e&&(ve.interpolatePadding(E,N,ze),U=ve.centerPoint.add(B)),K)Se.setLocationAtPoint(K,oe);else{const Le=Se.zoomScale(Se.zoom-y),Ze=I>y?Math.min(2,X):Math.max(.5,X),je=Math.pow(Ze,1-ze),tt=Se.unproject(W.add(G.mult(ze*je)).mult(Le));Se.setLocationAtPoint(Se.renderWorldCopies?tt.wrap():tt,U)}return n.preloadOnly||this._fireMoveEvents(u),Se};if(n.preloadOnly){const Se=this._emulate(pe,n.duration,p);return this._preloadTiles(Se),this}const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ne,this._pitching=be,this._padding=_e,this._easeId=n.easeId,this._prepareEase(u,n.noMoveStart,he),this._ease(pe(p),Se=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(u,Se)},n),this}_prepareEase(n,u,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||p.moving||this.fire(new s.z("movestart",n)),this._zooming&&!p.zooming&&this.fire(new s.z("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new s.z("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new s.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.z("move",n)),this._zooming&&this.fire(new s.z("zoom",n)),this._rotating&&this.fire(new s.z("rotate",n)),this._pitching&&this.fire(new s.z("pitch",n))}_afterEase(n,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.z("zoomend",n)),y&&this.fire(new s.z("rotateend",n)),b&&this.fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n))}flyTo(n,u){if(this._prefersReducedMotion(n)){const We=s.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(We,u)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eV},n);const p=this.transform,y=this.getZoom(),b=this.getBearing(),w=this.getPitch(),E=this.getPadding(),I="zoom"in n?s.aA(+n.zoom,p.minZoom,p.maxZoom):y,R="bearing"in n?this._normalizeBearing(n.bearing,b):b,L="pitch"in n?+n.pitch:w,N=this._extendPadding(n.padding),B=p.zoomScale(I-y),U=s.P.convert(n.offset);let W=p.centerPoint.add(U);const G=p.pointLocation(W),X=s.aT.convert(n.center||G);this._normalizeCenter(X);const K=p.project(G),oe=p.project(X).sub(K);let re=n.curve;const ne=Math.max(p.width,p.height),be=ne/B,_e=oe.mag();if("minZoom"in n){const We=s.aA(Math.min(n.minZoom,y,I),p.minZoom,p.maxZoom),ft=ne/p.zoomScale(We-y);re=Math.sqrt(ft/_e*2)}const ve=re*re;function pe(We){const ft=(be*be-ne*ne+(We?-1:1)*ve*ve*_e*_e)/(2*(We?be:ne)*ve*_e);return Math.log(Math.sqrt(ft*ft+1)-ft)}function he(We){return(Math.exp(We)-Math.exp(-We))/2}function Se(We){return(Math.exp(We)+Math.exp(-We))/2}const ze=pe(0);let Le=function(We){return Se(ze)/Se(ze+re*We)},Ze=function(We){return ne*((Se(ze)*(he(ft=ze+re*We)/Se(ft))-he(ze))/ve)/_e;var ft},je=(pe(1)-ze)/re;if(Math.abs(_e)<1e-6||!isFinite(je)){if(Math.abs(ne-be)<1e-6)return this.easeTo(n,u);const We=be<ne?-1:1;je=Math.abs(Math.log(be/ne))/re,Ze=function(){return 0},Le=function(ft){return Math.exp(We*re*ft)}}n.duration="duration"in n?+n.duration:1e3*je/("screenSpeed"in n?+n.screenSpeed/re:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const tt=b!==R,dt=L!==w,Fe=!p.isPaddingEqual(N),Te=n.retainPadding===!1?p.clone():p,Ke=We=>ft=>{const vt=ft*je,At=1/Le(vt);We.zoom=ft===1?I:y+We.scaleZoom(At),tt&&(We.bearing=s.ak(b,R,ft)),dt&&(We.pitch=s.ak(w,L,ft)),Fe&&(Te.interpolatePadding(E,N,ft),W=Te.centerPoint.add(U));const xt=ft===1?X:We.unproject(K.add(oe.mult(Ze(vt))).mult(At));return We.setLocationAtPoint(We.renderWorldCopies?xt.wrap():xt,W),We._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(u),We};if(n.preloadOnly){const We=this._emulate(Ke,n.duration,p);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=tt,this._pitching=dt,this._padding=Fe,this._prepareEase(u,!1),this._ease(Ke(p),()=>this._afterEase(u),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,u)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,u,p){p.animate===!1||p.duration===0?(n(1),u()):(this._easeStart=s.o.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,u){n=s.bT(n,-180,180);const p=Math.abs(n-u);return Math.abs(n-360-u)<p&&(n-=360),Math.abs(n+360-u)<p&&(n+=360),n}_normalizeCenter(n){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const p=n.lng-u.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,u,p){const y=Math.ceil(15*u/1e3),b=[],w=n(p.clone());for(let E=0;E<=y;E++){const I=w(E/y);b.push(I.clone())}return b}_preloadTiles(n,u){}}class nx{constructor(n={}){this.options=n,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const u=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=se("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const y=se("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",p),this._innerContainer=se("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(n){const p=u.reduce((y,b,w)=>(b.value&&(y+=`${b.key}=${b.value}${w<u.length-1?"&":""}`),y),"?");n.href=`${s.e.FEEDBACK_URL}/${p}#${Hv(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const u=this._map.style._mergedSourceCaches;for(const y in u){const b=u[y];if(b.used){const w=b.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((y,b)=>y.length-b.length),n=n.filter((y,b)=>{for(let w=b+1;w<n.length;w++)if(n[w].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.map(y=>(function(b){const w=new DOMParser().parseFromString(b,"text/html");return Array.from(w.body.querySelectorAll("*")).reverse().forEach(E=>{const I=E.textContent||"";if(E.tagName!=="A")return void E.replaceWith(...E.childNodes);const R=E.getAttribute("href");if(!R||!/^(https?:|mailto:)/i.test(R))return void E.replaceWith(w.createTextNode(I));const L=w.createElement("a");L.href=R,L.textContent=I,L.rel="noopener nofollow";const N=E.getAttribute("class");N&&(L.className=N),E.replaceWith(L)}),w.body.innerHTML})(y)).join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class rx{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=se("div","mapboxgl-ctrl");const u=se("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const u in n){const p=n[u].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class ox{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u}remove(n){const u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(const y of p)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const p of u)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class er{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const u=s.dD((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,u,p){this._start=this.getValue(u),this._end=n,this._startTime=u,this._endTime=u+p}}const sx={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use âŒ˜ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ax extends s.z{constructor(n,u,p,y){const{point:b,lngLat:w,originalEvent:E,target:I}=n;super(n.type,{point:b,lngLat:w,originalEvent:E,target:I}),this.preventDefault=()=>{n.preventDefault()},this.id=u,this.interaction=p,this.feature=y}}class _1{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,u){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const p=u.filter;let y=u.type;p&&this.filters.set(n,s.b6(p)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,u)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(n,u),this.typeById.set(n,y)}get(n){const u=this.typeById.get(n);if(!u)return;const p=this.interactionsByType.get(u);return p?p.get(n):void 0}remove(n){const u=this.typeById.get(n);if(!u)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(u);p&&(p.delete(n),u==="mouseenter"||u==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(u,this.handleType))}queryTargets(n,u){const p=[];for(const[y,b]of u)b.target&&p.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(n,p,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const u=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());u.length&&(n.type="mouseenter",this.handleType(n,u));const p=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||p.set(b.id,b);p.size&&(n.type="mouseleave",this.handleType(n,Array.from(p.values())))}handleOut(n){const u=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);u.length&&(n.type="mouseleave",this.handleType(n,u)),this.hoveredFeatures.clear()}handleType(n,u){const p=n.type==="mouseenter";if(p&&!this.interactionsByType.has(n.type))return void s.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(n.type)).reverse(),b=!!u;u=u||this.queryTargets(n.point,y);let w=!1;const E=new Set;for(const I of u){for(const[R,L]of y){if(!L.target)continue;const N=I.variants?I.variants[R]:null;if(N){for(const B of N){if(nh(B,I,E,R))continue;const U=new s.dx(I,B),W=ks(B,I,R);b&&U.id!==void 0&&(U.state=this.map.getFeatureState(U));const G=p?this.prevHoveredFeatures.get(W):null,X=new ax(n,R,L,U),K=G?G.stop:L.handler(X);if(p&&this.hoveredFeatures.set(W,{feature:I,stop:K}),K!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[I,R]of y){const{handler:L,target:N}=R;if(!N&&L(new ax(n,I,R,null))!==!1)break}}}function y1(f,n){if(Array.isArray(f)&&Array.isArray(n)){const u=new Set(f),p=new Set(n);return u.size===p.size&&f.every(y=>p.has(y))}return s.by(f,n)}const $h={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},lx={showCompass:!0,showZoom:!0,visualizePitch:!1};class yg{constructor(n,u,p=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new xf({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new bf({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),Ve()}move(n,u){const p=this.map,y=this.mouseRotate.mousemoveWindow(n,u),b=y&&y.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,u),E=w&&w.pitchDelta;E&&p.setPitch(p.getPitch()+E)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ne(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),zt(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,zt(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=pt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Vh(f,n,u){if(f=new s.aT(f.lng,f.lat),n){const p=new s.aT(f.lng-360,f.lat),y=new s.aT(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),w=u.locationPoint3D(f).distSqr(n),E=n.x<0||n.y<0||n.x>u.width||n.y>u.height;u.locationPoint3D(p).distSqr(n)<w&&(E||Math.abs(p.lng-u.center.lng)<b)?f=p:u.locationPoint3D(y).distSqr(n)<w&&(E||Math.abs(y.lng-u.center.lng)<b)&&(f=y)}for(;Math.abs(f.lng-u.center.lng)>180;){const p=u.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=u.width&&p.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}const _a={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},$s={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Rr extends s.E{constructor(n,u){super(),(n instanceof HTMLElement||u)&&(n=Object.assign({element:n},u)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:y="#3FB1CE",scale:b=1,draggable:w=!1,clickTolerance:E=0,rotation:I=$s.rotation,rotationAlignment:R=$s.rotationAlignment,pitchAlignment:L=$s.pitchAlignment,occludedOpacity:N=$s.occludedOpacity,altitude:B=$s.altitude}=n||{};this._anchor=p,this._color=y,this._scale=b,this._draggable=w,this._clickTolerance=E,this._rotation=I,this._rotationAlignment=R,this._pitchAlignment=L,this._occludedOpacity=N,this._altitude=B,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",G=>{G.preventDefault()}),this._element.addEventListener("mousedown",G=>{G.preventDefault()});const U=this._element.classList;for(const G in _a)U.remove(`mapboxgl-marker-anchor-${G}`);U.add(`mapboxgl-marker-anchor-${this._anchor}`);const W=n&&n.className?n.className.trim().split(/\s+/):[];U.add(...W),this._popup=null}_createDefaultMarker(){const n=se("div"),u=fe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const p=fe("radialGradient",{id:"shadowGradient"},fe("defs",{},u));fe("stop",{offset:"10%","stop-opacity":.4},p),fe("stop",{offset:"100%","stop-opacity":.05},p),fe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u)}return fe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),fe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),fe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.aT.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||$s.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const u=n.code,p=n.charCode||n.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const u=n.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,u=this._pos;if(!n||!u)return!1;const p=n.unproject(u,this._altitude),y=n.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const u=this._pos;if(!u||u.x<0||u.x>n.transform.width||u.y<0||u.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(u,this._altitude);let y;n._showingGlobe()&&s.f5(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${_a[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const n=this._pos,u=this._map,p=this.getPitchAlignment();if(!u||!n||p!=="map")return"";if(!u._showingGlobe()){const I=u.getPitch();return I?`rotateX(${I}deg)`:""}const y=s.cX(s.f6(u.transform,this._lngLat)),b=n.sub(s.f7(u.transform)),w=Math.abs(b.x)+Math.abs(b.y);if(w===0)return"";const E=y/w;return`rotateX(${-b.y*E}deg) rotateY(${b.x*E}deg)`}_calculateZTransform(){const n=this._pos,u=this._map;if(!u||!n)return"";let p=0;const y=this.getRotationAlignment();if(y==="map")if(u._showingGlobe()){const b=u.project(new s.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=u.project(new s.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);p=s.cX(Math.atan2(w.y,w.x))-90}else p=-u.getBearing();else if(y==="horizon"){const b=s.ah(4,6,u.getZoom()),w=s.f7(u.transform);w.y+=b*u.transform.height;const E=n.sub(w),I=s.cX(Math.atan2(E.y,E.x));p=(I>90?I-270:I+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Vh(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const u=this._map;if(!u)return;const p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){const b=this._clickTolerance||u._clickTolerance;if(n.point.dist(p)<b)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=u.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(n){const u=this._map,p=this._pos;u&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const u=this._map;return u&&(n?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||$s.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||$s.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||$s.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||$s.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},jh={maxWidth:100,unit:"metric"},Ef={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},cx={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},v1=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vu(f=new s.P(0,0),n="bottom"){if(typeof f=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new s.P(0,f);case"top-left":return new s.P(u,u);case"top-right":return new s.P(-u,u);case"bottom":return new s.P(0,-f);case"bottom-left":return new s.P(u,-u);case"bottom-right":return new s.P(-u,-u);case"left":return new s.P(f,0);case"right":return new s.P(-f,0)}return new s.P(0,0)}return f instanceof s.P||Array.isArray(f)?s.P.convert(f):s.P.convert(f[n]||[0,0])}return{version:P,supported:ee.supported,setRTLTextPlugin:s.fb,getRTLTextPluginStatus:s.fa,Map:class extends ix{constructor(f){F.mark(C.create);const n=f;if((f=Object.assign({},$h,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&s.f3(window)&&(f.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Nd(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new ox,this._domRenderTaskQueue=new ox,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},sx,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new er(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new ht(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const u=document.getElementById(f.container);if(!u)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=u}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new tx(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||s.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new Go(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const u=f.bounds;u&&(this.resize(),this.fitBounds(u,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new nx({customAttribution:f.customAttribution})),this._logoControl=new rx,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new s.z(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new s.z(`${u.dataType}dataloading`,u))}),this._interactions=new _1(this)}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),this.fire(new s.z("resize",f)),n&&this.fire(new s.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(s.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(n=>n==="auto"?navigator.language:n):f}setLanguage(f){const n=this._parseLanguage(f);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let u;n==="globe"&&f.zoom>=s.cL?(f.setMercatorFromTransition(),u=!0):n==="mercator"&&f.zoom<s.cL&&(f.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;const u=this.transform.mercatorFromTransition;n=f.name==="globe"&&this.transform.zoom>=s.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&u!==this.transform.mercatorFromTransition;return(n||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,n){return this.transform.locationPoint3D(s.aT.convert(f),n)}unproject(f,n){return this.transform.pointLocation3D(s.P.convert(f),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,n,u){const p=y=>{let b=[];if(Array.isArray(n)){const w=n.filter(E=>this.getLayer(E));b=w.length?this.queryRenderedFeatures(y,{layers:w}):[]}else b=this.queryRenderedFeatures(y,{target:n});return b};if(f==="mouseenter"||f==="mouseover"){let y=!1;return{listener:u,targets:n,delegates:{mousemove:w=>{const E=p(w.point);E.length?y||(y=!0,u.call(this,new yo(f,this,w.originalEvent,{features:E}))):y=!1},mouseout:()=>{y=!1}}}}if(f==="mouseleave"||f==="mouseout"){let y=!1;return{listener:u,targets:n,delegates:{mousemove:E=>{p(E.point).length?y=!0:y&&(y=!1,u.call(this,new yo(f,this,E.originalEvent)))},mouseout:E=>{y&&(y=!1,u.call(this,new yo(f,this,E.originalEvent)))}}}}{const y=b=>{const w=p(b.point);w.length&&(b.features=w,u.call(this,b),delete b.features)};return{listener:u,targets:n,delegates:{[f]:y}}}}on(f,n,u){if(typeof n=="function"||u===void 0)return super.on(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,n,u){if(typeof n=="function"||u===void 0)return super.once(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,u);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,n,u){if(typeof n=="function"||u===void 0)return super.off(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(y=>{for(let b=0;b<y.length;b++){const w=y[b];if(w.listener===u&&y1(w.targets,n)){for(const E in w.delegates)this.off(E,w.delegates[E]);return y.splice(b,1),this}}})(p),this}queryRenderedFeatures(f,n){if(!this.style)return[];if(f===void 0||f instanceof s.P||Array.isArray(f)||n!==void 0||(n=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!n){const b=this.style.queryRenderedFeatures(f,void 0,this.transform),w=this.style.queryRenderedFeatureset(f,void 0,this.transform);return b.concat(w)}let u=!0;if(n.target&&(u=this._isTargetValid(n.target),u&&!n.layers))return this.style.queryRenderedFeatureset(f,n,this.transform);let p=!0;if(n.layers&&Array.isArray(n.layers)){for(const b of n.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!n.target)return this.style.queryRenderedFeatures(f,n,this.transform)}let y=[];return p&&(y=y.concat(this.style.queryRenderedFeatures(f,n,this.transform))),u&&(y=y.concat(this.style.queryRenderedFeatureset(f,n,this.transform))),y}querySourceFeatures(f,n){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,n)}queryRasterValue(f,n,u){return this._isValidId(f)?this.style.queryRasterValue(f,n,u):Promise.resolve(null)}isPointOnSurface(f){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(f))}addInteraction(f,n){return this._interactions.add(f,n),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&f&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(f,(u,p)=>{if(u){const y=typeof u=="string"?u:u instanceof Error?u.message:u.error;s.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(f,n)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const u=Object.assign({},n);n&&n.config&&(u.initialConfig=n.config,delete u.config),this.style=new vs(this,u).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new vs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dr(f)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const n of f)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(f)}addSource(f,n){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,n,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,u)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,n,{pixelRatio:u=1,sdf:p=!1,stretchX:y,stretchY:b,content:w}={}){this._lazyInitEmptyStyle();const E=s.I.from(f);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:I,height:R,data:L}=s.o.getImageData(n);this.style.addImage(E,{data:new s.q({width:I,height:R},L),pixelRatio:u,stretchX:y,stretchY:b,content:w,sdf:p,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:R}=n,L=n;this.style.addImage(E,{data:new s.q({width:I,height:R},new Uint8Array(L.data)),pixelRatio:u,stretchX:y,stretchY:b,content:w,sdf:p,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f)}}updateImage(f,n){this._lazyInitEmptyStyle();const u=s.I.from(f),p=this.style.getImage(u);if(!p)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.o.getImageData(n):n,{width:b,height:w,data:E}=y;if(b===void 0||w===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||w!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${b}, ${w})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const I=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let R=!1;p.usvg?(p.data=new s.q({width:b,height:w},new Uint8Array(E)),p.usvg=!1,p.icon=void 0,R=!0):p.data.replace(E,I),this.style.updateImage(u,p,R)}hasImage(f){return f?!!this.style&&!!this.style.getImage(s.I.from(f)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(s.I.from(f))}loadImage(f,n){s.n(this._requestManager.transformRequest(f,s.R.Image),(u,p)=>{n(u,p instanceof HTMLImageElement?s.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,n){this._lazyInitEmptyStyle(),this.style.addModel(f,n)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,n){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)):this}getSlot(f){const n=this.getLayer(f);return n&&n.slot||null}setSlot(f,n){return this.style.setSlot(f,n),this.style.mergeLayers(),this._update(!0)}addImport(f,n){return this.style.addImport(f,n).catch(u=>this.fire(new s.y(new Error("Failed to add import",u)))),this}updateImport(f,n){return typeof n!="string"&&n.id!==f?(this.removeImport(f),this.addImport(n)):(this.style.updateImport(f,n),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,n){return this.style.moveImport(f,n),this._update(!0)}moveLayer(f,n){return this._isValidId(f)?(this.style.moveLayer(f,n),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const n=this.style.getOwnLayer(f);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,n,u){return this._isValidId(f)?(this.style.setLayerZoomRange(f,n,u),this._update(!0)):this}setFilter(f,n,u={}){return this._isValidId(f)?(this.style.setFilter(f,n,u),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,n,u,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,n,u,p),this._update(!0)):this}getPaintProperty(f,n){return this._isValidId(f)?this.style.getPaintProperty(f,n):null}setLayoutProperty(f,n,u,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,n,u,p),this._update(!0)):this}getLayoutProperty(f,n){return this._isValidId(f)?this.style.getLayoutProperty(f,n):null}setLayerProperty(f,n,u,p={}){return this._isValidId(f)?(n==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(f,n,u,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,n){return this.style.setSchema(f,n),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,n){return this.style.setConfig(f,n),this._update(!0)}getConfigProperty(f,n){return this.style.getConfigProperty(f,n)}setConfigProperty(f,n,u){return this.style.setConfigProperty(f,n,u),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const n=f[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,n),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aT.convert(f),this.transform):0}setFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,n),this._update())}removeFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,n),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.style.indoorManager.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.style.indoorManager.setActiveFloorsVisibility(f)}getIndoorTileOptions(f,n){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(f,n):null}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let u,p,y,b=this._container;for(;b&&(!p||!y);){const w=window.getComputedStyle(b).transform;w&&w!=="none"&&(u=w.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(p=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(y=u[3])),b=b.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=se("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=se("div","mapboxgl-canvas-container",f);this._canvas=se("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=se("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{p[y]=se("div",`mapboxgl-ctrl-${y}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const u=s.o.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const n=this._popups.indexOf(f);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const f=Object.assign({},ee.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",f);n?($e(n,!0),this.painter=new jv(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",u=>{if(u.dataType==="source"){const p=this.transform.elevation?this.transform.elevation._source():null;p&&u.sourceCacheId===p.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),s.k.testSupport(n)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;this.fire(new s.z("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,p=s.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=y.createQuery(),y.beginQuery(u.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,R=this.transform.pitch,L=s.o.now(),N=new s.ac(I,{now:L,fadeDuration:b,pitch:R,transition:this.style.transition,worldview:this._worldview});this.style.update(N)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(p),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,F.mark(C.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const I=s.o.now()-p;y.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const R=y.getQueryParameter(n,y.QUERY_RESULT)/1e6;y.deleteQuery(n),this.fire(new s.z("gpu-timing-frame",{cpuTime:I,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(I);this.fire(new s.z("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(I);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:R}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(E||this._repaint)this.triggerRepaint();else{const I=this.idle();if(I&&(w=this._updateAverageElevation(p,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,F.mark(C.fullLoad),this._performanceMetricsCollection&&Wt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const n of this._markers)f&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!f||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(f,n=!1){const u=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const w=Math.abs(y-b);if(w>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),u(b);this._averageElevation.easeTo(b,f,300)}else if(w>1e-4)return this._averageElevation.jumpTo(b),u(b)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){Vi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Qe||f.status===401)){const n=this.painter.context.gl;$e(n,!1),this._logoControl instanceof rx&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Un(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&mr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Li(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){hn(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const u=this.painter.context.gl,p=u.createFramebuffer();function y(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const w=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,w),w}return u.bindFramebuffer(u.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(f,n,u){let p=u[1]-u[0];const y=f.length/4;for(let b=0;b<n.length;b++){const w=n[b];let E=0;for(let I=0;I<w.length;I+=4)w[I]===f[I]&&w[I+1]===f[I+1]&&w[I+2]===f[I+2]&&w[I+3]===f[I+3]&&(E+=1);p+=(u[b+2]-u[b+1])*(1-E/y)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),zi.delete(this.painter.context.gl),ui.remove(),Dn.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=s.o.frame(n=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(n)}))}_preloadTiles(f){const n=this.style?this.style.getSourceCaches():[];return s.bw(n,(u,p)=>u._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this.style&&f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,n){s.f4(f,n)}get version(){return P}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},lx,f),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:n}):u.resetNorth({},{originalEvent:n}))}),this._compassIcon=se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),u=n===f.getMaxZoom(),p=n===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yg(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const u=se("button",f,this._container);return u.type="button",u.addEventListener("click",n),u}_setButtonTitle(f,n){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends s.E{constructor(f={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},Vs,f),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Gv(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const n=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,f(u)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>n(u.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),u=f.coords;return!!n&&(u.longitude<n.getWest()||u.longitude>n.getEast()||u.latitude<n.getSouth()||u.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const n=new s.aT(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,p=this._map.getBearing(),y=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(u),y,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new s.aT(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=s.cf(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",{code:f.code,message:f.message,PERMISSION_DENIED:f.PERMISSION_DENIED,POSITION_UNAVAILABLE:f.POSITION_UNAVAILABLE,TIMEOUT:f.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const f=this.options.positionOptions.timeout;f&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},f))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=se("button","mapboxgl-ctrl-geolocate",this._container),se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se("div","mapboxgl-user-location"),this._dotElement.appendChild(se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Rr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(f){return this.options.followUserLocation=f??Vs.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new s.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const f=()=>{const n="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(n,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:nx,ScaleControl:class{constructor(f={}){this.options=Object.assign({},jh,f),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,u=n._containerHeight/2,p=n._containerWidth/2-f/2,y=n.unproject([p,u]),b=n.unproject([p+f,u]),w=y.distanceTo(b);if(this.options.unit==="imperial"){const E=3.2808*w;E>5280?this._setScale(f,E/5280,"mile"):this._setScale(f,E,"foot")}else this.options.unit==="nautical"?this._setScale(f,w/1852,"nautical-mile"):w>=1e3?this._setScale(f,w/1e3,"kilometer"):this._setScale(f,w,"meter")}_setScale(f,n,u){this._map._requestDomTask(()=>{const p=(function(b){const w=Math.pow(10,`${Math.floor(b)}`.length-1);let E=b/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:(function(I){const R=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*R)/R})(E),w*E})(n),y=p/n;this._container.innerHTML=u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(p):`${p}&nbsp;${Ef[u]}`,this._container.style.width=f*y+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);se("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:cm,Popup:class extends s.E{constructor(f){super(),this.options=Object.assign(Object.create(cx),f),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=s.aT.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const n=document.createDocumentFragment(),u=document.createElement("body");let p;for(u.innerHTML=f;p=u.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=se("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const u=this._closeButton=se("button","mapboxgl-popup-close-button",n);u.type="button",u.setAttribute("aria-label","Close popup"),u.innerHTML='<span aria-hidden="true">&#215;</span>',u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,u=this._container,p=this._pos;if(!n||!u||!p)return"bottom";const y=u.offsetWidth,b=u.offsetHeight,w=p.x<y/2,E=p.x>n.transform.width-y/2;if(p.y+f<b)return w?"top-left":E?"top-right":"top";if(p.y>n.transform.height-b){if(w)return"bottom-left";if(E)return"bottom-right"}return w?"left":E?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,u=this._content;if(!n||!this._lngLat&&!this._trackPointer||!u)return;let p=this._container;if(p||(p=this._container=se("div","mapboxgl-popup",n.getContainer()),this._tip=se("div","mapboxgl-popup-tip",p),p.appendChild(u)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vh(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f instanceof s.P?f:n.project(this._lngLat,this._altitude),b=vu(this.options.offset),w=this._anchor=this._getAnchor(b.y),E=vu(this.options.offset,w),I=y.add(E).round();n._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${_a[w]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&n._showingGlobe()){const y=s.f5(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(v1);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Rr,Style:vs,LngLat:s.aT,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:Jy,Evented:s.E,config:s.e,prewarm:s.f9,clearPrewarmedResources:s.f8,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(f){s.e.ACCESS_TOKEN=f},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(f){s.e.API_URL=f},get workerCount(){return s.fi.workerCount},set workerCount(f){s.fi.workerCount=f},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.fh(f)},get workerUrl(){return s.fg.workerUrl},set workerUrl(f){s.fg.workerUrl=f},get workerClass(){return s.fg.workerClass},set workerClass(f){s.fg.workerClass=f},get workerParams(){return s.fg.workerParams},set workerParams(f){s.fg.workerParams=f},get dracoUrl(){return s.ff()},set dracoUrl(f){s.fe(f)},get meshoptUrl(){return s.fd()},set meshoptUrl(f){s.fc(f)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var x=l;return x}))})(Z0)),Z0.exports}var zJ=PJ();const cb=MJ(zJ),qM="126",d4=0,BT=1,f4=2,XM=1,p4=2,yp=3,Cy=0,Bo=1,Ry=2,JM=1,bp=0,wp=1,NT=2,UT=3,$T=4,m4=5,ad=100,g4=101,_4=102,VT=103,jT=104,y4=200,v4=201,x4=202,b4=203,YM=204,KM=205,w4=206,S4=207,T4=208,E4=209,I4=210,M4=0,A4=1,P4=2,ub=3,z4=4,C4=5,R4=6,L4=7,Ly=0,D4=1,k4=2,Sp=0,O4=1,F4=2,B4=3,N4=4,U4=5,QM=300,Mw=301,Aw=302,GT=303,HT=304,Pw=306,zw=307,hb=1e3,la=1001,db=1002,Cs=1003,ZT=1004,WT=1005,Ko=1006,$4=1007,Dy=1008,Cw=1009,V4=1010,j4=1011,F_=1012,G4=1013,S_=1014,Fc=1015,B_=1016,H4=1017,Z4=1018,W4=1019,Tp=1020,q4=1021,$u=1022,Ja=1023,X4=1024,J4=1025,fd=1026,Op=1027,Y4=1028,K4=1029,Q4=1030,eN=1031,tN=1032,iN=1033,qT=33776,XT=33777,JT=33778,YT=33779,KT=35840,QT=35841,eE=35842,tE=35843,nN=36196,iE=37492,nE=37496,rN=37808,oN=37809,sN=37810,aN=37811,lN=37812,cN=37813,uN=37814,hN=37815,dN=37816,fN=37817,pN=37818,mN=37819,gN=37820,_N=37821,yN=36492,vN=37840,xN=37841,bN=37842,wN=37843,SN=37844,TN=37845,EN=37846,IN=37847,MN=37848,AN=37849,PN=37850,zN=37851,CN=37852,RN=37853,LN=2200,DN=2201,kN=2202,N_=2300,U_=2301,W0=2302,cd=2400,ud=2401,$_=2402,Rw=2500,e2=2501,ON=0,qp=3e3,t2=3001,FN=3007,BN=3002,NN=3003,UN=3004,$N=3005,VN=3006,jN=3200,GN=3201,Td=0,HN=1,q0=7680,ZN=519,ky=35044,Fp=35048,rE="300 es";function Gc(){}Object.assign(Gc.prototype,{addEventListener:function(i,e){this._listeners===void 0&&(this._listeners={});const o=this._listeners;o[i]===void 0&&(o[i]=[]),o[i].indexOf(e)===-1&&o[i].push(e)},hasEventListener:function(i,e){if(this._listeners===void 0)return!1;const o=this._listeners;return o[i]!==void 0&&o[i].indexOf(e)!==-1},removeEventListener:function(i,e){if(this._listeners===void 0)return;const h=this._listeners[i];if(h!==void 0){const l=h.indexOf(e);l!==-1&&h.splice(l,1)}},dispatchEvent:function(i){if(this._listeners===void 0)return;const o=this._listeners[i.type];if(o!==void 0){i.target=this;const h=o.slice(0);for(let l=0,m=h.length;l<m;l++)h[l].call(this,i)}}});const hs=[];for(let i=0;i<256;i++)hs[i]=(i<16?"0":"")+i.toString(16);let _0=1234567;const kn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,o=Math.random()*4294967295|0,h=Math.random()*4294967295|0;return(hs[i&255]+hs[i>>8&255]+hs[i>>16&255]+hs[i>>24&255]+"-"+hs[e&255]+hs[e>>8&255]+"-"+hs[e>>16&15|64]+hs[e>>24&255]+"-"+hs[o&63|128]+hs[o>>8&255]+"-"+hs[o>>16&255]+hs[o>>24&255]+hs[h&255]+hs[h>>8&255]+hs[h>>16&255]+hs[h>>24&255]).toUpperCase()},clamp:function(i,e,o){return Math.max(e,Math.min(o,i))},euclideanModulo:function(i,e){return(i%e+e)%e},mapLinear:function(i,e,o,h,l){return h+(i-e)*(l-h)/(o-e)},lerp:function(i,e,o){return(1-o)*i+o*e},damp:function(i,e,o,h){return kn.lerp(i,e,1-Math.exp(-o*h))},pingpong:function(i,e=1){return e-Math.abs(kn.euclideanModulo(i,e*2)-e)},smoothstep:function(i,e,o){return i<=e?0:i>=o?1:(i=(i-e)/(o-e),i*i*(3-2*i))},smootherstep:function(i,e,o){return i<=e?0:i>=o?1:(i=(i-e)/(o-e),i*i*i*(i*(i*6-15)+10))},randInt:function(i,e){return i+Math.floor(Math.random()*(e-i+1))},randFloat:function(i,e){return i+Math.random()*(e-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){return i!==void 0&&(_0=i%2147483647),_0=_0*16807%2147483647,(_0-1)/2147483646},degToRad:function(i){return i*kn.DEG2RAD},radToDeg:function(i){return i*kn.RAD2DEG},isPowerOfTwo:function(i){return(i&i-1)===0&&i!==0},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,e,o,h,l){const m=Math.cos,x=Math.sin,s=m(o/2),P=x(o/2),C=m((e+h)/2),F=x((e+h)/2),O=m((e-h)/2),V=x((e-h)/2),J=m((h-e)/2),ee=x((h-e)/2);switch(l){case"XYX":i.set(s*F,P*O,P*V,s*C);break;case"YZY":i.set(P*V,s*F,P*O,s*C);break;case"ZXZ":i.set(P*O,P*V,s*F,s*C);break;case"XZX":i.set(s*F,P*ee,P*J,s*C);break;case"YXY":i.set(P*J,s*F,P*ee,s*C);break;case"ZYZ":i.set(P*ee,P*J,s*F,s*C);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+l)}}};class mi{constructor(e=0,o=0){this.x=e,this.y=o}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,o){return this.x=e,this.y=o,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,o){switch(e){case 0:this.x=o;break;case 1:this.y=o;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,o){return o!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,o)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,o){return this.x=e.x+o.x,this.y=e.y+o.y,this}addScaledVector(e,o){return this.x+=e.x*o,this.y+=e.y*o,this}sub(e,o){return o!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,o)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,o){return this.x=e.x-o.x,this.y=e.y-o.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const o=this.x,h=this.y,l=e.elements;return this.x=l[0]*o+l[3]*h+l[6],this.y=l[1]*o+l[4]*h+l[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,o){return this.x=Math.max(e.x,Math.min(o.x,this.x)),this.y=Math.max(e.y,Math.min(o.y,this.y)),this}clampScalar(e,o){return this.x=Math.max(e,Math.min(o,this.x)),this.y=Math.max(e,Math.min(o,this.y)),this}clampLength(e,o){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(e,Math.min(o,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const o=this.x-e.x,h=this.y-e.y;return o*o+h*h}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,o){return this.x+=(e.x-this.x)*o,this.y+=(e.y-this.y)*o,this}lerpVectors(e,o,h){return this.x=e.x+(o.x-e.x)*h,this.y=e.y+(o.y-e.y)*h,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,o=0){return this.x=e[o],this.y=e[o+1],this}toArray(e=[],o=0){return e[o]=this.x,e[o+1]=this.y,e}fromBufferAttribute(e,o,h){return h!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(o),this.y=e.getY(o),this}rotateAround(e,o){const h=Math.cos(o),l=Math.sin(o),m=this.x-e.x,x=this.y-e.y;return this.x=m*h-x*l+e.x,this.y=m*l+x*h+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}mi.prototype.isVector2=!0;class Qo{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,o,h,l,m,x,s,P,C){const F=this.elements;return F[0]=e,F[1]=l,F[2]=s,F[3]=o,F[4]=m,F[5]=P,F[6]=h,F[7]=x,F[8]=C,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const o=this.elements,h=e.elements;return o[0]=h[0],o[1]=h[1],o[2]=h[2],o[3]=h[3],o[4]=h[4],o[5]=h[5],o[6]=h[6],o[7]=h[7],o[8]=h[8],this}extractBasis(e,o,h){return e.setFromMatrix3Column(this,0),o.setFromMatrix3Column(this,1),h.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const o=e.elements;return this.set(o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,o){const h=e.elements,l=o.elements,m=this.elements,x=h[0],s=h[3],P=h[6],C=h[1],F=h[4],O=h[7],V=h[2],J=h[5],ee=h[8],se=l[0],fe=l[3],le=l[6],ie=l[1],it=l[4],Ve=l[7],Ne=l[2],Re=l[5],Ye=l[8];return m[0]=x*se+s*ie+P*Ne,m[3]=x*fe+s*it+P*Re,m[6]=x*le+s*Ve+P*Ye,m[1]=C*se+F*ie+O*Ne,m[4]=C*fe+F*it+O*Re,m[7]=C*le+F*Ve+O*Ye,m[2]=V*se+J*ie+ee*Ne,m[5]=V*fe+J*it+ee*Re,m[8]=V*le+J*Ve+ee*Ye,this}multiplyScalar(e){const o=this.elements;return o[0]*=e,o[3]*=e,o[6]*=e,o[1]*=e,o[4]*=e,o[7]*=e,o[2]*=e,o[5]*=e,o[8]*=e,this}determinant(){const e=this.elements,o=e[0],h=e[1],l=e[2],m=e[3],x=e[4],s=e[5],P=e[6],C=e[7],F=e[8];return o*x*F-o*s*C-h*m*F+h*s*P+l*m*C-l*x*P}invert(){const e=this.elements,o=e[0],h=e[1],l=e[2],m=e[3],x=e[4],s=e[5],P=e[6],C=e[7],F=e[8],O=F*x-s*C,V=s*P-F*m,J=C*m-x*P,ee=o*O+h*V+l*J;if(ee===0)return this.set(0,0,0,0,0,0,0,0,0);const se=1/ee;return e[0]=O*se,e[1]=(l*C-F*h)*se,e[2]=(s*h-l*x)*se,e[3]=V*se,e[4]=(F*o-l*P)*se,e[5]=(l*m-s*o)*se,e[6]=J*se,e[7]=(h*P-C*o)*se,e[8]=(x*o-h*m)*se,this}transpose(){let e;const o=this.elements;return e=o[1],o[1]=o[3],o[3]=e,e=o[2],o[2]=o[6],o[6]=e,e=o[5],o[5]=o[7],o[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const o=this.elements;return e[0]=o[0],e[1]=o[3],e[2]=o[6],e[3]=o[1],e[4]=o[4],e[5]=o[7],e[6]=o[2],e[7]=o[5],e[8]=o[8],this}setUvTransform(e,o,h,l,m,x,s){const P=Math.cos(m),C=Math.sin(m);return this.set(h*P,h*C,-h*(P*x+C*s)+x+e,-l*C,l*P,-l*(-C*x+P*s)+s+o,0,0,1),this}scale(e,o){const h=this.elements;return h[0]*=e,h[3]*=e,h[6]*=e,h[1]*=o,h[4]*=o,h[7]*=o,this}rotate(e){const o=Math.cos(e),h=Math.sin(e),l=this.elements,m=l[0],x=l[3],s=l[6],P=l[1],C=l[4],F=l[7];return l[0]=o*m+h*P,l[3]=o*x+h*C,l[6]=o*s+h*F,l[1]=-h*m+o*P,l[4]=-h*x+o*C,l[7]=-h*s+o*F,this}translate(e,o){const h=this.elements;return h[0]+=e*h[2],h[3]+=e*h[5],h[6]+=e*h[8],h[1]+=o*h[2],h[4]+=o*h[5],h[7]+=o*h[8],this}equals(e){const o=this.elements,h=e.elements;for(let l=0;l<9;l++)if(o[l]!==h[l])return!1;return!0}fromArray(e,o=0){for(let h=0;h<9;h++)this.elements[h]=e[h+o];return this}toArray(e=[],o=0){const h=this.elements;return e[o]=h[0],e[o+1]=h[1],e[o+2]=h[2],e[o+3]=h[3],e[o+4]=h[4],e[o+5]=h[5],e[o+6]=h[6],e[o+7]=h[7],e[o+8]=h[8],e}clone(){return new this.constructor().fromArray(this.elements)}}Qo.prototype.isMatrix3=!0;let Qf;const Ed={getDataURL:function(i){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;let e;if(i instanceof HTMLCanvasElement)e=i;else{Qf===void 0&&(Qf=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Qf.width=i.width,Qf.height=i.height;const o=Qf.getContext("2d");i instanceof ImageData?o.putImageData(i,0,0):o.drawImage(i,0,0,i.width,i.height),e=Qf}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let CJ=0;class es extends Gc{constructor(e=es.DEFAULT_IMAGE,o=es.DEFAULT_MAPPING,h=la,l=la,m=Ko,x=Dy,s=Ja,P=Cw,C=1,F=qp){super(),Object.defineProperty(this,"id",{value:CJ++}),this.uuid=kn.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=o,this.wrapS=h,this.wrapT=l,this.magFilter=m,this.minFilter=x,this.anisotropy=C,this.format=s,this.internalFormat=null,this.type=P,this.offset=new mi(0,0),this.repeat=new mi(1,1),this.center=new mi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Qo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=F,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const o=e===void 0||typeof e=="string";if(!o&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const h={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const l=this.image;if(l.uuid===void 0&&(l.uuid=kn.generateUUID()),!o&&e.images[l.uuid]===void 0){let m;if(Array.isArray(l)){m=[];for(let x=0,s=l.length;x<s;x++)l[x].isDataTexture?m.push(QS(l[x].image)):m.push(QS(l[x]))}else m=QS(l);e.images[l.uuid]={uuid:l.uuid,url:m}}h.image=l.uuid}return o||(e.textures[this.uuid]=h),h}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==QM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case hb:e.x=e.x-Math.floor(e.x);break;case la:e.x=e.x<0?0:1;break;case db:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case hb:e.y=e.y-Math.floor(e.y);break;case la:e.y=e.y<0?0:1;break;case db:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}es.DEFAULT_IMAGE=void 0;es.DEFAULT_MAPPING=QM;es.prototype.isTexture=!0;function QS(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?Ed.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class zr{constructor(e=0,o=0,h=0,l=1){this.x=e,this.y=o,this.z=h,this.w=l}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,o,h,l){return this.x=e,this.y=o,this.z=h,this.w=l,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,o){switch(e){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;case 3:this.w=o;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,o){return o!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,o)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,o){return this.x=e.x+o.x,this.y=e.y+o.y,this.z=e.z+o.z,this.w=e.w+o.w,this}addScaledVector(e,o){return this.x+=e.x*o,this.y+=e.y*o,this.z+=e.z*o,this.w+=e.w*o,this}sub(e,o){return o!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,o)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,o){return this.x=e.x-o.x,this.y=e.y-o.y,this.z=e.z-o.z,this.w=e.w-o.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const o=this.x,h=this.y,l=this.z,m=this.w,x=e.elements;return this.x=x[0]*o+x[4]*h+x[8]*l+x[12]*m,this.y=x[1]*o+x[5]*h+x[9]*l+x[13]*m,this.z=x[2]*o+x[6]*h+x[10]*l+x[14]*m,this.w=x[3]*o+x[7]*h+x[11]*l+x[15]*m,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const o=Math.sqrt(1-e.w*e.w);return o<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/o,this.y=e.y/o,this.z=e.z/o),this}setAxisAngleFromRotationMatrix(e){let o,h,l,m;const P=e.elements,C=P[0],F=P[4],O=P[8],V=P[1],J=P[5],ee=P[9],se=P[2],fe=P[6],le=P[10];if(Math.abs(F-V)<.01&&Math.abs(O-se)<.01&&Math.abs(ee-fe)<.01){if(Math.abs(F+V)<.1&&Math.abs(O+se)<.1&&Math.abs(ee+fe)<.1&&Math.abs(C+J+le-3)<.1)return this.set(1,0,0,0),this;o=Math.PI;const it=(C+1)/2,Ve=(J+1)/2,Ne=(le+1)/2,Re=(F+V)/4,Ye=(O+se)/4,zt=(ee+fe)/4;return it>Ve&&it>Ne?it<.01?(h=0,l=.707106781,m=.707106781):(h=Math.sqrt(it),l=Re/h,m=Ye/h):Ve>Ne?Ve<.01?(h=.707106781,l=0,m=.707106781):(l=Math.sqrt(Ve),h=Re/l,m=zt/l):Ne<.01?(h=.707106781,l=.707106781,m=0):(m=Math.sqrt(Ne),h=Ye/m,l=zt/m),this.set(h,l,m,o),this}let ie=Math.sqrt((fe-ee)*(fe-ee)+(O-se)*(O-se)+(V-F)*(V-F));return Math.abs(ie)<.001&&(ie=1),this.x=(fe-ee)/ie,this.y=(O-se)/ie,this.z=(V-F)/ie,this.w=Math.acos((C+J+le-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,o){return this.x=Math.max(e.x,Math.min(o.x,this.x)),this.y=Math.max(e.y,Math.min(o.y,this.y)),this.z=Math.max(e.z,Math.min(o.z,this.z)),this.w=Math.max(e.w,Math.min(o.w,this.w)),this}clampScalar(e,o){return this.x=Math.max(e,Math.min(o,this.x)),this.y=Math.max(e,Math.min(o,this.y)),this.z=Math.max(e,Math.min(o,this.z)),this.w=Math.max(e,Math.min(o,this.w)),this}clampLength(e,o){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(e,Math.min(o,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,o){return this.x+=(e.x-this.x)*o,this.y+=(e.y-this.y)*o,this.z+=(e.z-this.z)*o,this.w+=(e.w-this.w)*o,this}lerpVectors(e,o,h){return this.x=e.x+(o.x-e.x)*h,this.y=e.y+(o.y-e.y)*h,this.z=e.z+(o.z-e.z)*h,this.w=e.w+(o.w-e.w)*h,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,o=0){return this.x=e[o],this.y=e[o+1],this.z=e[o+2],this.w=e[o+3],this}toArray(e=[],o=0){return e[o]=this.x,e[o+1]=this.y,e[o+2]=this.z,e[o+3]=this.w,e}fromBufferAttribute(e,o,h){return h!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(o),this.y=e.getY(o),this.z=e.getZ(o),this.w=e.getW(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}zr.prototype.isVector4=!0;class Vu extends Gc{constructor(e,o,h){super(),this.width=e,this.height=o,this.depth=1,this.scissor=new zr(0,0,e,o),this.scissorTest=!1,this.viewport=new zr(0,0,e,o),h=h||{},this.texture=new es(void 0,h.mapping,h.wrapS,h.wrapT,h.magFilter,h.minFilter,h.format,h.type,h.anisotropy,h.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=o,this.texture.image.depth=1,this.texture.generateMipmaps=h.generateMipmaps!==void 0?h.generateMipmaps:!1,this.texture.minFilter=h.minFilter!==void 0?h.minFilter:Ko,this.depthBuffer=h.depthBuffer!==void 0?h.depthBuffer:!0,this.stencilBuffer=h.stencilBuffer!==void 0?h.stencilBuffer:!1,this.depthTexture=h.depthTexture!==void 0?h.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,o,h=1){(this.width!==e||this.height!==o||this.depth!==h)&&(this.width=e,this.height=o,this.depth=h,this.texture.image.width=e,this.texture.image.height=o,this.texture.image.depth=h,this.dispose()),this.viewport.set(0,0,e,o),this.scissor.set(0,0,e,o)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Vu.prototype.isWebGLRenderTarget=!0;class WN extends Vu{constructor(e,o,h){super(e,o,h),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}WN.prototype.isWebGLMultisampleRenderTarget=!0;class Rs{constructor(e=0,o=0,h=0,l=1){this._x=e,this._y=o,this._z=h,this._w=l}static slerp(e,o,h,l){return h.copy(e).slerp(o,l)}static slerpFlat(e,o,h,l,m,x,s){let P=h[l+0],C=h[l+1],F=h[l+2],O=h[l+3];const V=m[x+0],J=m[x+1],ee=m[x+2],se=m[x+3];if(s===0){e[o+0]=P,e[o+1]=C,e[o+2]=F,e[o+3]=O;return}if(s===1){e[o+0]=V,e[o+1]=J,e[o+2]=ee,e[o+3]=se;return}if(O!==se||P!==V||C!==J||F!==ee){let fe=1-s;const le=P*V+C*J+F*ee+O*se,ie=le>=0?1:-1,it=1-le*le;if(it>Number.EPSILON){const Ne=Math.sqrt(it),Re=Math.atan2(Ne,le*ie);fe=Math.sin(fe*Re)/Ne,s=Math.sin(s*Re)/Ne}const Ve=s*ie;if(P=P*fe+V*Ve,C=C*fe+J*Ve,F=F*fe+ee*Ve,O=O*fe+se*Ve,fe===1-s){const Ne=1/Math.sqrt(P*P+C*C+F*F+O*O);P*=Ne,C*=Ne,F*=Ne,O*=Ne}}e[o]=P,e[o+1]=C,e[o+2]=F,e[o+3]=O}static multiplyQuaternionsFlat(e,o,h,l,m,x){const s=h[l],P=h[l+1],C=h[l+2],F=h[l+3],O=m[x],V=m[x+1],J=m[x+2],ee=m[x+3];return e[o]=s*ee+F*O+P*J-C*V,e[o+1]=P*ee+F*V+C*O-s*J,e[o+2]=C*ee+F*J+s*V-P*O,e[o+3]=F*ee-s*O-P*V-C*J,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,o,h,l){return this._x=e,this._y=o,this._z=h,this._w=l,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,o){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const h=e._x,l=e._y,m=e._z,x=e._order,s=Math.cos,P=Math.sin,C=s(h/2),F=s(l/2),O=s(m/2),V=P(h/2),J=P(l/2),ee=P(m/2);switch(x){case"XYZ":this._x=V*F*O+C*J*ee,this._y=C*J*O-V*F*ee,this._z=C*F*ee+V*J*O,this._w=C*F*O-V*J*ee;break;case"YXZ":this._x=V*F*O+C*J*ee,this._y=C*J*O-V*F*ee,this._z=C*F*ee-V*J*O,this._w=C*F*O+V*J*ee;break;case"ZXY":this._x=V*F*O-C*J*ee,this._y=C*J*O+V*F*ee,this._z=C*F*ee+V*J*O,this._w=C*F*O-V*J*ee;break;case"ZYX":this._x=V*F*O-C*J*ee,this._y=C*J*O+V*F*ee,this._z=C*F*ee-V*J*O,this._w=C*F*O+V*J*ee;break;case"YZX":this._x=V*F*O+C*J*ee,this._y=C*J*O+V*F*ee,this._z=C*F*ee-V*J*O,this._w=C*F*O-V*J*ee;break;case"XZY":this._x=V*F*O-C*J*ee,this._y=C*J*O-V*F*ee,this._z=C*F*ee+V*J*O,this._w=C*F*O+V*J*ee;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+x)}return o!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,o){const h=o/2,l=Math.sin(h);return this._x=e.x*l,this._y=e.y*l,this._z=e.z*l,this._w=Math.cos(h),this._onChangeCallback(),this}setFromRotationMatrix(e){const o=e.elements,h=o[0],l=o[4],m=o[8],x=o[1],s=o[5],P=o[9],C=o[2],F=o[6],O=o[10],V=h+s+O;if(V>0){const J=.5/Math.sqrt(V+1);this._w=.25/J,this._x=(F-P)*J,this._y=(m-C)*J,this._z=(x-l)*J}else if(h>s&&h>O){const J=2*Math.sqrt(1+h-s-O);this._w=(F-P)/J,this._x=.25*J,this._y=(l+x)/J,this._z=(m+C)/J}else if(s>O){const J=2*Math.sqrt(1+s-h-O);this._w=(m-C)/J,this._x=(l+x)/J,this._y=.25*J,this._z=(P+F)/J}else{const J=2*Math.sqrt(1+O-h-s);this._w=(x-l)/J,this._x=(m+C)/J,this._y=(P+F)/J,this._z=.25*J}return this._onChangeCallback(),this}setFromUnitVectors(e,o){let l=e.dot(o)+1;return l<1e-6?(l=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=l):(this._x=0,this._y=-e.z,this._z=e.y,this._w=l)):(this._x=e.y*o.z-e.z*o.y,this._y=e.z*o.x-e.x*o.z,this._z=e.x*o.y-e.y*o.x,this._w=l),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(kn.clamp(this.dot(e),-1,1)))}rotateTowards(e,o){const h=this.angleTo(e);if(h===0)return this;const l=Math.min(1,o/h);return this.slerp(e,l),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,o){return o!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,o)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,o){const h=e._x,l=e._y,m=e._z,x=e._w,s=o._x,P=o._y,C=o._z,F=o._w;return this._x=h*F+x*s+l*C-m*P,this._y=l*F+x*P+m*s-h*C,this._z=m*F+x*C+h*P-l*s,this._w=x*F-h*s-l*P-m*C,this._onChangeCallback(),this}slerp(e,o){if(o===0)return this;if(o===1)return this.copy(e);const h=this._x,l=this._y,m=this._z,x=this._w;let s=x*e._w+h*e._x+l*e._y+m*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=x,this._x=h,this._y=l,this._z=m,this;const P=1-s*s;if(P<=Number.EPSILON){const J=1-o;return this._w=J*x+o*this._w,this._x=J*h+o*this._x,this._y=J*l+o*this._y,this._z=J*m+o*this._z,this.normalize(),this._onChangeCallback(),this}const C=Math.sqrt(P),F=Math.atan2(C,s),O=Math.sin((1-o)*F)/C,V=Math.sin(o*F)/C;return this._w=x*O+this._w*V,this._x=h*O+this._x*V,this._y=l*O+this._y*V,this._z=m*O+this._z*V,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,o=0){return this._x=e[o],this._y=e[o+1],this._z=e[o+2],this._w=e[o+3],this._onChangeCallback(),this}toArray(e=[],o=0){return e[o]=this._x,e[o+1]=this._y,e[o+2]=this._z,e[o+3]=this._w,e}fromBufferAttribute(e,o){return this._x=e.getX(o),this._y=e.getY(o),this._z=e.getZ(o),this._w=e.getW(o),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Rs.prototype.isQuaternion=!0;class He{constructor(e=0,o=0,h=0){this.x=e,this.y=o,this.z=h}set(e,o,h){return h===void 0&&(h=this.z),this.x=e,this.y=o,this.z=h,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,o){switch(e){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,o){return o!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,o)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,o){return this.x=e.x+o.x,this.y=e.y+o.y,this.z=e.z+o.z,this}addScaledVector(e,o){return this.x+=e.x*o,this.y+=e.y*o,this.z+=e.z*o,this}sub(e,o){return o!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,o)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,o){return this.x=e.x-o.x,this.y=e.y-o.y,this.z=e.z-o.z,this}multiply(e,o){return o!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,o)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,o){return this.x=e.x*o.x,this.y=e.y*o.y,this.z=e.z*o.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(zR.setFromEuler(e))}applyAxisAngle(e,o){return this.applyQuaternion(zR.setFromAxisAngle(e,o))}applyMatrix3(e){const o=this.x,h=this.y,l=this.z,m=e.elements;return this.x=m[0]*o+m[3]*h+m[6]*l,this.y=m[1]*o+m[4]*h+m[7]*l,this.z=m[2]*o+m[5]*h+m[8]*l,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const o=this.x,h=this.y,l=this.z,m=e.elements,x=1/(m[3]*o+m[7]*h+m[11]*l+m[15]);return this.x=(m[0]*o+m[4]*h+m[8]*l+m[12])*x,this.y=(m[1]*o+m[5]*h+m[9]*l+m[13])*x,this.z=(m[2]*o+m[6]*h+m[10]*l+m[14])*x,this}applyQuaternion(e){const o=this.x,h=this.y,l=this.z,m=e.x,x=e.y,s=e.z,P=e.w,C=P*o+x*l-s*h,F=P*h+s*o-m*l,O=P*l+m*h-x*o,V=-m*o-x*h-s*l;return this.x=C*P+V*-m+F*-s-O*-x,this.y=F*P+V*-x+O*-m-C*-s,this.z=O*P+V*-s+C*-x-F*-m,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const o=this.x,h=this.y,l=this.z,m=e.elements;return this.x=m[0]*o+m[4]*h+m[8]*l,this.y=m[1]*o+m[5]*h+m[9]*l,this.z=m[2]*o+m[6]*h+m[10]*l,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,o){return this.x=Math.max(e.x,Math.min(o.x,this.x)),this.y=Math.max(e.y,Math.min(o.y,this.y)),this.z=Math.max(e.z,Math.min(o.z,this.z)),this}clampScalar(e,o){return this.x=Math.max(e,Math.min(o,this.x)),this.y=Math.max(e,Math.min(o,this.y)),this.z=Math.max(e,Math.min(o,this.z)),this}clampLength(e,o){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(e,Math.min(o,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,o){return this.x+=(e.x-this.x)*o,this.y+=(e.y-this.y)*o,this.z+=(e.z-this.z)*o,this}lerpVectors(e,o,h){return this.x=e.x+(o.x-e.x)*h,this.y=e.y+(o.y-e.y)*h,this.z=e.z+(o.z-e.z)*h,this}cross(e,o){return o!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,o)):this.crossVectors(this,e)}crossVectors(e,o){const h=e.x,l=e.y,m=e.z,x=o.x,s=o.y,P=o.z;return this.x=l*P-m*s,this.y=m*x-h*P,this.z=h*s-l*x,this}projectOnVector(e){const o=e.lengthSq();if(o===0)return this.set(0,0,0);const h=e.dot(this)/o;return this.copy(e).multiplyScalar(h)}projectOnPlane(e){return eT.copy(this).projectOnVector(e),this.sub(eT)}reflect(e){return this.sub(eT.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const o=Math.sqrt(this.lengthSq()*e.lengthSq());if(o===0)return Math.PI/2;const h=this.dot(e)/o;return Math.acos(kn.clamp(h,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const o=this.x-e.x,h=this.y-e.y,l=this.z-e.z;return o*o+h*h+l*l}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,o,h){const l=Math.sin(o)*e;return this.x=l*Math.sin(h),this.y=Math.cos(o)*e,this.z=l*Math.cos(h),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,o,h){return this.x=e*Math.sin(o),this.y=h,this.z=e*Math.cos(o),this}setFromMatrixPosition(e){const o=e.elements;return this.x=o[12],this.y=o[13],this.z=o[14],this}setFromMatrixScale(e){const o=this.setFromMatrixColumn(e,0).length(),h=this.setFromMatrixColumn(e,1).length(),l=this.setFromMatrixColumn(e,2).length();return this.x=o,this.y=h,this.z=l,this}setFromMatrixColumn(e,o){return this.fromArray(e.elements,o*4)}setFromMatrix3Column(e,o){return this.fromArray(e.elements,o*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,o=0){return this.x=e[o],this.y=e[o+1],this.z=e[o+2],this}toArray(e=[],o=0){return e[o]=this.x,e[o+1]=this.y,e[o+2]=this.z,e}fromBufferAttribute(e,o,h){return h!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(o),this.y=e.getY(o),this.z=e.getZ(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}He.prototype.isVector3=!0;const eT=new He,zR=new Rs;class Ra{constructor(e=new He(1/0,1/0,1/0),o=new He(-1/0,-1/0,-1/0)){this.min=e,this.max=o}set(e,o){return this.min.copy(e),this.max.copy(o),this}setFromArray(e){let o=1/0,h=1/0,l=1/0,m=-1/0,x=-1/0,s=-1/0;for(let P=0,C=e.length;P<C;P+=3){const F=e[P],O=e[P+1],V=e[P+2];F<o&&(o=F),O<h&&(h=O),V<l&&(l=V),F>m&&(m=F),O>x&&(x=O),V>s&&(s=V)}return this.min.set(o,h,l),this.max.set(m,x,s),this}setFromBufferAttribute(e){let o=1/0,h=1/0,l=1/0,m=-1/0,x=-1/0,s=-1/0;for(let P=0,C=e.count;P<C;P++){const F=e.getX(P),O=e.getY(P),V=e.getZ(P);F<o&&(o=F),O<h&&(h=O),V<l&&(l=V),F>m&&(m=F),O>x&&(x=O),V>s&&(s=V)}return this.min.set(o,h,l),this.max.set(m,x,s),this}setFromPoints(e){this.makeEmpty();for(let o=0,h=e.length;o<h;o++)this.expandByPoint(e[o]);return this}setFromCenterAndSize(e,o){const h=u_.copy(o).multiplyScalar(.5);return this.min.copy(e).sub(h),this.max.copy(e).add(h),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new He),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new He),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const o=e.geometry;o!==void 0&&(o.boundingBox===null&&o.computeBoundingBox(),tT.copy(o.boundingBox),tT.applyMatrix4(e.matrixWorld),this.union(tT));const h=e.children;for(let l=0,m=h.length;l<m;l++)this.expandByObject(h[l]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,o){return o===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),o=new He),o.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,u_),u_.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let o,h;return e.normal.x>0?(o=e.normal.x*this.min.x,h=e.normal.x*this.max.x):(o=e.normal.x*this.max.x,h=e.normal.x*this.min.x),e.normal.y>0?(o+=e.normal.y*this.min.y,h+=e.normal.y*this.max.y):(o+=e.normal.y*this.max.y,h+=e.normal.y*this.min.y),e.normal.z>0?(o+=e.normal.z*this.min.z,h+=e.normal.z*this.max.z):(o+=e.normal.z*this.max.z,h+=e.normal.z*this.min.z),o<=-e.constant&&h>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(h_),y0.subVectors(this.max,h_),ep.subVectors(e.a,h_),tp.subVectors(e.b,h_),ip.subVectors(e.c,h_),Ru.subVectors(tp,ep),Lu.subVectors(ip,tp),nd.subVectors(ep,ip);let o=[0,-Ru.z,Ru.y,0,-Lu.z,Lu.y,0,-nd.z,nd.y,Ru.z,0,-Ru.x,Lu.z,0,-Lu.x,nd.z,0,-nd.x,-Ru.y,Ru.x,0,-Lu.y,Lu.x,0,-nd.y,nd.x,0];return!iT(o,ep,tp,ip,y0)||(o=[1,0,0,0,1,0,0,0,1],!iT(o,ep,tp,ip,y0))?!1:(v0.crossVectors(Ru,Lu),o=[v0.x,v0.y,v0.z],iT(o,ep,tp,ip,y0))}clampPoint(e,o){return o===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),o=new He),o.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return u_.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=this.getSize(u_).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Rc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Rc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Rc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Rc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Rc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Rc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Rc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Rc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Rc),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Ra.prototype.isBox3=!0;const Rc=[new He,new He,new He,new He,new He,new He,new He,new He],u_=new He,tT=new Ra,ep=new He,tp=new He,ip=new He,Ru=new He,Lu=new He,nd=new He,h_=new He,y0=new He,v0=new He,rd=new He;function iT(i,e,o,h,l){for(let m=0,x=i.length-3;m<=x;m+=3){rd.fromArray(i,m);const s=l.x*Math.abs(rd.x)+l.y*Math.abs(rd.y)+l.z*Math.abs(rd.z),P=e.dot(rd),C=o.dot(rd),F=h.dot(rd);if(Math.max(-Math.max(P,C,F),Math.min(P,C,F))>s)return!1}return!0}const RJ=new Ra;class Id{constructor(e=new He,o=-1){this.center=e,this.radius=o}set(e,o){return this.center.copy(e),this.radius=o,this}setFromPoints(e,o){const h=this.center;o!==void 0?h.copy(o):RJ.setFromPoints(e).getCenter(h);let l=0;for(let m=0,x=e.length;m<x;m++)l=Math.max(l,h.distanceToSquared(e[m]));return this.radius=Math.sqrt(l),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const o=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=o*o}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,o){const h=this.center.distanceToSquared(e);return o===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),o=new He),o.copy(e),h>this.radius*this.radius&&(o.sub(this.center).normalize(),o.multiplyScalar(this.radius).add(this.center)),o}getBoundingBox(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Ra),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Lc=new He,nT=new He,x0=new He,Du=new He,rT=new He,b0=new He,oT=new He;class ih{constructor(e=new He,o=new He(0,0,-1)){this.origin=e,this.direction=o}set(e,o){return this.origin.copy(e),this.direction.copy(o),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,o){return o===void 0&&(console.warn("THREE.Ray: .at() target is now required"),o=new He),o.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Lc)),this}closestPointToPoint(e,o){o===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),o=new He),o.subVectors(e,this.origin);const h=o.dot(this.direction);return h<0?o.copy(this.origin):o.copy(this.direction).multiplyScalar(h).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const o=Lc.subVectors(e,this.origin).dot(this.direction);return o<0?this.origin.distanceToSquared(e):(Lc.copy(this.direction).multiplyScalar(o).add(this.origin),Lc.distanceToSquared(e))}distanceSqToSegment(e,o,h,l){nT.copy(e).add(o).multiplyScalar(.5),x0.copy(o).sub(e).normalize(),Du.copy(this.origin).sub(nT);const m=e.distanceTo(o)*.5,x=-this.direction.dot(x0),s=Du.dot(this.direction),P=-Du.dot(x0),C=Du.lengthSq(),F=Math.abs(1-x*x);let O,V,J,ee;if(F>0)if(O=x*P-s,V=x*s-P,ee=m*F,O>=0)if(V>=-ee)if(V<=ee){const se=1/F;O*=se,V*=se,J=O*(O+x*V+2*s)+V*(x*O+V+2*P)+C}else V=m,O=Math.max(0,-(x*V+s)),J=-O*O+V*(V+2*P)+C;else V=-m,O=Math.max(0,-(x*V+s)),J=-O*O+V*(V+2*P)+C;else V<=-ee?(O=Math.max(0,-(-x*m+s)),V=O>0?-m:Math.min(Math.max(-m,-P),m),J=-O*O+V*(V+2*P)+C):V<=ee?(O=0,V=Math.min(Math.max(-m,-P),m),J=V*(V+2*P)+C):(O=Math.max(0,-(x*m+s)),V=O>0?m:Math.min(Math.max(-m,-P),m),J=-O*O+V*(V+2*P)+C);else V=x>0?-m:m,O=Math.max(0,-(x*V+s)),J=-O*O+V*(V+2*P)+C;return h&&h.copy(this.direction).multiplyScalar(O).add(this.origin),l&&l.copy(x0).multiplyScalar(V).add(nT),J}intersectSphere(e,o){Lc.subVectors(e.center,this.origin);const h=Lc.dot(this.direction),l=Lc.dot(Lc)-h*h,m=e.radius*e.radius;if(l>m)return null;const x=Math.sqrt(m-l),s=h-x,P=h+x;return s<0&&P<0?null:s<0?this.at(P,o):this.at(s,o)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const o=e.normal.dot(this.direction);if(o===0)return e.distanceToPoint(this.origin)===0?0:null;const h=-(this.origin.dot(e.normal)+e.constant)/o;return h>=0?h:null}intersectPlane(e,o){const h=this.distanceToPlane(e);return h===null?null:this.at(h,o)}intersectsPlane(e){const o=e.distanceToPoint(this.origin);return o===0||e.normal.dot(this.direction)*o<0}intersectBox(e,o){let h,l,m,x,s,P;const C=1/this.direction.x,F=1/this.direction.y,O=1/this.direction.z,V=this.origin;return C>=0?(h=(e.min.x-V.x)*C,l=(e.max.x-V.x)*C):(h=(e.max.x-V.x)*C,l=(e.min.x-V.x)*C),F>=0?(m=(e.min.y-V.y)*F,x=(e.max.y-V.y)*F):(m=(e.max.y-V.y)*F,x=(e.min.y-V.y)*F),h>x||m>l||((m>h||h!==h)&&(h=m),(x<l||l!==l)&&(l=x),O>=0?(s=(e.min.z-V.z)*O,P=(e.max.z-V.z)*O):(s=(e.max.z-V.z)*O,P=(e.min.z-V.z)*O),h>P||s>l)||((s>h||h!==h)&&(h=s),(P<l||l!==l)&&(l=P),l<0)?null:this.at(h>=0?h:l,o)}intersectsBox(e){return this.intersectBox(e,Lc)!==null}intersectTriangle(e,o,h,l,m){rT.subVectors(o,e),b0.subVectors(h,e),oT.crossVectors(rT,b0);let x=this.direction.dot(oT),s;if(x>0){if(l)return null;s=1}else if(x<0)s=-1,x=-x;else return null;Du.subVectors(this.origin,e);const P=s*this.direction.dot(b0.crossVectors(Du,b0));if(P<0)return null;const C=s*this.direction.dot(rT.cross(Du));if(C<0||P+C>x)return null;const F=-s*Du.dot(oT);return F<0?null:this.at(F/x,m)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class tn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,o,h,l,m,x,s,P,C,F,O,V,J,ee,se,fe){const le=this.elements;return le[0]=e,le[4]=o,le[8]=h,le[12]=l,le[1]=m,le[5]=x,le[9]=s,le[13]=P,le[2]=C,le[6]=F,le[10]=O,le[14]=V,le[3]=J,le[7]=ee,le[11]=se,le[15]=fe,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new tn().fromArray(this.elements)}copy(e){const o=this.elements,h=e.elements;return o[0]=h[0],o[1]=h[1],o[2]=h[2],o[3]=h[3],o[4]=h[4],o[5]=h[5],o[6]=h[6],o[7]=h[7],o[8]=h[8],o[9]=h[9],o[10]=h[10],o[11]=h[11],o[12]=h[12],o[13]=h[13],o[14]=h[14],o[15]=h[15],this}copyPosition(e){const o=this.elements,h=e.elements;return o[12]=h[12],o[13]=h[13],o[14]=h[14],this}setFromMatrix3(e){const o=e.elements;return this.set(o[0],o[3],o[6],0,o[1],o[4],o[7],0,o[2],o[5],o[8],0,0,0,0,1),this}extractBasis(e,o,h){return e.setFromMatrixColumn(this,0),o.setFromMatrixColumn(this,1),h.setFromMatrixColumn(this,2),this}makeBasis(e,o,h){return this.set(e.x,o.x,h.x,0,e.y,o.y,h.y,0,e.z,o.z,h.z,0,0,0,0,1),this}extractRotation(e){const o=this.elements,h=e.elements,l=1/np.setFromMatrixColumn(e,0).length(),m=1/np.setFromMatrixColumn(e,1).length(),x=1/np.setFromMatrixColumn(e,2).length();return o[0]=h[0]*l,o[1]=h[1]*l,o[2]=h[2]*l,o[3]=0,o[4]=h[4]*m,o[5]=h[5]*m,o[6]=h[6]*m,o[7]=0,o[8]=h[8]*x,o[9]=h[9]*x,o[10]=h[10]*x,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const o=this.elements,h=e.x,l=e.y,m=e.z,x=Math.cos(h),s=Math.sin(h),P=Math.cos(l),C=Math.sin(l),F=Math.cos(m),O=Math.sin(m);if(e.order==="XYZ"){const V=x*F,J=x*O,ee=s*F,se=s*O;o[0]=P*F,o[4]=-P*O,o[8]=C,o[1]=J+ee*C,o[5]=V-se*C,o[9]=-s*P,o[2]=se-V*C,o[6]=ee+J*C,o[10]=x*P}else if(e.order==="YXZ"){const V=P*F,J=P*O,ee=C*F,se=C*O;o[0]=V+se*s,o[4]=ee*s-J,o[8]=x*C,o[1]=x*O,o[5]=x*F,o[9]=-s,o[2]=J*s-ee,o[6]=se+V*s,o[10]=x*P}else if(e.order==="ZXY"){const V=P*F,J=P*O,ee=C*F,se=C*O;o[0]=V-se*s,o[4]=-x*O,o[8]=ee+J*s,o[1]=J+ee*s,o[5]=x*F,o[9]=se-V*s,o[2]=-x*C,o[6]=s,o[10]=x*P}else if(e.order==="ZYX"){const V=x*F,J=x*O,ee=s*F,se=s*O;o[0]=P*F,o[4]=ee*C-J,o[8]=V*C+se,o[1]=P*O,o[5]=se*C+V,o[9]=J*C-ee,o[2]=-C,o[6]=s*P,o[10]=x*P}else if(e.order==="YZX"){const V=x*P,J=x*C,ee=s*P,se=s*C;o[0]=P*F,o[4]=se-V*O,o[8]=ee*O+J,o[1]=O,o[5]=x*F,o[9]=-s*F,o[2]=-C*F,o[6]=J*O+ee,o[10]=V-se*O}else if(e.order==="XZY"){const V=x*P,J=x*C,ee=s*P,se=s*C;o[0]=P*F,o[4]=-O,o[8]=C*F,o[1]=V*O+se,o[5]=x*F,o[9]=J*O-ee,o[2]=ee*O-J,o[6]=s*F,o[10]=se*O+V}return o[3]=0,o[7]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromQuaternion(e){return this.compose(LJ,e,DJ)}lookAt(e,o,h){const l=this.elements;return ba.subVectors(e,o),ba.lengthSq()===0&&(ba.z=1),ba.normalize(),ku.crossVectors(h,ba),ku.lengthSq()===0&&(Math.abs(h.z)===1?ba.x+=1e-4:ba.z+=1e-4,ba.normalize(),ku.crossVectors(h,ba)),ku.normalize(),w0.crossVectors(ba,ku),l[0]=ku.x,l[4]=w0.x,l[8]=ba.x,l[1]=ku.y,l[5]=w0.y,l[9]=ba.y,l[2]=ku.z,l[6]=w0.z,l[10]=ba.z,this}multiply(e,o){return o!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,o)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,o){const h=e.elements,l=o.elements,m=this.elements,x=h[0],s=h[4],P=h[8],C=h[12],F=h[1],O=h[5],V=h[9],J=h[13],ee=h[2],se=h[6],fe=h[10],le=h[14],ie=h[3],it=h[7],Ve=h[11],Ne=h[15],Re=l[0],Ye=l[4],zt=l[8],pt=l[12],St=l[1],Et=l[5],Dt=l[9],Qe=l[13],ht=l[2],_t=l[6],yt=l[10],Nt=l[14],Qt=l[3],pi=l[7],Pi=l[11],Mi=l[15];return m[0]=x*Re+s*St+P*ht+C*Qt,m[4]=x*Ye+s*Et+P*_t+C*pi,m[8]=x*zt+s*Dt+P*yt+C*Pi,m[12]=x*pt+s*Qe+P*Nt+C*Mi,m[1]=F*Re+O*St+V*ht+J*Qt,m[5]=F*Ye+O*Et+V*_t+J*pi,m[9]=F*zt+O*Dt+V*yt+J*Pi,m[13]=F*pt+O*Qe+V*Nt+J*Mi,m[2]=ee*Re+se*St+fe*ht+le*Qt,m[6]=ee*Ye+se*Et+fe*_t+le*pi,m[10]=ee*zt+se*Dt+fe*yt+le*Pi,m[14]=ee*pt+se*Qe+fe*Nt+le*Mi,m[3]=ie*Re+it*St+Ve*ht+Ne*Qt,m[7]=ie*Ye+it*Et+Ve*_t+Ne*pi,m[11]=ie*zt+it*Dt+Ve*yt+Ne*Pi,m[15]=ie*pt+it*Qe+Ve*Nt+Ne*Mi,this}multiplyScalar(e){const o=this.elements;return o[0]*=e,o[4]*=e,o[8]*=e,o[12]*=e,o[1]*=e,o[5]*=e,o[9]*=e,o[13]*=e,o[2]*=e,o[6]*=e,o[10]*=e,o[14]*=e,o[3]*=e,o[7]*=e,o[11]*=e,o[15]*=e,this}determinant(){const e=this.elements,o=e[0],h=e[4],l=e[8],m=e[12],x=e[1],s=e[5],P=e[9],C=e[13],F=e[2],O=e[6],V=e[10],J=e[14],ee=e[3],se=e[7],fe=e[11],le=e[15];return ee*(+m*P*O-l*C*O-m*s*V+h*C*V+l*s*J-h*P*J)+se*(+o*P*J-o*C*V+m*x*V-l*x*J+l*C*F-m*P*F)+fe*(+o*C*O-o*s*J-m*x*O+h*x*J+m*s*F-h*C*F)+le*(-l*s*F-o*P*O+o*s*V+l*x*O-h*x*V+h*P*F)}transpose(){const e=this.elements;let o;return o=e[1],e[1]=e[4],e[4]=o,o=e[2],e[2]=e[8],e[8]=o,o=e[6],e[6]=e[9],e[9]=o,o=e[3],e[3]=e[12],e[12]=o,o=e[7],e[7]=e[13],e[13]=o,o=e[11],e[11]=e[14],e[14]=o,this}setPosition(e,o,h){const l=this.elements;return e.isVector3?(l[12]=e.x,l[13]=e.y,l[14]=e.z):(l[12]=e,l[13]=o,l[14]=h),this}invert(){const e=this.elements,o=e[0],h=e[1],l=e[2],m=e[3],x=e[4],s=e[5],P=e[6],C=e[7],F=e[8],O=e[9],V=e[10],J=e[11],ee=e[12],se=e[13],fe=e[14],le=e[15],ie=O*fe*C-se*V*C+se*P*J-s*fe*J-O*P*le+s*V*le,it=ee*V*C-F*fe*C-ee*P*J+x*fe*J+F*P*le-x*V*le,Ve=F*se*C-ee*O*C+ee*s*J-x*se*J-F*s*le+x*O*le,Ne=ee*O*P-F*se*P-ee*s*V+x*se*V+F*s*fe-x*O*fe,Re=o*ie+h*it+l*Ve+m*Ne;if(Re===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ye=1/Re;return e[0]=ie*Ye,e[1]=(se*V*m-O*fe*m-se*l*J+h*fe*J+O*l*le-h*V*le)*Ye,e[2]=(s*fe*m-se*P*m+se*l*C-h*fe*C-s*l*le+h*P*le)*Ye,e[3]=(O*P*m-s*V*m-O*l*C+h*V*C+s*l*J-h*P*J)*Ye,e[4]=it*Ye,e[5]=(F*fe*m-ee*V*m+ee*l*J-o*fe*J-F*l*le+o*V*le)*Ye,e[6]=(ee*P*m-x*fe*m-ee*l*C+o*fe*C+x*l*le-o*P*le)*Ye,e[7]=(x*V*m-F*P*m+F*l*C-o*V*C-x*l*J+o*P*J)*Ye,e[8]=Ve*Ye,e[9]=(ee*O*m-F*se*m-ee*h*J+o*se*J+F*h*le-o*O*le)*Ye,e[10]=(x*se*m-ee*s*m+ee*h*C-o*se*C-x*h*le+o*s*le)*Ye,e[11]=(F*s*m-x*O*m-F*h*C+o*O*C+x*h*J-o*s*J)*Ye,e[12]=Ne*Ye,e[13]=(F*se*l-ee*O*l+ee*h*V-o*se*V-F*h*fe+o*O*fe)*Ye,e[14]=(ee*s*l-x*se*l-ee*h*P+o*se*P+x*h*fe-o*s*fe)*Ye,e[15]=(x*O*l-F*s*l+F*h*P-o*O*P-x*h*V+o*s*V)*Ye,this}scale(e){const o=this.elements,h=e.x,l=e.y,m=e.z;return o[0]*=h,o[4]*=l,o[8]*=m,o[1]*=h,o[5]*=l,o[9]*=m,o[2]*=h,o[6]*=l,o[10]*=m,o[3]*=h,o[7]*=l,o[11]*=m,this}getMaxScaleOnAxis(){const e=this.elements,o=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],h=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],l=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(o,h,l))}makeTranslation(e,o,h){return this.set(1,0,0,e,0,1,0,o,0,0,1,h,0,0,0,1),this}makeRotationX(e){const o=Math.cos(e),h=Math.sin(e);return this.set(1,0,0,0,0,o,-h,0,0,h,o,0,0,0,0,1),this}makeRotationY(e){const o=Math.cos(e),h=Math.sin(e);return this.set(o,0,h,0,0,1,0,0,-h,0,o,0,0,0,0,1),this}makeRotationZ(e){const o=Math.cos(e),h=Math.sin(e);return this.set(o,-h,0,0,h,o,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,o){const h=Math.cos(o),l=Math.sin(o),m=1-h,x=e.x,s=e.y,P=e.z,C=m*x,F=m*s;return this.set(C*x+h,C*s-l*P,C*P+l*s,0,C*s+l*P,F*s+h,F*P-l*x,0,C*P-l*s,F*P+l*x,m*P*P+h,0,0,0,0,1),this}makeScale(e,o,h){return this.set(e,0,0,0,0,o,0,0,0,0,h,0,0,0,0,1),this}makeShear(e,o,h){return this.set(1,o,h,0,e,1,h,0,e,o,1,0,0,0,0,1),this}compose(e,o,h){const l=this.elements,m=o._x,x=o._y,s=o._z,P=o._w,C=m+m,F=x+x,O=s+s,V=m*C,J=m*F,ee=m*O,se=x*F,fe=x*O,le=s*O,ie=P*C,it=P*F,Ve=P*O,Ne=h.x,Re=h.y,Ye=h.z;return l[0]=(1-(se+le))*Ne,l[1]=(J+Ve)*Ne,l[2]=(ee-it)*Ne,l[3]=0,l[4]=(J-Ve)*Re,l[5]=(1-(V+le))*Re,l[6]=(fe+ie)*Re,l[7]=0,l[8]=(ee+it)*Ye,l[9]=(fe-ie)*Ye,l[10]=(1-(V+se))*Ye,l[11]=0,l[12]=e.x,l[13]=e.y,l[14]=e.z,l[15]=1,this}decompose(e,o,h){const l=this.elements;let m=np.set(l[0],l[1],l[2]).length();const x=np.set(l[4],l[5],l[6]).length(),s=np.set(l[8],l[9],l[10]).length();this.determinant()<0&&(m=-m),e.x=l[12],e.y=l[13],e.z=l[14],xl.copy(this);const C=1/m,F=1/x,O=1/s;return xl.elements[0]*=C,xl.elements[1]*=C,xl.elements[2]*=C,xl.elements[4]*=F,xl.elements[5]*=F,xl.elements[6]*=F,xl.elements[8]*=O,xl.elements[9]*=O,xl.elements[10]*=O,o.setFromRotationMatrix(xl),h.x=m,h.y=x,h.z=s,this}makePerspective(e,o,h,l,m,x){x===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,P=2*m/(o-e),C=2*m/(h-l),F=(o+e)/(o-e),O=(h+l)/(h-l),V=-(x+m)/(x-m),J=-2*x*m/(x-m);return s[0]=P,s[4]=0,s[8]=F,s[12]=0,s[1]=0,s[5]=C,s[9]=O,s[13]=0,s[2]=0,s[6]=0,s[10]=V,s[14]=J,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,o,h,l,m,x){const s=this.elements,P=1/(o-e),C=1/(h-l),F=1/(x-m),O=(o+e)*P,V=(h+l)*C,J=(x+m)*F;return s[0]=2*P,s[4]=0,s[8]=0,s[12]=-O,s[1]=0,s[5]=2*C,s[9]=0,s[13]=-V,s[2]=0,s[6]=0,s[10]=-2*F,s[14]=-J,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const o=this.elements,h=e.elements;for(let l=0;l<16;l++)if(o[l]!==h[l])return!1;return!0}fromArray(e,o=0){for(let h=0;h<16;h++)this.elements[h]=e[h+o];return this}toArray(e=[],o=0){const h=this.elements;return e[o]=h[0],e[o+1]=h[1],e[o+2]=h[2],e[o+3]=h[3],e[o+4]=h[4],e[o+5]=h[5],e[o+6]=h[6],e[o+7]=h[7],e[o+8]=h[8],e[o+9]=h[9],e[o+10]=h[10],e[o+11]=h[11],e[o+12]=h[12],e[o+13]=h[13],e[o+14]=h[14],e[o+15]=h[15],e}}tn.prototype.isMatrix4=!0;const np=new He,xl=new tn,LJ=new He(0,0,0),DJ=new He(1,1,1),ku=new He,w0=new He,ba=new He,CR=new tn,RR=new Rs;class Md{constructor(e=0,o=0,h=0,l=Md.DefaultOrder){this._x=e,this._y=o,this._z=h,this._order=l}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,o,h,l){return this._x=e,this._y=o,this._z=h,this._order=l||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,o,h){const l=kn.clamp,m=e.elements,x=m[0],s=m[4],P=m[8],C=m[1],F=m[5],O=m[9],V=m[2],J=m[6],ee=m[10];switch(o=o||this._order,o){case"XYZ":this._y=Math.asin(l(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(-O,ee),this._z=Math.atan2(-s,x)):(this._x=Math.atan2(J,F),this._z=0);break;case"YXZ":this._x=Math.asin(-l(O,-1,1)),Math.abs(O)<.9999999?(this._y=Math.atan2(P,ee),this._z=Math.atan2(C,F)):(this._y=Math.atan2(-V,x),this._z=0);break;case"ZXY":this._x=Math.asin(l(J,-1,1)),Math.abs(J)<.9999999?(this._y=Math.atan2(-V,ee),this._z=Math.atan2(-s,F)):(this._y=0,this._z=Math.atan2(C,x));break;case"ZYX":this._y=Math.asin(-l(V,-1,1)),Math.abs(V)<.9999999?(this._x=Math.atan2(J,ee),this._z=Math.atan2(C,x)):(this._x=0,this._z=Math.atan2(-s,F));break;case"YZX":this._z=Math.asin(l(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(-O,F),this._y=Math.atan2(-V,x)):(this._x=0,this._y=Math.atan2(P,ee));break;case"XZY":this._z=Math.asin(-l(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(J,F),this._y=Math.atan2(P,x)):(this._x=Math.atan2(-O,ee),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+o)}return this._order=o,h!==!1&&this._onChangeCallback(),this}setFromQuaternion(e,o,h){return CR.makeRotationFromQuaternion(e),this.setFromRotationMatrix(CR,o,h)}setFromVector3(e,o){return this.set(e.x,e.y,e.z,o||this._order)}reorder(e){return RR.setFromEuler(this),this.setFromQuaternion(RR,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],o=0){return e[o]=this._x,e[o+1]=this._y,e[o+2]=this._z,e[o+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new He(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Md.prototype.isEuler=!0;Md.DefaultOrder="XYZ";Md.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class i2{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}}let kJ=0;const LR=new He,rp=new Rs,Dc=new tn,S0=new He,d_=new He,OJ=new He,FJ=new Rs,DR=new He(1,0,0),kR=new He(0,1,0),OR=new He(0,0,1),BJ={type:"added"},FR={type:"removed"};function Rn(){Object.defineProperty(this,"id",{value:kJ++}),this.uuid=kn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Rn.DefaultUp.clone();const i=new He,e=new Md,o=new Rs,h=new He(1,1,1);function l(){o.setFromEuler(e,!1)}function m(){e.setFromQuaternion(o,void 0,!1)}e._onChange(l),o._onChange(m),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:h},modelViewMatrix:{value:new tn},normalMatrix:{value:new Qo}}),this.matrix=new tn,this.matrixWorld=new tn,this.matrixAutoUpdate=Rn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new i2,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Rn.DefaultUp=new He(0,1,0);Rn.DefaultMatrixAutoUpdate=!0;Rn.prototype=Object.assign(Object.create(Gc.prototype),{constructor:Rn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(i){return this.quaternion.premultiply(i),this},setRotationFromAxisAngle:function(i,e){this.quaternion.setFromAxisAngle(i,e)},setRotationFromEuler:function(i){this.quaternion.setFromEuler(i,!0)},setRotationFromMatrix:function(i){this.quaternion.setFromRotationMatrix(i)},setRotationFromQuaternion:function(i){this.quaternion.copy(i)},rotateOnAxis:function(i,e){return rp.setFromAxisAngle(i,e),this.quaternion.multiply(rp),this},rotateOnWorldAxis:function(i,e){return rp.setFromAxisAngle(i,e),this.quaternion.premultiply(rp),this},rotateX:function(i){return this.rotateOnAxis(DR,i)},rotateY:function(i){return this.rotateOnAxis(kR,i)},rotateZ:function(i){return this.rotateOnAxis(OR,i)},translateOnAxis:function(i,e){return LR.copy(i).applyQuaternion(this.quaternion),this.position.add(LR.multiplyScalar(e)),this},translateX:function(i){return this.translateOnAxis(DR,i)},translateY:function(i){return this.translateOnAxis(kR,i)},translateZ:function(i){return this.translateOnAxis(OR,i)},localToWorld:function(i){return i.applyMatrix4(this.matrixWorld)},worldToLocal:function(i){return i.applyMatrix4(Dc.copy(this.matrixWorld).invert())},lookAt:function(i,e,o){i.isVector3?S0.copy(i):S0.set(i,e,o);const h=this.parent;this.updateWorldMatrix(!0,!1),d_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Dc.lookAt(d_,S0,this.up):Dc.lookAt(S0,d_,this.up),this.quaternion.setFromRotationMatrix(Dc),h&&(Dc.extractRotation(h.matrixWorld),rp.setFromRotationMatrix(Dc),this.quaternion.premultiply(rp.invert()))},add:function(i){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.parent!==null&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(BJ)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)},remove:function(i){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.remove(arguments[o]);return this}const e=this.children.indexOf(i);return e!==-1&&(i.parent=null,this.children.splice(e,1),i.dispatchEvent(FR)),this},clear:function(){for(let i=0;i<this.children.length;i++){const e=this.children[i];e.parent=null,e.dispatchEvent(FR)}return this.children.length=0,this},attach:function(i){return this.updateWorldMatrix(!0,!1),Dc.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),Dc.multiply(i.parent.matrixWorld)),i.applyMatrix4(Dc),this.add(i),i.updateWorldMatrix(!1,!0),this},getObjectById:function(i){return this.getObjectByProperty("id",i)},getObjectByName:function(i){return this.getObjectByProperty("name",i)},getObjectByProperty:function(i,e){if(this[i]===e)return this;for(let o=0,h=this.children.length;o<h;o++){const m=this.children[o].getObjectByProperty(i,e);if(m!==void 0)return m}},getWorldPosition:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),i=new He),this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new Rs),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(d_,i,OJ),i},getWorldScale:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new He),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(d_,FJ,i),i},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),i=new He),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return i.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(i){i(this);const e=this.children;for(let o=0,h=e.length;o<h;o++)e[o].traverse(i)},traverseVisible:function(i){if(this.visible===!1)return;i(this);const e=this.children;for(let o=0,h=e.length;o<h;o++)e[o].traverseVisible(i)},traverseAncestors:function(i){const e=this.parent;e!==null&&(i(e),e.traverseAncestors(i))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);const e=this.children;for(let o=0,h=e.length;o<h;o++)e[o].updateMatrixWorld(i)},updateWorldMatrix:function(i,e){const o=this.parent;if(i===!0&&o!==null&&o.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const h=this.children;for(let l=0,m=h.length;l<m;l++)h[l].updateWorldMatrix(!1,!0)}},toJSON:function(i){const e=i===void 0||typeof i=="string",o={};e&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},o.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const h={};h.uuid=this.uuid,h.type=this.type,this.name!==""&&(h.name=this.name),this.castShadow===!0&&(h.castShadow=!0),this.receiveShadow===!0&&(h.receiveShadow=!0),this.visible===!1&&(h.visible=!1),this.frustumCulled===!1&&(h.frustumCulled=!1),this.renderOrder!==0&&(h.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(h.userData=this.userData),h.layers=this.layers.mask,h.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(h.matrixAutoUpdate=!1),this.isInstancedMesh&&(h.type="InstancedMesh",h.count=this.count,h.instanceMatrix=this.instanceMatrix.toJSON());function l(x,s){return x[s.uuid]===void 0&&(x[s.uuid]=s.toJSON(i)),s.uuid}if(this.isMesh||this.isLine||this.isPoints){h.geometry=l(i.geometries,this.geometry);const x=this.geometry.parameters;if(x!==void 0&&x.shapes!==void 0){const s=x.shapes;if(Array.isArray(s))for(let P=0,C=s.length;P<C;P++){const F=s[P];l(i.shapes,F)}else l(i.shapes,s)}}if(this.isSkinnedMesh&&(h.bindMode=this.bindMode,h.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(i.skeletons,this.skeleton),h.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const x=[];for(let s=0,P=this.material.length;s<P;s++)x.push(l(i.materials,this.material[s]));h.material=x}else h.material=l(i.materials,this.material);if(this.children.length>0){h.children=[];for(let x=0;x<this.children.length;x++)h.children.push(this.children[x].toJSON(i).object)}if(this.animations.length>0){h.animations=[];for(let x=0;x<this.animations.length;x++){const s=this.animations[x];h.animations.push(l(i.animations,s))}}if(e){const x=m(i.geometries),s=m(i.materials),P=m(i.textures),C=m(i.images),F=m(i.shapes),O=m(i.skeletons),V=m(i.animations);x.length>0&&(o.geometries=x),s.length>0&&(o.materials=s),P.length>0&&(o.textures=P),C.length>0&&(o.images=C),F.length>0&&(o.shapes=F),O.length>0&&(o.skeletons=O),V.length>0&&(o.animations=V)}return o.object=h,o;function m(x){const s=[];for(const P in x){const C=x[P];delete C.metadata,s.push(C)}return s}},clone:function(i){return new this.constructor().copy(this,i)},copy:function(i,e=!0){if(this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData=JSON.parse(JSON.stringify(i.userData)),e===!0)for(let o=0;o<i.children.length;o++){const h=i.children[o];this.add(h.clone())}return this}});const sT=new He,NJ=new He,UJ=new Qo;class El{constructor(e=new He(1,0,0),o=0){this.normal=e,this.constant=o}set(e,o){return this.normal.copy(e),this.constant=o,this}setComponents(e,o,h,l){return this.normal.set(e,o,h),this.constant=l,this}setFromNormalAndCoplanarPoint(e,o){return this.normal.copy(e),this.constant=-o.dot(this.normal),this}setFromCoplanarPoints(e,o,h){const l=sT.subVectors(h,o).cross(NJ.subVectors(e,o)).normalize();return this.setFromNormalAndCoplanarPoint(l,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,o){return o===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),o=new He),o.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,o){o===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),o=new He);const h=e.delta(sT),l=this.normal.dot(h);if(l===0)return this.distanceToPoint(e.start)===0?o.copy(e.start):void 0;const m=-(e.start.dot(this.normal)+this.constant)/l;if(!(m<0||m>1))return o.copy(h).multiplyScalar(m).add(e.start)}intersectsLine(e){const o=this.distanceToPoint(e.start),h=this.distanceToPoint(e.end);return o<0&&h>0||h<0&&o>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new He),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,o){const h=o||UJ.getNormalMatrix(e),l=this.coplanarPoint(sT).applyMatrix4(e),m=this.normal.applyMatrix3(h).normalize();return this.constant=-l.dot(m),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}El.prototype.isPlane=!0;const bl=new He,kc=new He,aT=new He,Oc=new He,op=new He,sp=new He,BR=new He,lT=new He,cT=new He,uT=new He;class zo{constructor(e=new He,o=new He,h=new He){this.a=e,this.b=o,this.c=h}static getNormal(e,o,h,l){l===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),l=new He),l.subVectors(h,o),bl.subVectors(e,o),l.cross(bl);const m=l.lengthSq();return m>0?l.multiplyScalar(1/Math.sqrt(m)):l.set(0,0,0)}static getBarycoord(e,o,h,l,m){bl.subVectors(l,o),kc.subVectors(h,o),aT.subVectors(e,o);const x=bl.dot(bl),s=bl.dot(kc),P=bl.dot(aT),C=kc.dot(kc),F=kc.dot(aT),O=x*C-s*s;if(m===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),m=new He),O===0)return m.set(-2,-1,-1);const V=1/O,J=(C*P-s*F)*V,ee=(x*F-s*P)*V;return m.set(1-J-ee,ee,J)}static containsPoint(e,o,h,l){return this.getBarycoord(e,o,h,l,Oc),Oc.x>=0&&Oc.y>=0&&Oc.x+Oc.y<=1}static getUV(e,o,h,l,m,x,s,P){return this.getBarycoord(e,o,h,l,Oc),P.set(0,0),P.addScaledVector(m,Oc.x),P.addScaledVector(x,Oc.y),P.addScaledVector(s,Oc.z),P}static isFrontFacing(e,o,h,l){return bl.subVectors(h,o),kc.subVectors(e,o),bl.cross(kc).dot(l)<0}set(e,o,h){return this.a.copy(e),this.b.copy(o),this.c.copy(h),this}setFromPointsAndIndices(e,o,h,l){return this.a.copy(e[o]),this.b.copy(e[h]),this.c.copy(e[l]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return bl.subVectors(this.c,this.b),kc.subVectors(this.a,this.b),bl.cross(kc).length()*.5}getMidpoint(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new He),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return zo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new El),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,o){return zo.getBarycoord(e,this.a,this.b,this.c,o)}getUV(e,o,h,l,m){return zo.getUV(e,this.a,this.b,this.c,o,h,l,m)}containsPoint(e){return zo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return zo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,o){o===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),o=new He);const h=this.a,l=this.b,m=this.c;let x,s;op.subVectors(l,h),sp.subVectors(m,h),lT.subVectors(e,h);const P=op.dot(lT),C=sp.dot(lT);if(P<=0&&C<=0)return o.copy(h);cT.subVectors(e,l);const F=op.dot(cT),O=sp.dot(cT);if(F>=0&&O<=F)return o.copy(l);const V=P*O-F*C;if(V<=0&&P>=0&&F<=0)return x=P/(P-F),o.copy(h).addScaledVector(op,x);uT.subVectors(e,m);const J=op.dot(uT),ee=sp.dot(uT);if(ee>=0&&J<=ee)return o.copy(m);const se=J*C-P*ee;if(se<=0&&C>=0&&ee<=0)return s=C/(C-ee),o.copy(h).addScaledVector(sp,s);const fe=F*ee-J*O;if(fe<=0&&O-F>=0&&J-ee>=0)return BR.subVectors(m,l),s=(O-F)/(O-F+(J-ee)),o.copy(l).addScaledVector(BR,s);const le=1/(fe+se+V);return x=se*le,s=V*le,o.copy(h).addScaledVector(op,x).addScaledVector(sp,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let $J=0;function eo(){Object.defineProperty(this,"id",{value:$J++}),this.uuid=kn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=wp,this.side=Cy,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=YM,this.blendDst=KM,this.blendEquation=ad,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ub,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ZN,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=q0,this.stencilZFail=q0,this.stencilZPass=q0,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}eo.prototype=Object.assign(Object.create(Gc.prototype),{constructor:eo,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(i){if(i!==void 0)for(const e in i){const o=i[e];if(o===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=o===JM;continue}const h=this[e];if(h===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}h&&h.isColor?h.set(o):h&&h.isVector3&&o&&o.isVector3?h.copy(o):this[e]=o}},toJSON:function(i){const e=i===void 0||typeof i=="string";e&&(i={textures:{},images:{}});const o={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.color&&this.color.isColor&&(o.color=this.color.getHex()),this.roughness!==void 0&&(o.roughness=this.roughness),this.metalness!==void 0&&(o.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(o.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(o.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(o.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(o.specular=this.specular.getHex()),this.shininess!==void 0&&(o.shininess=this.shininess),this.clearcoat!==void 0&&(o.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(o.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(o.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(o.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(o.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,o.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(o.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(o.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(o.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(o.lightMap=this.lightMap.toJSON(i).uuid,o.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(o.aoMap=this.aoMap.toJSON(i).uuid,o.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(o.bumpMap=this.bumpMap.toJSON(i).uuid,o.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(o.normalMap=this.normalMap.toJSON(i).uuid,o.normalMapType=this.normalMapType,o.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(o.displacementMap=this.displacementMap.toJSON(i).uuid,o.displacementScale=this.displacementScale,o.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(o.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(o.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(o.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(o.specularMap=this.specularMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(o.envMap=this.envMap.toJSON(i).uuid,o.reflectivity=this.reflectivity,o.refractionRatio=this.refractionRatio,this.combine!==void 0&&(o.combine=this.combine),this.envMapIntensity!==void 0&&(o.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(o.gradientMap=this.gradientMap.toJSON(i).uuid),this.size!==void 0&&(o.size=this.size),this.sizeAttenuation!==void 0&&(o.sizeAttenuation=this.sizeAttenuation),this.blending!==wp&&(o.blending=this.blending),this.side!==Cy&&(o.side=this.side),this.vertexColors&&(o.vertexColors=!0),this.opacity<1&&(o.opacity=this.opacity),this.transparent===!0&&(o.transparent=this.transparent),o.depthFunc=this.depthFunc,o.depthTest=this.depthTest,o.depthWrite=this.depthWrite,o.stencilWrite=this.stencilWrite,o.stencilWriteMask=this.stencilWriteMask,o.stencilFunc=this.stencilFunc,o.stencilRef=this.stencilRef,o.stencilFuncMask=this.stencilFuncMask,o.stencilFail=this.stencilFail,o.stencilZFail=this.stencilZFail,o.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(o.rotation=this.rotation),this.polygonOffset===!0&&(o.polygonOffset=!0),this.polygonOffsetFactor!==0&&(o.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(o.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(o.linewidth=this.linewidth),this.dashSize!==void 0&&(o.dashSize=this.dashSize),this.gapSize!==void 0&&(o.gapSize=this.gapSize),this.scale!==void 0&&(o.scale=this.scale),this.dithering===!0&&(o.dithering=!0),this.alphaTest>0&&(o.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(o.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(o.wireframe=this.wireframe),this.wireframeLinewidth>1&&(o.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(o.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(o.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(o.morphTargets=!0),this.morphNormals===!0&&(o.morphNormals=!0),this.skinning===!0&&(o.skinning=!0),this.flatShading===!0&&(o.flatShading=this.flatShading),this.visible===!1&&(o.visible=!1),this.toneMapped===!1&&(o.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(o.userData=this.userData);function h(l){const m=[];for(const x in l){const s=l[x];delete s.metadata,m.push(s)}return m}if(e){const l=h(i.textures),m=h(i.images);l.length>0&&(o.textures=l),m.length>0&&(o.images=m)}return o},clone:function(){return new this.constructor().copy(this)},copy:function(i){this.name=i.name,this.fog=i.fog,this.blending=i.blending,this.side=i.side,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;const e=i.clippingPlanes;let o=null;if(e!==null){const h=e.length;o=new Array(h);for(let l=0;l!==h;++l)o[l]=e[l].clone()}return this.clippingPlanes=o,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData=JSON.parse(JSON.stringify(i.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(eo.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});const qN={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},wl={h:0,s:0,l:0},T0={h:0,s:0,l:0};function hT(i,e,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?i+(e-i)*6*o:o<1/2?e:o<2/3?i+(e-i)*6*(2/3-o):i}function dT(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function fT(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}class dn{constructor(e,o,h){return o===void 0&&h===void 0?this.set(e):this.setRGB(e,o,h)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,o,h){return this.r=e,this.g=o,this.b=h,this}setHSL(e,o,h){if(e=kn.euclideanModulo(e,1),o=kn.clamp(o,0,1),h=kn.clamp(h,0,1),o===0)this.r=this.g=this.b=h;else{const l=h<=.5?h*(1+o):h+o-h*o,m=2*h-l;this.r=hT(m,l,e+1/3),this.g=hT(m,l,e),this.b=hT(m,l,e-1/3)}return this}setStyle(e){function o(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let h;if(h=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let l;const m=h[1],x=h[2];switch(m){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(x))return this.r=Math.min(255,parseInt(l[1],10))/255,this.g=Math.min(255,parseInt(l[2],10))/255,this.b=Math.min(255,parseInt(l[3],10))/255,o(l[4]),this;if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(x))return this.r=Math.min(100,parseInt(l[1],10))/100,this.g=Math.min(100,parseInt(l[2],10))/100,this.b=Math.min(100,parseInt(l[3],10))/100,o(l[4]),this;break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(x)){const s=parseFloat(l[1])/360,P=parseInt(l[2],10)/100,C=parseInt(l[3],10)/100;return o(l[4]),this.setHSL(s,P,C)}break}}else if(h=/^\#([A-Fa-f\d]+)$/.exec(e)){const l=h[1],m=l.length;if(m===3)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(m===6)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const o=qN[e];return o!==void 0?this.setHex(o):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,o=2){return this.r=Math.pow(e.r,o),this.g=Math.pow(e.g,o),this.b=Math.pow(e.b,o),this}copyLinearToGamma(e,o=2){const h=o>0?1/o:1;return this.r=Math.pow(e.r,h),this.g=Math.pow(e.g,h),this.b=Math.pow(e.b,h),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=dT(e.r),this.g=dT(e.g),this.b=dT(e.b),this}copyLinearToSRGB(e){return this.r=fT(e.r),this.g=fT(e.g),this.b=fT(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const o=this.r,h=this.g,l=this.b,m=Math.max(o,h,l),x=Math.min(o,h,l);let s,P;const C=(x+m)/2;if(x===m)s=0,P=0;else{const F=m-x;switch(P=C<=.5?F/(m+x):F/(2-m-x),m){case o:s=(h-l)/F+(h<l?6:0);break;case h:s=(l-o)/F+2;break;case l:s=(o-h)/F+4;break}s/=6}return e.h=s,e.s=P,e.l=C,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,o,h){return this.getHSL(wl),wl.h+=e,wl.s+=o,wl.l+=h,this.setHSL(wl.h,wl.s,wl.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,o){return this.r=e.r+o.r,this.g=e.g+o.g,this.b=e.b+o.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,o){return this.r+=(e.r-this.r)*o,this.g+=(e.g-this.g)*o,this.b+=(e.b-this.b)*o,this}lerpColors(e,o,h){return this.r=e.r+(o.r-e.r)*h,this.g=e.g+(o.g-e.g)*h,this.b=e.b+(o.b-e.b)*h,this}lerpHSL(e,o){this.getHSL(wl),e.getHSL(T0);const h=kn.lerp(wl.h,T0.h,o),l=kn.lerp(wl.s,T0.s,o),m=kn.lerp(wl.l,T0.l,o);return this.setHSL(h,l,m),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,o=0){return this.r=e[o],this.g=e[o+1],this.b=e[o+2],this}toArray(e=[],o=0){return e[o]=this.r,e[o+1]=this.g,e[o+2]=this.b,e}fromBufferAttribute(e,o){return this.r=e.getX(o),this.g=e.getY(o),this.b=e.getZ(o),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}dn.NAMES=qN;dn.prototype.isColor=!0;dn.prototype.r=1;dn.prototype.g=1;dn.prototype.b=1;class Lw extends eo{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new dn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ly,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this}}Lw.prototype.isMeshBasicMaterial=!0;const Vr=new He,E0=new mi;function Zn(i,e,o){if(Array.isArray(i))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=i,this.itemSize=e,this.count=i!==void 0?i.length/e:0,this.normalized=o===!0,this.usage=ky,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(Zn.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});Object.assign(Zn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this},copyAt:function(i,e,o){i*=this.itemSize,o*=e.itemSize;for(let h=0,l=this.itemSize;h<l;h++)this.array[i+h]=e.array[o+h];return this},copyArray:function(i){return this.array.set(i),this},copyColorsArray:function(i){const e=this.array;let o=0;for(let h=0,l=i.length;h<l;h++){let m=i[h];m===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",h),m=new dn),e[o++]=m.r,e[o++]=m.g,e[o++]=m.b}return this},copyVector2sArray:function(i){const e=this.array;let o=0;for(let h=0,l=i.length;h<l;h++){let m=i[h];m===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",h),m=new mi),e[o++]=m.x,e[o++]=m.y}return this},copyVector3sArray:function(i){const e=this.array;let o=0;for(let h=0,l=i.length;h<l;h++){let m=i[h];m===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",h),m=new He),e[o++]=m.x,e[o++]=m.y,e[o++]=m.z}return this},copyVector4sArray:function(i){const e=this.array;let o=0;for(let h=0,l=i.length;h<l;h++){let m=i[h];m===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",h),m=new zr),e[o++]=m.x,e[o++]=m.y,e[o++]=m.z,e[o++]=m.w}return this},applyMatrix3:function(i){if(this.itemSize===2)for(let e=0,o=this.count;e<o;e++)E0.fromBufferAttribute(this,e),E0.applyMatrix3(i),this.setXY(e,E0.x,E0.y);else if(this.itemSize===3)for(let e=0,o=this.count;e<o;e++)Vr.fromBufferAttribute(this,e),Vr.applyMatrix3(i),this.setXYZ(e,Vr.x,Vr.y,Vr.z);return this},applyMatrix4:function(i){for(let e=0,o=this.count;e<o;e++)Vr.x=this.getX(e),Vr.y=this.getY(e),Vr.z=this.getZ(e),Vr.applyMatrix4(i),this.setXYZ(e,Vr.x,Vr.y,Vr.z);return this},applyNormalMatrix:function(i){for(let e=0,o=this.count;e<o;e++)Vr.x=this.getX(e),Vr.y=this.getY(e),Vr.z=this.getZ(e),Vr.applyNormalMatrix(i),this.setXYZ(e,Vr.x,Vr.y,Vr.z);return this},transformDirection:function(i){for(let e=0,o=this.count;e<o;e++)Vr.x=this.getX(e),Vr.y=this.getY(e),Vr.z=this.getZ(e),Vr.transformDirection(i),this.setXYZ(e,Vr.x,Vr.y,Vr.z);return this},set:function(i,e=0){return this.array.set(i,e),this},getX:function(i){return this.array[i*this.itemSize]},setX:function(i,e){return this.array[i*this.itemSize]=e,this},getY:function(i){return this.array[i*this.itemSize+1]},setY:function(i,e){return this.array[i*this.itemSize+1]=e,this},getZ:function(i){return this.array[i*this.itemSize+2]},setZ:function(i,e){return this.array[i*this.itemSize+2]=e,this},getW:function(i){return this.array[i*this.itemSize+3]},setW:function(i,e){return this.array[i*this.itemSize+3]=e,this},setXY:function(i,e,o){return i*=this.itemSize,this.array[i+0]=e,this.array[i+1]=o,this},setXYZ:function(i,e,o,h){return i*=this.itemSize,this.array[i+0]=e,this.array[i+1]=o,this.array[i+2]=h,this},setXYZW:function(i,e,o,h,l){return i*=this.itemSize,this.array[i+0]=e,this.array[i+1]=o,this.array[i+2]=h,this.array[i+3]=l,this},onUpload:function(i){return this.onUploadCallback=i,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function fb(i,e,o){Zn.call(this,new Int8Array(i),e,o)}fb.prototype=Object.create(Zn.prototype);fb.prototype.constructor=fb;function pb(i,e,o){Zn.call(this,new Uint8Array(i),e,o)}pb.prototype=Object.create(Zn.prototype);pb.prototype.constructor=pb;function mb(i,e,o){Zn.call(this,new Uint8ClampedArray(i),e,o)}mb.prototype=Object.create(Zn.prototype);mb.prototype.constructor=mb;function gb(i,e,o){Zn.call(this,new Int16Array(i),e,o)}gb.prototype=Object.create(Zn.prototype);gb.prototype.constructor=gb;function Bp(i,e,o){Zn.call(this,new Uint16Array(i),e,o)}Bp.prototype=Object.create(Zn.prototype);Bp.prototype.constructor=Bp;function _b(i,e,o){Zn.call(this,new Int32Array(i),e,o)}_b.prototype=Object.create(Zn.prototype);_b.prototype.constructor=_b;function Np(i,e,o){Zn.call(this,new Uint32Array(i),e,o)}Np.prototype=Object.create(Zn.prototype);Np.prototype.constructor=Np;function V_(i,e,o){Zn.call(this,new Uint16Array(i),e,o)}V_.prototype=Object.create(Zn.prototype);V_.prototype.constructor=V_;V_.prototype.isFloat16BufferAttribute=!0;function Or(i,e,o){Zn.call(this,new Float32Array(i),e,o)}Or.prototype=Object.create(Zn.prototype);Or.prototype.constructor=Or;function yb(i,e,o){Zn.call(this,new Float64Array(i),e,o)}yb.prototype=Object.create(Zn.prototype);yb.prototype.constructor=yb;function XN(i){if(i.length===0)return-1/0;let e=i[0];for(let o=1,h=i.length;o<h;++o)i[o]>e&&(e=i[o]);return e}let VJ=0;const sc=new tn,pT=new Rn,ap=new He,wa=new Ra,f_=new Ra,Yo=new He;function pr(){Object.defineProperty(this,"id",{value:VJ++}),this.uuid=kn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}pr.prototype=Object.assign(Object.create(Gc.prototype),{constructor:pr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(i){return Array.isArray(i)?this.index=new(XN(i)>65535?Np:Bp)(i,1):this.index=i,this},getAttribute:function(i){return this.attributes[i]},setAttribute:function(i,e){return this.attributes[i]=e,this},deleteAttribute:function(i){return delete this.attributes[i],this},hasAttribute:function(i){return this.attributes[i]!==void 0},addGroup:function(i,e,o=0){this.groups.push({start:i,count:e,materialIndex:o})},clearGroups:function(){this.groups=[]},setDrawRange:function(i,e){this.drawRange.start=i,this.drawRange.count=e},applyMatrix4:function(i){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(i),e.needsUpdate=!0);const o=this.attributes.normal;if(o!==void 0){const l=new Qo().getNormalMatrix(i);o.applyNormalMatrix(l),o.needsUpdate=!0}const h=this.attributes.tangent;return h!==void 0&&(h.transformDirection(i),h.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(i){return sc.makeRotationX(i),this.applyMatrix4(sc),this},rotateY:function(i){return sc.makeRotationY(i),this.applyMatrix4(sc),this},rotateZ:function(i){return sc.makeRotationZ(i),this.applyMatrix4(sc),this},translate:function(i,e,o){return sc.makeTranslation(i,e,o),this.applyMatrix4(sc),this},scale:function(i,e,o){return sc.makeScale(i,e,o),this.applyMatrix4(sc),this},lookAt:function(i){return pT.lookAt(i),pT.updateMatrix(),this.applyMatrix4(pT.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ap).negate(),this.translate(ap.x,ap.y,ap.z),this},setFromPoints:function(i){const e=[];for(let o=0,h=i.length;o<h;o++){const l=i[o];e.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new Or(e,3)),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Ra);const i=this.attributes.position,e=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new He(-1/0,-1/0,-1/0),new He(1/0,1/0,1/0));return}if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),e)for(let o=0,h=e.length;o<h;o++){const l=e[o];wa.setFromBufferAttribute(l),this.morphTargetsRelative?(Yo.addVectors(this.boundingBox.min,wa.min),this.boundingBox.expandByPoint(Yo),Yo.addVectors(this.boundingBox.max,wa.max),this.boundingBox.expandByPoint(Yo)):(this.boundingBox.expandByPoint(wa.min),this.boundingBox.expandByPoint(wa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Id);const i=this.attributes.position,e=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new He,1/0);return}if(i){const o=this.boundingSphere.center;if(wa.setFromBufferAttribute(i),e)for(let l=0,m=e.length;l<m;l++){const x=e[l];f_.setFromBufferAttribute(x),this.morphTargetsRelative?(Yo.addVectors(wa.min,f_.min),wa.expandByPoint(Yo),Yo.addVectors(wa.max,f_.max),wa.expandByPoint(Yo)):(wa.expandByPoint(f_.min),wa.expandByPoint(f_.max))}wa.getCenter(o);let h=0;for(let l=0,m=i.count;l<m;l++)Yo.fromBufferAttribute(i,l),h=Math.max(h,o.distanceToSquared(Yo));if(e)for(let l=0,m=e.length;l<m;l++){const x=e[l],s=this.morphTargetsRelative;for(let P=0,C=x.count;P<C;P++)Yo.fromBufferAttribute(x,P),s&&(ap.fromBufferAttribute(i,P),Yo.add(ap)),h=Math.max(h,o.distanceToSquared(Yo))}this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){const i=this.index,e=this.attributes;if(i===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const o=i.array,h=e.position.array,l=e.normal.array,m=e.uv.array,x=h.length/3;e.tangent===void 0&&this.setAttribute("tangent",new Zn(new Float32Array(4*x),4));const s=e.tangent.array,P=[],C=[];for(let pt=0;pt<x;pt++)P[pt]=new He,C[pt]=new He;const F=new He,O=new He,V=new He,J=new mi,ee=new mi,se=new mi,fe=new He,le=new He;function ie(pt,St,Et){F.fromArray(h,pt*3),O.fromArray(h,St*3),V.fromArray(h,Et*3),J.fromArray(m,pt*2),ee.fromArray(m,St*2),se.fromArray(m,Et*2),O.sub(F),V.sub(F),ee.sub(J),se.sub(J);const Dt=1/(ee.x*se.y-se.x*ee.y);isFinite(Dt)&&(fe.copy(O).multiplyScalar(se.y).addScaledVector(V,-ee.y).multiplyScalar(Dt),le.copy(V).multiplyScalar(ee.x).addScaledVector(O,-se.x).multiplyScalar(Dt),P[pt].add(fe),P[St].add(fe),P[Et].add(fe),C[pt].add(le),C[St].add(le),C[Et].add(le))}let it=this.groups;it.length===0&&(it=[{start:0,count:o.length}]);for(let pt=0,St=it.length;pt<St;++pt){const Et=it[pt],Dt=Et.start,Qe=Et.count;for(let ht=Dt,_t=Dt+Qe;ht<_t;ht+=3)ie(o[ht+0],o[ht+1],o[ht+2])}const Ve=new He,Ne=new He,Re=new He,Ye=new He;function zt(pt){Re.fromArray(l,pt*3),Ye.copy(Re);const St=P[pt];Ve.copy(St),Ve.sub(Re.multiplyScalar(Re.dot(St))).normalize(),Ne.crossVectors(Ye,St);const Dt=Ne.dot(C[pt])<0?-1:1;s[pt*4]=Ve.x,s[pt*4+1]=Ve.y,s[pt*4+2]=Ve.z,s[pt*4+3]=Dt}for(let pt=0,St=it.length;pt<St;++pt){const Et=it[pt],Dt=Et.start,Qe=Et.count;for(let ht=Dt,_t=Dt+Qe;ht<_t;ht+=3)zt(o[ht+0]),zt(o[ht+1]),zt(o[ht+2])}},computeVertexNormals:function(){const i=this.index,e=this.getAttribute("position");if(e!==void 0){let o=this.getAttribute("normal");if(o===void 0)o=new Zn(new Float32Array(e.count*3),3),this.setAttribute("normal",o);else for(let O=0,V=o.count;O<V;O++)o.setXYZ(O,0,0,0);const h=new He,l=new He,m=new He,x=new He,s=new He,P=new He,C=new He,F=new He;if(i)for(let O=0,V=i.count;O<V;O+=3){const J=i.getX(O+0),ee=i.getX(O+1),se=i.getX(O+2);h.fromBufferAttribute(e,J),l.fromBufferAttribute(e,ee),m.fromBufferAttribute(e,se),C.subVectors(m,l),F.subVectors(h,l),C.cross(F),x.fromBufferAttribute(o,J),s.fromBufferAttribute(o,ee),P.fromBufferAttribute(o,se),x.add(C),s.add(C),P.add(C),o.setXYZ(J,x.x,x.y,x.z),o.setXYZ(ee,s.x,s.y,s.z),o.setXYZ(se,P.x,P.y,P.z)}else for(let O=0,V=e.count;O<V;O+=3)h.fromBufferAttribute(e,O+0),l.fromBufferAttribute(e,O+1),m.fromBufferAttribute(e,O+2),C.subVectors(m,l),F.subVectors(h,l),C.cross(F),o.setXYZ(O+0,C.x,C.y,C.z),o.setXYZ(O+1,C.x,C.y,C.z),o.setXYZ(O+2,C.x,C.y,C.z);this.normalizeNormals(),o.needsUpdate=!0}},merge:function(i,e){if(!(i&&i.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",i);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const o=this.attributes;for(const h in o){if(i.attributes[h]===void 0)continue;const m=o[h].array,x=i.attributes[h],s=x.array,P=x.itemSize*e,C=Math.min(s.length,m.length-P);for(let F=0,O=P;F<C;F++,O++)m[O]=s[F]}return this},normalizeNormals:function(){const i=this.attributes.normal;for(let e=0,o=i.count;e<o;e++)Yo.fromBufferAttribute(i,e),Yo.normalize(),i.setXYZ(e,Yo.x,Yo.y,Yo.z)},toNonIndexed:function(){function i(x,s){const P=x.array,C=x.itemSize,F=x.normalized,O=new P.constructor(s.length*C);let V=0,J=0;for(let ee=0,se=s.length;ee<se;ee++){V=s[ee]*C;for(let fe=0;fe<C;fe++)O[J++]=P[V++]}return new Zn(O,C,F)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new pr,o=this.index.array,h=this.attributes;for(const x in h){const s=h[x],P=i(s,o);e.setAttribute(x,P)}const l=this.morphAttributes;for(const x in l){const s=[],P=l[x];for(let C=0,F=P.length;C<F;C++){const O=P[C],V=i(O,o);s.push(V)}e.morphAttributes[x]=s}e.morphTargetsRelative=this.morphTargetsRelative;const m=this.groups;for(let x=0,s=m.length;x<s;x++){const P=m[x];e.addGroup(P.start,P.count,P.materialIndex)}return e},toJSON:function(){const i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){const s=this.parameters;for(const P in s)s[P]!==void 0&&(i[P]=s[P]);return i}i.data={attributes:{}};const e=this.index;e!==null&&(i.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const o=this.attributes;for(const s in o){const P=o[s],C=P.toJSON(i.data);P.name!==""&&(C.name=P.name),i.data.attributes[s]=C}const h={};let l=!1;for(const s in this.morphAttributes){const P=this.morphAttributes[s],C=[];for(let F=0,O=P.length;F<O;F++){const V=P[F],J=V.toJSON(i.data);V.name!==""&&(J.name=V.name),C.push(J)}C.length>0&&(h[s]=C,l=!0)}l&&(i.data.morphAttributes=h,i.data.morphTargetsRelative=this.morphTargetsRelative);const m=this.groups;m.length>0&&(i.data.groups=JSON.parse(JSON.stringify(m)));const x=this.boundingSphere;return x!==null&&(i.data.boundingSphere={center:x.center.toArray(),radius:x.radius}),i},clone:function(){return new pr().copy(this)},copy:function(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=i.name;const o=i.index;o!==null&&this.setIndex(o.clone(e));const h=i.attributes;for(const P in h){const C=h[P];this.setAttribute(P,C.clone(e))}const l=i.morphAttributes;for(const P in l){const C=[],F=l[P];for(let O=0,V=F.length;O<V;O++)C.push(F[O].clone(e));this.morphAttributes[P]=C}this.morphTargetsRelative=i.morphTargetsRelative;const m=i.groups;for(let P=0,C=m.length;P<C;P++){const F=m[P];this.addGroup(F.start,F.count,F.materialIndex)}const x=i.boundingBox;x!==null&&(this.boundingBox=x.clone());const s=i.boundingSphere;return s!==null&&(this.boundingSphere=s.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const NR=new tn,lp=new ih,mT=new Id,Ou=new He,Fu=new He,Bu=new He,gT=new He,_T=new He,yT=new He,I0=new He,M0=new He,A0=new He,P0=new mi,z0=new mi,C0=new mi,vT=new He,R0=new He;function lr(i=new pr,e=new Lw){Rn.call(this),this.type="Mesh",this.geometry=i,this.material=e,this.updateMorphTargets()}lr.prototype=Object.assign(Object.create(Rn.prototype),{constructor:lr,isMesh:!0,copy:function(i){return Rn.prototype.copy.call(this,i),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const e=i.morphAttributes,o=Object.keys(e);if(o.length>0){const h=e[o[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,m=h.length;l<m;l++){const x=h[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[x]=l}}}}else{const e=i.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(i,e){const o=this.geometry,h=this.material,l=this.matrixWorld;if(h===void 0||(o.boundingSphere===null&&o.computeBoundingSphere(),mT.copy(o.boundingSphere),mT.applyMatrix4(l),i.ray.intersectsSphere(mT)===!1)||(NR.copy(l).invert(),lp.copy(i.ray).applyMatrix4(NR),o.boundingBox!==null&&lp.intersectsBox(o.boundingBox)===!1))return;let m;if(o.isBufferGeometry){const x=o.index,s=o.attributes.position,P=o.morphAttributes.position,C=o.morphTargetsRelative,F=o.attributes.uv,O=o.attributes.uv2,V=o.groups,J=o.drawRange;if(x!==null)if(Array.isArray(h))for(let ee=0,se=V.length;ee<se;ee++){const fe=V[ee],le=h[fe.materialIndex],ie=Math.max(fe.start,J.start),it=Math.min(fe.start+fe.count,J.start+J.count);for(let Ve=ie,Ne=it;Ve<Ne;Ve+=3){const Re=x.getX(Ve),Ye=x.getX(Ve+1),zt=x.getX(Ve+2);m=L0(this,le,i,lp,s,P,C,F,O,Re,Ye,zt),m&&(m.faceIndex=Math.floor(Ve/3),m.face.materialIndex=fe.materialIndex,e.push(m))}}else{const ee=Math.max(0,J.start),se=Math.min(x.count,J.start+J.count);for(let fe=ee,le=se;fe<le;fe+=3){const ie=x.getX(fe),it=x.getX(fe+1),Ve=x.getX(fe+2);m=L0(this,h,i,lp,s,P,C,F,O,ie,it,Ve),m&&(m.faceIndex=Math.floor(fe/3),e.push(m))}}else if(s!==void 0)if(Array.isArray(h))for(let ee=0,se=V.length;ee<se;ee++){const fe=V[ee],le=h[fe.materialIndex],ie=Math.max(fe.start,J.start),it=Math.min(fe.start+fe.count,J.start+J.count);for(let Ve=ie,Ne=it;Ve<Ne;Ve+=3){const Re=Ve,Ye=Ve+1,zt=Ve+2;m=L0(this,le,i,lp,s,P,C,F,O,Re,Ye,zt),m&&(m.faceIndex=Math.floor(Ve/3),m.face.materialIndex=fe.materialIndex,e.push(m))}}else{const ee=Math.max(0,J.start),se=Math.min(s.count,J.start+J.count);for(let fe=ee,le=se;fe<le;fe+=3){const ie=fe,it=fe+1,Ve=fe+2;m=L0(this,h,i,lp,s,P,C,F,O,ie,it,Ve),m&&(m.faceIndex=Math.floor(fe/3),e.push(m))}}}else o.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});function jJ(i,e,o,h,l,m,x,s){let P;if(e.side===Bo?P=h.intersectTriangle(x,m,l,!0,s):P=h.intersectTriangle(l,m,x,e.side!==Ry,s),P===null)return null;R0.copy(s),R0.applyMatrix4(i.matrixWorld);const C=o.ray.origin.distanceTo(R0);return C<o.near||C>o.far?null:{distance:C,point:R0.clone(),object:i}}function L0(i,e,o,h,l,m,x,s,P,C,F,O){Ou.fromBufferAttribute(l,C),Fu.fromBufferAttribute(l,F),Bu.fromBufferAttribute(l,O);const V=i.morphTargetInfluences;if(e.morphTargets&&m&&V){I0.set(0,0,0),M0.set(0,0,0),A0.set(0,0,0);for(let ee=0,se=m.length;ee<se;ee++){const fe=V[ee],le=m[ee];fe!==0&&(gT.fromBufferAttribute(le,C),_T.fromBufferAttribute(le,F),yT.fromBufferAttribute(le,O),x?(I0.addScaledVector(gT,fe),M0.addScaledVector(_T,fe),A0.addScaledVector(yT,fe)):(I0.addScaledVector(gT.sub(Ou),fe),M0.addScaledVector(_T.sub(Fu),fe),A0.addScaledVector(yT.sub(Bu),fe)))}Ou.add(I0),Fu.add(M0),Bu.add(A0)}i.isSkinnedMesh&&e.skinning&&(i.boneTransform(C,Ou),i.boneTransform(F,Fu),i.boneTransform(O,Bu));const J=jJ(i,e,o,h,Ou,Fu,Bu,vT);if(J){s&&(P0.fromBufferAttribute(s,C),z0.fromBufferAttribute(s,F),C0.fromBufferAttribute(s,O),J.uv=zo.getUV(vT,Ou,Fu,Bu,P0,z0,C0,new mi)),P&&(P0.fromBufferAttribute(P,C),z0.fromBufferAttribute(P,F),C0.fromBufferAttribute(P,O),J.uv2=zo.getUV(vT,Ou,Fu,Bu,P0,z0,C0,new mi));const ee={a:C,b:F,c:O,normal:new He,materialIndex:0};zo.getNormal(Ou,Fu,Bu,ee.normal),J.face=ee}return J}class Po extends pr{constructor(e=1,o=1,h=1,l=1,m=1,x=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:o,depth:h,widthSegments:l,heightSegments:m,depthSegments:x};const s=this;l=Math.floor(l),m=Math.floor(m),x=Math.floor(x);const P=[],C=[],F=[],O=[];let V=0,J=0;ee("z","y","x",-1,-1,h,o,e,x,m,0),ee("z","y","x",1,-1,h,o,-e,x,m,1),ee("x","z","y",1,1,e,h,o,l,x,2),ee("x","z","y",1,-1,e,h,-o,l,x,3),ee("x","y","z",1,-1,e,o,h,l,m,4),ee("x","y","z",-1,-1,e,o,-h,l,m,5),this.setIndex(P),this.setAttribute("position",new Or(C,3)),this.setAttribute("normal",new Or(F,3)),this.setAttribute("uv",new Or(O,2));function ee(se,fe,le,ie,it,Ve,Ne,Re,Ye,zt,pt){const St=Ve/Ye,Et=Ne/zt,Dt=Ve/2,Qe=Ne/2,ht=Re/2,_t=Ye+1,yt=zt+1;let Nt=0,Qt=0;const pi=new He;for(let Pi=0;Pi<yt;Pi++){const Mi=Pi*Et-Qe;for(let fn=0;fn<_t;fn++){const bi=fn*St-Dt;pi[se]=bi*ie,pi[fe]=Mi*it,pi[le]=ht,C.push(pi.x,pi.y,pi.z),pi[se]=0,pi[fe]=0,pi[le]=Re>0?1:-1,F.push(pi.x,pi.y,pi.z),O.push(fn/Ye),O.push(1-Pi/zt),Nt+=1}}for(let Pi=0;Pi<zt;Pi++)for(let Mi=0;Mi<Ye;Mi++){const fn=V+Mi+_t*Pi,bi=V+Mi+_t*(Pi+1),Dn=V+(Mi+1)+_t*(Pi+1),Un=V+(Mi+1)+_t*Pi;P.push(fn,bi,Un),P.push(bi,Dn,Un),Qt+=6}s.addGroup(J,Qt,pt),J+=Qt,V+=Nt}}}function Up(i){const e={};for(const o in i){e[o]={};for(const h in i[o]){const l=i[o][h];l&&(l.isColor||l.isMatrix3||l.isMatrix4||l.isVector2||l.isVector3||l.isVector4||l.isTexture||l.isQuaternion)?e[o][h]=l.clone():Array.isArray(l)?e[o][h]=l.slice():e[o][h]=l}}return e}function Ms(i){const e={};for(let o=0;o<i.length;o++){const h=Up(i[o]);for(const l in h)e[l]=h[l]}return e}const JN={clone:Up,merge:Ms};var GJ=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,HJ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function Ia(i){eo.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=GJ,this.fragmentShader=HJ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,i!==void 0&&(i.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(i))}Ia.prototype=Object.create(eo.prototype);Ia.prototype.constructor=Ia;Ia.prototype.isShaderMaterial=!0;Ia.prototype.copy=function(i){return eo.prototype.copy.call(this,i),this.fragmentShader=i.fragmentShader,this.vertexShader=i.vertexShader,this.uniforms=Up(i.uniforms),this.defines=Object.assign({},i.defines),this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.lights=i.lights,this.clipping=i.clipping,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.extensions=Object.assign({},i.extensions),this.glslVersion=i.glslVersion,this};Ia.prototype.toJSON=function(i){const e=eo.prototype.toJSON.call(this,i);e.glslVersion=this.glslVersion,e.uniforms={};for(const h in this.uniforms){const m=this.uniforms[h].value;m&&m.isTexture?e.uniforms[h]={type:"t",value:m.toJSON(i).uuid}:m&&m.isColor?e.uniforms[h]={type:"c",value:m.getHex()}:m&&m.isVector2?e.uniforms[h]={type:"v2",value:m.toArray()}:m&&m.isVector3?e.uniforms[h]={type:"v3",value:m.toArray()}:m&&m.isVector4?e.uniforms[h]={type:"v4",value:m.toArray()}:m&&m.isMatrix3?e.uniforms[h]={type:"m3",value:m.toArray()}:m&&m.isMatrix4?e.uniforms[h]={type:"m4",value:m.toArray()}:e.uniforms[h]={value:m}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const o={};for(const h in this.extensions)this.extensions[h]===!0&&(o[h]=!0);return Object.keys(o).length>0&&(e.extensions=o),e};function Yu(){Rn.call(this),this.type="Camera",this.matrixWorldInverse=new tn,this.projectionMatrix=new tn,this.projectionMatrixInverse=new tn}Yu.prototype=Object.assign(Object.create(Rn.prototype),{constructor:Yu,isCamera:!0,copy:function(i,e){return Rn.prototype.copy.call(this,i,e),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),i=new He),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return i.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(i){Rn.prototype.updateMatrixWorld.call(this,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(i,e){Rn.prototype.updateWorldMatrix.call(this,i,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return new this.constructor().copy(this)}});function zs(i=50,e=1,o=.1,h=2e3){Yu.call(this),this.type="PerspectiveCamera",this.fov=i,this.zoom=1,this.near=o,this.far=h,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}zs.prototype=Object.assign(Object.create(Yu.prototype),{constructor:zs,isPerspectiveCamera:!0,copy:function(i,e){return Yu.prototype.copy.call(this,i,e),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this},setFocalLength:function(i){const e=.5*this.getFilmHeight()/i;this.fov=kn.RAD2DEG*2*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const i=Math.tan(kn.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/i},getEffectiveFOV:function(){return kn.RAD2DEG*2*Math.atan(Math.tan(kn.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(i,e,o,h,l,m){this.aspect=i/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=e,this.view.offsetX=o,this.view.offsetY=h,this.view.width=l,this.view.height=m,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const i=this.near;let e=i*Math.tan(kn.DEG2RAD*.5*this.fov)/this.zoom,o=2*e,h=this.aspect*o,l=-.5*h;const m=this.view;if(this.view!==null&&this.view.enabled){const s=m.fullWidth,P=m.fullHeight;l+=m.offsetX*h/s,e-=m.offsetY*o/P,h*=m.width/s,o*=m.height/P}const x=this.filmOffset;x!==0&&(l+=i*x/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+h,e,e-o,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){const e=Rn.prototype.toJSON.call(this,i);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const cp=90,up=1;class Dw extends Rn{constructor(e,o,h){if(super(),this.type="CubeCamera",h.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=h;const l=new zs(cp,up,e,o);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new He(1,0,0)),this.add(l);const m=new zs(cp,up,e,o);m.layers=this.layers,m.up.set(0,-1,0),m.lookAt(new He(-1,0,0)),this.add(m);const x=new zs(cp,up,e,o);x.layers=this.layers,x.up.set(0,0,1),x.lookAt(new He(0,1,0)),this.add(x);const s=new zs(cp,up,e,o);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new He(0,-1,0)),this.add(s);const P=new zs(cp,up,e,o);P.layers=this.layers,P.up.set(0,-1,0),P.lookAt(new He(0,0,1)),this.add(P);const C=new zs(cp,up,e,o);C.layers=this.layers,C.up.set(0,-1,0),C.lookAt(new He(0,0,-1)),this.add(C)}update(e,o){this.parent===null&&this.updateMatrixWorld();const h=this.renderTarget,[l,m,x,s,P,C]=this.children,F=e.xr.enabled,O=e.getRenderTarget();e.xr.enabled=!1;const V=h.texture.generateMipmaps;h.texture.generateMipmaps=!1,e.setRenderTarget(h,0),e.render(o,l),e.setRenderTarget(h,1),e.render(o,m),e.setRenderTarget(h,2),e.render(o,x),e.setRenderTarget(h,3),e.render(o,s),e.setRenderTarget(h,4),e.render(o,P),h.texture.generateMipmaps=V,e.setRenderTarget(h,5),e.render(o,C),e.setRenderTarget(O),e.xr.enabled=F}}class Oy extends es{constructor(e,o,h,l,m,x,s,P,C,F){e=e!==void 0?e:[],o=o!==void 0?o:Mw,s=s!==void 0?s:$u,super(e,o,h,l,m,x,s,P,C,F),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Oy.prototype.isCubeTexture=!0;class n2 extends Vu{constructor(e,o,h){Number.isInteger(o)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),o=h),super(e,e,o),o=o||{},this.texture=new Oy(void 0,o.mapping,o.wrapS,o.wrapT,o.magFilter,o.minFilter,o.format,o.type,o.anisotropy,o.encoding),this.texture.generateMipmaps=o.generateMipmaps!==void 0?o.generateMipmaps:!1,this.texture.minFilter=o.minFilter!==void 0?o.minFilter:Ko,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,o){this.texture.type=o.type,this.texture.format=Ja,this.texture.encoding=o.encoding,this.texture.generateMipmaps=o.generateMipmaps,this.texture.minFilter=o.minFilter,this.texture.magFilter=o.magFilter;const h={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},l=new Po(5,5,5),m=new Ia({name:"CubemapFromEquirect",uniforms:Up(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,side:Bo,blending:bp});m.uniforms.tEquirect.value=o;const x=new lr(l,m),s=o.minFilter;return o.minFilter===Dy&&(o.minFilter=Ko),new Dw(1,10,this).update(e,x),o.minFilter=s,x.geometry.dispose(),x.material.dispose(),this}clear(e,o,h,l){const m=e.getRenderTarget();for(let x=0;x<6;x++)e.setRenderTarget(this,x),e.clear(o,h,l);e.setRenderTarget(m)}}n2.prototype.isWebGLCubeRenderTarget=!0;class kw extends es{constructor(e,o,h,l,m,x,s,P,C,F,O,V){super(null,x,s,P,C,F,l,m,O,V),this.image={data:e||null,width:o||1,height:h||1},this.magFilter=C!==void 0?C:Cs,this.minFilter=F!==void 0?F:Cs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}kw.prototype.isDataTexture=!0;const hp=new Id,D0=new He;class Fy{constructor(e=new El,o=new El,h=new El,l=new El,m=new El,x=new El){this.planes=[e,o,h,l,m,x]}set(e,o,h,l,m,x){const s=this.planes;return s[0].copy(e),s[1].copy(o),s[2].copy(h),s[3].copy(l),s[4].copy(m),s[5].copy(x),this}copy(e){const o=this.planes;for(let h=0;h<6;h++)o[h].copy(e.planes[h]);return this}setFromProjectionMatrix(e){const o=this.planes,h=e.elements,l=h[0],m=h[1],x=h[2],s=h[3],P=h[4],C=h[5],F=h[6],O=h[7],V=h[8],J=h[9],ee=h[10],se=h[11],fe=h[12],le=h[13],ie=h[14],it=h[15];return o[0].setComponents(s-l,O-P,se-V,it-fe).normalize(),o[1].setComponents(s+l,O+P,se+V,it+fe).normalize(),o[2].setComponents(s+m,O+C,se+J,it+le).normalize(),o[3].setComponents(s-m,O-C,se-J,it-le).normalize(),o[4].setComponents(s-x,O-F,se-ee,it-ie).normalize(),o[5].setComponents(s+x,O+F,se+ee,it+ie).normalize(),this}intersectsObject(e){const o=e.geometry;return o.boundingSphere===null&&o.computeBoundingSphere(),hp.copy(o.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(hp)}intersectsSprite(e){return hp.center.set(0,0,0),hp.radius=.7071067811865476,hp.applyMatrix4(e.matrixWorld),this.intersectsSphere(hp)}intersectsSphere(e){const o=this.planes,h=e.center,l=-e.radius;for(let m=0;m<6;m++)if(o[m].distanceToPoint(h)<l)return!1;return!0}intersectsBox(e){const o=this.planes;for(let h=0;h<6;h++){const l=o[h];if(D0.x=l.normal.x>0?e.max.x:e.min.x,D0.y=l.normal.y>0?e.max.y:e.min.y,D0.z=l.normal.z>0?e.max.z:e.min.z,l.distanceToPoint(D0)<0)return!1}return!0}containsPoint(e){const o=this.planes;for(let h=0;h<6;h++)if(o[h].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function YN(){let i=null,e=!1,o=null,h=null;function l(m,x){o(m,x),h=i.requestAnimationFrame(l)}return{start:function(){e!==!0&&o!==null&&(h=i.requestAnimationFrame(l),e=!0)},stop:function(){i.cancelAnimationFrame(h),e=!1},setAnimationLoop:function(m){o=m},setContext:function(m){i=m}}}function ZJ(i,e){const o=e.isWebGL2,h=new WeakMap;function l(C,F){const O=C.array,V=C.usage,J=i.createBuffer();i.bindBuffer(F,J),i.bufferData(F,O,V),C.onUploadCallback();let ee=5126;return O instanceof Float32Array?ee=5126:O instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):O instanceof Uint16Array?C.isFloat16BufferAttribute?o?ee=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):ee=5123:O instanceof Int16Array?ee=5122:O instanceof Uint32Array?ee=5125:O instanceof Int32Array?ee=5124:O instanceof Int8Array?ee=5120:O instanceof Uint8Array&&(ee=5121),{buffer:J,type:ee,bytesPerElement:O.BYTES_PER_ELEMENT,version:C.version}}function m(C,F,O){const V=F.array,J=F.updateRange;i.bindBuffer(O,C),J.count===-1?i.bufferSubData(O,0,V):(o?i.bufferSubData(O,J.offset*V.BYTES_PER_ELEMENT,V,J.offset,J.count):i.bufferSubData(O,J.offset*V.BYTES_PER_ELEMENT,V.subarray(J.offset,J.offset+J.count)),J.count=-1)}function x(C){return C.isInterleavedBufferAttribute&&(C=C.data),h.get(C)}function s(C){C.isInterleavedBufferAttribute&&(C=C.data);const F=h.get(C);F&&(i.deleteBuffer(F.buffer),h.delete(C))}function P(C,F){if(C.isGLBufferAttribute){const V=h.get(C);(!V||V.version<C.version)&&h.set(C,{buffer:C.buffer,type:C.type,bytesPerElement:C.elementSize,version:C.version});return}C.isInterleavedBufferAttribute&&(C=C.data);const O=h.get(C);O===void 0?h.set(C,l(C,F)):O.version<C.version&&(m(O.buffer,C,F),O.version=C.version)}return{get:x,remove:s,update:P}}class oE extends pr{constructor(e=1,o=1,h=1,l=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:o,widthSegments:h,heightSegments:l};const m=e/2,x=o/2,s=Math.floor(h),P=Math.floor(l),C=s+1,F=P+1,O=e/s,V=o/P,J=[],ee=[],se=[],fe=[];for(let le=0;le<F;le++){const ie=le*V-x;for(let it=0;it<C;it++){const Ve=it*O-m;ee.push(Ve,-ie,0),se.push(0,0,1),fe.push(it/s),fe.push(1-le/P)}}for(let le=0;le<P;le++)for(let ie=0;ie<s;ie++){const it=ie+C*le,Ve=ie+C*(le+1),Ne=ie+1+C*(le+1),Re=ie+1+C*le;J.push(it,Ve,Re),J.push(Ve,Ne,Re)}this.setIndex(J),this.setAttribute("position",new Or(ee,3)),this.setAttribute("normal",new Or(se,3)),this.setAttribute("uv",new Or(fe,2))}}var WJ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,qJ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,XJ=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,JJ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,YJ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,KJ="vec3 transformed = vec3( position );",QJ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,eY=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,tY=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,iY=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,nY=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,rY=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,oY=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,sY=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,aY=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,lY=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,cY=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor.xyz *= color.xyz;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,uY=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,hY=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,dY=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,fY=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,pY=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,mY=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,gY=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,_Y="gl_FragColor = linearToOutputTexel( gl_FragColor );",yY=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,vY=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,xY=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,bY=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,wY=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,SY=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,TY=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,EY=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,IY=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,MY=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,AY=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,PY=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,zY=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,CY=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,RY=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,LY=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,DY=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,kY=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,OY=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,FY=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,BY=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,NY=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,UY=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,$Y=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,VY=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,jY=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,GY=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,HY=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,ZY=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,WY=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,qY=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,XY=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,JY=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,YY=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,KY=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,QY=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,eK=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,tK=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,iK=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,nK=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,rK=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,oK=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,sK=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,aK=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,lK=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,cK=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,uK=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,hK=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dK=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,fK=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,pK=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,mK=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,gK=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,_K=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,yK=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,vK=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,xK=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,bK=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,wK=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,SK=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,TK=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,EK=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,IK=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,MK=`#ifdef USE_TRANSMISSIONMAP
	totalTransmission *= texture2D( transmissionMap, vUv ).r;
#endif`,AK=`#ifdef USE_TRANSMISSIONMAP
	uniform sampler2D transmissionMap;
#endif`,PK=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,zK=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,CK=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,RK=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,LK=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,DK=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,kK=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,OK=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,FK=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,BK=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,NK=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,UK=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,$K=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,VK=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,jK=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,GK=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,HK=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,ZK=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,WK=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,qK=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,XK=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,JK=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,YK=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,KK=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QK=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,eQ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tQ=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,iQ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,nQ=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,rQ=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSMISSION
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSMISSION
	uniform float transmission;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <transmissionmap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef TRANSMISSION
		float totalTransmission = transmission;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <transmissionmap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSMISSION
		diffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oQ=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sQ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,aQ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,lQ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,cQ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,uQ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,hQ=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dQ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,fQ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const Xn={alphamap_fragment:WJ,alphamap_pars_fragment:qJ,alphatest_fragment:XJ,aomap_fragment:JJ,aomap_pars_fragment:YJ,begin_vertex:KJ,beginnormal_vertex:QJ,bsdfs:eY,bumpmap_pars_fragment:tY,clipping_planes_fragment:iY,clipping_planes_pars_fragment:nY,clipping_planes_pars_vertex:rY,clipping_planes_vertex:oY,color_fragment:sY,color_pars_fragment:aY,color_pars_vertex:lY,color_vertex:cY,common:uY,cube_uv_reflection_fragment:hY,defaultnormal_vertex:dY,displacementmap_pars_vertex:fY,displacementmap_vertex:pY,emissivemap_fragment:mY,emissivemap_pars_fragment:gY,encodings_fragment:_Y,encodings_pars_fragment:yY,envmap_fragment:vY,envmap_common_pars_fragment:xY,envmap_pars_fragment:bY,envmap_pars_vertex:wY,envmap_physical_pars_fragment:LY,envmap_vertex:SY,fog_vertex:TY,fog_pars_vertex:EY,fog_fragment:IY,fog_pars_fragment:MY,gradientmap_pars_fragment:AY,lightmap_fragment:PY,lightmap_pars_fragment:zY,lights_lambert_vertex:CY,lights_pars_begin:RY,lights_toon_fragment:DY,lights_toon_pars_fragment:kY,lights_phong_fragment:OY,lights_phong_pars_fragment:FY,lights_physical_fragment:BY,lights_physical_pars_fragment:NY,lights_fragment_begin:UY,lights_fragment_maps:$Y,lights_fragment_end:VY,logdepthbuf_fragment:jY,logdepthbuf_pars_fragment:GY,logdepthbuf_pars_vertex:HY,logdepthbuf_vertex:ZY,map_fragment:WY,map_pars_fragment:qY,map_particle_fragment:XY,map_particle_pars_fragment:JY,metalnessmap_fragment:YY,metalnessmap_pars_fragment:KY,morphnormal_vertex:QY,morphtarget_pars_vertex:eK,morphtarget_vertex:tK,normal_fragment_begin:iK,normal_fragment_maps:nK,normalmap_pars_fragment:rK,clearcoat_normal_fragment_begin:oK,clearcoat_normal_fragment_maps:sK,clearcoat_pars_fragment:aK,packing:lK,premultiplied_alpha_fragment:cK,project_vertex:uK,dithering_fragment:hK,dithering_pars_fragment:dK,roughnessmap_fragment:fK,roughnessmap_pars_fragment:pK,shadowmap_pars_fragment:mK,shadowmap_pars_vertex:gK,shadowmap_vertex:_K,shadowmask_pars_fragment:yK,skinbase_vertex:vK,skinning_pars_vertex:xK,skinning_vertex:bK,skinnormal_vertex:wK,specularmap_fragment:SK,specularmap_pars_fragment:TK,tonemapping_fragment:EK,tonemapping_pars_fragment:IK,transmissionmap_fragment:MK,transmissionmap_pars_fragment:AK,uv_pars_fragment:PK,uv_pars_vertex:zK,uv_vertex:CK,uv2_pars_fragment:RK,uv2_pars_vertex:LK,uv2_vertex:DK,worldpos_vertex:kK,background_frag:OK,background_vert:FK,cube_frag:BK,cube_vert:NK,depth_frag:UK,depth_vert:$K,distanceRGBA_frag:VK,distanceRGBA_vert:jK,equirect_frag:GK,equirect_vert:HK,linedashed_frag:ZK,linedashed_vert:WK,meshbasic_frag:qK,meshbasic_vert:XK,meshlambert_frag:JK,meshlambert_vert:YK,meshmatcap_frag:KK,meshmatcap_vert:QK,meshtoon_frag:eQ,meshtoon_vert:tQ,meshphong_frag:iQ,meshphong_vert:nQ,meshphysical_frag:rQ,meshphysical_vert:oQ,normal_frag:sQ,normal_vert:aQ,points_frag:lQ,points_vert:cQ,shadow_frag:uQ,shadow_vert:hQ,sprite_frag:dQ,sprite_vert:fQ},Ai={common:{diffuse:{value:new dn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Qo},uv2Transform:{value:new Qo},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new mi(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new dn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new dn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Qo}},sprite:{diffuse:{value:new dn(15658734)},opacity:{value:1},center:{value:new mi(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Qo}}},Il={basic:{uniforms:Ms([Ai.common,Ai.specularmap,Ai.envmap,Ai.aomap,Ai.lightmap,Ai.fog]),vertexShader:Xn.meshbasic_vert,fragmentShader:Xn.meshbasic_frag},lambert:{uniforms:Ms([Ai.common,Ai.specularmap,Ai.envmap,Ai.aomap,Ai.lightmap,Ai.emissivemap,Ai.fog,Ai.lights,{emissive:{value:new dn(0)}}]),vertexShader:Xn.meshlambert_vert,fragmentShader:Xn.meshlambert_frag},phong:{uniforms:Ms([Ai.common,Ai.specularmap,Ai.envmap,Ai.aomap,Ai.lightmap,Ai.emissivemap,Ai.bumpmap,Ai.normalmap,Ai.displacementmap,Ai.fog,Ai.lights,{emissive:{value:new dn(0)},specular:{value:new dn(1118481)},shininess:{value:30}}]),vertexShader:Xn.meshphong_vert,fragmentShader:Xn.meshphong_frag},standard:{uniforms:Ms([Ai.common,Ai.envmap,Ai.aomap,Ai.lightmap,Ai.emissivemap,Ai.bumpmap,Ai.normalmap,Ai.displacementmap,Ai.roughnessmap,Ai.metalnessmap,Ai.fog,Ai.lights,{emissive:{value:new dn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Xn.meshphysical_vert,fragmentShader:Xn.meshphysical_frag},toon:{uniforms:Ms([Ai.common,Ai.aomap,Ai.lightmap,Ai.emissivemap,Ai.bumpmap,Ai.normalmap,Ai.displacementmap,Ai.gradientmap,Ai.fog,Ai.lights,{emissive:{value:new dn(0)}}]),vertexShader:Xn.meshtoon_vert,fragmentShader:Xn.meshtoon_frag},matcap:{uniforms:Ms([Ai.common,Ai.bumpmap,Ai.normalmap,Ai.displacementmap,Ai.fog,{matcap:{value:null}}]),vertexShader:Xn.meshmatcap_vert,fragmentShader:Xn.meshmatcap_frag},points:{uniforms:Ms([Ai.points,Ai.fog]),vertexShader:Xn.points_vert,fragmentShader:Xn.points_frag},dashed:{uniforms:Ms([Ai.common,Ai.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xn.linedashed_vert,fragmentShader:Xn.linedashed_frag},depth:{uniforms:Ms([Ai.common,Ai.displacementmap]),vertexShader:Xn.depth_vert,fragmentShader:Xn.depth_frag},normal:{uniforms:Ms([Ai.common,Ai.bumpmap,Ai.normalmap,Ai.displacementmap,{opacity:{value:1}}]),vertexShader:Xn.normal_vert,fragmentShader:Xn.normal_frag},sprite:{uniforms:Ms([Ai.sprite,Ai.fog]),vertexShader:Xn.sprite_vert,fragmentShader:Xn.sprite_frag},background:{uniforms:{uvTransform:{value:new Qo},t2D:{value:null}},vertexShader:Xn.background_vert,fragmentShader:Xn.background_frag},cube:{uniforms:Ms([Ai.envmap,{opacity:{value:1}}]),vertexShader:Xn.cube_vert,fragmentShader:Xn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xn.equirect_vert,fragmentShader:Xn.equirect_frag},distanceRGBA:{uniforms:Ms([Ai.common,Ai.displacementmap,{referencePosition:{value:new He},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xn.distanceRGBA_vert,fragmentShader:Xn.distanceRGBA_frag},shadow:{uniforms:Ms([Ai.lights,Ai.fog,{color:{value:new dn(0)},opacity:{value:1}}]),vertexShader:Xn.shadow_vert,fragmentShader:Xn.shadow_frag}};Il.physical={uniforms:Ms([Il.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new mi(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new dn(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Xn.meshphysical_vert,fragmentShader:Xn.meshphysical_frag};function pQ(i,e,o,h,l){const m=new dn(0);let x=0,s,P,C=null,F=0,O=null;function V(ee,se,fe,le){let ie=se.isScene===!0?se.background:null;ie&&ie.isTexture&&(ie=e.get(ie));const it=i.xr,Ve=it.getSession&&it.getSession();Ve&&Ve.environmentBlendMode==="additive"&&(ie=null),ie===null?J(m,x):ie&&ie.isColor&&(J(ie,1),le=!0),(i.autoClear||le)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),ie&&(ie.isCubeTexture||ie.isWebGLCubeRenderTarget||ie.mapping===Pw)?(P===void 0&&(P=new lr(new Po(1,1,1),new Ia({name:"BackgroundCubeMaterial",uniforms:Up(Il.cube.uniforms),vertexShader:Il.cube.vertexShader,fragmentShader:Il.cube.fragmentShader,side:Bo,depthTest:!1,depthWrite:!1,fog:!1})),P.geometry.deleteAttribute("normal"),P.geometry.deleteAttribute("uv"),P.onBeforeRender=function(Ne,Re,Ye){this.matrixWorld.copyPosition(Ye.matrixWorld)},Object.defineProperty(P.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),h.update(P)),ie.isWebGLCubeRenderTarget&&(ie=ie.texture),P.material.uniforms.envMap.value=ie,P.material.uniforms.flipEnvMap.value=ie.isCubeTexture&&ie._needsFlipEnvMap?-1:1,(C!==ie||F!==ie.version||O!==i.toneMapping)&&(P.material.needsUpdate=!0,C=ie,F=ie.version,O=i.toneMapping),ee.unshift(P,P.geometry,P.material,0,0,null)):ie&&ie.isTexture&&(s===void 0&&(s=new lr(new oE(2,2),new Ia({name:"BackgroundMaterial",uniforms:Up(Il.background.uniforms),vertexShader:Il.background.vertexShader,fragmentShader:Il.background.fragmentShader,side:Cy,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),h.update(s)),s.material.uniforms.t2D.value=ie,ie.matrixAutoUpdate===!0&&ie.updateMatrix(),s.material.uniforms.uvTransform.value.copy(ie.matrix),(C!==ie||F!==ie.version||O!==i.toneMapping)&&(s.material.needsUpdate=!0,C=ie,F=ie.version,O=i.toneMapping),ee.unshift(s,s.geometry,s.material,0,0,null))}function J(ee,se){o.buffers.color.setClear(ee.r,ee.g,ee.b,se,l)}return{getClearColor:function(){return m},setClearColor:function(ee,se=1){m.set(ee),x=se,J(m,x)},getClearAlpha:function(){return x},setClearAlpha:function(ee){x=ee,J(m,x)},render:V}}function mQ(i,e,o,h){const l=i.getParameter(34921),m=h.isWebGL2?null:e.get("OES_vertex_array_object"),x=h.isWebGL2||m!==null,s={},P=se(null);let C=P;function F(Qe,ht,_t,yt,Nt){let Qt=!1;if(x){const pi=ee(yt,_t,ht);C!==pi&&(C=pi,V(C.object)),Qt=fe(yt,Nt),Qt&&le(yt,Nt)}else{const pi=ht.wireframe===!0;(C.geometry!==yt.id||C.program!==_t.id||C.wireframe!==pi)&&(C.geometry=yt.id,C.program=_t.id,C.wireframe=pi,Qt=!0)}Qe.isInstancedMesh===!0&&(Qt=!0),Nt!==null&&o.update(Nt,34963),Qt&&(Ye(Qe,ht,_t,yt),Nt!==null&&i.bindBuffer(34963,o.get(Nt).buffer))}function O(){return h.isWebGL2?i.createVertexArray():m.createVertexArrayOES()}function V(Qe){return h.isWebGL2?i.bindVertexArray(Qe):m.bindVertexArrayOES(Qe)}function J(Qe){return h.isWebGL2?i.deleteVertexArray(Qe):m.deleteVertexArrayOES(Qe)}function ee(Qe,ht,_t){const yt=_t.wireframe===!0;let Nt=s[Qe.id];Nt===void 0&&(Nt={},s[Qe.id]=Nt);let Qt=Nt[ht.id];Qt===void 0&&(Qt={},Nt[ht.id]=Qt);let pi=Qt[yt];return pi===void 0&&(pi=se(O()),Qt[yt]=pi),pi}function se(Qe){const ht=[],_t=[],yt=[];for(let Nt=0;Nt<l;Nt++)ht[Nt]=0,_t[Nt]=0,yt[Nt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ht,enabledAttributes:_t,attributeDivisors:yt,object:Qe,attributes:{},index:null}}function fe(Qe,ht){const _t=C.attributes,yt=Qe.attributes;let Nt=0;for(const Qt in yt){const pi=_t[Qt],Pi=yt[Qt];if(pi===void 0||pi.attribute!==Pi||pi.data!==Pi.data)return!0;Nt++}return C.attributesNum!==Nt||C.index!==ht}function le(Qe,ht){const _t={},yt=Qe.attributes;let Nt=0;for(const Qt in yt){const pi=yt[Qt],Pi={};Pi.attribute=pi,pi.data&&(Pi.data=pi.data),_t[Qt]=Pi,Nt++}C.attributes=_t,C.attributesNum=Nt,C.index=ht}function ie(){const Qe=C.newAttributes;for(let ht=0,_t=Qe.length;ht<_t;ht++)Qe[ht]=0}function it(Qe){Ve(Qe,0)}function Ve(Qe,ht){const _t=C.newAttributes,yt=C.enabledAttributes,Nt=C.attributeDivisors;_t[Qe]=1,yt[Qe]===0&&(i.enableVertexAttribArray(Qe),yt[Qe]=1),Nt[Qe]!==ht&&((h.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[h.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Qe,ht),Nt[Qe]=ht)}function Ne(){const Qe=C.newAttributes,ht=C.enabledAttributes;for(let _t=0,yt=ht.length;_t<yt;_t++)ht[_t]!==Qe[_t]&&(i.disableVertexAttribArray(_t),ht[_t]=0)}function Re(Qe,ht,_t,yt,Nt,Qt){h.isWebGL2===!0&&(_t===5124||_t===5125)?i.vertexAttribIPointer(Qe,ht,_t,Nt,Qt):i.vertexAttribPointer(Qe,ht,_t,yt,Nt,Qt)}function Ye(Qe,ht,_t,yt){if(h.isWebGL2===!1&&(Qe.isInstancedMesh||yt.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;ie();const Nt=yt.attributes,Qt=_t.getAttributes(),pi=ht.defaultAttributeValues;for(const Pi in Qt){const Mi=Qt[Pi];if(Mi>=0){const fn=Nt[Pi];if(fn!==void 0){const bi=fn.normalized,Dn=fn.itemSize,Un=o.get(fn);if(Un===void 0)continue;const Ht=Un.buffer,mr=Un.type,zn=Un.bytesPerElement;if(fn.isInterleavedBufferAttribute){const Li=fn.data,Ei=Li.stride,hn=fn.offset;Li&&Li.isInstancedInterleavedBuffer?(Ve(Mi,Li.meshPerAttribute),yt._maxInstanceCount===void 0&&(yt._maxInstanceCount=Li.meshPerAttribute*Li.count)):it(Mi),i.bindBuffer(34962,Ht),Re(Mi,Dn,mr,bi,Ei*zn,hn*zn)}else fn.isInstancedBufferAttribute?(Ve(Mi,fn.meshPerAttribute),yt._maxInstanceCount===void 0&&(yt._maxInstanceCount=fn.meshPerAttribute*fn.count)):it(Mi),i.bindBuffer(34962,Ht),Re(Mi,Dn,mr,bi,0,0)}else if(Pi==="instanceMatrix"){const bi=o.get(Qe.instanceMatrix);if(bi===void 0)continue;const Dn=bi.buffer,Un=bi.type;Ve(Mi+0,1),Ve(Mi+1,1),Ve(Mi+2,1),Ve(Mi+3,1),i.bindBuffer(34962,Dn),i.vertexAttribPointer(Mi+0,4,Un,!1,64,0),i.vertexAttribPointer(Mi+1,4,Un,!1,64,16),i.vertexAttribPointer(Mi+2,4,Un,!1,64,32),i.vertexAttribPointer(Mi+3,4,Un,!1,64,48)}else if(Pi==="instanceColor"){const bi=o.get(Qe.instanceColor);if(bi===void 0)continue;const Dn=bi.buffer,Un=bi.type;Ve(Mi,1),i.bindBuffer(34962,Dn),i.vertexAttribPointer(Mi,3,Un,!1,12,0)}else if(pi!==void 0){const bi=pi[Pi];if(bi!==void 0)switch(bi.length){case 2:i.vertexAttrib2fv(Mi,bi);break;case 3:i.vertexAttrib3fv(Mi,bi);break;case 4:i.vertexAttrib4fv(Mi,bi);break;default:i.vertexAttrib1fv(Mi,bi)}}}}Ne()}function zt(){Et();for(const Qe in s){const ht=s[Qe];for(const _t in ht){const yt=ht[_t];for(const Nt in yt)J(yt[Nt].object),delete yt[Nt];delete ht[_t]}delete s[Qe]}}function pt(Qe){if(s[Qe.id]===void 0)return;const ht=s[Qe.id];for(const _t in ht){const yt=ht[_t];for(const Nt in yt)J(yt[Nt].object),delete yt[Nt];delete ht[_t]}delete s[Qe.id]}function St(Qe){for(const ht in s){const _t=s[ht];if(_t[Qe.id]===void 0)continue;const yt=_t[Qe.id];for(const Nt in yt)J(yt[Nt].object),delete yt[Nt];delete _t[Qe.id]}}function Et(){Dt(),C!==P&&(C=P,V(C.object))}function Dt(){P.geometry=null,P.program=null,P.wireframe=!1}return{setup:F,reset:Et,resetDefaultState:Dt,dispose:zt,releaseStatesOfGeometry:pt,releaseStatesOfProgram:St,initAttributes:ie,enableAttribute:it,disableUnusedAttributes:Ne}}function gQ(i,e,o,h){const l=h.isWebGL2;let m;function x(C){m=C}function s(C,F){i.drawArrays(m,C,F),o.update(F,m,1)}function P(C,F,O){if(O===0)return;let V,J;if(l)V=i,J="drawArraysInstanced";else if(V=e.get("ANGLE_instanced_arrays"),J="drawArraysInstancedANGLE",V===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}V[J](m,C,F,O),o.update(F,m,O)}this.setMode=x,this.render=s,this.renderInstances=P}function _Q(i,e,o){let h;function l(){if(h!==void 0)return h;if(e.has("EXT_texture_filter_anisotropic")===!0){const Re=e.get("EXT_texture_filter_anisotropic");h=i.getParameter(Re.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else h=0;return h}function m(Re){if(Re==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Re="mediump"}return Re==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const x=typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&i instanceof WebGL2ComputeRenderingContext;let s=o.precision!==void 0?o.precision:"highp";const P=m(s);P!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",P,"instead."),s=P);const C=o.logarithmicDepthBuffer===!0,F=i.getParameter(34930),O=i.getParameter(35660),V=i.getParameter(3379),J=i.getParameter(34076),ee=i.getParameter(34921),se=i.getParameter(36347),fe=i.getParameter(36348),le=i.getParameter(36349),ie=O>0,it=x||e.has("OES_texture_float"),Ve=ie&&it,Ne=x?i.getParameter(36183):0;return{isWebGL2:x,getMaxAnisotropy:l,getMaxPrecision:m,precision:s,logarithmicDepthBuffer:C,maxTextures:F,maxVertexTextures:O,maxTextureSize:V,maxCubemapSize:J,maxAttributes:ee,maxVertexUniforms:se,maxVaryings:fe,maxFragmentUniforms:le,vertexTextures:ie,floatFragmentTextures:it,floatVertexTextures:Ve,maxSamples:Ne}}function yQ(i){const e=this;let o=null,h=0,l=!1,m=!1;const x=new El,s=new Qo,P={value:null,needsUpdate:!1};this.uniform=P,this.numPlanes=0,this.numIntersection=0,this.init=function(O,V,J){const ee=O.length!==0||V||h!==0||l;return l=V,o=F(O,J,0),h=O.length,ee},this.beginShadows=function(){m=!0,F(null)},this.endShadows=function(){m=!1,C()},this.setState=function(O,V,J){const ee=O.clippingPlanes,se=O.clipIntersection,fe=O.clipShadows,le=i.get(O);if(!l||ee===null||ee.length===0||m&&!fe)m?F(null):C();else{const ie=m?0:h,it=ie*4;let Ve=le.clippingState||null;P.value=Ve,Ve=F(ee,V,it,J);for(let Ne=0;Ne!==it;++Ne)Ve[Ne]=o[Ne];le.clippingState=Ve,this.numIntersection=se?this.numPlanes:0,this.numPlanes+=ie}};function C(){P.value!==o&&(P.value=o,P.needsUpdate=h>0),e.numPlanes=h,e.numIntersection=0}function F(O,V,J,ee){const se=O!==null?O.length:0;let fe=null;if(se!==0){if(fe=P.value,ee!==!0||fe===null){const le=J+se*4,ie=V.matrixWorldInverse;s.getNormalMatrix(ie),(fe===null||fe.length<le)&&(fe=new Float32Array(le));for(let it=0,Ve=J;it!==se;++it,Ve+=4)x.copy(O[it]).applyMatrix4(ie,s),x.normal.toArray(fe,Ve),fe[Ve+3]=x.constant}P.value=fe,P.needsUpdate=!0}return e.numPlanes=se,e.numIntersection=0,fe}}function vQ(i){let e=new WeakMap;function o(x,s){return s===GT?x.mapping=Mw:s===HT&&(x.mapping=Aw),x}function h(x){if(x&&x.isTexture){const s=x.mapping;if(s===GT||s===HT)if(e.has(x)){const P=e.get(x).texture;return o(P,x.mapping)}else{const P=x.image;if(P&&P.height>0){const C=i.getRenderTarget(),F=new n2(P.height/2);return F.fromEquirectangularTexture(i,x),e.set(x,F),i.setRenderTarget(C),x.addEventListener("dispose",l),o(F.texture,x.mapping)}else return null}}return x}function l(x){const s=x.target;s.removeEventListener("dispose",l);const P=e.get(s);P!==void 0&&(e.delete(s),P.dispose())}function m(){e=new WeakMap}return{get:h,dispose:m}}function xQ(i){const e={};function o(h){if(e[h]!==void 0)return e[h];let l;switch(h){case"WEBGL_depth_texture":l=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":l=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":l=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":l=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:l=i.getExtension(h)}return e[h]=l,l}return{has:function(h){return o(h)!==null},init:function(h){h.isWebGL2?o("EXT_color_buffer_float"):(o("WEBGL_depth_texture"),o("OES_texture_float"),o("OES_texture_half_float"),o("OES_texture_half_float_linear"),o("OES_standard_derivatives"),o("OES_element_index_uint"),o("OES_vertex_array_object"),o("ANGLE_instanced_arrays")),o("OES_texture_float_linear"),o("EXT_color_buffer_half_float")},get:function(h){const l=o(h);return l===null&&console.warn("THREE.WebGLRenderer: "+h+" extension not supported."),l}}}function bQ(i,e,o,h){const l={},m=new WeakMap;function x(O){const V=O.target;V.index!==null&&e.remove(V.index);for(const ee in V.attributes)e.remove(V.attributes[ee]);V.removeEventListener("dispose",x),delete l[V.id];const J=m.get(V);J&&(e.remove(J),m.delete(V)),h.releaseStatesOfGeometry(V),V.isInstancedBufferGeometry===!0&&delete V._maxInstanceCount,o.memory.geometries--}function s(O,V){return l[V.id]===!0||(V.addEventListener("dispose",x),l[V.id]=!0,o.memory.geometries++),V}function P(O){const V=O.attributes;for(const ee in V)e.update(V[ee],34962);const J=O.morphAttributes;for(const ee in J){const se=J[ee];for(let fe=0,le=se.length;fe<le;fe++)e.update(se[fe],34962)}}function C(O){const V=[],J=O.index,ee=O.attributes.position;let se=0;if(J!==null){const ie=J.array;se=J.version;for(let it=0,Ve=ie.length;it<Ve;it+=3){const Ne=ie[it+0],Re=ie[it+1],Ye=ie[it+2];V.push(Ne,Re,Re,Ye,Ye,Ne)}}else{const ie=ee.array;se=ee.version;for(let it=0,Ve=ie.length/3-1;it<Ve;it+=3){const Ne=it+0,Re=it+1,Ye=it+2;V.push(Ne,Re,Re,Ye,Ye,Ne)}}const fe=new(XN(V)>65535?Np:Bp)(V,1);fe.version=se;const le=m.get(O);le&&e.remove(le),m.set(O,fe)}function F(O){const V=m.get(O);if(V){const J=O.index;J!==null&&V.version<J.version&&C(O)}else C(O);return m.get(O)}return{get:s,update:P,getWireframeAttribute:F}}function wQ(i,e,o,h){const l=h.isWebGL2;let m;function x(V){m=V}let s,P;function C(V){s=V.type,P=V.bytesPerElement}function F(V,J){i.drawElements(m,J,s,V*P),o.update(J,m,1)}function O(V,J,ee){if(ee===0)return;let se,fe;if(l)se=i,fe="drawElementsInstanced";else if(se=e.get("ANGLE_instanced_arrays"),fe="drawElementsInstancedANGLE",se===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}se[fe](m,J,s,V*P,ee),o.update(J,m,ee)}this.setMode=x,this.setIndex=C,this.render=F,this.renderInstances=O}function SQ(i){const e={geometries:0,textures:0},o={frame:0,calls:0,triangles:0,points:0,lines:0};function h(m,x,s){switch(o.calls++,x){case 4:o.triangles+=s*(m/3);break;case 1:o.lines+=s*(m/2);break;case 3:o.lines+=s*(m-1);break;case 2:o.lines+=s*m;break;case 0:o.points+=s*m;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",x);break}}function l(){o.frame++,o.calls=0,o.triangles=0,o.points=0,o.lines=0}return{memory:e,render:o,programs:null,autoReset:!0,reset:l,update:h}}function TQ(i,e){return i[0]-e[0]}function EQ(i,e){return Math.abs(e[1])-Math.abs(i[1])}function IQ(i){const e={},o=new Float32Array(8),h=[];for(let m=0;m<8;m++)h[m]=[m,0];function l(m,x,s,P){const C=m.morphTargetInfluences,F=C===void 0?0:C.length;let O=e[x.id];if(O===void 0){O=[];for(let fe=0;fe<F;fe++)O[fe]=[fe,0];e[x.id]=O}for(let fe=0;fe<F;fe++){const le=O[fe];le[0]=fe,le[1]=C[fe]}O.sort(EQ);for(let fe=0;fe<8;fe++)fe<F&&O[fe][1]?(h[fe][0]=O[fe][0],h[fe][1]=O[fe][1]):(h[fe][0]=Number.MAX_SAFE_INTEGER,h[fe][1]=0);h.sort(TQ);const V=s.morphTargets&&x.morphAttributes.position,J=s.morphNormals&&x.morphAttributes.normal;let ee=0;for(let fe=0;fe<8;fe++){const le=h[fe],ie=le[0],it=le[1];ie!==Number.MAX_SAFE_INTEGER&&it?(V&&x.getAttribute("morphTarget"+fe)!==V[ie]&&x.setAttribute("morphTarget"+fe,V[ie]),J&&x.getAttribute("morphNormal"+fe)!==J[ie]&&x.setAttribute("morphNormal"+fe,J[ie]),o[fe]=it,ee+=it):(V&&x.hasAttribute("morphTarget"+fe)===!0&&x.deleteAttribute("morphTarget"+fe),J&&x.hasAttribute("morphNormal"+fe)===!0&&x.deleteAttribute("morphNormal"+fe),o[fe]=0)}const se=x.morphTargetsRelative?1:1-ee;P.getUniforms().setValue(i,"morphTargetBaseInfluence",se),P.getUniforms().setValue(i,"morphTargetInfluences",o)}return{update:l}}function MQ(i,e,o,h){let l=new WeakMap;function m(P){const C=h.render.frame,F=P.geometry,O=e.get(P,F);return l.get(O)!==C&&(e.update(O),l.set(O,C)),P.isInstancedMesh&&(P.hasEventListener("dispose",s)===!1&&P.addEventListener("dispose",s),o.update(P.instanceMatrix,34962),P.instanceColor!==null&&o.update(P.instanceColor,34962)),O}function x(){l=new WeakMap}function s(P){const C=P.target;C.removeEventListener("dispose",s),o.remove(C.instanceMatrix),C.instanceColor!==null&&o.remove(C.instanceColor)}return{update:m,dispose:x}}class r2 extends es{constructor(e=null,o=1,h=1,l=1){super(null),this.image={data:e,width:o,height:h,depth:l},this.magFilter=Cs,this.minFilter=Cs,this.wrapR=la,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}r2.prototype.isDataTexture2DArray=!0;class o2 extends es{constructor(e=null,o=1,h=1,l=1){super(null),this.image={data:e,width:o,height:h,depth:l},this.magFilter=Cs,this.minFilter=Cs,this.wrapR=la,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}o2.prototype.isDataTexture3D=!0;const KN=new es,AQ=new r2,PQ=new o2,QN=new Oy,UR=[],$R=[],VR=new Float32Array(16),jR=new Float32Array(9),GR=new Float32Array(4);function Xp(i,e,o){const h=i[0];if(h<=0||h>0)return i;const l=e*o;let m=UR[l];if(m===void 0&&(m=new Float32Array(l),UR[l]=m),e!==0){h.toArray(m,0);for(let x=1,s=0;x!==e;++x)s+=o,i[x].toArray(m,s)}return m}function Ka(i,e){if(i.length!==e.length)return!1;for(let o=0,h=i.length;o<h;o++)if(i[o]!==e[o])return!1;return!0}function Ma(i,e){for(let o=0,h=e.length;o<h;o++)i[o]=e[o]}function eU(i,e){let o=$R[e];o===void 0&&(o=new Int32Array(e),$R[e]=o);for(let h=0;h!==e;++h)o[h]=i.allocateTextureUnit();return o}function zQ(i,e){const o=this.cache;o[0]!==e&&(i.uniform1f(this.addr,e),o[0]=e)}function CQ(i,e){const o=this.cache;if(e.x!==void 0)(o[0]!==e.x||o[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),o[0]=e.x,o[1]=e.y);else{if(Ka(o,e))return;i.uniform2fv(this.addr,e),Ma(o,e)}}function RQ(i,e){const o=this.cache;if(e.x!==void 0)(o[0]!==e.x||o[1]!==e.y||o[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),o[0]=e.x,o[1]=e.y,o[2]=e.z);else if(e.r!==void 0)(o[0]!==e.r||o[1]!==e.g||o[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),o[0]=e.r,o[1]=e.g,o[2]=e.b);else{if(Ka(o,e))return;i.uniform3fv(this.addr,e),Ma(o,e)}}function LQ(i,e){const o=this.cache;if(e.x!==void 0)(o[0]!==e.x||o[1]!==e.y||o[2]!==e.z||o[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),o[0]=e.x,o[1]=e.y,o[2]=e.z,o[3]=e.w);else{if(Ka(o,e))return;i.uniform4fv(this.addr,e),Ma(o,e)}}function DQ(i,e){const o=this.cache,h=e.elements;if(h===void 0){if(Ka(o,e))return;i.uniformMatrix2fv(this.addr,!1,e),Ma(o,e)}else{if(Ka(o,h))return;GR.set(h),i.uniformMatrix2fv(this.addr,!1,GR),Ma(o,h)}}function kQ(i,e){const o=this.cache,h=e.elements;if(h===void 0){if(Ka(o,e))return;i.uniformMatrix3fv(this.addr,!1,e),Ma(o,e)}else{if(Ka(o,h))return;jR.set(h),i.uniformMatrix3fv(this.addr,!1,jR),Ma(o,h)}}function OQ(i,e){const o=this.cache,h=e.elements;if(h===void 0){if(Ka(o,e))return;i.uniformMatrix4fv(this.addr,!1,e),Ma(o,e)}else{if(Ka(o,h))return;VR.set(h),i.uniformMatrix4fv(this.addr,!1,VR),Ma(o,h)}}function FQ(i,e,o){const h=this.cache,l=o.allocateTextureUnit();h[0]!==l&&(i.uniform1i(this.addr,l),h[0]=l),o.safeSetTexture2D(e||KN,l)}function BQ(i,e,o){const h=this.cache,l=o.allocateTextureUnit();h[0]!==l&&(i.uniform1i(this.addr,l),h[0]=l),o.setTexture2DArray(e||AQ,l)}function NQ(i,e,o){const h=this.cache,l=o.allocateTextureUnit();h[0]!==l&&(i.uniform1i(this.addr,l),h[0]=l),o.setTexture3D(e||PQ,l)}function UQ(i,e,o){const h=this.cache,l=o.allocateTextureUnit();h[0]!==l&&(i.uniform1i(this.addr,l),h[0]=l),o.safeSetTextureCube(e||QN,l)}function $Q(i,e){const o=this.cache;o[0]!==e&&(i.uniform1i(this.addr,e),o[0]=e)}function VQ(i,e){const o=this.cache;Ka(o,e)||(i.uniform2iv(this.addr,e),Ma(o,e))}function jQ(i,e){const o=this.cache;Ka(o,e)||(i.uniform3iv(this.addr,e),Ma(o,e))}function GQ(i,e){const o=this.cache;Ka(o,e)||(i.uniform4iv(this.addr,e),Ma(o,e))}function HQ(i,e){const o=this.cache;o[0]!==e&&(i.uniform1ui(this.addr,e),o[0]=e)}function ZQ(i){switch(i){case 5126:return zQ;case 35664:return CQ;case 35665:return RQ;case 35666:return LQ;case 35674:return DQ;case 35675:return kQ;case 35676:return OQ;case 5124:case 35670:return $Q;case 35667:case 35671:return VQ;case 35668:case 35672:return jQ;case 35669:case 35673:return GQ;case 5125:return HQ;case 35678:case 36198:case 36298:case 36306:case 35682:return FQ;case 35679:case 36299:case 36307:return NQ;case 35680:case 36300:case 36308:case 36293:return UQ;case 36289:case 36303:case 36311:case 36292:return BQ}}function WQ(i,e){i.uniform1fv(this.addr,e)}function qQ(i,e){i.uniform1iv(this.addr,e)}function XQ(i,e){i.uniform2iv(this.addr,e)}function JQ(i,e){i.uniform3iv(this.addr,e)}function YQ(i,e){i.uniform4iv(this.addr,e)}function KQ(i,e){const o=Xp(e,this.size,2);i.uniform2fv(this.addr,o)}function QQ(i,e){const o=Xp(e,this.size,3);i.uniform3fv(this.addr,o)}function eee(i,e){const o=Xp(e,this.size,4);i.uniform4fv(this.addr,o)}function tee(i,e){const o=Xp(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,o)}function iee(i,e){const o=Xp(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,o)}function nee(i,e){const o=Xp(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,o)}function ree(i,e,o){const h=e.length,l=eU(o,h);i.uniform1iv(this.addr,l);for(let m=0;m!==h;++m)o.safeSetTexture2D(e[m]||KN,l[m])}function oee(i,e,o){const h=e.length,l=eU(o,h);i.uniform1iv(this.addr,l);for(let m=0;m!==h;++m)o.safeSetTextureCube(e[m]||QN,l[m])}function see(i){switch(i){case 5126:return WQ;case 35664:return KQ;case 35665:return QQ;case 35666:return eee;case 35674:return tee;case 35675:return iee;case 35676:return nee;case 5124:case 35670:return qQ;case 35667:case 35671:return XQ;case 35668:case 35672:return JQ;case 35669:case 35673:return YQ;case 35678:case 36198:case 36298:case 36306:case 35682:return ree;case 35680:case 36300:case 36308:case 36293:return oee}}function aee(i,e,o){this.id=i,this.addr=o,this.cache=[],this.setValue=ZQ(e.type)}function tU(i,e,o){this.id=i,this.addr=o,this.cache=[],this.size=e.size,this.setValue=see(e.type)}tU.prototype.updateCache=function(i){const e=this.cache;i instanceof Float32Array&&e.length!==i.length&&(this.cache=new Float32Array(i.length)),Ma(e,i)};function iU(i){this.id=i,this.seq=[],this.map={}}iU.prototype.setValue=function(i,e,o){const h=this.seq;for(let l=0,m=h.length;l!==m;++l){const x=h[l];x.setValue(i,e[x.id],o)}};const xT=/(\w+)(\])?(\[|\.)?/g;function HR(i,e){i.seq.push(e),i.map[e.id]=e}function lee(i,e,o){const h=i.name,l=h.length;for(xT.lastIndex=0;;){const m=xT.exec(h),x=xT.lastIndex;let s=m[1];const P=m[2]==="]",C=m[3];if(P&&(s=s|0),C===void 0||C==="["&&x+2===l){HR(o,C===void 0?new aee(s,i,e):new tU(s,i,e));break}else{let O=o.map[s];O===void 0&&(O=new iU(s),HR(o,O)),o=O}}}function ju(i,e){this.seq=[],this.map={};const o=i.getProgramParameter(e,35718);for(let h=0;h<o;++h){const l=i.getActiveUniform(e,h),m=i.getUniformLocation(e,l.name);lee(l,m,this)}}ju.prototype.setValue=function(i,e,o,h){const l=this.map[e];l!==void 0&&l.setValue(i,o,h)};ju.prototype.setOptional=function(i,e,o){const h=e[o];h!==void 0&&this.setValue(i,o,h)};ju.upload=function(i,e,o,h){for(let l=0,m=e.length;l!==m;++l){const x=e[l],s=o[x.id];s.needsUpdate!==!1&&x.setValue(i,s.value,h)}};ju.seqWithValue=function(i,e){const o=[];for(let h=0,l=i.length;h!==l;++h){const m=i[h];m.id in e&&o.push(m)}return o};function ZR(i,e,o){const h=i.createShader(e);return i.shaderSource(h,o),i.compileShader(h),h}let cee=0;function uee(i){const e=i.split(`
`);for(let o=0;o<e.length;o++)e[o]=o+1+": "+e[o];return e.join(`
`)}function nU(i){switch(i){case qp:return["Linear","( value )"];case t2:return["sRGB","( value )"];case BN:return["RGBE","( value )"];case UN:return["RGBM","( value, 7.0 )"];case $N:return["RGBM","( value, 16.0 )"];case VN:return["RGBD","( value, 256.0 )"];case FN:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case NN:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function WR(i,e,o){const h=i.getShaderParameter(e,35713),l=i.getShaderInfoLog(e).trim();if(h&&l==="")return"";const m=i.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+o+`
`+l+uee(m)}function p_(i,e){const o=nU(e);return"vec4 "+i+"( vec4 value ) { return "+o[0]+"ToLinear"+o[1]+"; }"}function hee(i,e){const o=nU(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+o[0]+o[1]+"; }"}function dee(i,e){let o;switch(e){case O4:o="Linear";break;case F4:o="Reinhard";break;case B4:o="OptimizedCineon";break;case N4:o="ACESFilmic";break;case U4:o="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),o="Linear"}return"vec3 "+i+"( vec3 color ) { return "+o+"ToneMapping( color ); }"}function fee(i){return[i.extensionDerivatives||i.envMapCubeUV||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(w_).join(`
`)}function pee(i){const e=[];for(const o in i){const h=i[o];h!==!1&&e.push("#define "+o+" "+h)}return e.join(`
`)}function mee(i,e){const o={},h=i.getProgramParameter(e,35721);for(let l=0;l<h;l++){const x=i.getActiveAttrib(e,l).name;o[x]=i.getAttribLocation(e,x)}return o}function w_(i){return i!==""}function qR(i,e){return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function XR(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const gee=/^[ \t]*#include +<([\w\d./]+)>/gm;function sE(i){return i.replace(gee,_ee)}function _ee(i,e){const o=Xn[e];if(o===void 0)throw new Error("Can not resolve #include <"+e+">");return sE(o)}const yee=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,vee=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function JR(i){return i.replace(vee,rU).replace(yee,xee)}function xee(i,e,o,h){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),rU(i,e,o,h)}function rU(i,e,o,h){let l="";for(let m=parseInt(e);m<parseInt(o);m++)l+=h.replace(/\[\s*i\s*\]/g,"[ "+m+" ]").replace(/UNROLLED_LOOP_INDEX/g,m);return l}function YR(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function bee(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===XM?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===p4?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===yp&&(e="SHADOWMAP_TYPE_VSM"),e}function wee(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Mw:case Aw:e="ENVMAP_TYPE_CUBE";break;case Pw:case zw:e="ENVMAP_TYPE_CUBE_UV";break}return e}function See(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Aw:case zw:e="ENVMAP_MODE_REFRACTION";break}return e}function Tee(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case Ly:e="ENVMAP_BLENDING_MULTIPLY";break;case D4:e="ENVMAP_BLENDING_MIX";break;case k4:e="ENVMAP_BLENDING_ADD";break}return e}function Eee(i,e,o,h){const l=i.getContext(),m=o.defines;let x=o.vertexShader,s=o.fragmentShader;const P=bee(o),C=wee(o),F=See(o),O=Tee(o),V=i.gammaFactor>0?i.gammaFactor:1,J=o.isWebGL2?"":fee(o),ee=pee(m),se=l.createProgram();let fe,le,ie=o.glslVersion?"#version "+o.glslVersion+`
`:"";o.isRawShaderMaterial?(fe=[ee].filter(w_).join(`
`),fe.length>0&&(fe+=`
`),le=[J,ee].filter(w_).join(`
`),le.length>0&&(le+=`
`)):(fe=[YR(o),"#define SHADER_NAME "+o.shaderName,ee,o.instancing?"#define USE_INSTANCING":"",o.instancingColor?"#define USE_INSTANCING_COLOR":"",o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+V,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+F:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&o.flatShading===!1?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+P:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&o.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(w_).join(`
`),le=[J,YR(o),"#define SHADER_NAME "+o.shaderName,ee,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+V,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+C:"",o.envMap?"#define "+F:"",o.envMap?"#define "+O:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.sheen?"#define USE_SHEEN":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors||o.instancingColor?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+P:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&o.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(o.extensionShaderTextureLOD||o.envMap)&&o.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",o.toneMapping!==Sp?"#define TONE_MAPPING":"",o.toneMapping!==Sp?Xn.tonemapping_pars_fragment:"",o.toneMapping!==Sp?dee("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",Xn.encodings_pars_fragment,o.map?p_("mapTexelToLinear",o.mapEncoding):"",o.matcap?p_("matcapTexelToLinear",o.matcapEncoding):"",o.envMap?p_("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMap?p_("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.lightMap?p_("lightMapTexelToLinear",o.lightMapEncoding):"",hee("linearToOutputTexel",o.outputEncoding),o.depthPacking?"#define DEPTH_PACKING "+o.depthPacking:"",`
`].filter(w_).join(`
`)),x=sE(x),x=qR(x,o),x=XR(x,o),s=sE(s),s=qR(s,o),s=XR(s,o),x=JR(x),s=JR(s),o.isWebGL2&&o.isRawShaderMaterial!==!0&&(ie=`#version 300 es
`,fe=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+fe,le=["#define varying in",o.glslVersion===rE?"":"out highp vec4 pc_fragColor;",o.glslVersion===rE?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+le);const it=ie+fe+x,Ve=ie+le+s,Ne=ZR(l,35633,it),Re=ZR(l,35632,Ve);if(l.attachShader(se,Ne),l.attachShader(se,Re),o.index0AttributeName!==void 0?l.bindAttribLocation(se,0,o.index0AttributeName):o.morphTargets===!0&&l.bindAttribLocation(se,0,"position"),l.linkProgram(se),i.debug.checkShaderErrors){const pt=l.getProgramInfoLog(se).trim(),St=l.getShaderInfoLog(Ne).trim(),Et=l.getShaderInfoLog(Re).trim();let Dt=!0,Qe=!0;if(l.getProgramParameter(se,35714)===!1){Dt=!1;const ht=WR(l,Ne,"vertex"),_t=WR(l,Re,"fragment");console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(se,35715),"gl.getProgramInfoLog",pt,ht,_t)}else pt!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",pt):(St===""||Et==="")&&(Qe=!1);Qe&&(this.diagnostics={runnable:Dt,programLog:pt,vertexShader:{log:St,prefix:fe},fragmentShader:{log:Et,prefix:le}})}l.deleteShader(Ne),l.deleteShader(Re);let Ye;this.getUniforms=function(){return Ye===void 0&&(Ye=new ju(l,se)),Ye};let zt;return this.getAttributes=function(){return zt===void 0&&(zt=mee(l,se)),zt},this.destroy=function(){h.releaseStatesOfProgram(this),l.deleteProgram(se),this.program=void 0},this.name=o.shaderName,this.id=cee++,this.cacheKey=e,this.usedTimes=1,this.program=se,this.vertexShader=Ne,this.fragmentShader=Re,this}function Iee(i,e,o,h,l,m){const x=[],s=h.isWebGL2,P=h.logarithmicDepthBuffer,C=h.floatVertexTextures,F=h.maxVertexUniforms,O=h.vertexTextures;let V=h.precision;const J={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},ee=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function se(Re){const zt=Re.skeleton.bones;if(C)return 1024;{const St=Math.floor((F-20)/4),Et=Math.min(St,zt.length);return Et<zt.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+zt.length+" bones. This GPU supports "+Et+"."),0):Et}}function fe(Re){let Ye;return Re&&Re.isTexture?Ye=Re.encoding:Re&&Re.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),Ye=Re.texture.encoding):Ye=qp,Ye}function le(Re,Ye,zt,pt,St){const Et=pt.fog,Dt=Re.isMeshStandardMaterial?pt.environment:null,Qe=e.get(Re.envMap||Dt),ht=J[Re.type],_t=St.isSkinnedMesh?se(St):0;Re.precision!==null&&(V=h.getMaxPrecision(Re.precision),V!==Re.precision&&console.warn("THREE.WebGLProgram.getParameters:",Re.precision,"not supported, using",V,"instead."));let yt,Nt;if(ht){const Pi=Il[ht];yt=Pi.vertexShader,Nt=Pi.fragmentShader}else yt=Re.vertexShader,Nt=Re.fragmentShader;const Qt=i.getRenderTarget();return{isWebGL2:s,shaderID:ht,shaderName:Re.type,vertexShader:yt,fragmentShader:Nt,defines:Re.defines,isRawShaderMaterial:Re.isRawShaderMaterial===!0,glslVersion:Re.glslVersion,precision:V,instancing:St.isInstancedMesh===!0,instancingColor:St.isInstancedMesh===!0&&St.instanceColor!==null,supportsVertexTextures:O,outputEncoding:Qt!==null?fe(Qt.texture):i.outputEncoding,map:!!Re.map,mapEncoding:fe(Re.map),matcap:!!Re.matcap,matcapEncoding:fe(Re.matcap),envMap:!!Qe,envMapMode:Qe&&Qe.mapping,envMapEncoding:fe(Qe),envMapCubeUV:!!Qe&&(Qe.mapping===Pw||Qe.mapping===zw),lightMap:!!Re.lightMap,lightMapEncoding:fe(Re.lightMap),aoMap:!!Re.aoMap,emissiveMap:!!Re.emissiveMap,emissiveMapEncoding:fe(Re.emissiveMap),bumpMap:!!Re.bumpMap,normalMap:!!Re.normalMap,objectSpaceNormalMap:Re.normalMapType===HN,tangentSpaceNormalMap:Re.normalMapType===Td,clearcoatMap:!!Re.clearcoatMap,clearcoatRoughnessMap:!!Re.clearcoatRoughnessMap,clearcoatNormalMap:!!Re.clearcoatNormalMap,displacementMap:!!Re.displacementMap,roughnessMap:!!Re.roughnessMap,metalnessMap:!!Re.metalnessMap,specularMap:!!Re.specularMap,alphaMap:!!Re.alphaMap,gradientMap:!!Re.gradientMap,sheen:!!Re.sheen,transmissionMap:!!Re.transmissionMap,combine:Re.combine,vertexTangents:Re.normalMap&&Re.vertexTangents,vertexColors:Re.vertexColors,vertexUvs:!!Re.map||!!Re.bumpMap||!!Re.normalMap||!!Re.specularMap||!!Re.alphaMap||!!Re.emissiveMap||!!Re.roughnessMap||!!Re.metalnessMap||!!Re.clearcoatMap||!!Re.clearcoatRoughnessMap||!!Re.clearcoatNormalMap||!!Re.displacementMap||!!Re.transmissionMap,uvsVertexOnly:!(Re.map||Re.bumpMap||Re.normalMap||Re.specularMap||Re.alphaMap||Re.emissiveMap||Re.roughnessMap||Re.metalnessMap||Re.clearcoatNormalMap||Re.transmissionMap)&&!!Re.displacementMap,fog:!!Et,useFog:Re.fog,fogExp2:Et&&Et.isFogExp2,flatShading:!!Re.flatShading,sizeAttenuation:Re.sizeAttenuation,logarithmicDepthBuffer:P,skinning:Re.skinning&&_t>0,maxBones:_t,useVertexTexture:C,morphTargets:Re.morphTargets,morphNormals:Re.morphNormals,maxMorphTargets:i.maxMorphTargets,maxMorphNormals:i.maxMorphNormals,numDirLights:Ye.directional.length,numPointLights:Ye.point.length,numSpotLights:Ye.spot.length,numRectAreaLights:Ye.rectArea.length,numHemiLights:Ye.hemi.length,numDirLightShadows:Ye.directionalShadowMap.length,numPointLightShadows:Ye.pointShadowMap.length,numSpotLightShadows:Ye.spotShadowMap.length,numClippingPlanes:m.numPlanes,numClipIntersection:m.numIntersection,dithering:Re.dithering,shadowMapEnabled:i.shadowMap.enabled&&zt.length>0,shadowMapType:i.shadowMap.type,toneMapping:Re.toneMapped?i.toneMapping:Sp,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:Re.premultipliedAlpha,alphaTest:Re.alphaTest,doubleSided:Re.side===Ry,flipSided:Re.side===Bo,depthPacking:Re.depthPacking!==void 0?Re.depthPacking:!1,index0AttributeName:Re.index0AttributeName,extensionDerivatives:Re.extensions&&Re.extensions.derivatives,extensionFragDepth:Re.extensions&&Re.extensions.fragDepth,extensionDrawBuffers:Re.extensions&&Re.extensions.drawBuffers,extensionShaderTextureLOD:Re.extensions&&Re.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||o.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||o.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||o.has("EXT_shader_texture_lod"),customProgramCacheKey:Re.customProgramCacheKey()}}function ie(Re){const Ye=[];if(Re.shaderID?Ye.push(Re.shaderID):(Ye.push(Re.fragmentShader),Ye.push(Re.vertexShader)),Re.defines!==void 0)for(const zt in Re.defines)Ye.push(zt),Ye.push(Re.defines[zt]);if(Re.isRawShaderMaterial===!1){for(let zt=0;zt<ee.length;zt++)Ye.push(Re[ee[zt]]);Ye.push(i.outputEncoding),Ye.push(i.gammaFactor)}return Ye.push(Re.customProgramCacheKey),Ye.join()}function it(Re){const Ye=J[Re.type];let zt;if(Ye){const pt=Il[Ye];zt=JN.clone(pt.uniforms)}else zt=Re.uniforms;return zt}function Ve(Re,Ye){let zt;for(let pt=0,St=x.length;pt<St;pt++){const Et=x[pt];if(Et.cacheKey===Ye){zt=Et,++zt.usedTimes;break}}return zt===void 0&&(zt=new Eee(i,Ye,Re,l),x.push(zt)),zt}function Ne(Re){if(--Re.usedTimes===0){const Ye=x.indexOf(Re);x[Ye]=x[x.length-1],x.pop(),Re.destroy()}}return{getParameters:le,getProgramCacheKey:ie,getUniforms:it,acquireProgram:Ve,releaseProgram:Ne,programs:x}}function Mee(){let i=new WeakMap;function e(m){let x=i.get(m);return x===void 0&&(x={},i.set(m,x)),x}function o(m){i.delete(m)}function h(m,x,s){i.get(m)[x]=s}function l(){i=new WeakMap}return{get:e,remove:o,update:h,dispose:l}}function Aee(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.program!==e.program?i.program.id-e.program.id:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function Pee(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function KR(i){const e=[];let o=0;const h=[],l=[],m={id:-1};function x(){o=0,h.length=0,l.length=0}function s(V,J,ee,se,fe,le){let ie=e[o];const it=i.get(ee);return ie===void 0?(ie={id:V.id,object:V,geometry:J,material:ee,program:it.program||m,groupOrder:se,renderOrder:V.renderOrder,z:fe,group:le},e[o]=ie):(ie.id=V.id,ie.object=V,ie.geometry=J,ie.material=ee,ie.program=it.program||m,ie.groupOrder=se,ie.renderOrder=V.renderOrder,ie.z=fe,ie.group=le),o++,ie}function P(V,J,ee,se,fe,le){const ie=s(V,J,ee,se,fe,le);(ee.transparent===!0?l:h).push(ie)}function C(V,J,ee,se,fe,le){const ie=s(V,J,ee,se,fe,le);(ee.transparent===!0?l:h).unshift(ie)}function F(V,J){h.length>1&&h.sort(V||Aee),l.length>1&&l.sort(J||Pee)}function O(){for(let V=o,J=e.length;V<J;V++){const ee=e[V];if(ee.id===null)break;ee.id=null,ee.object=null,ee.geometry=null,ee.material=null,ee.program=null,ee.group=null}}return{opaque:h,transparent:l,init:x,push:P,unshift:C,finish:O,sort:F}}function zee(i){let e=new WeakMap;function o(l,m){let x;return e.has(l)===!1?(x=new KR(i),e.set(l,[x])):m>=e.get(l).length?(x=new KR(i),e.get(l).push(x)):x=e.get(l)[m],x}function h(){e=new WeakMap}return{get:o,dispose:h}}function Cee(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let o;switch(e.type){case"DirectionalLight":o={direction:new He,color:new dn};break;case"SpotLight":o={position:new He,direction:new He,color:new dn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":o={position:new He,color:new dn,distance:0,decay:0};break;case"HemisphereLight":o={direction:new He,skyColor:new dn,groundColor:new dn};break;case"RectAreaLight":o={color:new dn,position:new He,halfWidth:new He,halfHeight:new He};break}return i[e.id]=o,o}}}function Ree(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let o;switch(e.type){case"DirectionalLight":o={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mi};break;case"SpotLight":o={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mi};break;case"PointLight":o={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mi,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=o,o}}}let Lee=0;function Dee(i,e){return(e.castShadow?1:0)-(i.castShadow?1:0)}function kee(i,e){const o=new Cee,h=Ree(),l={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let F=0;F<9;F++)l.probe.push(new He);const m=new He,x=new tn,s=new tn;function P(F){let O=0,V=0,J=0;for(let Ye=0;Ye<9;Ye++)l.probe[Ye].set(0,0,0);let ee=0,se=0,fe=0,le=0,ie=0,it=0,Ve=0,Ne=0;F.sort(Dee);for(let Ye=0,zt=F.length;Ye<zt;Ye++){const pt=F[Ye],St=pt.color,Et=pt.intensity,Dt=pt.distance,Qe=pt.shadow&&pt.shadow.map?pt.shadow.map.texture:null;if(pt.isAmbientLight)O+=St.r*Et,V+=St.g*Et,J+=St.b*Et;else if(pt.isLightProbe)for(let ht=0;ht<9;ht++)l.probe[ht].addScaledVector(pt.sh.coefficients[ht],Et);else if(pt.isDirectionalLight){const ht=o.get(pt);if(ht.color.copy(pt.color).multiplyScalar(pt.intensity),pt.castShadow){const _t=pt.shadow,yt=h.get(pt);yt.shadowBias=_t.bias,yt.shadowNormalBias=_t.normalBias,yt.shadowRadius=_t.radius,yt.shadowMapSize=_t.mapSize,l.directionalShadow[ee]=yt,l.directionalShadowMap[ee]=Qe,l.directionalShadowMatrix[ee]=pt.shadow.matrix,it++}l.directional[ee]=ht,ee++}else if(pt.isSpotLight){const ht=o.get(pt);if(ht.position.setFromMatrixPosition(pt.matrixWorld),ht.color.copy(St).multiplyScalar(Et),ht.distance=Dt,ht.coneCos=Math.cos(pt.angle),ht.penumbraCos=Math.cos(pt.angle*(1-pt.penumbra)),ht.decay=pt.decay,pt.castShadow){const _t=pt.shadow,yt=h.get(pt);yt.shadowBias=_t.bias,yt.shadowNormalBias=_t.normalBias,yt.shadowRadius=_t.radius,yt.shadowMapSize=_t.mapSize,l.spotShadow[fe]=yt,l.spotShadowMap[fe]=Qe,l.spotShadowMatrix[fe]=pt.shadow.matrix,Ne++}l.spot[fe]=ht,fe++}else if(pt.isRectAreaLight){const ht=o.get(pt);ht.color.copy(St).multiplyScalar(Et),ht.halfWidth.set(pt.width*.5,0,0),ht.halfHeight.set(0,pt.height*.5,0),l.rectArea[le]=ht,le++}else if(pt.isPointLight){const ht=o.get(pt);if(ht.color.copy(pt.color).multiplyScalar(pt.intensity),ht.distance=pt.distance,ht.decay=pt.decay,pt.castShadow){const _t=pt.shadow,yt=h.get(pt);yt.shadowBias=_t.bias,yt.shadowNormalBias=_t.normalBias,yt.shadowRadius=_t.radius,yt.shadowMapSize=_t.mapSize,yt.shadowCameraNear=_t.camera.near,yt.shadowCameraFar=_t.camera.far,l.pointShadow[se]=yt,l.pointShadowMap[se]=Qe,l.pointShadowMatrix[se]=pt.shadow.matrix,Ve++}l.point[se]=ht,se++}else if(pt.isHemisphereLight){const ht=o.get(pt);ht.skyColor.copy(pt.color).multiplyScalar(Et),ht.groundColor.copy(pt.groundColor).multiplyScalar(Et),l.hemi[ie]=ht,ie++}}le>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(l.rectAreaLTC1=Ai.LTC_FLOAT_1,l.rectAreaLTC2=Ai.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(l.rectAreaLTC1=Ai.LTC_HALF_1,l.rectAreaLTC2=Ai.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),l.ambient[0]=O,l.ambient[1]=V,l.ambient[2]=J;const Re=l.hash;(Re.directionalLength!==ee||Re.pointLength!==se||Re.spotLength!==fe||Re.rectAreaLength!==le||Re.hemiLength!==ie||Re.numDirectionalShadows!==it||Re.numPointShadows!==Ve||Re.numSpotShadows!==Ne)&&(l.directional.length=ee,l.spot.length=fe,l.rectArea.length=le,l.point.length=se,l.hemi.length=ie,l.directionalShadow.length=it,l.directionalShadowMap.length=it,l.pointShadow.length=Ve,l.pointShadowMap.length=Ve,l.spotShadow.length=Ne,l.spotShadowMap.length=Ne,l.directionalShadowMatrix.length=it,l.pointShadowMatrix.length=Ve,l.spotShadowMatrix.length=Ne,Re.directionalLength=ee,Re.pointLength=se,Re.spotLength=fe,Re.rectAreaLength=le,Re.hemiLength=ie,Re.numDirectionalShadows=it,Re.numPointShadows=Ve,Re.numSpotShadows=Ne,l.version=Lee++)}function C(F,O){let V=0,J=0,ee=0,se=0,fe=0;const le=O.matrixWorldInverse;for(let ie=0,it=F.length;ie<it;ie++){const Ve=F[ie];if(Ve.isDirectionalLight){const Ne=l.directional[V];Ne.direction.setFromMatrixPosition(Ve.matrixWorld),m.setFromMatrixPosition(Ve.target.matrixWorld),Ne.direction.sub(m),Ne.direction.transformDirection(le),V++}else if(Ve.isSpotLight){const Ne=l.spot[ee];Ne.position.setFromMatrixPosition(Ve.matrixWorld),Ne.position.applyMatrix4(le),Ne.direction.setFromMatrixPosition(Ve.matrixWorld),m.setFromMatrixPosition(Ve.target.matrixWorld),Ne.direction.sub(m),Ne.direction.transformDirection(le),ee++}else if(Ve.isRectAreaLight){const Ne=l.rectArea[se];Ne.position.setFromMatrixPosition(Ve.matrixWorld),Ne.position.applyMatrix4(le),s.identity(),x.copy(Ve.matrixWorld),x.premultiply(le),s.extractRotation(x),Ne.halfWidth.set(Ve.width*.5,0,0),Ne.halfHeight.set(0,Ve.height*.5,0),Ne.halfWidth.applyMatrix4(s),Ne.halfHeight.applyMatrix4(s),se++}else if(Ve.isPointLight){const Ne=l.point[J];Ne.position.setFromMatrixPosition(Ve.matrixWorld),Ne.position.applyMatrix4(le),J++}else if(Ve.isHemisphereLight){const Ne=l.hemi[fe];Ne.direction.setFromMatrixPosition(Ve.matrixWorld),Ne.direction.transformDirection(le),Ne.direction.normalize(),fe++}}}return{setup:P,setupView:C,state:l}}function QR(i,e){const o=new kee(i,e),h=[],l=[];function m(){h.length=0,l.length=0}function x(O){h.push(O)}function s(O){l.push(O)}function P(){o.setup(h)}function C(O){o.setupView(h,O)}return{init:m,state:{lightsArray:h,shadowsArray:l,lights:o},setupLights:P,setupLightsView:C,pushLight:x,pushShadow:s}}function Oee(i,e){let o=new WeakMap;function h(m,x=0){let s;return o.has(m)===!1?(s=new QR(i,e),o.set(m,[s])):x>=o.get(m).length?(s=new QR(i,e),o.get(m).push(s)):s=o.get(m)[x],s}function l(){o=new WeakMap}return{get:h,dispose:l}}class s2 extends eo{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=jN,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}s2.prototype.isMeshDepthMaterial=!0;class a2 extends eo{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new He,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}a2.prototype.isMeshDistanceMaterial=!0;var Fee=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,Bee=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function oU(i,e,o){let h=new Fy;const l=new mi,m=new mi,x=new zr,s=[],P=[],C={},F={0:Bo,1:Cy,2:Ry},O=new Ia({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new mi},radius:{value:4}},vertexShader:Bee,fragmentShader:Fee}),V=O.clone();V.defines.HORIZONTAL_PASS=1;const J=new pr;J.setAttribute("position",new Zn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const ee=new lr(J,O),se=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=XM,this.render=function(Ne,Re,Ye){if(se.enabled===!1||se.autoUpdate===!1&&se.needsUpdate===!1||Ne.length===0)return;const zt=i.getRenderTarget(),pt=i.getActiveCubeFace(),St=i.getActiveMipmapLevel(),Et=i.state;Et.setBlending(bp),Et.buffers.color.setClear(1,1,1,1),Et.buffers.depth.setTest(!0),Et.setScissorTest(!1);for(let Dt=0,Qe=Ne.length;Dt<Qe;Dt++){const ht=Ne[Dt],_t=ht.shadow;if(_t===void 0){console.warn("THREE.WebGLShadowMap:",ht,"has no shadow.");continue}if(_t.autoUpdate===!1&&_t.needsUpdate===!1)continue;l.copy(_t.mapSize);const yt=_t.getFrameExtents();if(l.multiply(yt),m.copy(_t.mapSize),(l.x>o||l.y>o)&&(l.x>o&&(m.x=Math.floor(o/yt.x),l.x=m.x*yt.x,_t.mapSize.x=m.x),l.y>o&&(m.y=Math.floor(o/yt.y),l.y=m.y*yt.y,_t.mapSize.y=m.y)),_t.map===null&&!_t.isPointLightShadow&&this.type===yp){const Qt={minFilter:Ko,magFilter:Ko,format:Ja};_t.map=new Vu(l.x,l.y,Qt),_t.map.texture.name=ht.name+".shadowMap",_t.mapPass=new Vu(l.x,l.y,Qt),_t.camera.updateProjectionMatrix()}if(_t.map===null){const Qt={minFilter:Cs,magFilter:Cs,format:Ja};_t.map=new Vu(l.x,l.y,Qt),_t.map.texture.name=ht.name+".shadowMap",_t.camera.updateProjectionMatrix()}i.setRenderTarget(_t.map),i.clear();const Nt=_t.getViewportCount();for(let Qt=0;Qt<Nt;Qt++){const pi=_t.getViewport(Qt);x.set(m.x*pi.x,m.y*pi.y,m.x*pi.z,m.y*pi.w),Et.viewport(x),_t.updateMatrices(ht,Qt),h=_t.getFrustum(),Ve(Re,Ye,_t.camera,ht,this.type)}!_t.isPointLightShadow&&this.type===yp&&fe(_t,Ye),_t.needsUpdate=!1}se.needsUpdate=!1,i.setRenderTarget(zt,pt,St)};function fe(Ne,Re){const Ye=e.update(ee);O.uniforms.shadow_pass.value=Ne.map.texture,O.uniforms.resolution.value=Ne.mapSize,O.uniforms.radius.value=Ne.radius,i.setRenderTarget(Ne.mapPass),i.clear(),i.renderBufferDirect(Re,null,Ye,O,ee,null),V.uniforms.shadow_pass.value=Ne.mapPass.texture,V.uniforms.resolution.value=Ne.mapSize,V.uniforms.radius.value=Ne.radius,i.setRenderTarget(Ne.map),i.clear(),i.renderBufferDirect(Re,null,Ye,V,ee,null)}function le(Ne,Re,Ye){const zt=Ne<<0|Re<<1|Ye<<2;let pt=s[zt];return pt===void 0&&(pt=new s2({depthPacking:GN,morphTargets:Ne,skinning:Re}),s[zt]=pt),pt}function ie(Ne,Re,Ye){const zt=Ne<<0|Re<<1|Ye<<2;let pt=P[zt];return pt===void 0&&(pt=new a2({morphTargets:Ne,skinning:Re}),P[zt]=pt),pt}function it(Ne,Re,Ye,zt,pt,St,Et){let Dt=null,Qe=le,ht=Ne.customDepthMaterial;if(zt.isPointLight===!0&&(Qe=ie,ht=Ne.customDistanceMaterial),ht===void 0){let _t=!1;Ye.morphTargets===!0&&(_t=Re.morphAttributes&&Re.morphAttributes.position&&Re.morphAttributes.position.length>0);let yt=!1;Ne.isSkinnedMesh===!0&&(Ye.skinning===!0?yt=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",Ne));const Nt=Ne.isInstancedMesh===!0;Dt=Qe(_t,yt,Nt)}else Dt=ht;if(i.localClippingEnabled&&Ye.clipShadows===!0&&Ye.clippingPlanes.length!==0){const _t=Dt.uuid,yt=Ye.uuid;let Nt=C[_t];Nt===void 0&&(Nt={},C[_t]=Nt);let Qt=Nt[yt];Qt===void 0&&(Qt=Dt.clone(),Nt[yt]=Qt),Dt=Qt}return Dt.visible=Ye.visible,Dt.wireframe=Ye.wireframe,Et===yp?Dt.side=Ye.shadowSide!==null?Ye.shadowSide:Ye.side:Dt.side=Ye.shadowSide!==null?Ye.shadowSide:F[Ye.side],Dt.clipShadows=Ye.clipShadows,Dt.clippingPlanes=Ye.clippingPlanes,Dt.clipIntersection=Ye.clipIntersection,Dt.wireframeLinewidth=Ye.wireframeLinewidth,Dt.linewidth=Ye.linewidth,zt.isPointLight===!0&&Dt.isMeshDistanceMaterial===!0&&(Dt.referencePosition.setFromMatrixPosition(zt.matrixWorld),Dt.nearDistance=pt,Dt.farDistance=St),Dt}function Ve(Ne,Re,Ye,zt,pt){if(Ne.visible===!1)return;if(Ne.layers.test(Re.layers)&&(Ne.isMesh||Ne.isLine||Ne.isPoints)&&(Ne.castShadow||Ne.receiveShadow&&pt===yp)&&(!Ne.frustumCulled||h.intersectsObject(Ne))){Ne.modelViewMatrix.multiplyMatrices(Ye.matrixWorldInverse,Ne.matrixWorld);const Dt=e.update(Ne),Qe=Ne.material;if(Array.isArray(Qe)){const ht=Dt.groups;for(let _t=0,yt=ht.length;_t<yt;_t++){const Nt=ht[_t],Qt=Qe[Nt.materialIndex];if(Qt&&Qt.visible){const pi=it(Ne,Dt,Qt,zt,Ye.near,Ye.far,pt);i.renderBufferDirect(Ye,null,Dt,pi,Ne,Nt)}}}else if(Qe.visible){const ht=it(Ne,Dt,Qe,zt,Ye.near,Ye.far,pt);i.renderBufferDirect(Ye,null,Dt,ht,Ne,null)}}const Et=Ne.children;for(let Dt=0,Qe=Et.length;Dt<Qe;Dt++)Ve(Et[Dt],Re,Ye,zt,pt)}}function Nee(i,e,o){const h=o.isWebGL2;function l(){let rt=!1;const ri=new zr;let wi=null;const gi=new zr(0,0,0,0);return{setMask:function(Yt){wi!==Yt&&!rt&&(i.colorMask(Yt,Yt,Yt,Yt),wi=Yt)},setLocked:function(Yt){rt=Yt},setClear:function(Yt,Zi,qi,$i,Xi){Xi===!0&&(Yt*=$i,Zi*=$i,qi*=$i),ri.set(Yt,Zi,qi,$i),gi.equals(ri)===!1&&(i.clearColor(Yt,Zi,qi,$i),gi.copy(ri))},reset:function(){rt=!1,wi=null,gi.set(-1,0,0,0)}}}function m(){let rt=!1,ri=null,wi=null,gi=null;return{setTest:function(Yt){Yt?Pi(2929):Mi(2929)},setMask:function(Yt){ri!==Yt&&!rt&&(i.depthMask(Yt),ri=Yt)},setFunc:function(Yt){if(wi!==Yt){if(Yt)switch(Yt){case M4:i.depthFunc(512);break;case A4:i.depthFunc(519);break;case P4:i.depthFunc(513);break;case ub:i.depthFunc(515);break;case z4:i.depthFunc(514);break;case C4:i.depthFunc(518);break;case R4:i.depthFunc(516);break;case L4:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);wi=Yt}},setLocked:function(Yt){rt=Yt},setClear:function(Yt){gi!==Yt&&(i.clearDepth(Yt),gi=Yt)},reset:function(){rt=!1,ri=null,wi=null,gi=null}}}function x(){let rt=!1,ri=null,wi=null,gi=null,Yt=null,Zi=null,qi=null,$i=null,Xi=null;return{setTest:function(Di){rt||(Di?Pi(2960):Mi(2960))},setMask:function(Di){ri!==Di&&!rt&&(i.stencilMask(Di),ri=Di)},setFunc:function(Di,gr,Er){(wi!==Di||gi!==gr||Yt!==Er)&&(i.stencilFunc(Di,gr,Er),wi=Di,gi=gr,Yt=Er)},setOp:function(Di,gr,Er){(Zi!==Di||qi!==gr||$i!==Er)&&(i.stencilOp(Di,gr,Er),Zi=Di,qi=gr,$i=Er)},setLocked:function(Di){rt=Di},setClear:function(Di){Xi!==Di&&(i.clearStencil(Di),Xi=Di)},reset:function(){rt=!1,ri=null,wi=null,gi=null,Yt=null,Zi=null,qi=null,$i=null,Xi=null}}}const s=new l,P=new m,C=new x;let F={},O=null,V=!1,J=null,ee=null,se=null,fe=null,le=null,ie=null,it=null,Ve=!1,Ne=null,Re=null,Ye=null,zt=null,pt=null;const St=i.getParameter(35661);let Et=!1,Dt=0;const Qe=i.getParameter(7938);Qe.indexOf("WebGL")!==-1?(Dt=parseFloat(/^WebGL (\d)/.exec(Qe)[1]),Et=Dt>=1):Qe.indexOf("OpenGL ES")!==-1&&(Dt=parseFloat(/^OpenGL ES (\d)/.exec(Qe)[1]),Et=Dt>=2);let ht=null,_t={};const yt=new zr,Nt=new zr;function Qt(rt,ri,wi){const gi=new Uint8Array(4),Yt=i.createTexture();i.bindTexture(rt,Yt),i.texParameteri(rt,10241,9728),i.texParameteri(rt,10240,9728);for(let Zi=0;Zi<wi;Zi++)i.texImage2D(ri+Zi,0,6408,1,1,0,6408,5121,gi);return Yt}const pi={};pi[3553]=Qt(3553,3553,1),pi[34067]=Qt(34067,34069,6),s.setClear(0,0,0,1),P.setClear(1),C.setClear(0),Pi(2929),P.setFunc(ub),mr(!1),zn(BT),Pi(2884),Un(bp);function Pi(rt){F[rt]!==!0&&(i.enable(rt),F[rt]=!0)}function Mi(rt){F[rt]!==!1&&(i.disable(rt),F[rt]=!1)}function fn(rt){return O!==rt?(i.useProgram(rt),O=rt,!0):!1}const bi={[ad]:32774,[g4]:32778,[_4]:32779};if(h)bi[VT]=32775,bi[jT]=32776;else{const rt=e.get("EXT_blend_minmax");rt!==null&&(bi[VT]=rt.MIN_EXT,bi[jT]=rt.MAX_EXT)}const Dn={[y4]:0,[v4]:1,[x4]:768,[YM]:770,[I4]:776,[T4]:774,[w4]:772,[b4]:769,[KM]:771,[E4]:775,[S4]:773};function Un(rt,ri,wi,gi,Yt,Zi,qi,$i){if(rt===bp){V===!0&&(Mi(3042),V=!1);return}if(V===!1&&(Pi(3042),V=!0),rt!==m4){if(rt!==J||$i!==Ve){if((ee!==ad||le!==ad)&&(i.blendEquation(32774),ee=ad,le=ad),$i)switch(rt){case wp:i.blendFuncSeparate(1,771,1,771);break;case NT:i.blendFunc(1,1);break;case UT:i.blendFuncSeparate(0,0,769,771);break;case $T:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",rt);break}else switch(rt){case wp:i.blendFuncSeparate(770,771,1,771);break;case NT:i.blendFunc(770,1);break;case UT:i.blendFunc(0,769);break;case $T:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",rt);break}se=null,fe=null,ie=null,it=null,J=rt,Ve=$i}return}Yt=Yt||ri,Zi=Zi||wi,qi=qi||gi,(ri!==ee||Yt!==le)&&(i.blendEquationSeparate(bi[ri],bi[Yt]),ee=ri,le=Yt),(wi!==se||gi!==fe||Zi!==ie||qi!==it)&&(i.blendFuncSeparate(Dn[wi],Dn[gi],Dn[Zi],Dn[qi]),se=wi,fe=gi,ie=Zi,it=qi),J=rt,Ve=null}function Ht(rt,ri){rt.side===Ry?Mi(2884):Pi(2884);let wi=rt.side===Bo;ri&&(wi=!wi),mr(wi),rt.blending===wp&&rt.transparent===!1?Un(bp):Un(rt.blending,rt.blendEquation,rt.blendSrc,rt.blendDst,rt.blendEquationAlpha,rt.blendSrcAlpha,rt.blendDstAlpha,rt.premultipliedAlpha),P.setFunc(rt.depthFunc),P.setTest(rt.depthTest),P.setMask(rt.depthWrite),s.setMask(rt.colorWrite);const gi=rt.stencilWrite;C.setTest(gi),gi&&(C.setMask(rt.stencilWriteMask),C.setFunc(rt.stencilFunc,rt.stencilRef,rt.stencilFuncMask),C.setOp(rt.stencilFail,rt.stencilZFail,rt.stencilZPass)),Ei(rt.polygonOffset,rt.polygonOffsetFactor,rt.polygonOffsetUnits)}function mr(rt){Ne!==rt&&(rt?i.frontFace(2304):i.frontFace(2305),Ne=rt)}function zn(rt){rt!==d4?(Pi(2884),rt!==Re&&(rt===BT?i.cullFace(1029):rt===f4?i.cullFace(1028):i.cullFace(1032))):Mi(2884),Re=rt}function Li(rt){rt!==Ye&&(Et&&i.lineWidth(rt),Ye=rt)}function Ei(rt,ri,wi){rt?(Pi(32823),(zt!==ri||pt!==wi)&&(i.polygonOffset(ri,wi),zt=ri,pt=wi)):Mi(32823)}function hn(rt){rt?Pi(3089):Mi(3089)}function ei(rt){rt===void 0&&(rt=33984+St-1),ht!==rt&&(i.activeTexture(rt),ht=rt)}function Wt(rt,ri){ht===null&&ei();let wi=_t[ht];wi===void 0&&(wi={type:void 0,texture:void 0},_t[ht]=wi),(wi.type!==rt||wi.texture!==ri)&&(i.bindTexture(rt,ri||pi[rt]),wi.type=rt,wi.texture=ri)}function ui(){const rt=_t[ht];rt!==void 0&&rt.type!==void 0&&(i.bindTexture(rt.type,null),rt.type=void 0,rt.texture=void 0)}function Vi(){try{i.compressedTexImage2D.apply(i,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function zi(){try{i.texImage2D.apply(i,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function $e(){try{i.texImage3D.apply(i,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function Ce(rt){yt.equals(rt)===!1&&(i.scissor(rt.x,rt.y,rt.z,rt.w),yt.copy(rt))}function Zt(rt){Nt.equals(rt)===!1&&(i.viewport(rt.x,rt.y,rt.z,rt.w),Nt.copy(rt))}function Xt(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),F={},ht=null,_t={},O=null,V=!1,J=null,ee=null,se=null,fe=null,le=null,ie=null,it=null,Ve=!1,Ne=null,Re=null,Ye=null,zt=null,pt=null,s.reset(),P.reset(),C.reset()}return{buffers:{color:s,depth:P,stencil:C},enable:Pi,disable:Mi,useProgram:fn,setBlending:Un,setMaterial:Ht,setFlipSided:mr,setCullFace:zn,setLineWidth:Li,setPolygonOffset:Ei,setScissorTest:hn,activeTexture:ei,bindTexture:Wt,unbindTexture:ui,compressedTexImage2D:Vi,texImage2D:zi,texImage3D:$e,scissor:Ce,viewport:Zt,reset:Xt}}function Uee(i,e,o,h,l,m,x){const s=l.isWebGL2,P=l.maxTextures,C=l.maxCubemapSize,F=l.maxTextureSize,O=l.maxSamples,V=new WeakMap;let J,ee=!1;try{ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function se($e,Ce){return ee?new OffscreenCanvas($e,Ce):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function fe($e,Ce,Zt,Xt){let rt=1;if(($e.width>Xt||$e.height>Xt)&&(rt=Xt/Math.max($e.width,$e.height)),rt<1||Ce===!0)if(typeof HTMLImageElement<"u"&&$e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&$e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&$e instanceof ImageBitmap){const ri=Ce?kn.floorPowerOfTwo:Math.floor,wi=ri(rt*$e.width),gi=ri(rt*$e.height);J===void 0&&(J=se(wi,gi));const Yt=Zt?se(wi,gi):J;return Yt.width=wi,Yt.height=gi,Yt.getContext("2d").drawImage($e,0,0,wi,gi),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+$e.width+"x"+$e.height+") to ("+wi+"x"+gi+")."),Yt}else return"data"in $e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+$e.width+"x"+$e.height+")."),$e;return $e}function le($e){return kn.isPowerOfTwo($e.width)&&kn.isPowerOfTwo($e.height)}function ie($e){return s?!1:$e.wrapS!==la||$e.wrapT!==la||$e.minFilter!==Cs&&$e.minFilter!==Ko}function it($e,Ce){return $e.generateMipmaps&&Ce&&$e.minFilter!==Cs&&$e.minFilter!==Ko}function Ve($e,Ce,Zt,Xt){i.generateMipmap($e);const rt=h.get(Ce);rt.__maxMipLevel=Math.log2(Math.max(Zt,Xt))}function Ne($e,Ce,Zt){if(s===!1)return Ce;if($e!==null){if(i[$e]!==void 0)return i[$e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+$e+"'")}let Xt=Ce;return Ce===6403&&(Zt===5126&&(Xt=33326),Zt===5131&&(Xt=33325),Zt===5121&&(Xt=33321)),Ce===6407&&(Zt===5126&&(Xt=34837),Zt===5131&&(Xt=34843),Zt===5121&&(Xt=32849)),Ce===6408&&(Zt===5126&&(Xt=34836),Zt===5131&&(Xt=34842),Zt===5121&&(Xt=32856)),(Xt===33325||Xt===33326||Xt===34842||Xt===34836)&&e.get("EXT_color_buffer_float"),Xt}function Re($e){return $e===Cs||$e===ZT||$e===WT?9728:9729}function Ye($e){const Ce=$e.target;Ce.removeEventListener("dispose",Ye),pt(Ce),Ce.isVideoTexture&&V.delete(Ce),x.memory.textures--}function zt($e){const Ce=$e.target;Ce.removeEventListener("dispose",zt),St(Ce),x.memory.textures--}function pt($e){const Ce=h.get($e);Ce.__webglInit!==void 0&&(i.deleteTexture(Ce.__webglTexture),h.remove($e))}function St($e){const Ce=$e.texture,Zt=h.get($e),Xt=h.get(Ce);if($e){if(Xt.__webglTexture!==void 0&&i.deleteTexture(Xt.__webglTexture),$e.depthTexture&&$e.depthTexture.dispose(),$e.isWebGLCubeRenderTarget)for(let rt=0;rt<6;rt++)i.deleteFramebuffer(Zt.__webglFramebuffer[rt]),Zt.__webglDepthbuffer&&i.deleteRenderbuffer(Zt.__webglDepthbuffer[rt]);else i.deleteFramebuffer(Zt.__webglFramebuffer),Zt.__webglDepthbuffer&&i.deleteRenderbuffer(Zt.__webglDepthbuffer),Zt.__webglMultisampledFramebuffer&&i.deleteFramebuffer(Zt.__webglMultisampledFramebuffer),Zt.__webglColorRenderbuffer&&i.deleteRenderbuffer(Zt.__webglColorRenderbuffer),Zt.__webglDepthRenderbuffer&&i.deleteRenderbuffer(Zt.__webglDepthRenderbuffer);h.remove(Ce),h.remove($e)}}let Et=0;function Dt(){Et=0}function Qe(){const $e=Et;return $e>=P&&console.warn("THREE.WebGLTextures: Trying to use "+$e+" texture units while this GPU supports only "+P),Et+=1,$e}function ht($e,Ce){const Zt=h.get($e);if($e.isVideoTexture&&ei($e),$e.version>0&&Zt.__version!==$e.version){const Xt=$e.image;if(Xt===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Xt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{fn(Zt,$e,Ce);return}}o.activeTexture(33984+Ce),o.bindTexture(3553,Zt.__webglTexture)}function _t($e,Ce){const Zt=h.get($e);if($e.version>0&&Zt.__version!==$e.version){fn(Zt,$e,Ce);return}o.activeTexture(33984+Ce),o.bindTexture(35866,Zt.__webglTexture)}function yt($e,Ce){const Zt=h.get($e);if($e.version>0&&Zt.__version!==$e.version){fn(Zt,$e,Ce);return}o.activeTexture(33984+Ce),o.bindTexture(32879,Zt.__webglTexture)}function Nt($e,Ce){const Zt=h.get($e);if($e.version>0&&Zt.__version!==$e.version){bi(Zt,$e,Ce);return}o.activeTexture(33984+Ce),o.bindTexture(34067,Zt.__webglTexture)}const Qt={[hb]:10497,[la]:33071,[db]:33648},pi={[Cs]:9728,[ZT]:9984,[WT]:9986,[Ko]:9729,[$4]:9985,[Dy]:9987};function Pi($e,Ce,Zt){if(Zt?(i.texParameteri($e,10242,Qt[Ce.wrapS]),i.texParameteri($e,10243,Qt[Ce.wrapT]),($e===32879||$e===35866)&&i.texParameteri($e,32882,Qt[Ce.wrapR]),i.texParameteri($e,10240,pi[Ce.magFilter]),i.texParameteri($e,10241,pi[Ce.minFilter])):(i.texParameteri($e,10242,33071),i.texParameteri($e,10243,33071),($e===32879||$e===35866)&&i.texParameteri($e,32882,33071),(Ce.wrapS!==la||Ce.wrapT!==la)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri($e,10240,Re(Ce.magFilter)),i.texParameteri($e,10241,Re(Ce.minFilter)),Ce.minFilter!==Cs&&Ce.minFilter!==Ko&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const Xt=e.get("EXT_texture_filter_anisotropic");if(Ce.type===Fc&&e.has("OES_texture_float_linear")===!1||s===!1&&Ce.type===B_&&e.has("OES_texture_half_float_linear")===!1)return;(Ce.anisotropy>1||h.get(Ce).__currentAnisotropy)&&(i.texParameterf($e,Xt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ce.anisotropy,l.getMaxAnisotropy())),h.get(Ce).__currentAnisotropy=Ce.anisotropy)}}function Mi($e,Ce){$e.__webglInit===void 0&&($e.__webglInit=!0,Ce.addEventListener("dispose",Ye),$e.__webglTexture=i.createTexture(),x.memory.textures++)}function fn($e,Ce,Zt){let Xt=3553;Ce.isDataTexture2DArray&&(Xt=35866),Ce.isDataTexture3D&&(Xt=32879),Mi($e,Ce),o.activeTexture(33984+Zt),o.bindTexture(Xt,$e.__webglTexture),i.pixelStorei(37440,Ce.flipY),i.pixelStorei(37441,Ce.premultiplyAlpha),i.pixelStorei(3317,Ce.unpackAlignment),i.pixelStorei(37443,0);const rt=ie(Ce)&&le(Ce.image)===!1,ri=fe(Ce.image,rt,!1,F),wi=le(ri)||s,gi=m.convert(Ce.format);let Yt=m.convert(Ce.type),Zi=Ne(Ce.internalFormat,gi,Yt);Pi(Xt,Ce,wi);let qi;const $i=Ce.mipmaps;if(Ce.isDepthTexture)Zi=6402,s?Ce.type===Fc?Zi=36012:Ce.type===S_?Zi=33190:Ce.type===Tp?Zi=35056:Zi=33189:Ce.type===Fc&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Ce.format===fd&&Zi===6402&&Ce.type!==F_&&Ce.type!==S_&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Ce.type=F_,Yt=m.convert(Ce.type)),Ce.format===Op&&Zi===6402&&(Zi=34041,Ce.type!==Tp&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Ce.type=Tp,Yt=m.convert(Ce.type))),o.texImage2D(3553,0,Zi,ri.width,ri.height,0,gi,Yt,null);else if(Ce.isDataTexture)if($i.length>0&&wi){for(let Xi=0,Di=$i.length;Xi<Di;Xi++)qi=$i[Xi],o.texImage2D(3553,Xi,Zi,qi.width,qi.height,0,gi,Yt,qi.data);Ce.generateMipmaps=!1,$e.__maxMipLevel=$i.length-1}else o.texImage2D(3553,0,Zi,ri.width,ri.height,0,gi,Yt,ri.data),$e.__maxMipLevel=0;else if(Ce.isCompressedTexture){for(let Xi=0,Di=$i.length;Xi<Di;Xi++)qi=$i[Xi],Ce.format!==Ja&&Ce.format!==$u?gi!==null?o.compressedTexImage2D(3553,Xi,Zi,qi.width,qi.height,0,qi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):o.texImage2D(3553,Xi,Zi,qi.width,qi.height,0,gi,Yt,qi.data);$e.__maxMipLevel=$i.length-1}else if(Ce.isDataTexture2DArray)o.texImage3D(35866,0,Zi,ri.width,ri.height,ri.depth,0,gi,Yt,ri.data),$e.__maxMipLevel=0;else if(Ce.isDataTexture3D)o.texImage3D(32879,0,Zi,ri.width,ri.height,ri.depth,0,gi,Yt,ri.data),$e.__maxMipLevel=0;else if($i.length>0&&wi){for(let Xi=0,Di=$i.length;Xi<Di;Xi++)qi=$i[Xi],o.texImage2D(3553,Xi,Zi,gi,Yt,qi);Ce.generateMipmaps=!1,$e.__maxMipLevel=$i.length-1}else o.texImage2D(3553,0,Zi,gi,Yt,ri),$e.__maxMipLevel=0;it(Ce,wi)&&Ve(Xt,Ce,ri.width,ri.height),$e.__version=Ce.version,Ce.onUpdate&&Ce.onUpdate(Ce)}function bi($e,Ce,Zt){if(Ce.image.length!==6)return;Mi($e,Ce),o.activeTexture(33984+Zt),o.bindTexture(34067,$e.__webglTexture),i.pixelStorei(37440,Ce.flipY),i.pixelStorei(37441,Ce.premultiplyAlpha),i.pixelStorei(3317,Ce.unpackAlignment),i.pixelStorei(37443,0);const Xt=Ce&&(Ce.isCompressedTexture||Ce.image[0].isCompressedTexture),rt=Ce.image[0]&&Ce.image[0].isDataTexture,ri=[];for(let Xi=0;Xi<6;Xi++)!Xt&&!rt?ri[Xi]=fe(Ce.image[Xi],!1,!0,C):ri[Xi]=rt?Ce.image[Xi].image:Ce.image[Xi];const wi=ri[0],gi=le(wi)||s,Yt=m.convert(Ce.format),Zi=m.convert(Ce.type),qi=Ne(Ce.internalFormat,Yt,Zi);Pi(34067,Ce,gi);let $i;if(Xt){for(let Xi=0;Xi<6;Xi++){$i=ri[Xi].mipmaps;for(let Di=0;Di<$i.length;Di++){const gr=$i[Di];Ce.format!==Ja&&Ce.format!==$u?Yt!==null?o.compressedTexImage2D(34069+Xi,Di,qi,gr.width,gr.height,0,gr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):o.texImage2D(34069+Xi,Di,qi,gr.width,gr.height,0,Yt,Zi,gr.data)}}$e.__maxMipLevel=$i.length-1}else{$i=Ce.mipmaps;for(let Xi=0;Xi<6;Xi++)if(rt){o.texImage2D(34069+Xi,0,qi,ri[Xi].width,ri[Xi].height,0,Yt,Zi,ri[Xi].data);for(let Di=0;Di<$i.length;Di++){const Er=$i[Di].image[Xi].image;o.texImage2D(34069+Xi,Di+1,qi,Er.width,Er.height,0,Yt,Zi,Er.data)}}else{o.texImage2D(34069+Xi,0,qi,Yt,Zi,ri[Xi]);for(let Di=0;Di<$i.length;Di++){const gr=$i[Di];o.texImage2D(34069+Xi,Di+1,qi,Yt,Zi,gr.image[Xi])}}$e.__maxMipLevel=$i.length}it(Ce,gi)&&Ve(34067,Ce,wi.width,wi.height),$e.__version=Ce.version,Ce.onUpdate&&Ce.onUpdate(Ce)}function Dn($e,Ce,Zt,Xt){const rt=Ce.texture,ri=m.convert(rt.format),wi=m.convert(rt.type),gi=Ne(rt.internalFormat,ri,wi);Xt===32879||Xt===35866?o.texImage3D(Xt,0,gi,Ce.width,Ce.height,Ce.depth,0,ri,wi,null):o.texImage2D(Xt,0,gi,Ce.width,Ce.height,0,ri,wi,null),i.bindFramebuffer(36160,$e),i.framebufferTexture2D(36160,Zt,Xt,h.get(rt).__webglTexture,0),i.bindFramebuffer(36160,null)}function Un($e,Ce,Zt){if(i.bindRenderbuffer(36161,$e),Ce.depthBuffer&&!Ce.stencilBuffer){let Xt=33189;if(Zt){const rt=Ce.depthTexture;rt&&rt.isDepthTexture&&(rt.type===Fc?Xt=36012:rt.type===S_&&(Xt=33190));const ri=hn(Ce);i.renderbufferStorageMultisample(36161,ri,Xt,Ce.width,Ce.height)}else i.renderbufferStorage(36161,Xt,Ce.width,Ce.height);i.framebufferRenderbuffer(36160,36096,36161,$e)}else if(Ce.depthBuffer&&Ce.stencilBuffer){if(Zt){const Xt=hn(Ce);i.renderbufferStorageMultisample(36161,Xt,35056,Ce.width,Ce.height)}else i.renderbufferStorage(36161,34041,Ce.width,Ce.height);i.framebufferRenderbuffer(36160,33306,36161,$e)}else{const Xt=Ce.texture,rt=m.convert(Xt.format),ri=m.convert(Xt.type),wi=Ne(Xt.internalFormat,rt,ri);if(Zt){const gi=hn(Ce);i.renderbufferStorageMultisample(36161,gi,wi,Ce.width,Ce.height)}else i.renderbufferStorage(36161,wi,Ce.width,Ce.height)}i.bindRenderbuffer(36161,null)}function Ht($e,Ce){if(Ce&&Ce.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,$e),!(Ce.depthTexture&&Ce.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!h.get(Ce.depthTexture).__webglTexture||Ce.depthTexture.image.width!==Ce.width||Ce.depthTexture.image.height!==Ce.height)&&(Ce.depthTexture.image.width=Ce.width,Ce.depthTexture.image.height=Ce.height,Ce.depthTexture.needsUpdate=!0),ht(Ce.depthTexture,0);const Xt=h.get(Ce.depthTexture).__webglTexture;if(Ce.depthTexture.format===fd)i.framebufferTexture2D(36160,36096,3553,Xt,0);else if(Ce.depthTexture.format===Op)i.framebufferTexture2D(36160,33306,3553,Xt,0);else throw new Error("Unknown depthTexture format")}function mr($e){const Ce=h.get($e),Zt=$e.isWebGLCubeRenderTarget===!0;if($e.depthTexture){if(Zt)throw new Error("target.depthTexture not supported in Cube render targets");Ht(Ce.__webglFramebuffer,$e)}else if(Zt){Ce.__webglDepthbuffer=[];for(let Xt=0;Xt<6;Xt++)i.bindFramebuffer(36160,Ce.__webglFramebuffer[Xt]),Ce.__webglDepthbuffer[Xt]=i.createRenderbuffer(),Un(Ce.__webglDepthbuffer[Xt],$e,!1)}else i.bindFramebuffer(36160,Ce.__webglFramebuffer),Ce.__webglDepthbuffer=i.createRenderbuffer(),Un(Ce.__webglDepthbuffer,$e,!1);i.bindFramebuffer(36160,null)}function zn($e){const Ce=$e.texture,Zt=h.get($e),Xt=h.get(Ce);$e.addEventListener("dispose",zt),Xt.__webglTexture=i.createTexture(),x.memory.textures++;const rt=$e.isWebGLCubeRenderTarget===!0,ri=$e.isWebGLMultisampleRenderTarget===!0,wi=Ce.isDataTexture3D||Ce.isDataTexture2DArray,gi=le($e)||s;if(s&&Ce.format===$u&&(Ce.type===Fc||Ce.type===B_)&&(Ce.format=Ja,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),rt){Zt.__webglFramebuffer=[];for(let Yt=0;Yt<6;Yt++)Zt.__webglFramebuffer[Yt]=i.createFramebuffer()}else if(Zt.__webglFramebuffer=i.createFramebuffer(),ri)if(s){Zt.__webglMultisampledFramebuffer=i.createFramebuffer(),Zt.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,Zt.__webglColorRenderbuffer);const Yt=m.convert(Ce.format),Zi=m.convert(Ce.type),qi=Ne(Ce.internalFormat,Yt,Zi),$i=hn($e);i.renderbufferStorageMultisample(36161,$i,qi,$e.width,$e.height),i.bindFramebuffer(36160,Zt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,Zt.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),$e.depthBuffer&&(Zt.__webglDepthRenderbuffer=i.createRenderbuffer(),Un(Zt.__webglDepthRenderbuffer,$e,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(rt){o.bindTexture(34067,Xt.__webglTexture),Pi(34067,Ce,gi);for(let Yt=0;Yt<6;Yt++)Dn(Zt.__webglFramebuffer[Yt],$e,36064,34069+Yt);it(Ce,gi)&&Ve(34067,Ce,$e.width,$e.height),o.bindTexture(34067,null)}else{let Yt=3553;wi&&(s?Yt=Ce.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),o.bindTexture(Yt,Xt.__webglTexture),Pi(Yt,Ce,gi),Dn(Zt.__webglFramebuffer,$e,36064,Yt),it(Ce,gi)&&Ve(3553,Ce,$e.width,$e.height),o.bindTexture(3553,null)}$e.depthBuffer&&mr($e)}function Li($e){const Ce=$e.texture,Zt=le($e)||s;if(it(Ce,Zt)){const Xt=$e.isWebGLCubeRenderTarget?34067:3553,rt=h.get(Ce).__webglTexture;o.bindTexture(Xt,rt),Ve(Xt,Ce,$e.width,$e.height),o.bindTexture(Xt,null)}}function Ei($e){if($e.isWebGLMultisampleRenderTarget)if(s){const Ce=h.get($e);i.bindFramebuffer(36008,Ce.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Ce.__webglFramebuffer);const Zt=$e.width,Xt=$e.height;let rt=16384;$e.depthBuffer&&(rt|=256),$e.stencilBuffer&&(rt|=1024),i.blitFramebuffer(0,0,Zt,Xt,0,0,Zt,Xt,rt,9728),i.bindFramebuffer(36160,Ce.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function hn($e){return s&&$e.isWebGLMultisampleRenderTarget?Math.min(O,$e.samples):0}function ei($e){const Ce=x.render.frame;V.get($e)!==Ce&&(V.set($e,Ce),$e.update())}let Wt=!1,ui=!1;function Vi($e,Ce){$e&&$e.isWebGLRenderTarget&&(Wt===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Wt=!0),$e=$e.texture),ht($e,Ce)}function zi($e,Ce){$e&&$e.isWebGLCubeRenderTarget&&(ui===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ui=!0),$e=$e.texture),Nt($e,Ce)}this.allocateTextureUnit=Qe,this.resetTextureUnits=Dt,this.setTexture2D=ht,this.setTexture2DArray=_t,this.setTexture3D=yt,this.setTextureCube=Nt,this.setupRenderTarget=zn,this.updateRenderTargetMipmap=Li,this.updateMultisampleRenderTarget=Ei,this.safeSetTexture2D=Vi,this.safeSetTextureCube=zi}function sU(i,e,o){const h=o.isWebGL2;function l(m){let x;if(m===Cw)return 5121;if(m===H4)return 32819;if(m===Z4)return 32820;if(m===W4)return 33635;if(m===V4)return 5120;if(m===j4)return 5122;if(m===F_)return 5123;if(m===G4)return 5124;if(m===S_)return 5125;if(m===Fc)return 5126;if(m===B_)return h?5131:(x=e.get("OES_texture_half_float"),x!==null?x.HALF_FLOAT_OES:null);if(m===q4)return 6406;if(m===$u)return 6407;if(m===Ja)return 6408;if(m===X4)return 6409;if(m===J4)return 6410;if(m===fd)return 6402;if(m===Op)return 34041;if(m===Y4)return 6403;if(m===K4)return 36244;if(m===Q4)return 33319;if(m===eN)return 33320;if(m===tN)return 36248;if(m===iN)return 36249;if(m===qT||m===XT||m===JT||m===YT)if(x=e.get("WEBGL_compressed_texture_s3tc"),x!==null){if(m===qT)return x.COMPRESSED_RGB_S3TC_DXT1_EXT;if(m===XT)return x.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(m===JT)return x.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(m===YT)return x.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(m===KT||m===QT||m===eE||m===tE)if(x=e.get("WEBGL_compressed_texture_pvrtc"),x!==null){if(m===KT)return x.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(m===QT)return x.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(m===eE)return x.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(m===tE)return x.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(m===nN)return x=e.get("WEBGL_compressed_texture_etc1"),x!==null?x.COMPRESSED_RGB_ETC1_WEBGL:null;if((m===iE||m===nE)&&(x=e.get("WEBGL_compressed_texture_etc"),x!==null)){if(m===iE)return x.COMPRESSED_RGB8_ETC2;if(m===nE)return x.COMPRESSED_RGBA8_ETC2_EAC}if(m===rN||m===oN||m===sN||m===aN||m===lN||m===cN||m===uN||m===hN||m===dN||m===fN||m===pN||m===mN||m===gN||m===_N||m===vN||m===xN||m===bN||m===wN||m===SN||m===TN||m===EN||m===IN||m===MN||m===AN||m===PN||m===zN||m===CN||m===RN)return x=e.get("WEBGL_compressed_texture_astc"),x!==null?m:null;if(m===yN)return x=e.get("EXT_texture_compression_bptc"),x!==null?m:null;if(m===Tp)return h?34042:(x=e.get("WEBGL_depth_texture"),x!==null?x.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:l}}function vb(i=[]){zs.call(this),this.cameras=i}vb.prototype=Object.assign(Object.create(zs.prototype),{constructor:vb,isArrayCamera:!0});class hd extends Rn{constructor(){super(),this.type="Group"}}hd.prototype.isGroup=!0;function T_(){this._targetRay=null,this._grip=null,this._hand=null}Object.assign(T_.prototype,{constructor:T_,getHandSpace:function(){return this._hand===null&&(this._hand=new hd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new hd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new hd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this},disconnect:function(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this},update:function(i,e,o){let h=null,l=null,m=null;const x=this._targetRay,s=this._grip,P=this._hand;if(i&&e.session.visibilityState!=="visible-blurred")if(P&&i.hand){m=!0;for(const ee of i.hand.values()){const se=e.getJointPose(ee,o);if(P.joints[ee.jointName]===void 0){const le=new hd;le.matrixAutoUpdate=!1,le.visible=!1,P.joints[ee.jointName]=le,P.add(le)}const fe=P.joints[ee.jointName];se!==null&&(fe.matrix.fromArray(se.transform.matrix),fe.matrix.decompose(fe.position,fe.rotation,fe.scale),fe.jointRadius=se.radius),fe.visible=se!==null}const C=P.joints["index-finger-tip"],F=P.joints["thumb-tip"],O=C.position.distanceTo(F.position),V=.02,J=.005;P.inputState.pinching&&O>V+J?(P.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!P.inputState.pinching&&O<=V-J&&(P.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else x!==null&&(h=e.getPose(i.targetRaySpace,o),h!==null&&(x.matrix.fromArray(h.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale))),s!==null&&i.gripSpace&&(l=e.getPose(i.gripSpace,o),l!==null&&(s.matrix.fromArray(l.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale)));return x!==null&&(x.visible=h!==null),s!==null&&(s.visible=l!==null),P!==null&&(P.visible=m!==null),this}});function aU(i,e){const o=this;let h=null,l=1,m=null,x="local-floor",s=null;const P=[],C=new Map,F=new zs;F.layers.enable(1),F.viewport=new zr;const O=new zs;O.layers.enable(2),O.viewport=new zr;const V=[F,O],J=new vb;J.layers.enable(1),J.layers.enable(2);let ee=null,se=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(St){let Et=P[St];return Et===void 0&&(Et=new T_,P[St]=Et),Et.getTargetRaySpace()},this.getControllerGrip=function(St){let Et=P[St];return Et===void 0&&(Et=new T_,P[St]=Et),Et.getGripSpace()},this.getHand=function(St){let Et=P[St];return Et===void 0&&(Et=new T_,P[St]=Et),Et.getHandSpace()};function fe(St){const Et=C.get(St.inputSource);Et&&Et.dispatchEvent({type:St.type,data:St.inputSource})}function le(){C.forEach(function(St,Et){St.disconnect(Et)}),C.clear(),ee=null,se=null,i.setFramebuffer(null),i.setRenderTarget(i.getRenderTarget()),pt.stop(),o.isPresenting=!1,o.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(St){l=St,o.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(St){x=St,o.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return m},this.getSession=function(){return h},this.setSession=async function(St){if(h=St,h!==null){h.addEventListener("select",fe),h.addEventListener("selectstart",fe),h.addEventListener("selectend",fe),h.addEventListener("squeeze",fe),h.addEventListener("squeezestart",fe),h.addEventListener("squeezeend",fe),h.addEventListener("end",le),h.addEventListener("inputsourceschange",ie);const Et=e.getContextAttributes();Et.xrCompatible!==!0&&await e.makeXRCompatible();const Dt={antialias:Et.antialias,alpha:Et.alpha,depth:Et.depth,stencil:Et.stencil,framebufferScaleFactor:l},Qe=new XRWebGLLayer(h,e,Dt);h.updateRenderState({baseLayer:Qe}),m=await h.requestReferenceSpace(x),pt.setContext(h),pt.start(),o.isPresenting=!0,o.dispatchEvent({type:"sessionstart"})}};function ie(St){const Et=h.inputSources;for(let Dt=0;Dt<P.length;Dt++)C.set(Et[Dt],P[Dt]);for(let Dt=0;Dt<St.removed.length;Dt++){const Qe=St.removed[Dt],ht=C.get(Qe);ht&&(ht.dispatchEvent({type:"disconnected",data:Qe}),C.delete(Qe))}for(let Dt=0;Dt<St.added.length;Dt++){const Qe=St.added[Dt],ht=C.get(Qe);ht&&ht.dispatchEvent({type:"connected",data:Qe})}}const it=new He,Ve=new He;function Ne(St,Et,Dt){it.setFromMatrixPosition(Et.matrixWorld),Ve.setFromMatrixPosition(Dt.matrixWorld);const Qe=it.distanceTo(Ve),ht=Et.projectionMatrix.elements,_t=Dt.projectionMatrix.elements,yt=ht[14]/(ht[10]-1),Nt=ht[14]/(ht[10]+1),Qt=(ht[9]+1)/ht[5],pi=(ht[9]-1)/ht[5],Pi=(ht[8]-1)/ht[0],Mi=(_t[8]+1)/_t[0],fn=yt*Pi,bi=yt*Mi,Dn=Qe/(-Pi+Mi),Un=Dn*-Pi;Et.matrixWorld.decompose(St.position,St.quaternion,St.scale),St.translateX(Un),St.translateZ(Dn),St.matrixWorld.compose(St.position,St.quaternion,St.scale),St.matrixWorldInverse.copy(St.matrixWorld).invert();const Ht=yt+Dn,mr=Nt+Dn,zn=fn-Un,Li=bi+(Qe-Un),Ei=Qt*Nt/mr*Ht,hn=pi*Nt/mr*Ht;St.projectionMatrix.makePerspective(zn,Li,Ei,hn,Ht,mr)}function Re(St,Et){Et===null?St.matrixWorld.copy(St.matrix):St.matrixWorld.multiplyMatrices(Et.matrixWorld,St.matrix),St.matrixWorldInverse.copy(St.matrixWorld).invert()}this.getCamera=function(St){J.near=O.near=F.near=St.near,J.far=O.far=F.far=St.far,(ee!==J.near||se!==J.far)&&(h.updateRenderState({depthNear:J.near,depthFar:J.far}),ee=J.near,se=J.far);const Et=St.parent,Dt=J.cameras;Re(J,Et);for(let ht=0;ht<Dt.length;ht++)Re(Dt[ht],Et);St.matrixWorld.copy(J.matrixWorld),St.matrix.copy(J.matrix),St.matrix.decompose(St.position,St.quaternion,St.scale);const Qe=St.children;for(let ht=0,_t=Qe.length;ht<_t;ht++)Qe[ht].updateMatrixWorld(!0);return Dt.length===2?Ne(J,F,O):J.projectionMatrix.copy(F.projectionMatrix),J};let Ye=null;function zt(St,Et){if(s=Et.getViewerPose(m),s!==null){const Qe=s.views,ht=h.renderState.baseLayer;i.setFramebuffer(ht.framebuffer);let _t=!1;Qe.length!==J.cameras.length&&(J.cameras.length=0,_t=!0);for(let yt=0;yt<Qe.length;yt++){const Nt=Qe[yt],Qt=ht.getViewport(Nt),pi=V[yt];pi.matrix.fromArray(Nt.transform.matrix),pi.projectionMatrix.fromArray(Nt.projectionMatrix),pi.viewport.set(Qt.x,Qt.y,Qt.width,Qt.height),yt===0&&J.matrix.copy(pi.matrix),_t===!0&&J.cameras.push(pi)}}const Dt=h.inputSources;for(let Qe=0;Qe<P.length;Qe++){const ht=P[Qe],_t=Dt[Qe];ht.update(_t,Et,m)}Ye&&Ye(St,Et)}const pt=new YN;pt.setAnimationLoop(zt),this.setAnimationLoop=function(St){Ye=St},this.dispose=function(){}}Object.assign(aU.prototype,Gc.prototype);function $ee(i){function e(le,ie){le.fogColor.value.copy(ie.color),ie.isFog?(le.fogNear.value=ie.near,le.fogFar.value=ie.far):ie.isFogExp2&&(le.fogDensity.value=ie.density)}function o(le,ie,it,Ve){ie.isMeshBasicMaterial?h(le,ie):ie.isMeshLambertMaterial?(h(le,ie),P(le,ie)):ie.isMeshToonMaterial?(h(le,ie),F(le,ie)):ie.isMeshPhongMaterial?(h(le,ie),C(le,ie)):ie.isMeshStandardMaterial?(h(le,ie),ie.isMeshPhysicalMaterial?V(le,ie):O(le,ie)):ie.isMeshMatcapMaterial?(h(le,ie),J(le,ie)):ie.isMeshDepthMaterial?(h(le,ie),ee(le,ie)):ie.isMeshDistanceMaterial?(h(le,ie),se(le,ie)):ie.isMeshNormalMaterial?(h(le,ie),fe(le,ie)):ie.isLineBasicMaterial?(l(le,ie),ie.isLineDashedMaterial&&m(le,ie)):ie.isPointsMaterial?x(le,ie,it,Ve):ie.isSpriteMaterial?s(le,ie):ie.isShadowMaterial?(le.color.value.copy(ie.color),le.opacity.value=ie.opacity):ie.isShaderMaterial&&(ie.uniformsNeedUpdate=!1)}function h(le,ie){le.opacity.value=ie.opacity,ie.color&&le.diffuse.value.copy(ie.color),ie.emissive&&le.emissive.value.copy(ie.emissive).multiplyScalar(ie.emissiveIntensity),ie.map&&(le.map.value=ie.map),ie.alphaMap&&(le.alphaMap.value=ie.alphaMap),ie.specularMap&&(le.specularMap.value=ie.specularMap);const it=i.get(ie).envMap;if(it){le.envMap.value=it,le.flipEnvMap.value=it.isCubeTexture&&it._needsFlipEnvMap?-1:1,le.reflectivity.value=ie.reflectivity,le.refractionRatio.value=ie.refractionRatio;const Re=i.get(it).__maxMipLevel;Re!==void 0&&(le.maxMipLevel.value=Re)}ie.lightMap&&(le.lightMap.value=ie.lightMap,le.lightMapIntensity.value=ie.lightMapIntensity),ie.aoMap&&(le.aoMap.value=ie.aoMap,le.aoMapIntensity.value=ie.aoMapIntensity);let Ve;ie.map?Ve=ie.map:ie.specularMap?Ve=ie.specularMap:ie.displacementMap?Ve=ie.displacementMap:ie.normalMap?Ve=ie.normalMap:ie.bumpMap?Ve=ie.bumpMap:ie.roughnessMap?Ve=ie.roughnessMap:ie.metalnessMap?Ve=ie.metalnessMap:ie.alphaMap?Ve=ie.alphaMap:ie.emissiveMap?Ve=ie.emissiveMap:ie.clearcoatMap?Ve=ie.clearcoatMap:ie.clearcoatNormalMap?Ve=ie.clearcoatNormalMap:ie.clearcoatRoughnessMap&&(Ve=ie.clearcoatRoughnessMap),Ve!==void 0&&(Ve.isWebGLRenderTarget&&(Ve=Ve.texture),Ve.matrixAutoUpdate===!0&&Ve.updateMatrix(),le.uvTransform.value.copy(Ve.matrix));let Ne;ie.aoMap?Ne=ie.aoMap:ie.lightMap&&(Ne=ie.lightMap),Ne!==void 0&&(Ne.isWebGLRenderTarget&&(Ne=Ne.texture),Ne.matrixAutoUpdate===!0&&Ne.updateMatrix(),le.uv2Transform.value.copy(Ne.matrix))}function l(le,ie){le.diffuse.value.copy(ie.color),le.opacity.value=ie.opacity}function m(le,ie){le.dashSize.value=ie.dashSize,le.totalSize.value=ie.dashSize+ie.gapSize,le.scale.value=ie.scale}function x(le,ie,it,Ve){le.diffuse.value.copy(ie.color),le.opacity.value=ie.opacity,le.size.value=ie.size*it,le.scale.value=Ve*.5,ie.map&&(le.map.value=ie.map),ie.alphaMap&&(le.alphaMap.value=ie.alphaMap);let Ne;ie.map?Ne=ie.map:ie.alphaMap&&(Ne=ie.alphaMap),Ne!==void 0&&(Ne.matrixAutoUpdate===!0&&Ne.updateMatrix(),le.uvTransform.value.copy(Ne.matrix))}function s(le,ie){le.diffuse.value.copy(ie.color),le.opacity.value=ie.opacity,le.rotation.value=ie.rotation,ie.map&&(le.map.value=ie.map),ie.alphaMap&&(le.alphaMap.value=ie.alphaMap);let it;ie.map?it=ie.map:ie.alphaMap&&(it=ie.alphaMap),it!==void 0&&(it.matrixAutoUpdate===!0&&it.updateMatrix(),le.uvTransform.value.copy(it.matrix))}function P(le,ie){ie.emissiveMap&&(le.emissiveMap.value=ie.emissiveMap)}function C(le,ie){le.specular.value.copy(ie.specular),le.shininess.value=Math.max(ie.shininess,1e-4),ie.emissiveMap&&(le.emissiveMap.value=ie.emissiveMap),ie.bumpMap&&(le.bumpMap.value=ie.bumpMap,le.bumpScale.value=ie.bumpScale,ie.side===Bo&&(le.bumpScale.value*=-1)),ie.normalMap&&(le.normalMap.value=ie.normalMap,le.normalScale.value.copy(ie.normalScale),ie.side===Bo&&le.normalScale.value.negate()),ie.displacementMap&&(le.displacementMap.value=ie.displacementMap,le.displacementScale.value=ie.displacementScale,le.displacementBias.value=ie.displacementBias)}function F(le,ie){ie.gradientMap&&(le.gradientMap.value=ie.gradientMap),ie.emissiveMap&&(le.emissiveMap.value=ie.emissiveMap),ie.bumpMap&&(le.bumpMap.value=ie.bumpMap,le.bumpScale.value=ie.bumpScale,ie.side===Bo&&(le.bumpScale.value*=-1)),ie.normalMap&&(le.normalMap.value=ie.normalMap,le.normalScale.value.copy(ie.normalScale),ie.side===Bo&&le.normalScale.value.negate()),ie.displacementMap&&(le.displacementMap.value=ie.displacementMap,le.displacementScale.value=ie.displacementScale,le.displacementBias.value=ie.displacementBias)}function O(le,ie){le.roughness.value=ie.roughness,le.metalness.value=ie.metalness,ie.roughnessMap&&(le.roughnessMap.value=ie.roughnessMap),ie.metalnessMap&&(le.metalnessMap.value=ie.metalnessMap),ie.emissiveMap&&(le.emissiveMap.value=ie.emissiveMap),ie.bumpMap&&(le.bumpMap.value=ie.bumpMap,le.bumpScale.value=ie.bumpScale,ie.side===Bo&&(le.bumpScale.value*=-1)),ie.normalMap&&(le.normalMap.value=ie.normalMap,le.normalScale.value.copy(ie.normalScale),ie.side===Bo&&le.normalScale.value.negate()),ie.displacementMap&&(le.displacementMap.value=ie.displacementMap,le.displacementScale.value=ie.displacementScale,le.displacementBias.value=ie.displacementBias),i.get(ie).envMap&&(le.envMapIntensity.value=ie.envMapIntensity)}function V(le,ie){O(le,ie),le.reflectivity.value=ie.reflectivity,le.clearcoat.value=ie.clearcoat,le.clearcoatRoughness.value=ie.clearcoatRoughness,ie.sheen&&le.sheen.value.copy(ie.sheen),ie.clearcoatMap&&(le.clearcoatMap.value=ie.clearcoatMap),ie.clearcoatRoughnessMap&&(le.clearcoatRoughnessMap.value=ie.clearcoatRoughnessMap),ie.clearcoatNormalMap&&(le.clearcoatNormalScale.value.copy(ie.clearcoatNormalScale),le.clearcoatNormalMap.value=ie.clearcoatNormalMap,ie.side===Bo&&le.clearcoatNormalScale.value.negate()),le.transmission.value=ie.transmission,ie.transmissionMap&&(le.transmissionMap.value=ie.transmissionMap)}function J(le,ie){ie.matcap&&(le.matcap.value=ie.matcap),ie.bumpMap&&(le.bumpMap.value=ie.bumpMap,le.bumpScale.value=ie.bumpScale,ie.side===Bo&&(le.bumpScale.value*=-1)),ie.normalMap&&(le.normalMap.value=ie.normalMap,le.normalScale.value.copy(ie.normalScale),ie.side===Bo&&le.normalScale.value.negate()),ie.displacementMap&&(le.displacementMap.value=ie.displacementMap,le.displacementScale.value=ie.displacementScale,le.displacementBias.value=ie.displacementBias)}function ee(le,ie){ie.displacementMap&&(le.displacementMap.value=ie.displacementMap,le.displacementScale.value=ie.displacementScale,le.displacementBias.value=ie.displacementBias)}function se(le,ie){ie.displacementMap&&(le.displacementMap.value=ie.displacementMap,le.displacementScale.value=ie.displacementScale,le.displacementBias.value=ie.displacementBias),le.referencePosition.value.copy(ie.referencePosition),le.nearDistance.value=ie.nearDistance,le.farDistance.value=ie.farDistance}function fe(le,ie){ie.bumpMap&&(le.bumpMap.value=ie.bumpMap,le.bumpScale.value=ie.bumpScale,ie.side===Bo&&(le.bumpScale.value*=-1)),ie.normalMap&&(le.normalMap.value=ie.normalMap,le.normalScale.value.copy(ie.normalScale),ie.side===Bo&&le.normalScale.value.negate()),ie.displacementMap&&(le.displacementMap.value=ie.displacementMap,le.displacementScale.value=ie.displacementScale,le.displacementBias.value=ie.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:o}}function Vee(){const i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.style.display="block",i}function Cr(i){i=i||{};const e=i.canvas!==void 0?i.canvas:Vee(),o=i.context!==void 0?i.context:null,h=i.alpha!==void 0?i.alpha:!1,l=i.depth!==void 0?i.depth:!0,m=i.stencil!==void 0?i.stencil:!0,x=i.antialias!==void 0?i.antialias:!1,s=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,P=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,C=i.powerPreference!==void 0?i.powerPreference:"default",F=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let O=null,V=null;const J=[],ee=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=qp,this.physicallyCorrectLights=!1,this.toneMapping=Sp,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const se=this;let fe=!1,le=null,ie=0,it=0,Ve=null,Ne=null,Re=-1,Ye=null;const zt=new zr,pt=new zr;let St=null,Et=e.width,Dt=e.height,Qe=1,ht=null,_t=null;const yt=new zr(0,0,Et,Dt),Nt=new zr(0,0,Et,Dt);let Qt=!1;const pi=new Fy;let Pi=!1,Mi=!1;const fn=new tn,bi=new He,Dn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Un(){return Ve===null?Qe:1}let Ht=o;function mr(De,Rt){for(let Ae=0;Ae<De.length;Ae++){const Ot=De[Ae],_i=e.getContext(Ot,Rt);if(_i!==null)return _i}return null}try{const De={alpha:h,depth:l,stencil:m,antialias:x,premultipliedAlpha:s,preserveDrawingBuffer:P,powerPreference:C,failIfMajorPerformanceCaveat:F};if(e.addEventListener("webglcontextlost",Er,!1),e.addEventListener("webglcontextrestored",Cl,!1),Ht===null){const Rt=["webgl2","webgl","experimental-webgl"];if(se.isWebGL1Renderer===!0&&Rt.shift(),Ht=mr(Rt,De),Ht===null)throw mr(Rt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ht.getShaderPrecisionFormat===void 0&&(Ht.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(De){throw console.error("THREE.WebGLRenderer: "+De.message),De}let zn,Li,Ei,hn,ei,Wt,ui,Vi,zi,$e,Ce,Zt,Xt,rt,ri,wi,gi,Yt,Zi,qi,$i;function Xi(){zn=new xQ(Ht),Li=new _Q(Ht,zn,i),zn.init(Li),qi=new sU(Ht,zn,Li),Ei=new Nee(Ht,zn,Li),Ei.scissor(pt.copy(Nt).multiplyScalar(Qe).floor()),Ei.viewport(zt.copy(yt).multiplyScalar(Qe).floor()),hn=new SQ,ei=new Mee,Wt=new Uee(Ht,zn,Ei,ei,Li,qi,hn),ui=new vQ(se),Vi=new ZJ(Ht,Li),$i=new mQ(Ht,zn,Vi,Li),zi=new bQ(Ht,Vi,hn,$i),$e=new MQ(Ht,zi,Vi,hn),gi=new IQ(Ht),ri=new yQ(ei),Ce=new Iee(se,ui,zn,Li,$i,ri),Zt=new $ee(ei),Xt=new zee(ei),rt=new Oee(zn,Li),wi=new pQ(se,ui,Ei,$e,s),Yt=new gQ(Ht,zn,hn,Li),Zi=new wQ(Ht,zn,hn,Li),hn.programs=Ce.programs,se.capabilities=Li,se.extensions=zn,se.properties=ei,se.renderLists=Xt,se.state=Ei,se.info=hn}Xi();const Di=new aU(se,Ht);this.xr=Di;const gr=new oU(se,$e,Li.maxTextureSize);this.shadowMap=gr,this.getContext=function(){return Ht},this.getContextAttributes=function(){return Ht.getContextAttributes()},this.forceContextLoss=function(){const De=zn.get("WEBGL_lose_context");De&&De.loseContext()},this.forceContextRestore=function(){const De=zn.get("WEBGL_lose_context");De&&De.restoreContext()},this.getPixelRatio=function(){return Qe},this.setPixelRatio=function(De){De!==void 0&&(Qe=De,this.setSize(Et,Dt,!1))},this.getSize=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),De=new mi),De.set(Et,Dt)},this.setSize=function(De,Rt,Ae){if(Di.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Et=De,Dt=Rt,e.width=Math.floor(De*Qe),e.height=Math.floor(Rt*Qe),Ae!==!1&&(e.style.width=De+"px",e.style.height=Rt+"px"),this.setViewport(0,0,De,Rt)},this.getDrawingBufferSize=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),De=new mi),De.set(Et*Qe,Dt*Qe).floor()},this.setDrawingBufferSize=function(De,Rt,Ae){Et=De,Dt=Rt,Qe=Ae,e.width=Math.floor(De*Ae),e.height=Math.floor(Rt*Ae),this.setViewport(0,0,De,Rt)},this.getCurrentViewport=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),De=new zr),De.copy(zt)},this.getViewport=function(De){return De.copy(yt)},this.setViewport=function(De,Rt,Ae,Ot){De.isVector4?yt.set(De.x,De.y,De.z,De.w):yt.set(De,Rt,Ae,Ot),Ei.viewport(zt.copy(yt).multiplyScalar(Qe).floor())},this.getScissor=function(De){return De.copy(Nt)},this.setScissor=function(De,Rt,Ae,Ot){De.isVector4?Nt.set(De.x,De.y,De.z,De.w):Nt.set(De,Rt,Ae,Ot),Ei.scissor(pt.copy(Nt).multiplyScalar(Qe).floor())},this.getScissorTest=function(){return Qt},this.setScissorTest=function(De){Ei.setScissorTest(Qt=De)},this.setOpaqueSort=function(De){ht=De},this.setTransparentSort=function(De){_t=De},this.getClearColor=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),De=new dn),De.copy(wi.getClearColor())},this.setClearColor=function(){wi.setClearColor.apply(wi,arguments)},this.getClearAlpha=function(){return wi.getClearAlpha()},this.setClearAlpha=function(){wi.setClearAlpha.apply(wi,arguments)},this.clear=function(De,Rt,Ae){let Ot=0;(De===void 0||De)&&(Ot|=16384),(Rt===void 0||Rt)&&(Ot|=256),(Ae===void 0||Ae)&&(Ot|=1024),Ht.clear(Ot)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Er,!1),e.removeEventListener("webglcontextrestored",Cl,!1),Xt.dispose(),rt.dispose(),ei.dispose(),ui.dispose(),$e.dispose(),$i.dispose(),Di.dispose(),gs.stop()};function Er(De){De.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),fe=!0}function Cl(){console.log("THREE.WebGLRenderer: Context Restored."),fe=!1,Xi()}function Ks(De){const Rt=De.target;Rt.removeEventListener("dispose",Ks),mo(Rt)}function mo(De){Qs(De),ei.remove(De)}function Qs(De){const Rt=ei.get(De).program;Rt!==void 0&&Ce.releaseProgram(Rt)}function ha(De,Rt){De.render(function(Ae){se.renderBufferImmediate(Ae,Rt)})}this.renderBufferImmediate=function(De,Rt){$i.initAttributes();const Ae=ei.get(De);De.hasPositions&&!Ae.position&&(Ae.position=Ht.createBuffer()),De.hasNormals&&!Ae.normal&&(Ae.normal=Ht.createBuffer()),De.hasUvs&&!Ae.uv&&(Ae.uv=Ht.createBuffer()),De.hasColors&&!Ae.color&&(Ae.color=Ht.createBuffer());const Ot=Rt.getAttributes();De.hasPositions&&(Ht.bindBuffer(34962,Ae.position),Ht.bufferData(34962,De.positionArray,35048),$i.enableAttribute(Ot.position),Ht.vertexAttribPointer(Ot.position,3,5126,!1,0,0)),De.hasNormals&&(Ht.bindBuffer(34962,Ae.normal),Ht.bufferData(34962,De.normalArray,35048),$i.enableAttribute(Ot.normal),Ht.vertexAttribPointer(Ot.normal,3,5126,!1,0,0)),De.hasUvs&&(Ht.bindBuffer(34962,Ae.uv),Ht.bufferData(34962,De.uvArray,35048),$i.enableAttribute(Ot.uv),Ht.vertexAttribPointer(Ot.uv,2,5126,!1,0,0)),De.hasColors&&(Ht.bindBuffer(34962,Ae.color),Ht.bufferData(34962,De.colorArray,35048),$i.enableAttribute(Ot.color),Ht.vertexAttribPointer(Ot.color,3,5126,!1,0,0)),$i.disableUnusedAttributes(),Ht.drawArrays(4,0,De.count),De.count=0},this.renderBufferDirect=function(De,Rt,Ae,Ot,_i,Cn){Rt===null&&(Rt=Dn);const ti=_i.isMesh&&_i.matrixWorld.determinant()<0,Ee=lc(De,Rt,Ot,_i);Ei.setMaterial(Ot,ti);let Z=Ae.index;const Q=Ae.attributes.position;if(Z===null){if(Q===void 0||Q.count===0)return}else if(Z.count===0)return;let ce=1;Ot.wireframe===!0&&(Z=zi.getWireframeAttribute(Ae),ce=2),(Ot.morphTargets||Ot.morphNormals)&&gi.update(_i,Ae,Ot,Ee),$i.setup(_i,Ot,Ee,Ae,Z);let xe,de=Yt;Z!==null&&(xe=Vi.get(Z),de=Zi,de.setIndex(xe));const Me=Z!==null?Z.count:Q.count,Oe=Ae.drawRange.start*ce,Pe=Ae.drawRange.count*ce,Be=Cn!==null?Cn.start*ce:0,gt=Cn!==null?Cn.count*ce:1/0,st=Math.max(Oe,Be),Ft=Math.min(Me,Oe+Pe,Be+gt)-1,ni=Math.max(0,Ft-st+1);if(ni!==0){if(_i.isMesh)Ot.wireframe===!0?(Ei.setLineWidth(Ot.wireframeLinewidth*Un()),de.setMode(1)):de.setMode(4);else if(_i.isLine){let li=Ot.linewidth;li===void 0&&(li=1),Ei.setLineWidth(li*Un()),_i.isLineSegments?de.setMode(1):_i.isLineLoop?de.setMode(2):de.setMode(3)}else _i.isPoints?de.setMode(0):_i.isSprite&&de.setMode(4);if(_i.isInstancedMesh)de.renderInstances(st,ni,_i.count);else if(Ae.isInstancedBufferGeometry){const li=Math.min(Ae.instanceCount,Ae._maxInstanceCount);de.renderInstances(st,ni,li)}else de.render(st,ni)}},this.compile=function(De,Rt){V=rt.get(De),V.init(),De.traverseVisible(function(Ot){Ot.isLight&&Ot.layers.test(Rt.layers)&&(V.pushLight(Ot),Ot.castShadow&&V.pushShadow(Ot))}),V.setupLights();const Ae=new WeakMap;De.traverse(function(Ot){const _i=Ot.material;if(_i)if(Array.isArray(_i))for(let Cn=0;Cn<_i.length;Cn++){const ti=_i[Cn];Ae.has(ti)===!1&&(yr(ti,De,Ot),Ae.set(ti))}else Ae.has(_i)===!1&&(yr(_i,De,Ot),Ae.set(_i))})};let ea=null;function da(De){Di.isPresenting||ea&&ea(De)}const gs=new YN;gs.setAnimationLoop(da),typeof window<"u"&&gs.setContext(window),this.setAnimationLoop=function(De){ea=De,Di.setAnimationLoop(De),De===null?gs.stop():gs.start()},this.render=function(De,Rt){let Ae,Ot;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Ae=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),Ot=arguments[3]),Rt!==void 0&&Rt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(fe===!0)return;$i.resetDefaultState(),Re=-1,Ye=null,De.autoUpdate===!0&&De.updateMatrixWorld(),Rt.parent===null&&Rt.updateMatrixWorld(),Di.enabled===!0&&Di.isPresenting===!0&&(Rt=Di.getCamera(Rt)),De.isScene===!0&&De.onBeforeRender(se,De,Rt,Ae||Ve),V=rt.get(De,ee.length),V.init(),ee.push(V),fn.multiplyMatrices(Rt.projectionMatrix,Rt.matrixWorldInverse),pi.setFromProjectionMatrix(fn),Mi=this.localClippingEnabled,Pi=ri.init(this.clippingPlanes,Mi,Rt),O=Xt.get(De,J.length),O.init(),J.push(O),fa(De,Rt,0,se.sortObjects),O.finish(),se.sortObjects===!0&&O.sort(ht,_t),Pi===!0&&ri.beginShadows();const _i=V.state.shadowsArray;gr.render(_i,De,Rt),V.setupLights(),V.setupLightsView(Rt),Pi===!0&&ri.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ae!==void 0&&this.setRenderTarget(Ae),wi.render(O,De,Rt,Ot);const Cn=O.opaque,ti=O.transparent;Cn.length>0&&nl(Cn,De,Rt),ti.length>0&&nl(ti,De,Rt),De.isScene===!0&&De.onAfterRender(se,De,Rt),Ve!==null&&(Wt.updateRenderTargetMipmap(Ve),Wt.updateMultisampleRenderTarget(Ve)),Ei.buffers.depth.setTest(!0),Ei.buffers.depth.setMask(!0),Ei.buffers.color.setMask(!0),Ei.setPolygonOffset(!1),ee.pop(),ee.length>0?V=ee[ee.length-1]:V=null,J.pop(),J.length>0?O=J[J.length-1]:O=null};function fa(De,Rt,Ae,Ot){if(De.visible===!1)return;if(De.layers.test(Rt.layers)){if(De.isGroup)Ae=De.renderOrder;else if(De.isLOD)De.autoUpdate===!0&&De.update(Rt);else if(De.isLight)V.pushLight(De),De.castShadow&&V.pushShadow(De);else if(De.isSprite){if(!De.frustumCulled||pi.intersectsSprite(De)){Ot&&bi.setFromMatrixPosition(De.matrixWorld).applyMatrix4(fn);const ti=$e.update(De),Ee=De.material;Ee.visible&&O.push(De,ti,Ee,Ae,bi.z,null)}}else if(De.isImmediateRenderObject)Ot&&bi.setFromMatrixPosition(De.matrixWorld).applyMatrix4(fn),O.push(De,null,De.material,Ae,bi.z,null);else if((De.isMesh||De.isLine||De.isPoints)&&(De.isSkinnedMesh&&De.skeleton.frame!==hn.render.frame&&(De.skeleton.update(),De.skeleton.frame=hn.render.frame),!De.frustumCulled||pi.intersectsObject(De))){Ot&&bi.setFromMatrixPosition(De.matrixWorld).applyMatrix4(fn);const ti=$e.update(De),Ee=De.material;if(Array.isArray(Ee)){const Z=ti.groups;for(let Q=0,ce=Z.length;Q<ce;Q++){const xe=Z[Q],de=Ee[xe.materialIndex];de&&de.visible&&O.push(De,ti,de,Ae,bi.z,xe)}}else Ee.visible&&O.push(De,ti,Ee,Ae,bi.z,null)}}const Cn=De.children;for(let ti=0,Ee=Cn.length;ti<Ee;ti++)fa(Cn[ti],Rt,Ae,Ot)}function nl(De,Rt,Ae){const Ot=Rt.isScene===!0?Rt.overrideMaterial:null;for(let _i=0,Cn=De.length;_i<Cn;_i++){const ti=De[_i],Ee=ti.object,Z=ti.geometry,Q=Ot===null?ti.material:Ot,ce=ti.group;if(Ae.isArrayCamera){const xe=Ae.cameras;for(let de=0,Me=xe.length;de<Me;de++){const Oe=xe[de];Ee.layers.test(Oe.layers)&&(Ei.viewport(zt.copy(Oe.viewport)),V.setupLightsView(Oe),$n(Ee,Rt,Oe,Z,Q,ce))}}else $n(Ee,Rt,Ae,Z,Q,ce)}}function $n(De,Rt,Ae,Ot,_i,Cn){if(De.onBeforeRender(se,Rt,Ae,Ot,_i,Cn),De.modelViewMatrix.multiplyMatrices(Ae.matrixWorldInverse,De.matrixWorld),De.normalMatrix.getNormalMatrix(De.modelViewMatrix),De.isImmediateRenderObject){const ti=lc(Ae,Rt,_i,De);Ei.setMaterial(_i),$i.reset(),ha(De,ti)}else se.renderBufferDirect(Ae,Rt,Ot,_i,De,Cn);De.onAfterRender(se,Rt,Ae,Ot,_i,Cn)}function yr(De,Rt,Ae){Rt.isScene!==!0&&(Rt=Dn);const Ot=ei.get(De),_i=V.state.lights,Cn=V.state.shadowsArray,ti=_i.state.version,Ee=Ce.getParameters(De,_i.state,Cn,Rt,Ae),Z=Ce.getProgramCacheKey(Ee);let Q=Ot.program,ce=!0;if(Ot.environment=De.isMeshStandardMaterial?Rt.environment:null,Ot.fog=Rt.fog,Ot.envMap=ui.get(De.envMap||Ot.environment),Q===void 0)De.addEventListener("dispose",Ks);else if(Q.cacheKey!==Z)Qs(De);else if(Ot.lightsStateVersion!==ti)ce=!1;else{if(Ee.shaderID!==void 0)return;ce=!1}ce&&(Ee.uniforms=Ce.getUniforms(De),De.onBeforeCompile(Ee,se),Q=Ce.acquireProgram(Ee,Z),Ot.program=Q,Ot.uniforms=Ee.uniforms,Ot.outputEncoding=Ee.outputEncoding);const xe=Ot.uniforms;(!De.isShaderMaterial&&!De.isRawShaderMaterial||De.clipping===!0)&&(Ot.numClippingPlanes=ri.numPlanes,Ot.numIntersection=ri.numIntersection,xe.clippingPlanes=ri.uniform),Ot.needsLights=ts(De),Ot.lightsStateVersion=ti,Ot.needsLights&&(xe.ambientLightColor.value=_i.state.ambient,xe.lightProbe.value=_i.state.probe,xe.directionalLights.value=_i.state.directional,xe.directionalLightShadows.value=_i.state.directionalShadow,xe.spotLights.value=_i.state.spot,xe.spotLightShadows.value=_i.state.spotShadow,xe.rectAreaLights.value=_i.state.rectArea,xe.ltc_1.value=_i.state.rectAreaLTC1,xe.ltc_2.value=_i.state.rectAreaLTC2,xe.pointLights.value=_i.state.point,xe.pointLightShadows.value=_i.state.pointShadow,xe.hemisphereLights.value=_i.state.hemi,xe.directionalShadowMap.value=_i.state.directionalShadowMap,xe.directionalShadowMatrix.value=_i.state.directionalShadowMatrix,xe.spotShadowMap.value=_i.state.spotShadowMap,xe.spotShadowMatrix.value=_i.state.spotShadowMatrix,xe.pointShadowMap.value=_i.state.pointShadowMap,xe.pointShadowMatrix.value=_i.state.pointShadowMatrix);const de=Ot.program.getUniforms(),Me=ju.seqWithValue(de.seq,xe);Ot.uniformsList=Me}function lc(De,Rt,Ae,Ot){Rt.isScene!==!0&&(Rt=Dn),Wt.resetTextureUnits();const _i=Rt.fog,Cn=Ae.isMeshStandardMaterial?Rt.environment:null,ti=Ve===null?se.outputEncoding:Ve.texture.encoding,Ee=ui.get(Ae.envMap||Cn),Z=ei.get(Ae),Q=V.state.lights;if(Pi===!0&&(Mi===!0||De!==Ye)){const Be=De===Ye&&Ae.id===Re;ri.setState(Ae,De,Be)}Ae.version===Z.__version?(Ae.fog&&Z.fog!==_i||Z.environment!==Cn||Z.needsLights&&Z.lightsStateVersion!==Q.state.version||Z.numClippingPlanes!==void 0&&(Z.numClippingPlanes!==ri.numPlanes||Z.numIntersection!==ri.numIntersection)||Z.outputEncoding!==ti||Z.envMap!==Ee)&&yr(Ae,Rt,Ot):(yr(Ae,Rt,Ot),Z.__version=Ae.version);let ce=!1,xe=!1,de=!1;const Me=Z.program,Oe=Me.getUniforms(),Pe=Z.uniforms;if(Ei.useProgram(Me.program)&&(ce=!0,xe=!0,de=!0),Ae.id!==Re&&(Re=Ae.id,xe=!0),ce||Ye!==De){if(Oe.setValue(Ht,"projectionMatrix",De.projectionMatrix),Li.logarithmicDepthBuffer&&Oe.setValue(Ht,"logDepthBufFC",2/(Math.log(De.far+1)/Math.LN2)),Ye!==De&&(Ye=De,xe=!0,de=!0),Ae.isShaderMaterial||Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshStandardMaterial||Ae.envMap){const Be=Oe.map.cameraPosition;Be!==void 0&&Be.setValue(Ht,bi.setFromMatrixPosition(De.matrixWorld))}(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial)&&Oe.setValue(Ht,"isOrthographic",De.isOrthographicCamera===!0),(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial||Ae.isShadowMaterial||Ae.skinning)&&Oe.setValue(Ht,"viewMatrix",De.matrixWorldInverse)}if(Ae.skinning){Oe.setOptional(Ht,Ot,"bindMatrix"),Oe.setOptional(Ht,Ot,"bindMatrixInverse");const Be=Ot.skeleton;if(Be){const gt=Be.bones;if(Li.floatVertexTextures){if(Be.boneTexture===null){let st=Math.sqrt(gt.length*4);st=kn.ceilPowerOfTwo(st),st=Math.max(st,4);const Ft=new Float32Array(st*st*4);Ft.set(Be.boneMatrices);const ni=new kw(Ft,st,st,Ja,Fc);Be.boneMatrices=Ft,Be.boneTexture=ni,Be.boneTextureSize=st}Oe.setValue(Ht,"boneTexture",Be.boneTexture,Wt),Oe.setValue(Ht,"boneTextureSize",Be.boneTextureSize)}else Oe.setOptional(Ht,Be,"boneMatrices")}}return(xe||Z.receiveShadow!==Ot.receiveShadow)&&(Z.receiveShadow=Ot.receiveShadow,Oe.setValue(Ht,"receiveShadow",Ot.receiveShadow)),xe&&(Oe.setValue(Ht,"toneMappingExposure",se.toneMappingExposure),Z.needsLights&&Rl(Pe,de),_i&&Ae.fog&&Zt.refreshFogUniforms(Pe,_i),Zt.refreshMaterialUniforms(Pe,Ae,Qe,Dt),ju.upload(Ht,Z.uniformsList,Pe,Wt)),Ae.isShaderMaterial&&Ae.uniformsNeedUpdate===!0&&(ju.upload(Ht,Z.uniformsList,Pe,Wt),Ae.uniformsNeedUpdate=!1),Ae.isSpriteMaterial&&Oe.setValue(Ht,"center",Ot.center),Oe.setValue(Ht,"modelViewMatrix",Ot.modelViewMatrix),Oe.setValue(Ht,"normalMatrix",Ot.normalMatrix),Oe.setValue(Ht,"modelMatrix",Ot.matrixWorld),Me}function Rl(De,Rt){De.ambientLightColor.needsUpdate=Rt,De.lightProbe.needsUpdate=Rt,De.directionalLights.needsUpdate=Rt,De.directionalLightShadows.needsUpdate=Rt,De.pointLights.needsUpdate=Rt,De.pointLightShadows.needsUpdate=Rt,De.spotLights.needsUpdate=Rt,De.spotLightShadows.needsUpdate=Rt,De.rectAreaLights.needsUpdate=Rt,De.hemisphereLights.needsUpdate=Rt}function ts(De){return De.isMeshLambertMaterial||De.isMeshToonMaterial||De.isMeshPhongMaterial||De.isMeshStandardMaterial||De.isShadowMaterial||De.isShaderMaterial&&De.lights===!0}this.setFramebuffer=function(De){le!==De&&Ve===null&&Ht.bindFramebuffer(36160,De),le=De},this.getActiveCubeFace=function(){return ie},this.getActiveMipmapLevel=function(){return it},this.getRenderTarget=function(){return Ve},this.setRenderTarget=function(De,Rt=0,Ae=0){Ve=De,ie=Rt,it=Ae,De&&ei.get(De).__webglFramebuffer===void 0&&Wt.setupRenderTarget(De);let Ot=le,_i=!1,Cn=!1;if(De){const ti=De.texture;(ti.isDataTexture3D||ti.isDataTexture2DArray)&&(Cn=!0);const Ee=ei.get(De).__webglFramebuffer;De.isWebGLCubeRenderTarget?(Ot=Ee[Rt],_i=!0):De.isWebGLMultisampleRenderTarget?Ot=ei.get(De).__webglMultisampledFramebuffer:Ot=Ee,zt.copy(De.viewport),pt.copy(De.scissor),St=De.scissorTest}else zt.copy(yt).multiplyScalar(Qe).floor(),pt.copy(Nt).multiplyScalar(Qe).floor(),St=Qt;if(Ne!==Ot&&(Ht.bindFramebuffer(36160,Ot),Ne=Ot),Ei.viewport(zt),Ei.scissor(pt),Ei.setScissorTest(St),_i){const ti=ei.get(De.texture);Ht.framebufferTexture2D(36160,36064,34069+Rt,ti.__webglTexture,Ae)}else if(Cn){const ti=ei.get(De.texture),Ee=Rt||0;Ht.framebufferTextureLayer(36160,36064,ti.__webglTexture,Ae||0,Ee)}},this.readRenderTargetPixels=function(De,Rt,Ae,Ot,_i,Cn,ti){if(!(De&&De.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ee=ei.get(De).__webglFramebuffer;if(De.isWebGLCubeRenderTarget&&ti!==void 0&&(Ee=Ee[ti]),Ee){let Z=!1;Ee!==Ne&&(Ht.bindFramebuffer(36160,Ee),Z=!0);try{const Q=De.texture,ce=Q.format,xe=Q.type;if(ce!==Ja&&qi.convert(ce)!==Ht.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const de=xe===B_&&(zn.has("EXT_color_buffer_half_float")||Li.isWebGL2&&zn.has("EXT_color_buffer_float"));if(xe!==Cw&&qi.convert(xe)!==Ht.getParameter(35738)&&!(xe===Fc&&(Li.isWebGL2||zn.has("OES_texture_float")||zn.has("WEBGL_color_buffer_float")))&&!de){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ht.checkFramebufferStatus(36160)===36053?Rt>=0&&Rt<=De.width-Ot&&Ae>=0&&Ae<=De.height-_i&&Ht.readPixels(Rt,Ae,Ot,_i,qi.convert(ce),qi.convert(xe),Cn):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Z&&Ht.bindFramebuffer(36160,Ne)}}},this.copyFramebufferToTexture=function(De,Rt,Ae=0){const Ot=Math.pow(2,-Ae),_i=Math.floor(Rt.image.width*Ot),Cn=Math.floor(Rt.image.height*Ot),ti=qi.convert(Rt.format);Wt.setTexture2D(Rt,0),Ht.copyTexImage2D(3553,Ae,ti,De.x,De.y,_i,Cn,0),Ei.unbindTexture()},this.copyTextureToTexture=function(De,Rt,Ae,Ot=0){const _i=Rt.image.width,Cn=Rt.image.height,ti=qi.convert(Ae.format),Ee=qi.convert(Ae.type);Wt.setTexture2D(Ae,0),Ht.pixelStorei(37440,Ae.flipY),Ht.pixelStorei(37441,Ae.premultiplyAlpha),Ht.pixelStorei(3317,Ae.unpackAlignment),Rt.isDataTexture?Ht.texSubImage2D(3553,Ot,De.x,De.y,_i,Cn,ti,Ee,Rt.image.data):Rt.isCompressedTexture?Ht.compressedTexSubImage2D(3553,Ot,De.x,De.y,Rt.mipmaps[0].width,Rt.mipmaps[0].height,ti,Rt.mipmaps[0].data):Ht.texSubImage2D(3553,Ot,De.x,De.y,ti,Ee,Rt.image),Ot===0&&Ae.generateMipmaps&&Ht.generateMipmap(3553),Ei.unbindTexture()},this.copyTextureToTexture3D=function(De,Rt,Ae,Ot,_i=0){if(se.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const{width:Cn,height:ti,data:Ee}=Ae.image,Z=qi.convert(Ot.format),Q=qi.convert(Ot.type);let ce;if(Ot.isDataTexture3D)Wt.setTexture3D(Ot,0),ce=32879;else if(Ot.isDataTexture2DArray)Wt.setTexture2DArray(Ot,0),ce=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Ht.pixelStorei(37440,Ot.flipY),Ht.pixelStorei(37441,Ot.premultiplyAlpha),Ht.pixelStorei(3317,Ot.unpackAlignment);const xe=Ht.getParameter(3314),de=Ht.getParameter(32878),Me=Ht.getParameter(3316),Oe=Ht.getParameter(3315),Pe=Ht.getParameter(32877);Ht.pixelStorei(3314,Cn),Ht.pixelStorei(32878,ti),Ht.pixelStorei(3316,De.min.x),Ht.pixelStorei(3315,De.min.y),Ht.pixelStorei(32877,De.min.z),Ht.texSubImage3D(ce,_i,Rt.x,Rt.y,Rt.z,De.max.x-De.min.x+1,De.max.y-De.min.y+1,De.max.z-De.min.z+1,Z,Q,Ee),Ht.pixelStorei(3314,xe),Ht.pixelStorei(32878,de),Ht.pixelStorei(3316,Me),Ht.pixelStorei(3315,Oe),Ht.pixelStorei(32877,Pe),_i===0&&Ot.generateMipmaps&&Ht.generateMipmap(ce),Ei.unbindTexture()},this.initTexture=function(De){Wt.setTexture2D(De,0),Ei.unbindTexture()},this.resetState=function(){Ei.reset(),$i.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class lU extends Cr{}lU.prototype.isWebGL1Renderer=!0;class Ow extends Rn{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,o){return super.copy(e,o),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const o=super.toJSON(e);return this.background!==null&&(o.object.background=this.background.toJSON(e)),this.environment!==null&&(o.object.environment=this.environment.toJSON(e)),this.fog!==null&&(o.object.fog=this.fog.toJSON()),o}}Ow.prototype.isScene=!0;function Sa(i,e){this.array=i,this.stride=e,this.count=i!==void 0?i.length/e:0,this.usage=ky,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=kn.generateUUID()}Object.defineProperty(Sa.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});Object.assign(Sa.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this},copyAt:function(i,e,o){i*=this.stride,o*=e.stride;for(let h=0,l=this.stride;h<l;h++)this.array[i+h]=e.array[o+h];return this},set:function(i,e=0){return this.array.set(i,e),this},clone:function(i){i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=kn.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),o=new Sa(e,this.stride);return o.setUsage(this.usage),o},onUpload:function(i){return this.onUploadCallback=i,this},toJSON:function(i){return i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=kn.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const od=new He;function $p(i,e,o,h){this.name="",this.data=i,this.itemSize=e,this.offset=o,this.normalized=h===!0}Object.defineProperties($p.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(i){this.data.needsUpdate=i}}});Object.assign($p.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(i){for(let e=0,o=this.data.count;e<o;e++)od.x=this.getX(e),od.y=this.getY(e),od.z=this.getZ(e),od.applyMatrix4(i),this.setXYZ(e,od.x,od.y,od.z);return this},setX:function(i,e){return this.data.array[i*this.data.stride+this.offset]=e,this},setY:function(i,e){return this.data.array[i*this.data.stride+this.offset+1]=e,this},setZ:function(i,e){return this.data.array[i*this.data.stride+this.offset+2]=e,this},setW:function(i,e){return this.data.array[i*this.data.stride+this.offset+3]=e,this},getX:function(i){return this.data.array[i*this.data.stride+this.offset]},getY:function(i){return this.data.array[i*this.data.stride+this.offset+1]},getZ:function(i){return this.data.array[i*this.data.stride+this.offset+2]},getW:function(i){return this.data.array[i*this.data.stride+this.offset+3]},setXY:function(i,e,o){return i=i*this.data.stride+this.offset,this.data.array[i+0]=e,this.data.array[i+1]=o,this},setXYZ:function(i,e,o,h){return i=i*this.data.stride+this.offset,this.data.array[i+0]=e,this.data.array[i+1]=o,this.data.array[i+2]=h,this},setXYZW:function(i,e,o,h,l){return i=i*this.data.stride+this.offset,this.data.array[i+0]=e,this.data.array[i+1]=o,this.data.array[i+2]=h,this.data.array[i+3]=l,this},clone:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let o=0;o<this.count;o++){const h=o*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)e.push(this.data.array[h+l])}return new Zn(new this.array.constructor(e),this.itemSize,this.normalized)}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new $p(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let o=0;o<this.count;o++){const h=o*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)e.push(this.data.array[h+l])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});class l2 extends eo{constructor(e){super(),this.type="SpriteMaterial",this.color=new dn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}l2.prototype.isSpriteMaterial=!0;let dp;const m_=new He,fp=new He,pp=new He,mp=new mi,g_=new mi,cU=new tn,k0=new He,__=new He,O0=new He,eL=new mi,bT=new mi,tL=new mi;class uU extends Rn{constructor(e){if(super(),this.type="Sprite",dp===void 0){dp=new pr;const o=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),h=new Sa(o,5);dp.setIndex([0,1,2,0,2,3]),dp.setAttribute("position",new $p(h,3,0,!1)),dp.setAttribute("uv",new $p(h,2,3,!1))}this.geometry=dp,this.material=e!==void 0?e:new l2,this.center=new mi(.5,.5)}raycast(e,o){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),fp.setFromMatrixScale(this.matrixWorld),cU.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),pp.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&fp.multiplyScalar(-pp.z);const h=this.material.rotation;let l,m;h!==0&&(m=Math.cos(h),l=Math.sin(h));const x=this.center;F0(k0.set(-.5,-.5,0),pp,x,fp,l,m),F0(__.set(.5,-.5,0),pp,x,fp,l,m),F0(O0.set(.5,.5,0),pp,x,fp,l,m),eL.set(0,0),bT.set(1,0),tL.set(1,1);let s=e.ray.intersectTriangle(k0,__,O0,!1,m_);if(s===null&&(F0(__.set(-.5,.5,0),pp,x,fp,l,m),bT.set(0,1),s=e.ray.intersectTriangle(k0,O0,__,!1,m_),s===null))return;const P=e.ray.origin.distanceTo(m_);P<e.near||P>e.far||o.push({distance:P,point:m_.clone(),uv:zo.getUV(m_,k0,__,O0,eL,bT,tL,new mi),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}uU.prototype.isSprite=!0;function F0(i,e,o,h,l,m){mp.subVectors(i,o).addScalar(.5).multiply(h),l!==void 0?(g_.x=m*mp.x-l*mp.y,g_.y=l*mp.x+m*mp.y):g_.copy(mp),i.copy(e),i.x+=g_.x,i.y+=g_.y,i.applyMatrix4(cU)}const iL=new He,nL=new zr,rL=new zr,jee=new He,oL=new tn;function xb(i,e){lr.call(this,i,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new tn,this.bindMatrixInverse=new tn}xb.prototype=Object.assign(Object.create(lr.prototype),{constructor:xb,isSkinnedMesh:!0,copy:function(i){return lr.prototype.copy.call(this,i),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,this},bind:function(i,e){this.skeleton=i,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const i=new zr,e=this.geometry.attributes.skinWeight;for(let o=0,h=e.count;o<h;o++){i.x=e.getX(o),i.y=e.getY(o),i.z=e.getZ(o),i.w=e.getW(o);const l=1/i.manhattanLength();l!==1/0?i.multiplyScalar(l):i.set(1,0,0,0),e.setXYZW(o,i.x,i.y,i.z,i.w)}},updateMatrixWorld:function(i){lr.prototype.updateMatrixWorld.call(this,i),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(i,e){const o=this.skeleton,h=this.geometry;nL.fromBufferAttribute(h.attributes.skinIndex,i),rL.fromBufferAttribute(h.attributes.skinWeight,i),iL.fromBufferAttribute(h.attributes.position,i).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let l=0;l<4;l++){const m=rL.getComponent(l);if(m!==0){const x=nL.getComponent(l);oL.multiplyMatrices(o.bones[x].matrixWorld,o.boneInverses[x]),e.addScaledVector(jee.copy(iL).applyMatrix4(oL),m)}}return e.applyMatrix4(this.bindMatrixInverse)}});function aE(){Rn.call(this),this.type="Bone"}aE.prototype=Object.assign(Object.create(Rn.prototype),{constructor:aE,isBone:!0});const sL=new tn,aL=new tn,B0=[],y_=new lr;function lE(i,e,o){lr.call(this,i,e),this.instanceMatrix=new Zn(new Float32Array(o*16),16),this.instanceColor=null,this.count=o,this.frustumCulled=!1}lE.prototype=Object.assign(Object.create(lr.prototype),{constructor:lE,isInstancedMesh:!0,copy:function(i){return lr.prototype.copy.call(this,i),this.instanceMatrix.copy(i.instanceMatrix),i.instanceColor!==null&&(this.instanceColor=i.instanceColor.clone()),this.count=i.count,this},getColorAt:function(i,e){e.fromArray(this.instanceColor.array,i*3)},getMatrixAt:function(i,e){e.fromArray(this.instanceMatrix.array,i*16)},raycast:function(i,e){const o=this.matrixWorld,h=this.count;if(y_.geometry=this.geometry,y_.material=this.material,y_.material!==void 0)for(let l=0;l<h;l++){this.getMatrixAt(l,sL),aL.multiplyMatrices(o,sL),y_.matrixWorld=aL,y_.raycast(i,B0);for(let m=0,x=B0.length;m<x;m++){const s=B0[m];s.instanceId=l,s.object=this,e.push(s)}B0.length=0}},setColorAt:function(i,e){this.instanceColor===null&&(this.instanceColor=new Zn(new Float32Array(this.count*3),3)),e.toArray(this.instanceColor.array,i*3)},setMatrixAt:function(i,e){e.toArray(this.instanceMatrix.array,i*16)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});class Jp extends eo{constructor(e){super(),this.type="LineBasicMaterial",this.color=new dn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}Jp.prototype.isLineBasicMaterial=!0;const lL=new He,cL=new He,uL=new tn,wT=new ih,N0=new Id;function Vp(i=new pr,e=new Jp){Rn.call(this),this.type="Line",this.geometry=i,this.material=e,this.updateMorphTargets()}Vp.prototype=Object.assign(Object.create(Rn.prototype),{constructor:Vp,isLine:!0,copy:function(i){return Rn.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(i.index===null){const e=i.attributes.position,o=[0];for(let h=1,l=e.count;h<l;h++)lL.fromBufferAttribute(e,h-1),cL.fromBufferAttribute(e,h),o[h]=o[h-1],o[h]+=lL.distanceTo(cL);i.setAttribute("lineDistance",new Or(o,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(i,e){const o=this.geometry,h=this.matrixWorld,l=i.params.Line.threshold;if(o.boundingSphere===null&&o.computeBoundingSphere(),N0.copy(o.boundingSphere),N0.applyMatrix4(h),N0.radius+=l,i.ray.intersectsSphere(N0)===!1)return;uL.copy(h).invert(),wT.copy(i.ray).applyMatrix4(uL);const m=l/((this.scale.x+this.scale.y+this.scale.z)/3),x=m*m,s=new He,P=new He,C=new He,F=new He,O=this.isLineSegments?2:1;if(o.isBufferGeometry){const V=o.index,ee=o.attributes.position;if(V!==null){const se=V.array;for(let fe=0,le=se.length-1;fe<le;fe+=O){const ie=se[fe],it=se[fe+1];if(s.fromBufferAttribute(ee,ie),P.fromBufferAttribute(ee,it),wT.distanceSqToSegment(s,P,F,C)>x)continue;F.applyMatrix4(this.matrixWorld);const Ne=i.ray.origin.distanceTo(F);Ne<i.near||Ne>i.far||e.push({distance:Ne,point:C.clone().applyMatrix4(this.matrixWorld),index:fe,face:null,faceIndex:null,object:this})}}else for(let se=0,fe=ee.count-1;se<fe;se+=O){if(s.fromBufferAttribute(ee,se),P.fromBufferAttribute(ee,se+1),wT.distanceSqToSegment(s,P,F,C)>x)continue;F.applyMatrix4(this.matrixWorld);const ie=i.ray.origin.distanceTo(F);ie<i.near||ie>i.far||e.push({distance:ie,point:C.clone().applyMatrix4(this.matrixWorld),index:se,face:null,faceIndex:null,object:this})}}else o.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const e=i.morphAttributes,o=Object.keys(e);if(o.length>0){const h=e[o[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,m=h.length;l<m;l++){const x=h[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[x]=l}}}}else{const e=i.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const hL=new He,dL=new He;function j_(i,e){Vp.call(this,i,e),this.type="LineSegments"}j_.prototype=Object.assign(Object.create(Vp.prototype),{constructor:j_,isLineSegments:!0,computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(i.index===null){const e=i.attributes.position,o=[];for(let h=0,l=e.count;h<l;h+=2)hL.fromBufferAttribute(e,h),dL.fromBufferAttribute(e,h+1),o[h]=h===0?0:o[h-1],o[h+1]=o[h]+hL.distanceTo(dL);i.setAttribute("lineDistance",new Or(o,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});class hU extends Vp{constructor(e,o){super(e,o),this.type="LineLoop"}}hU.prototype.isLineLoop=!0;class c2 extends eo{constructor(e){super(),this.type="PointsMaterial",this.color=new dn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}c2.prototype.isPointsMaterial=!0;const fL=new tn,cE=new ih,U0=new Id,$0=new He;function uE(i=new pr,e=new c2){Rn.call(this),this.type="Points",this.geometry=i,this.material=e,this.updateMorphTargets()}uE.prototype=Object.assign(Object.create(Rn.prototype),{constructor:uE,isPoints:!0,copy:function(i){return Rn.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},raycast:function(i,e){const o=this.geometry,h=this.matrixWorld,l=i.params.Points.threshold;if(o.boundingSphere===null&&o.computeBoundingSphere(),U0.copy(o.boundingSphere),U0.applyMatrix4(h),U0.radius+=l,i.ray.intersectsSphere(U0)===!1)return;fL.copy(h).invert(),cE.copy(i.ray).applyMatrix4(fL);const m=l/((this.scale.x+this.scale.y+this.scale.z)/3),x=m*m;if(o.isBufferGeometry){const s=o.index,C=o.attributes.position;if(s!==null){const F=s.array;for(let O=0,V=F.length;O<V;O++){const J=F[O];$0.fromBufferAttribute(C,J),pL($0,J,x,h,i,e,this)}}else for(let F=0,O=C.count;F<O;F++)$0.fromBufferAttribute(C,F),pL($0,F,x,h,i,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const e=i.morphAttributes,o=Object.keys(e);if(o.length>0){const h=e[o[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,m=h.length;l<m;l++){const x=h[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[x]=l}}}}else{const e=i.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});function pL(i,e,o,h,l,m,x){const s=cE.distanceSqToPoint(i);if(s<o){const P=new He;cE.closestPointToPoint(i,P),P.applyMatrix4(h);const C=l.ray.origin.distanceTo(P);if(C<l.near||C>l.far)return;m.push({distance:C,distanceToRay:Math.sqrt(s),point:P,index:e,face:null,object:x})}}class dU extends es{constructor(e,o,h,l,m,x,s,P,C){super(e,o,h,l,m,x,s,P,C),this.format=s!==void 0?s:$u,this.minFilter=x!==void 0?x:Ko,this.magFilter=m!==void 0?m:Ko,this.generateMipmaps=!1;const F=this;function O(){F.needsUpdate=!0,e.requestVideoFrameCallback(O)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(O)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}dU.prototype.isVideoTexture=!0;class u2 extends es{constructor(e,o,h,l,m,x,s,P,C,F,O,V){super(null,x,s,P,C,F,l,m,O,V),this.image={width:o,height:h},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}u2.prototype.isCompressedTexture=!0;class fU extends es{constructor(e,o,h,l,m,x,s,P,C){super(e,o,h,l,m,x,s,P,C),this.needsUpdate=!0}}fU.prototype.isCanvasTexture=!0;class pU extends es{constructor(e,o,h,l,m,x,s,P,C,F){if(F=F!==void 0?F:fd,F!==fd&&F!==Op)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");h===void 0&&F===fd&&(h=F_),h===void 0&&F===Op&&(h=Tp),super(null,l,m,x,s,P,F,h,C),this.image={width:e,height:o},this.magFilter=s!==void 0?s:Cs,this.minFilter=P!==void 0?P:Cs,this.flipY=!1,this.generateMipmaps=!1}}pU.prototype.isDepthTexture=!0;class hE extends pr{constructor(e=1,o=1,h=1,l=8,m=1,x=!1,s=0,P=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:o,height:h,radialSegments:l,heightSegments:m,openEnded:x,thetaStart:s,thetaLength:P};const C=this;l=Math.floor(l),m=Math.floor(m);const F=[],O=[],V=[],J=[];let ee=0;const se=[],fe=h/2;let le=0;ie(),x===!1&&(e>0&&it(!0),o>0&&it(!1)),this.setIndex(F),this.setAttribute("position",new Or(O,3)),this.setAttribute("normal",new Or(V,3)),this.setAttribute("uv",new Or(J,2));function ie(){const Ve=new He,Ne=new He;let Re=0;const Ye=(o-e)/h;for(let zt=0;zt<=m;zt++){const pt=[],St=zt/m,Et=St*(o-e)+e;for(let Dt=0;Dt<=l;Dt++){const Qe=Dt/l,ht=Qe*P+s,_t=Math.sin(ht),yt=Math.cos(ht);Ne.x=Et*_t,Ne.y=-St*h+fe,Ne.z=Et*yt,O.push(Ne.x,Ne.y,Ne.z),Ve.set(_t,Ye,yt).normalize(),V.push(Ve.x,Ve.y,Ve.z),J.push(Qe,1-St),pt.push(ee++)}se.push(pt)}for(let zt=0;zt<l;zt++)for(let pt=0;pt<m;pt++){const St=se[pt][zt],Et=se[pt+1][zt],Dt=se[pt+1][zt+1],Qe=se[pt][zt+1];F.push(St,Et,Qe),F.push(Et,Dt,Qe),Re+=6}C.addGroup(le,Re,0),le+=Re}function it(Ve){const Ne=ee,Re=new mi,Ye=new He;let zt=0;const pt=Ve===!0?e:o,St=Ve===!0?1:-1;for(let Dt=1;Dt<=l;Dt++)O.push(0,fe*St,0),V.push(0,St,0),J.push(.5,.5),ee++;const Et=ee;for(let Dt=0;Dt<=l;Dt++){const ht=Dt/l*P+s,_t=Math.cos(ht),yt=Math.sin(ht);Ye.x=pt*yt,Ye.y=fe*St,Ye.z=pt*_t,O.push(Ye.x,Ye.y,Ye.z),V.push(0,St,0),Re.x=_t*.5+.5,Re.y=yt*.5*St+.5,J.push(Re.x,Re.y),ee++}for(let Dt=0;Dt<l;Dt++){const Qe=Ne+Dt,ht=Et+Dt;Ve===!0?F.push(ht,ht+1,Qe):F.push(ht+1,ht,Qe),zt+=3}C.addGroup(le,zt,Ve===!0?1:2),le+=zt}}}const Gee={triangulate:function(i,e,o){o=o||2;const h=e&&e.length,l=h?e[0]*o:i.length;let m=mU(i,0,l,o,!0);const x=[];if(!m||m.next===m.prev)return x;let s,P,C,F,O,V,J;if(h&&(m=Xee(i,e,m,o)),i.length>80*o){s=C=i[0],P=F=i[1];for(let ee=o;ee<l;ee+=o)O=i[ee],V=i[ee+1],O<s&&(s=O),V<P&&(P=V),O>C&&(C=O),V>F&&(F=V);J=Math.max(C-s,F-P),J=J!==0?1/J:0}return G_(m,x,o,s,P,J),x}};function mU(i,e,o,h,l){let m,x;if(l===ste(i,e,o,h)>0)for(m=e;m<o;m+=h)x=mL(m,i[m],i[m+1],x);else for(m=o-h;m>=e;m-=h)x=mL(m,i[m],i[m+1],x);return x&&Fw(x,x.next)&&(Z_(x),x=x.next),x}function Ku(i,e){if(!i)return i;e||(e=i);let o=i,h;do if(h=!1,!o.steiner&&(Fw(o,o.next)||uo(o.prev,o,o.next)===0)){if(Z_(o),o=e=o.prev,o===o.next)break;h=!0}else o=o.next;while(h||o!==e);return e}function G_(i,e,o,h,l,m,x){if(!i)return;!x&&m&&ete(i,h,l,m);let s=i,P,C;for(;i.prev!==i.next;){if(P=i.prev,C=i.next,m?Zee(i,h,l,m):Hee(i)){e.push(P.i/o),e.push(i.i/o),e.push(C.i/o),Z_(i),i=C.next,s=C.next;continue}if(i=C,i===s){x?x===1?(i=Wee(Ku(i),e,o),G_(i,e,o,h,l,m,2)):x===2&&qee(i,e,o,h,l,m):G_(Ku(i),e,o,h,l,m,1);break}}}function Hee(i){const e=i.prev,o=i,h=i.next;if(uo(e,o,h)>=0)return!1;let l=i.next.next;for(;l!==i.prev;){if(vp(e.x,e.y,o.x,o.y,h.x,h.y,l.x,l.y)&&uo(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function Zee(i,e,o,h){const l=i.prev,m=i,x=i.next;if(uo(l,m,x)>=0)return!1;const s=l.x<m.x?l.x<x.x?l.x:x.x:m.x<x.x?m.x:x.x,P=l.y<m.y?l.y<x.y?l.y:x.y:m.y<x.y?m.y:x.y,C=l.x>m.x?l.x>x.x?l.x:x.x:m.x>x.x?m.x:x.x,F=l.y>m.y?l.y>x.y?l.y:x.y:m.y>x.y?m.y:x.y,O=dE(s,P,e,o,h),V=dE(C,F,e,o,h);let J=i.prevZ,ee=i.nextZ;for(;J&&J.z>=O&&ee&&ee.z<=V;){if(J!==i.prev&&J!==i.next&&vp(l.x,l.y,m.x,m.y,x.x,x.y,J.x,J.y)&&uo(J.prev,J,J.next)>=0||(J=J.prevZ,ee!==i.prev&&ee!==i.next&&vp(l.x,l.y,m.x,m.y,x.x,x.y,ee.x,ee.y)&&uo(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;J&&J.z>=O;){if(J!==i.prev&&J!==i.next&&vp(l.x,l.y,m.x,m.y,x.x,x.y,J.x,J.y)&&uo(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;ee&&ee.z<=V;){if(ee!==i.prev&&ee!==i.next&&vp(l.x,l.y,m.x,m.y,x.x,x.y,ee.x,ee.y)&&uo(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Wee(i,e,o){let h=i;do{const l=h.prev,m=h.next.next;!Fw(l,m)&&gU(l,h,h.next,m)&&H_(l,m)&&H_(m,l)&&(e.push(l.i/o),e.push(h.i/o),e.push(m.i/o),Z_(h),Z_(h.next),h=i=m),h=h.next}while(h!==i);return Ku(h)}function qee(i,e,o,h,l,m){let x=i;do{let s=x.next.next;for(;s!==x.prev;){if(x.i!==s.i&&nte(x,s)){let P=_U(x,s);x=Ku(x,x.next),P=Ku(P,P.next),G_(x,e,o,h,l,m),G_(P,e,o,h,l,m);return}s=s.next}x=x.next}while(x!==i)}function Xee(i,e,o,h){const l=[];let m,x,s,P,C;for(m=0,x=e.length;m<x;m++)s=e[m]*h,P=m<x-1?e[m+1]*h:i.length,C=mU(i,s,P,h,!1),C===C.next&&(C.steiner=!0),l.push(ite(C));for(l.sort(Jee),m=0;m<l.length;m++)Yee(l[m],o),o=Ku(o,o.next);return o}function Jee(i,e){return i.x-e.x}function Yee(i,e){if(e=Kee(i,e),e){const o=_U(e,i);Ku(e,e.next),Ku(o,o.next)}}function Kee(i,e){let o=e;const h=i.x,l=i.y;let m=-1/0,x;do{if(l<=o.y&&l>=o.next.y&&o.next.y!==o.y){const V=o.x+(l-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(V<=h&&V>m){if(m=V,V===h){if(l===o.y)return o;if(l===o.next.y)return o.next}x=o.x<o.next.x?o:o.next}}o=o.next}while(o!==e);if(!x)return null;if(h===m)return x;const s=x,P=x.x,C=x.y;let F=1/0,O;o=x;do h>=o.x&&o.x>=P&&h!==o.x&&vp(l<C?h:m,l,P,C,l<C?m:h,l,o.x,o.y)&&(O=Math.abs(l-o.y)/(h-o.x),H_(o,i)&&(O<F||O===F&&(o.x>x.x||o.x===x.x&&Qee(x,o)))&&(x=o,F=O)),o=o.next;while(o!==s);return x}function Qee(i,e){return uo(i.prev,i,e.prev)<0&&uo(e.next,i,i.next)<0}function ete(i,e,o,h){let l=i;do l.z===null&&(l.z=dE(l.x,l.y,e,o,h)),l.prevZ=l.prev,l.nextZ=l.next,l=l.next;while(l!==i);l.prevZ.nextZ=null,l.prevZ=null,tte(l)}function tte(i){let e,o,h,l,m,x,s,P,C=1;do{for(o=i,i=null,m=null,x=0;o;){for(x++,h=o,s=0,e=0;e<C&&(s++,h=h.nextZ,!!h);e++);for(P=C;s>0||P>0&&h;)s!==0&&(P===0||!h||o.z<=h.z)?(l=o,o=o.nextZ,s--):(l=h,h=h.nextZ,P--),m?m.nextZ=l:i=l,l.prevZ=m,m=l;o=h}m.nextZ=null,C*=2}while(x>1);return i}function dE(i,e,o,h,l){return i=32767*(i-o)*l,e=32767*(e-h)*l,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function ite(i){let e=i,o=i;do(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next;while(e!==i);return o}function vp(i,e,o,h,l,m,x,s){return(l-x)*(e-s)-(i-x)*(m-s)>=0&&(i-x)*(h-s)-(o-x)*(e-s)>=0&&(o-x)*(m-s)-(l-x)*(h-s)>=0}function nte(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!rte(i,e)&&(H_(i,e)&&H_(e,i)&&ote(i,e)&&(uo(i.prev,i,e.prev)||uo(i,e.prev,e))||Fw(i,e)&&uo(i.prev,i,i.next)>0&&uo(e.prev,e,e.next)>0)}function uo(i,e,o){return(e.y-i.y)*(o.x-e.x)-(e.x-i.x)*(o.y-e.y)}function Fw(i,e){return i.x===e.x&&i.y===e.y}function gU(i,e,o,h){const l=j0(uo(i,e,o)),m=j0(uo(i,e,h)),x=j0(uo(o,h,i)),s=j0(uo(o,h,e));return!!(l!==m&&x!==s||l===0&&V0(i,o,e)||m===0&&V0(i,h,e)||x===0&&V0(o,i,h)||s===0&&V0(o,e,h))}function V0(i,e,o){return e.x<=Math.max(i.x,o.x)&&e.x>=Math.min(i.x,o.x)&&e.y<=Math.max(i.y,o.y)&&e.y>=Math.min(i.y,o.y)}function j0(i){return i>0?1:i<0?-1:0}function rte(i,e){let o=i;do{if(o.i!==i.i&&o.next.i!==i.i&&o.i!==e.i&&o.next.i!==e.i&&gU(o,o.next,i,e))return!0;o=o.next}while(o!==i);return!1}function H_(i,e){return uo(i.prev,i,i.next)<0?uo(i,e,i.next)>=0&&uo(i,i.prev,e)>=0:uo(i,e,i.prev)<0||uo(i,i.next,e)<0}function ote(i,e){let o=i,h=!1;const l=(i.x+e.x)/2,m=(i.y+e.y)/2;do o.y>m!=o.next.y>m&&o.next.y!==o.y&&l<(o.next.x-o.x)*(m-o.y)/(o.next.y-o.y)+o.x&&(h=!h),o=o.next;while(o!==i);return h}function _U(i,e){const o=new fE(i.i,i.x,i.y),h=new fE(e.i,e.x,e.y),l=i.next,m=e.prev;return i.next=e,e.prev=i,o.next=l,l.prev=o,h.next=o,o.prev=h,m.next=h,h.prev=m,h}function mL(i,e,o,h){const l=new fE(i,e,o);return h?(l.next=h.next,l.prev=h,h.next.prev=l,h.next=l):(l.prev=l,l.next=l),l}function Z_(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function fE(i,e,o){this.i=i,this.x=e,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ste(i,e,o,h){let l=0;for(let m=e,x=o-h;m<o;m+=h)l+=(i[x]-i[m])*(i[m+1]+i[x+1]),x=m;return l}const Gu={area:function(i){const e=i.length;let o=0;for(let h=e-1,l=0;l<e;h=l++)o+=i[h].x*i[l].y-i[l].x*i[h].y;return o*.5},isClockWise:function(i){return Gu.area(i)<0},triangulateShape:function(i,e){const o=[],h=[],l=[];gL(i),_L(o,i);let m=i.length;e.forEach(gL);for(let s=0;s<e.length;s++)h.push(m),m+=e[s].length,_L(o,e[s]);const x=Gee.triangulate(o,h);for(let s=0;s<x.length;s+=3)l.push(x.slice(s,s+3));return l}};function gL(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function _L(i,e){for(let o=0;o<e.length;o++)i.push(e[o].x),i.push(e[o].y)}class jp extends pr{constructor(e,o){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:o},e=Array.isArray(e)?e:[e];const h=this,l=[],m=[];for(let s=0,P=e.length;s<P;s++){const C=e[s];x(C)}this.setAttribute("position",new Or(l,3)),this.setAttribute("uv",new Or(m,2)),this.computeVertexNormals();function x(s){const P=[],C=o.curveSegments!==void 0?o.curveSegments:12,F=o.steps!==void 0?o.steps:1;let O=o.depth!==void 0?o.depth:100,V=o.bevelEnabled!==void 0?o.bevelEnabled:!0,J=o.bevelThickness!==void 0?o.bevelThickness:6,ee=o.bevelSize!==void 0?o.bevelSize:J-2,se=o.bevelOffset!==void 0?o.bevelOffset:0,fe=o.bevelSegments!==void 0?o.bevelSegments:3;const le=o.extrudePath,ie=o.UVGenerator!==void 0?o.UVGenerator:ate;o.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),O=o.amount);let it,Ve=!1,Ne,Re,Ye,zt;le&&(it=le.getSpacedPoints(F),Ve=!0,V=!1,Ne=le.computeFrenetFrames(F,!1),Re=new He,Ye=new He,zt=new He),V||(fe=0,J=0,ee=0,se=0);const pt=s.extractPoints(C);let St=pt.shape;const Et=pt.holes;if(!Gu.isClockWise(St)){St=St.reverse();for(let ei=0,Wt=Et.length;ei<Wt;ei++){const ui=Et[ei];Gu.isClockWise(ui)&&(Et[ei]=ui.reverse())}}const Qe=Gu.triangulateShape(St,Et),ht=St;for(let ei=0,Wt=Et.length;ei<Wt;ei++){const ui=Et[ei];St=St.concat(ui)}function _t(ei,Wt,ui){return Wt||console.error("THREE.ExtrudeGeometry: vec does not exist"),Wt.clone().multiplyScalar(ui).add(ei)}const yt=St.length,Nt=Qe.length;function Qt(ei,Wt,ui){let Vi,zi,$e;const Ce=ei.x-Wt.x,Zt=ei.y-Wt.y,Xt=ui.x-ei.x,rt=ui.y-ei.y,ri=Ce*Ce+Zt*Zt,wi=Ce*rt-Zt*Xt;if(Math.abs(wi)>Number.EPSILON){const gi=Math.sqrt(ri),Yt=Math.sqrt(Xt*Xt+rt*rt),Zi=Wt.x-Zt/gi,qi=Wt.y+Ce/gi,$i=ui.x-rt/Yt,Xi=ui.y+Xt/Yt,Di=(($i-Zi)*rt-(Xi-qi)*Xt)/(Ce*rt-Zt*Xt);Vi=Zi+Ce*Di-ei.x,zi=qi+Zt*Di-ei.y;const gr=Vi*Vi+zi*zi;if(gr<=2)return new mi(Vi,zi);$e=Math.sqrt(gr/2)}else{let gi=!1;Ce>Number.EPSILON?Xt>Number.EPSILON&&(gi=!0):Ce<-Number.EPSILON?Xt<-Number.EPSILON&&(gi=!0):Math.sign(Zt)===Math.sign(rt)&&(gi=!0),gi?(Vi=-Zt,zi=Ce,$e=Math.sqrt(ri)):(Vi=Ce,zi=Zt,$e=Math.sqrt(ri/2))}return new mi(Vi/$e,zi/$e)}const pi=[];for(let ei=0,Wt=ht.length,ui=Wt-1,Vi=ei+1;ei<Wt;ei++,ui++,Vi++)ui===Wt&&(ui=0),Vi===Wt&&(Vi=0),pi[ei]=Qt(ht[ei],ht[ui],ht[Vi]);const Pi=[];let Mi,fn=pi.concat();for(let ei=0,Wt=Et.length;ei<Wt;ei++){const ui=Et[ei];Mi=[];for(let Vi=0,zi=ui.length,$e=zi-1,Ce=Vi+1;Vi<zi;Vi++,$e++,Ce++)$e===zi&&($e=0),Ce===zi&&(Ce=0),Mi[Vi]=Qt(ui[Vi],ui[$e],ui[Ce]);Pi.push(Mi),fn=fn.concat(Mi)}for(let ei=0;ei<fe;ei++){const Wt=ei/fe,ui=J*Math.cos(Wt*Math.PI/2),Vi=ee*Math.sin(Wt*Math.PI/2)+se;for(let zi=0,$e=ht.length;zi<$e;zi++){const Ce=_t(ht[zi],pi[zi],Vi);mr(Ce.x,Ce.y,-ui)}for(let zi=0,$e=Et.length;zi<$e;zi++){const Ce=Et[zi];Mi=Pi[zi];for(let Zt=0,Xt=Ce.length;Zt<Xt;Zt++){const rt=_t(Ce[Zt],Mi[Zt],Vi);mr(rt.x,rt.y,-ui)}}}const bi=ee+se;for(let ei=0;ei<yt;ei++){const Wt=V?_t(St[ei],fn[ei],bi):St[ei];Ve?(Ye.copy(Ne.normals[0]).multiplyScalar(Wt.x),Re.copy(Ne.binormals[0]).multiplyScalar(Wt.y),zt.copy(it[0]).add(Ye).add(Re),mr(zt.x,zt.y,zt.z)):mr(Wt.x,Wt.y,0)}for(let ei=1;ei<=F;ei++)for(let Wt=0;Wt<yt;Wt++){const ui=V?_t(St[Wt],fn[Wt],bi):St[Wt];Ve?(Ye.copy(Ne.normals[ei]).multiplyScalar(ui.x),Re.copy(Ne.binormals[ei]).multiplyScalar(ui.y),zt.copy(it[ei]).add(Ye).add(Re),mr(zt.x,zt.y,zt.z)):mr(ui.x,ui.y,O/F*ei)}for(let ei=fe-1;ei>=0;ei--){const Wt=ei/fe,ui=J*Math.cos(Wt*Math.PI/2),Vi=ee*Math.sin(Wt*Math.PI/2)+se;for(let zi=0,$e=ht.length;zi<$e;zi++){const Ce=_t(ht[zi],pi[zi],Vi);mr(Ce.x,Ce.y,O+ui)}for(let zi=0,$e=Et.length;zi<$e;zi++){const Ce=Et[zi];Mi=Pi[zi];for(let Zt=0,Xt=Ce.length;Zt<Xt;Zt++){const rt=_t(Ce[Zt],Mi[Zt],Vi);Ve?mr(rt.x,rt.y+it[F-1].y,it[F-1].x+ui):mr(rt.x,rt.y,O+ui)}}}Dn(),Un();function Dn(){const ei=l.length/3;if(V){let Wt=0,ui=yt*Wt;for(let Vi=0;Vi<Nt;Vi++){const zi=Qe[Vi];zn(zi[2]+ui,zi[1]+ui,zi[0]+ui)}Wt=F+fe*2,ui=yt*Wt;for(let Vi=0;Vi<Nt;Vi++){const zi=Qe[Vi];zn(zi[0]+ui,zi[1]+ui,zi[2]+ui)}}else{for(let Wt=0;Wt<Nt;Wt++){const ui=Qe[Wt];zn(ui[2],ui[1],ui[0])}for(let Wt=0;Wt<Nt;Wt++){const ui=Qe[Wt];zn(ui[0]+yt*F,ui[1]+yt*F,ui[2]+yt*F)}}h.addGroup(ei,l.length/3-ei,0)}function Un(){const ei=l.length/3;let Wt=0;Ht(ht,Wt),Wt+=ht.length;for(let ui=0,Vi=Et.length;ui<Vi;ui++){const zi=Et[ui];Ht(zi,Wt),Wt+=zi.length}h.addGroup(ei,l.length/3-ei,1)}function Ht(ei,Wt){let ui=ei.length;for(;--ui>=0;){const Vi=ui;let zi=ui-1;zi<0&&(zi=ei.length-1);for(let $e=0,Ce=F+fe*2;$e<Ce;$e++){const Zt=yt*$e,Xt=yt*($e+1),rt=Wt+Vi+Zt,ri=Wt+zi+Zt,wi=Wt+zi+Xt,gi=Wt+Vi+Xt;Li(rt,ri,wi,gi)}}}function mr(ei,Wt,ui){P.push(ei),P.push(Wt),P.push(ui)}function zn(ei,Wt,ui){Ei(ei),Ei(Wt),Ei(ui);const Vi=l.length/3,zi=ie.generateTopUV(h,l,Vi-3,Vi-2,Vi-1);hn(zi[0]),hn(zi[1]),hn(zi[2])}function Li(ei,Wt,ui,Vi){Ei(ei),Ei(Wt),Ei(Vi),Ei(Wt),Ei(ui),Ei(Vi);const zi=l.length/3,$e=ie.generateSideWallUV(h,l,zi-6,zi-3,zi-2,zi-1);hn($e[0]),hn($e[1]),hn($e[3]),hn($e[1]),hn($e[2]),hn($e[3])}function Ei(ei){l.push(P[ei*3+0]),l.push(P[ei*3+1]),l.push(P[ei*3+2])}function hn(ei){m.push(ei.x),m.push(ei.y)}}}toJSON(){const e=pr.prototype.toJSON.call(this),o=this.parameters.shapes,h=this.parameters.options;return lte(o,h,e)}}const ate={generateTopUV:function(i,e,o,h,l){const m=e[o*3],x=e[o*3+1],s=e[h*3],P=e[h*3+1],C=e[l*3],F=e[l*3+1];return[new mi(m,x),new mi(s,P),new mi(C,F)]},generateSideWallUV:function(i,e,o,h,l,m){const x=e[o*3],s=e[o*3+1],P=e[o*3+2],C=e[h*3],F=e[h*3+1],O=e[h*3+2],V=e[l*3],J=e[l*3+1],ee=e[l*3+2],se=e[m*3],fe=e[m*3+1],le=e[m*3+2];return Math.abs(s-F)<.01?[new mi(x,1-P),new mi(C,1-O),new mi(V,1-ee),new mi(se,1-le)]:[new mi(s,1-P),new mi(F,1-O),new mi(J,1-ee),new mi(fe,1-le)]}};function lte(i,e,o){if(o.shapes=[],Array.isArray(i))for(let h=0,l=i.length;h<l;h++){const m=i[h];o.shapes.push(m.uuid)}else o.shapes.push(i.uuid);return e.extrudePath!==void 0&&(o.options.extrudePath=e.extrudePath.toJSON()),o}function W_(i,e,o){pr.call(this),this.type="ParametricGeometry",this.parameters={func:i,slices:e,stacks:o};const h=[],l=[],m=[],x=[],s=1e-5,P=new He,C=new He,F=new He,O=new He,V=new He;i.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const J=e+1;for(let ee=0;ee<=o;ee++){const se=ee/o;for(let fe=0;fe<=e;fe++){const le=fe/e;i(le,se,C),l.push(C.x,C.y,C.z),le-s>=0?(i(le-s,se,F),O.subVectors(C,F)):(i(le+s,se,F),O.subVectors(F,C)),se-s>=0?(i(le,se-s,F),V.subVectors(C,F)):(i(le,se+s,F),V.subVectors(F,C)),P.crossVectors(O,V).normalize(),m.push(P.x,P.y,P.z),x.push(le,se)}}for(let ee=0;ee<o;ee++)for(let se=0;se<e;se++){const fe=ee*J+se,le=ee*J+se+1,ie=(ee+1)*J+se+1,it=(ee+1)*J+se;h.push(fe,le,it),h.push(le,ie,it)}this.setIndex(h),this.setAttribute("position",new Or(l,3)),this.setAttribute("normal",new Or(m,3)),this.setAttribute("uv",new Or(x,2))}W_.prototype=Object.create(pr.prototype);W_.prototype.constructor=W_;class pE extends pr{constructor(e,o=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:o};const h=[],l=[],m=[],x=[];let s=0,P=0;if(Array.isArray(e)===!1)C(e);else for(let F=0;F<e.length;F++)C(e[F]),this.addGroup(s,P,F),s+=P,P=0;this.setIndex(h),this.setAttribute("position",new Or(l,3)),this.setAttribute("normal",new Or(m,3)),this.setAttribute("uv",new Or(x,2));function C(F){const O=l.length/3,V=F.extractPoints(o);let J=V.shape;const ee=V.holes;Gu.isClockWise(J)===!1&&(J=J.reverse());for(let fe=0,le=ee.length;fe<le;fe++){const ie=ee[fe];Gu.isClockWise(ie)===!0&&(ee[fe]=ie.reverse())}const se=Gu.triangulateShape(J,ee);for(let fe=0,le=ee.length;fe<le;fe++){const ie=ee[fe];J=J.concat(ie)}for(let fe=0,le=J.length;fe<le;fe++){const ie=J[fe];l.push(ie.x,ie.y,0),m.push(0,0,1),x.push(ie.x,ie.y)}for(let fe=0,le=se.length;fe<le;fe++){const ie=se[fe],it=ie[0]+O,Ve=ie[1]+O,Ne=ie[2]+O;h.push(it,Ve,Ne),P+=3}}}toJSON(){const e=pr.prototype.toJSON.call(this),o=this.parameters.shapes;return cte(o,e)}}function cte(i,e){if(e.shapes=[],Array.isArray(i))for(let o=0,h=i.length;o<h;o++){const l=i[o];e.shapes.push(l.uuid)}else e.shapes.push(i.uuid);return e}class yU extends eo{constructor(e){super(),this.type="ShadowMaterial",this.color=new dn(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}yU.prototype.isShadowMaterial=!0;class vU extends Ia{constructor(e){super(e),this.type="RawShaderMaterial"}}vU.prototype.isRawShaderMaterial=!0;function Uc(i){eo.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new dn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Td,this.normalScale=new mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(i)}Uc.prototype=Object.create(eo.prototype);Uc.prototype.constructor=Uc;Uc.prototype.isMeshStandardMaterial=!0;Uc.prototype.copy=function(i){return eo.prototype.copy.call(this,i),this.defines={STANDARD:""},this.color.copy(i.color),this.roughness=i.roughness,this.metalness=i.metalness,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.roughnessMap=i.roughnessMap,this.metalnessMap=i.metalnessMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.envMapIntensity=i.envMapIntensity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.flatShading=i.flatShading,this.vertexTangents=i.vertexTangents,this};function yd(i){Uc.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mi(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=kn.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(i)}yd.prototype=Object.create(Uc.prototype);yd.prototype.constructor=yd;yd.prototype.isMeshPhysicalMaterial=!0;yd.prototype.copy=function(i){return Uc.prototype.copy.call(this,i),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=i.clearcoat,this.clearcoatMap=i.clearcoatMap,this.clearcoatRoughness=i.clearcoatRoughness,this.clearcoatRoughnessMap=i.clearcoatRoughnessMap,this.clearcoatNormalMap=i.clearcoatNormalMap,this.clearcoatNormalScale.copy(i.clearcoatNormalScale),this.reflectivity=i.reflectivity,i.sheen?this.sheen=(this.sheen||new dn).copy(i.sheen):this.sheen=null,this.transmission=i.transmission,this.transmissionMap=i.transmissionMap,this};class Tl extends eo{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new dn(16777215),this.specular=new dn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Td,this.normalScale=new mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ly,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}Tl.prototype.isMeshPhongMaterial=!0;class xU extends eo{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new dn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Td,this.normalScale=new mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}xU.prototype.isMeshToonMaterial=!0;class bU extends eo{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Td,this.normalScale=new mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}bU.prototype.isMeshNormalMaterial=!0;class wU extends eo{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new dn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ly,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}wU.prototype.isMeshLambertMaterial=!0;class SU extends eo{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new dn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Td,this.normalScale=new mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}SU.prototype.isMeshMatcapMaterial=!0;class TU extends Jp{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}TU.prototype.isLineDashedMaterial=!0;const Jr={arraySlice:function(i,e,o){return Jr.isTypedArray(i)?new i.constructor(i.subarray(e,o!==void 0?o:i.length)):i.slice(e,o)},convertArray:function(i,e,o){return!i||!o&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){function e(l,m){return i[l]-i[m]}const o=i.length,h=new Array(o);for(let l=0;l!==o;++l)h[l]=l;return h.sort(e),h},sortedArray:function(i,e,o){const h=i.length,l=new i.constructor(h);for(let m=0,x=0;x!==h;++m){const s=o[m]*e;for(let P=0;P!==e;++P)l[x++]=i[s+P]}return l},flattenJSON:function(i,e,o,h){let l=1,m=i[0];for(;m!==void 0&&m[h]===void 0;)m=i[l++];if(m===void 0)return;let x=m[h];if(x!==void 0)if(Array.isArray(x))do x=m[h],x!==void 0&&(e.push(m.time),o.push.apply(o,x)),m=i[l++];while(m!==void 0);else if(x.toArray!==void 0)do x=m[h],x!==void 0&&(e.push(m.time),x.toArray(o,o.length)),m=i[l++];while(m!==void 0);else do x=m[h],x!==void 0&&(e.push(m.time),o.push(x)),m=i[l++];while(m!==void 0)},subclip:function(i,e,o,h,l=30){const m=i.clone();m.name=e;const x=[];for(let P=0;P<m.tracks.length;++P){const C=m.tracks[P],F=C.getValueSize(),O=[],V=[];for(let J=0;J<C.times.length;++J){const ee=C.times[J]*l;if(!(ee<o||ee>=h)){O.push(C.times[J]);for(let se=0;se<F;++se)V.push(C.values[J*F+se])}}O.length!==0&&(C.times=Jr.convertArray(O,C.times.constructor),C.values=Jr.convertArray(V,C.values.constructor),x.push(C))}m.tracks=x;let s=1/0;for(let P=0;P<m.tracks.length;++P)s>m.tracks[P].times[0]&&(s=m.tracks[P].times[0]);for(let P=0;P<m.tracks.length;++P)m.tracks[P].shift(-1*s);return m.resetDuration(),m},makeClipAdditive:function(i,e=0,o=i,h=30){h<=0&&(h=30);const l=o.tracks.length,m=e/h;for(let x=0;x<l;++x){const s=o.tracks[x],P=s.ValueTypeName;if(P==="bool"||P==="string")continue;const C=i.tracks.find(function(le){return le.name===s.name&&le.ValueTypeName===P});if(C===void 0)continue;let F=0;const O=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(F=O/3);let V=0;const J=C.getValueSize();C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(V=J/3);const ee=s.times.length-1;let se;if(m<=s.times[0]){const le=F,ie=O-F;se=Jr.arraySlice(s.values,le,ie)}else if(m>=s.times[ee]){const le=ee*O+F,ie=le+O-F;se=Jr.arraySlice(s.values,le,ie)}else{const le=s.createInterpolant(),ie=F,it=O-F;le.evaluate(m),se=Jr.arraySlice(le.resultBuffer,ie,it)}P==="quaternion"&&new Rs().fromArray(se).normalize().conjugate().toArray(se);const fe=C.times.length;for(let le=0;le<fe;++le){const ie=le*J+V;if(P==="quaternion")Rs.multiplyQuaternionsFlat(C.values,ie,se,0,C.values,ie);else{const it=J-V*2;for(let Ve=0;Ve<it;++Ve)C.values[ie+Ve]-=se[Ve]}}}return i.blendMode=e2,i}};function Ta(i,e,o,h){this.parameterPositions=i,this._cachedIndex=0,this.resultBuffer=h!==void 0?h:new e.constructor(o),this.sampleValues=e,this.valueSize=o}Object.assign(Ta.prototype,{evaluate:function(i){const e=this.parameterPositions;let o=this._cachedIndex,h=e[o],l=e[o-1];e:{t:{let m;i:{n:if(!(i<h)){for(let x=o+2;;){if(h===void 0){if(i<l)break n;return o=e.length,this._cachedIndex=o,this.afterEnd_(o-1,i,l)}if(o===x)break;if(l=h,h=e[++o],i<h)break t}m=e.length;break i}if(!(i>=l)){const x=e[1];i<x&&(o=2,l=x);for(let s=o-2;;){if(l===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,h);if(o===s)break;if(h=l,l=e[--o-1],i>=l)break t}m=o,o=0;break i}break e}for(;o<m;){const x=o+m>>>1;i<e[x]?m=x:o=x+1}if(h=e[o],l=e[o-1],l===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,h);if(h===void 0)return o=e.length,this._cachedIndex=o,this.afterEnd_(o-1,l,i)}this._cachedIndex=o,this.intervalChanged_(o,l,h)}return this.interpolate_(o,l,i,h)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(i){const e=this.resultBuffer,o=this.sampleValues,h=this.valueSize,l=i*h;for(let m=0;m!==h;++m)e[m]=o[l+m];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});Object.assign(Ta.prototype,{beforeStart_:Ta.prototype.copySampleValue_,afterEnd_:Ta.prototype.copySampleValue_});function bb(i,e,o,h){Ta.call(this,i,e,o,h),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}bb.prototype=Object.assign(Object.create(Ta.prototype),{constructor:bb,DefaultSettings_:{endingStart:cd,endingEnd:cd},intervalChanged_:function(i,e,o){const h=this.parameterPositions;let l=i-2,m=i+1,x=h[l],s=h[m];if(x===void 0)switch(this.getSettings_().endingStart){case ud:l=i,x=2*e-o;break;case $_:l=h.length-2,x=e+h[l]-h[l+1];break;default:l=i,x=o}if(s===void 0)switch(this.getSettings_().endingEnd){case ud:m=i,s=2*o-e;break;case $_:m=1,s=o+h[1]-h[0];break;default:m=i-1,s=e}const P=(o-e)*.5,C=this.valueSize;this._weightPrev=P/(e-x),this._weightNext=P/(s-o),this._offsetPrev=l*C,this._offsetNext=m*C},interpolate_:function(i,e,o,h){const l=this.resultBuffer,m=this.sampleValues,x=this.valueSize,s=i*x,P=s-x,C=this._offsetPrev,F=this._offsetNext,O=this._weightPrev,V=this._weightNext,J=(o-e)/(h-e),ee=J*J,se=ee*J,fe=-O*se+2*O*ee-O*J,le=(1+O)*se+(-1.5-2*O)*ee+(-.5+O)*J+1,ie=(-1-V)*se+(1.5+V)*ee+.5*J,it=V*se-V*ee;for(let Ve=0;Ve!==x;++Ve)l[Ve]=fe*m[C+Ve]+le*m[P+Ve]+ie*m[s+Ve]+it*m[F+Ve];return l}});function q_(i,e,o,h){Ta.call(this,i,e,o,h)}q_.prototype=Object.assign(Object.create(Ta.prototype),{constructor:q_,interpolate_:function(i,e,o,h){const l=this.resultBuffer,m=this.sampleValues,x=this.valueSize,s=i*x,P=s-x,C=(o-e)/(h-e),F=1-C;for(let O=0;O!==x;++O)l[O]=m[P+O]*F+m[s+O]*C;return l}});function wb(i,e,o,h){Ta.call(this,i,e,o,h)}wb.prototype=Object.assign(Object.create(Ta.prototype),{constructor:wb,interpolate_:function(i){return this.copySampleValue_(i-1)}});class zl{constructor(e,o,h,l){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(o===void 0||o.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Jr.convertArray(o,this.TimeBufferType),this.values=Jr.convertArray(h,this.ValueBufferType),this.setInterpolation(l||this.DefaultInterpolation)}static toJSON(e){const o=e.constructor;let h;if(o.toJSON!==this.toJSON)h=o.toJSON(e);else{h={name:e.name,times:Jr.convertArray(e.times,Array),values:Jr.convertArray(e.values,Array)};const l=e.getInterpolation();l!==e.DefaultInterpolation&&(h.interpolation=l)}return h.type=e.ValueTypeName,h}InterpolantFactoryMethodDiscrete(e){return new wb(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new q_(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new bb(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let o;switch(e){case N_:o=this.InterpolantFactoryMethodDiscrete;break;case U_:o=this.InterpolantFactoryMethodLinear;break;case W0:o=this.InterpolantFactoryMethodSmooth;break}if(o===void 0){const h="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(h);return console.warn("THREE.KeyframeTrack:",h),this}return this.createInterpolant=o,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return N_;case this.InterpolantFactoryMethodLinear:return U_;case this.InterpolantFactoryMethodSmooth:return W0}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const o=this.times;for(let h=0,l=o.length;h!==l;++h)o[h]+=e}return this}scale(e){if(e!==1){const o=this.times;for(let h=0,l=o.length;h!==l;++h)o[h]*=e}return this}trim(e,o){const h=this.times,l=h.length;let m=0,x=l-1;for(;m!==l&&h[m]<e;)++m;for(;x!==-1&&h[x]>o;)--x;if(++x,m!==0||x!==l){m>=x&&(x=Math.max(x,1),m=x-1);const s=this.getValueSize();this.times=Jr.arraySlice(h,m,x),this.values=Jr.arraySlice(this.values,m*s,x*s)}return this}validate(){let e=!0;const o=this.getValueSize();o-Math.floor(o)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const h=this.times,l=this.values,m=h.length;m===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let x=null;for(let s=0;s!==m;s++){const P=h[s];if(typeof P=="number"&&isNaN(P)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,P),e=!1;break}if(x!==null&&x>P){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,P,x),e=!1;break}x=P}if(l!==void 0&&Jr.isTypedArray(l))for(let s=0,P=l.length;s!==P;++s){const C=l[s];if(isNaN(C)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,C),e=!1;break}}return e}optimize(){const e=Jr.arraySlice(this.times),o=Jr.arraySlice(this.values),h=this.getValueSize(),l=this.getInterpolation()===W0,m=e.length-1;let x=1;for(let s=1;s<m;++s){let P=!1;const C=e[s],F=e[s+1];if(C!==F&&(s!==1||C!==e[0]))if(l)P=!0;else{const O=s*h,V=O-h,J=O+h;for(let ee=0;ee!==h;++ee){const se=o[O+ee];if(se!==o[V+ee]||se!==o[J+ee]){P=!0;break}}}if(P){if(s!==x){e[x]=e[s];const O=s*h,V=x*h;for(let J=0;J!==h;++J)o[V+J]=o[O+J]}++x}}if(m>0){e[x]=e[m];for(let s=m*h,P=x*h,C=0;C!==h;++C)o[P+C]=o[s+C];++x}return x!==e.length?(this.times=Jr.arraySlice(e,0,x),this.values=Jr.arraySlice(o,0,x*h)):(this.times=e,this.values=o),this}clone(){const e=Jr.arraySlice(this.times,0),o=Jr.arraySlice(this.values,0),h=this.constructor,l=new h(this.name,e,o);return l.createInterpolant=this.createInterpolant,l}}zl.prototype.TimeBufferType=Float32Array;zl.prototype.ValueBufferType=Float32Array;zl.prototype.DefaultInterpolation=U_;class Ad extends zl{}Ad.prototype.ValueTypeName="bool";Ad.prototype.ValueBufferType=Array;Ad.prototype.DefaultInterpolation=N_;Ad.prototype.InterpolantFactoryMethodLinear=void 0;Ad.prototype.InterpolantFactoryMethodSmooth=void 0;class h2 extends zl{}h2.prototype.ValueTypeName="color";class X_ extends zl{}X_.prototype.ValueTypeName="number";function Sb(i,e,o,h){Ta.call(this,i,e,o,h)}Sb.prototype=Object.assign(Object.create(Ta.prototype),{constructor:Sb,interpolate_:function(i,e,o,h){const l=this.resultBuffer,m=this.sampleValues,x=this.valueSize,s=(o-e)/(h-e);let P=i*x;for(let C=P+x;P!==C;P+=4)Rs.slerpFlat(l,0,m,P-x,m,P,s);return l}});class Yp extends zl{InterpolantFactoryMethodLinear(e){return new Sb(this.times,this.values,this.getValueSize(),e)}}Yp.prototype.ValueTypeName="quaternion";Yp.prototype.DefaultInterpolation=U_;Yp.prototype.InterpolantFactoryMethodSmooth=void 0;class Pd extends zl{}Pd.prototype.ValueTypeName="string";Pd.prototype.ValueBufferType=Array;Pd.prototype.DefaultInterpolation=N_;Pd.prototype.InterpolantFactoryMethodLinear=void 0;Pd.prototype.InterpolantFactoryMethodSmooth=void 0;class J_ extends zl{}J_.prototype.ValueTypeName="vector";class mE{constructor(e,o=-1,h,l=Rw){this.name=e,this.tracks=h,this.duration=o,this.blendMode=l,this.uuid=kn.generateUUID(),this.duration<0&&this.resetDuration()}static parse(e){const o=[],h=e.tracks,l=1/(e.fps||1);for(let x=0,s=h.length;x!==s;++x)o.push(hte(h[x]).scale(l));const m=new this(e.name,e.duration,o,e.blendMode);return m.uuid=e.uuid,m}static toJSON(e){const o=[],h=e.tracks,l={name:e.name,duration:e.duration,tracks:o,uuid:e.uuid,blendMode:e.blendMode};for(let m=0,x=h.length;m!==x;++m)o.push(zl.toJSON(h[m]));return l}static CreateFromMorphTargetSequence(e,o,h,l){const m=o.length,x=[];for(let s=0;s<m;s++){let P=[],C=[];P.push((s+m-1)%m,s,(s+1)%m),C.push(0,1,0);const F=Jr.getKeyframeOrder(P);P=Jr.sortedArray(P,1,F),C=Jr.sortedArray(C,1,F),!l&&P[0]===0&&(P.push(m),C.push(C[0])),x.push(new X_(".morphTargetInfluences["+o[s].name+"]",P,C).scale(1/h))}return new this(e,-1,x)}static findByName(e,o){let h=e;if(!Array.isArray(e)){const l=e;h=l.geometry&&l.geometry.animations||l.animations}for(let l=0;l<h.length;l++)if(h[l].name===o)return h[l];return null}static CreateClipsFromMorphTargetSequences(e,o,h){const l={},m=/^([\w-]*?)([\d]+)$/;for(let s=0,P=e.length;s<P;s++){const C=e[s],F=C.name.match(m);if(F&&F.length>1){const O=F[1];let V=l[O];V||(l[O]=V=[]),V.push(C)}}const x=[];for(const s in l)x.push(this.CreateFromMorphTargetSequence(s,l[s],o,h));return x}static parseAnimation(e,o){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const h=function(O,V,J,ee,se){if(J.length!==0){const fe=[],le=[];Jr.flattenJSON(J,fe,le,ee),fe.length!==0&&se.push(new O(V,fe,le))}},l=[],m=e.name||"default",x=e.fps||30,s=e.blendMode;let P=e.length||-1;const C=e.hierarchy||[];for(let O=0;O<C.length;O++){const V=C[O].keys;if(!(!V||V.length===0))if(V[0].morphTargets){const J={};let ee;for(ee=0;ee<V.length;ee++)if(V[ee].morphTargets)for(let se=0;se<V[ee].morphTargets.length;se++)J[V[ee].morphTargets[se]]=-1;for(const se in J){const fe=[],le=[];for(let ie=0;ie!==V[ee].morphTargets.length;++ie){const it=V[ee];fe.push(it.time),le.push(it.morphTarget===se?1:0)}l.push(new X_(".morphTargetInfluence["+se+"]",fe,le))}P=J.length*x}else{const J=".bones["+o[O].name+"]";h(J_,J+".position",V,"pos",l),h(Yp,J+".quaternion",V,"rot",l),h(J_,J+".scale",V,"scl",l)}}return l.length===0?null:new this(m,P,l,s)}resetDuration(){const e=this.tracks;let o=0;for(let h=0,l=e.length;h!==l;++h){const m=this.tracks[h];o=Math.max(o,m.times[m.times.length-1])}return this.duration=o,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let o=0;o<this.tracks.length;o++)e=e&&this.tracks[o].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let o=0;o<this.tracks.length;o++)e.push(this.tracks[o].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ute(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return X_;case"vector":case"vector2":case"vector3":case"vector4":return J_;case"color":return h2;case"quaternion":return Yp;case"bool":case"boolean":return Ad;case"string":return Pd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function hte(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=ute(i.type);if(i.times===void 0){const o=[],h=[];Jr.flattenJSON(i.keys,o,h,"value"),i.times=o,i.values=h}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const vd={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};function EU(i,e,o){const h=this;let l=!1,m=0,x=0,s;const P=[];this.onStart=void 0,this.onLoad=i,this.onProgress=e,this.onError=o,this.itemStart=function(C){x++,l===!1&&h.onStart!==void 0&&h.onStart(C,m,x),l=!0},this.itemEnd=function(C){m++,h.onProgress!==void 0&&h.onProgress(C,m,x),m===x&&(l=!1,h.onLoad!==void 0&&h.onLoad())},this.itemError=function(C){h.onError!==void 0&&h.onError(C)},this.resolveURL=function(C){return s?s(C):C},this.setURLModifier=function(C){return s=C,this},this.addHandler=function(C,F){return P.push(C,F),this},this.removeHandler=function(C){const F=P.indexOf(C);return F!==-1&&P.splice(F,2),this},this.getHandler=function(C){for(let F=0,O=P.length;F<O;F+=2){const V=P[F],J=P[F+1];if(V.global&&(V.lastIndex=0),V.test(C))return J}return null}}const IU=new EU;function Ds(i){this.manager=i!==void 0?i:IU,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Ds.prototype,{load:function(){},loadAsync:function(i,e){const o=this;return new Promise(function(h,l){o.load(i,h,e,l)})},parse:function(){},setCrossOrigin:function(i){return this.crossOrigin=i,this},setWithCredentials:function(i){return this.withCredentials=i,this},setPath:function(i){return this.path=i,this},setResourcePath:function(i){return this.resourcePath=i,this},setRequestHeader:function(i){return this.requestHeader=i,this}});const Sl={};function Y_(i){Ds.call(this,i)}Y_.prototype=Object.assign(Object.create(Ds.prototype),{constructor:Y_,load:function(i,e,o,h){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const l=this,m=vd.get(i);if(m!==void 0)return l.manager.itemStart(i),setTimeout(function(){e&&e(m),l.manager.itemEnd(i)},0),m;if(Sl[i]!==void 0){Sl[i].push({onLoad:e,onProgress:o,onError:h});return}const x=/^data:(.*?)(;base64)?,(.*)$/,s=i.match(x);let P;if(s){const C=s[1],F=!!s[2];let O=s[3];O=decodeURIComponent(O),F&&(O=atob(O));try{let V;const J=(this.responseType||"").toLowerCase();switch(J){case"arraybuffer":case"blob":const ee=new Uint8Array(O.length);for(let fe=0;fe<O.length;fe++)ee[fe]=O.charCodeAt(fe);J==="blob"?V=new Blob([ee.buffer],{type:C}):V=ee.buffer;break;case"document":V=new DOMParser().parseFromString(O,C);break;case"json":V=JSON.parse(O);break;default:V=O;break}setTimeout(function(){e&&e(V),l.manager.itemEnd(i)},0)}catch(V){setTimeout(function(){h&&h(V),l.manager.itemError(i),l.manager.itemEnd(i)},0)}}else{Sl[i]=[],Sl[i].push({onLoad:e,onProgress:o,onError:h}),P=new XMLHttpRequest,P.open("GET",i,!0),P.addEventListener("load",function(C){const F=this.response,O=Sl[i];if(delete Sl[i],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),vd.add(i,F);for(let V=0,J=O.length;V<J;V++){const ee=O[V];ee.onLoad&&ee.onLoad(F)}l.manager.itemEnd(i)}else{for(let V=0,J=O.length;V<J;V++){const ee=O[V];ee.onError&&ee.onError(C)}l.manager.itemError(i),l.manager.itemEnd(i)}},!1),P.addEventListener("progress",function(C){const F=Sl[i];for(let O=0,V=F.length;O<V;O++){const J=F[O];J.onProgress&&J.onProgress(C)}},!1),P.addEventListener("error",function(C){const F=Sl[i];delete Sl[i];for(let O=0,V=F.length;O<V;O++){const J=F[O];J.onError&&J.onError(C)}l.manager.itemError(i),l.manager.itemEnd(i)},!1),P.addEventListener("abort",function(C){const F=Sl[i];delete Sl[i];for(let O=0,V=F.length;O<V;O++){const J=F[O];J.onError&&J.onError(C)}l.manager.itemError(i),l.manager.itemEnd(i)},!1),this.responseType!==void 0&&(P.responseType=this.responseType),this.withCredentials!==void 0&&(P.withCredentials=this.withCredentials),P.overrideMimeType&&P.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const C in this.requestHeader)P.setRequestHeader(C,this.requestHeader[C]);P.send(null)}return l.manager.itemStart(i),P},setResponseType:function(i){return this.responseType=i,this},setMimeType:function(i){return this.mimeType=i,this}});function gE(i){Ds.call(this,i)}gE.prototype=Object.assign(Object.create(Ds.prototype),{constructor:gE,load:function(i,e,o,h){const l=this,m=[],x=new u2,s=new Y_(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(l.withCredentials);let P=0;function C(F){s.load(i[F],function(O){const V=l.parse(O,!0);m[F]={width:V.width,height:V.height,format:V.format,mipmaps:V.mipmaps},P+=1,P===6&&(V.mipmapCount===1&&(x.minFilter=Ko),x.image=m,x.format=V.format,x.needsUpdate=!0,e&&e(x))},o,h)}if(Array.isArray(i))for(let F=0,O=i.length;F<O;++F)C(F);else s.load(i,function(F){const O=l.parse(F,!0);if(O.isCubemap){const V=O.mipmaps.length/O.mipmapCount;for(let J=0;J<V;J++){m[J]={mipmaps:[]};for(let ee=0;ee<O.mipmapCount;ee++)m[J].mipmaps.push(O.mipmaps[J*O.mipmapCount+ee]),m[J].format=O.format,m[J].width=O.width,m[J].height=O.height}x.image=m}else x.image.width=O.width,x.image.height=O.height,x.mipmaps=O.mipmaps;O.mipmapCount===1&&(x.minFilter=Ko),x.format=O.format,x.needsUpdate=!0,e&&e(x)},o,h);return x}});class d2 extends Ds{constructor(e){super(e)}load(e,o,h,l){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const m=this,x=vd.get(e);if(x!==void 0)return m.manager.itemStart(e),setTimeout(function(){o&&o(x),m.manager.itemEnd(e)},0),x;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function P(){s.removeEventListener("load",P,!1),s.removeEventListener("error",C,!1),vd.add(e,this),o&&o(this),m.manager.itemEnd(e)}function C(F){s.removeEventListener("load",P,!1),s.removeEventListener("error",C,!1),l&&l(F),m.manager.itemError(e),m.manager.itemEnd(e)}return s.addEventListener("load",P,!1),s.addEventListener("error",C,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),m.manager.itemStart(e),s.src=e,s}}class MU extends Ds{constructor(e){super(e)}load(e,o,h,l){const m=new Oy,x=new d2(this.manager);x.setCrossOrigin(this.crossOrigin),x.setPath(this.path);let s=0;function P(C){x.load(e[C],function(F){m.images[C]=F,s++,s===6&&(m.needsUpdate=!0,o&&o(m))},void 0,l)}for(let C=0;C<e.length;++C)P(C);return m}}function _E(i){Ds.call(this,i)}_E.prototype=Object.assign(Object.create(Ds.prototype),{constructor:_E,load:function(i,e,o,h){const l=this,m=new kw,x=new Y_(this.manager);return x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(l.withCredentials),x.load(i,function(s){const P=l.parse(s);P&&(P.image!==void 0?m.image=P.image:P.data!==void 0&&(m.image.width=P.width,m.image.height=P.height,m.image.data=P.data),m.wrapS=P.wrapS!==void 0?P.wrapS:la,m.wrapT=P.wrapT!==void 0?P.wrapT:la,m.magFilter=P.magFilter!==void 0?P.magFilter:Ko,m.minFilter=P.minFilter!==void 0?P.minFilter:Ko,m.anisotropy=P.anisotropy!==void 0?P.anisotropy:1,P.encoding!==void 0&&(m.encoding=P.encoding),P.flipY!==void 0&&(m.flipY=P.flipY),P.format!==void 0&&(m.format=P.format),P.type!==void 0&&(m.type=P.type),P.mipmaps!==void 0&&(m.mipmaps=P.mipmaps,m.minFilter=Dy),P.mipmapCount===1&&(m.minFilter=Ko),m.needsUpdate=!0,e&&e(m,P))},o,h),m}});function Tb(i){Ds.call(this,i)}Tb.prototype=Object.assign(Object.create(Ds.prototype),{constructor:Tb,load:function(i,e,o,h){const l=new es,m=new d2(this.manager);return m.setCrossOrigin(this.crossOrigin),m.setPath(this.path),m.load(i,function(x){l.image=x;const s=i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0;l.format=s?$u:Ja,l.needsUpdate=!0,e!==void 0&&e(l)},o,h),l}});function Ys(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(Ys.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(i,e){const o=this.getUtoTmapping(i);return this.getPoint(o,e)},getPoints:function(i=5){const e=[];for(let o=0;o<=i;o++)e.push(this.getPoint(o/i));return e},getSpacedPoints:function(i=5){const e=[];for(let o=0;o<=i;o++)e.push(this.getPointAt(o/i));return e},getLength:function(){const i=this.getLengths();return i[i.length-1]},getLengths:function(i){if(i===void 0&&(i=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===i+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let o,h=this.getPoint(0),l=0;e.push(0);for(let m=1;m<=i;m++)o=this.getPoint(m/i),l+=o.distanceTo(h),e.push(l),h=o;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(i,e){const o=this.getLengths();let h=0;const l=o.length;let m;e?m=e:m=i*o[l-1];let x=0,s=l-1,P;for(;x<=s;)if(h=Math.floor(x+(s-x)/2),P=o[h]-m,P<0)x=h+1;else if(P>0)s=h-1;else{s=h;break}if(h=s,o[h]===m)return h/(l-1);const C=o[h],O=o[h+1]-C,V=(m-C)/O;return(h+V)/(l-1)},getTangent:function(i,e){let h=i-1e-4,l=i+1e-4;h<0&&(h=0),l>1&&(l=1);const m=this.getPoint(h),x=this.getPoint(l),s=e||(m.isVector2?new mi:new He);return s.copy(x).sub(m).normalize(),s},getTangentAt:function(i,e){const o=this.getUtoTmapping(i);return this.getTangent(o,e)},computeFrenetFrames:function(i,e){const o=new He,h=[],l=[],m=[],x=new He,s=new tn;for(let V=0;V<=i;V++){const J=V/i;h[V]=this.getTangentAt(J,new He),h[V].normalize()}l[0]=new He,m[0]=new He;let P=Number.MAX_VALUE;const C=Math.abs(h[0].x),F=Math.abs(h[0].y),O=Math.abs(h[0].z);C<=P&&(P=C,o.set(1,0,0)),F<=P&&(P=F,o.set(0,1,0)),O<=P&&o.set(0,0,1),x.crossVectors(h[0],o).normalize(),l[0].crossVectors(h[0],x),m[0].crossVectors(h[0],l[0]);for(let V=1;V<=i;V++){if(l[V]=l[V-1].clone(),m[V]=m[V-1].clone(),x.crossVectors(h[V-1],h[V]),x.length()>Number.EPSILON){x.normalize();const J=Math.acos(kn.clamp(h[V-1].dot(h[V]),-1,1));l[V].applyMatrix4(s.makeRotationAxis(x,J))}m[V].crossVectors(h[V],l[V])}if(e===!0){let V=Math.acos(kn.clamp(l[0].dot(l[i]),-1,1));V/=i,h[0].dot(x.crossVectors(l[0],l[i]))>0&&(V=-V);for(let J=1;J<=i;J++)l[J].applyMatrix4(s.makeRotationAxis(h[J],V*J)),m[J].crossVectors(h[J],l[J])}return{tangents:h,normals:l,binormals:m}},clone:function(){return new this.constructor().copy(this)},copy:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this},toJSON:function(){const i={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return i.arcLengthDivisions=this.arcLengthDivisions,i.type=this.type,i},fromJSON:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}});class By extends Ys{constructor(e=0,o=0,h=1,l=1,m=0,x=Math.PI*2,s=!1,P=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=o,this.xRadius=h,this.yRadius=l,this.aStartAngle=m,this.aEndAngle=x,this.aClockwise=s,this.aRotation=P}getPoint(e,o){const h=o||new mi,l=Math.PI*2;let m=this.aEndAngle-this.aStartAngle;const x=Math.abs(m)<Number.EPSILON;for(;m<0;)m+=l;for(;m>l;)m-=l;m<Number.EPSILON&&(x?m=0:m=l),this.aClockwise===!0&&!x&&(m===l?m=-l:m=m-l);const s=this.aStartAngle+e*m;let P=this.aX+this.xRadius*Math.cos(s),C=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){const F=Math.cos(this.aRotation),O=Math.sin(this.aRotation),V=P-this.aX,J=C-this.aY;P=V*F-J*O+this.aX,C=V*O+J*F+this.aY}return h.set(P,C)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}By.prototype.isEllipseCurve=!0;class f2 extends By{constructor(e,o,h,l,m,x){super(e,o,h,h,l,m,x),this.type="ArcCurve"}}f2.prototype.isArcCurve=!0;function p2(){let i=0,e=0,o=0,h=0;function l(m,x,s,P){i=m,e=s,o=-3*m+3*x-2*s-P,h=2*m-2*x+s+P}return{initCatmullRom:function(m,x,s,P,C){l(x,s,C*(s-m),C*(P-x))},initNonuniformCatmullRom:function(m,x,s,P,C,F,O){let V=(x-m)/C-(s-m)/(C+F)+(s-x)/F,J=(s-x)/F-(P-x)/(F+O)+(P-s)/O;V*=F,J*=F,l(x,s,V,J)},calc:function(m){const x=m*m,s=x*m;return i+e*m+o*x+h*s}}}const G0=new He,ST=new p2,TT=new p2,ET=new p2;class m2 extends Ys{constructor(e=[],o=!1,h="centripetal",l=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=o,this.curveType=h,this.tension=l}getPoint(e,o=new He){const h=o,l=this.points,m=l.length,x=(m-(this.closed?0:1))*e;let s=Math.floor(x),P=x-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/m)+1)*m:P===0&&s===m-1&&(s=m-2,P=1);let C,F;this.closed||s>0?C=l[(s-1)%m]:(G0.subVectors(l[0],l[1]).add(l[0]),C=G0);const O=l[s%m],V=l[(s+1)%m];if(this.closed||s+2<m?F=l[(s+2)%m]:(G0.subVectors(l[m-1],l[m-2]).add(l[m-1]),F=G0),this.curveType==="centripetal"||this.curveType==="chordal"){const J=this.curveType==="chordal"?.5:.25;let ee=Math.pow(C.distanceToSquared(O),J),se=Math.pow(O.distanceToSquared(V),J),fe=Math.pow(V.distanceToSquared(F),J);se<1e-4&&(se=1),ee<1e-4&&(ee=se),fe<1e-4&&(fe=se),ST.initNonuniformCatmullRom(C.x,O.x,V.x,F.x,ee,se,fe),TT.initNonuniformCatmullRom(C.y,O.y,V.y,F.y,ee,se,fe),ET.initNonuniformCatmullRom(C.z,O.z,V.z,F.z,ee,se,fe)}else this.curveType==="catmullrom"&&(ST.initCatmullRom(C.x,O.x,V.x,F.x,this.tension),TT.initCatmullRom(C.y,O.y,V.y,F.y,this.tension),ET.initCatmullRom(C.z,O.z,V.z,F.z,this.tension));return h.set(ST.calc(P),TT.calc(P),ET.calc(P)),h}copy(e){super.copy(e),this.points=[];for(let o=0,h=e.points.length;o<h;o++){const l=e.points[o];this.points.push(l.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let o=0,h=this.points.length;o<h;o++){const l=this.points[o];e.points.push(l.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let o=0,h=e.points.length;o<h;o++){const l=e.points[o];this.points.push(new He().fromArray(l))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}m2.prototype.isCatmullRomCurve3=!0;function yL(i,e,o,h,l){const m=(h-e)*.5,x=(l-o)*.5,s=i*i,P=i*s;return(2*o-2*h+m+x)*P+(-3*o+3*h-2*m-x)*s+m*i+o}function dte(i,e){const o=1-i;return o*o*e}function fte(i,e){return 2*(1-i)*i*e}function pte(i,e){return i*i*e}function E_(i,e,o,h){return dte(i,e)+fte(i,o)+pte(i,h)}function mte(i,e){const o=1-i;return o*o*o*e}function gte(i,e){const o=1-i;return 3*o*o*i*e}function _te(i,e){return 3*(1-i)*i*i*e}function yte(i,e){return i*i*i*e}function I_(i,e,o,h,l){return mte(i,e)+gte(i,o)+_te(i,h)+yte(i,l)}class Bw extends Ys{constructor(e=new mi,o=new mi,h=new mi,l=new mi){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=o,this.v2=h,this.v3=l}getPoint(e,o=new mi){const h=o,l=this.v0,m=this.v1,x=this.v2,s=this.v3;return h.set(I_(e,l.x,m.x,x.x,s.x),I_(e,l.y,m.y,x.y,s.y)),h}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Bw.prototype.isCubicBezierCurve=!0;class g2 extends Ys{constructor(e=new He,o=new He,h=new He,l=new He){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=o,this.v2=h,this.v3=l}getPoint(e,o=new He){const h=o,l=this.v0,m=this.v1,x=this.v2,s=this.v3;return h.set(I_(e,l.x,m.x,x.x,s.x),I_(e,l.y,m.y,x.y,s.y),I_(e,l.z,m.z,x.z,s.z)),h}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}g2.prototype.isCubicBezierCurve3=!0;class Ny extends Ys{constructor(e=new mi,o=new mi){super(),this.type="LineCurve",this.v1=e,this.v2=o}getPoint(e,o=new mi){const h=o;return e===1?h.copy(this.v2):(h.copy(this.v2).sub(this.v1),h.multiplyScalar(e).add(this.v1)),h}getPointAt(e,o){return this.getPoint(e,o)}getTangent(e,o){const h=o||new mi;return h.copy(this.v2).sub(this.v1).normalize(),h}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Ny.prototype.isLineCurve=!0;class AU extends Ys{constructor(e=new He,o=new He){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=o}getPoint(e,o=new He){const h=o;return e===1?h.copy(this.v2):(h.copy(this.v2).sub(this.v1),h.multiplyScalar(e).add(this.v1)),h}getPointAt(e,o){return this.getPoint(e,o)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Nw extends Ys{constructor(e=new mi,o=new mi,h=new mi){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=o,this.v2=h}getPoint(e,o=new mi){const h=o,l=this.v0,m=this.v1,x=this.v2;return h.set(E_(e,l.x,m.x,x.x),E_(e,l.y,m.y,x.y)),h}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Nw.prototype.isQuadraticBezierCurve=!0;class _2 extends Ys{constructor(e=new He,o=new He,h=new He){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=o,this.v2=h}getPoint(e,o=new He){const h=o,l=this.v0,m=this.v1,x=this.v2;return h.set(E_(e,l.x,m.x,x.x),E_(e,l.y,m.y,x.y),E_(e,l.z,m.z,x.z)),h}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}_2.prototype.isQuadraticBezierCurve3=!0;class Uw extends Ys{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,o=new mi){const h=o,l=this.points,m=(l.length-1)*e,x=Math.floor(m),s=m-x,P=l[x===0?x:x-1],C=l[x],F=l[x>l.length-2?l.length-1:x+1],O=l[x>l.length-3?l.length-1:x+2];return h.set(yL(s,P.x,C.x,F.x,O.x),yL(s,P.y,C.y,F.y,O.y)),h}copy(e){super.copy(e),this.points=[];for(let o=0,h=e.points.length;o<h;o++){const l=e.points[o];this.points.push(l.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let o=0,h=this.points.length;o<h;o++){const l=this.points[o];e.points.push(l.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let o=0,h=e.points.length;o<h;o++){const l=e.points[o];this.points.push(new mi().fromArray(l))}return this}}Uw.prototype.isSplineCurve=!0;var vte=Object.freeze({__proto__:null,ArcCurve:f2,CatmullRomCurve3:m2,CubicBezierCurve:Bw,CubicBezierCurve3:g2,EllipseCurve:By,LineCurve:Ny,LineCurve3:AU,QuadraticBezierCurve:Nw,QuadraticBezierCurve3:_2,SplineCurve:Uw});class PU extends Ys{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),o=this.curves[this.curves.length-1].getPoint(1);e.equals(o)||this.curves.push(new Ny(o,e))}getPoint(e){const o=e*this.getLength(),h=this.getCurveLengths();let l=0;for(;l<h.length;){if(h[l]>=o){const m=h[l]-o,x=this.curves[l],s=x.getLength(),P=s===0?0:1-m/s;return x.getPointAt(P)}l++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let o=0;for(let h=0,l=this.curves.length;h<l;h++)o+=this.curves[h].getLength(),e.push(o);return this.cacheLengths=e,e}getSpacedPoints(e=40){const o=[];for(let h=0;h<=e;h++)o.push(this.getPoint(h/e));return this.autoClose&&o.push(o[0]),o}getPoints(e=12){const o=[];let h;for(let l=0,m=this.curves;l<m.length;l++){const x=m[l],s=x&&x.isEllipseCurve?e*2:x&&(x.isLineCurve||x.isLineCurve3)?1:x&&x.isSplineCurve?e*x.points.length:e,P=x.getPoints(s);for(let C=0;C<P.length;C++){const F=P[C];h&&h.equals(F)||(o.push(F),h=F)}}return this.autoClose&&o.length>1&&!o[o.length-1].equals(o[0])&&o.push(o[0]),o}copy(e){super.copy(e),this.curves=[];for(let o=0,h=e.curves.length;o<h;o++){const l=e.curves[o];this.curves.push(l.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let o=0,h=this.curves.length;o<h;o++){const l=this.curves[o];e.curves.push(l.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let o=0,h=e.curves.length;o<h;o++){const l=e.curves[o];this.curves.push(new vte[l.type]().fromJSON(l))}return this}}class Eb extends PU{constructor(e){super(),this.type="Path",this.currentPoint=new mi,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let o=1,h=e.length;o<h;o++)this.lineTo(e[o].x,e[o].y);return this}moveTo(e,o){return this.currentPoint.set(e,o),this}lineTo(e,o){const h=new Ny(this.currentPoint.clone(),new mi(e,o));return this.curves.push(h),this.currentPoint.set(e,o),this}quadraticCurveTo(e,o,h,l){const m=new Nw(this.currentPoint.clone(),new mi(e,o),new mi(h,l));return this.curves.push(m),this.currentPoint.set(h,l),this}bezierCurveTo(e,o,h,l,m,x){const s=new Bw(this.currentPoint.clone(),new mi(e,o),new mi(h,l),new mi(m,x));return this.curves.push(s),this.currentPoint.set(m,x),this}splineThru(e){const o=[this.currentPoint.clone()].concat(e),h=new Uw(o);return this.curves.push(h),this.currentPoint.copy(e[e.length-1]),this}arc(e,o,h,l,m,x){const s=this.currentPoint.x,P=this.currentPoint.y;return this.absarc(e+s,o+P,h,l,m,x),this}absarc(e,o,h,l,m,x){return this.absellipse(e,o,h,h,l,m,x),this}ellipse(e,o,h,l,m,x,s,P){const C=this.currentPoint.x,F=this.currentPoint.y;return this.absellipse(e+C,o+F,h,l,m,x,s,P),this}absellipse(e,o,h,l,m,x,s,P){const C=new By(e,o,h,l,m,x,s,P);if(this.curves.length>0){const O=C.getPoint(0);O.equals(this.currentPoint)||this.lineTo(O.x,O.y)}this.curves.push(C);const F=C.getPoint(1);return this.currentPoint.copy(F),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class $w extends Eb{constructor(e){super(e),this.uuid=kn.generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(e){const o=[];for(let h=0,l=this.holes.length;h<l;h++)o[h]=this.holes[h].getPoints(e);return o}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let o=0,h=e.holes.length;o<h;o++){const l=e.holes[o];this.holes.push(l.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let o=0,h=this.holes.length;o<h;o++){const l=this.holes[o];e.holes.push(l.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let o=0,h=e.holes.length;o<h;o++){const l=e.holes[o];this.holes.push(new Eb().fromJSON(l))}return this}}class Pl extends Rn{constructor(e,o=1){super(),this.type="Light",this.color=new dn(e),this.intensity=o}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const o=super.toJSON(e);return o.object.color=this.color.getHex(),o.object.intensity=this.intensity,this.groundColor!==void 0&&(o.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(o.object.distance=this.distance),this.angle!==void 0&&(o.object.angle=this.angle),this.decay!==void 0&&(o.object.decay=this.decay),this.penumbra!==void 0&&(o.object.penumbra=this.penumbra),this.shadow!==void 0&&(o.object.shadow=this.shadow.toJSON()),o}}Pl.prototype.isLight=!0;class zU extends Pl{constructor(e,o,h){super(e,h),this.type="HemisphereLight",this.position.copy(Rn.DefaultUp),this.updateMatrix(),this.groundColor=new dn(o)}copy(e){return Pl.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}zU.prototype.isHemisphereLight=!0;const vL=new tn,xL=new He,bL=new He;class y2{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new mi(512,512),this.map=null,this.mapPass=null,this.matrix=new tn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Fy,this._frameExtents=new mi(1,1),this._viewportCount=1,this._viewports=[new zr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const o=this.camera,h=this.matrix;xL.setFromMatrixPosition(e.matrixWorld),o.position.copy(xL),bL.setFromMatrixPosition(e.target.matrixWorld),o.lookAt(bL),o.updateMatrixWorld(),vL.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vL),h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(o.projectionMatrix),h.multiply(o.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class CU extends y2{constructor(){super(new zs(50,1,.5,500)),this.focus=1}updateMatrices(e){const o=this.camera,h=kn.RAD2DEG*2*e.angle*this.focus,l=this.mapSize.width/this.mapSize.height,m=e.distance||o.far;(h!==o.fov||l!==o.aspect||m!==o.far)&&(o.fov=h,o.aspect=l,o.far=m,o.updateProjectionMatrix()),super.updateMatrices(e)}}CU.prototype.isSpotLightShadow=!0;class RU extends Pl{constructor(e,o,h=0,l=Math.PI/3,m=0,x=1){super(e,o),this.type="SpotLight",this.position.copy(Rn.DefaultUp),this.updateMatrix(),this.target=new Rn,this.distance=h,this.angle=l,this.penumbra=m,this.decay=x,this.shadow=new CU}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}RU.prototype.isSpotLight=!0;const wL=new tn,v_=new He,IT=new He;class LU extends y2{constructor(){super(new zs(90,1,.5,500)),this._frameExtents=new mi(4,2),this._viewportCount=6,this._viewports=[new zr(2,1,1,1),new zr(0,1,1,1),new zr(3,1,1,1),new zr(1,1,1,1),new zr(3,0,1,1),new zr(1,0,1,1)],this._cubeDirections=[new He(1,0,0),new He(-1,0,0),new He(0,0,1),new He(0,0,-1),new He(0,1,0),new He(0,-1,0)],this._cubeUps=[new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,0,1),new He(0,0,-1)]}updateMatrices(e,o=0){const h=this.camera,l=this.matrix;v_.setFromMatrixPosition(e.matrixWorld),h.position.copy(v_),IT.copy(h.position),IT.add(this._cubeDirections[o]),h.up.copy(this._cubeUps[o]),h.lookAt(IT),h.updateMatrixWorld(),l.makeTranslation(-v_.x,-v_.y,-v_.z),wL.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),this._frustum.setFromProjectionMatrix(wL)}}LU.prototype.isPointLightShadow=!0;class v2 extends Pl{constructor(e,o,h=0,l=1){super(e,o),this.type="PointLight",this.distance=h,this.decay=l,this.shadow=new LU}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}v2.prototype.isPointLight=!0;class x2 extends Yu{constructor(e=-1,o=1,h=1,l=-1,m=.1,x=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=o,this.top=h,this.bottom=l,this.near=m,this.far=x,this.updateProjectionMatrix()}copy(e,o){return super.copy(e,o),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,o,h,l,m,x){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=o,this.view.offsetX=h,this.view.offsetY=l,this.view.width=m,this.view.height=x,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),o=(this.top-this.bottom)/(2*this.zoom),h=(this.right+this.left)/2,l=(this.top+this.bottom)/2;let m=h-e,x=h+e,s=l+o,P=l-o;if(this.view!==null&&this.view.enabled){const C=(this.right-this.left)/this.view.fullWidth/this.zoom,F=(this.top-this.bottom)/this.view.fullHeight/this.zoom;m+=C*this.view.offsetX,x=m+C*this.view.width,s-=F*this.view.offsetY,P=s-F*this.view.height}this.projectionMatrix.makeOrthographic(m,x,s,P,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const o=Rn.prototype.toJSON.call(this,e);return o.object.zoom=this.zoom,o.object.left=this.left,o.object.right=this.right,o.object.top=this.top,o.object.bottom=this.bottom,o.object.near=this.near,o.object.far=this.far,this.view!==null&&(o.object.view=Object.assign({},this.view)),o}}x2.prototype.isOrthographicCamera=!0;class DU extends y2{constructor(){super(new x2(-5,5,5,-5,.5,500))}}DU.prototype.isDirectionalLightShadow=!0;class Ib extends Pl{constructor(e,o){super(e,o),this.type="DirectionalLight",this.position.copy(Rn.DefaultUp),this.updateMatrix(),this.target=new Rn,this.shadow=new DU}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Ib.prototype.isDirectionalLight=!0;class b2 extends Pl{constructor(e,o){super(e,o),this.type="AmbientLight"}}b2.prototype.isAmbientLight=!0;class kU extends Pl{constructor(e,o,h=10,l=10){super(e,o),this.type="RectAreaLight",this.width=h,this.height=l}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const o=super.toJSON(e);return o.object.width=this.width,o.object.height=this.height,o}}kU.prototype.isRectAreaLight=!0;class w2{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new He)}set(e){for(let o=0;o<9;o++)this.coefficients[o].copy(e[o]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,o){const h=e.x,l=e.y,m=e.z,x=this.coefficients;return o.copy(x[0]).multiplyScalar(.282095),o.addScaledVector(x[1],.488603*l),o.addScaledVector(x[2],.488603*m),o.addScaledVector(x[3],.488603*h),o.addScaledVector(x[4],1.092548*(h*l)),o.addScaledVector(x[5],1.092548*(l*m)),o.addScaledVector(x[6],.315392*(3*m*m-1)),o.addScaledVector(x[7],1.092548*(h*m)),o.addScaledVector(x[8],.546274*(h*h-l*l)),o}getIrradianceAt(e,o){const h=e.x,l=e.y,m=e.z,x=this.coefficients;return o.copy(x[0]).multiplyScalar(.886227),o.addScaledVector(x[1],2*.511664*l),o.addScaledVector(x[2],2*.511664*m),o.addScaledVector(x[3],2*.511664*h),o.addScaledVector(x[4],2*.429043*h*l),o.addScaledVector(x[5],2*.429043*l*m),o.addScaledVector(x[6],.743125*m*m-.247708),o.addScaledVector(x[7],2*.429043*h*m),o.addScaledVector(x[8],.429043*(h*h-l*l)),o}add(e){for(let o=0;o<9;o++)this.coefficients[o].add(e.coefficients[o]);return this}addScaledSH(e,o){for(let h=0;h<9;h++)this.coefficients[h].addScaledVector(e.coefficients[h],o);return this}scale(e){for(let o=0;o<9;o++)this.coefficients[o].multiplyScalar(e);return this}lerp(e,o){for(let h=0;h<9;h++)this.coefficients[h].lerp(e.coefficients[h],o);return this}equals(e){for(let o=0;o<9;o++)if(!this.coefficients[o].equals(e.coefficients[o]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,o=0){const h=this.coefficients;for(let l=0;l<9;l++)h[l].fromArray(e,o+l*3);return this}toArray(e=[],o=0){const h=this.coefficients;for(let l=0;l<9;l++)h[l].toArray(e,o+l*3);return e}static getBasisAt(e,o){const h=e.x,l=e.y,m=e.z;o[0]=.282095,o[1]=.488603*l,o[2]=.488603*m,o[3]=.488603*h,o[4]=1.092548*h*l,o[5]=1.092548*l*m,o[6]=.315392*(3*m*m-1),o[7]=1.092548*h*m,o[8]=.546274*(h*h-l*l)}}w2.prototype.isSphericalHarmonics3=!0;class Vw extends Pl{constructor(e=new w2,o=1){super(void 0,o),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const o=super.toJSON(e);return o.object.sh=this.sh.toArray(),o}}Vw.prototype.isLightProbe=!0;const OU={decodeText:function(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let e="";for(let o=0,h=i.length;o<h;o++)e+=String.fromCharCode(i[o]);try{return decodeURIComponent(escape(e))}catch{return e}},extractUrlBase:function(i){const e=i.lastIndexOf("/");return e===-1?"./":i.substr(0,e+1)}};function Mb(){pr.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}Mb.prototype=Object.assign(Object.create(pr.prototype),{constructor:Mb,isInstancedBufferGeometry:!0,copy:function(i){return pr.prototype.copy.call(this,i),this.instanceCount=i.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const i=pr.prototype.toJSON.call(this);return i.instanceCount=this.instanceCount,i.isInstancedBufferGeometry=!0,i}});function yE(i,e,o,h){typeof o=="number"&&(h=o,o=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Zn.call(this,i,e,o),this.meshPerAttribute=h||1}yE.prototype=Object.assign(Object.create(Zn.prototype),{constructor:yE,isInstancedBufferAttribute:!0,copy:function(i){return Zn.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},toJSON:function(){const i=Zn.prototype.toJSON.call(this);return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}});function vE(i){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Ds.call(this,i),this.options={premultiplyAlpha:"none"}}vE.prototype=Object.assign(Object.create(Ds.prototype),{constructor:vE,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(i,e,o,h){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const l=this,m=vd.get(i);if(m!==void 0)return l.manager.itemStart(i),setTimeout(function(){e&&e(m),l.manager.itemEnd(i)},0),m;const x={};x.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",x.headers=this.requestHeader,fetch(i,x).then(function(s){return s.blob()}).then(function(s){return createImageBitmap(s,Object.assign(l.options,{colorSpaceConversion:"none"}))}).then(function(s){vd.add(i,s),e&&e(s),l.manager.itemEnd(i)}).catch(function(s){h&&h(s),l.manager.itemError(i),l.manager.itemEnd(i)}),l.manager.itemStart(i)}});class FU extends Vw{constructor(e,o,h=1){super(void 0,h);const l=new dn().set(e),m=new dn().set(o),x=new He(l.r,l.g,l.b),s=new He(m.r,m.g,m.b),P=Math.sqrt(Math.PI),C=P*Math.sqrt(.75);this.sh.coefficients[0].copy(x).add(s).multiplyScalar(P),this.sh.coefficients[1].copy(x).sub(s).multiplyScalar(C)}}FU.prototype.isHemisphereLightProbe=!0;class BU extends Vw{constructor(e,o=1){super(void 0,o);const h=new dn().set(e);this.sh.coefficients[0].set(h.r,h.g,h.b).multiplyScalar(2*Math.sqrt(Math.PI))}}BU.prototype.isAmbientLightProbe=!0;new tn;new tn;class NU{constructor(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=SL(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const o=SL();e=(o-this.oldTime)/1e3,this.oldTime=o,this.elapsedTime+=e}return e}}function SL(){return(typeof performance>"u"?Date:performance).now()}class UU{constructor(e,o,h){this.binding=e,this.valueSize=h;let l,m,x;switch(o){case"quaternion":l=this._slerp,m=this._slerpAdditive,x=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(h*6),this._workIndex=5;break;case"string":case"bool":l=this._select,m=this._select,x=this._setAdditiveIdentityOther,this.buffer=new Array(h*5);break;default:l=this._lerp,m=this._lerpAdditive,x=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(h*5)}this._mixBufferRegion=l,this._mixBufferRegionAdditive=m,this._setIdentity=x,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,o){const h=this.buffer,l=this.valueSize,m=e*l+l;let x=this.cumulativeWeight;if(x===0){for(let s=0;s!==l;++s)h[m+s]=h[s];x=o}else{x+=o;const s=o/x;this._mixBufferRegion(h,m,0,s,l)}this.cumulativeWeight=x}accumulateAdditive(e){const o=this.buffer,h=this.valueSize,l=h*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(o,l,0,e,h),this.cumulativeWeightAdditive+=e}apply(e){const o=this.valueSize,h=this.buffer,l=e*o+o,m=this.cumulativeWeight,x=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,m<1){const P=o*this._origIndex;this._mixBufferRegion(h,l,P,1-m,o)}x>0&&this._mixBufferRegionAdditive(h,l,this._addIndex*o,1,o);for(let P=o,C=o+o;P!==C;++P)if(h[P]!==h[P+o]){s.setValue(h,l);break}}saveOriginalState(){const e=this.binding,o=this.buffer,h=this.valueSize,l=h*this._origIndex;e.getValue(o,l);for(let m=h,x=l;m!==x;++m)o[m]=o[l+m%h];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,o=e+this.valueSize;for(let h=e;h<o;h++)this.buffer[h]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,o=this._addIndex*this.valueSize;for(let h=0;h<this.valueSize;h++)this.buffer[o+h]=this.buffer[e+h]}_select(e,o,h,l,m){if(l>=.5)for(let x=0;x!==m;++x)e[o+x]=e[h+x]}_slerp(e,o,h,l){Rs.slerpFlat(e,o,e,o,e,h,l)}_slerpAdditive(e,o,h,l,m){const x=this._workIndex*m;Rs.multiplyQuaternionsFlat(e,x,e,o,e,h),Rs.slerpFlat(e,o,e,o,e,x,l)}_lerp(e,o,h,l,m){const x=1-l;for(let s=0;s!==m;++s){const P=o+s;e[P]=e[P]*x+e[h+s]*l}}_lerpAdditive(e,o,h,l,m){for(let x=0;x!==m;++x){const s=o+x;e[s]=e[s]+e[h+x]*l}}}const S2="\\[\\]\\.:\\/",xte=new RegExp("["+S2+"]","g"),T2="[^"+S2+"]",bte="[^"+S2.replace("\\.","")+"]",wte=/((?:WC+[\/:])*)/.source.replace("WC",T2),Ste=/(WCOD+)?/.source.replace("WCOD",bte),Tte=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",T2),Ete=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",T2),Ite=new RegExp("^"+wte+Ste+Tte+Ete+"$"),Mte=["material","materials","bones"];function $U(i,e,o){const h=o||Ea.parseTrackName(e);this._targetGroup=i,this._bindings=i.subscribe_(e,h)}Object.assign($U.prototype,{getValue:function(i,e){this.bind();const o=this._targetGroup.nCachedObjects_,h=this._bindings[o];h!==void 0&&h.getValue(i,e)},setValue:function(i,e){const o=this._bindings;for(let h=this._targetGroup.nCachedObjects_,l=o.length;h!==l;++h)o[h].setValue(i,e)},bind:function(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,o=i.length;e!==o;++e)i[e].bind()},unbind:function(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,o=i.length;e!==o;++e)i[e].unbind()}});function Ea(i,e,o){this.path=e,this.parsedPath=o||Ea.parseTrackName(e),this.node=Ea.findNode(i,this.parsedPath.nodeName)||i,this.rootNode=i}Object.assign(Ea,{Composite:$U,create:function(i,e,o){return i&&i.isAnimationObjectGroup?new Ea.Composite(i,e,o):new Ea(i,e,o)},sanitizeNodeName:function(i){return i.replace(/\s/g,"_").replace(xte,"")},parseTrackName:function(i){const e=Ite.exec(i);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+i);const o={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},h=o.nodeName&&o.nodeName.lastIndexOf(".");if(h!==void 0&&h!==-1){const l=o.nodeName.substring(h+1);Mte.indexOf(l)!==-1&&(o.nodeName=o.nodeName.substring(0,h),o.objectName=l)}if(o.propertyName===null||o.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return o},findNode:function(i,e){if(!e||e===""||e==="."||e===-1||e===i.name||e===i.uuid)return i;if(i.skeleton){const o=i.skeleton.getBoneByName(e);if(o!==void 0)return o}if(i.children){const o=function(l){for(let m=0;m<l.length;m++){const x=l[m];if(x.name===e||x.uuid===e)return x;const s=o(x.children);if(s)return s}return null},h=o(i.children);if(h)return h}return null}});Object.assign(Ea.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,o){e[o]=this.node[this.propertyName]},function(e,o){const h=this.resolvedProperty;for(let l=0,m=h.length;l!==m;++l)e[o++]=h[l]},function(e,o){e[o]=this.resolvedProperty[this.propertyIndex]},function(e,o){this.resolvedProperty.toArray(e,o)}],SetterByBindingTypeAndVersioning:[[function(e,o){this.targetObject[this.propertyName]=e[o]},function(e,o){this.targetObject[this.propertyName]=e[o],this.targetObject.needsUpdate=!0},function(e,o){this.targetObject[this.propertyName]=e[o],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,o){const h=this.resolvedProperty;for(let l=0,m=h.length;l!==m;++l)h[l]=e[o++]},function(e,o){const h=this.resolvedProperty;for(let l=0,m=h.length;l!==m;++l)h[l]=e[o++];this.targetObject.needsUpdate=!0},function(e,o){const h=this.resolvedProperty;for(let l=0,m=h.length;l!==m;++l)h[l]=e[o++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,o){this.resolvedProperty[this.propertyIndex]=e[o]},function(e,o){this.resolvedProperty[this.propertyIndex]=e[o],this.targetObject.needsUpdate=!0},function(e,o){this.resolvedProperty[this.propertyIndex]=e[o],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,o){this.resolvedProperty.fromArray(e,o)},function(e,o){this.resolvedProperty.fromArray(e,o),this.targetObject.needsUpdate=!0},function(e,o){this.resolvedProperty.fromArray(e,o),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,o){this.bind(),this.getValue(e,o)},setValue:function(e,o){this.bind(),this.setValue(e,o)},bind:function(){let i=this.node;const e=this.parsedPath,o=e.objectName,h=e.propertyName;let l=e.propertyIndex;if(i||(i=Ea.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!i){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(o){let P=e.objectIndex;switch(o){case"materials":if(!i.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!i.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}i=i.material.materials;break;case"bones":if(!i.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}i=i.skeleton.bones;for(let C=0;C<i.length;C++)if(i[C].name===P){P=C;break}break;default:if(i[o]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}i=i[o]}if(P!==void 0){if(i[P]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);return}i=i[P]}}const m=i[h];if(m===void 0){const P=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+P+"."+h+" but it wasn't found.",i);return}let x=this.Versioning.None;this.targetObject=i,i.needsUpdate!==void 0?x=this.Versioning.NeedsUpdate:i.matrixWorldNeedsUpdate!==void 0&&(x=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(l!==void 0){if(h==="morphTargetInfluences"){if(!i.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(i.geometry.isBufferGeometry){if(!i.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}i.morphTargetDictionary[l]!==void 0&&(l=i.morphTargetDictionary[l])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}s=this.BindingType.ArrayElement,this.resolvedProperty=m,this.propertyIndex=l}else m.fromArray!==void 0&&m.toArray!==void 0?(s=this.BindingType.HasFromToArray,this.resolvedProperty=m):Array.isArray(m)?(s=this.BindingType.EntireArray,this.resolvedProperty=m):this.propertyName=h;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][x]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});Object.assign(Ea.prototype,{_getValue_unbound:Ea.prototype.getValue,_setValue_unbound:Ea.prototype.setValue});class Ate{constructor(e,o,h=null,l=o.blendMode){this._mixer=e,this._clip=o,this._localRoot=h,this.blendMode=l;const m=o.tracks,x=m.length,s=new Array(x),P={endingStart:cd,endingEnd:cd};for(let C=0;C!==x;++C){const F=m[C].createInterpolant(null);s[C]=F,F.settings=P}this._interpolantSettings=P,this._interpolants=s,this._propertyBindings=new Array(x),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=DN,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,o){return this.loop=e,this.repetitions=o,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,o,h){if(e.fadeOut(o),this.fadeIn(o),h){const l=this._clip.duration,m=e._clip.duration,x=m/l,s=l/m;e.warp(1,x,o),this.warp(s,1,o)}return this}crossFadeTo(e,o,h){return e.crossFadeFrom(this,o,h)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,o,h){const l=this._mixer,m=l.time,x=this.timeScale;let s=this._timeScaleInterpolant;s===null&&(s=l._lendControlInterpolant(),this._timeScaleInterpolant=s);const P=s.parameterPositions,C=s.sampleValues;return P[0]=m,P[1]=m+h,C[0]=e/x,C[1]=o/x,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,o,h,l){if(!this.enabled){this._updateWeight(e);return}const m=this._startTime;if(m!==null){const P=(e-m)*h;if(P<0||h===0)return;this._startTime=null,o=h*P}o*=this._updateTimeScale(e);const x=this._updateTime(o),s=this._updateWeight(e);if(s>0){const P=this._interpolants,C=this._propertyBindings;switch(this.blendMode){case e2:for(let F=0,O=P.length;F!==O;++F)P[F].evaluate(x),C[F].accumulateAdditive(s);break;case Rw:default:for(let F=0,O=P.length;F!==O;++F)P[F].evaluate(x),C[F].accumulate(l,s)}}}_updateWeight(e){let o=0;if(this.enabled){o=this.weight;const h=this._weightInterpolant;if(h!==null){const l=h.evaluate(e)[0];o*=l,e>h.parameterPositions[1]&&(this.stopFading(),l===0&&(this.enabled=!1))}}return this._effectiveWeight=o,o}_updateTimeScale(e){let o=0;if(!this.paused){o=this.timeScale;const h=this._timeScaleInterpolant;if(h!==null){const l=h.evaluate(e)[0];o*=l,e>h.parameterPositions[1]&&(this.stopWarping(),o===0?this.paused=!0:this.timeScale=o)}}return this._effectiveTimeScale=o,o}_updateTime(e){const o=this._clip.duration,h=this.loop;let l=this.time+e,m=this._loopCount;const x=h===kN;if(e===0)return m===-1?l:x&&(m&1)===1?o-l:l;if(h===LN){m===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(l>=o)l=o;else if(l<0)l=0;else{this.time=l;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=l,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(m===-1&&(e>=0?(m=0,this._setEndings(!0,this.repetitions===0,x)):this._setEndings(this.repetitions===0,!0,x)),l>=o||l<0){const s=Math.floor(l/o);l-=o*s,m+=Math.abs(s);const P=this.repetitions-m;if(P<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,l=e>0?o:0,this.time=l,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(P===1){const C=e<0;this._setEndings(C,!C,x)}else this._setEndings(!1,!1,x);this._loopCount=m,this.time=l,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}else this.time=l;if(x&&(m&1)===1)return o-l}return l}_setEndings(e,o,h){const l=this._interpolantSettings;h?(l.endingStart=ud,l.endingEnd=ud):(e?l.endingStart=this.zeroSlopeAtStart?ud:cd:l.endingStart=$_,o?l.endingEnd=this.zeroSlopeAtEnd?ud:cd:l.endingEnd=$_)}_scheduleFading(e,o,h){const l=this._mixer,m=l.time;let x=this._weightInterpolant;x===null&&(x=l._lendControlInterpolant(),this._weightInterpolant=x);const s=x.parameterPositions,P=x.sampleValues;return s[0]=m,P[0]=o,s[1]=m+e,P[1]=h,this}}class VU extends Gc{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,o){const h=e._localRoot||this._root,l=e._clip.tracks,m=l.length,x=e._propertyBindings,s=e._interpolants,P=h.uuid,C=this._bindingsByRootAndName;let F=C[P];F===void 0&&(F={},C[P]=F);for(let O=0;O!==m;++O){const V=l[O],J=V.name;let ee=F[J];if(ee!==void 0)x[O]=ee;else{if(ee=x[O],ee!==void 0){ee._cacheIndex===null&&(++ee.referenceCount,this._addInactiveBinding(ee,P,J));continue}const se=o&&o._propertyBindings[O].binding.parsedPath;ee=new UU(Ea.create(h,J,se),V.ValueTypeName,V.getValueSize()),++ee.referenceCount,this._addInactiveBinding(ee,P,J),x[O]=ee}s[O].resultBuffer=ee.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const h=(e._localRoot||this._root).uuid,l=e._clip.uuid,m=this._actionsByClip[l];this._bindAction(e,m&&m.knownActions[0]),this._addInactiveAction(e,l,h)}const o=e._propertyBindings;for(let h=0,l=o.length;h!==l;++h){const m=o[h];m.useCount++===0&&(this._lendBinding(m),m.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const o=e._propertyBindings;for(let h=0,l=o.length;h!==l;++h){const m=o[h];--m.useCount===0&&(m.restoreOriginalState(),this._takeBackBinding(m))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const o=e._cacheIndex;return o!==null&&o<this._nActiveActions}_addInactiveAction(e,o,h){const l=this._actions,m=this._actionsByClip;let x=m[o];if(x===void 0)x={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,m[o]=x;else{const s=x.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=l.length,l.push(e),x.actionByRoot[h]=e}_removeInactiveAction(e){const o=this._actions,h=o[o.length-1],l=e._cacheIndex;h._cacheIndex=l,o[l]=h,o.pop(),e._cacheIndex=null;const m=e._clip.uuid,x=this._actionsByClip,s=x[m],P=s.knownActions,C=P[P.length-1],F=e._byClipCacheIndex;C._byClipCacheIndex=F,P[F]=C,P.pop(),e._byClipCacheIndex=null;const O=s.actionByRoot,V=(e._localRoot||this._root).uuid;delete O[V],P.length===0&&delete x[m],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const o=e._propertyBindings;for(let h=0,l=o.length;h!==l;++h){const m=o[h];--m.referenceCount===0&&this._removeInactiveBinding(m)}}_lendAction(e){const o=this._actions,h=e._cacheIndex,l=this._nActiveActions++,m=o[l];e._cacheIndex=l,o[l]=e,m._cacheIndex=h,o[h]=m}_takeBackAction(e){const o=this._actions,h=e._cacheIndex,l=--this._nActiveActions,m=o[l];e._cacheIndex=l,o[l]=e,m._cacheIndex=h,o[h]=m}_addInactiveBinding(e,o,h){const l=this._bindingsByRootAndName,m=this._bindings;let x=l[o];x===void 0&&(x={},l[o]=x),x[h]=e,e._cacheIndex=m.length,m.push(e)}_removeInactiveBinding(e){const o=this._bindings,h=e.binding,l=h.rootNode.uuid,m=h.path,x=this._bindingsByRootAndName,s=x[l],P=o[o.length-1],C=e._cacheIndex;P._cacheIndex=C,o[C]=P,o.pop(),delete s[m],Object.keys(s).length===0&&delete x[l]}_lendBinding(e){const o=this._bindings,h=e._cacheIndex,l=this._nActiveBindings++,m=o[l];e._cacheIndex=l,o[l]=e,m._cacheIndex=h,o[h]=m}_takeBackBinding(e){const o=this._bindings,h=e._cacheIndex,l=--this._nActiveBindings,m=o[l];e._cacheIndex=l,o[l]=e,m._cacheIndex=h,o[h]=m}_lendControlInterpolant(){const e=this._controlInterpolants,o=this._nActiveControlInterpolants++;let h=e[o];return h===void 0&&(h=new q_(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),h.__cacheIndex=o,e[o]=h),h}_takeBackControlInterpolant(e){const o=this._controlInterpolants,h=e.__cacheIndex,l=--this._nActiveControlInterpolants,m=o[l];e.__cacheIndex=l,o[l]=e,m.__cacheIndex=h,o[h]=m}clipAction(e,o,h){const l=o||this._root,m=l.uuid;let x=typeof e=="string"?mE.findByName(l,e):e;const s=x!==null?x.uuid:e,P=this._actionsByClip[s];let C=null;if(h===void 0&&(x!==null?h=x.blendMode:h=Rw),P!==void 0){const O=P.actionByRoot[m];if(O!==void 0&&O.blendMode===h)return O;C=P.knownActions[0],x===null&&(x=C._clip)}if(x===null)return null;const F=new Ate(this,x,o,h);return this._bindAction(F,C),this._addInactiveAction(F,s,m),F}existingAction(e,o){const h=o||this._root,l=h.uuid,m=typeof e=="string"?mE.findByName(h,e):e,x=m?m.uuid:e,s=this._actionsByClip[x];return s!==void 0&&s.actionByRoot[l]||null}stopAllAction(){const e=this._actions,o=this._nActiveActions;for(let h=o-1;h>=0;--h)e[h].stop();return this}update(e){e*=this.timeScale;const o=this._actions,h=this._nActiveActions,l=this.time+=e,m=Math.sign(e),x=this._accuIndex^=1;for(let C=0;C!==h;++C)o[C]._update(l,e,m,x);const s=this._bindings,P=this._nActiveBindings;for(let C=0;C!==P;++C)s[C].apply(x);return this}setTime(e){this.time=0;for(let o=0;o<this._actions.length;o++)this._actions[o].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const o=this._actions,h=e.uuid,l=this._actionsByClip,m=l[h];if(m!==void 0){const x=m.knownActions;for(let s=0,P=x.length;s!==P;++s){const C=x[s];this._deactivateAction(C);const F=C._cacheIndex,O=o[o.length-1];C._cacheIndex=null,C._byClipCacheIndex=null,O._cacheIndex=F,o[F]=O,o.pop(),this._removeInactiveBindingsForAction(C)}delete l[h]}}uncacheRoot(e){const o=e.uuid,h=this._actionsByClip;for(const x in h){const s=h[x].actionByRoot,P=s[o];P!==void 0&&(this._deactivateAction(P),this._removeInactiveAction(P))}const l=this._bindingsByRootAndName,m=l[o];if(m!==void 0)for(const x in m){const s=m[x];s.restoreOriginalState(),this._removeInactiveBinding(s)}}uncacheAction(e,o){const h=this.existingAction(e,o);h!==null&&(this._deactivateAction(h),this._removeInactiveAction(h))}}VU.prototype._controlInterpolantsResultBuffer=new Float32Array(1);function xE(i,e,o){Sa.call(this,i,e),this.meshPerAttribute=o||1}xE.prototype=Object.assign(Object.create(Sa.prototype),{constructor:xE,isInstancedInterleavedBuffer:!0,copy:function(i){return Sa.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},clone:function(i){const e=Sa.prototype.clone.call(this,i);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(i){const e=Sa.prototype.toJSON.call(this,i);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}});function E2(i,e,o,h,l){this.buffer=i,this.type=e,this.itemSize=o,this.elementSize=h,this.count=l,this.version=0}Object.defineProperty(E2.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});Object.assign(E2.prototype,{isGLBufferAttribute:!0,setBuffer:function(i){return this.buffer=i,this},setType:function(i,e){return this.type=i,this.elementSize=e,this},setItemSize:function(i){return this.itemSize=i,this},setCount:function(i){return this.count=i,this}});function I2(i,e,o=0,h=1/0){this.ray=new ih(i,e),this.near=o,this.far=h,this.camera=null,this.layers=new i2,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function TL(i,e){return i.distance-e.distance}function bE(i,e,o,h){if(i.layers.test(e.layers)&&i.raycast(e,o),h===!0){const l=i.children;for(let m=0,x=l.length;m<x;m++)bE(l[m],e,o,!0)}}Object.assign(I2.prototype,{set:function(i,e){this.ray.set(i,e)},setFromCamera:function(i,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(i.x,i.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(i,e=!1,o=[]){return bE(i,this,o,e),o.sort(TL),o},intersectObjects:function(i,e=!1,o=[]){for(let h=0,l=i.length;h<l;h++)bE(i[h],this,o,e);return o.sort(TL),o}});function K_(i){Rn.call(this),this.material=i,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}K_.prototype=Object.create(Rn.prototype);K_.prototype.constructor=K_;K_.prototype.isImmediateRenderObject=!0;const Nu=new He,H0=new tn,MT=new tn;class jU extends j_{constructor(e){const o=GU(e),h=new pr,l=[],m=[],x=new dn(0,0,1),s=new dn(0,1,0);for(let C=0;C<o.length;C++){const F=o[C];F.parent&&F.parent.isBone&&(l.push(0,0,0),l.push(0,0,0),m.push(x.r,x.g,x.b),m.push(s.r,s.g,s.b))}h.setAttribute("position",new Or(l,3)),h.setAttribute("color",new Or(m,3));const P=new Jp({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(h,P),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=o,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const o=this.bones,h=this.geometry,l=h.getAttribute("position");MT.copy(this.root.matrixWorld).invert();for(let m=0,x=0;m<o.length;m++){const s=o[m];s.parent&&s.parent.isBone&&(H0.multiplyMatrices(MT,s.matrixWorld),Nu.setFromMatrixPosition(H0),l.setXYZ(x,Nu.x,Nu.y,Nu.z),H0.multiplyMatrices(MT,s.parent.matrixWorld),Nu.setFromMatrixPosition(H0),l.setXYZ(x+1,Nu.x,Nu.y,Nu.z),x+=2)}h.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function GU(i){const e=[];i&&i.isBone&&e.push(i);for(let o=0;o<i.children.length;o++)e.push.apply(e,GU(i.children[o]));return e}class HU extends j_{constructor(e=10,o=10,h=4473924,l=8947848){h=new dn(h),l=new dn(l);const m=o/2,x=e/o,s=e/2,P=[],C=[];for(let V=0,J=0,ee=-s;V<=o;V++,ee+=x){P.push(-s,0,ee,s,0,ee),P.push(ee,0,-s,ee,0,s);const se=V===m?h:l;se.toArray(C,J),J+=3,se.toArray(C,J),J+=3,se.toArray(C,J),J+=3,se.toArray(C,J),J+=3}const F=new pr;F.setAttribute("position",new Or(P,3)),F.setAttribute("color",new Or(C,3));const O=new Jp({vertexColors:!0,toneMapped:!1});super(F,O),this.type="GridHelper"}}const Pte=new Float32Array(1);new Int32Array(Pte.buffer);const zte=new Lw({side:Bo,depthWrite:!1,depthTest:!1});new lr(new Po,zte);Ys.create=function(i,e){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(Ys.prototype),i.prototype.constructor=i,i.prototype.getPoint=e,i};Eb.prototype.fromPoints=function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)};HU.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};jU.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Ds.prototype.extractUrlBase=function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),OU.extractUrlBase(i)};Ds.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Ra.prototype.center=function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)};Ra.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Ra.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};Ra.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};Ra.prototype.size=function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)};Id.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Fy.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)};kn.random16=function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()};kn.nearestPowerOfTwo=function(i){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),kn.floorPowerOfTwo(i)};kn.nextPowerOfTwo=function(i){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),kn.ceilPowerOfTwo(i)};Qo.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};Qo.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};Qo.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Qo.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};Qo.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Qo.prototype.getInverse=function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};tn.prototype.extractPosition=function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)};tn.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};tn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new He().setFromMatrixColumn(this,3)};tn.prototype.setRotationFromQuaternion=function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)};tn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};tn.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};tn.prototype.multiplyVector4=function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};tn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};tn.prototype.rotateAxis=function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)};tn.prototype.crossVector=function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};tn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};tn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};tn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};tn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};tn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};tn.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};tn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};tn.prototype.makeFrustum=function(i,e,o,h,l,m){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,e,h,o,l,m)};tn.prototype.getInverse=function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};El.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)};Rs.prototype.multiplyVector3=function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)};Rs.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};ih.prototype.isIntersectionBox=function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};ih.prototype.isIntersectionPlane=function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)};ih.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};zo.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};zo.prototype.barycoordFromPoint=function(i,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,e)};zo.prototype.midpoint=function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)};zo.prototypenormal=function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)};zo.prototype.plane=function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)};zo.barycoordFromPoint=function(i,e,o,h,l){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),zo.getBarycoord(i,e,o,h,l)};zo.normal=function(i,e,o,h){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),zo.getNormal(i,e,o,h)};$w.prototype.extractAllPoints=function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)};$w.prototype.extrude=function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new jp(this,i)};$w.prototype.makeGeometry=function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new pE(this,i)};mi.prototype.fromAttribute=function(i,e,o){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,o)};mi.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};mi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};He.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};He.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};He.prototype.getPositionFromMatrix=function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)};He.prototype.getScaleFromMatrix=function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)};He.prototype.getColumnFromMatrix=function(i,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,i)};He.prototype.applyProjection=function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)};He.prototype.fromAttribute=function(i,e,o){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,o)};He.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};He.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};zr.prototype.fromAttribute=function(i,e,o){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,o)};zr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Rn.prototype.getChildByName=function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)};Rn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Rn.prototype.translate=function(i,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,i)};Rn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Rn.prototype.applyMatrix=function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(Rn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});lr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(lr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),ON},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});xb.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(Ys.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(i){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=i}});zs.prototype.setLens=function(i,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(i)};Object.defineProperties(Pl.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}});Object.defineProperties(Zn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Fp},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Fp)}}});Zn.prototype.setDynamic=function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?Fp:ky),this};Zn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Zn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};pr.prototype.addIndex=function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)};pr.prototype.addAttribute=function(i,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new Zn(arguments[1],arguments[2]))):i==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(i,e)};pr.prototype.addDrawCall=function(i,e,o){o!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,e)};pr.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};pr.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};pr.prototype.removeAttribute=function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)};pr.prototype.applyMatrix=function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(pr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Object.defineProperties(Mb.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(i){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=i}}});Object.defineProperties(I2.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(i){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=i}}});Object.defineProperties(Sa.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Fp},set:function(i){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(i)}}});Sa.prototype.setDynamic=function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?Fp:ky),this};Sa.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};jp.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};jp.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};jp.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Ow.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(eo.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new dn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===JM}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}}});Object.defineProperties(Tl.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(yd.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(i){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=i}}});Object.defineProperties(Ia.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}});Cr.prototype.clearTarget=function(i,e,o,h){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(e,o,h)};Cr.prototype.animate=function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)};Cr.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Cr.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Cr.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Cr.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Cr.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Cr.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Cr.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Cr.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Cr.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Cr.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Cr.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Cr.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Cr.prototype.enableScissorTest=function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)};Cr.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Cr.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Cr.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Cr.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Cr.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Cr.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Cr.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Cr.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Cr.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Cr.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Cr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?t2:qp}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(oU.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Vu.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}});Dw.prototype.updateCubeMap=function(i,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,e)};Dw.prototype.clear=function(i,e,o,h){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,e,o,h)};Ed.crossOrigin=void 0;Ed.loadTexture=function(i,e,o,h){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const l=new Tb;l.setCrossOrigin(this.crossOrigin);const m=l.load(i,o,void 0,h);return e&&(m.mapping=e),m};Ed.loadTextureCube=function(i,e,o,h){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const l=new MU;l.setCrossOrigin(this.crossOrigin);const m=l.load(i,o,void 0,h);return e&&(m.mapping=e),m};Ed.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Ed.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:qM}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=qM);const Cte=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:N4,AddEquation:ad,AddOperation:k4,AdditiveAnimationBlendMode:e2,AdditiveBlending:NT,AlphaFormat:q4,AlwaysDepth:A4,AlwaysStencilFunc:ZN,AmbientLight:b2,AmbientLightProbe:BU,AnimationClip:mE,AnimationMixer:VU,AnimationUtils:Jr,ArcCurve:f2,ArrayCamera:vb,BackSide:Bo,BasicDepthPacking:jN,Bone:aE,BooleanKeyframeTrack:Ad,Box3:Ra,BoxBufferGeometry:Po,BoxGeometry:Po,BufferAttribute:Zn,BufferGeometry:pr,ByteType:V4,Cache:vd,Camera:Yu,CanvasTexture:fU,CatmullRomCurve3:m2,CineonToneMapping:B4,ClampToEdgeWrapping:la,Clock:NU,Color:dn,ColorKeyframeTrack:h2,CompressedTexture:u2,CompressedTextureLoader:gE,CubeCamera:Dw,CubeReflectionMapping:Mw,CubeRefractionMapping:Aw,CubeTexture:Oy,CubeTextureLoader:MU,CubeUVReflectionMapping:Pw,CubeUVRefractionMapping:zw,CubicBezierCurve:Bw,CubicBezierCurve3:g2,CubicInterpolant:bb,CullFaceBack:BT,CullFaceFront:f4,CullFaceNone:d4,Curve:Ys,CurvePath:PU,CustomBlending:m4,CustomToneMapping:U4,CylinderBufferGeometry:hE,CylinderGeometry:hE,DataTexture:kw,DataTexture2DArray:r2,DataTexture3D:o2,DataTextureLoader:_E,DefaultLoadingManager:IU,DepthFormat:fd,DepthStencilFormat:Op,DepthTexture:pU,DirectionalLight:Ib,DiscreteInterpolant:wb,DoubleSide:Ry,DstAlphaFactor:w4,DstColorFactor:T4,DynamicDrawUsage:Fp,EllipseCurve:By,EqualDepth:z4,EquirectangularReflectionMapping:GT,EquirectangularRefractionMapping:HT,Euler:Md,EventDispatcher:Gc,ExtrudeBufferGeometry:jp,ExtrudeGeometry:jp,FileLoader:Y_,FlatShading:JM,Float16BufferAttribute:V_,Float32BufferAttribute:Or,Float64BufferAttribute:yb,FloatType:Fc,FrontSide:Cy,Frustum:Fy,GLBufferAttribute:E2,GLSL3:rE,GammaEncoding:FN,GreaterDepth:R4,GreaterEqualDepth:C4,GridHelper:HU,Group:hd,HalfFloatType:B_,HemisphereLight:zU,HemisphereLightProbe:FU,ImageBitmapLoader:vE,ImageLoader:d2,ImageUtils:Ed,ImmediateRenderObject:K_,InstancedBufferAttribute:yE,InstancedBufferGeometry:Mb,InstancedInterleavedBuffer:xE,InstancedMesh:lE,Int16BufferAttribute:gb,Int32BufferAttribute:_b,Int8BufferAttribute:fb,IntType:G4,InterleavedBuffer:Sa,InterleavedBufferAttribute:$p,Interpolant:Ta,InterpolateDiscrete:N_,InterpolateLinear:U_,InterpolateSmooth:W0,KeepStencilOp:q0,KeyframeTrack:zl,Layers:i2,LessDepth:P4,LessEqualDepth:ub,Light:Pl,LightProbe:Vw,Line:Vp,LineBasicMaterial:Jp,LineCurve:Ny,LineCurve3:AU,LineDashedMaterial:TU,LineLoop:hU,LineSegments:j_,LinearEncoding:qp,LinearFilter:Ko,LinearInterpolant:q_,LinearMipmapLinearFilter:Dy,LinearMipmapNearestFilter:$4,LinearToneMapping:O4,Loader:Ds,LoaderUtils:OU,LoadingManager:EU,LogLuvEncoding:NN,LoopOnce:LN,LoopPingPong:kN,LoopRepeat:DN,LuminanceAlphaFormat:J4,LuminanceFormat:X4,Material:eo,Math:kn,MathUtils:kn,Matrix3:Qo,Matrix4:tn,MaxEquation:jT,Mesh:lr,MeshBasicMaterial:Lw,MeshDepthMaterial:s2,MeshDistanceMaterial:a2,MeshLambertMaterial:wU,MeshMatcapMaterial:SU,MeshNormalMaterial:bU,MeshPhongMaterial:Tl,MeshPhysicalMaterial:yd,MeshStandardMaterial:Uc,MeshToonMaterial:xU,MinEquation:VT,MirroredRepeatWrapping:db,MixOperation:D4,MultiplyBlending:$T,MultiplyOperation:Ly,NearestFilter:Cs,NearestMipmapLinearFilter:WT,NearestMipmapNearestFilter:ZT,NeverDepth:M4,NoBlending:bp,NoToneMapping:Sp,NormalAnimationBlendMode:Rw,NormalBlending:wp,NotEqualDepth:L4,NumberKeyframeTrack:X_,Object3D:Rn,ObjectSpaceNormalMap:HN,OneFactor:v4,OneMinusDstAlphaFactor:S4,OneMinusDstColorFactor:E4,OneMinusSrcAlphaFactor:KM,OneMinusSrcColorFactor:b4,OrthographicCamera:x2,PCFShadowMap:XM,PCFSoftShadowMap:p4,ParametricBufferGeometry:W_,ParametricGeometry:W_,Path:Eb,PerspectiveCamera:zs,Plane:El,PlaneBufferGeometry:oE,PlaneGeometry:oE,PointLight:v2,Points:uE,PointsMaterial:c2,PropertyBinding:Ea,PropertyMixer:UU,QuadraticBezierCurve:Nw,QuadraticBezierCurve3:_2,Quaternion:Rs,QuaternionKeyframeTrack:Yp,QuaternionLinearInterpolant:Sb,REVISION:qM,RGBADepthPacking:GN,RGBAFormat:Ja,RGBAIntegerFormat:iN,RGBA_ASTC_10x10_Format:mN,RGBA_ASTC_10x5_Format:dN,RGBA_ASTC_10x6_Format:fN,RGBA_ASTC_10x8_Format:pN,RGBA_ASTC_12x10_Format:gN,RGBA_ASTC_12x12_Format:_N,RGBA_ASTC_4x4_Format:rN,RGBA_ASTC_5x4_Format:oN,RGBA_ASTC_5x5_Format:sN,RGBA_ASTC_6x5_Format:aN,RGBA_ASTC_6x6_Format:lN,RGBA_ASTC_8x5_Format:cN,RGBA_ASTC_8x6_Format:uN,RGBA_ASTC_8x8_Format:hN,RGBA_BPTC_Format:yN,RGBA_ETC2_EAC_Format:nE,RGBA_PVRTC_2BPPV1_Format:tE,RGBA_PVRTC_4BPPV1_Format:eE,RGBA_S3TC_DXT1_Format:XT,RGBA_S3TC_DXT3_Format:JT,RGBA_S3TC_DXT5_Format:YT,RGBDEncoding:VN,RGBEEncoding:BN,RGBFormat:$u,RGBIntegerFormat:tN,RGBM16Encoding:$N,RGBM7Encoding:UN,RGB_ETC1_Format:nN,RGB_ETC2_Format:iE,RGB_PVRTC_2BPPV1_Format:QT,RGB_PVRTC_4BPPV1_Format:KT,RGB_S3TC_DXT1_Format:qT,RGFormat:Q4,RGIntegerFormat:eN,RawShaderMaterial:vU,Ray:ih,Raycaster:I2,RectAreaLight:kU,RedFormat:Y4,RedIntegerFormat:K4,ReinhardToneMapping:F4,RepeatWrapping:hb,ReverseSubtractEquation:_4,SRGB8_ALPHA8_ASTC_10x10_Format:zN,SRGB8_ALPHA8_ASTC_10x5_Format:MN,SRGB8_ALPHA8_ASTC_10x6_Format:AN,SRGB8_ALPHA8_ASTC_10x8_Format:PN,SRGB8_ALPHA8_ASTC_12x10_Format:CN,SRGB8_ALPHA8_ASTC_12x12_Format:RN,SRGB8_ALPHA8_ASTC_4x4_Format:vN,SRGB8_ALPHA8_ASTC_5x4_Format:xN,SRGB8_ALPHA8_ASTC_5x5_Format:bN,SRGB8_ALPHA8_ASTC_6x5_Format:wN,SRGB8_ALPHA8_ASTC_6x6_Format:SN,SRGB8_ALPHA8_ASTC_8x5_Format:TN,SRGB8_ALPHA8_ASTC_8x6_Format:EN,SRGB8_ALPHA8_ASTC_8x8_Format:IN,Scene:Ow,ShaderChunk:Xn,ShaderLib:Il,ShaderMaterial:Ia,ShadowMaterial:yU,Shape:$w,ShapeBufferGeometry:pE,ShapeGeometry:pE,ShapeUtils:Gu,ShortType:j4,SkeletonHelper:jU,SkinnedMesh:xb,Sphere:Id,SphericalHarmonics3:w2,SplineCurve:Uw,SpotLight:RU,Sprite:uU,SpriteMaterial:l2,SrcAlphaFactor:YM,SrcAlphaSaturateFactor:I4,SrcColorFactor:x4,StaticDrawUsage:ky,StringKeyframeTrack:Pd,SubtractEquation:g4,SubtractiveBlending:UT,TangentSpaceNormalMap:Td,Texture:es,TextureLoader:Tb,Triangle:zo,TrianglesDrawMode:ON,UVMapping:QM,Uint16BufferAttribute:Bp,Uint32BufferAttribute:Np,Uint8BufferAttribute:pb,Uint8ClampedBufferAttribute:mb,UniformsLib:Ai,UniformsUtils:JN,UnsignedByteType:Cw,UnsignedInt248Type:Tp,UnsignedIntType:S_,UnsignedShort4444Type:H4,UnsignedShort5551Type:Z4,UnsignedShort565Type:W4,UnsignedShortType:F_,VSMShadowMap:yp,Vector2:mi,Vector3:He,Vector4:zr,VectorKeyframeTrack:J_,VideoTexture:dU,WebGL1Renderer:lU,WebGLCubeRenderTarget:n2,WebGLMultisampleRenderTarget:WN,WebGLRenderTarget:Vu,WebGLRenderer:Cr,WebGLUtils:sU,WrapAroundEnding:$_,ZeroCurvatureEnding:cd,ZeroFactor:y4,ZeroSlopeEnding:ud,sRGBEncoding:t2},Symbol.toStringTag,{value:"Module"}));let wE="",SE="";const Bc=new IJ({name:"OASIS GeoMap",version:"1.0.0"});let cn,M_=null,Hu={markers:!0,heatmap:!1,buildings:!1,deserts:!1},Uu=null,Ml=null,Rte=[],Ep=null;const Lte={northern:[-.9057,9.5439],"upper east":[-.85,10.75],"upper west":[-2.15,10.25],"greater accra":[-.187,5.6037],ashanti:[-1.5209,6.747],western:[-2.15,5.396],eastern:[-.45,6.33],central:[-1.2,5.46],volta:[.5,6.8],"brong-ahafo":[-1.5,7.5],bono:[-2.3,7.5],"bono east":[-1.05,7.75],ahafo:[-2.35,7],savannah:[-1.8,9],"north east":[-.35,10.5],oti:[.3,7.8],"western north":[-2.3,6.3],accra:[-.187,5.6037],kumasi:[-1.6244,6.6885],tamale:[-.8393,9.4008],bolgatanga:[-.8514,10.7856],wa:[-2.5099,10.0601],"cape coast":[-1.2466,5.1036],ho:[.4667,6.6],sunyani:[-2.3266,7.3349],koforidua:[-.2558,6.094],takoradi:[-1.7554,4.8986]};function Ps(i){return document.getElementById(i)}function Dte(i){return i.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim()}function pd(i,e){console.log(`[OASIS] ${e?"âœ…":"âš ï¸"} ${i}`)}async function kte(i,e){var l;const h=(l=(await Bc.callServerTool({name:i,arguments:e})).content)==null?void 0:l.find(m=>m.type==="text");if(h&&"text"in h){const m=h.text;try{return JSON.parse(m)}catch{throw new Error(`Failed to parse ${i} response as JSON (got ${m.slice(0,120)}â€¦)`)}}throw new Error(`No text content in ${i} response`)}function Ote(){if(!wE){pd("MAPBOX_TOKEN not set â€” add it to .env and restart MCP server",!1);return}cb.accessToken=wE,cn=new cb.Map({container:"map",style:"mapbox://styles/mapbox/dark-v11",projection:"globe",center:[0,20],zoom:1.8,pitch:0,bearing:0,antialias:!0}),cn.on("style.load",()=>{cn.setFog({color:"rgb(10,10,30)","high-color":"rgb(30,50,120)","horizon-blend":.08,"space-color":"rgb(5,5,15)","star-intensity":.95})}),cn.on("error",i=>{var e;console.error("Mapbox error:",i.error||i),Ps("loader").classList.add("gone"),pd("Map error: "+(((e=i.error)==null?void 0:e.message)||"unknown"),!1)}),cn.on("load",async()=>{cn.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),cn.setTerrain({source:"mapbox-dem",exaggeration:1.5}),cn.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,90],"sky-atmosphere-sun-intensity":15}}),await Fte(),Bte();const i=Gte();setTimeout(()=>{Ps("loader").classList.add("gone"),i?cn.flyTo({center:i.center,zoom:i.zoom,pitch:i.pitch,bearing:-15,duration:4e3,essential:!0}):cn.flyTo({center:[-1.0232,7.9465],zoom:6.5,pitch:50,bearing:-15,duration:4e3,essential:!0})},2200),setTimeout(()=>{Hte()},2800)}),setTimeout(()=>{const i=Ps("loader");i.classList.contains("gone")||(i.classList.add("gone"),pd("Map load timed out â€” check console for errors",!1))},15e3),cn.on("zoom",()=>{cn.getZoom()>=14&&!Hu.buildings&&Q_("buildings")})}async function Fte(){try{pd("Loading facilities via MCPâ€¦",!0),M_=(await kte("geocode_facilities",{})).geojson||{type:"FeatureCollection",features:[]};const e=new Set,o=new Set;M_.features.forEach(h=>{const l=h.properties;l.city&&e.add(l.city);try{JSON.parse(l.specialties||"[]").forEach(m=>o.add(m))}catch{}}),Rte=[...o].sort(),pd(`Loaded ${M_.features.length} facilities`,!0)}catch(i){console.error("Failed to load facilities via MCP:",i),pd("Failed to load facilities: "+i.message,!1)}}function Bte(){if(!M_)return;cn.addSource("facilities",{type:"geojson",data:M_}),cn.addLayer({id:"layer-heatmap",type:"heatmap",source:"facilities",layout:{visibility:"none"},paint:{"heatmap-weight":["interpolate",["linear"],["length",["to-string",["get","specialties"]]],10,.2,100,.5,300,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-radius":["interpolate",["linear"],["zoom"],0,4,6,30,9,50],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.1,"rgba(26,5,48,0.6)",.25,"rgba(107,15,107,0.7)",.4,"rgba(255,68,68,0.8)",.6,"rgba(255,153,68,0.85)",.8,"rgba(255,238,68,0.9)",1,"rgba(255,255,255,1)"],"heatmap-opacity":["interpolate",["linear"],["zoom"],5,.8,12,.3]}},"waterway-label"),cn.addLayer({id:"layer-glow",type:"circle",source:"facilities",paint:{"circle-radius":["interpolate",["linear"],["zoom"],4,6,8,12,12,18],"circle-color":"#FF6B35","circle-opacity":.15,"circle-blur":1}}),cn.addLayer({id:"layer-markers",type:"circle",source:"facilities",maxzoom:10,paint:{"circle-radius":["interpolate",["linear"],["zoom"],4,2.5,8,5,10,8],"circle-color":"#FF6B35","circle-opacity":.85,"circle-stroke-width":["interpolate",["linear"],["zoom"],4,.5,10,2],"circle-stroke-color":"rgba(255,255,255,0.6)","circle-blur":.1}});const i=cn.getStyle().layers.find(o=>{var h;return o.type==="symbol"&&((h=o.layout)==null?void 0:h["text-field"])});cn.addLayer({id:"layer-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:13,layout:{visibility:"none"},paint:{"fill-extrusion-color":["interpolate",["linear"],["get","height"],0,"#1a1a3e",20,"#2a2a5e",50,"#4a3a7e"],"fill-extrusion-height":["interpolate",["linear"],["zoom"],13,0,14.5,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],13,0,14.5,["get","min_height"]],"fill-extrusion-opacity":.75}},i?i.id:void 0);const e=o=>{const h=o.features[0],l=o.lngLat;cn.flyTo({center:l,zoom:Math.max(cn.getZoom(),16),pitch:60,duration:1500}),Hu.buildings||Q_("buildings"),Ute(h.properties,l)};cn.on("click","layer-markers",e),cn.on("mouseenter","layer-markers",()=>{cn.getCanvas().style.cursor="pointer"}),cn.on("mouseleave","layer-markers",()=>{cn.getCanvas().style.cursor=""})}function Nte(i){cn.getSource("desert-gaps")&&(cn.getLayer("desert-circles")&&cn.removeLayer("desert-circles"),cn.getLayer("desert-labels")&&cn.removeLayer("desert-labels"),cn.removeSource("desert-gaps"));const e=i.map(o=>({type:"Feature",geometry:{type:"Point",coordinates:[o.lng,o.lat]},properties:{nearest_city:o.nearest_city,distance_km:o.nearest_facility_distance_km,severity:o.severity,nearest_facility:o.nearest_facility_name}}));if(cn.addSource("desert-gaps",{type:"geojson",data:{type:"FeatureCollection",features:e}}),cn.addLayer({id:"desert-circles",type:"circle",source:"desert-gaps",paint:{"circle-radius":["interpolate",["linear"],["zoom"],4,20,8,40,12,60],"circle-color":["case",["==",["get","severity"],"critical"],"rgba(255,82,82,0.25)","rgba(255,152,0,0.2)"],"circle-blur":.6,"circle-stroke-width":2,"circle-stroke-color":["case",["==",["get","severity"],"critical"],"rgba(255,82,82,0.5)","rgba(255,152,0,0.4)"]}},"layer-glow"),cn.addLayer({id:"desert-labels",type:"symbol",source:"desert-gaps",layout:{"text-field":["concat",`DESERT
`,["get","nearest_city"]],"text-size":10,"text-anchor":"center"},paint:{"text-color":"#FF5252","text-halo-color":"#000","text-halo-width":1}}),i.length>0){const o=new cb.LngLatBounds;i.forEach(h=>o.extend([h.lng,h.lat])),cn.fitBounds(o,{padding:80,pitch:30,duration:2e3})}}function Ute(i,e){Ps("d-name").textContent=i.name||"â€”",Ps("d-type").textContent=i.facility_type||"Facility";let o=[];try{o=JSON.parse(i.specialties||"[]")}catch{}Ps("d-specs").textContent=String(o.length),Ps("d-dist").textContent=i.distance!=null?i.distance.toFixed(1)+" km":"â€”",Ps("d-city").textContent=i.city||"â€”";let h=[];try{h=JSON.parse(i.equipment||"[]").filter(Boolean)}catch{}const l=[...o.map(Dte),...h];Ps("d-caps").innerHTML=l.slice(0,12).map(x=>`<span class="cap-chip">${x}</span>`).join("")+(l.length>12?`<span class="cap-chip">+${l.length-12}</span>`:""),Ps("detail-card").classList.add("show");const m=e?[e.lng,e.lat]:i.coords||[0,0];Vte(m,i.name||"Hospital"),jte(i)}function $te(){Ps("detail-card").classList.remove("show"),Uu&&cn.getLayer(Uu)&&(cn.removeLayer(Uu),Uu=null),Ml&&(Ml.pause(),Ml=null)}function Q_(i){Hu[i]=!Hu[i];const e=Hu[i],o=document.getElementById(`tog-${i}`);switch(o&&o.classList.toggle("on",e),i){case"markers":cn.setLayoutProperty("layer-markers","visibility",e?"visible":"none"),cn.setLayoutProperty("layer-glow","visibility",e?"visible":"none");break;case"heatmap":cn.setLayoutProperty("layer-heatmap","visibility",e?"visible":"none"),Ps("heatmap-legend").classList.toggle("show",e);break;case"buildings":cn.setLayoutProperty("layer-buildings","visibility",e?"visible":"none");break;case"deserts":cn.getLayer("desert-circles")&&(cn.setLayoutProperty("desert-circles","visibility",e?"visible":"none"),cn.setLayoutProperty("desert-labels","visibility",e?"visible":"none"));break}}function Vte(i,e){if(!Cte)return;Uu&&cn.getLayer(Uu)&&cn.removeLayer(Uu);const o=cb.MercatorCoordinate.fromLngLat(i,0),h={translateX:o.x,translateY:o.y,translateZ:o.z,rotateX:Math.PI/2,rotateY:0,rotateZ:0,scale:o.meterInMercatorCoordinateUnits()},l="3d-model-hospital";Uu=l;const m={id:l,type:"custom",renderingMode:"3d",onAdd(x,s){this.camera=new Yu,this.scene=new Ow,this.clock=new NU,this.scene.add(new b2(13426175,.6));const P=new Ib(16777215,1);P.position.set(50,-80,120),this.scene.add(P);const C=new Ib(8952268,.4);C.position.set(-40,60,80),this.scene.add(C);const F=new Tl({color:15790320,specular:2236962,shininess:30}),O=new Tl({color:8965375,specular:16777215,shininess:100,opacity:.6,transparent:!0}),V=new Tl({color:16739125,specular:16746581,shininess:60}),J=new Tl({color:16711680,emissive:16720384,emissiveIntensity:.5}),ee=new Tl({color:4478310}),se=new Tl({color:3359829}),fe=new hd,le=new lr(new Po(60,30,40),F);le.position.set(0,0,20),fe.add(le);for(let Dt=0;Dt<5;Dt++){const Qe=5+Dt*8;fe.add(Object.assign(new lr(new Po(56,.5,4),O),{position:new He(0,-15.3,Qe)})),fe.add(Object.assign(new lr(new Po(56,.5,4),O),{position:new He(0,15.3,Qe)})),fe.add(Object.assign(new lr(new Po(.5,26,4),O),{position:new He(-30.3,0,Qe)})),fe.add(Object.assign(new lr(new Po(.5,26,4),O),{position:new He(30.3,0,Qe)}))}const ie=new Po(20,20,16),it=new lr(ie,F);it.position.set(-40,0,8),fe.add(it);const Ve=new lr(ie,F);Ve.position.set(40,0,8),fe.add(Ve);const Ne=new lr(new Po(62,31,2),V);Ne.position.set(0,0,41),fe.add(Ne);const Re=new lr(new Po(64,33,1),ee);Re.position.set(0,0,42),fe.add(Re);const Ye=new lr(new hE(8,8,.3,32),se);Ye.rotation.x=Math.PI/2,Ye.position.set(0,0,42.5),fe.add(Ye);const zt=new Tl({color:16777215});fe.add(Object.assign(new lr(new Po(1,6,.2),zt),{position:new He(-2,0,42.8)})),fe.add(Object.assign(new lr(new Po(1,6,.2),zt),{position:new He(2,0,42.8)})),fe.add(Object.assign(new lr(new Po(5,1,.2),zt),{position:new He(0,0,42.8)}));const pt=new lr(new Po(16,8,1),V);pt.position.set(0,-19,10),fe.add(pt);const St=new lr(new Po(8,.5,2),J);St.position.set(0,-15.5,22),fe.add(St);const Et=new lr(new Po(2,.5,8),J);Et.position.set(0,-15.5,22),fe.add(Et),this.beacon=new v2(16711680,2,200),this.beacon.position.set(0,0,48),fe.add(this.beacon),fe.add(new lr(new Po(100,60,.5),new Tl({color:4478276}))),this.scene.add(fe),this.map=x,this.renderer=new Cr({canvas:x.getCanvas(),context:s,antialias:!0}),this.renderer.autoClear=!1},render(x,s){this.beacon&&this.clock&&(this.beacon.intensity=1+Math.sin(this.clock.getElapsedTime()*3)*1.5);const P=new tn().makeRotationAxis(new He(1,0,0),h.rotateX),C=new tn().makeRotationAxis(new He(0,1,0),h.rotateY),F=new tn().makeRotationAxis(new He(0,0,1),h.rotateZ),O=new tn().fromArray(s),V=new tn().makeTranslation(h.translateX,h.translateY,h.translateZ).scale(new He(h.scale,-h.scale,h.scale)).multiply(P).multiply(C).multiply(F);this.camera.projectionMatrix=O.multiply(V),this.renderer.resetState(),this.renderer.render(this.scene,this.camera),this.map.triggerRepaint()}};cn.addLayer(m)}async function jte(i){if(Ml&&(Ml.pause(),Ml=null),!SE)return;let e=[];try{e=JSON.parse(i.specialties||"[]")}catch{}const o=`${i.name||"This facility"}. ${i.city?"Located in "+i.city+".":""} ${e.length>0?"Specialties include "+e.slice(0,3).map(h=>h.replace(/([A-Z])/g," $1")).join(", ")+".":""}`;try{const h=await fetch("https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM",{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":SE},body:JSON.stringify({text:o,model_id:"eleven_monolingual_v1",voice_settings:{stability:.5,similarity_boost:.5}})});if(h.ok){const l=await h.blob();Ml=new Audio(URL.createObjectURL(l)),Ml.play()}}catch(h){console.error("ElevenLabs narration error:",h)}}function ZU(i){var e,o,h;if(i.theme&&SJ(i.theme),(e=i.styles)!=null&&e.variables&&TJ(i.styles.variables),(h=(o=i.styles)==null?void 0:o.css)!=null&&h.fonts&&EJ(i.styles.css.fonts),i.safeAreaInsets){const{top:l,right:m,bottom:x,left:s}=i.safeAreaInsets;document.body.style.padding=`${l}px ${m}px ${x}px ${s}px`}}function Gte(){var o,h;if(!Ep)return null;const i=Ep,e=i.initial_zoom||6;if(i.highlight_region){const l=i.highlight_region.toLowerCase(),m=Lte[l];if(m)return{center:m,zoom:e,pitch:45}}return i.mode==="search"&&((o=i.center)!=null&&o.lat)&&((h=i.center)!=null&&h.lng)?{center:[i.center.lng,i.center.lat],zoom:Math.max(e,8),pitch:45}:i.mode==="deserts"&&e!==6?{center:[-1.0232,7.9465],zoom:e,pitch:45}:null}function Hte(){var e,o;if(!Ep)return;const i=Ep;Ep=null,i.mode==="deserts"&&((e=i.gaps)==null?void 0:e.length)>0&&(Nte(i.gaps),Hu.deserts=!0,Ps("tog-deserts").classList.add("on"),Hu.heatmap||Q_("heatmap"),pd(`${i.gap_count||i.gaps.length} coverage gaps for ${((o=i.query)==null?void 0:o.condition)||"specialty"}`,!0)),i.narrative_focus==="deserts"&&!Hu.heatmap&&Q_("heatmap")}Bc.ontoolinput=()=>{Ps("loader").classList.remove("gone")};Bc.ontoolresult=i=>{var e;try{const o=(e=i==null?void 0:i.content)==null?void 0:e.find(h=>h.type==="text");if(o&&"text"in o){const h=JSON.parse(o.text);h.config&&(wE=h.config.mapbox_token||"",SE=h.config.elevenlabs_api_key||""),Ep=h}}catch(o){console.error("Failed to parse geo_map tool result:",o)}Ote()};Bc.onhostcontextchanged=i=>{if(ZU(i),i.displayMode){A_=i.displayMode;const e=document.getElementById("tog-fullscreen");e&&e.classList.toggle("on",A_==="fullscreen"),setTimeout(()=>cn==null?void 0:cn.resize(),100)}};Bc.onteardown=async()=>(Ml&&(Ml.pause(),Ml=null),{});let A_="inline";async function Zte(){const i=A_==="fullscreen"?"inline":"fullscreen";A_=(await Bc.requestDisplayMode({mode:i})).mode;const o=document.getElementById("tog-fullscreen");o&&o.classList.toggle("on",A_==="fullscreen"),setTimeout(()=>cn==null?void 0:cn.resize(),100)}Ps("btn-close-detail").addEventListener("click",$te);Ps("tog-fullscreen").addEventListener("click",Zte);document.querySelectorAll("[data-layer]").forEach(i=>{i.addEventListener("click",()=>{Q_(i.dataset.layer)})});document.querySelectorAll("[data-fly]").forEach(i=>{i.addEventListener("click",()=>{const[e,o,h]=i.dataset.fly.split(",").map(Number);cn.flyTo({center:[e,o],zoom:h,pitch:45,bearing:-15,duration:2500})})});Bc.connect().then(()=>{const i=Bc.getHostContext();i&&ZU(i),Bc.sendSizeChanged({width:0,height:600}),console.log("[OASIS] Connected to Claude Desktop via MCP")});</script>
  <style rel="stylesheet" crossorigin>.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.mapboxgl-canvas{left:0;position:absolute;top:0}.mapboxgl-map:-webkit-full-screen{height:100%;width:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-webkit-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom,.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-left,.mapboxgl-ctrl-right,.mapboxgl-ctrl-top,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.mapboxgl-ctrl-top-left{left:0;top:0}.mapboxgl-ctrl-top{left:50%;top:0;transform:translate(-50%)}.mapboxgl-ctrl-top-right{right:0;top:0}.mapboxgl-ctrl-right{right:0;top:50%;transform:translateY(-50%)}.mapboxgl-ctrl-bottom-right{bottom:0;right:0}.mapboxgl-ctrl-bottom{bottom:0;left:50%;transform:translate(-50%)}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-left{left:0;top:50%;transform:translateY(-50%)}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{float:left;margin:10px 0 0 10px}.mapboxgl-ctrl-top .mapboxgl-ctrl{float:left;margin:10px 0}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{float:right;margin:10px 10px 0 0}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl,.mapboxgl-ctrl-right .mapboxgl-ctrl{float:right;margin:0 10px 10px 0}.mapboxgl-ctrl-bottom .mapboxgl-ctrl{float:left;margin:10px 0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl,.mapboxgl-ctrl-left .mapboxgl-ctrl{float:left;margin:0 0 10px 10px}.mapboxgl-ctrl-group{background:#fff;border-radius:4px}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media(-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{background-color:initial;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;overflow:hidden;padding:0;width:29px}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media(-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:initial}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl-group button:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:only-child{border-radius:inherit}.mapboxgl-ctrl button:not(:disabled):hover{background-color:#0000000d}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media(-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media(-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media(-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-buildings-toggle .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg fill='none' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3E%3Cpath d='M3.3335 11.6666C3.3335 12.5871 4.07969 13.3333 5.00016 13.3333C5.92064 13.3333 6.66683 12.5871 6.66683 11.6666L6.66683 6.66659L11.6668 6.66659C12.5873 6.66659 13.3335 5.92039 13.3335 4.99992C13.3335 4.07944 12.5873 3.33325 11.6668 3.33325H3.3335V11.6666Z' fill='currentColor'/%3E%3Cpath d='M26.6668 11.6666C26.6668 12.5871 25.9206 13.3333 25.0002 13.3333C24.0797 13.3333 23.3335 12.5871 23.3335 11.6666L23.3335 6.66659L18.3335 6.66659C17.413 6.66659 16.6668 5.92039 16.6668 4.99992C16.6668 4.07944 17.413 3.33325 18.3335 3.33325H26.6668L26.6668 11.6666Z' fill='currentColor'/%3E%3Cpath d='M13.3335 24.9999C13.3335 25.9204 12.5873 26.6666 11.6668 26.6666H3.3335V18.3333C3.3335 17.4128 4.07969 16.6666 5.00016 16.6666C5.92064 16.6666 6.66683 17.4128 6.66683 18.3333V23.3333H11.6668C12.5873 23.3333 13.3335 24.0794 13.3335 24.9999Z' fill='currentColor'/%3E%3Cpath d='M18.3335 26.6666C17.413 26.6666 16.6668 25.9204 16.6668 24.9999C16.6668 24.0794 17.413 23.3333 18.3335 23.3333H23.3335V18.3333C23.3335 17.4128 24.0797 16.6666 25.0002 16.6666C25.9206 16.6666 26.6668 17.4128 26.6668 18.3333V26.6666H18.3335Z' fill='currentColor'/%3E%3C/svg%3E");background-size:26px 26px}.mapboxgl-ctrl button.mapboxgl-ctrl-buildings-toggle.mapboxgl-ctrl-level-button-selected .mapboxgl-ctrl-icon{filter:invert(1) brightness(1)}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{animation:mapboxgl-spin 2s linear infinite}@media(-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}}@keyframes mapboxgl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='0.9' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media(-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:initial;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E")}}@media(-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23000'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{background-color:#fff;border-radius:12px;box-sizing:initial;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:#0000000d}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{right:0;top:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{left:0;top:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}.mapboxgl-ctrl-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:#000000bf;text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px;white-space:nowrap}.mapboxgl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{border:10px solid #0000;height:0;width:0;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.mapboxgl-popup-close-button{background-color:initial;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.mapboxgl-popup-close-button:hover{background-color:#0000000d}.mapboxgl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:10px 10px 15px;pointer-events:auto;position:relative}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{left:0;opacity:1;position:absolute;top:0;transition:opacity .2s;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.mapboxgl-user-location-dot:before{animation:mapboxgl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.mapboxgl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading{height:0;width:0}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after,.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-bottom:7.5px solid #4aa1eb;content:"";position:absolute}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-left:7.5px solid #0000;transform:translateY(-28px) skewY(-20deg)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after{border-right:7.5px solid #0000;transform:translate(7.5px,-28px) skewY(20deg)}@keyframes mapboxgl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}@media print{.mapbox-improve-map{display:none}}.mapboxgl-scroll-zoom-blocker,.mapboxgl-touch-pan-blocker{align-items:center;background:#000000b3;color:#fff;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;height:100%;justify-content:center;left:0;opacity:0;pointer-events:none;position:absolute;text-align:center;top:0;transition:opacity .75s ease-in-out;transition-delay:1s;width:100%}.mapboxgl-scroll-zoom-blocker-show,.mapboxgl-touch-pan-blocker-show{opacity:1;transition:opacity .1s ease-in-out}.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page,.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-ctrl-separator{background-color:#e0e0e0;height:1px}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button{align-items:center;color:#333;display:flex;font-size:18px;font-weight:700;height:50px;justify-content:center;line-height:normal;padding:0;text-align:center;width:50px}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button:first-child{border-top-left-radius:8px;border-top-right-radius:8px}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button:last-child{border-bottom-left-radius:8px;border-bottom-right-radius:8px}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button:hover{background-color:#f5f5f5}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button-selected{background-color:#4a5568;color:#fff}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button-selected:hover{background-color:#2d3748}</style>
</head>
<body>

<div class="loader" id="loader">
    <div class="loader-icon">ðŸŒ´</div>
    <div class="loader-text">Initializing OASIS</div>
    <div class="loader-bar"><div class="loader-fill"></div></div>
</div>

<div id="map"></div>

<div class="top-bar glass">
    <div class="logo">ðŸŒ´<span class="status-dot"></span></div>
    <h1>OASIS</h1>
</div>

<div class="nav-pills" id="nav-pills">
    <button class="nav-pill" data-fly="-0.187,5.6037,12">Accra</button>
    <button class="nav-pill" data-fly="-1.6244,6.6885,12">Kumasi</button>
    <button class="nav-pill" data-fly="-0.8393,9.4008,11">Tamale</button>
    <button class="nav-pill" data-fly="-0.8514,10.7856,11">Bolgatanga</button>
    <button class="nav-pill" data-fly="-1.0232,7.9465,6.5">Ghana</button>
</div>

<div class="detail-card glass" id="detail-card">
    <div class="detail-header">
        <div>
            <h2 id="d-name">â€”</h2>
            <span class="type-badge" id="d-type">â€”</span>
        </div>
        <button class="close-btn" id="btn-close-detail">âœ•</button>
    </div>
    <div class="detail-stats">
        <div class="stat-block"><div class="stat-val" id="d-specs">â€”</div><div class="stat-lbl">Specialties</div></div>
        <div class="stat-block"><div class="stat-val" id="d-dist">â€”</div><div class="stat-lbl">Distance</div></div>
        <div class="stat-block"><div class="stat-val" id="d-city">â€”</div><div class="stat-lbl">City</div></div>
    </div>
    <div class="detail-caps">
        <h4>Capabilities</h4>
        <div class="cap-chips" id="d-caps"></div>
    </div>
</div>

<div class="layers">
    <button class="layer-btn" id="tog-fullscreen">â›¶<span class="tip">Fullscreen</span></button>
    <button class="layer-btn on" id="tog-markers" data-layer="markers">ðŸ“<span class="tip">Markers</span></button>
    <button class="layer-btn" id="tog-heatmap" data-layer="heatmap">ðŸ”¥<span class="tip">Heatmap</span></button>
    <button class="layer-btn" id="tog-deserts" data-layer="deserts">ðŸœï¸<span class="tip">Deserts</span></button>
</div>

<div class="legend glass" id="heatmap-legend">
    <h4>Care Density</h4>
    <div class="legend-bar"></div>
    <div class="legend-labels"><span>Desert</span><span>Moderate</span><span>High</span></div>
</div>


</body>
</html>

